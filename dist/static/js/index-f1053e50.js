var Ze=Object.defineProperty,et=Object.defineProperties;var tt=Object.getOwnPropertyDescriptors;var ve=Object.getOwnPropertySymbols;var at=Object.prototype.hasOwnProperty,rt=Object.prototype.propertyIsEnumerable;var ye=(D,d,h)=>d in D?Ze(D,d,{enumerable:!0,configurable:!0,writable:!0,value:h}):D[d]=h,A=(D,d)=>{for(var h in d||(d={}))at.call(d,h)&&ye(D,h,d[h]);if(ve)for(var h of ve(d))rt.call(d,h)&&ye(D,h,d[h]);return D},w=(D,d)=>et(D,tt(d));import{g as ut,a9 as nt,O as ot,E as p,M as De,y as X,_ as Ee,l as st,h as lt,r as Z,af as it,j as _,n as ee,p as E,m as te,H as ct,t as M,z as R,k as $,A as f,J as q,C as Pe,F as dt,T as C,D as mt,X as pt}from"./vendor-ec22d003.js";import{_ as ft,C as Ce,I as ht,a1 as Ft,J as ge,a4 as Ne}from"./index-e28bc108.js";import{a as ae}from"./order-00cfd119.js";import{S as Y,R as B,f as vt}from"./infoCollection-979f62e4.js";import{p as Be,i as yt,s as Dt,g as Et,u as Ct,a as gt}from"./trial-2bf33e60.js";import{p as Nt}from"./product-3fa17019.js";import{g as Ie,t as Bt,v as re,a as _e,b as It}from"./utils-e0abdecf.js";import{f as _t,a as Ae}from"./utils-b77f2acb.js";import{t as At}from"./theme-ea709837.js";import{d as we,B as wt,D as Tt,G as Pt,S as Ot,H as St,P as bt,U as Ht,_ as xt,W as kt,p as Te,a as K}from"./auth-5d402231.js";import{_ as Ut}from"./index-0b0e8cd1.js";import"./trial-6cbc011a.js";import"./index-0949dbef.js";import"./bankCard-60b0c90c.js";import"./phoneVerify-d76df9f7.js";const Vt={key:0},Lt={class:"page-internet-product-detail"},Mt={class:"info"},Rt={class:"footer-button"},$t={class:"price"},qt=Pe(" \u603B\u4FDD\u8D39"),Yt={key:0},Kt=ut({setup(D){const d=nt(),h=ot(),{productCode:W="BWYL2021",tenantId:F,orderNo:g,phoneNo:ue,agentCode:T="",saleChannelId:Oe,paymentMethod:Se,certNo:ne,name:oe,pageCode:se,upgradeCode:be,from:le}=h.query,ie=p(),l=p(),P=p(),y=p(),k=se==="payBack",He=p(!1),U=p(!1),V=p(!1),xe=p(0),J=p(!1),z=p(!1),G=p({show:!1,html:""}),j=p(!1);let Q="";const t=De({holder:{certNo:ne,certType:Ce.CERT,mobile:ue,name:oe,socialFlag:Y.HAS},insured:{certNo:ne,certType:Ce.CERT,name:oe,socialFlag:Y.HAS,relationToHolder:B.SELF},paymentMethod:Se,renewalDK:"Y",paymentFrequency:vt.MONTH}),L=p(we),I=p(we),i=De({showInsure:!k,canInsure:!1,canUpgrade:!1}),ke=X(()=>{var a,e;return((e=(a=l.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:e.attachmentVOList.filter(r=>r.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),Ue=X(()=>{var a,e,r,n,u,o,s,c;return[...((e=(a=l.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:e.titleAndDescVOS)||[],{desc:`\u51FA\u751F${_t((n=(r=l.value)==null?void 0:r.tenantProductInsureVO)==null?void 0:n.holderAgeLimit)}`,title:"\u6295\u4FDD\u5E74\u9F84",noDetail:!0},{desc:Ae((o=(u=l.value)==null?void 0:u.tenantProductInsureVO)==null?void 0:o.insurancePeriodValues),title:"\u4FDD\u969C\u671F\u9650",noDetail:!0},{desc:Ae((c=(s=l.value)==null?void 0:s.tenantProductInsureVO)==null?void 0:c.waitPeriod)||"",title:"\u7B49\u5F85\u671F",noDetail:!0}]}),Ve=X(()=>{var a,e;return((e=(a=l.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:e.attachmentVOList.filter(r=>r.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),ce=()=>{if(t.holder.certNo){const a=ge(t.holder.certNo);if(re(t.holder.certNo,18,"year"))return C("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E18\u5C81\uFF01"),!1;if(t.insured.certNo&&t.insured.relationToHolder===B.MATE){const e=ge(t.insured.certNo);if(a===e)return C("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(t.insured.certNo){if(t.insured.relationToHolder===B.CHILD&&re(t.insured.certNo,30,"day"))return C("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(t.insured.relationToHolder===B.PARENT&&!re(t.insured.certNo,71,"year"))return C("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E70\u5C81\uFF01"),!1}if([B.CHILD,B.PARENT].includes(t.insured.relationToHolder)){const a=_e(t.holder.certNo,"year"),e=_e(t.insured.certNo,"year");if(t.insured.relationToHolder===B.CHILD&&a-e<18)return C("\u6295\u4FDD\u4EBA\u548C\u5B50\u5973\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1;if(t.insured.relationToHolder===B.PARENT&&e-a<18)return C("\u6295\u4FDD\u4EBA\u548C\u7236\u6BCD\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1}return!0},Le=()=>{const{holder:{certNo:a,mobile:e,name:r,socialFlag:n},insured:{certNo:u,name:o,socialFlag:s,relationToHolder:c},paymentMethod:v}=t;return ht(u)&&!!s},de=()=>{d.push({path:"/internet/guaranteeUpgrade",query:w(A({},h.query),{tenantId:F,productCode:"BWYL2022",orderNo:g,agentCode:T})})},Me=()=>{z.value=!1,d.replace(`/pay?orderNo=${g}&saleUserId=${T}&tenantId=${F}`)},Re=()=>{I.value=L.value},$e=()=>{I.value=w(A({},I.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},qe=async a=>{C.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0,duration:0});try{const e=await Ct(a),{code:r}=e;if(r==="10000"){const n=await gt({orderNo:a.orderNo,tenantId:F}),{data:u}=n;n.code==="10000"&&(u.type===2?(G.value={show:!0,html:u.paymentUrl},pt(()=>{const o=document.getElementById("cashierSubmit");o==null||o.addEventListener("submit",s=>{s.preventDefault()}),o==null||o.submit()})):window.location.href=u.paymentUrl)}i.canInsure=!0}catch{i.canInsure=!0}finally{C.clear()}},Ye=a=>{var u,o;const e=JSON.parse((o=(u=P.value)==null?void 0:u.productBasicInfoVO)==null?void 0:o.extInfo);let r="";return e.endorsementFlag===1&&(r=`&upgradeCode=${e.endorsementCode}`),`${Ne}/internet/productDetail?tenantId=${F}&productCode=${W}&orderNo=${a}&agentCode=${T}&pageCode=payBack${r}&from=${le||"normal"}`},Ke=a=>`${Ne}/internet/payFail?tenantId=${F}&orderNo=${a}&agentCode=${T}&pageCode=payBack&from=${le||"normal"}`,We=async a=>{const e=It({tenantId:F,saleUserId:T,saleChannelId:Oe,detail:l.value,insureDetail:P.value,paymentMethod:t.paymentMethod,renewalDK:t.renewalDK,iseeBizNo:Q,successJumpUrl:"",premium:y.value,holder:t.holder,insured:t.insured,tenantOrderRiskList:a,orderStatus:"",orderTopStatus:""});try{const r=await Dt(e),{code:n,data:u}=r;n==="10000"&&qe(w(A({},e),{orderNo:u.data,extInfo:{extraInfo:{renewalDK:t.renewalDK,paymentMethod:t.paymentMethod,paymentFrequency:t.paymentFrequency,successJumpUrl:Ye(u.data),failUrl:Ke(u.data)},iseeBizNo:Q}}))}catch{i.canInsure=!0}},Je=async()=>{if(i.canInsure=!0,!ce())return{};const{calcData:a,riskVOList:e}=Ie({holder:t.holder,insured:t.insured,tenantId:F,paymentFrequency:t.paymentFrequency,productDetail:l.value,insureDetail:P.value},!0);if(!Array.isArray(e)||e.length<1)return C("\u88AB\u4FDD\u4EBA\u5E74\u9F84\u9700\u572830\u5929(\u542B) - 70\u5C81(\u542B)\u4E4B\u95F4\uFF01"),y.value=null,{};j.value=!0;const r=await Be(a);j.value=!1;const{code:n,data:u}=r;return n==="10000"?t.insured.certNo?(y.value=u.premium,{condition:e,data:u}):(y.value=null,{condition:e,data:u}):{}},ze=()=>new Promise((a,e)=>{var r,n;(n=(r=ie.value)==null?void 0:r.validateForm)==null||n.call(r).then(async()=>{if(!ce()){e(new Error);return}const{calcData:u,riskVOList:o}=Ie({holder:t.holder,insured:t.insured,tenantId:F,paymentFrequency:t.paymentFrequency,productDetail:l.value,insureDetail:P.value},!0),s=await Be(u),{code:c,data:v}=s;c==="10000"?(y.value=v.premium,a({condition:o,data:v})):e(new Error)}).catch(()=>{i.canInsure=!0})}),me=async()=>{var a;if(k){de();return}i.canInsure=!1;try{const{condition:e,data:r}=await ze(),n={},u=(s=[])=>{(s||[]).forEach(c=>{var v;n[c.riskCode]=c,((v=c.riskPremiumDetailVOList)==null?void 0:v.length)&&u(c.riskPremiumDetailVOList)})};u(r.riskPremiumDetailVOList);const o=Bt({tenantId:F,riskList:e,riskPremium:n,productId:(a=l.value)==null?void 0:a.id});We(o)}catch{i.canInsure=!0}},Ge=a=>{a==="allFalse"?(U.value=!1,me(),i.canInsure=!0):mt.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"}).then(()=>{window.history.back()})},je=()=>{He.value=!0,V.value=!1,U.value=!0};Ee([()=>t.insured.certNo,()=>t.insured.socialFlag],st.exports.debounce(()=>{t.insured.certNo&&t.insured.socialFlag&&se!=="payBack"&&Le()&&Je()},500),{deep:!0,immediate:!0}),Ee(()=>t.insured.certNo,()=>{t.insured.certNo||(y.value=null)});const pe=async()=>{var n,u,o,s,c,v,O,S,b,H,fe,he,Fe;const a=await Et({orderNo:g,tenantId:F}),{code:e,data:r}=a;if(e==="10000"){const{tenantOrderHolder:N,tenantOrderInsuredList:m,extInfo:x}=r;if(!k){Object.assign(t,{holder:{certNo:N.certNo,certType:N.certType,mobile:N.mobile,name:N.name,socialFlag:Y.HAS},insured:{certNo:m==null?void 0:m[0].certNo,certType:(n=m[0])==null?void 0:n.certType,name:(u=m[0])==null?void 0:u.name,socialFlag:(s=(o=m[0])==null?void 0:o.extInfo)==null?void 0:s.hasSocialInsurance,relationToHolder:(c=m[0])==null?void 0:c.relationToHolder},paymentMethod:x.extraInfo.paymentMethod,paymentFrequency:x.extraInfo.paymentFrequency,renewalDK:"Y"}),i.canInsure=!0;return}Object.assign(t,{holder:{certNo:N.certNo,certType:N.certType,mobile:N.mobile,name:N.name,socialFlag:Y.HAS},insured:{certNo:m==null?void 0:m[0].certNo,certType:(v=m[0])==null?void 0:v.certType,name:(O=m[0])==null?void 0:O.name,socialFlag:(b=(S=m[0])==null?void 0:S.extInfo)==null?void 0:b.hasSocialInsurance,relationToHolder:(H=m[0])==null?void 0:H.relationToHolder},paymentMethod:x.extraInfo.paymentMethod,paymentFrequency:x.extraInfo.paymentFrequency,renewalDK:x.extraInfo.renewalDK||"N"}),y.value=(Fe=(he=(fe=m[0])==null?void 0:fe.tenantOrderProductList)==null?void 0:he[0])==null?void 0:Fe.premium,(r.orderStatus===ae.ACCEPT_POLICY||r.orderStatus===ae.PAYMENT_SUCCESS)&&(i.canUpgrade=!0,J.value=!1,z.value=!0),r.orderStatus===ae.PAYING&&(J.value=!0,setTimeout(()=>{pe()},3*1e3))}},Qe=async()=>{const a=Nt({productCode:W,withInsureInfo:!0,tenantId:F}),e=yt({productCode:W});await Promise.all([a,e]).then(([r,n])=>{var u;r.code==="10000"&&(l.value=r.data,document.title=((u=r.data)==null?void 0:u.productFullName)||""),n.code==="10000"&&(P.value=n.data)}),g&&pe()},Xe=()=>{k?(I.value=Te,L.value=Te,console.log("\u652F\u4ED8\u5B8C\u6210\u8FDB\u5165")):g?(console.log("\u6295\u4FDD\u94FE\u63A5-\u6765\u4ED8\u94B1"),I.value=w(A({},K),{paymentFrequencyDisable:!0}),L.value=K,i.canInsure=!0):ue||g||(console.log("\u6295\u4FDD\u94FE\u63A5"),I.value=w(A({},K),{paymentFrequencyDisable:!0}),L.value=K,i.canInsure=!0)};return lt(()=>{Xe(),Qe(),setTimeout(async()=>{Q=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(a,e)=>{const r=Z("van-loading"),n=Z("van-button"),u=Z("van-config-provider"),o=it("dompurify-html");return _(),ee(dt,null,[E(u,{"theme-vars":f(At)},{default:te(()=>{var s,c,v,O,S,b,H;return[G.value.show?ct((_(),ee("div",Vt,null,512)),[[o,G.value.html]]):M("",!0),R("div",Lt,[R("div",Mt,[E(wt,{url:(c=(s=l.value)==null?void 0:s.tenantProductInsureVO)==null?void 0:c.banner[0]},null,8,["url"]),E(Tt,{"product-name":(v=l.value)==null?void 0:v.productFullName,"product-desc":(S=(O=l.value)==null?void 0:O.showConfigVO)==null?void 0:S.desc},null,8,["product-name","product-desc"])]),((H=(b=l.value)==null?void 0:b.tenantProductInsureVO)==null?void 0:H.titleAndDescVOS)?(_(),$(Pt,{key:0,"guarantee-list":f(Ue)},null,8,["guarantee-list"])):M("",!0),E(Ot,{detail:l.value},{form:te(()=>[E(St,{ref_key:"formRef",ref:ie,disable:!f(i).showInsure,"form-auth":I.value,"form-info":f(t),premium:y.value,"product-detail":l.value,payments:[1],"payment-method":[0],onOnReset:Re,onOnUpdate:$e},null,8,["disable","form-auth","form-info","premium","product-detail"])]),_:1},8,["detail"]),R("div",Rt,[R("div",$t,[qt,j.value?(_(),$(r,{key:1,class:"premium-loading",type:"spinner"})):(_(),ee("span",Yt,q(y.value?"\uFFE5":"")+q(f(Ft)(y.value))+q(y.value?"\u5143/\u6708":""),1))]),E(n,{type:"primary",class:"right",disabled:!(f(i).canInsure||f(i).canUpgrade),onClick:me},{default:te(()=>[Pe(q(f(i).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),f(g)?M("",!0):(_(),$(bt,{key:1,"product-detail":l.value},null,8,["product-detail"])),E(Ht,{"order-no":f(g),"tenant-id":f(F),"upgrade-code":f(be),"is-show":z.value,onOnConfirm:de,onOnClose:Me},null,8,["order-no","tenant-id","upgrade-code","is-show"])]}),_:1},8,["theme-vars"]),E(xt,{show:U.value,"onUpdate:show":e[0]||(e[0]=s=>U.value=s),"content-list":f(ke),"active-index":0,onOnConfirmHealth:Ge},null,8,["show","content-list"]),V.value?(_(),$(Ut,{key:0,show:V.value,"onUpdate:show":e[1]||(e[1]=s=>V.value=s),"content-list":f(Ve),"active-index":xe.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9",onSubmit:je},null,8,["show","content-list","active-index"])):M("",!0),E(kt,{"is-show":J.value},null,8,["is-show"])],64)}}});var la=ft(Kt,[["__scopeId","data-v-2fac69c9"]]);export{la as default};
