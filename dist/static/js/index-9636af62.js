import{h as le,r as E,$ as re,k as m,m as v,n as R,p as d,B as i,t as l,s as X,H as ce,L as b,F as fe,G as H,aa as ye,P as Ce,R as Ae,N as Be,A as se,o as De,C as c,x as J,d as ue,T as he}from"./vendor-902054a7.js";import{_ as ge,m as Pe,h as Te,g as Re,A as w,t as T,N as be,n as xe,b as Ne}from"./index-3a9ce3bd.js";import{p as Fe}from"./trial-378270e6.js";import{P as ie,I as de,R as Ve}from"./trial-40f2c4e1.js";import{u as ke}from"./useDicData-89e61451.js";import{R as He,a as Se,B as Ue,b as we}from"./infoCollection-0841e133.js";import{_ as ne}from"./index-11007cd4.js";import"./relativeTime-cdc592a9.js";const $e={class:"com-select-container"},je={class:"radio-item-wrapper"},Me={class:"name"},Ye={class:"hone"},qe={class:"address"},Ge={class:"footer-button"},Ke=H("\u53D6\u6D88"),We=H("\u786E\u8BA4"),Je=le({props:{dataSource:{type:Array,default:()=>[]},show:{type:Boolean,default:!1},modelValue:{type:[String,Number],default:null}},emits:["update","update:modelValue","submit","close"],setup(z,{emit:$}){const x=z,D=E(x.modelValue),j=E(x.show),Q=()=>{$("submit",D.value),j.value=!1},Z=()=>{$("close")};return re(()=>x.modelValue,M=>{D.value=M}),re(()=>D.value,M=>{$("update:modelValue",M)}),(M,N)=>{const W=m("van-radio"),Y=m("van-radio-group"),q=m("VanButton");return v(),R(Pe,{show:j.value,"onUpdate:show":N[1]||(N[1]=L=>j.value=L),class:"com-select",title:"\u9009\u62E9\u4FDD\u5355\u901A\u8BAF\u4FE1\u606F",onClose:Z},{default:d(()=>[i("div",$e,[l(Y,{modelValue:D.value,"onUpdate:modelValue":N[0]||(N[0]=L=>D.value=L)},{default:d(()=>[(v(!0),X(fe,null,ce(z.dataSource,(L,F)=>(v(),R(W,{key:F,name:F+1,class:"radio-item"},{default:d(()=>[i("div",je,[i("p",null,[i("span",Me,b(L.contactName),1),i("span",Ye,b(L.contactPhoneNo),1)]),i("p",qe,b(L.contactAddress),1)])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),i("div",Ge,[l(q,{plain:"",type:"primary"},{default:d(()=>[Ke]),_:1}),l(q,{type:"primary",onClick:Q},{default:d(()=>[We]),_:1})])]),_:1},8,["show"])}}});var Xe=ge(Je,[["__scopeId","data-v-a821acd4"]]);const ze={key:0,class:"beneficiary-part"},Qe={class:"part-title"},Ze={class:"title"},et=H("\u5220\u9664"),tt=H("+\u6DFB\u52A0\u53D7\u76CA\u4EBA"),nt=H("\u9009\u62E9\u4FDD\u5355\u901A\u8BAF\u4FE1\u606F"),rt={class:"radio-item-wrapper"},ot={class:"name"},at={class:"hone"},st={class:"address"},ut={class:"footer-button","safe-area-inset-bottom":""},it={class:"left"},dt={class:"trial-result"},lt=H(" \u9996\u671F"),ct={class:"result-num"},ft=i("div",{class:"result-desc"},"\u5B9E\u9645\u4FDD\u8D39\u4EE5\u540E\u7EED\u4E3A\u51C6",-1),pt={class:"operate-btn"},mt=H("\u4E0B\u4E00\u6B65"),At=le({setup(z){const $=ye(),x=Ce(),{templateId:D=1,orderNo:j="2022072710380711215",productCode:Q,tenantId:Z="9991000007",proposalId:M,insurerCode:N="kunlunhealth"}=x.query,[W,Y]=Ae(),q=x.path==="/infoPreview"?"infoPreview":"infoCollection",L=ke("NATIONAL_REGION_CODE"),F=E({}),e=E({extInfo:{pageCode:q},tenantOrderHolder:{extInfo:{occupationCodeList:[]},holderType:1},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},insuredBeneficiaryType:"1",tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}]}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}}),ee=E(null),h=E([]),S=E([]),G=E([]),te=E([]),oe=E([]),g=Be({beneficiaryId:0,nextPage:"",currentAddress:null,isLoading:!0}),ae=se(()=>{var t,u,s,r,o,f,p,y,C,A;return[{contactAddress:(u=(t=e.value.tenantOrderHolder)==null?void 0:t.extInfo)==null?void 0:u.familyAddress,contactName:e.value.tenantOrderHolder.name,contactPhoneNo:e.value.tenantOrderHolder.mobile},{contactAddress:(r=(s=e.value.tenantOrderHolder)==null?void 0:s.extInfo)==null?void 0:r.workAddress,contactName:e.value.tenantOrderHolder.name,contactPhoneNo:e.value.tenantOrderHolder.mobile},{contactAddress:(f=(o=e.value.tenantOrderInsuredList[0])==null?void 0:o.extInfo)==null?void 0:f.familyAddress,contactName:(p=e.value.tenantOrderInsuredList[0])==null?void 0:p.name,contactPhoneNo:(y=e.value.tenantOrderInsuredList[0])==null?void 0:y.mobile},{contactAddress:(A=(C=e.value.tenantOrderInsuredList[0])==null?void 0:C.extInfo)==null?void 0:A.workAddress,contactName:e.value.tenantOrderInsuredList[0].name,contactPhoneNo:e.value.tenantOrderInsuredList[0].mobile}].filter(_=>_.contactAddress&&_.contactName&&_.contactPhoneNo)||[]}),K=se(()=>{var a,t;return g.currentAddress?ae.value[g.currentAddress-1]||{}:((t=(a=e.value.extInfo)==null?void 0:a.contactInfo)==null?void 0:t[0])||{}}),pe=a=>{const t={};return a.map(u=>{const{initialAmount:s,annuityDrawFrequency:r,annuityDrawType:o,paymentFrequency:f,paymentPeriod:p,paymentPeriodType:y,insurancePeriodType:C,insurancePeriodValue:A,riskCode:_,riskType:V,initialPremium:U,liabilityDetails:k,extInfo:O}=u,{riskId:P,copy:n}=O,I={amount:s,annuityDrawDate:r,annuityDrawType:o,paymentFrequency:f,riskId:P,copy:n,chargePeriod:p?`${ie[y]}_${p}`:ie[y],coveragePeriod:A?`${de[C]}_${A}`:de[C],riskCode:_,riskType:V,premium:U,liabilityVOList:k.map(B=>({...B,liabilityAttributeValue:B.refundMethod,liabilityAttributeCode:B.refundMethod&&1}))};return V===Ve.MAIN_RISK?(t.mainRiskCode=_,t.mainRiskId=P):Object.assign(I,t),I})},me=()=>{var t;const a={...e.value};a.extInfo={...a.extInfo,contactInfo:[K.value],buttonCode:be.infoCollection},a.tenantOrderAttachmentList=[{category:w.OBVERSE_CERT,objectType:T.HOLDER,objectId:e.value.tenantOrderHolder.id,name:"\u6295\u4FDD\u4EBA\u8BC1\u4EF6\u6B63\u9762",uri:h.value[0],id:G.value[0]},{category:w.REVERSE_CERT,objectType:T.HOLDER,objectId:e.value.tenantOrderHolder.id,name:"\u6295\u4FDD\u4EBA\u8BC1\u4EF6\u80CC\u9762",uri:h.value[1],id:G.value[1]},{category:w.OBVERSE_CERT,objectType:T.INSURED,objectId:e.value.tenantOrderInsuredList[0].id,name:"\u88AB\u4FDD\u4EBA\u8BC1\u4EF6\u6B63\u9762",uri:S.value[0]||h.value[0],id:te.value[1]},{category:w.REVERSE_CERT,objectType:T.INSURED,objectId:e.value.tenantOrderInsuredList[0].id,name:"\u88AB\u4FDD\u4EBA\u8BC1\u4EF6\u80CC\u9762",uri:S.value[1]||h.value[1],id:te.value[1]}].filter(u=>u.uri),(t=ee.value)==null||t.validate().then(u=>{if(a.tenantOrderInsuredList[0].insuredBeneficiaryType===we.SPECIFY){const s={};if(a.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.forEach(r=>{s[r.benefitOrder]?s[r.benefitOrder].sum+=Number(r.benefitRate):s[r.benefitOrder]={sum:Number(r.benefitRate)}}),Object.values(s).some(r=>r.sum!==100)){he.fail("\u540C\u4E00\u987A\u4F4D\u7684\u53D7\u76CA\u4EBA\u6BD4\u4F8B\u4E4B\u548C\u5FC5\u987B\u4E3A100");return}}xe(a).then(({code:s,data:r})=>{s==="10000"&&r.pageAction.pageAction==="jumpToPage"&&$.push({path:Ne[r.pageAction.data.nextPageCode],query:x.query})})})},Ie=()=>{var a;(a=ee.value)==null||a.validate().then(()=>{const{birthday:t,gender:u,extInfo:s}=e.value.tenantOrderHolder,{hasSocialInsurance:r,occupationCodeList:o}=s,{birthday:f,gender:p,extInfo:y,tenantOrderProductList:C}=e.value.tenantOrderInsuredList[0],{hasSocialInsurance:A,occupationCodeList:_}=y,V={holder:{personVO:{birthday:ue(t).format("YYYY-MM-DD"),gender:u,socialFlag:r,occupationCodeList:o}},productCode:Q,insuredVOList:[{insurerCode:N,personVO:{birthday:ue(f).format("YYYY-MM-DD"),gender:p,socialFlag:A,occupationCodeList:_},productPlanVOList:[{insurerCode:N,planCode:"",riskVOList:pe(C[0].tenantOrderRiskList)}]}]};Fe({...V}).then(({code:U,data:k})=>{if(U==="10000"){const O={},P=(n=[])=>{(n||[]).forEach(I=>{var B;O[I.riskCode]=I,(B=I.riskPremiumDetailVOList)!=null&&B.length&&P(I.riskPremiumDetailVOList)})};P(k.riskPremiumDetailVOList),e.value.tenantOrderInsuredList[0].tenantOrderProductList[0]={...e.value.tenantOrderInsuredList[0].tenantOrderProductList[0],premium:k.premium,tenantOrderRiskList:e.value.tenantOrderInsuredList[0].tenantOrderProductList[0].tenantOrderRiskList.map(n=>({...n,initialAmount:O[n.riskCode].amount,initialPremium:O[n.riskCode].premium}))},me()}})})},ve=a=>{},_e=()=>{g.beneficiaryId+=1,e.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.push({id:g.beneficiaryId,extInfo:{}})},Oe=a=>{e.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList=e.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.filter(t=>t.beneficiaryId!==a.beneficiaryId||a.id!==t.id)},Ee=()=>{Re({orderNo:j,tenantId:Z}).then(({code:a,data:t})=>{var u,s;if(a==="10000"){const r=t;r.extInfo={...r.extInfo,pageCode:q,templateId:D},r.tenantOrderHolder=r.tenantOrderHolder||{holderType:1},r.tenantOrderHolder.extInfo={...r.tenantOrderHolder.extInfo,occupationCodeList:((u=r.tenantOrderHolder.extInfo)==null?void 0:u.occupationCodeList)||[]},r.tenantOrderInsuredList[0].extInfo={...r.tenantOrderInsuredList[0].extInfo,occupationCodeList:((s=r.tenantOrderInsuredList[0].extInfo)==null?void 0:s.occupationCodeList)||[]},r.tenantOrderInsuredList[0].tenantOrderBeneficiaryList=r.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.map(o=>{var p;const f=o;return f.extInfo={...f.extInfo,occupationCodeList:((p=f.extInfo)==null?void 0:p.occupationCodeList)||[]},f}),r.tenantOrderAttachmentList.forEach(o=>{o.category===w.OBVERSE_CERT?o.objectType===T.HOLDER?(h.value[0]=o.uri,G.value[0]=o.id):o.objectType===T.INSURED&&(S.value[0]=o.uri,te.value[0]=o.id):o.category===w.REVERSE_CERT&&(o.objectType===T.HOLDER?(h.value[1]=o.uri,G.value[1]=o.id):o.objectType===T.INSURED&&(S.value[1]=o.uri,G.value[1]=o.id))}),Object.assign(e.value,r)}}).finally(()=>{g.isLoading=!1})},Le=()=>{Object.assign(e.value.tenantOrderInsuredList[0],e.value.tenantOrderHolder,{id:e.value.tenantOrderInsuredList[0].id,extInfo:{...e.value.tenantOrderHolder.extInfo,insureProvinceCode:e.value.tenantOrderInsuredList[0].extInfo.insureProvinceCode,insureCityCode:e.value.tenantOrderInsuredList[0].extInfo.insureCityCode,insureAreaCode:e.value.tenantOrderInsuredList[0].extInfo.insureAreaCode}})};return De(()=>{Ee(),Te({pageCode:"infoCollection",templateId:D}).then(({code:a,data:t})=>{if(a==="10000"){const u={BENEFICIARY:[],INSURER:[],HOLDER:[]};t.productInsureFactorList.forEach(s=>{(u[s.moduleType]=u[s.moduleType]||[]).push(s)}),F.value=u}})}),re([()=>e.value.tenantOrderInsuredList[0].relationToHolder,()=>e.value.tenantOrderHolder],()=>{`${e.value.tenantOrderInsuredList[0].relationToHolder}`===He.SELF&&Le()},{deep:!0,immediate:!0}),(a,t)=>{const u=m("ProCard"),s=m("ProRadioButton"),r=m("ProField"),o=m("ProCascader"),f=m("ProSvg"),p=m("VanButton"),y=m("ProCheckButton"),C=m("van-cell"),A=m("ProForm"),_=m("ProPageWrap");return v(),R(_,{class:"page-info-wrapper"},{default:d(()=>{var V,U,k,O,P;return[c(g).isLoading?J("",!0):(v(),R(A,{key:0,ref_key:"formRef",ref:ee},{default:d(()=>[l(u,{title:"\u6295\u4FDD\u4EBA"},{default:d(()=>[l(ne,{images:h.value,"onUpdate:images":t[0]||(t[0]=n=>h.value=n),"form-info":e.value.tenantOrderHolder,"factor-list":F.value.HOLDER,prefix:"holder"},null,8,["images","form-info","factor-list"])]),_:1}),l(u,{title:"\u88AB\u4FDD\u4EBA"},{default:d(()=>[l(r,{modelValue:e.value.tenantOrderInsuredList[0].relationToHolder,"onUpdate:modelValue":t[2]||(t[2]=n=>e.value.tenantOrderInsuredList[0].relationToHolder=n),label:"\u4E3A\u8C01\u4FDD\u5355",name:"relationToHolder",placeholder:"\u8BF7\u9009\u62E9"},{input:d(()=>[l(s,{modelValue:e.value.tenantOrderInsuredList[0].relationToHolder,"onUpdate:modelValue":t[1]||(t[1]=n=>e.value.tenantOrderInsuredList[0].relationToHolder=n),options:c(Se)},null,8,["modelValue","options"])]),_:1},8,["modelValue"]),+e.value.tenantOrderInsuredList[0].relationToHolder!=1?(v(),R(ne,{key:0,images:S.value,"onUpdate:images":t[3]||(t[3]=n=>S.value=n),"form-info":e.value.tenantOrderInsuredList[0],"factor-list":F.value.INSURER||[],prefix:"insure"},null,8,["images","form-info","factor-list"])):J("",!0),l(o,{modelValue:e.value.tenantOrderInsuredList[0].extInfo.insureAreaCode,"onUpdate:modelValue":t[4]||(t[4]=n=>e.value.tenantOrderInsuredList[0].extInfo.insureAreaCode=n),field1:e.value.tenantOrderInsuredList[0].extInfo.insureProvinceCode,"onUpdate:field1":t[5]||(t[5]=n=>e.value.tenantOrderInsuredList[0].extInfo.insureProvinceCode=n),field2:e.value.tenantOrderInsuredList[0].extInfo.insureCityCode,"onUpdate:field2":t[6]||(t[6]=n=>e.value.tenantOrderInsuredList[0].extInfo.insureCityCode=n),field3:e.value.tenantOrderInsuredList[0].extInfo.insureAreaCode,"onUpdate:field3":t[7]||(t[7]=n=>e.value.tenantOrderInsuredList[0].extInfo.insureAreaCode=n),label:"\u6295\u4FDD\u5730\u533A",name:"insureAreaCode",placeholder:"\u8BF7\u9009\u62E9","is-link":"",required:"","data-source":c(L),mapping:{label:"name",value:"code",children:"children"}},null,8,["modelValue","field1","field2","field3","data-source"])]),_:1}),l(u,{title:"\u53D7\u76CA\u4EBA"},{default:d(()=>[l(r,{modelValue:e.value.tenantOrderInsuredList[0].insuredBeneficiaryType,"onUpdate:modelValue":t[9]||(t[9]=n=>e.value.tenantOrderInsuredList[0].insuredBeneficiaryType=n),label:"\u53D7\u76CA\u4EBA\u7C7B\u578B",name:"insuredBeneficiaryType",placeholder:"\u8BF7\u9009\u62E9"},{input:d(()=>[l(s,{modelValue:e.value.tenantOrderInsuredList[0].insuredBeneficiaryType,"onUpdate:modelValue":t[8]||(t[8]=n=>e.value.tenantOrderInsuredList[0].insuredBeneficiaryType=n),options:c(Ue)},null,8,["modelValue","options"])]),_:1},8,["modelValue"]),e.value.tenantOrderInsuredList[0].insuredBeneficiaryType==2?(v(),X("div",ze,[(v(!0),X(fe,null,ce(e.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList,(n,I)=>(v(),X("div",{key:n.beneficiaryId||n.id,class:"beneficiary-item"},[i("div",Qe,[i("span",Ze,b(`\u53D7\u76CA\u4EBA${I+1}`),1),l(f,{name:"delete",onClick:B=>Oe(n)},{default:d(()=>[et]),_:2},1032,["onClick"])]),l(ne,{images:oe.value,"onUpdate:images":t[10]||(t[10]=B=>oe.value=B),"form-info":n,"factor-list":F.value.BENEFICIARY||[],prefix:`beneficiary-${I}`,"beneficiary-list":e.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList},null,8,["images","form-info","factor-list","prefix","beneficiary-list"])]))),128)),l(p,{onClick:_e},{default:d(()=>[tt]),_:1})])):J("",!0)]),_:1}),l(u,{title:"\u4FDD\u5355\u901A\u8BAF\u4FE1\u606F"},{default:d(()=>{var n;return[(n=Object.keys(c(K)))!=null&&n.length?(v(),R(C,{key:1,title:"\u5355\u5143\u683C","is-link":"",onClick:t[12]||(t[12]=I=>c(Y)(!0))},{title:d(()=>[i("div",rt,[i("p",null,[i("span",ot,b(c(K).contactName),1),i("span",at,b(c(K).contactPhoneNo),1)]),i("p",st,b(c(K).contactAddress),1)])]),_:1})):(v(),R(y,{key:0,activated:"",onClick:t[11]||(t[11]=I=>c(Y)(!0))},{default:d(()=>[nt]),_:1}))]}),_:1})]),_:1},512)),i("div",ut,[i("div",it,[i("div",dt,[lt,i("span",ct,"\uFFE5"+b((P=(O=(k=(U=(V=e.value.tenantOrderInsuredList)==null?void 0:V[0])==null?void 0:U.tenantOrderProductList)==null?void 0:k[0].premium)==null?void 0:O.toLocaleString)==null?void 0:P.call(O)),1)]),ft]),i("div",pt,[l(p,{block:"",type:"primary",onClick:Ie},{default:d(()=>[mt]),_:1})])]),c(W)?(v(),R(Xe,{key:1,modelValue:c(g).currentAddress,"onUpdate:modelValue":t[13]||(t[13]=n=>c(g).currentAddress=n),show:c(W),"data-source":c(ae),onSubmit:ve,onClose:t[14]||(t[14]=n=>c(Y)(!1))},null,8,["modelValue","show","data-source"])):J("",!0)]}),_:1})}}});export{At as default};
