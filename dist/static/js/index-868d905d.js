var ye=Object.defineProperty,me=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var ae=Object.getOwnPropertySymbols;var Te=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable;var ne=(c,n,f)=>n in c?ye(c,n,{enumerable:!0,configurable:!0,writable:!0,value:f}):c[n]=f,O=(c,n)=>{for(var f in n||(n={}))Te.call(n,f)&&ne(c,f,n[f]);if(ae)for(var f of ae(n))Ne.call(n,f)&&ne(c,f,n[f]);return c},P=(c,n)=>me(c,ge(n));import{g as Re,O as Ie,ak as Oe,E as w,d as Se,y as oe,h as ke,r as Y,j as E,k as U,m as C,z as o,p as D,J as y,n as v,L as re,t as S,A as N,G,F as J,a4 as xe,a5 as Le,C as x,T as k,D as Pe}from"./vendor-e057bbeb.js";import{q as be}from"./index-15376f4b.js";import{_ as we,S as Ue,K as He,L as Me,q as Q,l as H,M as ie,r as le,G as $e,n as Ve,P as je,Q as z,R as M}from"./index-fc868a0a.js";import{_ as qe}from"./index-b5d78519.js";import{f as Ye,s as ce,g as de,a as Ge}from"./verify-951d93d0.js";import{a as Je}from"./order-35b0e3c5.js";const W=c=>(xe("data-v-41c5ea06"),c=c(),Le(),c),Qe={class:"page-verify"},ze={class:"people"},We={class:"name"},Ke={class:"verify-item"},Xe=W(()=>o("div",{class:"label"},"\u8BC1\u4EF6\u53F7\u7801",-1)),Ze={class:"no"},eu=x(" \u53BB\u8BA4\u8BC1 "),uu={class:"sign-body"},tu={class:"date"},su={class:"file"},au=x(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A "),nu={class:"people"},ou={class:"name"},ru={class:"verify-item"},iu=W(()=>o("div",{class:"label"},"\u8BC1\u4EF6\u53F7\u7801",-1)),lu={class:"no"},cu=["onClick"],du=x(" \u53BB\u8BA4\u8BC1 "),Bu=["onClick"],Eu={class:"sign-body"},fu={class:"date"},_u={class:"file"},Cu=x(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A "),Du={class:"footer-button footer"},Fu=W(()=>o("div",{class:"text"},"\u5237\u65B0",-1)),vu=x("\u5206\u4EAB"),Au=x("\u63D0\u4EA4"),pu=Re({setup(c){const n={CERT:1,NO_CERT:2},f={1:"pdf",4:"picture",2:"richText",3:"link"},b=Ie(),Be=Oe(),{saleUserId:$="D1234567-1",tenantId:m="9991000007",templateId:Ee=1,productCode:fe="CQ75CQ76",insurerCode:_e="ancheng",isShare:V}=b.query;let{orderNo:A}=b.query;typeof A=="object"&&(A=(A||[])[0]);const j=new Ue({source:"localStorage"}),K=w([]),X=w([]),r=w(),R=w(),g=[],Z=Se().format("YYYY-MM-DD"),ee=oe(()=>u=>{let s=1;return u.materialSource===1?u.materialContent.indexOf(".pdf")!==-1?s=1:s=4:s=u.materialSource,f[s]}),Ce=()=>{var u;(u=R.value)==null||u.clear()},De=u=>{g[u].clear()},ue=(u,s)=>{Ge({callbackUrl:window.location.href,certiNo:u,faceAuthMode:"TENCENT",userName:s,tenantId:9991000007}).then(i=>{const{code:t,data:d}=i;if(t==="10000"){const{originalUrl:_,serialNo:e}=d;window.location.href=_,j.set("verifyData",{serialNo:e,certNo:u,name:s})}})},I=u=>`${u}`===Me.CERT,te=u=>{var s,i,t,d;u===-1?ue((s=r.value.tenantOrderHolder)==null?void 0:s.certNo,(i=r.value.tenantOrderHolder)==null?void 0:i.name):ue((t=r.value.tenantOrderInsuredList[u])==null?void 0:t.certNo,(d=r.value.tenantOrderInsuredList[u])==null?void 0:d.name)},Fe=u=>{u&&g.every(s=>s!==u)&&g.push(u)},ve=()=>{var s,i,t,d,_;if((s=R.value)==null?void 0:s.isEmpty()){k.fail("\u8BF7\u6295\u4FDD\u4EBA\u7B7E\u540D");return}if(g.some(e=>e.isEmpty())){k.fail("\u8BF7\u88AB\u4FDD\u4EBA\u7B7E\u540D");return}if(((t=(i=r.value.tenantOrderHolder)==null?void 0:i.extInfo)==null?void 0:t.isCert)!==n.CERT&&I((d=r.value.tenantOrderHolder)==null?void 0:d.certType)){k.fail("\u8BF7\u6295\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}if((_=r.value.tenantOrderInsuredList)==null?void 0:_.some(e=>{var a;return((a=e.extInfo)==null?void 0:a.isCert)!==n.CERT&&I(e.certType)})){k.fail("\u8BF7\u88AB\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}le({orderNo:A,saleUserId:$,tenantId:m}).then(e=>{const{code:a,data:l}=e;a==="10000"&&(l.orderStatus!==Je.PENDING?$e("paymentResult",b.query):Pe.confirm({title:"\u63D0\u793A",message:"\u8BF7\u786E\u8BA4\u4FE1\u606F\u586B\u5199\u65E0\u8BEF\u540E\uFF0C\u518D\u8FDB\u884C\u652F\u4ED8"}).then(()=>{var p,h;const B=(p=R.value)==null?void 0:p.save();Promise.all([ce("HOLDER",B,(h=r.value)==null?void 0:h.id,`${m}`),...g.map(F=>{var T;return ce("INSURED",F.save(),(T=r.value)==null?void 0:T.id,`${m}`)})]).then(()=>{Ve(P(O({},r.value),{pageCode:"sign",operateOption:{withSignInfo:!0},extInfo:P(O({},r.value.extInfo),{pageCode:"sign",templateId:Ee,shareFlag:V?"Y":"N"}),venderCode:_e})).then(F=>{const{code:T,data:L}=F;a==="10000"&&L.success&&Be.push({path:je[L.pageAction.data.nextPageCode],query:{orderNo:A,saleUserId:$,tenantId:m}})})})}))})},q=(u=!1)=>{le({orderNo:A,saleUserId:$,tenantId:m}).then(s=>{var d,_;const{code:i,data:t}=s;i==="10000"&&(r.value=t,u&&(((_=(d=t==null?void 0:t.tenantOrderHolder)==null?void 0:d.extInfo)==null?void 0:_.isCert)===n.NO_CERT||(t==null?void 0:t.tenantOrderInsuredList.some(e=>{var a;return((a=e.extInfo)==null?void 0:a.isCert)===n.NO_CERT}))?k("\u7528\u6237\u672A\u5B8C\u8EAB\u4EFD\u8BA4\u8BC1\u53CA\u7B7E\u5B57"):(!(t==null?void 0:t.tenantOrderAttachmentList.find(e=>e.category===z.ELECTRIC_SIGN&&e.objectType===M.HOLDER))||!(t==null?void 0:t.tenantOrderAttachmentList.find(e=>e.category===z.ELECTRIC_SIGN&&e.objectType===M.INSURED)))&&k("\u7528\u6237\u672A\u5B8C\u8EAB\u4EFD\u8BA4\u8BC1\u53CA\u7B7E\u5B57")),setTimeout(()=>{let e=0;t.tenantOrderAttachmentList.forEach(a=>{a.category===z.ELECTRIC_SIGN&&(a.objectType===M.HOLDER?(R.value.clear(),R.value.setDataURL(a.fileBase64)):a.objectType===M.INSURED&&(g[e].clear(),g[e].setDataURL(a.fileBase64),e+=1))})}))})},Ae=()=>{q(!0)},pe=oe(()=>{const u=P(O({},b.query),{isShare:1,sharePageCode:"sign"});return`${window.location.origin}/phoneVerify?${be.stringify(u)}`}),he=()=>{const u={orderNo:A,productCode:fe,tenantId:m,objectType:1};de(O({},u)).then(({code:s,data:i})=>{s==="10000"&&(X.value=i||[])}),de(P(O({},u),{objectType:2})).then(({code:s,data:i})=>{s==="10000"&&(K.value=i||[])})};return ke(()=>{q(),he();const u=j.get("verifyData");if(u){const{serialNo:s,certNo:i,name:t}=u;Ye({certiNo:i,orderNo:A,serialNo:s,tenantId:m,userName:t}).then(d=>{const{code:_,data:e}=d;_==="10000"&&(j.remove("verifyData"),q())})}}),(u,s)=>{const i=Y("ProPDFviewer"),t=Y("van-button"),d=Y("ProPageWrap");return E(),U(d,null,{default:C(()=>{var _;return[o("div",Qe,[D(He,{type:"warning",title:"\u5C0A\u656C\u7684\u5BA2\u6237\uFF0C\u672C\u6B21\u6295\u4FDD\u9700\u8981\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",content:"\u672C\u4EA7\u54C1\u6295\u4FDD\u9700\u8981\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u8FDB\u884C\u5B9E\u540D\u8BA4\u8BC1\uFF0C\u60A8\u8D2D\u4E70\u672C\u4EA7\u54C1\u7684\u7D2F\u8BA1\u603B\u4FDD\u8D39\u5DF2\u8D85\u8FC720\u4E07\uFF0C\u6309\u76D1\u7BA1\u8981\u6C42\uFF0C\u9700\u8981\u63D0\u4F9B\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u3001\u6307\u5B9A\u53D7\u76CA\u4EBA\u8BC1\u4EF6\u5F71\u50CF\uFF0C\u672C\u4EA7\u54C1\u975E\u672C\u4EBA\u6295\u4FDD\u4E14\u5E26\u8EAB\u6545\u8D23\u4EFB\u3001\u9700\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\uFF08\u6210\u4EBA\uFF09\u7684\u6295\u4FDD\u610F\u613F\u8FDB\u884C\u7B7E\u5B57\u786E\u8BA4\u3002"}),D(H,{title:"\u6295\u4FDD\u4EBA",class:"card"},{extra:C(()=>{var e,a,l,B,p,h,F,T,L,se;return[o("div",ze,[o("div",We,y((a=(e=r.value)==null?void 0:e.tenantOrderHolder)==null?void 0:a.name),1),I((B=(l=r.value)==null?void 0:l.tenantOrderHolder)==null?void 0:B.certType)?(E(),v("div",{key:0,class:re(["status",{verified:((F=(h=(p=r.value)==null?void 0:p.tenantOrderHolder)==null?void 0:h.extInfo)==null?void 0:F.isCert)===n.CERT}])},y(((se=(L=(T=r.value)==null?void 0:T.tenantOrderHolder)==null?void 0:L.extInfo)==null?void 0:se.isCert)===n.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)):S("",!0)])]}),default:C(()=>{var e,a,l,B,p,h,F;return[o("div",Ke,[Xe,o("div",Ze,y((a=(e=r.value)==null?void 0:e.tenantOrderHolder)==null?void 0:a.certNo),1),((p=(B=(l=r.value)==null?void 0:l.tenantOrderHolder)==null?void 0:B.extInfo)==null?void 0:p.isCert)!==n.CERT&&I((F=(h=r.value)==null?void 0:h.tenantOrderHolder)==null?void 0:F.certType)?(E(),v("div",{key:0,class:"action",onClick:s[0]||(s[0]=T=>te(-1))},[eu,D(Q,{name:"right_arrow",class:"icon"})])):S("",!0)])]}),_:1}),D(H,{title:"\u6295\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:C(()=>[o("div",{class:"resign",onClick:Ce},"\u91CD\u7B7E")]),default:C(()=>[D(ie,{ref_key:"holderSign",ref:R,class:"sign"},null,512),o("div",uu,[o("div",tu,"\u7B7E\u540D\u65E5\u671F\uFF1A "+y(N(Z)),1),o("div",su,[au,(E(!0),v(J,null,G(X.value,(e,a)=>(E(),U(i,{key:a,class:"file",title:`\u300A${e.materialName}\u300B`,content:e.materialContent,type:N(ee)(e)},null,8,["title","content","type"]))),128))])])]),_:1}),(E(!0),v(J,null,G((_=r.value)==null?void 0:_.tenantOrderInsuredList,(e,a)=>(E(),v("div",{key:a},[D(H,{title:"\u88AB\u4FDD\u4EBA",class:"card"},{extra:C(()=>{var l,B;return[o("div",nu,[o("div",ou,y(e.name),1),I(e.certType)?(E(),v("div",{key:0,class:re(["status",{verified:((l=e.extInfo)==null?void 0:l.isCert)===n.CERT}])},y(((B=e.extInfo)==null?void 0:B.isCert)===n.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)):S("",!0)])]}),default:C(()=>{var l;return[o("div",ru,[iu,o("div",lu,y(e.certNo),1),((l=e.extInfo)==null?void 0:l.isCert)!==n.CERT&&I(e.certType)?(E(),v("div",{key:0,class:"action",onClick:B=>te(a)},[du,D(Q,{name:"right_arrow",class:"icon"})],8,cu)):S("",!0)])]}),_:2},1024),D(H,{title:"\u88AB\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:C(()=>[o("div",{class:"resign",onClick:l=>De(a)},"\u91CD\u7B7E",8,Bu)]),default:C(()=>[D(ie,{ref_for:!0,ref:Fe,class:"sign"}),o("div",Eu,[o("div",fu,"\u7B7E\u540D\u65E5\u671F\uFF1A "+y(N(Z)),1),o("div",_u,[Cu,(E(!0),v(J,null,G(K.value,(l,B)=>(E(),U(i,{key:B,class:"file",title:`\u300A${l.materialName}\u300B`,content:l.materialContent,type:N(ee)(l)},null,8,["title","content","type"]))),128))])])]),_:2},1024)]))),128)),o("div",Du,[N(V)?S("",!0):(E(),v("div",{key:0,class:"refresh-btn",onClick:Ae},[o("div",null,[D(Q,{name:"refresh"})]),Fu])),N(V)?S("",!0):(E(),U(qe,{key:1,title:"\u9080\u8BF7\u60A8\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",desc:"\u9080\u8BF7\u60A8\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",link:N(pe)},{default:C(()=>[D(t,{plain:"",type:"primary",class:"share-btn"},{default:C(()=>[vu]),_:1})]),_:1},8,["link"])),D(t,{type:"primary",class:"submit-btn",onClick:ve},{default:C(()=>[Au]),_:1})])])]}),_:1})}}});var Iu=we(pu,[["__scopeId","data-v-41c5ea06"]]);export{Iu as default};
