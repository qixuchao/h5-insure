import{h as je,aa as ze,P as Je,r as c,N as Ge,A as T,$ as re,l as Xe,j as Qe,k as w,m as H,s as Ze,t as D,p as k,B as ne,L as et,C as R,n as ue,x as se,F as tt,G as at,D as ie,T as v,Y as ot}from"./vendor-f85e77c6.js";import{_ as rt,g as le,o as ce,r as nt,v as de,t as me,a as ut,b as L}from"./utils-4792ffe8.js";import{p as b,i as st,g as it,s as lt,u as ct,a as dt}from"./trial-1ad9e8dc.js";import{_ as mt,C as pe,I as pt,n as ft,J as fe,a4 as Fe}from"./index-4ac31bd7.js";import{u as Ft}from"./theme-e4a7893d.js";import{a as U}from"./order-955e3b11.js";import{S as V,R as E,g as yt,I as vt}from"./infoCollection-9ebcca76.js";import{_ as Et,a as Ct}from"./index-7f1a97c8.js";import"./relativeTime-664f9963.js";import"./useDicData-081bc0cf.js";import"./trial-0fc310fa.js";const ht={class:"product-name"},gt={class:"footer-button"},Bt=at("\u5206\u4EAB\u7528\u6237\u786E\u8BA4\u6295\u4FDD"),Dt=je({setup(It){const ye=Ft(),ve=ze(),M=Je(),{productCode:Ee="HTEJBX",tenantId:d="0",orderNo:x,phoneNo:Ce,agentCode:I="",saleChannelId:q,paymentMethod:he,certNo:Y,name:$,pageCode:ge,from:Be}=M.query,N=c(),O=c(),A=c({agencyId:I,commencementTime:"",expiryDate:"",extInfo:{buttonCode:"EVENT_NETSALE_underWrite",pageCode:"infoCollection",templateId:3,iseeBizNo:""},orderCategory:1,saleUserId:q,tenantId:d,venderCode:"",tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},insuredBeneficiaryType:"1",tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}],tenantOrderProductList:[{}]}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}}),m=c(),F=c(),K=c({}),C=c({}),W=ge==="payBack",P=c(!1),_=c(!1),h=c(!1),j=c(0),z=c(!1),De=c(!1),J=c({show:!1,html:""});let S="";const a=Ge({holder:{certNo:Y,certType:pe.CERT,mobile:Ce,name:$,socialFlag:V.HAS},insured:{certNo:Y,certType:pe.CERT,name:$,socialFlag:V.HAS,relationToHolder:E.SELF},paymentMethod:he,renewalDK:"Y",paymentFrequency:yt.YEAR,packageProductList:[],mobileSmsCode:""}),G=T(()=>{var t,e;return!!((e=(t=m.value)==null?void 0:t.productRelationPlanVOList)!=null&&e.length)}),Ie=T(()=>{var e,o,r;let t=[];return G.value?t=((o=(e=m.value)==null?void 0:e.productRelationPlanVOList.find(n=>n.planCode===O.value))==null?void 0:o.productRiskVoList)||[]:t=((r=m.value)==null?void 0:r.productRiskVoList)||[],t[0]}),Ne=async(t,e,o)=>{var n;const r={holder:{personVO:t.tenantOrderHolder},insuredVOList:t.tenantOrderInsuredList.map(u=>({insuredCode:"",personVO:u,productPlanVOList:[{insurerCode:e.productBasicInfoVO.insurerCode,planCode:O.value||0,riskVOList:nt(o)}]}))};await b(r),A.value.tenantOrderInsuredList[0].tenantOrderProductList[0]=(n=r.insuredVOList[0])==null?void 0:n.productPlanVOList},Oe=(t={},e={},o={})=>{var u;const r={...o},n={tenantId:d,riskList:((u=r.tenantOrderInsuredList[0])==null?void 0:u.tenantOrderProductList[0].riskVOList)||[],riskPremium:e,productId:t==null?void 0:t.productBasicInfoVO.id};return r.tenantOrderInsuredList[0].tenantOrderProductList[0]={premium:"",productCode:t.productBasicInfoVO.productCode,productName:t.productBasicInfoVO.productName,tenantOrderRiskList:me(n)},r},Ae=async()=>{const{code:t,data:e}=await ft(Oe(m.value,{},A.value));t==="10000"&&console.log("123123",e)},Pe=async()=>{Ne(A.value,m.value,Ie.value.riskDetailVOList),ie.confirm({title:"\u5206\u4EAB",message:`\u5373\u5C06\u5411\u5BA2\u6237\u3010${A.value.tenantOrderHolder.name}\u3011\u53D1\u9001\u6295\u4FDD\u786E\u8BA4\u4FE1\u606F,\u8BF7\u786E\u8BA4\u662F\u5426\u7EE7\u7EED\uFF1F`}).then(()=>{Ae()})},_e=T(()=>{var t,e;return((e=(t=C.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:e.attachmentVOList.filter(o=>o.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),we=T(()=>{var t,e;return((e=(t=C.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:e.attachmentVOList.filter(o=>o.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),Le=()=>{if(a.holder.certNo){const t=L(a.holder.certNo,"year"),e=fe(a.holder.certNo);if(t<18)return v("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E18\u5C81\uFF01"),!1;if(a.insured.certNo&&a.insured.relationToHolder===E.MATE){const o=fe(a.insured.certNo);if(e===o)return v("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(a.insured.certNo){const t=L(a.insured.certNo,"day"),e=L(a.insured.certNo,"year");if(a.insured.relationToHolder===E.CHILD&&t<30)return v("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(a.insured.relationToHolder===E.PARENT&&e>=71)return v("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E70\u5C81\uFF01"),!1}if([E.CHILD,E.PARENT].includes(a.insured.relationToHolder)){const t=L(a.holder.certNo,"year"),e=L(a.insured.certNo,"year");if(a.insured.relationToHolder===E.CHILD&&t-e<18)return v("\u6295\u4FDD\u4EBA\u548C\u5B50\u5973\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1;if(a.insured.relationToHolder===E.PARENT&&e-t<18)return v("\u6295\u4FDD\u4EBA\u548C\u7236\u6BCD\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1}return!0},Te=()=>{const{holder:{certNo:t,mobile:e,name:o,socialFlag:r},insured:{certNo:n,name:u,socialFlag:l,relationToHolder:s},paymentMethod:p}=a;return!!(pt(n)&&!!l)},ke=()=>{ve.push({path:"/internet/guaranteeUpgrade",query:{...M.query,tenantId:d,productCode:"BWYL2022",orderNo:x,agentCode:I}})},Re=async t=>{v.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const e=await ct(t),{code:o}=e;if(o==="10000"){v.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const r=await dt({orderNo:t.orderNo,tenantId:d}),{data:n}=r;r.code==="10000"&&(n.type===2?(J.value={show:!0,html:n.paymentUrl},console.log("data.paymentUrl",J.value),ot(()=>{console.log("document.forms",document.forms);const u=document.getElementById("cashierSubmit");u==null||u.addEventListener("submit",l=>{l.preventDefault()}),u==null||u.submit()})):window.location.href=n.paymentUrl)}}catch(e){console.log(e)}},Ve=t=>`${Fe}/pay?orderNo=${t}&saleUserId=${I}&tenantId=${d}`,xe=t=>`${Fe}/internet/payFail?tenantId=${d}&orderNo=${t}&agentCode=${I}&pageCode=payBack&from=${Be||"normal"}`,Se=async t=>{console.log("risk",t);const e=ut({tenantId:d,saleUserId:I,saleChannelId:q,detail:C.value,insureDetail:m.value,paymentMethod:a.paymentMethod,paymentFrequency:a.paymentFrequency,renewalDK:a.renewalDK,iseeBizNo:S,successJumpUrl:"",premium:F.value,holder:a.holder,insured:a.insured,tenantOrderRiskList:t,orderStatus:"",orderTopStatus:""});try{const o=await lt(e),{code:r,data:n}=o;r==="10000"&&Re({...e,orderNo:n.data,extInfo:{extraInfo:{renewalDK:a.renewalDK,paymentMethod:a.paymentMethod,paymentFrequency:a.paymentFrequency,successJumpUrl:Ve(n.data),failUrl:xe(n.data)},iseeBizNo:S}})}catch(o){console.log(o)}},He=async()=>{const{calcData:t,riskVOList:e}=le({holder:a.holder,insured:a.insured,tenantId:d,productDetail:C.value,insureDetail:m.value,paymentFrequency:a.paymentFrequency,packageRiskIdList:ce(a.packageProductList)},!1,de);if(!Array.isArray(e)||e.length<1)return F.value=null,{};const o=await b(t),{code:r,data:n}=o;return r==="10000"?(F.value=n.premium,{condition:e,data:n}):(F.value=null,{})},be=t=>{j.value=t,h.value=!0},Ue=()=>new Promise((t,e)=>{var o,r;(r=(o=N.value)==null?void 0:o.validateForm)==null||r.call(o).then(async()=>{var g;if(!Le())return;if(!(((g=N.value)==null?void 0:g.isAgreeFile)||P.value)){P.value=!1,h.value=!0,be(0);return}const{calcData:u,riskVOList:l}=le({holder:a.holder,insured:a.insured,tenantId:d,productDetail:C.value,insureDetail:m.value,paymentFrequency:a.paymentFrequency,packageRiskIdList:ce(a.packageProductList)},!1,de);(!Array.isArray(l)||l.length<1)&&(F.value=null,e(new Error));const s=await b(u),{code:p,data:f}=s;p==="10000"?(F.value=f.premium,t({condition:l,data:f})):(F.value=null,e(new Error))}).catch(()=>{})}),Me=async()=>{var t;if(W){ke();return}try{const{condition:e,data:o}=await Ue(),r={},n=(l=[])=>{(l||[]).forEach(s=>{var p;r[s.riskCode]=s,(p=s.riskPremiumDetailVOList)!=null&&p.length&&n(s.riskPremiumDetailVOList)})};n(o.riskPremiumDetailVOList);const u=me({tenantId:d,riskList:e,riskPremium:r,productId:(t=C.value)==null?void 0:t.id});Se(u)}catch(e){console.log(e)}},qe=t=>{t==="allFalse"?(_.value=!1,P.value=!0,Me()):ie.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"}).then(()=>{window.history.back()}).catch(()=>{var e;(e=N.value)==null||e.reEditForm(),P.value=!1})},X=()=>{var t;(t=N.value)==null||t.reEditForm(),P.value=!1},Ye=()=>{console.log("onCloseHealthPopup========"),_.value=!1,X()},$e=()=>{console.log("onCloseFilePreview========"),h.value=!1,X()},Ke=()=>{h.value=!1,_.value=!0};re(()=>C.value,()=>{console.log("123123")},{deep:!0}),re([()=>a.insured.certNo,()=>a.insured.socialFlag,()=>a.packageProductList,()=>a.paymentFrequency],Xe.exports.debounce(()=>{a.insured.certNo&&a.insured.socialFlag&&Te()&&He()},500),{deep:!0,immediate:!0});const Q=async()=>{var r,n,u,l,s,p,f,g,Z,ee,te,ae,oe;const t=await it({orderNo:x,tenantId:d}),{code:e,data:o}=t;if(e==="10000"){const{tenantOrderHolder:y,tenantOrderInsuredList:i,extInfo:B}=o;if(!W){Object.assign(a,{holder:{certNo:y.certNo,certType:y.certType,mobile:y.mobile,name:y.name,socialFlag:V.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(r=i[0])==null?void 0:r.certType,name:(n=i[0])==null?void 0:n.name,socialFlag:(l=(u=i[0])==null?void 0:u.extInfo)==null?void 0:l.hasSocialInsurance,relationToHolder:(s=i[0])==null?void 0:s.relationToHolder},paymentMethod:B.extraInfo.paymentMethod,paymentFrequency:B.extraInfo.paymentFrequency,renewalDK:B.extraInfo.renewalDK||"N"});return}Object.assign(a,{holder:{certNo:y.certNo,certType:y.certType,mobile:y.mobile,name:y.name,socialFlag:V.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(p=i[0])==null?void 0:p.certType,name:(f=i[0])==null?void 0:f.name,socialFlag:(Z=(g=i[0])==null?void 0:g.extInfo)==null?void 0:Z.hasSocialInsurance,relationToHolder:(ee=i[0])==null?void 0:ee.relationToHolder},paymentMethod:B.extraInfo.paymentMethod,paymentFrequency:B.extraInfo.paymentFrequency,renewalDK:B.extraInfo.renewalDK||"N"}),F.value=(oe=(ae=(te=i[0])==null?void 0:te.tenantOrderProductList)==null?void 0:ae[0])==null?void 0:oe.premium,(o.orderStatus===U.ACCEPT_POLICY||o.orderStatus===U.PAYMENT_SUCCESS)&&(z.value=!1,De.value=!0),o.orderStatus===U.PAYING&&(z.value=!0,setTimeout(()=>{Q()},3*1e3))}},We=async()=>{var o,r;const{code:t,data:e}=await st({productCode:Ee});t==="10000"&&(a.packageProductList=(((o=e.data)==null?void 0:o.packageProductVOList)||[]).map(n=>({...n,value:vt.UN_INSURE,disabled:!1})),m.value=e,K.value=e.productFactor,(r=e==null?void 0:e.productRelationPlanVOList)!=null&&r.length&&(O.value=e.productRelationPlanVOList[0].planCode)),x&&Q()};return Qe(()=>{We(),setTimeout(async()=>{S=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(t,e)=>{const o=w("ProRadioButton"),r=w("ProCard"),n=w("van-button"),u=w("ProPageWrap"),l=w("van-config-provider");return H(),Ze(tt,null,[D(l,{"theme-vars":R(ye)},{default:k(()=>[D(u,{class:"net-sale-wrap"},{default:k(()=>{var s,p;return[ne("div",ht,et((p=(s=m.value)==null?void 0:s.productBasicInfoVO)==null?void 0:p.productFullName),1),R(G)?(H(),ue(r,{key:0,title:"\u4FDD\u969C\u5E74\u671F"},{default:k(()=>{var f;return[D(o,{modelValue:O.value,"onUpdate:modelValue":e[0]||(e[0]=g=>O.value=g),class:"radio-group",prop:{label:"planName",value:"planCode"},options:(f=m.value)==null?void 0:f.productRelationPlanVOList},null,8,["modelValue","options"])]}),_:1})):se("",!0),D(rt,{ref_key:"formRef",ref:N,"title-collection":{HOLDER:"\u672C\u4EBA\u4FE1\u606F\uFF08\u6295\u4FDD\u4EBA\uFF09",INSURER:"\u4E3A\u8C01\u6295\u4FDD\uFF08\u88AB\u4FDD\u4EBA\uFF09",BENEFICIARY:"\u6536\u76CA\u4EBA"},"form-info":A.value,"send-sms-code":()=>{},"factor-object":K.value},null,8,["form-info","send-sms-code","factor-object"]),ne("div",gt,[D(n,{type:"primary",block:"",onClick:Pe},{default:k(()=>[Bt]),_:1})])]}),_:1})]),_:1},8,["theme-vars"]),D(Et,{show:_.value,"onUpdate:show":e[1]||(e[1]=s=>_.value=s),"content-list":R(_e),"active-index":0,onOnConfirmHealth:qe,onOnCloseHealth:Ye},null,8,["show","content-list"]),h.value?(H(),ue(Ct,{key:0,show:h.value,"onUpdate:show":e[2]||(e[2]=s=>h.value=s),"content-list":R(we),"active-index":j.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9","force-read-cound":2,"on-close-file-preview":"",onSubmit:Ke,onOnCloseFilePreview:$e},null,8,["show","content-list","active-index"])):se("",!0)],64)}}});var xt=mt(Dt,[["__scopeId","data-v-09c9a74a"]]);export{xt as default};
