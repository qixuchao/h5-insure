import{G as e,d as o,r as t,c as r,e as s,w as a,f as d,i as l,j as i,B as u,z as c,bI as n,R as p,A as m,g as v,a2 as f,U as k,V as C,bv as h,E as P,bJ as b,aC as L,bK as y,bL as V,bB as I,al as R,am as _,ab as j,L as O,bM as g,h as D,bN as w,b7 as x,a as T,u as N,o as U,aA as E,bq as q,b as S,bO as B,D as $,aB as A,$ as F,bi as H,aw as K,T as M}from"./index-88fa1e29.js";import{A as W}from"./index-c91cc5c5.js";import{P as z,a as G,b as J,c as Y}from"./index-6f6e62be.js";import{d as Q}from"./debounce-eed12388.js";import{u as X}from"./createProposal-11c089f7.js";import{_ as Z}from"./ProRenderFormWithCard.vue_vue_type_style_index_0_scoped_true_lang-1b67b5e5.js";/* empty css              */import"./bankCard-6b31a808.js";import{q as ee,a as oe}from"./createProposal-e457999d.js";import{a as te,p as re}from"./trial-0be2b4e1.js";import{T as se}from"./index-69bee476.js";import{u as ae}from"./useDicData-809c769d.js";import"./pdfh5-008ca364.js";import"./index-7adc225a.js";import"./isObjectLike-a9798079.js";import"./_initCloneObject-0663309f.js";import"./phoneVerify-d812f376.js";import"./index-11b4eaf4.js";import"./cloneDeep-1de8e9b0.js";import"./infoCollection-0d371949.js";import"./index-7dc8b06e.js";import"./utils-331621a4.js";import"./index-c62a79fb.js";import"./trial-c2aa666c.js";import"./utils-4fe23903.js";import"./index-22c4392a.js";import"./empty-c926d8ec.js";import"./box-title-9cc8096b.js";import"./index-ca2f6e83.js";import"./echarts-ac920fed.js";import"./Table-d976d812.js";import"./useOrder-276d34a2.js";import"./utils-cafa38d9.js";import"./constants-7afb7c3d.js";import"./nextStep-63293a50.js";import"./core-88dcd045.js";import"./constant-8927d485.js";const de={class:"trial-button"};var le=e(o({__name:"TrialPopup",props:{productCode:{default:""},productName:{default:""}},emits:["finish"],setup(e,{expose:o,emit:c}){const n=e,p=t(null),m=(e,o)=>{var t;console.log("trialData",e);const{holder:r,insuredVOList:s,productCode:a}=e||{},{personVO:d,productPlanVOList:l}=(null==s?void 0:s[0])||{},i=((null==(t=null==l?void 0:l[0])?void 0:t.riskVOList)||[]).map((e=>{var t,r;return{...e,premium:null==(t=o[e.riskCode])?void 0:t.premium,amount:null==(r=o[e.riskCode])?void 0:r.amount}}));return{productCode:a,proposalHolder:null==r?void 0:r.personVO,insuredPersonVO:d,insuredProductInfo:{productCode:a,productName:n.productName,occupationCodeList:d.occupationCodeList,proposalProductRiskList:i}}};return o({...["open","close"].reduce(((e,o)=>(e[o]=(...e)=>{var t;null==(t=p.value)||t[o](...e)},e)),{}),formatData:m}),(o,t)=>{const n=u;return r(),s(se,{ref_key:"trialRef",ref:p,"hide-benefit":"","hide-popup-button":"",title:"选择保障方案",class:"proposal-trial","product-info":{productCode:e.productCode},"tenant-product-detail":{}},{default:a((({trialData:e,riskPremium:o})=>[d("div",de,[l(n,{type:"primary",onClick:t=>((...e)=>{c("finish",m(e[0],e[1]))})(e,o)},{default:a((()=>[i("确定")])),_:2},1032,["onClick"])])])),_:1},8,["product-info"])}}}),[["__scopeId","data-v-0e8aad9c"]]);const ie={class:"com-risk-list-wrapper"},ue=(e=>(R("data-v-7d3c3028"),e=e(),_(),e))((()=>d("div",{class:"popup-title"},"选择附加险",-1))),ce={class:"risk-list"},ne={class:"cell-title"},pe={class:"title"},me={class:"footer-button"};var ve=e(o({__name:"index",props:{riskList:{default:()=>[]},show:{type:Boolean,default:!1},collocationList:{default:()=>[]},disabled:{default:()=>[]},modelValue:{default:()=>[]}},emits:["finished","close","update:modelValue"],setup(e,{emit:o}){const R=e,_=t([]),j=t([]),O=t([...R.disabled]),g=c({show:R.show,currentChecked:[...R.modelValue]}),D=e=>{var o,t,r;if(O.value.includes(e))return;((e,o)=>{if(!R.collocationList.length)return o?void(g.currentChecked=[]):void g.currentChecked.push(e);let t=g.currentChecked,r=O.value;o?(R.collocationList.forEach((o=>{e===o.riskId&&(2===o.collocationType?t=t.filter((t=>t!==o.collocationRiskId||t!==e)):3===o.collocationType?(t=t.filter((o=>o!==e)),r=r.filter((e=>e!==o.collocationRiskId))):t=t.filter((o=>o!==e)))})),g.currentChecked=t,O.value=r):(R.collocationList.forEach((s=>{e===s.riskId&&(o||(2===s.collocationType?t.push(s.collocationRiskId):3===s.collocationType&&r.push(s.collocationRiskId),t.push(e)))})),g.currentChecked.push(...t),O.value=r)})(e,g.currentChecked.includes(e)),null==(r=null==(t=null==(o=null==_?void 0:_.value)?void 0:o[e])?void 0:t.toggle)||r.call(t)},w=()=>{o("close")},x=()=>{const e=R.riskList.filter((e=>g.currentChecked.includes(e.id)));o("update:modelValue",[...new Set(j.value)]),o("finished",e,O.value),o("close")};return n((()=>{_.value=[]})),p((()=>g.currentChecked),(e=>{j.value=e}),{deep:!0,immediate:!0}),p((()=>R.modelValue),(e=>{j.value=e||[],O.value.push(...e||[])}),{deep:!0,immediate:!0}),(o,t)=>{const c=b,n=L,p=y,R=V,T=u,N=I;return r(),m("div",ie,[l(N,{show:v(g).show,"onUpdate:show":t[1]||(t[1]=e=>v(g).show=e),title:"选择附加险","show-footer":"",round:"",position:"bottom",closeable:"",onClose:w},{default:a((()=>[ue,d("div",ce,[l(R,{modelValue:v(j),"onUpdate:modelValue":t[0]||(t[0]=e=>f(j)?j.value=e:null)},{default:a((()=>[l(p,{inset:""},{default:a((()=>[(r(!0),m(k,null,C(e.riskList,(e=>(r(),s(n,{key:e.id,title:e.riskName,disabled:v(O).includes(e.id),onClick:o=>D(e.id)},{"right-icon":a((()=>[l(c,{ref_for:!0,ref:o=>v(_)[e.id]=o,shape:"square",disabled:v(O).includes(e.id),name:e.id,onClick:h((o=>D(e.id)),["stop"])},null,8,["disabled","name","onClick"])])),title:a((()=>[d("div",ne,[d("div",pe,P(e.riskName),1)])])),_:2},1032,["title","disabled","onClick"])))),128))])),_:1})])),_:1},8,["modelValue"])]),d("div",me,[l(T,{type:"primary",disabled:!v(g).currentChecked.length,block:"",onClick:x},{default:a((()=>[i("确认")])),_:1},8,["disabled"])])])),_:1},8,["show"])])}}}),[["__scopeId","data-v-7d3c3028"]]);const fe=e=>(R("data-v-fcbc5962"),e=e(),_(),e),ke={class:"com-product-list-wrapper"},Ce={class:"risk-item-wrapper"},he={class:"content"},Pe={class:"risk-premium"},be={class:"premium"},Le={class:"risk-factor"},ye={class:"factor"},Ve={class:"factor-value"},Ie=fe((()=>d("span",{class:"factor-name"}," 保额(元) ",-1))),Re={class:"factor"},_e={class:"factor-value"},je=fe((()=>d("span",{class:"factor-name"}," 保障期间 ",-1))),Oe={class:"factor"},ge={class:"factor-value"},De=fe((()=>d("span",{class:"factor-name"}," 缴费期间 ",-1))),we={class:"operate-bar"},xe=fe((()=>d("span",{class:"btn-plus"},"+",-1))),Te={key:0,class:"premium-total"},Ne={class:"premium"},Ue=o({name:"ProductList"});var Ee=e(o({...Ue,props:{productRiskList:{default:()=>[]},productInfo:{default:()=>({})},productData:{default:()=>({})},pickProductPremium:{type:Function,default:()=>{}},productNum:{default:0}},emits:["deleteRisk","updateRisk","addRiderRisk"],setup(e,{emit:o}){const u=e,[c,n]=j(),f=t({checkedList:[],disabledList:[],riderRiskList:[],mainRiskData:{},totalPremium:0,currentRiskRecord:{},productRiskList:[]}),h=ae("RISK_PAYMENT_PERIOD"),b=ae("RISK_INSURANCE_PERIOD"),L=O((()=>{var e,o;return(null==(o=null==(e=u.productData)?void 0:e.productRiskVoList)?void 0:o[0].riskDetailVOList.filter((e=>1===e.collocationType)))||[]})),y=O((()=>{var e,o;const t=u.productRiskList.map((e=>e.riskId)),r=((null==(o=null==(e=u.productData)?void 0:e.productRiskVoList)?void 0:o[0].riskDetailVOList)||[]).filter((e=>t.includes(e.id)&&1===e.collocationType));return L.value.length-r.length})),V=O((()=>e=>{var o,t;const r=(null==(t=null==(o=u.productData)?void 0:o.productRiskVoList)?void 0:t[0].riskDetailVOList.find((o=>o.id!==e)))||{};let s=!1;return s=!!u.productNum||2===r.riskType&&1===r.collocationType,s})),I=O((()=>{var e,o;return(null==(o=null==(e=u.productData)?void 0:e.productRiskVoList)?void 0:o[0].riskDetailVOList.find((e=>1===e.riskType)))||{}})),R=O((()=>I.value.collocationVOList||[])),_=(e,t)=>{const r=e.map((e=>e.id)).filter((e=>!f.value.disabledList.includes(e)));o("addRiderRisk",r,u.productInfo)};return p((()=>u.productInfo),(e=>{var o;console.log(12111111);let t=0;(e.proposalProductRiskList||[]).forEach((e=>{t+=e.premium})),null==(o=u.pickProductPremium)||o.call(u,{[`${e.productCode}`]:t}),f.value.totalPremium=t}),{deep:!0,immediate:!0}),p((()=>u.productRiskList),(e=>{const o=[],t=[],r=[];(e||[]).forEach((e=>{1===e.riskType?o.unshift(e):(t.push(e.riskId),r.push(e.riskId),o.push(e))})),f.value.disabledList=t,f.value.checkedList=r,f.value.productRiskList=o}),{deep:!0,immediate:!0}),(e,t)=>{var p,I;const j=w,O=x;return r(),m("div",ke,[(r(!0),m(k,null,C(v(f).productRiskList,(e=>{var t,c;return r(),m("div",{key:e.riskId},[d("div",Ce,[l(j,{"risk-type":e.riskType,title:e.riskName,class:"no-border"},null,8,["risk-type","title"]),d("div",he,[d("div",Pe,[i(" 保费:"),d("span",be,"￥"+P(null==(t=e.premium)?void 0:t.toLocaleString()),1)]),d("div",Le,[d("div",ye,[d("span",Ve,P(null==(c=e.amount)?void 0:c.toLocaleString()),1),Ie]),d("div",Re,[d("span",_e,P(v(g)(v(b),e.coveragePeriod)),1),je]),d("div",Oe,[d("span",ge,P(v(g)(v(h),e.chargePeriod)),1),De])]),d("div",we,[v(V)(e.riskId)?(r(),s(O,{key:0,round:32,class:"border",onClick:t=>{o("deleteRisk",e,u.productInfo)}},{default:a((()=>[i("删除")])),_:2},1032,["onClick"])):D("",!0),v(y)?(r(),s(O,{key:1,activated:"",round:32,class:"btn-rider-risk",onClick:o=>{return t=e,n(!0),void(f.value.currentRiskRecord=t);var t}},{default:a((()=>[xe,i(" 附加险")])),_:2},1032,["onClick"])):D("",!0),l(O,{activated:"",round:32,onClick:t=>{o("updateRisk",e,u.productInfo)}},{default:a((()=>[i("修改")])),_:2},1032,["onClick"])])])])])})),128)),v(f).productRiskList.length>1?(r(),m("div",Te,[i(" 保费: "),d("span",Ne,"￥"+P(null==(I=null==(p=v(f))?void 0:p.totalPremium)?void 0:I.toLocaleString()),1)])):D("",!0),v(c)?(r(),s(ve,{key:1,modelValue:v(f).checkedList,"onUpdate:modelValue":t[0]||(t[0]=e=>v(f).checkedList=e),show:v(c),disabled:v(f).disabledList,"risk-list":v(L),"collocation-list":v(R),onFinished:_,onClose:t[1]||(t[1]=e=>v(n)(!1))},null,8,["modelValue","show","disabled","risk-list","collocation-list"])):D("",!0)])}}}),[["__scopeId","data-v-fcbc5962"]]);const qe={class:"container"},Se={class:"operate-bar"},Be={class:"footer-bar"},$e={class:"trial-result"},Ae={class:"result-num"},Fe={class:"trial-operate"},He=o({name:"CreateProposal"});var Ke=e(o({...He,setup(e){const o=[{name:"保存修改"},{name:"另存为新计划书"}],[n,h]=j(),[b,L]=j(),y=t({proposalHolder:{},proposalInsuredList:[{name:"",gender:"",birthday:"",proposalInsuredProductList:[]}],proposalName:"",totalPremium:0,relationUserType:2}),V=T(),I=N(),R=X(),{id:_,productCode:g,type:D="add",isCreateProposal:w}=I.query,se=t(null),ae=t({productCode:0,productCollection:{},productInfo:{},productPremium:{},riderRisk:{},type:"add",currentRisk:[]}),de=c({selectedProductCodeList:[],insuredPersonVO:{},proposalName:"",currentProductCode:"",proposalHolder:{},proposalInsuredProductList:[],productCollection:{}}),ie=t(null),ue=t(null),ce=O((()=>de.proposalInsuredProductList.map((e=>e.productCode)).filter((e=>Boolean(e))))),ne=()=>{var e,o;Promise.all([null==(e=ie.value)?void 0:e.validate(),null==(o=ue.value)?void 0:o.validate()]).then((()=>{const{proposalHolder:e}=de;oe({proposalHolder:e,proposalInsuredList:[{...de.insuredPersonVO,proposalInsuredProductList:de.proposalInsuredProductList}],proposalName:de.proposalName,totalPremium:0,relationUserType:2}).then((e=>{const{code:o,data:t}=e||{};"10000"===o&&(R.$reset(),R.proposalId=t,V.push({path:"/compositionProposal",query:{id:t}}))}))}))},pe=()=>{ne()},me=(e,o)=>{o&&(y.value.id=null),ne()},ve=O((()=>{var e;return(null==(e=de.productCollection)?void 0:e[de.currentProductCode])||{}})),fe=O((()=>{var e,o;return(null==(o=null==(e=ve.value)?void 0:e.productPlanInsureVOList)?void 0:o[0])||{}})),ke=(e={})=>{Object.assign(ae.value.productPremium,e),y.value.totalPremium=Object.values(ae.value.productPremium).reduce(((e,o)=>e+o),0)},Ce=(e,o)=>{const t=o;$.confirm({message:"确认删除该险种？"}).then((()=>{1===e.riskType?(de.proposalInsuredProductList=de.proposalInsuredProductList.filter((e=>e.productCode!==t.productCode)).map((e=>({...e,nanoid:A()}))),ke({[t.productCode]:0})):t.proposalProductRiskList=t.proposalProductRiskList.filter((o=>o.riskId!==e.riskId))}))},he=(e,o)=>{ae.value.productCode=o.productCode,ae.value.productInfo=o,ae.value.type="edit",ae.value.currentRisk=[e.riskId],de.currentProductCode=o.productCode,F((()=>{var e;null==(e=se.value)||e.open()}))},Pe=(e,o)=>{ae.value.productCode=o.productCode,ae.value.productInfo=o,ae.value.type="addRiderRisk",ae.value.currentRisk=e,h(!0)},be=e=>{var o;const t=de.proposalInsuredProductList.findIndex((o=>o.productCode===e.productCode)),r={...e.insuredProductInfo,nanoid:A()};t>-1?de.proposalInsuredProductList[t]=r:de.proposalInsuredProductList.push(r),null==(o=se.value)||o.close()},Le=()=>{R.setProposalInfo(y.value),R.setTrialData([]),ae.value.productCollection.length&&R.setExcludeProduct(ae.value.productCollection.map((e=>e.productCode)));const{gender:e,birthday:o}=de.insuredPersonVO;V.push({path:"/proposalList",query:{isCreateProposal:"1",productCode:g,productCodeList:ce.value,gender:e,birthday:o}})},ye=e=>{ee(e).then((({code:e,data:o})=>{"10000"===e&&E(o)&&Object.assign(de.productCollection,o.reduce(((e,o)=>(e[o.productCode]=o,e)),{}))})).finally((()=>{}))},Ve=async(e,o=!1)=>{if(!E(e))return;const{code:t,data:r}=await te({calcProductFactorList:e,...de.insuredPersonVO});"10000"===t&&r&&E(r)&&r.forEach((e=>{const{holder:t,insuredVOList:r,productCode:s}=e,{personVO:a,productPlanVOList:d}=(r||[])[0]||{},[{riskVOList:l}={}]=d||[],i={productCode:s,proposalProductRiskList:l};var u;if(re(u=e).then((({code:e,data:o})=>{var t;if(e===K&&o){(null==o?void 0:o.errorInfo)&&M(`${null==o?void 0:o.errorInfo}`);const e={};E(o.riskPremiumDetailVOList)&&(o.riskPremiumDetailVOList.forEach((o=>{e[o.riskCode]={premium:o.premium,amount:o.amount}})),be(null==(t=se.value)?void 0:t.formatData(u,e)))}})),o)Object.assign(de.insuredPersonVO,a),Object.assign(de.proposalHolder,t),de.proposalInsuredProductList=[i];else{const e=ce.value.findIndex((e=>e===s));de.proposalInsuredProductList[e]=i}}))};U((()=>{g&&(ye([{productCode:g}]),Ve([{productCode:g}],!0))}));const Ie=e=>!!E(e)&&e.every((e=>Boolean(e)));return p((()=>["gender","birthday"].map((e=>de.insuredPersonVO[e]))),((e,o)=>{if(console.log(66666666,e,e.every((e=>Boolean(e)))),Ie(e)&&Ie(o)&&e.join(",")!==o.join(",")){console.log("被保人条件变动");const e=[g,...de.selectedProductCodeList].map((e=>({productCode:e})));ye(e),Ve(e,!0)}}),{deep:!0}),p((()=>de.selectedProductCodeList),Q((e=>{if(E(e)){console.log("选择的产品变动了",e);const o=e.map((e=>({productCode:e,proposalProductRiskList:[]})));de.proposalInsuredProductList.push(...o),Ve(e.map((e=>({productCode:e}))))}})),{deep:!0}),p((()=>de.selectedProductCodeList),(e=>{if(E(e)){const o=Object.keys(de.productCollection),t=null==e?void 0:e.filter((e=>!o.includes(e)));E(t)&&ye(null==t?void 0:t.map((e=>({productCode:e}))))}}),{deep:!0,immediate:!0}),q((()=>{const{query:{selectProduct:e}}=N();de.selectedProductCodeList=E(e)?e:"string"==typeof e&&e?[e]:[]})),(e,t)=>{const c=Y,n=H,p=x,h=u,V=W,I=S("ProPageWrap");return r(),s(I,{class:"page-create-wrapper"},{default:a((()=>{var e,u;return[d("div",qe,[l(c,{ref_key:"formRef",ref:ie,class:"mb20",model:v(de)},{default:a((()=>[l(v(Z),{modelValue:v(de).proposalName,"onUpdate:modelValue":t[0]||(t[0]=e=>v(de).proposalName=e),label:"计划书名称",name:"proposalName",maxlength:20,required:""},null,8,["modelValue"])])),_:1},8,["model"]),l(v(z),{ref_key:"insuredFormRef",ref:ue,title:"被保人信息",model:v(de).insuredPersonVO},{default:a((()=>[l(v(Z),{modelValue:v(de).insuredPersonVO.name,"onUpdate:modelValue":t[1]||(t[1]=e=>v(de).insuredPersonVO.name=e),label:"姓名",name:"name",maxlength:20,required:""},null,8,["modelValue"]),l(v(G),{modelValue:v(de).insuredPersonVO.birthday,"onUpdate:modelValue":t[2]||(t[2]=e=>v(de).insuredPersonVO.birthday=e),label:"出生日期",name:"birthday",required:""},null,8,["modelValue"]),l(v(J),{modelValue:v(de).insuredPersonVO.gender,"onUpdate:modelValue":t[3]||(t[3]=e=>v(de).insuredPersonVO.gender=e),label:"性别",name:"gender",columns:v(B),required:""},null,8,["modelValue","columns"])])),_:1},8,["model"]),(r(!0),m(k,null,C(v(de).proposalInsuredProductList,((e,o)=>(r(),s(n,{key:`${e.nanoid}_${o}_${e.productCode}`,"show-line":!1},{default:a((()=>{var o;return[l(Ee,{"product-risk-list":e.proposalProductRiskList,"product-info":e,"product-num":(null==(o=v(de).proposalInsuredProductList)?void 0:o.length)-1,"product-data":v(ae).productCollection[e.productCode],"pick-product-premium":ke,onAddRiderRisk:Pe,onUpdateRisk:he,onDeleteRisk:Ce},null,8,["product-risk-list","product-info","product-num","product-data"])]})),_:2},1024)))),128)),d("div",Se,[l(p,{activated:"",round:34,onClick:Le},{default:a((()=>[i("添加主险")])),_:1})])]),d("div",Be,[d("span",$e,[i("总保费"),d("span",Ae,"￥"+P(null==(u=null==(e=v(y))?void 0:e.totalPremium)?void 0:u.toLocaleString()),1)]),d("div",Fe,[l(h,{type:"primary",onClick:pe},{default:a((()=>[i("保存并预览")])),_:1})])]),l(V,{show:v(b),"onUpdate:show":t[4]||(t[4]=e=>f(b)?b.value=e:null),actions:o,"cancel-text":"取消","close-on-click-action":"",onCancel:t[5]||(t[5]=e=>v(L)(!1)),onSelect:me},null,8,["show"]),l(le,{ref_key:"trialPopupRef",ref:se,"data-source":v(fe),"product-code":v(de).currentProductCode,onFinish:be},null,8,["data-source","product-code"])]})),_:1})}}}),[["__scopeId","data-v-198bf111"]]);export{Ke as default};
