import{d as e,i as o,j as t,k as a,l as s,o as i,p as l,w as r,a as d,e as u,b as c,u as n,q as p,c as v,F as m,s as f,v as k,_ as R,T as C,z as I,az as L,aA as h,A as y,aB as g,aC as j,aD as w,h as b,aE as _,aF as q,aG as T,f as P,aH as N}from"./index-6dfb9eb8.js";import S from"./index-99e168f4.js";import{a as A,b as V,g as x,s as M,i as D,m as K}from"./trial-6313c38c.js";import{R as B}from"./trial-124934bd.js";import{_ as E}from"./TrialButton-c0a6de88.js";import{u as O}from"./useOrder-630316b4.js";import{p as F,a as z}from"./utils-b4fc1bc7.js";import{q as H}from"./createProposal-b34e2223.js";import{g as U}from"./util-52658c06.js";import{f as $,a as G}from"./findLastIndex-e4896aa6.js";import{c as J}from"./cloneDeep-5c5d66c1.js";import"./InsureInfos-55622262.js";import"./index-9acba029.js";import"./infoCollection-44cd012f.js";import"./index-64259894.js";import"./PolicyInfo-7dfd3b2a.js";import"./questionnaire-42dcb602.js";import"./product-7bbf9c44.js";import"./constants-6ad2f07c.js";import"./utils-827b6f63.js";import"./nextStep-fddcf871.js";import"./core-e4e0378c.js";import"./format-31cde443.js";import"./index-28ec8550.js";import"./utils-3e1c7560.js";const Q={class:"popup-container"},W={class:"popup-header"},X={class:"title"},Y=(e=>(j("data-v-70cc3ead"),e=e(),w(),e))((()=>d("p",{class:"tip"},"已为您挑选出以下险种",-1))),Z={class:"search"},ee={key:0,class:"risk-list"},oe=e({name:"riskSelect"});var te=R(e({...oe,props:{type:{default:2},show:{type:Boolean,default:!1},title:{},insuredList:{default:()=>[]},mainRiskCode:{default:""},selectList:{default:()=>[]},currentProductCode:{default:""},productClass:{default:""}},emits:["cancel","confirm"],setup(e,{emit:R}){const j=e,w=o(),{insurerCode:b}=w.query,_=t([]),q=t([]),T=t([]),P=t(),N=a((()=>j.show)),S=()=>{R("cancel")},x=()=>{var e;if(!(null==(e=_.value)?void 0:e.length))return void C(`暂未添加任何${j.type===B.MAIN_RISK?"主":"附加"}险`);let o=[];o=j.type===B.RIDER_RISK?_.value:q.value.filter((e=>_.value.includes(e.productCode))).map((e=>({productCode:e.productCode,mergeRiskReqList:(e.mainRiskCollocationList||[]).map((e=>({riskCode:e.collocationRiskCode,riskType:e.mainRiskCode?2:1,mainRiskCode:e.mainRiskCode})))}))),R("confirm",o)},M=async()=>{var e;const o={insuredList:j.insuredList,mainRiskCode:j.mainRiskCode,insurerCode:b,productCategory:"",keyword:P.value,selectProductCodes:[],selectRiskCodes:[],filterFlag:(null==(e=j.selectList)?void 0:e.length)?1:2,productClass:j.productClass};if(o.selectProductCodes=j.selectList.map((e=>(e.productCode===j.currentProductCode&&o.selectRiskCodes.push(...e.mergeRiskReqList.map((e=>e.riskCode))),e.productCode))),j.type===B.MAIN_RISK){const{code:e,data:t}=await A(o);"10000"===e&&(q.value=t)}else{const{code:e,data:t}=await V(o);"10000"===e&&(q.value=t.riskInfoList,T.value=t.collocationInfoResList)}};return s((()=>{M()})),(e,o)=>{const t=I,a=L,s=h,R=y,C=g;return i(),l(C,{show:n(N),"onUpdate:show":o[2]||(o[2]=e=>p(N)?N.value=e:null),class:"popup-risk-select",closeable:!1},{default:r((()=>{var C;return[d("div",Q,[d("div",W,[d("span",{class:"clear-all",onClick:S}," 取消 "),d("span",X,u(e.title),1),d("span",{class:"close",onClick:x},"确认")]),Y,d("div",Z,[c(t,{modelValue:n(P),"onUpdate:modelValue":o[0]||(o[0]=e=>p(P)?P.value=e:null),placeholder:"请输入产品名称进行搜索",onSearch:M},null,8,["modelValue"])]),(null==(C=n(q))?void 0:C.length)?(i(),v("div",ee,[c(s,{modelValue:n(_),"onUpdate:modelValue":o[1]||(o[1]=e=>p(_)?_.value=e:null)},{default:r((()=>[(i(!0),v(m,null,f(n(q),(e=>(i(),l(a,{key:e.riskCode||e.productCode,name:e.riskCode||e.productCode,onClick:()=>{return o=e.riskCode,j.type===B.RIDER_RISK&&(T.value||[]).forEach((e=>{_.value.includes(o)?o===e.relatedRiskCode?(2===e.collocationType&&_.value.push(e.collocationRiskCode),3===e.collocationType&&(_.value.push(o),_.value=_.value.filter((o=>o!==e.collocationRiskCode)))):o===e.collocationRiskCode&&(2===e.collocationType&&_.value.push(e.relatedRiskCode),3===e.collocationType&&(_.value=_.value.filter((o=>o!==e.relatedRiskCode)))):o===e.relatedRiskCode?(2===e.collocationType&&(_.value=_.value.filter((o=>o!==e.collocationRiskCode))),3===e.collocationType&&(_.value.push(o),_.value=_.value.filter((o=>o!==e.collocationRiskCode)))):o===e.collocationRiskCode&&(2===e.collocationType&&(_.value=_.value.filter((o=>o!==e.relatedRiskCode))),3===e.collocationType&&(_.value=_.value.filter((o=>o!==e.relatedRiskCode))))})),void(_.value=[...new Set(_.value)]);var o}},{default:r((()=>[k(u(e.riskName||e.productName),1)])),_:2},1032,["name","onClick"])))),128))])),_:1},8,["modelValue"])])):(i(),l(R,{key:1,title:`暂无关联${e.type===n(B).MAIN_RISK?"主":"附加"}险、请选择其他险种`},null,8,["title"]))])]})),_:1},8,["show"])}}}),[["__scopeId","data-v-70cc3ead"]]);const ae={class:"page-trial-wrap"},se=e({name:"trial"}),ie=e({...se,setup(e){const d=o(),u=b(),{productCode:p,orderNo:m,tenantId:f,proposalId:R,proposalInsuredId:C,productClass:I}=d.query,L=t({}),h=t({productList:[]}),y=t([]),g=t({}),j=t(),w=t(),A=t(),V=O({extInfo:{buttonCode:_.TRIAL_PREMIUM,pageCode:q.TRIAL_PREMIUM}});U();const Q=t(),W=t(),X=t(1),Y=a((()=>X.value===B.MAIN_RISK?"添加主险":"添加附加险")),Z=t(!1),ee=()=>{K(h.value).then((({code:e,data:o})=>{if("10000"===e){const{productDetailResList:e,productFactor:t}=o;W.value=t,h.value=z(e);const a={};e.forEach((e=>{a[e.productCode]=e})),L.value=a}}))},oe=()=>{Z.value=!1},se=e=>{if(X.value===B.MAIN_RISK){h.value.productList.push(...e);const o=e.map((e=>e.productCode));j.value.getProductDefaultValue(o)}else{const o=h.value.productList.find((e=>e.productCode===w.value)),t=e.map((e=>({riskCode:e,riskType:B.RIDER_RISK,mainRiskCode:g.value.riskCode}))),a=$(o.mergeRiskReqList,(e=>e.riskCode===g.value.riskCode)),s=G(o.mergeRiskReqList,(e=>e.mainRiskCode===g.value.riskCode));let i=a;-1!==s&&(i=s),o.mergeRiskReqList=[...o.mergeRiskReqList.slice(0,i+1),...t,...o.mergeRiskReqList.slice(i+1,o.mergeRiskReqList.length)],j.value.getRiderRiskDefaultValue(w.value,e,g.value.riskCode,o.mergeRiskReqList)}ee(),Z.value=!1},ie=(e,o,t)=>{Z.value=!0,X.value=B.RIDER_RISK,y.value=t,g.value=o,w.value=e},le=e=>{Z.value=!0,X.value=B.MAIN_RISK,y.value=e},re=(e,o,t)=>{L.value[e],t?(L.value[e].productPlanInsureVOList[0].insureProductRiskVOList=L.value[e].productPlanInsureVOList[0].insureProductRiskVOList.filter((e=>e.riskCode!==o)),h.value.productList=h.value.productList.map((t=>(t.productCode===e&&(t.mergeRiskReqList=t.mergeRiskReqList.filter((e=>e.riskCode!==o))),t)))):(h.value.productList=h.value.productList.filter((o=>o.productCode!==e)),ee())},de=()=>{j.value.onNext((async e=>{var o;const t=J(e),a=["id","relationToHolder","beneficiaryList","guardian","insuredBeneficiaryType"];m||Object.keys(null==(o=t.insuredList)?void 0:o[0]).reduce(((e,o)=>{var s,i,l,r;return!a.includes(o)&&(null==(i=null==(s=t.insuredList)?void 0:s[0])?void 0:i[o])&&(e[o]=null==(r=null==(l=t.insuredList)?void 0:l[0])?void 0:r[o]),e}),t.holder),t.extInfo&&(t.extInfo.iseeBizNo=A.value),t.operateOption={withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0};const{code:s,data:i}=await M(t);"10000"===s&&u.push({path:N.questionNotice,query:{...d.query,orderNo:i}})}))};return T((()=>{m?x({orderNo:m,tenantId:f}).then((({code:e,data:o})=>{"10000"===e&&(Q.value=o,V.value=o,h.value=F(o.insuredList[0].productList),ee())})):R?H({id:R,tenantId:f}).then((({code:e,data:o})=>{if("10000"===e){const{holder:e,insuredList:t}=o,a=(p||"").split(",");let s=[];const i=(t||[]).filter((e=>e.id===+C)).map((e=>({...e,relationToHolder:null,productList:e.productList.filter((e=>!!a.includes(e.productCode)&&(s=e.occupationCodeList,!0)))})));i[0].occupationCodeList=s,Object.assign(V.value,{renewFlag:"",holder:e,tenantId:f,proposalId:R,insuredList:i}),Q.value=V.value,h.value=F(V.value.insuredList[0].productList),ee()}})):D({productCode:p,isTenant:!1}).then((({data:e,code:o})=>{var t,a;"10000"===o&&(L.value[`${p}`]=e,W.value=null==(a=null==(t=null==e?void 0:e.productPlanInsureVOList)?void 0:t[0])?void 0:a.productFactor,h.value=z([e]))}))})),s((()=>{setTimeout((async()=>{A.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,o)=>(i(),v("div",ae,[c(S,{ref_key:"trialRef",ref:j,"product-collection":n(L),"default-data":n(Q),"product-factor":n(W),"product-risk-code-map":n(h),"is-trial":"","hide-benefit":"",onAddRisk:ie,onAddMainRisk:le,onDeleteRisk:re},{trialBtn:r((({riskPremium:e})=>[c(E,{premium:null==e?void 0:e.initialPremium,onHandleClick:de},{label:r((()=>[k(" 首年总保费 ")])),_:2},1032,["premium"])])),_:1},8,["product-collection","default-data","product-factor","product-risk-code-map"]),n(Z)?(i(),l(te,{key:0,type:n(X),"product-class":n(I),show:n(Z),"insured-list":n(y),title:n(Y),"current-product-code":n(w),"main-risk-code":n(g).riskCode,"select-list":n(h).productList,onCancel:oe,onConfirm:se},null,8,["type","product-class","show","insured-list","title","current-product-code","main-risk-code","select-list"])):P("",!0)]))}});export{ie as default};
