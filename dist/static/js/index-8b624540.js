import{a as G,g as Q,E as m,M as W,a6 as N,y as X,_ as h,o as Z,r as L,j as O,n as j,p as k,m as _,z as P,A as c,k as B,t as R,C as ee,a4 as te,a5 as oe}from"./vendor-f5ae78f6.js";import{P as $,a as ae}from"./index-370c09ea.js";import{i as re,p as se}from"./trial-e7097d51.js";import{_ as ie,F as ne}from"./index-ba1e5cac.js";const ye=G({id:"createProposal",state:()=>({proposalInfo:{},trialData:[],excludeProduct:[],proposalId:0}),actions:{setProposalInfo(p){this.$state.proposalInfo=p},setTrialData(p){this.$state.trialData=p},setExcludeProduct(p){this.$state.excludeProduct=p}}});const ue=p=>(te("data-v-65cbf84c"),p=p(),oe(),p),ce={class:"com-product-risk-wrapper"},de={class:"popup-container"},le=ue(()=>P("div",{class:"popup-title"},"\u8BF7\u9009\u62E9\u4FDD\u969C\u65B9\u6848",-1)),pe={class:"risk-trial-wrapper"},fe={class:"risk-content"},me={key:0,class:"risk"},ke={class:"footer-bar"},ge=ee("\u786E\u5B9A"),he=Q({props:{isShow:{type:Boolean,default:!1},type:{default:"add"},productId:{default:0},riskType:{default:1},formInfo:{default:{}},productData:{default:()=>({})},holder:{default:()=>({})},insured:{default:()=>({})},riderRisk:{default:()=>[]},currentRisk:{default:()=>[]}},emits:["close","finished"],setup(p,{emit:F}){var S,E;const n=p,V=m({personVO:{occupationCodeList:[],...n.holder}}),I=m({insuredCode:"",personVO:{occupationCodeList:((E=(((S=n.insured)==null?void 0:S.proposalInsuredProductList)||[]).find(t=>t.productId===n.productData.productBasicInfoVO.id))==null?void 0:E.occupationCodeList)||[],...n.insured}}),v=m({}),b=m({}),g=m({}),w=m({}),A=m({}),e=W({currentPlan:"0",isShow:n.isShow,riskBaseInfo:{},holderFactor:[],insuredFactor:[],riskData:[],riskPlanData:[],trialResult:{},canTrial:!0,retrialTip:!1,enumList:{},ageRange:[],collapseName:["1"],type:n.type});N("premium",A.value),N("source",{type:e.type,origin:"proposal",showRiskList:n.currentRisk});const x=X(()=>{var a;let t="";if((a=e.riskData)!=null&&a[0]){const o=e.riskData[0],s=((o==null?void 0:o.requiredRiderRiskVOList)||[]).map(i=>i.riskName);s.length&&(t=`\u7279\u6B8A\u63D0\u793A: ${o.riskName}\u548C${s.join("\u3001")}\u5FC5\u987B\u540C\u65F6\u6295\u4FDD`)}return t}),M=(t,a)=>{var i,d,u,r,l,D,f,y,T;const o=(t.insuredVOList[0].productPlanVOList[0].riskVOList||[]).map(C=>({...C,premium:a[C.riskCode].premium,amount:a[C.riskCode].amount}));return{proposalHolder:{...(i=t.holder)==null?void 0:i.personVO},proposalInsuredList:[{...t.insuredVOList[0].personVO,dateRange:{min:(u=(d=g.value)==null?void 0:d.ageRangeObj)==null?void 0:u.minAge,max:(l=(r=g.value)==null?void 0:r.ageRangeObj)==null?void 0:l.maxAge},proposalInsuredProductList:[{productId:e.riskBaseInfo.id,productName:e.riskBaseInfo.productName,dateRange:{min:(f=(D=g.value)==null?void 0:D.ageRangeObj)==null?void 0:f.minAge,max:(T=(y=g.value)==null?void 0:y.ageRangeObj)==null?void 0:T.maxAge},occupationCodeList:t.insuredVOList[0].personVO.occupationCodeList,proposalProductRiskList:o}]}]}},q=(t,a)=>{var s,i,d,u;const o=t;if(o.chargePeriod==="3"){const r=(a.chargePeriod||"").split("_");if(r[1]-=1,o.exemptFlag===1){if(r[0]==="to"){let l=0;o.exemptType===1?(s=V.value.personVO)!=null&&s.birthday&&(l=parseInt(`${(+new Date-new Date((i=V.value.personVO)==null?void 0:i.birthday))/(1e3*60*60*24*365)}`,10)):o.exemptType===2&&(d=I.value.personVO)!=null&&d.birthday&&(l=parseInt(`${(+new Date-new Date((u=I.value.personVO)==null?void 0:u.birthday))/(1e3*60*60*24*365)}`,10)),r[1]=r[1]-l}r[0]="year",o.coveragePeriod=r.join("_")}o.chargePeriod=r.join("_")}},J=()=>{var i;const t=JSON.parse(JSON.stringify(v.value[e.currentPlan])),a=Object.values(t).find(d=>d.riskType===1),o=Object.values(t).map(d=>{const u=d;return q(u,a),u.liabilityVOList=(u.liabilityVOList||[]).filter(r=>r.optionalFlag===1||r.liabilityAttributeValue&&r.liabilityAttributeValue!=="-1").map(r=>{const l=r;return l.liabilityAttributeValue==="0"&&(l.liabilityAttributeValue=""),l}),u}),s={holder:V.value,productCode:e.riskBaseInfo.productCode,insuredVOList:[{...I.value,productPlanVOList:[{planCode:e.currentPlan||"",insurerCode:(i=e.riskBaseInfo)==null?void 0:i.insurerCode,riskVOList:o}]}]};se({...s}).then(({code:d,data:u})=>{if(d==="10000"){e.retrialTip=!1,e.trialResult=u,e.canTrial=!1;const r={},l=(D=[])=>{(D||[]).forEach(f=>{var y;r[f.riskCode]=f,(y=f.riskPremiumDetailVOList)!=null&&y.length&&l(f.riskPremiumDetailVOList)})};l(u.riskPremiumDetailVOList),Object.assign(A.value,r),F("finished",M(s,r))}else e.retrialTip=!0})},K=()=>{var t,a,o,s,i;Promise.all([(a=(t=b.value)==null?void 0:t.validateForm)==null?void 0:a.call(t),(s=(o=g.value)==null?void 0:o.validateForm)==null?void 0:s.call(o),(i=w.value)==null?void 0:i.validate()]).then(()=>{J()})},U=()=>{F("close")},Y=()=>{ne({dictCodeList:["RISK_PAYMENT_PERIOD","RISK_INSURANCE_PERIOD"]}).then(({code:a,data:o})=>{if(a==="10000"){const s={};o.forEach(i=>{s[i.dictCode]=i.dictItemList}),e.enumList=s}})},z=()=>{re({productId:n.productId,source:2}).then(({code:t,data:a})=>{t==="10000"&&(e.riskBaseInfo=a.productBasicInfoVO,(a.productRiskVoList[0].riskDetailVOList||[]).forEach((o,s)=>{s===0&&(e.currentPlan=o.planCode||"0"),Object.assign(v.value,{[o.planCode||s]:{}})}),e.riskData=a.productRiskVoList[0].riskDetailVOList||[],e.riskPlanData=a.productRelationPlanVOList||[])}).finally(()=>{})},H=t=>{e.holderFactor=t.holderFactorList,e.insuredFactor=t.insuredFactorList,e.ageRange=t.ageRange};return h([()=>v.value,()=>V.value,()=>I.value],t=>{t&&!e.canTrial&&(e.canTrial=!0,e.retrialTip=!0)},{deep:!0}),h(()=>n.isShow,t=>{e.isShow=t},{immediate:!0}),h(()=>n.productId,t=>{t&&z()},{immediate:!0}),h(()=>n.formInfo,(t={})=>{if(!(n.type==="add"||n.type==="repeatAdd")){const a={};t.proposalProductRiskList.forEach(o=>{a[o.riskId]=o}),Object.assign(v.value,{0:a})}},{deep:!0,immediate:!0}),h(()=>n.productData,t=>{var a;n.type==="add"||n.type==="repeatAdd"||(e.riskBaseInfo=t.productBasicInfoVO,e.riskData=((a=t.productRiskVoList)==null?void 0:a[0].riskDetailVOList)||[])},{deep:!0,immediate:!0}),h(()=>n.type,t=>{e.type=t}),Z(()=>{Y()}),(t,a)=>{const o=L("ProMessage"),s=L("ProCard"),i=L("VanForm"),d=L("VanButton"),u=L("VanPopup");return O(),j("div",ce,[k(u,{show:c(e).isShow,"onUpdate:show":a[0]||(a[0]=r=>c(e).isShow=r),round:"",position:"bottom",closeable:"",style:{height:"80%"},onClose:U},{default:_(()=>[P("div",de,[le,c(x)?(O(),B(o,{key:0,content:c(x)},null,8,["content"])):R("",!0),P("div",pe,[c(e).holderFactor.length?(O(),B(s,{key:0,title:"\u6295\u4FDD\u4EBA",class:"part-card"},{default:_(()=>{var r;return[k($,{ref_key:"holderRef",ref:b,"insured-code":(r=c(e).riskBaseInfo)==null?void 0:r.insurerCode,"form-info":V.value.personVO,"factor-list":c(e).holderFactor,"age-range":c(e).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])]}),_:1})):R("",!0),c(e).insuredFactor.length?(O(),B(s,{key:1,title:"\u88AB\u4FDD\u4EBA",class:"part-card"},{default:_(()=>{var r;return[k($,{ref_key:"insuredRef",ref:g,"insured-code":(r=c(e).riskBaseInfo)==null?void 0:r.insurerCode,"form-info":I.value.personVO,"factor-list":c(e).insuredFactor,"age-range":c(e).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])]}),_:1})):R("",!0),P("div",fe,[k(s,{title:"\u6295\u4FDD\u65B9\u6848",class:"part-card"},{default:_(()=>[c(e).riskData.length?(O(),j("div",me,[k(i,{ref_key:"riskFormRef",ref:w,"input-align":"right","error-message-align":"right"},{default:_(()=>[k(ae,{"risk-info":v.value[0],enums:c(e).enumList,"origin-data":c(e).riskData,"pick-factor":H},null,8,["risk-info","enums","origin-data"])]),_:1},512)])):R("",!0)]),_:1})])]),P("div",ke,[k(d,{block:"",type:"primary",onClick:K},{default:_(()=>[ge]),_:1})])])]),_:1},8,["show"])])}}});var Le=ie(he,[["__scopeId","data-v-65cbf84c"]]);export{Le as P,ye as u};
