import{d as e,a4 as a,a5 as i,h as s,g as t,bv as n,i as o,av as r,o as l,c as d,b as c,a as u,u as f,l as g,q as v,m as p,w as h,a8 as m,aB as y,cd as b,T as j,bk as S,aa as I,ce as E,ag as D}from"./index-c2b6bc52.js";import{b as O}from"./product-f2661c93.js";import{g as L,m as w}from"./trial-bd427bbf.js";import{_ as N}from"./SignPart-4ec31343.js";import{u as T}from"./useOrder-5c61c2bd.js";import{N as _}from"./notice-33e6eedd.js";import{s as x,a as A}from"./verify-b8f67c1f.js";import"./PolicyInfo-096bf79d.js";import{a as C,P as R}from"./constants-fe95ef6f.js";import{p as V}from"./utils-4f4d2e09.js";import"./useAttachment-3f6dca45.js";import"./utils-366f59d7.js";import"./infoCollection-2743d74a.js";import"./trial-09439f3b.js";import"./index-5b4af532.js";const P={class:"long-verify"},q={class:"header"},B={class:"verify-content"},k={class:"footer-button"},U=e({__name:"agentSign",setup(e){const U=a((()=>i((()=>import("./index-7a8543a5.js")),["static/js/index-7a8543a5.js","static/css/index-cb73c937.css","static/js/index-c2b6bc52.js","static/css/index-3d26afdd.css"]))),G=a((()=>i((()=>import("./index-5242d4c1.js")),["static/js/index-5242d4c1.js","static/css/index-fa4edf2a.css","static/js/index-c2b6bc52.js","static/css/index-3d26afdd.css","static/js/theme-94cf7d00.js","static/js/index-978dbbd0.js","static/css/index-bbfdd7ec.css","static/js/utils-366f59d7.js","static/js/infoCollection-2743d74a.js","static/js/trial-09439f3b.js"]))),F=s(),H=t(),{productCode:M="",tenantId:z,agentCode:$="",agencyCode:J,saleChannelId:K,saleUserId:Q,orderNo:W,orderCode:X,extraInfo:Y,isShare:Z,insurerCode:ee,preview:ae}=F.query;let ie={};try{ie=JSON.parse(decodeURIComponent(Y))}catch(ge){}const se=T(),te=`${window.origin}/baseInsurance/long/phoneVerify?${n.stringify({...F.query,orderNo:X||W})}`,ne=o(),oe=o({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:""},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{}},agent:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:""}}),re=o({sign:[],verify:[],scribing:""}),le=o(!1),de=o(0),ce=()=>{le.value=!1},ue=()=>{if(ae)return void y(C.SIGN,F.query);const e=[];ne.value&&re.value.sign.includes("1")&&e.push(ne.value.validateSign()),Promise.all(e).then((e=>{A({bizObjectId:[],bizObjectType:b.AGENT,orderId:se.value.id,tenantId:z}).then((({code:e,data:a})=>{"10000"===e&&a&&H.push({path:R.sign,query:F.query})}))})).catch((e=>{j(e.message)}))};o();o({imgUrl:"",desc:"",title:"",link:te});const fe=async()=>{let e={};const{code:a,data:i}=await L({orderNo:W,tenantId:z});"10000"===a&&(e=V(i.insuredList[0].productList),i.tenantOrderAttachmentList.forEach((e=>{e.objectType===_.HOlDER?oe.value.holder.signData=e.fileBase64:e.objectType===_.AGENT?oe.value.agent.signData=e.fileBase64:e.objectType===_.INSURED&&(oe.value.insured.signData[e.objectId]=e.fileBase64)}))),O(e).then((({code:e,data:a})=>{var i;if("10000"===e){const{signMaterialMap:e}=(null==(i=a.productMaterialPlanVOList)?void 0:i[1])||{};(Object.values(e)||[]).forEach((e=>{e.noticeObject===_.AGENT?oe.value.agent.fileList.push(e):e.noticeObject===_.HOlDER?oe.value.holder.fileList.push(e):e.noticeObject===_.INSURED&&oe.value.insured.fileList.push(e)}))}})),w(e).then((({data:e,code:a})=>{if("10000"===a){const{signInfo:a}=S(e.productFactor);a.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((a=>{e.required&&re.value.sign.push(a.code),"1"===a.code?oe.value.agent.isSign=!0:"2"===a.code?oe.value.holder.isSign=!0:"3"===a.code?oe.value.insured.isSign=!0:"4"===a.code?oe.value.holder.isShareSign=!0:"5"===a.code&&(oe.value.insured.isShareSign=!0)})),"customerFace"===e.name&&e.columns.forEach((a=>{e.required&&re.value.verify.push(a.code),"1"===a.code?oe.value.holder.isVerify=!0:"2"===a.code&&(oe.value.insured.isVerify=!0)}))}))}})),W&&L({orderNo:X||W,tenantId:z}).then((({code:e,data:a})=>{"10000"===e&&(Object.assign(se.value,a),a.tenantOrderAttachmentList.forEach((e=>{e.objectType===_.HOlDER?oe.value.holder.signData=e.fileBase64:e.objectType===_.AGENT?oe.value.agent.signData=e.fileBase64:e.objectType===_.INSURED&&(oe.value.insured.signData[e.objectId]=e.fileBase64)})))}))};return r((()=>{fe()})),(e,a)=>{var i,s,t,n;const o=I,r=E,y=D;return l(),d("div",P,[c(o),u("div",q,[c(r,{type:"warning",title:"尊敬的客户，本次投保需要进行身份认证",content:"本产品投保需要对投保人、被保人进行实名认证，您购买本产品的累计总保费已超过20万，按监管要求，需要提供投保人、被保人、指定受益人证件影像，本产品非本人投保且带身故责任、需对投保人、被保人（成人）的投保意愿进行签字确认。"})]),u("div",B,[c(N,{ref_key:"agentSignRef",ref:ne,"order-detail":f(se),"sign-string":f(oe).agent.signData,"show-sign":f(oe).agent.isSign,"show-verify":f(oe).agent.isVerify,"file-list":f(oe).agent.fileList,"personal-info":f(oe).agent.personalInfo,disabled:!!f(Z),title:"代理人",onHandleSign:a[0]||(a[0]=e=>((e,a,i)=>{var s;console.log("orderDetail.value",se.value),x(e,a,null==(s=se.value)?void 0:s.id,z,i)})("AGENT",e))},null,8,["order-detail","sign-string","show-sign","show-verify","file-list","personal-info","disabled"])]),(null==(s=null==(i=f(oe).agent)?void 0:i.fileList)?void 0:s.length)?(l(),g(f(U),{key:0,"attachment-list":null==(t=f(oe).agent)?void 0:t.fileList,"pre-text":"请阅读",onPreviewFile:a[1]||(a[1]=e=>(e=>{de.value=e,le.value=!0})(e))},null,8,["attachment-list"])):v("",!0),f(le)?(l(),g(f(G),{key:1,show:f(le),"onUpdate:show":a[2]||(a[2]=e=>p(le)?le.value=e:null),"content-list":[null==(n=f(oe).agent)?void 0:n.fileList[f(de)]],"is-only-view":"","active-index":f(de),text:"关闭","force-read-cound":0,onOnCloseFilePreviewByMask:ce},null,8,["show","content-list","active-index"])):v("",!0),u("div",k,[c(y,{type:"primary",onClick:ue},{default:h((()=>[m("确定")])),_:1})])])}}});export{U as default};
