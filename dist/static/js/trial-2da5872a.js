import{d as e,h as a,i as t,j as s,O as o,o as r,l,w as i,a as d,e as u,b as c,u as n,m as p,c as m,F as v,n as f,a8 as k,_ as R,T as C,ap as b,aq as I,ar as j,as as h,at as L,g as y,au as _,q as g,s as P}from"./index-49d4fa1c.js";import{T as w}from"./index-6fe70b36.js";import{a as q,b as N,g as V,s as S,i as x,m as M}from"./trial-b71b15d0.js";import{_ as A}from"./index-1820128f.js";import{S as K}from"./index-aac6fb12.js";import{R as D}from"./trial-fabcc47b.js";import{_ as O}from"./TrialButton-b752ddb0.js";import{u as T}from"./useOrder-6cf087e8.js";import{B as E,a as U}from"./constants-fe95ef6f.js";import{a as B}from"./utils-ba4d4a83.js";import"./cloneDeep-e4501169.js";import"./InsureInfos-10e821d8.js";import"./index-de590a0b.js";import"./get-66ebb657.js";import"./infoCollection-2bb43a7d.js";import"./index-a5b92736.js";import"./PolicyInfo-5bb0e3a0.js";import"./lodash-e76a8740.js";import"./questionnaire-62331097.js";import"./util-55b9e102.js";import"./product-7bbf9c44.js";import"./constants-f76a30cc.js";import"./utils-9dbd2fd2.js";import"./createProposal-73b40de1.js";import"./nextStep-f678aa1c.js";import"./core-2f4c0b97.js";import"./empty-ae586b6c.js";import"./index-14dfd583.js";import"./utils-9d649f18.js";const F={class:"popup-container"},$={class:"popup-header"},H={class:"title"},z=(e=>(h("data-v-30eb5131"),e=e(),L(),e))((()=>d("p",{class:"tip"},"已为您挑选出以下险种",-1))),G={class:"search"},J={key:0,class:"risk-list"},Q=e({name:"riskSelect"});var W=R(e({...Q,props:{type:{default:2},show:{type:Boolean,default:!1},title:{},insuredList:{default:()=>[]},mainRiskCode:{default:""},selectList:{default:()=>[]},currentProductCode:{default:""}},emits:["cancel","confirm"],setup(e,{emit:R}){const h=e,L=a(),{insurerCode:y}=L.query,_=t([]),g=t([]),P=t(),w=s((()=>h.show)),V=()=>{R("cancel")},S=()=>{var e;(null==(e=_.value)?void 0:e.length)?R("confirm",_.value):C(`暂未添加任何${h.type===D.MAIN_RISK?"主":"附加"}险`)},x=async()=>{var e;const a={insuredList:h.insuredList,mainRiskCode:h.mainRiskCode,insurerCode:y,productCategory:"",keyword:P.value,selectProductCodes:[],selectRiskCodes:[],filterFlag:(null==(e=h.selectList)?void 0:e.length)?1:2};if(a.selectProductCodes=h.selectList.map((e=>(e.productCode===h.currentProductCode&&a.selectRiskCodes.push(...e.mergeRiskReqList.map((e=>e.riskCode))),e.productCode))),h.type===D.MAIN_RISK){const{code:e,data:t}=await q(a);"10000"===e&&(g.value=t)}else{const{code:e,data:t}=await N(a);"10000"===e&&(g.value=t)}};return o((()=>{x()})),(e,a)=>{const t=K,s=b,o=I,R=A,C=j;return r(),l(C,{show:n(w),"onUpdate:show":a[2]||(a[2]=e=>p(w)?w.value=e:null),class:"popup-risk-select",closeable:!1},{default:i((()=>[d("div",F,[d("div",$,[d("span",{class:"clear-all",onClick:V}," 取消 "),d("span",H,u(e.title),1),d("span",{class:"close",onClick:S},"确认")]),z,d("div",G,[c(t,{modelValue:n(P),"onUpdate:modelValue":a[0]||(a[0]=e=>p(P)?P.value=e:null),shape:"round",placeholder:"请输入产品名称进行搜索","clear-trigger":"always","show-action":"",clearable:"",onSearch:x},null,8,["modelValue"])]),n(g).length?(r(),m("div",J,[c(o,{modelValue:n(_),"onUpdate:modelValue":a[1]||(a[1]=e=>p(_)?_.value=e:null)},{default:i((()=>[(r(!0),m(v,null,f(n(g),(e=>(r(),l(s,{key:e.riskCode||e.productCode,name:e.riskCode||e.productCode},{default:i((()=>[k(u(e.riskName||e.productName),1)])),_:2},1032,["name"])))),128))])),_:1},8,["modelValue"])])):(r(),l(R,{key:1,title:`暂无关联${e.type===n(D).MAIN_RISK?"主":"附加"}险、请选择其他险种`},null,8,["title"]))])])),_:1},8,["show"])}}}),[["__scopeId","data-v-30eb5131"]]);const X={class:"page-trial-wrap"},Y=e({name:"trial"}),Z=e({...Y,setup(e){const o=a(),d=y(),{productCode:u,orderNo:p,tenantId:v}=o.query,f=t({}),k=t({productList:[]}),R=t([]),C=t({}),b=t(),I=t(),j=T({extInfo:{templateId:201,buttonCode:E.TRIAL_PREMIUM,pageCode:U.TRIAL_PREMIUM}}),h=t(),L=t(1),q=s((()=>L.value===D.MAIN_RISK?"添加主险":"添加附加险")),N=t(!1),A=()=>{N.value=!1},K=e=>{if(L.value===D.MAIN_RISK){const a=e.map((e=>({productCode:e,mergeRiskReqList:[]})));k.value.productList.push(...a),b.value.getProductDefaultValue(e)}else{const a=k.value.productList.find((e=>e.productCode===I.value)),t=e.map((e=>({riskCode:e,riskType:D.RIDER_RISK,mainRiskCode:C.value.riskCode})));a.mergeRiskReqList.push(...t),b.value.getRiderRiskDefaultValue(I.value,e,C.value.riskCode)}M(k.value).then((({code:e,data:a})=>{if("10000"===e){const{productDetailResList:e,productFactor:t}=a;h.value=t,k.value=B(e);const s={};e.forEach((e=>{s[e.productCode]=e})),f.value=s}})),N.value=!1},F=(e,a,t)=>{N.value=!0,L.value=D.RIDER_RISK,R.value=t,C.value=a,I.value=e},$=e=>{N.value=!0,L.value=D.MAIN_RISK,R.value=e},H=(e,a,t)=>{f.value[e],t?(f.value[e].productPlanInsureVOList[0].insureProductRiskVOList=f.value[e].productPlanInsureVOList[0].insureProductRiskVOList.filter((e=>e.riskCode!==a)),k.value.productList=k.value.productList.map((t=>(t.productCode===e&&(t.mergeRiskReqList=t.mergeRiskReqList.filter((e=>e.riskCode!==a))),t)))):(delete f.value[e],k.value.productList=k.value.productList.filter((a=>a.productCode!==e)))},z=()=>{b.value.onNext((async e=>{const{code:a,data:t}=await S(e);"10000"===a&&d.push({path:P.questionNotice,query:{...o.query,orderNo:t}})}))};return _((()=>{x({productCode:u,isTenant:!1}).then((({data:e,code:a})=>{var t,s;"10000"===a&&(f.value[`${u}`]=e,h.value=null==(s=null==(t=null==e?void 0:e.productPlanInsureVOList)?void 0:t[0])?void 0:s.productFactor,k.value=B([e]))})),p&&V({orderNo:p,tenantId:v}).then((({code:e,data:a})=>{"10000"===e&&(j.value=a)}))})),(e,a)=>(r(),m("div",X,[c(w,{ref_key:"trialRef",ref:b,"product-collection":n(f),"default-value":n(j),"product-factor":n(h),"product-risk-code-map":n(k),"is-trial":"","hide-benefit":"",onAddRisk:F,onAddMainRisk:$,onDeleteRisk:H},{trialBtn:i((({riskPremium:e})=>[c(O,{premium:e.initialPremium,onHandleClick:z},null,8,["premium"])])),_:1},8,["product-collection","default-value","product-factor","product-risk-code-map"]),n(N)?(r(),l(W,{key:0,type:n(L),show:n(N),"insured-list":n(R),title:n(q),"current-product-code":n(I),"main-risk-code":n(C).riskCode,"select-list":n(k).productList,onCancel:A,onConfirm:K},null,8,["type","show","insured-list","title","current-product-code","main-risk-code","select-list"])):g("",!0)]))}});export{Z as default};
