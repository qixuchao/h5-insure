import{h as e,aw as t,r,L as n,Z as a,l as o,y as i,z as l,A as d,I as s,Q as c,X as u,a8 as p,N as f,j as m,ax as v,k as A,m as h,n as w,s as I,E as y,F as O,T as b,d as C}from"./vendor-372f2d73.js";import{_ as P,a8 as D,a9 as g}from"./index-33a89504.js";import{P as V}from"./index-9ddb7ec9.js";import{u as k,B as x,A as j,I as F,P as T}from"./useAddressList-572d2ec0.js";import{_ as L,n as N}from"./nextStep-4ca8d748.js";import{a as E,s as H,c as B}from"./phoneVerify-cbc4a69d.js";import{p as Y,g as U}from"./product-57a3f407.js";import{i as S,t as _}from"./trial-be725098.js";import{_ as M}from"./index-efe13cf6.js";import{j as R}from"./trial-9dae0975.js";import{v as z,f as Z}from"./utils-b01b810a.js";import{u as $}from"./theme-bc16780d.js";import"./infoCollection-a1b5aed6.js";import"./relativeTime-701fe99b.js";import"./useDicData-b46e5ac7.js";import"./core-f3a85c7d.js";import"./index-d24ff306.js";import"./useStorage-b69ffe7b.js";var G="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFYAAAAeCAMAAACBgxnEAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAA8UExURUdwTPpkAPpkAPpkAPlkAPlkAP9fAPpkAP9jAPljAPljAPlkAPdhAP9VAPhlAPpjAPpiAPpkAPlhAPpkAKrbDd8AAAATdFJOUwCe3XX6YBgzC+yKwSIDTrE+0C9Hm6hZAAAAf0lEQVR42u2MSw6AIAxEi6CCf+j976ommvG3omxMOqv2vczQmZa3tPRMptdZndVZndXZf892/JGOxN68qUEr24/zk84jSvne93fae3Qk3scrjZeWzDcVaNUQIvRDOGkYQOU+hYMmsBJ+cTt1C0gZP7mNTvhL+Zq5xlfOW4tb6le9ZDBDk4RvXwAAAABJRU5ErkJggg==";const J={class:"free-crad"},Q={class:"container"},X={class:"title"},q=["src"],K=["src"];var W=P(e({props:{colors:{type:Array,default:()=>["#CDDFFE","#F1F7FE"]},detail:{type:Object,default:()=>{}},isFirst:{type:Boolean,default:!0},insureDetail:{type:Object,default:()=>{}}},setup(e,{expose:p}){const f=e;t((e=>({"3d6356f2":f.colors[0],"3d6356b4":f.colors[1]})));const m=r(),v=n({factorObj:{1:[{attributeValues:null,code:"mobile",datasource:null,defaultValue:null,displayType:null,factorId:null,factorScript:null,hasDefaultValue:1,id:8249,isDisplay:1,isHidden:1,isMustInput:1,isReadOnly:null,moduleType:1,placeholder:null,planCode:null,position:null,productCode:"lin23323",productId:null,title:"手机号"},{attributeValues:null,code:"verificationCode",datasource:null,defaultValue:null,displayType:null,factorId:null,factorScript:null,hasDefaultValue:1,id:8249,isDisplay:1,isHidden:1,isMustInput:1,isReadOnly:null,moduleType:1,placeholder:null,planCode:null,position:null,productCode:"lin23323",productId:null,title:"验证码"}],2:[],3:[]},isFirst:!0}),A=async(e,t)=>{const r=f.isFirst?E:H,n=await r(e),{code:a,data:o}=n;"10000"===a&&(null==t||t())};return a((()=>f.isFirst),(()=>{var e;f.isFirst||(v.factorObj=null==(e=f.insureDetail)?void 0:e.productFactor)})),p({validateForm:()=>new Promise(((e,t)=>{m.value.validateForm().then((t=>{e(!0)})).catch((()=>{t()}))}))}),(t,r)=>(o(),i("div",J,[l("div",Q,[l("div",X,[l("img",{src:d(G)},null,8,q),l("span",null,s(e.isFirst?"凭手机号 免费领取":"最后一步 填写信息"),1),l("img",{src:d(G)},null,8,K)]),c(L,{ref_key:"formRef",ref:m,"send-sms-code":A,"need-desensitize":"","form-info":e.detail,"factor-object":d(v).factorObj},null,8,["form-info","factor-object"]),u(t.$slots,"default",{},void 0,!0)])]))}}),[["__scopeId","data-v-513bc632"]]);const ee={class:"page-free-product-detail"},te={class:"product-desc"},re={key:1,class:"page-free-footer"};var ne=P(e({setup(e){t((e=>({"53f6d997":d(le).colors[1]})));const s=$(),u=p(),P=f(),{productCode:L="",agencyCode:E="",tenantId:H="",saleUserId:G="",saleChannelId:J="",extraInfo:Q}=P.query;let X={};try{X=JSON.parse(decodeURIComponent(Q))}catch(Ae){}const{openId:q,indirectCode:K="",agentCode:ne}=X;let ae="";const oe=r(),ie=r(),le=n({colors:["#fff"],detail:{},order:{tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},insuredBeneficiaryType:"1",tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}]}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}},relationList:{},banner:"",productDesc:[],newAuth:!0,isValidateCode:!1,insureDetail:{},loading:!0,isSelfInsure:!0,showBtn:!1,activeIndex:0,showFilePreview:!1,isOnlyView:!0}),de=r();k({openId:q},(e=>{le.relationList=e}));const se=()=>{var e,t,r;const n=le.insureDetail.productRiskVoList||[];return 1===((null==(r=null==(t=null==(e=null==n?void 0:n[0])?void 0:e.riskDetailVOList)?void 0:t[0])?void 0:r.insuranceStartType)||1)?`${C(new Date).format("YYYY-MM-DD")} 00:00:00`:`${C(new Date).add(1,"day").format("YYYY-MM-DD")} 00:00:00`},ce=()=>{var e,t;const r=le.insureDetail.productRiskVoList||[],{insuranceEndType:n,riskInsureLimitVO:a}=(null==(t=null==(e=null==r?void 0:r[0])?void 0:e.riskDetailVOList)?void 0:t[0])||{},{insurancePeriodValueList:o}=a||{},[i,l]=((null==o?void 0:o[0])||"").split("_");return 1===n?`${C(new Date).add(l||0,i).format("YYYY-MM-DD")} 23:59:59`:n?`${C(new Date).add(l,i).format("YYYY-MM-DD")} 00:00:00`:""},ue=async()=>{le.loading=!0;const e=Y({productCode:L,withInsureInfo:!0,tenantId:H}),t=S({productCode:L}),r=U({openId:q});await Promise.all([e,t,r]).then((([e,t,r])=>{var n,a,o,i,l;if("10000"===e.code){le.detail=e.data,le.banner=null==(n=le.detail.tenantProductInsureVO)?void 0:n.banner[0];const{colorEnd:t,colorStart:r}=(null==(a=le.detail.tenantProductInsureVO)?void 0:a.backgroundInsureVO)||{};le.colors=[r,t],le.productDesc=le.detail.tenantProductInsureVO.spec||[],document.title=(null==(i=null==(o=le.detail)?void 0:o.tenantProductInsureVO)?void 0:i.productName)||""}if("10000"===t.code&&(le.insureDetail=t.data,le.insureDetail.productFactor[1].forEach((e=>{"verificationCode"===e.code&&1===e.isDisplay&&(le.isValidateCode=!0)})),le.insureDetail.productFactor[2]=null==(l=le.insureDetail.productFactor)?void 0:l[2].map((e=>{var t,r;return"relationToHolder"===e.code&&1===e.isDisplay&&(e.title="被保人",le.order.tenantOrderInsuredList[0].relationToHolder=(null==(r=null==(t=e.attributeValueList)?void 0:t[0])?void 0:r.code)||""),e}))),"10000"===r.code&&(le.newAuth=!r.data,le.isSelfInsure=!!r.data,r.data)){const e=r.data;le.order.tenantOrderHolder={certNo:null==e?void 0:e.certiNo,extInfo:{},mobile:null==e?void 0:e.mobile,name:null==e?void 0:e.name}}(()=>{let e={};if(e=le.detail.tenantProductInsureVO.planInsureVO.attachmentVOList||[],!e)return void(de.value=[]);const t={2:"richText",3:"link"};de.value=Object.keys(e).map((r=>(e[r].forEach((e=>{if("1"===e.attachmentType){const t=e.attachmentUri.split("?"),r=t[0].substr(t[0].lastIndexOf(".")+1);e.attachmentType="pdf"===r?"pdf":"picture"}else e.attachmentType=t[e.attachmentType]})),{attachmentName:r,attachmentList:e[r]})))||[]})(),le.loading=!1}))},pe=async()=>{let e={loginType:"2",openId:q,thirdUserType:"XINAO_WECHAT",indirectCode:K};try{if(le.newAuth?(e.loginName=le.order.tenantOrderHolder.mobile,e.password=le.order.tenantOrderHolder.verificationCode):e=Z({order:le.order,tenantId:H,extraInfo:X,commencementTime:se(),expiryDate:ce(),detail:le.detail,insureDetail:le.insureDetail,iseeBizNo:ae,agentCode:ne,agencyCode:E,saleUserId:G,templateId:null==X?void 0:X.templateId,saleChannelId:J,pageCode:"infoCollection",buttonCode:"EVENT_FREE_multiIssuePolicy"}),le.newAuth){const{code:t,data:r}=await _(e);"10000"===t&&(le.newAuth=!1)}else N(e,((e,t)=>{t===g.JUMP_PAGE&&e.orderNo&&u.push(`/baseInsurance/orderDetail?from=free&tenantId=${H}&orderNo=${e.orderNo}&productCode=${L}`)}))}catch(t){}},fe=async()=>await(async()=>{var e;await ie.value.validateForm();const t=null==(e=le.order.tenantOrderHolder)?void 0:e.verificationCode;if((le.isValidateCode||le.newAuth)&&(!t||!z(t)))return b({message:"请输入正确的验证码"}),!1;if(le.newAuth||!le.isValidateCode)return!0;const{code:r,data:n}=await B(le.order.tenantOrderHolder.mobile,t);return!!n})()?(le.newAuth||0===de.value.length?pe():(le.isOnlyView=!1,le.showFilePreview=!0),!1):null,me=()=>{le.showFilePreview=!1,le.isOnlyView=!0},ve=()=>{le.showFilePreview=!1,le.isOnlyView=!0,pe()};return m((()=>{ue(),setTimeout((async()=>{ae=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),a((()=>le.order.tenantOrderInsuredList[0]),(e=>{if(D(le.relationList)||le.newAuth)return null;const t=le.relationList[e.relationToHolder]||[];return 1===t.length&&(R.SELF!==e.relationToHolder?(le.order.tenantOrderInsuredList[0].certNo=le.order.tenantOrderInsuredList[0].certNo?le.order.tenantOrderInsuredList[0].certNo:t[0].cert[0].certNo,le.order.tenantOrderInsuredList[0].name=le.order.tenantOrderInsuredList[0].name?le.order.tenantOrderInsuredList[0].name:t[0].cert[0].certName):le.isSelfInsure&&(le.isSelfInsure=!1,le.order.tenantOrderHolder.certNo=le.order.tenantOrderHolder.certNo?le.order.tenantOrderHolder.certNo:t[0].cert[0].certNo,le.order.tenantOrderHolder.name=le.order.tenantOrderHolder.name?le.order.tenantOrderHolder.name:t[0].cert[0].certName)),!1}),{immediate:!0,deep:!0}),v(oe,(([{isIntersecting:e}],t)=>{le.showBtn=!e})),(e,t)=>{const r=A("van-image"),n=A("van-config-provider");return o(),h(n,{"theme-vars":d(s)},{default:w((()=>{var e,n,a,s;return[l("div",ee,[c(x,{url:d(le).banner},null,8,["url"]),c(W,{ref_key:"formRef",ref:ie,"is-first":d(le).newAuth,"insure-detail":d(le).insureDetail,detail:d(le).order,colors:d(le).colors},{default:w((()=>[c(V,{ref_key:"root",ref:oe,class:"submit-btn","is-gradient":!1,text:d(le).newAuth?"立即领取":"激活保障",onClick:fe},null,8,["text"]),!d(le).newAuth&&de.value&&de.value.length>0?(o(),h(j,{key:0,"attachement-list":de.value,"has-bg-color":!1,"pre-text":"请阅读",onPreviewFile:t[0]||(t[0]=e=>(e=>{le.isOnlyView=!0,le.activeIndex=e,le.showFilePreview=!0})(e))},null,8,["attachement-list"])):I("",!0)])),_:1},8,["is-first","insure-detail","detail","colors"]),l("div",te,[(o(!0),i(O,null,y(d(le).productDesc,((e,t)=>(o(),h(r,{key:t,width:"100%","lazy-load":"",src:e,class:""},null,8,["src"])))),128))]),(null==(n=null==(e=d(le).detail)?void 0:e.tenantProductInsureVO)?void 0:n.inscribedContent)?(o(),h(F,{key:0,"inscribed-content":null==(s=null==(a=d(le).detail)?void 0:a.tenantProductInsureVO)?void 0:s.inscribedContent},null,8,["inscribed-content"])):I("",!0),d(le).showBtn?(o(),i("footer",re,[c(V,{"is-gradient":!1,text:d(le).newAuth?"立即领取":"激活保障",onClick:fe},null,8,["text"])])):I("",!0)]),d(le).showFilePreview&&0!==de.value.length?(o(),h(M,{key:0,show:d(le).showFilePreview,"onUpdate:show":t[1]||(t[1]=e=>d(le).showFilePreview=e),"content-list":de.value,"is-only-view":d(le).isOnlyView,"active-index":d(le).activeIndex,text:d(le).isOnlyView?"关闭":"我已逐页阅读上述内容并同意","force-read-cound":0,"on-close-file-preview":"",onSubmit:ve,onOnCloseFilePreview:me},null,8,["show","content-list","is-only-view","active-index","text"])):I("",!0),d(le).loading?I("",!0):(o(),h(T,{key:1,"product-detail":d(le).detail},null,8,["product-detail"]))]})),_:1},8,["theme-vars"])}}}),[["__scopeId","data-v-7dbc0d8c"]]);export{ne as default};
