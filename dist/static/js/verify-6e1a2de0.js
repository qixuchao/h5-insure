import{d as e,j as a,k as l,B as s,o as i,m as o,w as n,a as r,e as u,u as d,b as t,V as c,W as v,ci as m,cj as f,ck as p,cl as h,cm as g,aB as y,ao as b,cn as S,i as C,h as V,a6 as k,aj as j,O as q,c as w,f as x,F as I,p as A,a8 as L,co as M,bV as $,cp as _,cq as N,bZ as P,cr as T,cs as U,T as E,bw as O,bs as D,aL as F,a9 as R,aa as B,bp as G,ag as H}from"./index-97d6e4e2.js";import{P as Y}from"./index-b48fcb48.js";import{n as z}from"./nextStep-de183ad2.js";import{c as W}from"./format-b5e9d8b9.js";import{g as Z,m as J}from"./trial-eed2e069.js";import{p as K}from"./utils-f970f8a8.js";import{u as Q}from"./useOrder-3b041634.js";import{M as X,P as ee,a as ae,B as le}from"./constants-4b08cf92.js";import{d as se,q as ie}from"./verify-cdb0891c.js";import"./core-af445785.js";import"./utils-693435fe.js";import"./infoCollection-4bc671b5.js";import"./trial-e656e821.js";const oe={class:"popup-container"},ne={class:"popup-header"},re={class:"title"},ue={class:"popup-body"},de=e({name:"checkCodePopup"}),te=e({...de,props:{show:{type:Boolean,default:!1},type:{default:"agent"},data:{default:()=>({})}},emits:["cancel","confirm"],setup(e,{emit:b}){const S=e,C=a(),V=l((()=>S.show)),k=a({mobile:"",verifyCode:""}),j=l((()=>S.type)),q=a({holder:{type:"投保人",name:"",mobile:"",desc:""},agent:{type:"代理人",name:"",mobile:"",desc:"色卡上会计核算看回放独守空房还是空巅峰计划收款方"},insured:{type:"被保人",name:"",mobile:"",desc:""}}),w=()=>{b("cancel")},x=()=>{C.value.validate().then((()=>{b("confirm")}))};return s([()=>S.data,S.type],(([e,a])=>{var l,s,i;e&&(Object.assign(q.value.holder,e.holder),Object.assign(q.value.insured,null==(l=null==e?void 0:e.insuredList)?void 0:l[0]),k.value.mobile=null==(i=null==(s=q.value)?void 0:s[S.type])?void 0:i.mobile)}),{immediate:!0,deep:!0}),(e,a)=>{const l=p,s=h,b=g,S=y;return i(),o(S,{show:V.value,"onUpdate:show":a[2]||(a[2]=e=>V.value=e),class:"popup-check-mobile",closeable:!1,"close-on-click-overlay":!1},{default:n((()=>[r("div",oe,[r("div",ne,[r("span",{class:"clear-all",onClick:w}," 取消 "),r("span",re,u(`${q.value[j.value].type}手机号验证`),1),r("span",{class:"close",onClick:x},"确认")]),r("div",ue,[r("h3",null,u(`尊敬的${q.value[j.value].type}:${q.value[j.value].name}`),1),r("p",null,u(q.value[j.value].desc),1),r("h3",null,u(`${q.value[j.value].type}手机号验证 ${d(W)(q.value[j.value].mobile||"")}`),1),t(b,{ref_key:"formRef",ref:C,"validate-method":"toast",model:k.value},{default:n((()=>[c(t(l,{modelValue:k.value.mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>k.value.mobile=e),label:"被保人手机号",name:"mobile",maxlength:"11",rules:[{required:!0,message:"请输入手机号"}]},null,8,["modelValue"]),[[v,!1]]),t(s,{modelValue:k.value.verifyCode,"onUpdate:modelValue":a[1]||(a[1]=e=>k.value.verifyCode=e),"related-name":"mobile",label:" ",maxlength:"6","input-align":"left",placeholder:"请输入验证码",name:"verifyCode",rules:[{required:!0,message:"请输入验证码"}],"send-s-m-s-code":d(m),"check-s-m-s-code":d(f)},null,8,["modelValue","send-s-m-s-code","check-s-m-s-code"])])),_:1},8,["model"])])])])),_:1},8,["show"])}}}),ce=b([{label:"签名完成",value:1},{label:"去签名",value:2},{label:"认证失败，请联系内勤人员",value:3}]),ve=2,me=b([{label:"去双录",value:1},{label:"双录完成",value:ve},{label:"双录失败",value:3}]);const fe={class:"page-verify-wrap"},pe={class:"sign-list"},he={class:"inner-cell"},ge={class:"inner-cell"},ye={class:"inner-cell"},be={class:"inner-cell"},Se={class:"footer-button"},Ce=e({name:"verify"}),Ve=e({...Ce,setup(e){const s=S(),u=C(),c=V(),{orderNo:v,tenantId:y}=u.query,b=a(!1),W=a(),oe=a(!1),ne=a(),re=a({holderMobile:"",holderVerifyCode:"",insuredMobile:"",insuredVerifyCode:""}),ue=Q(),de=a(!1),Ce=a({sign:[],verify:[],scribing:""}),Ve=a({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{},verifyStatus:2},agent:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2}}),ke=a("agent"),je=l((()=>e=>Ce.value.sign.includes(e)||Ce.value.verify.includes(e))),qe=l((()=>Ve.value.agent.verifyStatus!==k.YES)),we=l((()=>{const{insuredList:e}=ue.value||{},{age:a,relationToHolder:l}=e[0]||{};return!(a<18||`${l}`===j.CERT)})),xe=l((()=>e=>Ve.value[e].isSign||Ve.value[e].isVerify)),Ie=l((()=>e=>Ve.value[e].isShareSign)),Ae=e=>{var a;const{holder:l,insured:s}=ue.value;let i={name:l.name,gender:`${M[l.gender]}士`};"insured"===e&&(i={name:null==s?void 0:s[0].name,gender:`${M[null==(a=null==s?void 0:s[0])?void 0:a.gender]}士`}),$({messageType:X.HOLDER,orderNo:v,tenantId:y}),_({shareType:0,title:`${N.sign.title}（${P[e.toLocaleUpperCase()]}）`,desc:N.sign.desc.replace("{name}",`${i.name||""}${i.gender||""},代理人`),url:`${window.location.href}&objectType=${e}&nextPageCode=infoPreview`.replace("/verify","/phoneVerify"),imageUrl:"https://zatech-aquarius-v2-private-test.oss-cn-hangzhou.aliyuncs.com/lian_logo.png?OSSAccessKeyId=LTAI5t9uBW78vZ4sm5i3oQ5C&Expires=1697288114&Signature=S87PMeDRxltLovmmHVTeiHoew1c%3D"})},Le=e=>{ke.value=e,"agent"!==e?qe.value||(de.value=!0):c.push({path:ee.agentSign,query:u.query})},Me=()=>{qe.value||W.value===ve||(T("com.situ.lian://shuanglu?jsonParams=%7B%22agentNo%22%3A%22AGENT8848%22%2C%22data%22%3A%22SITU9527%22%2C%22orderSource%22%3A%221%22%2C%22systemSource%22%3A%224%22%7D"),U("com.situ.lian://shuanglu?jsonParams=%7B%22agentNo%22%3A%22AGENT8848%22%2C%22data%22%3A%22SITU9527%22%2C%22orderSource%22%3A%221%22%2C%22systemSource%22%3A%224%22%7D"),se(ue.value).then((({code:e,data:a})=>{"10000"===e&&a&&E("双录已完成")})))},$e=()=>{de.value=!1},_e=()=>{let e="";e="agent"===ke.value?ee.infoPreview:(ke.value,Ve.value[ke.value].isVerify?ee.verifyFace:ee.infoPreview),s.set(`${O}_orderDetail`,ue.value),c.push({path:e,query:{...u.query,objectType:ke.value,isFirst:1}})},Ne=async()=>{let e={};ie({orderNo:v,tenantId:y}).then((({code:e,data:a})=>{if("10000"===e){const{doubleRecordFlag:e,doubleRecordStatus:l}=a;b.value=e===k.YES,W.value=l}})),await Z({orderNo:v,tenantId:y}).then((({code:a,data:l})=>{var s,i,o;if("10000"===a){Object.assign(ue.value,l);const{agentAuthFlag:a}=l.extInfo,{mobile:n}=l.holder,{mobile:r}=(null==(s=l.insuredList)?void 0:s[0])||{};Object.assign(re.value,{holderMobile:n,insuredMobile:r}),e=K(l.insuredList[0].productList),Ve.value.agent.verifyStatus=a,Ve.value.holder.verifyStatus=l.holder.isCert,Ve.value.insured.verifyStatus=null==(o=null==(i=l.insuredList)?void 0:i[0])?void 0:o.isCert}})),await J(e).then((({data:e,code:a})=>{if("10000"===a){const{signInfo:a}=D(e.productFactor);a.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((a=>{e.required&&Ce.value.sign.push(a.code),"1"===a.code?Ve.value.agent.isSign=!0:"2"===a.code?Ve.value.holder.isSign=!0:"3"===a.code?Ve.value.insured.isSign=!0:"4"===a.code?Ve.value.holder.isShareSign=!0:"5"===a.code&&(Ve.value.insured.isShareSign=!0)})),"customerFace"===e.name&&e.columns.forEach((a=>{e.required&&Ce.value.verify.push(a.code),"1"===a.code?Ve.value.holder.isVerify=!0:"2"===a.code&&(Ve.value.insured.isVerify=!0)}))}))}})),oe.value=!1},Pe=async()=>{var e;const{holder:a,insuredList:l,extInfo:s}=ue.value;if(b.value){if(s.agentAuthFlag!==k.YES)return void E("代理人签名未完成")}else{if(s.agentAuthFlag===k.NO)return void E("代理人签名未完成");if(a.isCert===k.NO)return void E("投保人签名未完成");if(l[0].isCert===k.NO)return void E("被保人签名未完成")}await(null==(e=ne.value)?void 0:e.validate());const i=Object.assign(ue.value,{extInfo:{...ue.value.extInfo,pageCode:ae.SIGN,buttonCode:le.SIGN}});z(i,((e,a)=>{a===F.JUMP_PAGE&&R(e.nextPageCode,u.query)}),u)};return q((()=>{Ne()})),(e,a)=>{const l=B,s=G,u=Y,c=H;return i(),w("div",fe,[t(l),t(u,{modelValue:d(oe),"onUpdate:modelValue":a[9]||(a[9]=e=>A(oe)?oe.value=e:null),onRefresh:Ne},{default:n((()=>[r("div",pe,[d(xe)("agent")?(i(),o(s,{key:0,title:"代理人签名",required:d(je)("agent")},{value:n((()=>[r("div",he,[t(s,{"is-link":"",value:d(ce)[d(Ve).agent.verifyStatus],onClick:a[0]||(a[0]=e=>Le("agent"))},null,8,["value"])])])),_:1},8,["required"])):x("",!0),d(b)?(i(),o(d(g),{key:2,ref_key:"formRef",ref:ne,"validate-method":"toast",model:d(re)},{default:n((()=>[t(d(p),{modelValue:d(re).holderMobile,"onUpdate:modelValue":a[5]||(a[5]=e=>d(re).holderMobile=e),label:"投保人手机号",name:"holderMobile",maxlength:"11",required:"","is-view":""},null,8,["modelValue"]),t(d(h),{modelValue:d(re).holderVerifyCode,"onUpdate:modelValue":a[6]||(a[6]=e=>d(re).holderVerifyCode=e),"related-name":"holderMobile",label:"验证码",maxlength:"6",name:"holderVerifyCode","send-s-m-s-code":d(m),"check-s-m-s-code":d(f),required:""},null,8,["modelValue","send-s-m-s-code","check-s-m-s-code"]),d(we)?(i(),w(I,{key:0},[t(d(p),{modelValue:d(re).insuredMobile,"onUpdate:modelValue":a[7]||(a[7]=e=>d(re).insuredMobile=e),label:"被保人手机号",name:"insuredMobile",maxlength:"11",required:"","is-view":""},null,8,["modelValue"]),t(d(h),{modelValue:d(re).insuredVerifyCode,"onUpdate:modelValue":a[8]||(a[8]=e=>d(re).insuredVerifyCode=e),label:"验证码",maxlength:"6",name:"insuredVerifyCode","related-name":"insuredMobile","send-s-m-s-code":d(m),"check-s-m-s-code":d(f),required:""},null,8,["modelValue","send-s-m-s-code","check-s-m-s-code"])],64)):x("",!0)])),_:1},8,["model"])):(i(),w(I,{key:1},[d(xe)("holder")?(i(),o(s,{key:0,title:"投保人签名",required:d(je)("holder")},{value:n((()=>[r("div",ge,[d(Ie)("holder")?(i(),o(s,{key:0,"value-class":""+(d(qe)?"disable":""),"is-link":"",value:"分享空签邀约",onClick:a[1]||(a[1]=e=>Ae("holder"))},null,8,["value-class"])):x("",!0),t(s,{"is-link":"",value:d(ce)[d(Ve).holder.verifyStatus],"value-class":""+(d(qe)?"disable":""),onClick:a[2]||(a[2]=e=>Le("holder"))},null,8,["value","value-class"])])])),_:1},8,["required"])):x("",!0),d(xe)("insured")&&d(we)?(i(),o(s,{key:1,title:"被保人签名",required:d(je)("insured")},{value:n((()=>[r("div",ye,[d(Ie)("insured")?(i(),o(s,{key:0,"value-class":""+(d(qe)?"disable":""),"is-link":"",value:"分享空签邀约",onClick:a[3]||(a[3]=e=>Ae("insured"))},null,8,["value-class"])):x("",!0),t(s,{"is-link":"","value-class":""+(d(qe)?"disable":""),value:d(ce)[d(Ve).insured.verifyStatus],onClick:a[4]||(a[4]=e=>Le("insured"))},null,8,["value-class","value"])])])),_:1},8,["required"])):x("",!0)],64)),d(b)?x("",!0):(i(),o(s,{key:3,title:"保单双录",required:""},{value:n((()=>[r("div",be,[t(s,{"is-link":"","value-class":""+(d(qe)?"disable":""),value:d(me)[d(W)],onClick:Me},null,8,["value-class","value"])])])),_:1}))])])),_:1},8,["modelValue"]),r("div",Se,[t(c,{type:"primary",onClick:Pe},{default:n((()=>[L("下一步")])),_:1})]),d(de)?(i(),o(te,{key:0,type:d(ke),show:d(de),data:d(ue),onCancel:$e,onConfirm:_e},null,8,["type","show","data"])):x("",!0)])}}});export{Ve as default};
