import{d as e,h as a,g as i,bF as s,i as t,av as n,o as r,c as o,b as l,a as d,u as c,w as u,a8 as f,aB as g,cd as p,T as h,bj as v,aa as m,c7 as y,an as b}from"./index-cb6244e5.js";import{c as j}from"./product-31222ac8.js";import{g as S,m as I}from"./trial-7c136c09.js";import{_ as D}from"./SignPart-a66af0ee.js";import{u as E}from"./useOrder-a8cca413.js";import{M as N}from"./product-585b0e6f.js";import{N as O}from"./notice-33e6eedd.js";import{s as T,a as L}from"./verify-0b49890f.js";import"./PolicyInfo-38735e27.js";import{P as w,a as C}from"./constants-5480429b.js";import{a as A}from"./utils-0af605ab.js";import"./useAttachment-5bf2dad4.js";import"./utils-128dc56b.js";import"./infoCollection-c91b4b6c.js";import"./trial-c8f568a3.js";import"./index-2a81c410.js";const R={class:"long-verify"},V={class:"header"},q={class:"verify-content"},B={class:"footer-button"},G=e({__name:"agentSign",setup(e){const G=a(),U=i(),{productCode:P="",tenantId:_,agentCode:x="",agencyCode:H,saleChannelId:M,saleUserId:k,orderNo:F,orderCode:z,extraInfo:$,isShare:J,insurerCode:K,preview:Q}=G.query;let W={};try{W=JSON.parse(decodeURIComponent($))}catch(te){}const X=E(),Y=`${window.origin}/baseInsurance/long/phoneVerify?${s.stringify({...G.query,orderNo:z||F})}`,Z=t(),ee=t({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:""},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{}},agent:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:""}}),ae=t({sign:[],verify:[],scribing:""}),ie=()=>{if(Q)return void g(w.SIGN,G.query);const e=[];Z.value&&ae.value.sign.includes("1")&&e.push(Z.value.validateSign()),Promise.all(e).then((e=>{L({bizObjectId:[],bizObjectType:p.AGENT,orderId:X.value.id,tenantId:_}).then((({code:e,data:a})=>{"10000"===e&&a&&U.push({path:C.sign,query:G.query})}))})).catch((e=>{h(e.message)}))};t();t({imgUrl:"",desc:"",title:"",link:Y});const se=async()=>{let e={};const{code:a,data:i}=await S({orderNo:F,tenantId:_});"10000"===a&&(e=A(i.insuredList[0].productList),i.tenantOrderAttachmentList.forEach((e=>{e.objectType===O.HOlDER?ee.value.holder.signData=e.fileBase64:e.objectType===O.AGENT?ee.value.agent.signData=e.fileBase64:e.objectType===O.INSURED&&(ee.value.insured.signData[e.objectId]=e.fileBase64)}))),j(e).then((({code:e,data:a})=>{var i;if("10000"===e){const{productMaterialMap:e}=(null==(i=a.productMaterialPlanVOList)?void 0:i[0])||{};(Object.values(e||{})||[]).flat().filter((e=>e.materialType===N.SIGN)).forEach((e=>{e.noticeObject===O.AGENT?ee.value.agent.fileList.push(e):e.noticeObject===O.HOlDER?ee.value.holder.fileList.push(e):e.noticeObject===O.INSURED&&ee.value.insured.fileList.push(e)}))}})),I(e).then((({data:e,code:a})=>{if("10000"===a){const{signInfo:a}=v(e.productFactor);a.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((a=>{e.required&&ae.value.sign.push(a.code),"1"===a.code?ee.value.agent.isSign=!0:"2"===a.code?ee.value.holder.isSign=!0:"3"===a.code?ee.value.insured.isSign=!0:"4"===a.code?ee.value.holder.isShareSign=!0:"5"===a.code&&(ee.value.insured.isShareSign=!0)})),"customerFace"===e.name&&e.columns.forEach((a=>{e.required&&ae.value.verify.push(a.code),"1"===a.code?ee.value.holder.isVerify=!0:"2"===a.code&&(ee.value.insured.isVerify=!0)}))}))}})),F&&S({orderNo:z||F,tenantId:_}).then((({code:e,data:a})=>{"10000"===e&&(Object.assign(X.value,a),a.tenantOrderAttachmentList.forEach((e=>{e.objectType===O.HOlDER?ee.value.holder.signData=e.fileBase64:e.objectType===O.AGENT?ee.value.agent.signData=e.fileBase64:e.objectType===O.INSURED&&(ee.value.insured.signData[e.objectId]=e.fileBase64)})))}))};return n((()=>{se()})),(e,a)=>{const i=m,s=y,t=b;return r(),o("div",R,[l(i),d("div",V,[l(s,{type:"warning",title:"尊敬的客户，本次投保需要进行身份认证",content:"本产品投保需要对投保人、被保人进行实名认证，您购买本产品的累计总保费已超过20万，按监管要求，需要提供投保人、被保人、指定受益人证件影像，本产品非本人投保且带身故责任、需对投保人、被保人（成人）的投保意愿进行签字确认。"})]),d("div",q,[l(D,{ref_key:"agentSignRef",ref:Z,"order-detail":c(X),"sign-string":c(ee).agent.signData,"show-sign":c(ee).agent.isSign,"show-verify":c(ee).agent.isVerify,"file-list":c(ee).agent.fileList,"personal-info":c(ee).agent.personalInfo,disabled:!!c(J),title:"代理人",onHandleSign:a[0]||(a[0]=e=>((e,a,i)=>{var s;console.log("orderDetail.value",X.value),T(e,a,null==(s=X.value)?void 0:s.id,_,i)})("AGENT",e))},null,8,["order-detail","sign-string","show-sign","show-verify","file-list","personal-info","disabled"])]),d("div",B,[l(t,{type:"primary",onClick:ie},{default:u((()=>[f("确定")])),_:1})])])}}});export{G as default};
