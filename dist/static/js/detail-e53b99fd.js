import{d as e,r as t,b as a,c as n,h as l,j as o,g as i,k as r,f as d,w as s,n as u,t as c,a2 as f,X as v,F as m,b4 as p,a as h,u as y,y as I,e as C,i as b,T as O,Z as w}from"./index-3898adba.js";import{u as x}from"./theme-65292714.js";import{g as j,i as L}from"./trial-90934487.js";import g from"./index-0e7c179e.js";import{s as N}from"./verify-75eed699.js";import{n as _}from"./nextStep-bea0bd37.js";import{p as k}from"./product-511cfeb4.js";import{O as E,a as P}from"./order-de9535ec.js";import T from"./index-0743af83.js";import V from"./index-6e34a33d.js";import{u as S}from"./useDicData-e6df81e6.js";import{a as R}from"./trial-0423da29.js";import"./pdfh5-008ca364.js";import"./infoCollection-f73cacca.js";import"./relativeTime-fde2a46e.js";import"./validator-5a13dc82.js";import"./core-eb5ed187.js";import"./useStorage-e5ca6bac.js";import"./utils-e8cb0724.js";const H={class:"sign-wrap"},U=["src"],A={class:"popup-body"},D={class:"sign-container-wrap"},B={class:"operate-bar"},F={class:"btns"},$=e({__name:"index",props:{option:{default:{}},modelValue:{default:""}},emits:["update:modelValue"],setup(e,{emit:h}){const y=t(!1),I=t(),C=t(""),b=t(!0),O=()=>{var e;y.value=!0,null==(e=I.value)||e.clear()},w=()=>{p({images:[C.value],className:"customer-sign-preview"})},x=()=>{y.value=!1},j=()=>{var e,t;null==(t=null==(e=I.value)?void 0:e.clear)||t.call(e)},L=()=>{var e;C.value=null==(e=I.value)?void 0:e.save(),h("update:modelValue",C.value),y.value=!1};return(e,t)=>{const p=a("van-button"),h=a("van-icon"),g=a("van-popup");return n(),l(m,null,[o("div",H,[i(C)?(n(),l("img",{key:0,class:"preview-sign",src:i(C),alt:"",onClick:w},null,8,U)):r("",!0),d(p,{type:"primary",round:"",size:"small",onClick:O},{default:s((()=>[u(c(i(C)?"重新签名":"点击签字"),1)])),_:1})]),d(g,{show:i(y),"onUpdate:show":t[1]||(t[1]=e=>v(y)?y.value=e:null),position:"bottom",style:{height:"100%",overflow:"hidden"}},{default:s((()=>[o("div",A,[o("div",D,[d(f,{ref_key:"signRef",ref:I,placeholder:"请在此处签名",onStroke:t[0]||(t[0]=e=>b.value=!1)},null,512),o("div",B,[o("span",null,[d(h,{name:"info",color:"#ffaf22"}),u(" 请投保人正楷签署您的签名:")]),o("div",F,[d(p,{type:"default",class:"btn",onClick:x},{default:s((()=>[u("返回")])),_:1}),d(p,{type:"default",class:"btn",onClick:j},{default:s((()=>[u("重写")])),_:1}),d(p,{type:"primary",class:"btn",disabled:i(b),onClick:L},{default:s((()=>[u("确定签字")])),_:1},8,["disabled"])])])])])])),_:1},8,["show"])],64)}}});const q={key:0,class:"net-sale-detail-wrap"},z={class:"sign-cell"},G=o("div",{class:"sign-label"},"签名",-1),W={class:"footer"},Y={class:"footer"},Z=e({__name:"detail",setup(e){const u=x(),c=h(),f=y(),{orderNo:p="2022113021181894998",tenantId:H="9991000001"}=c.query,U=t({}),A=t(!1),D=S("NATIONAL_REGION_CODE"),B=t({commencementTime:"",expiryDate:"",extInfo:{buttonCode:"EVENT_NETSALE_airSignature",pageCode:"infoCollection",templateId:3,iseeBizNo:""},orderCategory:1,tenantId:H,venderCode:"",tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}],tenantOrderProductList:[{}]}],tenantOrderSubjectList:[{extInfo:{subjectRelatedFirm:"",subjectRelatedUserId:""},subjectName:"",subjectObjectType:"HOLDER",subjectType:"GENERAL",subjectNo:"",tenantId:H}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}}),F=t(!1),Z=t(),M=t(),X=t(),J=t(""),K=t(""),Q=t(!1),ee=t(!1),te=t(0),ae=t([]),ne=t(""),le=t("");t("");const oe=t([]),ie=()=>{Q.value=!1,ee.value=!1},re=async()=>{Q.value=!1,ee.value=!0,await N("HOLDER",J.value,B.value.id,`${H}`),_(B.value)},de=async()=>{const{data:e,code:t}=await k({productCode:le.value,tenantId:H,withInsureInfo:!0});"10000"===t&&(X.value=e,(()=>{var e,t,a,n,l,o;let i={};if(i=K.value?(null==(a=((null==(t=null==(e=X.value)?void 0:e.tenantProductInsureVO)?void 0:t.planList)||[]).find((e=>e.planCode===K.value)))?void 0:a.attachmentVOList)||[]:(null==(o=null==(l=null==(n=X.value)?void 0:n.tenantProductInsureVO)?void 0:l.planInsureVO)?void 0:o.attachmentVOList)||[],!i)return void(ae.value=[]);const r={2:"richText",3:"link"};ae.value=Object.keys(i).map((e=>(i[e].forEach((e=>{if("1"===e.attachmentType){const t=e.attachmentUri.split("?"),a=t[0].substr(t[0].lastIndexOf(".")+1);e.attachmentType="pdf"===a?"pdf":"picture"}else e.attachmentType=r[e.attachmentType]})),{attachmentName:e,attachmentList:i[e]})))||[],oe.value=ae.value.map((e=>({attachmentName:e.attachmentName,attachmentList:e.attachmentList.filter((e=>e.mustReadFlag===w.YES))}))).filter((e=>e.attachmentList.length))})())},se=async()=>{var e;const{code:t,data:a}=await j({orderNo:p,tenantId:H});"10000"===t&&(a.extInfo.buttonCode="EVENT_NETSALE_airSignature",B.value=a,K.value=null==(e=a.tenantOrderInsuredList[0])?void 0:e.planCode,le.value=a.tenantOrderInsuredList[0].tenantOrderProductList[0].productCode,A.value=!0,(e=>{const t=e.find((e=>1===e.riskType));var a,n;t&&(ne.value=(a=t.insurancePeriodValue,-1!==(n=R[t.insurancePeriodType]).indexOf("$")?n.replace("$",`${a}`):`${a||""}${n}`))})(a.tenantOrderInsuredList[0].tenantOrderProductList[0].tenantOrderRiskList||[]),(async()=>{const{code:e,data:t}=await L({productCode:le.value,tenantId:H});"10000"===e&&(M.value=t,U.value=t.productFactor)})(),de(),a.orderStatus!==P.UNDER_WRITING_SUCCESS&&f.push({path:"/baseInsurance/orderDetail",query:{...c.query,productCode:le.value,ISEE_BIZ:a.extInfo.iseeBizNo}}))},ue=async()=>{J.value?(ee.value=!1,oe.value.length?Q.value=!0:re()):O("请先签字")};return I((()=>{se()})),(e,t)=>{const c=a("ProCell"),f=a("ProCard"),p=a("ProCascader"),h=a("van-cell"),y=a("ProPageWrap"),I=a("ProFilePreview"),O=a("ProPopup"),w=a("van-config-provider");return n(),C(w,{"theme-vars":i(u)},{default:s((()=>{var e;return[d(y,null,{default:s((()=>{var e;return[(null==(e=i(M))?void 0:e.productBasicInfoVO)?(n(),l("div",q,[d(f,null,{default:s((()=>{var e;return[d(c,{title:"产品名称",content:null==(e=i(M))?void 0:e.productBasicInfoVO.productFullName},null,8,["content"])]})),_:1}),i(B).id?(n(),C(f,{key:0,"show-line":!1,title:"投保信息"},{default:s((()=>{var e,a,n,l;return[d(c,{title:"保费",content:i(B).orderAmount+"元"},null,8,["content"]),d(c,{title:"保险期限",content:i(ne)},null,8,["content"]),d(c,{title:"起保日期",content:i(B).commencementTime},null,8,["content"]),d(c,{title:"终保日期",content:i(B).expiryDate},null,8,["content"]),d(c,{title:"保单状态",content:i(E)[i(B).orderStatus]},null,8,["content"]),d(c,{title:"订单编号",content:i(B).orderNo},null,8,["content"]),d(p,{modelValue:i(B).tenantOrderHolder.extInfo.familyAreaCode,"onUpdate:modelValue":t[0]||(t[0]=e=>i(B).tenantOrderHolder.extInfo.familyAreaCode=e),field1:i(B).tenantOrderHolder.extInfo.familyProvinceCode,"onUpdate:field1":t[1]||(t[1]=e=>i(B).tenantOrderHolder.extInfo.familyProvinceCode=e),field2:i(B).tenantOrderHolder.extInfo.familyCityCode,"onUpdate:field2":t[2]||(t[2]=e=>i(B).tenantOrderHolder.extInfo.familyCityCode=e),field3:i(B).tenantOrderHolder.extInfo.familyAreaCode,"onUpdate:field3":t[3]||(t[3]=e=>i(B).tenantOrderHolder.extInfo.familyAreaCode=e),label:"房产所在地",name:"familyProvinceCode","is-link":"","is-view":"",class:"insured-info","data-source":i(D),mapping:{label:"name",value:"code",children:"children"}},null,8,["modelValue","field1","field2","field3","data-source"]),d(c,{title:"详细地址",content:null==(a=null==(e=i(B).tenantOrderHolder)?void 0:e.extInfo)?void 0:a.familyAddress},null,8,["content"]),d(c,{title:"燃气编号",content:null==(l=null==(n=i(B).tenantOrderSubjectList)?void 0:n[0])?void 0:l.subjectNo},null,8,["content"])]})),_:1})):r("",!0),i(A)?(n(),C(g,{key:1,ref:"formRef","title-collection":{HOLDER:"投保人信息",INSURER:"被保人信息",BENEFICIARY:"受益人"},"is-view":!0,"form-info":i(B),"factor-object":i(U),"input-align":"right"},null,8,["form-info","factor-object"])):r("",!0),d(f,{title:"阅读条款合同",class:"file-list-card"},{default:s((()=>[(n(!0),l(m,null,b(i(ae),((e,t)=>(n(),C(h,{key:t,title:e.attachmentName,"is-link":"",onClick:t=>{return a=e.attachmentName,n=e.attachmentList,F.value=!0,void(Z.value={title:a,fileContent:null==n?void 0:n[0]});var a,n}},null,8,["title","onClick"])))),128))])),_:1}),d(f,{title:"客户签名"},{default:s((()=>[o("div",z,[G,d($,{modelValue:i(J),"onUpdate:modelValue":t[4]||(t[4]=e=>v(J)?J.value=e:null)},null,8,["modelValue"])])])),_:1}),o("div",W,[d(T,{shadow:!1,text:"提 交",onClick:ue})])])):r("",!0)]})),_:1}),d(O,{show:i(F),"onUpdate:show":t[6]||(t[6]=e=>v(F)?F.value=e:null),class:"pre-notice-wrap",title:null==(e=i(Z))?void 0:e.title,position:"bottom",style:{height:"600px"}},{default:s((()=>{var e,a,n,l;return[d(I,{content:null==(a=null==(e=i(Z))?void 0:e.fileContent)?void 0:a.attachmentUri,type:null==(l=null==(n=i(Z))?void 0:n.fileContent)?void 0:l.attachmentType},null,8,["content","type"]),o("div",Y,[d(T,{shadow:!1,text:"关闭",onClick:t[5]||(t[5]=e=>F.value=!1)})])]})),_:1},8,["show","title"]),i(Q)&&0!==i(oe).length?(n(),C(V,{key:0,show:i(Q),"onUpdate:show":t[7]||(t[7]=e=>v(Q)?Q.value=e:null),"content-list":i(oe),"is-only-view":i(ee),"active-index":i(te),text:i(ee)?"关闭":"我已逐页阅读上述内容并同意","force-read-cound":0,"on-close-file-preview":"",onSubmit:re,onOnCloseFilePreview:ie,onOnCloseFilePreviewByMask:t[8]||(t[8]=e=>Q.value=!1)},null,8,["show","content-list","is-only-view","active-index","text"])):r("",!0)]})),_:1},8,["theme-vars"])}}});export{Z as default};
