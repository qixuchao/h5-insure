import{m as e,ay as t,r as a,P as o,a0 as i,t as r,C as l,E as n,F as s,U as d,_ as c,a6 as u,a7 as p,ab as f,u as m,o as A,az as v,s as h,v as w,x as y,z as I,J as P,I as O,T as C}from"./vendor-fd650291.js";import{P as b}from"./index-3728ac2a.js";import{B as g,A as x,_ as F,P as j}from"./index-feaf780e.js";import{_ as D,n as V}from"./nextStep-d4a9b01c.js";import{a as k,s as T,c as E}from"./phoneVerify-7c2a1f6d.js";import{_ as B,a8 as U}from"./index-823b7915.js";import{p as _,g as H}from"./product-9ad33e98.js";import{i as N,t as R}from"./trial-46e5d06e.js";import{v as z,f as S}from"./utils-c8bf37a8.js";import{u as L}from"./theme-467ed2f7.js";import"./infoCollection-15d1d038.js";import"./relativeTime-b37e3f29.js";import"./useDicData-31bc5f12.js";import"./useStorage-c84e29a4.js";import"./trial-0f930d31.js";var Z="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFYAAAAeCAMAAACBgxnEAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAA8UExURUdwTPpkAPpkAPpkAPlkAPlkAP9fAPpkAP9jAPljAPljAPlkAPdhAP9VAPhlAPpjAPpiAPpkAPlhAPpkAKrbDd8AAAATdFJOUwCe3XX6YBgzC+yKwSIDTrE+0C9Hm6hZAAAAf0lEQVR42u2MSw6AIAxEi6CCf+j976ommvG3omxMOqv2vczQmZa3tPRMptdZndVZndXZf892/JGOxN68qUEr24/zk84jSvne93fae3Qk3scrjZeWzDcVaNUQIvRDOGkYQOU+hYMmsBJ+cTt1C0gZP7mNTvhL+Zq5xlfOW4tb6le9ZDBDk4RvXwAAAABJRU5ErkJggg==";const J={class:"free-crad"},M={class:"container"},G={class:"title"},Q=["src"],X=(e=>(u("data-v-a8331544"),e=e(),p(),e))((()=>n("span",null,"最后一步 填写信息",-1))),q=["src"];var K=B(e({props:{colors:{type:Array,default:()=>["#CDDFFE","#F1F7FE"]},detail:{type:Object,default:()=>{}},isFirst:{type:Boolean,default:!0},insureDetail:{type:Object,default:()=>{}}},setup(e,{expose:u}){const p=e;t((e=>({"2689eaee":p.colors[0],"2689eab0":p.colors[1]})));const f=a(),m=o({factorObj:{1:[{attributeValues:null,code:"mobile",datasource:null,defaultValue:null,displayType:null,factorId:null,factorScript:null,hasDefaultValue:1,id:8249,isDisplay:1,isHidden:1,isMustInput:2,isReadOnly:null,moduleType:1,placeholder:null,planCode:null,position:null,productCode:"lin23323",productId:null,title:"手机号"},{attributeValues:null,code:"verificationCode",datasource:null,defaultValue:null,displayType:null,factorId:null,factorScript:null,hasDefaultValue:1,id:8249,isDisplay:1,isHidden:1,isMustInput:2,isReadOnly:null,moduleType:1,placeholder:null,planCode:null,position:null,productCode:"lin23323",productId:null,title:"验证码"}],2:[],3:[]},isFirst:!0}),A=async(e,t)=>{const a=p.isFirst?k:T,o=await a(e),{code:i,data:r}=o;"10000"===i&&(null==t||t())};return i((()=>p.isFirst),(()=>{var e;p.isFirst||(m.factorObj=null==(e=p.insureDetail)?void 0:e.productFactor)})),u({validateForm:()=>new Promise(((e,t)=>{f.value.validateForm().then((t=>{e(!0)})).catch((()=>{t()}))}))}),(t,a)=>(r(),l("div",J,[n("div",M,[n("div",G,[n("img",{src:s(Z)},null,8,Q),X,n("img",{src:s(Z)},null,8,q)]),d(D,{ref_key:"formRef",ref:f,"send-sms-code":A,"form-info":e.detail,"factor-object":s(m).factorObj},null,8,["form-info","factor-object"]),c(t.$slots,"default",{},void 0,!0)])]))}}),[["__scopeId","data-v-a8331544"]]);const Y={class:"page-free-product-detail"},$={class:"product-desc"},W={key:0,class:"page-free-footer"};var ee=B(e({setup(e){t((e=>({fd6b5336:s(q).colors[1]})));const i=L(),c=f(),u=m(),{productCode:p="",tenantId:D="",extraInfo:k}=u.query;let T={};try{T=JSON.parse(decodeURIComponent(k))}catch(le){}const{openId:B,indirectCode:Z="123",saleUserId:J="",saleChannelId:M=""}=T;let G="";const Q=a(),X=a(),q=o({colors:["#fff"],detail:{},order:{tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},insuredBeneficiaryType:"1",tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}]}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}},banner:"",productDesc:[],newAuth:!0,isValidateCode:!1,insureDetail:{},loading:!0,showBtn:!1,activeIndex:0,showFilePreview:!1,isOnlyView:!0}),ee=a(),te=async()=>{q.loading=!0;const e=_({productCode:p,withInsureInfo:!0,tenantId:D}),t=N({productCode:p}),a=H({openId:B});await Promise.all([e,t,a]).then((([e,t,a])=>{var o,i,r;if("10000"===e.code){q.detail=e.data,q.banner=null==(o=q.detail.tenantProductInsureVO)?void 0:o.banner[0];const{colorEnd:t,colorStart:a}=(null==(i=q.detail.tenantProductInsureVO)?void 0:i.backgroundInsureVO)||{};q.colors=[a,t],q.productDesc=q.detail.tenantProductInsureVO.spec||[],document.title=q.detail.productFullName||""}"10000"===t.code&&(q.insureDetail=t.data,q.insureDetail.productFactor[1].forEach((e=>{"verificationCode"===e.code&&1===e.isDisplay&&(q.isValidateCode=!0)})),q.insureDetail.productFactor[2]=null==(r=q.insureDetail.productFactor)?void 0:r[2].map((e=>{var t,a;return"relationToHolder"===e.code&&1===e.isDisplay&&(e.title="被保人",q.order.tenantOrderInsuredList[0].relationToHolder=(null==(a=null==(t=e.attributeValueList)?void 0:t[0])?void 0:a.code)||""),e}))),"10000"===a.code&&(q.newAuth=!a.data),(()=>{let e={};if(e=q.detail.tenantProductInsureVO.planInsureVO.attachmentVOList||[],!e)return void(ee.value=[]);const t={2:"richText",3:"link"};ee.value=Object.keys(e).map((a=>(e[a].forEach((e=>{if("1"===e.attachmentType){const t=e.attachmentUri.split("?"),a=t[0].substr(t[0].lastIndexOf(".")+1);e.attachmentType="pdf"===a?"pdf":"picture"}else e.attachmentType=t[e.attachmentType]})),{attachmentName:a,attachmentList:e[a]})))||[]})(),q.loading=!1}))},ae=async()=>{let e={loginType:"2",openId:B,thirdUserType:"XINAO_WECHAT",indirectCode:Z};try{if(q.newAuth?(e.loginName=q.order.tenantOrderHolder.mobile,e.password=q.order.tenantOrderHolder.verificationCode):e=S({order:q.order,tenantId:D,extraInfo:T,detail:q.detail,insureDetail:q.insureDetail,iseeBizNo:G,saleUserId:J,templateId:null==T?void 0:T.templateId,saleChannelId:M,pageCode:"infoCollection",buttonCode:"EVENT_FREE_multiIssuePolicy"}),q.newAuth){const{code:t,data:a}=await R(e);"10000"===t&&(q.newAuth=!1)}else V(e,((e,t)=>{t===U.JUMP_PAGE&&e.orderNo&&c.push(`/baseInsurance/orderDetail?from=free&tenantId=${D}&orderNo=${e.orderNo}&productCode=${p}`)}))}catch(t){}},oe=async()=>await(async()=>{var e;await X.value.validateForm();const t=null==(e=q.order.tenantOrderHolder)?void 0:e.verificationCode;if(!t||!z(t))return C({message:"请输入正确的验证码"}),!1;if(q.newAuth||!q.isValidateCode)return!0;const{code:a,data:o}=await E(q.order.tenantOrderHolder.mobile,t);return!!o})()?(q.newAuth||0===ee.value.length?ae():(q.isOnlyView=!1,q.showFilePreview=!0),!1):null,ie=()=>{q.showFilePreview=!1,q.isOnlyView=!1},re=()=>{q.showFilePreview=!1,q.isOnlyView=!0,ae()};return A((()=>{te(),setTimeout((async()=>{G=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),v(Q,(([{isIntersecting:e}],t)=>{q.showBtn=!e})),(e,t)=>{const a=h("van-image"),o=h("van-config-provider");return r(),w(o,{"theme-vars":s(i)},{default:y((()=>[n("div",Y,[d(g,{url:s(q).banner},null,8,["url"]),d(K,{ref_key:"formRef",ref:X,"is-first":s(q).newAuth,"insure-detail":s(q).insureDetail,detail:s(q).order,colors:s(q).colors},{default:y((()=>[d(b,{ref_key:"root",ref:Q,class:"submit-btn","is-gradient":!1,text:s(q).newAuth?"立即领取":"激活保障",onClick:oe},null,8,["text"]),ee.value&&ee.value.length>0?(r(),w(x,{key:0,"attachement-list":ee.value,"has-bg-color":!1,"pre-text":"请阅读",onPreviewFile:t[0]||(t[0]=e=>(e=>{q.activeIndex=e,q.showFilePreview=!0})(e))},null,8,["attachement-list"])):I("",!0)])),_:1},8,["is-first","insure-detail","detail","colors"]),n("div",$,[(r(!0),l(O,null,P(s(q).productDesc,((e,t)=>(r(),w(a,{key:t,width:"100%","lazy-load":"",src:e,class:""},null,8,["src"])))),128))]),s(q).showBtn?(r(),l("footer",W,[d(b,{"is-gradient":!1,text:s(q).newAuth?"立即领取":"激活保障",onClick:oe},null,8,["text"])])):I("",!0)]),s(q).showFilePreview&&0!==ee.value.length?(r(),w(F,{key:0,show:s(q).showFilePreview,"onUpdate:show":t[1]||(t[1]=e=>s(q).showFilePreview=e),"content-list":ee.value,"is-only-view":s(q).isOnlyView,"active-index":s(q).activeIndex,text:s(q).isOnlyView?"关闭":"我已逐页阅读上述内容并同意","force-read-cound":0,"on-close-file-preview":"",onSubmit:re,onOnCloseFilePreview:ie},null,8,["show","content-list","is-only-view","active-index","text"])):I("",!0),s(q).loading?I("",!0):(r(),w(j,{key:1,"product-detail":s(q).detail},null,8,["product-detail"]))])),_:1},8,["theme-vars"])}}}),[["__scopeId","data-v-7997d3d4"]]);export{ee as default};
