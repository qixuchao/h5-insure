import{d as I}from"./vendor-e88cb016.js";import{I as w,R as _,g as q}from"./infoCollection-2d7dfb8c.js";import{b as k,a as V,R as b,i as E}from"./trial-0b9cd392.js";import{a6 as P,K as u,C as N,J as p,a3 as B}from"./index-47352d37.js";const W=e=>{const{tenantId:t,riskList:n,riskPremium:i,productId:a}=e;return n.map(r=>{var o;return{tenantId:t,amountUnit:1,annuityDrawFrequency:r.annuityDrawDate,annuityDrawType:r.annuityDrawType,paymentFrequency:r.paymentFrequency,paymentPeriod:r.chargePeriod.split("_")[1],paymentPeriodType:k[r.chargePeriod.split("_")[0]],insurancePeriodType:V[r.coveragePeriod==="to_life"?"to_life":r.coveragePeriod.split("_")[0]],insurancePeriodValue:Number.isNaN(+r.coveragePeriod.split("_")[1])?0:r.coveragePeriod.split("_")[1],riskCode:r.riskCode,riskType:r.riskType,riskName:r.riskName,extInfo:{riskId:r.riskId,copy:r.copy},initialPremium:(o=i[r.riskCode])==null?void 0:o.premium,liabilityDetails:r.liabilityVOList.map(d=>({liabilityCode:d.liabilityCode,liabilityName:d.liabilityName,refundMethod:d.liabilityAttributeValue})),productId:a,currentAmount:r.amount,initialAmount:r.amount}})},L=(e,t,n=[],i=q.YEAR,a=!1)=>{const r=e.filter(o=>{try{return o.extraInfo?JSON.parse(o.extraInfo).packageCode?!!n.includes(o.id):!0:!1}catch{return!1}});console.log("lastRiskList",r);const l=r.find(o=>o.riskType===b.MAIN_RISK);return r.map(o=>{const{riskInsureLimitVO:d,riskCategory:s,id:y,riskType:c,riskName:m,riskCode:M,extraInfo:S,riskLiabilityInfoVOList:F,riskCalcMethodInfoVO:Y}=o,{insurancePeriodType:z,insurancePeriodValueList:C,paymentFrequencyList:X,paymentPeriodValueList:O,paymentPeriodType:$,annuityDrawFrequencyList:T,annuityDrawValueList:h,insurancePeriodRule:A,paymentPeriodRule:U}=d,{fixedAmount:x,minCopy:H}=Y,f={amount:x,riskCode:M,riskId:y,riskName:m,paymentFrequency:i,extraInfo:S,chargePeriod:O==null?void 0:O[0],annuityDrawDate:h==null?void 0:h[0],riskType:c,annuityDrawFrequency:T==null?void 0:T[0],copy:H,coveragePeriod:C==null?void 0:C[0],insuredCode:t==null?void 0:t.insurerCode,liabilityVOList:F,riskCategory:s};return c===b.MAIN_RISK?f:(A===E.ONE_YEAR&&(f.coveragePeriod="year_1"),U===E.ONE_YEAR&&(f.chargePeriod="year_1"),{...f,mainRiskId:l==null?void 0:l.id,mainRiskCode:l==null?void 0:l.riskCode})})},ee=e=>{var n,i,a;return{orderAmount:e.premium,tenantId:e.tenantId,venderCode:(n=e.detail)==null?void 0:n.insurerCode,applicationNo:e.applicationNo,policyNo:e.policyNo,orderDataSource:"1",saleUserId:e.saleUserId,saleChannelId:e.saleChannelId,orderCategory:e.orderCategory,orderStatus:e.orderStatus,orderTopStatus:e.orderTopStatus,tenantOrderHolder:{tenantId:e.tenantId,name:e.holder.name,certNo:e.holder.certNo,certType:N.CERT,mobile:e.holder.mobile,birthday:u(e.holder.certNo),gender:p(e.holder.certNo),extInfo:{hasSocialInsurance:e.holder.socialFlag}},extInfo:{extraInfo:{renewalDK:e.renewalDK,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,successJumpUrl:e.successJumpUrl},iseeBizNo:e.iseeBizNo},tenantOrderInsuredList:[{tenantId:e.tenantId,relationToHolder:e.insured.relationToHolder,certNo:e.insured.certNo,certType:N.CERT,name:e.insured.name,mobile:e.insured.relationToHolder===_.SELF?e.holder.mobile:"",birthday:u(e.insured.certNo),gender:p(e.insured.certNo),extInfo:{hasSocialInsurance:e.insured.socialFlag},tenantOrderProductList:[{tenantId:e.tenantId,productCode:(i=e.detail)==null?void 0:i.productCode,productName:(a=e.detail)==null?void 0:a.productName,premium:e.premium,tenantOrderRiskList:e.tenantOrderRiskList}]}]}},D=(e,t)=>{if(!e)return"";const[n,i]=e.split("_"),a=parseInt(i,10);return n==="day"?I(t).add(a,"day").format("YYYY-MM-DD"):I(t).add(a,"year").format("YYYY-MM-DD")},g=(e,t=I().format("YYYY-MM-DD"))=>I(e).diff(t,"day"),v=(e,t,n)=>{const i=D(e,n),a=D(t,n);return g(i)<=1&&g(a)>=0},re=e=>{const{riskCode:t,liabilityCode:n,birth:i,sex:a}=e,r=D("max_18",i);return console.log("lastDate",r),console.log("diffDate(lastDate)",g(r)),!(t==="7Y7"&&n==="FXG086"&&!(a===B.FEMALE&&g(r)<=0))},R=(e,t,n=i=>!0)=>{const i=u(t),a=p(t),r=[];return e.forEach(l=>{const{riskDetailVOList:o}=l,d=o.map(s=>{const{maxHolderAge:y,minHolderAge:c}=s.riskInsureLimitVO;return v(c,y,i)?(s.riskLiabilityInfoVOList=s.riskLiabilityInfoVOList.filter(m=>n({riskCode:s.riskCode,liabilityCode:m.liabilityCode,birth:i,sex:a})),s):null});r.push({riskDetailVOList:d.filter(s=>!!(s&&s.riskLiabilityInfoVOList.length>0))})}),r},te=(e,t=!1,n=i=>!0)=>{var r,l,o;let i=[];if(t)i=L((l=(r=R(P(e.insureDetail.productRiskVoList),e.insured.certNo,n))==null?void 0:r[0])==null?void 0:l.riskDetailVOList,e.productDetail,[],e.paymentFrequency,t);else{const d=R(P(e.insureDetail.productRiskVoList),e.insured.certNo,n);console.log("===result",[...d]),i=d.map(s=>L(s.riskDetailVOList,e.productDetail,e.packageRiskIdList,e.paymentFrequency,t))}return{calcData:{holder:{personVO:{birthday:u(e.holder.certNo),certType:N.CERT,certNo:e.holder.certNo,gender:Number(p(e.holder.certNo)),mobile:e.holder.mobile,name:e.holder.name,socialFlag:e.holder.socialFlag}},insuredVOList:[{insuredCode:(o=e.productDetail)==null?void 0:o.insurerCode,relationToHolder:e.insured.relationToHolder,personVO:{birthday:u(e.insured.certNo),certType:N.CERT,certNo:e.insured.certNo,gender:Number(p(e.insured.certNo)),name:e.insured.name,socialFlag:e.insured.socialFlag},productPlanVOList:[{riskVOList:i.flat()}]}],productCode:e.productDetail.productCode,tenantId:e.tenantId},riskVOList:i.flat()}},ne=e=>e&&e.length?e.filter(n=>n.value===w.INSURE).map(n=>n.productRiskVoList.map(i=>i.id)).flat():[],ie=e=>{let t=(Math.round(parseFloat(e.toString())*100)/100).toString();const n=t.toString().split(".");return n.length===1?(t=`${t.toString()}.00`,t):n.length>1?(n[1].length<2&&(t=`${t.toString()}0`),t):e},ae=(e,t="year")=>I().diff(u(e),t,!0),K=e=>!e||Number.isNaN(+e.split("_")[1])?0:e==null?void 0:e.split("_")[1],J=e=>{const{tenantId:t,riskList:n,riskPremium:i,productId:a}=e;return n.map(r=>{var o,d,s,y,c;return{tenantId:t,amountUnit:1,annuityDrawFrequency:r.annuityDrawDate,annuityDrawType:r.annuityDrawType,paymentFrequency:r.paymentFrequency,paymentPeriod:0,paymentPeriodType:(o=k)==null?void 0:o[r.chargePeriod],insurancePeriodType:V[r.coveragePeriod==="to_life"?"to_life":(s=(d=r.coveragePeriod)==null?void 0:d.split("_"))==null?void 0:s[0]],insurancePeriodValue:K(r.coveragePeriod),riskCode:r.riskCode,riskType:r.riskType,riskName:r.riskName,extInfo:{riskId:r.riskId,copy:r.copy},initialPremium:(y=i[r.riskCode])==null?void 0:y.premium,liabilityDetails:(c=r.liabilityVOList)==null?void 0:c.map(m=>({liabilityCode:m.liabilityCode,liabilityName:m.liabilityName,refundMethod:m.liabilityAttributeValue})),productId:a,currentAmount:r.amount,initialAmount:r.amount}})},oe=e=>{var n,i,a;return console.log(e,"sksksk"),{buttonCode:e.buttonCode,templateId:1,orderAmount:0,tenantId:e.tenantId,venderCode:e.insureDetail.productBasicInfoVO.insurerCode,orderDataSource:"1",saleUserId:e.saleUserId,saleChannelId:e.saleChannelId,orderCategory:"1",tenantOrderHolder:{tenantId:e.tenantId,name:e.order.tenantOrderHolder.name,certNo:e.order.tenantOrderHolder.certNo,certType:e.order.tenantOrderHolder.certEndType,mobile:e.order.tenantOrderHolder.mobile,birthday:u(e.order.tenantOrderHolder.certNo),gender:p(e.order.tenantOrderHolder.certNo)},extInfo:{extraInfo:{renewalDK:e.renewalDK,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,successJumpUrl:e.successJumpUrl},buttonCode:e.buttonCode,iseeBizNo:e.iseeBizNo},tenantOrderInsuredList:[{tenantId:e.tenantId,relationToHolder:e.order.tenantOrderInsuredList[0].relationToHolder,certNo:e.order.tenantOrderInsuredList[0].certNo,certType:e.order.tenantOrderInsuredList[0].certEndType,name:e.order.tenantOrderInsuredList[0].name,mobile:e.order.tenantOrderInsuredList[0].relationToHolder===_.SELF?e.order.tenantOrderHolder.mobile:"",birthday:u(e.order.tenantOrderInsuredList[0].certNo),gender:p(e.order.tenantOrderInsuredList[0].certNo),tenantOrderProductList:[{tenantId:e.tenantId,productCode:(n=e.insureDetail)==null?void 0:n.productBasicInfoVO.productCode,productName:(i=e.insureDetail)==null?void 0:i.productBasicInfoVO.productName,premium:0,tenantOrderRiskList:J({tenantId:e.tenantId,riskList:L(e.insureDetail.productRiskVoList[0].riskDetailVOList,e.detail),riskPremium:{},productId:(a=e.detail)==null?void 0:a.id})}]}],operateOption:{withHolderInfo:!0,withInsuredInfo:!0,withProductInfo:!0}}};export{ee as a,ae as b,ie as c,oe as f,te as g,ne as o,W as t,re as v};
