var ze=Object.defineProperty,Je=Object.defineProperties;var Qe=Object.getOwnPropertyDescriptors;var de=Object.getOwnPropertySymbols;var Xe=Object.prototype.hasOwnProperty,Ze=Object.prototype.propertyIsEnumerable;var me=(I,f,h)=>f in I?ze(I,f,{enumerable:!0,configurable:!0,writable:!0,value:h}):I[f]=h,m=(I,f)=>{for(var h in f||(f={}))Xe.call(f,h)&&me(I,h,f[h]);if(de)for(var h of de(f))Ze.call(f,h)&&me(I,h,f[h]);return I},p=(I,f)=>Je(I,Qe(f));import{g as et,a9 as tt,O as at,E,M as pe,y as Q,T as b,_ as rt,l as ot,h as ut,r as fe,af as nt,j as q,n as he,p as _,m as X,H as st,t as Z,z as k,A as g,J as ve,C as we,k as Fe,F as lt,D as it,X as ct}from"./vendor-505c98f2.js";import{_ as dt,C as De,I as ye,H as mt,a0 as pt,a2 as Ee}from"./index-ccab46db.js";import{a as w}from"./order-26db6dbf.js";import{S as O,R as M,f as ft}from"./infoCollection-192ba138.js";import{p as ge,i as ht,s as vt,g as Ft,a as Dt,u as yt,b as Et}from"./trial-3db49d37.js";import{p as gt}from"./product-2c6affbc.js";import{g as ee,a as Ce,t as Ct,b as Nt}from"./utils-aaab73d4.js";import{t as It}from"./theme-ea709837.js";import{d as Ne,B as _t,D as At,G as Bt,S as wt,H as Tt,P as bt,U as Ot,_ as St,W as Pt,c as K,f as Ie,o as _e,a as W,n as Ae,h as Be}from"./auth-5d8912f9.js";import{_ as Ut}from"./index-28b0971c.js";import"./utils-b6782348.js";import"./trial-df167647.js";import"./index-4b5cfbbb.js";import"./bankCard-0e4ce564.js";import"./phoneVerify-6cb5283d.js";const Ht={key:0},xt={class:"page-internet-product-detail"},kt={class:"info"},Mt={class:"footer-button"},Lt={class:"price"},Rt=we(" \u603B\u4FDD\u8D39"),Vt=et({setup(I){const f=tt(),h=at(),{productCode:L="BWYL2021",tenantId:C,orderNo:S,phoneNo:R,agentCode:V="",saleChannelId:Te,paymentMethod:D,certNo:te,name:ae,pageCode:P,upgradeCode:be,from:re}=h.query;console.log(h.query,"route.query");const G=E(),v=E(),U=E(),T=E(),H=P==="payBack",oe=E(!1),Y=E(!1),x=E(!1),ue=E(0),j=E(!1),z=E(!1),$=E({show:!1,html:""});let J="";const r=pe({holder:{certNo:te,certType:De.CERT,mobile:R,name:ae,socialFlag:O.HAS},insured:{certNo:te,certType:De.CERT,name:ae,socialFlag:O.HAS,relationToHolder:M.SELF},paymentMethod:D,renewalDK:"Y",paymentFrequency:ft.MONTH}),A=E(Ne),N=E(Ne),s=pe({showInsure:!H,canInsure:!1,canUpgrade:!1}),Oe=Q(()=>{var a,t;return((t=(a=v.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(e=>e.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),Se=Q(()=>{var a,t;return((t=(a=v.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(e=>e.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),ne=Q(()=>{if(r.holder.certNo){const a=ee(r.holder.certNo,"year"),t=ye(r.holder.certNo);if(a<18)return b("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E18\u5C81\uFF01"),!1;if(r.insured.certNo&&r.insured.relationToHolder===M.MATE){const e=ye(r.insured.certNo);if(t===e)return b("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(r.insured.certNo){const a=ee(r.holder.certNo,"day"),t=ee(r.holder.certNo,"year");if(r.insured.relationToHolder===M.CHILD&&a<30)return b("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(r.insured.relationToHolder===M.PARENT&&t>=61)return b("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E60\u5C81\uFF01"),!1}return!0}),Pe=()=>{const{holder:{certNo:a,mobile:t,name:e,socialFlag:n},insured:{certNo:o,name:u,socialFlag:i,relationToHolder:c},paymentMethod:F}=r;return mt(o)&&!!i},se=()=>{f.push({path:"/internet/guaranteeUpgrade",query:p(m({},h.query),{tenantId:C,productCode:"BWYL2022",orderNo:S,agentCode:V})})},Ue=()=>{z.value=!1},He=()=>{N.value=A.value},xe=()=>{N.value=p(m({},N.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},ke=async a=>{b.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const t=await yt(a),{code:e}=t;if(e==="10000"){b.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const n=await Et({orderNo:a.orderNo,tenantId:C}),{data:o}=n;n.code==="10000"&&(o.type===2?($.value={show:!0,html:o.paymentUrl},console.log("data.paymentUrl",$.value),ct(()=>{console.log("document.forms",document.forms);const u=document.getElementById("cashierSubmit");u==null||u.addEventListener("submit",i=>{i.preventDefault()}),u==null||u.submit()})):window.location.href=o.paymentUrl)}s.canInsure=!0}catch{s.canInsure=!0}},Me=a=>{var o,u;const t=JSON.parse((u=(o=U.value)==null?void 0:o.productBasicInfoVO)==null?void 0:u.extInfo);let e="";return t.endorsementFlag===1&&(e=`&upgradeCode=${t.endorsementCode}`),`${Ee}/internet/productDetail?tenantId=${C}&productCode=${L}&orderNo=${a}&agentCode=${V}&pageCode=payBack${e}&from=${re||"normal"}`},Le=a=>`${Ee}/internet/payFail?tenantId=${C}&orderNo=${a}&agentCode=${V}&pageCode=payBack&from=${re||"normal"}`,Re=async a=>{const t=Nt({tenantId:C,saleUserId:V,saleChannelId:Te,detail:v.value,insureDetail:U.value,paymentMethod:r.paymentMethod,renewalDK:r.renewalDK,iseeBizNo:J,successJumpUrl:"",premium:T.value,holder:r.holder,insured:r.insured,tenantOrderRiskList:a,orderStatus:"",orderTopStatus:""});try{const e=await vt(t),{code:n,data:o}=e;n==="10000"&&ke(p(m({},t),{orderNo:o.data,extInfo:{extraInfo:{renewalDK:r.renewalDK,paymentMethod:r.paymentMethod,successJumpUrl:Me(o.data),failUrl:Le(o.data)},iseeBizNo:J}}))}catch{s.canInsure=!0}},Ve=async()=>{if(!ne.value)return{};const{calcData:a,riskVOList:t}=Ce({holder:r.holder,insured:r.insured,tenantId:C,paymentFrequency:r.paymentFrequency,productDetail:v.value,insureDetail:U.value},!0),e=await ge(a),{code:n,data:o}=e;return n==="10000"?(T.value=o.premium,{condition:t,data:o}):{}},Ye=a=>{ue.value=a,x.value=!0},$e=()=>new Promise((a,t)=>{var e,n;(n=(e=G.value)==null?void 0:e.validateForm)==null||n.call(e).then(async()=>{var d;if(!ne.value)return;if(!(((d=G.value)==null?void 0:d.isAgreeFile)||oe.value)){Ye(0);return}const{calcData:u,riskVOList:i}=Ce({holder:r.holder,insured:r.insured,tenantId:C,paymentFrequency:r.paymentFrequency,productDetail:v.value,insureDetail:U.value},!0),c=await ge(u),{code:F,data:y}=c;F==="10000"?(T.value=y.premium,a({condition:i,data:y})):t(new Error)}).catch(()=>{s.canInsure=!0})}),le=async()=>{var a;if(H){se();return}s.canInsure=!1;try{const{condition:t,data:e}=await $e(),n={},o=(i=[])=>{(i||[]).forEach(c=>{var F;n[c.riskCode]=c,((F=c.riskPremiumDetailVOList)==null?void 0:F.length)&&o(c.riskPremiumDetailVOList)})};o(e.riskPremiumDetailVOList);const u=Ct({tenantId:C,riskList:t,riskPremium:n,productId:(a=v.value)==null?void 0:a.id});Re(u)}catch{s.canInsure=!0}},qe=a=>{a==="allFalse"?(Y.value=!1,le(),s.canInsure=!0):it.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"})},Ke=()=>{oe.value=!0,x.value=!1,Y.value=!0};rt([()=>r.insured.certNo,()=>r.insured.socialFlag],ot.exports.debounce(()=>{r.insured.certNo&&r.insured.socialFlag&&P!=="payBack"&&Pe()&&Ve()},500),{deep:!0,immediate:!0});const ie=async()=>{var n,o,u,i,c,F,y,d;const a=await Ft({orderNo:S,tenantId:C}),{code:t,data:e}=a;if(t==="10000"){const{tenantOrderHolder:l,tenantOrderInsuredList:B,extInfo:ce}=e;if(!H){Object.assign(r,{holder:{certNo:l.certNo,certType:l.certType,mobile:l.mobile,name:l.name,socialFlag:O.HAS},insured:{certNo:l.certNo,certType:l.certType,name:l.name,socialFlag:O.HAS,relationToHolder:M.SELF},paymentMethod:D,renewalDK:"Y"}),s.canInsure=!0,N.value=Ae,A.value=Ae;return}Object.assign(r,{holder:{certNo:l.certNo,certType:l.certType,mobile:l.mobile,name:l.name,socialFlag:O.HAS},insured:{certNo:B==null?void 0:B[0].certNo,certType:(n=B[0])==null?void 0:n.certType,name:(o=B[0])==null?void 0:o.name,socialFlag:(i=(u=B[0])==null?void 0:u.extInfo)==null?void 0:i.hasSocialInsurance,relationToHolder:(c=B[0])==null?void 0:c.relationToHolder},paymentMethod:ce.extraInfo.paymentMethod,renewalDK:ce.extraInfo.renewalDK||"N"}),T.value=(d=(y=(F=B[0])==null?void 0:F.tenantOrderProductList)==null?void 0:y[0])==null?void 0:d.premium,(e.orderStatus===w.ACCEPT_POLICY||e.orderStatus===w.PAYMENT_SUCCESS)&&(s.canUpgrade=!0,j.value=!1,z.value=!0),e.orderStatus===w.PAYING&&(j.value=!0,setTimeout(()=>{ie()},3*1e3))}},We=async()=>{var n,o,u,i,c,F;console.log("\u77ED\u4FE1\u8FDB\u5165\uFF0C\u5E26\u4E86orderNo, mobile");const a=await Dt({holderPhone:R,orderStatus:[w.PAYING.toUpperCase(),w.TIMEOUT.toUpperCase(),"ACCEPT_POLICY"],productCode:L,tenantId:C}),{code:t,data:e}=a;if(e.orderStatus===w.ACCEPT_POLICY&&(console.log("\u5DF2\u627F\u4FDD\uFF0C\u88AB\u4FDD\u4EBA\u4FE1\u606F\u4E0D\u80FD\u4FEE\u6539"),N.value=p(m({},Be),{paymentDisable:!!D}),A.value=p(m({},Be),{paymentDisable:!!D})),(e.orderStatus===w.PAYING||e.orderStatus===w.TIMEOUT)&&(console.log("\u652F\u4ED8\u4E2D\uFF0C\u8D85\u65F6\u53EF\u4EE5\u4FEE\u6539\u6295\u4FDD\u4EBA\u4FE1\u606F"),N.value=p(m({},W),{paymentDisable:!!D}),A.value=p(m({},W),{paymentDisable:!!D})),t==="10000"&&((n=e==null?void 0:e.tenantOrderHolder)==null?void 0:n.certNo)){s.canInsure=!0;const{tenantOrderHolder:y,tenantOrderInsuredList:d,extInfo:l}=e;Object.assign(r,{holder:{certNo:y.certNo,certType:y.certType,mobile:y.mobile,name:y.name,socialFlag:O.HAS},insured:{certNo:d==null?void 0:d[0].certNo,certType:(o=d[0])==null?void 0:o.certType,name:(u=d[0])==null?void 0:u.name,socialFlag:(c=(i=d[0])==null?void 0:i.extInfo)==null?void 0:c.hasSocialInsurance,relationToHolder:(F=d[0])==null?void 0:F.relationToHolder},paymentMethod:D||l.extraInfo.paymentMethod,renewalDK:l.extraInfo.renewalDK})}else N.value=p(m({},K),{paymentDisable:!!D}),A.value=p(m({},K),{paymentDisable:!!D}),s.canInsure=!0},Ge=async()=>{const a=gt({productCode:L,withInsureInfo:!0,tenantId:C}),t=ht({productCode:L});await Promise.all([a,t]).then(([e,n])=>{var o;e.code==="10000"&&(v.value=e.data,document.title=((o=e.data)==null?void 0:o.productFullName)||""),n.code==="10000"&&(U.value=n.data)}),S?ie():R&&P==="productDetail"&&We()},je=()=>{P==="free"?H?(N.value=p(m({},Ie),{paymentDisable:!!D}),A.value=p(m({},Ie),{paymentDisable:!!D}),s.canInsure=!0):(N.value=p(m({},K),{paymentDisable:!!D}),A.value=p(m({},K),{paymentDisable:!!D}),s.canInsure=!0):H?(N.value=_e,A.value=_e,console.log("\u652F\u4ED8\u5B8C\u6210\u8FDB\u5165")):R||S||(console.log("\u6295\u4FDD\u94FE\u63A5"),N.value=p(m({},W),{paymentFrequencyDisable:!0}),A.value=W,s.canInsure=!0)};return ut(()=>{je(),Ge(),setTimeout(async()=>{J=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(a,t)=>{const e=fe("van-button"),n=fe("van-config-provider"),o=nt("dompurify-html");return q(),he(lt,null,[_(n,{"theme-vars":g(It)},{default:X(()=>{var u,i,c,F,y,d,l;return[$.value.show?st((q(),he("div",Ht,null,512)),[[o,$.value.html]]):Z("",!0),k("div",xt,[k("div",kt,[_(_t,{url:(i=(u=v.value)==null?void 0:u.tenantProductInsureVO)==null?void 0:i.banner[0]},null,8,["url"]),_(At,{"product-name":(c=v.value)==null?void 0:c.productFullName,"product-desc":(y=(F=v.value)==null?void 0:F.showConfigVO)==null?void 0:y.desc},null,8,["product-name","product-desc"])]),_(Bt,{"guarantee-list":(l=(d=v.value)==null?void 0:d.tenantProductInsureVO)==null?void 0:l.titleAndDescVOS},null,8,["guarantee-list"]),_(wt,{detail:v.value},{form:X(()=>[_(Tt,{ref_key:"formRef",ref:G,disable:!g(s).showInsure,"form-auth":N.value,"form-info":g(r),premium:T.value,"product-detail":v.value,payments:[1],"payment-method":[0],onOnReset:He,onOnUpdate:xe},null,8,["disable","form-auth","form-info","premium","product-detail"])]),_:1},8,["detail"]),k("div",Mt,[k("div",Lt,[Rt,k("span",null,"\uFFE5"+ve(g(pt)(T.value))+"/\u6708",1)]),_(e,{type:"primary",class:"right",disabled:!(g(s).canInsure||g(s).canUpgrade),onClick:le},{default:X(()=>[we(ve(g(s).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),g(P)!=="payBack"?(q(),Fe(bt,{key:1,"product-detail":v.value},null,8,["product-detail"])):Z("",!0),_(Ot,{"order-no":g(S),"tenant-id":g(C),"upgrade-code":g(be),"is-show":z.value,onOnConfirm:se,onOnClose:Ue},null,8,["order-no","tenant-id","upgrade-code","is-show"])]}),_:1},8,["theme-vars"]),_(St,{show:Y.value,"onUpdate:show":t[0]||(t[0]=u=>Y.value=u),"content-list":g(Oe),"active-index":0,onOnConfirmHealth:qe},null,8,["show","content-list"]),x.value?(q(),Fe(Ut,{key:0,show:x.value,"onUpdate:show":t[1]||(t[1]=u=>x.value=u),"content-list":g(Se),"active-index":ue.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9",onSubmit:Ke},null,8,["show","content-list","active-index"])):Z("",!0),_(Pt,{"is-show":j.value},null,8,["is-show"])],64)}}});var oa=dt(Vt,[["__scopeId","data-v-d8d47604"]]);export{oa as default};
