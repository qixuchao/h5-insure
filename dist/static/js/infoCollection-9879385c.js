import{d as e,X as a,Y as t,u as o,z as n,r as i,L as l,Z as r,aw as s,T as u,o as d,R as c,b as v,c as p,e as f,w as m,f as O,g as V,h,i as I,a2 as L,j as C,n as y,P as g,p as k,a3 as P,a4 as j,C as _}from"./index-a540e387.js";import{d as R}from"./debounce-eed12388.js";import{P as w,l as x}from"./index-88a78f80.js";import{t as b}from"./ProRenderFormWithCard.vue_vue_type_style_index_0_scoped_true_lang-d3c9cc7e.js";/* empty css              */import"./bankCard-94f04fd1.js";import{_ as F}from"./PayInfo-977c3de3.js";import{u as T,p as E,q as N,g as D,i as S}from"./trial-3ef57907.js";import{I as q,P as A}from"./index-53d3d05c.js";import{P as U,d as K}from"./index-a138e944.js";import{_ as B}from"./TrialButton-ea24a1c8.js";import{n as H}from"./nextStep-c957ab66.js";import{u as M}from"./useAttachment-eef23373.js";import{a as J,q as W}from"./product-de73efdf.js";import{t as $,g as z}from"./utils-ce193452.js";import{u as G}from"./useOrder-fdfcd608.js";import{P as X,B as Y}from"./constants-7afb7c3d.js";import"./infoCollection-dcb48eb6.js";import{o as Q,f as Z}from"./utils-53b99dd0.js";import"./pdfh5-008ca364.js";import"./isObjectLike-a9798079.js";import"./cloneDeep-1de8e9b0.js";import"./_initCloneObject-0663309f.js";import"./index-345a7b08.js";import"./index-ea68046e.js";import"./phoneVerify-92910a0f.js";import"./index-5a7bb1ba.js";import"./core-201e4c36.js";import"./constant-8927d485.js";import"./trial-3e3ac622.js";import"./createProposal-7aa0e153.js";const ee={class:"long-info-collection"},ae=e({__name:"infoCollection",setup(e){const ae=a((()=>t((()=>import("./index-706a13bf.js")),["static/js/index-706a13bf.js","static/css/index-fa4edf2a.css","static/js/index-a540e387.js","static/css/index-f9ad39f9.css","static/js/pdfh5-008ca364.js","static/js/index-5a7bb1ba.js","static/css/index-827a8544.css","static/js/utils-ce193452.js","static/js/infoCollection-dcb48eb6.js","static/js/trial-3e3ac622.js"]))),te=a((()=>t((()=>import("./index-54952e2a.js")),["static/js/index-54952e2a.js","static/css/index-3329e46f.css","static/js/index-a540e387.js","static/css/index-f9ad39f9.css","static/js/pdfh5-008ca364.js"]))),oe=o(),ne=G(),{productCode:ie="",tenantId:le,agentCode:re="",agencyCode:se,saleChannelId:ue,isShare:de,orderNo:ce,extraInfo:ve,insurerCode:pe,preview:fe}=oe.query;let me={};try{me=JSON.parse(decodeURIComponent(ve))}catch(ia){}const Oe=n({isView:!1,personalInfo:{},payInfo:{schema:[],config:[],formData:[]},defaultValue:{},isAutoChange:!1}),Ve=`${window.origin}/baseInsurance/long/phoneVerify${window.location.search}`,he=i({imgUrl:"",desc:"",title:"",link:Ve}),Ie=i(),Le=i(),Ce=i({}),ye=i({}),ge=i([]),ke=i(),Pe=i({}),je=i(!1),_e=i(!1),Re=i(0),we=i(!0),{fileList:xe,mustReadFileCount:be,popupFileList:Fe}=M(Pe,ke),Te=i(!1),Ee=i(!1),Ne=()=>{_e.value=!1,we.value=!0,ge.value.length<1||(je.value=!0)},De=()=>{je.value=!1,_e.value=!1,we.value=!0},Se=i({}),qe=i(!1),Ae=i([{}]),Ue=i(""),Ke=i(0),Be=i(!1),He=i(),Me=i();i();const Je=l((()=>{var e,a;const{insureProductRiskVOList:t}=(null==(a=null==(e=ye.value)?void 0:e.productPlanInsureVOList)?void 0:a[0])||{};return(t||[]).find((e=>e.mainRiskFlag===r.YES))})),We=i(0),$e=i({}),ze=R((()=>{qe.value&&(Se.value.productCode=ie,Se.value.tenantId=le,Ae.value=Ae.value.map((e=>(e=>{var a,t,o,n,i;const l=null==(t=null==(a=Pe.value)?void 0:a.insureProductRiskVOList)?void 0:t.find((a=>e.riskId===a.riskId));if(l&&1!==l.mainRiskFlag){const a=null==(n=(null==(o=Pe.value)?void 0:o.productRiskRelationVOList)||[])?void 0:n.find((e=>e.collocationRiskId===l.riskId));if(a){const t=null==(i=Ae.value)?void 0:i.find((e=>e.riskId===a.riskId));A.forEach((a=>{a.ruleKey&&l.productRiskInsureLimitVO&&t&&(1===l.productRiskInsureLimitVO[a.ruleKey]&&(e[a.valueKey]=t[a.valueKey]),3===l.productRiskInsureLimitVO[a.ruleKey]&&(e[a.valueKey]=K(l,t[a.valueKey],Se.value)))}))}}return e})(e))),Se.value.insuredVOList=Se.value.insuredVOList.map((e=>{var a;return{personVO:e.personVO,productPlanVOList:[{insurerCode:pe,planCode:null==(a=Pe.value)?void 0:a.planCode,riskVOList:Ae.value}]}})),console.log(">>>数据构建<<<",Se.value),Ue.value="试算中...",Ke.value=0,Be.value=!0,T(Se.value).then((({code:e})=>{e===s&&E(Se.value).then((e=>{var a,t,o;if(e.data&&e.code===s){(null==(a=null==e?void 0:e.data)?void 0:a.errorInfo)&&u(`${null==(t=null==e?void 0:e.data)?void 0:t.errorInfo}`),We.value=null==(o=e.data)?void 0:o.premium,Ue.value="",Ke.value=e.data.premium;const n={};e.data.riskPremiumDetailVOList&&e.data.riskPremiumDetailVOList.length&&e.data.riskPremiumDetailVOList.forEach((e=>{n[e.riskCode]={premium:e.premium,amount:e.amount}})),$e.value=n}})).finally((()=>{Be.value=!1}))})))}),300),Ge=["annuityDrawDate","coveragePeriod","chargePeriod"],Xe=e=>{var a,t,o,n,i,l;if(null==(t=null==(a=null==e?void 0:e.data)?void 0:a[0])?void 0:t.productRiskDyInsureFactorVOList){const a=[];if(null==(o=Pe.value)||o.insureProductRiskVOList.forEach((t=>{var o,n;const i=null==(n=null==(o=null==e?void 0:e.data)?void 0:o[0])?void 0:n.productRiskDyInsureFactorVOList.find((e=>e.riskCode===t.riskCode));if(i){t.productRiskInsureLimitVO={...t.productRiskInsureLimitVO,...i};const e=Ae.value.find((e=>e.riskCode===t.riskCode));let o=!0;A.forEach((a=>{if(Ge.indexOf(a.valueKey)>=0){const n=t.productRiskInsureLimitVO[a.configKey];if(n&&e){const t=n.find((t=>t.code===e[a.valueKey]));if(t&&2===t.useFlag){const t=n.find((e=>1===e.defaultFlag));e[a.valueKey]=t.code,o=!0}}}})),o&&a.push({...e,...i,riskCode:t.riskCode})}})),a.length>0&&(null==(l=null==(i=null==(n=Oe.defaultValue)?void 0:n.insuredVOList)?void 0:i[0])?void 0:l.productPlanVOList))return a.forEach((e=>{var a,t,o;Oe.defaultValue.insuredVOList[0].productPlanVOList=null==(o=null==(t=null==(a=Oe.defaultValue)?void 0:a.insuredVOList)?void 0:t[0])?void 0:o.productPlanVOList.map((a=>(a.riskCode===e.riskCode&&(a=e),a)))})),!1}return!0},Ye=async e=>{var a,t;const{holder:o,insuredVOList:n,isFirstInsuredChange:i}=e;if(o&&(Se.value.holder={personVO:{...o.personVO,socialFlag:o.hasSocialInsurance}}),n&&n.length>0&&n.forEach(((e,a)=>{var t;Se.value.insuredVOList&&Se.value.insuredVOList.length>a?Se.value.insuredVOList[a].personVO={...e.personVO,socialFlag:e.personVO.hasSocialInsurance}:((null==(t=Se.value)?void 0:t.insuredVOList)||(Se.value.insuredVOList=[]),Se.value.insuredVOList.push({personVO:{...e.personVO,socialFlag:e.personVO.hasSocialInsurance}}))})),qe.value=!0,console.log("投被保人的信息回传 ",Se.value,e),i){console.log("处理第一被保人修改的dy变化");const e=await N({calcProductFactorList:[{planCode:Pe.value.planCode,productCode:Pe.value.productCode,riskEditVOList:[{insureProductRiskVO:null==(a=Pe.value.insureProductRiskVOList)?void 0:a[0]}]}],...null==(t=null==n?void 0:n[0])?void 0:t.personVO});if(!Xe(e))return}ze()},Qe=async(e,a)=>{var t,o,n,i;if(a){const l=x.exports.cloneDeep(e);delete l.insurancePeriodValueList,delete l.liabilityVOList,delete l.paymentFrequencyList,delete l.paymentPeriodValueList;if(Ge.indexOf(a.key)>=0){const r={};switch(a.key){case"annuityDrawDate":r.changeType=3;break;case"coveragePeriod":r.changeType=2;break;case"chargePeriod":r.changeType=1}const s=null==(o=null==(t=Se.value)?void 0:t.insuredVOList)?void 0:o[0].personVO,u=null==(i=null==(n=Pe.value)?void 0:n.insureProductRiskVOList)?void 0:i.find((a=>a.riskCode===e.riskCode));if(!Oe.isAutoChange){const a=await N({calcProductFactorList:[{planCode:Pe.value.planCode,productCode:Pe.value.productCode,riskEditVOList:[{insureProductRiskVO:u,insureRiskEditReqVO:{riskId:e.riskId,riskCode:e.riskCode,...l,...r}}]}],...s}),t=Xe(a);return t||(Oe.isAutoChange=!0),t}Oe.isAutoChange=!1}}return!0},Ze=async(e,a)=>{He.value=e;await Qe(e,a)&&(Ae.value.length>0&&(Ae.value[0]=e),console.log("标准险种的信息回传",e),ze())},ea=async(e,a)=>{if(Ae.value=[He.value,...e],console.log("附加险列表数据回传",e),a){console.log("-change data = ",a);const t=e.find((e=>e.riskCode===a.riskCode));if(!(await Qe(t,a)))return}ze()},aa=(e={},a={},t={})=>{var o;const n={...t},{tenantOrderHolder:i,tenantOrderInsuredList:l}=Z({holder:null==(o=Oe.personalInfo.holder)?void 0:o.personVO,insuredList:(Oe.personalInfo.insuredVOList||[]).map((e=>e.personVO))}),r={tenantId:le,riskList:Ae.value||[],riskPremium:a,productId:e.id};return n.extInfo.iseeBizNo=Me.value,n.productCode=e.productCode,n.commencementTime=n.insuranceStartDate,n.expiryDate=n.insuranceEndDate,n.premium=We.value,n.orderAmount=We.value,n.orderRealAmount=We.value,n.tenantOrderHolder=i,n.tenantOrderInsuredList=l.map((a=>({...a,certType:a.certType||_.CERT,certNo:(a.certNo||"").toLocaleUpperCase(),planCode:Pe.value.planCode,tenantOrderProductList:[{premium:We.value,productCode:e.productCode,productName:e.productName,planCode:Pe.value.planCode,tenantOrderRiskList:$(r)}]}))),n},ta=async()=>{var e,a,t;fe?y(X.INFO_COLLECTION,oe.query):Te.value?Promise.all([null==(e=Le.value)?void 0:e.validate(!1),null==(t=null==(a=Ie.value)?void 0:a.validate)?void 0:t.call(a)]).then((()=>{Object.assign(ne.value,{extInfo:{...ne.value.extInfo,buttonCode:Y.INFO_COLLECTION,pageCode:X.INFO_COLLECTION}});const e=aa(ye.value,$e.value,ne.value);H(e,((e,a)=>{a===g.JUMP_PAGE&&(console.log("12313"),k(e.nextPageCode,oe.query))}))})):u("请勾选投保人阅读并接受")},oa=e=>{Le.value.validateHolder("mobile").then((()=>{Object.assign(ne.value,{extInfo:{...ne.value.extInfo,buttonCode:Y.INFO_COLLECTION,pageCode:X.INFO_COLLECTION}});const a=aa(ye.value,$e.value,ne.value);H(a,((a,t)=>{t===g.JUMP_PAGE&&(null==e||e())}))})).catch((()=>{u("请录入投保人手机号后进行分享")}))};n({tenantOrderPayInfoList:[]});const na=async()=>{J({productCode:ie,tenantId:le}).then((({data:e,code:a})=>{if("10000"===a){Ce.value=e,document.title=e.BASIC_INFO.title||"";let a={};const{wxShareConfig:t,showWXShare:o}=e.PRODUCT_LIST||{};if(o){const{title:e,desc:n,image:i}=t||{},[l=""]=i||[];a={title:e,desc:n,image:l,isShare:o}}else{const{title:t,desc:n,image:i}=(null==e?void 0:e.PRODUCT_LIST)||{};a={title:t,desc:n,image:i,isShare:o}}P(e.BASIC_INFO.themeType),Object.assign(he.value,a)}})),ce&&D({orderNo:ce,tenantId:le}).then((({code:e,data:a})=>{if("10000"===e){Ke.value=a.orderAmount,Object.assign(ne.value,a,{tenantOrderPayInfoList:a.tenantOrderPayInfoList||[],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0,withPayInfo:!0}}),(()=>{const e={},{tenantOrderHolder:a,tenantOrderInsuredList:t}=ne.value;e.holder={personVO:{...a,...a.extInfo}},e.insuredVOList=(t||[]).map((e=>({personVO:{...e,...e.extInfo,beneficiaryList:e.tenantOrderBeneficiaryList.map((e=>({personVO:e})))}}))),Object.assign(Oe.personalInfo,e)})();const e=Q(a,ye.value,"");Oe.defaultValue=e,Ee.value=!0}})),W({productCode:ie}).then((({code:e,data:a})=>{var t,o,n,i;if("10000"===e){const{productMaterialPlanVOList:e,productQuestionnaireVOList:l}=a;ke.value=e||[];const{basicInfo:{questionnaireType:r},questions:s,questionnaireName:u}=(null==(t=null==l?void 0:l[0])?void 0:t.questionnaireDetailResponseVO)||{basicInfo:{}};r&&(ge.value=2===r?[{attachmentName:u,attachmentUri:s,attachmentType:"question"}]:[{attachmentName:u,attachmentUri:null==(o=null==s?void 0:s[0])?void 0:o.content,attachmentType:z(String(null==(n=null==s?void 0:s[0])?void 0:n.textType),null==(i=null==s?void 0:s[0])?void 0:i.content)}])}})),await S({productCode:ie,isTenant:!fe}).then((({data:e,code:a})=>{var t,o;if("10000"===a){ye.value=e,Pe.value=(null==(t=e.productPlanInsureVOList)?void 0:t[0])||{};const{payInfo:a}=b(null==(o=Pe.value)?void 0:o.productFactor);Oe.payInfo={...Oe.payInfo,...a}}}))};return d((()=>{na()})),c((()=>Oe.personalInfo),((...e)=>{}),{deep:!0,immediate:!0}),(e,a)=>{const t=j,o=v("ProPageWrap");return p(),f(o,null,{default:m((()=>{var e,o,n,i,l,r,s,u,d,c,v,y,g,k,P,j;return[O("div",ee,[(null==(e=V(Pe))?void 0:e.productFactor)?(p(),f(V(w),{key:0,ref_key:"personalInfoRef",ref:Le,modelValue:V(Oe).personalInfo,"onUpdate:modelValue":a[0]||(a[0]=e=>V(Oe).personalInfo=e),"product-factor":null==(o=V(Pe))?void 0:o.productFactor,"multi-insured-config":null==(n=V(Pe))?void 0:n.multiInsuredConfigVO,"is-view":!1,onTrailChange:Ye},null,8,["modelValue","product-factor","multi-insured-config"])):h("",!0),I(q,{ref:"insureInfosRef","origin-data":V(Je),"product-factor":V(Pe).productFactor,"default-value":null==(d=null==(u=null==(s=null==(r=null==(l=null==(i=V(Oe).defaultValue)?void 0:i.insuredVOList)?void 0:l[0])?void 0:r.productPlanVOList)?void 0:s[0])?void 0:u.riskVOList)?void 0:d[0],onTrialChange:Ze},null,8,["origin-data","product-factor","default-value"]),V(Pe).insureProductRiskVOList?(p(),f(U,{key:1,"data-source":V(Pe),"show-main-risk":!1,"default-value":V(Oe).defaultValue&&(null==(k=null==(g=null==(y=null==(v=null==(c=V(Oe).defaultValue)?void 0:c.insuredVOList)?void 0:v[0])?void 0:y.productPlanVOList)?void 0:g[0])?void 0:k.riskVOList)||[],onTrialChange:ea},null,8,["data-source","default-value"])):h("",!0),V(Oe).payInfo.schema.length?(p(),f(V(F),{key:2,ref_key:"payInfoRef",ref:Ie,modelValue:V(ne).tenantOrderPayInfoList,"onUpdate:modelValue":a[1]||(a[1]=e=>V(ne).tenantOrderPayInfoList=e),schema:V(Oe).payInfo.schema,"is-view":V(Oe).isView},null,8,["modelValue","schema","is-view"])):h("",!0),I(t,null,{default:m((()=>{var e;return[(null==(e=V(xe))?void 0:e.length)?(p(),f(V(te),{key:0,modelValue:V(Te),"onUpdate:modelValue":a[2]||(a[2]=e=>L(Te)?Te.value=e:null),"attachment-list":V(xe),"is-show-radio":"","pre-text":"投保人阅读并接受",onPreviewFile:a[3]||(a[3]=e=>(e=>{Re.value=e,_e.value=!0})(e))},null,8,["modelValue","attachment-list"])):h("",!0)]})),_:1}),I(B,{"is-share":V(he).isShare&&!V(de),premium:V(Ke),"share-info":V(he),"loading-text":V(Ue),"payment-frequency":null==(j=null==(P=V(Ae))?void 0:P[0])?void 0:j.paymentFrequency,"tenant-product-detail":V(Ce),"handle-share":oa,onHandleClick:ta},{default:m((()=>[C("下一步")])),_:1},8,["is-share","premium","share-info","loading-text","payment-frequency","tenant-product-detail"]),V(_e)?(p(),f(V(ae),{key:3,show:V(_e),"onUpdate:show":a[4]||(a[4]=e=>L(_e)?_e.value=e:null),"content-list":V(we)?V(xe):V(Fe),"is-only-view":V(we),"active-index":V(Re),text:V(we)?"关闭":"我已逐页阅读并确认告知内容","force-read-count":V(we)?0:V(be),onSubmit:Ne,onOnCloseFilePreviewByMask:De},null,8,["show","content-list","is-only-view","active-index","text","force-read-count"])):h("",!0)])]})),_:1})}}});export{ae as default};
