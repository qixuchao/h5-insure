import{z as e,d as o,N as r,r as t,I as s,v as a,b as i,c as d,W as l,X as u,f as p,e as c,g as n,x as m,i as v,bm as k,Y as f,w as I,Z as L,bn as b,b6 as h,U as P,V as R,a as j,u as y,t as C,o as g,a4 as _,bo as D,ad as O,D as x,as as V,aq as N,a7 as T,B as w}from"./index-3300826d.js";import{A as F}from"./index-f1765c71.js";import{R as q,u as S,P as E,T as U}from"./index-5218a57f.js";import{_ as $}from"./SchemaRenderField.vue_vue_type_style_index_0_scoped_true_lang-fe6cebc4.js";import{_ as A,P as H,a as B}from"./index-aa4b8783.js";/* empty css              */import"./bankCard-07bf592d.js";import{q as K,a as W,b as Y}from"./createProposal-d1e3040e.js";import{q as z}from"./trial-fa78661d.js";import{u as J}from"./useDicData-bdf2d123.js";import"./pdfh5-008ca364.js";import"./index-e8d7649c.js";import"./index-8a71e66b.js";import"./infoCollection-aa0e608b.js";import"./cloneDeep-91e31c47.js";import"./keysIn-3ff85984.js";import"./isObjectLike-a9798079.js";import"./index-99b3573f.js";import"./TrialButton-6ad69654.js";import"./index-3e34be93.js";import"./utils-5bf67951.js";import"./index-34a98020.js";import"./empty-c926d8ec.js";import"./box-title-e323f85f.js";import"./index-193bab3c.js";import"./echarts-ac920fed.js";import"./Table-be8cdc6c.js";import"./useOrder-2c46487b.js";import"./utils-e5bca207.js";import"./trial-28355e02.js";import"./utils-a8052624.js";import"./constants-7afb7c3d.js";import"./nextStep-576c2fe1.js";import"./core-13a4c4c2.js";import"./constant-c3f28a3b.js";import"./pageJump-ce50f880.js";import"./index-aea4611b.js";import"./phoneVerify-2f15fb99.js";import"./debounce-eed12388.js";const M=e=>(P("data-v-ea5c6354"),e=e(),R(),e),X={class:"com-product-list-wrapper"},Z={class:"risk-item-wrapper"},G={class:"content"},Q={class:"risk-premium"},ee={class:"premium"},oe={class:"risk-factor"},re={class:"factor"},te={class:"factor-value"},se=M((()=>p("span",{class:"factor-name"}," 保额(元) ",-1))),ae={class:"factor"},ie={class:"factor-value"},de=M((()=>p("span",{class:"factor-name"}," 保障期间 ",-1))),le={class:"factor"},ue={class:"factor-value"},pe=M((()=>p("span",{class:"factor-name"}," 缴费期间 ",-1))),ce={class:"operate-bar"},ne=M((()=>p("span",{class:"btn-plus"},"+",-1))),me={key:0,class:"premium-total"},ve={class:"premium"};var ke=e(o({__name:"index",props:{productRiskList:{default:()=>[]},productInfo:{default:()=>({})},productData:{default:()=>({})},pickProductPremium:{type:Function,default:()=>{}},productNum:{default:0}},emits:["deleteRisk","updateRisk","addRiderRisk"],setup(e,{emit:o}){const P=e,[R,j]=r(),y=t({checkedList:[],disabledList:[],riderRiskList:[],mainRiskData:{},totalPremium:0,currentRiskRecord:{},productRiskList:[]}),C=J("RISK_PAYMENT_PERIOD"),g=J("RISK_INSURANCE_PERIOD"),_=s((()=>{var e,o;return(null==(o=null==(e=P.productData)?void 0:e.productRiskVoList)?void 0:o[0].riskDetailVOList.filter((e=>1===e.collocationType)))||[]})),D=s((()=>{var e,o;const r=P.productRiskList.map((e=>e.riskId)),t=((null==(o=null==(e=P.productData)?void 0:e.productRiskVoList)?void 0:o[0].riskDetailVOList)||[]).filter((e=>r.includes(e.id)&&1===e.collocationType));return _.value.length-t.length})),O=s((()=>e=>{var o,r;const t=(null==(r=null==(o=P.productData)?void 0:o.productRiskVoList)?void 0:r[0].riskDetailVOList.find((o=>o.id!==e)))||{};let s=!1;return s=!!P.productNum||2===t.riskType&&1===t.collocationType,s})),x=s((()=>{var e,o;return(null==(o=null==(e=P.productData)?void 0:e.productRiskVoList)?void 0:o[0].riskDetailVOList.find((e=>1===e.riskType)))||{}})),V=s((()=>x.value.collocationVOList||[])),N=(e,r)=>{const t=e.map((e=>e.id)).filter((e=>!y.value.disabledList.includes(e)));o("addRiderRisk",t,P.productInfo)};return a((()=>P.productInfo),(e=>{var o;let r=0;(e.proposalProductRiskList||[]).forEach((e=>{r+=e.premium})),null==(o=P.pickProductPremium)||o.call(P,{[`${e.productId}`]:r}),y.value.totalPremium=r}),{deep:!0,immediate:!0}),a((()=>P.productRiskList),(e=>{const o=[],r=[],t=[];(e||[]).forEach((e=>{1===e.riskType?o.unshift(e):(r.push(e.riskId),t.push(e.riskId),o.push(e))})),y.value.disabledList=r,y.value.checkedList=t,y.value.productRiskList=o}),{deep:!0,immediate:!0}),(e,r)=>{var t,s;const a=b,x=h;return i(),d("div",X,[(i(!0),d(l,null,u(v(y).productRiskList,(e=>{var r,t;return i(),d("div",{key:e.riskId},[p("div",Z,[c(a,{"risk-type":e.riskType,title:e.riskName,class:"no-border"},null,8,["risk-type","title"]),p("div",G,[p("div",Q,[n(" 保费:"),p("span",ee,"￥"+m(null==(r=e.premium)?void 0:r.toLocaleString()),1)]),p("div",oe,[p("div",re,[p("span",te,m(null==(t=e.amount)?void 0:t.toLocaleString()),1),se]),p("div",ae,[p("span",ie,m(v(k)(v(g),e.coveragePeriod)),1),de]),p("div",le,[p("span",ue,m(v(k)(v(C),e.chargePeriod)),1),pe])]),p("div",ce,[v(O)(e.riskId)?(i(),f(x,{key:0,round:32,class:"border",onClick:r=>{o("deleteRisk",e,P.productInfo)}},{default:I((()=>[n("删除")])),_:2},1032,["onClick"])):L("",!0),v(D)?(i(),f(x,{key:1,activated:"",round:32,class:"btn-rider-risk",onClick:o=>{return r=e,j(!0),void(y.value.currentRiskRecord=r);var r}},{default:I((()=>[ne,n(" 附加险")])),_:2},1032,["onClick"])):L("",!0),c(x,{activated:"",round:32,onClick:r=>{o("updateRisk",e,P.productInfo)}},{default:I((()=>[n("修改")])),_:2},1032,["onClick"])])])])])})),128)),v(y).productRiskList.length>1?(i(),d("div",me,[n(" 保费: "),p("span",ve,"￥"+m(null==(s=null==(t=v(y))?void 0:t.totalPremium)?void 0:s.toLocaleString()),1)])):L("",!0),v(R)?(i(),f(q,{key:1,modelValue:v(y).checkedList,"onUpdate:modelValue":r[0]||(r[0]=e=>v(y).checkedList=e),show:v(R),disabled:v(y).disabledList,"risk-list":v(_),"collocation-list":v(V),onFinished:N,onClose:r[1]||(r[1]=e=>v(j)(!1))},null,8,["modelValue","show","disabled","risk-list","collocation-list"])):L("",!0)])}}}),[["__scopeId","data-v-ea5c6354"]]);const fe={class:"container"},Ie={class:"operate-bar"},Le={class:"footer-bar"},be={class:"trial-result"},he={class:"result-num"},Pe={class:"trial-operate"},Re=o({name:"createProposal"});var je=e(o({...Re,setup(e){const o=[{name:"保存修改"},{name:"另存为新计划书"}],[k,b]=r(),[P,R]=r(),q=t({proposalHolder:{},proposalInsuredList:[{name:"",gender:"",birthday:"",proposalInsuredProductList:[]}],proposalName:"",totalPremium:0,relationUserType:2}),J=j(),M=y(),X=S(),{id:Z,productCode:G,type:Q="add",isCreateProposal:ee}=M.query,oe=t(null),re=t({productId:0,productCollection:{},productInfo:{},productPremium:{},riderRisk:{},type:"add",currentRisk:[],insuredFormData:{proposalName:""}}),te=C({insuredFormData:{proposalName:""},currentProductCode:""}),se=t();t({}),t([]),s((()=>({min:"",max:""})));const ae=()=>{se.value.validate().then((()=>{Y(q.value).then((e=>{const{code:o,data:r}=e||{};"10000"===o&&(X.$reset(),X.proposalId=r,J.push({path:"/compositionProposal",query:{id:r}}))}))}))},ie=()=>{!Z&&X.proposalId?R(!0):ae()},de=(e,o)=>{o&&(q.value.id=null),ae()},le=s((()=>{var e;return(null==(e=re.value.productCollection)?void 0:e[te.currentProductCode])||{}})),ue=s((()=>{var e,o;return(null==(o=null==(e=le.value)?void 0:e.productPlanInsureVOList)?void 0:o[0])||{}})),pe=async e=>{const{code:o,data:r}=await z({calcProductFactorList:[{productCode:e}]});if("10000"===o&&r){const[{holder:e,insuredVOList:o}={}]=r||[{}],{personVO:t}=(o||[])[0]||{},{age:s,gender:a,birthday:i}=t||{};Object.assign(te.insuredFormData,{age:s,gender:a,birthday:i}),Object.assign(q.value,(({productCode:e,holder:o,insuredVOList:r}={})=>{const{personVO:t,productPlanVOList:s}=(null==r?void 0:r[0])||{};return{proposalHolder:o,proposalInsuredList:[{...t,proposalInsuredProductList:[{productCode:e,productName:re.productName,proposalProductRiskList:s}]}]}})((r||[])[0]))}},ce=(e={})=>{Object.assign(re.value.productPremium,e),q.value.totalPremium=Object.values(re.value.productPremium).reduce(((e,o)=>e+o),0)},ne=(e,o)=>{const r=o;x.confirm({message:"确认删除该险种？"}).then((()=>{1===e.riskType?(q.value.proposalInsuredList[0].proposalInsuredProductList=q.value.proposalInsuredList[0].proposalInsuredProductList.filter((e=>e.productId!==r.productId)),ce({[r.productId]:0})):r.proposalProductRiskList=r.proposalProductRiskList.filter((o=>o.riskId!==e.riskId))}))},me=(e,o)=>{re.value.productId=o.productId,re.value.productInfo=o,re.value.type="edit",re.value.currentRisk=[e.riskId],te.currentProductCode=o.productCode,V((()=>{var e;null==(e=oe.value)||e.open()}))},ve=(e,o)=>{re.value.productId=o.productId,re.value.productInfo=o,re.value.type="addRiderRisk",re.value.currentRisk=e,b(!0)},Re=e=>{q.value.proposalInsuredList[0].proposalInsuredProductList=q.value.proposalInsuredList[0].proposalInsuredProductList.map((o=>{let r=o;return o.productId===e.proposalInsuredList[0].proposalInsuredProductList[0].productId&&(r={...e.proposalInsuredList[0].proposalInsuredProductList[0]}),r})),b(!1)},je=()=>{X.setProposalInfo(q.value),X.setTrialData([]),re.value.productCollection.length&&X.setExcludeProduct(re.value.productCollection.map((e=>e.productCode))),J.push({path:"/proposalList",query:{isCreateProposal:"1",...M.query}})},ye=()=>{b(!1)};return g((()=>{const e=X.$state.trialData,o=X.$state.proposalInfo,r=X.$state.proposalId;Z&&!ee||r?(((e={})=>{K(e).then((({code:e,data:o})=>{"10000"===e&&Object.assign(q.value,o)}))})({id:Z||r}),X.$reset()):!Object.keys(o).length&&e.length?Object.assign(q.value,e[0]):Object.keys(o).length&&e.length?(o.proposalInsuredList[0].proposalInsuredProductList.push(...e[0].proposalInsuredList[0].proposalInsuredProductList),q.value=o):Object.keys(o).length&&!e.length&&(q.value=o),X.setTrialData([]),G&&pe(G)})),a((()=>{var e;return null==(e=q.value.proposalInsuredList[0].proposalInsuredProductList)?void 0:e.length}),(()=>{const e=q.value.proposalInsuredList[0].proposalInsuredProductList.map((e=>({productCode:e.productCode})));W(e).then((({code:e,data:o})=>{"10000"===e&&(re.value.productCollection=N(o)?o.reduce(((e,o)=>(e[o.productCode]=o,e)),{}):{})})).finally((()=>{}))})),(e,r)=>{const t=T,s=h,a=w,b=F,j=_("ProPageWrap");return i(),f(j,{class:"page-create-wrapper"},{default:I((()=>{var e,h,j,y;return[p("div",fe,[c(v($),{modelValue:v(te).insuredFormData.proposalName,"onUpdate:modelValue":r[0]||(r[0]=e=>v(te).insuredFormData.proposalName=e),class:"mb20",label:"计划书名称",name:"proposalName",maxlength:20},null,8,["modelValue"]),c(v(A),{title:"被保人信息",model:v(te).insuredFormData},{default:I((()=>[c(v($),{label:"姓名",name:"name",maxlength:20,required:""}),c(v(H),{label:"出生日期",name:"birthday",required:""}),c(v(B),{label:"性别",name:"gender",columns:v(D),required:""},null,8,["columns"])])),_:1},8,["model"]),(i(!0),d(l,null,u(null==(e=v(q).proposalInsuredList[0])?void 0:e.proposalInsuredProductList,(e=>(i(),f(t,{key:e.productCode,"show-line":!1},{default:I((()=>{var o,r;return[c(ke,{"product-risk-list":e.proposalProductRiskList,"product-info":e,"product-num":(null==(r=null==(o=v(q).proposalInsuredList[0])?void 0:o.proposalInsuredProductList)?void 0:r.length)-1,"product-data":v(re).productCollection[e.productCode],"pick-product-premium":ce,onAddRiderRisk:ve,onUpdateRisk:me,onDeleteRisk:ne},null,8,["product-risk-list","product-info","product-num","product-data"])]})),_:2},1024)))),128)),p("div",Ie,[c(s,{activated:"",round:34,onClick:je},{default:I((()=>[n("添加主险")])),_:1})])]),p("div",Le,[p("span",be,[n("总保费"),p("span",he,"￥"+m(null==(j=null==(h=v(q))?void 0:h.totalPremium)?void 0:j.toLocaleString()),1)]),p("div",Pe,[c(a,{type:"primary",onClick:ie},{default:I((()=>[n("保存并预览")])),_:1})])]),v(k)?(i(),f(E,{key:0,"is-show":v(k),type:v(re).type,"rider-risk":(null==(y=v(re).riderRisk)?void 0:y[v(re).productId])||[],"product-data":v(re).productCollection[v(re).productId],"form-info":v(re).productInfo,holder:v(q).proposalHolder,insured:v(q).proposalInsuredList[0],"current-risk":v(re).currentRisk,onClose:ye,onFinished:Re},null,8,["is-show","type","rider-risk","product-data","form-info","holder","insured","current-risk"])):L("",!0),c(b,{show:v(P),"onUpdate:show":r[1]||(r[1]=e=>O(P)?P.value=e:null),actions:o,"cancel-text":"取消","close-on-click-action":"",onCancel:r[2]||(r[2]=e=>v(R)(!1)),onSelect:de},null,8,["show"]),c(U,{ref_key:"trialPopupRef",ref:oe,"data-source":v(ue),"product-code":v(te).currentProductCode},null,8,["data-source","product-code"])]})),_:1})}}}),[["__scopeId","data-v-0f763ee0"]]);export{je as default};
