import{h as e,a8 as a,N as i,r,L as t,a5 as o,Z as s,o as n,k as l,l as d,m as u,n as c,A as p,y as m,Q as f,s as v,z as k,F as g,E as y,I as C,C as I}from"./vendor-e8ba1bfa.js";import{P,a as V}from"./index-e631e3f6.js";import{i as h,p as L}from"./trial-50622fa0.js";import{c as O}from"./createProposal-e74b33b4.js";import{_ as b,n as R,N as _,b as D,G as T,f as N}from"./index-c1fff0ee.js";import{u as F}from"./useStorage-2c6e4f72.js";import{b as B,a as j}from"./trial-cf16a3ca.js";import"./useDicData-a7d0474e.js";const A={key:0,class:"part-card"},w={key:1,class:"part-card"},x={class:"risk-content"},E={key:0,class:"risk"},S={key:1,class:"plan-risk"},q={class:"footer-bar van-safe-area-bottom"},U={class:"trial-result"},M=I("总保费"),z={class:"result-num"},H={class:"trial-operate"},J={key:0,class:"retrial-tip"},K=I(" 条件更改后，需要重新试算 "),Y=I("去试算"),G=I("立即投保");var Q=b(e({setup(e){var I;const b=a(),Q=i(),{agentCode:W="test",agencyCode:Z="",tenantId:X=9991000007,insurerCode:$="99",proposalId:ee,saleChannelId:ae}=Q.query;let{productCode:ie="MMBBSF",templateId:re=1}=Q.query;const te=r({personVO:{occupationCodeList:[]}}),oe=r({insuredCode:"",personVO:{occupationCodeList:[]}}),se=r({}),ne=r({}),le=r({}),de=r(null),ue=r({}),ce=t({currentPlan:"",riskBaseInfo:{},holderFactor:[],insuredFactor:[],riskData:[],riskPlanData:[],trialResult:{},canTrial:!0,retrialTip:!1,enumList:{},ageRange:[],collapseName:["1"],insuredRiskList:[],currentRiskList:[]});ee&&(ie=null==(I=Q.query||{})?void 0:I.productCenterCode),o("premium",ue.value),F().get("userInfo");const pe=()=>{ce.retrialTip=!1},me=()=>{R({agencyId:Z,saleUserId:W,saleChannelId:ae,tenantId:X,venderCode:ce.riskBaseInfo.insurerCode,orderDataSource:1,proposalId:ee,extInfo:{templateId:+(re||1),pageCode:"premiumTrial",iseeBizNo:window.iseeBiz,buttonCode:_.premiumTrial},tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{extInfo:{},tenantOrderProductList:[{productCode:ce.riskBaseInfo.productCode||"",productName:ce.riskBaseInfo.productName||"",premium:ce.trialResult.premium||0,tenantOrderRiskList:ce.insuredRiskList}]}]}).then((({code:e,data:a})=>{"10000"===e&&"jumpToPage"===a.pageAction.pageAction&&b.push({path:D[a.pageAction.data.nextPageCode],query:{insurerCode:ce.riskBaseInfo.insurerCode,templateId:re,...Q.query,productCategory:ce.riskBaseInfo.productCategory,orderNo:a.pageAction.data.orderNo}})}))},fe=()=>{const e=JSON.parse(JSON.stringify(se.value[ce.currentPlan])),a=Object.values(e).find((e=>1===e.riskType)),i=Object.values(e).map((e=>{const i=e;return((e,a)=>{var i,r,t,o;const s=e;if("3"===s.chargePeriod){const e=(a.chargePeriod||"").split("_");if(e[1]-=1,1===s.exemptFlag){if("to"===e[0]){let a=0;1===s.exemptType?(null==(i=te.value.personVO)?void 0:i.birthday)&&(a=parseInt(""+(+new Date-new Date(null==(r=te.value.personVO)?void 0:r.birthday))/31536e6,10)):2===s.exemptType&&(null==(t=oe.value.personVO)?void 0:t.birthday)&&(a=parseInt(""+(+new Date-new Date(null==(o=oe.value.personVO)?void 0:o.birthday))/31536e6,10)),e[1]=e[1]-a}e[0]="year",s.coveragePeriod=e.join("_")}s.chargePeriod=e.join("_")}})(i,a),i.liabilityVOList=(i.liabilityVOList||[]).filter((e=>1===e.optionalFlag||e.liabilityAttributeValue&&"-1"!==e.liabilityAttributeValue)).map((e=>{const a=e;return"0"===a.liabilityAttributeValue&&(a.liabilityAttributeValue=""),a})),i})),r={holder:te.value,productCode:ce.riskBaseInfo.productCode,insuredVOList:[{...oe.value,productPlanVOList:[{planCode:ce.currentPlan||"",insurerCode:ce.riskBaseInfo.insurerCode,riskVOList:i}]}]};L({...r}).then((({code:e,data:a})=>{if("10000"===e){ce.retrialTip=!1,ce.trialResult=a,ce.canTrial=!1;const e={},i=(a=[])=>{(a||[]).forEach((a=>{var r;e[a.riskCode]=a,(null==(r=a.riskPremiumDetailVOList)?void 0:r.length)&&i(a.riskPremiumDetailVOList)}))};i(a.riskPremiumDetailVOList),((e,a)=>{ce.insuredRiskList=e.map((e=>{var i,r;return{initialAmount:null==(i=a[e.riskCode])?void 0:i.amount,amountUnit:1,annuityDrawFrequency:e.annuityDrawDate,annuityDrawType:e.annuityDrawType,paymentFrequency:e.paymentFrequency,paymentPeriod:e.chargePeriod.split("_")[1],paymentPeriodType:B[e.chargePeriod.split("_")[0]],insurancePeriodType:j["to_life"===e.coveragePeriod?"to_life":e.coveragePeriod.split("_")[0]],insurancePeriodValue:Number.isNaN(+e.coveragePeriod.split("_")[1])?0:e.coveragePeriod.split("_")[1],riskCode:e.riskCode,riskType:e.riskType,riskName:e.riskName,extInfo:{riskId:e.riskId,copy:e.copy},initialPremium:null==(r=a[e.riskCode])?void 0:r.premium,liabilityDetails:e.liabilityVOList.map((e=>({liabilityCode:e.liabilityCode,liabilityName:e.liabilityName,refundMethod:e.liabilityAttributeValue}))),productId:ce.riskBaseInfo.id}}))})(r.insuredVOList[0].productPlanVOList[0].riskVOList,e),Object.assign(ue.value,e)}}))},ve=()=>{var e,a,i,r,t;Promise.all([null==(a=null==(e=ne.value)?void 0:e.validateForm)?void 0:a.call(e),null==(r=null==(i=le.value)?void 0:i.validateForm)?void 0:r.call(i),null==(t=de.value)?void 0:t.validate()]).then((()=>{fe()}),(e=>{var a;(null==e?void 0:e.length)&&(null==(a=null==de?void 0:de.value)||a.scrollToField(e[0].name))}))},ke=()=>{h({productCode:ie,source:ee?2:1}).then((({code:e,data:a})=>{var i,r,t,o;"10000"===e&&(ce.riskBaseInfo=a.productBasicInfoVO,(a.productRelationPlanVOList.length?a.productRelationPlanVOList:a.productRiskVoList[0].riskDetailVOList||[]).forEach(((e,a)=>{0===a&&(ce.currentPlan=e.planCode||"0"),ee||Object.assign(se.value,{[e.planCode||a]:{}})})),ee&&(t=ce.riskBaseInfo.productCategory,o=ce.riskBaseInfo.insurerCode,N({productCategory:t,venderCode:o}).then((e=>{var a;"10000"===e.code&&(re=null==(a=e.data)?void 0:a.id)}))),ce.riskData=(null==(i=a.productRiskVoList[0])?void 0:i.riskDetailVOList)||[],ce.riskPlanData=a.productRelationPlanVOList||[],ee&&(r=a.productBasicInfoVO.id,O({id:ee,tenantId:X}).then((({code:e,data:a})=>{var i;if("10000"===e){const{proposalInsuredProductList:e=[],...t}=(null==(i=a.proposalInsuredList)?void 0:i[0])||{};Object.assign(te.value.personVO,a.proposalHolder);const o=e.find((e=>e.productId===r));Object.assign(oe.value.personVO,t,{occupationCodeList:(null==o?void 0:o.occupationCodeList)||[]});const s={};((null==o?void 0:o.proposalProductRiskList)||[]).forEach((e=>{s[e.riskId]=e})),Object.assign(se.value,{0:s})}}))))})).finally((()=>{}))},ge=e=>{ce.holderFactor=e.holderFactorList,ce.insuredFactor=e.insuredFactorList,ce.ageRange=e.ageRange};return s([()=>se.value,()=>te.value,()=>oe.value],(e=>{e&&!ce.canTrial&&(ce.canTrial=!0,ce.retrialTip=!0)}),{deep:!0}),n((()=>{ke(),T({dictCodeList:["RISK_PAYMENT_PERIOD","RISK_INSURANCE_PERIOD"]}).then((({code:e,data:a})=>{if("10000"===e){const e={};a.forEach((a=>{e[a.dictCode]=a.dictItemList})),ce.enumList=e}}))})),(e,a)=>{const i=l("ProTitle"),r=l("VanForm"),t=l("ProTabButton"),o=l("VanTab"),s=l("VanTabs"),n=l("van-collapse-item"),I=l("van-collapse"),h=l("VanButton"),L=l("ProPageWrap");return d(),u(L,{class:"page-trial-wrapper"},{default:c((()=>{var e,l,L;return[p(ce).holderFactor.length?(d(),m("div",A,[f(i,{title:"投保人"}),f(P,{ref_key:"holderRef",ref:ne,"insured-code":null==(e=p(ce).riskBaseInfo)?void 0:e.insurerCode,"form-info":te.value.personVO,"factor-list":p(ce).holderFactor,"age-range":p(ce).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):v("",!0),p(ce).insuredFactor.length?(d(),m("div",w,[f(i,{title:"被保人"}),f(P,{ref_key:"insuredRef",ref:le,"insured-code":null==(l=p(ce).riskBaseInfo)?void 0:l.insurerCode,"form-info":oe.value.personVO,"factor-list":p(ce).insuredFactor,"age-range":p(ce).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):v("",!0),k("div",x,[f(I,{modelValue:p(ce).collapseName,"onUpdate:modelValue":a[1]||(a[1]=e=>p(ce).collapseName=e)},{default:c((()=>[f(n,{name:"1"},{title:c((()=>[f(i,{title:"投保方案"})])),default:c((()=>[p(ce).riskData.length&&se.value[0]?(d(),m("div",E,[f(r,{ref_key:"riskFormRef",ref:de,"input-align":"right","error-message-align":"right"},{default:c((()=>[f(V,{"risk-info":se.value[0],enums:p(ce).enumList,"origin-data":p(ce).riskData,"pick-factor":ge},null,8,["risk-info","enums","origin-data"])])),_:1},512)])):v("",!0),p(ce).riskPlanData.length?(d(),m("div",S,[f(r,{ref_key:"riskFormRef",ref:de,"input-align":"right","error-message-align":"right"},{default:c((()=>[f(s,{active:p(ce).currentPlan,"onUpdate:active":a[0]||(a[0]=e=>p(ce).currentPlan=e)},{default:c((()=>[(d(!0),m(g,null,y(p(ce).riskPlanData,(e=>(d(),u(o,{key:e.planCode,name:e.planCode,title:e.planName},{title:c((()=>[f(t,{title:e.planName,active:p(ce).currentPlan===e.planCode},null,8,["title","active"])])),default:c((()=>{var a;return[e.planCode===p(ce).currentPlan?(d(),u(V,{key:0,"risk-info":se.value[e.planCode],enums:p(ce).enumList,"origin-data":null==(a=e.productRiskVoList)?void 0:a[0].riskDetailVOList,"pick-factor":ge},null,8,["risk-info","enums","origin-data"])):v("",!0)]})),_:2},1032,["name","title"])))),128))])),_:1},8,["active"])])),_:1},512)])):v("",!0)])),_:1})])),_:1},8,["modelValue"])]),k("div",q,[k("span",U,[M,k("span",z,C((p(ce).retrialTip?0:(null==(L=p(ce).trialResult)?void 0:L.premium)||0).toLocaleString("hanidec",{style:"currency",currency:"CNY"})),1)]),k("div",H,[p(ce).retrialTip?(d(),m("div",J,[K,k("span",{class:"close-icon",onClick:pe})])):v("",!0),p(ce).canTrial?(d(),u(h,{key:1,type:"primary",onClick:ve},{default:c((()=>[Y])),_:1})):(d(),u(h,{key:2,type:"primary",onClick:me},{default:c((()=>[G])),_:1}))])])]})),_:1})}}}),[["__scopeId","data-v-67d6b9f9"]]);export{Q as default};
