var la=Object.defineProperty,ia=Object.defineProperties;var ca=Object.getOwnPropertyDescriptors;var Ee=Object.getOwnPropertySymbols;var da=Object.prototype.hasOwnProperty,ma=Object.prototype.propertyIsEnumerable;var De=(D,d,v)=>d in D?la(D,d,{enumerable:!0,configurable:!0,writable:!0,value:v}):D[d]=v,b=(D,d)=>{for(var v in d||(d={}))da.call(d,v)&&De(D,v,d[v]);if(Ee)for(var v of Ee(d))ma.call(d,v)&&De(D,v,d[v]);return D},L=(D,d)=>ia(D,ca(d));import{g as fa,a9 as pa,O as va,E as c,M as ge,y as Ce,_ as Ne,l as ha,h as ya,r as j,af as Fa,j as k,n as X,p as g,m as Q,H as Ea,t as Z,z as q,A as f,J as Y,k as ee,C as be,F as Da,T as p,D as ga,X as Ca}from"./vendor-17026bfd.js";import{_ as Na,C as Ie,a1 as Ia,I as _a,a4 as _e,J as Be}from"./index-f1d83edb.js";import{a as ae}from"./order-bedb564c.js";import{S as $,R as I,f as we,I as te}from"./infoCollection-c0abe585.js";import{p as Ae,i as Ba,u as wa,a as Aa,s as ka,g as Ta}from"./trial-f9916438.js";import{p as Pa}from"./product-25e36ec0.js";import{a as ke,o as Te,t as Sa,v as re,g as Pe,b as Oa,j as Se}from"./utils-4fba8c75.js";import{t as Ua}from"./theme-ea709837.js";import{d as Oe,B as ba,D as La,G as Ha,S as Ra,H as xa,P as Ma,U as Va,_ as qa,W as Ya,a as Ue}from"./auth-df51fe1a.js";import{_ as $a}from"./index-25d55b40.js";import"./trial-cb7b01d0.js";import"./index-e45e61e6.js";import"./bankCard-9629db99.js";import"./phoneVerify-b3ee4c41.js";const Ka={key:0},Wa={class:"page-internet-product-detail"},za={class:"info"},Ga={class:"footer-button"},Ja={class:"price"},ja=be(" \u603B\u4FDD\u8D39"),Xa={key:0},Qa=fa({setup(D){const d=pa(),v=va(),{productCode:oe="BWYL2021",tenantId:E,orderNo:_,phoneNo:Le,agentCode:H="",saleChannelId:He,paymentMethod:Re,certNo:ue,name:ne,pageCode:xe,from:Me}=v.query,se=c(),m=c(),R=c(),h=c(),K=xe==="payBack";c(!1);const B=c(!1),C=c(!1),le=c(0),W=c(!1),z=c(!1),x=c({show:!1,html:""}),T=c({}),ie=c(),G=c(!1);let J="";const e=ge({holder:{certNo:ue,certType:Ie.CERT,mobile:Le,name:ne,socialFlag:$.HAS},insured:{certNo:ue,certType:Ie.CERT,name:ne,socialFlag:$.HAS,relationToHolder:I.SELF},paymentMethod:Re,renewalDK:"Y",paymentFrequency:we.YEAR,packageProductList:[],mobileSmsCode:""}),ce=c(Oe),P=c(Oe),l=ge({showInsure:!K,canInsure:!1,canUpgrade:!1}),Ve=Ce(()=>{var t,a;return((a=(t=m.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:a.attachmentVOList.filter(r=>r.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),qe=Ce(()=>{var t,a;return((a=(t=m.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:a.attachmentVOList.filter(r=>r.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),Ye=()=>{if(e.holder.certNo){const t=Be(e.holder.certNo);if(re(e.holder.certNo,18,"year"))return p("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E18\u5C81\uFF01"),!1;if(e.insured.certNo&&e.insured.relationToHolder===I.MATE){const a=Be(e.insured.certNo);if(t===a)return p("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(e.insured.certNo){if(e.insured.relationToHolder===I.CHILD&&re(e.insured.certNo,30,"day"))return p("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(e.insured.relationToHolder===I.PARENT&&!re(e.insured.certNo,71,"year"))return p("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E70\u5C81\uFF01"),!1}if([I.CHILD,I.PARENT].includes(e.insured.relationToHolder)){const t=Pe(e.holder.certNo,"year"),a=Pe(e.insured.certNo,"year");if(e.insured.relationToHolder===I.CHILD&&t-a<18)return p("\u6295\u4FDD\u4EBA\u548C\u5B50\u5973\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1;if(e.insured.relationToHolder===I.PARENT&&a-t<18)return p("\u6295\u4FDD\u4EBA\u548C\u7236\u6BCD\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1}return!0},$e=()=>{const{holder:{certNo:t,mobile:a,name:r,socialFlag:u},insured:{certNo:o,name:n,socialFlag:s,relationToHolder:y},paymentMethod:F}=e;return!!(_a(o)&&!!s)},de=()=>{d.push({path:"/internet/guaranteeUpgrade",query:L(b({},v.query),{tenantId:E,productCode:"BWYL2022",orderNo:_,agentCode:H})})},Ke=()=>{z.value=!1},We=()=>{P.value=ce.value},ze=()=>{P.value=L(b({},P.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},Ge=async t=>{p.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0,duration:0});try{const a=await wa(t),{code:r}=a;if(r==="10000"){const u=await Aa({orderNo:t.orderNo,tenantId:E}),{data:o}=u;u.code==="10000"&&(o.type===2?(x.value={show:!0,html:o.paymentUrl},console.log("data.paymentUrl",x.value),Ca(()=>{console.log("document.forms",document.forms);const n=document.getElementById("cashierSubmit");n==null||n.addEventListener("submit",s=>{s.preventDefault()}),n==null||n.submit()})):window.location.href=o.paymentUrl)}l.canInsure=!0}catch{l.canInsure=!0}finally{p.clear()}},Je=t=>`${_e}/pay?orderNo=${t}&saleUserId=${H}&tenantId=${E}`,je=t=>`${_e}/internet/payFail?tenantId=${E}&orderNo=${t}&agentCode=${H}&pageCode=payBack&from=${Me||"normal"}`,Xe=t=>{le.value=t,C.value=!0},Qe=async t=>{const a=Oa({tenantId:E,saleUserId:H,saleChannelId:He,detail:m.value,insureDetail:R.value,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,renewalDK:e.renewalDK,iseeBizNo:J,successJumpUrl:"",premium:h.value,holder:e.holder,insured:e.insured,tenantOrderRiskList:t,orderStatus:"",orderTopStatus:"",orderNo:_,id:ie.value});try{const r=await ka(a),{code:u,data:o}=r;C.value=!1,B.value=!1,u==="10000"&&(p.clear(),delete a.id,T.value={orderNo:o.data,order:a},C.value=!0,Xe(0))}catch{p.clear(),l.canInsure=!0}},Ze=async()=>{const{calcData:t,riskVOList:a}=ke({holder:e.holder,insured:e.insured,tenantId:E,productDetail:m.value,insureDetail:R.value,paymentFrequency:e.paymentFrequency,packageRiskIdList:Te(e.packageProductList)},!1,Se);if(!Array.isArray(a)||a.length<1)return p("\u88AB\u4FDD\u4EBA\u5E74\u9F84\u9700\u572830\u5929(\u542B) - 70\u5C81(\u542B)\u4E4B\u95F4\uFF01"),h.value=null,{};G.value=!0;const r=await Ae(t);G.value=!1;const{code:u,data:o}=r;return u==="10000"?e.insured.certNo?(h.value=o.premium,{condition:a,data:o}):(h.value=null,{condition:a,data:o}):(h.value=null,{})},ea=()=>new Promise((t,a)=>{var r,u;(u=(r=se.value)==null?void 0:r.validateForm)==null||u.call(r).then(async()=>{if(!Ye()){l.canInsure=!0;return}const{calcData:o,riskVOList:n}=ke({holder:e.holder,insured:e.insured,tenantId:E,productDetail:m.value,insureDetail:R.value,paymentFrequency:e.paymentFrequency,packageRiskIdList:Te(e.packageProductList)},!1,Se);(!Array.isArray(n)||n.length<1)&&(p("\u88AB\u4FDD\u4EBA\u5E74\u9F84\u9700\u572830\u5929(\u542B) - 70\u5C81(\u542B)\u4E4B\u95F4\uFF01"),h.value=null,a(new Error));const s=await Ae(o),{code:y,data:F}=s;y==="10000"?(h.value=F.premium,t({condition:n,data:F})):(h.value=null,a(new Error))}).catch(()=>{l.canInsure=!0})}),aa=async()=>{var t;if(K){de();return}try{p.loading({message:"\u8BA2\u5355\u751F\u6210\u4E2D...",forbidClick:!0,duration:0});const{condition:a,data:r}=await ea(),u={},o=(s=[])=>{(s||[]).forEach(y=>{var F;u[y.riskCode]=y,((F=y.riskPremiumDetailVOList)==null?void 0:F.length)&&o(y.riskPremiumDetailVOList)})};o(r.riskPremiumDetailVOList);const n=Sa({tenantId:E,riskList:a,riskPremium:u,productId:(t=m.value)==null?void 0:t.id});Qe(n)}catch{l.canInsure=!0}finally{p.clear()}},ta=t=>{t==="allFalse"?(B.value=!1,l.canInsure=!0,Ge(L(b({},T.value.order),{orderNo:T.value.orderNo,extInfo:{extraInfo:{renewalDK:e.renewalDK,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,successJumpUrl:Je(T.value.orderNo),failUrl:je(T.value.orderNo)},iseeBizNo:J}}))):ga.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"}).then(()=>{window.history.back()}).catch(()=>{l.canInsure=!0})},me=()=>{C.value=!1,B.value=!1,l.canInsure=!0},ra=()=>{C.value=!1,B.value=!0};Ne([()=>e.insured.certNo,()=>e.insured.socialFlag,()=>e.packageProductList,()=>e.paymentFrequency],ha.exports.debounce(()=>{e.insured.certNo&&e.insured.socialFlag&&$e()&&Ze()},500),{deep:!0,immediate:!0}),Ne(()=>e.insured.certNo,()=>{e.insured.certNo||(h.value=null)});const fe=async()=>{var u,o,n,s,y,F,w,S,O,U,pe,ve,he,ye,Fe;const t=await Ta({orderNo:_,tenantId:E}),{code:a,data:r}=t;if(a==="10000"){const{id:na,tenantOrderHolder:N,tenantOrderInsuredList:i,extInfo:A}=r;if(ie.value=na,!K){const sa=(((o=(u=i[0])==null?void 0:u.tenantOrderProductList[0])==null?void 0:o.tenantOrderRiskList)||[]).map(M=>{var V;return((V=M.extInfo)==null?void 0:V.riskId)||""});e.packageProductList.forEach(M=>{M.value=M.productRiskVoList.filter(V=>sa.includes(V.id)).length>0?te.INSURE:te.UN_INSURE}),Object.assign(e,{holder:{certNo:N.certNo,certType:N.certType,mobile:N.mobile,name:N.name,socialFlag:$.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(n=i[0])==null?void 0:n.certType,name:(s=i[0])==null?void 0:s.name,socialFlag:(F=(y=i[0])==null?void 0:y.extInfo)==null?void 0:F.hasSocialInsurance,relationToHolder:(w=i[0])==null?void 0:w.relationToHolder},paymentMethod:A.extraInfo.paymentMethod,paymentFrequency:A.extraInfo.paymentFrequency,renewalDK:A.extraInfo.renewalDK||"N"}),l.canInsure=!0;return}Object.assign(e,{holder:{certNo:N.certNo,certType:N.certType,mobile:N.mobile,name:N.name,socialFlag:$.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(S=i[0])==null?void 0:S.certType,name:(O=i[0])==null?void 0:O.name,socialFlag:(pe=(U=i[0])==null?void 0:U.extInfo)==null?void 0:pe.hasSocialInsurance,relationToHolder:(ve=i[0])==null?void 0:ve.relationToHolder},paymentMethod:A.extraInfo.paymentMethod,paymentFrequency:A.extraInfo.paymentFrequency,renewalDK:A.extraInfo.renewalDK||"N"}),h.value=(Fe=(ye=(he=i[0])==null?void 0:he.tenantOrderProductList)==null?void 0:ye[0])==null?void 0:Fe.premium,(r.orderStatus===ae.ACCEPT_POLICY||r.orderStatus===ae.PAYMENT_SUCCESS)&&(l.canUpgrade=!0,W.value=!1,z.value=!0),r.orderStatus===ae.PAYING&&(W.value=!0,setTimeout(()=>{fe()},3*1e3))}},oa=async()=>{const t=Pa({productCode:oe,withInsureInfo:!0,tenantId:E}),a=Ba({productCode:oe});await Promise.all([t,a]).then(([r,u])=>{var o,n;r.code==="10000"&&(m.value=r.data,document.title=((o=r.data)==null?void 0:o.productFullName)||""),u.code==="10000"&&(e.packageProductList=(((n=u.data)==null?void 0:n.packageProductVOList)||[]).map(s=>L(b({},s),{value:te.UN_INSURE,disabled:!1})),R.value=u.data)}),_&&fe()},ua=()=>{console.log("\u6295\u4FDD\u94FE\u63A5"),P.value=Ue,ce.value=Ue,l.canInsure=!0};return ya(()=>{ua(),oa(),setTimeout(async()=>{J=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(t,a)=>{const r=j("van-loading"),u=j("van-button"),o=j("van-config-provider"),n=Fa("dompurify-html");return k(),X(Da,null,[g(o,{"theme-vars":f(Ua)},{default:Q(()=>{var s,y,F,w,S,O,U;return[x.value.show?Ea((k(),X("div",Ka,null,512)),[[n,x.value.html]]):Z("",!0),q("div",Wa,[q("div",za,[g(ba,{url:(y=(s=m.value)==null?void 0:s.tenantProductInsureVO)==null?void 0:y.banner[0]},null,8,["url"]),g(La,{"product-name":(F=m.value)==null?void 0:F.productFullName,"product-desc":(S=(w=m.value)==null?void 0:w.showConfigVO)==null?void 0:S.desc},null,8,["product-name","product-desc"])]),g(Ha,{"show-service-config":"","guarantee-list":(U=(O=m.value)==null?void 0:O.tenantProductInsureVO)==null?void 0:U.titleAndDescVOS},null,8,["guarantee-list"]),g(Ra,{detail:m.value},{form:Q(()=>[g(xa,{ref_key:"formRef",ref:se,"is-show-package":"",disable:!f(l).showInsure,"form-auth":P.value,"form-info":f(e),"product-detail":m.value,onOnReset:We,onOnUpdate:ze},null,8,["disable","form-auth","form-info","product-detail"])]),_:1},8,["detail"]),q("div",Ga,[q("div",Ja,[ja,G.value?(k(),ee(r,{key:1,class:"premium-loading",type:"spinner"})):(k(),X("span",Xa,Y(h.value?"\uFFE5":"")+Y(f(Ia)(h.value))+" "+Y(h.value?f(e).paymentFrequency==f(we).YEAR?"\u5143/\u5E74":"\u5143/\u6708":""),1))]),g(u,{type:"primary",class:"right",disabled:!(f(l).canInsure||f(l).canUpgrade),onClick:aa},{default:Q(()=>[be(Y(f(l).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),f(_)?Z("",!0):(k(),ee(Ma,{key:1,"product-detail":m.value},null,8,["product-detail"])),g(Va,{"order-no":f(_),"tenant-id":f(E),"is-show":z.value,onOnConfirm:de,onOnClose:Ke},null,8,["order-no","tenant-id","is-show"])]}),_:1},8,["theme-vars"]),g(qa,{show:B.value,"onUpdate:show":a[0]||(a[0]=s=>B.value=s),"content-list":f(Ve),"active-index":0,onOnConfirmHealth:ta,onOnCloseHealth:me},null,8,["show","content-list"]),C.value?(k(),ee($a,{key:0,show:C.value,"onUpdate:show":a[1]||(a[1]=s=>C.value=s),"content-list":f(qe),"active-index":le.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9","force-read-cound":2,"on-close-file-preview":"",onSubmit:ra,onOnCloseFilePreview:me},null,8,["show","content-list","active-index"])):Z("",!0),g(Ya,{"is-show":W.value},null,8,["is-show"])],64)}}});var pt=Na(Qa,[["__scopeId","data-v-0ee5fc55"]]);export{pt as default};
