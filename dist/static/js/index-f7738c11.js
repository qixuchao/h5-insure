import{g as Z,a0 as z,Q as M,C as u,L as P,M as W,m as k,n,j as F,y as t,G as f,H as g,F as A,r as y,k as T,I as v,z as _,A as j,E as G,h as H,s as O,B as D,a2 as Q,a3 as J,T as N}from"./vendor-e9263418.js";import{b as K}from"./visit-bddb9367.js";import{_ as X}from"./index-654379f5.js";import{_ as ee}from"./index-e4c11be9.js";import{S as te,u as se}from"./index-b8742a0a.js";import{_ as ae}from"./plugin-vue_export-helper-46f75680.js";const oe=B=>(Q("data-v-1b5a9c62"),B=B(),J(),B),le={class:"head-left"},ie=["src"],ue={class:"head-detail"},ne={class:"head-name"},de={class:"name-div"},re=D(" \u7D2F\u8BA1\u8BBF\u95EE"),ce=D("\u6B21 "),ve={class:"out"},_e={class:"add-image-out"},pe=["src"],he={class:"add-text"},me={class:"visitorDetail-body"},fe=oe(()=>t("div",{class:"body-title"},"\u8BBF\u95EE\u8BB0\u5F55",-1)),ge={class:"body-list"},ye=["onClick"],Be={class:"item-left"},Ie={class:"left-title"},Ce={class:"left-time"},Ee={class:"item-image"},Fe=["src"],Te={class:"visitorDetail-footer"},Se={class:"footer-div"},ke=D("\u5173\u8054\u5BA2\u6237"),De=Z({setup(B){const R=new te({source:"localStorage"}),{getIconUrl:S}=se(),i=z(),p=M(),d=u(!1),r=u(!1),h=u(!1),I=u(!1),C=u(0),l=u({}),c=u(!1),a=P([]),q=e=>{var o,m,E;if(console.log(e),e==="add"){if(((o=R.get("userInfo"))==null?void 0:o.userType)==="I"){N("\u5185\u52E4\u7528\u6237\u4E0D\u80FD\u6DFB\u52A0\u5BA2\u6237");return}i.push({path:"./editCustomer",query:{isVisit:"Y",visitId:p.query.visitId,wechatNickname:((m=l.value)==null?void 0:m.wechatNickname)||""}})}else e==="edit"&&i.push({path:"./editCustomer",query:{agentCustomerId:l.value.relatedCustomerId||"",customerType:((E=l.value)==null?void 0:E.relatedCustomerType)||""}})},x=e=>{console.log(e),e.contentType==="poster"?i.push("/posterDetail"):e.contentType==="article"?i.push({path:"./articleDetail",query:{articleId:e.contentId,isInnerEntry:"Y",flag:"Y",isOuterUrl:(e==null?void 0:e.articleType)==="02"?"Y":"N"}}):e.contentType==="vcard"?i.push("/businessCard"):e.contentType==="activity"&&i.push("/activity")},V=()=>{console.log("\u70B9\u51FB\u4E86\u5173\u8054\u5BA2\u6237"),i.push({path:"./relatedCustomers",query:{visitId:p.query.visitId}})},b=()=>{I.value&&(a.splice(0,a.length),I.value=!1),C.value+=1,C.value===1&&(d.value=!0),K({pageNum:C.value,pageSize:5,queryBean:{visitorId:p.query.visitId,tenantId:p.query.tenantId,shareId:p.query.shareId||""}}).then(e=>{console.log(e.data.data,"list"),l.value=e.data.data,c.value=e.data.data.relatedCustomerId!==null,(e.data.data.visitorRecords.list===null||e.data.data.visitorRecords.list.length===0)&&(h.value=!0),e.data.data.visitorRecords.pageNum===1?a.push(...e.data.data.visitorRecords.list):a.push(...e.data.data.visitorRecords.list),(e.data.data.visitorRecords.list.length<5||e.data.data===null)&&(r.value=!1,h.value=!0),r.value=!1,console.log("visitList===>>",a),d.value=!1}).catch(e=>{console.log(e),d.value=!1,N.fail("\u8BBF\u5BA2\u6570\u636E\u67E5\u8BE2\u5931\u8D25"),r.value=!1,h.value=!0})},w=()=>{h.value=!1,r.value=!0,C.value=0,b()};return W(()=>{a.splice(0,a.length),w()}),(e,o)=>{const m=y("ZaSvg"),E=y("van-list"),L=y("van-pull-refresh"),$=y("ZaPageWrap"),U=y("van-button");return T(),k(A,null,[n($,{id:"outer","main-class":"page-visitorDetail","footer-class":"visitorDetail-footer"},{default:F(()=>[t("div",{class:"visitorDetail-head",style:j({backgroundImage:`url(${_(S)("visitor.detailbg")})`})},[t("div",le,[t("img",{src:l.value.wechatImageUrl,alt:"",class:"image"},null,8,ie),t("div",ue,[t("div",ne,[t("div",de,v(c.value?l.value.relatedCustomerName:l.value.wechatNickname),1)]),t("p",null,[re,t("span",null,v(l.value.visitCount),1),ce])])]),t("div",{class:"head-right",onClick:o[0]||(o[0]=s=>q(c.value?"edit":"add"))},[t("div",ve,[t("div",_e,[t("img",{class:"add-image",src:c.value?_(S)("visitor.editImg"):_(S)("visitor.addImg"),alt:""},null,8,pe)]),t("div",he,v(c.value?"\u7F16\u8F91\u4FE1\u606F":"\u65B0\u589E\u5BA2\u6237"),1)])])],4),t("div",me,[fe,f(t("div",ge,[n(L,{modelValue:I.value,"onUpdate:modelValue":o[2]||(o[2]=s=>I.value=s),onRefresh:w},{default:F(()=>[n(E,{loading:r.value,"onUpdate:loading":o[1]||(o[1]=s=>r.value=s),finished:h.value,"finished-text":"\u6CA1\u6709\u66F4\u591A\u4E86",onLoad:b},{default:F(()=>[(T(!0),k(A,null,G(_(a),(s,Y)=>(T(),k("div",{key:Y,class:"body-list-item",onClick:be=>x(s)},[t("div",Be,[t("div",Ie,v(s.contentTitle||""),1),t("div",Ce,[n(m,{name:"time",class:"time-img"}),t("span",null,v(s.lastVisitContentTimeStr||"\u7A7A"),1),f(n(m,{name:"eyes",alt:"",class:"eye-img"},null,512),[[g,s.viewTimeStr]]),f(t("span",null,v(`\u8BBF\u95EE ${s.viewTimeStr||""}`),513),[[g,s.viewTimeStr]])])]),t("div",Ee,[t("img",{src:s.contentImg,alt:""},null,8,Fe)])],8,ye))),128))]),_:1},8,["loading","finished"])]),_:1},8,["modelValue"])],512),[[g,_(a).length!==0&&!d.value]]),d.value?(T(),H(X,{key:0,vertical:!0})):O("",!0),f(n(ee,{title:"\u6682\u65E0\u8BBF\u95EE\u8BB0\u5F55",class:"empty-class"},null,512),[[g,_(a).length===0&&!d.value]])])]),_:1}),t("div",Te,[f(t("div",Se,[n(U,{round:"",type:"primary",class:"btn",onClick:V},{default:F(()=>[ke]),_:1})],512),[[g,!c.value]])])],64)}}});var Ve=ae(De,[["__scopeId","data-v-1b5a9c62"]]);export{Ve as default};
