var Je=Object.defineProperty,Xe=Object.defineProperties;var Qe=Object.getOwnPropertyDescriptors;var ie=Object.getOwnPropertySymbols;var Ze=Object.prototype.hasOwnProperty,et=Object.prototype.propertyIsEnumerable;var ce=(y,c,p)=>c in y?Je(y,c,{enumerable:!0,configurable:!0,writable:!0,value:p}):y[c]=p,k=(y,c)=>{for(var p in c||(c={}))Ze.call(c,p)&&ce(y,p,c[p]);if(ie)for(var p of ie(c))et.call(c,p)&&ce(y,p,c[p]);return y},S=(y,c)=>Xe(y,Qe(c));import{g as tt,a9 as at,O as rt,E as h,M as de,y as me,_ as ot,l as nt,h as ut,r as pe,af as st,j as M,n as fe,p as E,m as G,H as lt,t as j,z as b,A as m,J as V,C as we,k as he,F as it,D as ct,T as I,X as dt}from"./vendor-ec22d003.js";import{_ as mt,C as ve,a0 as pt,H as ft,I as Fe,a1 as ye}from"./index-a5b54414.js";import{a as J}from"./order-26db6dbf.js";import{S as q,R as _,f as Ee,I as ht}from"./infoCollection-192ba138.js";import{p as ge,i as vt,s as Ft,g as yt,u as Et,a as gt}from"./trial-abc6ba8c.js";import{p as Dt}from"./product-9e18532a.js";import{a as De,o as Ce,t as Ct,g as U,b as Nt,h as Ne}from"./utils-d046687d.js";import{t as It}from"./theme-ea709837.js";import{d as Ie,B as _t,D as wt,G as At,S as Bt,H as Tt,P as Pt,U as kt,_ as St,W as bt,a as _e}from"./auth-3c9419ec.js";import{_ as Ut}from"./index-91f95db1.js";import"./utils-b6782348.js";import"./trial-894ef2df.js";import"./index-c5e84e88.js";import"./bankCard-0e4ce564.js";import"./phoneVerify-2f735385.js";const Ht={key:0},Ot={class:"page-internet-product-detail"},Lt={class:"info"},xt={class:"footer-button"},Rt={class:"price"},Mt=we(" \u603B\u4FDD\u8D39"),Vt=tt({setup(y){const c=at(),p=rt(),{productCode:X="BWYL2021",tenantId:v,orderNo:B,phoneNo:Ae,agentCode:H="",saleChannelId:Be,paymentMethod:Te,certNo:Q,name:Z,pageCode:Pe,from:ke}=p.query,O=h(),d=h(),L=h(),D=h(),Y=Pe==="payBack",$=h(!1),x=h(!1),w=h(!1),ee=h(0),K=h(!1),W=h(!1),R=h({show:!1,html:""});let z="";const e=de({holder:{certNo:Q,certType:ve.CERT,mobile:Ae,name:Z,socialFlag:q.HAS},insured:{certNo:Q,certType:ve.CERT,name:Z,socialFlag:q.HAS,relationToHolder:_.SELF},paymentMethod:Te,renewalDK:"Y",paymentFrequency:Ee.YEAR,packageProductList:[],mobileSmsCode:""}),te=h(Ie),T=h(Ie),s=de({showInsure:!Y,canInsure:!1,canUpgrade:!1}),Se=me(()=>{var t,a;return((a=(t=d.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:a.attachmentVOList.filter(r=>r.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),be=me(()=>{var t,a;return((a=(t=d.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:a.attachmentVOList.filter(r=>r.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),Ue=()=>{if(e.holder.certNo){const t=U(e.holder.certNo,"year"),a=Fe(e.holder.certNo);if(t<18)return I("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E18\u5C81\uFF01"),!1;if(e.insured.certNo&&e.insured.relationToHolder===_.MATE){const r=Fe(e.insured.certNo);if(a===r)return I("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(e.insured.certNo){const t=U(e.insured.certNo,"day"),a=U(e.insured.certNo,"year");if(e.insured.relationToHolder===_.CHILD&&t<30)return I("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(e.insured.relationToHolder===_.PARENT&&a>=71)return I("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E70\u5C81\uFF01"),!1}if([_.CHILD,_.PARENT].includes(e.insured.relationToHolder)){const t=U(e.holder.certNo,"year"),a=U(e.insured.certNo,"year");if(e.insured.relationToHolder===_.CHILD&&t-a<18)return I("\u6295\u4FDD\u4EBA\u548C\u5B50\u5973\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1;if(e.insured.relationToHolder===_.PARENT&&a-t<18)return I("\u6295\u4FDD\u4EBA\u548C\u7236\u6BCD\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1}return!0},He=()=>{const{holder:{certNo:t,mobile:a,name:r,socialFlag:u},insured:{certNo:o,name:n,socialFlag:l,relationToHolder:f},paymentMethod:F}=e;return!!(ft(o)&&!!l)},ae=()=>{c.push({path:"/internet/guaranteeUpgrade",query:S(k({},p.query),{tenantId:v,productCode:"BWYL2022",orderNo:B,agentCode:H})})},Oe=()=>{W.value=!1},Le=()=>{T.value=te.value},xe=()=>{T.value=S(k({},T.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},Re=async t=>{I.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const a=await Et(t),{code:r}=a;if(r==="10000"){I.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const u=await gt({orderNo:t.orderNo,tenantId:v}),{data:o}=u;u.code==="10000"&&(o.type===2?(R.value={show:!0,html:o.paymentUrl},console.log("data.paymentUrl",R.value),dt(()=>{console.log("document.forms",document.forms);const n=document.getElementById("cashierSubmit");n==null||n.addEventListener("submit",l=>{l.preventDefault()}),n==null||n.submit()})):window.location.href=o.paymentUrl)}s.canInsure=!0}catch{s.canInsure=!0}},Me=t=>`${ye}/pay?orderNo=${t}&saleUserId=${H}&tenantId=${v}`,Ve=t=>`${ye}/internet/payFail?tenantId=${v}&orderNo=${t}&agentCode=${H}&pageCode=payBack&from=${ke||"normal"}`,qe=async t=>{console.log("risk",t);const a=Nt({tenantId:v,saleUserId:H,saleChannelId:Be,detail:d.value,insureDetail:L.value,paymentMethod:e.paymentMethod,renewalDK:e.renewalDK,iseeBizNo:z,successJumpUrl:"",premium:D.value,holder:e.holder,insured:e.insured,tenantOrderRiskList:t,orderStatus:"",orderTopStatus:""});try{const r=await Ft(a),{code:u,data:o}=r;u==="10000"&&Re(S(k({},a),{orderNo:o.data,extInfo:{extraInfo:{renewalDK:e.renewalDK,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,successJumpUrl:Me(o.data),failUrl:Ve(o.data)},iseeBizNo:z}}))}catch{s.canInsure=!0}},Ye=async()=>{const{calcData:t,riskVOList:a}=De({holder:e.holder,insured:e.insured,tenantId:v,productDetail:d.value,insureDetail:L.value,paymentFrequency:e.paymentFrequency,packageRiskIdList:Ce(e.packageProductList)},!1,Ne),r=await ge(t),{code:u,data:o}=r;return u==="10000"?(D.value=o.premium,{condition:a,data:o}):{}},$e=t=>{ee.value=t,w.value=!0},Ke=()=>new Promise((t,a)=>{var r,u;(u=(r=O.value)==null?void 0:r.validateForm)==null||u.call(r).then(async()=>{var C;if(!Ue()){s.canInsure=!0;return}if(!(((C=O.value)==null?void 0:C.isAgreeFile)||$.value)){w.value=!0,$e(0);return}const{calcData:n,riskVOList:l}=De({holder:e.holder,insured:e.insured,tenantId:v,productDetail:d.value,insureDetail:L.value,paymentFrequency:e.paymentFrequency,packageRiskIdList:Ce(e.packageProductList)},!1,Ne),f=await ge(n),{code:F,data:g}=f;F==="10000"?(D.value=g.premium,t({condition:l,data:g})):a(new Error)}).catch(()=>{s.canInsure=!0})}),re=async()=>{var t;if(Y){ae();return}try{const{condition:a,data:r}=await Ke(),u={},o=(l=[])=>{(l||[]).forEach(f=>{var F;u[f.riskCode]=f,((F=f.riskPremiumDetailVOList)==null?void 0:F.length)&&o(f.riskPremiumDetailVOList)})};o(r.riskPremiumDetailVOList);const n=Ct({tenantId:v,riskList:a,riskPremium:u,productId:(t=d.value)==null?void 0:t.id});qe(n)}catch{s.canInsure=!0}},We=t=>{t==="allFalse"?(x.value=!1,re(),s.canInsure=!0):ct.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"}).then(()=>{window.history.back()}).catch(()=>{var a;(a=O.value)==null||a.reEditForm(),$.value=!1,s.canInsure=!0})},ze=()=>{$.value=!0,w.value=!1,x.value=!0};ot([()=>e.insured.certNo,()=>e.insured.socialFlag,()=>e.packageProductList,()=>e.paymentFrequency],nt.exports.debounce(()=>{e.insured.certNo&&e.insured.socialFlag&&He()&&Ye()},500),{deep:!0,immediate:!0});const oe=async()=>{var u,o,n,l,f,F,g,C,P,ne,ue,se,le;const t=await yt({orderNo:B,tenantId:v}),{code:a,data:r}=t;if(a==="10000"){const{tenantOrderHolder:N,tenantOrderInsuredList:i,extInfo:A}=r;if(!Y){Object.assign(e,{holder:{certNo:N.certNo,certType:N.certType,mobile:N.mobile,name:N.name,socialFlag:q.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(u=i[0])==null?void 0:u.certType,name:(o=i[0])==null?void 0:o.name,socialFlag:(l=(n=i[0])==null?void 0:n.extInfo)==null?void 0:l.hasSocialInsurance,relationToHolder:(f=i[0])==null?void 0:f.relationToHolder},paymentMethod:A.extraInfo.paymentMethod,paymentFrequency:A.extraInfo.paymentFrequency,renewalDK:A.extraInfo.renewalDK||"N"}),s.canInsure=!0;return}Object.assign(e,{holder:{certNo:N.certNo,certType:N.certType,mobile:N.mobile,name:N.name,socialFlag:q.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(F=i[0])==null?void 0:F.certType,name:(g=i[0])==null?void 0:g.name,socialFlag:(P=(C=i[0])==null?void 0:C.extInfo)==null?void 0:P.hasSocialInsurance,relationToHolder:(ne=i[0])==null?void 0:ne.relationToHolder},paymentMethod:A.extraInfo.paymentMethod,paymentFrequency:A.extraInfo.paymentFrequency,renewalDK:A.extraInfo.renewalDK||"N"}),D.value=(le=(se=(ue=i[0])==null?void 0:ue.tenantOrderProductList)==null?void 0:se[0])==null?void 0:le.premium,(r.orderStatus===J.ACCEPT_POLICY||r.orderStatus===J.PAYMENT_SUCCESS)&&(s.canUpgrade=!0,K.value=!1,W.value=!0),r.orderStatus===J.PAYING&&(K.value=!0,setTimeout(()=>{oe()},3*1e3))}},Ge=async()=>{const t=Dt({productCode:X,withInsureInfo:!0,tenantId:v}),a=vt({productCode:X});await Promise.all([t,a]).then(([r,u])=>{var o,n;r.code==="10000"&&(d.value=r.data,document.title=((o=r.data)==null?void 0:o.productFullName)||""),u.code==="10000"&&(e.packageProductList=(((n=u.data)==null?void 0:n.packageProductVOList)||[]).map(l=>S(k({},l),{value:ht.UN_INSURE,disabled:!1})),L.value=u.data)}),B&&oe()},je=()=>{console.log("\u6295\u4FDD\u94FE\u63A5"),T.value=_e,te.value=_e,s.canInsure=!0};return ut(()=>{je(),Ge(),setTimeout(async()=>{z=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(t,a)=>{const r=pe("van-button"),u=pe("van-config-provider"),o=st("dompurify-html");return M(),fe(it,null,[E(u,{"theme-vars":m(It)},{default:G(()=>{var n,l,f,F,g,C,P;return[R.value.show?lt((M(),fe("div",Ht,null,512)),[[o,R.value.html]]):j("",!0),b("div",Ot,[b("div",Lt,[E(_t,{url:(l=(n=d.value)==null?void 0:n.tenantProductInsureVO)==null?void 0:l.banner[0]},null,8,["url"]),E(wt,{"product-name":(f=d.value)==null?void 0:f.productFullName,"product-desc":(g=(F=d.value)==null?void 0:F.showConfigVO)==null?void 0:g.desc},null,8,["product-name","product-desc"])]),E(At,{"show-service-config":"","guarantee-list":(P=(C=d.value)==null?void 0:C.tenantProductInsureVO)==null?void 0:P.titleAndDescVOS},null,8,["guarantee-list"]),E(Bt,{detail:d.value},{form:G(()=>[E(Tt,{ref_key:"formRef",ref:O,"is-show-package":"",disable:!m(s).showInsure,"form-auth":T.value,"form-info":m(e),premium:D.value,"product-detail":d.value,onOnReset:Le,onOnUpdate:xe},null,8,["disable","form-auth","form-info","premium","product-detail"])]),_:1},8,["detail"]),b("div",xt,[b("div",Rt,[Mt,b("span",null,V(D.value?"\uFFE5":"")+V(m(pt)(D.value))+" "+V(D.value?m(e).paymentFrequency==m(Ee).YEAR?"\u5143/\u5E74":"\u5143/\u6708":""),1)]),E(r,{type:"primary",class:"right",disabled:!(m(s).canInsure||m(s).canUpgrade),onClick:re},{default:G(()=>[we(V(m(s).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),m(B)?j("",!0):(M(),he(Pt,{key:1,"product-detail":d.value},null,8,["product-detail"])),E(kt,{"order-no":m(B),"tenant-id":m(v),"is-show":W.value,onOnConfirm:ae,onOnClose:Oe},null,8,["order-no","tenant-id","is-show"])]}),_:1},8,["theme-vars"]),E(St,{show:x.value,"onUpdate:show":a[0]||(a[0]=n=>x.value=n),"content-list":m(Se),"active-index":0,onOnConfirmHealth:We},null,8,["show","content-list"]),w.value?(M(),he(Ut,{key:0,show:w.value,"onUpdate:show":a[1]||(a[1]=n=>w.value=n),"content-list":m(be),"active-index":ee.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9","force-read-cound":2,onSubmit:ze},null,8,["show","content-list","active-index"])):j("",!0),E(bt,{"is-show":K.value},null,8,["is-show"])],64)}}});var oa=mt(Vt,[["__scopeId","data-v-8408dfd2"]]);export{oa as default};
