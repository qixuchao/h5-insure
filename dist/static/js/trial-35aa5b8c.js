import{d as e,h as a,i as t,j as s,O as o,o as r,l,w as i,a as u,e as d,b as c,u as n,m as p,c as m,F as v,n as f,a8 as k,_ as R,T as C,ap as I,aq as j,ar as h,as as L,at as y,g as b,au as _,q as g,s as P}from"./index-3179c687.js";import{T as w}from"./index-ddbaee07.js";import{a as q,b as N,g as V,s as S,i as x,m as M}from"./trial-37f9d893.js";import{_ as A}from"./index-349028be.js";import{S as K}from"./index-f31d2ab7.js";import{R as D}from"./trial-b740f447.js";import{_ as O}from"./TrialButton-3f536336.js";import{u as T}from"./useOrder-a9f32552.js";import{B as E,a as U}from"./constants-fe95ef6f.js";import{a as B}from"./utils-e81fde52.js";import"./cloneDeep-3b41a914.js";import"./InsureInfos-5263bc39.js";import"./index-de590a0b.js";import"./get-395c773b.js";import"./infoCollection-ac1e9604.js";import"./index-494d5762.js";import"./PolicyInfo-31c6a42f.js";import"./lodash-8e207415.js";import"./questionnaire-62331097.js";import"./util-d1892bb0.js";import"./product-7bbf9c44.js";import"./constants-11eaea5a.js";import"./utils-4d148ef9.js";import"./createProposal-da208658.js";import"./nextStep-3f87be0e.js";import"./core-a72ee908.js";import"./empty-ae586b6c.js";import"./index-6081d219.js";import"./utils-ef727091.js";const F={class:"popup-container"},$={class:"popup-header"},H={class:"title"},z=(e=>(L("data-v-30eb5131"),e=e(),y(),e))((()=>u("p",{class:"tip"},"已为您挑选出以下险种",-1))),G={class:"search"},J={key:0,class:"risk-list"},Q=e({name:"riskSelect"});var W=R(e({...Q,props:{type:{default:2},show:{type:Boolean,default:!1},title:{},insuredList:{default:()=>[]},mainRiskCode:{default:""},selectList:{default:()=>[]},currentProductCode:{default:""}},emits:["cancel","confirm"],setup(e,{emit:R}){const L=e,y=a(),{insurerCode:b}=y.query,_=t([]),g=t([]),P=t(),w=s((()=>L.show)),V=()=>{R("cancel")},S=()=>{var e;(null==(e=_.value)?void 0:e.length)?R("confirm",_.value):C(`暂未添加任何${L.type===D.MAIN_RISK?"主":"附加"}险`)},x=async()=>{var e;const a={insuredList:L.insuredList,mainRiskCode:L.mainRiskCode,insurerCode:b,productCategory:"",keyword:P.value,selectProductCodes:[],selectRiskCodes:[],filterFlag:(null==(e=L.selectList)?void 0:e.length)?1:2};if(a.selectProductCodes=L.selectList.map((e=>(e.productCode===L.currentProductCode&&a.selectRiskCodes.push(...e.mergeRiskReqList.map((e=>e.riskCode))),e.productCode))),L.type===D.MAIN_RISK){const{code:e,data:t}=await q(a);"10000"===e&&(g.value=t)}else{const{code:e,data:t}=await N(a);"10000"===e&&(g.value=t)}};return o((()=>{x()})),(e,a)=>{const t=K,s=I,o=j,R=A,C=h;return r(),l(C,{show:n(w),"onUpdate:show":a[2]||(a[2]=e=>p(w)?w.value=e:null),class:"popup-risk-select",closeable:!1},{default:i((()=>[u("div",F,[u("div",$,[u("span",{class:"clear-all",onClick:V}," 取消 "),u("span",H,d(e.title),1),u("span",{class:"close",onClick:S},"确认")]),z,u("div",G,[c(t,{modelValue:n(P),"onUpdate:modelValue":a[0]||(a[0]=e=>p(P)?P.value=e:null),shape:"round",placeholder:"请输入产品名称进行搜索","clear-trigger":"always","show-action":"",clearable:"",onSearch:x},null,8,["modelValue"])]),n(g).length?(r(),m("div",J,[c(o,{modelValue:n(_),"onUpdate:modelValue":a[1]||(a[1]=e=>p(_)?_.value=e:null)},{default:i((()=>[(r(!0),m(v,null,f(n(g),(e=>(r(),l(s,{key:e.riskCode||e.productCode,name:e.riskCode||e.productCode},{default:i((()=>[k(d(e.riskName||e.productName),1)])),_:2},1032,["name"])))),128))])),_:1},8,["modelValue"])])):(r(),l(R,{key:1,title:`暂无关联${e.type===n(D).MAIN_RISK?"主":"附加"}险、请选择其他险种`},null,8,["title"]))])])),_:1},8,["show"])}}}),[["__scopeId","data-v-30eb5131"]]);const X={class:"page-trial-wrap"},Y=e({name:"trial"}),Z=e({...Y,setup(e){const o=a(),u=b(),{productCode:d,orderNo:p,tenantId:v}=o.query,f=t({}),k=t({productList:[]}),R=t([]),C=t({}),I=t(),j=t(),h=T({extInfo:{templateId:201,buttonCode:E.TRIAL_PREMIUM,pageCode:U.TRIAL_PREMIUM}}),L=t(),y=t(1),q=s((()=>y.value===D.MAIN_RISK?"添加主险":"添加附加险")),N=t(!1),A=()=>{N.value=!1},K=e=>{if(y.value===D.MAIN_RISK){const a=e.map((e=>({productCode:e,mergeRiskReqList:[]})));k.value.productList.push(...a),I.value.getProductDefaultValue(e)}else{const a=k.value.productList.find((e=>e.productCode===j.value)),t=e.map((e=>({riskCode:e,riskType:D.RIDER_RISK,mainRiskCode:C.value.riskCode})));a.mergeRiskReqList.push(...t),I.value.getRiderRiskDefaultValue(j.value,e,C.value.riskCode)}M(k.value).then((({code:e,data:a})=>{if("10000"===e){const{productDetailResList:e,productFactor:t}=a;L.value=t,k.value=B(e);const s={};e.forEach((e=>{s[e.productCode]=e})),f.value=s}})),N.value=!1},F=(e,a,t)=>{N.value=!0,y.value=D.RIDER_RISK,R.value=t,C.value=a,j.value=e},$=e=>{N.value=!0,y.value=D.MAIN_RISK,R.value=e},H=(e,a,t)=>{f.value[e],t?(f.value[e].productPlanInsureVOList[0].insureProductRiskVOList=f.value[e].productPlanInsureVOList[0].insureProductRiskVOList.filter((e=>e.riskCode!==a)),k.value.productList=k.value.productList.map((t=>(t.productCode===e&&(t.mergeRiskReqList=t.mergeRiskReqList.filter((e=>e.riskCode!==a))),t)))):(delete f.value[e],k.value.productList=k.value.productList.filter((a=>a.productCode!==e)))},z=()=>{I.value.onNext((async e=>{const{code:a,data:t}=await S(e);"10000"===a&&u.push({path:P.questionNotice,query:{...o.query,orderNo:t}})}))};return _((()=>{x({productCode:d,isTenant:!1}).then((({data:e,code:a})=>{var t,s;"10000"===a&&(f.value[`${d}`]=e,L.value=null==(s=null==(t=null==e?void 0:e.productPlanInsureVOList)?void 0:t[0])?void 0:s.productFactor,k.value=B([e]))})),p&&V({orderNo:p,tenantId:v}).then((({code:e,data:a})=>{"10000"===e&&(h.value=a)}))})),(e,a)=>(r(),m("div",X,[c(w,{ref_key:"trialRef",ref:I,"product-collection":n(f),"default-value":n(h),"product-factor":n(L),"product-risk-code-map":n(k),"is-trial":"","hide-benefit":"",onAddRisk:F,onAddMainRisk:$,onDeleteRisk:H},{trialBtn:i((({riskPremium:e})=>[c(O,{premium:e.initialPremium,onHandleClick:z},null,8,["premium"])])),_:1},8,["product-collection","default-value","product-factor","product-risk-code-map"]),n(N)?(r(),l(W,{key:0,type:n(y),show:n(N),"insured-list":n(R),title:n(q),"current-product-code":n(j),"main-risk-code":n(C).riskCode,"select-list":n(k).productList,onCancel:A,onConfirm:K},null,8,["type","show","insured-list","title","current-product-code","main-risk-code","select-list"])):g("",!0)]))}});export{Z as default};
