import{d as e,ad as n,i as t,j as a,r as i,cO as o,k as s,O as r,dx as l,o as d,c as u,b as c,w as p,u as f,a as g,f as v,V as m,a8 as h,e as C,p as k,F as w,_ as y,E as b,dG as N,T as j,aj as P,au as x,bW as R}from"./index-8ccea0ec.js";import{d as _}from"./product-97cae19e.js";import{u as G}from"./useThread-637a02aa.js";import{o as O}from"./jsbridgePromise-1a7f0ae2.js";const S={key:0,class:"header"},T=["src"],I={key:1,class:"statement up"},A={key:3,class:"statement"},D={class:"footer"},E={key:0},J={class:"review-pdf"},U=e({name:"preNotice"});var L=y(e({...U,props:{productDetail:{default:()=>({})}},setup(e){const y=e,U=n(),L=t(),{tenantId:F="",productCode:V,preview:q}=L.query,W=a(),z=i({insureConfig:{logoLocation:void 0,logoUrl:"",readingReminder:"",acceptReminder:"",readingSeconds:0,buttonTitle:"我知道了"}}),B=a(!1),H=a(!1),K=new o({source:"sessionStorage"});let M;const Q=a({title:"",link:""}),X=a(),Y=s((()=>{if(Q.value.link){const e=(Q.value.link||"").split("?"),n=e[0].lastIndexOf("."),t=(e[0]||"").substring(n+1);if("pdf"===t)return"pdf";if([".jpg",".JPG",".jpeg",".JPEG",".png",".PNG",".gif",".tif"].includes(t))return"picture"}return"link"})),Z=e=>{H.value=!H.value,Q.value.link=e.href,Q.value.title=e.innerText},$=()=>{B.value=!1};return r((()=>{!q&&(async()=>{const{code:e,data:n}=await _({insureCode:y.productDetail.insurerCode,productCode:V,tenantId:F});"10000"===e&&(B.value=!0,z.insureConfig=n,X.value=z.insureConfig.readingSeconds||0,M=G({start:()=>{console.log("开始轮询"),X.value-=1},stop:()=>{console.log("结束轮询"),X.value=0,K.set("PRENOTICE-isShow","1")},time:1e3,number:z.insureConfig.readingSeconds||0}),b((()=>{M.run()}))),N(W,"click",(e=>{const n=e||window.event;n.preventDefault?n.preventDefault():n.returnValue=!1;const{target:t}=n;let a=t;("SPAN"===t.tagName&&"A"===(null==t?void 0:t.parentNode.tagName)||"A"===t.tagName)&&("SPAN"===t.tagName&&"A"===(null==t?void 0:t.parentNode.tagName)&&(a=null==t?void 0:t.parentNode),console.dir(a),(e=>{if(!e)return!1;const[n]=(e||"").split("?"),t=n.lastIndexOf(".");if(-1===t)return!1;const a=n.substring(t);return[".jpg",".JPG",".jpeg",".JPEG",".png",".PNG",".gif",".tif",".pdf",".PDF"].includes(a)})(a.href)?Z(a):"_blank"===a.target?0===a.href.indexOf("http://")||0===a.href.indexOf("https://")?U?O(a.innerText,a.href):window.open(a.href):j("配置网页链接需要带协议http://或https://"):Z(a))}))})()})),(e,n)=>{var t;const a=P,i=x,o=R,s=l("dompurify-html");return d(),u(w,null,[c(i,{class:"pre-notice-wrap",show:f(B),"close-on-click-overlay":!1,closeable:!1,height:"auto",style:{"padding-bottom":"30px"}},{default:p((()=>[f(z).insureConfig.logoUrl?(d(),u("div",S,[g("img",{src:f(z).insureConfig.logoUrl},null,8,T)])):v("",!0),1===f(z).insureConfig.logoLocation&&f(z).insureConfig.acceptReminder?m((d(),u("div",I,null,512)),[[s,f(z).insureConfig.acceptReminder]]):v("",!0),f(z).insureConfig.readingReminder?(d(),u("div",{key:2,ref_key:"noticeRef",ref:W,class:"content"},[m(g("div",null,null,512),[[s,f(z).insureConfig.readingReminder]])],512)):v("",!0),2===f(z).insureConfig.logoLocation&&f(z).insureConfig.acceptReminder?m((d(),u("div",A,null,512)),[[s,f(z).insureConfig.acceptReminder]]):v("",!0),g("div",D,[c(a,{type:"primary",disabled:0!==f(X),block:"",round:"",onClick:$},{default:p((()=>[h(C(f(z).insureConfig.buttonTitle)+" ",1),f(X)?(d(),u("span",E,C(f(X))+"s",1)):v("",!0)])),_:1},8,["disabled"])])])),_:1},8,["show"]),c(i,{show:f(H),"onUpdate:show":n[0]||(n[0]=e=>k(H)?H.value=e:null),class:"pre-notice-wrap",title:null==(t=f(Q))?void 0:t.title,position:"bottom","close-on-click-overlay":!1,style:{overflow:"hidden"}},{default:p((()=>{var e;return[g("div",J,[c(o,{"is-iframe":!1,content:null==(e=f(Q))?void 0:e.link,type:f(Y)},null,8,["content","type"])])]})),_:1},8,["show","title"])],64)}}}),[["__scopeId","data-v-5a8ead59"]]);export{L as default};
