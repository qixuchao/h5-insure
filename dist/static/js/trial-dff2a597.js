import{ap as e,aq as t,ar as o,as as a,at as r,au as i,av as l,aw as s,ax as u,ay as n,d,i as c,j as p,k as v,O as f,o as m,m as k,w as R,a as C,e as h,b as y,u as I,p as L,c as j,F as g,q as b,a8 as _,_ as q,T as w,az as P,aA as T,aB as x,aC as S,aD as M,h as N,aE as V,f as A,s as D}from"./index-df1d7325.js";import{T as K}from"./index-61808269.js";import{a as O,b as E,g as B,s as U,i as F,m as $}from"./trial-d9bdf76c.js";import{_ as z}from"./index-18e08912.js";import{S as H}from"./index-ece6be5f.js";import{R as G}from"./trial-5cc08684.js";import{_ as J}from"./TrialButton-b974e3f2.js";import{u as Q}from"./useOrder-e61339f4.js";import{B as W,a as X}from"./constants-b6eb977d.js";import{a as Y}from"./utils-47d6e2d3.js";import{c as Z,t as ee,i as te,g as oe,b as ae}from"./index-ccf04eb9.js";import"./cloneDeep-ddf01994.js";import"./InsureInfos-d26e65b6.js";import"./index-85b786dc.js";import"./infoCollection-7c1ecd77.js";import"./index-252d7909.js";import"./PolicyInfo-bc2b9f65.js";import"./lodash-2729befa.js";import"./questionnaire-62331097.js";import"./util-2c40257e.js";import"./product-7bbf9c44.js";import"./constants-919275b6.js";import"./config-98e8d477.js";import"./utils-39f4f453.js";import"./createProposal-efbb9ed8.js";import"./nextStep-9dd06cce.js";import"./core-9e6d2258.js";import"./empty-ae586b6c.js";import"./index-7dc2e13c.js";import"./utils-92391273.js";function re(t){var o=function(t){return t?1/0===(t=e(t))||-1/0===t?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}(t),a=o%1;return o==o?a?o-a:o:0}function ie(e,t,o,a){for(var r=e.length,i=o+(a?1:-1);a?i--:++i<r;)if(t(e[i],i,e))return i;return-1}function le(e){return e==e&&!a(e)}function se(e,t){return function(o){return null!=o&&(o[e]===t&&(void 0!==t||e in Object(o)))}}function ue(e){var a=function(e){for(var t=r(e),o=t.length;o--;){var a=t[o],i=e[a];t[o]=[a,i,le(i)]}return t}(e);return 1==a.length&&a[0][2]?se(a[0][0],a[0][1]):function(r){return r===e||function(e,a,r,i){var l=r.length,s=l,u=!i;if(null==e)return!s;for(e=Object(e);l--;){var n=r[l];if(u&&n[2]?n[1]!==e[n[0]]:!(n[0]in e))return!1}for(;++l<s;){var d=(n=r[l])[0],c=e[d],p=n[1];if(u&&n[2]){if(void 0===c&&!(d in e))return!1}else{var v=new t;if(i)var f=i(c,p,d,e,a,v);if(!(void 0===f?o(p,c,3,i,v):f))return!1}}return!0}(r,e,a)}}function ne(e,t){return null!=e&&t in Object(e)}function de(e,t){return null!=e&&function(e,t,o){for(var a=-1,r=(t=Z(t,e)).length,n=!1;++a<r;){var d=ee(t[a]);if(!(n=null!=e&&o(e,d)))break;e=e[d]}return n||++a!=r?n:!!(r=null==e?0:e.length)&&i(r)&&l(d,r)&&(s(e)||u(e))}(e,t,ne)}function ce(e){return te(e)?(t=ee(e),function(e){return null==e?void 0:e[t]}):function(e){return function(t){return ae(t,e)}}(e);var t}function pe(e){return"function"==typeof e?e:null==e?n:"object"==typeof e?s(e)?(t=e[0],a=e[1],te(t)&&le(a)?se(ee(t),a):function(e){var r=oe(e,t);return void 0===r&&r===a?de(e,t):o(a,r,3)}):ue(e):ce(e);var t,a}var ve=Math.max;var fe=Math.max,me=Math.min;const ke={class:"popup-container"},Re={class:"popup-header"},Ce={class:"title"},he=(e=>(S("data-v-0e97ccde"),e=e(),M(),e))((()=>C("p",{class:"tip"},"已为您挑选出以下险种",-1))),ye={class:"search"},Ie={key:0,class:"risk-list"},Le=d({name:"riskSelect"});var je=q(d({...Le,props:{type:{default:2},show:{type:Boolean,default:!1},title:null,insuredList:{default:()=>[]},mainRiskCode:{default:""},selectList:{default:()=>[]},currentProductCode:{default:""}},emits:["cancel","confirm"],setup(e,{emit:t}){const o=e,a=c(),{insurerCode:r}=a.query,i=p([]),l=p([]),s=p([]),u=p(),n=v((()=>o.show)),d=()=>{t("cancel")},q=()=>{var e;if(!(null==(e=i.value)?void 0:e.length))return void w(`暂未添加任何${o.type===G.MAIN_RISK?"主":"附加"}险`);let a=[];a=o.type===G.RIDER_RISK?i.value:l.value.filter((e=>i.value.includes(e.productCode))).map((e=>({productCode:e.productCode,mergeRiskReqList:(e.mainRiskCollocationList||[]).map((e=>({riskCode:e.collocationRiskCode,riskType:e.mainRiskCode?2:1,mainRiskCode:e.mainRiskCode})))}))),t("confirm",a)},S=async()=>{var e;const t={insuredList:o.insuredList,mainRiskCode:o.mainRiskCode,insurerCode:r,productCategory:"",keyword:u.value,selectProductCodes:[],selectRiskCodes:[],filterFlag:(null==(e=o.selectList)?void 0:e.length)?1:2};if(t.selectProductCodes=o.selectList.map((e=>(e.productCode===o.currentProductCode&&t.selectRiskCodes.push(...e.mergeRiskReqList.map((e=>e.riskCode))),e.productCode))),o.type===G.MAIN_RISK){const{code:e,data:o}=await O(t);"10000"===e&&(l.value=o)}else{const{code:e,data:o}=await E(t);"10000"===e&&(l.value=o.riskInfoList,s.value=o.collocationInfoResList)}};return f((()=>{S()})),(t,a)=>{const r=H,c=P,p=T,v=z,f=x;return m(),k(f,{show:I(n),"onUpdate:show":a[2]||(a[2]=e=>L(n)?n.value=e:null),class:"popup-risk-select",closeable:!1},{default:R((()=>{var t;return[C("div",ke,[C("div",Re,[C("span",{class:"clear-all",onClick:d}," 取消 "),C("span",Ce,h(e.title),1),C("span",{class:"close",onClick:q},"确认")]),he,C("div",ye,[y(r,{modelValue:I(u),"onUpdate:modelValue":a[0]||(a[0]=e=>L(u)?u.value=e:null),shape:"round",placeholder:"请输入产品名称进行搜索","clear-trigger":"always","show-action":"",clearable:"",onSearch:S},null,8,["modelValue"])]),(null==(t=I(l))?void 0:t.length)?(m(),j("div",Ie,[y(p,{modelValue:I(i),"onUpdate:modelValue":a[1]||(a[1]=e=>L(i)?i.value=e:null)},{default:R((()=>[(m(!0),j(g,null,b(I(l),(e=>(m(),k(c,{key:e.riskCode||e.productCode,name:e.riskCode||e.productCode,onClick:()=>{return t=e.riskCode,o.type===G.RIDER_RISK&&s.value.forEach((e=>{i.value.includes(t)?t===e.relatedRiskCode?(2===e.collocationType&&i.value.push(e.collocationRiskCode),3===e.collocationType&&(i.value.push(t),i.value=i.value.filter((t=>t!==e.collocationRiskCode)))):t===e.collocationRiskCode&&(2===e.collocationType&&i.value.push(e.relatedRiskCode),3===e.collocationType&&(i.value=i.value.filter((t=>t!==e.relatedRiskCode)))):t===e.relatedRiskCode?(2===e.collocationType&&(i.value=i.value.filter((t=>t!==e.collocationRiskCode))),3===e.collocationType&&(i.value.push(t),i.value=i.value.filter((t=>t!==e.collocationRiskCode)))):t===e.collocationRiskCode&&(2===e.collocationType&&(i.value=i.value.filter((t=>t!==e.relatedRiskCode))),3===e.collocationType&&(i.value=i.value.filter((t=>t!==e.relatedRiskCode))))})),void(i.value=[...new Set(i.value)]);var t}},{default:R((()=>[_(h(e.riskName||e.productName),1)])),_:2},1032,["name","onClick"])))),128))])),_:1},8,["modelValue"])])):(m(),k(v,{key:1,title:`暂无关联${e.type===I(G).MAIN_RISK?"主":"附加"}险、请选择其他险种`},null,8,["title"]))])]})),_:1},8,["show"])}}}),[["__scopeId","data-v-0e97ccde"]]);const ge={class:"page-trial-wrap"},be=d({name:"trial"}),_e=d({...be,setup(e){const t=c(),o=N(),{productCode:a,orderNo:r,tenantId:i}=t.query,l=p({}),s=p({productList:[]}),u=p([]),n=p({}),d=p(),f=p(),C=Q({extInfo:{templateId:201,buttonCode:W.TRIAL_PREMIUM,pageCode:X.TRIAL_PREMIUM}}),h=p(),L=p(1),g=v((()=>L.value===G.MAIN_RISK?"添加主险":"添加附加险")),b=p(!1),_=()=>{b.value=!1},q=e=>{if(L.value===G.MAIN_RISK){s.value.productList.push(...e),console.log("selectCodeList",e);const t=e.map((e=>e.productCode));d.value.getProductDefaultValue(t)}else{const t=s.value.productList.find((e=>e.productCode===f.value)),o=e.map((e=>({riskCode:e,riskType:G.RIDER_RISK,mainRiskCode:n.value.riskCode}))),a=function(e,t,o){var a=null==e?0:e.length;if(!a)return-1;var r=null==o?0:re(o);return r<0&&(r=ve(a+r,0)),ie(e,pe(t),r)}(t.mergeRiskReqList,(e=>e.riskCode===n.value.riskCode)),r=function(e,t,o){var a=null==e?0:e.length;if(!a)return-1;var r=a-1;return void 0!==o&&(r=re(o),r=o<0?fe(a+r,0):me(r,a-1)),ie(e,pe(t),r,!0)}(t.mergeRiskReqList,(e=>e.mainRiskCode===n.value.riskCode));let i=a;-1!==r&&(i=r),t.mergeRiskReqList=[...t.mergeRiskReqList.slice(0,i+1),...o,...t.mergeRiskReqList.slice(i+1,t.mergeRiskReqList.length)],d.value.getRiderRiskDefaultValue(f.value,e,n.value.riskCode)}$(s.value).then((({code:e,data:t})=>{if("10000"===e){const{productDetailResList:e,productFactor:o}=t;h.value=o,s.value=Y(e);const a={};e.forEach((e=>{a[e.productCode]=e})),l.value=a}})),b.value=!1},w=(e,t,o)=>{b.value=!0,L.value=G.RIDER_RISK,u.value=o,n.value=t,f.value=e},P=e=>{b.value=!0,L.value=G.MAIN_RISK,u.value=e},T=(e,t,o)=>{l.value[e],o?(l.value[e].productPlanInsureVOList[0].insureProductRiskVOList=l.value[e].productPlanInsureVOList[0].insureProductRiskVOList.filter((e=>e.riskCode!==t)),s.value.productList=s.value.productList.map((o=>(o.productCode===e&&(o.mergeRiskReqList=o.mergeRiskReqList.filter((e=>e.riskCode!==t))),o)))):(delete l.value[e],s.value.productList=s.value.productList.filter((t=>t.productCode!==e)))},x=()=>{d.value.onNext((async e=>{const{code:a,data:r}=await U(e);"10000"===a&&o.push({path:D.questionNotice,query:{...t.query,orderNo:r}})}))};return V((()=>{F({productCode:a,isTenant:!1}).then((({data:e,code:t})=>{var o,r;"10000"===t&&(l.value[`${a}`]=e,h.value=null==(r=null==(o=null==e?void 0:e.productPlanInsureVOList)?void 0:o[0])?void 0:r.productFactor,s.value=Y([e]))})),r&&B({orderNo:r,tenantId:i}).then((({code:e,data:t})=>{"10000"===e&&(C.value=t)}))})),(e,t)=>(m(),j("div",ge,[y(K,{ref_key:"trialRef",ref:d,"product-collection":I(l),"default-value":I(C),"product-factor":I(h),"product-risk-code-map":I(s),"is-trial":"","hide-benefit":"",onAddRisk:w,onAddMainRisk:P,onDeleteRisk:T},{trialBtn:R((({riskPremium:e})=>[y(J,{premium:e.initialPremium,onHandleClick:x},null,8,["premium"])])),_:1},8,["product-collection","default-value","product-factor","product-risk-code-map"]),I(b)?(m(),k(je,{key:0,type:I(L),show:I(b),"insured-list":I(u),title:I(g),"current-product-code":I(f),"main-risk-code":I(n).riskCode,"select-list":I(s).productList,onCancel:_,onConfirm:q},null,8,["type","show","insured-list","title","current-product-code","main-risk-code","select-list"])):A("",!0)]))}});export{_e as default};
