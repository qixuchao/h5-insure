var Se=Object.defineProperty,ke=Object.defineProperties;var Ie=Object.getOwnPropertyDescriptors;var le=Object.getOwnPropertySymbols;var Le=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable;var ce=(E,r,f)=>r in E?Se(E,r,{enumerable:!0,configurable:!0,writable:!0,value:f}):E[r]=f,h=(E,r)=>{for(var f in r||(r={}))Le.call(r,f)&&ce(E,f,r[f]);if(le)for(var f of le(r))xe.call(r,f)&&ce(E,f,r[f]);return E},I=(E,r)=>ke(E,Ie(r));import{g as be,O as we,a9 as Pe,E as m,d as Ue,y as He,h as Me,r as W,j as C,k as H,m as _,z as i,p as D,J as g,n as p,L as de,t as L,A as O,G as $,F as j,a4 as $e,a5 as je,C as b,T as x,D as qe}from"./vendor-667a94d7.js";import{q as Ve}from"./index-b8597e1c.js";import{_ as Qe,S as Ye,M as Ge,Q as Je,q as K,l as q,R as Be,r as Ce,H as ze,n as We,P as Ke,T as X,U as V,B as Ee}from"./index-d0831898.js";import{_ as Xe}from"./index-cf2b2b86.js";import{f as Ze,s as fe,g as _e,a as et}from"./verify-8cb42673.js";import{a as tt}from"./order-b675ac95.js";import{l as De,g as ut}from"./inform-57dbb847.js";const Z=E=>($e("data-v-0ea93eae"),E=E(),je(),E),st={class:"page-verify"},ot={class:"people"},nt={class:"name"},at={class:"verify-item"},rt=Z(()=>i("div",{class:"label"},"\u8BC1\u4EF6\u53F7\u7801",-1)),it={class:"no"},lt=b(" \u53BB\u8BA4\u8BC1 "),ct={class:"sign-body"},dt={class:"date"},Bt={class:"file"},Ct=b(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A "),Et={class:"people"},ft={class:"name"},_t={class:"verify-item"},Dt=Z(()=>i("div",{class:"label"},"\u8BC1\u4EF6\u53F7\u7801",-1)),pt={class:"no"},vt=["onClick"],Ft=b(" \u53BB\u8BA4\u8BC1 "),At=["onClick"],yt={class:"sign-body"},ht={class:"date"},mt={class:"file"},gt=b(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A "),Tt={class:"footer-button footer"},Nt=Z(()=>i("div",{class:"text"},"\u5237\u65B0",-1)),Rt=b("\u5206\u4EAB"),Ot=b("\u63D0\u4EA4"),St=be({setup(E){const r={CERT:1,NO_CERT:2},f=we(),pe=Pe(),{saleUserId:Q="D1234567-1",tenantId:v="9991000007",templateId:ve=1,productCode:Fe="CQ75CQ76",insurerCode:Y="ancheng",isShare:G,orderCode:w,orderNo:T,productCategory:ee}=f.query,te=()=>{const u=f.query;return u.orderCode&&(u.orderNo=u.orderCode),u},J=new Ye({source:"localStorage"}),ue=m([]),se=m([]),oe=m([]),Ae=m([]),l=m(),S=m(),N=[],P=m(""),M=m(),ne=Ue().format("YYYY-MM-DD"),ye=()=>{var u;(u=S.value)==null||u.clear()},he=u=>{N[u].clear()},ae=(u,n)=>{let o=window.location.href;o=o.includes("orderCode")?o:o.replace("orderNo","orderCode"),et({callbackUrl:o,certiNo:u,faceAuthMode:"TENCENT",userName:n,tenantId:9991000007}).then(t=>{const{code:d,data:c}=t;if(d==="10000"){const{originalUrl:e,serialNo:s}=c;window.location.href=e,J.set("verifyData",{serialNo:s,certNo:u,name:n})}})},me=u=>{const{id:n,objectType:o}=u;P.value="",M.value="";const t={1:"pdf",2:"richText",3:"link"};ut({insurerCode:Y,id:n,objectType:o,productCategory:ee,orderNo:T,tenantId:v}).then(({code:d,data:c})=>{if(d==="10000"){const{textType:e,content:s,questionType:a}=(c==null?void 0:c[0])||{};a===2?(P.value="question",M.value=c):(e===1&&s.includes("png")?P.value="picture":P.value=t[e],M.value=s)}})},k=u=>`${u}`===Je.CERT,re=u=>{var n,o,t,d;u===-1?ae((n=l.value.tenantOrderHolder)==null?void 0:n.certNo,(o=l.value.tenantOrderHolder)==null?void 0:o.name):ae((t=l.value.tenantOrderInsuredList[u])==null?void 0:t.certNo,(d=l.value.tenantOrderInsuredList[u])==null?void 0:d.name)},ge=u=>{u&&N.every(n=>n!==u)&&N.push(u)},Te=()=>{var n,o,t,d,c;if((n=S.value)==null?void 0:n.isEmpty()){x.fail("\u8BF7\u6295\u4FDD\u4EBA\u7B7E\u540D");return}if(N.some(e=>e.isEmpty())){x.fail("\u8BF7\u88AB\u4FDD\u4EBA\u7B7E\u540D");return}if(((t=(o=l.value.tenantOrderHolder)==null?void 0:o.extInfo)==null?void 0:t.isCert)!==r.CERT&&k((d=l.value.tenantOrderHolder)==null?void 0:d.certType)){x.fail("\u8BF7\u6295\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}if((c=l.value.tenantOrderInsuredList)==null?void 0:c.some(e=>{var s;return((s=e.extInfo)==null?void 0:s.isCert)!==r.CERT&&k(e.certType)})){x.fail("\u8BF7\u88AB\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}Ce({orderNo:w||T,saleUserId:Q,tenantId:v}).then(e=>{const{code:s,data:a}=e;s==="10000"&&(a.orderStatus!==tt.PENDING?ze("paymentResult",te()):qe.confirm({title:"\u63D0\u793A",message:"\u8BF7\u786E\u8BA4\u4FE1\u606F\u586B\u5199\u65E0\u8BEF\u540E\uFF0C\u518D\u8FDB\u884C\u652F\u4ED8"}).then(()=>{var A,y;const B=(A=S.value)==null?void 0:A.save();Promise.all([fe("HOLDER",B,(y=l.value)==null?void 0:y.id,`${v}`),...N.map(F=>{var R;return fe("INSURED",F.save(),(R=l.value)==null?void 0:R.id,`${v}`)})]).then(()=>{We(I(h({},l.value),{pageCode:"sign",operateOption:{withSignInfo:!0},extInfo:I(h({},l.value.extInfo),{pageCode:"sign",templateId:ve,shareFlag:G?"Y":"N"}),venderCode:Y})).then(F=>{const{code:R,data:U}=F;s==="10000"&&U.success&&pe.push({path:Ke[U.pageAction.data.nextPageCode],query:{orderNo:w||T,saleUserId:Q,tenantId:v}})})})}))})},z=(u=!1)=>{Ce({orderNo:w||T,saleUserId:Q,tenantId:v}).then(n=>{var d,c;const{code:o,data:t}=n;o==="10000"&&(l.value=t,u&&(((c=(d=t==null?void 0:t.tenantOrderHolder)==null?void 0:d.extInfo)==null?void 0:c.isCert)===r.NO_CERT||(t==null?void 0:t.tenantOrderInsuredList.some(e=>{var s;return((s=e.extInfo)==null?void 0:s.isCert)===r.NO_CERT}))?x("\u7528\u6237\u672A\u5B8C\u8EAB\u4EFD\u8BA4\u8BC1\u53CA\u7B7E\u5B57"):(!(t==null?void 0:t.tenantOrderAttachmentList.find(e=>e.category===X.ELECTRIC_SIGN&&e.objectType===V.HOLDER))||!(t==null?void 0:t.tenantOrderAttachmentList.find(e=>e.category===X.ELECTRIC_SIGN&&e.objectType===V.INSURED)))&&x("\u7528\u6237\u672A\u5B8C\u8EAB\u4EFD\u8BA4\u8BC1\u53CA\u7B7E\u5B57")),setTimeout(()=>{let e=0;t.tenantOrderAttachmentList.forEach(s=>{s.category===X.ELECTRIC_SIGN&&(s.objectType===V.HOLDER?(S.value.clear(),S.value.setDataURL(s.fileBase64)):s.objectType===V.INSURED&&(N[e].clear(),N[e].setDataURL(s.fileBase64),e+=1))})}))})},Ne=()=>{z(!0)},Re=He(()=>{const u=I(h({},te()),{isShare:1,sharePageCode:"sign"});return`${window.location.origin}/phoneVerify?${Ve.stringify(u)}`}),Oe=()=>{const u={orderNo:w||T,productCode:Fe,tenantId:v,objectType:1},n={insurerCode:Y,orderNo:T,productCategory:ee,tenantId:v,noticeType:4,objectType:1};_e(h({},u)).then(({code:o,data:t})=>{o==="10000"&&(se.value=t||[])}),_e(I(h({},u),{objectType:2})).then(({code:o,data:t})=>{o==="10000"&&(ue.value=t||[])}),De(h({},n)).then(({code:o,data:t})=>{o==="10000"&&(Ae.value=t||[])}),De(I(h({},n),{noticeType:5,objectType:2})).then(({code:o,data:t})=>{o==="10000"&&(oe.value=t||[])})};return Me(()=>{z(),Oe();const u=J.get("verifyData");if(u){const{serialNo:n,certNo:o,name:t}=u;Ze({certiNo:o,orderNo:w||T,serialNo:n,tenantId:v,userName:t}).then(d=>{const{code:c,data:e}=d;c==="10000"&&(J.remove("verifyData"),z())})}}),(u,n)=>{const o=W("ProPDFviewer"),t=W("van-button"),d=W("ProPageWrap");return C(),H(d,null,{default:_(()=>{var c;return[i("div",st,[D(Ge,{type:"warning",title:"\u5C0A\u656C\u7684\u5BA2\u6237\uFF0C\u672C\u6B21\u6295\u4FDD\u9700\u8981\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",content:"\u672C\u4EA7\u54C1\u6295\u4FDD\u9700\u8981\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u8FDB\u884C\u5B9E\u540D\u8BA4\u8BC1\uFF0C\u60A8\u8D2D\u4E70\u672C\u4EA7\u54C1\u7684\u7D2F\u8BA1\u603B\u4FDD\u8D39\u5DF2\u8D85\u8FC720\u4E07\uFF0C\u6309\u76D1\u7BA1\u8981\u6C42\uFF0C\u9700\u8981\u63D0\u4F9B\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u3001\u6307\u5B9A\u53D7\u76CA\u4EBA\u8BC1\u4EF6\u5F71\u50CF\uFF0C\u672C\u4EA7\u54C1\u975E\u672C\u4EBA\u6295\u4FDD\u4E14\u5E26\u8EAB\u6545\u8D23\u4EFB\u3001\u9700\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\uFF08\u6210\u4EBA\uFF09\u7684\u6295\u4FDD\u610F\u613F\u8FDB\u884C\u7B7E\u5B57\u786E\u8BA4\u3002"}),D(q,{title:"\u6295\u4FDD\u4EBA",class:"card"},{extra:_(()=>{var e,s,a,B,A,y,F,R,U,ie;return[i("div",ot,[i("div",nt,g((s=(e=l.value)==null?void 0:e.tenantOrderHolder)==null?void 0:s.name),1),k((B=(a=l.value)==null?void 0:a.tenantOrderHolder)==null?void 0:B.certType)?(C(),p("div",{key:0,class:de(["status",{verified:((F=(y=(A=l.value)==null?void 0:A.tenantOrderHolder)==null?void 0:y.extInfo)==null?void 0:F.isCert)===r.CERT}])},g(((ie=(U=(R=l.value)==null?void 0:R.tenantOrderHolder)==null?void 0:U.extInfo)==null?void 0:ie.isCert)===r.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)):L("",!0)])]}),default:_(()=>{var e,s,a,B,A,y,F;return[i("div",at,[rt,i("div",it,g((s=(e=l.value)==null?void 0:e.tenantOrderHolder)==null?void 0:s.certNo),1),((A=(B=(a=l.value)==null?void 0:a.tenantOrderHolder)==null?void 0:B.extInfo)==null?void 0:A.isCert)!==r.CERT&&k((F=(y=l.value)==null?void 0:y.tenantOrderHolder)==null?void 0:F.certType)?(C(),p("div",{key:0,class:"action",onClick:n[0]||(n[0]=R=>re(-1))},[lt,D(K,{name:"right_arrow",class:"icon"})])):L("",!0)])]}),_:1}),D(q,{title:"\u6295\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:_(()=>[i("div",{class:"resign",onClick:ye},"\u91CD\u7B7E")]),default:_(()=>[D(Be,{ref_key:"holderSign",ref:S,class:"sign"},null,512),i("div",ct,[i("div",dt,"\u7B7E\u540D\u65E5\u671F\uFF1A "+g(O(ne)),1),i("div",Bt,[Ct,(C(!0),p(j,null,$(se.value,(e,s)=>(C(),H(o,{key:`holderFileList-${s}`,class:"file",title:`\u300A${e.materialName}\u300B`,content:e.materialContent,type:O(Ee)(e.materialContent,e.materialSource+""),onClick:n[1]||(n[1]=()=>"")},null,8,["title","content","type"]))),128))])])]),_:1}),(C(!0),p(j,null,$((c=l.value)==null?void 0:c.tenantOrderInsuredList,(e,s)=>(C(),p("div",{key:s},[D(q,{title:"\u88AB\u4FDD\u4EBA",class:"card"},{extra:_(()=>{var a,B;return[i("div",Et,[i("div",ft,g(e.name),1),k(e.certType)?(C(),p("div",{key:0,class:de(["status",{verified:((a=e.extInfo)==null?void 0:a.isCert)===r.CERT}])},g(((B=e.extInfo)==null?void 0:B.isCert)===r.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)):L("",!0)])]}),default:_(()=>{var a;return[i("div",_t,[Dt,i("div",pt,g(e.certNo),1),((a=e.extInfo)==null?void 0:a.isCert)!==r.CERT&&k(e.certType)?(C(),p("div",{key:0,class:"action",onClick:B=>re(s)},[Ft,D(K,{name:"right_arrow",class:"icon"})],8,vt)):L("",!0)])]}),_:2},1024),D(q,{title:"\u88AB\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:_(()=>[i("div",{class:"resign",onClick:a=>he(s)},"\u91CD\u7B7E",8,At)]),default:_(()=>[D(Be,{ref_for:!0,ref:ge,class:"sign"}),i("div",yt,[i("div",ht,"\u7B7E\u540D\u65E5\u671F\uFF1A "+g(O(ne)),1),i("div",mt,[gt,(C(!0),p(j,null,$(ue.value,(a,B)=>(C(),H(o,{key:`insuredFileList-${B}`,class:"file",title:`\u300A${a.materialName}\u300B`,content:a.materialContent,type:O(Ee)(a.materialContent,a.materialSource+""),onClick:n[2]||(n[2]=()=>"")},null,8,["title","content","type"]))),128)),(C(!0),p(j,null,$(oe.value,(a,B)=>(C(),H(o,{key:`insuredQuestionList-${B}`,class:"file",title:`\u300A${a.title}\u300B`,content:M.value,type:P.value,onClick:()=>me(a)},null,8,["title","content","type","onClick"]))),128))])])]),_:2},1024)]))),128)),i("div",Tt,[O(G)?L("",!0):(C(),p("div",{key:0,class:"refresh-btn",onClick:Ne},[i("div",null,[D(K,{name:"refresh"})]),Nt])),O(G)?L("",!0):(C(),H(Xe,{key:1,title:"\u9080\u8BF7\u60A8\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",desc:"\u9080\u8BF7\u60A8\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",link:O(Re)},{default:_(()=>[D(t,{plain:"",type:"primary",class:"share-btn"},{default:_(()=>[Rt]),_:1})]),_:1},8,["link"])),D(t,{type:"primary",class:"submit-btn",onClick:Te},{default:_(()=>[Ot]),_:1})])])]}),_:1})}}});var Ht=Qe(St,[["__scopeId","data-v-0ea93eae"]]);export{Ht as default};
