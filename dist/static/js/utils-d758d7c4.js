import{d as e,r as a,ay as i,R as t,c as r,A as n,f as o,g as l,i as s,h as d,E as u,U as c,w as p,k as y,j as m,a9 as h,az as C,ae as k,C as f}from"./index-591873b8.js";import{P as b}from"./index-a096cbfa.js";import{q as I}from"./createProposal-a2a12b2f.js";import{b as g,c as v}from"./trial-54c38a43.js";const T={class:"trial-button-wrap"},O={class:"footer-area"},P=o("span",null,"分享",-1),L={class:"price"},D={key:0},R=e({name:"trialButton"}),V=e({...R,props:{premium:{default:0},tenantProductDetail:{default:()=>({})},planCode:{default:void 0},loadingText:{default:""},paymentFrequency:{default:""},shareInfo:{default:()=>({})},isShare:{type:Boolean,default:!1},handleShare:null},emits:["handleClick"],setup(e,{emit:f}){const I=e,g=a(""),v=a(""),R=i(),V=a(),F=()=>{I.handleShare?I.handleShare((()=>V.value.handleShare())):V.value.handleShare()};return t([()=>I.premium,()=>I.tenantProductDetail,()=>I.paymentFrequency,()=>I.planCode],(([e])=>{const{PREMIUM:a=[]}=I.tenantProductDetail||{};let i={};if(null==a?void 0:a.length){i=(a||[]).find((e=>e.planCode===I.planCode||!e.planCode))||{};const t=((null==i?void 0:i.data)||[]).find((e=>e.paymentFrequency===I.paymentFrequency)),{premium:r,minActualUnit:n}=t||{};e?(v.value=n,g.value=e&&`${e}`):(v.value=r,g.value="")}else e&&(v.value="",g.value=e&&`${e}`)}),{deep:!0,immediate:!0}),(a,i)=>{const t=k;return r(),n("div",T,[o("div",O,[e.isShare&&l(R)?(r(),n("div",{key:0,class:"com-share",onClick:F},[s(t,{name:"share-icon","font-size":"24px",color:"#AEAEAE"}),P])):d("",!0),o("div",L,[e.loadingText?(r(),n("span",D,u(e.loadingText),1)):(r(),n(c,{key:1},[o("span",null,u(l(g)),1),o("span",null,u(l(v)),1)],64))]),s(b,{shadow:!1,class:"right",onClick:i[0]||(i[0]=e=>f("handleClick"))},{default:p((()=>[y(a.$slots,"default",{},(()=>[m("立即投保")]))])),_:3})]),s(C,h({ref_key:"shareRef",ref:V},e.shareInfo),null,16)])}}}),F=(e,a)=>{const i=[];return e.forEach((e=>{var t;null==(t=e.tenantOrderRiskList)||t.forEach((e=>{const{currentAmount:t,paymentPeriod:r,paymentPeriodType:n,liabilityDetails:o,extInfo:l,insurancePeriodValue:s,insurancePeriodType:d,paymentFrequency:u,riskType:c,riskCode:p,initialPremium:y,initialAmount:m,annuityDrawFrequency:h,annuityDrawDate:C}=e;let k=`${g[n]}_${r}`;1===n&&(k="single");let f=`${v[d]}_${s}`;5===d&&(f="to_life"),i.push({amount:m,annuityDrawDate:C,annuityDrawFrequency:h,chargePeriod:k,copy:(null==l?void 0:l.copy)||"",coveragePeriod:f,insuredCode:a,liabilityVOList:o,mainRisk:"",mainRiskCode:"",mainRiskId:"",paymentFrequency:u,premium:y,riskType:c,riskCode:p,riskId:(null==l?void 0:l.riskId)||"",riderRisk:"",riderRiskVOList:[]})}))})),i},w=({holder:e,insuredList:a=[]})=>{const i=["birthday","certEndDate","certEndType","certNo","certStartDate","verificationCode","certType","email","gender","mobile","name","id","insuredBeneficiaryType","relationToHolder","relationToMainInsured","tenantOrderBeneficiaryList","extInfo"],t=e=>{const a={extInfo:{}};return"[object Object]"==={}.toString.call(e)&&Object.keys(e).forEach((t=>{i.includes(t)?a[t]=e[t]:a.extInfo[t]=e[t]})),a};return{tenantOrderHolder:t(e),tenantOrderInsuredList:(a||[]).map((e=>t(e)))}},x=(e,a,i)=>{var t;const{tenantId:r,commencementTime:n,expiryDate:o,venderCode:l,tenantOrderHolder:s,tenantOrderInsuredList:d}=e;return{tenantId:r,productCode:null==a?void 0:a.productCode,insuranceStartDate:n,insuranceEndDate:o,holder:{personVO:{...s,socialFlag:null==(t=s.extInfo)?void 0:t.hasSocialInsurance,certType:s.certType||f.CERT}},insuredVOList:d.map((a=>({insuredCode:"",relationToHolder:a.relationToHolder,personVO:{...a,socialFlag:a.extInfo.hasSocialInsurance,certType:a.certType||f.CERT},productPlanVOList:[{insurerCode:l,planCode:i||"",riskVOList:F(a.tenantOrderProductList||[],e.venderCode)}]})))}},A=async({proposalId:e,productCode:a,tenantId:i},t)=>{const r=(await I({id:e,tenantId:i})).data,n={holder:{},insuredVOList:[],productCode:a};n.holder={personVO:null==r?void 0:r.proposalHolder},n.insuredVOList=null==r?void 0:r.proposalInsuredList.map((e=>({personVO:{age:e.age,birthday:e.birthday,bmi:e.bmi,certNo:e.certNo,certType:e.certType,email:e.email,gender:e.gender,hasSocialInsurance:e.hasSocialInsurance,height:e.height,holderRelation:e.holderRelation,insureAreaCode:e.insureAreaCode,insureCityCode:e.insureCityCode,insureProvinceCode:e.insureProvinceCode,mobile:e.mobile,name:e.name,occupationClass:e.occupationClass,occupationCodeList:e.occupationCode,smokeFlag:e.smokeFlag,socialFlag:e.socialFlag,weight:e.weight},productPlanVOList:e.proposalInsuredProductList.map((e=>({insurerCode:null,planCode:"",relationToHolder:"1",riskVOList:e.proposalProductRiskList.map((e=>({amount:e.amount,annuityDrawDate:e.annuityDrawDate,annuityDrawType:e.annuityDrawType,chargePeriod:e.chargePeriod,copy:e.copy,coveragePeriod:e.coveragePeriod,liabilityVOList:e.liabilityVOList.map((e=>({liabilityAmount:null,liabilityAttributeType:e.liabilityAttributeType,liabilityAttributeValueList:e.liabilityAttributeValueList,liabilityCode:e.liabilityCode,liabilityId:e.liabilityId,liabilityRateType:null,liabilityValue:null}))),mainRiskCode:e.mainRiskCode,mainRiskId:e.mainRiskId,paymentFrequency:e.paymentFrequency,premium:e.premium,riskCategory:e.riskCategory,riskCode:e.riskCode,riskId:e.riskId,riskName:e.riskName,riskType:e.riskType})))})))}))),null==t||t(n)};export{V as _,w as f,x as o,A as p};
