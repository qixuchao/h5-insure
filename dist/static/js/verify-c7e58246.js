import{ref as e,watch as o}from"vue";import{a8 as a,a9 as t,aa as s,ab as n,ac as i,ad as l,ae as r,af as u,ag as c,ah as v,ai as d,aj as m,ak as p,al as g,am as h,an as f,ao as w,ap as N,aq as C,ar as V,as as y,at as x,au as b,av as S,aw as I,ax as P,ay as z,az as T,aA as k,aB as R,aC as $,aD as B,r as E,aE as X}from"./index-d66a20d8.js";const[Z,Y]=a("image"),D={src:String,alt:String,fit:String,position:String,round:Boolean,block:Boolean,width:i,height:i,radius:i,lazyLoad:Boolean,iconSize:i,showError:l,errorIcon:r("photo-fail"),iconPrefix:String,showLoading:l,loadingIcon:r("photo")};const H=c(vue.defineComponent({name:Z,props:D,emits:["load","error"],setup(e,{emit:o,slots:a}){const i=vue.ref(!1),l=vue.ref(!0),r=vue.ref(),{$Lazyload:c}=vue.getCurrentInstance().proxy,v=vue.computed((()=>{const o={width:t(e.width),height:t(e.height)};return s(e.radius)&&(o.overflow="hidden",o.borderRadius=t(e.radius)),o}));vue.watch((()=>e.src),(()=>{i.value=!1,l.value=!0}));const d=e=>{l.value=!1,o("load",e)},m=e=>{i.value=!0,l.value=!1,o("error",e)},p=(o,a,t)=>t?t():vue.createVNode(u,{name:o,size:e.iconSize,class:a,classPrefix:e.iconPrefix},null),g=()=>{if(i.value||!e.src)return;const o={alt:e.alt,class:Y("img"),style:{objectFit:e.fit,objectPosition:e.position}};return e.lazyLoad?vue.withDirectives(vue.createVNode("img",vue.mergeProps({ref:r},o),null),[[vue.resolveDirective("lazy"),e.src]]):vue.createVNode("img",vue.mergeProps({src:e.src,onLoad:d,onError:m},o),null)},h=({el:e})=>{const o=()=>{e===r.value&&l.value&&d()};r.value?o():vue.nextTick(o)},f=({el:e})=>{e!==r.value||i.value||m()};return c&&n&&(c.$on("loaded",h),c.$on("error",f),vue.onBeforeUnmount((()=>{c.$off("loaded",h),c.$off("error",f)}))),()=>{var o;return vue.createVNode("div",{class:Y({round:e.round,block:e.block}),style:v.value},[g(),l.value&&e.showLoading?vue.createVNode("div",{class:Y("loading")},[p(e.loadingIcon,Y("loading-icon"),a.loading)]):i.value&&e.showError?vue.createVNode("div",{class:Y("error")},[p(e.errorIcon,Y("error-icon"),a.error)]):void 0,null==(o=a.default)?void 0:o.call(a)])}}})),W=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),L=a("image-preview")[1];var O=vue.defineComponent({props:{src:String,show:Boolean,active:Number,minZoom:v(i),maxZoom:v(i),rootWidth:v(Number),rootHeight:v(Number)},emits:["scale","close"],setup(e,{emit:o,slots:a}){const t=vue.reactive({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),s=d(),n=vue.ref(),i=vue.computed((()=>{const{rootWidth:o,rootHeight:a}=e,s=a/o;return t.imageRatio>s})),l=vue.computed((()=>{const{scale:e,moveX:o,moveY:a,moving:s,zooming:n}=t,i={transitionDuration:n||s?"0s":".3s"};if(1!==e){const t=o/e,s=a/e;i.transform=`scale(${e}, ${e}) translate(${t}px, ${s}px)`}return i})),r=vue.computed((()=>{if(t.imageRatio){const{rootWidth:o,rootHeight:a}=e,s=i.value?a/t.imageRatio:o;return Math.max(0,(t.scale*s-o)/2)}return 0})),u=vue.computed((()=>{if(t.imageRatio){const{rootWidth:o,rootHeight:a}=e,s=i.value?a:o*t.imageRatio;return Math.max(0,(t.scale*s-a)/2)}return 0})),c=a=>{(a=h(a,+e.minZoom,+e.maxZoom+1))!==t.scale&&(t.scale=a,o("scale",{scale:a,index:e.active}))},v=()=>{c(1),t.moveX=0,t.moveY=0};let w,N,C,V,y,x,b;const S=e=>{const{touches:o}=e,{offsetX:a}=s;s.start(e),w=o.length,N=t.moveX,C=t.moveY,b=Date.now(),t.moving=1===w&&1!==t.scale,t.zooming=2===w&&!a.value,t.zooming&&(V=t.scale,y=W(e.touches))},I=()=>{if(w>1)return;const{offsetX:e,offsetY:a}=s,n=Date.now()-b;e.value<5&&a.value<5&&n<250&&(x?(clearTimeout(x),x=null,(()=>{const e=t.scale>1?1:2;c(e),t.moveX=0,t.moveY=0})()):x=setTimeout((()=>{o("close"),x=null}),250))},P=o=>{let a=!1;(t.moving||t.zooming)&&(a=!0,t.moving&&N===t.moveX&&C===t.moveY&&(a=!1),o.touches.length||(t.zooming&&(t.moveX=h(t.moveX,-r.value,r.value),t.moveY=h(t.moveY,-u.value,u.value),t.zooming=!1),t.moving=!1,N=0,C=0,V=1,t.scale<1&&v(),t.scale>e.maxZoom&&(t.scale=+e.maxZoom))),g(o,a),I(),s.reset()},z=e=>{const{naturalWidth:o,naturalHeight:a}=e.target;t.imageRatio=a/o};return vue.watch((()=>e.active),v),vue.watch((()=>e.show),(e=>{e||v()})),m("touchmove",(e=>{const{touches:o}=e;if(s.move(e),(t.moving||t.zooming)&&g(e,!0),t.moving){const{deltaX:e,deltaY:o}=s,a=e.value+N,n=o.value+C;t.moveX=h(a,-r.value,r.value),t.moveY=h(n,-u.value,u.value)}if(t.zooming&&2===o.length){const e=W(o);c(V*e/y)}}),{target:vue.computed((()=>{var e;return null==(e=n.value)?void 0:e.$el}))}),()=>{const o={loading:()=>vue.createVNode(f,{type:"spinner"},null)};return vue.createVNode(p,{ref:n,class:L("swipe-item"),onTouchstartPassive:S,onTouchend:P,onTouchcancel:P},{default:()=>[a.image?vue.createVNode("div",{class:L("image-wrap")},[a.image({src:e.src})]):vue.createVNode(H,{src:e.src,fit:"contain",class:L("image",{vertical:i.value}),style:l.value,onLoad:z},o)]})}}});const[_,j]=a("image-preview"),F=["show","transition","overlayStyle","closeOnPopstate"],U={show:Boolean,loop:l,images:x(),minZoom:b(1/3),maxZoom:b(3),overlay:l,closeable:Boolean,showIndex:l,className:S,closeIcon:r("clear"),transition:String,beforeClose:Function,overlayClass:S,overlayStyle:Object,swipeDuration:b(300),startPosition:b(0),showIndicators:Boolean,closeOnPopstate:l,closeIconPosition:r("top-right")};var M=vue.defineComponent({name:_,props:U,emits:["scale","close","closed","change","update:show"],setup(e,{emit:o,slots:a}){const t=vue.ref(),s=vue.reactive({active:0,rootWidth:0,rootHeight:0}),n=()=>{if(t.value){const e=I(t.value.$el);s.rootWidth=e.width,s.rootHeight=e.height,t.value.resize()}},i=e=>o("scale",e),l=e=>o("update:show",e),r=()=>{T(e.beforeClose,{args:[s.active],done:()=>l(!1)})},c=e=>{e!==s.active&&(s.active=e,o("change",e))},v=()=>{if(e.showIndex)return vue.createVNode("div",{class:j("index")},[a.index?a.index({index:s.active}):`${s.active+1} / ${e.images.length}`])},d=()=>{if(a.cover)return vue.createVNode("div",{class:j("cover")},[a.cover()])},m=()=>{if(e.closeable)return vue.createVNode(u,{role:"button",name:e.closeIcon,class:[j("close-icon",e.closeIconPosition),z],onClick:r},null)},p=()=>o("closed"),g=(e,o)=>{var a;return null==(a=t.value)?void 0:a.swipeTo(e,o)};return w({swipeTo:g}),vue.onMounted(n),vue.watch([N,C],n),vue.watch((()=>e.startPosition),(e=>c(+e))),vue.watch((()=>e.show),(a=>{const{images:t,startPosition:i}=e;a?(c(+i),vue.nextTick((()=>{n(),g(+i,{immediate:!0})}))):o("close",{index:s.active,url:t[s.active]})})),()=>vue.createVNode(V,vue.mergeProps({class:[j(),e.className],overlayClass:[j("overlay"),e.overlayClass],onClosed:p,"onUpdate:show":l},y(e,F)),{default:()=>[m(),vue.createVNode(P,{ref:t,lazyRender:!0,loop:e.loop,class:j("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:c},{default:()=>[e.images.map((o=>vue.createVNode(O,{src:o,show:e.show,active:s.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:s.rootWidth,rootHeight:s.rootHeight,onScale:i,onClose:r},{image:a.image})))]}),v(),d()]})}});let A;const q={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};const G=(e,o=0)=>{if(n)return A||({instance:A}=R({setup(){const{state:e,toggle:o}=$(),a=()=>{e.images=[]};return()=>vue.createVNode(M,vue.mergeProps(e,{onClosed:a,"onUpdate:show":o}),null)}})),e=Array.isArray(e)?{images:e,startPosition:o}:e,A.open(k({},q,e)),A};G.Component=c(M),G.install=e=>{e.use(G.Component)};const J={class:"sign-wrap"},K=["src"],Q={class:"popup-body"},ee={class:"sign-container-wrap"},oe={class:"operate-bar"},ae={class:"btns"},te=vue.defineComponent({name:"sign"}),se=vue.defineComponent({...te,props:{option:{default:{}},modelValue:{default:""}},emits:["update:modelValue","submitSign"],setup(a,{expose:t,emit:s}){const n=a,i=e(!1),l=e(),r=e(""),u=e(!0),c=()=>{var e;i.value=!0,null==(e=l.value)||e.clear(),setTimeout((()=>{var e;null==(e=l.value)||e.setDataURL(r.value),n.modelValue?u.value=!1:u.value=!0}))},v=()=>{G({images:[r.value],className:"customer-sign-preview"})},d=()=>{i.value=!1},m=()=>{var e,o;null==(o=null==(e=l.value)?void 0:e.clear)||o.call(e),r.value="",u.value=!0,s("update:modelValue","")},p=()=>{var e;r.value=null==(e=l.value)?void 0:e.save(),s("update:modelValue",r.value),s("submitSign",r.value),i.value=!1};return o((()=>n.modelValue),(()=>{r.value=n.modelValue}),{immediate:!0}),t({rewrite:m,openSign:c}),(e,o)=>{const a=vue.resolveComponent("van-button"),t=vue.resolveComponent("van-icon"),s=vue.resolveComponent("van-popup");return vue.openBlock(),vue.createElementBlock(vue.Fragment,null,[vue.createElementVNode("div",J,[vue.renderSlot(e.$slots,"signImg",{data:vue.unref(r)},(()=>[vue.unref(r)?(vue.openBlock(),vue.createElementBlock("img",{key:0,class:"preview-sign",src:vue.unref(r),alt:"",onClick:v},null,8,K)):vue.createCommentVNode("",!0),vue.createVNode(a,{type:"primary",round:"",size:"small",onClick:c},{default:vue.withCtx((()=>[vue.createTextVNode(vue.toDisplayString(vue.unref(r)?"重新签名":"点击签字"),1)])),_:1})]))]),vue.createVNode(s,{show:vue.unref(i),"onUpdate:show":o[1]||(o[1]=e=>vue.isRef(i)?i.value=e:null),position:"bottom",style:{height:"100%",overflow:"hidden"}},{default:vue.withCtx((()=>[vue.createElementVNode("div",Q,[vue.createElementVNode("div",ee,[vue.createVNode(B,{ref_key:"signRef",ref:l,placeholder:"请在此处签名",onStroke:o[0]||(o[0]=e=>u.value=!1)},null,512),vue.createElementVNode("div",oe,[vue.createElementVNode("span",null,[vue.createVNode(t,{name:"info",color:"#ffaf22"}),vue.createTextVNode(" 请投保人正楷签署您的签名:")]),vue.createElementVNode("div",ae,[vue.createVNode(a,{type:"default",class:"btn",onClick:d},{default:vue.withCtx((()=>[vue.createTextVNode("返回")])),_:1}),vue.createVNode(a,{type:"default",class:"btn",onClick:m},{default:vue.withCtx((()=>[vue.createTextVNode("重写")])),_:1}),vue.createVNode(a,{type:"primary",class:"btn",disabled:vue.unref(u),onClick:p},{default:vue.withCtx((()=>[vue.createTextVNode("确定签字")])),_:1},8,["disabled"])])])])])])),_:1},8,["show"])],64)}}}),ne=e=>E({url:"/api/app/insure/insurance/customerFace",method:"POST",data:e}),ie=e=>E({url:"/api/app/insure/insurance/saveCustomerFaceResult",method:"POST",data:e}),le=(e,o,a,t,s)=>{const n={bizObjectType:e,bizObjectId:s,docCategory:"ELECTRIC_SIGN",docType:"png",fileBase64:o,docName:`${X[e]}电子签名`,orderId:a,tenantId:t};return E({url:"/api/app/insure/insurance/saveCustomerSignResult",method:"POST",data:n})};export{se as _,ne as a,ie as f,le as s};
