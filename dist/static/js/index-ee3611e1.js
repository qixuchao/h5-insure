import{T as e,d as a,j as l,k as s,B as n,ct as t,cu as u,o as i,c as o,a as r,g as v,u as d,f as c,b as g,w as p,a8 as m,e as f,F as h,q as S,m as w,cv as y,p as b,_,cw as k,ag as V,cx as C}from"./index-0cb46857.js";var x=e;const A={class:"sign-wrap"},T=["src"],U={class:"popup-body"},R={class:"sign-container-wrap"},j={class:"operate-bar"},E=a({name:"sign"});var I=_(a({...E,props:{option:{default:{}},modelValue:{default:()=>[]},signString:{default:"房间卡贺卡和大伙副书记环境发好"},signAccount:{default:3}},emits:["update:modelValue","submitSign"],setup(e,{expose:a,emit:_}){const E=e,I=l(!1),N=l(),q=l([]),z=l(0),B=s((()=>{if(E.signString&&E.signString.length>=E.signAccount){const e=[];let a=0;for(let l=0;l<=E.signString.length;l++)!l||l%E.signAccount||(a+=1),E.signString[l]&&(e[a]?e[a]+=E.signString[l]:e[a]=E.signString[l]);return e}return[E.signString||""]})),D=s((()=>{var e;const a=q.value.filter((e=>e));return(null==(e=B.value)?void 0:e.length)>(null==a?void 0:a.length)})),F=l(!0),L=l(),$=()=>{0!==z.value&&L.value&&(z.value-=1,L.value.swipeTo(z.value))},G=()=>{I.value=!0,setTimeout((()=>{var e;N.value&&((N.value||[]).forEach(((e,a)=>{var l,s;null==(s=e.setDataURL)||s.call(e,(null==(l=q.value)?void 0:l[a])||"")})),(null==(e=E.modelValue)?void 0:e.length)?F.value=!1:F.value=!0)}),200)},H=()=>{k({images:q.value,className:"customer-sign-preview"})},J=()=>{I.value=!1},K=()=>{if(z.value===B.value.length-1)return;z.value,E.signAccount;B.value[z.value].length,L.value&&(z.value+=1,L.value.swipeTo(z.value))},M=()=>{(N.value||[]).forEach(((e,a)=>{var l;a===z.value&&(null==(l=e.clear)||l.call(e))}))},O=()=>{var e,a;(null==(e=q.value)?void 0:e.length)<(null==(a=B.value)?void 0:a.length)?x({message:"请完成签名",className:"toast-vertical"}):(_("update:modelValue",q.value),_("submitSign",q.value),I.value=!1)};return n([()=>E.modelValue,()=>B.value],(()=>{q.value=(E.modelValue||[]).slice(0,B.value.length)}),{immediate:!0,deep:!0}),a({rewrite:M,openSign:G}),(e,a)=>{var l;const s=V,n=t,_=u,k=C;return i(),o(h,null,[r("div",A,[v(e.$slots,"signImg",{data:null==(l=d(q))?void 0:l[0]},(()=>{var a;return[d(q).length?(i(),o("img",{key:0,class:"preview-sign",src:null==(a=d(q))?void 0:a[0],alt:"",onClick:H},null,8,T)):c("",!0),g(s,{type:"primary",round:"",size:"small",onClick:G},{default:p((()=>[m(f(e.signString?"重新签名":"点击签字"),1)])),_:1})]}),!0)]),g(k,{show:d(I),"onUpdate:show":a[1]||(a[1]=e=>b(I)?I.value=e:null),position:"bottom",style:{height:"100%",overflow:"hidden"}},{default:p((()=>[r("div",U,[r("div",R,[g(_,{ref_key:"swipeRef",ref:L,vertical:"",loop:!1,"show-indicators":!1,touchable:!1},{default:p((()=>[(i(!0),o(h,null,S(d(B),((e,l)=>(i(),w(n,{key:l},{default:p((()=>[g(y,{ref_for:!0,ref_key:"signRef",ref:N,modelValue:d(q)[l],"onUpdate:modelValue":e=>d(q)[l]=e,placeholder:e,onStroke:a[0]||(a[0]=e=>F.value=!1),onSignSuccess:K},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1024)))),128))])),_:1},512),r("div",j,[g(s,{type:"primary",class:"btn",disabled:d(D),onClick:O},{default:p((()=>[m("确定")])),_:1},8,["disabled"]),g(s,{type:"primary",plain:"",class:"btn",onClick:$},{default:p((()=>[m("上一页")])),_:1}),g(s,{type:"primary",plain:"",class:"btn",onClick:M},{default:p((()=>[m("重签")])),_:1}),g(s,{type:"default",class:"btn",onClick:J},{default:p((()=>[m("取消")])),_:1})])])])])),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-d45e62ea"]]);export{I as S};
