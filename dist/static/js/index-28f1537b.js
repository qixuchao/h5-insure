import{_ as a,d as e,r as l,x as t,aa as d,c as n,h as o,e as s,g as r,ab as u,k as i,ac as m,w as p,j as c,f as y,ad as b,ae as v,Z as I,af as k,ag as f,K as E,L as g,n as _,a as N,u as h,y as R,O as T,b as A,P as V,ah as D,F as C,i as S,B,t as M,X as O,ai as U,W as L,a3 as j,aj as P,p as K,a5 as x,T as q,a7 as w,a8 as F,C as G,N as W,D as H,a9 as Y}from"./index-4c2d8b53.js";import{B as z,a as $,P as X,E as Z,b as J,c as Q,d as aa,e as ea,f as la}from"./bankCard-a25dcf89.js";import{u as ta}from"./useDicData-4b5f34ce.js";import{a as da}from"./order-2c02b5f1.js";import"./pdfh5-008ca364.js";const na={class:"com-bank-card-info"},oa=(a=>(E("data-v-bb02bba6"),a=a(),g(),a))((()=>c("span",{class:"field-title"},[_("银行卡照片 "),c("span",{class:"sub-title"},"(需上传正反两面)")],-1))),sa={class:"image-wrap"};var ra=a(e({__name:"index",props:{modelValue:{type:Object,default:()=>{}},holderName:{type:String,default:""},factor:{type:Object,default:()=>{}}},emits:["update:modelValue"],setup(a,{emit:e}){const E=a,g=ta("BANK"),_=l({bankCardType:z.DEBIT,bankCardNo:"",accountName:"",payBank:"",mobile:"",images:[]}),N=a=>E.factor&&E.factor[a]&&E.factor[a].isDisplay===I.YES,h=a=>!(!a||2!==a.length)||"请上传银行卡正反面照片",R=t((()=>g.value.map((a=>({label:a.name,value:a.code}))))),T=a=>{k({ossKey:[a],imageType:f.BANK_CARD}).then((a=>{const{data:e,code:l}=a;if("10000"===l&&e&&e.bankCardOcrVO){_.value.bankCardNo=e.bankCardOcrVO.cardNo;const a=R.value.find((a=>a.label===e.bankCardOcrVO.bankName));a&&(_.value.payBank=a.value)}}))};return d((()=>E.modelValue),(a=>{_.value=a}),{immediate:!0}),d(_,(a=>{e("update:modelValue",a)})),(e,l)=>(n(),o("div",na,[N("cardType")?(n(),s(u,{key:0,modelValue:r(_).bankCardType,"onUpdate:modelValue":l[0]||(l[0]=a=>r(_).bankCardType=a),label:"卡片类型",name:"bankCardType","data-source":r($),"is-view":""},null,8,["modelValue","data-source"])):i("",!0),N("bankCardNumber")?(n(),s(m,{key:1,modelValue:r(_).bankCardNo,"onUpdate:modelValue":l[1]||(l[1]=a=>r(_).bankCardNo=a),label:"银行卡号",name:"bankCardNo",type:"number",required:""},null,8,["modelValue"])):i("",!0),N("cardHolder")?(n(),s(m,{key:2,"model-value":a.holderName,label:"持卡人",name:"accountName","is-view":""},null,8,["model-value"])):i("",!0),N("bank")?(n(),s(u,{key:3,modelValue:r(_).payBank,"onUpdate:modelValue":l[2]||(l[2]=a=>r(_).payBank=a),name:"payBank",label:"开户银行","data-source":r(R),required:""},null,8,["modelValue","data-source"])):i("",!0),N("bankCardAttachment")?(n(),s(m,{key:4,label:"银行卡照片",block:"","label-width":"100%",name:"images",rules:[{validator:h}]},{label:p((()=>[oa])),input:p((()=>[c("div",sa,[y(b,{modelValue:r(_).images,"onUpdate:modelValue":l[3]||(l[3]=a=>r(_).images=a),"max-count":2,"upload-type":r(v).BANK_CARD,onOnUploadFinished:T},null,8,["modelValue","upload-type"])])])),_:1},8,["rules"])):i("",!0),N("bankPreMobile")?(n(),s(m,{key:5,modelValue:r(_).mobile,"onUpdate:modelValue":l[4]||(l[4]=a=>r(_).mobile=a),label:"预留手机号",type:"number",required:"",name:"mobile","validate-type":["phone"]},null,8,["modelValue"])):i("",!0)]))}}),[["__scopeId","data-v-bb02bba6"]]);const ua={class:"page-bank-card"},ia={class:"reprise-card-list"},ma=["onClick"],pa={class:"agree"},ca={class:"footer-button footer"},ya=(a=>(E("data-v-7a52b3b4"),a=a(),g(),a))((()=>c("div",{class:"text"},"刷新",-1)));var ba=a(e({__name:"index",setup(a){const e=N(),d=h(),{orderNo:b="2022072710380711215",agentCode:v="D1234567-1",tenantId:k="9991000007",templateId:f=1,isShare:E,insurerCode:g="kunlunhealth"}=e.query,$={bankCardType:z.DEBIT};let ta={};const na=l(""),oa=l({payMethod:X.REAL_TIME,bankData:{...$,imagesId:[],images:[]}}),sa=l({payMethod:X.REAL_TIME,expiryMethod:Z.AUTOMATIC_PADDING,bankData:{...$,imagesId:[],images:[]},payInfoType:J.FIRST_SAME}),ba=l({bankData:{...$,imagesId:[],images:[]}}),va=l(J.FIRST_SAME),Ia=l({}),ka=l(!1),fa=l(),Ea=l(),ga=l(),_a=l({}),Na=(a,e)=>Ia.value&&Ia.value[e]&&Ia.value[e][a]&&Ia.value[e][a].isDisplay===I.YES,ha=()=>{K({orderNo:b,saleUserId:v,tenantId:k}).then((a=>{var l,t,n;const{code:o,data:s}=a;"10000"===o&&([da.PENDING,da.PAYMENT_FAILED,da.UNDER_WRITING_SUCCESS].includes(s.orderStatus)?Promise.all([null==(l=fa.value)?void 0:l.validate(),null==(t=Ea.value)?void 0:t.validate(),null==(n=ga.value)?void 0:n.validate()]).then((a=>{if(!ka.value)return void q.fail("请勾选同意银行转账授权");const l=[{...a[0],id:oa.value.id,paymentType:la.FIRST_TERM},{...a[1],id:sa.value.id,paymentType:la.RENEW_TERM},{...a[2],id:ba.value.id,paymentType:la.REPRISE,payInfoType:va.value}],t=[{category:w.OBVERSE_BANK_CARD,name:"首期签约银行卡正面",objectType:F.INIT_SIGN,type:"png",uri:a[0].images[0],id:oa.value.bankData.imagesId[0]},{category:w.REVERSE_BANK_CARD,name:"首期签约银行卡背面",objectType:F.INIT_SIGN,type:"png",uri:a[0].images[1],id:oa.value.bankData.imagesId[1]}];sa.value.payInfoType===J.OTHER&&(t.push({category:w.OBVERSE_BANK_CARD,name:"续期签约银行卡正面",objectType:F.RENEWAL_SIGN,type:"png",uri:a[1].images[0],id:sa.value.bankData.imagesId[0]}),t.push({category:w.REVERSE_BANK_CARD,name:"续期签约银行卡正面",objectType:F.RENEWAL_SIGN,type:"png",uri:a[1].images[1],id:sa.value.bankData.imagesId[1]})),va.value===J.OTHER&&(t.push({category:w.OBVERSE_BANK_CARD,name:"年金签约银行卡正面",objectType:F.ANNUAL_SIGN,type:"png",uri:a[2].images[0],id:ba.value.bankData.imagesId[0]}),t.push({category:w.REVERSE_BANK_CARD,name:"年金签约银行卡背面",objectType:F.ANNUAL_SIGN,type:"png",uri:a[2].images[1],id:ba.value.bankData.imagesId[1]})),G({...ta,pageCode:"payInfo",tenantOrderPayInfoList:l,extInfo:{...ta.extInfo,templateId:f,pageCode:"payInfo",shareFlag:E?"Y":"N",buttonCode:W.payInfo},operateOption:{withPayInfo:!0,withAttachmentInfo:!0},tenantOrderAttachmentList:t}).then((a=>{const{code:l,data:t}=a;"10000"===l&&t.success&&d.push({path:H[t.pageAction.data.nextPageCode],query:e.query})}))})):x("paymentResult",e.query))}))},Ra=t((()=>{const a={...e.query,isShare:1,sharePageCode:"payInfo"};return`${window.location.origin}/phoneVerify?${Y.stringify(a)}`})),Ta=(a=!1)=>{K({orderNo:b,saleUserId:v,tenantId:k}).then((e=>{const{code:l,data:t}=e;"10000"===l&&t&&(ta=t,na.value=t.tenantOrderHolder.name,t.tenantOrderPayInfoList.forEach((a=>{a.paymentType===la.FIRST_TERM?(oa.value=a,oa.value.bankData={...$,...a,images:[],imagesId:[]}):a.paymentType===la.RENEW_TERM?(sa.value=a,sa.value.bankData={...a,images:[],imagesId:[]}):a.paymentType===la.REPRISE&&(ba.value=a,ba.value.bankData={...a,images:[],imagesId:[]},va.value=a.payInfoType)})),t.tenantOrderAttachmentList.forEach((a=>{a.objectType===F.INIT_SIGN?(a.category===w.OBVERSE_BANK_CARD&&(oa.value.bankData.images[0]=a.uri,oa.value.bankData.imagesId[0]=a.id),a.category===w.REVERSE_BANK_CARD&&(oa.value.bankData.images[1]=a.uri,oa.value.bankData.imagesId[1]=a.id)):a.objectType===F.RENEWAL_SIGN?(a.category===w.OBVERSE_BANK_CARD&&(sa.value.bankData.images[0]=a.uri,sa.value.bankData.imagesId[0]=a.id),a.category===w.REVERSE_BANK_CARD&&(sa.value.bankData.images[1]=a.uri,sa.value.bankData.imagesId[1]=a.id)):a.objectType===F.ANNUAL_SIGN&&(a.category===w.OBVERSE_BANK_CARD&&(ba.value.bankData.images[0]=a.uri,ba.value.bankData.imagesId[0]=a.id),a.category===w.REVERSE_BANK_CARD&&(ba.value.bankData.images[1]=a.uri,ba.value.bankData.imagesId[1]=a.id))})),a&&(t.tenantOrderPayInfoList.find((a=>a.paymentType===la.FIRST_TERM&&a.bankCardNo))||q("用户未完成银行卡信息填写")))}))},Aa=()=>{Ta(!0)};return R((()=>{P({insureCode:g,objectType:4,tenantId:k,orderNo:b}).then((({code:a,data:e})=>{"10000"===a&&(_a.value=e)})),T({pageCode:"payInfo",templateId:f}).then((a=>{const{code:e,data:l}=a;if("10000"===e){const a={};l.productInsureFactorList.forEach((e=>{a[e.moduleType]||(a[e.moduleType]={}),a[e.moduleType][e.code]=e})),Ia.value=a}})),Ta()})),(a,e)=>{const l=A("van-switch"),t=A("van-checkbox"),d=A("ProSvg"),b=A("van-button"),v=A("ProPageWrap");return n(),s(v,null,{default:p((()=>[c("div",ua,[y(V,{title:"首期支付"},{default:p((()=>[y(D,{ref_key:"form1",ref:fa},{default:p((()=>[Na("paymentMethod","INIT")?(n(),s(u,{key:0,modelValue:r(oa).payMethod,"onUpdate:modelValue":e[0]||(e[0]=a=>r(oa).payMethod=a),name:"payMethod",required:"",label:"支付方式","is-link":"",placeholder:"请选择","data-source":r(Q)},null,8,["modelValue","data-source"])):i("",!0),y(ra,{modelValue:r(oa).bankData,"onUpdate:modelValue":e[1]||(e[1]=a=>r(oa).bankData=a),"holder-name":r(na),factor:r(Ia).INIT},null,8,["modelValue","holder-name","factor"])])),_:1},512)])),_:1}),y(V,{title:"续期支付"},{default:p((()=>[y(D,{ref_key:"form2",ref:Ea},{default:p((()=>[Na("sameAsInit","RENEWAL")?(n(),s(m,{key:0,label:"同首期",name:"payInfoType"},{input:p((()=>[y(l,{modelValue:r(sa).payInfoType,"onUpdate:modelValue":e[2]||(e[2]=a=>r(sa).payInfoType=a),size:"22","active-value":r(J).FIRST_SAME,"inactive-value":r(J).OTHER},null,8,["modelValue","active-value","inactive-value"])])),_:1})):i("",!0),Na("paymentMethod","RENEWAL")?(n(),s(u,{key:1,modelValue:r(sa).payMethod,"onUpdate:modelValue":e[3]||(e[3]=a=>r(sa).payMethod=a),name:"payMethod",label:"支付方式","is-link":"",placeholder:"请选择","data-source":r(Q),required:""},null,8,["modelValue","data-source"])):i("",!0),Na("overduePayment","RENEWAL")?(n(),s(u,{key:2,modelValue:r(sa).expiryMethod,"onUpdate:modelValue":e[4]||(e[4]=a=>r(sa).expiryMethod=a),name:"expiryMethod",label:"保费逾期未支付","is-link":"",placeholder:"请选择","data-source":r(aa),required:"","label-width":"200"},null,8,["modelValue","data-source"])):i("",!0),r(sa).payInfoType!==r(J).FIRST_SAME?(n(),s(ra,{key:3,modelValue:r(sa).bankData,"onUpdate:modelValue":e[5]||(e[5]=a=>r(sa).bankData=a),"holder-name":r(na),factor:r(Ia).RENEWAL},null,8,["modelValue","holder-name","factor"])):i("",!0)])),_:1},512)])),_:1}),y(V,{title:"年金领取银行卡",class:"reprise-card","show-divider":!1},{default:p((()=>[c("div",ia,[(n(!0),o(C,null,S(r(ea),((a,e)=>(n(),o("div",{key:e,class:B(["reprise-card-item",{selected:r(va)===a.value}]),onClick:e=>{return l=a.value,void(va.value=l);var l}},M(a.label),11,ma)))),128))]),y(D,{ref_key:"form3",ref:ga},{default:p((()=>[r(va)===r(J).OTHER?(n(),s(ra,{key:0,modelValue:r(ba).bankData,"onUpdate:modelValue":e[6]||(e[6]=a=>r(ba).bankData=a),"holder-name":r(na),factor:r(Ia).ANNUITY},null,8,["modelValue","holder-name","factor"])):i("",!0)])),_:1},512)])),_:1}),c("div",pa,[y(t,{modelValue:r(ka),"onUpdate:modelValue":e[7]||(e[7]=a=>O(ka)?ka.value=a:null),class:"checkbox",shape:"square","icon-size":16},null,8,["modelValue"]),_(" 投保人阅读并接受 "),y(U,{class:"file",title:"《银行转账授权》",content:r(_a).materialContent,type:r(L)(r(_a).materialContent,r(_a).materialSource+"")},null,8,["content","type"])]),c("div",ca,[r(E)?i("",!0):(n(),o("div",{key:0,class:"refresh-btn",onClick:Aa},[c("div",null,[y(d,{name:"refresh"})]),ya])),r(E)?i("",!0):(n(),s(j,{key:1,title:"邀请您填写银行卡信息",desc:"邀请您填写银行卡信息",link:r(Ra),"-":""},{default:p((()=>[y(b,{plain:"",type:"primary"},{default:p((()=>[_("分享")])),_:1})])),_:1},8,["link"])),y(b,{type:"primary",class:"submit-btn",onClick:ha},{default:p((()=>[_("下一步")])),_:1})])])])),_:1})}}}),[["__scopeId","data-v-7a52b3b4"]]);export{ba as default};
