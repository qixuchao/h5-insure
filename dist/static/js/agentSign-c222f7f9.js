import{d as e,aV as a,aW as i,i as s,h as n,c5 as t,j as o,ad as r,af as l,bc as c,l as d,o as u,c as g,b as f,a as m,u as p,w as v,v as h,bj as b,bb as y,cO as S,cP as j,y as I,T as _,cQ as w,bO as E,a$ as O,cR as N,b3 as L}from"./index-83a8b446.js";import{b as T}from"./product-6bdc6741.js";import{g as V,m as C}from"./trial-e48acfbd.js";import{_ as A}from"./SignPart-b63aa187.js";import{u as D}from"./useOrder-5d8cb7c9.js";import{N as P}from"./notice-8819bd7b.js";import"./PolicyInfo-9498e98e.js";import{p as q}from"./utils-89a8b2ff.js";import{g as $}from"./utils-7bac2bc5.js";import"./index-340d107b.js";import"./cloneDeep-d236c69c.js";import"./utils-1b63caf2.js";import"./createProposal-4bee1c8e.js";import"./trial-166a0af0.js";import"./infoCollection-207a44bb.js";const x={class:"long-verify"},G={class:"header"},R={class:"verify-content"},z={class:"footer-button"},B=e({__name:"agentSign",setup(e){a((()=>i((()=>import("./index-7e71e286.js")),["static/js/index-7e71e286.js","static/css/index-4822eb94.css","static/js/index-83a8b446.js","static/css/index-5706e38b.css"]))),a((()=>i((()=>import("./index-e410e5fd.js")),["static/js/index-e410e5fd.js","static/css/index-fa4edf2a.css","static/js/index-83a8b446.js","static/css/index-5706e38b.css","static/js/theme-94cf7d00.js","static/js/index-bd368392.js","static/css/index-bbfdd7ec.css","static/js/utils-7bac2bc5.js","static/js/infoCollection-207a44bb.js","static/js/trial-166a0af0.js"])));const B=s(),k=n(),{productCode:M="",tenantId:U,agentCode:F="",agencyCode:H,saleChannelId:J,saleUserId:Q,orderNo:W,orderCode:K,extraInfo:X,isShare:Y,insurerCode:Z,preview:ee}=B.query;let ae={};try{ae=JSON.parse(decodeURIComponent(X))}catch(ue){}const ie=D(),se=`${window.origin}/baseInsurance/long/phoneVerify?${t.stringify({...B.query,orderNo:K||W})}`,ne=o(),te=r.get(`${l}_userInfo`),oe=o({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:""},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{}},agent:{fileList:[],personalInfo:{name:(null==te?void 0:te.name)||""},isSign:!1,isVerify:!1,isShareSign:!1,signData:[],compositionSign:""}}),re=o({sign:[],verify:[],scribing:""}),le=()=>{if(ee)return void b(y.SIGN,B.query);const e=[];ne.value&&re.value.sign.includes("1")&&e.push(ne.value.validateSign()),Promise.all(e).then((e=>{S({bizObjectId:[],bizObjectType:j.AGENT,orderId:ie.value.id,tenantId:U}).then((({code:e,data:a})=>{"10000"===e&&a&&k.push({path:I.sign,query:B.query})}))})).catch((e=>{_(e.message)}))};o();const ce=(e,a,i)=>{var s;w(e,a,null==(s=ie.value)?void 0:s.id,U,i).then((()=>{W&&V({orderNo:K||W,tenantId:U}).then((({code:e,data:a})=>{if("10000"===e){Object.assign(ie.value,a);const e=[];a.tenantOrderAttachmentList.forEach((a=>{a.objectType===P.AGENT&&(30===a.category?e.push(a.fileBase64):21===a.category&&(oe.value.agent.compositionSign=a.uri))})),oe.value.agent.signData=e}}))}))};o({imgUrl:"",desc:"",title:"",link:se});c((()=>{(async()=>{let e={};const{code:a,data:i}=await V({orderNo:W,tenantId:U});"10000"===a&&(Object.assign(ie.value,i),e=q(i.insuredList[0].productList),i.tenantOrderAttachmentList.forEach((e=>{e.objectType===P.AGENT&&(30===e.category?oe.value.agent.signData.push(e.fileBase64):21===e.category&&(oe.value.agent.compositionSign=e.uri))}))),T(e).then((({code:e,data:a})=>{var i;if("10000"===e){const{signMaterialMap:e}=(null==(i=a.productMaterialPlanVOList)?void 0:i[1])||{};(Object.values(e||{}).flat()||[]).forEach((e=>{e.noticeObject===P.AGENT&&oe.value.agent.fileList.push({attachmentName:e.materialName,attachmentList:[{...e,materialSource:$(`${null==e?void 0:e.materialSource}`,null==e?void 0:e.materialContent)}]})}))}})),C(e).then((({data:e,code:a})=>{if("10000"===a){const{signInfo:a}=E(e.productFactor);a.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((a=>{e.required&&re.value.sign.push(a.code),"1"===a.code?oe.value.agent.isSign=!0:"2"===a.code?oe.value.holder.isSign=!0:"3"===a.code?oe.value.insured.isSign=!0:"4"===a.code?oe.value.holder.isShareSign=!0:"5"===a.code&&(oe.value.insured.isShareSign=!0)})),"customerFace"===e.name&&e.columns.forEach((a=>{e.required&&re.value.verify.push(a.code),"1"===a.code?oe.value.holder.isVerify=!0:"2"===a.code&&(oe.value.insured.isVerify=!0)}))}))}}))})()}));const de=o();return d((()=>{setTimeout((async()=>{de.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,a)=>{var i,s;const n=O,t=N,o=L;return u(),g("div",x,[f(n),m("div",G,[f(t,{type:"warning",content:`本人${null==(i=p(te))?void 0:i.name}已面晤投保人、被保险人(被保险人为未成年人的，还包括其法定监护人)，投保过程中的告知事项已逐一向投保人、被保险人/法定监护人当面询问，并亲自见证投保人、被保险人/法定监护人在电子投保单上签名。如有不实见证或报告，本人愿承担相应的法律责任。请${null==(s=p(te))?void 0:s.name}签名确认。`},null,8,["content"])]),m("div",R,[f(A,{ref_key:"agentSignRef",ref:ne,"order-detail":p(ie),"sign-string":p(oe).agent.signData,"show-sign":p(oe).agent.isSign,"show-verify":p(oe).agent.isVerify,"file-list":p(oe).agent.fileList,"personal-info":p(oe).agent.personalInfo,"composition-sign":p(oe).agent.compositionSign,disabled:!!p(Y),title:"销售人员",onHandleSign:a[0]||(a[0]=e=>ce("AGENT",e))},null,8,["order-detail","sign-string","show-sign","show-verify","file-list","personal-info","composition-sign","disabled"])]),m("div",z,[f(o,{type:"primary",onClick:le},{default:v((()=>[h("确定")])),_:1})])])}}});export{B as default};
