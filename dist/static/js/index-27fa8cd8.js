import{d as e,ap as a,o as l,X as i,L as t,b as s,c as n,N as o,M as r,f as u,e as d,w as c,h as p,ao as v,a6 as f,aM as m,r as k,g as I,i as y,aN as L,aX as b,aR as h,G as g,aY as V,aZ as R,ac as C,Q as x,a_ as P,aP as O,aj as T,ak as w,ae as S,j as D,aA as _,a$ as F,Z as E,a7 as M,B as N,b0 as Y,b1 as A,u as j,a as U,V as $,n as B,au as X,T as q,ad as K,P as Q,p as H}from"./index-0f8b4bae.js";import{l as W,a as z,P as G}from"./index-c713f5ef.js";import{_ as J}from"./index-222e49e8.js";/* empty css              */import{S as Z}from"./index-cb2e2b4e.js";import{P as ee}from"./index-c5bafa14.js";import{S as ae,_ as le}from"./box-title-856c641a.js";import{_ as ie}from"./index-cf1033f1.js";import{_ as te}from"./empty-ae586b6c.js";import{R as se}from"./trial-425cd01c.js";import{u as ne,b as oe,p as re,q as ue,c as de}from"./trial-f2b55fbf.js";import{u as ce}from"./useOrder-ac4fcd77.js";import{t as pe}from"./utils-a16c123e.js";import{P as ve,B as fe}from"./constants-7afb7c3d.js";import{n as me}from"./nextStep-7c3ffffa.js";const ke={key:0},Ie={key:0,class:"risk2-field"},ye=e({name:"ProductRiskList"});var Le=f(e({...ye,props:{dataSource:{type:Array,default:()=>[]},productInfo:{type:Object,default:()=>({productCode:"",productName:""})},showMainRisk:{type:Boolean,default:()=>!0},defaultValue:{type:Object,default:()=>{}}},emits:["trialChange"],setup(e,{emit:f}){const k=e,I=a({loading:!1,show:!0,select:{},list:[],userData:{},riskIsInsure:{},submitData:{},disabledRiskInfo:[],risksDefaultValue:{}}),y=e=>{const a=[];return e.riskLiabilityInfoVOList.map((e=>(1!=+e.showFlag&&a.push({...e}),[]))),a},L=(e,a,l)=>{var i;I.riskIsInsure[a].data=e;const t=[...I.disabledRiskInfo];null==(i=k.dataSource.insureProductRiskVOList)||i.forEach((e=>{if(1!==e.mainRiskFlag){const a=I.riskIsInsure[e.riskId];a.data&&Object.keys(a.data).length>0&&"1"===a.selected&&t.push(a.data)}})),f("trialChange",t,l)},b=(e,a)=>{var l;null==(l=k.dataSource.productRiskRelationVOList)||l.forEach((l=>{1!==l.collocationType&&(a.riskId===l.riskId?(I.riskIsInsure[a.riskId]&&I.riskIsInsure[a.riskId].selected,2===l.collocationType&&I.riskIsInsure[l.collocationRiskId]&&(I.riskIsInsure[l.collocationRiskId].selected=e),3===l.collocationType&&I.riskIsInsure[l.collocationRiskId]&&"1"===e&&(I.riskIsInsure[l.collocationRiskId].selected="1"===e?"2":"1")):a.riskId===l.collocationRiskId&&(3===l.collocationType&&"1"===e&&I.riskIsInsure[l.riskId]&&(I.riskIsInsure[l.riskId].selected="1"===e?"2":"1"),2===l.collocationType&&I.riskIsInsure[l.riskId]&&(I.riskIsInsure[l.riskId].selected=e)))})),"2"===e?L({},a.riskId):(e=>{var a,l,i,t,s,n,o,r,u,d,c,p;if(1!==(null==e?void 0:e.factorDisPlayFlag)){const v=null==(a=null==e?void 0:e.productRiskInsureLimitVO)?void 0:a.amountPremiumConfigVO,f={riskCategory:e.riskCategory,riskCode:e.riskCode,riskName:e.riskName,riskId:e.riskId,riskType:e.riskType,mainRiskId:e.mainRiskId,mainRiskCode:e.mainRiskCode,liabilityList:y(e)};f.chargePeriod=(null==(i=null==(l=null==e?void 0:e.productRiskInsureLimitVO)?void 0:l.paymentPeriodValueList)?void 0:i.length)>0&&(null==(t=null==e?void 0:e.productRiskInsureLimitVO)?void 0:t.paymentPeriodValueList[0].code)||null,f.coveragePeriod=(null==(n=null==(s=null==e?void 0:e.productRiskInsureLimitVO)?void 0:s.insurancePeriodValueList)?void 0:n.length)>0&&(null==(o=null==e?void 0:e.productRiskInsureLimitVO)?void 0:o.insurancePeriodValueList[0].code)||null,f.paymentFrequency=(null==(u=null==(r=null==e?void 0:e.productRiskInsureLimitVO)?void 0:r.paymentFrequencyList)?void 0:u.length)>0&&(null==(d=null==e?void 0:e.productRiskInsureLimitVO)?void 0:d.paymentFrequencyList[0].code)||null;let m=0;1===v.displayType?m=(null==v?void 0:v.minStepValue)>0?null==v?void 0:v.minStepValue:0:3===v.displayType&&2===v.requireCopies?m=(null==(c=null==v?void 0:v.displayValues)?void 0:c.length)>0?null==v?void 0:v.displayValues[0].value:0:3===v.displayType&&1===v.requireCopies?(m=(null==(p=null==v?void 0:v.displayValues)?void 0:p.length)>0?null==v?void 0:v.displayValues[0].value:0,f.copy=v.minCopiesValue):2===v.displayType?f.copy=v.minCopiesValue:m=0,1===v.saleMethod?f.initialAmount=m:f.initialPremium=m,L(f,e.riskId)}})(a)};return l((()=>{(()=>{var e,a;I.disabledRiskInfo=[];let l=null;if(null==(e=k.dataSource.insureProductRiskVOList)||e.forEach((e=>{var a;const i=1!==e.mainRiskFlag?null==(a=k.dataSource.productRiskRelationVOList)?void 0:a.find((a=>a.collocationRiskId===e.riskId)):{};1===e.mainRiskFlag&&(l=e),I.riskIsInsure[e.riskId]?(I.riskIsInsure[e.riskId].data=null,I.riskIsInsure[e.riskId].relation=i,I.riskIsInsure[e.riskId].isMust=!1):I.riskIsInsure[e.riskId]={selected:"2",data:null,relation:i,isMust:!1}})),l){const e=null==(a=k.dataSource.productRiskRelationVOList)?void 0:a.filter((e=>e.riskId===l.riskId));if(!e)return;null==e||e.forEach((e=>{var a,l,i,t,s,n,o,r,u,d,c,p,v,f,m;if(2===e.collocationType){I.riskIsInsure[e.collocationRiskId].selected="1",I.riskIsInsure[e.collocationRiskId].isMust=!0;const b=null==(a=k.dataSource.insureProductRiskVOList)?void 0:a.find((a=>e.collocationRiskId===a.riskId));if(b&&1!==b.factorDisPlayFlag&&(null==(l=null==b?void 0:b.productRiskInsureLimitVO)?void 0:l.amountPremiumConfigVO)){const a=null==(i=b.riskLiabilityInfoVOList)?void 0:i.every((e=>1!==e.showFlag)),l=null==(t=null==b?void 0:b.productRiskInsureLimitVO)?void 0:t.amountPremiumConfigVO;if(a){I.riskIsInsure[e.collocationRiskId].isDisabled=!0;const a={riskCategory:b.riskCategory,riskCode:b.riskCode,riskName:b.riskName,riskId:b.riskId,riskType:b.riskType,mainRiskId:b.mainRiskId,mainRiskCode:b.mainRiskCode,liabilityList:y(b)};a.chargePeriod=(null==(n=null==(s=null==b?void 0:b.productRiskInsureLimitVO)?void 0:s.paymentPeriodValueList)?void 0:n.length)>0&&(null==(o=null==b?void 0:b.productRiskInsureLimitVO)?void 0:o.paymentPeriodValueList[0].code)||null,a.coveragePeriod=(null==(u=null==(r=null==b?void 0:b.productRiskInsureLimitVO)?void 0:r.insurancePeriodValueList)?void 0:u.length)>0&&(null==(d=null==b?void 0:b.productRiskInsureLimitVO)?void 0:d.insurancePeriodValueList[0].code)||null,a.paymentFrequency=(null==(p=null==(c=null==b?void 0:b.productRiskInsureLimitVO)?void 0:c.paymentFrequencyList)?void 0:p.length)>0&&(null==(v=null==b?void 0:b.productRiskInsureLimitVO)?void 0:v.paymentFrequencyList[0].code)||null;let i=0;1===l.displayType?i=(null==l?void 0:l.minStepValue)>0?null==l?void 0:l.minStepValue:0:3===l.displayType&&2===l.requireCopies?i=(null==(f=null==l?void 0:l.displayValues)?void 0:f.length)>0?null==l?void 0:l.displayValues[0].value:0:3===l.displayType&&1===l.requireCopies?(i=(null==(m=null==l?void 0:l.displayValues)?void 0:m.length)>0?null==l?void 0:l.displayValues[0].value:0,a.copy=l.minCopiesValue):2===l.displayType&&(a.copy=l.minCopiesValue),1===l.saleMethod?a.initialAmount=i:a.initialPremium=i,I.disabledRiskInfo.push(a),L(a,b.riskId)}}}3===e.collocationType&&(I.riskIsInsure[e.collocationRiskId].selected="2",I.riskIsInsure[e.collocationRiskId].isMust=!0)}))}})()})),i((()=>{I.loading=!0})),t((()=>I.riskIsInsure),(e=>{}),{deep:!0,immediate:!0}),t((()=>k.defaultValue),(e=>{(null==e?void 0:e.length)>0&&e.forEach((e=>{I.risksDefaultValue[e.riskCode]=e,I.riskIsInsure[e.riskId]?(I.riskIsInsure[e.riskId].selected="1",L(e,e.riskId)):I.riskIsInsure[e.riskId]={selected:"1",isMust:!1}}))}),{deep:!0,immediate:!0}),(a,l)=>{const i=Z,t=m;return s(!0),n(r,null,o(e.dataSource.insureProductRiskVOList,(l=>{var o,f;return s(),n(r,{key:l.riskCode},[(!e.showMainRisk&&1!==l.mainRiskFlag||e.showMainRisk)&&(null==(f=null==(o=u(I).riskIsInsure)?void 0:o[l.riskId])?void 0:f.relation)?(s(),n("div",ke,[d(t,{modelValue:u(I).riskIsInsure[l.riskId].selected,"onUpdate:modelValue":e=>u(I).riskIsInsure[l.riskId].selected=e,label:l.riskName,name:"selected","label-width":"50%",border:!1,class:"risk-select-field risk-name"},{input:c((()=>[d(i,{modelValue:u(I).riskIsInsure[l.riskId].selected,"onUpdate:modelValue":e=>u(I).riskIsInsure[l.riskId].selected=e,"active-value":"1","inactive-value":"2",size:"0.68rem",disabled:u(I).riskIsInsure[l.riskId].isMust,style:{"margin-right":"8px"},onChange:e=>b(e,l)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])])),_:2},1032,["modelValue","onUpdate:modelValue","label"]),"1"===u(I).riskIsInsure[l.riskId].selected?(s(),n("div",Ie,[d(J,{modelValue:u(I).riskIsInsure[l.riskId].data,"onUpdate:modelValue":e=>u(I).riskIsInsure[l.riskId].data=e,"origin-data":l,"product-factor":e.dataSource.productFactor,"default-value":u(I).risksDefaultValue[l.riskCode],onTrialChange:(e,a)=>L(e,l.riskId,a)},null,8,["modelValue","onUpdate:modelValue","origin-data","product-factor","default-value","onTrialChange"])])):p("",!0),1===l.exemptFlag&&"1"===u(I).riskIsInsure[l.riskId].selected?v(a.$slots,"holderForm",{key:1},void 0,!0):p("",!0)])):p("",!0)],64)})),128)}}}),[["__scopeId","data-v-58a61f59"]]);const be={class:"pro-radio-wrap"},he=e({name:"PlanSelect"}),ge=e({...he,props:{planList:{default:()=>[]},defaultPlan:{default:()=>{}}},emits:["planChange"],setup(e,{emit:a}){const l=e,n=k("");let o=!1;return i((()=>{l.defaultPlan&&(o=!0,n.value=l.defaultPlan.planCode)})),t((()=>n),(e=>{o||a("planChange",n.value),o&&(o=!1)}),{deep:!0,immediate:!0}),(a,i)=>{const t=L,o=m;return e.planList.length>0?(s(),I(o,{key:0,modelValue:n.value,"onUpdate:modelValue":i[1]||(i[1]=e=>n.value=e),label:"保障计划",name:"planCode",class:"risk-select-field"},{input:c((()=>[y("div",be,[d(t,{modelValue:n.value,"onUpdate:modelValue":i[0]||(i[0]=e=>n.value=e),options:l.planList.map((e=>({label:e.planName,value:e.planCode})))},null,8,["modelValue","options"])])])),_:1},8,["modelValue"])):p("",!0)}}});var Ve=f(e({__name:"ScrollWrap",props:{moduleValue:{type:Number,default:0},scrollX:{type:Boolean,default:!1},scrollY:{type:Boolean,default:!1}},emits:["update:modelValue","update:needFixed"],setup(e,{emit:l}){const o=e,r=a({offsetX:0,offsetY:0,startX:0,startY:0}),d=k(null),c=k(null),{width:p,height:f}=b(d),{width:m,height:I}=b(c),y=h("PRO_TABLE_KEY"),L=g((()=>{const e=p.value>m.value+4;return l("update:needFixed",e),e})),C=g((()=>f.value>I.value+4)),{direction:x}=V(d,{passive:!1,onSwipeStart(e){const{clientX:a,clientY:l}=e.touches[0];r.startX=a,r.startY=l},onSwipe(e){const{clientX:a,clientY:l}=e.touches[0];if(["LEFT","RIGHT"].includes(x.value)){const e=r.offsetX-(r.startX-a);e>-p.value+m.value&&e<0&&(r.offsetX=e,y.state.offsetX=r.offsetX),r.startX=a}if(["UP","DOWN"].includes(x.value)){const e=r.offsetY-(r.startY-l);e>-f.value+I.value&&e<0&&(r.offsetY=e,y.state.offsetY=r.offsetY),r.startY=l}},onSwipeEnd(e){}}),P=g((()=>o.scrollX||o.scrollY?`transform: translate(${o.scrollX?`${r.offsetX}px`:0},${o.scrollY?`${r.offsetY}px`:0} );`:""));return t((()=>null==y?void 0:y.state),(()=>{const{offsetX:e,offsetY:a}=(null==y?void 0:y.state)||{};L.value&&(r.offsetX=e),C.value&&(r.offsetY=a)}),{deep:!0,immediate:!0}),i((()=>{var e;c.value=null==(e=d.value)?void 0:e.parentElement})),(e,a)=>(s(),n("div",{ref_key:"swiperEl",ref:d,class:"scroll-wrap",style:R(u(P))},[v(e.$slots,"default",{},void 0,!0)],4))}}),[["__scopeId","data-v-0ba94815"]]);const Re={class:"pro-com-table-wrap"},Ce={ref:"tableHeadRef",class:"com-table"},xe={class:"com-table-head"},Pe={class:"com-table-row"},Oe={ref:"tableBodyRef",class:"com-table"},Te={class:"com-table-head"},we={class:"com-table-row"},Se={class:"com-table-body"};var De=f(e({__name:"Table",props:{data:{type:Array,default:()=>[]},columns:{type:Array,default:()=>[]},translateY:{type:Number,default:0}},emits:["update:modelValue","update:needFixed"],setup(e,{emit:a}){const l=e=>{a("update:needFixed",e)};return(a,i)=>(s(),n("div",Re,[d(Ve,{ref:"tableScroll",class:"pro-table-head","scroll-x":"","onUpdate:needFixed":l},{default:c((()=>[y("table",Ce,[y("thead",xe,[y("tr",Pe,[(s(!0),n(r,null,o(e.columns,((e,a)=>(s(),n("th",{key:a,class:C(["table-cell",`table-cell-${a}`]),style:R({minWidth:`${e.width||80}px`})},x(e.title),7)))),128))])])],512)])),_:1},512),d(Ve,{ref:"tableScroll",class:"pro-table-body","scroll-y":"","scroll-x":""},{default:c((()=>[y("table",Oe,[y("thead",Te,[y("tr",we,[(s(!0),n(r,null,o(e.columns,((e,a)=>(s(),n("th",{key:a,class:C(["table-cell",`table-cell-${a}`]),style:R({minWidth:`${e.width||80}px`})},x(e.title),7)))),128))])]),y("tbody",Se,[(s(!0),n(r,null,o(e.data,((a,l)=>(s(),n("tr",{key:l,class:"com-table-row"},[(s(!0),n(r,null,o(e.columns,((e,i)=>(s(),n("td",{key:i,class:C(["table-cell"])},[y("span",null,x(e.render?e.render(a,l):a[e.key]),1)])))),128))])))),128))])],512)])),_:1},512)]))}}),[["__scopeId","data-v-f37eb4be"]]);const _e=e=>(T("data-v-0cf962f9"),e=e(),w(),e),Fe={key:0,class:"pro-table-wrap"},Ee={key:1,class:"no-data-wrap"},Me=[_e((()=>y("img",{src:te,alt:"暂无数据"},null,-1))),_e((()=>y("span",null,"暂无数据～",-1)))];var Ne=f(e({__name:"ProTable",props:{data:{type:Array,default:()=>[]},columns:{type:Array,default:()=>[]}},setup(e){const l=e;k(null),k(null);const i=a({translateY:0,translateX:0,offsetX:0,offsetY:0,needFixed:!1});P("PRO_TABLE_KEY",{state:i});const t=g((()=>O(l.columns)?l.columns.filter((e=>e.fixed)):[])),o=e=>{i.needFixed=e};return(a,l)=>e.data&&e.data.length?(s(),n("div",Fe,[d(De,{"translate-y":u(i).translateY,"onUpdate:translateY":l[0]||(l[0]=e=>u(i).translateY=e),columns:e.columns,data:e.data,"onUpdate:needFixed":o},null,8,["translate-y","columns","data"]),u(i).needFixed?(s(),I(De,{key:0,"translate-y":u(i).translateY,"onUpdate:translateY":l[1]||(l[1]=e=>u(i).translateY=e),class:"pro-table-fixed",style:{width:"160px"},columns:u(t),data:e.data},null,8,["translate-y","columns","data"])):p("",!0)])):(s(),n("div",Ee,Me))}}),[["__scopeId","data-v-0cf962f9"]]);const Ye={class:"benefit-table"},Ae=e({__name:"BenefitTable",props:{dataSource:null},setup(e){const a=e,l=g((()=>O(a.dataSource.headers)?a.dataSource.headers.map(((e,a)=>({title:e,key:`header_${a}`,fixed:a<2}))):[])),i=g((()=>O(a.dataSource.dataList)?a.dataSource.dataList.map((e=>{const a={};return e.forEach(((e,l)=>{a[`header_${l}`]=e})),a})):[]));return(e,a)=>(s(),n("div",Ye,[d(Ne,{columns:u(l),data:u(i),"is-clone":!0},null,8,["columns","data"])]))}});const je=e=>(T("data-v-5e4dfbe9"),e=e(),w(),e),Ue={key:0,class:"benefit-container"},$e={key:0,class:"benefit"},Be=je((()=>y("div",{class:"line"},null,-1))),Xe={class:"box-title box-title-chart"},qe=je((()=>y("img",{class:"tl",src:le,alt:""},null,-1))),Ke=je((()=>y("img",{class:"transform-z180 tr",src:le,alt:""},null,-1))),Qe={key:0},He={class:"box"},We={class:"box-title"},ze=je((()=>y("img",{class:"tl",src:le,alt:""},null,-1))),Ge=je((()=>y("img",{class:"transform-z180 tr",src:le,alt:""},null,-1))),Je={class:"box-price"},Ze={class:"text1"},ea={class:"text2"},aa={key:1},la={key:2,style:{width:"100%, minWidth: 338px"}},ia={class:"slider"},ta={style:{flex:"1",margin:"0px 5px"}},sa={class:"custom-button"},na=je((()=>y("p",{class:"slider-dec"},"拖动按钮查看不同年龄保障",-1))),oa={class:"btn-two"},ra={key:1,class:"benefit-container"},ua={key:0},da={class:"benefit"},ca=je((()=>y("div",{class:"line"},null,-1))),pa=je((()=>y("div",null,[y("div",{class:"box"},[y("p",{class:"box-title"},[y("img",{class:"tl",src:le,alt:""}),D(" 保单年度"),y("span",null,"-"),D("年度，被保人"),y("span",null,"-"),D("岁时 "),y("img",{class:"transform-z180 tr",src:le,alt:""})]),y("div",{class:"box-price"})])],-1))),va={class:"slider"},fa={class:"opt lf"},ma={style:{flex:"1",margin:"0px 5px"}},ka=je((()=>y("div",{class:"custom-button"},"0 岁",-1))),Ia={class:"opt rg"},ya=je((()=>y("p",{class:"slider-dec"},"拖动按钮查看不同年龄保障",-1))),La={class:"btn-two"},ba={key:1,class:"empty-box"},ha=e({name:"Benefit"});var ga=f(e({...ha,props:{dataSource:{default:()=>({showTypeList:["1"]})},productInfo:{default:()=>null}},setup(e){var a;const l=e,i="1",v="2",f="3",m=k(0),L=k(0),b=k(0),h=k(),g=k(0),V=k(null==(a=l.dataSource.showTypeList)?void 0:a[0]),R=k(),C=e=>{if(!(null==e?void 0:e.benefitRiskResultVOList))return;const a=null==e?void 0:e.benefitRiskResultVOList[m.value];L.value=a.ageBegin+1,g.value=a.ageBegin+1,b.value=a.ageEnd},P=()=>{var e,a,i,t,s,n;const o=null==(a=null==(e=l.dataSource)?void 0:e.benefitRiskResultVOList)?void 0:a[m.value];R.value=null==(s=null==(t=null==(i=l.dataSource)?void 0:i.benefitRiskResultVOList)?void 0:t[m.value].benefitRiskTableResultVOList)?void 0:s[0];const{a:r,year:u}=((e,a)=>{const l=[],i=[];for(let t=e,s=0;t<=a;t++,s++)l.push(t.toString()),i.push(s+1);return{a:l,year:i}})(L.value,b.value),d={index:r.indexOf(g.value.toString()),age:r,year:u,result:null==(n=null==o?void 0:o.benefitRiskItemResultVOList)?void 0:n[0]};h.value=d},O=()=>{g.value>b.value-1||(g.value+=1,P())},T=()=>{g.value>L.value&&(g.value-=1,P())},w=e=>{m.value=e.name,C(l.dataSource),P()};return t((()=>l.dataSource),(e=>{var a;e&&(C(e),P(),V.value=null==(a=e.showTypeList)?void 0:a[0])}),{deep:!0,immediate:!0}),t(g,(()=>{P()})),(a,t)=>{var k;const C=M,P=ae,j=N,U=Y,$=A,B=ee;return(null==(k=e.dataSource)?void 0:k.benefitRiskResultVOList)?(s(),n("div",Ue,[d($,{active:u(m),onClickTab:w},{default:c((()=>{var e;return[(s(!0),n(r,null,o(null==(e=l.dataSource)?void 0:e.benefitRiskResultVOList,((e,a)=>(s(),I(U,{key:a,name:a,title:e.riskName},{default:c((()=>{var e,k,w,M,N,Y,A,U,$,B,X,q,K,Q,H,W;return[a==u(m)?(s(),n("div",$e,[Be,S(y("p",Xe,[qe,D(" 保单年度"),y("span",null,x(null==(w=null==(e=u(h))?void 0:e.year)?void 0:w[null==(k=u(h))?void 0:k.index]),1),D("年度，被保人"),y("span",null,x(null==(Y=null==(M=u(h))?void 0:M.age)?void 0:Y[null==(N=u(h))?void 0:N.index]),1),D("岁时 "),Ke],512),[[_,u(V)===v]]),u(V)===i?(s(),n("div",Qe,[y("div",He,[y("p",We,[ze,D(" 保单年度"),y("span",null,x(null==($=null==(A=u(h))?void 0:A.year)?void 0:$[null==(U=u(h))?void 0:U.index]),1),D("年度，被保人"),y("span",null,x(null==(q=null==(B=u(h))?void 0:B.age)?void 0:q[null==(X=u(h))?void 0:X.index]),1),D("岁时 "),Ge]),y("div",Je,[(s(!0),n(r,null,o(null==(Q=null==(K=u(h))?void 0:K.result)?void 0:Q.headers,((e,a)=>{var l,i,t,o,r,d,c,p,v,f;return s(),n("div",{key:a,style:{width:"33%"}},[y("p",Ze,x(("0"==(null==(r=null==(o=null==(i=null==(l=u(h))?void 0:l.result)?void 0:i.dataList)?void 0:o[null==(t=u(h))?void 0:t.index])?void 0:r[a])?"0":u(F)(Number(null==(f=null==(v=null==(c=null==(d=u(h))?void 0:d.result)?void 0:c.dataList)?void 0:v[null==(p=u(h))?void 0:p.index])?void 0:f[a])))||"0"),1),y("p",ea,x(e)+"(元）",1)])})),128))])])])):p("",!0),u(V)===f?(s(),n("div",aa,[d(Ae,{"data-source":u(R)},null,8,["data-source"])])):p("",!0),u(V)==v?(s(),n("div",la,[d(ie,{min:u(L),max:u(b),current:u(g),data:null==(W=null==(H=u(h))?void 0:H.result)?void 0:W.benefitRiskItemList},null,8,["min","max","current","data"])])):p("",!0),u(V)!=f?(s(),n(r,{key:3},[y("div",ia,[y("div",{class:"opt lf",onClick:T},[d(C,{name:"minus"})]),y("div",ta,[u(L)?(s(),I(P,{key:0,modelValue:u(g),"onUpdate:modelValue":t[0]||(t[0]=e=>E(g)?g.value=e:null),min:u(L),max:u(b),"bar-height":"8px"},{button:c((()=>[y("div",sa,x(u(g))+" 岁",1)])),_:1},8,["modelValue","min","max"])):p("",!0)]),y("div",{class:"opt rg",onClick:O},[d(C,{name:"plus"})])]),na],64)):p("",!0),y("div",oa,[l.dataSource.showTypeList.includes(i)?(s(),I(j,{key:0,round:"",plain:u(V)!==i,type:"primary",class:"btn",onClick:t[1]||(t[1]=e=>V.value=i)},{default:c((()=>[D("图表展示")])),_:1},8,["plain"])):p("",!0),l.dataSource.showTypeList.includes(v)?(s(),I(j,{key:1,round:"",plain:u(V)!==v,type:"primary",class:"btn",onClick:t[2]||(t[2]=e=>V.value=v)},{default:c((()=>[D("趋势展示")])),_:1},8,["plain"])):p("",!0),l.dataSource.showTypeList.includes(f)?(s(),I(j,{key:2,round:"",plain:u(V)!==f,type:"primary",class:"btn",onClick:t[3]||(t[3]=e=>V.value=f)},{default:c((()=>[D("表格展示")])),_:1},8,["plain"])):p("",!0)])])):p("",!0)]})),_:2},1032,["name","title"])))),128))]})),_:1},8,["active"])])):(s(),n("div",ra,[l.productInfo?(s(),n("div",ua,[d($,{active:u(m),onClickTab:w},{default:c((()=>[(s(),I(U,{key:1,name:1,title:e.productInfo.insureProductRiskVOList[0].riskName},{default:c((()=>[y("div",da,[ca,pa,y("div",va,[y("div",fa,[d(C,{name:"minus"})]),y("div",ma,[d(P,{modelValue:u(g),"onUpdate:modelValue":t[4]||(t[4]=e=>E(g)?g.value=e:null),min:0,max:80,"bar-height":"8px",disabled:""},{button:c((()=>[ka])),_:1},8,["modelValue"])]),y("div",Ia,[d(C,{name:"plus"})])]),ya,y("div",La,[d(j,{round:"",plain:!0,type:"primary",class:"btn",disabled:""},{default:c((()=>[D("图表展示")])),_:1}),d(j,{round:"",plain:!1,type:"primary",class:"btn",disabled:""},{default:c((()=>[D("趋势展示")])),_:1}),d(j,{round:"",plain:!1,type:"primary",class:"btn",disabled:""},{default:c((()=>[D("表格展示")])),_:1})])])])),_:1},8,["title"]))])),_:1},8,["active"])])):(s(),n("div",ba,[d(B,{title:"试算结果正在计算中...","empty-class":"empty-select"})]))]))}}}),[["__scopeId","data-v-5e4dfbe9"]]);const Va={key:0,class:"head-warning-wrap"},Ra=y("div",{class:"warning-icon"},[y("span",null,"!")],-1),Ca={class:"warning-text"},xa=e({name:"HeadWaring"}),Pa=e({...xa,props:{labels:{default:()=>[]}},setup:e=>(a,l)=>e.labels.length>0?(s(),n("div",Va,[Ra,y("div",Ca,[(s(!0),n(r,null,o(e.labels,(e=>(s(),n("span",{key:e},x(e),1)))),128))])])):p("",!0)}),Oa=(e,a,l)=>{const i=e,{holder:t}=l,s=l.insuredList[0],n=(a||"").split("_");if(n.length<2)return a;if(W.exports.isNaN(Number(n[1])))return a;if(n[1]-=1,1===i.exemptFlag){if("to"===n[0]){let e=0;1===i.exemptType?(null==t?void 0:t.birthday)&&(e=parseInt(""+((new Date).getTime()-new Date(t.birthday).getTime())/31536e6,10)):2===i.exemptType&&(null==s?void 0:s.birthday)&&(e=parseInt(""+(+(new Date).getTime()-new Date(s.birthday).getTime())/31536e6,10)),n[1]=+n[1]-e}n[0]="year"}return n.join("_")},Ta=(e,a)=>{const l=[],i={};return null==e||e.forEach((e=>{i[e.riskId]=e})),null==a||a.forEach((e=>{var a,t,s,n;const{collocationType:o,collocationRiskId:r,riskId:u}=e;switch(o){case 2:{const e=null==(a=i[u])?void 0:a.riskName,s=null==(t=i[r])?void 0:t.riskName;l.push(`${e} 和 ${s} 必须同时投保`);break}case 3:{const e=null==(s=i[u])?void 0:s.riskName,a=null==(n=i[r])?void 0:n.riskName;l.push(`${e} 和 ${a} 不能同时投保`);break}}})),l};const wa={class:"com-body"},Sa={class:"trial-body"},Da={class:"container"},_a={class:"container"},Fa={class:"container"},Ea=(e=>(T("data-v-4a5a4d36"),e=e(),w(),e))((()=>y("div",{class:"empty"},null,-1))),Ma=e({name:"TrialBody"});var Na=f(e({...Ma,props:{dataSource:{default:()=>[]},productInfo:{default:()=>({productCode:"",productName:"",insurerCode:"",tenantId:"",planList:[]})},tenantProductDetail:{default:()=>({})},hideBenefit:{type:Boolean,default:!1},hidePopupButton:{type:Boolean,default:!1},title:{default:"算一算保费"},defaultData:{default:null},isTrial:{type:Boolean,default:!1},defaultOrder:{default:()=>({})}},emits:["trialStart","trialEnd","update:userData"],setup(e,{expose:o,emit:r}){const f=e,m=k(null),L=j();U();const{tenantId:b,templateId:h,preview:V}=L.query,R=k(),C=a({loading:!1,show:!1,select:{},list:[],userData:{},riskIsInsure:{},submitData:{},riskList:[{}],mainRiskVO:{},ifPersonalInfoSuccess:!1,trialMsg:"",trialResultPremium:0,trialResult:{initialPremium:0,initialAmount:0},isAniShow:!1,defaultValue:null,isAutoChange:!1,planIndex:0,isSkipFirstTrial:!1,hadSkipFirstTrial:!1,isQuerying:!1,currentPlanCode:""}),x=ce();k();const P=k(),T=k(f.dataSource),w=k([]),S=e=>{const{holder:a,insuredList:l}=e||{};a&&(C.submitData.holder=a),l&&l.length>0&&l.forEach(((e,a)=>{var l;C.submitData.insuredList&&C.submitData.insuredList.length>a?C.submitData.insuredList[a]=e:((null==(l=C.submitData)?void 0:l.insuredList)||(C.submitData.insuredList=[]),C.submitData.insuredList.push(e))}))},D=g((()=>f.productInfo.planList&&f.productInfo.planList.length>2)),_=(e,a)=>{if(e){const l=["birthday","age","gender","id"];a.includes("occupationCodeList")&&l.push("occupationClass"),Object.keys(e).forEach((i=>{[...a,...l].includes(i)||(e[i]=null)}))}},F=(e,a=(e=>!0))=>O(e)?e.filter(a).map((e=>e.code)):[],E=()=>{console.log("--current plan = ",T.value),console.log("---current submit = ",C.submitData);const e=W.exports.cloneDeep(C.submitData);if(!D.value)return e;const{1:a,2:l,3:i}=T.value.productFactor||{};if(e.holder&&_(e.holder,F(a)),e.insuredList){const a=["productList","beneficiaryList"],t=F(l,(e=>"2"!==String(e.subModuleType))),s=F(l,(e=>"2"===String(e.subModuleType))),n=O(s),o=F(i),r=O(o);e.insuredList.forEach(((e,l)=>{var i,u;_(e,[...l>=1&&n?s:t,...a,...r?["insuredBeneficiaryType"]:[]]),(null==(i=e.beneficiaryList)?void 0:i.length)>0&&(r?e.beneficiaryList.forEach((e=>_(e,o))):e.beneficiaryList.length=0),e.planCode=T.value.planCode;const d=(null==(u=e.productList[0])?void 0:u.riskList)||[],c=T.value.insureProductRiskVOList||[];if(d&&c){const a=d.filter((e=>null!==c.find((a=>a.riskCode===e.riskCode))));e.productList[0].riskList=a}}))}return e},M=k(),N=k({}),Y=["annuityDrawDate","coveragePeriod","chargePeriod","paymentFrequency"],A=e=>{var a,l,i,t,s,n;if(null==(l=null==(a=null==e?void 0:e.data)?void 0:a[0])?void 0:l.productRiskDyInsureFactorVOList){const a=[];if(null==(i=T.value)||i.insureProductRiskVOList.forEach((l=>{var i,t;const s=null==(t=null==(i=null==e?void 0:e.data)?void 0:i[0])?void 0:t.productRiskDyInsureFactorVOList.find((e=>e.riskCode===l.riskCode));if(s){l.productRiskInsureLimitVO={...l.productRiskInsureLimitVO,...s};const e=C.riskList.find((e=>e.riskCode===l.riskCode));let i=!1;G.forEach((a=>{if(Y.indexOf(a.valueKey)>=0){const t=l.productRiskInsureLimitVO[a.configKey];if(t&&e){const l=t.find((l=>l.code===e[a.valueKey]));if(l&&2===l.useFlag){const l=t.find((e=>1===e.defaultFlag));e[a.valueKey]=l.code,i=!0}}}})),i&&a.push({...e,...s,riskCode:l.riskCode})}})),a.length>0&&(null==(n=null==(s=null==(t=C.defaultValue)?void 0:t.insuredList)?void 0:s[0])?void 0:n.productList))return a.forEach((e=>{var a,l,i;C.defaultValue.insuredList[0].productList=null==(i=null==(l=null==(a=C.defaultValue)?void 0:a.insuredList)?void 0:l[0])?void 0:i.productList.map((a=>(a.riskList=null==a?void 0:a.riskList.map((a=>(a.riskCode===e.riskCode&&(a=e),a))),a)))})),!1}return!0},Z=async(e,a=!0)=>{C.trialMsg="试算中...",C.trialResultPremium=0,C.loading=!0,r("trialStart");let l=!1;if(a){const{code:a}=await ne(e);l="10000"===a}!l&&a||(C.isQuerying=!0,f.hideBenefit||oe(e).then((e=>{e.data&&e.code===X&&(N.value=e.data)})).finally((()=>{C.loading=!1})),re(e).then((a=>{var l,i;if(a.data&&a.code===X){(null==(l=null==a?void 0:a.data)?void 0:l.errorInfo)&&q(`${null==(i=null==a?void 0:a.data)?void 0:i.errorInfo}`),C.trialMsg="",C.trialResultPremium=a.data.initialPremium,C.trialResult=a.data;const t={};a.data.riskPremiumDetailVOList&&a.data.riskPremiumDetailVOList.length&&a.data.riskPremiumDetailVOList.forEach((e=>{t[e.riskCode]={initialAmount:e.initialAmount,initialPremium:e.initialPremium}})),M.value=t,r("trialEnd",a.data,e)}})).finally((()=>{C.loading=!1,C.isQuerying=!1})))},ee=W.exports.debounce((async()=>{console.log(">>>>>调用试算<<<<<",C.ifPersonalInfoSuccess,R.value.canTrail());const{productCode:e,productName:a}=f.productInfo||{};if(C.ifPersonalInfoSuccess||R.value.canTrail()){C.submitData.productCode=e,C.submitData.productName=a,C.submitData.tenantId=f.productInfo.tenantId,C.riskList=C.riskList.map((e=>(e=>{var a,l,i,t;const s=null==(a=T.value.insureProductRiskVOList)?void 0:a.find((a=>e.riskId===a.riskId));if(s&&1!==s.mainRiskFlag){const a=null==(i=null==(l=T.value)?void 0:l.productRiskRelationVOList)?void 0:i.filter((e=>{var a;if(e.collocationRiskId===s.riskId&&3!==e.collocationType){const l=null==(a=T.value.insureProductRiskVOList)?void 0:a.find((a=>e.riskId===a.riskId));if(l&&l.riskType===se.MAIN_RISK)return!0}return!1})),n=a.length>0?a[0]:null;if(n){const a=null==(t=C.riskList)?void 0:t.find((e=>e.riskId===n.riskId));G.forEach((l=>{l.ruleKey&&s.productRiskInsureLimitVO&&a&&(1===s.productRiskInsureLimitVO[l.ruleKey]&&(e[l.valueKey]=a[l.valueKey]),3===s.productRiskInsureLimitVO[l.ruleKey]&&(1!==s.exemptFlag?e[l.valueKey]=Oa(s,a[l.valueKey],C.submitData):e[l.valueKey]=Oa(s,a[l.ruleValueKey],C.submitData)))}))}}return e})(e))),C.submitData.insuredList&&C.submitData.insuredList.forEach((l=>{l.productList=[{productCode:e,productName:a,riskList:C.riskList}]}));const l=E();console.log(">>>数据构建<<<",l),await Z(l)}}),300),ae=async e=>{var a;const{insuredList:l,isFirstInsuredChange:i}=e;if(S(e),C.ifPersonalInfoSuccess=!0,i){console.log("处理第一被保人修改的dy变化"),C.isQuerying=!0;const e=await ue({calcProductFactorList:[{planCode:T.value.planCode,productCode:f.productInfo.productCode,riskEditVOList:[{insureProductRiskVO:null==(a=T.value.insureProductRiskVOList)?void 0:a[0]}]}],...l[0]});if(C.isQuerying=!1,!A(e))return}console.log("投被保人的信息回传 ",e),ee()},le=async(e,a)=>{var l,i,t,s;if(a){const n=W.exports.cloneDeep(e);delete n.insurancePeriodValueList,delete n.paymentFrequencyList,delete n.paymentPeriodValueList;if(Y.indexOf(a.key)>=0&&`${a.oldValue}`!=`${a.newValue}`){const o={};switch(a.key){case"annuityDrawDate":o.changeType=3;break;case"coveragePeriod":o.changeType=2;break;case"chargePeriod":o.changeType=1}const r=null==(i=null==(l=C.submitData)?void 0:l.insuredList)?void 0:i[0],u=null==(s=null==(t=T.value)?void 0:t.insureProductRiskVOList)?void 0:s.find((a=>a.riskCode===e.riskCode));if(!C.isAutoChange){C.isQuerying=!0;const a=await ue({calcProductFactorList:[{planCode:T.value.planCode,productCode:f.productInfo.productCode,riskEditVOList:[{insureProductRiskVO:u,insureRiskEditReqVO:{riskId:e.riskId,riskCode:e.riskCode,...n,...o}}]}],...r});C.isQuerying=!1;const l=A(a);return l||(C.isAutoChange=!0),l}C.isAutoChange=!1}}return!0},ie=async(e,a)=>{C.mainRiskVO=e;await le(e,a)&&(C.riskList.length>0&&(C.riskList[0]=e),console.log("标准险种的信息回传",e),ee())},te=async(e,a)=>{if(C.riskList=[C.mainRiskVO,...e],console.log("附加险列表数据回传",e),a){const l=e.find((e=>e.riskCode===a.riskCode));if(!(await le(l,a)))return}ee()},ke=e=>{var a,l,i,t;C.userData=e,C.defaultValue=e;const s=(null==(a=e.insuredList)?void 0:a[0].productList.findIndex((e=>e.planCode===T.value.planCode)))||0;C.planIndex=-1===s?0:s,C.riskList=(null==(t=null==(i=null==(l=null==e?void 0:e.insuredList)?void 0:l[0].productList)?void 0:i[C.planIndex])?void 0:t.riskList)||[],Z(e,!0)},Ie=async e=>{var a;if(f.defaultData){const e=f.defaultData.find((e=>e.productCode===f.productInfo.productCode))||f.defaultData[0];ke(e),S(null==(a=f.defaultData)?void 0:a[0])}else w.value.push(T.value.planCode),await(async()=>{var e;const a=await de({calcProductFactorList:[{planCode:T.value.planCode,productCode:f.productInfo.productCode}]});if(a.data){const l=a.data.find((e=>e.productCode===f.productInfo.productCode))||a.data[0];ke(l),S(null==(e=a.data)?void 0:e[0])}})()},ye=async e=>{var a,l;const i=f.productInfo.planList.findIndex((a=>a.planCode===e)),t=(null==(l=null==(a=C.defaultValue)?void 0:a.insuredList)?void 0:l[0].productList.findIndex((a=>a.planCode===e)))||0,s=i>=0?f.productInfo.planList[i]:null;s&&(C.currentPlanCode=e,T.value=s,C.planIndex=t>=0?t:0,C.defaultValue.insuredList[0].productList[C.planIndex].riskList=C.riskList,w.value.findIndex((a=>a===e))<0&&w.value.push(e))};l((()=>{var e,a;C.select={},C.list=[],C.userData={},C.riskIsInsure={},C.submitData={},C.riskList=[{}],C.mainRiskVO={},C.ifPersonalInfoSuccess=!1,C.trialMsg="",C.trialResultPremium=0,C.riskIsInsure={},null==(a=null==(e=T.value)?void 0:e.insureProductRiskVOList)||a.forEach((e=>{var a;const l=null==(a=T.value.productRiskRelationVOList)?void 0:a.find((a=>a.collocationRiskId===e.riskId));l&&(C.riskIsInsure[e.riskCode]={selected:"2",data:null,relation:l})}))})),i((()=>{T.value=f.dataSource,C.loading=!0,C.show=!0,C.isAniShow=!0,C.isSkipFirstTrial=!0,C.hadSkipFirstTrial=!1,$((()=>{Ie()}))}));return o({getTrialSuccessFlag:()=>C.trialResultPremium>0,validate:()=>R.value.validate(!1),validateTrialFields:()=>R.value.validateTrialFields(),validateHolder:e=>{var a;return null==(a=R.value)?void 0:a.validateHolder(e)},getUserData:()=>({...C.userData}),onShare:e=>{var a;C.trialResultPremium&&(null==(a=m.value)||a.validate().then((()=>{Object.assign(x.value,f.defaultOrder,{extInfo:{...x.value.extInfo,buttonCode:fe.TRIAL_PREMIUM,pageCode:ve.TRIAL_PREMIUM,templateId:h}});const a=pe(f.productInfo,M.value,x.value);me(a,((a,l)=>{l===Q.JUMP_PAGE&&(P.value.link=`${window.location.href}&isShare=1&orderNo=${a.orderNo}`,e())})),console.log("---- validate success ----")})))},onNext:()=>{var e;const{productCode:a,productName:l}=f.productInfo;V?B(ve.TRIAL_PREMIUM,L.query):C.trialResultPremium&&(null==(e=m.value)||e.validate().then((()=>{Object.assign(x.value,f.defaultOrder,{extInfo:{templateId:h,...x.value.extInfo,...f.defaultOrder.extInfo||{},buttonCode:fe.TRIAL_PREMIUM,pageCode:ve.TRIAL_PREMIUM}}),console.log("dealMixData()",E());const e=pe({...E(),productCode:a,productName:l},C.trialResult,x.value);me(e,((e,a)=>{a===Q.JUMP_PAGE&&H(e.nextPageCode,{...L.query,orderNo:e.orderNo})})),console.log("---- validate success ----")})),C.loading=!1,C.show=!0,C.isAniShow=!0)},dealMixData:E}),t((()=>C.riskIsInsure),(e=>{}),{deep:!0,immediate:!0}),t((()=>C.userData),(e=>{if(e){const{holder:a,insuredList:l}=e||{},i={holder:a,insuredList:l};Object.assign(C.submitData,i),r("update:userData",i)}}),{deep:!0}),t((()=>f.dataSource),(e=>{T.value=e}),{deep:!0,immediate:!0}),(a,l)=>{var i,t,o,r,f,k,L,b;const h=K;return s(),n("div",wa,[v(a.$slots,"trialHead",{},void 0,!0),y("div",Sa,[d(Pa,{labels:u(Ta)((null==(i=T.value)?void 0:i.insureProductRiskVOList)||[],T.value.productRiskRelationVOList)},null,8,["labels"]),y("div",Da,[!e.hideBenefit&&(null==(t=N.value)?void 0:t.benefitRiskResultVOList)?(s(),I(ga,{key:0,class:"benefit-wrap","data-source":N.value,"product-info":T.value,"show-type-list":N.value.showTypList},null,8,["data-source","product-info","show-type-list"])):p("",!0),u(D)?(s(),I(ge,{key:1,"plan-list":e.productInfo.planList,"default-plan":T.value,onPlanChange:ye},null,8,["plan-list","default-plan"])):p("",!0),T.value.productFactor?(s(),I(u(z),{ref_key:"personalInfoRef",ref:R,key:T.value.planCode,modelValue:u(C).userData,"onUpdate:modelValue":l[0]||(l[0]=e=>u(C).userData=e),"is-trial":e.isTrial,"product-factor":T.value.productFactor,"multi-insured-config":null==(o=T.value)?void 0:o.multiInsuredConfigVO,onTrailChange:ae},null,8,["modelValue","is-trial","product-factor","multi-insured-config"])):p("",!0)]),d(h,{size:"large"}),y("div",_a,[(s(),I(J,{ref_key:"insureInfosRef",ref:m,key:T.value.planCode,"origin-data":null==(r=T.value.insureProductRiskVOList)?void 0:r[0],"product-factor":T.value.productFactor,"default-value":u(C).defaultValue?null==(k=null==(f=u(C).defaultValue)?void 0:f.insuredList[0].productList[u(C).planIndex])?void 0:k.riskList[0]:null,"trial-result":u(C).trialResult,onTrialChange:ie},null,8,["origin-data","product-factor","default-value","trial-result"]))]),y("div",Fa,[T.value.insureProductRiskVOList?(s(),I(Le,{key:T.value.planCode,"data-source":T.value,"show-main-risk":!1,"default-value":u(C).defaultValue?null==(b=null==(L=u(C).defaultValue)?void 0:L.insuredList[0].productList[u(C).planIndex])?void 0:b.riskList:[],onTrialChange:te},{holderForm:c((()=>{var a;return[e.isTrial&&e.dataSource.productFactor?(s(),I(u(z),{key:0,ref_key:"personalInfoRef",ref:R,modelValue:u(C).userData,"onUpdate:modelValue":l[1]||(l[1]=e=>u(C).userData=e),"is-trial":e.isTrial,"is-only-holder":!0,"product-factor":e.dataSource.productFactor,"multi-insured-config":null==(a=e.dataSource)?void 0:a.multiInsuredConfigVO,onTrailChange:ae},null,8,["modelValue","is-trial","product-factor","multi-insured-config"])):p("",!0)]})),_:1},8,["data-source","default-value"])):p("",!0)]),Ea]),v(a.$slots,"trialBtn",{trialData:u(C).submitData,riskPremium:u(C).trialResult,loading:u(C).isQuerying,personalInfoRef:R.value},void 0,!0)])}}}),[["__scopeId","data-v-4a5a4d36"]]);export{Na as T};
