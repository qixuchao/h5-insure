import{h as e,a8 as a,N as t,r as n,x as o,Z as r,j as l,k as i,l as u,m as d,n as s,Q as c,z as v,I as p,A as m,s as f,d as I,D as O,a3 as L,a4 as V,T as C}from"./vendor-0381d15c.js";import{d as j}from"./debounce-924a6220.js";import{r as h,t as y}from"./utils-4afe4ff4.js";import{p as P}from"./product-45a317d6.js";import{i as b,b as D,p as w}from"./trial-78bb8c3a.js";import{_ as g,n as R}from"./nextStep-4caefff5.js";import{u as k}from"./theme-126054aa.js";import{P as x}from"./index-cbfaf465.js";import{_ as N}from"./index-647cae04.js";import"./infoCollection-d2bb0b5f.js";import"./useStorage-11a57ae5.js";import"./trial-ae9dfa4f.js";import"./relativeTime-71db0de4.js";import"./validator-5a13dc82.js";import"./useDicData-187b6947.js";import"./core-8c71086d.js";import"./index-38a8c5cf.js";const Y=e=>(L("data-v-2eee1961"),e=e(),V(),e),B={class:"net-sale-wrap"},E={class:"part product-name"},T=Y((()=>v("span",null,null,-1))),_=Y((()=>v("span",null,null,-1))),H={class:"part"},F={class:"footer"};var $=N(e({setup(e){const L=k();a();const V=t(),{productCode:N="HTEJBX",tenantId:Y="9991000001",orderNo:$,agentCode:M="",agencyCode:A,saleChannelId:S,extraInfo:z,from:U}=V.query,q=n(),J=n(),W=n(),G=n(),Q=n(),X=n({}),Z=n({}),K=n({}),ee=n();let ae={};try{ae=JSON.parse(decodeURIComponent(z))}catch(se){}const te=n({agencyId:A,agentCode:M,commencementTime:"",expiryDate:"",extInfo:{buttonCode:"EVENT_NETSALE_underWrite",pageCode:"infoCollection",templateId:null==ae?void 0:ae.templateId,iseeBizNo:ee,extraInfo:ae},orderCategory:1,saleChannelId:S,tenantId:Y,venderCode:"",tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{relationToHolder:"1",extInfo:{occupationCodeList:[]},tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}],tenantOrderProductList:[{}]}],tenantOrderSubjectList:[{extInfo:{subjectRelatedFirm:"xinao",subjectRelatedUserId:""},subjectName:"",subjectObjectType:"HOLDER",subjectType:"GENERAL",tenantId:Y}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}}),ne=o((()=>{var e,a;return!!(null==(a=null==(e=W.value)?void 0:e.productRelationPlanVOList)?void 0:a.length)})),oe=n();r([()=>Q.value,()=>G.value,()=>J.value],(()=>{var e,a;const{premium:t}=Q.value||{};if(t)oe.value=t&&`￥${t}元`;else{const{tenantProductInsureVO:t}=G.value||{};let n={};n=(null==(e=null==t?void 0:t.planList)?void 0:e.length)?((null==t?void 0:t.planList)||[]).find((e=>e.planCode===J.value)):null==t?void 0:t.planInsureVO;const{paymentFrequencyValue:o,premiumUnit:r}=(null==(a=null==n?void 0:n.productPremiumVOList)?void 0:a[0])||{};oe.value=o&&`￥${o}${r||"元"}`}}),{deep:!0,immediate:!0});const re=o((()=>{var e,a,t;let n=[];return n=ne.value?(null==(a=null==(e=W.value)?void 0:e.productRelationPlanVOList.find((e=>e.planCode===J.value)))?void 0:a.productRiskVoList)||[]:(null==(t=W.value)?void 0:t.productRiskVoList)||[],n})),le=o((()=>{var e,a,t;const n=re.value||[];return 1===((null==(t=null==(a=null==(e=null==n?void 0:n[0])?void 0:e.riskDetailVOList)?void 0:a[0])?void 0:t.insuranceStartType)||1)?`${I(new Date).format("YYYY-MM-DD")} 00:00:00`:`${I(new Date).add(1,"day").format("YYYY-MM-DD")} 00:00:00`})),ie=o((()=>{var e,a;const t=re.value||[],{insuranceEndType:n,riskInsureLimitVO:o}=(null==(a=null==(e=null==t?void 0:t[0])?void 0:e.riskDetailVOList)?void 0:a[0])||{},{insurancePeriodValueList:r}=o||{},[l,i]=((null==r?void 0:r[0])||"").split("_");return 1===n?`${I(new Date).add(i||0,l).format("YYYY-MM-DD")} 23:59:59`:n?`${I(new Date).add(i,l).format("YYYY-MM-DD")} 00:00:00`:""})),ue=async()=>{var e;te.value.venderCode=null==(e=W.value)?void 0:e.productBasicInfoVO.insurerCode,te.value.orderAmount=Q.value.premium,te.value.orderRealAmount=Q.value.premium,te.value.commencementTime=le.value,te.value.expiryDate=ie.value,te.value.extInfo.iseeBizNo=ee.value,te.value.tenantOrderInsuredList[0].planCode=J.value,R(((e={},a={},t={})=>{var n;const o={},r=(e=[])=>{(e||[]).forEach((e=>{var a;o[e.riskCode]=e,(null==(a=e.riskPremiumDetailVOList)?void 0:a.length)&&r(e.riskPremiumDetailVOList)}))};r(a.riskPremiumDetailVOList);const l={...t},i={tenantId:Y,riskList:(null==(n=Z.value)?void 0:n[0].riskVOList)||[],riskPremium:o,productId:null==e?void 0:e.productBasicInfoVO.id};return l.tenantOrderInsuredList[0].tenantOrderProductList=[{premium:Q.value.premium,productCode:e.productBasicInfoVO.productCode,productName:e.productBasicInfoVO.productName,tenantOrderRiskList:y(i)}],l})(W.value,Q.value,te.value),((e,a)=>{"jumpToPage"===a&&C("提交成功")}))},de=async()=>{var e;null==(e=q.value)||e.validateForm().then((()=>{O.confirm({title:"分享",message:`即将向客户【${te.value.tenantOrderHolder.name}】发送投保确认信息,请确认是否继续？`}).then((()=>{ue()}))}))};r([()=>te.value.tenantOrderHolder.gender,()=>te.value.tenantOrderHolder.name,()=>te.value.tenantOrderHolder.birthday,()=>{var e;return null==(e=te.value.tenantOrderInsuredList)?void 0:e[0].name},()=>{var e;return null==(e=te.value.tenantOrderInsuredList)?void 0:e[0].gender},()=>{var e;return null==(e=te.value.tenantOrderInsuredList)?void 0:e[0].birthday},()=>J.value],j((([e,a,t,n,o,r])=>{a&&n&&o&&r&&(async(e,a,t)=>{var n;const o={holder:{personVO:e.tenantOrderHolder},insuredVOList:e.tenantOrderInsuredList.map((e=>({insuredCode:"",personVO:e,productPlanVOList:[{insurerCode:a.productBasicInfoVO.insurerCode,planCode:J.value||0,riskVOList:h(t)}]}))),productCode:a.productBasicInfoVO.productCode,tenantId:Y},{code:r}=await D(o);if("10000"===r){const{code:e,data:a}=await w(o);"10000"===e?(Q.value=a,Z.value=null==(n=o.insuredVOList[0])?void 0:n.productPlanVOList):Q.value=null}})(te.value,W.value,re.value)}),500));return r((()=>J.value),(()=>{X.value&&(K.value=X.value[J.value])})),l((()=>{(async()=>{var e,a;const{code:t,data:n}=await P({productCode:N,withInsureInfo:!0,tenantId:Y});"10000"===t&&(G.value=n,document.title=(null==(e=n.tenantProductInsureVO)?void 0:e.productNam)||"");const{code:o,data:r}=await b({productCode:N});"10000"===o&&(W.value=r,X.value=r.planFactor,(null==(a=null==r?void 0:r.productRelationPlanVOList)?void 0:a.length)&&(J.value=r.productRelationPlanVOList[0].planCode),r.productFactor?K.value=r.productFactor:r.planFactor&&(K.value=r.planFactor[J.value]))})(),setTimeout((async()=>{ee.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,a)=>{const t=i("ProRadioButton"),n=i("ProCard"),o=i("ProCell"),r=i("ProPageWrap"),l=i("van-config-provider");return u(),d(l,{"theme-vars":m(L)},{default:s((()=>[c(r,null,{default:s((()=>{var e,r;return[v("div",B,[v("div",E,p(null==(r=null==(e=W.value)?void 0:e.productBasicInfoVO)?void 0:r.productFullName),1),m(ne)?(u(),d(n,{key:0,"show-line":!1,title:"保障年期"},{default:s((()=>{var e;return[c(t,{modelValue:J.value,"onUpdate:modelValue":a[0]||(a[0]=e=>J.value=e),class:"radio-group",prop:{label:"planName",value:"planCode"},options:null==(e=W.value)?void 0:e.productRelationPlanVOList},null,8,["modelValue","options"])]})),_:1})):f("",!0),c(g,{ref_key:"formRef",ref:q,"title-collection":{HOLDER:"投保人",INSURER:"被保人",BENEFICIARY:"收益人"},"need-desensitize":"","form-info":te.value,"send-sms-code":()=>{},"input-align":"left","factor-object":K.value},{holderName:s((()=>[T])),insurerName:s((()=>[_])),_:1},8,["form-info","send-sms-code","factor-object"]),v("div",H,[c(o,{title:"保费",content:oe.value},null,8,["content"]),c(o,{title:"保障期间",content:`${m(le).split(" ")[0]}~${m(ie).split(" ")[0]}`},null,8,["content"])]),v("div",F,[c(x,{shadow:!1,text:"分享用户确认投保",onClick:de})])])]})),_:1})])),_:1},8,["theme-vars"])}}}),[["__scopeId","data-v-2eee1961"]]);export{$ as default};
