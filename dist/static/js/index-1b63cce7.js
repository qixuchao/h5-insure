var se=Object.defineProperty,oe=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var Y=(f,l,u)=>l in f?se(f,l,{enumerable:!0,configurable:!0,writable:!0,value:u}):f[l]=u,V=(f,l)=>{for(var u in l||(l={}))le.call(l,u)&&Y(f,u,l[u]);if(q)for(var u of q(l))ue.call(l,u)&&Y(f,u,l[u]);return f},L=(f,l)=>oe(f,ne(l));import{g as ce,af as de,Q as pe,C as y,L as me,a3 as j,X as fe,o as _e,r as k,h as p,j as T,k as m,z as i,m as R,n as d,s as C,y as D,F as ge,E as ke,I as Pe,B}from"./vendor-50171071.js";import{P as w,R as J,i as Ve,p as ye}from"./trial-02b8d4e0.js";import{n as he,g as ve}from"./index-9b9c43e6.js";import{u as Oe}from"./useStorage-31c729f1.js";import{_ as Le,P as Re}from"./index-1e64972f.js";import{P as Ce,I as De}from"./trial-ac00af92.js";const be={key:0,class:"part-card"},Te={key:1,class:"part-card"},Be={class:"risk-content"},Fe={key:0,class:"risk"},Ie={key:1,class:"plan-risk"},Ee={class:"footer-bar"},Ne={class:"trial-result"},Ae={class:"result-num"},Se=B(" \u5143\u8D77 "),xe={class:"trial-operate"},Ue={key:0,class:"retrial-tip"},Me=B(" \u6761\u4EF6\u66F4\u6539\u540E\uFF0C\u9700\u8981\u91CD\u65B0\u8BD5\u7B97 "),qe=B("\u53BB\u8BD5\u7B97"),Ye=B("\u7ACB\u5373\u6295\u4FDD"),je=ce({setup(f){const l=de(),u=pe(),{productCode:K="MMBBSF",templateId:W=1,agentCode:X="test",agencyCode:$="",tenantId:z=9991000007,venderCode:G="99"}=u.query,b=y({personVO:{}}),h=y({insuredCode:"",personVO:{}}),v=y({}),I=y({}),E=y({}),F=y({}),N=y({}),e=me({currentPlan:"",riskBaseInfo:{},holderFactor:[],insuredFactor:[],riskData:[],riskPlanData:[],trialResult:{},canTrial:!0,retrialTip:!1,enumList:{},ageRange:[],collapseName:["1"],insuredRiskList:[]});j("premium",N.value),j("source",""),Oe().get("userInfo");const A="premiumTrial",H=()=>{e.retrialTip=!1},Q=(a,t)=>{const n=[],s=o=>{o.forEach(r=>{var O,g,P;const _={initialAmount:(O=t[r.riskCode])==null?void 0:O.amount,paymentFrequency:r.paymentFrequency,paymentPeriod:r.chargePeriod.split("_")[1],paymentPeriodType:Ce[r.chargePeriod.split("_")[0]],insurancePeriodType:De[r.coveragePeriod.split("_")[0]],insurancePeriodValue:r.coveragePeriod.split("_")[1],riskCode:r.riskCode,riskType:r.riskType,initialPremium:(g=t[r.riskCode])==null?void 0:g.premium};n.push(_),((P=r.riderRiskVOList)==null?void 0:P.length)&&s(r.riderRiskVOList)})};s(a),e.insuredRiskList=n},Z=()=>{he({agencyId:$,saleUserId:X,tenantId:z,venderCode:G,orderDataSource:1,pageCode:A,extInfo:{templateId:+(W||1),pageCode:A},tenantOrderHolder:{},tenantOrderInsuredList:[{tenantOrderProductList:[{productCode:e.riskBaseInfo.productCode||"",productName:e.riskBaseInfo.productName||"",premium:e.trialResult.premium||0,tenantOrderRiskList:e.insuredRiskList}]}]}).then(({code:a,data:t})=>{a==="10000"&&t.pageAction.pageAction==="jumpToPage"&&l.push({path:Re[t.pageAction.data.nextPageCode],query:L(V({},u.query),{orderNo:t.pageAction.data.orderNo})})})},ee=()=>{const a=JSON.parse(JSON.stringify(v.value[e.currentPlan])),t=Object.values(a.riderRiskVOList).map(s=>{const o=s;if(o.chargePeriod==="3"){const r=(v.value[e.currentPlan].chargePeriod||"").split("_");r[1]&&(r[1]-=1),o.chargePeriod=r.join("_")}return o.liabilityVOList=(o.liabilityVOList||[]).filter(r=>r.liabilityAttributeValue&&r.liabilityAttributeValue!=="-1").map(r=>{const _=r;return _.liabilityAttributeValue==="0"&&(_.liabilityAttributeValue=""),_}),o});a.liabilityVOList=a.liabilityVOList.filter(s=>!["-1"].includes(s.liabilityAttributeValue)).map(s=>{const o=s;return o.liabilityAttributeValue==="0"&&(o.liabilityAttributeValue=""),o});const n={holder:{personVO:L(V({},b.value.personVO),{birthday:b.value.personVO.birthday?`${b.value.personVO.birthday} 00:00:00`:""})},productCode:e.riskBaseInfo.productCode,insuredVOList:[L(V({},h.value),{personVO:L(V({},h.value.personVO),{birthday:h.value.personVO.birthday&&`${h.value.personVO.birthday} 00:00:00`}),productPlanVOList:[{planCode:e.currentPlan||"",riskVOList:[L(V({},a),{riderRiskVOList:t})]}]})]};ye(V({},n)).then(({code:s,data:o})=>{if(s==="10000"){e.retrialTip=!1,e.trialResult=o,e.canTrial=!1;const r={},_=(O=[])=>{O.forEach(g=>{var P;r[g.riskCode]=g,((P=g.riskPremiumDetailVOList)==null?void 0:P.length)&&_(g.riskPremiumDetailVOList)})};_(o.riskPremiumDetailVOList),Q(n.insuredVOList[0].productPlanVOList[0].riskVOList,r),Object.assign(N.value,r)}})},te=()=>{var a,t,n,s,o;Promise.all([(t=(a=I.value)==null?void 0:a.validateForm)==null?void 0:t.call(a),(s=(n=E.value)==null?void 0:n.validateForm)==null?void 0:s.call(n),(o=F.value)==null?void 0:o.validate()]).then(()=>{ee()})},re=()=>{ve({dictCodeList:["RISK_PAYMENT_PERIOD","RISK_INSURANCE_PERIOD"]}).then(({code:t,data:n})=>{if(t==="10000"){const s={};n.forEach(o=>{s[o.dictCode]=o.dictItemList}),e.enumList=s}})},ie=()=>{Ve({productCode:K,source:1}).then(({code:a,data:t})=>{a==="10000"&&(e.riskBaseInfo=t==null?void 0:t.productBasicInfoVO,((t==null?void 0:t.productRelationPlanVOList)||(t==null?void 0:t.riskDetailVOList)||[]).forEach((n,s)=>{s===0&&(e.currentPlan=n.planCode||"0"),Object.assign(v.value,{[n.planCode||s]:{liabilityVOList:[],riderRiskVOList:{}}})}),e.riskData=t.riskDetailVOList||[],e.riskPlanData=t.productRelationPlanVOList||[])}).finally(()=>{})},S=a=>{e.holderFactor=a.holderFactorList,e.insuredFactor=a.insuredFactorList,e.ageRange=a.ageRange};return fe([()=>v.value,()=>b.value,()=>h.value],a=>{a&&!e.canTrial&&(e.canTrial=!0,e.retrialTip=!0)},{deep:!0}),_e(()=>{ie(),re()}),(a,t)=>{const n=k("ProTitle"),s=k("VanForm"),o=k("ProTabButton"),r=k("VanTab"),_=k("VanTabs"),O=k("van-collapse-item"),g=k("van-collapse"),P=k("VanButton"),ae=k("ProPageWrap");return p(),T(ae,{class:"page-trial-wrapper"},{default:m(()=>{var x,U,M;return[i(e).holderFactor.length?(p(),R("div",be,[d(n,{title:"\u6295\u4FDD\u4EBA"}),d(w,{ref_key:"holderRef",ref:I,"insured-code":(x=i(e).riskBaseInfo)==null?void 0:x.insurerCode,"form-info":b.value.personVO,"factor-list":i(e).holderFactor,"age-range":i(e).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):C("",!0),i(e).insuredFactor.length?(p(),R("div",Te,[d(n,{title:"\u88AB\u4FDD\u4EBA"}),d(w,{ref_key:"insuredRef",ref:E,"insured-code":(U=i(e).riskBaseInfo)==null?void 0:U.insurerCode,"form-info":h.value.personVO,"factor-list":i(e).insuredFactor,"age-range":i(e).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):C("",!0),D("div",Be,[d(g,{modelValue:i(e).collapseName,"onUpdate:modelValue":t[1]||(t[1]=c=>i(e).collapseName=c)},{default:m(()=>[d(O,{name:"1"},{title:m(()=>[d(n,{title:"\u6295\u4FDD\u65B9\u6848"})]),default:m(()=>[i(e).riskData.length?(p(),R("div",Fe,[d(s,{ref_key:"riskFormRef",ref:F,"input-align":"right","error-message-align":"right"},{default:m(()=>[d(J,{"risk-info":v.value[0],enums:i(e).enumList,"origin-data":i(e).riskData,"pick-factor":S},null,8,["risk-info","enums","origin-data"])]),_:1},512)])):C("",!0),i(e).riskPlanData.length?(p(),R("div",Ie,[d(s,{ref_key:"riskFormRef",ref:F,"input-align":"right","error-message-align":"right"},{default:m(()=>[d(_,{active:i(e).currentPlan,"onUpdate:active":t[0]||(t[0]=c=>i(e).currentPlan=c)},{default:m(()=>[(p(!0),R(ge,null,ke(i(e).riskPlanData,c=>(p(),T(r,{key:c.planCode,name:c.planCode,title:c.planName},{title:m(()=>[d(o,{title:c.planName,active:i(e).currentPlan===c.planCode},null,8,["title","active"])]),default:m(()=>[c.planCode===i(e).currentPlan?(p(),T(J,{key:0,"risk-info":v.value[c.planCode],enums:i(e).enumList,"origin-data":c.riskDetailVOList,"pick-factor":S},null,8,["risk-info","enums","origin-data"])):C("",!0)]),_:2},1032,["name","title"]))),128))]),_:1},8,["active"])]),_:1},512)])):C("",!0)]),_:1})]),_:1},8,["modelValue"])]),D("div",Ee,[D("span",Ne,[D("span",Ae,Pe((i(e).retrialTip?"0":((M=i(e).trialResult)==null?void 0:M.premium)||"0").toLocaleString()),1),Se]),D("div",xe,[i(e).retrialTip?(p(),R("div",Ue,[Me,D("span",{class:"close-icon",onClick:H},"X")])):C("",!0),i(e).canTrial?(p(),T(P,{key:1,type:"primary",onClick:te},{default:m(()=>[qe]),_:1})):(p(),T(P,{key:2,type:"primary",onClick:Z},{default:m(()=>[Ye]),_:1}))])])]}),_:1})}}});var Ge=Le(je,[["__scopeId","data-v-ed02a4de"]]);export{Ge as default};
