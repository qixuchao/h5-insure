import{d as e,af as a,ag as t,i as o,h as n,c9 as s,r as i,j as r,aG as l,l as u,o as d,c,b as f,u as p,p as m,q as y,f as I,w as v,F as h,s as b,a as w,g,v as j,e as C,dG as x,ah as V,bH as q,ak as P,bK as k,aS as L,dM as T,aQ as _,aN as E,T as N,c6 as O}from"./index-308a6130.js";import{P as R,a as U}from"./PolicyInfo-78dfde71.js";import{g as A,m as M}from"./trial-25629e93.js";import{n as S}from"./nextStep-90a89e2b.js";import{b as D,l as F}from"./product-23cac0b3.js";import{u as Q}from"./useOrder-c150b01d.js";import{P as G}from"./constants-29516b3a.js";import{P as J}from"./index-f5d944d5.js";import{P as $}from"./index-30640e74.js";import{_ as B}from"./InsureInfo-f1b14f06.js";import{p as z,d as W}from"./utils-0a59abb2.js";import{Q as H}from"./notice-33e6eedd.js";import{g as K}from"./utils-f2cca166.js";import{Q as X}from"./questionnaire-42dcb602.js";import{P as Y}from"./constants-b39aa53b.js";import{T as Z}from"./infoCollection-e3913a49.js";import"./core-fd6cee84.js";import"./cloneDeep-e32c65b9.js";import"./util-c8d82ba5.js";import"./trial-34e9a059.js";const ee={class:"long-info-preview"},ae={class:"footer-button"},te=e({__name:"infoPreview",setup(e){const te=a((()=>t((()=>import("./index-b878c713.js")),["static/js/index-b878c713.js","static/css/index-fa4edf2a.css","static/js/index-308a6130.js","static/css/index-3ce2d7e3.css","static/js/theme-94cf7d00.js","static/js/index-30640e74.js","static/css/index-bbfdd7ec.css","static/js/utils-f2cca166.js","static/js/infoCollection-e3913a49.js","static/js/trial-34e9a059.js"]))),oe=o(),ne=n(),se=Q({}),{productCode:ie="",tenantId:re,agentCode:le="",agencyCode:ue,saleChannelId:de,isShare:ce,orderNo:fe,extraInfo:pe,insurerCode:me,objectType:ye="1",templateId:Ie,preview:ve,origin:he,pageType:be}=oe.query;let we={};try{we=JSON.parse(decodeURIComponent(pe))}catch(De){}const[ge,je]=s(!1),Ce=i({isView:!1,personalInfo:{},policyInfo:{schema:[],config:[],formData:{}},payInfo:{schema:[],config:[],formData:[]},customerQuestions:[]}),xe=`${window.origin}/baseInsurance/long/phoneVerify${window.location.search}`;r({imgUrl:"",desc:"",title:"",link:xe});const Ve=r(),qe=r(),Pe=r(!1),ke=r(!1),Le=r(0),Te=r(!1),_e=()=>{ke.value=!1},Ee=()=>{Pe.value=!0,se.value.extInfo.buttonCode=x.short.underWrite,se.value.extInfo.pageCode="infoPreview",S(se.value,((e,a)=>{_.JUMP_ALERT===a&&E.confirm({})}))},Ne=()=>{Ie===Z.FREE?(se.value.extInfo.buttonCode=x.free.faceVerify,se.value.extInfo.pageCode="faceAuth",S(se.value,((e,a)=>{a===_.JUMP_PAGE&&N("被保人已完成认证")}))):be?(delete oe.query.pageType,ne.push({path:G.holderInfoPreview,query:oe.query})):(se.value.extInfo.buttonCode=x.short.faceVerify,se.value.extInfo.pageCode="faceAuth",S(se.value,((e,a)=>{a===_.JUMP_PAGE&&N("被保人已完成认证")})))},Oe=async()=>{if(Ie===Z.FREE){se.value.extInfo.buttonCode=x.free.faceVerify,se.value.extInfo.pageCode="faceAuth",await S(se.value);const{code:e,data:a}=await A({orderNo:fe,tenantId:re});"10000"===e&&(Object.assign(se.value,a),se.value.extInfo.buttonCode=x.free.underWriteAndIssue,se.value.extInfo.pageCode="productInfo",S(se.value,((e,a)=>{a===_.JUMP_PAGE&&(delete oe.query.pageType,ne.push({path:Y[e.nextPageCode],query:oe.query}))})))}else{if(Pe.value)return void Ee();je(!0)}},Re=r(),Ue=r(),Ae=r([]),Me=async()=>{let e={};const{code:a,data:t}=await A({orderNo:fe,tenantId:re});"10000"===a&&(Object.assign(se.value,t),e=z(t.insuredList[0].productList),Re.value=t,Te.value=!0),(async e=>{let a=[];const{code:t,data:o}=await O({orderNo:fe,tenantId:re});"10000"===t&&(a=o.productQuestionnaireVOList);const{code:n,data:s}=await F(e);if("10000"===n){const{productQuestionnaireVOList:e}=s||{},t=e.filter((e=>e.businessType!==H.VISIT));Ce.customerQuestions=t.map((e=>{const{questionnaireDetailResponseVO:t,questionnaireId:o,questionnaireName:n}=e||{},{questions:s,basicInfo:i}=t||{},{objectType:r,questionnaireType:l}=i||{};if(l===X.TEXT){const{content:e,textType:a}=(null==s?void 0:s[0])||{};return{content:e,contentType:K(`${a}`,e),questionnaireId:o,questionnaireName:n}}const u=(a||[]).find((e=>e.questionnaireId===o));return{...t,contentType:"question",...null==u?void 0:u.questionnaireDetailResponseVO,questionnaireId:o,questionnaireName:n}}))}})({productCodeList:e.productList.map((e=>e.productCode))}),D(e).then((({code:e,data:a})=>{if("10000"===e){const{productMaterialList:e,riskMaterialList:t}=W(a);Ce.fileList=e.map((e=>({tabName:e.attachmentName,isExpand:!0,files:e.attachmentList.map((e=>({name:e.materialName,file:e.materialContent,type:e.materialSource,mustRead:e.mustReadFlag===V.YES})))}))),Ae.value=e.concat(t)}})),M(e).then((({data:e,code:a})=>{if("10000"===a){const{productDetailResList:a,productFactor:t}=e;Ue.value=t;const{payInfo:o,other:n}=q(t);Ce.payInfo={...Ce.payInfo,...o},Ce.policyInfo={...Ce.policyInfo,...n}}}))};l((()=>{Me()}));const Se=r();return u((()=>{setTimeout((async()=>{Se.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,a)=>{var t,o,n;const s=P,i=k,r=L,l=T;return d(),c("div",ee,[f(s),f(B,{"product-data":null==(o=null==(t=p(se).insuredList)?void 0:t[0])?void 0:o.productList},null,8,["product-data"]),(null==(n=Object.keys(p(Ue)||{}))?void 0:n.length)?(d(),m(J,{key:0,ref_key:"personalInfoRef",ref:qe,modelValue:p(Re),"onUpdate:modelValue":a[0]||(a[0]=e=>y(Re)?Re.value=e:null),"product-factor":p(Ue),"is-view":"","input-align":"left"},null,8,["modelValue","product-factor"])):I("",!0),p(Ce).payInfo.schema.length?(d(),m(p(R),{key:1,ref_key:"payInfoRef",ref:Ve,modelValue:p(se).tenantOrderPayInfoList,"onUpdate:modelValue":a[1]||(a[1]=e=>p(se).tenantOrderPayInfoList=e),schema:p(Ce).payInfo.schema,"is-view":""},null,8,["modelValue","schema"])):I("",!0),p(Ce).policyInfo.schema.length?(d(),m(p(U),{key:2,modelValue:p(se).extInfo,"onUpdate:modelValue":a[2]||(a[2]=e=>p(se).extInfo=e),schema:p(Ce).policyInfo.schema,"is-view":""},null,8,["modelValue","schema"])):I("",!0),f(r,{title:"产品资料","show-line":!1,"show-icon":!1},{default:v((()=>[(d(!0),c(h,null,b(p(Ae),((e,a)=>(d(),m(i,{key:a,"is-link":"",title:e.attachmentName,onClick:e=>(e=>{Le.value=e,ke.value=!0})(a)},null,8,["title","onClick"])))),128))])),_:1}),w("div",ae,["share"===p(he)||p(be)?(d(),m($,{key:0,shadow:!1,onClick:Ne},{default:v((()=>[g(e.$slots,"default",{},(()=>[j("确认")]))])),_:3})):(d(),m($,{key:1,shadow:!1,onClick:Oe},{default:v((()=>[g(e.$slots,"default",{},(()=>[j(C(p(Ie)===p(Z).FREE?"领取保障并激活":"确认支付"),1)]))])),_:3}))]),p(ke)?(d(),m(p(te),{key:3,show:p(ke),"onUpdate:show":a[3]||(a[3]=e=>y(ke)?ke.value=e:null),"content-list":[p(Ae)[p(Le)]],"is-only-view":"","active-index":0,text:"关闭","force-read-cound":0,onOnCloseFilePreviewByMask:_e},null,8,["show","content-list"])):I("",!0),p(ge)?(d(),m(l,{key:4,modelValue:p(ge),"onUpdate:modelValue":a[4]||(a[4]=e=>y(ge)?ge.value=e:null),closeable:!1,"data-source":p(Ce).fileList,onSubmit:Ee},null,8,["modelValue","data-source"])):I("",!0)])}}});export{te as default};
