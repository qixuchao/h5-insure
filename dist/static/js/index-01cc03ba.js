var U=Object.defineProperty,Y=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var A=(a,l,n)=>l in a?U(a,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[l]=n,d=(a,l)=>{for(var n in l||(l={}))H.call(l,n)&&A(a,n,l[n]);if(T)for(var n of T(l))X.call(l,n)&&A(a,n,l[n]);return a},p=(a,l)=>Y(a,z(l));import{a as G,g as Q,C as V,L as W,a3 as w,x as Z,X as g,o as ee,r as v,h as P,m as R,n as f,k as I,y,z as c,j as te,s as D,a1 as se,a2 as re,B as ie}from"./vendor-4dbfa310.js";import{P as E,R as oe,i as ae,p as ne}from"./trial-ef6a620a.js";import{g as ue}from"./index-43962f28.js";import{_ as le}from"./index-e3074f98.js";const Ie=G({id:"createProposal",state:()=>({proposalInfo:{},trialData:[]}),actions:{setProposalInfo(a){this.$state.proposalInfo=a},setTrialData(a){this.$state.trialData=a}}});const ce=a=>(se("data-v-1fbe738d"),a=a(),re(),a),de={class:"com-product-risk-wrapper"},pe={class:"popup-container"},fe=ce(()=>y("div",{class:"popup-title"},"\u8BF7\u9009\u62E9\u4FDD\u969C\u65B9\u6848",-1)),me={class:"risk-trial-wrapper"},ke={key:0,class:"part-card"},Ve={key:1,class:"part-card"},he={class:"risk-content"},_e={key:0,class:"risk"},Oe={class:"footer-bar"},Le=ie("\u786E\u8BA4"),ge=Q({props:{isShow:{type:Boolean,default:!1},type:{default:"add"},productId:{default:0},riskType:{default:1},formInfo:{default:{}},productData:{default:{}}},emits:["close","finished"],setup(a,{emit:l}){const n=a,L=V({personVO:{}}),h=V({insuredCode:"",personVO:{}}),_=V({}),b=V({}),B=V({}),C=V({}),F=V({}),e=W({currentPlan:"0",isShow:n.isShow,riskBaseInfo:{},holderFactor:[],insuredFactor:[],riskData:[],riskPlanData:[],trialResult:{},canTrial:!0,retrialTip:!1,enumList:{},ageRange:[],collapseName:["1"]});w("premium",F.value),w("source","proposal");const S=Z(()=>{var i;let t="";if((i=e.riskData)==null?void 0:i[0]){const o=e.riskData[0],r=((o==null?void 0:o.requiredRiderRiskVOList)||[]).map(s=>s.riskName);r.length&&(t=`\u7279\u6B8A\u63D0\u793A: ${o.riskName}\u548C${r.join("\u3001")}\u5FC5\u987B\u540C\u65F6\u6295\u4FDD`)}return t}),x=(t,i)=>{var s;const o=(t.insuredVOList[0].productPlanVOList[0].riskVOList[0].riderRiskVOList||[]).map(u=>p(d({},u),{premium:i[u.riskCode].premium}));return{proposalHolder:((s=t.holder)==null?void 0:s.personVO)||{},proposalInsuredList:[p(d({},t.insuredVOList[0].personVO),{proposalInsuredProductList:[{productId:e.riskBaseInfo.id,productName:e.riskBaseInfo.productName,proposalProductRiskList:[p(d({},t.insuredVOList[0].productPlanVOList[0].riskVOList[0]),{premium:i[t.insuredVOList[0].productPlanVOList[0].riskVOList[0].riskCode].premium,riderRiskVOList:o})]}]})]}},$=()=>{const t=JSON.parse(JSON.stringify(_.value[e.currentPlan])),i=Object.values(t.riderRiskVOList).map(r=>{const s=r;if(s.chargePeriod==="3"){const u=(_.value[e.currentPlan].chargePeriod||"").split("_");u[1]&&(u[1]-=1),s.chargePeriod=u.join("_")}return s.liabilityVOList=(s.liabilityVOList||[]).filter(u=>u.liabilityAttributeValue!=="-1").map(u=>{const m=u;return m.liabilityAttributeValue==="0"&&(m.liabilityAttributeValue=""),m}),s});t.liabilityVOList=t.liabilityVOList.filter(r=>r.liabilityAttributeValue!=="-1").map(r=>{const s=r;return s.liabilityAttributeValue==="0"&&(s.liabilityAttributeValue=""),s});const o={holder:{personVO:p(d({},L.value.personVO),{birthday:L.value.personVO.birthday?`${L.value.personVO.birthday} 00:00:00`:""})},productCode:e.riskBaseInfo.productCode,insuredVOList:[p(d({},h.value),{personVO:p(d({},h.value.personVO),{birthday:h.value.personVO.birthday&&`${h.value.personVO.birthday} 00:00:00`}),productPlanVOList:[{planCode:e.currentPlan||"",riskVOList:[p(d({},t),{riderRiskVOList:i})]}]})]};ne(d({},o)).then(({code:r,data:s})=>{if(r==="10000"){e.retrialTip=!1,e.trialResult=s,e.canTrial=!1;const u={},m=(O=[])=>{O.forEach(k=>{var N;u[k.riskCode]=k,((N=k.riskPremiumDetailVOList)==null?void 0:N.length)&&m(k.riskPremiumDetailVOList)})};m(s.riskPremiumDetailVOList),Object.assign(F.value,u),l("finished",x(o,u))}else e.retrialTip=!0})},j=()=>{var t,i,o,r,s;Promise.all([(i=(t=b.value)==null?void 0:t.validateForm)==null?void 0:i.call(t),(r=(o=B.value)==null?void 0:o.validateForm)==null?void 0:r.call(o),(s=C.value)==null?void 0:s.validate()]).then(()=>{$()})},q=()=>{l("close")},M=()=>{ue({dictCodeList:["RISK_PAYMENT_PERIOD","RISK_INSURANCE_PERIOD"]}).then(({code:i,data:o})=>{if(i==="10000"){const r={};o.forEach(s=>{r[s.dictCode]=s.dictItemList}),e.enumList=r}})},J=()=>{ae({productId:n.productId,source:2}).then(({code:t,data:i})=>{t==="10000"&&(e.riskBaseInfo=i.productBasicInfoVO,(i.productRelationPlanVOList||i.riskDetailVOList||[]).forEach((o,r)=>{r===0&&(e.currentPlan=o.planCode||"0"),Object.assign(_.value,{[o.planCode||r]:{liabilityVOList:[],riderRiskVOList:{}}})}),e.riskData=i.riskDetailVOList||[],e.riskPlanData=i.productRelationPlanVOList||[])}).finally(()=>{})},K=t=>{e.holderFactor=t.holderFactorList,e.insuredFactor=t.insuredFactorList,e.ageRange=t.ageRange};return g([()=>_.value,()=>L.value,()=>h.value],t=>{t&&!e.canTrial&&(e.canTrial=!0,e.retrialTip=!0)},{deep:!0}),g(()=>n.isShow,t=>{e.isShow=t},{immediate:!0}),g(()=>n.productId,t=>{t&&J()},{immediate:!0}),g(()=>n.formInfo,(t={})=>{if(n.type==="edit"){const i={0:p(d({},t.proposalProductRiskList[0]),{riderRiskVOList:t.proposalProductRiskList[0].proposalProductRiskVOList})};Object.assign(_.value,i)}},{deep:!0,immediate:!0}),g(()=>n.productData,t=>{n.type==="edit"&&(console.log("newVal",t),e.riskBaseInfo=t.productBasicInfoVO,e.riskData=t.riskDetailVOList)},{deep:!0,immediate:!0}),ee(()=>{M()}),(t,i)=>{const o=v("ProMessage"),r=v("ProTitle"),s=v("VanForm"),u=v("VanButton"),m=v("VanPopup");return P(),R("div",de,[f(m,{show:c(e).isShow,"onUpdate:show":i[0]||(i[0]=O=>c(e).isShow=O),round:"",position:"bottom",closeable:"",style:{height:"80%"},onClose:q},{default:I(()=>{var O,k;return[y("div",pe,[fe,c(S)?(P(),te(o,{key:0,content:c(S)},null,8,["content"])):D("",!0),y("div",me,[c(e).holderFactor.length?(P(),R("div",ke,[f(r,{title:"\u6295\u4FDD\u4EBA"}),f(E,{ref_key:"holderRef",ref:b,"insured-code":(O=c(e).riskBaseInfo)==null?void 0:O.insurerCode,"form-info":L.value.personVO,"factor-list":c(e).holderFactor,"age-range":c(e).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):D("",!0),c(e).insuredFactor.length?(P(),R("div",Ve,[f(r,{title:"\u88AB\u4FDD\u4EBA"}),f(E,{ref_key:"insuredRef",ref:B,"insured-code":(k=c(e).riskBaseInfo)==null?void 0:k.insurerCode,"form-info":h.value.personVO,"factor-list":c(e).insuredFactor,"age-range":c(e).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):D("",!0),y("div",he,[f(r,{title:"\u6295\u4FDD\u65B9\u6848"}),c(e).riskData.length?(P(),R("div",_e,[f(s,{ref_key:"riskFormRef",ref:C,"input-align":"right","error-message-align":"right"},{default:I(()=>[f(oe,{"risk-info":_.value[0],enums:c(e).enumList,"origin-data":c(e).riskData,"pick-factor":K},null,8,["risk-info","enums","origin-data"])]),_:1},512)])):D("",!0)])]),y("div",Oe,[f(u,{block:"",type:"primary",onClick:j},{default:I(()=>[Le]),_:1})])])]}),_:1},8,["show"])])}}});var be=le(ge,[["__scopeId","data-v-1fbe738d"]]);export{be as P,Ie as u};
