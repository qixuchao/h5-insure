import{ae as a,d as e,o as n,c as l,f as t,a as i,F as o,s as r,e as s,j as m,ai as u,aj as d,r as c,k as p,E as f,b as v,ak as E,w as y,p as h,u as R,al as T,q as I,_ as g,am as S,an as D,ao as b,ap as _,ag as M,aq as w,ar as N,as as L,at as k,au as C,av as P,aw as V}from"./index-d3f9fc28.js";import{c as j}from"./cloneDeep-66e92211.js";const A=[{value:5,label:"支付宝",iconName:"ali"},{value:6,label:"微信",iconName:"wechat"}];a([{value:1,label:"实时转账"},{value:2,label:"批量扣款"}]);var F=(a=>(a[a.DEBIT=1]="DEBIT",a[a.CREDIT=2]="CREDIT",a[a.PRE_PAY=3]="PRE_PAY",a[a.PRE_CREDIT=4]="PRE_CREDIT",a[a.OTHER=5]="OTHER",a))(F||{});a([{value:1,label:"借记卡"},{value:2,label:"贷记卡"},{value:3,label:"预付费卡"},{value:4,label:"准贷记卡"},{value:5,label:"其他"}]);var G=(a=>(a[a.FIRST_TERM=1]="FIRST_TERM",a[a.RENEW_TERM=2]="RENEW_TERM",a[a.REPRISE=3]="REPRISE",a[a.OTHER=4]="OTHER",a))(G||{});const W=[{value:1,label:"首期支付"},{value:2,label:"续期支付"},{value:3,label:"年金领取"},{value:4,label:"其他"}];a(W);var O=(a=>(a[a.FIRST_SAME=1]="FIRST_SAME",a[a.RENEW_SAME=2]="RENEW_SAME",a[a.OTHER=3]="OTHER",a))(O||{});a(W);a([{value:1,label:"自动垫付"},{value:2,label:"中止合同"}]);const x={key:0,class:"head-warning-wrap"},B={key:0,class:"warning-icon"},$=[i("span",null,"!",-1)],H={class:"warning-text"},J=e({name:"HeadWaring"}),U=e({...J,props:{labels:{default:()=>[]},showIcon:{type:Boolean,default:!0}},setup:a=>(a,e)=>a.labels.length>0?(n(),l("div",x,[a.showIcon?(n(),l("div",B,$)):t("",!0),i("div",H,[(n(!0),l(o,null,r(a.labels,(a=>(n(),l("span",{key:a},s(a),1)))),128))])])):t("",!0)});const q={class:"img-wrap"},z=["src"];var Y=g(e({__name:"PayInfo",props:{schema:{default:()=>[]},config:{default:()=>[]},modelValue:{default:()=>[]},isView:{type:Boolean,default:!1},userData:{default:()=>({})}},emits:["update:modelValue"],setup(a,{expose:e,emit:t}){const s=a,g="1",A=m(!1),W=m(0),x=[{img:"/h5insure/static/jpg/picidikou-cd1b0c24.jpg",title:"实时转账"},{img:"/h5insure/static/jpg/shishizhuanzhang-680e7d84.jpg",title:"批次抵扣"}],B=()=>{A.value=!0},$=m(null),H=["cardType","bankCard"],J=["orderId","tenantId","id"],Y={paymentType:"1",paymentMethod:"1",expiryMethod:"1",cardType:F.DEBIT},K=[...Object.keys(Y),"paymentGenre"],Q=[{title:"首期支付",schema:[],payInfoType:G.FIRST_TERM,formData:{},config:{cardType:{isView:!0},bankCard:{accountName:{isView:!0}}},objectType:u.INIT_SIGN},{title:"续期支付",schema:[],payInfoType:G.RENEW_TERM,formData:{paymentGenre:String(O.FIRST_SAME)},config:{cardType:{isView:!0},bankCard:{accountName:{isView:!0}}},objectType:u.RENEWAL_SIGN},{title:"年金领取银行卡",schema:[],payInfoType:G.REPRISE,formData:{paymentMethod:"1",paymentGenre:String(O.FIRST_SAME)},config:{},objectType:u.ANNUAL_SIGN}].map((a=>({...a,nanoid:d()}))),X=[["initialPaymentMethod","initialCardType","initialBankCard","initialPaymentType"],["renewalPaymentGenre","renewalPaymentMethod","renewalCardType","renewalBankCard","renewalPaymentType","expiryMethod"],["annuityPaymentGenre","annuityBankCard"]],Z=c({schemaList:[]}),aa=p((()=>{var a,e;return(null==(e=null==(a=s.userData.insuredList)?void 0:a[0])?void 0:e.name)||null})),ea=p((()=>{var a,e;return(null==(e=null==(a=s.userData)?void 0:a.holder)?void 0:e.name)||null})),na=p((()=>["FIRST_TERM","RENEW_TERM","REPRISE"].reduce(((a,e)=>{const n=(l=e,Z.schemaList.findIndex((a=>String(a.payInfoType)===String(G[l]))));var l;return n>-1&&(a[e]=n),a}),{}))),la=(a,e)=>{var n,l;return a>-1&&(null==(l=null==(n=Z.schemaList[a])?void 0:n.formData)?void 0:l.paymentGenre)===`${O[e]}`},ta=p((()=>{const a=Z.schemaList.map((a=>`${a.payInfoType}`));return Q.filter((e=>a.includes(String(e.payInfoType))))})),ia=(a,e)=>{var n;const{formData:l}=Z.schemaList[e]||{},{paymentGenre:t,id:i,...o}=l||{},r={bankCardImage:b(o.bankCardImage)?o.bankCardImage.map((e=>{var n,l;return{...e,objectType:null==(l=null==(n=ta.value)?void 0:n[a])?void 0:l.objectType}})):[]};Object.keys(o).reduce(((a,e)=>(o[e]&&(a[e]=o[e]),a)),r),M(null==(n=Z.schemaList[a])?void 0:n.formData,r)};return f((()=>Z.schemaList.map((a=>{var e,n;return[null==(e=null==a?void 0:a.formData)?void 0:e.paymentMethod,null==(n=null==a?void 0:a.formData)?void 0:n.paymentGenre]}))),((a,e)=>{S("支付方式/支付类型变动"),Z.schemaList.forEach(((a,e)=>{const{formData:n,schema:l}=a||{},t=g===String(null==n?void 0:n.paymentMethod),i=[O.FIRST_SAME,O.RENEW_SAME].includes(Number(null==n?void 0:n.paymentGenre));l.forEach((a=>{a.hidden=(i||!t)&&((a,e=!1)=>{if(a){const n=[...H];return e&&n.push("paymentMethod"),n.includes(a)}return!1})(a.name,i)})),a.nanoid=d()}))}),{deep:!0,immediate:!0}),f((()=>Z.schemaList.map((a=>{var e;return null==(e=null==a?void 0:a.formData)?void 0:e.paymentType}))),((a,e)=>{!D(a,e)&&b(e)&&Z.schemaList.forEach(((a,n)=>{var l,t;(null==(l=null==a?void 0:a.formData)?void 0:l.paymentType)===(null==e?void 0:e[n])&&1!==(null==(t=null==a?void 0:a.formData)?void 0:t.paymentGenre)||Object.assign(a.formData,_(null==a?void 0:a.formData,(a=>["bankCardNo","payBank","mobile","bankCardImage","verificationCode"].includes(a))))}))}),{deep:!0}),f((()=>Z.schemaList.map((a=>{var e;return null==(e=null==a?void 0:a.formData)?void 0:e.payBank}))),((a,e)=>{!D(a,e)&&b(e)&&Z.schemaList.forEach(((a,n)=>{var l,t;(null==(l=null==a?void 0:a.formData)?void 0:l.payBank)===(null==e?void 0:e[n])&&1!==(null==(t=null==a?void 0:a.formData)?void 0:t.paymentGenre)||Object.assign(a.formData,_(null==a?void 0:a.formData,(a=>["bankCardNo","mobile","bankCardImage","verificationCode"].includes(a))))}))}),{deep:!0}),f((()=>Z.schemaList.map((a=>{var e;return null==(e=null==a?void 0:a.formData)?void 0:e.bankCardNo}))),((a,e)=>{!D(a,e)&&b(e)&&Z.schemaList.forEach(((a,n)=>{var l;(null==(l=null==a?void 0:a.formData)?void 0:l.bankCardNo)!==(null==e?void 0:e[n])&&(M(a.formData,_(null==a?void 0:a.formData,(a=>["mobile","bankCardImage","verificationCode"].includes(a)))),console.log("item.formData",a.formData))}))}),{deep:!0}),f((()=>{var a;return j(null==(a=Z.schemaList[na.value.FIRST_TERM])?void 0:a.formData)}),((a,e)=>{if(s.isView||JSON.stringify(a)===JSON.stringify(e))return!1;const{REPRISE:n,RENEW_TERM:l}=na.value;S("首期数据变动"),la(l,"FIRST_SAME")&&ia(l,na.value.FIRST_TERM),la(n,"FIRST_SAME")&&ia(n,l)}),{deep:!0}),f((()=>{var a;return null==(a=Z.schemaList[na.value.RENEW_TERM])?void 0:a.formData}),((a,e)=>{if(s.isView||D(a,e))return!1;S("续期数据变动");const{REPRISE:n,RENEW_TERM:l}=na.value;la(n,"RENEW_SAME")&&ia(n,l)}),{deep:!0}),f((()=>Z.schemaList.map((a=>{var e;return null==(e=null==a?void 0:a.formData)?void 0:e.paymentMethod}))),((a,e)=>{JSON.stringify(a)!==JSON.stringify(e)&&Z.schemaList.forEach(((n,l)=>{const t=a[l],i=e[l],o=t&&i&&String(t)!==String(i);n.payInfoType!==G.REPRISE&&o&&"1"!==String(t)&&M(n.formData,{..._(n.formData,(a=>V.includes(a))),bankCardImage:null})}))}),{deep:!0}),f((()=>{var a,e;return null==(e=null==(a=Z.schemaList[na.value.RENEW_TERM])?void 0:a.formData)?void 0:e.paymentGenre}),(a=>{var e,n;if(s.isView)return!1;S("续期支付类型变动");const{FIRST_TERM:l,RENEW_TERM:t}=na.value;String(a)===String(O.FIRST_SAME)?ia(t,l):Z.schemaList[t]&&(M(Z.schemaList[t].formData,{..._(Z.schemaList[t].formData,(a=>!J.includes(a))),...null==(n=null==(e=ta.value)?void 0:e[t])?void 0:n.formData,accountName:ea.value,paymentGenre:a}),Z.schemaList[t].nanoid=d())})),f((()=>{var a,e;return null==(e=null==(a=Z.schemaList[na.value.REPRISE])?void 0:a.formData)?void 0:e.paymentGenre}),((a,e)=>{var n,l;if(s.isView||!a||!e||a===e)return!1;const{FIRST_TERM:t,RENEW_TERM:i,REPRISE:o}=na.value,r=[O.FIRST_SAME,O.RENEW_SAME].includes(Number(a));if(S("年金支付类型变动"),r){const e=String(a)===String(O.FIRST_SAME)?t:i;ia(o,e)}else Z.schemaList[o]&&(M(Z.schemaList[o].formData,{..._(Z.schemaList[o].formData,(a=>!J.includes(a))),...null==(l=null==(n=ta.value)?void 0:n[o])?void 0:l.formData,accountName:aa.value,paymentGenre:a}),Z.schemaList[o].nanoid=d())}),{immediate:!0}),f([()=>s.schema,()=>s.config],(()=>{let a=[];Z.schemaList=s.schema.reduce(((e,n)=>{const l=X.findIndex((a=>a.includes(n.name)));if("paymentDrawType"===n.name&&(a=n.columns.map((a=>a.code))),l>-1){const a=(a=>{if("string"!=typeof a||!a)return"";const[e,n]=a.match(/^(?:initial|renewal|annuity)(.*)$/)||[];return n?P(n):a})(n.name);if(K.includes(a)){const t=(({name:a,columns:e},n)=>{if(b(e)){const l={...n,...Y},t=b(e)&&e.find((e=>`${e.code}`==`${l[a]}`));return{[a]:t?l[a]:null}}return{}})({name:a,columns:n.columns},Q[l].formData);M(e[l].formData,t),M(Q[l].formData,t)}e[l].schema.push({...n,name:a,payInfoType:Q[l].payInfoType})}return e}),w(Q)).map(((a,e)=>({...a,config:{...a.config,...s.config[e]||{}},nanoid:d()}))).filter((({schema:e,...n})=>a.includes(`${n.payInfoType}`)&&b(e)))}),{deep:!0,immediate:!0}),f((()=>s.modelValue),(a=>{b(a)&&Z.schemaList.forEach(((e,n)=>{var l;M(e.formData,a[n]),M(e.config,{payBank:{category:null==(l=null==a?void 0:a[n])?void 0:l.paymentType}})}))}),{deep:!0,immediate:!0}),f((()=>{var a;return null==(a=Z.schemaList)?void 0:a.map((a=>a.formData))}),(a=>{b(a)&&t("update:modelValue",a.map(((a,e)=>{const{payInfoType:n}=Z.schemaList[e];return{...a,payInfoType:n}})))}),{deep:!0,immediate:!0}),f((()=>[ea.value,aa.value]),(([a,e])=>{(a||e)&&Z.schemaList.forEach((n=>{const l=n.payInfoType===G.REPRISE;n.formData.accountName=l?e:a}))}),{deep:!0}),e({validate:a=>{var e;return Promise.all($.value?null==(e=$.value)?void 0:e.map((a=>null==a?void 0:a.validate())):[])}}),(a,e)=>{const t=N,s=L,m=k,u=C;return n(),l(o,null,[v(t,{title:"支付方式","show-line":!1,"show-divider":!1},E({_:2},[a.isView?void 0:{name:"extra",fn:y((()=>[i("span",{class:"extra",onClick:B},"银行限额表")])),key:"0"}]),1024),(n(!0),l(o,null,r(R(Z).schemaList,((e,l)=>(n(),h(R(T),{ref_for:!0,ref_key:"payInfoFormRef",ref:$,key:`${e.nanoid}_${l}`,schema:e.schema,model:e.formData,config:e.config,title:e.title,"show-icon":!1,"is-view":a.isView,"extra-provision":{objectType:e.objectType,objectId:e.formData.id}},null,8,["schema","model","config","title","is-view","extra-provision"])))),128)),v(u,{show:R(A),"onUpdate:show":e[1]||(e[1]=a=>I(A)?A.value=a:null),title:"银行卡可用列表"},{default:y((()=>[v(U,{"show-icon":!1,labels:["只支持借记卡，不支持信用卡和存折"]}),v(m,{active:R(W),"onUpdate:active":e[0]||(e[0]=a=>I(W)?W.value=a:null)},{default:y((()=>[(n(),l(o,null,r(x,((a,e)=>v(s,{key:e,title:a.title},{default:y((()=>[i("div",q,[i("img",{src:a.img,alt:""},null,8,z)])])),_:2},1032,["title"]))),64))])),_:1},8,["active"])])),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-47fdd2b8"]]);const K=e({name:"policyInfo"}),Q=e({...K,props:{schema:{default:()=>[]},config:{default:()=>[]},modelValue:{default:()=>[]},isView:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(a,{expose:e,emit:l}){const t=a,i=c({schema:{},modelValue:{},config:{}}),o=m();return f([()=>t.schema,()=>t.config],(()=>{i.schema=t.schema,i.config=t.config}),{deep:!0,immediate:!0}),f((()=>t.modelValue),((a,e)=>{a!==e&&Object.assign(i.modelValue,a)}),{deep:!0,immediate:!0}),f((()=>i.modelValue),(a=>{l("update:modelValue",a)}),{deep:!0,immediate:!0}),e({validate:()=>{var a;return null==(a=o.value)?void 0:a.validate()}}),(a,e)=>(n(),h(R(T),{ref_key:"policyInfoFormRef",ref:o,schema:R(i).schema,model:R(i).modelValue,config:R(i).config,title:"保单信息",class:"policy-info","is-view":a.isView},null,8,["schema","model","config","is-view"]))}});export{A,Y as P,U as _,Q as a};
