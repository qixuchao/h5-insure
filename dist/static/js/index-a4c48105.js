import{l as e,a as i,P as l}from"./index-b127c8b3.js";import{d as a,z as s,o as t,a1 as n,R as u,c as o,A as r,V as d,U as c,g as p,i as v,w as k,h as m,G as f,aN as I,r as y,e as L,f as h,aO as g,aP as V,L as b,ah as R,j as C,E as O,aB as P,aZ as x,a3 as T,ab as D,B as S,a_ as w,a$ as F,am as _,an as E,u as j,a as N,$ as M,k as q,av as B,T as A}from"./index-9df4f971.js";import{I as K}from"./index-780c5572.js";/* empty css              */import{S as U}from"./index-a2f33451.js";import{P as $}from"./index-a3827b92.js";import{S as Q,_ as W}from"./box-title-9a3e30ca.js";import{_ as z}from"./index-b507edd3.js";import{T as H}from"./Table-9f618b44.js";import{R as G}from"./trial-3aed0f8b.js";import{u as Z,b as J,p as X,q as Y,c as ee}from"./trial-b078714f.js";import{u as ie}from"./useOrder-479f616e.js";import"./infoCollection-2e42023d.js";import"./core-44174aed.js";const le={key:0},ae={key:0,class:"risk2-field"},se=a({name:"ProductRiskList"});var te=f(a({...se,props:{dataSource:{type:Array,default:()=>[]},productInfo:{type:Object,default:()=>({productCode:"",productName:""})},showMainRisk:{type:Boolean,default:()=>!0},defaultValue:{type:Object,default:()=>{}}},emits:["trialChange"],setup(e,{emit:i}){const l=e,a=s({loading:!1,show:!0,select:{},list:[],userData:{},riskIsInsure:{},submitData:{},disabledRiskInfo:[],risksDefaultValue:{}}),f=e=>{const i=[];return e.riskLiabilityInfoVOList.map((e=>(1!=+e.showFlag&&i.push({...e}),[]))),i},y=(e,s,t)=>{var n;a.riskIsInsure[s].data=e;const u=[...a.disabledRiskInfo];null==(n=l.dataSource.insureProductRiskVOList)||n.forEach((e=>{if(1!==e.mainRiskFlag){const i=a.riskIsInsure[e.riskId];i.data&&Object.keys(i.data).length>0&&"1"===i.selected&&u.push(i.data)}})),i("trialChange",u,t)},L=(e,i)=>{var s;null==(s=l.dataSource.productRiskRelationVOList)||s.forEach((l=>{1!==l.collocationType&&(i.riskId===l.riskId?(a.riskIsInsure[i.riskId]&&a.riskIsInsure[i.riskId].selected,2===l.collocationType&&a.riskIsInsure[l.collocationRiskId]&&(a.riskIsInsure[l.collocationRiskId].selected=e),3===l.collocationType&&a.riskIsInsure[l.collocationRiskId]&&"1"===e&&(a.riskIsInsure[l.collocationRiskId].selected="1"===e?"2":"1")):i.riskId===l.collocationRiskId&&(3===l.collocationType&&"1"===e&&a.riskIsInsure[l.riskId]&&(a.riskIsInsure[l.riskId].selected="1"===e?"2":"1"),2===l.collocationType&&a.riskIsInsure[l.riskId]&&(a.riskIsInsure[l.riskId].selected=e)))})),"2"===e?y({},i.riskId):(e=>{var i,l,a,s,t,n,u,o,r,d,c,p;if(1!==(null==e?void 0:e.factorDisPlayFlag)){const v=null==(i=null==e?void 0:e.productRiskInsureLimitVO)?void 0:i.amountPremiumConfigVO,k={riskCategory:e.riskCategory,riskCode:e.riskCode,riskName:e.riskName,riskId:e.riskId,riskType:e.riskType,mainRiskId:e.mainRiskId,mainRiskCode:e.mainRiskCode,liabilityList:f(e)};k.chargePeriod=(null==(a=null==(l=null==e?void 0:e.productRiskInsureLimitVO)?void 0:l.paymentPeriodValueList)?void 0:a.length)>0&&(null==(s=null==e?void 0:e.productRiskInsureLimitVO)?void 0:s.paymentPeriodValueList[0].code)||null,k.coveragePeriod=(null==(n=null==(t=null==e?void 0:e.productRiskInsureLimitVO)?void 0:t.insurancePeriodValueList)?void 0:n.length)>0&&(null==(u=null==e?void 0:e.productRiskInsureLimitVO)?void 0:u.insurancePeriodValueList[0].code)||null,k.paymentFrequency=(null==(r=null==(o=null==e?void 0:e.productRiskInsureLimitVO)?void 0:o.paymentFrequencyList)?void 0:r.length)>0&&(null==(d=null==e?void 0:e.productRiskInsureLimitVO)?void 0:d.paymentFrequencyList[0].code)||null;let m=0;1===v.displayType?m=(null==v?void 0:v.minStepValue)>0?null==v?void 0:v.minStepValue:0:3===v.displayType&&2===v.requireCopies?m=(null==(c=null==v?void 0:v.displayValues)?void 0:c.length)>0?null==v?void 0:v.displayValues[0].value:0:3===v.displayType&&1===v.requireCopies?(m=(null==(p=null==v?void 0:v.displayValues)?void 0:p.length)>0?null==v?void 0:v.displayValues[0].value:0,k.copy=v.minCopiesValue):2===v.displayType?k.copy=v.minCopiesValue:m=0,1===v.saleMethod?k.initialAmount=m:k.initialPremium=m,y(k,e.riskId)}})(i)};return t((()=>{(()=>{var e,i;a.disabledRiskInfo=[];let s=null;if(null==(e=l.dataSource.insureProductRiskVOList)||e.forEach((e=>{var i;const t=1!==e.mainRiskFlag?null==(i=l.dataSource.productRiskRelationVOList)?void 0:i.find((i=>i.collocationRiskId===e.riskId)):{};1===e.mainRiskFlag&&(s=e),a.riskIsInsure[e.riskId]?(a.riskIsInsure[e.riskId].data=null,a.riskIsInsure[e.riskId].relation=t,a.riskIsInsure[e.riskId].isMust=!1):a.riskIsInsure[e.riskId]={selected:"2",data:null,relation:t,isMust:!1}})),s){const e=null==(i=l.dataSource.productRiskRelationVOList)?void 0:i.filter((e=>e.riskId===s.riskId));if(!e)return;null==e||e.forEach((e=>{var i,s,t,n,u,o,r,d,c,p,v,k,m,I,L;if(2===e.collocationType){a.riskIsInsure[e.collocationRiskId].selected="1",a.riskIsInsure[e.collocationRiskId].isMust=!0;const h=null==(i=l.dataSource.insureProductRiskVOList)?void 0:i.find((i=>e.collocationRiskId===i.riskId));if(h&&1!==h.factorDisPlayFlag&&(null==(s=null==h?void 0:h.productRiskInsureLimitVO)?void 0:s.amountPremiumConfigVO)){const i=null==(t=h.riskLiabilityInfoVOList)?void 0:t.every((e=>1!==e.showFlag)),l=null==(n=null==h?void 0:h.productRiskInsureLimitVO)?void 0:n.amountPremiumConfigVO;if(i){a.riskIsInsure[e.collocationRiskId].isDisabled=!0;const i={riskCategory:h.riskCategory,riskCode:h.riskCode,riskName:h.riskName,riskId:h.riskId,riskType:h.riskType,mainRiskId:h.mainRiskId,mainRiskCode:h.mainRiskCode,liabilityList:f(h)};i.chargePeriod=(null==(o=null==(u=null==h?void 0:h.productRiskInsureLimitVO)?void 0:u.paymentPeriodValueList)?void 0:o.length)>0&&(null==(r=null==h?void 0:h.productRiskInsureLimitVO)?void 0:r.paymentPeriodValueList[0].code)||null,i.coveragePeriod=(null==(c=null==(d=null==h?void 0:h.productRiskInsureLimitVO)?void 0:d.insurancePeriodValueList)?void 0:c.length)>0&&(null==(p=null==h?void 0:h.productRiskInsureLimitVO)?void 0:p.insurancePeriodValueList[0].code)||null,i.paymentFrequency=(null==(k=null==(v=null==h?void 0:h.productRiskInsureLimitVO)?void 0:v.paymentFrequencyList)?void 0:k.length)>0&&(null==(m=null==h?void 0:h.productRiskInsureLimitVO)?void 0:m.paymentFrequencyList[0].code)||null;let s=0;1===l.displayType?s=(null==l?void 0:l.minStepValue)>0?null==l?void 0:l.minStepValue:0:3===l.displayType&&2===l.requireCopies?s=(null==(I=null==l?void 0:l.displayValues)?void 0:I.length)>0?null==l?void 0:l.displayValues[0].value:0:3===l.displayType&&1===l.requireCopies?(s=(null==(L=null==l?void 0:l.displayValues)?void 0:L.length)>0?null==l?void 0:l.displayValues[0].value:0,i.copy=l.minCopiesValue):2===l.displayType&&(i.copy=l.minCopiesValue),1===l.saleMethod?i.initialAmount=s:i.initialPremium=s,a.disabledRiskInfo.push(i),y(i,h.riskId)}}}3===e.collocationType&&(a.riskIsInsure[e.collocationRiskId].selected="2",a.riskIsInsure[e.collocationRiskId].isMust=!0)}))}})()})),n((()=>{a.loading=!0})),u((()=>a.riskIsInsure),(e=>{}),{deep:!0,immediate:!0}),u((()=>l.defaultValue),(e=>{(null==e?void 0:e.length)>0&&e.forEach((e=>{a.risksDefaultValue[e.riskCode]=e,a.riskIsInsure[e.riskId]?(a.riskIsInsure[e.riskId].selected="1",y(e,e.riskId)):a.riskIsInsure[e.riskId]={selected:"1",isMust:!1}}))}),{deep:!0,immediate:!0}),(i,l)=>{const s=U,t=I;return o(!0),r(c,null,d(e.dataSource.insureProductRiskVOList,(i=>{var l,n;return o(),r(c,{key:i.riskCode},[(!e.showMainRisk&&1!==i.mainRiskFlag||e.showMainRisk)&&(null==(n=null==(l=p(a).riskIsInsure)?void 0:l[i.riskId])?void 0:n.relation)?(o(),r("div",le,[v(t,{modelValue:p(a).riskIsInsure[i.riskId].selected,"onUpdate:modelValue":e=>p(a).riskIsInsure[i.riskId].selected=e,label:i.riskName,name:"selected","label-width":"50%",border:!1,class:"risk-select-field risk-name"},{input:k((()=>[v(s,{modelValue:p(a).riskIsInsure[i.riskId].selected,"onUpdate:modelValue":e=>p(a).riskIsInsure[i.riskId].selected=e,"active-value":"1","inactive-value":"2",size:"0.74rem",disabled:p(a).riskIsInsure[i.riskId].isMust,style:{"margin-right":"8px"},onChange:e=>L(e,i)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])])),_:2},1032,["modelValue","onUpdate:modelValue","label"]),"1"===p(a).riskIsInsure[i.riskId].selected?(o(),r("div",ae,[v(K,{modelValue:p(a).riskIsInsure[i.riskId].data,"onUpdate:modelValue":e=>p(a).riskIsInsure[i.riskId].data=e,"origin-data":i,"product-factor":e.dataSource.productFactor,"default-value":p(a).risksDefaultValue[i.riskCode],onTrialChange:(e,l)=>y(e,i.riskId,l)},null,8,["modelValue","onUpdate:modelValue","origin-data","product-factor","default-value","onTrialChange"])])):m("",!0)])):m("",!0)],64)})),128)}}}),[["__scopeId","data-v-d3264472"]]);const ne={class:"pro-radio-wrap"},ue=a({name:"PlanSelect"}),oe=a({...ue,props:{planList:{default:()=>[]},defaultPlan:{default:()=>{}}},emits:["planChange"],setup(e,{emit:i}){const l=e,a=y("");let s=!1;return n((()=>{l.defaultPlan&&(s=!0,a.value=l.defaultPlan.planCode)})),u((()=>a),(e=>{s||i("planChange",a.value),s&&(s=!1)}),{deep:!0,immediate:!0}),(i,s)=>{const t=g,n=V;return e.planList.length>0?(o(),L(n,{key:0,modelValue:a.value,"onUpdate:modelValue":s[1]||(s[1]=e=>a.value=e),label:"保障计划",name:"planCode",class:"risk-select-field"},{input:k((()=>[h("div",ne,[v(t,{modelValue:a.value,"onUpdate:modelValue":s[0]||(s[0]=e=>a.value=e),options:l.planList.map((e=>({label:e.planName,value:e.planCode})))},null,8,["modelValue","options"])])])),_:1},8,["modelValue"])):m("",!0)}}});const re={class:"benefit-table"},de=a({name:"benefitTable"}),ce=a({...de,props:{dataSource:null},setup(e){const i=e,l=b((()=>{const e=i.dataSource.headers.length,l=12*i.dataSource.headers.join("").length+20*i.dataSource.headers.length;return i.dataSource.headers.map(((i,a)=>{const s=l>320?12*i.length+20:Math.max(12*i.length+20,320/e);return console.log("totalWordWidth:",l,"titleWidth:",s,"word-width:",12*i.length+20),{title:i,key:`header_${a}`,fixed:a<2,minWidth:s}}))})),a=b((()=>i.dataSource.dataList.map((e=>{const i={};return e.forEach(((e,l)=>{i[`header_${l}`]=e})),i}))));return n((()=>{})),(e,i)=>(o(),r("div",re,[v(H,{"top-height":400,columns:p(l),data:p(a),"is-clone":!0},null,8,["columns","data"])]))}});const pe=e=>(_("data-v-d9a31ad8"),e=e(),E(),e),ve={key:0,class:"benefit-container"},ke={key:0,class:"benefit"},me=pe((()=>h("div",{class:"line"},null,-1))),fe={class:"box-title box-title-chart"},Ie=pe((()=>h("img",{class:"tl",src:W,alt:""},null,-1))),ye=pe((()=>h("img",{class:"transform-z180 tr",src:W,alt:""},null,-1))),Le={key:0},he={class:"box"},ge={class:"box-title"},Ve=pe((()=>h("img",{class:"tl",src:W,alt:""},null,-1))),be=pe((()=>h("img",{class:"transform-z180 tr",src:W,alt:""},null,-1))),Re={class:"box-price"},Ce={class:"text1"},Oe={class:"text2"},Pe={key:1},xe={key:2,style:{width:"100%, minWidth: 338px"}},Te={class:"slider"},De={style:{flex:"1",margin:"0px 5px"}},Se={class:"custom-button"},we=pe((()=>h("p",{class:"slider-dec"},"拖动按钮查看不同年龄保障",-1))),Fe={class:"btn-two"},_e={key:1,class:"benefit-container"},Ee={key:0},je={class:"benefit"},Ne=pe((()=>h("div",{class:"line"},null,-1))),Me=pe((()=>h("div",null,[h("div",{class:"box"},[h("p",{class:"box-title"},[h("img",{class:"tl",src:W,alt:""}),C(" 保单年度"),h("span",null,"-"),C("年度，被保人"),h("span",null,"-"),C("岁时 "),h("img",{class:"transform-z180 tr",src:W,alt:""})]),h("div",{class:"box-price"})])],-1))),qe={class:"slider"},Be={class:"opt lf"},Ae={style:{flex:"1",margin:"0px 5px"}},Ke=pe((()=>h("div",{class:"custom-button"},"0 岁",-1))),Ue={class:"opt rg"},$e=pe((()=>h("p",{class:"slider-dec"},"拖动按钮查看不同年龄保障",-1))),Qe={class:"btn-two"},We={key:1,class:"empty-box"},ze=a({name:"Benefit"});var He=f(a({...ze,props:{dataSource:{default:()=>({showTypeList:["1"]})},productInfo:{default:()=>null}},setup(e){var i;const l=e,a="1",s="2",t="3",n=y(0),f=y(0),I=y(0),g=y(),V=y(0),b=y(null==(i=l.dataSource.showTypeList)?void 0:i[0]),_=y(),E=e=>{if(!(null==e?void 0:e.benefitRiskResultVOList))return;const i=null==e?void 0:e.benefitRiskResultVOList[n.value];f.value=i.ageBegin+1,V.value=i.ageBegin+1,I.value=i.ageEnd},j=()=>{var e,i,a,s,t,u;const o=null==(i=null==(e=l.dataSource)?void 0:e.benefitRiskResultVOList)?void 0:i[n.value];_.value=null==(t=null==(s=null==(a=l.dataSource)?void 0:a.benefitRiskResultVOList)?void 0:s[n.value].benefitRiskTableResultVOList)?void 0:t[0];const{a:r,year:d}=((e,i)=>{const l=[],a=[];for(let s=e,t=0;s<=i;s++,t++)l.push(s.toString()),a.push(t+1);return{a:l,year:a}})(f.value,I.value),c={index:r.indexOf(V.value.toString()),age:r,year:d,result:null==(u=null==o?void 0:o.benefitRiskItemResultVOList)?void 0:u[0]};g.value=c},N=()=>{V.value>I.value-1||(V.value+=1,j())},M=()=>{V.value>f.value&&(V.value-=1,j())},q=e=>{n.value=e.name,E(l.dataSource),j()};return u((()=>l.dataSource),(e=>{var i;e&&(E(e),j(),b.value=null==(i=e.showTypeList)?void 0:i[0])}),{deep:!0,immediate:!0}),u(V,(()=>{j()})),(i,u)=>{var y;const E=D,j=Q,B=S,A=w,K=F,U=$;return(null==(y=e.dataSource)?void 0:y.benefitRiskResultVOList)?(o(),r("div",ve,[v(K,{active:p(n),onClickTab:q},{default:k((()=>{var e;return[(o(!0),r(c,null,d(null==(e=l.dataSource)?void 0:e.benefitRiskResultVOList,((e,i)=>(o(),L(A,{key:i,name:i,title:e.riskName},{default:k((()=>{var e,y,D,S,w,F,q,A,K,U,$,Q,W,H,G,Z;return[i==p(n)?(o(),r("div",ke,[me,R(h("p",fe,[Ie,C(" 保单年度"),h("span",null,O(null==(D=null==(e=p(g))?void 0:e.year)?void 0:D[null==(y=p(g))?void 0:y.index]),1),C("年度，被保人"),h("span",null,O(null==(F=null==(S=p(g))?void 0:S.age)?void 0:F[null==(w=p(g))?void 0:w.index]),1),C("岁时 "),ye],512),[[P,p(b)===s]]),p(b)===a?(o(),r("div",Le,[h("div",he,[h("p",ge,[Ve,C(" 保单年度"),h("span",null,O(null==(K=null==(q=p(g))?void 0:q.year)?void 0:K[null==(A=p(g))?void 0:A.index]),1),C("年度，被保人"),h("span",null,O(null==(Q=null==(U=p(g))?void 0:U.age)?void 0:Q[null==($=p(g))?void 0:$.index]),1),C("岁时 "),be]),h("div",Re,[(o(!0),r(c,null,d(null==(H=null==(W=p(g))?void 0:W.result)?void 0:H.headers,((e,i)=>{var l,a,s,t,n,u,d,c,v,k;return o(),r("div",{key:i,style:{width:"33%"}},[h("p",Ce,O(("0"==(null==(n=null==(t=null==(a=null==(l=p(g))?void 0:l.result)?void 0:a.dataList)?void 0:t[null==(s=p(g))?void 0:s.index])?void 0:n[i])?"0":p(x)(Number(null==(k=null==(v=null==(d=null==(u=p(g))?void 0:u.result)?void 0:d.dataList)?void 0:v[null==(c=p(g))?void 0:c.index])?void 0:k[i])))||"0"),1),h("p",Oe,O(e)+"(元）",1)])})),128))])])])):m("",!0),p(b)===t?(o(),r("div",Pe,[v(ce,{"data-source":p(_)},null,8,["data-source"])])):m("",!0),p(b)==s?(o(),r("div",xe,[v(z,{min:p(f),max:p(I),current:p(V),data:null==(Z=null==(G=p(g))?void 0:G.result)?void 0:Z.benefitRiskItemList},null,8,["min","max","current","data"])])):m("",!0),p(b)!=t?(o(),r(c,{key:3},[h("div",Te,[h("div",{class:"opt lf",onClick:M},[v(E,{name:"minus"})]),h("div",De,[p(f)?(o(),L(j,{key:0,modelValue:p(V),"onUpdate:modelValue":u[0]||(u[0]=e=>T(V)?V.value=e:null),min:p(f),max:p(I),"bar-height":"8px"},{button:k((()=>[h("div",Se,O(p(V))+" 岁",1)])),_:1},8,["modelValue","min","max"])):m("",!0)]),h("div",{class:"opt rg",onClick:N},[v(E,{name:"plus"})])]),we],64)):m("",!0),h("div",Fe,[l.dataSource.showTypeList.includes(a)?(o(),L(B,{key:0,round:"",plain:p(b)!==a,type:"primary",class:"btn",onClick:u[1]||(u[1]=e=>b.value=a)},{default:k((()=>[C("图表展示")])),_:1},8,["plain"])):m("",!0),l.dataSource.showTypeList.includes(s)?(o(),L(B,{key:1,round:"",plain:p(b)!==s,type:"primary",class:"btn",onClick:u[2]||(u[2]=e=>b.value=s)},{default:k((()=>[C("趋势展示")])),_:1},8,["plain"])):m("",!0),l.dataSource.showTypeList.includes(t)?(o(),L(B,{key:2,round:"",plain:p(b)!==t,type:"primary",class:"btn",onClick:u[3]||(u[3]=e=>b.value=t)},{default:k((()=>[C("表格展示")])),_:1},8,["plain"])):m("",!0)])])):m("",!0)]})),_:2},1032,["name","title"])))),128))]})),_:1},8,["active"])])):(o(),r("div",_e,[l.productInfo?(o(),r("div",Ee,[v(K,{active:p(n),onClickTab:q},{default:k((()=>[(o(),L(A,{key:1,name:1,title:e.productInfo.insureProductRiskVOList[0].riskName},{default:k((()=>[h("div",je,[Ne,Me,h("div",qe,[h("div",Be,[v(E,{name:"minus"})]),h("div",Ae,[v(j,{modelValue:p(V),"onUpdate:modelValue":u[4]||(u[4]=e=>T(V)?V.value=e:null),min:0,max:80,"bar-height":"8px",disabled:""},{button:k((()=>[Ke])),_:1},8,["modelValue"])]),h("div",Ue,[v(E,{name:"plus"})])]),$e,h("div",Qe,[v(B,{round:"",plain:!0,type:"primary",class:"btn",disabled:""},{default:k((()=>[C("图表展示")])),_:1}),v(B,{round:"",plain:!1,type:"primary",class:"btn",disabled:""},{default:k((()=>[C("趋势展示")])),_:1}),v(B,{round:"",plain:!1,type:"primary",class:"btn",disabled:""},{default:k((()=>[C("表格展示")])),_:1})])])])),_:1},8,["title"]))])),_:1},8,["active"])])):(o(),r("div",We,[v(U,{title:"试算结果正在计算中...","empty-class":"empty-select"})]))]))}}}),[["__scopeId","data-v-d9a31ad8"]]);const Ge={key:0,class:"head-warning-wrap"},Ze=h("div",{class:"warning-icon"},[h("span",null,"!")],-1),Je={class:"warning-text"},Xe=a({name:"HeadWaring"}),Ye=a({...Xe,props:{labels:{default:()=>[]}},setup:e=>(i,l)=>e.labels.length>0?(o(),r("div",Ge,[Ze,h("div",Je,[(o(!0),r(c,null,d(e.labels,(e=>(o(),r("span",{key:e},O(e),1)))),128))])])):m("",!0)}),ei=(i,l,a)=>{const s=i,{holder:t}=a,n=a.insuredList[0],u=(l||"").split("_");if(u.length<2)return l;if(e.exports.isNaN(Number(u[1])))return l;if(u[1]-=1,1===s.exemptFlag){if("to"===u[0]){let e=0;1===s.exemptType?(null==t?void 0:t.birthday)&&(e=parseInt(""+((new Date).getTime()-new Date(t.birthday).getTime())/31536e6,10)):2===s.exemptType&&(null==n?void 0:n.birthday)&&(e=parseInt(""+(+(new Date).getTime()-new Date(n.birthday).getTime())/31536e6,10)),u[1]=+u[1]-e}u[0]="year"}return u.join("_")},ii=(e,i)=>{const l=[],a={};return null==e||e.forEach((e=>{a[e.riskId]=e})),null==i||i.forEach((e=>{var i,s,t,n;const{collocationType:u,collocationRiskId:o,riskId:r}=e;switch(u){case 2:{const e=null==(i=a[r])?void 0:i.riskName,t=null==(s=a[o])?void 0:s.riskName;l.push(`${e} 和 ${t} 必须同时投保`);break}case 3:{const e=null==(t=a[r])?void 0:t.riskName,i=null==(n=a[o])?void 0:n.riskName;l.push(`${e} 和 ${i} 不能同时投保`);break}}})),l};const li={class:"com-body"},ai={class:"trial-body"},si={class:"container"},ti=(e=>(_("data-v-e2290618"),e=e(),E(),e))((()=>h("div",{class:"empty"},null,-1))),ni=a({name:"TrialBody"});var ui=f(a({...ni,props:{dataSource:{default:()=>[]},productInfo:{default:()=>({productCode:"",productName:"",insurerCode:"",tenantId:"",planList:[]})},tenantProductDetail:{default:()=>({})},hideBenefit:{type:Boolean,default:!1},hidePopupButton:{type:Boolean,default:!1},title:{default:"算一算保费"},defaultData:{default:null},isTrial:{type:Boolean,default:!1}},emits:["trialStart","trialEnd"],setup(a,{expose:d,emit:c}){const k=a,f=y(null),I=j();N(),I.query;const g=y(),V=s({loading:!1,show:!1,select:{},list:[],userData:{},riskIsInsure:{},submitData:{},riskList:[{}],mainRiskVO:{},ifPersonalInfoSuccess:!1,trialMsg:"",trialResultPremium:0,trialResult:{initialPremium:0,initialAmount:0},isAniShow:!1,defaultValue:null,isAutoChange:!1,planIndex:0,isSkipFirstTrial:!1,hadSkipFirstTrial:!1,isQuerying:!1,currentPlanCode:""});ie(),y(),y();const b=y(k.dataSource),R=y([]),C=e=>{const{holder:i,insuredList:l}=e||{};i&&(V.submitData.holder=i),l&&l.length>0&&l.forEach(((e,i)=>{var l;V.submitData.insuredList&&V.submitData.insuredList.length>i?V.submitData.insuredList[i]=e:((null==(l=V.submitData)?void 0:l.insuredList)||(V.submitData.insuredList=[]),V.submitData.insuredList.push(e))}))},O=y(),P=y({}),x=["annuityDrawDate","coveragePeriod","chargePeriod","paymentFrequency"],T=e=>{var i,a,s,t,n,u;if(null==(a=null==(i=null==e?void 0:e.data)?void 0:i[0])?void 0:a.productRiskDyInsureFactorVOList){const i=[];if(null==(s=b.value)||s.insureProductRiskVOList.forEach((a=>{var s,t;const n=null==(t=null==(s=null==e?void 0:e.data)?void 0:s[0])?void 0:t.productRiskDyInsureFactorVOList.find((e=>e.riskCode===a.riskCode));if(n){a.productRiskInsureLimitVO={...a.productRiskInsureLimitVO,...n};const e=V.riskList.find((e=>e.riskCode===a.riskCode));let s=!1;l.forEach((i=>{if(x.indexOf(i.valueKey)>=0){const l=a.productRiskInsureLimitVO[i.configKey];if(l&&e){const a=l.find((l=>l.code===e[i.valueKey]));if(a&&2===a.useFlag){const a=l.find((e=>1===e.defaultFlag));e[i.valueKey]=a.code,s=!0}}}})),s&&i.push({...e,...n,riskCode:a.riskCode})}})),i.length>0&&(null==(u=null==(n=null==(t=V.defaultValue)?void 0:t.insuredList)?void 0:n[0])?void 0:u.productList))return i.forEach((e=>{var i,l,a;V.defaultValue.insuredList[0].productList=null==(a=null==(l=null==(i=V.defaultValue)?void 0:i.insuredList)?void 0:l[0])?void 0:a.productList.map((i=>(i.riskList=null==i?void 0:i.riskList.map((i=>(i.riskCode===e.riskCode&&(i=e),i))),i)))})),!1}return!0},D=async(e,i=!0)=>{V.trialMsg="试算中...",V.trialResultPremium=0,V.loading=!0,c("trialStart");let l=!1;if(i){const{code:i}=await Z(e);l="10000"===i}!l&&i||(V.isQuerying=!0,k.hideBenefit||J(e).then((e=>{e.data&&e.code===B&&(P.value=e.data)})).finally((()=>{V.loading=!1})),X(e).then((e=>{var i,l;if(e.data&&e.code===B){(null==(i=null==e?void 0:e.data)?void 0:i.errorInfo)&&A(`${null==(l=null==e?void 0:e.data)?void 0:l.errorInfo}`),V.trialMsg="",V.trialResultPremium=e.data.initialPremium,V.trialResult=e.data;const a={};e.data.riskPremiumDetailVOList&&e.data.riskPremiumDetailVOList.length&&e.data.riskPremiumDetailVOList.forEach((e=>{a[e.riskCode]={initialAmount:e.initialAmount,initialPremium:e.initialPremium}})),O.value=a,c("trialEnd",e.data,V.submitData)}})).finally((()=>{V.loading=!1,V.isQuerying=!1})))},S=e.exports.debounce((async()=>{console.log(">>>>>调用试算<<<<<",V.ifPersonalInfoSuccess);const{productCode:i,productName:a}=k.productInfo||{};if(V.ifPersonalInfoSuccess||g.value.canTrail()){V.submitData.productCode=i,V.submitData.productName=a,V.submitData.tenantId=k.productInfo.tenantId,V.riskList=V.riskList.map((e=>(e=>{var i,a,s,t;const n=null==(i=b.value.insureProductRiskVOList)?void 0:i.find((i=>e.riskId===i.riskId));if(n&&1!==n.mainRiskFlag){const i=null==(s=null==(a=b.value)?void 0:a.productRiskRelationVOList)?void 0:s.filter((e=>{var i;if(e.collocationRiskId===n.riskId&&3!==e.collocationType){const l=null==(i=b.value.insureProductRiskVOList)?void 0:i.find((i=>e.riskId===i.riskId));if(l&&l.riskType===G.MAIN_RISK)return!0}return!1})),u=i.length>0?i[0]:null;if(u){const i=null==(t=V.riskList)?void 0:t.find((e=>e.riskId===u.riskId));l.forEach((l=>{l.ruleKey&&n.productRiskInsureLimitVO&&i&&(1===n.productRiskInsureLimitVO[l.ruleKey]&&(e[l.valueKey]=i[l.valueKey]),3===n.productRiskInsureLimitVO[l.ruleKey]&&(1!==n.exemptFlag?e[l.valueKey]=ei(n,i[l.valueKey],V.submitData):e[l.valueKey]=ei(n,i[l.ruleValueKey],V.submitData)))}))}}return e})(e))),V.submitData.insuredList&&V.submitData.insuredList.forEach((e=>{e.productList=[{productCode:i,productName:a,riskList:V.riskList}]}));const s=(()=>{console.log("--current plan = ",b.value),console.log("---current submit = ",V.submitData);const i=e.exports.cloneDeep(V.submitData);if(i.holder){const e=b.value.productFactor[1]||[];Object.keys(i.holder).forEach((l=>{i.holder[l]&&(e.find((e=>e.code===l))||(i.holder[l]=null))}))}if(i.insuredList){const e=b.value.productFactor[2]||[],l=["productList","beneficiaryList"];i.insuredList.forEach(((i,a)=>{const s=a>=1?2:1;Object.keys(i).forEach((a=>{l.indexOf(a)>=0||!i[a]||e.find((e=>e.code===a&&e.subModuleType===s))||(i[a]=null)})),i.planCode=b.value.planCode}))}return i})();console.log(">>>数据构建<<<",s),await D(s)}}),300),w=async e=>{var i;const{insuredList:l,isFirstInsuredChange:a}=e;if(console.log("----------person info change"),C(e),V.ifPersonalInfoSuccess=!0,a){console.log("处理第一被保人修改的dy变化"),V.isQuerying=!0;const e=await Y({calcProductFactorList:[{planCode:b.value.planCode,productCode:k.productInfo.productCode,riskEditVOList:[{insureProductRiskVO:null==(i=b.value.insureProductRiskVOList)?void 0:i[0]}]}],...l[0]});if(V.isQuerying=!1,!T(e))return}console.log("投被保人的信息回传 ",e),S()},F=async(i,l)=>{var a,s,t,n;if(l){const u=e.exports.cloneDeep(i);delete u.insurancePeriodValueList,delete u.paymentFrequencyList,delete u.paymentPeriodValueList;if(x.indexOf(l.key)>=0&&`${l.oldValue}`!=`${l.newValue}`){const e={};switch(l.key){case"annuityDrawDate":e.changeType=3;break;case"coveragePeriod":e.changeType=2;break;case"chargePeriod":e.changeType=1}const o=null==(s=null==(a=V.submitData)?void 0:a.insuredList)?void 0:s[0],r=null==(n=null==(t=b.value)?void 0:t.insureProductRiskVOList)?void 0:n.find((e=>e.riskCode===i.riskCode));if(!V.isAutoChange){V.isQuerying=!0;const l=await Y({calcProductFactorList:[{planCode:b.value.planCode,productCode:k.productInfo.productCode,riskEditVOList:[{insureProductRiskVO:r,insureRiskEditReqVO:{riskId:i.riskId,riskCode:i.riskCode,...u,...e}}]}],...o});V.isQuerying=!1;const a=T(l);return a||(V.isAutoChange=!0),a}V.isAutoChange=!1}}return!0},_=async(e,i)=>{V.mainRiskVO=e;await F(e,i)&&(V.riskList.length>0&&(V.riskList[0]=e),console.log("标准险种的信息回传",e),S())},E=async(e,i)=>{if(V.riskList=[V.mainRiskVO,...e],console.log("附加险列表数据回传",e),i){const l=e.find((e=>e.riskCode===i.riskCode));if(!(await F(l,i)))return}S()},U=e=>{var i,l,a,s;V.userData=e,V.defaultValue=e;const t=(null==(i=e.insuredList)?void 0:i[0].productList.findIndex((e=>e.planCode===b.value.planCode)))||0;V.planIndex=-1===t?0:t,V.riskList=(null==(s=null==(a=null==(l=null==e?void 0:e.insuredList)?void 0:l[0].productList)?void 0:a[V.planIndex])?void 0:s.riskList)||[],D(e,!0)},$=async e=>{var i;if(k.defaultData){const e=k.defaultData.find((e=>e.productCode===k.productInfo.productCode))||k.defaultData[0];U(e),C(null==(i=k.defaultData)?void 0:i[0])}else R.value.push(b.value.planCode),await(async()=>{var e;const i=await ee({calcProductFactorList:[{planCode:b.value.planCode,productCode:k.productInfo.productCode}]});if(i.data){const l=i.data.find((e=>e.productCode===k.productInfo.productCode))||i.data[0];U(l),C(null==(e=i.data)?void 0:e[0])}})()},Q=async e=>{var i;const l=k.productInfo.planList.findIndex((i=>i.planCode===e)),a=(null==(i=V.defaultValue.insuredList)?void 0:i[0].productList.findIndex((i=>i.planCode===e)))||0,s=l>=0?k.productInfo.planList[l]:null;s&&(V.currentPlanCode=e,b.value=s,V.planIndex=l,V.defaultValue.insuredList[0].productList[a].riskList[0]=V.mainRiskVO,R.value.findIndex((i=>i===e))<0&&R.value.push(e))};t((()=>{var e,i;V.select={},V.list=[],V.userData={},V.riskIsInsure={},V.submitData={},V.riskList=[{}],V.mainRiskVO={},V.ifPersonalInfoSuccess=!1,V.trialMsg="",V.trialResultPremium=0,V.riskIsInsure={},null==(i=null==(e=b.value)?void 0:e.insureProductRiskVOList)||i.forEach((e=>{var i;const l=null==(i=b.value.productRiskRelationVOList)?void 0:i.find((i=>i.collocationRiskId===e.riskId));l&&(V.riskIsInsure[e.riskCode]={selected:"2",data:null,relation:l})}))})),n((()=>{b.value=k.dataSource,V.loading=!0,V.show=!0,V.isAniShow=!0,V.isSkipFirstTrial=!0,V.hadSkipFirstTrial=!1,M((()=>{$()}))}));return d({getTrialSuccessFlag:()=>V.trialResultPremium>0,validate:()=>g.value.validate(!1),validateTrialFields:()=>g.value.validateTrialFields(),validateHolder:e=>{var i;return null==(i=g.value)?void 0:i.validateHolder(e)},getUserData:()=>({...V.userData})}),u((()=>V.riskIsInsure),(e=>{}),{deep:!0,immediate:!0}),u((()=>V.userData),(e=>{if(e){const{holder:i,insuredList:l}=e||{};Object.assign(V.submitData,{holder:i,insuredList:l})}}),{deep:!0}),(e,l)=>{var s,t,n,u,d,c,k,I;return o(),r("div",li,[q(e.$slots,"trialHead",{},void 0,!0),h("div",ai,[v(Ye,{labels:p(ii)((null==(s=b.value)?void 0:s.insureProductRiskVOList)||[],b.value.productRiskRelationVOList)},null,8,["labels"]),h("div",si,[!a.hideBenefit&&(null==(t=P.value)?void 0:t.benefitRiskResultVOList)?(o(),L(He,{key:0,class:"benefit-wrap","data-source":P.value,"product-info":b.value,"show-type-list":P.value.showTypList},null,8,["data-source","product-info","show-type-list"])):m("",!0),v(oe,{"plan-list":a.productInfo.planList,"default-plan":b.value,onPlanChange:Q},null,8,["plan-list","default-plan"]),b.value.productFactor?(o(),L(p(i),{ref_key:"personalInfoRef",ref:g,key:b.value.planCode,modelValue:p(V).userData,"onUpdate:modelValue":l[0]||(l[0]=e=>p(V).userData=e),"is-trial":a.isTrial,"product-factor":b.value.productFactor,"multi-insured-config":null==(n=b.value)?void 0:n.multiInsuredConfigVO,onTrailChange:w},null,8,["modelValue","is-trial","product-factor","multi-insured-config"])):m("",!0),(o(),L(K,{ref_key:"insureInfosRef",ref:f,key:b.value.planCode,"origin-data":null==(u=b.value.insureProductRiskVOList)?void 0:u[0],"product-factor":b.value.productFactor,"default-value":p(V).defaultValue?null==(c=null==(d=p(V).defaultValue)?void 0:d.insuredList[0].productList[p(V).planIndex])?void 0:c.riskList[0]:null,"trial-result":p(V).trialResult,onTrialChange:_},null,8,["origin-data","product-factor","default-value","trial-result"])),b.value.insureProductRiskVOList?(o(),L(te,{key:b.value.planCode,"data-source":b.value,"show-main-risk":!1,"default-value":p(V).defaultValue?null==(I=null==(k=p(V).defaultValue)?void 0:k.insuredList[0].productList[p(V).planIndex])?void 0:I.riskList:[],onTrialChange:E},null,8,["data-source","default-value"])):m("",!0),ti])]),q(e.$slots,"trialBtn",{trialData:p(V).submitData,riskPremium:p(V).trialResult,loading:p(V).isQuerying},void 0,!0)])}}}),[["__scopeId","data-v-e2290618"]]);export{ui as T};
