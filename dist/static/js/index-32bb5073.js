var Ye=Object.defineProperty,Ke=Object.defineProperties;var Ge=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var We=Object.prototype.hasOwnProperty,qe=Object.prototype.propertyIsEnumerable;var re=(w,m,y)=>m in w?Ye(w,m,{enumerable:!0,configurable:!0,writable:!0,value:y}):w[m]=y,v=(w,m)=>{for(var y in m||(m={}))We.call(m,y)&&re(w,y,m[y]);if(oe)for(var y of oe(m))qe.call(m,y)&&re(w,y,m[y]);return w},D=(w,m)=>Ke(w,Ge(m));import{g as je,a9 as ze,O as Je,E as I,M as ne,y as se,_ as Qe,l as Xe,h as Ze,r as ue,j as le,n as ea,p as _,m as q,z as k,A as E,J as ie,C as Ee,k as aa,t as ta,F as oa,T as ce}from"./vendor-17026bfd.js";import{_ as ra,C as de,$ as na,G as me,a1 as pe}from"./index-49e16b47.js";import{a as T}from"./order-c0ced472.js";import{S as O,R as fe}from"./infoCollection-8fbe54c6.js";import{p as he,i as sa,s as ua,g as la,a as ia,u as ca,b as da}from"./trial-db27232b.js";import{p as ma}from"./product-4ddd7d1f.js";import{d as ve,B as pa,D as fa,G as ha,S as va,H as Da,P as ya,U as ga,_ as Fa,W as Ca,v as Ia,a as De,c as V,f as ye,o as ge,b as R,n as Fe,h as Ce}from"./auth-78a75d68.js";import{_ as Ea,g as Ie,t as _a,a as wa}from"./index-514da13f.js";import{t as Na}from"./theme-ea709837.js";import"./utils-b6782348.js";import"./index-2acc2d64.js";import"./bankCard-b9d5732e.js";import"./trial-7c453374.js";const ba={class:"page-internet-product-detail"},Ta={class:"info"},Aa={class:"footer-button"},Oa={class:"price"},Pa=Ee(" \u603B\u4FDD\u8D39"),Sa=je({setup(w){const m=ze(),y=Je(),{productCode:x="BWYL2021",tenantId:F,orderNo:P,phoneNo:H,agentCode:M="",saleChannelId:_e,paymentMethod:g,certNo:j,name:z,pageCode:S,from:J}=y.query,$=I(),i=I(),B=I(),A=I(),U=S==="payBack",Q=I(!1),L=I(!1),Y=I(!1),X=I(0),K=I(!1),G=I(!1);let W="";const l=ne({holder:{certNo:j,certType:de.CERT,mobile:H,name:z,socialFlag:O.HAS},insured:{certNo:j,certType:de.CERT,name:z,socialFlag:O.HAS,relationToHolder:fe.SELF},paymentMethod:g,renewalDK:"Y"}),N=I(ve),C=I(ve),n=ne({showInsure:!U,canInsure:!1,canUpgrade:!1}),we=se(()=>{var a,t;return((t=(a=i.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(e=>e.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),Ne=se(()=>{var a,t;return((t=(a=i.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(e=>e.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),be=()=>{const{holder:{certNo:a,mobile:t,name:e,socialFlag:r},insured:{certNo:o,name:p,socialFlag:f,relationToHolder:u},paymentMethod:c}=l,d=me(a)&&Ia(t)&&De(e)&&!!r,s=me(o)&&De(p)&&!!f&&!!u;return!!(d&&s&&!!c)},Z=()=>{m.push({path:"/internet/guaranteeUpgrade",query:D(v({},y.query),{tenantId:F,productCode:"BWYL2022",orderNo:P,agentCode:M})})},Te=()=>{G.value=!1},Ae=()=>{C.value=N.value},Oe=()=>{C.value=D(v({},C.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},Pe=async a=>{ce.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const t=await ca(a),{code:e}=t;if(e==="10000"){ce.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const r=await da({orderNo:a.orderNo,tenantId:F}),{data:o}=r;e==="10000"&&(window.location.href=o)}n.canInsure=!0}catch{n.canInsure=!0}},Se=a=>`${pe}/internet/productDetail?tenantId=${F}&productCode=${x}&orderNo=${a}&agentCode=${M}&pageCode=payBack&from=${J||"normal"}`,Be=a=>`${pe}/internet/payFail?tenantId=${F}&orderNo=${a}&agentCode=${M}&pageCode=payBack&from=${J||"normal"}`,Ue=async a=>{const t=wa({tenantId:F,saleUserId:M,saleChannelId:_e,detail:i.value,insureDetail:B.value,paymentMethod:l.paymentMethod,renewalDK:l.renewalDK,iseeBizNo:W,successJumpUrl:"",premium:A.value,holder:l.holder,insured:l.insured,tenantOrderRiskList:a,orderStatus:"",orderTopStatus:""});try{const e=await ua(t),{code:r,data:o}=e;r==="10000"&&Pe(D(v({},t),{orderNo:o.data,extInfo:{extraInfo:{renewalDK:l.renewalDK,paymentMethod:l.paymentMethod,successJumpUrl:Se(o.data),failUrl:Be(o.data)},iseeBizNo:W}}))}catch{n.canInsure=!0}},ke=async()=>{const{calcData:a,riskVOList:t}=Ie({holder:l.holder,insured:l.insured,tenantId:F,productDetail:i.value,insureDetail:B.value}),e=await he(a),{code:r,data:o}=e;return r==="10000"?(A.value=o.premium,{condition:t,data:o}):{}},xe=a=>{X.value=a,Y.value=!0},He=()=>new Promise((a,t)=>{var e,r;(r=(e=$.value)==null?void 0:e.validateForm)==null||r.call(e).then(async()=>{var s;if(!(((s=$.value)==null?void 0:s.isAgreeFile)||Q.value)){L.value=!0;return}const{calcData:p,riskVOList:f}=Ie({holder:l.holder,insured:l.insured,tenantId:F,productDetail:i.value,insureDetail:B.value}),u=await he(p),{code:c,data:d}=u;c==="10000"?(A.value=d.premium,a({condition:f,data:d})):t(new Error)}).catch(()=>{n.canInsure=!0})}),ee=async()=>{var a;if(U){Z();return}n.canInsure=!1;try{const{condition:t,data:e}=await He(),r={},o=(f=[])=>{(f||[]).forEach(u=>{var c;r[u.riskCode]=u,((c=u.riskPremiumDetailVOList)==null?void 0:c.length)&&o(u.riskPremiumDetailVOList)})};o(e.riskPremiumDetailVOList);const p=_a({tenantId:F,riskList:t,riskPremium:r,productId:(a=i.value)==null?void 0:a.id});Ue(p)}catch{n.canInsure=!0}},Me=a=>{a==="allFalse"&&(L.value=!1,xe(0)),n.canInsure=!0},Le=()=>{Q.value=!0,ee()};Qe(()=>l,Xe.exports.debounce(()=>{i.value&&B.value&&S!=="payBack"&&be()&&ke()},500),{deep:!0,immediate:!0});const ae=async()=>{var r,o,p,f,u,c,d,s;const a=await la({orderNo:P,tenantId:F}),{code:t,data:e}=a;if(t==="10000"){const{tenantOrderHolder:h,tenantOrderInsuredList:b,extInfo:te}=e;if(!U){Object.assign(l,{holder:{certNo:h.certNo,certType:h.certType,mobile:h.mobile,name:h.name,socialFlag:O.HAS},insured:{certNo:h.certNo,certType:h.certType,name:h.name,socialFlag:O.HAS,relationToHolder:fe.SELF},paymentMethod:g,renewalDK:"Y"}),n.canInsure=!0,C.value=Fe,N.value=Fe;return}Object.assign(l,{holder:{certNo:h.certNo,certType:h.certType,mobile:h.mobile,name:h.name,socialFlag:O.HAS},insured:{certNo:b==null?void 0:b[0].certNo,certType:(r=b[0])==null?void 0:r.certType,name:(o=b[0])==null?void 0:o.name,socialFlag:(f=(p=b[0])==null?void 0:p.extInfo)==null?void 0:f.hasSocialInsurance,relationToHolder:(u=b[0])==null?void 0:u.relationToHolder},paymentMethod:te.extraInfo.paymentMethod,renewalDK:te.extraInfo.renewalDK||"N"}),A.value=(s=(d=(c=b[0])==null?void 0:c.tenantOrderProductList)==null?void 0:d[0])==null?void 0:s.premium,(e.orderStatus===T.ACCEPT_POLICY||e.orderStatus===T.PAYMENT_SUCCESS)&&(n.canUpgrade=!0,K.value=!1,G.value=!0),e.orderStatus===T.PAYING&&(K.value=!0,setTimeout(()=>{ae()},3*1e3))}},Ve=async()=>{var r,o,p,f,u,c;console.log("\u77ED\u4FE1\u8FDB\u5165\uFF0C\u5E26\u4E86orderNo, mobile");const a=await ia({holderPhone:H,orderStatus:[T.PAYING.toUpperCase(),T.TIMEOUT.toUpperCase(),"ACCEPT_POLICY"],productCode:x,tenantId:F}),{code:t,data:e}=a;if(e.orderStatus===T.ACCEPT_POLICY&&(console.log("\u5DF2\u627F\u4FDD\uFF0C\u88AB\u4FDD\u4EBA\u4FE1\u606F\u4E0D\u80FD\u4FEE\u6539"),C.value=D(v({},Ce),{paymentDisable:!!g}),N.value=D(v({},Ce),{paymentDisable:!!g})),(e.orderStatus===T.PAYING||e.orderStatus===T.TIMEOUT)&&(console.log("\u652F\u4ED8\u4E2D\uFF0C\u8D85\u65F6\u53EF\u4EE5\u4FEE\u6539\u6295\u4FDD\u4EBA\u4FE1\u606F"),C.value=D(v({},R),{paymentDisable:!!g}),N.value=D(v({},R),{paymentDisable:!!g})),t==="10000"&&((r=e==null?void 0:e.tenantOrderHolder)==null?void 0:r.certNo)){n.canInsure=!0;const{tenantOrderHolder:d,tenantOrderInsuredList:s,extInfo:h}=e;Object.assign(l,{holder:{certNo:d.certNo,certType:d.certType,mobile:d.mobile,name:d.name,socialFlag:O.HAS},insured:{certNo:s==null?void 0:s[0].certNo,certType:(o=s[0])==null?void 0:o.certType,name:(p=s[0])==null?void 0:p.name,socialFlag:(u=(f=s[0])==null?void 0:f.extInfo)==null?void 0:u.hasSocialInsurance,relationToHolder:(c=s[0])==null?void 0:c.relationToHolder},paymentMethod:g||h.extraInfo.paymentMethod,renewalDK:h.extraInfo.renewalDK})}else C.value=D(v({},V),{paymentDisable:!!g}),N.value=D(v({},V),{paymentDisable:!!g}),n.canInsure=!0},Re=async()=>{const a=ma({productCode:x,withInsureInfo:!0,tenantId:F}),t=sa({productCode:x});await Promise.all([a,t]).then(([e,r])=>{var o;e.code==="10000"&&(i.value=e.data,document.title=((o=e.data)==null?void 0:o.productFullName)||""),r.code==="10000"&&(B.value=r.data)}),P?ae():H&&S==="productDetail"&&Ve()},$e=()=>{S==="free"?U?(C.value=D(v({},ye),{paymentDisable:!!g}),N.value=D(v({},ye),{paymentDisable:!!g}),n.canInsure=!0):(C.value=D(v({},V),{paymentDisable:!!g}),N.value=D(v({},V),{paymentDisable:!!g}),n.canInsure=!0):U?(C.value=ge,N.value=ge,console.log("\u652F\u4ED8\u5B8C\u6210\u8FDB\u5165")):H||P||(console.log("\u6295\u4FDD\u94FE\u63A5"),C.value=R,N.value=R,n.canInsure=!0)};return Ze(()=>{$e(),Re(),setTimeout(async()=>{W=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(a,t)=>{const e=ue("van-button"),r=ue("van-config-provider");return le(),ea(oa,null,[_(r,{"theme-vars":E(Na)},{default:q(()=>{var o,p,f,u,c,d,s;return[k("div",ba,[k("div",Ta,[_(pa,{url:(p=(o=i.value)==null?void 0:o.tenantProductInsureVO)==null?void 0:p.banner[0]},null,8,["url"]),_(fa,{"product-name":(f=i.value)==null?void 0:f.productFullName,"product-desc":(c=(u=i.value)==null?void 0:u.showConfigVO)==null?void 0:c.desc},null,8,["product-name","product-desc"])]),_(ha,{"guarantee-list":(s=(d=i.value)==null?void 0:d.tenantProductInsureVO)==null?void 0:s.titleAndDescVOS},null,8,["guarantee-list"]),_(va,{detail:i.value},{form:q(()=>[_(Da,{ref_key:"formRef",ref:$,disable:!E(n).showInsure,"form-auth":C.value,"form-info":E(l),premium:A.value,"product-detail":i.value,onOnReset:Ae,onOnUpdate:Oe},null,8,["disable","form-auth","form-info","premium","product-detail"])]),_:1},8,["detail"]),k("div",Aa,[k("div",Oa,[Pa,k("span",null,"\uFFE5"+ie(E(na)(A.value))+"/\u6708",1)]),_(e,{type:"primary",class:"right",disabled:!(E(n).canInsure||E(n).canUpgrade),onClick:ee},{default:q(()=>[Ee(ie(E(n).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),E(S)!=="payBack"?(le(),aa(ya,{key:0,"product-detail":i.value},null,8,["product-detail"])):ta("",!0),_(ga,{"order-no":E(P),"tenant-id":E(F),"is-show":G.value,onOnConfirm:Z,onOnClose:Te},null,8,["order-no","tenant-id","is-show"])]}),_:1},8,["theme-vars"]),_(Fa,{show:L.value,"onUpdate:show":t[0]||(t[0]=o=>L.value=o),"content-list":E(we),"active-index":0,onOnConfirmHealth:Me},null,8,["show","content-list"]),_(Ea,{show:Y.value,"onUpdate:show":t[1]||(t[1]=o=>Y.value=o),"content-list":E(Ne),"active-index":X.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9",onSubmit:Le},null,8,["show","content-list","active-index"]),_(Ca,{"is-show":K.value},null,8,["is-show"])],64)}}});var qa=ra(Sa,[["__scopeId","data-v-3ffdb7d5"]]);export{qa as default};
