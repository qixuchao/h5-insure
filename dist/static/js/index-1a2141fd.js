import{_ as e,d as t,a,r as n,x as o,a8 as l,y as r,b as i,c as d,e as u,w as s,f as c,i as v,t as p,l as m,j as f,$ as I,a5 as O,K as L,L as C,a3 as V,T as y}from"./index-a90c3162.js";import{d as h}from"./debounce-34069fe8.js";import{r as j,t as P}from"./utils-85e841e8.js";import{p as R}from"./product-480d9e23.js";import{i as b,b as x,p as T}from"./trial-d799fee8.js";import w from"./index-3a82298f.js";import{u as D}from"./theme-65292714.js";import{n as g}from"./nextStep-522872fd.js";import E from"./index-cc65d664.js";import"./pdfh5-e5c0db2a.js";import"./infoCollection-3bd369ad.js";import"./useStorage-61b30760.js";import"./trial-faeaefb9.js";import"./relativeTime-190c9ccf.js";import"./validator-5a13dc82.js";import"./useDicData-f5a5424a.js";import"./core-81d81b36.js";import"./index-c6b2b786.js";const k=e=>(L("data-v-20ff49d0"),e=e(),C(),e),B={class:"net-sale-wrap"},N={class:"part product-name"},Y=k((()=>v("span",null,null,-1))),H=k((()=>v("span",null,null,-1))),$={class:"part"},F={class:"footer"};var _=e(t({setup(e){const t=D(),L=a(),{productCode:C="HTEJBX",tenantId:k="9991000001",agentCode:_="",agencyCode:S,saleChannelId:M,extraInfo:A,preview:U}=L.query,z=n(),q=n("0"),J=n(),W=n(),G=n(),K=n([{}]),X=n([]),Q=n({}),Z=n("");let ee={};try{ee=JSON.parse(decodeURIComponent(A))}catch(ue){}const te=n({agencyId:S,agentCode:_,commencementTime:"",expiryDate:"",extInfo:{buttonCode:"EVENT_NETSALE_underWrite",pageCode:"infoCollection",templateId:ee.templateId,iseeBizNo:Z.value,extraInfo:ee},orderCategory:1,saleUserId:_,saleChannelId:M,tenantId:k,venderCode:"",tenantOrderHolder:{extInfo:{occupationCodeList:[]}},tenantOrderInsuredList:[{relationToHolder:"1",extInfo:{occupationCodeList:[]},tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{}}],tenantOrderProductList:[{}]}],tenantOrderSubjectList:[{extInfo:{subjectRelatedFirm:"xinao",subjectRelatedUserId:""},subjectName:"",subjectObjectType:"HOLDER",subjectType:"GENERAL",subjectNo:"",tenantId:k}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}}),ae=o((()=>{var e,t;return((null==(t=null==(e=J.value)?void 0:e.productRelationPlanVOList)?void 0:t.length)||0)>1})),ne=n();l([()=>G.value,()=>W.value,()=>q.value],(()=>{var e,t;const{premium:a}=G.value||{};if(a)ne.value=a&&`￥${a}元`;else{const{tenantProductInsureVO:a}=W.value||{};let n={};n=(null==(e=null==a?void 0:a.planList)?void 0:e.length)?((null==a?void 0:a.planList)||[]).find((e=>e.planCode===q.value)):null==a?void 0:a.planInsureVO;const{paymentFrequencyValue:o,premiumUnit:l}=(null==(t=null==n?void 0:n.productPremiumVOList)?void 0:t[0])||{};ne.value=o&&`￥${o}${l||"元"}`}}),{deep:!0,immediate:!0});const oe=o((()=>{var e,t,a,n,o;let l=[];return l=(null==(t=null==(e=J.value)?void 0:e.productRelationPlanVOList)?void 0:t.length)?(null==(n=null==(a=J.value)?void 0:a.productRelationPlanVOList.find((e=>e.planCode===q.value)))?void 0:n.productRiskVoList)||[]:(null==(o=J.value)?void 0:o.productRiskVoList)||[],l})),le=o((()=>{var e,t,a;const n=oe.value||[];return 1===((null==(a=null==(t=null==(e=null==n?void 0:n[0])?void 0:e.riskDetailVOList)?void 0:t[0])?void 0:a.insuranceStartType)||1)?`${I(new Date).format("YYYY-MM-DD")} 00:00:00`:`${I(new Date).add(1,"day").format("YYYY-MM-DD")} 00:00:00`})),re=o((()=>{var e,t;const a=oe.value||[],{insuranceEndType:n,riskInsureLimitVO:o}=(null==(t=null==(e=null==a?void 0:a[0])?void 0:e.riskDetailVOList)?void 0:t[0])||{},{insurancePeriodValueList:l}=o||{},[r,i]=((null==l?void 0:l[0])||"").split("_");return 1===n?`${I(new Date).add(i||0,r).format("YYYY-MM-DD")} 23:59:59`:n?`${I(new Date).add(i,r).format("YYYY-MM-DD")} 00:00:00`:""})),ie=async()=>{var e,t,a;te.value.venderCode=null==(e=J.value)?void 0:e.productBasicInfoVO.insurerCode,te.value.orderAmount=null==(t=G.value)?void 0:t.premium,te.value.orderRealAmount=null==(a=G.value)?void 0:a.premium,te.value.commencementTime=le.value,te.value.expiryDate=re.value,te.value.extInfo&&(te.value.extInfo.iseeBizNo=Z.value),te.value.tenantOrderInsuredList&&(te.value.tenantOrderInsuredList[0].planCode=q.value),g(((e,t,a)=>{var n,o;const l={},r=(e=[])=>{(e||[]).forEach((e=>{var t;l[e.riskCode]=e,(null==(t=e.riskPremiumDetailVOList)?void 0:t.length)&&r(e.riskPremiumDetailVOList)}))};r(null==t?void 0:t.riskPremiumDetailVOList);const i={...a},d={tenantId:k,riskList:(null==(n=X.value)?void 0:n[0].riskVOList)||[],riskPremium:l,productId:(null==e?void 0:e.productBasicInfoVO.id)||0};return i.tenantOrderHolder&&(i.tenantOrderHolder.certType=i.tenantOrderHolder.certType||V.CERT),i.tenantOrderInsuredList&&(i.tenantOrderInsuredList[0].certType=i.tenantOrderInsuredList[0].certType||V.CERT,i.tenantOrderInsuredList[0].tenantOrderProductList=[{premium:null==(o=G.value)?void 0:o.premium,productCode:null==e?void 0:e.productBasicInfoVO.productCode,productName:null==e?void 0:e.productBasicInfoVO.productName,tenantOrderRiskList:P(d)}]),i})(J.value,G.value,te.value),((e,t)=>{"jumpToPage"===t&&y("提交成功")}))},de=async()=>{var e;null==(e=z.value)||e.validateForm().then((()=>{var e,t;O.confirm({title:"分享",message:`即将向客户【${null==(t=null==(e=te.value)?void 0:e.tenantOrderHolder)?void 0:t.name}】发送投保确认信息,请确认是否继续？`}).then((()=>{U||ie()}))}))};l([()=>{var e;return null==(e=te.value.tenantOrderInsuredList)?void 0:e[0].name},()=>{var e;return null==(e=te.value.tenantOrderInsuredList)?void 0:e[0].birthday},()=>q.value],h((([e,t])=>{e&&t&&(U||(async(e,t,a)=>{var n,o,l,r,i,d;const u={holder:{personVO:{certType:V.CERT,...e.tenantOrderHolder,socialFlag:`${(null==(o=null==(n=e.tenantOrderHolder)?void 0:n.extInfo)?void 0:o.hasSocialInsurance)||""}`,occupationCodeList:null==(r=null==(l=e.tenantOrderHolder)?void 0:l.extInfo)?void 0:r.occupationCodeList}},insuredVOList:((null==e?void 0:e.tenantOrderInsuredList)||[]).map((e=>{var n,o;return{insuredCode:"",personVO:{...e,certType:V.CERT,socialFlag:`${(null==(n=null==e?void 0:e.extInfo)?void 0:n.hasSocialInsurance)||""}`,occupationCodeList:null==(o=null==e?void 0:e.extInfo)?void 0:o.occupationCodeList},productPlanVOList:[{insurerCode:null==t?void 0:t.productBasicInfoVO.insurerCode,planCode:q.value||"",riskVOList:j(a)}]}})),productCode:null==t?void 0:t.productBasicInfoVO.productCode,productId:null==t?void 0:t.productBasicInfoVO.id,tenantId:k},{code:s}=await x(u);if("10000"===s){const{code:e,data:t}=await T(u);"10000"===e?(G.value=t,X.value=(null==(d=null==(i=null==u?void 0:u.insuredVOList)?void 0:i[0])?void 0:d.productPlanVOList)||[]):G.value=void 0}})(te.value,J.value,oe.value))}),500));return l((()=>q.value),(()=>{K.value&&(Q.value=K.value[q.value])})),r((()=>{(async()=>{await R({productCode:C,withInsureInfo:!0,tenantId:k}).then((({code:e,data:t})=>{var a;"10000"===e&&(W.value=t,document.title=(null==(a=t.tenantProductInsureVO)?void 0:a.productName)||"")})),b({productCode:C}).then((({code:e,data:t})=>{var a;"10000"===e&&(J.value=t,K.value=t.planFactor,(null==(a=t.productRelationPlanVOList)?void 0:a.length)&&(q.value=t.productRelationPlanVOList[0].planCode||""),t.productFactor?Q.value=t.productFactor:t.planFactor&&(Q.value=t.planFactor[q.value]))}))})(),setTimeout((async()=>{Z.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,a)=>{const n=i("ProRadioButton"),o=i("ProCard"),l=i("ProCell"),r=i("ProPageWrap"),I=i("van-config-provider");return d(),u(I,{"theme-vars":m(t)},{default:s((()=>[c(r,null,{default:s((()=>{var e,t;return[v("div",B,[v("div",N,p(null==(t=null==(e=J.value)?void 0:e.productBasicInfoVO)?void 0:t.productFullName),1),m(ae)?(d(),u(o,{key:0,"show-line":!1,title:"保障年期"},{default:s((()=>{var e;return[c(n,{modelValue:q.value,"onUpdate:modelValue":a[0]||(a[0]=e=>q.value=e),class:"radio-group",prop:{label:"planName",value:"planCode"},options:null==(e=J.value)?void 0:e.productRelationPlanVOList},null,8,["modelValue","options"])]})),_:1})):f("",!0),c(w,{ref_key:"formRef",ref:z,"title-collection":{HOLDER:"投保人",INSURER:"被保人",BENEFICIARY:"收益人"},"form-info":te.value,"send-sms-code":()=>{},"input-align":"left","factor-object":Q.value},{holderName:s((()=>[Y])),insurerName:s((()=>[H])),_:1},8,["form-info","send-sms-code","factor-object"]),v("div",$,[c(l,{title:"保费",content:ne.value},null,8,["content"]),c(l,{title:"保障期间",content:`${m(le).split(" ")[0]}~${m(re).split(" ")[0]}`},null,8,["content"])]),v("div",F,[c(E,{shadow:!1,text:"分享用户确认投保",onClick:de})])])]})),_:1})])),_:1},8,["theme-vars"])}}}),[["__scopeId","data-v-20ff49d0"]]);export{_ as default};
