import{aZ as e,d as i,r as l,bi as a,bj as t,bk as n,G as o,bl as s,bm as r,R as u,N as d,bn as c,e as p,bo as m,bp as v,a_ as f,bq as y,br as g,bs as h,bt as b,O as V,bu as k,bv as C,bw as L,ar as O,bx as I,by as w,bz as x,bA as A,b2 as S,b0 as T,bB as N,aG as F,b4 as B,bc as D,a6 as j,bC as _,bD as U,bE as P,bF as M,bG as K,bH as E,bI as R,bJ as J,b as $,c as z,w as G,i as H,f as Y,g as W,$ as q,h as Q,U as X,ag as Z,b7 as ee,b8 as ie,ae as le,a9 as ae,ao as te,ap as ne,a4 as oe,j as se,D as re,a1 as ue,ai as de,aC as ce,a0 as pe,u as me,T as ve,aA as fe,bK as ye,bL as ge,aJ as he,aU as be,aV as Ve,bM as ke,Y as Ce}from"./index-1f35fe76.js";import{a as Le,B as Oe}from"./infoCollection-7771190b.js";import{S as Ie}from"./index-990c3e87.js";import{c as we}from"./cloneDeep-96676b66.js";import{d as xe,i as Ae}from"./debounce-6981b306.js";import{m as Se}from"./merge-c5599fa4.js";import{c as Te,g as Ne,r as Fe,P as Be,v as De,a as je,i as _e,t as Ue}from"./PayInfo-b0005826.js";import{c as Pe,d as Me}from"./trial-5d0972c9.js";import{a as Ke,M as Ee}from"./keysIn-a287568b.js";import{S as Re}from"./isObjectLike-a9798079.js";import{P as Je}from"./config-98e8d477.js";import{S as $e}from"./index-a8be1661.js";import{L as ze}from"./product-585b0e6f.js";const[Ge,He]=e("index-bar"),Ye={sticky:v,zIndex:f,teleport:[String,Object],highlightColor:String,stickyOffsetTop:y(0),indexList:{type:Array,default:function(){const e="A".charCodeAt(0);return Array(26).fill("").map(((i,l)=>String.fromCharCode(e+l)))}}},We=Symbol(Ge);var qe=i({name:Ge,props:Ye,emits:["select","change"],setup(e,{emit:i,slots:v}){const f=l(),y=l(),O=l(""),I=a(),w=t(f),{children:x,linkChildren:A}=n(We);let S;A({props:e});const T=o((()=>{if(s(e.zIndex))return{zIndex:+e.zIndex+1}})),N=o((()=>{if(e.highlightColor)return{color:e.highlightColor}})),F=(i,l)=>{for(let a=x.length-1;a>=0;a--){const t=a>0?l[a-1].height:0;if(i+(e.sticky?t+e.stickyOffsetTop:0)>=l[a].top)return a}return-1},B=e=>x.find((i=>String(i.index)===e)),D=()=>{if(g(f))return;const{sticky:i,indexList:l}=e,a=h(w.value),t=b(w),n=x.map((e=>e.getRect(w.value,t)));let o=-1;if(S){const e=B(S);if(e){const i=e.getRect(w.value,t);o=F(i.top,n)}}else o=F(a,n);O.value=l[o],i&&x.forEach(((i,l)=>{const{state:s,$el:r}=i;if(l===o||l===o-1){const e=r.getBoundingClientRect();s.left=e.left,s.width=e.width}else s.left=null,s.width=null;if(l===o)s.active=!0,s.top=Math.max(e.stickyOffsetTop,n[l].top-a)+t.top;else if(l===o-1&&""===S){const e=n[o].top-a;s.active=e>0,s.top=e+t.top-n[l].height}else s.active=!1})),S=""},j=()=>{V(D)};r("scroll",D,{target:w,passive:!0}),u(j),d((()=>e.indexList),j),d(O,(e=>{e&&i("change",e)}));const _=l=>{S=String(l);const a=B(S);if(a){const l=h(w.value),t=b(w),{offsetHeight:n}=document.documentElement;if(a.$el.scrollIntoView(),l===n-t.height)return void D();e.sticky&&e.stickyOffsetTop&&k(C()-e.stickyOffsetTop),i("select",a.index)}},U=e=>{const{index:i}=e.dataset;i&&_(i)},P=e=>{U(e.target)};let M;const K=()=>p("div",{ref:y,class:He("sidebar"),style:T.value,onClick:P,onTouchstartPassive:I.start},[e.indexList.map((e=>{const i=e===O.value;return p("span",{class:He("index",{active:i}),style:i?N.value:void 0,"data-index":e},[e])}))]);return c({scrollTo:_}),r("touchmove",(e=>{if(I.move(e),I.isVertical()){L(e);const{clientX:i,clientY:l}=e.touches[0],a=document.elementFromPoint(i,l);if(a){const{index:e}=a.dataset;e&&M!==e&&(M=e,U(a))}}}),{target:y}),()=>{var i;return p("div",{ref:f,class:He()},[e.teleport?p(m,{to:e.teleport},{default:()=>[K()]}):K(),null==(i=v.default)?void 0:i.call(v)])}}});const[Qe,Xe]=e("index-anchor");const Ze=S(i({name:Qe,props:{index:f},setup(e,{slots:i}){const a=O({top:0,left:null,rect:{top:0,height:0},width:null,active:!1}),t=l(),{parent:n}=I(We);if(!n)return;const s=()=>a.active&&n.props.sticky,r=o((()=>{const{zIndex:e,highlightColor:i}=n.props;if(s())return w(x(e),{left:a.left?`${a.left}px`:void 0,width:a.width?`${a.width}px`:void 0,transform:a.top?`translate3d(0, ${a.top}px, 0)`:void 0,color:i})}));return c({state:a,getRect:(e,i)=>{const l=b(t);return a.rect.height=l.height,e===window||e===document.body?a.rect.top=l.top+C():a.rect.top=l.top+h(e)-i.top,a.rect}}),()=>{const l=s();return p("div",{ref:t,style:{height:l?`${a.rect.height}px`:void 0}},[p("div",{style:r.value,class:[Xe({sticky:l}),{[A]:l}]},[i.default?i.default():e.index])])}}})),ei=S(qe),[ii,li]=e("stepper"),ai=(e,i)=>String(e)===String(i);const ti=S(i({name:ii,props:{min:U(1),max:U(1/0),name:U(""),step:U(1),theme:String,integer:Boolean,disabled:Boolean,showPlus:v,showMinus:v,showInput:v,longPress:v,allowEmpty:Boolean,modelValue:f,inputWidth:f,buttonSize:f,placeholder:String,disablePlus:Boolean,disableMinus:Boolean,disableInput:Boolean,beforeChange:Function,defaultValue:U(1),decimalLength:f},emits:["plus","blur","minus","focus","change","overlimit","update:modelValue"],setup(e,{emit:i}){const a=i=>{const{min:l,max:a,allowEmpty:t,decimalLength:n}=e;return t&&""===i||(i=""===(i=P(String(i),!e.integer))?0:+i,i=Number.isNaN(i)?+l:i,i=Math.max(Math.min(+a,i),+l),s(n)&&(i=i.toFixed(+n))),i};let t;const n=l(),r=l((()=>{var l;const t=null!=(l=e.modelValue)?l:e.defaultValue,n=a(t);return ai(n,e.modelValue)||i("update:modelValue",n),n})()),u=o((()=>e.disabled||e.disableMinus||r.value<=+e.min)),c=o((()=>e.disabled||e.disablePlus||r.value>=+e.max)),m=o((()=>({width:T(e.inputWidth),height:T(e.buttonSize)}))),v=o((()=>N(e.buttonSize))),f=i=>{e.beforeChange?K(e.beforeChange,{args:[i],done(){r.value=i}}):r.value=i},y=()=>{if("plus"===t&&c.value||"minus"===t&&u.value)return void i("overlimit",t);const l="minus"===t?-e.step:+e.step,n=a(E(+r.value,l));f(n),i(t)},g=i=>{const l=i.target,{value:a}=l,{decimalLength:t}=e;let n=P(String(a),!e.integer);if(s(t)&&n.includes(".")){const e=n.split(".");n=`${e[0]}.${e[1].slice(0,+t)}`}e.beforeChange?l.value=String(r.value):ai(a,n)||(l.value=n);const o=n===String(+n);f(o?+n:n)},h=l=>{var a;e.disableInput?null==(a=n.value)||a.blur():i("focus",l)},b=e=>{const l=e.target,t=a(l.value);l.value=String(t),r.value=t,V((()=>{i("blur",e),M()}))};let k,C;const O=()=>{C=setTimeout((()=>{y(),O()}),200)},I=i=>{e.longPress&&(clearTimeout(C),k&&L(i))},w=i=>{e.disableInput&&L(i)},x=i=>({onClick:e=>{L(e),t=i,y()},onTouchstartPassive:()=>{t=i,e.longPress&&(k=!1,clearTimeout(C),C=setTimeout((()=>{k=!0,y(),O()}),600))},onTouchend:I,onTouchcancel:I});return d((()=>[e.max,e.min,e.integer,e.decimalLength]),(()=>{const e=a(r.value);ai(e,r.value)||(r.value=e)})),d((()=>e.modelValue),(e=>{ai(e,r.value)||(r.value=a(e))})),d(r,(l=>{i("update:modelValue",l),i("change",l,{name:e.name})})),F((()=>e.modelValue)),()=>p("div",{role:"group",class:li([e.theme])},[B(p("button",j({type:"button",style:v.value,class:[li("minus",{disabled:u.value}),{[_]:!u.value}],"aria-disabled":u.value||void 0},x("minus")),null),[[D,e.showMinus]]),B(p("input",{ref:n,type:e.integer?"tel":"text",role:"spinbutton",class:li("input"),value:r.value,style:m.value,disabled:e.disabled,readonly:e.disableInput,inputmode:e.integer?"numeric":"decimal",placeholder:e.placeholder,"aria-valuemax":e.max,"aria-valuemin":e.min,"aria-valuenow":r.value,onBlur:b,onInput:g,onFocus:h,onMousedown:w},null),[[D,e.showInput]]),B(p("button",j({type:"button",style:v.value,class:[li("plus",{disabled:c.value}),{[_]:!c.value}],"aria-disabled":c.value||void 0},x("plus")),null),[[D,e.showPlus]])])}})),[ni,oi]=e("swipe-cell");const si=S(i({name:ni,props:{name:U(""),disabled:Boolean,leftWidth:f,rightWidth:f,beforeClose:Function,stopPropagation:Boolean},emits:["open","close","click"],setup(e,{emit:i,slots:t}){let n,u,d;const m=l(),v=l(),f=l(),y=O({offset:0,dragging:!1}),g=a(),h=e=>e.value?b(e).width:0,V=o((()=>s(e.leftWidth)?+e.leftWidth:h(v))),k=o((()=>s(e.rightWidth)?+e.rightWidth:h(f))),C=l=>{y.offset="left"===l?V.value:-k.value,n||(n=!0,i("open",{name:e.name,position:l}))},I=l=>{y.offset=0,n&&(n=!1,i("close",{name:e.name,position:l}))},w=i=>{e.disabled||(d=y.offset,g.start(i))},x=()=>{y.dragging&&(y.dragging=!1,(e=>{const i=Math.abs(y.offset),l=n?.85:.15,a="left"===e?V.value:k.value;a&&i>a*l?C(e):I(e)})(y.offset>0?"left":"right"),setTimeout((()=>{u=!1}),0))},A=(l="outside")=>{i("click",l),n&&!u&&K(e.beforeClose,{args:[{name:e.name,position:l}],done:()=>I(l)})},S=(e,i)=>l=>{i&&l.stopPropagation(),A(e)},T=(e,i)=>{const l=t[e];if(l)return p("div",{ref:i,class:oi(e),onClick:S(e,!0)},[l()])};return c({open:C,close:I}),R(m,(()=>A("outside")),{eventName:"touchstart"}),r("touchmove",(i=>{if(e.disabled)return;const{deltaX:l}=g;if(g.move(i),g.isHorizontal()){u=!0,y.dragging=!0;(!n||l.value*d<0)&&L(i,e.stopPropagation),y.offset=J(l.value+d,-k.value,V.value)}}),{target:m}),()=>{var e;const i={transform:`translate3d(${y.offset}px, 0, 0)`,transitionDuration:y.dragging?"0s":".6s"};return p("div",{ref:m,class:oi(),onClick:S("cell",u),onTouchstartPassive:w,onTouchend:x,onTouchcancel:x},[p("div",{class:oi("wrapper"),style:i},[T("left",v),null==(e=t.default)?void 0:e.call(t),T("right",f)])])}}}));const ri={key:0},ui={class:"custom-field"},di={key:1,class:"flex-field"},ci={class:"pro-radio-wrap"},pi={key:2},mi={class:"pro-radio-wrap"},vi={class:"custom-field"},fi={key:1},yi={key:3},gi={class:"custom-field"},hi={key:1},bi={class:"custom-field"},Vi={key:0},ki={key:1},Ci={key:4},Li=i({name:"BaoeBaofei"});var Oi=Z(i({...Li,props:{originData:{default:()=>({})},modelValue:{default:()=>({})},defalutValue:{default:()=>({})},trialResult:{default:()=>({})}},emits:["update:modelValue","trialChange"],setup(e,{emit:i}){const a=e,t=O({hadSetDefault:!1}),n=l(a.originData),s=l(a.modelValue),r=l(0),c=()=>2===n.value.saleMethod?{label:"保费",key:"initialPremium"}:{label:"保额",key:"initialAmount"},m=()=>{switch(`${n.value.displayUnit}`){case Le.YUAN:return"元";case Le.MONTH_SALARY:return"倍月薪";case Le.MILLION:return"万元";case Le.COPY:return"份"}return""},v=o((()=>2===n.value.saleMethod?{label:"保费",key:"initialPremium"}:{label:"保额",key:"initialAmount"})),f=(...e)=>{if(1===r.value){const e=s.value[v.value.key],i=a.originData.minStepValue,l=a.originData.maxStepValue,t=a.originData.stepValue;if(+e>=+l)s.value[v.value.key]=l;else if(+e<=+i)s.value[v.value.key]=i;else{const l=+e-+i,a=Math.floor(l/+t);l%+t!=0&&(s.value[v.value.key]=+i+a*+t)}}return!0},y=()=>{const{displayType:e,requireCopies:i}=n.value,l=c().key,a=!s.value.riskCode;1===e?r.value=1:3===e&&2===i?(r.value=2,n.value.displayValues.length>=1&&a&&!s.value[l]&&(s.value[l]=n.value.displayValues[0].code||n.value.displayValues[0].value)):3===e&&1===i?(r.value=3,n.value.minCopiesValue===n.value.maxCopiesValue&&a&&!s.value.copy&&(s.value.copy=n.value.minCopiesValue),n.value.displayValues.length>=1&&a&&!s.value[l]&&(s.value[l]=n.value.displayValues[0].code||n.value.displayValues[0].value)):2===e&&(r.value=4,n.value.minCopiesValue===n.value.maxCopiesValue&&a&&!s.value.copy&&(s.value.copy=n.value.minCopiesValue),a&&!s.value.initialAmount&&(s.value.initialAmount=n.value.copiesAmount))},g=o((()=>{if(n.value.displayValues){const e=c().key;return 1!==n.value.displayValues.length||s.value.riskCode||(s.value[e]=n.value.displayValues[0].code),n.value.displayValues.map((e=>({label:e.value,value:e.code})))}return[]})),h=()=>{};return u((()=>{y(),i("update:modelValue",s.value)})),d((()=>n),(e=>{y()}),{deep:!0}),d((()=>a.defalutValue),(e=>{(null==e?void 0:e.riskCode)&&!t.hadSetDefault&&(t.hadSetDefault=!0,s.value={...s.value,initialAmount:e.initialAmount,initialPremium:e.initialPremium,copy:e.copy})}),{deep:!0,immediate:!0}),d((()=>s.value),(e=>{(()=>{if(1===r.value){const e=s.value[v.value.key],i=a.originData.minStepValue,l=a.originData.maxStepValue,t=a.originData.stepValue;if(+e>+l)return!1;if(+e<+i)return!1;if((+e-+i)%+t!=0)return!1}return!0})()&&(i("update:modelValue",e),i("trialChange",e))}),{deep:!0,immediate:!0}),(e,i)=>{const l=ti,a=ee,t=ie;return $(),z(X,null,[1===r.value?($(),z("div",ri,[p(a,{label:`基本${Y(v).label}`,name:Y(v).key,class:"risk-select-field"},{input:G((()=>[H("div",ui,[p(l,{modelValue:s.value[Y(v).key],"onUpdate:modelValue":i[0]||(i[0]=e=>s.value[Y(v).key]=e),"input-width":"80px","default-value":e.originData.minStepValue,min:e.originData.minStepValue,step:e.originData.stepValue,max:e.originData.maxStepValue,theme:"round",onBlur:f},null,8,["modelValue","default-value","min","step","max"])])])),_:1},8,["label","name"])])):2===r.value?($(),z("div",di,[p(a,{modelValue:s.value[Y(v).key],"onUpdate:modelValue":i[2]||(i[2]=e=>s.value[Y(v).key]=e),label:`基本${Y(v).label}`,name:Y(v).key,class:"risk-select-field"},{input:G((()=>[H("div",ci,[p(t,{modelValue:s.value[Y(v).key],"onUpdate:modelValue":i[1]||(i[1]=e=>s.value[Y(v).key]=e),options:Y(g),onclick:h},null,8,["modelValue","options"])])])),_:1},8,["modelValue","label","name"])])):3===r.value?($(),z("div",pi,[p(a,{modelValue:s.value[Y(v).key],"onUpdate:modelValue":i[4]||(i[4]=e=>s.value[Y(v).key]=e),label:`基本${Y(v).label}`,name:Y(v).key,class:"risk-select-field"},{input:G((()=>[H("div",mi,[p(t,{modelValue:s.value[Y(v).key],"onUpdate:modelValue":i[3]||(i[3]=e=>s.value[Y(v).key]=e),options:Y(g),onclick:h},null,8,["modelValue","options"])])])),_:1},8,["modelValue","label","name"]),H("div",null,[p(a,{modelValue:s.value.copy,"onUpdate:modelValue":i[6]||(i[6]=e=>s.value.copy=e),label:"份数",name:"copy",class:"risk-select-field"},{input:G((()=>[H("div",vi,[e.originData.minCopiesValue!==e.originData.maxCopiesValue?($(),W(l,{key:0,modelValue:s.value.copy,"onUpdate:modelValue":i[5]||(i[5]=e=>s.value.copy=e),"input-width":"80px","default-value":e.originData.minCopiesValue,min:e.originData.minCopiesValue||1,step:1,max:e.originData.maxCopiesValue,theme:"round"},null,8,["modelValue","default-value","min","max"])):($(),z("span",fi,q(e.originData.minCopiesValue),1))])])),_:1},8,["modelValue"])])])):4===r.value?($(),z("div",yi,[p(a,{modelValue:s.value.copy,"onUpdate:modelValue":i[8]||(i[8]=e=>s.value.copy=e),label:"份数",name:"copy",class:"risk-select-field"},{input:G((()=>[H("div",gi,[e.originData.minCopiesValue!==e.originData.maxCopiesValue?($(),W(l,{key:0,modelValue:s.value.copy,"onUpdate:modelValue":i[7]||(i[7]=e=>s.value.copy=e),"input-width":"64px","default-value":e.originData.minCopiesValue,min:e.originData.minCopiesValue||1,step:1,max:e.originData.maxCopiesValue,theme:"round"},null,8,["modelValue","default-value","min","max"])):($(),z("span",hi,q(e.originData.minCopiesValue),1))])])),_:1},8,["modelValue"]),p(a,{label:Y(v).label,name:"copyAmount",class:"risk-select-field"},{input:G((()=>[H("div",bi,[e.originData.minCopiesValue!==e.originData.maxCopiesValue?($(),z("span",Vi,q(+e.originData.copiesAmount*+s.value.copy+m()),1)):($(),z("span",ki,q(+e.originData.minCopiesValue*+e.originData.copiesAmount+m()),1))])])),_:1},8,["label"])])):Q("",!0),2===n.value.saleMethod&&e.trialResult&&e.trialResult.initialAmount>0?($(),z("div",Ci,[p(a,{label:"保额",class:"risk-select-field"},{input:G((()=>[H("span",null,q(e.trialResult.initialAmount),1)])),_:1})])):Q("",!0)],64)}}}),[["__scopeId","data-v-3a02f6d0"]]),Ii="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAVCAYAAACt4nWrAAAAAXNSR0IArs4c6QAAAR5JREFUSEvtk71KA1EQhc+5mwVDNptWCwVFYcHHSGupKD5A0CgrWgR/Giu1UEhibyP4EGJjqZBKQSxiIZaChBW0yN4jq5WgWNxYBDL9fMycmY+oyC/mcQ4pMuBMp8lWsKJp5rAJlxIuWVrVuDV6+OJwK2nyoBCrbKALFzagE2aAYqwaiAg51JIjPheqGvY8lN3gaH/C/6sG8B+T7edYdmWCF5wCiAgsJg3eh1VNyrcVly8yNNcsrWvCpmpnIEPudBrc66lEQax6pn+XrLw3+TgUa8wX5l0mt8RNPx/UZfc/egex/K5/cU2HgKKu5dLbMZ/yGxr1U8y6nCMFbr9JBMPtpM793kk0Jy8cwZmASAYLr3XehbGmBLvsMrmhufoApklpCUynypUAAAAASUVORK5CYII=";const wi=i({name:"BeneficiaryItem"});var xi=Z(i({...wi,props:{modelValue:{default:()=>({})},schema:{default:()=>[]},config:{default:()=>({})},isView:{type:Boolean,default:!1},isTrial:{type:Boolean,default:!1},title:{default:"受益人"}},emits:["update:modelValue","trailChange"],setup(e,{expose:i,emit:a}){const t=e,n=l(null),o=O({validated:!1,schema:[],config:{},personVO:{}});return d((()=>t.config),(e=>{e&&Object.assign(o.config,e)}),{deep:!0,immediate:!0}),d((()=>t.schema),(e=>{e&&Object.assign(o.schema,we(t.schema))}),{deep:!0,immediate:!0}),d((()=>t.modelValue),((e,i)=>{JSON.stringify(e)!==JSON.stringify(i)&&(Te("受益人数据变动了"),Object.assign(o.personVO,e))}),{deep:!0,immediate:!0}),d((()=>o.personVO),(e=>{e&&a("update:modelValue",e)}),{deep:!0,immediate:!0}),d((()=>{var e;return null==(e=o.personVO)?void 0:e.relationToInsured}),((e,i)=>{if(e===i)return!1;Te("受益人与被保人关系变动了");const{certType:l}=o.personVO||{},[a,n]=Ne(o.schema,{certType:l,relationToHolder:e});return Se(o.config,n),!t.isView&&e&&i&&Object.assign(o.personVO,{...Fe(o.personVO,(e=>!(a&&"certType"===e))),relationToInsured:e}),!1}),{immediate:!0}),i({validate:e=>je(n,t.trialFactorCodes,e),validateTrialFields:()=>De({personVO:o.personVO,trialFactorCodes:t.trialFactorCodes})}),(e,i)=>($(),W(Y(Be),{ref_key:"formRef",ref:n,class:"personal-info-card",title:e.title,model:Y(o).personVO,schema:Y(o).schema,config:Y(o).config,"is-view":e.isView,"extra-provision":{objectType:Y(ae).BENEFICIARY,objectId:Y(o).personVO.id}},{cardTitleExtra:G((()=>[le(e.$slots,"default",{},void 0,!0)])),_:3},8,["title","model","schema","config","is-view","extra-provision"]))}}),[["__scopeId","data-v-eb39bf9e"]]);const Ai=["onClick"],Si=i({name:"InsuredItem"});var Ti=Z(i({...Si,props:{modelValue:{default:()=>({})},title:{default:""},holderPersonVO:{},schema:{default:()=>[]},config:{default:()=>({})},isView:{type:Boolean,default:!1},isTrial:{type:Boolean,default:!1},trialFactorCodes:{default:()=>[]},multiBeneficiaryMaxNum:{default:null},beneficiaryList:{default:()=>[]},beneficiarySchema:{default:()=>[]}},emits:["update:modelValue","update:beneficiaryList"],setup(e,{expose:i,emit:a}){const t=e,n=l(null),s=l(null),r=l(null),u={schema:[],trialFactorCodes:[],config:{},personVO:{}},c=O({validated:!1,schema:[],config:{},personVO:{},beneficiaryTypeSchemaList:[],beneficiarySchemaList:[],beneficiaryList:[]}),m=()=>{c.beneficiaryList.push(we({...u,nanoid:ne(),schema:t.beneficiarySchema}))},v=o((()=>!t.multiBeneficiaryMaxNum||c.beneficiaryList.length<t.multiBeneficiaryMaxNum)),f=o((()=>!c.schema.filter((e=>{var i;return!(e.hidden||(null==(i=c.config[e.name])?void 0:i.hidden))})).length)),y=o((()=>c.schema.filter((e=>e.isSelfInsuredNeed)).map((e=>e.name)))),g=o((()=>te(t.beneficiarySchema))),h=o((()=>{var e;return String(null==(e=c.personVO)?void 0:e.insuredBeneficiaryType)===Oe.SPECIFY}));return d((()=>t.holderPersonVO),(e=>{var i;Te("------投保人信息变动了-----");const{id:l,...a}=e||{};if("1"===String(null==(i=c.personVO)?void 0:i.relationToHolder)){const e=te(y.value)?Object.keys(a).reduce(((e,i)=>([...y.value,"occupationClass"].includes(i)&&!["birthday","age","gender"].includes(i)||(e[i]=a[i]),e)),{}):a;Object.assign(c.personVO,e)}}),{deep:!0,immediate:!0}),d((()=>t.beneficiarySchema),(e=>{c.beneficiarySchemaList=te(e)?e.filter((e=>"insuredBeneficiaryType"!==e.name)):[],c.beneficiaryTypeSchemaList=te(e)?e.filter((e=>"insuredBeneficiaryType"===e.name)):[]}),{deep:!0,immediate:!0}),d(h,((e,i)=>{String(e)!==String(i)&&(Te("受益人类型关系变动了"),e?!te(c.beneficiaryList)&&m():c.beneficiaryList=[])}),{immediate:!0}),d((()=>we(c.beneficiaryList).map((e=>({personVO:e.personVO,nanoid:e.nanoid})))),((e,i)=>{JSON.stringify(e)!==JSON.stringify(i)&&a("update:beneficiaryList",e)}),{deep:!0,immediate:!0}),d((()=>{var e;return null==(e=c.personVO)?void 0:e.relationToHolder}),((e,i)=>{if(!e)return;Te("与投保人关系变动了");const{personVO:l,schema:a=[],config:n}=c||{},{id:o,...s}=t.holderPersonVO||{},r="1"===String(l.relationToHolder),[u,d]=Ne(a,l);if(Se(n,d),a.forEach((e=>{e.relationToHolder=l.relationToHolder,e.hidden=!e.isSelfInsuredNeed&&r})),!t.isView&&i&&String(e)!==String(i)){let e={...l,...s};r||(e={...Fe(l,(e=>!(u&&"certType"===e))),relationToHolder:l.relationToHolder}),Object.assign(c.personVO,e)}}),{deep:!0}),d((()=>{var e;return null==(e=c.personVO)?void 0:e.relationToMainInsured}),((e,i)=>{if(!e)return;Te("次被保人与主被保人关系变动了");const{personVO:l,schema:a=[],config:n}=c||{},{certType:o}=l||{},[s,r]=Ne(a,{certType:o,relationToHolder:e});Se(n,r),!t.isView&&i&&String(e)!==String(i)&&Object.assign(c.personVO,{...Fe(l,(e=>!(s&&"certType"===e))),relationToMainInsured:l.relationToMainInsured})})),d((()=>t.config),(e=>{e&&Object.assign(c.config,e)}),{deep:!0,immediate:!0}),d((()=>t.schema),((e,i)=>{e&&JSON.stringify(e)!==JSON.stringify(i)&&Object.assign(c.schema,we(e))}),{deep:!0,immediate:!0}),d((()=>t.modelValue),((e,i)=>{if(JSON.stringify(e)!==JSON.stringify(i)){const{beneficiaryList:i,...l}=e;Se(c.personVO,l)}}),{deep:!0,immediate:!0}),d((()=>we(t.beneficiaryList)),((e,i)=>{JSON.stringify(e)!==JSON.stringify(i)&&(c.beneficiaryList=te(e)?e.map((e=>({...e,nanoid:e.nanoid||ne()}))):[])}),{deep:!0,immediate:!0}),d((()=>c.personVO),(e=>{e&&a("update:modelValue",e)}),{deep:!0,immediate:!0}),i({validate:e=>{var i;return Promise.all([je(n,t.trialFactorCodes,e),je(s,[],e),...(null==(i=r.value)?void 0:i.map((i=>i.validate(e))))||[]])},validateTrialFields:()=>De({personVO:c.personVO,trialFactorCodes:t.trialFactorCodes})}),(e,i)=>{const l=ue,a=de;return $(),z(X,null,[p(Y(Be),{ref_key:"insuredFormRef",ref:n,class:"personal-info-card",title:Y(f)?"":e.title,model:Y(c).personVO,schema:Y(c).schema,config:Y(c).config,"is-view":e.isView,"extra-provision":{objectType:Y(ae).INSURED,objectId:Y(c).personVO.id}},{cardTitleExtra:G((()=>[le(e.$slots,"default",{},void 0,!0)])),_:3},8,["title","model","schema","config","is-view","extra-provision"]),Y(g)?($(),z(X,{key:0},[p(Y(Be),{ref_key:"beneficiaryTypeFormRef",ref:s,class:"personal-info-card",title:"受益人",model:Y(c).personVO,schema:Y(c).beneficiaryTypeSchemaList,"is-view":e.isView},null,8,["model","schema","is-view"]),Y(h)?($(),z(X,{key:0},[($(!0),z(X,null,oe(Y(c).beneficiaryList,((i,a)=>($(),W(xi,{ref_for:!0,ref_key:"beneficiaryFormRef",ref:r,key:`${i.nanoid}_${a}`,modelValue:i.personVO,"onUpdate:modelValue":e=>i.personVO=e,title:`受益人${a+1}`,schema:Y(c).beneficiarySchemaList,config:i.config,"is-view":e.isView},{default:G((()=>[le(e.$slots,"cardTitleExtraBenifit",{index:a},void 0,!0),a>0&&!e.isView?($(),z("span",{key:0,class:"delete-button",onClick:e=>(e=>{re.confirm({message:"确定要删除该受益人吗？"}).then((()=>{c.beneficiaryList.splice(e,1)}))})(a)},[p(l,{name:"delete"})],8,Ai)):Q("",!0)])),_:2},1032,["modelValue","onUpdate:modelValue","title","schema","config","is-view"])))),128)),!e.isView&&Y(v)?($(),z("span",{key:0,class:"add-button",onClick:m},[p(a,{name:"plus"}),se("添加受益人")])):Q("",!0)],64)):Q("",!0)],64)):Q("",!0),le(e.$slots,"riskList",{},void 0,!0)],64)}}}),[["__scopeId","data-v-524344c0"]]);const Ni={class:"customer-list-item"},Fi={class:"left"},Bi=["src"],Di={class:"left-item"},ji={class:"name"},_i={key:0,class:"cert-no"},Ui={class:"cert-type-name"},Pi={key:1,class:"cert-no"},Mi={class:"cert-type-name"},Ki={key:0,class:"from-wx"},Ei=H("img",{class:"img-wx",alt:""},null,-1),Ri=i({__name:"item",props:{data:{type:Object,required:!1,default:()=>Object},disabled:{type:Boolean,required:!1,default:()=>!0}},emits:["on-delete","on-close"],setup(e,{emit:i}){const a=e,t=l(!1),{data:n,disabled:o}=ce(a);return(e,l)=>{const a=si;return $(),z("div",Ni,[p(a,{disabled:Y(o)},{default:G((()=>{var e,a,o,s,r,u,d,c;return[H("div",{class:pe(["list-item",!0===t.value?"item-bg":""]),onClick:l[0]||(l[0]=e=>(e=>{t.value=!0,e.stopPropagation(),console.log("这里关闭弹窗",n.value),i("on-close",n.value)})(e))},[H("div",Fi,[H("div",null,[H("img",{src:Y(n).gender?"1"===Y(n).gender?Y("/static/png/female-321a465f.png"):Y("/static/png/male-4ddd4d22.png"):Y("/static/png/gender-76f48c97.png"),alt:"",class:"mf"},null,8,Bi)]),H("div",null,[H("div",Di,[H("div",ji,q(Y(n).name),1),(null==(a=null==(e=Y(n))?void 0:e.certInfo[0])?void 0:a.certNo)&&1==+(null==(s=null==(o=Y(n))?void 0:o.certInfo[0])?void 0:s.certType)?($(),z("div",_i,[se(q(Y(n).certInfo[0].desensitizaCertNo)+" ",1),H("span",Ui,q(Y(n).certInfo[0].certTypeName),1)])):Q("",!0),(null==(u=null==(r=Y(n))?void 0:r.certInfo[0])?void 0:u.certNo)&&1!=+(null==(c=null==(d=Y(n))?void 0:d.certInfo[0])?void 0:c.certType)?($(),z("div",Pi,[se(q(Y(n).certInfo[0].certNo)+" ",1),H("span",Mi,q(Y(n).certInfo[0].certTypeName),1)])):Q("",!0)]),Y(n).relative?($(),z("div",Ki,[Ei,se(" 微信客户 ")])):Q("",!0)])])],2)]})),_:1},8,["disabled"])])}}});const Ji={class:"customer-list"},$i={key:0,class:"list-pr"},zi={key:1,class:"list-pr"};var Gi=Z(i({__name:"index",props:{data:{type:Array,required:!0,default:()=>[]},type:{type:String,required:!0,default:()=>"firstLetter"},disabled:{type:Boolean,required:!1,default:()=>!0}},emits:["on-delete","on-close"],setup(e,{emit:i}){const a=e,{data:t,type:n,disabled:o}=ce(a),s=l([]),r=l([]),u=e=>{i("on-delete",e)},c=e=>{i("on-close",e),console.log("这里关闭弹窗1111222----",e)};return d((()=>a.data),(()=>{t.value=a.data||[],console.log("data",t),s.value=t.value.filter((e=>!!(e.children&&Array.isArray(e.children)&&e.children.length>0))),r.value=s.value.map((e=>e.label))}),{immediate:!0,deep:!0}),(e,i)=>{const l=Ze,a=ei;return $(),z("div",Ji,["firstLetter"===Y(n)?($(),z("div",$i,[p(a,{"highlight-color":"$zaui-brand","index-list":r.value,sticky:!1},{default:G((()=>[($(!0),z(X,null,oe(s.value,(e=>($(),z(X,{key:e.label},[p(l,{index:`${e.label}`},null,8,["index"]),($(!0),z(X,null,oe(e.children,(e=>($(),W(Ri,{key:e.agentCustomerId,data:e,disabled:Y(o),onOnDelete:u,onOnClose:c},null,8,["data","disabled"])))),128))],64)))),128))])),_:1},8,["index-list"])])):($(),z("div",zi,[($(!0),z(X,null,oe(Y(t),(e=>($(),W(Ri,{key:e.agentCustomerId,data:e,disabled:Y(o),onOnDelete:u,onOnClose:c},null,8,["data","disabled"])))),128))]))])}}}),[["__scopeId","data-v-7f0e84c3"]]);const Hi=e=>(be("data-v-1d004b22"),e=e(),Ve(),e),Yi=Hi((()=>H("img",{src:Ii},null,-1))),Wi=["onClick"],qi=Hi((()=>H("img",{src:Ii},null,-1))),Qi=["onClick"],Xi=Hi((()=>H("img",{src:Ii},null,-1))),Zi=["onClick"],el={class:"search-bar"},il=["src"],ll={key:1,class:"empth"},al=[Hi((()=>H("p",null,[H("img",{src:"/static/png/empth-d7935dd7.png",class:"ig"})],-1))),Hi((()=>H("p",{class:"p1"},"暂时还没有客户哦～",-1)))],tl=i({name:"PersonalInfo"}),nl=i({...tl,props:{productFactor:{default:()=>({})},modelValue:{default:()=>({})},isTrial:{type:Boolean,default:!1},isView:{type:Boolean,default:!1},isOnlyHolder:{type:Boolean,default:!1},multiInsuredConfig:{}},emits:["update:modelValue","trailChange","trailValidateFailed","closeCustomerPopoup"],setup(e,{expose:i,emit:a}){const t=e,n=me(),{isShare:s,saleChannelId:r}=n.query,u=l(null),c=l(null),m=O({count:0,slotProps:{},uniqKey:"",currentIndex:0,currentBenifitIndex:0,currentType:"",keyword:void 0,show:!1,list:[],config:{},trialValidated:!1,holder:{personVO:{},schema:[],trialFactorCodes:[],config:{}},beneficiarySchema:[],initInsuredIList:[],insured:[]}),v=async e=>{var i,l;m.keyword;const a={pageNum:1,pageSize:999,queryBean:{keyword:m.keyword||""}},t=await Pe(a);console.log("reqs",t);const n=[];Object.keys((null==(i=null==t?void 0:t.data)?void 0:i.customerMaps)||{}).forEach((e=>{var i;n.push({label:e,children:null==(i=null==t?void 0:t.data)?void 0:i.customerMaps[e]})})),m.list=n,m.count=null==(l=null==t?void 0:t.data)?void 0:l.count},f=()=>{v(m.keyword)},y=()=>{v()},g=o((()=>!t.isTrial||t.isOnlyHolder)),h=(e,i,l)=>{m.currentType=e,"benifit"!==e?m.currentIndex=i:(m.currentIndex=i,m.currentBenifitIndex=l),m.uniqKey=ne(),v(),m.show=!0},b=()=>{setTimeout((()=>{m.show=!1}),300)},V=()=>(console.log("state.beneficiarySchema",m.beneficiarySchema),"holder"===m.currentType?m.holder.schema.map((e=>e.name))||[]:"insured"===m.currentType?m.insured[m.currentIndex].schema.map((e=>e.name))||[]:"benifit"===m.currentType?m.beneficiarySchema.map((e=>e.name))||[]:void 0),k=o((()=>{var e,i;return null==(i=null==(e=null==m?void 0:m.holder)?void 0:e.personVO)?void 0:i.name})),C=o((()=>{var e,i;return null==(i=null==(e=null==m?void 0:m.holder)?void 0:e.personVO)?void 0:i.gender})),L=o((()=>{var e,i;return null==(i=null==(e=null==m?void 0:m.holder)?void 0:e.personVO)?void 0:i.birthday})),I=o((()=>{var e,i;return null==(i=null==(e=null==m?void 0:m.holder)?void 0:e.personVO)?void 0:i.certType})),w=o((()=>{var e,i;return null==(i=null==(e=null==m?void 0:m.holder)?void 0:e.personVO)?void 0:i.certNo})),x=(e,i)=>{var l,a,t;console.log("convertCustomerData",e);const n=null==(l=null==e?void 0:e.contactInfo)?void 0:l.find((e=>"01"===e.contactType)),o=null==(a=null==e?void 0:e.contactInfo)?void 0:a.find((e=>"02"===e.contactType)),s=null==e?void 0:e.certInfo[0];console.log("mobileObject=====",n);const r={name:null==e?void 0:e.name,gender:null==e?void 0:e.gender,birthday:null==e?void 0:e.birthday,mobile:(null==n?void 0:n.contactNo)||null,email:(null==o?void 0:o.contactNo)||null,certNo:(null==s?void 0:s.certNo)||null,certType:(null==s?void 0:s.certType)||null};console.log("insureKeys",V());const u=null==(t=V())?void 0:t.reduce(((e,i)=>r.hasOwnProperty(i)?{...e,[i]:r[i]}:e),{});return console.log("extractedObject===",u),console.log("state.holder.schema=====",m.holder.schema),u},A=e=>{var i,l,a,t,n,o,s,r,u,d,c,p;if(x(e),console.log("---state.currentType",m.currentType),console.log("--state.currentIndex",m.currentIndex),console.log("--state.currentBenifitIndex",m.currentBenifitIndex),console.log("state?.insured[state.currentIndex]?.beneficiaryList[state.currentBenifitIndex]?.personVO ",null==(l=null==(i=null==m?void 0:m.insured[m.currentIndex])?void 0:i.beneficiaryList[m.currentBenifitIndex])?void 0:l.personVO),m.show=!1,"holder"===m.currentType&&Object.assign((null==(a=null==m?void 0:m.holder)?void 0:a.personVO)||{},x(e)),"insured"===m.currentType){Object.assign((null==(t=null==m?void 0:m.insured[m.currentIndex])?void 0:t.personVO)||{},x(e)),console.log("---holderGender---",C.value),console.log("---holderBirthday---",L.value);const{name:i,gender:l,birthday:a,certType:o,certNo:s}=x(e);if(k.value===i&&C.value===l&&L.value===a&&I.value===o&&w.value===s)return void Object.assign((null==(n=null==m?void 0:m.insured[m.currentIndex])?void 0:n.personVO)||{},{relationToHolder:"1"})}if("benifit"===m.currentType){const{name:i,gender:l,birthday:a,certType:t,certNo:n}=x(e);(null==(o=null==m?void 0:m.insured[m.currentIndex])?void 0:o.personVO.name)===i&&(null==(s=null==m?void 0:m.insured[m.currentIndex])?void 0:s.personVO.gender)===l&&(null==(r=null==m?void 0:m.insured[m.currentIndex])?void 0:r.personVO.birthday)===a&&(null==(u=null==m?void 0:m.insured[m.currentIndex])?void 0:u.personVO.certType)===t&&(null==(d=null==m?void 0:m.insured[m.currentIndex])?void 0:d.personVO.certNo)===n?ve("指定受益人不可为被保人本人"):Object.assign((null==(p=null==(c=null==m?void 0:m.insured[m.currentIndex])?void 0:c.beneficiaryList[m.currentBenifitIndex])?void 0:p.personVO)||{},x(e))}},S=()=>{var e;const i=!c.value||(null==(e=c.value)?void 0:e.every((e=>e.validateTrialFields())));return(!u.value||De(m.holder))&&i},T=e=>{var i;return Promise.all([...(null==(i=c.value)?void 0:i.map((i=>i.validate(e))))||[],je(u,m.holder.trialFactorCodes,e)])},N=e=>{const{productList:i,config:l,schema:a,trialFactorCodes:t,beneficiaryList:n,personVO:o,nanoid:s,...r}=e||{};return r},F=()=>{const{length:e,[e-1]:i}=m.initInsuredIList;m.insured.push(we({...i,nanoid:ne()}))},B=o((()=>{const{multiInsuredMaxNum:e,multiInsuredSupportFlag:i}=m.config;return i&&(!e||m.insured.length<e)})),D=o((()=>te(m.holder.schema))),_=o((()=>m.insured.some((e=>te(e.schema))))),U=(e,i)=>te(e)?e.reduce(((e,l)=>(e[l]=i[l],e)),{}):{},P=(e,i,l={})=>!!te(e)&&JSON.stringify(U(e,i))!==JSON.stringify(U(e,l));return d((()=>{var e;return null==(e=m.holder.personVO)?void 0:e.certType}),((e,i)=>{if(`${e}`==`${i}`)return!1;Te("投保人信息变动了====");const[l,a]=Ne(m.holder.schema,{certType:e});return Se(m.holder.config,a),!1})),d([()=>{var e;return{...null==(e=m.holder)?void 0:e.personVO}},()=>m.insured.map((e=>{const{beneficiaryList:i,personVO:l}=e||{};return{...l,beneficiaryList:te(i)?i.map((e=>({...e.personVO}))):[]}}))],xe(((e,i)=>{var l,n,o;const[s,r]=e,u=((e,i)=>{const l=P(m.holder.trialFactorCodes,e[0],i[0]),a=m.insured.some(((e,l)=>{var a;const{trialFactorCodes:t,personVO:n}=e;return P(t,n,null==(a=i[1])?void 0:a[l])}));return l||a})([s,r],i);Te(`投被保人信息变动了---${u}`);const{insuredList:d}=t.modelValue;console.log("insuredList",d,r);const c={holder:s,insuredList:r.map(((e,i)=>({...(null==d?void 0:d[i])||{},...e})))};if(m.config.isSpouseInsured){const[e,i]=r.map((e=>null==e?void 0:e.gender));if(e&&i&&String(e)===String(i))return ve("被保人性别与投保要求不符")}if(JSON.stringify(null==(l=null==r?void 0:r[0])?void 0:l.personVO),N(null==(o=null==(n=t.modelValue)?void 0:n.insuredList)?void 0:o[0]),console.log("-------result = ",c),a("update:modelValue",c),!S())return m.trialValidated=!1,a("trailValidateFailed",c);T(!0).then((()=>{m.trialValidated=!0,u&&!t.isOnlyHolder&&a("trailChange",c)})).catch((()=>{m.trialValidated=!1,a("trailValidateFailed",c)}))}),500),{deep:!0}),d([()=>t.productFactor,()=>t.isTrial],((e,i)=>{if(_e(e,i)||!e[0])return!1;Te("投被保人要素变动了");const{insuredFactorCodes:l,holderFactorCodes:a}=fe(ye)||{},{holder:n,insured:o,beneficiary:s,config:r}=Ue(e[0],{isTrial:e[1],...t.multiInsuredConfig,insuredFactorCodes:l,holderFactorCodes:a});return Object.assign(m.holder,n),console.log("-----------",n,o),m.config=r,te(o)&&(m.initInsuredIList=o.map((e=>({...e,beneficiaryList:[]})))),m.beneficiarySchema=we((null==s?void 0:s.schema)||[]),!1}),{deep:!0,immediate:!0}),d((()=>{var e,i;return null==(i=null==(e=null==m?void 0:m.insured[m.currentIndex])?void 0:e.beneficiaryList[m.currentBenifitIndex])?void 0:i.personVO}),((e,i)=>{var l,a;(null==(a=null==(l=null==m?void 0:m.insured[m.currentIndex])?void 0:l.beneficiaryList[m.currentBenifitIndex])?void 0:a.personVO)&&(null==e?void 0:e.relationToInsured)!==(null==i?void 0:i.relationToInsured)&&(Te("受益人关系变动了+++++"),m.insured[m.currentIndex].beneficiaryList[m.currentBenifitIndex].personVO={relationToInsured:null==e?void 0:e.relationToInsured})}),{deep:!0,immediate:!0}),d([()=>{const{holder:e,insuredList:i}=t.modelValue;console.log("表单数据",we(e));const l=te(i)?i.map((e=>({config:e.config,personVO:N(e),beneficiaryList:te(e.beneficiaryList)?e.beneficiaryList.map((({config:e,...i})=>({config:e,personVO:N(i)}))):[]}))):[];return[null==e?void 0:e.config,N(e),l]},()=>m.config,()=>m.initInsuredIList],(([[e,i,l]])=>{Te("投被保人数据变动了"),Object.assign(m.holder.config,e),console.log("投保人数据===",we(m.holder.personVO),we(i)),console.log("投保人数据===",we(m.holder.personVO),we(i)),Object.assign(m.holder.personVO,i);const{length:a}=l||[],{length:n}=m.insured,{length:o,0:s={},[o-1]:r}=m.initInsuredIList,{multiInsuredMaxNum:u,multiInsuredMinNum:d,multiInsuredSupportFlag:c}=m.config,p=t.isView||a>n?Math.min(a,u):n||d;m.insured=Array.from({length:p}).reduce(((e,i,a)=>{const{personVO:t,config:n={},beneficiaryList:o}=(null==l?void 0:l[a])||{},u=we(0===a?s:r);return e[a]?Se(e[a],{...we(u),personVO:t,config:n,beneficiaryList:o}):e[a]={...u,personVO:t,config:n,beneficiaryList:o,nanoid:ne()},e}),m.insured)}),{deep:!0,immediate:!0}),d((()=>m.list),((e,i)=>{e&&(console.log("val----",e),m.list=e)})),i({validate:T,validateTrialFields:S,validateHolder:(...e)=>{var i;return null==(i=u.value)?void 0:i.validate(...e)},canTrail:()=>m.trialValidated}),(e,i)=>{const l=ue,a=de,t=ge,n=Ie,o=he;return $(),z(X,null,[Y(D)&&Y(g)?($(),W(Y(Be),{key:0,ref_key:"holderFormRef",ref:u,title:"投保人信息",class:"personal-info-card",model:Y(m).holder.personVO,schema:Y(m).holder.schema,config:Y(m).holder.config,"is-view":e.isView,"extra-provision":{objectType:Y(ae).HOLDER,objectId:Y(m).holder.personVO.id}},{cardTitleExtra:G((()=>[Y(s)||e.isView||e.isTrial?Q("",!0):($(),z("div",{key:0,class:"choose-customer",onClick:i[0]||(i[0]=e=>h("holder",1,0))},[Yi,se(" 选择老用户 ")]))])),_:1},8,["model","schema","config","is-view","extra-provision"])):Q("",!0),Y(_)&&!e.isOnlyHolder?($(),z(X,{key:1},[($(!0),z(X,null,oe(Y(m).insured,((i,a)=>($(),W(Ti,j({ref_for:!0,ref_key:"insuredFormRef",ref:c,key:`${i.nanoid}_${a}`,modelValue:i.personVO,"onUpdate:modelValue":e=>i.personVO=e,"beneficiary-list":i.beneficiaryList,"onUpdate:beneficiaryList":e=>i.beneficiaryList=e,title:""+(Y(m).insured.length>1?`被保人${a+1}`:"被保人信息"),"holder-person-v-o":Y(m).holder.personVO},i,{"beneficiary-schema":Y(m).beneficiarySchema,"is-view":e.isView,"multi-beneficiary-num":Y(m).config.multiBeneficiaryMaxNum}),{riskList:G((()=>[le(e.$slots,"riskInfo",{insuredIndex:a},void 0,!0)])),cardTitleExtraBenifit:G((i=>[Y(s)||e.isView||e.isTrial?Q("",!0):($(),z("div",{key:0,class:"choose-customer",onClick:e=>h("benifit",a,null==i?void 0:i.index)},[Xi,se(" 选择老用户 ")],8,Qi))])),default:G((()=>[1==+i.personVO.relationToHolder||Y(s)||e.isView||e.isTrial?Q("",!0):($(),z("div",{key:0,class:"choose-customer",onClick:e=>h("insured",a,0)},[qi,se(" 选择老用户 ")],8,Wi)),!e.isView&&a+1>Y(m).config.multiInsuredMinNum?($(),z("span",{key:1,class:"delete-button",onClick:e=>(e=>{re.confirm({message:"确定要删除该被保人吗？"}).then((()=>{m.insured.splice(e,1)}))})(a)},[p(l,{name:"delete",color:"var(--van-primary-color)"})],8,Zi)):Q("",!0)])),_:2},1040,["modelValue","onUpdate:modelValue","beneficiary-list","onUpdate:beneficiaryList","title","holder-person-v-o","beneficiary-schema","is-view","multi-beneficiary-num"])))),128)),!e.isView&&Y(B)?($(),W(t,{key:0,class:"add-button-wrap"},{title:G((()=>[H("span",{class:"add-button",onClick:F},[p(a,{name:"plus"}),se("添加被保人")])])),_:1})):Q("",!0)],64)):Q("",!0),Y(m).show?($(),W(o,{key:2,round:!1,show:Y(m).show,closeable:!1,onClose:b,onClosed:e.onClosePopupAfterAni},{default:G((()=>[H("div",el,[p(n,{modelValue:Y(m).keyword,"onUpdate:modelValue":i[1]||(i[1]=e=>Y(m).keyword=e),placeholder:"客户 姓名/手机号",class:"icon-sercher",onSearch:f,onCancel:y},{"left-icon":G((()=>[H("img",{src:Y("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAAZlBMVEUAAAC0wNC1wdO/v/+zwNC0v9C0wM+0wNG2wdLCydm0wNC0wNC1wdCzwNC0wNC0wNC1wNC1v9G2wdS0wM+0wNC0wNCzwdG0wdCzwc+1wNK4wta6xtO1wdGzwNC0wc+1v9WzwdCzv89PygQeAAAAIXRSTlMA/DQE896qhEQLjvjX0cC5iUwk7Oamb2ZbKxkVf8d7GIfl18UPAAABK0lEQVRIx+1V25aDIAwkiEVUvNXe7G3z/z+5pKeHs2fJyqav7byIwwxJBKL64DUUi9ZL8V+1ti1gALRWqzwqjwBIoKevMvJ7j6SOAOzvq9nM8NQFPIezXkmngYewrA/jeKhLfLw2f6Y1GSB5p2PADokxE693LdB6x5/csSGudazhgrSa/lUVRcULpz8bMlRJXWQwZ8Yw0IxNeUvrDIyhDPzWMaVtAbFM+RMtZBUDS6FPCb3HAM3uJs3sE7oGRKNYGESoE3YXM2Wr2yVsHwxX3nANhl4cQVyD+CuJ90G407PwLOGX+LQK74MV3jjvRHcaYZJ0DcKmkPSldceSdL4yxsj2VpL7sdhER7Z7+5rKj47c/2FyNEoceUTHTckc0CmRA3BQEsetG5x6Z3wDxtkpoVPsMuQAAAAASUVORK5CYII="),alt:"",class:"search-icon-img",style:{width:"22px",height:"23px"}},null,8,il)])),_:1},8,["modelValue"])]),Y(m).count?($(),W(Gi,{key:0,data:Y(m).list,type:e.order,disabled:!1,onOnClose:A},null,8,["data","type"])):($(),z("div",ll,al))])),_:1},8,["show","onClosed"])):Q("",!0)],64)}}});var ol=Z(nl,[["__scopeId","data-v-1d004b22"]]),sl=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,rl=/^\w*$/;function ul(e,i){if("function"!=typeof e||null!=i&&"function"!=typeof i)throw new TypeError("Expected a function");var l=function(){var a=arguments,t=i?i.apply(this,a):a[0],n=l.cache;if(n.has(t))return n.get(t);var o=e.apply(this,a);return l.cache=n.set(t,o)||n,o};return l.cache=new(ul.Cache||Ee),l}ul.Cache=Ee;var dl,cl,pl,ml=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,vl=/\\(\\)?/g,fl=(dl=function(e){var i=[];return 46===e.charCodeAt(0)&&i.push(""),e.replace(ml,(function(e,l,a,t){i.push(a?t.replace(vl,"$1"):l||e)})),i},cl=ul(dl,(function(e){return 500===pl.size&&pl.clear(),e})),pl=cl.cache,cl),yl=fl;var gl=Re?Re.prototype:void 0,hl=gl?gl.toString:void 0;function bl(e){if("string"==typeof e)return e;if(Ke(e))return function(e,i){for(var l=-1,a=null==e?0:e.length,t=Array(a);++l<a;)t[l]=i(e[l],l,e);return t}(e,bl)+"";if(Ae(e))return hl?hl.call(e):"";var i=e+"";return"0"==i&&1/e==-Infinity?"-0":i}function Vl(e,i){return Ke(e)?e:function(e,i){if(Ke(e))return!1;var l=typeof e;return!("number"!=l&&"symbol"!=l&&"boolean"!=l&&null!=e&&!Ae(e))||rl.test(e)||!sl.test(e)||null!=i&&e in Object(i)}(e,i)?[e]:yl(function(e){return null==e?"":bl(e)}(e))}function kl(e){if("string"==typeof e||Ae(e))return e;var i=e+"";return"0"==i&&1/e==-Infinity?"-0":i}function Cl(e,i,l){var a=null==e?void 0:function(e,i){for(var l=0,a=(i=Vl(i,e)).length;null!=e&&l<a;)e=e[kl(i[l++])];return l&&l==a?e:void 0}(e,i);return void 0===a?l:a}const Ll={class:"pro-radio-wrap"},Ol=i({name:"ProductKeys"});var Il=Z(i({...Ol,props:{originData:{default:()=>({})},modelValue:{default:()=>({})},riskInfo:{default:()=>({})},defaultValue:{default:()=>({})},useData:{default:()=>({})}},emits:["trialChange","inputChange"],setup(e,{emit:i}){const a=e,t=l(a.originData),n=l(a.modelValue);l(1);const o=e=>{const i=Cl(a.originData,e),l=Cl(a.originData,e);return i.map((e=>{const i=l?l.find((i=>i.code===e.code)):null;return{label:e.value,value:e.code,disabled:!(!i||null===i.useFlag||void 0===i.useFlag)&&1!==i.useFlag}}))},s=()=>{Je.forEach((e=>{const i=Cl(a.originData,e.configKey);"checkbox"===e.type&&i&&i.length>0&&!n.value.riskCode&&(n.value[e.valueKey]=i[0].code)}))};return u((()=>{s()})),d((()=>a.defaultValue),(e=>{(null==e?void 0:e.riskCode)&&(n.value=JSON.parse(JSON.stringify(e)))}),{deep:!0,immediate:!0}),d((()=>t.value),(e=>{s()}),{deep:!0,immediate:!0}),d((()=>JSON.stringify(n.value)),((e,l)=>{const t=e&&JSON.parse(e)||{};console.log("---v new = ",t);const n=l&&JSON.parse(l)||{};let o=null;Je.forEach((e=>{t[e.valueKey]&&n[e.valueKey]&&t[e.valueKey]!==n[e.valueKey]&&(o||(o={key:e.valueKey,oldValue:n[e.valueKey],newValue:t[e.valueKey],riskCode:a.riskInfo.riskCode}))})),e&&i("trialChange",JSON.parse(e),o)}),{deep:!0,immediate:!0}),(e,i)=>{const l=ie,a=ee;return $(!0),z(X,null,oe(Y(Je),(i=>($(),z(X,null,[Y(Cl)(e.originData,i.configKey)&&(1===e.riskInfo.mainRiskFlag||i.ruleKey&&2===Y(Cl)(e.originData,i.ruleKey)||!i.ruleKey)?($(),z("div",{key:e.riskInfo.riskCode+"_"+i.name},["checkbox"===i.type?($(),W(a,{key:0,modelValue:n.value[i.valueKey],"onUpdate:modelValue":e=>n.value[i.valueKey]=e,label:i.name,name:i.valueKey,class:"risk-select-field"},{input:G((()=>[H("div",Ll,[p(l,{modelValue:n.value[i.valueKey],"onUpdate:modelValue":[e=>n.value[i.valueKey]=e,e=>((e,i)=>{console.log("-------change",e,i)})(e,i.valueKey)],options:o(i.configKey)},null,8,["modelValue","onUpdate:modelValue","options"])])])),_:2},1032,["modelValue","onUpdate:modelValue","label","name"])):Q("",!0)])):Q("",!0)],64)))),256)}}}),[["__scopeId","data-v-15c494f0"]]);const wl={class:"com-risk-liabilityinfo"},xl={class:"item-wrap"},Al={key:0},Sl=(e=>(be("data-v-68f76c44"),e=e(),Ve(),e))((()=>H("div",{class:"cell-content"},null,-1))),Tl=i({name:"riskLiabilityInfo"});var Nl=Z(i({...Tl,props:{dataSource:{default:()=>({})},modelValue:{default:()=>({})},dataSourceFolmulate:{default:()=>({})},params:{default:()=>({amountUnit:"",basicsAmount:"",basicsPremium:"",riskId:""})},defaultValue:{default:()=>({})}},emits:["trialChange"],setup(e,{emit:i}){const a=e,t=l({formInfo:a.dataSource,isCheckList:[],checkValueList:[],liabilityList:[],signLiabilityClick:[]}),n=(e,i)=>{console.log("---click ",e,i),t.value.signLiabilityClick.push({item:e,index:i})},s=(e,i)=>{const{riskLiabilityInfoVOList:l,riskLiabilityCollocationVOList:n}=a.dataSource,o=l[e].liabilityId,s=(n||[]).find((e=>e.relatedLiabilityId===o||e.collocationLiabilityId===o))||{};let r=null;s.collocationLiabilityId===o?(r=s.relatedLiabilityId,s.collocationType===ze.YI_LAI&&(r=s.collocationLiabilityId)):r=s.collocationLiabilityId;const u=l.findIndex((e=>e.liabilityId===r));((e,i,l)=>{t.value.isCheckList[e]===`${Ce.YES}`?l===ze.BANG_DING||l===ze.YI_LAI?t.value.isCheckList[i]="1":t.value.isCheckList[i]="2":l===ze.BANG_DING?t.value.isCheckList[i]="2":l===ze.YI_LAI&&(t.value.isCheckList[i]=e!==i?"3":"2")})(e,u,s.collocationType),i(l[u],u,!0)},r=(e,i,l)=>{const a=t.value.liabilityList.map((e=>e.key)),o=0===(null==e?void 0:e.liabilityAttributeValueList.length)&&0===(null==e?void 0:e.formula.length),u=t.value.isCheckList[i];o&&-1===a.indexOf(i)&&u&&t.value.liabilityList.push({liabilityValue:e,key:i,isSwitchOn:t.value.isCheckList[i]}),"1"===u?n(e,i):t.value.signLiabilityClick.splice(i,1),-1!==a.indexOf(i)&&t.value.liabilityList.forEach((e=>{e.key===i&&(e.isSwitchOn=t.value.isCheckList[i])})),l||s(i,r)},c=(e,i)=>{const l=e.liabilityAttributeValueList.filter((e=>e.displayValue===t.value.checkValueList[i])),a=JSON.parse(JSON.stringify(l))[0]||e.liabilityAttributeValueList[0],n={...e,liabilityValue:a};t.value.liabilityList.length>0&&Object.keys(t.value.checkValueList).indexOf(i)&&(t.value.liabilityList=t.value.liabilityList.filter((e=>e.key!==i))),t.value.checkValueList[i]=a.displayValue,t.value.liabilityList.push({liabilityValue:n,key:i,isSwitchOn:"1"})},m=o((()=>we(a.dataSourceFolmulate))),v=(e,i,l)=>{1===l?t.value.liabilityList.push({liabilityValue:{...e,liabilityValue:null==e?void 0:e.liabilityAttributeValueList[0]},key:i,isSwitchOn:"1"}):t.value.liabilityList.push({liabilityValue:{...e,liabilityValue:null==e?void 0:e.liabilityAttributeValueList[0]},key:i,isSwitchOn:"2"})};d((()=>m.value),((e,i)=>{var l,n;const o=null==(l=a.dataSourceFolmulate)?void 0:l.initialAmount,s=null==(n=a.dataSourceFolmulate)?void 0:n.initialPremium,r={amountUnit:a.params.amountUnit,basicsAmount:o,basicsPremium:s,riskId:a.params.riskId};a.dataSource.riskLiabilityInfoVOList.map((async l=>{if(l.formula.length>0&&(o||s)&&((null==e?void 0:e.initialAmount)!==(null==i?void 0:i.initialAmount)||(null==e?void 0:e.initialPremium)!==(null==i?void 0:i.initialPremium))){const{code:e,data:i}=await Me({...r,riskLiabilities:[l]});if("10000"===e){if(l.liabilityAttributeValueList=i[0].formulaResult,t.value.signLiabilityClick.length>0){const e=t.value.signLiabilityClick.find((e=>e.item.liabilityCode===l.liabilityCode));e&&c(e.item,e.index)}return{...l,liabilityAttributeValueList:i[0]}}return l}}))}),{deep:!0,immediate:!0}),d((()=>t.value.liabilityList),(e=>{const l=t.value.liabilityList.filter((e=>"1"===e.isSwitchOn)).map((e=>({...e.liabilityValue})));i("trialChange",l)}),{deep:!0,immediate:!0}),u((()=>{console.log("----mounted"),a.dataSource.riskLiabilityInfoVOList.map(((e,i)=>{const l=e.liabilityAttributeValueList.length>0&&0===e.formula.length&&e.liabilityAttributeValueList[0].displayValue;return t.value.checkValueList[i]||(t.value.checkValueList[i]=l),1!=+e.showFlag&&t.value.liabilityList.push({liabilityValue:e,key:i,isSwitchOn:"1"}),1==+e.showFlag&&(1===e.attributeFlag&&2===e.insureFlag&&0===e.formula.length&&v(e,i,1),1===e.attributeFlag&&1===e.insureFlag&&0===e.formula.length&&v(e,i,2),2===e.attributeFlag&&1===(null==e?void 0:e.liabilityAttributeValueList.length)&&2===e.insureFlag&&v(e,i,1),2===e.attributeFlag&&1===(null==e?void 0:e.liabilityAttributeValueList.length)&&1===e.insureFlag&&v(e,i,2)),null}))}));const f=l([]);return d((()=>a.dataSource.riskLiabilityInfoVOList),(e=>{f.value=(e||[]).map((e=>{const i=(a.dataSource.riskLiabilityCollocationVOList||[]).find((i=>i.collocationLiabilityId===e.liabilityId));return{...e,relation:null==i?void 0:i.collocationType}}))}),{deep:!0,immediate:!0}),d((()=>a.defaultValue),(e=>{(null==e?void 0:e.riskCode)&&e.liabilityList&&(t.value.signLiabilityClick=[],a.dataSource.riskLiabilityInfoVOList.forEach(((i,l)=>{var a;const o=null==e?void 0:e.liabilityList.find((e=>e.liabilityCode===i.liabilityCode));console.log("--target lia = ",o),o&&(t.value.isCheckList[l]="1",t.value.checkValueList[l]=null==(a=null==o?void 0:o.liabilityValue)?void 0:a.displayValue,1==+i.showFlag&&2==+i.optionalFlag?r(i,l):n(i,l))})))}),{deep:!0,immediate:!0}),(e,i)=>{const l=$e,a=ee,n=ke;return $(),W(n,null,{default:G((()=>[H("div",wl,[H("div",xl,[($(!0),z(X,null,oe(Y(f),((e,i)=>($(),z("div",{key:i},[1!=+e.showFlag||2===e.attributeFlag&&1===(null==e?void 0:e.liabilityAttributeValueList.length)&&2===e.insureFlag?Q("",!0):($(),z("div",Al,[(Y(t).isCheckList[i]?"3"!==Y(t).isCheckList[i]:e.relation!==Y(ze).YI_LAI)?($(),W(a,{key:0,label:`${e.liabilityName}`,"label-width":"44%",name:"insuredRelation",class:"riskliab-select-field"},{input:G((()=>[1==+e.insureFlag?($(),W(l,{key:0,modelValue:Y(t).isCheckList[i],"onUpdate:modelValue":e=>Y(t).isCheckList[i]=e,"active-value":"1","inactive-value":"2",size:"0.68rem",onClick:l=>r(e,i)},null,8,["modelValue","onUpdate:modelValue","onClick"])):Q("",!0)])),_:2},1032,["label"])):Q("",!0),1==+Y(t).isCheckList[i]&&1===e.attributeFlag||1===e.attributeFlag&&2===e.insureFlag?($(),W(a,{key:1,label:e.liabilityAttributeTypeDesc,"label-width":"44%",name:"insuredRelation",class:"riskliab-select-field-children"},{input:G((()=>[p(ie,{modelValue:Y(t).checkValueList[i],"onUpdate:modelValue":e=>Y(t).checkValueList[i]=e,prop:{label:"displayValue",value:"displayValue"},options:(e.formula.length,e.liabilityAttributeValueList),"is-simply":!0,onClick:l=>c(e,i)},null,8,["modelValue","onUpdate:modelValue","options","onClick"])])),_:2},1032,["label"])):Q("",!0)]))])))),128))])]),Sl])),_:1})}}}),[["__scopeId","data-v-68f76c44"]]);export{Oi as B,ol as P,Nl as R,ti as S,Il as a};
