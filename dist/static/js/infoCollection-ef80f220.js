import{d as e,ae as a,af as t,i as l,j as o,r as n,aH as i,l as s,c7 as r,o as u,c as d,b as c,u as f,p,w as v,f as m,q as h,v as I,aP as y,aG as g,aF as b,aN as C,aQ as O,ai as w,c8 as L,T as j,bJ as x,ak as P,al as _,ag as V}from"./index-6ae0e435.js";import{P as k,a as F}from"./PolicyInfo-7e7bbd0a.js";import{g as E,m as N}from"./trial-5417ecbf.js";import{_ as D}from"./TrialButton-e1b507ec.js";import{n as T}from"./nextStep-6d5b3b50.js";import{u as R}from"./useAttachment-03b4840e.js";import"./infoCollection-0bb41b27.js";import"./trial-4b9b5e0a.js";import{u as U}from"./useOrder-0f1eaade.js";import{t as q}from"./utils-d671d18e.js";import A from"./index-25e04001.js";import{p as S}from"./utils-a235cd49.js";import"./index-201f9e5c.js";import"./format-31cde443.js";import"./core-f1d36fe0.js";import"./utils-628af358.js";import"./createProposal-140c5d0a.js";import"./cloneDeep-f68eb52e.js";import"./InsureInfos-018f2d47.js";import"./index-de590a0b.js";import"./index-29f75cbf.js";import"./index-38d52196.js";import"./questionnaire-42dcb602.js";import"./util-539572ec.js";import"./product-7bbf9c44.js";import"./constants-7afb7c3d.js";const M={class:"long-info-collection"},B=e({name:"InfoCollection"}),H=e({...B,setup(e){const B=a((()=>t((()=>import("./index-73bb46a6.js")),["static/js/index-73bb46a6.js","static/css/index-fa4edf2a.css","static/js/index-6ae0e435.js","static/css/index-61b5a2c9.css","static/js/theme-94cf7d00.js","static/js/index-201f9e5c.js","static/css/index-bbfdd7ec.css","static/js/utils-628af358.js","static/js/infoCollection-0bb41b27.js","static/js/trial-4b9b5e0a.js"]))),H=a((()=>t((()=>import("./index-2a6719d2.js")),["static/js/index-2a6719d2.js","static/css/index-bf024e9b.css","static/js/index-6ae0e435.js","static/css/index-61b5a2c9.css"]))),J=l(),G=U(),{productCode:$="",tenantId:z,agentCode:Q="",agencyCode:Y,saleChannelId:K,isShare:W,orderNo:X,extraInfo:Z,insurerCode:ee,preview:ae}=J.query;let te={},le=null;const oe=o(2);try{te=JSON.parse(decodeURIComponent(Z))}catch(Be){}const ne={moduleType:7,subModuleType:null,code:"renewFlag",title:"保证续保型的一年期产品在保证续保期间是否申请续保",planCode:null,displayName:null,defaultValue:null,isHidden:null,isReadOnly:null,isMustInput:1,isExtend:null,regex:null,displayType:6,datasource:null,factorScript:null,isCalculationFactor:2,attributeValueList:[{code:"1",value:"是",defaultFlag:null,useFlag:null},{code:"2",value:"否",defaultFlag:null,useFlag:null}],position:null,remark:""},ie=n({isView:!1,personalInfo:{},payInfo:{schema:[],config:[],formData:[]},policyInfo:{schema:[],config:[],formData:{}},defaultValue:null,isAutoChange:!1,defaultPlanCode:"",userData:{}}),se=`${window.origin}/baseInsurance/long/phoneVerify${window.location.search}`,re=o({imgUrl:"",desc:"",title:"",link:se}),ue=o();o();const de=o(),ce=o({}),fe=o({}),pe=o([]),ve=o(),me=o({}),he=o(!1),Ie=o(!1),ye=o(0),ge=o(!0),{fileList:be,mustReadFileCount:Ce,popupFileList:Oe}=R(me,ve),we=o(!1),Le=o(!1),je=()=>{Ie.value=!1,ge.value=!0,pe.value.length<1||(he.value=!0)},xe=()=>{he.value=!1,Ie.value=!1,ge.value=!0};o({}),o(!1),o([{}]);const Pe=o(""),_e=o({}),Ve=o(!1);o();const ke=o();o();const Fe=o(0);o({});const Ee=o(),Ne=()=>{Pe.value="试算中...",_e.value=null,Ve.value=!0},De=(e,a)=>{Pe.value="",Fe.value=e.premium,_e.value=e,Ee.value=a,Ve.value=!1},Te=o(!1),Re=async()=>{var e,a;if(ae)return void y(g.INFO_COLLECTION,J.query);if(!_e.value)return;const t=[];de.value&&t.push(null==(e=de.value)?void 0:e.validate(!1)),ue.value&&t.push(null==(a=ue.value)?void 0:a.validate(!1)),Promise.all(t).then((e=>{Object.assign(G.value,{extInfo:{...G.value.extInfo,buttonCode:b.INFO_COLLECTION,pageCode:g.INFO_COLLECTION}});const a=de.value.dealMixData(),t=q({...a,productCode:$,productName:fe.value.productName},_e.value,G.value);J.query.productClass=oe.value;const l=(()=>{var e,a;const{holder:t,insuredList:l}=ie.userData,o=[],n=(e,a)=>{e.ocrData&&Object.keys(e.ocrData).find((a=>(e[a]||e.ocrData[a])&&e.ocrData[a]!==e[a]))&&o.push(`${a}信息影像识别与录入信息不一致，请确认`)};return n(t,"投保人"),n(null==l?void 0:l[0],"被保人"),((null==(e=null==l?void 0:l[0])?void 0:e.beneficiaryList)||[]).forEach(((e,a)=>{n(e,`受益人${a+1}`)})),n(null==l?void 0:l[0].guardian,"监护人"),n(null==l?void 0:l[0].guardian,"监护人"),((null==(a=G.value)?void 0:a.tenantOrderPayInfoList)||[]).forEach((e=>{n(null==l?void 0:l[0].guardian,"银行卡")})),o})();Te.value=!0,(null==l?void 0:l.length)?C.confirm({message:null==l?void 0:l[0]}).then((()=>{clearInterval(le),T(t,((e,a)=>{Te.value=!1,a===O.JUMP_PAGE&&w(e.nextPageCode,J.query)}),J)})):(clearInterval(le),T(t,((e,a)=>{Te.value=!1,a===O.JUMP_PAGE&&w(e.nextPageCode,J.query)}),J))}),(e=>{L(".long-info-collection",".van-field--error")})).catch((e=>{console.log("e",e)}))},Ue=e=>{const a=G.value.tenantOrderPayInfoList[0];G.value.tenantOrderPayInfoList.splice(0,1,{...a,...e})},qe=e=>{Object.assign(ie.userData,e)},Ae=o({}),Se=o(),Me=async()=>{let e={};X&&await E({orderNo:X,tenantId:z}).then((({code:a,data:t})=>{var l;if("10000"===a){if((null==(l=t.insuredList)?void 0:l.length)>0){const{planCode:e}=t.insuredList[0];ie.defaultPlanCode=e}Object.assign(G.value,t,{tenantOrderPayInfoList:t.tenantOrderPayInfoList||[],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0,withPayInfo:!0},productCode:$}),ie.defaultValue=G.value,e=S(t.insuredList[0].productList),oe.value=t.insuredList[0].productList.length>1?1:2,Le.value=!0}})),await N(e).then((({data:e,code:a})=>{var t;if("10000"===a){const{productDetailResList:a,productFactor:l}=e,o=(e=>{const a=[];return e.forEach((e=>{var t;const{insureProductRiskVOList:l}=(null==(t=e.productPlanInsureVOList)?void 0:t[0])||{};l.reduce(((e,a)=>{const{riskFixedRuleVO:{guaranteedRenewalFlag:t},riskCode:l}=(null==a?void 0:a.riskDetailResVO)||{};return t===V.YES&&e.push(l),e}),a)})),a})(a);Object.assign(G.value.extInfo,{renewRisk:o.join(",")}),(null==o?void 0:o.length)&&((null==(t=l[7])?void 0:t.length)?l[7].push(ne):l[7]=[ne]),Se.value=l;const n={};a.forEach((e=>{n[e.productCode]=e})),Ae.value=n;const{payInfo:i,other:s}=x(Se.value);ie.payInfo={...ie.payInfo,...i},ie.policyInfo={...ie.policyInfo,...s}}}))};return i((()=>{Me()})),s((()=>{le=setInterval((()=>{}),3e4),setTimeout((async()=>{ke.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),r((()=>{clearInterval(le)})),(e,a)=>{var t,l,o,n,i,s;const r=P,y=_;return u(),d("div",M,[c(r),f(Le)||f(ae)?(u(),p(A,{key:0,ref_key:"personalInfoRef",ref:de,"product-info":{productCode:f($),productName:f(fe).productName,insurerCode:f(ee),tenantId:f(z),planList:[]},"tenant-product-detail":f(ce),"hide-benefit":"","product-collection":f(Ae),"default-data":f(G),"product-factor":f(Se),onTrialStart:Ne,onTrialEnd:De,"onUpdate:userData":qe,onUpdateBank:Ue},{middleInfo:v((()=>[f(ie).payInfo.schema.length?(u(),p(f(k),{key:0,ref_key:"payInfoRef",ref:ue,modelValue:f(G).tenantOrderPayInfoList,"onUpdate:modelValue":a[0]||(a[0]=e=>f(G).tenantOrderPayInfoList=e),schema:f(ie).payInfo.schema,"is-view":f(ie).isView,"user-data":f(ie).userData},null,8,["modelValue","schema","is-view","user-data"])):m("",!0),f(ie).policyInfo.schema.length?(u(),p(f(F),{key:1,modelValue:f(G).extInfo,"onUpdate:modelValue":a[1]||(a[1]=e=>f(G).extInfo=e),schema:f(ie).policyInfo.schema,"is-view":f(ie).isView},null,8,["modelValue","schema","is-view"])):m("",!0)])),_:1},8,["product-info","tenant-product-detail","product-collection","default-data","product-factor"])):m("",!0),c(y,null,{default:v((()=>{var e;return[(null==(e=f(be))?void 0:e.length)?(u(),p(f(H),{key:0,modelValue:f(we),"onUpdate:modelValue":a[2]||(a[2]=e=>h(we)?we.value=e:null),"has-bg-color":!1,"attachment-list":f(be),"is-show-radio":"","pre-text":"投保人阅读并接受",onPreviewFile:a[3]||(a[3]=e=>(e=>{ye.value=e,Ie.value=!0})(e))},null,8,["modelValue","attachment-list"])):m("",!0)]})),_:1}),f(Ie)?(u(),p(f(B),{key:1,show:f(Ie),"onUpdate:show":a[4]||(a[4]=e=>h(Ie)?Ie.value=e:null),"content-list":f(ge)?f(be):f(Oe),"is-only-view":f(ge),"active-index":f(ye),text:f(ge)?"关闭":"我已逐页阅读并确认告知内容","force-read-count":f(ge)?0:f(Ce),onSubmit:je,onOnCloseFilePreviewByMask:xe},null,8,["show","content-list","is-only-view","active-index","text","force-read-count"])):m("",!0),c(D,{"is-share":f(re).isShare&&!f(W),premium:null==(t=f(_e))?void 0:t.initialPremium,"share-info":f(re),"loading-text":f(Pe),"payment-frequency":(null==(s=null==(i=null==(n=null==(o=null==(l=f(Ee))?void 0:l.insuredList)?void 0:o[0].productList)?void 0:n[0].riskList)?void 0:i[0])?void 0:s.paymentFrequency)+"","tenant-product-detail":f(ce),"handle-share":e=>(e=>{de.value.validateHolder(["mobile"]).then((()=>{Object.assign(G.value,{extInfo:{...G.value.extInfo,buttonCode:b.INFO_COLLECTION,pageCode:g.INFO_COLLECTION}});const a=de.value.getUserData(),t=q({...Ee.value,holder:null==a?void 0:a.holder},_e.value||{},G.value);T(t,((a,t)=>{t===O.JUMP_PAGE&&(null==e||e())}),J)})).catch((()=>{j("请录入投保人手机号后进行分享")}))})(e),disabled:!f(_e)||f(Te),onHandleClick:Re},{default:v((()=>[I("下一步 ")])),_:1},8,["is-share","premium","share-info","loading-text","payment-frequency","tenant-product-detail","handle-share","disabled"])])}}});export{H as default};
