import{d as e,j as a,k as l,z as s,o as i,m as o,w as u,a as n,e as r,u as d,b as t,V as c,W as v,ce as m,cf as f,cg as p,ch as h,ci as y,aB as g,ao as b,cj as S,i as V,h as C,a6 as k,aj as j,O as q,c as w,f as x,F as M,a8 as I,ck as _,T as L,cl as O,bs as $,aL as P,a9 as U,aa as E,bp as F,ag as N}from"./index-ef19c187.js";import{n as T}from"./nextStep-377b9222.js";import{c as R}from"./format-b5e9d8b9.js";import{g as A,m as D}from"./trial-e28131da.js";import{p as B}from"./utils-71625aa3.js";import{u as G}from"./useOrder-c5d9c4c6.js";import{P as Y,a as z,B as H}from"./constants-62d1c4af.js";import{d as J,q as W}from"./verify-990e54b6.js";import"./core-6c63c8d2.js";import"./utils-45cb58c8.js";import"./infoCollection-4eef8dfa.js";import"./trial-93892488.js";const K={class:"popup-container"},Q={class:"popup-header"},X={class:"title"},Z={class:"popup-body"},ee=e({name:"checkCodePopup"}),ae=e({...ee,props:{show:{type:Boolean,default:!1},type:{default:"agent"},data:{default:()=>({})}},emits:["cancel","confirm"],setup(e,{emit:b}){const S=e,V=a(),C=l((()=>S.show)),k=a({mobile:"",verifyCode:""}),j=l((()=>S.type)),q=a({holder:{type:"投保人",name:"",mobile:"",desc:""},agent:{type:"代理人",name:"李三",mobile:"13262278989",desc:"色卡上会计核算看回放独守空房还是空巅峰计划收款方"},insured:{type:"被保人",name:"",mobile:"",desc:""}}),w=()=>{b("cancel")},x=()=>{V.value.validate().then((()=>{b("confirm")}))};return s([()=>S.data,S.type],(([e,a])=>{var l,s,i;e&&(Object.assign(q.value.holder,e.holder),Object.assign(q.value.insured,null==(l=null==e?void 0:e.insuredList)?void 0:l[0]),k.value.mobile=null==(i=null==(s=q.value)?void 0:s[`${S.type}`])?void 0:i.mobile)}),{immediate:!0,deep:!0}),(e,a)=>{const l=p,s=h,b=y,S=g;return i(),o(S,{show:C.value,"onUpdate:show":a[2]||(a[2]=e=>C.value=e),class:"popup-check-mobile",closeable:!1,"close-on-click-overlay":!1},{default:u((()=>[n("div",K,[n("div",Q,[n("span",{class:"clear-all",onClick:w}," 取消 "),n("span",X,r(`${q.value[j.value].type}手机号验证`),1),n("span",{class:"close",onClick:x},"确认")]),n("div",Z,[n("h3",null,r(`尊敬的${q.value[j.value].type}:${q.value[j.value].name}`),1),n("p",null,r(q.value[j.value].desc),1),n("h3",null,r(`${q.value[j.value].type}手机号验证 ${d(R)(q.value[j.value].mobile||"")}`),1),t(b,{ref_key:"formRef",ref:V,model:k.value},{default:u((()=>[c(t(l,{modelValue:k.value.mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>k.value.mobile=e),label:"被保人手机号",name:"mobile",maxlength:"11",required:""},null,8,["modelValue"]),[[v,!1]]),t(s,{modelValue:k.value.verifyCode,"onUpdate:modelValue":a[1]||(a[1]=e=>k.value.verifyCode=e),"related-name":"mobile",label:" ",maxlength:"6","input-align":"left",placeholder:"请输入验证码",name:"verifyCode","send-s-m-s-code":d(m),"check-s-m-s-code":d(f)},null,8,["modelValue","send-s-m-s-code","check-s-m-s-code"])])),_:1},8,["model"])])])])),_:1},8,["show"])}}}),le=b([{label:"签名完成",value:1},{label:"去签名",value:2},{label:"认证失败，请联系内勤人员",value:3}]),se=2,ie=b([{label:"去双录",value:1},{label:"双录完成",value:se},{label:"双录失败",value:3}]);const oe={class:"page-verify-wrap"},ue={class:"sign-list"},ne={class:"inner-cell"},re={class:"inner-cell"},de={class:"inner-cell"},te={class:"inner-cell"},ce={class:"footer-button"},ve=e({name:"verify"}),me=e({...ve,setup(e){const s=S(),r=V(),c=C(),{orderNo:v,tenantId:f}=r.query,g=a(!1),b=a(),R=a(),K=a({holderMobile:"",holderVerifyCode:"",insuredMobile:"",insuredVerifyCode:""}),Q=G(),X=a(!1),Z=a({sign:[],verify:[],scribing:""}),ee=a({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{},verifyStatus:2},agent:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2}}),ve=a("agent"),me=l((()=>e=>Z.value.sign.includes(e)||Z.value.verify.includes(e))),fe=l((()=>ee.value.agent.verifyStatus!==k.YES)),pe=l((()=>{const{insuredList:e}=Q.value||{},{age:a,relationToHolder:l}=e[0]||{};return!(a<18||`${l}`===j.CERT)})),he=l((()=>e=>ee.value[e].isSign||ee.value[e].isVerify)),ye=l((()=>e=>ee.value[e].isShareSign)),ge=e=>{_({shareType:0,title:"分享",desc:"表述",url:`${window.location.href}&objectType=${e}&nextPageCode=infoPreview`.replace("/verify","/phoneVerify"),imageUrl:"https://aquarius-v100-test.oss-cn-hangzhou.aliyuncs.com/MyPicture/asdad.png"})},be=e=>{ve.value=e,"agent"!==e?fe.value||(X.value=!0):c.push({path:Y.agentSign,query:r.query})},Se=()=>{fe.value||b.value===se||J(Q.value).then((({code:e,data:a})=>{"10000"===e&&a&&L("双录已完成")}))},Ve=()=>{X.value=!1},Ce=()=>{let e="";e=("agent"===ve.value||(ve.value,ee.value[ve.value].isVerify),Y.infoPreview),s.set(`${O}_orderDetail`,Q.value),c.push({path:e,query:{...r.query,objectType:ve.value,isFirst:1}})},ke=()=>{const{holder:e,insuredList:a,extInfo:l}=Q.value;if(g.value){if(l.agentAuthFlag!==k.YES)return void L("代理人签名未完成")}else{if(l.agentAuthFlag===k.NO)return void L("代理人签名未完成");if(e.isCert===k.NO)return void L("投保人签名未完成");if(a[0].isCert===k.NO)return void L("被保人签名未完成")}const s=Object.assign(Q.value,{extInfo:{...Q.value.extInfo,pageCode:z.SIGN,buttonCode:H.SIGN}});T(s,((e,a)=>{a===P.JUMP_PAGE&&U(e.nextPageCode,r.query)}),r)};return q((()=>{(async()=>{let e={};W({orderNo:v,tenantId:f}).then((({code:e,data:a})=>{if("10000"===e){const{doubleRecordFlag:e,doubleRecordStatus:l}=a;g.value=e===k.YES,b.value=l}})),await A({orderNo:v,tenantId:f}).then((({code:a,data:l})=>{var s,i,o;if("10000"===a){Object.assign(Q.value,l);const{agentAuthFlag:a}=l.extInfo,{mobile:u}=l.holder,{mobile:n}=(null==(s=l.insuredList)?void 0:s[0])||{};Object.assign(K.value,{holderMobile:u,insuredMobile:n}),e=B(l.insuredList[0].productList),ee.value.agent.verifyStatus=a,ee.value.holder.verifyStatus=l.holder.isCert,ee.value.insured.verifyStatus=null==(o=null==(i=l.insuredList)?void 0:i[0])?void 0:o.isCert}})),await D(e).then((({data:e,code:a})=>{if("10000"===a){const{signInfo:a}=$(e.productFactor);a.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((a=>{e.required&&Z.value.sign.push(a.code),"1"===a.code?ee.value.agent.isSign=!0:"2"===a.code?ee.value.holder.isSign=!0:"3"===a.code?ee.value.insured.isSign=!0:"4"===a.code?ee.value.holder.isShareSign=!0:"5"===a.code&&(ee.value.insured.isShareSign=!0)})),"customerFace"===e.name&&e.columns.forEach((a=>{e.required&&Z.value.verify.push(a.code),"1"===a.code?ee.value.holder.isVerify=!0:"2"===a.code&&(ee.value.insured.isVerify=!0)}))}))}}))})()})),(e,a)=>{const l=E,s=F,r=N;return i(),w("div",oe,[t(l),n("div",ue,[d(he)("agent")?(i(),o(s,{key:0,title:"代理人签名",required:d(me)("agent")},{value:u((()=>[n("div",ne,[t(s,{"is-link":"",value:d(le)[d(ee).agent.verifyStatus],onClick:a[0]||(a[0]=e=>be("agent"))},null,8,["value"])])])),_:1},8,["required"])):x("",!0),d(g)?(i(),o(d(y),{key:2,ref_key:"formRef",ref:R,model:d(K)},{default:u((()=>[t(d(p),{modelValue:d(K).holderMobile,"onUpdate:modelValue":a[5]||(a[5]=e=>d(K).holderMobile=e),label:"投保人手机号",name:"holderMobile",maxlength:"11",required:"","is-view":""},null,8,["modelValue"]),t(d(h),{modelValue:d(K).holderVerifyCode,"onUpdate:modelValue":a[6]||(a[6]=e=>d(K).holderVerifyCode=e),"related-name":"holderMobile",label:"验证码",maxlength:"6",name:"holderVerifyCode","send-s-m-s-code":d(m),required:""},null,8,["modelValue","send-s-m-s-code"]),d(pe)?(i(),w(M,{key:0},[t(d(p),{modelValue:d(K).insuredMobile,"onUpdate:modelValue":a[7]||(a[7]=e=>d(K).insuredMobile=e),label:"被保人手机号",name:"insuredMobile",maxlength:"11",required:"","is-view":""},null,8,["modelValue"]),t(d(h),{modelValue:d(K).insuredVerifyCode,"onUpdate:modelValue":a[8]||(a[8]=e=>d(K).insuredVerifyCode=e),label:"验证码",maxlength:"6",name:"insuredVerifyCode","related-name":"insuredMobile","send-s-m-s-code":d(m),required:""},null,8,["modelValue","send-s-m-s-code"])],64)):x("",!0)])),_:1},8,["model"])):(i(),w(M,{key:1},[d(he)("holder")?(i(),o(s,{key:0,title:"投保人签名",required:d(me)("holder")},{value:u((()=>[n("div",re,[d(ye)("holder")?(i(),o(s,{key:0,"value-class":""+(d(fe)?"disable":""),"is-link":"",value:"分享空签邀约",onClick:a[1]||(a[1]=e=>ge("holder"))},null,8,["value-class"])):x("",!0),t(s,{"is-link":"",value:d(le)[d(ee).holder.verifyStatus],"value-class":""+(d(fe)?"disable":""),onClick:a[2]||(a[2]=e=>be("holder"))},null,8,["value","value-class"])])])),_:1},8,["required"])):x("",!0),d(he)("insured")&&d(pe)?(i(),o(s,{key:1,title:"被保人签名",required:d(me)("insured")},{value:u((()=>[n("div",de,[d(ye)("insured")?(i(),o(s,{key:0,"value-class":""+(d(fe)?"disable":""),"is-link":"",value:"分享空签邀约",onClick:a[3]||(a[3]=e=>ge("insured"))},null,8,["value-class"])):x("",!0),t(s,{"is-link":"","value-class":""+(d(fe)?"disable":""),value:d(le)[d(ee).insured.verifyStatus],onClick:a[4]||(a[4]=e=>be("insured"))},null,8,["value-class","value"])])])),_:1},8,["required"])):x("",!0)],64)),d(g)?(i(),o(s,{key:3,title:"保单双录",required:""},{value:u((()=>[n("div",te,[t(s,{"is-link":"","value-class":""+(d(fe)?"disable":""),value:d(ie)[d(b)],onClick:Se},null,8,["value-class","value"])])])),_:1})):x("",!0)]),n("div",ce,[t(r,{type:"primary",onClick:ke},{default:u((()=>[I("下一步")])),_:1})]),t(ae,{type:d(ve),show:d(X),data:d(Q),onCancel:Ve,onConfirm:Ce},null,8,["type","show","data"])])}}});export{me as default};
