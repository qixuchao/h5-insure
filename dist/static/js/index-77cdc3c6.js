import{av as e,aT as a,aU as s,aV as t,aW as o,aX as l,aY as r,d as i,f as d,aZ as u,a_ as n,a$ as c,b0 as p,b1 as m,aA as v,b2 as k,aB as I,_ as f,S as L,r as h,E as b,am as y,c as R,g as P,F as g,h as V,i as C,t as _,m as O,b3 as D,e as j,w,j as T,n as S,b4 as U,aF as x,X as N,Y as $,u as A,a as E,aD as q,b as B,aL as F,b5 as Y,ai as H,y as K,P as W,aO as X,l as M,b6 as Z,B as z}from"./index-5239afda.js";import{u as G,P as J}from"./index-1fa3ebf6.js";import{q as Q,a as ee,b as ae}from"./createProposal-05765e43.js";import{R as se}from"./index-2038fd60.js";import{u as te}from"./useDicData-2fe3e43e.js";import"./pdfh5-008ca364.js";import"./trial-f5b40a6d.js";import"./trial-04861e1a.js";const[oe,le]=e("action-sheet"),re=a({},s,{title:String,round:t,actions:o(),closeIcon:l("cross"),closeable:t,cancelText:String,description:String,closeOnPopstate:t,closeOnClickAction:Boolean,safeAreaInsetBottom:t}),ie=[...r,"round","closeOnPopstate","safeAreaInsetBottom"];const de=I(i({name:oe,props:re,emits:["select","cancel","update:show"],setup(e,{slots:a,emit:s}){const t=e=>s("update:show",e),o=()=>{t(!1),s("cancel")},l=()=>{if(e.title)return d("div",{class:le("header")},[e.title,e.closeable&&d(p,{name:e.closeIcon,class:[le("close"),m],onClick:o},null)])},r=()=>{if(a.cancel||e.cancelText)return[d("div",{class:le("gap")},null),d("button",{type:"button",class:le("cancel"),onClick:o},[a.cancel?a.cancel():e.cancelText])]},i=(e,s)=>e.loading?d(v,{class:le("loading-icon")},null):a.action?a.action({action:e,index:s}):[d("span",{class:le("name")},[e.name]),e.subname&&d("div",{class:le("subname")},[e.subname])],I=(a,o)=>{const{color:l,loading:r,callback:u,disabled:n,className:c}=a;return d("button",{type:"button",style:{color:l},class:[le("item",{loading:r,disabled:n}),c],onClick:()=>{n||r||(u&&u(a),e.closeOnClickAction&&t(!1),k((()=>s("select",a,o))))}},[i(a,o)])},f=()=>{if(e.description||a.description){const s=a.description?a.description():e.description;return d("div",{class:le("description")},[s])}};return()=>d(c,u({class:le(),position:"bottom","onUpdate:show":t},n(e,ie)),{default:()=>{var s;return[l(),f(),d("div",{class:le("content")},[e.actions.map(I),null==(s=a.default)?void 0:s.call(a)]),r()]}})}}));const ue=e=>(N("data-v-cd47605e"),e=e(),$(),e),ne={class:"com-product-list-wrapper"},ce={class:"risk-item-wrapper"},pe={class:"content"},me={class:"risk-premium"},ve=S(" 保费:"),ke={class:"premium"},Ie={class:"risk-factor"},fe={class:"factor"},Le={class:"factor-value"},he=ue((()=>C("span",{class:"factor-name"}," 保额(元) ",-1))),be={class:"factor"},ye={class:"factor-value"},Re=ue((()=>C("span",{class:"factor-name"}," 保障期间 ",-1))),Pe={class:"factor"},ge={class:"factor-value"},Ve=ue((()=>C("span",{class:"factor-name"}," 缴费期间 ",-1))),Ce={class:"operate-bar"},_e=S("删除"),Oe=ue((()=>C("span",{class:"btn-plus"},"+",-1))),De=S(" 附加险"),je=S("修改"),we={key:0,class:"premium-total"},Te=S(" 保费: "),Se={class:"premium"};var Ue=f(i({props:{productRiskList:{default:()=>[]},productInfo:{default:()=>({})},productData:{default:()=>({})},pickProductPremium:{type:Function,default:()=>{}},productNum:{default:0}},emits:["deleteRisk","updateRisk","addRiderRisk"],setup(e,{emit:a}){const s=e,[t,o]=L(),l=h({checkedList:[],disabledList:[],riderRiskList:[],mainRiskData:{},totalPremium:0,currentRiskRecord:{},productRiskList:[]}),r=te("RISK_PAYMENT_PERIOD"),i=te("RISK_INSURANCE_PERIOD"),u=b((()=>{var e,a;return(null==(a=null==(e=s.productData)?void 0:e.productRiskVoList)?void 0:a[0].riskDetailVOList.filter((e=>1===e.collocationType)))||[]})),n=b((()=>{var e,a;const t=s.productRiskList.map((e=>e.riskId)),o=((null==(a=null==(e=s.productData)?void 0:e.productRiskVoList)?void 0:a[0].riskDetailVOList)||[]).filter((e=>t.includes(e.id)&&1===e.collocationType));return u.value.length-o.length})),c=b((()=>e=>{var a,t;const o=(null==(t=null==(a=s.productData)?void 0:a.productRiskVoList)?void 0:t[0].riskDetailVOList.find((a=>a.id!==e)))||{};let l=!1;return l=!!s.productNum||2===o.riskType&&1===o.collocationType,l})),p=b((()=>{var e,a;return(null==(a=null==(e=s.productData)?void 0:e.productRiskVoList)?void 0:a[0].riskDetailVOList.find((e=>1===e.riskType)))||{}})),m=b((()=>p.value.collocationVOList||[])),v=(e,t)=>{const o=e.map((e=>e.id)).filter((e=>!l.value.disabledList.includes(e)));a("addRiderRisk",o,s.productInfo)};return y((()=>s.productInfo),(e=>{var a;let t=0;(e.proposalProductRiskList||[]).forEach((e=>{t+=e.premium})),null==(a=s.pickProductPremium)||a.call(s,{[`${e.productId}`]:t}),l.value.totalPremium=t}),{deep:!0,immediate:!0}),y((()=>s.productRiskList),(e=>{const a=[],s=[],t=[];(e||[]).forEach((e=>{1===e.riskType?a.unshift(e):(s.push(e.riskId),t.push(e.riskId),a.push(e))})),l.value.disabledList=s,l.value.checkedList=t,l.value.productRiskList=a}),{deep:!0,immediate:!0}),(e,p)=>{const k=U,I=x;return R(),P("div",ne,[(R(!0),P(g,null,V(l.value.productRiskList,(e=>{var t,u;return R(),P("div",{key:e.riskId},[C("div",ce,[d(k,{"risk-type":e.riskType,title:e.riskName,class:"no-border"},null,8,["risk-type","title"]),C("div",pe,[C("div",me,[ve,C("span",ke,"￥"+_(null==(t=e.premium)?void 0:t.toLocaleString()),1)]),C("div",Ie,[C("div",fe,[C("span",Le,_(null==(u=e.amount)?void 0:u.toLocaleString()),1),he]),C("div",be,[C("span",ye,_(O(D)(O(i),e.coveragePeriod)),1),Re]),C("div",Pe,[C("span",ge,_(O(D)(O(r),e.chargePeriod)),1),Ve])]),C("div",Ce,[O(c)(e.riskId)?(R(),j(I,{key:0,round:32,class:"border",onClick:t=>{a("deleteRisk",e,s.productInfo)}},{default:w((()=>[_e])),_:2},1032,["onClick"])):T("",!0),O(n)?(R(),j(I,{key:1,activated:"",round:32,class:"btn-rider-risk",onClick:a=>{return s=e,o(!0),void(l.value.currentRiskRecord=s);var s}},{default:w((()=>[Oe,De])),_:2},1032,["onClick"])):T("",!0),d(I,{activated:"",round:32,onClick:t=>{a("updateRisk",e,s.productInfo)}},{default:w((()=>[je])),_:2},1032,["onClick"])])])])])})),128)),l.value.productRiskList.length>1?(R(),P("div",we,[Te,C("span",Se,"￥"+_(l.value.totalPremium.toLocaleString()),1)])):T("",!0),O(t)?(R(),j(se,{key:1,modelValue:l.value.checkedList,"onUpdate:modelValue":p[0]||(p[0]=e=>l.value.checkedList=e),show:O(t),disabled:l.value.disabledList,"risk-list":O(u),"collocation-list":O(m),onFinished:v,onClose:p[1]||(p[1]=e=>O(o)(!1))},null,8,["modelValue","show","disabled","risk-list","collocation-list"])):T("",!0)])}}}),[["__scopeId","data-v-cd47605e"]]);const xe={class:"container"},Ne=(e=>(N("data-v-4f24fb6d"),e=e(),$(),e))((()=>C("span",{class:"plan-name"},"计划书名称",-1))),$e={class:"operate-bar"},Ae=S("添加主险"),Ee={class:"footer-bar"},qe={class:"trial-result"},Be=S("总保费"),Fe={class:"result-num"},Ye={class:"trial-operate"},He=S("保存并预览");var Ke=f(i({setup(e){const a=[{name:"保存修改"},{name:"另存为新计划书"}],[s,t]=L(),[o,l]=L(),r=h({proposalHolder:{},proposalInsuredList:[{name:"",gender:"",birthday:"",proposalInsuredProductList:[]}],proposalName:"",totalPremium:0,relationUserType:2}),i=A(),u=E(),n=G(),{id:c,type:p="add",isCreateProposal:m}=u.query,v=h({productId:0,productCollection:{},productInfo:{},productPremium:{},riderRisk:{},type:"add",currentRisk:[]}),k=h();h({}),h([]),b((()=>({min:"",max:""})));const I=()=>{k.value.validate().then((()=>{ae(r.value).then((({code:e,data:a})=>{"10000"===e&&(n.$reset(),n.proposalId=a,i.push({path:"/compositionProposal",query:{id:a}}))}))}))},f=()=>{!c&&n.proposalId?l(!0):I()},D=(e,a)=>{a&&(r.value.id=null),I()},S=(e,a,s)=>a?/^.{1,20}$/.test(a)?"":`${e}不能超过20个字符`:"",U=(e={})=>{Object.assign(v.value.productPremium,e),r.value.totalPremium=Object.values(v.value.productPremium).reduce(((e,a)=>e+a),0)},N=(e,a)=>{const s=a;H.confirm({message:"确认删除该险种？"}).then((()=>{1===e.riskType?(r.value.proposalInsuredList[0].proposalInsuredProductList=r.value.proposalInsuredList[0].proposalInsuredProductList.filter((e=>e.productId!==s.productId)),U({[s.productId]:0})):s.proposalProductRiskList=s.proposalProductRiskList.filter((a=>a.riskId!==e.riskId))}))},$=(e,a)=>{v.value.productId=a.productId,v.value.productInfo=a,v.value.type="edit",v.value.currentRisk=[e.riskId],t(!0)},se=(e,a)=>{v.value.productId=a.productId,v.value.productInfo=a,v.value.type="addRiderRisk",v.value.currentRisk=e,t(!0)},te=e=>{r.value.proposalInsuredList[0].proposalInsuredProductList=r.value.proposalInsuredList[0].proposalInsuredProductList.map((a=>{let s=a;return a.productId===e.proposalInsuredList[0].proposalInsuredProductList[0].productId&&(s={...e.proposalInsuredList[0].proposalInsuredProductList[0]}),s})),t(!1)},oe=()=>{n.setProposalInfo(r.value),n.setTrialData([]),n.setExcludeProduct(Object.keys(v.value.productCollection)),i.push({path:"/proposalList",query:{isCreateProposal:"1",...u.query}})},le=()=>{t(!1)};return q((()=>{const e=n.$state.trialData,a=n.$state.proposalInfo,s=n.$state.proposalId;c&&!m||s?(((e={})=>{Q(e).then((({code:e,data:a})=>{"10000"===e&&Object.assign(r.value,a)}))})({id:c||s}),n.$reset()):!Object.keys(a).length&&e.length?Object.assign(r.value,e[0]):Object.keys(a).length&&e.length?(a.proposalInsuredList[0].proposalInsuredProductList.push(...e[0].proposalInsuredList[0].proposalInsuredProductList),r.value=a):Object.keys(a).length&&!e.length&&(r.value=a),n.setTrialData([])})),y((()=>{var e;return null==(e=r.value.proposalInsuredList[0].proposalInsuredProductList)?void 0:e.length}),(()=>{const e=r.value.proposalInsuredList[0].proposalInsuredProductList.map((e=>({productId:e.productId,source:2})));ee({voList:e}).then((({code:e,data:a})=>{"10000"===e&&(v.value.productCollection=a)})).finally((()=>{}))})),(e,t)=>{const i=K,u=W,n=X,c=M,p=Z,m=x,I=z,L=de,h=B("ProPageWrap");return R(),j(h,{class:"page-create-wrapper"},{default:w((()=>{var e;return[C("div",xe,[d(p,{ref_key:"formRef",ref:k,"input-align":"right","error-message-align":"right"},{default:w((()=>[d(u,{"show-line":!1},{default:w((()=>[d(i,{modelValue:r.value.proposalName,"onUpdate:modelValue":t[0]||(t[0]=e=>r.value.proposalName=e),class:"border-radius",name:"proposalName",placeholder:"请输入计划书名称",rules:[{validator:(...e)=>S("计划书名称",...e)}]},{label:w((()=>[Ne])),_:1},8,["modelValue","rules"])])),_:1}),d(u,{title:"被保人信息"},{default:w((()=>[d(i,{modelValue:r.value.proposalInsuredList[0].name,"onUpdate:modelValue":t[1]||(t[1]=e=>r.value.proposalInsuredList[0].name=e),name:"name",label:"姓名",rules:[{validator:(...e)=>S("姓名",...e)}],placeholder:"请输入（选填）"},null,8,["modelValue","rules"]),d(n,{modelValue:r.value.proposalInsuredList[0].birthday,"onUpdate:modelValue":t[2]||(t[2]=e=>r.value.proposalInsuredList[0].birthday=e),name:"birthday",label:"出生日期",type:"date","is-link":"",readonly:"",placeholder:"请选择",rules:[{required:!0,message:"请选择"}]},null,8,["modelValue"]),d(i,{modelValue:r.value.proposalInsuredList[0].gender,"onUpdate:modelValue":t[4]||(t[4]=e=>r.value.proposalInsuredList[0].gender=e),name:"gender",label:"性别",class:"border-radius",rules:[{required:!0,message:"请选择"}]},{input:w((()=>[d(c,{modelValue:r.value.proposalInsuredList[0].gender,"onUpdate:modelValue":t[3]||(t[3]=e=>r.value.proposalInsuredList[0].gender=e),options:O(F)},null,8,["modelValue","options"])])),_:1},8,["modelValue"])])),_:1})])),_:1},512),(R(!0),P(g,null,V(r.value.proposalInsuredList[0].proposalInsuredProductList||[],(e=>(R(),j(u,{key:e.productId,"show-line":!1},{default:w((()=>{var a,s;return[d(Ue,{"product-risk-list":e.proposalProductRiskList,"product-info":e,"product-num":(null==(s=null==(a=r.value.proposalInsuredList[0])?void 0:a.proposalInsuredProductList)?void 0:s.length)-1,"product-data":v.value.productCollection[e.productId],"pick-product-premium":U,onAddRiderRisk:se,onUpdateRisk:$,onDeleteRisk:N},null,8,["product-risk-list","product-info","product-num","product-data"])]})),_:2},1024)))),128)),C("div",$e,[d(m,{activated:"",round:34,onClick:oe},{default:w((()=>[Ae])),_:1})])]),C("div",Ee,[C("span",qe,[Be,C("span",Fe,"￥"+_(r.value.totalPremium.toLocaleString()),1)]),C("div",Ye,[d(I,{type:"primary",onClick:f},{default:w((()=>[He])),_:1})])]),O(s)?(R(),j(J,{key:0,"is-show":O(s),type:v.value.type,"rider-risk":(null==(e=v.value.riderRisk)?void 0:e[v.value.productId])||[],"product-data":v.value.productCollection[v.value.productId],"form-info":v.value.productInfo,holder:r.value.proposalHolder,insured:r.value.proposalInsuredList[0],"current-risk":v.value.currentRisk,onClose:le,onFinished:te},null,8,["is-show","type","rider-risk","product-data","form-info","holder","insured","current-risk"])):T("",!0),d(L,{show:O(o),"onUpdate:show":t[5]||(t[5]=e=>Y(o)?o.value=e:null),actions:a,"cancel-text":"取消","close-on-click-action":"",onCancel:t[6]||(t[6]=e=>O(l)(!1)),onSelect:D},null,8,["show"])]})),_:1})}}}),[["__scopeId","data-v-4f24fb6d"]]);export{Ke as default};
