import{d as e,a4 as a,a5 as i,i as s,h as t,bF as n,j as r,aG as o,o as d,c as l,b as c,a as u,u as f,w as g,a8 as p,aL as m,cB as h,cC as v,T as y,cD as S,bw as b,aa as j,cE as I,ai as E}from"./index-9ddb4866.js";import{b as _}from"./product-bc332d14.js";import{g as L,m as N}from"./trial-e64e64ad.js";import{_ as O}from"./SignPart-c273e63f.js";import{u as w}from"./useOrder-8054edcb.js";import{N as C}from"./notice-33e6eedd.js";import"./PolicyInfo-a2540901.js";import{a as T,P as V}from"./constants-4b08cf92.js";import{p as A}from"./utils-ad3ac2bd.js";import{g as D}from"./utils-fb96d18c.js";import"./index-9394f204.js";import"./infoCollection-3daf3928.js";import"./trial-b9732f54.js";const q={class:"long-verify"},G={class:"header"},P={class:"verify-content"},x={class:"footer-button"},R=e({__name:"agentSign",setup(e){a((()=>i((()=>import("./index-75d201c4.js")),["static/js/index-75d201c4.js","static/css/index-bf024e9b.css","static/js/index-9ddb4866.js","static/css/index-d5fdc031.css"]))),a((()=>i((()=>import("./index-7f28b844.js")),["static/js/index-7f28b844.js","static/css/index-fa4edf2a.css","static/js/index-9ddb4866.js","static/css/index-d5fdc031.css","static/js/theme-94cf7d00.js","static/js/index-02d214c0.js","static/css/index-bbfdd7ec.css","static/js/utils-fb96d18c.js","static/js/infoCollection-3daf3928.js","static/js/trial-b9732f54.js"])));const R=s(),k=t(),{productCode:B="",tenantId:F,agentCode:M="",agencyCode:U,saleChannelId:$,saleUserId:z,orderNo:H,orderCode:J,extraInfo:K,isShare:Q,insurerCode:W,preview:X}=R.query;let Y={};try{Y=JSON.parse(decodeURIComponent(K))}catch(re){}const Z=w(),ee=`${window.origin}/baseInsurance/long/phoneVerify?${n.stringify({...R.query,orderNo:J||H})}`,ae=r(),ie=r({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:""},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{}},agent:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:[]}}),se=r({sign:[],verify:[],scribing:""}),te=()=>{if(X)return void m(T.SIGN,R.query);const e=[];ae.value&&se.value.sign.includes("1")&&e.push(ae.value.validateSign()),Promise.all(e).then((e=>{h({bizObjectId:[],bizObjectType:v.AGENT,orderId:Z.value.id,tenantId:F}).then((({code:e,data:a})=>{"10000"===e&&a&&k.push({path:V.sign,query:R.query})}))})).catch((e=>{y(e.message)}))};r();const ne=(e,a,i)=>{var s;S(e,a,null==(s=Z.value)?void 0:s.id,F,i).then((()=>{H&&L({orderNo:J||H,tenantId:F}).then((({code:e,data:a})=>{if("10000"===e){Object.assign(Z.value,a);const e=[];a.tenantOrderAttachmentList.forEach((a=>{a.objectType===C.AGENT&&30===a.category&&e.push(a.fileBase64)})),ie.value.agent.signData=e}}))}))};r({imgUrl:"",desc:"",title:"",link:ee});return o((()=>{(async()=>{let e={};const{code:a,data:i}=await L({orderNo:H,tenantId:F});"10000"===a&&(Object.assign(Z.value,i),e=A(i.insuredList[0].productList),i.tenantOrderAttachmentList.forEach((e=>{e.objectType===C.AGENT&&30===e.category&&ie.value.agent.signData.push(e.fileBase64)}))),_(e).then((({code:e,data:a})=>{var i;if("10000"===e){const{signMaterialMap:e}=(null==(i=a.productMaterialPlanVOList)?void 0:i[1])||{};(Object.values(e||{}).flat()||[]).forEach((e=>{e.noticeObject===C.AGENT&&ie.value.agent.fileList.push({attachmentName:e.materialName,attachmentList:[{...e,materialSource:D(`${null==e?void 0:e.materialSource}`,null==e?void 0:e.materialContent)}]})}))}})),N(e).then((({data:e,code:a})=>{if("10000"===a){const{signInfo:a}=b(e.productFactor);a.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((a=>{e.required&&se.value.sign.push(a.code),"1"===a.code?ie.value.agent.isSign=!0:"2"===a.code?ie.value.holder.isSign=!0:"3"===a.code?ie.value.insured.isSign=!0:"4"===a.code?ie.value.holder.isShareSign=!0:"5"===a.code&&(ie.value.insured.isShareSign=!0)})),"customerFace"===e.name&&e.columns.forEach((a=>{e.required&&se.value.verify.push(a.code),"1"===a.code?ie.value.holder.isVerify=!0:"2"===a.code&&(ie.value.insured.isVerify=!0)}))}))}}))})()})),(e,a)=>{const i=j,s=I,t=E;return d(),l("div",q,[c(i),u("div",G,[c(s,{type:"warning",title:"尊敬的客户，本次投保需要进行身份认证",content:"本产品投保需要对投保人、被保人进行实名认证，您购买本产品的累计总保费已超过20万，按监管要求，需要提供投保人、被保人、指定受益人证件影像，本产品非本人投保且带身故责任、需对投保人、被保人（成人）的投保意愿进行签字确认。"})]),u("div",P,[c(O,{ref_key:"agentSignRef",ref:ae,"order-detail":f(Z),"sign-string":f(ie).agent.signData,"show-sign":f(ie).agent.isSign,"show-verify":f(ie).agent.isVerify,"file-list":f(ie).agent.fileList,"personal-info":f(ie).agent.personalInfo,disabled:!!f(Q),title:"代理人",onHandleSign:a[0]||(a[0]=e=>ne("AGENT",e))},null,8,["order-detail","sign-string","show-sign","show-verify","file-list","personal-info","disabled"])]),u("div",x,[c(t,{type:"primary",onClick:te},{default:g((()=>[p("确定")])),_:1})])])}}});export{R as default};
