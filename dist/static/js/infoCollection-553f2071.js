import{d as e,ay as a,az as t,i as o,j as l,r as n,aR as i,l as s,cb as r,o as u,c as d,b as c,u as p,p as v,w as f,f as m,q as h,v as I,aY as y,aQ as L,aP as g,aX as C,aZ as R,aC as k,cc as O,T as w,bP as j,aD as P,aE as b,aA as x}from"./index-6a9cf46c.js";import{P as _,a as V}from"./PolicyInfo-6c553e35.js";import{g as D,m as E}from"./trial-41b6fd53.js";import{_ as F}from"./TrialButton-2ee2e941.js";import{n as q}from"./nextStep-5fc4dcce.js";import{u as N}from"./useAttachment-02b8927b.js";import"./infoCollection-974452d5.js";import{R as T}from"./trial-d6373768.js";import{u as U}from"./useOrder-d313309a.js";import{t as A}from"./utils-e3b5b413.js";import S from"./index-475507b2.js";import{p as M,a as B}from"./utils-91ecdfd9.js";import{f as $,a as H}from"./findLastIndex-b7f0dff6.js";import"./index-ced963d8.js";import"./format-31cde443.js";import"./core-90944064.js";import"./utils-64e52959.js";import"./createProposal-e1f6da83.js";import"./cloneDeep-793b0cc9.js";import"./InsureInfos-84cc911a.js";import"./index-d68eb918.js";import"./index-e4b4e23c.js";import"./questionnaire-42dcb602.js";import"./util-d26fb81f.js";import"./product-7bbf9c44.js";import"./constants-6ad2f07c.js";const J={class:"long-info-collection"},z=e({name:"InfoCollection"}),G=e({...z,setup(e){const z=a((()=>t((()=>import("./index-5441d24a.js")),["static/js/index-5441d24a.js","static/css/index-fa4edf2a.css","static/js/index-6a9cf46c.js","static/css/index-40e42718.css","static/js/theme-94cf7d00.js","static/js/index-ced963d8.js","static/css/index-bbfdd7ec.css","static/js/utils-64e52959.js","static/js/infoCollection-974452d5.js","static/js/trial-d6373768.js"]))),G=a((()=>t((()=>import("./index-365d6381.js")),["static/js/index-365d6381.js","static/css/index-793d1580.css","static/js/index-6a9cf46c.js","static/css/index-40e42718.css"]))),K=a((()=>t((()=>import("./SelectRiskList-32c731f4.js")),["static/js/SelectRiskList-32c731f4.js","static/css/SelectRiskList-e1e05c2e.css","static/js/index-6a9cf46c.js","static/css/index-40e42718.css","static/js/trial-41b6fd53.js","static/js/trial-d6373768.js"]))),Y=o(),Q=U({}),{productCode:X="",tenantId:Z,agentCode:W="",agencyCode:ee,saleChannelId:ae,isShare:te,orderNo:oe,extraInfo:le,insurerCode:ne,preview:ie}=Y.query;let se={},re=null;const ue=l(2);try{se=JSON.parse(decodeURIComponent(le))}catch(oa){}const de={moduleType:7,subModuleType:null,code:"renewFlag",title:"保证续保型的一年期产品在保证续保期间是否申请续保",planCode:null,displayName:null,defaultValue:null,isHidden:null,isReadOnly:null,isMustInput:1,isExtend:null,regex:null,displayType:6,datasource:null,factorScript:null,isCalculationFactor:2,attributeValueList:[{code:"1",value:"是",defaultFlag:null,useFlag:null},{code:"2",value:"否",defaultFlag:null,useFlag:null}],position:null,remark:""},ce=n({isView:!1,personalInfo:{},payInfo:{schema:[],config:[],formData:[]},policyInfo:{schema:[],config:[],formData:{}},defaultValue:null,isAutoChange:!1,defaultPlanCode:"",userData:{}}),pe=`${window.origin}/baseInsurance/long/phoneVerify${window.location.search}`,ve=l({imgUrl:"",desc:"",title:"",link:pe}),fe=l();l();const me=l(),he=l({}),Ie=l({}),ye=l([]),Le=l(),ge=l({}),Ce=l(!1),Re=l(!1),ke=l(0),Oe=l(!0),{fileList:we,mustReadFileCount:je,popupFileList:Pe}=N(ge,Le),be=l(!1),xe=l(!1),_e=()=>{Re.value=!1,Oe.value=!0,ye.value.length<1||(Ce.value=!0)},Ve=()=>{Ce.value=!1,Re.value=!1,Oe.value=!0};l({}),l(!1),l([{}]);const De=l(""),Ee=l({}),Fe=l(!1);l();const qe=l();l();const Ne=l([]),Te=l(0);l({});const Ue=l(),Ae=()=>{De.value="试算中...",Ee.value=null,Fe.value=!0},Se=(e,a)=>{De.value="",Te.value=e.premium,Ee.value=e,Ue.value=a,Fe.value=!1},Me=l(!1),Be=l(),$e=l({}),He=l({productList:[]}),Je=l({}),ze=l(),Ge=()=>{E(He.value).then((({code:e,data:a})=>{if("10000"===e){const{productDetailResList:e,productFactor:t}=a;He.value=B(e);const o={};e.forEach((e=>{o[e.productCode]=e})),Je.value=o}}))},Ke=()=>{Me.value=!1},Ye=e=>{const a=He.value.productList.find((e=>e.productCode===Be.value)),t=e.map((e=>({riskCode:e,riskType:T.RIDER_RISK,mainRiskCode:$e.value.riskCode}))),o=$(a.mergeRiskReqList,(e=>e.riskCode===$e.value.riskCode)),l=H(a.mergeRiskReqList,(e=>e.mainRiskCode===$e.value.riskCode));let n=o;-1!==l&&(n=l),a.mergeRiskReqList=[...a.mergeRiskReqList.slice(0,n+1),...t,...a.mergeRiskReqList.slice(n+1,a.mergeRiskReqList.length)],me.value.getRiderRiskDefaultValue(Be.value,e,$e.value.riskCode,a.mergeRiskReqList),Ge(),Me.value=!1},Qe=(e,a,t)=>{Me.value=!0,Ne.value=t,$e.value=a,Be.value=e},Xe=(e,a,t)=>{Je.value[e],t?(Je.value[e].productPlanInsureVOList[0].insureProductRiskVOList=Je.value[e].productPlanInsureVOList[0].insureProductRiskVOList.filter((e=>e.riskCode!==a)),He.value.productList=He.value.productList.map((t=>(t.productCode===e&&(t.mergeRiskReqList=t.mergeRiskReqList.filter((e=>e.riskCode!==a))),t)))):(He.value.productList=He.value.productList.filter((a=>a.productCode!==e)),Ge())},Ze=l(!1),We=async()=>{var e,a;if(ie)return void y(L.INFO_COLLECTION,Y.query);if(!Ee.value)return;const t=[];me.value&&t.push(null==(e=me.value)?void 0:e.validate(!1)),fe.value&&t.push(null==(a=fe.value)?void 0:a.validate(!1)),Promise.all(t).then((e=>{Object.assign(Q.value,{extInfo:{...Q.value.extInfo,buttonCode:g.INFO_COLLECTION,pageCode:L.INFO_COLLECTION}});const a=me.value.dealMixData(),t=A({...a,productCode:X,productName:Ie.value.productName},Ee.value,Q.value);Y.query.productClass=`${ue.value}`;const o=(()=>{var e,a;const{holder:t,insuredList:o}=ce.userData,l=[],n=(e,a)=>{e.ocrData&&Object.keys(e.ocrData).find((a=>(e[a]||e.ocrData[a])&&e.ocrData[a]!==e[a]))&&l.push(`${a}信息影像识别与录入信息不一致，请确认`)};return n(t,"投保人"),n(null==o?void 0:o[0],"被保人"),((null==(e=null==o?void 0:o[0])?void 0:e.beneficiaryList)||[]).forEach(((e,a)=>{n(e,`受益人${a+1}`)})),n(null==o?void 0:o[0].guardian,"监护人"),n(null==o?void 0:o[0].guardian,"监护人"),((null==(a=Q.value)?void 0:a.tenantOrderPayInfoList)||[]).forEach((e=>{n(null==o?void 0:o[0].guardian,"银行卡")})),l})();Ze.value=!0,(null==o?void 0:o.length)?C.confirm({message:null==o?void 0:o[0]}).then((()=>{clearInterval(re),q(t,((e,a)=>{Ze.value=!1,a===R.JUMP_PAGE&&k(e.nextPageCode,Y.query)}),Y)})):(clearInterval(re),q(t,((e,a)=>{Ze.value=!1,a===R.JUMP_PAGE&&k(e.nextPageCode,Y.query)}),Y))}),(e=>{O(".long-info-collection",".van-field--error")})).catch((e=>{console.log("e",e)}))},ea=e=>{const a=Q.value.tenantOrderPayInfoList[0];Q.value.tenantOrderPayInfoList.splice(0,1,{...a,...e})},aa=e=>{Object.assign(ce.userData,e)},ta=async()=>{oe&&await D({orderNo:oe,tenantId:Z}).then((({code:e,data:a})=>{var t;if("10000"===e){if((null==(t=a.insuredList)?void 0:t.length)>0){const{planCode:e}=a.insuredList[0];ce.defaultPlanCode=e}Object.assign(Q.value,a,{tenantOrderPayInfoList:a.tenantOrderPayInfoList||[],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0,withPayInfo:!0},productCode:X}),ce.defaultValue=Q.value,He.value=M(a.insuredList[0].productList),ue.value=a.insuredList[0].productList.length>1?1:2,xe.value=!0}})),await E(He.value).then((({data:e,code:a})=>{var t;if("10000"===a){const{productDetailResList:a,productFactor:o}=e,l=(e=>{const a=[];return e.forEach((e=>{var t;const{insureProductRiskVOList:o}=(null==(t=e.productPlanInsureVOList)?void 0:t[0])||{};o.reduce(((e,a)=>{const{riskFixedRuleVO:{guaranteedRenewalFlag:t},riskCode:o}=(null==a?void 0:a.riskDetailResVO)||{};return t===x.YES&&e.push(o),e}),a)})),a})(a);Object.assign(Q.value.extInfo,{renewRisk:l.join(",")}),(null==l?void 0:l.length)&&((null==(t=o[7])?void 0:t.length)?o[7].push(de):o[7]=[de]),ze.value=o;const n={};a.forEach((e=>{n[e.productCode]=e})),Je.value=n;const{payInfo:i,other:s}=j(ze.value);ce.payInfo={...ce.payInfo,...i},ce.policyInfo={...ce.policyInfo,...s}}}))};return i((()=>{ta()})),s((()=>{re=setInterval((()=>{}),3e4),setTimeout((async()=>{qe.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),r((()=>{clearInterval(re)})),(e,a)=>{var t,o,l,n,i,s;const r=P,y=b;return u(),d("div",J,[c(r),p(xe)||p(ie)?(u(),v(S,{key:0,ref_key:"personalInfoRef",ref:me,"product-info":{productCode:p(X),productName:p(Ie).productName,insurerCode:p(ne),tenantId:p(Z),planList:[]},"tenant-product-detail":p(he),"hide-benefit":"","product-collection":p(Je),"default-data":p(Q),"product-factor":p(ze),onTrialStart:Ae,onTrialEnd:Se,"onUpdate:userData":aa,onUpdateBank:ea,onAddRisk:Qe,onDeleteRisk:Xe},{middleInfo:f((()=>[p(ce).payInfo.schema.length?(u(),v(p(_),{key:0,ref_key:"payInfoRef",ref:fe,modelValue:p(Q).tenantOrderPayInfoList,"onUpdate:modelValue":a[0]||(a[0]=e=>p(Q).tenantOrderPayInfoList=e),schema:p(ce).payInfo.schema,"is-view":p(ce).isView,"user-data":p(ce).userData},null,8,["modelValue","schema","is-view","user-data"])):m("",!0),p(ce).policyInfo.schema.length?(u(),v(p(V),{key:1,modelValue:p(Q).extInfo,"onUpdate:modelValue":a[1]||(a[1]=e=>p(Q).extInfo=e),schema:p(ce).policyInfo.schema,"is-view":p(ce).isView},null,8,["modelValue","schema","is-view"])):m("",!0)])),_:1},8,["product-info","tenant-product-detail","product-collection","default-data","product-factor"])):m("",!0),c(y,null,{default:f((()=>{var e;return[(null==(e=p(we))?void 0:e.length)?(u(),v(p(G),{key:0,modelValue:p(be),"onUpdate:modelValue":a[2]||(a[2]=e=>h(be)?be.value=e:null),"has-bg-color":!1,"attachment-list":p(we),"is-show-radio":"","pre-text":"投保人阅读并接受",onPreviewFile:a[3]||(a[3]=e=>(e=>{ke.value=e,Re.value=!0})(e))},null,8,["modelValue","attachment-list"])):m("",!0)]})),_:1}),p(Re)?(u(),v(p(z),{key:1,show:p(Re),"onUpdate:show":a[4]||(a[4]=e=>h(Re)?Re.value=e:null),"content-list":p(Oe)?p(we):p(Pe),"is-only-view":p(Oe),"active-index":p(ke),text:p(Oe)?"关闭":"我已逐页阅读并确认告知内容","force-read-count":p(Oe)?0:p(je),onSubmit:_e,onOnCloseFilePreviewByMask:Ve},null,8,["show","content-list","is-only-view","active-index","text","force-read-count"])):m("",!0),c(F,{"is-share":p(ve).isShare&&!p(te),premium:null==(t=p(Ee))?void 0:t.initialPremium,"share-info":p(ve),"loading-text":p(De),"payment-frequency":(null==(s=null==(i=null==(n=null==(l=null==(o=p(Ue))?void 0:o.insuredList)?void 0:l[0].productList)?void 0:n[0].riskList)?void 0:i[0])?void 0:s.paymentFrequency)+"","tenant-product-detail":p(he),"handle-share":e=>(e=>{me.value.validateHolder(["mobile"]).then((()=>{Object.assign(Q.value,{extInfo:{...Q.value.extInfo,buttonCode:g.INFO_COLLECTION,pageCode:L.INFO_COLLECTION}});const a=me.value.getUserData(),t=A({...Ue.value,holder:null==a?void 0:a.holder},Ee.value||{},Q.value);q(t,((a,t)=>{t===R.JUMP_PAGE&&(null==e||e())}),Y)})).catch((()=>{w("请录入投保人手机号后进行分享")}))})(e),disabled:!p(Ee)||p(Ze),onHandleClick:We},{label:f((()=>[I(" 首年总保费 ")])),default:f((()=>[I("下一步 ")])),_:1},8,["is-share","premium","share-info","loading-text","payment-frequency","tenant-product-detail","handle-share","disabled"]),p(Me)?(u(),v(p(K),{key:2,type:p(T).RIDER_RISK,"product-class":p(ue),show:p(Me),"insured-list":p(Ne),title:"添加附加险","current-product-code":p(Be),"main-risk-code":p($e).riskCode,"select-list":p(He).productList,onCancel:Ke,onConfirm:Ye},null,8,["type","product-class","show","insured-list","current-product-code","main-risk-code","select-list"])):m("",!0)])}}});export{G as default};
