import{d as e,ay as a,az as t,i as o,j as l,r as n,k as i,bU as s,aR as u,l as r,bV as d,o as c,c as v,b as p,u as f,p as m,ak as I,w as h,f as g,q as y,v as C,aY as L,aQ as k,T as O,aP as R,aX as b,aZ as w,aD as j,bW as P,ap as x,bv as _,aE as V,aA as E,bX as D,aB as N}from"./index-293602cf.js";import{P as F,a as q}from"./PolicyInfo-6a2174e8.js";import{s as T,g as U,m as S}from"./trial-c3c4be9e.js";import{_ as A}from"./TrialButton-cabb826e.js";import{n as B}from"./nextStep-5576d441.js";import{u as M}from"./useAttachment-7548f2aa.js";import"./infoCollection-bd0a09c9.js";import{R as $}from"./trial-cf0e0910.js";import{u as H}from"./useOrder-4d47ea77.js";import{t as J}from"./utils-7df7eba7.js";import z from"./index-75f50708.js";import{p as G,a as K}from"./utils-73e43db6.js";import{f as X,a as Y}from"./findLastIndex-2b487b0c.js";import"./index-33a7b2a3.js";import"./format-31cde443.js";import"./core-29806fcd.js";import"./utils-27637540.js";import"./createProposal-57f15fed.js";import"./InsureInfos-9cd3e9ad.js";import"./index-34095ef2.js";import"./index-b009e548.js";import"./questionnaire-42dcb602.js";import"./util-6a44db2a.js";import"./product-7bbf9c44.js";import"./constants-6ad2f07c.js";const Q={class:"long-info-collection"},W=e({name:"InfoCollection"}),Z=e({...W,setup(e){const W=a((()=>t((()=>import("./index-737d81fa.js")),["static/js/index-737d81fa.js","static/css/index-fa4edf2a.css","static/js/index-293602cf.js","static/css/index-efad381f.css","static/js/theme-94cf7d00.js","static/js/index-33a7b2a3.js","static/css/index-bbfdd7ec.css","static/js/utils-27637540.js","static/js/infoCollection-bd0a09c9.js","static/js/trial-cf0e0910.js"]))),Z=a((()=>t((()=>import("./index-e1467c3d.js")),["static/js/index-e1467c3d.js","static/css/index-4822eb94.css","static/js/index-293602cf.js","static/css/index-efad381f.css"]))),ee=a((()=>t((()=>import("./SelectRiskList-62bc2aa9.js")),["static/js/SelectRiskList-62bc2aa9.js","static/css/SelectRiskList-e1e05c2e.css","static/js/index-293602cf.js","static/css/index-efad381f.css","static/js/trial-c3c4be9e.js","static/js/trial-cf0e0910.js"]))),ae=o(),te=H({}),oe=l(!0),{productCode:le="",tenantId:ne,agentCode:ie="",agencyCode:se,saleChannelId:ue,isShare:re,orderNo:de,extraInfo:ce,insurerCode:ve,preview:pe}=ae.query;let fe={};const me=null,Ie=l(2);try{fe=JSON.parse(decodeURIComponent(ce))}catch(fa){}const he={moduleType:7,subModuleType:null,code:"renewFlag",title:"保证续保型的一年期产品在保证续保期间是否申请续保",planCode:null,displayName:null,defaultValue:null,isHidden:null,isReadOnly:null,isMustInput:1,isExtend:null,regex:null,displayType:6,datasource:null,factorScript:null,isCalculationFactor:2,attributeValueList:[{code:"1",value:"是",defaultFlag:null,useFlag:null},{code:"2",value:"否",defaultFlag:null,useFlag:null}],position:null,remark:""},ge=n({isView:!1,personalInfo:{},payInfo:{schema:[],config:[],formData:[]},policyInfo:{schema:[],config:[],formData:{}},defaultValue:null,isAutoChange:!1,defaultPlanCode:"",userData:{},solvency:""}),ye=`${window.origin}/baseInsurance/long/phoneVerify${window.location.search}`,Ce=l({imgUrl:"",desc:"",title:"",link:ye}),Le=l(),ke=l();l();const Oe=l(),Re=l({}),be=l({}),we=l([]),je=l(),Pe=l({}),xe=l(!1),_e=l(!1),Ve=l(0),Ee=l(!0),{fileList:De,mustReadFileCount:Ne,popupFileList:Fe}=M(Pe,je);l(!1);const qe=l(!1),Te=l(!1),Ue=()=>{_e.value=!1,Ee.value=!0,we.value.length<1||(xe.value=!0)},Se=()=>{xe.value=!1,_e.value=!1,Ee.value=!0};l({}),l(!1),l([{}]);const Ae=l(""),Be=l({}),Me=l(!1);l();const $e=l();l();const He=l([]),Je=l(0);l({});const ze=l(),Ge=()=>{Ae.value="试算中...",Be.value=null,Me.value=!0},Ke=(e,a)=>{Ae.value="",Je.value=e.premium,Be.value=e,ze.value=a,Me.value=!1},Xe=l(!1),Ye=l(),Qe=l({}),We=l({productList:[]}),Ze=l({}),ea=l(),aa=(e,a)=>{var t;const o=[],l=a;return e.forEach((e=>{var a;const{insureProductRiskVOList:t}=(null==(a=e.productPlanInsureVOList)?void 0:a[0])||{};t.reduce(((e,a)=>{const{riskFixedRuleVO:{guaranteedRenewalFlag:t},riskCode:o}=(null==a?void 0:a.riskDetailResVO)||{};return t===N.YES&&e.push(o),e}),o)})),Object.assign(te.value.extInfo,{renewRisk:o.join(",")}),(null==o?void 0:o.length)?(null==(t=l[7])?void 0:t.length)?l[7].push(he):l[7]=[he]:l[7]=(l[7]||[]).filter((e=>e.code!==he.code)),l},ta=i((()=>{const e=ea.value[5]||[];return Boolean(e.find((e=>"solvency"===e.code)))})),oa=()=>{S(We.value).then((({code:e,data:a})=>{if("10000"===e){const{productDetailResList:e,productFactor:t}=a;We.value=K(e),ea.value=aa(e,t);const{other:o}=_(ea.value);ge.policyInfo=o;const l={};e.forEach((e=>{l[e.productCode]=e})),Ze.value=l}}))},la=()=>{Xe.value=!1},na=e=>{const a=We.value.productList.find((e=>e.productCode===Ye.value)),t=e.map((e=>({riskCode:e,riskType:$.RIDER_RISK,mainRiskCode:Qe.value.riskCode}))),o=X(a.mergeRiskReqList,(e=>e.riskCode===Qe.value.riskCode)),l=Y(a.mergeRiskReqList,(e=>e.mainRiskCode===Qe.value.riskCode));let n=o;-1!==l&&(n=l),a.mergeRiskReqList=[...a.mergeRiskReqList.slice(0,n+1),...t,...a.mergeRiskReqList.slice(n+1,a.mergeRiskReqList.length)],Oe.value.getRiderRiskDefaultValue(Ye.value,e,Qe.value.riskCode,a.mergeRiskReqList),oa(),Xe.value=!1},ia=(e,a,t)=>{Xe.value=!0,He.value=t,Qe.value=a,Ye.value=e},sa=(e,a,t)=>{Ze.value[e],t?(Ze.value[e].productPlanInsureVOList[0].insureProductRiskVOList=Ze.value[e].productPlanInsureVOList[0].insureProductRiskVOList.filter((e=>e.riskCode!==a)),We.value.productList=We.value.productList.map((t=>(t.productCode===e&&(t.mergeRiskReqList=t.mergeRiskReqList.filter((e=>e.riskCode!==a))),t)))):(We.value.productList=We.value.productList.filter((a=>a.productCode!==e)),oa())},ua=l(!1),ra=async()=>{var e,a,t;if(pe)return void L(k.INFO_COLLECTION,ae.query);if(!Be.value)return;const o=[];Oe.value&&o.push(null==(e=Oe.value)?void 0:e.validate(!1)),Le.value&&o.push(null==(a=Le.value)?void 0:a.validate(!1)),ke.value&&o.push(null==(t=ke.value)?void 0:t.validate(!1)),Promise.all(o).then((e=>{if(ta.value&&!qe.value)return void O("请阅读并勾选特别约定");Object.assign(te.value,{extInfo:{...te.value.extInfo,buttonCode:R.INFO_COLLECTION,pageCode:k.INFO_COLLECTION,specNoticeFlag:qe.value?1:2}});const a=Oe.value.dealMixData(),t=J({...a,productCode:le,productName:be.value.productName},Be.value,te.value);ae.query.productClass=`${Ie.value}`,delete ae.query.canBack;const o=(()=>{var e,a;const{holder:t,insuredList:o}=ge.userData,l=[],n=(e,a)=>{e.ocrData&&Object.keys(e.ocrData).find((a=>(e[a]||e.ocrData[a])&&e.ocrData[a]!==e[a]))&&l.push(`${a}信息影像识别与录入信息不一致，请确认`)};return n(t,"投保人"),n(null==o?void 0:o[0],"被保险人"),((null==(e=null==o?void 0:o[0])?void 0:e.beneficiaryList)||[]).forEach(((e,a)=>{n(e,`受益人${a+1}`)})),n(null==o?void 0:o[0].guardian,"监护人"),n(null==o?void 0:o[0].guardian,"监护人"),((null==(a=te.value)?void 0:a.tenantOrderPayInfoList)||[]).forEach((e=>{n(null==o?void 0:o[0].guardian,"银行卡")})),l})();ua.value=!0,(null==o?void 0:o.length)?b.confirm({message:null==o?void 0:o[0]}).then((()=>{clearInterval(me),O.loading({duration:0,message:"自核中..."}),B(t,((e,a)=>{ua.value=!1,O.clear(),a===w.JUMP_PAGE&&j(e.nextPageCode,ae.query)}),ae,!1)})):(clearInterval(me),O.loading({duration:0,message:"自核中..."}),B(t,((e,a)=>{ua.value=!1,O.clear(),a===w.JUMP_PAGE&&j(e.nextPageCode,ae.query)}),ae,!1))}),(e=>{P(".long-info-collection",".van-field--error")})).catch((e=>{console.log("e",e)}))},da=e=>{const a=te.value.tenantOrderPayInfoList[0];te.value.tenantOrderPayInfoList.splice(0,1,{...a,...e})},ca=e=>{Object.assign(ge.userData,e)},va=l(),pa=(e=!0)=>{var a,t;Object.assign(te.value,{extInfo:{...te.value.extInfo,buttonCode:R.INFO_COLLECTION,pageCode:k.INFO_COLLECTION}});const o=null==(t=null==(a=Oe.value)?void 0:a.dealMixData)?void 0:t.call(a),l=J({...o,productCode:le,productName:be.value.productName},Be.value,te.value);l.orderStatus="collectInfo",T(l).then((({code:a,data:t})=>{"10000"===a&&e&&O("暂存成功")}))};s("handleCache",pa);return u((()=>{(async()=>{O.loading("加载中..."),de&&await U({orderNo:de,tenantId:ne}).then((({code:e,data:a})=>{var t;if("10000"===e){if((null==(t=a.insuredList)?void 0:t.length)>0){const{planCode:e}=a.insuredList[0];ge.defaultPlanCode=e}Object.assign(te.value,a,{tenantOrderPayInfoList:a.tenantOrderPayInfoList||[],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0,withPayInfo:!0},productCode:le}),va.value=x(te.value),ge.defaultValue=te.value,We.value=G(a.insuredList[0].productList),Ie.value=a.insuredList[0].productList.length>1?1:2,Te.value=!0}})),await S(We.value).then((({data:e,code:a})=>{if("10000"===a){const{productDetailResList:a,productFactor:t,solvency:o}=e;ea.value=aa(a,t);const l={};a.forEach((e=>{l[e.productCode]=e})),Ze.value=l;const{payInfo:n,other:i}=_(ea.value);ge.payInfo={...ge.payInfo,...n},ge.solvency=o,ge.policyInfo={...ge.policyInfo,...i},setTimeout((()=>{oe.value=!1}),500)}}))})()})),r((()=>{setTimeout((async()=>{$e.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),d((()=>{clearInterval(me)})),(e,a)=>{var t,o,l,n,i,s;const u=V,r=E,d=D;return c(),v("div",Q,[p(u),f(Te)||f(pe)?(c(),m(z,{key:0,ref_key:"personalInfoRef",ref:Oe,"product-info":{productCode:f(le),productName:f(be).productName,insurerCode:f(ve),tenantId:f(ne),planList:[]},"tenant-product-detail":f(Re),"hide-benefit":"","product-collection":f(Ze),"default-data":f(te),"product-factor":f(ea),"page-loading":f(oe),onTrialStart:Ge,onTrialEnd:Ke,"onUpdate:userData":ca,onUpdateBank:da,onAddRisk:ia,onDeleteRisk:sa},I({_:2},[f(oe)?void 0:{name:"middleInfo",fn:h((()=>[f(ge).payInfo.schema.length?(c(),m(f(F),{key:0,ref_key:"payInfoRef",ref:Le,modelValue:f(te).tenantOrderPayInfoList,"onUpdate:modelValue":a[0]||(a[0]=e=>f(te).tenantOrderPayInfoList=e),schema:f(ge).payInfo.schema,"is-view":f(ge).isView,"user-data":f(ge).userData},null,8,["modelValue","schema","is-view","user-data"])):g("",!0),f(ge).policyInfo.schema.length?(c(),m(f(q),{key:1,ref_key:"policyInfoRef",ref:ke,modelValue:f(te).extInfo,"onUpdate:modelValue":a[1]||(a[1]=e=>f(te).extInfo=e),schema:f(ge).policyInfo.schema,"is-view":f(ge).isView},null,8,["modelValue","schema","is-view"])):g("",!0)])),key:"0"}]),1032,["product-info","tenant-product-detail","product-collection","default-data","product-factor","page-loading"])):g("",!0),p(r,null,{default:h((()=>[!f(oe)&&f(ta)?(c(),m(f(Z),{key:0,modelValue:f(qe),"onUpdate:modelValue":a[2]||(a[2]=e=>y(qe)?qe.value=e:null),class:"special-tips","has-bg-color":!1,"attachment-list":f(De),"is-show-radio":"","pre-text":`本人已认真阅读下面的特别约定${f(ge).solvency}`,onPreviewFile:a[3]||(a[3]=e=>(e=>{Ve.value=e,_e.value=!0})(e))},null,8,["modelValue","attachment-list","pre-text"])):g("",!0)])),_:1}),f(_e)?(c(),m(f(W),{key:1,show:f(_e),"onUpdate:show":a[4]||(a[4]=e=>y(_e)?_e.value=e:null),"content-list":f(Ee)?f(De):f(Fe),"is-only-view":f(Ee),"active-index":f(Ve),text:f(Ee)?"关闭":"我已逐页阅读并确认告知内容","force-read-count":f(Ee)?0:f(Ne),onSubmit:Ue,onOnCloseFilePreviewByMask:Se},null,8,["show","content-list","is-only-view","active-index","text","force-read-count"])):g("",!0),p(A,{"is-share":f(Ce).isShare&&!f(re),premium:null==(t=f(Be))?void 0:t.initialPremium,"share-info":f(Ce),"loading-text":f(Ae),"payment-frequency":(null==(s=null==(i=null==(n=null==(l=null==(o=f(ze))?void 0:o.insuredList)?void 0:l[0].productList)?void 0:n[0].riskList)?void 0:i[0])?void 0:s.paymentFrequency)+"","tenant-product-detail":f(Re),"handle-share":e=>(e=>{Oe.value.validateHolder(["mobile"]).then((()=>{Object.assign(te.value,{extInfo:{...te.value.extInfo,buttonCode:R.INFO_COLLECTION,pageCode:k.INFO_COLLECTION}});const a=Oe.value.getUserData(),t=J({...ze.value,holder:null==a?void 0:a.holder},Be.value||{},te.value);B(t,((a,t)=>{t===w.JUMP_PAGE&&(null==e||e())}),ae)})).catch((()=>{O("请录入投保人手机号后进行分享")}))})(e),disabled:!f(Be)||f(ua)||f(oe),onHandleClick:ra},{label:h((()=>[C(" 首年总保费 ")])),default:h((()=>[C("下一步 ")])),_:1},8,["is-share","premium","share-info","loading-text","payment-frequency","tenant-product-detail","handle-share","disabled"]),f(Xe)?(c(),m(f(ee),{key:2,type:f($).RIDER_RISK,"product-class":f(Ie),show:f(Xe),"insured-list":f(He),title:"添加附加险","current-product-code":f(Ye),"main-risk-code":f(Qe).riskCode,"select-list":f(We).productList,onCancel:la,onConfirm:na},null,8,["type","product-class","show","insured-list","current-product-code","main-risk-code","select-list"])):g("",!0),p(d,{"button-image":f("/static/png/cache_icon-a458a0d2.png"),onClick:pa},null,8,["button-image"])])}}});export{Z as default};
