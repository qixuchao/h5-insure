var $e=Object.defineProperty,Ke=Object.defineProperties;var qe=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var Ge=Object.prototype.hasOwnProperty,We=Object.prototype.propertyIsEnumerable;var re=(N,v,y)=>v in N?$e(N,v,{enumerable:!0,configurable:!0,writable:!0,value:y}):N[v]=y,f=(N,v)=>{for(var y in v||(v={}))Ge.call(v,y)&&re(N,y,v[y]);if(oe)for(var y of oe(v))We.call(v,y)&&re(N,y,v[y]);return N},h=(N,v)=>Ke(N,qe(v));import{g as je,a9 as ze,O as Je,E,M as ne,y as se,_ as Qe,l as Xe,h as Ze,r as ue,j as le,n as ea,p as _,m as W,z as U,A as I,J as ie,C as Ie,k as aa,t as ta,F as oa,T as ce}from"./vendor-17026bfd.js";import{_ as ra,C as de,$ as na,G as me,a1 as pe}from"./index-6b38e96c.js";import{a as b}from"./order-c0ced472.js";import{S as P,R as fe,i as sa,h as ua}from"./infoCollection-8fbe54c6.js";import{p as he,i as la,s as ia,g as ca,a as da,u as ma,b as pa}from"./trial-4aeeafbc.js";import{p as fa}from"./product-2f52f3a1.js";import{d as ve,B as ha,D as va,G as Da,S as ya,H as ga,P as Fa,U as Ca,_ as Ea,W as Ia,v as _a,a as De,c as R,f as ye,o as ge,b as V,n as Fe,h as Ce}from"./auth-4a403920.js";import{_ as Na,g as Ee,o as wa,t as Ta,a as ba}from"./index-8e494103.js";import{t as Aa}from"./theme-ea709837.js";import"./utils-b6782348.js";import"./index-d292ea95.js";import"./bankCard-b9d5732e.js";import"./trial-688c6c48.js";const Pa={class:"page-internet-product-detail"},Oa={class:"info"},Sa={class:"footer-button"},ka={class:"price"},Ba=Ie(" \u603B\u4FDD\u8D39"),Ua=je({setup(N){const v=ze(),y=Je(),{productCode:M="BWYL2021",tenantId:F,orderNo:O,phoneNo:L,agentCode:H="",saleChannelId:_e,paymentMethod:g,certNo:j,name:z,pageCode:S,from:J}=y.query,Y=E(),d=E(),k=E(),A=E(),B=S==="payBack",Q=E(!1),x=E(!1),$=E(!1),X=E(0),K=E(!1),q=E(!1);let G="";const n=ne({holder:{certNo:j,certType:de.CERT,mobile:L,name:z,socialFlag:P.HAS},insured:{certNo:j,certType:de.CERT,name:z,socialFlag:P.HAS,relationToHolder:fe.SELF},paymentMethod:g,renewalDK:"Y",paymentFrequency:sa.YEAR,packageProductList:[],mobileSmsCode:""}),w=E(ve),C=E(ve),s=ne({showInsure:!B,canInsure:!1,canUpgrade:!1}),Ne=se(()=>{var a,t;return((t=(a=d.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(e=>e.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),we=se(()=>{var a,t;return((t=(a=d.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(e=>e.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),Te=()=>{const{holder:{certNo:a,mobile:t,name:e,socialFlag:r},insured:{certNo:o,name:l,socialFlag:c,relationToHolder:i},paymentMethod:m}=n,p=me(a)&&_a(t)&&De(e)&&!!r,u=me(o)&&De(l)&&!!c&&!!i;return!!(p&&u&&!!m)},Z=()=>{v.push({path:"/internet/guaranteeUpgrade",query:h(f({},y.query),{tenantId:F,productCode:"BWYL2022",orderNo:O,agentCode:H})})},be=()=>{q.value=!1},Ae=()=>{C.value=w.value},Pe=()=>{C.value=h(f({},C.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},Oe=async a=>{ce.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const t=await ma(a),{code:e}=t;if(e==="10000"){ce.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const r=await pa({orderNo:a.orderNo,tenantId:F}),{data:o}=r;e==="10000"&&(window.location.href=o)}s.canInsure=!0}catch{s.canInsure=!0}},Se=a=>`${pe}/internet/productDetail?tenantId=${F}&productCode=${M}&orderNo=${a}&agentCode=${H}&pageCode=payBack&from=${J||"normal"}`,ke=a=>`${pe}/internet/payFail?tenantId=${F}&orderNo=${a}&agentCode=${H}&pageCode=payBack&from=${J||"normal"}`,Be=async a=>{const t=ba({tenantId:F,saleUserId:H,saleChannelId:_e,detail:d.value,insureDetail:k.value,paymentMethod:n.paymentMethod,renewalDK:n.renewalDK,iseeBizNo:G,successJumpUrl:"",premium:A.value,holder:n.holder,insured:n.insured,tenantOrderRiskList:a,orderStatus:"",orderTopStatus:""});try{const e=await ia(t),{code:r,data:o}=e;r==="10000"&&Oe(h(f({},t),{orderNo:o.data,extInfo:{extraInfo:{renewalDK:n.renewalDK,paymentMethod:n.paymentMethod,successJumpUrl:Se(o.data),failUrl:ke(o.data)},iseeBizNo:G}}))}catch{s.canInsure=!0}},Ue=async()=>{console.log("trialData",n);const{calcData:a,riskVOList:t}=Ee({holder:n.holder,insured:n.insured,paymentFrequency:n.paymentFrequency,tenantId:F,productDetail:d.value,insureDetail:k.value,packageRiskIdList:wa(n.packageProductList)}),e=await he(a),{code:r,data:o}=e;return r==="10000"?(A.value=o.premium,{condition:t,data:o}):{}},Me=a=>{X.value=a,$.value=!0},Le=()=>new Promise((a,t)=>{var e,r;(r=(e=Y.value)==null?void 0:e.validateForm)==null||r.call(e).then(async()=>{var u;if(!(((u=Y.value)==null?void 0:u.isAgreeFile)||Q.value)){x.value=!0;return}const{calcData:l,riskVOList:c}=Ee({holder:n.holder,insured:n.insured,tenantId:F,productDetail:d.value,insureDetail:k.value}),i=await he(l),{code:m,data:p}=i;m==="10000"?(A.value=p.premium,a({condition:c,data:p})):t(new Error)}).catch(()=>{s.canInsure=!0})}),ee=async()=>{var a;if(B){Z();return}s.canInsure=!1;try{const{condition:t,data:e}=await Le(),r={},o=(c=[])=>{(c||[]).forEach(i=>{var m;r[i.riskCode]=i,((m=i.riskPremiumDetailVOList)==null?void 0:m.length)&&o(i.riskPremiumDetailVOList)})};o(e.riskPremiumDetailVOList);const l=Ta({tenantId:F,riskList:t,riskPremium:r,productId:(a=d.value)==null?void 0:a.id});Be(l)}catch{s.canInsure=!0}},He=a=>{a==="allFalse"&&(x.value=!1,Me(0)),s.canInsure=!0},xe=()=>{Q.value=!0,ee()};Qe(()=>n,Xe.exports.debounce(()=>{d.value&&k.value&&S!=="payBack"&&Te()&&Ue()},500),{deep:!0,immediate:!0});const ae=async()=>{var r,o,l,c,i,m,p,u;const a=await ca({orderNo:O,tenantId:F}),{code:t,data:e}=a;if(t==="10000"){const{tenantOrderHolder:D,tenantOrderInsuredList:T,extInfo:te}=e;if(!B){Object.assign(n,{holder:{certNo:D.certNo,certType:D.certType,mobile:D.mobile,name:D.name,socialFlag:P.HAS},insured:{certNo:D.certNo,certType:D.certType,name:D.name,socialFlag:P.HAS,relationToHolder:fe.SELF},paymentMethod:g,renewalDK:"Y"}),s.canInsure=!0,C.value=Fe,w.value=Fe;return}Object.assign(n,{holder:{certNo:D.certNo,certType:D.certType,mobile:D.mobile,name:D.name,socialFlag:P.HAS},insured:{certNo:T==null?void 0:T[0].certNo,certType:(r=T[0])==null?void 0:r.certType,name:(o=T[0])==null?void 0:o.name,socialFlag:(c=(l=T[0])==null?void 0:l.extInfo)==null?void 0:c.hasSocialInsurance,relationToHolder:(i=T[0])==null?void 0:i.relationToHolder},paymentMethod:te.extraInfo.paymentMethod,renewalDK:te.extraInfo.renewalDK||"N"}),A.value=(u=(p=(m=T[0])==null?void 0:m.tenantOrderProductList)==null?void 0:p[0])==null?void 0:u.premium,(e.orderStatus===b.ACCEPT_POLICY||e.orderStatus===b.PAYMENT_SUCCESS)&&(s.canUpgrade=!0,K.value=!1,q.value=!0),e.orderStatus===b.PAYING&&(K.value=!0,setTimeout(()=>{ae()},3*1e3))}},Re=async()=>{var r,o,l,c,i,m;console.log("\u77ED\u4FE1\u8FDB\u5165\uFF0C\u5E26\u4E86orderNo, mobile");const a=await da({holderPhone:L,orderStatus:[b.PAYING.toUpperCase(),b.TIMEOUT.toUpperCase(),"ACCEPT_POLICY"],productCode:M,tenantId:F}),{code:t,data:e}=a;if(e.orderStatus===b.ACCEPT_POLICY&&(console.log("\u5DF2\u627F\u4FDD\uFF0C\u88AB\u4FDD\u4EBA\u4FE1\u606F\u4E0D\u80FD\u4FEE\u6539"),C.value=h(f({},Ce),{paymentDisable:!!g}),w.value=h(f({},Ce),{paymentDisable:!!g})),(e.orderStatus===b.PAYING||e.orderStatus===b.TIMEOUT)&&(console.log("\u652F\u4ED8\u4E2D\uFF0C\u8D85\u65F6\u53EF\u4EE5\u4FEE\u6539\u6295\u4FDD\u4EBA\u4FE1\u606F"),C.value=h(f({},V),{paymentDisable:!!g}),w.value=h(f({},V),{paymentDisable:!!g})),t==="10000"&&((r=e==null?void 0:e.tenantOrderHolder)==null?void 0:r.certNo)){s.canInsure=!0;const{tenantOrderHolder:p,tenantOrderInsuredList:u,extInfo:D}=e;Object.assign(n,{holder:{certNo:p.certNo,certType:p.certType,mobile:p.mobile,name:p.name,socialFlag:P.HAS},insured:{certNo:u==null?void 0:u[0].certNo,certType:(o=u[0])==null?void 0:o.certType,name:(l=u[0])==null?void 0:l.name,socialFlag:(i=(c=u[0])==null?void 0:c.extInfo)==null?void 0:i.hasSocialInsurance,relationToHolder:(m=u[0])==null?void 0:m.relationToHolder},paymentMethod:g||D.extraInfo.paymentMethod,renewalDK:D.extraInfo.renewalDK})}else C.value=h(f({},R),{paymentDisable:!!g}),w.value=h(f({},R),{paymentDisable:!!g}),s.canInsure=!0},Ve=async()=>{const a=fa({productCode:M,withInsureInfo:!0,tenantId:F}),t=la({productCode:M});await Promise.all([a,t]).then(([e,r])=>{var o,l;e.code==="10000"&&(d.value=e.data,document.title=((o=e.data)==null?void 0:o.productFullName)||""),r.code==="10000"&&(n.packageProductList=(((l=r.data)==null?void 0:l.packageProductVOList)||[]).map(c=>h(f({},c),{value:ua.UN_INSURE})),k.value=r.data)}),O?ae():L&&S==="productDetail"&&Re()},Ye=()=>{S==="free"?B?(C.value=h(f({},ye),{paymentDisable:!!g}),w.value=h(f({},ye),{paymentDisable:!!g}),s.canInsure=!0):(C.value=h(f({},R),{paymentDisable:!!g}),w.value=h(f({},R),{paymentDisable:!!g}),s.canInsure=!0):B?(C.value=ge,w.value=ge,console.log("\u652F\u4ED8\u5B8C\u6210\u8FDB\u5165")):L||O||(console.log("\u6295\u4FDD\u94FE\u63A5"),C.value=V,w.value=V,s.canInsure=!0)};return Ze(()=>{Ye(),Ve(),setTimeout(async()=>{G=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(a,t)=>{const e=ue("van-button"),r=ue("van-config-provider");return le(),ea(oa,null,[_(r,{"theme-vars":I(Aa)},{default:W(()=>{var o,l,c,i,m,p,u;return[U("div",Pa,[U("div",Oa,[_(ha,{url:(l=(o=d.value)==null?void 0:o.tenantProductInsureVO)==null?void 0:l.banner[0]},null,8,["url"]),_(va,{"product-name":(c=d.value)==null?void 0:c.productFullName,"product-desc":(m=(i=d.value)==null?void 0:i.showConfigVO)==null?void 0:m.desc},null,8,["product-name","product-desc"])]),_(Da,{"guarantee-list":(u=(p=d.value)==null?void 0:p.tenantProductInsureVO)==null?void 0:u.titleAndDescVOS},null,8,["guarantee-list"]),_(ya,{detail:d.value},{form:W(()=>[_(ga,{ref_key:"formRef",ref:Y,"is-show-package":"",disable:!I(s).showInsure,"form-auth":C.value,"form-info":I(n),premium:A.value,"product-detail":d.value,onOnReset:Ae,onOnUpdate:Pe},null,8,["disable","form-auth","form-info","premium","product-detail"])]),_:1},8,["detail"]),U("div",Sa,[U("div",ka,[Ba,U("span",null,"\uFFE5"+ie(I(na)(A.value))+"/\u6708",1)]),_(e,{type:"primary",class:"right",disabled:!(I(s).canInsure||I(s).canUpgrade),onClick:ee},{default:W(()=>[Ie(ie(I(s).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),I(S)!=="payBack"?(le(),aa(Fa,{key:0,"product-detail":d.value},null,8,["product-detail"])):ta("",!0),_(Ca,{"order-no":I(O),"tenant-id":I(F),"is-show":q.value,onOnConfirm:Z,onOnClose:be},null,8,["order-no","tenant-id","is-show"])]}),_:1},8,["theme-vars"]),_(Ea,{show:x.value,"onUpdate:show":t[0]||(t[0]=o=>x.value=o),"content-list":I(Ne),"active-index":0,onOnConfirmHealth:He},null,8,["show","content-list"]),_(Na,{show:$.value,"onUpdate:show":t[1]||(t[1]=o=>$.value=o),"content-list":I(we),"active-index":X.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9",onSubmit:xe},null,8,["show","content-list","active-index"]),_(Ia,{"is-show":K.value},null,8,["is-show"])],64)}}});var Ja=ra(Ua,[["__scopeId","data-v-0f8f0574"]]);export{Ja as default};
