var X=Object.defineProperty,G=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var j=(r,l,s)=>l in r?X(r,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[l]=s,m=(r,l)=>{for(var s in l||(l={}))W.call(l,s)&&j(r,s,l[s]);if(x)for(var s of x(l))Z.call(l,s)&&j(r,s,l[s]);return r},y=(r,l)=>G(r,Q(l));import{a as ee,g as te,E as h,M as se,a3 as M,y as oe,X as v,o as ae,r as V,j as I,n as L,p as f,m as b,z as D,A as c,k as re,t as O,a1 as ie,a2 as ne,C as ue}from"./vendor-c15a8cf7.js";import{P as $,R as le,i as ce,p as de}from"./trial-1340f610.js";import{g as pe}from"./index-a8c79304.js";import{_ as fe}from"./index-65b1952c.js";const be=ee({id:"createProposal",state:()=>({proposalInfo:{},trialData:[],excludeProduct:[],proposalId:0}),actions:{setProposalInfo(r){this.$state.proposalInfo=r},setTrialData(r){this.$state.trialData=r},setExcludeProduct(r){this.$state.excludeProduct=r}}});const me=r=>(ie("data-v-4f8eda3b"),r=r(),ne(),r),ke={class:"com-product-risk-wrapper"},ge={class:"popup-container"},he=me(()=>D("div",{class:"popup-title"},"\u8BF7\u9009\u62E9\u4FDD\u969C\u65B9\u6848",-1)),_e={class:"risk-trial-wrapper"},ve={key:0,class:"part-card"},Re={key:1,class:"part-card"},Pe={class:"risk-content"},Ve={key:0,class:"risk"},Ie={class:"footer-bar"},De=ue("\u786E\u8BA4"),ye=te({props:{isShow:{type:Boolean,default:!1},type:{default:"add"},productId:{default:0},riskType:{default:1},formInfo:{default:{}},productData:{default:()=>({})},holder:{default:()=>({})},insured:{default:()=>({})},riderRisk:{default:()=>[]},currentRisk:{default:()=>[]}},emits:["close","finished"],setup(r,{emit:l}){const s=r,B=h({personVO:m({},s.holder)}),C=h({insuredCode:"",personVO:m({},s.insured)}),R=h({}),A=h({}),_=h({}),S=h({}),T=h({}),e=se({currentPlan:"0",isShow:s.isShow,riskBaseInfo:{},holderFactor:[],insuredFactor:[],riskData:[],riskPlanData:[],trialResult:{},canTrial:!0,retrialTip:!1,enumList:{},ageRange:[],collapseName:["1"],type:s.type});M("premium",T.value),M("source",{type:e.type,origin:"proposal",showRiskList:s.currentRisk});const w=oe(()=>{var o;let t="";if((o=e.riskData)==null?void 0:o[0]){const a=e.riskData[0],i=((a==null?void 0:a.requiredRiderRiskVOList)||[]).map(n=>n.riskName);i.length&&(t=`\u7279\u6B8A\u63D0\u793A: ${a.riskName}\u548C${i.join("\u3001")}\u5FC5\u987B\u540C\u65F6\u6295\u4FDD`)}return t}),q=(t,o)=>{var n,p,u,d,k,g,P,E,N;const a=(t.insuredVOList[0].productPlanVOList[0].riskVOList||[]).map(F=>y(m({},F),{premium:o[F.riskCode].premium,amount:o[F.riskCode].amount}));return{proposalHolder:m({},(n=t.holder)==null?void 0:n.personVO),proposalInsuredList:[y(m({},t.insuredVOList[0].personVO),{dateRange:{min:(u=(p=_.value)==null?void 0:p.ageRangeObj)==null?void 0:u.minAge,max:(k=(d=_.value)==null?void 0:d.ageRangeObj)==null?void 0:k.maxAge},proposalInsuredProductList:[{productId:e.riskBaseInfo.id,productName:e.riskBaseInfo.productName,dateRange:{min:(P=(g=_.value)==null?void 0:g.ageRangeObj)==null?void 0:P.minAge,max:(N=(E=_.value)==null?void 0:E.ageRangeObj)==null?void 0:N.maxAge},proposalProductRiskList:a}]})]}},J=()=>{const t=JSON.parse(JSON.stringify(R.value[e.currentPlan])),o=Object.values(t).find(n=>n.riskType===1),a=Object.values(t).map(n=>{const p=n;if(p.chargePeriod==="3"){const u=(o.chargePeriod||"").split("_");u[1]&&(u[1]-=1),p.chargePeriod=u.join("_")}return p.liabilityVOList=(p.liabilityVOList||[]).filter(u=>u.optionalFlag===1||u.liabilityAttributeValue&&u.liabilityAttributeValue!=="-1").map(u=>{const d=u;return d.liabilityAttributeValue==="0"&&(d.liabilityAttributeValue=""),d}),p}),i={holder:B.value,productCode:e.riskBaseInfo.productCode,insuredVOList:[y(m({},C.value),{productPlanVOList:[{planCode:e.currentPlan||"",riskVOList:a}]})]};de(m({},i)).then(({code:n,data:p})=>{if(n==="10000"){e.retrialTip=!1,e.trialResult=p,e.canTrial=!1;const u={},d=(k=[])=>{(k||[]).forEach(g=>{var P;u[g.riskCode]=g,((P=g.riskPremiumDetailVOList)==null?void 0:P.length)&&d(g.riskPremiumDetailVOList)})};d(p.riskPremiumDetailVOList),Object.assign(T.value,u),l("finished",q(i,u))}else e.retrialTip=!0})},K=()=>{var t,o,a,i,n;Promise.all([(o=(t=A.value)==null?void 0:t.validateForm)==null?void 0:o.call(t),(i=(a=_.value)==null?void 0:a.validateForm)==null?void 0:i.call(a),(n=S.value)==null?void 0:n.validate()]).then(()=>{J()})},U=()=>{l("close")},Y=()=>{pe({dictCodeList:["RISK_PAYMENT_PERIOD","RISK_INSURANCE_PERIOD"]}).then(({code:o,data:a})=>{if(o==="10000"){const i={};a.forEach(n=>{i[n.dictCode]=n.dictItemList}),e.enumList=i}})},z=()=>{ce({productId:s.productId,source:2}).then(({code:t,data:o})=>{t==="10000"&&(e.riskBaseInfo=o.productBasicInfoVO,(o.productRiskVoList[0].riskDetailVOList||[]).forEach((a,i)=>{i===0&&(e.currentPlan=a.planCode||"0"),Object.assign(R.value,{[a.planCode||i]:{}})}),e.riskData=o.productRiskVoList[0].riskDetailVOList||[],e.riskPlanData=o.productRelationPlanVOList||[])}).finally(()=>{})},H=t=>{e.holderFactor=t.holderFactorList,e.insuredFactor=t.insuredFactorList,e.ageRange=t.ageRange};return v([()=>R.value,()=>B.value,()=>C.value],t=>{t&&!e.canTrial&&(e.canTrial=!0,e.retrialTip=!0)},{deep:!0}),v(()=>s.isShow,t=>{e.isShow=t},{immediate:!0}),v(()=>s.productId,t=>{t&&z()},{immediate:!0}),v(()=>s.formInfo,(t={})=>{if(!(s.type==="add"||s.type==="repeatAdd")){const o={};t.proposalProductRiskList.forEach(a=>{o[a.riskId]=a}),Object.assign(R.value,{0:o})}},{deep:!0,immediate:!0}),v(()=>s.productData,t=>{var o;s.type==="add"||s.type==="repeatAdd"||(e.riskBaseInfo=t.productBasicInfoVO,e.riskData=((o=t.productRiskVoList)==null?void 0:o[0].riskDetailVOList)||[])},{deep:!0,immediate:!0}),v(()=>s.type,t=>{e.type=t}),ae(()=>{Y()}),(t,o)=>{const a=V("ProMessage"),i=V("ProTitle"),n=V("VanForm"),p=V("VanButton"),u=V("VanPopup");return I(),L("div",ke,[f(u,{show:c(e).isShow,"onUpdate:show":o[0]||(o[0]=d=>c(e).isShow=d),round:"",position:"bottom",closeable:"",style:{height:"80%"},onClose:U},{default:b(()=>{var d,k;return[D("div",ge,[he,c(w)?(I(),re(a,{key:0,content:c(w)},null,8,["content"])):O("",!0),D("div",_e,[c(e).holderFactor.length?(I(),L("div",ve,[f(i,{title:"\u6295\u4FDD\u4EBA"}),f($,{ref_key:"holderRef",ref:A,"insured-code":(d=c(e).riskBaseInfo)==null?void 0:d.insurerCode,"form-info":B.value.personVO,"factor-list":c(e).holderFactor,"age-range":c(e).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):O("",!0),c(e).insuredFactor.length?(I(),L("div",Re,[f(i,{title:"\u88AB\u4FDD\u4EBA"}),f($,{ref_key:"insuredRef",ref:_,"insured-code":(k=c(e).riskBaseInfo)==null?void 0:k.insurerCode,"form-info":C.value.personVO,"factor-list":c(e).insuredFactor,"age-range":c(e).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):O("",!0),D("div",Pe,[f(i,{title:"\u6295\u4FDD\u65B9\u6848"}),c(e).riskData.length?(I(),L("div",Ve,[f(n,{ref_key:"riskFormRef",ref:S,"input-align":"right","error-message-align":"right"},{default:b(()=>[f(le,{"risk-info":R.value[0],enums:c(e).enumList,"origin-data":c(e).riskData,"pick-factor":H},null,8,["risk-info","enums","origin-data"])]),_:1},512)])):O("",!0)])]),D("div",Ie,[f(p,{block:"",type:"primary",onClick:K},{default:b(()=>[De]),_:1})])])]}),_:1},8,["show"])])}}});var Ae=fe(ye,[["__scopeId","data-v-4f8eda3b"]]);export{Ae as P,be as u};
