var ze=Object.defineProperty,Je=Object.defineProperties;var Qe=Object.getOwnPropertyDescriptors;var ue=Object.getOwnPropertySymbols;var Xe=Object.prototype.hasOwnProperty,Ze=Object.prototype.propertyIsEnumerable;var le=(_,f,F)=>f in _?ze(_,f,{enumerable:!0,configurable:!0,writable:!0,value:F}):_[f]=F,m=(_,f)=>{for(var F in f||(f={}))Xe.call(f,F)&&le(_,F,f[F]);if(ue)for(var F of ue(f))Ze.call(f,F)&&le(_,F,f[F]);return _},p=(_,f)=>Je(_,Qe(f));import{g as ea,a9 as aa,O as ta,E as D,M as ie,y as ce,_ as oa,l as ra,h as na,r as de,af as sa,j as Y,n as me,p as N,m as z,H as ua,t as J,z as U,A as g,J as Q,C as be,k as pe,F as la,T as fe,X as ia}from"./vendor-17026bfd.js";import{_ as ca,C as he,$ as da,G as ma,a1 as ve}from"./index-68bb0b47.js";import{a as P}from"./order-c0ced472.js";import{S as O,R as ye,f as De,h as pa}from"./infoCollection-086b7a1f.js";import{p as ge,i as fa,s as ha,g as va,a as ya,u as Da,b as ga}from"./trial-27fb7bc6.js";import{p as Fa}from"./product-7a9a1ded.js";import{g as Fe,o as Ee,t as Ea,a as Ia}from"./utils-a05d3726.js";import{t as Ca}from"./theme-ea709837.js";import{d as Ie,B as _a,D as Na,G as wa,S as ba,H as Pa,P as Ta,U as Aa,_ as Oa,W as ka,c as $,f as Ce,o as _e,b as q,n as Ne,h as we}from"./auth-ceca5c7a.js";import{_ as Sa}from"./index-9269cbab.js";import"./utils-b6782348.js";import"./trial-46d75bee.js";import"./index-4bd09983.js";import"./bankCard-0e4ce564.js";import"./phoneVerify-2b7b8609.js";const Ua={key:0},Ba={class:"page-internet-product-detail"},La={class:"info"},Ha={class:"footer-button"},Ma={class:"price"},Ra=be(" \u603B\u4FDD\u8D39"),xa=ea({setup(_){const f=aa(),F=ta(),{productCode:B="BWYL2021",tenantId:I,orderNo:k,phoneNo:L,agentCode:H="",saleChannelId:Pe,paymentMethod:E,certNo:X,name:Z,pageCode:M,from:ee}=F.query,K=D(),h=D(),R=D(),T=D(),S=M==="payBack",ae=D(!1),x=D(!1),A=D(!1),te=D(0),G=D(!1),W=D(!1),V=D({show:!1,html:""}),Te=D(!0);let j="";const o=ie({holder:{certNo:X,certType:he.CERT,mobile:L,name:Z,socialFlag:O.HAS},insured:{certNo:X,certType:he.CERT,name:Z,socialFlag:O.HAS,relationToHolder:ye.SELF},paymentMethod:E,renewalDK:"Y",paymentFrequency:De.YEAR,packageProductList:[],mobileSmsCode:""}),w=D(Ie),C=D(Ie),u=ie({showInsure:!S,canInsure:!1,canUpgrade:!1}),Ae=a=>{Te.value=!a},Oe=ce(()=>{var a,t;return((t=(a=h.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(e=>e.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),ke=ce(()=>{var a,t;return((t=(a=h.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(e=>e.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),Se=()=>{const{holder:{certNo:a,mobile:t,name:e,socialFlag:s},insured:{certNo:r,name:n,socialFlag:l,relationToHolder:c},paymentMethod:v}=o;return!!(ma(r)&&!!l)},oe=()=>{f.push({path:"/internet/guaranteeUpgrade",query:p(m({},F.query),{tenantId:I,productCode:"BWYL2022",orderNo:k,agentCode:H})})},Ue=()=>{W.value=!1},Be=()=>{C.value=w.value},Le=()=>{C.value=p(m({},C.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},He=async a=>{fe.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const t=await Da(a),{code:e}=t;if(e==="10000"){fe.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const s=await ga({orderNo:a.orderNo,tenantId:I}),{data:r}=s;s.code==="10000"&&(r.type===2?(V.value={show:!0,html:r.paymentUrl},console.log("data.paymentUrl",V.value),ia(()=>{console.log("document.forms",document.forms);const n=document.getElementById("cashierSubmit");n==null||n.addEventListener("submit",l=>{l.preventDefault()}),n==null||n.submit()})):window.location.href=r.paymentUrl)}u.canInsure=!0}catch{u.canInsure=!0}},Me=a=>`${ve}/internet/productDetail?tenantId=${I}&productCode=${B}&orderNo=${a}&agentCode=${H}&pageCode=payBack&from=${ee||"normal"}`,Re=a=>`${ve}/internet/payFail?tenantId=${I}&orderNo=${a}&agentCode=${H}&pageCode=payBack&from=${ee||"normal"}`,xe=async a=>{console.log("risk",a);const t=Ia({tenantId:I,saleUserId:H,saleChannelId:Pe,detail:h.value,insureDetail:R.value,paymentMethod:o.paymentMethod,renewalDK:o.renewalDK,iseeBizNo:j,successJumpUrl:"",premium:T.value,holder:o.holder,insured:o.insured,tenantOrderRiskList:a,orderStatus:"",orderTopStatus:""});try{const e=await ha(t),{code:s,data:r}=e;s==="10000"&&He(p(m({},t),{orderNo:r.data,extInfo:{extraInfo:{renewalDK:o.renewalDK,paymentMethod:o.paymentMethod,successJumpUrl:Me(r.data),failUrl:Re(r.data)},iseeBizNo:j}}))}catch{u.canInsure=!0}},Ve=async()=>{console.log("trialData",o);const{calcData:a,riskVOList:t}=Fe({holder:o.holder,insured:o.insured,tenantId:I,productDetail:h.value,insureDetail:R.value,paymentFrequency:o.paymentFrequency,packageRiskIdList:Ee(o.packageProductList)}),e=await ge(a),{code:s,data:r}=e;return s==="10000"?(T.value=r.premium,{condition:t,data:r}):{}},Ye=a=>{te.value=a,A.value=!0},$e=()=>new Promise((a,t)=>{var e,s;(s=(e=K.value)==null?void 0:e.validateForm)==null||s.call(e).then(async()=>{var d;if(!(((d=K.value)==null?void 0:d.isAgreeFile)||ae.value)){A.value=!0,Ye(0);return}const{calcData:n,riskVOList:l}=Fe({holder:o.holder,insured:o.insured,tenantId:I,productDetail:h.value,insureDetail:R.value,paymentFrequency:o.paymentFrequency,packageRiskIdList:Ee(o.packageProductList)}),c=await ge(n),{code:v,data:y}=c;v==="10000"?(T.value=y.premium,a({condition:l,data:y})):t(new Error)}).catch(()=>{u.canInsure=!0})}),re=async()=>{var a;if(S){oe();return}u.canInsure=!1;try{const{condition:t,data:e}=await $e(),s={},r=(l=[])=>{(l||[]).forEach(c=>{var v;s[c.riskCode]=c,((v=c.riskPremiumDetailVOList)==null?void 0:v.length)&&r(c.riskPremiumDetailVOList)})};r(e.riskPremiumDetailVOList);const n=Ea({tenantId:I,riskList:t,riskPremium:s,productId:(a=h.value)==null?void 0:a.id});xe(n)}catch{u.canInsure=!0}},qe=a=>{a==="allFalse"&&(x.value=!1,re()),u.canInsure=!0},Ke=()=>{ae.value=!0,A.value=!1,x.value=!0};oa([()=>o.insured.certNo,()=>o.insured.socialFlag,()=>o.packageProductList],ra.exports.debounce(()=>{o.insured.certNo&&o.insured.socialFlag&&Se()&&Ve()},500),{deep:!0,immediate:!0});const ne=async()=>{var s,r,n,l,c,v,y,d;const a=await va({orderNo:k,tenantId:I}),{code:t,data:e}=a;if(t==="10000"){const{tenantOrderHolder:i,tenantOrderInsuredList:b,extInfo:se}=e;if(!S){Object.assign(o,{holder:{certNo:i.certNo,certType:i.certType,mobile:i.mobile,name:i.name,socialFlag:O.HAS},insured:{certNo:i.certNo,certType:i.certType,name:i.name,socialFlag:O.HAS,relationToHolder:ye.SELF},paymentMethod:E,renewalDK:"Y"}),u.canInsure=!0,C.value=Ne,w.value=Ne;return}Object.assign(o,{holder:{certNo:i.certNo,certType:i.certType,mobile:i.mobile,name:i.name,socialFlag:O.HAS},insured:{certNo:b==null?void 0:b[0].certNo,certType:(s=b[0])==null?void 0:s.certType,name:(r=b[0])==null?void 0:r.name,socialFlag:(l=(n=b[0])==null?void 0:n.extInfo)==null?void 0:l.hasSocialInsurance,relationToHolder:(c=b[0])==null?void 0:c.relationToHolder},paymentMethod:se.extraInfo.paymentMethod,renewalDK:se.extraInfo.renewalDK||"N"}),T.value=(d=(y=(v=b[0])==null?void 0:v.tenantOrderProductList)==null?void 0:y[0])==null?void 0:d.premium,(e.orderStatus===P.ACCEPT_POLICY||e.orderStatus===P.PAYMENT_SUCCESS)&&(u.canUpgrade=!0,G.value=!1,W.value=!0),e.orderStatus===P.PAYING&&(G.value=!0,setTimeout(()=>{ne()},3*1e3))}},Ge=async()=>{var s,r,n,l,c,v;console.log("\u77ED\u4FE1\u8FDB\u5165\uFF0C\u5E26\u4E86orderNo, mobile");const a=await ya({holderPhone:L,orderStatus:[P.PAYING.toUpperCase(),P.TIMEOUT.toUpperCase(),"ACCEPT_POLICY"],productCode:B,tenantId:I}),{code:t,data:e}=a;if(e.orderStatus===P.ACCEPT_POLICY&&(console.log("\u5DF2\u627F\u4FDD\uFF0C\u88AB\u4FDD\u4EBA\u4FE1\u606F\u4E0D\u80FD\u4FEE\u6539"),C.value=p(m({},we),{paymentDisable:!!E}),w.value=p(m({},we),{paymentDisable:!!E})),(e.orderStatus===P.PAYING||e.orderStatus===P.TIMEOUT)&&(console.log("\u652F\u4ED8\u4E2D\uFF0C\u8D85\u65F6\u53EF\u4EE5\u4FEE\u6539\u6295\u4FDD\u4EBA\u4FE1\u606F"),C.value=p(m({},q),{paymentDisable:!!E}),w.value=p(m({},q),{paymentDisable:!!E})),t==="10000"&&((s=e==null?void 0:e.tenantOrderHolder)==null?void 0:s.certNo)){u.canInsure=!0;const{tenantOrderHolder:y,tenantOrderInsuredList:d,extInfo:i}=e;Object.assign(o,{holder:{certNo:y.certNo,certType:y.certType,mobile:y.mobile,name:y.name,socialFlag:O.HAS},insured:{certNo:d==null?void 0:d[0].certNo,certType:(r=d[0])==null?void 0:r.certType,name:(n=d[0])==null?void 0:n.name,socialFlag:(c=(l=d[0])==null?void 0:l.extInfo)==null?void 0:c.hasSocialInsurance,relationToHolder:(v=d[0])==null?void 0:v.relationToHolder},paymentMethod:E||i.extraInfo.paymentMethod,renewalDK:i.extraInfo.renewalDK})}else C.value=p(m({},$),{paymentDisable:!!E}),w.value=p(m({},$),{paymentDisable:!!E}),u.canInsure=!0},We=async()=>{const a=Fa({productCode:B,withInsureInfo:!0,tenantId:I}),t=fa({productCode:B});await Promise.all([a,t]).then(([e,s])=>{var r,n;e.code==="10000"&&(h.value=e.data,document.title=((r=e.data)==null?void 0:r.productFullName)||""),s.code==="10000"&&(o.packageProductList=(((n=s.data)==null?void 0:n.packageProductVOList)||[]).map(l=>p(m({},l),{value:pa.UN_INSURE,disabled:!1})),R.value=s.data)}),k?ne():L&&M==="productDetail"&&Ge()},je=()=>{M==="free"?S?(C.value=p(m({},Ce),{paymentDisable:!!E}),w.value=p(m({},Ce),{paymentDisable:!!E}),u.canInsure=!0):(C.value=p(m({},$),{paymentDisable:!!E}),w.value=p(m({},$),{paymentDisable:!!E}),u.canInsure=!0):S?(C.value=_e,w.value=_e,console.log("\u652F\u4ED8\u5B8C\u6210\u8FDB\u5165")):L||k||(console.log("\u6295\u4FDD\u94FE\u63A5"),C.value=q,w.value=q,u.canInsure=!0)};return na(()=>{je(),We(),setTimeout(async()=>{j=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(a,t)=>{const e=de("van-button"),s=de("van-config-provider"),r=sa("dompurify-html");return Y(),me(la,null,[N(s,{"theme-vars":g(Ca)},{default:z(()=>{var n,l,c,v,y,d,i;return[V.value.show?ua((Y(),me("div",Ua,null,512)),[[r,V.value.html]]):J("",!0),U("div",Ba,[U("div",La,[N(_a,{url:(l=(n=h.value)==null?void 0:n.tenantProductInsureVO)==null?void 0:l.banner[0]},null,8,["url"]),N(Na,{"product-name":(c=h.value)==null?void 0:c.productFullName,"product-desc":(y=(v=h.value)==null?void 0:v.showConfigVO)==null?void 0:y.desc},null,8,["product-name","product-desc"])]),N(wa,{"show-service-config":"","guarantee-list":(i=(d=h.value)==null?void 0:d.tenantProductInsureVO)==null?void 0:i.titleAndDescVOS},null,8,["guarantee-list"]),N(ba,{detail:h.value},{form:z(()=>[N(Pa,{ref_key:"formRef",ref:K,"is-show-package":"",disable:!g(u).showInsure,"form-auth":C.value,"form-info":g(o),premium:T.value,"product-detail":h.value,onOnVerify:Ae,onOnReset:Be,onOnUpdate:Le},null,8,["disable","form-auth","form-info","premium","product-detail"])]),_:1},8,["detail"]),U("div",Ha,[U("div",Ma,[Ra,U("span",null," \uFFE5"+Q(g(da)(T.value))+" "+Q(g(o).paymentFrequency==g(De).YEAR?"\u5143":"\u5143/\u6708"),1)]),N(e,{type:"primary",class:"right",disabled:!(g(u).canInsure||g(u).canUpgrade),onClick:re},{default:z(()=>[be(Q(g(u).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),g(M)!=="payBack"?(Y(),pe(Ta,{key:1,"product-detail":h.value},null,8,["product-detail"])):J("",!0),N(Aa,{"order-no":g(k),"tenant-id":g(I),"is-show":W.value,onOnConfirm:oe,onOnClose:Ue},null,8,["order-no","tenant-id","is-show"])]}),_:1},8,["theme-vars"]),N(Oa,{show:x.value,"onUpdate:show":t[0]||(t[0]=n=>x.value=n),"content-list":g(Oe),"active-index":0,onOnConfirmHealth:qe},null,8,["show","content-list"]),A.value?(Y(),pe(Sa,{key:0,show:A.value,"onUpdate:show":t[1]||(t[1]=n=>A.value=n),"content-list":g(ke),"active-index":te.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9","force-read-cound":2,onSubmit:Ke},null,8,["show","content-list","active-index"])):J("",!0),N(ka,{"is-show":G.value},null,8,["is-show"])],64)}}});var ot=ca(xa,[["__scopeId","data-v-b9ffcbfa"]]);export{ot as default};
