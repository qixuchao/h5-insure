import{l as i,a as e,P as a}from"./index-c7969b33.js";import{d as s,z as l,o as t,a1 as r,R as o,c as n,A as d,V as u,U as c,g as p,i as k,w as v,h as m,k as f,G as I,aN as y,L as g,r as h,e as L,ah as V,f as R,j as b,E as C,aB as O,aZ as S,a3 as P,ab as x,B as D,a_ as T,a$ as w,am as F,an as _,u as E,a as N,$ as j,av as M,T as q}from"./index-8ec50ef1.js";import{_ as B}from"./index-273394c2.js";/* empty css              */import{S as A}from"./index-d91ec5e9.js";import{P as K}from"./index-969146a3.js";import{S as $,_ as U}from"./box-title-78e0e510.js";import{_ as Q}from"./index-6bbfd0cb.js";import{T as W}from"./Table-1837ac3a.js";import{R as z}from"./trial-762b0a75.js";import{u as H,b as G,p as Z,q as J,c as X}from"./trial-92f8d53d.js";import{u as Y}from"./useOrder-db5ff216.js";import"./infoCollection-7f56aa00.js";import"./core-dd079ee3.js";const ii={key:0},ei={key:0,class:"risk2-field"},ai=s({name:"ProductRiskList"});var si=I(s({...ai,props:{dataSource:{type:Array,default:()=>[]},productInfo:{type:Object,default:()=>({productCode:"",productName:""})},showMainRisk:{type:Boolean,default:()=>!0},defaultValue:{type:Object,default:()=>{}}},emits:["trialChange"],setup(i,{emit:e}){const a=i,s=l({loading:!1,show:!0,select:{},list:[],userData:{},riskIsInsure:{},submitData:{},disabledRiskInfo:[],risksDefaultValue:{}}),I=i=>{const e=[];return i.riskLiabilityInfoVOList.map((i=>(1!=+i.showFlag&&e.push({...i}),[]))),e},g=(i,l,t)=>{var r;s.riskIsInsure[l].data=i;const o=[...s.disabledRiskInfo];null==(r=a.dataSource.insureProductRiskVOList)||r.forEach((i=>{if(1!==i.mainRiskFlag){const e=s.riskIsInsure[i.riskId];e.data&&Object.keys(e.data).length>0&&"1"===e.selected&&o.push(e.data)}})),e("trialChange",o,t)},h=(i,e)=>{var l;null==(l=a.dataSource.productRiskRelationVOList)||l.forEach((a=>{1!==a.collocationType&&(e.riskId===a.riskId?(s.riskIsInsure[e.riskId]&&s.riskIsInsure[e.riskId].selected,2===a.collocationType&&s.riskIsInsure[a.collocationRiskId]&&(s.riskIsInsure[a.collocationRiskId].selected=i),3===a.collocationType&&s.riskIsInsure[a.collocationRiskId]&&"1"===i&&(s.riskIsInsure[a.collocationRiskId].selected="1"===i?"2":"1")):e.riskId===a.collocationRiskId&&(3===a.collocationType&&"1"===i&&s.riskIsInsure[a.riskId]&&(s.riskIsInsure[a.riskId].selected="1"===i?"2":"1"),2===a.collocationType&&s.riskIsInsure[a.riskId]&&(s.riskIsInsure[a.riskId].selected=i)))})),"2"===i?g({},e.riskId):(i=>{var e,a,s,l,t,r,o,n,d,u,c,p;if(1!==(null==i?void 0:i.factorDisPlayFlag)){const k=null==(e=null==i?void 0:i.productRiskInsureLimitVO)?void 0:e.amountPremiumConfigVO,v={riskCategory:i.riskCategory,riskCode:i.riskCode,riskName:i.riskName,riskId:i.riskId,riskType:i.riskType,mainRiskId:i.mainRiskId,mainRiskCode:i.mainRiskCode,liabilityList:I(i)};v.chargePeriod=(null==(s=null==(a=null==i?void 0:i.productRiskInsureLimitVO)?void 0:a.paymentPeriodValueList)?void 0:s.length)>0&&(null==(l=null==i?void 0:i.productRiskInsureLimitVO)?void 0:l.paymentPeriodValueList[0].code)||null,v.coveragePeriod=(null==(r=null==(t=null==i?void 0:i.productRiskInsureLimitVO)?void 0:t.insurancePeriodValueList)?void 0:r.length)>0&&(null==(o=null==i?void 0:i.productRiskInsureLimitVO)?void 0:o.insurancePeriodValueList[0].code)||null,v.paymentFrequency=(null==(d=null==(n=null==i?void 0:i.productRiskInsureLimitVO)?void 0:n.paymentFrequencyList)?void 0:d.length)>0&&(null==(u=null==i?void 0:i.productRiskInsureLimitVO)?void 0:u.paymentFrequencyList[0].code)||null;let m=0;1===k.displayType?m=(null==k?void 0:k.minStepValue)>0?null==k?void 0:k.minStepValue:0:3===k.displayType&&2===k.requireCopies?m=(null==(c=null==k?void 0:k.displayValues)?void 0:c.length)>0?null==k?void 0:k.displayValues[0].value:0:3===k.displayType&&1===k.requireCopies?(m=(null==(p=null==k?void 0:k.displayValues)?void 0:p.length)>0?null==k?void 0:k.displayValues[0].value:0,v.copy=k.minCopiesValue):2===k.displayType?v.copy=k.minCopiesValue:m=0,1===k.saleMethod?v.initialAmount=m:v.initialPremium=m,g(v,i.riskId)}})(e)};return t((()=>{(()=>{var i,e;s.disabledRiskInfo=[];let l=null;if(null==(i=a.dataSource.insureProductRiskVOList)||i.forEach((i=>{var e;const t=1!==i.mainRiskFlag?null==(e=a.dataSource.productRiskRelationVOList)?void 0:e.find((e=>e.collocationRiskId===i.riskId)):{};1===i.mainRiskFlag&&(l=i),s.riskIsInsure[i.riskId]?(s.riskIsInsure[i.riskId].data=null,s.riskIsInsure[i.riskId].relation=t,s.riskIsInsure[i.riskId].isMust=!1):s.riskIsInsure[i.riskId]={selected:"2",data:null,relation:t,isMust:!1}})),l){const i=null==(e=a.dataSource.productRiskRelationVOList)?void 0:e.filter((i=>i.riskId===l.riskId));if(!i)return;null==i||i.forEach((i=>{var e,l,t,r,o,n,d,u,c,p,k,v,m,f,y;if(2===i.collocationType){s.riskIsInsure[i.collocationRiskId].selected="1",s.riskIsInsure[i.collocationRiskId].isMust=!0;const h=null==(e=a.dataSource.insureProductRiskVOList)?void 0:e.find((e=>i.collocationRiskId===e.riskId));if(h&&1!==h.factorDisPlayFlag&&(null==(l=null==h?void 0:h.productRiskInsureLimitVO)?void 0:l.amountPremiumConfigVO)){const e=null==(t=h.riskLiabilityInfoVOList)?void 0:t.every((i=>1!==i.showFlag)),a=null==(r=null==h?void 0:h.productRiskInsureLimitVO)?void 0:r.amountPremiumConfigVO;if(e){s.riskIsInsure[i.collocationRiskId].isDisabled=!0;const e={riskCategory:h.riskCategory,riskCode:h.riskCode,riskName:h.riskName,riskId:h.riskId,riskType:h.riskType,mainRiskId:h.mainRiskId,mainRiskCode:h.mainRiskCode,liabilityList:I(h)};e.chargePeriod=(null==(n=null==(o=null==h?void 0:h.productRiskInsureLimitVO)?void 0:o.paymentPeriodValueList)?void 0:n.length)>0&&(null==(d=null==h?void 0:h.productRiskInsureLimitVO)?void 0:d.paymentPeriodValueList[0].code)||null,e.coveragePeriod=(null==(c=null==(u=null==h?void 0:h.productRiskInsureLimitVO)?void 0:u.insurancePeriodValueList)?void 0:c.length)>0&&(null==(p=null==h?void 0:h.productRiskInsureLimitVO)?void 0:p.insurancePeriodValueList[0].code)||null,e.paymentFrequency=(null==(v=null==(k=null==h?void 0:h.productRiskInsureLimitVO)?void 0:k.paymentFrequencyList)?void 0:v.length)>0&&(null==(m=null==h?void 0:h.productRiskInsureLimitVO)?void 0:m.paymentFrequencyList[0].code)||null;let l=0;1===a.displayType?l=(null==a?void 0:a.minStepValue)>0?null==a?void 0:a.minStepValue:0:3===a.displayType&&2===a.requireCopies?l=(null==(f=null==a?void 0:a.displayValues)?void 0:f.length)>0?null==a?void 0:a.displayValues[0].value:0:3===a.displayType&&1===a.requireCopies?(l=(null==(y=null==a?void 0:a.displayValues)?void 0:y.length)>0?null==a?void 0:a.displayValues[0].value:0,e.copy=a.minCopiesValue):2===a.displayType&&(e.copy=a.minCopiesValue),1===a.saleMethod?e.initialAmount=l:e.initialPremium=l,s.disabledRiskInfo.push(e),g(e,h.riskId)}}}3===i.collocationType&&(s.riskIsInsure[i.collocationRiskId].selected="2",s.riskIsInsure[i.collocationRiskId].isMust=!0)}))}})()})),r((()=>{s.loading=!0})),o((()=>s.riskIsInsure),(i=>{}),{deep:!0,immediate:!0}),o((()=>a.defaultValue),(i=>{(null==i?void 0:i.length)>0&&i.forEach((i=>{s.risksDefaultValue[i.riskCode]=i,s.riskIsInsure[i.riskId]?(s.riskIsInsure[i.riskId].selected="1",g(i,i.riskId)):s.riskIsInsure[i.riskId]={selected:"1",isMust:!1}}))}),{deep:!0,immediate:!0}),(e,a)=>{const l=A,t=y;return n(!0),d(c,null,u(i.dataSource.insureProductRiskVOList,(a=>{var r,o;return n(),d(c,{key:a.riskCode},[(!i.showMainRisk&&1!==a.mainRiskFlag||i.showMainRisk)&&(null==(o=null==(r=p(s).riskIsInsure)?void 0:r[a.riskId])?void 0:o.relation)?(n(),d("div",ii,[k(t,{modelValue:p(s).riskIsInsure[a.riskId].selected,"onUpdate:modelValue":i=>p(s).riskIsInsure[a.riskId].selected=i,label:a.riskName,name:"selected","label-width":"50%",border:!1,class:"risk-select-field risk-name"},{input:v((()=>[k(l,{modelValue:p(s).riskIsInsure[a.riskId].selected,"onUpdate:modelValue":i=>p(s).riskIsInsure[a.riskId].selected=i,"active-value":"1","inactive-value":"2",size:"0.74rem",disabled:p(s).riskIsInsure[a.riskId].isMust,style:{"margin-right":"8px"},onChange:i=>h(i,a)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])])),_:2},1032,["modelValue","onUpdate:modelValue","label"]),"1"===p(s).riskIsInsure[a.riskId].selected?(n(),d("div",ei,[k(B,{modelValue:p(s).riskIsInsure[a.riskId].data,"onUpdate:modelValue":i=>p(s).riskIsInsure[a.riskId].data=i,"origin-data":a,"product-factor":i.dataSource.productFactor,"default-value":p(s).risksDefaultValue[a.riskCode],onTrialChange:(i,e)=>g(i,a.riskId,e)},null,8,["modelValue","onUpdate:modelValue","origin-data","product-factor","default-value","onTrialChange"])])):m("",!0),1===a.exemptFlag&&"1"===p(s).riskIsInsure[a.riskId].selected?f(e.$slots,"holderForm",{key:1},void 0,!0):m("",!0)])):m("",!0)],64)})),128)}}}),[["__scopeId","data-v-04703dac"]]);const li={class:"benefit-table"},ti=s({name:"benefitTable"}),ri=s({...ti,props:{dataSource:null},setup(i){const e=i,a=g((()=>{const i=e.dataSource.headers.length,a=12*e.dataSource.headers.join("").length+20*e.dataSource.headers.length;return e.dataSource.headers.map(((e,s)=>{const l=a>320?12*e.length+20:Math.max(12*e.length+20,320/i);return console.log("totalWordWidth:",a,"titleWidth:",l,"word-width:",12*e.length+20),{title:e,key:`header_${s}`,fixed:s<2,minWidth:l}}))})),s=g((()=>e.dataSource.dataList.map((i=>{const e={};return i.forEach(((i,a)=>{e[`header_${a}`]=i})),e}))));return r((()=>{})),(i,e)=>(n(),d("div",li,[k(W,{"top-height":400,columns:p(a),data:p(s),"is-clone":!0},null,8,["columns","data"])]))}});const oi=i=>(F("data-v-d9a31ad8"),i=i(),_(),i),ni={key:0,class:"benefit-container"},di={key:0,class:"benefit"},ui=oi((()=>R("div",{class:"line"},null,-1))),ci={class:"box-title box-title-chart"},pi=oi((()=>R("img",{class:"tl",src:U,alt:""},null,-1))),ki=oi((()=>R("img",{class:"transform-z180 tr",src:U,alt:""},null,-1))),vi={key:0},mi={class:"box"},fi={class:"box-title"},Ii=oi((()=>R("img",{class:"tl",src:U,alt:""},null,-1))),yi=oi((()=>R("img",{class:"transform-z180 tr",src:U,alt:""},null,-1))),gi={class:"box-price"},hi={class:"text1"},Li={class:"text2"},Vi={key:1},Ri={key:2,style:{width:"100%, minWidth: 338px"}},bi={class:"slider"},Ci={style:{flex:"1",margin:"0px 5px"}},Oi={class:"custom-button"},Si=oi((()=>R("p",{class:"slider-dec"},"拖动按钮查看不同年龄保障",-1))),Pi={class:"btn-two"},xi={key:1,class:"benefit-container"},Di={key:0},Ti={class:"benefit"},wi=oi((()=>R("div",{class:"line"},null,-1))),Fi=oi((()=>R("div",null,[R("div",{class:"box"},[R("p",{class:"box-title"},[R("img",{class:"tl",src:U,alt:""}),b(" 保单年度"),R("span",null,"-"),b("年度，被保人"),R("span",null,"-"),b("岁时 "),R("img",{class:"transform-z180 tr",src:U,alt:""})]),R("div",{class:"box-price"})])],-1))),_i={class:"slider"},Ei={class:"opt lf"},Ni={style:{flex:"1",margin:"0px 5px"}},ji=oi((()=>R("div",{class:"custom-button"},"0 岁",-1))),Mi={class:"opt rg"},qi=oi((()=>R("p",{class:"slider-dec"},"拖动按钮查看不同年龄保障",-1))),Bi={class:"btn-two"},Ai={key:1,class:"empty-box"},Ki=s({name:"Benefit"});var $i=I(s({...Ki,props:{dataSource:{default:()=>({showTypeList:["1"]})},productInfo:{default:()=>null}},setup(i){var e;const a=i,s="1",l="2",t="3",r=h(0),f=h(0),I=h(0),y=h(),g=h(0),F=h(null==(e=a.dataSource.showTypeList)?void 0:e[0]),_=h(),E=i=>{if(!(null==i?void 0:i.benefitRiskResultVOList))return;const e=null==i?void 0:i.benefitRiskResultVOList[r.value];f.value=e.ageBegin+1,g.value=e.ageBegin+1,I.value=e.ageEnd},N=()=>{var i,e,s,l,t,o;const n=null==(e=null==(i=a.dataSource)?void 0:i.benefitRiskResultVOList)?void 0:e[r.value];_.value=null==(t=null==(l=null==(s=a.dataSource)?void 0:s.benefitRiskResultVOList)?void 0:l[r.value].benefitRiskTableResultVOList)?void 0:t[0];const{a:d,year:u}=((i,e)=>{const a=[],s=[];for(let l=i,t=0;l<=e;l++,t++)a.push(l.toString()),s.push(t+1);return{a:a,year:s}})(f.value,I.value),c={index:d.indexOf(g.value.toString()),age:d,year:u,result:null==(o=null==n?void 0:n.benefitRiskItemResultVOList)?void 0:o[0]};y.value=c},j=()=>{g.value>I.value-1||(g.value+=1,N())},M=()=>{g.value>f.value&&(g.value-=1,N())},q=i=>{r.value=i.name,E(a.dataSource),N()};return o((()=>a.dataSource),(i=>{var e;i&&(E(i),N(),F.value=null==(e=i.showTypeList)?void 0:e[0])}),{deep:!0,immediate:!0}),o(g,(()=>{N()})),(e,o)=>{var h;const E=x,N=$,B=D,A=T,U=w,W=K;return(null==(h=i.dataSource)?void 0:h.benefitRiskResultVOList)?(n(),d("div",ni,[k(U,{active:p(r),onClickTab:q},{default:v((()=>{var i;return[(n(!0),d(c,null,u(null==(i=a.dataSource)?void 0:i.benefitRiskResultVOList,((i,e)=>(n(),L(A,{key:e,name:e,title:i.riskName},{default:v((()=>{var i,h,x,D,T,w,q,A,K,$,U,W,z,H,G,Z;return[e==p(r)?(n(),d("div",di,[ui,V(R("p",ci,[pi,b(" 保单年度"),R("span",null,C(null==(x=null==(i=p(y))?void 0:i.year)?void 0:x[null==(h=p(y))?void 0:h.index]),1),b("年度，被保人"),R("span",null,C(null==(w=null==(D=p(y))?void 0:D.age)?void 0:w[null==(T=p(y))?void 0:T.index]),1),b("岁时 "),ki],512),[[O,p(F)===l]]),p(F)===s?(n(),d("div",vi,[R("div",mi,[R("p",fi,[Ii,b(" 保单年度"),R("span",null,C(null==(K=null==(q=p(y))?void 0:q.year)?void 0:K[null==(A=p(y))?void 0:A.index]),1),b("年度，被保人"),R("span",null,C(null==(W=null==($=p(y))?void 0:$.age)?void 0:W[null==(U=p(y))?void 0:U.index]),1),b("岁时 "),yi]),R("div",gi,[(n(!0),d(c,null,u(null==(H=null==(z=p(y))?void 0:z.result)?void 0:H.headers,((i,e)=>{var a,s,l,t,r,o,u,c,k,v;return n(),d("div",{key:e,style:{width:"33%"}},[R("p",hi,C(("0"==(null==(r=null==(t=null==(s=null==(a=p(y))?void 0:a.result)?void 0:s.dataList)?void 0:t[null==(l=p(y))?void 0:l.index])?void 0:r[e])?"0":p(S)(Number(null==(v=null==(k=null==(u=null==(o=p(y))?void 0:o.result)?void 0:u.dataList)?void 0:k[null==(c=p(y))?void 0:c.index])?void 0:v[e])))||"0"),1),R("p",Li,C(i)+"(元）",1)])})),128))])])])):m("",!0),p(F)===t?(n(),d("div",Vi,[k(ri,{"data-source":p(_)},null,8,["data-source"])])):m("",!0),p(F)==l?(n(),d("div",Ri,[k(Q,{min:p(f),max:p(I),current:p(g),data:null==(Z=null==(G=p(y))?void 0:G.result)?void 0:Z.benefitRiskItemList},null,8,["min","max","current","data"])])):m("",!0),p(F)!=t?(n(),d(c,{key:3},[R("div",bi,[R("div",{class:"opt lf",onClick:M},[k(E,{name:"minus"})]),R("div",Ci,[p(f)?(n(),L(N,{key:0,modelValue:p(g),"onUpdate:modelValue":o[0]||(o[0]=i=>P(g)?g.value=i:null),min:p(f),max:p(I),"bar-height":"8px"},{button:v((()=>[R("div",Oi,C(p(g))+" 岁",1)])),_:1},8,["modelValue","min","max"])):m("",!0)]),R("div",{class:"opt rg",onClick:j},[k(E,{name:"plus"})])]),Si],64)):m("",!0),R("div",Pi,[a.dataSource.showTypeList.includes(s)?(n(),L(B,{key:0,round:"",plain:p(F)!==s,type:"primary",class:"btn",onClick:o[1]||(o[1]=i=>F.value=s)},{default:v((()=>[b("图表展示")])),_:1},8,["plain"])):m("",!0),a.dataSource.showTypeList.includes(l)?(n(),L(B,{key:1,round:"",plain:p(F)!==l,type:"primary",class:"btn",onClick:o[2]||(o[2]=i=>F.value=l)},{default:v((()=>[b("趋势展示")])),_:1},8,["plain"])):m("",!0),a.dataSource.showTypeList.includes(t)?(n(),L(B,{key:2,round:"",plain:p(F)!==t,type:"primary",class:"btn",onClick:o[3]||(o[3]=i=>F.value=t)},{default:v((()=>[b("表格展示")])),_:1},8,["plain"])):m("",!0)])])):m("",!0)]})),_:2},1032,["name","title"])))),128))]})),_:1},8,["active"])])):(n(),d("div",xi,[a.productInfo?(n(),d("div",Di,[k(U,{active:p(r),onClickTab:q},{default:v((()=>[(n(),L(A,{key:1,name:1,title:i.productInfo.insureProductRiskVOList[0].riskName},{default:v((()=>[R("div",Ti,[wi,Fi,R("div",_i,[R("div",Ei,[k(E,{name:"minus"})]),R("div",Ni,[k(N,{modelValue:p(g),"onUpdate:modelValue":o[4]||(o[4]=i=>P(g)?g.value=i:null),min:0,max:80,"bar-height":"8px",disabled:""},{button:v((()=>[ji])),_:1},8,["modelValue"])]),R("div",Mi,[k(E,{name:"plus"})])]),qi,R("div",Bi,[k(B,{round:"",plain:!0,type:"primary",class:"btn",disabled:""},{default:v((()=>[b("图表展示")])),_:1}),k(B,{round:"",plain:!1,type:"primary",class:"btn",disabled:""},{default:v((()=>[b("趋势展示")])),_:1}),k(B,{round:"",plain:!1,type:"primary",class:"btn",disabled:""},{default:v((()=>[b("表格展示")])),_:1})])])])),_:1},8,["title"]))])),_:1},8,["active"])])):(n(),d("div",Ai,[k(W,{title:"试算结果正在计算中...","empty-class":"empty-select"})]))]))}}}),[["__scopeId","data-v-d9a31ad8"]]);const Ui={key:0,class:"head-warning-wrap"},Qi=R("div",{class:"warning-icon"},[R("span",null,"!")],-1),Wi={class:"warning-text"},zi=s({name:"HeadWaring"}),Hi=s({...zi,props:{labels:{default:()=>[]}},setup:i=>(e,a)=>i.labels.length>0?(n(),d("div",Ui,[Qi,R("div",Wi,[(n(!0),d(c,null,u(i.labels,(i=>(n(),d("span",{key:i},C(i),1)))),128))])])):m("",!0)}),Gi=(e,a,s)=>{const l=e,{holder:t}=s,r=s.insuredList[0],o=(a||"").split("_");if(o.length<2)return a;if(i.exports.isNaN(Number(o[1])))return a;if(o[1]-=1,1===l.exemptFlag){if("to"===o[0]){let i=0;1===l.exemptType?(null==t?void 0:t.birthday)&&(i=parseInt(""+((new Date).getTime()-new Date(t.birthday).getTime())/31536e6,10)):2===l.exemptType&&(null==r?void 0:r.birthday)&&(i=parseInt(""+(+(new Date).getTime()-new Date(r.birthday).getTime())/31536e6,10)),o[1]=+o[1]-i}o[0]="year"}return o.join("_")},Zi=(i,e)=>{const a=[],s={};return null==i||i.forEach((i=>{s[i.riskId]=i})),null==e||e.forEach((i=>{var e,l,t,r;const{collocationType:o,collocationRiskId:n,riskId:d}=i;switch(o){case 2:{const i=null==(e=s[d])?void 0:e.riskName,t=null==(l=s[n])?void 0:l.riskName;a.push(`${i} 和 ${t} 必须同时投保`);break}case 3:{const i=null==(t=s[d])?void 0:t.riskName,e=null==(r=s[n])?void 0:r.riskName;a.push(`${i} 和 ${e} 不能同时投保`);break}}})),a};const Ji={class:"com-body"},Xi={class:"trial-body"},Yi={class:"container"},ie=(i=>(F("data-v-378aeb4a"),i=i(),_(),i))((()=>R("div",{class:"empty"},null,-1))),ee=s({name:"TrialBody"});var ae=I(s({...ee,props:{dataSource:{default:()=>[]},productInfo:{default:()=>({productCode:"",productName:"",insurerCode:"",tenantId:""})},tenantProductDetail:{default:()=>({})},hideBenefit:{type:Boolean,default:!1},hidePopupButton:{type:Boolean,default:!1},title:{default:"算一算保费"},defaultData:{default:null},isTrial:{type:Boolean,default:!1}},emits:["trialStart","trialEnd"],setup(s,{expose:u,emit:c}){const I=s,y=h(null),g=E();N(),g.query;const V=h(),b=l({loading:!1,show:!1,select:{},list:[],userData:{},riskIsInsure:{},submitData:{},riskList:[{}],mainRiskVO:{},ifPersonalInfoSuccess:!1,trialMsg:"",trialResultPremium:0,trialResult:{initialPremium:0,initialAmount:0},isAniShow:!1,defaultValue:null,isAutoChange:!1,planIndex:0,isSkipFirstTrial:!1,hadSkipFirstTrial:!1,isQuerying:!1});Y(),h(),h();const C=i=>{const{holder:e,insuredList:a}=i||{};e&&(b.submitData.holder=e),a&&a.length>0&&a.forEach(((i,e)=>{var a;b.submitData.insuredList&&b.submitData.insuredList.length>e?b.submitData.insuredList[e]=i:((null==(a=b.submitData)?void 0:a.insuredList)||(b.submitData.insuredList=[]),b.submitData.insuredList.push(i))}))},O=h(),S=h({}),P=["annuityDrawDate","coveragePeriod","chargePeriod","paymentFrequency"],x=i=>{var e,s,l,t,r,o;if(null==(s=null==(e=null==i?void 0:i.data)?void 0:e[0])?void 0:s.productRiskDyInsureFactorVOList){const e=[];if(null==(l=I.dataSource)||l.insureProductRiskVOList.forEach((s=>{var l,t;const r=null==(t=null==(l=null==i?void 0:i.data)?void 0:l[0])?void 0:t.productRiskDyInsureFactorVOList.find((i=>i.riskCode===s.riskCode));if(r){s.productRiskInsureLimitVO={...s.productRiskInsureLimitVO,...r};const i=b.riskList.find((i=>i.riskCode===s.riskCode));let l=!1;a.forEach((e=>{if(P.indexOf(e.valueKey)>=0){const a=s.productRiskInsureLimitVO[e.configKey];if(a&&i){const s=a.find((a=>a.code===i[e.valueKey]));if(s&&2===s.useFlag){const s=a.find((i=>1===i.defaultFlag));i[e.valueKey]=s.code,l=!0}}}})),l&&e.push({...i,...r,riskCode:s.riskCode})}})),e.length>0&&(null==(o=null==(r=null==(t=b.defaultValue)?void 0:t.insuredList)?void 0:r[0])?void 0:o.productList))return e.forEach((i=>{var e,a,s;b.defaultValue.insuredList[0].productList=null==(s=null==(a=null==(e=b.defaultValue)?void 0:e.insuredList)?void 0:a[0])?void 0:s.productList.map((e=>(e.riskList=null==e?void 0:e.riskList.map((e=>(e.riskCode===i.riskCode&&(e=i),e))),e)))})),!1}return!0},D=async(i,e=!0)=>{b.trialMsg="试算中...",b.trialResultPremium=0,b.loading=!0,c("trialStart");let a=!1;if(e){const{code:e}=await H(i);a="10000"===e}!a&&e||(b.isQuerying=!0,I.hideBenefit||G(i).then((i=>{i.data&&i.code===M&&(S.value=i.data)})).finally((()=>{b.loading=!1})),Z(i).then((i=>{var e,a;if(i.data&&i.code===M){(null==(e=null==i?void 0:i.data)?void 0:e.errorInfo)&&q(`${null==(a=null==i?void 0:i.data)?void 0:a.errorInfo}`),b.trialMsg="",b.trialResultPremium=i.data.initialPremium,b.trialResult=i.data;const s={};i.data.riskPremiumDetailVOList&&i.data.riskPremiumDetailVOList.length&&i.data.riskPremiumDetailVOList.forEach((i=>{s[i.riskCode]={initialAmount:i.initialAmount,initialPremium:i.initialPremium}})),O.value=s,c("trialEnd",i.data,b.submitData)}})).finally((()=>{b.loading=!1,b.isQuerying=!1})))},T=i.exports.debounce((async()=>{console.log(">>>>>调用试算<<<<<",b.ifPersonalInfoSuccess);const{productCode:e,productName:s}=I.productInfo||{};if(b.ifPersonalInfoSuccess||V.value.canTrail()){b.submitData.productCode=e,b.submitData.productName=s,b.submitData.tenantId=I.productInfo.tenantId,b.riskList=b.riskList.map((i=>(i=>{var e,s,l,t;const r=null==(e=I.dataSource.insureProductRiskVOList)?void 0:e.find((e=>i.riskId===e.riskId));if(r&&1!==r.mainRiskFlag){const e=null==(l=null==(s=I.dataSource)?void 0:s.productRiskRelationVOList)?void 0:l.filter((i=>{var e;if(i.collocationRiskId===r.riskId&&3!==i.collocationType){const a=null==(e=I.dataSource.insureProductRiskVOList)?void 0:e.find((e=>i.riskId===e.riskId));if(a&&a.riskType===z.MAIN_RISK)return!0}return!1})),o=e.length>0?e[0]:null;if(o){const e=null==(t=b.riskList)?void 0:t.find((i=>i.riskId===o.riskId));a.forEach((a=>{a.ruleKey&&r.productRiskInsureLimitVO&&e&&(1===r.productRiskInsureLimitVO[a.ruleKey]&&(i[a.valueKey]=e[a.valueKey]),3===r.productRiskInsureLimitVO[a.ruleKey]&&(1!==r.exemptFlag?i[a.valueKey]=Gi(r,e[a.valueKey],b.submitData):i[a.valueKey]=Gi(r,e[a.ruleValueKey],b.submitData)))}))}}return i})(i))),b.submitData.insuredList&&b.submitData.insuredList.forEach((i=>{i.productList=[{productCode:e,productName:s,riskList:b.riskList}]})),console.log(">>>数据构建<<<",i.exports.cloneDeep(b.submitData));const l=i.exports.cloneDeep(b.submitData);await D(l)}}),300),w=async i=>{var e;const{insuredList:a,isFirstInsuredChange:s}=i;if(C(i),b.ifPersonalInfoSuccess=!0,s){console.log("处理第一被保人修改的dy变化"),b.isQuerying=!0;const i=await J({calcProductFactorList:[{planCode:I.dataSource.planCode,productCode:I.productInfo.productCode,riskEditVOList:[{insureProductRiskVO:null==(e=I.dataSource.insureProductRiskVOList)?void 0:e[0]}]}],...a[0]});if(b.isQuerying=!1,!x(i))return}console.log("投被保人的信息回传 ",i),T()},F=async(e,a)=>{var s,l,t,r;if(a){const o=i.exports.cloneDeep(e);delete o.insurancePeriodValueList,delete o.paymentFrequencyList,delete o.paymentPeriodValueList;if(P.indexOf(a.key)>=0&&`${a.oldValue}`!=`${a.newValue}`){const i={};switch(a.key){case"annuityDrawDate":i.changeType=3;break;case"coveragePeriod":i.changeType=2;break;case"chargePeriod":i.changeType=1}const n=null==(l=null==(s=b.submitData)?void 0:s.insuredList)?void 0:l[0],d=null==(r=null==(t=I.dataSource)?void 0:t.insureProductRiskVOList)?void 0:r.find((i=>i.riskCode===e.riskCode));if(!b.isAutoChange){b.isQuerying=!0;const a=await J({calcProductFactorList:[{planCode:I.dataSource.planCode,productCode:I.productInfo.productCode,riskEditVOList:[{insureProductRiskVO:d,insureRiskEditReqVO:{riskId:e.riskId,riskCode:e.riskCode,...o,...i}}]}],...n});b.isQuerying=!1;const s=x(a);return s||(b.isAutoChange=!0),s}b.isAutoChange=!1}}return!0},_=async(i,e)=>{b.mainRiskVO=i;await F(i,e)&&(b.riskList.length>0&&(b.riskList[0]=i),console.log("标准险种的信息回传",i),T())},A=async(i,e)=>{if(b.riskList=[b.mainRiskVO,...i],console.log("附加险列表数据回传",i),e){const a=i.find((i=>i.riskCode===e.riskCode));if(!(await F(a,e)))return}T()},K=i=>{var e,a,s,l;b.userData=i,b.defaultValue=i;const t=(null==(e=i.insuredList)?void 0:e[0].productList.findIndex((i=>i.planCode===I.dataSource.planCode)))||0;b.planIndex=-1===t?0:t,b.riskList=(null==(l=null==(s=null==(a=null==i?void 0:i.insuredList)?void 0:a[0].productList)?void 0:s[b.planIndex])?void 0:l.riskList)||[],D(i,!0)};t((()=>{var i,e;b.select={},b.list=[],b.userData={},b.riskIsInsure={},b.submitData={},b.riskList=[{}],b.mainRiskVO={},b.ifPersonalInfoSuccess=!1,b.trialMsg="",b.trialResultPremium=0,b.riskIsInsure={},null==(e=null==(i=null==I?void 0:I.dataSource)?void 0:i.insureProductRiskVOList)||e.forEach((i=>{var e;const a=null==(e=I.dataSource.productRiskRelationVOList)?void 0:e.find((e=>e.collocationRiskId===i.riskId));a&&(b.riskIsInsure[i.riskCode]={selected:"2",data:null,relation:a})}))})),r((()=>{b.loading=!0,b.show=!0,b.isAniShow=!0,b.isSkipFirstTrial=!0,b.hadSkipFirstTrial=!1,j((()=>{(async i=>{var e,a;if(console.log("props.defaultData",!I.defaultData),I.defaultData){const i=I.defaultData.find((i=>i.productCode===I.productInfo.productCode))||I.defaultData[0];K(i),C(null==(a=I.defaultData)?void 0:a[0])}else{const i=await X({calcProductFactorList:[{planCode:I.dataSource.planCode,productCode:I.productInfo.productCode}]});if(i.data){const a=i.data.find((i=>i.productCode===I.productInfo.productCode))||i.data[0];K(a),C(null==(e=i.data)?void 0:e[0])}}})()}))}));return u({getTrialSuccessFlag:()=>b.trialResultPremium>0,validate:()=>V.value.validate(!1),validateTrialFields:()=>V.value.validateTrialFields(),validateHolder:i=>{var e;return null==(e=V.value)?void 0:e.validateHolder(i)},getUserData:()=>({...b.userData})}),o((()=>b.riskIsInsure),(i=>{}),{deep:!0,immediate:!0}),o((()=>b.userData),(i=>{if(i){const{holder:e,insuredList:a}=i||{};Object.assign(b.submitData,{holder:e,insuredList:a})}}),{deep:!0}),(i,a)=>{var l,t,r,o,u,c,I,g;return n(),d("div",Ji,[f(i.$slots,"trialHead",{},void 0,!0),R("div",Xi,[k(Hi,{labels:p(Zi)((null==(l=s.dataSource)?void 0:l.insureProductRiskVOList)||[],s.dataSource.productRiskRelationVOList)},null,8,["labels"]),R("div",Yi,[!s.hideBenefit&&(null==(t=S.value)?void 0:t.benefitRiskResultVOList)?(n(),L($i,{key:0,class:"benefit-wrap","data-source":S.value,"product-info":s.dataSource,"show-type-list":S.value.showTypList},null,8,["data-source","product-info","show-type-list"])):m("",!0),s.dataSource.productFactor?(n(),L(p(e),{key:1,ref_key:"personalInfoRef",ref:V,modelValue:p(b).userData,"onUpdate:modelValue":a[0]||(a[0]=i=>p(b).userData=i),"is-trial":s.isTrial,"product-factor":s.dataSource.productFactor,"multi-insured-config":null==(r=s.dataSource)?void 0:r.multiInsuredConfigVO,onTrailChange:w},null,8,["modelValue","is-trial","product-factor","multi-insured-config"])):m("",!0),k(B,{ref_key:"insureInfosRef",ref:y,"origin-data":null==(o=s.dataSource.insureProductRiskVOList)?void 0:o[0],"product-factor":s.dataSource.productFactor,"default-value":p(b).defaultValue?null==(c=null==(u=p(b).defaultValue)?void 0:u.insuredList[0].productList[p(b).planIndex])?void 0:c.riskList[0]:null,"trial-result":p(b).trialResult,onTrialChange:_},null,8,["origin-data","product-factor","default-value","trial-result"]),s.dataSource.insureProductRiskVOList?(n(),L(si,{key:2,"data-source":s.dataSource,"show-main-risk":!1,"default-value":p(b).defaultValue?null==(g=null==(I=p(b).defaultValue)?void 0:I.insuredList[0].productList[p(b).planIndex])?void 0:g.riskList:[],onTrialChange:A},{holderForm:v((()=>{var i;return[s.isTrial&&s.dataSource.productFactor?(n(),L(p(e),{key:0,ref_key:"personalInfoRef",ref:V,modelValue:p(b).userData,"onUpdate:modelValue":a[1]||(a[1]=i=>p(b).userData=i),"is-trial":s.isTrial,"is-only-holder":!0,"product-factor":s.dataSource.productFactor,"multi-insured-config":null==(i=s.dataSource)?void 0:i.multiInsuredConfigVO,onTrailChange:w},null,8,["modelValue","is-trial","product-factor","multi-insured-config"])):m("",!0)]})),_:1},8,["data-source","default-value"])):m("",!0),ie])]),f(i.$slots,"trialBtn",{trialData:p(b).submitData,riskPremium:p(b).trialResult,loading:p(b).isQuerying},void 0,!0)])}}}),[["__scopeId","data-v-378aeb4a"]]);export{ae as T};
