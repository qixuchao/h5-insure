import{ref as e,onMounted as t}from"vue";import{aI as n,u as o,a,aS as r,aF as u,T as l,Y as i}from"./index-deb4ddfb.js";/* empty css              */import{g as d,i as c}from"./trial-90e504aa.js";import{_ as s}from"./index-7edb5e9e.js";import{_ as f,s as V}from"./verify-3179c315.js";import{n as m}from"./nextStep-0d38f4c6.js";import{p}from"./product-c166a0f6.js";import{P as v}from"./index-593ee4c8.js";import C from"./index-52712cf2.js";import{u as I}from"./useDicData-48f91541.js";import{I as h}from"./trial-a75330fd.js";import"./pdfh5-e588f83d.js";import"./infoCollection-f930e52f.js";import"./PersonalInfo-37797a94.js";import"./core-5f3b09dd.js";import"./constant-8927d485.js";import"./theme-65292714.js";import"./utils-f063477c.js";const N={key:0,class:"net-sale-detail-wrap"},y={class:"sign-cell"},x=Vue.createElementVNode("div",{class:"sign-label"},"签名",-1),O={class:"footer"},w={class:"footer"},j=Vue.defineComponent({name:"netSaleDetail"}),E=Vue.defineComponent({...j,setup(j){n();const E=o(),k=a(),{orderNo:b="2022113021181894998",tenantId:L="9991000001"}=E.query,P=e({}),B=e(!1),T=I("NATIONAL_REGION_CODE"),g=e({commencementTime:"",expiryDate:"",extInfo:{buttonCode:"EVENT_NETSALE_airSignature",pageCode:"infoCollection",templateId:3,iseeBizNo:""},orderCategory:1,tenantId:L,venderCode:"",tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}],tenantOrderProductList:[{}]}],tenantOrderSubjectList:[{extInfo:{subjectRelatedFirm:"",subjectRelatedUserId:""},subjectName:"",subjectObjectType:"HOLDER",subjectType:"GENERAL",subjectNo:"",tenantId:L}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}}),R=e(!1),S=e(),_=e(),H=e(),A=e(""),U=e(""),D=e(!1),F=e(!1),$=e(0),q=e([]),G=e(""),Y=e("");e("");const z=e([]),W=()=>{D.value=!1,F.value=!1},M=async()=>{D.value=!1,F.value=!0,await V("HOLDER",A.value,g.value.id,`${L}`),m(g.value)},Z=async()=>{const{data:e,code:t}=await p({productCode:Y.value,tenantId:L,withInsureInfo:!0});"10000"===t&&(H.value=e,(()=>{var e,t,n,o,a,r;let u={};if(u=U.value?(null==(n=((null==(t=null==(e=H.value)?void 0:e.tenantProductInsureVO)?void 0:t.planList)||[]).find((e=>e.planCode===U.value)))?void 0:n.attachmentVOList)||[]:(null==(r=null==(a=null==(o=H.value)?void 0:o.tenantProductInsureVO)?void 0:a.planInsureVO)?void 0:r.attachmentVOList)||[],!u)return void(q.value=[]);const l={2:"richText",3:"link"};q.value=Object.keys(u).map((e=>(u[e].forEach((e=>{if("1"===e.attachmentType){const t=e.attachmentUri.split("?"),n=t[0].substr(t[0].lastIndexOf(".")+1);e.attachmentType="pdf"===n?"pdf":"picture"}else e.attachmentType=l[e.attachmentType]})),{attachmentName:e,attachmentList:u[e]})))||[],z.value=q.value.map((e=>({attachmentName:e.attachmentName,attachmentList:e.attachmentList.filter((e=>e.mustReadFlag===i.YES))}))).filter((e=>e.attachmentList.length))})())},J=async()=>{var e;const{code:t,data:n}=await d({orderNo:b,tenantId:L});"10000"===t&&(n.extInfo.buttonCode="EVENT_NETSALE_airSignature",g.value=n,U.value=null==(e=n.tenantOrderInsuredList[0])?void 0:e.planCode,Y.value=n.tenantOrderInsuredList[0].tenantOrderProductList[0].productCode,B.value=!0,(e=>{const t=e.find((e=>1===e.riskType));var n,o;t&&(G.value=(n=t.insurancePeriodValue,-1!==(o=h[t.insurancePeriodType]).indexOf("$")?o.replace("$",`${n}`):`${n||""}${o}`))})(n.tenantOrderInsuredList[0].tenantOrderProductList[0].tenantOrderRiskList||[]),(async()=>{const{code:e,data:t}=await c({productCode:Y.value,tenantId:L});"10000"===e&&(_.value=t,P.value=t.productFactor)})(),Z(),n.orderStatus!==u.UNDER_WRITING_SUCCESS&&k.push({path:"/baseInsurance/orderDetail",query:{...E.query,productCode:Y.value,ISEE_BIZ:n.extInfo.iseeBizNo}}))},K=async()=>{A.value?(F.value=!1,z.value.length?D.value=!0:M()):l("请先签字")};return t((()=>{J()})),(e,t)=>{var n;const o=Vue.resolveComponent("ProCell"),a=Vue.resolveComponent("ProCard"),u=Vue.resolveComponent("ProCascader"),l=Vue.resolveComponent("van-cell"),i=Vue.resolveComponent("ProPageWrap"),d=Vue.resolveComponent("ProFilePreview"),c=Vue.resolveComponent("ProPopup");return Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,[Vue.createVNode(i,null,{default:Vue.withCtx((()=>{var e;return[(null==(e=Vue.unref(_))?void 0:e.productBasicInfoVO)?(Vue.openBlock(),Vue.createElementBlock("div",N,[Vue.createVNode(a,null,{default:Vue.withCtx((()=>{var e;return[Vue.createVNode(o,{title:"产品名称",content:null==(e=Vue.unref(_))?void 0:e.productBasicInfoVO.productFullName},null,8,["content"])]})),_:1}),Vue.unref(g).id?(Vue.openBlock(),Vue.createBlock(a,{key:0,"show-line":!1,title:"投保信息"},{default:Vue.withCtx((()=>{var e,n,a,l;return[Vue.createVNode(o,{title:"保费",content:Vue.unref(g).orderAmount+"元"},null,8,["content"]),Vue.createVNode(o,{title:"保险期限",content:Vue.unref(G)},null,8,["content"]),Vue.createVNode(o,{title:"起保日期",content:Vue.unref(g).commencementTime},null,8,["content"]),Vue.createVNode(o,{title:"终保日期",content:Vue.unref(g).expiryDate},null,8,["content"]),Vue.createVNode(o,{title:"保单状态",content:Vue.unref(r)[Vue.unref(g).orderStatus]},null,8,["content"]),Vue.createVNode(o,{title:"订单编号",content:Vue.unref(g).orderNo},null,8,["content"]),Vue.createVNode(u,{modelValue:Vue.unref(g).tenantOrderHolder.extInfo.familyAreaCode,"onUpdate:modelValue":t[0]||(t[0]=e=>Vue.unref(g).tenantOrderHolder.extInfo.familyAreaCode=e),field1:Vue.unref(g).tenantOrderHolder.extInfo.familyProvinceCode,"onUpdate:field1":t[1]||(t[1]=e=>Vue.unref(g).tenantOrderHolder.extInfo.familyProvinceCode=e),field2:Vue.unref(g).tenantOrderHolder.extInfo.familyCityCode,"onUpdate:field2":t[2]||(t[2]=e=>Vue.unref(g).tenantOrderHolder.extInfo.familyCityCode=e),field3:Vue.unref(g).tenantOrderHolder.extInfo.familyAreaCode,"onUpdate:field3":t[3]||(t[3]=e=>Vue.unref(g).tenantOrderHolder.extInfo.familyAreaCode=e),label:"房产所在地",name:"familyProvinceCode","is-link":"","is-view":"",class:"insured-info","data-source":Vue.unref(T),mapping:{label:"name",value:"code",children:"children"}},null,8,["modelValue","field1","field2","field3","data-source"]),Vue.createVNode(o,{title:"详细地址",content:null==(n=null==(e=Vue.unref(g).tenantOrderHolder)?void 0:e.extInfo)?void 0:n.familyAddress},null,8,["content"]),Vue.createVNode(o,{title:"燃气编号",content:null==(l=null==(a=Vue.unref(g).tenantOrderSubjectList)?void 0:a[0])?void 0:l.subjectNo},null,8,["content"])]})),_:1})):Vue.createCommentVNode("",!0),Vue.unref(B)?(Vue.openBlock(),Vue.createBlock(s,{key:1,ref:"formRef","title-collection":{HOLDER:"投保人信息",INSURER:"被保人信息",BENEFICIARY:"受益人"},"is-view":!0,"form-info":Vue.unref(g),"factor-object":Vue.unref(P),"input-align":"right"},null,8,["form-info","factor-object"])):Vue.createCommentVNode("",!0),Vue.createVNode(a,{title:"阅读条款合同",class:"file-list-card"},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(q),((e,t)=>(Vue.openBlock(),Vue.createBlock(l,{key:t,title:e.attachmentName,"is-link":"",onClick:t=>{return n=e.attachmentName,o=e.attachmentList,R.value=!0,void(S.value={title:n,fileContent:null==o?void 0:o[0]});var n,o}},null,8,["title","onClick"])))),128))])),_:1}),Vue.createVNode(a,{title:"客户签名"},{default:Vue.withCtx((()=>[Vue.createElementVNode("div",y,[x,Vue.createVNode(f,{modelValue:Vue.unref(A),"onUpdate:modelValue":t[4]||(t[4]=e=>Vue.isRef(A)?A.value=e:null)},null,8,["modelValue"])])])),_:1}),Vue.createElementVNode("div",O,[Vue.createVNode(v,{shadow:!1,text:"提 交",onClick:K})])])):Vue.createCommentVNode("",!0)]})),_:1}),Vue.createVNode(c,{show:Vue.unref(R),"onUpdate:show":t[6]||(t[6]=e=>Vue.isRef(R)?R.value=e:null),class:"pre-notice-wrap",title:null==(n=Vue.unref(S))?void 0:n.title,position:"bottom",style:{height:"600px"}},{default:Vue.withCtx((()=>{var e,n,o,a;return[Vue.createVNode(d,{content:null==(n=null==(e=Vue.unref(S))?void 0:e.fileContent)?void 0:n.attachmentUri,type:null==(a=null==(o=Vue.unref(S))?void 0:o.fileContent)?void 0:a.attachmentType},null,8,["content","type"]),Vue.createElementVNode("div",w,[Vue.createVNode(v,{shadow:!1,text:"关闭",onClick:t[5]||(t[5]=e=>R.value=!1)})])]})),_:1},8,["show","title"]),Vue.unref(D)&&0!==Vue.unref(z).length?(Vue.openBlock(),Vue.createBlock(C,{key:0,show:Vue.unref(D),"onUpdate:show":t[7]||(t[7]=e=>Vue.isRef(D)?D.value=e:null),"content-list":Vue.unref(z),"is-only-view":Vue.unref(F),"active-index":Vue.unref($),text:Vue.unref(F)?"关闭":"我已逐页阅读上述内容并同意","force-read-count":0,"on-close-file-preview":"",onSubmit:M,onOnCloseFilePreview:W,onOnCloseFilePreviewByMask:t[8]||(t[8]=e=>D.value=!1)},null,8,["show","content-list","is-only-view","active-index","text"])):Vue.createCommentVNode("",!0)],64)}}});export{E as default};
