import{d as e,K as a,a0 as t,c as s,y as i,i as l,g as o,r as n,Q as r,b as u,w as d,R as c,U as p,e as m,ab as f,f as v,j as k,z as h,an as V,ao as O,h as y,a1 as L,E as g,a9 as I,B as C,ap as b,aq as R,ag as S,ah as x,u as P,a as D,x as w,ar as T,T as _,o as E,A as j,k as F,as as A,af as K,C as q,P as M}from"./index-14b87a0a.js";import{l as N,P as B}from"./index-5bb63aad.js";import"./infoCollection-8c829899.js";import{I as $,P as U}from"./index-82f5842c.js";import{_ as H,f as W}from"./utils-4fe5dc84.js";import{P as z,d as J}from"./utils-94323e32.js";import{S as G,_ as Q}from"./box-title-62ad4da5.js";import{_ as Z}from"./index-10f5202f.js";import{T as X}from"./Table-4b29e54f.js";import{u as Y,p as ee,b as ae,q as te,a as se}from"./trial-98bfde99.js";import{u as ie}from"./useOrder-fb4a0968.js";import{t as le}from"./utils-b0532950.js";import{B as oe,P as ne}from"./constants-7afb7c3d.js";import{n as re}from"./nextStep-b71523da.js";import{p as ue}from"./pageJump-1c6f1428.js";const de={class:"benefit-table"},ce=e({name:"benefitTable"}),pe=e({...ce,props:{dataSource:null},setup(e){const n=e,r=a((()=>{const e=n.dataSource.headers.length,a=12*n.dataSource.headers.join("").length+20*n.dataSource.headers.length;return n.dataSource.headers.map(((t,s)=>{const i=a>320?12*t.length+20:Math.max(12*t.length+20,320/e);return console.log("totalWordWidth:",a,"titleWidth:",i,"word-width:",12*t.length+20),{title:t,key:`header_${s}`,fixed:s<2,minWidth:i}}))})),u=a((()=>n.dataSource.dataList.map((e=>{const a={};return e.forEach(((e,t)=>{a[`header_${t}`]=e})),a}))));return t((()=>{})),(e,a)=>(s(),i("div",de,[l(X,{"top-height":400,columns:o(r),data:o(u),"is-clone":!0},null,8,["columns","data"])]))}});const me=e=>(S("data-v-71e6c361"),e=e(),x(),e),fe={key:0,class:"benefit-container"},ve={key:0,class:"benefit"},ke=me((()=>v("div",{class:"line"},null,-1))),he={class:"box-title box-title-chart"},Ve=me((()=>v("img",{class:"tl",src:Q,alt:""},null,-1))),Oe=me((()=>v("img",{class:"transform-z180 tr",src:Q,alt:""},null,-1))),ye={key:0},Le={class:"box"},ge={class:"box-title"},Ie=me((()=>v("img",{class:"tl",src:Q,alt:""},null,-1))),Ce=me((()=>v("img",{class:"transform-z180 tr",src:Q,alt:""},null,-1))),be={class:"box-price"},Re={class:"text1"},Se={class:"text2"},xe={key:1},Pe={key:2,style:{width:"100%, minWidth: 338px"}},De={class:"slider"},we={style:{flex:"1",margin:"0px 5px"}},Te={class:"custom-button"},_e=me((()=>v("p",{class:"slider-dec"},"拖动按钮查看不同年龄保障",-1))),Ee={class:"btn-two"},je={key:1},Fe=e({name:"benefit"});var Ae=g(e({...Fe,props:{dataSource:{default:()=>({showTypeList:["1"]})}},setup(e){var a;const t=e,g="1",S="2",x="3",P=n(0),D=n(0),w=n(0),T=n(),_=n(0),E=n(null==(a=t.dataSource.showTypeList)?void 0:a[0]),j=n(),F=e=>{if(!(null==e?void 0:e.benefitRiskResultVOList))return;const a=null==e?void 0:e.benefitRiskResultVOList[P.value];D.value=a.ageBegin+1,_.value=a.ageBegin+1,w.value=a.ageEnd},A=()=>{var e,a,s,i,l,o;const n=null==(a=null==(e=t.dataSource)?void 0:e.benefitRiskResultVOList)?void 0:a[P.value];j.value=null==(l=null==(i=null==(s=t.dataSource)?void 0:s.benefitRiskResultVOList)?void 0:i[P.value].benefitRiskTableResultVOList)?void 0:l[0];const{a:r,year:u}=((e,a)=>{const t=[],s=[];for(let i=e,l=0;i<=a;i++,l++)t.push(i.toString()),s.push(l+1);return{a:t,year:s}})(D.value,w.value),d={index:r.indexOf(_.value.toString()),age:r,year:u,result:null==(o=null==n?void 0:n.benefitRiskItemResultVOList)?void 0:o[0]};T.value=d},K=()=>{_.value>w.value-1||(_.value+=1,A())},q=()=>{_.value>D.value&&(_.value-=1,A())},M=e=>{P.value=e.name,F(t.dataSource),A()};return r((()=>t.dataSource),(e=>{var a;e&&(F(e),A(),E.value=null==(a=e.showTypeList)?void 0:a[0])}),{deep:!0,immediate:!0}),r(_,(()=>{A()})),(a,n)=>{var r;const F=I,A=G,N=C,B=b,$=R,U=u("ZaEmpty");return(null==(r=e.dataSource)?void 0:r.benefitRiskResultVOList)?(s(),i("div",fe,[l($,{active:o(P),onClickTab:M},{default:d((()=>{var e;return[(s(!0),i(c,null,p(null==(e=t.dataSource)?void 0:e.benefitRiskResultVOList,((e,a)=>(s(),m(B,{key:a,name:a,title:e.riskName},{default:d((()=>{var e,r,u,I,C,b,R,M,B,$,U,H,W,z,J,G;return[a==o(P)?(s(),i("div",ve,[ke,f(v("p",he,[Ve,k(" 保单年度"),v("span",null,h(null==(u=null==(e=o(T))?void 0:e.year)?void 0:u[null==(r=o(T))?void 0:r.index]),1),k("年度，被保人"),v("span",null,h(null==(b=null==(I=o(T))?void 0:I.age)?void 0:b[null==(C=o(T))?void 0:C.index]),1),k("岁时 "),Oe],512),[[V,o(E)===S]]),o(E)===g?(s(),i("div",ye,[v("div",Le,[v("p",ge,[Ie,k(" 保单年度"),v("span",null,h(null==(B=null==(R=o(T))?void 0:R.year)?void 0:B[null==(M=o(T))?void 0:M.index]),1),k("年度，被保人"),v("span",null,h(null==(H=null==($=o(T))?void 0:$.age)?void 0:H[null==(U=o(T))?void 0:U.index]),1),k("岁时 "),Ce]),v("div",be,[(s(!0),i(c,null,p(null==(z=null==(W=o(T))?void 0:W.result)?void 0:z.headers,((e,a)=>{var t,l,n,r,u,d,c,p,m,f;return s(),i("div",{key:a,style:{width:"33%"}},[v("p",Re,h("0"==(null==(u=null==(r=null==(l=null==(t=o(T))?void 0:t.result)?void 0:l.dataList)?void 0:r[null==(n=o(T))?void 0:n.index])?void 0:u[a])?"0":o(O)(Number(null==(f=null==(m=null==(c=null==(d=o(T))?void 0:d.result)?void 0:c.dataList)?void 0:m[null==(p=o(T))?void 0:p.index])?void 0:f[a]))),1),v("p",Se,h(e)+"(元）",1)])})),128))])])])):y("",!0),o(E)===x?(s(),i("div",xe,[l(pe,{"data-source":o(j)},null,8,["data-source"])])):y("",!0),o(E)==S?(s(),i("div",Pe,[l(Z,{min:o(D),max:o(w),current:o(_),data:null==(G=null==(J=o(T))?void 0:J.result)?void 0:G.benefitRiskItemList},null,8,["min","max","current","data"])])):y("",!0),o(E)!=x?(s(),i(c,{key:3},[v("div",De,[v("div",{class:"opt lf",onClick:q},[l(F,{name:"minus"})]),v("div",we,[o(D)?(s(),m(A,{key:0,modelValue:o(_),"onUpdate:modelValue":n[0]||(n[0]=e=>L(_)?_.value=e:null),min:o(D),max:o(w),"bar-height":"8px"},{button:d((()=>[v("div",Te,h(o(_))+" 岁",1)])),_:1},8,["modelValue","min","max"])):y("",!0)]),v("div",{class:"opt rg",onClick:K},[l(F,{name:"plus"})])]),_e],64)):y("",!0),v("div",Ee,[t.dataSource.showTypeList.includes(g)?(s(),m(N,{key:0,round:"",plain:o(E)!==g,type:"primary",class:"btn",onClick:n[1]||(n[1]=e=>E.value=g)},{default:d((()=>[k("图表展示")])),_:1},8,["plain"])):y("",!0),t.dataSource.showTypeList.includes(S)?(s(),m(N,{key:1,round:"",plain:o(E)!==S,type:"primary",class:"btn",onClick:n[2]||(n[2]=e=>E.value=S)},{default:d((()=>[k("趋势展示")])),_:1},8,["plain"])):y("",!0),t.dataSource.showTypeList.includes(x)?(s(),m(N,{key:2,round:"",plain:o(E)!==x,type:"primary",class:"btn",onClick:n[3]||(n[3]=e=>E.value=x)},{default:d((()=>[k("表格展示")])),_:1},8,["plain"])):y("",!0)])])):y("",!0)]})),_:2},1032,["name","title"])))),128))]})),_:1},8,["active"])])):(s(),i("div",je,[l(U,{title:"试算前请完善投保信息","empty-class":"empty-select"})]))}}}),[["__scopeId","data-v-71e6c361"]]);const Ke={class:"com-body"},qe={class:"header"},Me={class:"header-title"},Ne={class:"container"},Be=(e=>(S("data-v-6109b60f"),e=e(),x(),e))((()=>v("div",{class:"empty"},null,-1))),$e=e({name:"TrialPop"});var Ue=g(e({...$e,props:{dataSource:{default:()=>[]},productInfo:{default:()=>({productCode:"",productName:"",insurerCode:"",tenantId:""})},shareInfo:{default:()=>({})},tenantProductDetail:{default:()=>({})},hideBenefit:{type:Boolean,default:!1},hidePopupButton:{type:Boolean,default:!1},title:{default:"算一算保费"},defaultData:{default:null}},setup(e,{expose:a}){const u=e,p=n(null),f=P();D();const{tenantId:V,templateId:O}=f.query,L=w({loading:!1,show:!1,select:{},list:[],userData:{},riskIsInsure:{},submitData:{},riskVOList:[{}],mainRiskVO:{},ifPersonalInfoSuccess:!1,trialMsg:"",trialResult:0,isAniShow:!1,defaultValue:null,isAutoChange:!1,planIndex:0}),g=ie(),I=n(),C=n(),b=()=>{var e;null==(e=p.value)||e.validate().then((()=>{Object.assign(g.value,{extInfo:{...g.value.extInfo,buttonCode:oe.TRIAL_PREMIUM,pageCode:ne.TRIAL_PREMIUM,templateId:O}});const e=((e={},a={},t={})=>{var s;const i={...t},{tenantOrderHolder:l,tenantOrderInsuredList:o}=W({holder:null==(s=L.submitData.holder)?void 0:s.personVO,insuredList:(L.submitData.insuredVOList||[]).map((e=>e.personVO))});console.log("tenantOrderHolder",l),console.log("tenantOrderInsuredList",o);const n=L.submitData.insuredVOList.map((e=>{var a,t;return null==(t=null==(a=e.productPlanVOList)?void 0:a[0])?void 0:t.riskVOList})).flat();console.log("riskList",n);const r={tenantId:V,riskList:n,riskPremium:a,productId:e.id};return i.extInfo.iseeBizNo=I.value,i.productCode=e.productCode,i.commencementTime=i.insuranceStartDate,i.expiryDate=i.insuranceEndDate,i.premium=L.trialResult,i.orderAmount=L.trialResult,i.orderRealAmount=L.trialResult,i.tenantOrderHolder=l,i.tenantOrderInsuredList=o.map((a=>({...a,certType:a.certType||q.CERT,certNo:(a.certNo||"").toLocaleUpperCase(),planCode:u.dataSource.planCode,tenantOrderProductList:[{premium:L.trialResult,productCode:e.productCode,productName:e.productName,planCode:u.dataSource.planCode,tenantOrderRiskList:le(r)}]}))),console.log("nextStepParams",i),i})(u.productInfo,C.value,g.value);re(e,((e,a)=>{a===M.JUMP_PAGE&&ue(e.nextPageCode,{...f.query,orderNo:e.orderNo})})),console.log("---- validate success ----")})),L.loading=!1,L.show=!0,L.isAniShow=!0},R=()=>{L.show=!1,L.loading=!1},S=n({}),x=["annuityDrawDate","coveragePeriod","chargePeriod"],G=()=>{var e,a;L.riskIsInsure={},null==(a=null==(e=null==u?void 0:u.dataSource)?void 0:e.insureProductRiskVOList)||a.forEach((e=>{var a;const t=null==(a=u.dataSource.productRiskRelationVOList)?void 0:a.find((a=>a.collocationRiskId===e.riskId));t&&(L.riskIsInsure[e.riskCode]={selected:"2",data:null,relation:t})}))},Q=e=>{var a,t,s,i,l,o;if(null==(t=null==(a=null==e?void 0:e.data)?void 0:a[0])?void 0:t.productRiskDyInsureFactorVOList){const a=[];if(null==(s=u.dataSource)||s.insureProductRiskVOList.forEach((t=>{var s,i;const l=null==(i=null==(s=null==e?void 0:e.data)?void 0:s[0])?void 0:i.productRiskDyInsureFactorVOList.find((e=>e.riskCode===t.riskCode));if(l){t.productRiskInsureLimitVO={...t.productRiskInsureLimitVO,...l};const e=L.riskVOList.find((e=>e.riskCode===t.riskCode));let s=!1;U.forEach((a=>{if(x.indexOf(a.valueKey)>=0){const i=t.productRiskInsureLimitVO[a.configKey];if(i&&e){const t=i.find((t=>t.code===e[a.valueKey]));if(t&&2===t.useFlag){const t=i.find((e=>1===e.defaultFlag));e[a.valueKey]=t.code,s=!0}}}})),s&&a.push({...e,...l,riskCode:t.riskCode})}})),a.length>0&&(null==(o=null==(l=null==(i=L.defaultValue)?void 0:i.insuredVOList)?void 0:l[0])?void 0:o.productPlanVOList))return a.forEach((e=>{var a,t,s;L.defaultValue.insuredVOList[0].productPlanVOList=null==(s=null==(t=null==(a=L.defaultValue)?void 0:a.insuredVOList)?void 0:t[0])?void 0:s.productPlanVOList.map((a=>(a.riskCode===e.riskCode&&(a=e),a)))})),!1}return!0},Z=N.exports.debounce((async()=>{if(console.error("-------",(new Date).getTime()),L.ifPersonalInfoSuccess){L.submitData.productCode=u.productInfo.productCode,L.submitData.tenantId=u.productInfo.tenantId,L.riskVOList=L.riskVOList.map((e=>(e=>{var a,t,s,i;const l=null==(a=u.dataSource.insureProductRiskVOList)?void 0:a.find((a=>e.riskId===a.riskId));if(l&&1!==l.mainRiskFlag){const a=null==(s=null==(t=u.dataSource)?void 0:t.productRiskRelationVOList)?void 0:s.find((e=>e.collocationRiskId===l.riskId));if(a){const t=null==(i=L.riskVOList)?void 0:i.find((e=>e.riskId===a.riskId));U.forEach((a=>{a.ruleKey&&l.productRiskInsureLimitVO&&t&&(1===l.productRiskInsureLimitVO[a.ruleKey]&&(e[a.valueKey]=t[a.valueKey]),3===l.productRiskInsureLimitVO[a.ruleKey]&&(1!==l.exemptFlag?e[a.valueKey]=J(l,t[a.valueKey],L.submitData):e[a.valueKey]=J(l,t[a.ruleValueKey],L.submitData)))}))}}return e})(e))),L.submitData.insuredVOList&&L.submitData.insuredVOList.forEach((e=>{e.productPlanVOList=[{insurerCode:u.productInfo.insurerCode,planCode:u.dataSource.planCode,riskVOList:L.riskVOList}]})),console.log(">>>数据构建<<<",JSON.stringify(L.submitData));const e=N.exports.cloneDeep(L.submitData);L.trialMsg="试算中...",L.trialResult=0,L.loading=!0;const{code:a}=await Y(e);"10000"===a&&(ee(e).then((e=>{var a,t;if(e.data&&e.code===T){(null==(a=null==e?void 0:e.data)?void 0:a.errorInfo)&&_(`${null==(t=null==e?void 0:e.data)?void 0:t.errorInfo}`),L.trialMsg="",L.trialResult=e.data.premium;const s={};e.data.riskPremiumDetailVOList&&e.data.riskPremiumDetailVOList.length&&e.data.riskPremiumDetailVOList.forEach((e=>{s[e.riskCode]={premium:e.premium,amount:e.amount}})),C.value=s}})).finally((()=>{L.loading=!1})),ae(e).then((e=>{e.data&&e.code===T&&(S.value=e.data)})).finally((()=>{L.loading=!1})))}}),400),X=async e=>{var a;const{holder:t,insuredVOList:s,isFirstInsuredChange:i}=e;if(t&&(L.submitData.holder=t),s&&s.length>0&&s.forEach(((e,a)=>{var t;L.submitData.insuredVOList&&L.submitData.insuredVOList.length>a?L.submitData.insuredVOList[a].personVO={...e.personVO,socialFlag:e.personVO.hasSocialInsurance}:((null==(t=L.submitData)?void 0:t.insuredVOList)||(L.submitData.insuredVOList=[]),L.submitData.insuredVOList.push({personVO:{...e.personVO,socialFlag:e.personVO.hasSocialInsurance}}))})),L.ifPersonalInfoSuccess=!0,i){console.log("处理第一被保人修改的dy变化");const e=await te({calcProductFactorList:[{planCode:u.dataSource.planCode,productCode:u.productInfo.productCode,riskEditVOList:[{insureProductRiskVO:null==(a=u.dataSource.insureProductRiskVOList)?void 0:a[0]}]}],...s[0].personVO});if(!Q(e))return}console.log("投被保人的信息回传 ",L.submitData,e),Z()},de=async(e,a)=>{var t,s,i,l;if(a){const o=N.exports.cloneDeep(e);delete o.insurancePeriodValueList,delete o.paymentFrequencyList,delete o.paymentPeriodValueList;if(x.indexOf(a.key)>=0){const n={};switch(a.key){case"annuityDrawDate":n.changeType=3;break;case"coveragePeriod":n.changeType=2;break;case"chargePeriod":n.changeType=1}const r=null==(s=null==(t=L.submitData)?void 0:t.insuredVOList)?void 0:s[0].personVO,d=null==(l=null==(i=u.dataSource)?void 0:i.insureProductRiskVOList)?void 0:l.find((a=>a.riskCode===e.riskCode));if(!L.isAutoChange){const a=await te({calcProductFactorList:[{planCode:u.dataSource.planCode,productCode:u.productInfo.productCode,riskEditVOList:[{insureProductRiskVO:d,insureRiskEditReqVO:{riskId:e.riskId,riskCode:e.riskCode,...o,...n}}]}],...r}),t=Q(a);return t||(L.isAutoChange=!0),t}L.isAutoChange=!1}}return!0},ce=async(e,a)=>{L.mainRiskVO=e,console.log(":::::handleTrialInfoChange = ",e);await de(e,a)&&(L.riskVOList.length>0&&(L.riskVOList[0]=e),console.log("标准险种的信息回传",e),Z())},pe=async(e,a)=>{if(L.riskVOList=[L.mainRiskVO,...e],console.log("附加险列表数据回传",e),a){console.log("-change data = ",a);const t=e.find((e=>e.riskCode===a.riskCode));if(!(await de(t,a)))return}Z()},me=()=>{L.isAniShow=!1},fe=e=>{var a;L.userData=e,L.defaultValue=e,L.planIndex=e.insuredVOList[0].productPlanVOList.findIndex((e=>e.planCode===u.dataSource.planCode)),console.log("-----data = ",null==(a=L.defaultValue)?void 0:a.insuredVOList[0].productPlanVOList[0])};E((()=>{G()})),t((()=>{L.loading=!0})),r((()=>L.show),(e=>{e&&(L.select={},L.list=[],L.userData={},L.riskIsInsure={},L.submitData={},L.riskVOList=[{}],L.mainRiskVO={},L.ifPersonalInfoSuccess=!1,L.trialMsg="",L.trialResult=0,G())}));const ve=()=>{L.show=!0,L.isAniShow=!0,(async e=>{if(u.defaultData)fe(u.defaultData.find((e=>e.productCode===u.productInfo.productCode)));else{const e=await se({calcProductFactorList:[{planCode:u.dataSource.planCode,productCode:u.productInfo.productCode}]});e.data&&fe(e.data.find((e=>e.productCode===u.productInfo.productCode)))}})()};return a({open:ve,close:R}),r((()=>L.riskIsInsure),(e=>{}),{deep:!0,immediate:!0}),(a,t)=>{const n=A,r=K;return s(),i(c,null,[e.hidePopupButton?y("",!0):(s(),i("div",{key:0,class:j(`trial-button ${a.$attrs.class}`)},[l(H,{"is-share":e.shareInfo.isShare,premium:o(L).trialResult,"share-info":e.shareInfo,"loading-text":o(L).trialMsg,"plan-code":u.dataSource.planCode,"payment-frequency":o(L).mainRiskVO.paymentFrequency+"","tenant-product-detail":e.tenantProductDetail,onHandleClick:ve},{default:d((()=>[k("立即投保")])),_:1},8,["is-share","premium","share-info","loading-text","plan-code","payment-frequency","tenant-product-detail"])],2)),o(L).isAniShow||o(L).show?(s(),m(r,{key:1,class:j(`com-trial-wrap ${a.$attrs.class}`),show:o(L).show,closeable:!1,onClose:R,onClosed:me},{default:d((()=>{var i,r,c,f,V,O,g;return[v("div",Ke,[v("div",qe,[v("span",Me,h(e.title),1),l(n,{name:"cross",onClick:t[0]||(t[0]=e=>o(L).show=!1)})]),v("div",Ne,[e.hideBenefit?y("",!0):(s(),m(Ae,{key:0,class:"benefit-wrap","data-source":S.value,"show-type-list":S.value.showTypList},null,8,["data-source","show-type-list"])),e.dataSource.productFactor?(s(),m(o(B),{key:1,ref:"personalInfoRef",modelValue:o(L).userData,"onUpdate:modelValue":t[1]||(t[1]=e=>o(L).userData=e),"is-trial":"","product-factor":e.dataSource.productFactor,"multi-insured-num":null==(r=null==(i=e.dataSource)?void 0:i.multiInsuredConfigVO)?void 0:r.multiInsuredNum,onTrailChange:X},null,8,["modelValue","product-factor","multi-insured-num"])):y("",!0),l($,{ref_key:"insureInfosRef",ref:p,"origin-data":null==(c=e.dataSource.insureProductRiskVOList)?void 0:c[0],"product-factor":e.dataSource.productFactor,"default-value":o(L).defaultValue?null==(V=null==(f=o(L).defaultValue)?void 0:f.insuredVOList[0].productPlanVOList[o(L).planIndex])?void 0:V.riskVOList[0]:null,onTrialChange:ce},null,8,["origin-data","product-factor","default-value"]),l(z,{"data-source":e.dataSource,"show-main-risk":!1,"default-value":o(L).defaultValue?null==(g=null==(O=o(L).defaultValue)?void 0:O.insuredVOList[0].productPlanVOList[o(L).planIndex])?void 0:g.riskVOList:[],onTrialChange:pe},null,8,["data-source","default-value"]),Be]),F(a.$slots,"default",{trialData:o(L).submitData,riskPremium:C.value},(()=>[l(H,{"is-share":e.shareInfo.isShare,premium:o(L).trialResult,"share-info":e.shareInfo,"loading-text":o(L).trialMsg,"plan-code":u.dataSource.planCode,"payment-frequency":o(L).mainRiskVO.paymentFrequency+"","tenant-product-detail":e.tenantProductDetail,onHandleClick:b},{default:d((()=>[k("立即投保")])),_:1},8,["is-share","premium","share-info","loading-text","plan-code","payment-frequency","tenant-product-detail"])]),!0)])]})),_:3},8,["class","show"])):y("",!0)],64)}}}),[["__scopeId","data-v-6109b60f"]]);export{Ue as T};
