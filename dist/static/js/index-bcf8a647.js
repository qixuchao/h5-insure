import{j as e,d as o,t as a,r as t,o as s,c as l,a as r,b as d,u as c,e as i,F as u,s as n,g as p,_ as v,I as m,k as f,a8 as h,l as g,du as C,aH as y,n as k,f as P,p as L,w as b,dv as _,q as w,v as x,cn as I,aO as V,ar as S,cq as M,aD as j,aE as q,E as O,d3 as $,aA as U,bH as N,aB as T,h as F,i as R,dd as A,c9 as B,m as E,A as z,x as D,bN as H,T as W,z as G,br as J}from"./index-67e7dac2.js";import{P as K}from"./index-765b0e65.js";import{L as Q}from"./index-86d27ce6.js";import{T as X,a as Y}from"./index-0a09cd0a.js";import{P as Z,u as ee}from"./ProductTips-513ead0a.js";import{q as oe,a as ae}from"./proposalList-b4f28894.js";import{P as te}from"./index-7dbd242e.js";import{C as se}from"./index-9e0edfe2.js";import{q as le}from"./trial-68edb64e.js";const re={class:"com-product-item"},de={class:"content-wrap"},ce={class:"product-image"},ie={class:"product-info"},ue={class:"title"},ne={class:"description"},pe={class:"tags"};var ve=v(o({__name:"productItem",props:{productInfo:{default:()=>({})},errorMsg:{default:""}},setup(e){const o=e,{productInfo:v}=a(o),f=t({checked:!1});return a(f),(e,o)=>{var a,t,f,h,g;const C=m;return s(),l("div",re,[r("div",de,[r("div",ce,[d(C,{src:(null==(a=c(v).showConfig)?void 0:a.fileThumbnailUrl)||(null==(t=c(v).showConfig)?void 0:t.fileUrl)},null,8,["src"])]),r("div",ie,[r("p",ue,i(null==(f=c(v).showConfig)?void 0:f.title),1),r("p",ne,i(null==(h=c(v).showConfig)?void 0:h.text),1),r("p",pe,[(s(!0),l(u,null,n(null==(g=c(v).showConfig)?void 0:g.tags,((e,o)=>(s(),l("span",{key:o,class:"tag"},i(e),1)))),128))])]),p(e.$slots,"checkedProduct",{},void 0,!0)]),d(Z,{"error-msg":e.errorMsg},null,8,["error-msg"])])}}}),[["__scopeId","data-v-002f53ee"]]);const me=["xlink:href"],fe=o({__name:"index",props:{name:{type:String,required:!0},color:{type:String,default:""}},setup(e){const o=e,a=f((()=>`#icon-${o.name}`)),t=f((()=>o.name?`svg-icon icon-${o.name}`:"svg-icon"));return(o,d)=>(s(),l("svg",h({class:c(t)},o.$attrs,{style:{color:e.color}}),[r("use",{"xlink:href":c(a)},null,8,me)],16))}});const he=e=>(j("data-v-88e3365a"),e=e(),q(),e),ge={class:"com-tab-filter"},Ce={class:"article-mid"},ye={class:"article-tag"},ke=["onClick"],Pe=he((()=>r("span",null,null,-1))),Le={class:"popup-inner"},be=he((()=>r("div",{class:"popup-title"},"保险公司",-1))),_e={class:"footer-button"};var we=v(o({__name:"insureFilter",props:{tagList:{type:Array,default:()=>[]},filter:{type:Boolean,default:!1},popupStyle:{type:Object,default:()=>{}}},emits:["onSelectInsure"],setup(o,{emit:p}){const v=o,{isPopShow:m,openPop:f,closePop:h}=function(o=!1){const a=e(o);return{isPopShow:a,openPop:e=>{e instanceof Function&&e(),a.value=!0},closePop:e=>{a.value=!1,e instanceof Function&&e()}}}(!1),j=t({insureList:[],checkedInsure:[],productCategoryList:[]}),{insureList:q,checkedInsure:O}=a(j),$=e(""),U=()=>{O.value=[]},N=()=>{var e;const{productCategoryId:o}=(null==(e=j.productCategoryList)?void 0:e[$.value])||{};p("onSelectInsure",{selectInsureCode:O.value,selectCategory:o}),h()};g((()=>{v.filter&&C().then((e=>{const{code:o,data:a}=e;"10000"===o&&(q.value=null==a?void 0:a.map((e=>({label:e.abbreviation,value:e.insurerCode}))))}))})),y((()=>{oe().then((e=>{const{code:o,data:a}=e||{};"10000"===o&&V(a)&&(j.productCategoryList=[{productCategoryName:"全部",productCategoryId:""},...a])}))}));const T=e();return g((()=>{T.value=document.querySelector(".page-proposal")})),(e,a)=>{const t=S,v=M;return s(),l("div",ge,[r("div",Ce,[r("div",ye,[(s(!0),l(u,null,n(c(j).productCategoryList,((e,o)=>(s(),l("div",{key:o,class:k(["tag-item",{checked:c($)==o}]),onClick:a=>((e,o)=>{var a;$.value=o;const{productCategoryId:t}=(null==(a=j.productCategoryList)?void 0:a[$.value])||{};p("onSelectInsure",{selectInsureCode:O.value,selectCategory:t})})(null==e||e.productCategoryId,o)},[r("div",{class:k(["tag-out",{checked:c($)==o}])},[r("div",{class:k(["tag-item-text",{checked:c($)==o}])},i(e.productCategoryName),3)],2)],10,ke)))),128))]),o.filter?(s(),l("div",{key:0,class:"filter",onClick:a[0]||(a[0]=(...e)=>c(f)&&c(f)(...e))},[Pe,r("div",{class:k(["text",{"has-select-condition":c(O).length>0}])},"筛选",2),d(fe,{name:"filter"})])):P("",!0),c(T)?(s(),L(v,{key:1,show:c(m),position:"right","close-on-click-overlay":"",class:"proposal-list-filter-popup-wrap",style:I(o.popupStyle),onClickOverlay:c(h)},{default:b((()=>[r("div",Le,[be,d(_,{modelValue:c(O),"onUpdate:modelValue":a[1]||(a[1]=e=>w(O)?O.value=e:null),options:c(q)},null,8,["modelValue","options"])]),r("div",_e,[d(t,{plain:"",type:"primary",onClick:U},{default:b((()=>[x("重置")])),_:1}),d(t,{type:"primary",onClick:N},{default:b((()=>[x("确定")])),_:1})])])),_:1},8,["show","style","onClickOverlay"])):P("",!0)])])}}}),[["__scopeId","data-v-88e3365a"]]);const xe={class:"com-trial-product-wrapper"},Ie={class:"container"},Ve=(e=>(j("data-v-49f70a68"),e=e(),q(),e))((()=>r("span",{class:"title"}," 已选产品 ",-1))),Se={class:"popup-body"},Me={class:"cell-title"},je={class:"title"},qe=o({name:"TrialProductPopup"});var Oe=v(o({...qe,props:{isShow:{type:Boolean,default:!1},proposalList:{default:()=>[]},modalValue:{default:()=>[]}},emits:["close","update:modalValue","checked"],setup(o,{emit:a}){const t=o,p=e([]),v=e([]),m=e({isShow:t.isShow}),f=()=>{a("close")},h=()=>{v.value=[],a("checked",[])},g=e=>{var o,t,s;null==(s=null==(t=null==(o=null==p?void 0:p.value)?void 0:o[e])?void 0:t.toggle)||s.call(t),a("checked",v.value)};return O((()=>t.isShow),(e=>{m.value.isShow=e})),O(v,((e=[])=>{a("update:modalValue",e)}),{deep:!0,immediate:!0}),O((()=>t.modalValue),((e=[])=>{v.value=e}),{deep:!0,immediate:!0}),(e,o)=>{const a=U,t=N,C=se,y=T,k=M;return s(),l("div",xe,[d(k,{show:c(m).isShow,"onUpdate:show":o[1]||(o[1]=e=>c(m).isShow=e),position:"bottom",onClose:f},{default:b((()=>[r("div",Ie,[r("div",{class:"popup-header"},[r("span",{class:"clear-all",onClick:h}," 清空选项 "),Ve,r("span",{class:"close",onClick:f})]),r("div",Se,[d(y,{modelValue:c(v),"onUpdate:modelValue":o[0]||(o[0]=e=>w(v)?v.value=e:null)},{default:b((()=>[d(C,{inset:""},{default:b((()=>[(s(!0),l(u,null,n(e.proposalList,(e=>(s(),L(t,{key:e.productCode,title:e.productName,onClick:o=>g(e.productCode)},{"right-icon":b((()=>{var o;return[d(a,{ref_for:!0,ref:o=>c(p)[e.productCode]=o,shape:"square","model-value":null==(o=c(v))?void 0:o.includes(e.productCode),name:e.productCode,onClick:$((o=>g(e.productCode)),["stop"])},null,8,["model-value","name","onClick"])]})),title:b((()=>[r("div",Me,[r("div",je,i(e.productName),1)])])),_:2},1032,["title","onClick"])))),128))])),_:1})])),_:1},8,["modelValue"])])])])),_:1},8,["show"])])}}}),[["__scopeId","data-v-49f70a68"]]);const $e={class:"page-proposal-list"},Ue={class:"check-button"},Ne={key:1,class:"van-sticky"},Te={class:"add-plan"},Fe={class:"has-select-product"},Re=(e=>(j("data-v-a3bf660a"),e=e(),q(),e))((()=>r("span",{class:"icon"},null,-1))),Ae=o({name:"ProposalList"});var Be=v(o({...Ae,props:{isCreateProposal:{type:Boolean,default:!0}},setup(o){const p=ee(),v=F(),m=R(),{isCreateProposal:h,productClass:g}=m.query,C=A(),k=t({searchValue:"",tagLists:[],isOpen:!0,loading:!1,finished:!1,refreshing:!1,productList:[],selectProduct:[],insurerCodeList:[],showCategory:"",productTotal:0,checked:"",productCode:void 0,proposalList:[],showFooter:!0,productName:"",productCodeList:[],errorMsgMap:{},excludeProductCodeList:[],isCreateProposal:!1,selectedProductList:[],excludeMainRiskCode:[],firstLoading:!0}),{searchValue:_,tagLists:I,isOpen:V,loading:M,finished:j,refreshing:q,productList:O,selectProduct:$,insurerCodeList:N,showCategory:T,productTotal:Z,showFooter:oe}=a(k);B();const[se,re]=B(),de=e(+(g||1)),ce=f((()=>{const e=p.$state.insuredPersonVO||{};return Object.keys(e).length?[e]:[]})),ie=()=>{const{excludeProductCodeList:e}=k;k.firstLoading&&W.loading("加载中..."),ae({productName:_.value,insurerCodeList:N.value,productClass:de.value,showCategory:T.value,selectProductCodes:Array.isArray(e)?e:[],selectRiskCodes:k.excludeMainRiskCode||[],insuredList:ce.value,holder:p.$state.holder,pageNum:1,pageSize:999}).then((e=>{const{code:o,data:a,total:t}=e;"10000"===o&&(O.value=a,Z.value=t)})).finally((()=>{W.clear(),k.firstLoading=!1}))},ue=e=>{ie()},ne=e=>{const{selectInsureCode:o,selectCategory:a}=e;N.value=o,T.value=a,ie()},pe=()=>{q.value&&(O.value=[],q.value=!1),ie(),M.value=!1,Z.value===O.value.length&&(j.value=!0)},me=()=>{v.push({path:"historyProposalList"})};f((()=>{var e;const{birthday:o,gender:a}=(null==(e=p.$state.proposalInfo.proposalInsuredList)?void 0:e[0])||{};return{birthday:o,gender:a}}));const fe=f((()=>O.value.length>0)),he=({productCode:e})=>h?(k.productCode=e,k.selectProduct.includes(e)?(k.selectProduct=k.selectProduct.filter((o=>o!==e)),!1):void(async(e,o)=>{const{code:a,data:t,message:s}=await le({...p.$state.insuredPersonVO,calcProductFactorList:[{productCode:e}]},{isCustomError:!0});"10000"===a?(k.errorMsgMap[e]="","function"==typeof o&&o(!0)):k.errorMsgMap[e]=s})(e,(()=>{k.selectProduct.push(e)}))):(v.push({path:"/proposal/createProposal",query:{productCode:e}}),!1),ge=e=>{k.selectProduct=e,k.selectedProductList=k.selectedProductList.filter((o=>e.includes(o.productCode)))},Ce=()=>{const e=k.proposalList.filter((e=>k.selectProduct.includes(e.proposalInsuredList[0].proposalInsuredProductList[0].productCode)));p.setTrialData(e),p.setSelectedProduct(k.selectProduct),p.setSelectedProductList(k.selectedProductList),v.back()},ye=()=>{j.value=!0,M.value=!0,pe()};return y((()=>{k.excludeProductCodeList=p.$state.excludeProduct,k.excludeMainRiskCode=p.$state.excludeMainRiskCode})),(e,o)=>{const a=X,t=Y,p=G,v=U,m=Q,f=K,y=S,I=E("ProPageWrap"),V=J;return s(),L(V,{"theme-vars":c(C)},{default:b((()=>[d(I,{class:"page-proposal"},{default:b((()=>[d(p,{modelValue:c(_),"onUpdate:modelValue":o[1]||(o[1]=e=>w(_)?_.value=e:null),placeholder:"请输入计划书名称",onSearch:ue},{default:b((()=>[d(we,{"filter-class":"filter-area",onOnSelectInsure:ne}),d(t,{modelValue:c(de),"onUpdate:modelValue":o[0]||(o[0]=e=>w(de)?de.value=e:null),disabled:"","active-color":"var(--van-primary-color)","inactive-color":"black",fixed:!1,"before-change":()=>!c(g),onChange:ie},{default:b((()=>[d(a,{name:1},{default:b((()=>[x("非组合计划书")])),_:1}),d(a,{name:4},{default:b((()=>[x("组合计划书")])),_:1})])),_:1},8,["modelValue","before-change"])])),_:1},8,["modelValue"]),c(fe)||c(k).firstLoading?P("",!0):(s(),L(z,{key:0,"empty-img":c(D),title:"没有找到相关内容~","empty-class":"empty-select"},null,8,["empty-img"])),r("div",$e,[d(f,{modelValue:c(q),"onUpdate:modelValue":o[3]||(o[3]=e=>w(q)?q.value=e:null),onRefresh:ye},{default:b((()=>[d(m,{loading:c(M),"onUpdate:loading":o[2]||(o[2]=e=>w(M)?M.value=e:null),finished:c(j),"finished-text":c(fe)?"- 已经到底了哦 -":"",onLoad:pe},{default:b((()=>[(s(!0),l(u,null,n(c(O),(e=>(s(),L(ve,{key:e.id,"product-info":e,"error-msg":c(k).errorMsgMap[e.productCode],onClick:o=>he(e)},H({_:2},[c(h)?{name:"checkedProduct",fn:b((()=>[r("div",Ue,[(s(),L(v,{key:e.id,name:e.productCode,"model-value":c(k).selectProduct.includes(e.productCode),shape:"square",onChange:o=>((e,o)=>{e?k.selectedProductList.push(o):k.selectedProductList=k.selectedProductList.filter((e=>e.productCode!==o.productCode))})(o,e)},null,8,["name","model-value","onChange"]))])])),key:"0"}:void 0]),1032,["product-info","error-msg","onClick"])))),128))])),_:1},8,["loading","finished","finished-text"])])),_:1},8,["modelValue"])]),c(h)&&c(oe)?(s(),l("div",Ne,[r("div",Te,[r("p",{class:"has-select",onClick:o[4]||(o[4]=e=>c(re)(!c(se)))},[x(" 已选"),r("span",Fe,i(c(k).selectProduct.length),1),x("款产品 "),Re]),d(y,{type:"primary",disabled:!c(k).selectProduct.length,onClick:Ce},{default:b((()=>[x("添加到计划书")])),_:1},8,["disabled"])])])):P("",!0),d(Oe,{"modal-value":c(k).selectProduct,"proposal-list":c(k).selectedProductList,"is-show":c(se),onClose:o[5]||(o[5]=e=>c(re)(!1)),onChecked:ge},null,8,["modal-value","proposal-list","is-show"])])),_:1}),c(h)?P("",!0):(s(),L(te,{key:0,"button-image":c("/static/png/lishijihuashu-b6958e78.png"),onClick:me},null,8,["button-image"]))])),_:1},8,["theme-vars"])}}}),[["__scopeId","data-v-a3bf660a"]]);export{Be as default};
