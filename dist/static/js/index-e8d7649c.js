import{d as e,I as a,$ as t,b as s,c as i,e as l,i as o,r as n,v as r,w as u,W as d,X as c,Y as p,a9 as v,f,g as m,x as k,aa as h,bE as V,Z as O,ad as y,z as L,Q as g,B as b,bF as I,bG as C,U as R,V as S,u as x,a as P,t as w,aG as D,T,o as _,y as j,h as E,am as F,ae as A,C as K,P as M}from"./index-3300826d.js";import{l as B,P as $,I as q,a as N}from"./index-8a71e66b.js";import"./infoCollection-aa0e608b.js";import{_ as U}from"./TrialButton-6ad69654.js";import{P as W,d as z}from"./utils-5bf67951.js";import{Z as G}from"./index-34a98020.js";import{S as H,_ as J}from"./box-title-e323f85f.js";import{_ as Z}from"./index-193bab3c.js";import{T as Q}from"./Table-be8cdc6c.js";import{p as X,b as Y,c as ee,q as ae}from"./trial-fa78661d.js";import{u as te}from"./useOrder-2c46487b.js";import{f as se}from"./utils-e5bca207.js";import{t as ie}from"./utils-a8052624.js";import{B as le,P as oe}from"./constants-7afb7c3d.js";import{n as ne}from"./nextStep-576c2fe1.js";import{p as re}from"./pageJump-ce50f880.js";const ue={class:"benefit-table"},de=e({name:"benefitTable"}),ce=e({...de,props:{dataSource:null},setup(e){const n=e,r=a((()=>{const e=n.dataSource.headers.length,a=12*n.dataSource.headers.join("").length+20*n.dataSource.headers.length;return n.dataSource.headers.map(((t,s)=>{const i=a>320?12*t.length+20:Math.max(12*t.length+20,320/e);return console.log("totalWordWidth:",a,"titleWidth:",i,"word-width:",12*t.length+20),{title:t,key:`header_${s}`,fixed:s<2,minWidth:i}}))})),u=a((()=>n.dataSource.dataList.map((e=>{const a={};return e.forEach(((e,t)=>{a[`header_${t}`]=e})),a}))));return t((()=>{})),(e,a)=>(s(),i("div",ue,[l(Q,{"top-height":400,columns:o(r),data:o(u),"is-clone":!0},null,8,["columns","data"])]))}});const pe=e=>(R("data-v-71e6c361"),e=e(),S(),e),ve={key:0,class:"benefit-container"},fe={key:0,class:"benefit"},me=pe((()=>f("div",{class:"line"},null,-1))),ke={class:"box-title box-title-chart"},he=pe((()=>f("img",{class:"tl",src:J,alt:""},null,-1))),Ve=pe((()=>f("img",{class:"transform-z180 tr",src:J,alt:""},null,-1))),Oe={key:0},ye={class:"box"},Le={class:"box-title"},ge=pe((()=>f("img",{class:"tl",src:J,alt:""},null,-1))),be=pe((()=>f("img",{class:"transform-z180 tr",src:J,alt:""},null,-1))),Ie={class:"box-price"},Ce={class:"text1"},Re={class:"text2"},Se={key:1},xe={key:2,style:{width:"100%, minWidth: 338px"}},Pe={class:"slider"},we={style:{flex:"1",margin:"0px 5px"}},De={class:"custom-button"},Te=pe((()=>f("p",{class:"slider-dec"},"拖动按钮查看不同年龄保障",-1))),_e={class:"btn-two"},je={key:1},Ee=e({name:"benefit"});var Fe=L(e({...Ee,props:{dataSource:{default:()=>({showTypeList:["1"]})}},setup(e){var a;const t=e,L="1",R="2",S="3",x=n(0),P=n(0),w=n(0),D=n(),T=n(0),_=n(null==(a=t.dataSource.showTypeList)?void 0:a[0]),j=n(),E=e=>{if(!(null==e?void 0:e.benefitRiskResultVOList))return;const a=null==e?void 0:e.benefitRiskResultVOList[x.value];P.value=a.ageBegin+1,T.value=a.ageBegin+1,w.value=a.ageEnd},F=()=>{var e,a,s,i,l,o;const n=null==(a=null==(e=t.dataSource)?void 0:e.benefitRiskResultVOList)?void 0:a[x.value];j.value=null==(l=null==(i=null==(s=t.dataSource)?void 0:s.benefitRiskResultVOList)?void 0:i[x.value].benefitRiskTableResultVOList)?void 0:l[0];const{a:r,year:u}=((e,a)=>{const t=[],s=[];for(let i=e,l=0;i<=a;i++,l++)t.push(i.toString()),s.push(l+1);return{a:t,year:s}})(P.value,w.value),d={index:r.indexOf(T.value.toString()),age:r,year:u,result:null==(o=null==n?void 0:n.benefitRiskItemResultVOList)?void 0:o[0]};D.value=d},A=()=>{T.value>w.value-1||(T.value+=1,F())},K=()=>{T.value>P.value&&(T.value-=1,F())},M=e=>{x.value=e.name,E(t.dataSource),F()};return r((()=>t.dataSource),(e=>{var a;e&&(E(e),F(),_.value=null==(a=e.showTypeList)?void 0:a[0])}),{deep:!0,immediate:!0}),r(T,(()=>{F()})),(a,n)=>{var r;const E=g,F=H,B=b,$=I,q=C,N=G;return(null==(r=e.dataSource)?void 0:r.benefitRiskResultVOList)?(s(),i("div",ve,[l(q,{active:o(x),onClickTab:M},{default:u((()=>{var e;return[(s(!0),i(d,null,c(null==(e=t.dataSource)?void 0:e.benefitRiskResultVOList,((e,a)=>(s(),p($,{key:a,name:a,title:e.riskName},{default:u((()=>{var e,r,g,b,I,C,M,$,q,N,U,W,z,G,H,J;return[a==o(x)?(s(),i("div",fe,[me,v(f("p",ke,[he,m(" 保单年度"),f("span",null,k(null==(g=null==(e=o(D))?void 0:e.year)?void 0:g[null==(r=o(D))?void 0:r.index]),1),m("年度，被保人"),f("span",null,k(null==(C=null==(b=o(D))?void 0:b.age)?void 0:C[null==(I=o(D))?void 0:I.index]),1),m("岁时 "),Ve],512),[[h,o(_)===R]]),o(_)===L?(s(),i("div",Oe,[f("div",ye,[f("p",Le,[ge,m(" 保单年度"),f("span",null,k(null==(q=null==(M=o(D))?void 0:M.year)?void 0:q[null==($=o(D))?void 0:$.index]),1),m("年度，被保人"),f("span",null,k(null==(W=null==(N=o(D))?void 0:N.age)?void 0:W[null==(U=o(D))?void 0:U.index]),1),m("岁时 "),be]),f("div",Ie,[(s(!0),i(d,null,c(null==(G=null==(z=o(D))?void 0:z.result)?void 0:G.headers,((e,a)=>{var t,l,n,r,u,d,c,p,v,m;return s(),i("div",{key:a,style:{width:"33%"}},[f("p",Ce,k("0"==(null==(u=null==(r=null==(l=null==(t=o(D))?void 0:t.result)?void 0:l.dataList)?void 0:r[null==(n=o(D))?void 0:n.index])?void 0:u[a])?"0":o(V)(Number(null==(m=null==(v=null==(c=null==(d=o(D))?void 0:d.result)?void 0:c.dataList)?void 0:v[null==(p=o(D))?void 0:p.index])?void 0:m[a]))),1),f("p",Re,k(e)+"(元）",1)])})),128))])])])):O("",!0),o(_)===S?(s(),i("div",Se,[l(ce,{"data-source":o(j)},null,8,["data-source"])])):O("",!0),o(_)==R?(s(),i("div",xe,[l(Z,{min:o(P),max:o(w),current:o(T),data:null==(J=null==(H=o(D))?void 0:H.result)?void 0:J.benefitRiskItemList},null,8,["min","max","current","data"])])):O("",!0),o(_)!=S?(s(),i(d,{key:3},[f("div",Pe,[f("div",{class:"opt lf",onClick:K},[l(E,{name:"minus"})]),f("div",we,[o(P)?(s(),p(F,{key:0,modelValue:o(T),"onUpdate:modelValue":n[0]||(n[0]=e=>y(T)?T.value=e:null),min:o(P),max:o(w),"bar-height":"8px"},{button:u((()=>[f("div",De,k(o(T))+" 岁",1)])),_:1},8,["modelValue","min","max"])):O("",!0)]),f("div",{class:"opt rg",onClick:A},[l(E,{name:"plus"})])]),Te],64)):O("",!0),f("div",_e,[t.dataSource.showTypeList.includes(L)?(s(),p(B,{key:0,round:"",plain:o(_)!==L,type:"primary",class:"btn",onClick:n[1]||(n[1]=e=>_.value=L)},{default:u((()=>[m("图表展示")])),_:1},8,["plain"])):O("",!0),t.dataSource.showTypeList.includes(R)?(s(),p(B,{key:1,round:"",plain:o(_)!==R,type:"primary",class:"btn",onClick:n[2]||(n[2]=e=>_.value=R)},{default:u((()=>[m("趋势展示")])),_:1},8,["plain"])):O("",!0),t.dataSource.showTypeList.includes(S)?(s(),p(B,{key:2,round:"",plain:o(_)!==S,type:"primary",class:"btn",onClick:n[3]||(n[3]=e=>_.value=S)},{default:u((()=>[m("表格展示")])),_:1},8,["plain"])):O("",!0)])])):O("",!0)]})),_:2},1032,["name","title"])))),128))]})),_:1},8,["active"])])):(s(),i("div",je,[l(N,{title:"试算前请完善投保信息","empty-class":"empty-select"})]))}}}),[["__scopeId","data-v-71e6c361"]]);const Ae={class:"com-body"},Ke={class:"header"},Me={class:"header-title"},Be={class:"container"},$e=(e=>(R("data-v-0fb3960b"),e=e(),S(),e))((()=>f("div",{class:"empty"},null,-1))),qe=e({name:"TrialPop"});var Ne=L(e({...qe,props:{dataSource:{default:()=>[]},productInfo:{default:()=>({productCode:"",productName:"",insurerCode:"",tenantId:""})},shareInfo:{default:()=>({})},tenantProductDetail:{default:()=>({})},hideBenefit:{type:Boolean,default:!1},title:{default:"算一算保费"}},setup(e,{expose:a}){const c=e,v=n(null),h=x();P();const{tenantId:V}=h.query,y=w({loading:!1,show:!1,select:{},list:[],userData:{},riskIsInsure:{},submitData:{},riskVOList:[{}],mainRiskVO:{},ifPersonalInfoSuccess:!1,trialMsg:"",trialResult:0,isAniShow:!1,defaultValue:null,isAutoChange:!1}),L=te(),g=n(),I=n(),C=()=>{var e;null==(e=v.value)||e.validate().then((()=>{Object.assign(L.value,{extInfo:{...L.value.extInfo,buttonCode:le.TRIAL_PREMIUM,pageCode:oe.TRIAL_PREMIUM}});const e=((e={},a={},t={})=>{var s,i;const l={...t},{tenantOrderHolder:o,tenantOrderInsuredList:n}=se({holder:null==(s=y.submitData.holder)?void 0:s.personVO,insuredList:(y.submitData.insuredVOList||[]).map((e=>e.personVO))}),r={tenantId:V,riskList:(null==(i=l.tenantOrderInsuredList[0])?void 0:i.tenantOrderProductList[0].riskVOList)||[],riskPremium:a,productId:e.id};return l.extInfo.iseeBizNo=g.value,l.productCode=e.productCode,l.commencementTime=l.insuranceStartDate,l.expiryDate=l.insuranceEndDate,l.premium=y.trialResult,l.orderAmount=y.trialResult,l.orderRealAmount=y.trialResult,l.tenantOrderHolder=o,l.tenantOrderInsuredList=n.map((a=>({...a,certType:a.certType||K.CERT,certNo:(a.certNo||"").toLocaleUpperCase(),planCode:c.dataSource.planCode,tenantOrderProductList:[{premium:y.trialResult,productCode:e.productCode,productName:e.productName,planCode:c.dataSource.planCode,tenantOrderRiskList:ie(r)}]}))),l})(c.productInfo,I.value,L.value);ne(e,((e,a)=>{a===M.JUMP_PAGE&&re(e.nextPageCode,h.query)})),console.log("---- validate success ----")})),y.loading=!1,y.show=!0,y.isAniShow=!0},R=()=>{y.show=!1,y.loading=!1},S=n({}),G=["annuityDrawDate","coveragePeriod","chargePeriod"],H=()=>{var e,a;y.riskIsInsure={},null==(a=null==(e=null==c?void 0:c.dataSource)?void 0:e.insureProductRiskVOList)||a.forEach((e=>{var a;const t=null==(a=c.dataSource.productRiskRelationVOList)?void 0:a.find((a=>a.collocationRiskId===e.riskId));t&&(y.riskIsInsure[e.riskCode]={selected:"2",data:null,relation:t})}))},J=e=>{var a,t,s,i,l,o;if(null==(t=null==(a=null==e?void 0:e.data)?void 0:a[0])?void 0:t.productRiskDyInsureFactorVOList){const a=[];if(null==(s=c.dataSource)||s.insureProductRiskVOList.forEach((t=>{var s,i;const l=null==(i=null==(s=null==e?void 0:e.data)?void 0:s[0])?void 0:i.productRiskDyInsureFactorVOList.find((e=>e.riskCode===t.riskCode));if(l){t.productRiskInsureLimitVO={...t.productRiskInsureLimitVO,...l};const e=y.riskVOList.find((e=>e.riskCode===t.riskCode));let s=!1;N.forEach((a=>{if(G.indexOf(a.valueKey)>=0){const i=t.productRiskInsureLimitVO[a.configKey];if(i&&e){const t=i.find((t=>t.code===e[a.valueKey]));if(t&&2===t.useFlag){const t=i.find((e=>1===e.defaultFlag));e[a.valueKey]=t.code,s=!0}}}})),s&&a.push({...e,...l,riskCode:t.riskCode})}})),a.length>0&&(null==(o=null==(l=null==(i=y.defaultValue)?void 0:i.insuredVOList)?void 0:l[0])?void 0:o.productPlanVOList))return a.forEach((e=>{var a,t,s;y.defaultValue.insuredVOList[0].productPlanVOList=null==(s=null==(t=null==(a=y.defaultValue)?void 0:a.insuredVOList)?void 0:t[0])?void 0:s.productPlanVOList.map((a=>(a.riskCode===e.riskCode&&(a=e),a)))})),!1}return!0},Z=B.exports.debounce((()=>{y.ifPersonalInfoSuccess&&(y.submitData.productCode=c.productInfo.productCode,y.submitData.tenantId=c.productInfo.tenantId,y.riskVOList=y.riskVOList.map((e=>(e=>{var a,t,s,i;const l=null==(a=c.dataSource.insureProductRiskVOList)?void 0:a.find((a=>e.riskId===a.riskId));if(l&&1!==l.mainRiskFlag){const a=null==(s=null==(t=c.dataSource)?void 0:t.productRiskRelationVOList)?void 0:s.find((e=>e.collocationRiskId===l.riskId));if(a){const t=null==(i=y.riskVOList)?void 0:i.find((e=>e.riskId===a.riskId));N.forEach((a=>{a.ruleKey&&l.productRiskInsureLimitVO&&t&&(1===l.productRiskInsureLimitVO[a.ruleKey]&&(e[a.valueKey]=t[a.valueKey]),3===l.productRiskInsureLimitVO[a.ruleKey]&&(e[a.valueKey]=z(l,t[a.valueKey],y.submitData)))}))}}return e})(e))),y.submitData.insuredVOList[0].productPlanVOList=[{insurerCode:c.productInfo.insurerCode,planCode:c.dataSource.planCode,riskVOList:y.riskVOList}],console.log(">>>数据构建<<<",y.submitData),y.trialMsg="试算中...",y.trialResult=0,y.loading=!0,X(y.submitData).then((e=>{var a,t;if(e.data&&e.code===D){(null==(a=null==e?void 0:e.data)?void 0:a.errorInfo)&&T(`${null==(t=null==e?void 0:e.data)?void 0:t.errorInfo}`),y.trialMsg="",y.trialResult=e.data.premium;const s={};e.data.riskPremiumDetailVOList&&e.data.riskPremiumDetailVOList.length&&e.data.riskPremiumDetailVOList.forEach((e=>{s[e.riskCode]={premium:e.premium,amount:e.amount}})),I.value=s}})).finally((()=>{y.loading=!1})),Y(y.submitData).then((e=>{e.data&&e.code===D&&(S.value=e.data)})).finally((()=>{y.loading=!1})))}),300),Q=async e=>{var a;const{holder:t,insuredVOList:s,isFirstInsuredChange:i}=e;if(t&&(y.submitData.holder={personVO:{...t,socialFlag:t.hasSocialInsurance}}),s&&s.length>0&&s.forEach(((e,a)=>{y.submitData.insuredVOList&&y.submitData.insuredVOList.length>a?y.submitData.insuredVOList[a].personVO={...e.personVO,socialFlag:e.personVO.hasSocialInsurance}:y.submitData.insuredVOList=[{personVO:{...e.personVO,socialFlag:e.personVO.hasSocialInsurance}}]})),y.ifPersonalInfoSuccess=!0,i){console.log("处理第一被保人修改的dy变化");const e=await ee({calcProductFactorList:[{planCode:c.dataSource.planCode,productCode:c.productInfo.productCode,riskEditVOList:[{insureProductRiskVO:null==(a=c.dataSource.insureProductRiskVOList)?void 0:a[0]}]}],...s[0].personVO});if(!J(e))return}console.log("投被保人的信息回传 ",y.submitData,e),Z()},ue=async(e,a)=>{var t,s,i,l;if(a){const o=B.exports.cloneDeep(e);delete o.insurancePeriodValueList,delete o.liabilityVOList,delete o.paymentFrequencyList,delete o.paymentPeriodValueList;if(G.indexOf(a.key)>=0){const n={};switch(a.key){case"annuityDrawDate":n.changeType=3;break;case"coveragePeriod":n.changeType=2;break;case"chargePeriod":n.changeType=1}const r=null==(s=null==(t=y.submitData)?void 0:t.insuredVOList)?void 0:s[0].personVO,u=null==(l=null==(i=c.dataSource)?void 0:i.insureProductRiskVOList)?void 0:l.find((a=>a.riskCode===e.riskCode));if(!y.isAutoChange){const a=await ee({calcProductFactorList:[{planCode:c.dataSource.planCode,productCode:c.productInfo.productCode,riskEditVOList:[{insureProductRiskVO:u,insureRiskEditReqVO:{riskId:e.riskId,riskCode:e.riskCode,...o,...n}}]}],...r}),t=J(a);return t||(y.isAutoChange=!0),t}y.isAutoChange=!1}}return!0},de=async(e,a)=>{y.mainRiskVO=e;await ue(e,a)&&(y.riskVOList.length>0&&(y.riskVOList[0]=e),console.log("标准险种的信息回传",e),Z())},ce=async(e,a)=>{if(y.riskVOList=[y.mainRiskVO,...e],console.log("附加险列表数据回传",e),a){console.log("-change data = ",a);const t=e.find((e=>e.riskCode===a.riskCode));if(!(await ue(t,a)))return}Z()},pe=()=>{y.isAniShow=!1},ve=async e=>{const a=await ae({calcProductFactorList:[{planCode:c.dataSource.planCode,productCode:c.productInfo.productCode}]});var t,s;a.data&&(t=a.data.find((e=>e.productCode===c.productInfo.productCode)),y.userData=t,y.defaultValue=t,console.log("-----data = ",null==(s=y.defaultValue)?void 0:s.insuredVOList[0].productPlanVOList[0]))};_((()=>{H()})),t((()=>{y.loading=!0})),r((()=>y.show),(e=>{e&&(y.select={},y.list=[],y.userData={},y.riskIsInsure={},y.submitData={},y.riskVOList=[{}],y.mainRiskVO={},y.ifPersonalInfoSuccess=!1,y.trialMsg="",y.trialResult=0,H())}));const fe=()=>{y.show=!0,y.isAniShow=!0,ve()};return a({open:fe}),r((()=>y.riskIsInsure),(e=>{}),{deep:!0,immediate:!0}),(a,t)=>{const n=b,r=F,h=A;return s(),i(d,null,[f("div",{class:j(`trial-button ${a.$attrs.class}`)},[l(n,{type:"primary",onClick:fe},{default:u((()=>[m("立即投保")])),_:1})],2),o(y).isAniShow||o(y).show?(s(),p(h,{key:0,class:j(`com-trial-wrap ${a.$attrs.class}`),show:o(y).show,closeable:!1,onClose:R,onClosed:pe},{default:u((()=>{var i,n,d;return[f("div",Ae,[f("div",Ke,[f("span",Me,k(e.title),1),l(r,{name:"cross",onClick:t[0]||(t[0]=e=>o(y).show=!1)})]),f("div",Be,[e.hideBenefit?O("",!0):(s(),p(Fe,{key:0,class:"benefit-wrap","data-source":S.value,"show-type-list":S.value.showTypList},null,8,["data-source","show-type-list"])),e.dataSource.productFactor?(s(),p(o($),{key:1,ref:"personalInfoRef",modelValue:o(y).userData,"onUpdate:modelValue":t[1]||(t[1]=e=>o(y).userData=e),"is-trial":"","product-factor":e.dataSource.productFactor,onTrailChange:Q},null,8,["modelValue","product-factor"])):O("",!0),l(q,{ref_key:"insureInfosRef",ref:v,"origin-data":null==(i=e.dataSource.insureProductRiskVOList)?void 0:i[0],"product-factor":e.dataSource.productFactor,"default-value":o(y).defaultValue?null==(n=o(y).defaultValue)?void 0:n.insuredVOList[0].productPlanVOList[0]:null,onTrialChange:de},null,8,["origin-data","product-factor","default-value"]),l(W,{"data-source":e.dataSource,"show-main-risk":!1,"default-value":o(y).defaultValue?null==(d=o(y).defaultValue)?void 0:d.insuredVOList[0].productPlanVOList:[],onTrialChange:ce},null,8,["data-source","default-value"]),$e]),E(a.$slots,"default",{},(()=>[l(U,{"is-share":e.shareInfo.isShare,premium:o(y).trialResult,"share-info":e.shareInfo,"loading-text":o(y).trialMsg,"plan-code":c.dataSource.planCode,"payment-frequency":o(y).mainRiskVO.paymentFrequency+"","tenant-product-detail":e.tenantProductDetail,onClick:C},{default:u((()=>[m("立即投保")])),_:1},8,["is-share","premium","share-info","loading-text","plan-code","payment-frequency","tenant-product-detail"])]),!0)])]})),_:3},8,["class","show"])):O("",!0)],64)}}}),[["__scopeId","data-v-0fb3960b"]]);export{Ne as T};
