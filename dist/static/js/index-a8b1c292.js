var z=Object.defineProperty,J=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var H=(r,t,a)=>t in r?z(r,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[t]=a,L=(r,t)=>{for(var a in t||(t={}))Y.call(t,a)&&H(r,a,t[a]);if(q)for(var a of q(t))K.call(t,a)&&H(r,a,t[a]);return r},S=(r,t)=>J(r,W(t));import{g as T,E as g,M,_ as X,r as h,j as y,k as E,m as N,p as D,A as o,z as f,J as Q,L as R,T as x,O as Z,a9 as ee,h as te,n as ae,G as oe,F as ne,C as ue}from"./vendor-06835924.js";import{R as se}from"./infoCollection-b0426750.js";import{s as re,c as le}from"./phoneVerify-5a9daa2e.js";import{v as $,a as j,b as ie}from"./validator-ebd71d12.js";import{F as P,g as ce}from"./utils-b0cf053b.js";import{G as me}from"./index-53a8b7fc.js";import{g as de,m as fe,i as pe}from"./trial-1f170358.js";import{p as ve}from"./product-7c779546.js";import{t as _e}from"./theme-eeb93d73.js";import"./trial-e1e6bcc5.js";const he=T({props:{isCheck:{type:Boolean,default:!1},userInfo:{type:Object,default:()=>{}}},emits:["on-verify"],setup(r,{emit:t}){var A;const a=r,u=g({}),s=g(!1),k=30,c=g(0),C=g("\u83B7\u53D6\u9A8C\u8BC1\u7801"),n=M({mobile:(A=a.userInfo)==null?void 0:A.mobile,smsCode:""}),b=l=>$(l)?!0:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7",B=l=>j(l)?!0:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u9A8C\u8BC1\u7801",V=()=>{if(c.value>0)return;c.value=k;const l=()=>{C.value=`${c.value}s`,c.value-=1};l();const m=setInterval(()=>{c.value===0?(C.value="\u83B7\u53D6\u9A8C\u8BC1\u7801",c.value=0,clearInterval(m)):l()},1e3)},e=async()=>{c.value>0||u==null||u.value.validate("mobile").then(async()=>{const l=await re(n.mobile),{code:m,data:v}=l;m==="10000"&&(s.value=!0,x({message:"\u77ED\u4FE1\u53D1\u9001\u6210\u529F\uFF0C\u8BF7\u67E5\u6536"}),V())})},p=async()=>{const l=await le(n.mobile,n.smsCode),{data:m}=l;m&&t("on-verify",n)},w=async()=>{u==null||u.value.validate().then(async()=>{p()})};return X(()=>n,()=>{$(n.mobile)&&j(n.smsCode)&&s.value&&p()},{deep:!0,immediate:!0}),(l,m)=>{const v=h("van-field"),d=h("van-cell-group"),_=h("VanForm");return y(),E(_,{ref_key:"formRef",ref:u,"label-width":"80"},{default:N(()=>[D(d,null,{default:N(()=>[D(v,{modelValue:o(n).mobile,"onUpdate:modelValue":m[0]||(m[0]=i=>o(n).mobile=i),name:"mobile",label:"\u624B\u673A\u53F7",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",maxlength:o(P).MOBILE,rules:[{validator:b}]},null,8,["modelValue","maxlength","rules"]),D(v,{modelValue:o(n).smsCode,"onUpdate:modelValue":m[1]||(m[1]=i=>o(n).smsCode=i),name:"smsCode",label:"\u9A8C\u8BC1\u7801",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",maxlength:o(P).SMS_CODE,rules:[{validator:B}]},{button:N(()=>[f("div",{class:R(["sms-code",{"count-down":c.value>0}]),onClick:e},Q(C.value),3)]),_:1},8,["modelValue","maxlength","rules"])]),_:1}),f("div",{class:R([{"check-submit":a.isCheck},{submit:!a.isCheck}]),onClick:w},null,2)]),_:1},512)}}}),Ce=T({props:{userInfo:{type:Object,default:()=>{}}},emits:["on-submit"],setup(r,{emit:t}){const a=r,u=g({}),s=M({name:a.userInfo.name,certNo:a.userInfo.certNo}),k=n=>me(s.certNo)?!0:"\u8BF7\u586B\u5199\u6B63\u786E\u7684\u8BC1\u4EF6\u53F7",c=n=>ie(n)?!0:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u59D3\u540D",C=()=>{u==null||u.value.validate().then(async n=>{t("on-submit",s)})};return(n,b)=>{const B=h("van-field"),V=h("van-cell-group"),e=h("VanForm");return y(),E(e,{ref_key:"formRef",ref:u,"label-width":"80"},{default:N(()=>[D(V,null,{default:N(()=>[D(B,{modelValue:o(s).name,"onUpdate:modelValue":b[0]||(b[0]=p=>o(s).name=p),name:"name",label:"\u59D3\u540D",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D",maxlength:o(P).NAME,rules:[{validator:c}]},null,8,["modelValue","maxlength","rules"]),D(B,{modelValue:o(s).certNo,"onUpdate:modelValue":b[1]||(b[1]=p=>o(s).certNo=p),name:"certNo",label:"\u8EAB\u4EFD\u8BC1",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u8EAB\u4EFD\u8BC1\u53F7",maxlength:o(P).ID_CARD,rules:[{validator:k}]},null,8,["modelValue","maxlength","rules"])]),_:1}),f("div",{class:"submit",onClick:C})]),_:1},512)}}});var be="/static/assets/title-step1.97cb9efa.png",Fe="/static/assets/title-step2.258af5e9.png";const ge={class:"page-activity-invite"},Be=["src"],Ie={class:"container"},ye={class:"main-form"},De={class:"title"},Ve=["src"],Ee={class:"agree"},Ne={class:"check-wrap"},ke=ue(" \u6211\u5DF2\u9605\u8BFB\u5E76\u540C\u610F "),He=T({setup(r){const t=Z(),a=ee(),{productCode:u="7X9",tenantId:s="",phoneNo:k,saleChannelId:c,agentCode:C="",paymentMethod:n,from:b}=t.query,B=g(!0),V=b==="check",e=M({title:be,attachmentList:[{attachmentName:"",attachmentUri:""}],userInfo:{mobile:k,certNo:"",name:""},agree:!1}),p=g(),w=g(),A=async v=>{var I,F;if(e.userInfo.mobile=v.mobile,V){if(!e.agree){x("\u8BF7\u52FE\u9009\u534F\u8BAE");return}a.push({path:"/chuangxin/baigebao/productDetail",query:S(L({},t.query),{tenantId:s,phoneNo:e.userInfo.mobile,productCode:"BWYL2021"})});return}const d=await de({holderPhone:e.userInfo.mobile,productCode:u,tenantId:s}),{code:_,data:i}=d;_==="10000"&&(e.userInfo.name=(I=i.tenantOrderHolder)==null?void 0:I.name,e.userInfo.certNo=(F=i.tenantOrderHolder)==null?void 0:F.certNo),e.title=Fe,B.value=!1},l=async v=>{if(!e.agree){x("\u8BF7\u52FE\u9009\u534F\u8BAE");return}try{x({message:"\u9886\u53D6\u4E2D...",forbidClick:!0,loadingType:"spinner"}),e.userInfo.certNo=v.certNo,e.userInfo.name=v.name;const d=ce({tenantId:s,detail:p.value,insureDetail:w.value,saleChannelId:c,saleUserId:C,holder:e.userInfo,insured:S(L({},e.userInfo),{relationToHolder:se.SELF}),paymentMethod:n,renewalDK:"",successJumpUrl:"",premium:0,orderStatus:"",orderTopStatus:"",tenantOrderRiskList:[]}),_=await fe(d),{code:i}=_;i==="10000"&&a.push({path:"/chuangxin/baigebao/productDetail",query:S(L({},t.query),{tenantId:s,phoneNo:e.userInfo.mobile,certNo:e.userInfo.certNo,name:e.userInfo.name,productCode:"BWYL2021",agentCode:C})})}catch(d){console.log(d),x.clear()}},m=async()=>{const v=ve({productCode:u,withInsureInfo:!0,tenantId:s}),d=pe({productCode:u});Promise.all([v,d]).then(([_,i])=>{var I,F;_.code==="10000"&&(p.value=_.data,e.attachmentList=((F=(I=p.value)==null?void 0:I.tenantProductInsureVO)==null?void 0:F.attachmentVOList)||[]),i.code==="10000"&&(w.value=i.data)})};return te(()=>{m()}),(v,d)=>{const _=h("van-checkbox"),i=h("ProPDFviewer"),I=h("van-config-provider");return y(),E(I,{"theme-vars":o(_e)},{default:N(()=>{var F,U;return[f("div",ge,[f("img",{src:(U=(F=p.value)==null?void 0:F.tenantProductInsureVO)==null?void 0:U.banner[0],class:"banner"},null,8,Be),f("div",Ie,[f("div",ye,[f("div",De,[f("img",{src:o(e).title},null,8,Ve)]),B.value?(y(),E(he,{key:0,"is-check":V,"user-info":o(e).userInfo,onOnVerify:A},null,8,["user-info"])):(y(),E(Ce,{key:1,"user-info":o(e).userInfo,onOnSubmit:l},null,8,["user-info"])),f("div",Ee,[f("div",Ne,[D(_,{modelValue:o(e).agree,"onUpdate:modelValue":d[0]||(d[0]=O=>o(e).agree=O),name:"agree",shape:"square"},null,8,["modelValue"])]),f("div",null,[ke,(y(!0),ae(ne,null,oe(o(e).attachmentList||[],(O,G)=>(y(),E(i,{key:G,class:"file-name",title:`\u300A${O.attachmentName}\u300B`,content:O.attachmentUri,type:"pdf"},null,8,["title","content"]))),128))])])])])])]}),_:1},8,["theme-vars"])}}});export{He as default};
