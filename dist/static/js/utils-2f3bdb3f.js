import{d as e}from"./vendor-533c215b.js";import{g as r,R as t,I as i}from"./infoCollection-cd4a13b9.js";import{b as n,a,R as o,i as d}from"./trial-618f0ef0.js";import{K as s,C as l,J as u,a3 as c,a6 as m}from"./index-3ce9a118.js";const p=e=>{const{tenantId:r,riskList:t,riskPremium:i,productId:o}=e;return t.map((e=>{var t;return{tenantId:r,amountUnit:1,annuityDrawFrequency:e.annuityDrawDate,annuityDrawType:e.annuityDrawType,paymentFrequency:e.paymentFrequency,paymentPeriod:e.chargePeriod.split("_")[1],paymentPeriodType:n[e.chargePeriod.split("_")[0]],insurancePeriodType:a["to_life"===e.coveragePeriod?"to_life":e.coveragePeriod.split("_")[0]],insurancePeriodValue:Number.isNaN(+e.coveragePeriod.split("_")[1])?0:e.coveragePeriod.split("_")[1],riskCode:e.riskCode,riskType:e.riskType,riskName:e.riskName,extInfo:{riskId:e.riskId,copy:e.copy},initialPremium:null==(t=i[e.riskCode])?void 0:t.premium,liabilityDetails:e.liabilityVOList.map((e=>({liabilityCode:e.liabilityCode,liabilityName:e.liabilityName,refundMethod:e.liabilityAttributeValue}))),productId:o,currentAmount:e.amount,initialAmount:e.amount}}))},y=(e,t,i=[],n=r.YEAR,a=!1)=>{const s=e.filter((e=>{try{if(e.extraInfo){return!JSON.parse(e.extraInfo).packageCode||!!i.includes(e.id)}return!1}catch(r){return!1}})),l=s.find((e=>e.riskType===o.MAIN_RISK));return s.map((e=>{const{riskInsureLimitVO:r,riskCategory:i,id:s,riskType:u,riskName:c,riskCode:m,extraInfo:p,riskLiabilityInfoVOList:y,riskCalcMethodInfoVO:I}=e,{insurancePeriodType:L,insurancePeriodValueList:N,paymentFrequencyList:k,paymentPeriodValueList:f,paymentPeriodType:O,annuityDrawFrequencyList:g,annuityDrawValueList:h,insurancePeriodRule:b,paymentPeriodRule:C}=r,{fixedAmount:D,minCopy:v}=I,T={amount:D,riskCode:m,riskId:s,riskName:c,paymentFrequency:n,extraInfo:p,chargePeriod:null==f?void 0:f[0],annuityDrawDate:null==h?void 0:h[0],riskType:u,annuityDrawFrequency:null==g?void 0:g[0],copy:v,coveragePeriod:null==N?void 0:N[0],insuredCode:null==t?void 0:t.insurerCode,liabilityVOList:a?y.filter((e=>1===e.optionalFlag&&"FXG086"!==e.liabilityCode)):y,riskCategory:i};return u===o.MAIN_RISK?T:(b===d.ONE_YEAR&&(T.coveragePeriod="year_1"),C===d.ONE_YEAR&&(T.chargePeriod="year_1"),{...T,mainRiskId:null==l?void 0:l.id,mainRiskCode:null==l?void 0:l.riskCode})}))},I=e=>{var r,i,n;return{orderAmount:e.premium,tenantId:e.tenantId,venderCode:null==(r=e.detail)?void 0:r.insurerCode,applicationNo:e.applicationNo,policyNo:e.policyNo,orderDataSource:"1",saleUserId:e.saleUserId,saleChannelId:e.saleChannelId,orderCategory:e.orderCategory,orderStatus:e.orderStatus,orderTopStatus:e.orderTopStatus,tenantOrderHolder:{tenantId:e.tenantId,name:e.holder.name,certNo:e.holder.certNo,certType:l.CERT,mobile:e.holder.mobile,birthday:s(e.holder.certNo),gender:u(e.holder.certNo),extInfo:{hasSocialInsurance:e.holder.socialFlag}},extInfo:{extraInfo:{renewalDK:e.renewalDK,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,successJumpUrl:e.successJumpUrl},iseeBizNo:e.iseeBizNo},tenantOrderInsuredList:[{tenantId:e.tenantId,relationToHolder:e.insured.relationToHolder,certNo:e.insured.certNo,certType:l.CERT,name:e.insured.name,mobile:e.insured.relationToHolder===t.SELF?e.holder.mobile:"",birthday:s(e.insured.certNo),gender:u(e.insured.certNo),extInfo:{hasSocialInsurance:e.insured.socialFlag},tenantOrderProductList:[{tenantId:e.tenantId,productCode:null==(i=e.detail)?void 0:i.productCode,productName:null==(n=e.detail)?void 0:n.productName,premium:e.premium,tenantOrderRiskList:e.tenantOrderRiskList}]}]}},L=(r,t)=>{if(!r)return"";const[i,n]=r.split("_"),a=parseInt(n,10);return"day"===i?e(t).add(a,"day").format("YYYY-MM-DD"):e(t).add(a,"year").format("YYYY-MM-DD")},N=(r,t=e().format("YYYY-MM-DD"))=>e(r).diff(t,"day"),k=(e,r,t)=>{const i=L(e,t),n=L(r,t);return N(i)<=1&&N(n)>=0},f=e=>{const{riskCode:r,liabilityCode:t,birth:i,sex:n}=e,a=L("max_18",i);return"7Y7"!==r||"FXG086"!==t||n===c.FEMALE&&N(a)<=0},O=e=>{const{riskCode:r,liabilityCode:t,birth:i,sex:n}=e,a=L("max_18",i);return"7Y7"!==r||"FXG086"!==t||n===c.FEMALE&&N(a)<=0},g=(e,r,t=(e=>!0))=>{const i=s(r),n=u(r),a=[];return e.forEach((e=>{const{riskDetailVOList:r}=e,o=r.map((e=>{const{maxHolderAge:r,minHolderAge:a}=e.riskInsureLimitVO;return k(a,r,i)?(e.riskLiabilityInfoVOList=e.riskLiabilityInfoVOList.filter((r=>t({riskCode:e.riskCode,liabilityCode:r.liabilityCode,birth:i,sex:n}))),e):null}));a.push({riskDetailVOList:o.filter((e=>!!(e&&e.riskLiabilityInfoVOList.length>0)))})})),a},h=(e,r=!1,t=(e=>!0))=>{var i,n,a;let o=[];if(r)o=y(null==(n=null==(i=g(m(e.insureDetail.productRiskVoList),e.insured.certNo,t))?void 0:i[0])?void 0:n.riskDetailVOList,e.productDetail,[],e.paymentFrequency,r);else{o=g(m(e.insureDetail.productRiskVoList),e.insured.certNo,t).map((t=>y(t.riskDetailVOList,e.productDetail,e.packageRiskIdList,e.paymentFrequency,r)))}return{calcData:{holder:{personVO:{birthday:s(e.holder.certNo),certType:l.CERT,certNo:e.holder.certNo,gender:Number(u(e.holder.certNo)),mobile:e.holder.mobile,name:e.holder.name,socialFlag:e.holder.socialFlag}},insuredVOList:[{insuredCode:null==(a=e.productDetail)?void 0:a.insurerCode,relationToHolder:e.insured.relationToHolder,personVO:{birthday:s(e.insured.certNo),certType:l.CERT,certNo:e.insured.certNo,gender:Number(u(e.insured.certNo)),name:e.insured.name,socialFlag:e.insured.socialFlag},productPlanVOList:[{riskVOList:o.flat()}]}],productCode:e.productDetail.productCode,tenantId:e.tenantId},riskVOList:o.flat()}},b=(e,r=(e=>!0))=>{var t,i,n,a,o,d;const{orderDetail:s}=e;return{agencyId:s.agencyId,venderCode:s.venderCode,applicationNo:s.applicationNo,orderDataSource:s.orderDataSource,policyNo:s.policyNo,commencementTime:s.commencementTime,orderNo:s.orderNo,tenantId:e.tenantId,orderAmount:e.premium,extInfo:{extraInfo:{...s.extInfo.extraInfo,successJumpUrl:e.successJumpUrl},iseeBizNo:e.iseeBizNo},tenantOrderHolder:{tenantId:s.tenantOrderHolder.tenantId,name:s.tenantOrderHolder.name,certType:s.tenantOrderHolder.certType,certNo:s.tenantOrderHolder.certNo,mobile:s.tenantOrderHolder.mobile,birthday:s.tenantOrderHolder.birthday,gender:s.tenantOrderHolder.gender},tenantOrderInsuredList:[{premium:e.premium,tenantId:s.tenantOrderInsuredList[0].tenantId,relationToHolder:s.tenantOrderInsuredList[0].relationToHolder,insuredBeneficiaryType:s.tenantOrderInsuredList[0].insuredBeneficiaryType,name:s.tenantOrderInsuredList[0].name,hasSocialInsurance:s.tenantOrderInsuredList[0].hasSocialInsurance,certType:s.tenantOrderInsuredList[0].certType,certNo:s.tenantOrderInsuredList[0].certNo,mobile:s.tenantOrderInsuredList[0].mobile,birthday:s.tenantOrderInsuredList[0].birthday,gender:s.tenantOrderInsuredList[0].gender,tenantOrderProductList:[{tenantId:s.tenantOrderInsuredList[0].tenantOrderProductList[0].tenantId,productCode:e.productDetail.productCode,productName:e.productDetail.productName,tenantOrderRiskList:p({tenantId:e.tenantId,riskList:y(null==(o=null==(a=g(e.insureDetail.productRiskVoList,null==(n=null==(i=null==(t=e.orderDetail)?void 0:t.tenantOrderInsuredList)?void 0:i[0])?void 0:n.certNo,r))?void 0:a[0])?void 0:o.riskDetailVOList,e.productDetail),riskPremium:{},productId:null==(d=e.productDetail)?void 0:d.id})}]}]}},C=e=>{if(e&&e.length){return e.filter((e=>e.value===i.INSURE)).map((e=>e.productRiskVoList.map((e=>e.id)))).flat()}return[]},D=(e,r)=>!e.productRiskVoList.some((e=>{const t=e.riskInsureLimitVO.minHolderAge,i=e.riskInsureLimitVO.maxHolderAge,n=s(r);return!k(t,i,n)})),v=e=>{let r=(Math.round(100*parseFloat(e.toString()))/100).toString();const t=r.toString().split(".");return 1===t.length?(r=`${r.toString()}.00`,r):t.length>1?(t[1].length<2&&(r=`${r.toString()}0`),r):e},T=e=>{if("string"==typeof e){const r=null==e?void 0:e.substring(1);return null==e?void 0:e.replace(r,"**")}return e},V=e=>null==e?void 0:e.replace(/(\d{3})\d*(\d{4})/,"$1****$2"),P=e=>null==e?void 0:e.replace(/^(.{6})(?:\d+)(.{2})$/,"$1**********$2"),F=e=>/^\d{6}$/.test(e),R=(r,t="year")=>e().diff(s(r),t,!0);export{I as a,R as b,D as c,F as d,v as e,b as f,h as g,f as h,P as i,y as j,V as m,T as n,C as o,p as t,O as v};
