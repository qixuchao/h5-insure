var H=Object.defineProperty,R=Object.defineProperties;var $=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var P=(i,n,s)=>n in i?H(i,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[n]=s,L=(i,n)=>{for(var s in n||(n={}))j.call(n,s)&&P(i,s,n[s]);if(T)for(var s of T(n))z.call(n,s)&&P(i,s,n[s]);return i},O=(i,n)=>R(i,$(n));import{g as w,E as b,M as S,_ as G,r as v,j as g,k as I,m as y,p as B,A as u,z as f,J,L as K,T as k,O as W,a9 as X,h as Y,n as Q,G as Z,F as ee,C as te}from"./vendor-667a94d7.js";import{a as ae}from"./infoCollection-242da9b6.js";import{s as oe,c as ne}from"./phoneVerify-15f3e160.js";import{v as M,a as U,b as ue}from"./validator-ebd71d12.js";import{F as A,t as se,g as re}from"./theme-c57feeae.js";import{a3 as le}from"./index-32fbbf52.js";import{g as ie,m as ce,i as me}from"./trial-7c8d95a3.js";import{p as de}from"./product-1e2da2e6.js";import"./trial-a05556b1.js";const fe=w({props:{userInfo:{type:Object,default:()=>{}}},emits:["on-verify"],setup(i,{emit:n}){var l;const s=i,r=b({}),c=b(!1),V=30,m=b(0),e=b("\u83B7\u53D6\u9A8C\u8BC1\u7801"),a=S({mobile:(l=s.userInfo)==null?void 0:l.mobile,smsCode:""}),p=t=>M(t)?!0:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7",D=t=>U(t)?!0:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u9A8C\u8BC1\u7801",E=()=>{if(m.value>0)return;m.value=V;const t=()=>{e.value=`${m.value}s`,m.value-=1};t();const o=setInterval(()=>{m.value===0?(e.value="\u83B7\u53D6\u9A8C\u8BC1\u7801",m.value=0,clearInterval(o)):t()},1e3)},N=async()=>{m.value>0||r==null||r.value.validate("mobile").then(async()=>{const t=await oe(a.mobile),{code:o,data:h}=t;o==="10000"&&(c.value=!0,k({message:"\u77ED\u4FE1\u53D1\u9001\u6210\u529F\uFF0C\u8BF7\u67E5\u6536"}),E())})},_=async()=>{const t=await ne(a.mobile,a.smsCode),{data:o}=t;o&&n("on-verify",a)},d=async()=>{r==null||r.value.validate().then(async()=>{_()})};return G(()=>a,()=>{M(a.mobile)&&U(a.smsCode)&&c.value&&_()},{deep:!0,immediate:!0}),(t,o)=>{const h=v("van-field"),F=v("van-cell-group"),x=v("VanForm");return g(),I(x,{ref_key:"formRef",ref:r,"label-width":"60"},{default:y(()=>[B(F,null,{default:y(()=>[B(h,{modelValue:u(a).mobile,"onUpdate:modelValue":o[0]||(o[0]=C=>u(a).mobile=C),name:"mobile",label:"\u624B\u673A\u53F7",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",maxlength:u(A).MOBILE,rules:[{validator:p}]},null,8,["modelValue","maxlength","rules"]),B(h,{modelValue:u(a).smsCode,"onUpdate:modelValue":o[1]||(o[1]=C=>u(a).smsCode=C),name:"smsCode",label:"\u9A8C\u8BC1\u7801",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",maxlength:u(A).SMS_CODE,rules:[{validator:D}]},{button:y(()=>[f("div",{class:K(["sms-code",{"count-down":m.value>0}]),onClick:N},J(e.value),3)]),_:1},8,["modelValue","maxlength","rules"])]),_:1}),f("div",{class:"submit",onClick:d})]),_:1},512)}}}),pe=w({props:{userInfo:{type:Object,default:()=>{}}},emits:["on-submit"],setup(i,{emit:n}){const s=i,r=b({}),c=S({name:s.userInfo.name,certNo:s.userInfo.certNo}),V=a=>le(c.certNo)?!0:"\u8BF7\u586B\u5199\u6B63\u786E\u7684\u8BC1\u4EF6\u53F7",m=a=>ue(a)?!0:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u59D3\u540D",e=()=>{r==null||r.value.validate().then(async a=>{n("on-submit",c)})};return(a,p)=>{const D=v("van-field"),E=v("van-cell-group"),N=v("VanForm");return g(),I(N,{ref_key:"formRef",ref:r,"label-width":"60"},{default:y(()=>[B(E,null,{default:y(()=>[B(D,{modelValue:u(c).name,"onUpdate:modelValue":p[0]||(p[0]=_=>u(c).name=_),name:"name",label:"\u59D3\u540D",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D",maxlength:u(A).NAME,rules:[{validator:m}]},null,8,["modelValue","maxlength","rules"]),B(D,{modelValue:u(c).certNo,"onUpdate:modelValue":p[1]||(p[1]=_=>u(c).certNo=_),name:"certNo",label:"\u8EAB\u4EFD\u8BC1",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u8EAB\u4EFD\u8BC1\u53F7",maxlength:u(A).ID_CARD,rules:[{validator:V}]},null,8,["modelValue","maxlength","rules"])]),_:1}),f("div",{class:"submit",onClick:e})]),_:1},512)}}});var ve="/static/assets/title-step1.97cb9efa.png",_e="/static/assets/title-step2.258af5e9.png";const he={class:"page-activity-invite"},Ce=["src"],be={class:"container"},Fe={class:"main-form"},ge={class:"title"},Be=["src"],De={class:"agree"},Ie=te(" \u6211\u5DF2\u9605\u8BFB\u5E76\u540C\u610F "),Se=w({setup(i){const n=W(),s=X(),{productCode:r="7X9",tenantId:c="",phoneNo:V}=n.query,m=b(!0),e=S({title:ve,attachmentList:[{attachmentName:"",attachmentUrl:""}],userInfo:{mobile:V,certNo:"",name:""},agree:!1}),a=b(),p=b(),D=async d=>{var h,F;e.userInfo.mobile=d.mobile;const l=await ie({holderPhone:e.userInfo.mobile,productCode:r,tenantId:c}),{code:t,data:o}=l;t==="10000"&&(e.userInfo.name=(h=o.tenantOrderHolder)==null?void 0:h.name,e.userInfo.certNo=(F=o.tenantOrderHolder)==null?void 0:F.certNo),e.title=_e,m.value=!1},E=async d=>{if(!e.agree){k("\u8BF7\u52FE\u9009\u534F\u8BAE");return}try{k({message:"\u9886\u53D6\u4E2D...",forbidClick:!0,loadingType:"spinner"}),e.userInfo.certNo=d.certNo,e.userInfo.name=d.name;const l=re({tenantId:c,detail:a.value,insureDetail:p.value,saleChannelId:"",holder:e.userInfo,insured:O(L({},e.userInfo),{relationToHolder:ae.SELF}),paymentMethod:"",renewalDK:"",successJumpUrl:"",premium:0,orderStatus:"",orderTopStatus:"",tenantOrderRiskList:[]}),t=await ce(l),{code:o}=t;o==="10000"&&s.push({path:"/chuangxin/baigebao/productDetail",query:O(L({},n.query),{tenantId:c,phoneNo:e.userInfo.mobile,certNo:e.userInfo.certNo,name:e.userInfo.name,productCode:"BWYL2021"})}),k.clear()}catch(l){console.log(l),k.clear()}},N=()=>{let d=[];return p.value.productRiskVoList.forEach(l=>{l.riskDetailVOList.forEach(t=>{d=d.concat(t.riskAttachmentVOList)})}),d},_=async()=>{const d=de({productCode:r,withInsureInfo:!0,tenantId:c}),l=me({productCode:r});Promise.all([d,l]).then(([t,o])=>{t.code==="10000"&&(a.value=t.data),o.code==="10000"&&(p.value=o.data,e.attachmentList=N())})};return Y(()=>{_()}),(d,l)=>{const t=v("van-checkbox"),o=v("ProPDFviewer"),h=v("van-config-provider");return g(),I(h,{"theme-vars":u(se)},{default:y(()=>{var F,x;return[f("div",he,[f("img",{src:(x=(F=a.value)==null?void 0:F.tenantProductInsureVO)==null?void 0:x.banner[0],class:"banner"},null,8,Ce),f("div",be,[f("div",Fe,[f("div",ge,[f("img",{src:u(e).title},null,8,Be)]),m.value?(g(),I(fe,{key:0,"user-info":u(e).userInfo,onOnVerify:D},null,8,["user-info"])):(g(),I(pe,{key:1,"user-info":u(e).userInfo,onOnSubmit:E},null,8,["user-info"])),f("div",De,[B(t,{modelValue:u(e).agree,"onUpdate:modelValue":l[0]||(l[0]=C=>u(e).agree=C),name:"agree",shape:"square"},null,8,["modelValue"]),f("div",null,[Ie,(g(!0),Q(ee,null,Z(u(e).attachmentList||[],(C,q)=>(g(),I(o,{key:q,class:"file-name",title:`\u300A${C.attachmentName}\u300B`,content:C.attachmentUrl,type:"pdf"},null,8,["title","content"]))),128))])])])])])]}),_:1},8,["theme-vars"])}}});export{Se as default};
