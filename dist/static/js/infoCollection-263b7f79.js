import{d as e,aV as a,aW as t,i as l,j as o,r as n,k as i,bc as s,l as u,ca as r,o as d,c,b as v,u as p,p as f,ak as m,w as I,f as h,q as g,v as y,bj as L,bb as C,T as k,ba as O,bi as R,bk as b,a_ as j,cb as w,an as _,bO as x,a$ as P,aX as V,cc as E,aY as D}from"./index-97c91859.js";import{P as F,a as N}from"./PolicyInfo-965ab610.js";import{s as q,g as T,m as S}from"./trial-aac5df38.js";import{_ as U}from"./TrialButton-e3e81310.js";import{n as A}from"./nextStep-b93a1b55.js";import{u as B}from"./useAttachment-57d6f8db.js";import"./infoCollection-f01ff1c0.js";import{R as M}from"./trial-c0a963cf.js";import{u as $}from"./useOrder-e11c9801.js";import{t as H}from"./utils-b2956012.js";import J from"./index-62f433f4.js";import{p as G,a as z}from"./utils-2a5b834d.js";import{f as K,a as Y}from"./findLastIndex-8ae0fa3c.js";import{c as W}from"./cloneDeep-a0a80033.js";import"./index-effe3d7c.js";import"./format-31cde443.js";import"./core-0d45ac8c.js";import"./utils-8d77b4c3.js";import"./createProposal-fb65ed67.js";import"./InsureInfos-8c1734a8.js";import"./index-89ff5eed.js";import"./index-fa5868b5.js";import"./questionnaire-42dcb602.js";import"./util-178f660a.js";import"./product-7bbf9c44.js";import"./constants-6ad2f07c.js";const X={class:"long-info-collection"},Q=e({name:"InfoCollection"}),Z=e({...Q,setup(e){const Q=a((()=>t((()=>import("./index-465e88fa.js")),["static/js/index-465e88fa.js","static/css/index-fa4edf2a.css","static/js/index-97c91859.js","static/css/index-5706e38b.css","static/js/theme-94cf7d00.js","static/js/index-effe3d7c.js","static/css/index-bbfdd7ec.css","static/js/utils-8d77b4c3.js","static/js/infoCollection-f01ff1c0.js","static/js/trial-c0a963cf.js"]))),Z=a((()=>t((()=>import("./index-7faf7a30.js")),["static/js/index-7faf7a30.js","static/css/index-4822eb94.css","static/js/index-97c91859.js","static/css/index-5706e38b.css"]))),ee=a((()=>t((()=>import("./SelectRiskList-c852d9f1.js")),["static/js/SelectRiskList-c852d9f1.js","static/css/SelectRiskList-e1e05c2e.css","static/js/index-97c91859.js","static/css/index-5706e38b.css","static/js/trial-aac5df38.js","static/js/trial-c0a963cf.js"]))),ae=l(),te=$({}),le=o(!0),{productCode:oe="",tenantId:ne,agentCode:ie="",agencyCode:se,saleChannelId:ue,isShare:re,orderNo:de,extraInfo:ce,insurerCode:ve,preview:pe}=ae.query;let fe={},me=null;const Ie=o(2);try{fe=JSON.parse(decodeURIComponent(ce))}catch(fa){}const he={moduleType:7,subModuleType:null,code:"renewFlag",title:"保证续保型的一年期产品在保证续保期间是否申请续保",planCode:null,displayName:null,defaultValue:null,isHidden:null,isReadOnly:null,isMustInput:1,isExtend:null,regex:null,displayType:6,datasource:null,factorScript:null,isCalculationFactor:2,attributeValueList:[{code:"1",value:"是",defaultFlag:null,useFlag:null},{code:"2",value:"否",defaultFlag:null,useFlag:null}],position:null,remark:""},ge=n({isView:!1,personalInfo:{},payInfo:{schema:[],config:[],formData:[]},policyInfo:{schema:[],config:[],formData:{}},defaultValue:null,isAutoChange:!1,defaultPlanCode:"",userData:{},solvency:""}),ye=`${window.origin}/baseInsurance/long/phoneVerify${window.location.search}`,Le=o({imgUrl:"",desc:"",title:"",link:ye}),Ce=o(),ke=o();o();const Oe=o(),Re=o({}),be=o({}),je=o([]),we=o(),_e=o({}),xe=o(!1),Pe=o(!1),Ve=o(0),Ee=o(!0),{fileList:De,mustReadFileCount:Fe,popupFileList:Ne}=B(_e,we);o(!1);const qe=o(!1),Te=o(!1),Se=()=>{Pe.value=!1,Ee.value=!0,je.value.length<1||(xe.value=!0)},Ue=()=>{xe.value=!1,Pe.value=!1,Ee.value=!0};o({}),o(!1),o([{}]);const Ae=o(""),Be=o({}),Me=o(!1);o();const $e=o();o();const He=o([]),Je=o(0);o({});const Ge=o(),ze=()=>{Ae.value="试算中...",Be.value=null,Me.value=!0},Ke=(e,a)=>{Ae.value="",Je.value=e.premium,Be.value=e,Ge.value=a,Me.value=!1},Ye=o(!1),We=o(),Xe=o({}),Qe=o({productList:[]}),Ze=o({}),ea=o(),aa=(e,a)=>{var t;const l=[],o=a;return e.forEach((e=>{var a;const{insureProductRiskVOList:t}=(null==(a=e.productPlanInsureVOList)?void 0:a[0])||{};t.reduce(((e,a)=>{const{riskFixedRuleVO:{guaranteedRenewalFlag:t},riskCode:l}=(null==a?void 0:a.riskDetailResVO)||{};return t===D.YES&&e.push(l),e}),l)})),Object.assign(te.value.extInfo,{renewRisk:l.join(",")}),(null==l?void 0:l.length)?(null==(t=o[7])?void 0:t.length)?o[7].push(he):o[7]=[he]:o[7]=(o[7]||[]).filter((e=>e.code!==he.code)),o},ta=i((()=>{const e=ea.value[5]||[];return Boolean(e.find((e=>"solvency"===e.code)))})),la=()=>{S(Qe.value).then((({code:e,data:a})=>{if("10000"===e){const{productDetailResList:e,productFactor:t}=a;Qe.value=z(e),ea.value=aa(e,t);const{other:l}=x(ea.value);ge.policyInfo=l;const o={};e.forEach((e=>{o[e.productCode]=e})),Ze.value=o}}))},oa=()=>{Ye.value=!1},na=e=>{const a=Qe.value.productList.find((e=>e.productCode===We.value)),t=e.map((e=>({riskCode:e,riskType:M.RIDER_RISK,mainRiskCode:Xe.value.riskCode}))),l=K(a.mergeRiskReqList,(e=>e.riskCode===Xe.value.riskCode)),o=Y(a.mergeRiskReqList,(e=>e.mainRiskCode===Xe.value.riskCode));let n=l;-1!==o&&(n=o),a.mergeRiskReqList=[...a.mergeRiskReqList.slice(0,n+1),...t,...a.mergeRiskReqList.slice(n+1,a.mergeRiskReqList.length)],Oe.value.getRiderRiskDefaultValue(We.value,e,Xe.value.riskCode,a.mergeRiskReqList),la(),Ye.value=!1},ia=(e,a,t)=>{Ye.value=!0,He.value=t,Xe.value=a,We.value=e},sa=(e,a,t)=>{Ze.value[e],t?(Ze.value[e].productPlanInsureVOList[0].insureProductRiskVOList=Ze.value[e].productPlanInsureVOList[0].insureProductRiskVOList.filter((e=>e.riskCode!==a)),Qe.value.productList=Qe.value.productList.map((t=>(t.productCode===e&&(t.mergeRiskReqList=t.mergeRiskReqList.filter((e=>e.riskCode!==a))),t)))):(Qe.value.productList=Qe.value.productList.filter((a=>a.productCode!==e)),la())},ua=o(!1),ra=async()=>{var e,a,t;if(pe)return void L(C.INFO_COLLECTION,ae.query);if(!Be.value)return;const l=[];Oe.value&&l.push(null==(e=Oe.value)?void 0:e.validate(!1)),Ce.value&&l.push(null==(a=Ce.value)?void 0:a.validate(!1)),ke.value&&l.push(null==(t=ke.value)?void 0:t.validate(!1)),Promise.all(l).then((e=>{if(ta.value&&!qe.value)return void k("请阅读并勾选特别约定");Object.assign(te.value,{extInfo:{...te.value.extInfo,buttonCode:O.INFO_COLLECTION,pageCode:C.INFO_COLLECTION,specNoticeFlag:qe.value?1:2}});const a=Oe.value.dealMixData(),t=H({...a,productCode:oe,productName:be.value.productName},Be.value,te.value);ae.query.productClass=`${Ie.value}`,delete ae.query.canBack;const l=(()=>{var e,a;const{holder:t,insuredList:l}=ge.userData,o=[],n=(e,a)=>{e.ocrData&&Object.keys(e.ocrData).find((a=>(e[a]||e.ocrData[a])&&e.ocrData[a]!==e[a]))&&o.push(`${a}信息影像识别与录入信息不一致，请确认`)};return n(t,"投保人"),n(null==l?void 0:l[0],"被保险人"),((null==(e=null==l?void 0:l[0])?void 0:e.beneficiaryList)||[]).forEach(((e,a)=>{n(e,`受益人${a+1}`)})),n(null==l?void 0:l[0].guardian,"监护人"),n(null==l?void 0:l[0].guardian,"监护人"),((null==(a=te.value)?void 0:a.tenantOrderPayInfoList)||[]).forEach((e=>{n(null==l?void 0:l[0].guardian,"银行卡")})),o})();ua.value=!0,(null==l?void 0:l.length)?R.confirm({message:null==l?void 0:l[0]}).then((()=>{clearInterval(me),k.loading({duration:0,message:"自核中..."}),A(t,((e,a)=>{ua.value=!1,k.clear(),a===b.JUMP_PAGE&&j(e.nextPageCode,ae.query)}),ae,!1)})):(clearInterval(me),k.loading({duration:0,message:"自核中..."}),A(t,((e,a)=>{ua.value=!1,k.clear(),a===b.JUMP_PAGE&&j(e.nextPageCode,ae.query)}),ae,!1))}),(e=>{w(".long-info-collection",".van-field--error")})).catch((e=>{console.log("e",e)}))},da=e=>{const a=te.value.tenantOrderPayInfoList[0];te.value.tenantOrderPayInfoList.splice(0,1,{...a,...e})},ca=e=>{Object.assign(ge.userData,e)},va=o(),pa=()=>{var e,a;Object.assign(te.value,{extInfo:{...te.value.extInfo,buttonCode:O.INFO_COLLECTION,pageCode:C.INFO_COLLECTION}});const t=null==(a=null==(e=Oe.value)?void 0:e.dealMixData)?void 0:a.call(e),l=H(t,Be.value,te.value);l.orderStatus="collectInfo",_(l,va.value)||q(l).then((({code:e,data:a})=>{"10000"===e&&(va.value=W(l))}))};return s((()=>{(async()=>{k.loading("加载中..."),de&&await T({orderNo:de,tenantId:ne}).then((({code:e,data:a})=>{var t;if("10000"===e){if((null==(t=a.insuredList)?void 0:t.length)>0){const{planCode:e}=a.insuredList[0];ge.defaultPlanCode=e}Object.assign(te.value,a,{tenantOrderPayInfoList:a.tenantOrderPayInfoList||[],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0,withPayInfo:!0},productCode:oe}),va.value=W(te.value),ge.defaultValue=te.value,Qe.value=G(a.insuredList[0].productList),Ie.value=a.insuredList[0].productList.length>1?1:2,Te.value=!0}})),await S(Qe.value).then((({data:e,code:a})=>{if("10000"===a){const{productDetailResList:a,productFactor:t,solvency:l}=e;ea.value=aa(a,t);const o={};a.forEach((e=>{o[e.productCode]=e})),Ze.value=o;const{payInfo:n,other:i}=x(ea.value);ge.payInfo={...ge.payInfo,...n},ge.solvency=l,ge.policyInfo={...ge.policyInfo,...i},setTimeout((()=>{le.value=!1}),500)}}))})()})),u((()=>{me=setInterval((()=>{pa()}),1e4),setTimeout((async()=>{$e.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),r((()=>{clearInterval(me)})),(e,a)=>{var t,l,o,n,i,s;const u=P,r=V,L=E;return d(),c("div",X,[v(u),p(Te)||p(pe)?(d(),f(J,{key:0,ref_key:"personalInfoRef",ref:Oe,"product-info":{productCode:p(oe),productName:p(be).productName,insurerCode:p(ve),tenantId:p(ne),planList:[]},"tenant-product-detail":p(Re),"hide-benefit":"","product-collection":p(Ze),"default-data":p(te),"product-factor":p(ea),"page-loading":p(le),onTrialStart:ze,onTrialEnd:Ke,"onUpdate:userData":ca,onUpdateBank:da,onAddRisk:ia,onDeleteRisk:sa},m({_:2},[p(le)?void 0:{name:"middleInfo",fn:I((()=>[p(ge).payInfo.schema.length?(d(),f(p(F),{key:0,ref_key:"payInfoRef",ref:Ce,modelValue:p(te).tenantOrderPayInfoList,"onUpdate:modelValue":a[0]||(a[0]=e=>p(te).tenantOrderPayInfoList=e),schema:p(ge).payInfo.schema,"is-view":p(ge).isView,"user-data":p(ge).userData},null,8,["modelValue","schema","is-view","user-data"])):h("",!0),p(ge).policyInfo.schema.length?(d(),f(p(N),{key:1,ref_key:"policyInfoRef",ref:ke,modelValue:p(te).extInfo,"onUpdate:modelValue":a[1]||(a[1]=e=>p(te).extInfo=e),schema:p(ge).policyInfo.schema,"is-view":p(ge).isView},null,8,["modelValue","schema","is-view"])):h("",!0)])),key:"0"}]),1032,["product-info","tenant-product-detail","product-collection","default-data","product-factor","page-loading"])):h("",!0),v(r,null,{default:I((()=>[!p(le)&&p(ta)?(d(),f(p(Z),{key:0,modelValue:p(qe),"onUpdate:modelValue":a[2]||(a[2]=e=>g(qe)?qe.value=e:null),class:"special-tips","has-bg-color":!1,"attachment-list":p(De),"is-show-radio":"","pre-text":`本人已认真阅读下面的特别约定${p(ge).solvency}`,onPreviewFile:a[3]||(a[3]=e=>(e=>{Ve.value=e,Pe.value=!0})(e))},null,8,["modelValue","attachment-list","pre-text"])):h("",!0)])),_:1}),p(Pe)?(d(),f(p(Q),{key:1,show:p(Pe),"onUpdate:show":a[4]||(a[4]=e=>g(Pe)?Pe.value=e:null),"content-list":p(Ee)?p(De):p(Ne),"is-only-view":p(Ee),"active-index":p(Ve),text:p(Ee)?"关闭":"我已逐页阅读并确认告知内容","force-read-count":p(Ee)?0:p(Fe),onSubmit:Se,onOnCloseFilePreviewByMask:Ue},null,8,["show","content-list","is-only-view","active-index","text","force-read-count"])):h("",!0),v(U,{"is-share":p(Le).isShare&&!p(re),premium:null==(t=p(Be))?void 0:t.initialPremium,"share-info":p(Le),"loading-text":p(Ae),"payment-frequency":(null==(s=null==(i=null==(n=null==(o=null==(l=p(Ge))?void 0:l.insuredList)?void 0:o[0].productList)?void 0:n[0].riskList)?void 0:i[0])?void 0:s.paymentFrequency)+"","tenant-product-detail":p(Re),"handle-share":e=>(e=>{Oe.value.validateHolder(["mobile"]).then((()=>{Object.assign(te.value,{extInfo:{...te.value.extInfo,buttonCode:O.INFO_COLLECTION,pageCode:C.INFO_COLLECTION}});const a=Oe.value.getUserData(),t=H({...Ge.value,holder:null==a?void 0:a.holder},Be.value||{},te.value);A(t,((a,t)=>{t===b.JUMP_PAGE&&(null==e||e())}),ae)})).catch((()=>{k("请录入投保人手机号后进行分享")}))})(e),disabled:!p(Be)||p(ua)||p(le),onHandleClick:ra},{label:I((()=>[y(" 首年总保费 ")])),default:I((()=>[y("下一步 ")])),_:1},8,["is-share","premium","share-info","loading-text","payment-frequency","tenant-product-detail","handle-share","disabled"]),p(Ye)?(d(),f(p(ee),{key:2,type:p(M).RIDER_RISK,"product-class":p(Ie),show:p(Ye),"insured-list":p(He),title:"添加附加险","current-product-code":p(We),"main-risk-code":p(Xe).riskCode,"select-list":p(Qe).productList,onCancel:oa,onConfirm:na},null,8,["type","product-class","show","insured-list","current-product-code","main-risk-code","select-list"])):h("",!0),v(L,{"button-image":p("/h5insure/static/png/cache_icon-a458a0d2.png"),onClick:pa},null,8,["button-image"])])}}});export{Z as default};
