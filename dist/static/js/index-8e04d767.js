var G=Object.defineProperty,Q=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var j=(a,u,s)=>u in a?G(a,u,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[u]=s,k=(a,u)=>{for(var s in u||(u={}))X.call(u,s)&&j(a,s,u[s]);if(x)for(var s of x(u))Z.call(u,s)&&j(a,s,u[s]);return a},y=(a,u)=>Q(a,W(u));import{a as ee,g as te,E as h,M as se,a6 as M,y as oe,_ as v,o as re,r as R,j as I,n as D,p as m,m as A,z as P,A as d,k as ae,t as C,a4 as ie,a5 as ne,C as ue}from"./vendor-96e68f0e.js";import{P as $,R as ce,i as de,p as le}from"./trial-886cbdba.js";import{_ as pe,g as fe}from"./index-979b8b7e.js";const Fe=ee({id:"createProposal",state:()=>({proposalInfo:{},trialData:[],excludeProduct:[],proposalId:0}),actions:{setProposalInfo(a){this.$state.proposalInfo=a},setTrialData(a){this.$state.trialData=a},setExcludeProduct(a){this.$state.excludeProduct=a}}});const me=a=>(ie("data-v-8b44b5f8"),a=a(),ne(),a),ke={class:"com-product-risk-wrapper"},ge={class:"popup-container"},he=me(()=>P("div",{class:"popup-title"},"\u8BF7\u9009\u62E9\u4FDD\u969C\u65B9\u6848",-1)),_e={class:"risk-trial-wrapper"},ve={key:0,class:"part-card"},Ve={key:1,class:"part-card"},Le={class:"risk-content"},Re={key:0,class:"risk"},Ie={class:"footer-bar"},Pe=ue("\u786E\u8BA4"),Oe=te({props:{isShow:{type:Boolean,default:!1},type:{default:"add"},productId:{default:0},riskType:{default:1},formInfo:{default:{}},productData:{default:()=>({})},holder:{default:()=>({})},insured:{default:()=>({})},riderRisk:{default:()=>[]},currentRisk:{default:()=>[]}},emits:["close","finished"],setup(a,{emit:u}){const s=a,B=h({personVO:k({occupationCodeList:[]},s.holder)}),F=h({insuredCode:"",personVO:k({occupationCodeList:[]},s.insured)}),V=h({}),S=h({}),_=h({}),T=h({}),w=h({}),e=se({currentPlan:"0",isShow:s.isShow,riskBaseInfo:{},holderFactor:[],insuredFactor:[],riskData:[],riskPlanData:[],trialResult:{},canTrial:!0,retrialTip:!1,enumList:{},ageRange:[],collapseName:["1"],type:s.type});M("premium",w.value),M("source",{type:e.type,origin:"proposal",showRiskList:s.currentRisk});const E=oe(()=>{var o;let t="";if((o=e.riskData)==null?void 0:o[0]){const r=e.riskData[0],n=((r==null?void 0:r.requiredRiderRiskVOList)||[]).map(c=>c.riskName);n.length&&(t=`\u7279\u6B8A\u63D0\u793A: ${r.riskName}\u548C${n.join("\u3001")}\u5FC5\u987B\u540C\u65F6\u6295\u4FDD`)}return t}),q=(t,o)=>{var c,f,l,i,p,O,g,L,N;const r=(t.insuredVOList[0].productPlanVOList[0].riskVOList||[]).map(b=>y(k({},b),{premium:o[b.riskCode].premium,amount:o[b.riskCode].amount}));return{proposalHolder:k({},(c=t.holder)==null?void 0:c.personVO),proposalInsuredList:[y(k({},t.insuredVOList[0].personVO),{dateRange:{min:(l=(f=_.value)==null?void 0:f.ageRangeObj)==null?void 0:l.minAge,max:(p=(i=_.value)==null?void 0:i.ageRangeObj)==null?void 0:p.maxAge},proposalInsuredProductList:[{productId:e.riskBaseInfo.id,productName:e.riskBaseInfo.productName,dateRange:{min:(g=(O=_.value)==null?void 0:O.ageRangeObj)==null?void 0:g.minAge,max:(N=(L=_.value)==null?void 0:L.ageRangeObj)==null?void 0:N.maxAge},occupationCodeList:t.insuredVOList[0].personVO.occupationCodeList,proposalProductRiskList:r}]})]}},J=()=>{var c;const t=JSON.parse(JSON.stringify(V.value[e.currentPlan])),o=Object.values(t).find(f=>f.riskType===1),r=Object.values(t).map(f=>{const l=f;if(l.chargePeriod==="3"){const i=(o.chargePeriod||"").split("_");i[1]&&(i[1]-=1),l.chargePeriod=i.join("_")}return l.liabilityVOList=(l.liabilityVOList||[]).filter(i=>i.optionalFlag===1||i.liabilityAttributeValue&&i.liabilityAttributeValue!=="-1").map(i=>{const p=i;return p.liabilityAttributeValue==="0"&&(p.liabilityAttributeValue=""),p}),l}),n={holder:B.value,productCode:e.riskBaseInfo.productCode,insuredVOList:[y(k({},F.value),{productPlanVOList:[{planCode:e.currentPlan||"",insurerCode:(c=e.riskBaseInfo)==null?void 0:c.insurerCode,riskVOList:r}]})]};le(k({},n)).then(({code:f,data:l})=>{if(f==="10000"){e.retrialTip=!1,e.trialResult=l,e.canTrial=!1;const i={},p=(O=[])=>{(O||[]).forEach(g=>{var L;i[g.riskCode]=g,((L=g.riskPremiumDetailVOList)==null?void 0:L.length)&&p(g.riskPremiumDetailVOList)})};p(l.riskPremiumDetailVOList),Object.assign(w.value,i),u("finished",q(n,i))}else e.retrialTip=!0})},K=()=>{var t,o,r,n,c;Promise.all([(o=(t=S.value)==null?void 0:t.validateForm)==null?void 0:o.call(t),(n=(r=_.value)==null?void 0:r.validateForm)==null?void 0:n.call(r),(c=T.value)==null?void 0:c.validate()]).then(()=>{J()})},U=()=>{u("close")},Y=()=>{fe({dictCodeList:["RISK_PAYMENT_PERIOD","RISK_INSURANCE_PERIOD"]}).then(({code:o,data:r})=>{if(o==="10000"){const n={};r.forEach(c=>{n[c.dictCode]=c.dictItemList}),e.enumList=n}})},z=()=>{de({productId:s.productId,source:2}).then(({code:t,data:o})=>{t==="10000"&&(e.riskBaseInfo=o.productBasicInfoVO,(o.productRiskVoList[0].riskDetailVOList||[]).forEach((r,n)=>{n===0&&(e.currentPlan=r.planCode||"0"),Object.assign(V.value,{[r.planCode||n]:{}})}),e.riskData=o.productRiskVoList[0].riskDetailVOList||[],e.riskPlanData=o.productRelationPlanVOList||[])}).finally(()=>{})},H=t=>{e.holderFactor=t.holderFactorList,e.insuredFactor=t.insuredFactorList,e.ageRange=t.ageRange};return v([()=>V.value,()=>B.value,()=>F.value],t=>{t&&!e.canTrial&&(e.canTrial=!0,e.retrialTip=!0)},{deep:!0}),v(()=>s.isShow,t=>{e.isShow=t},{immediate:!0}),v(()=>s.productId,t=>{t&&z()},{immediate:!0}),v(()=>s.formInfo,(t={})=>{if(!(s.type==="add"||s.type==="repeatAdd")){const o={};t.proposalProductRiskList.forEach(r=>{o[r.riskId]=r}),Object.assign(V.value,{0:o})}},{deep:!0,immediate:!0}),v(()=>s.productData,t=>{var o;s.type==="add"||s.type==="repeatAdd"||(e.riskBaseInfo=t.productBasicInfoVO,e.riskData=((o=t.productRiskVoList)==null?void 0:o[0].riskDetailVOList)||[])},{deep:!0,immediate:!0}),v(()=>s.type,t=>{e.type=t}),re(()=>{Y()}),(t,o)=>{const r=R("ProMessage"),n=R("ProTitle"),c=R("VanForm"),f=R("VanButton"),l=R("VanPopup");return I(),D("div",ke,[m(l,{show:d(e).isShow,"onUpdate:show":o[0]||(o[0]=i=>d(e).isShow=i),round:"",position:"bottom",closeable:"",style:{height:"80%"},onClose:U},{default:A(()=>{var i,p;return[P("div",ge,[he,d(E)?(I(),ae(r,{key:0,content:d(E)},null,8,["content"])):C("",!0),P("div",_e,[d(e).holderFactor.length?(I(),D("div",ve,[m(n,{title:"\u6295\u4FDD\u4EBA"}),m($,{ref_key:"holderRef",ref:S,"insured-code":(i=d(e).riskBaseInfo)==null?void 0:i.insurerCode,"form-info":B.value.personVO,"factor-list":d(e).holderFactor,"age-range":d(e).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):C("",!0),d(e).insuredFactor.length?(I(),D("div",Ve,[m(n,{title:"\u88AB\u4FDD\u4EBA"}),m($,{ref_key:"insuredRef",ref:_,"insured-code":(p=d(e).riskBaseInfo)==null?void 0:p.insurerCode,"form-info":F.value.personVO,"factor-list":d(e).insuredFactor,"age-range":d(e).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):C("",!0),P("div",Le,[m(n,{title:"\u6295\u4FDD\u65B9\u6848"}),d(e).riskData.length?(I(),D("div",Re,[m(c,{ref_key:"riskFormRef",ref:T,"input-align":"right","error-message-align":"right"},{default:A(()=>[m(ce,{"risk-info":V.value[0],enums:d(e).enumList,"origin-data":d(e).riskData,"pick-factor":H},null,8,["risk-info","enums","origin-data"])]),_:1},512)])):C("",!0)])]),P("div",Ie,[m(f,{block:"",type:"primary",onClick:K},{default:A(()=>[Pe]),_:1})])])]}),_:1},8,["show"])])}}});var be=pe(Oe,[["__scopeId","data-v-8b44b5f8"]]);export{be as P,Fe as u};
