import{d as e,h as a,i as s,j as t,O as o,o as i,l,w as r,a as u,e as d,b as c,u as n,m as p,c as m,F as f,n as v,_ as k,T as C,ap as R,aq as j,ar as I,as as b,at as h,au as L,g as y,av as _,q as g,s as w}from"./index-85d20ef9.js";import{T as P}from"./index-84b685a5.js";import{a as q,b as N,g as V,s as x,i as S,m as M}from"./trial-74f99ba7.js";import{_ as A}from"./index-6d43c047.js";import{C as K}from"./index-c247a679.js";import{S as D}from"./index-3348c186.js";import{R as O}from"./trial-63a10349.js";import{_ as T}from"./TrialButton-a6f7b688.js";import{u as E}from"./useOrder-83e08cf5.js";import{B as U,a as B}from"./constants-fe95ef6f.js";import{a as F}from"./utils-cfd02f4e.js";import"./cloneDeep-493c6609.js";import"./InsureInfos-4c6fe323.js";import"./index-de590a0b.js";import"./get-bbabda78.js";import"./infoCollection-d0fbc452.js";import"./index-7126ace7.js";import"./PolicyInfo-bfd43a31.js";import"./lodash-199bb32d.js";import"./questionnaire-62331097.js";import"./util-cc72a4f7.js";import"./product-7bbf9c44.js";import"./constants-9861ec04.js";import"./utils-dabd99ff.js";import"./createProposal-383e5303.js";import"./nextStep-eb00f6e0.js";import"./core-699f2082.js";import"./empty-ae586b6c.js";import"./index-10984f74.js";import"./utils-6b9457d6.js";const $={class:"popup-container"},H={class:"popup-header"},z={class:"title"},G=(e=>(h("data-v-478b9b11"),e=e(),L(),e))((()=>u("p",{class:"tip"},"已为您挑选出以下险种",-1))),J={class:"search"},Q={key:0,class:"risk-list"},W=e({name:"riskSelect"});var X=k(e({...W,props:{type:{default:2},show:{type:Boolean,default:!1},title:{},insuredList:{default:()=>[]},mainRiskCode:{default:""},selectList:{default:()=>[]}},emits:["cancel","confirm"],setup(e,{emit:k}){const h=e,L=a(),{insurerCode:y}=L.query,_=s(),g=s([]),w=s(),P=t((()=>h.show)),V=()=>{k("cancel")},x=()=>{_.value?k("confirm",_.value):C(`暂未添加任何${h.type===O.MAIN_RISK?"主":"附加"}险`)},S=async()=>{var e;const a={insuredList:h.insuredList,mainRiskCode:h.mainRiskCode,insurerCode:y,productCategory:"",keyword:w.value,selectProductCodes:[],selectRiskCodes:[],filterFlag:(null==(e=h.selectList)?void 0:e.length)?1:2};if(a.selectProductCodes=h.selectList.map((e=>(a.selectRiskCodes.push(...e.mergeRiskReqList.map((e=>e.riskCode))),e.productCode))),h.type===O.MAIN_RISK){const{code:e,data:s}=await q(a);"10000"===e&&(g.value=s)}else{const{code:e,data:s}=await N(a);"10000"===e&&(g.value=s)}};return o((()=>{S()})),(e,a)=>{const s=D,t=R,o=j,k=K,C=I,h=A,L=b;return i(),l(L,{show:n(P),"onUpdate:show":a[2]||(a[2]=e=>p(P)?P.value=e:null),class:"popup-risk-select",closeable:!1},{default:r((()=>[u("div",$,[u("div",H,[u("span",{class:"clear-all",onClick:V}," 取消 "),u("span",z,d(e.title),1),u("span",{class:"close",onClick:x},"确认")]),G,u("div",J,[c(s,{modelValue:n(w),"onUpdate:modelValue":a[0]||(a[0]=e=>p(w)?w.value=e:null),shape:"round",placeholder:"请输入产品名称进行搜索","clear-trigger":"always","show-action":"",clearable:"",onSearch:S},null,8,["modelValue"])]),n(g).length?(i(),m("div",Q,[c(C,{modelValue:n(_),"onUpdate:modelValue":a[1]||(a[1]=e=>p(_)?_.value=e:null)},{default:r((()=>[c(k,{inset:""},{default:r((()=>[(i(!0),m(f,null,v(n(g),(e=>(i(),l(o,{key:e.riskCode||e.productCode,title:e.riskName||e.productName,clickable:"",onClick:a=>_.value=e.riskCode||e.productCode},{icon:r((()=>[c(t,{name:e.riskCode||e.productCode},null,8,["name"])])),_:2},1032,["title","onClick"])))),128))])),_:1})])),_:1},8,["modelValue"])])):(i(),l(h,{key:1,title:`暂无关联${e.type===n(O).MAIN_RISK?"主":"附加"}险、请选择其他险种`},null,8,["title"]))])])),_:1},8,["show"])}}}),[["__scopeId","data-v-478b9b11"]]);const Y={class:"page-trial-wrap"},Z=e({name:"trial"}),ee=e({...Z,setup(e){const o=a(),u=y(),{productCode:d,orderNo:p,tenantId:f}=o.query,v=s({}),k=s({productList:[]}),C=s([]),R=s({}),j=s(),I=s(),b=E({extInfo:{templateId:201,buttonCode:U.TRIAL_PREMIUM,pageCode:B.TRIAL_PREMIUM}}),h=s(),L=s(1),q=t((()=>L.value===O.MAIN_RISK?"添加主险":"添加附加险")),N=s(!1),A=()=>{N.value=!1},K=e=>{if(L.value===O.MAIN_RISK)k.value.productList.push({productCode:e,mergeRiskReqList:[]}),j.value.getProductDefaultValue(e);else{k.value.productList.find((e=>e.productCode===I.value)).mergeRiskReqList.push({riskCode:e,riskType:O.RIDER_RISK,mainRiskCode:R.value.riskCode}),j.value.getRiderRiskDefaultValue(I.value,e,R.value.riskCode)}M(k.value).then((({code:e,data:a})=>{if("10000"===e){const{productDetailResList:e,productFactor:s}=a;h.value=s,k.value=F(e);const t={};e.forEach((e=>{t[e.productCode]=e})),v.value=t}})),N.value=!1},D=(e,a,s)=>{N.value=!0,L.value=O.RIDER_RISK,C.value=s,R.value=a,I.value=e},$=e=>{N.value=!0,L.value=O.MAIN_RISK,C.value=e},H=(e,a,s)=>{v.value[e],s?(v.value[e].productPlanInsureVOList[0].insureProductRiskVOList=v.value[e].productPlanInsureVOList[0].insureProductRiskVOList.filter((e=>e.riskCode!==a)),k.value.productList=k.value.productList.map((s=>(s.productCode===e&&(s.mergeRiskReqList=s.mergeRiskReqList.filter((e=>e.riskCode!==a))),s)))):(delete v.value[e],k.value.productList=k.value.productList.filter((a=>a.productCode!==e)))},z=()=>{j.value.onNext((async e=>{const{code:a,data:s}=await x(e);"10000"===a&&u.push({path:w.questionNotice,query:{...o.query,orderNo:s}})}))};return _((()=>{S({productCode:d,isTenant:!1}).then((({data:e,code:a})=>{var s,t;"10000"===a&&(v.value[`${d}`]=e,h.value=null==(t=null==(s=null==e?void 0:e.productPlanInsureVOList)?void 0:s[0])?void 0:t.productFactor,k.value=F([e]))})),p&&V({orderNo:p,tenantId:f}).then((({code:e,data:a})=>{"10000"===e&&(b.value=a)}))})),(e,a)=>(i(),m("div",Y,[c(P,{ref_key:"trialRef",ref:j,"product-collection":n(v),"default-value":n(b),"product-factor":n(h),"product-risk-code-map":n(k),"is-trial":"","hide-benefit":"",onAddRisk:D,onAddMainRisk:$,onDeleteRisk:H},{trialBtn:r((({riskPremium:e})=>[c(T,{premium:e.initialPremium,onHandleClick:z},null,8,["premium"])])),_:1},8,["product-collection","default-value","product-factor","product-risk-code-map"]),n(N)?(i(),l(X,{key:0,type:n(L),show:n(N),"insured-list":n(C),title:n(q),"main-risk-code":n(R).riskCode,"select-list":n(k).productList,onCancel:A,onConfirm:K},null,8,["type","show","insured-list","title","main-risk-code","select-list"])):g("",!0)]))}});export{ee as default};
