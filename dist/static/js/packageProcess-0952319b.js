var Ke=Object.defineProperty,We=Object.defineProperties;var ze=Object.getOwnPropertyDescriptors;var le=Object.getOwnPropertySymbols;var Ge=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var ie=(F,i,p)=>i in F?Ke(F,i,{enumerable:!0,configurable:!0,writable:!0,value:p}):F[i]=p,A=(F,i)=>{for(var p in i||(i={}))Ge.call(i,p)&&ie(F,p,i[p]);if(le)for(var p of le(i))je.call(i,p)&&ie(F,p,i[p]);return F},B=(F,i)=>We(F,ze(i));import{g as Je,a9 as Xe,O as Qe,E as h,M as ce,y as W,T as I,_ as Ze,l as et,h as tt,r as de,af as at,j as H,n as me,p as g,m as z,H as rt,t as G,z as k,A as m,J as x,C as Ne,k as pe,F as ot,D as nt,X as st}from"./vendor-17026bfd.js";import{_ as ut,C as fe,I as he,a0 as lt,H as it,a2 as ve}from"./index-6c2a3df9.js";import{a as j}from"./order-26db6dbf.js";import{S as P,R as T,f as ye,I as ct}from"./infoCollection-192ba138.js";import{p as Fe,i as dt,s as mt,g as pt,u as ft,a as ht}from"./trial-3585f899.js";import{p as vt}from"./product-8da66d79.js";import{g as J,a as ge,o as Ee,t as yt,b as Ft,h as De}from"./utils-ad48858e.js";import{t as gt}from"./theme-ea709837.js";import{d as Ce,B as Et,D as Dt,G as Ct,S as _t,H as Nt,P as It,U as wt,_ as At,W as Bt,a as _e}from"./auth-84ae722c.js";import{_ as kt}from"./index-560e0eb2.js";import"./utils-b6782348.js";import"./trial-d8dbf004.js";import"./index-360bd844.js";import"./bankCard-0e4ce564.js";import"./phoneVerify-994eb6cf.js";const Pt={key:0},Tt={class:"page-internet-product-detail"},St={class:"info"},bt={class:"footer-button"},Ot={class:"price"},Ut=Ne(" \u603B\u4FDD\u8D39"),Lt=Je({setup(F){const i=Xe(),p=Qe(),{productCode:X="BWYL2021",tenantId:v,orderNo:S,phoneNo:Ie,agentCode:b="",saleChannelId:we,paymentMethod:Q,certNo:Z,name:ee,pageCode:te,from:Ae}=p.query,O=h(),c=h(),U=h(),D=h(),M=te==="payBack",V=h(!1),L=h(!1),N=h(!1),ae=h(0),q=h(!1),Y=h(!1),R=h({show:!1,html:""});let $="";const e=ce({holder:{certNo:Z,certType:fe.CERT,mobile:Ie,name:ee,socialFlag:P.HAS},insured:{certNo:Z,certType:fe.CERT,name:ee,socialFlag:P.HAS,relationToHolder:T.SELF},paymentMethod:Q,renewalDK:"Y",paymentFrequency:ye.YEAR,packageProductList:[],mobileSmsCode:""}),re=h(Ce),w=h(Ce),u=ce({showInsure:!M,canInsure:!1,canUpgrade:!1}),Be=W(()=>{var t,a;return((a=(t=c.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:a.attachmentVOList.filter(r=>r.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),ke=W(()=>{var t,a;return((a=(t=c.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:a.attachmentVOList.filter(r=>r.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),oe=W(()=>{if(e.holder.certNo){const t=J(e.holder.certNo,"year"),a=he(e.holder.certNo);if(t<18)return I("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E18\u5C81\uFF01"),!1;if(e.insured.certNo&&e.insured.relationToHolder===T.MATE){const r=he(e.insured.certNo);if(a===r)return I("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(e.insured.certNo){const t=J(e.holder.certNo,"day"),a=J(e.holder.certNo,"year");if(e.insured.relationToHolder===T.CHILD&&t<30)return I("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(e.insured.relationToHolder===T.PARENT&&a>=71)return I("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E70\u5C81\uFF01"),!1}return!0}),Pe=()=>{const{holder:{certNo:t,mobile:a,name:r,socialFlag:s},insured:{certNo:o,name:n,socialFlag:l,relationToHolder:f},paymentMethod:y}=e;return!!(it(o)&&!!l)},ne=()=>{i.push({path:"/internet/guaranteeUpgrade",query:B(A({},p.query),{tenantId:v,productCode:"BWYL2022",orderNo:S,agentCode:b})})},Te=()=>{Y.value=!1},Se=()=>{w.value=re.value},be=()=>{w.value=B(A({},w.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},Oe=async t=>{I.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const a=await ft(t),{code:r}=a;if(r==="10000"){I.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const s=await ht({orderNo:t.orderNo,tenantId:v}),{data:o}=s;s.code==="10000"&&(o.type===2?(R.value={show:!0,html:o.paymentUrl},console.log("data.paymentUrl",R.value),st(()=>{console.log("document.forms",document.forms);const n=document.getElementById("cashierSubmit");n==null||n.addEventListener("submit",l=>{l.preventDefault()}),n==null||n.submit()})):window.location.href=o.paymentUrl)}u.canInsure=!0}catch{u.canInsure=!0}},Ue=t=>`${ve}/pay?orderNo=${t}&saleUserId=${b}&tenantId=${v}`,Le=t=>`${ve}/internet/payFail?tenantId=${v}&orderNo=${t}&agentCode=${b}&pageCode=payBack&from=${Ae||"normal"}`,Re=async t=>{console.log("risk",t);const a=Ft({tenantId:v,saleUserId:b,saleChannelId:we,detail:c.value,insureDetail:U.value,paymentMethod:e.paymentMethod,renewalDK:e.renewalDK,iseeBizNo:$,successJumpUrl:"",premium:D.value,holder:e.holder,insured:e.insured,tenantOrderRiskList:t,orderStatus:"",orderTopStatus:""});try{const r=await mt(a),{code:s,data:o}=r;s==="10000"&&Oe(B(A({},a),{orderNo:o.data,extInfo:{extraInfo:{renewalDK:e.renewalDK,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,successJumpUrl:Ue(o.data),failUrl:Le(o.data)},iseeBizNo:$}}))}catch{u.canInsure=!0}},He=async()=>{if(!oe.value)return u.canInsure=!0,{};const{calcData:t,riskVOList:a}=ge({holder:e.holder,insured:e.insured,tenantId:v,productDetail:c.value,insureDetail:U.value,paymentFrequency:e.paymentFrequency,packageRiskIdList:Ee(e.packageProductList)},!1,De),r=await Fe(t),{code:s,data:o}=r;return s==="10000"?(D.value=o.premium,{condition:a,data:o}):{}},xe=t=>{ae.value=t,N.value=!0},Me=()=>new Promise((t,a)=>{var r,s;(s=(r=O.value)==null?void 0:r.validateForm)==null||s.call(r).then(async()=>{var C;if(!oe.value){u.canInsure=!0;return}if(!(((C=O.value)==null?void 0:C.isAgreeFile)||V.value)){N.value=!0,xe(0);return}const{calcData:n,riskVOList:l}=ge({holder:e.holder,insured:e.insured,tenantId:v,productDetail:c.value,insureDetail:U.value,paymentFrequency:e.paymentFrequency,packageRiskIdList:Ee(e.packageProductList)},!1,De),f=await Fe(n),{code:y,data:E}=f;y==="10000"?(D.value=E.premium,t({condition:l,data:E})):a(new Error)}).catch(()=>{u.canInsure=!0})}),se=async()=>{var t;if(M){ne();return}u.canInsure=!1;try{const{condition:a,data:r}=await Me(),s={},o=(l=[])=>{(l||[]).forEach(f=>{var y;s[f.riskCode]=f,((y=f.riskPremiumDetailVOList)==null?void 0:y.length)&&o(f.riskPremiumDetailVOList)})};o(r.riskPremiumDetailVOList);const n=yt({tenantId:v,riskList:a,riskPremium:s,productId:(t=c.value)==null?void 0:t.id});Re(n)}catch{u.canInsure=!0}},Ve=t=>{t==="allFalse"?(L.value=!1,se(),u.canInsure=!0):nt.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"}).then(()=>{window.history.back()}).catch(()=>{var a;(a=O.value)==null||a.reEditForm(),V.value=!1,u.canInsure=!0})},qe=()=>{V.value=!0,N.value=!1,L.value=!0};Ze([()=>e.insured.certNo,()=>e.insured.socialFlag,()=>e.packageProductList,()=>e.paymentFrequency],et.exports.debounce(()=>{e.insured.certNo&&e.insured.socialFlag&&Pe()&&He()},500),{deep:!0,immediate:!0});const ue=async()=>{var s,o,n,l,f,y,E,C;const t=await pt({orderNo:S,tenantId:v}),{code:a,data:r}=t;if(a==="10000"){const{tenantOrderHolder:d,tenantOrderInsuredList:_,extInfo:K}=r;if(!M){Object.assign(e,{holder:{certNo:d.certNo,certType:d.certType,mobile:d.mobile,name:d.name,socialFlag:P.HAS},insured:{certNo:d.certNo,certType:d.certType,name:d.name,socialFlag:P.HAS,relationToHolder:T.SELF},paymentMethod:Q,renewalDK:"Y"}),u.canInsure=!0;return}Object.assign(e,{holder:{certNo:d.certNo,certType:d.certType,mobile:d.mobile,name:d.name,socialFlag:P.HAS},insured:{certNo:_==null?void 0:_[0].certNo,certType:(s=_[0])==null?void 0:s.certType,name:(o=_[0])==null?void 0:o.name,socialFlag:(l=(n=_[0])==null?void 0:n.extInfo)==null?void 0:l.hasSocialInsurance,relationToHolder:(f=_[0])==null?void 0:f.relationToHolder},paymentMethod:K.extraInfo.paymentMethod,paymentFrequency:K.extraInfo.paymentFrequency,renewalDK:K.extraInfo.renewalDK||"N"}),D.value=(C=(E=(y=_[0])==null?void 0:y.tenantOrderProductList)==null?void 0:E[0])==null?void 0:C.premium,(r.orderStatus===j.ACCEPT_POLICY||r.orderStatus===j.PAYMENT_SUCCESS)&&(u.canUpgrade=!0,q.value=!1,Y.value=!0),r.orderStatus===j.PAYING&&(q.value=!0,setTimeout(()=>{ue()},3*1e3))}},Ye=async()=>{const t=vt({productCode:X,withInsureInfo:!0,tenantId:v}),a=dt({productCode:X});await Promise.all([t,a]).then(([r,s])=>{var o,n;r.code==="10000"&&(c.value=r.data,document.title=((o=r.data)==null?void 0:o.productFullName)||""),s.code==="10000"&&(e.packageProductList=(((n=s.data)==null?void 0:n.packageProductVOList)||[]).map(l=>B(A({},l),{value:ct.UN_INSURE,disabled:!1})),U.value=s.data)}),S&&ue()},$e=()=>{console.log("\u6295\u4FDD\u94FE\u63A5"),w.value=_e,re.value=_e,u.canInsure=!0};return tt(()=>{$e(),Ye(),setTimeout(async()=>{$=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(t,a)=>{const r=de("van-button"),s=de("van-config-provider"),o=at("dompurify-html");return H(),me(ot,null,[g(s,{"theme-vars":m(gt)},{default:z(()=>{var n,l,f,y,E,C,d;return[R.value.show?rt((H(),me("div",Pt,null,512)),[[o,R.value.html]]):G("",!0),k("div",Tt,[k("div",St,[g(Et,{url:(l=(n=c.value)==null?void 0:n.tenantProductInsureVO)==null?void 0:l.banner[0]},null,8,["url"]),g(Dt,{"product-name":(f=c.value)==null?void 0:f.productFullName,"product-desc":(E=(y=c.value)==null?void 0:y.showConfigVO)==null?void 0:E.desc},null,8,["product-name","product-desc"])]),g(Ct,{"show-service-config":"","guarantee-list":(d=(C=c.value)==null?void 0:C.tenantProductInsureVO)==null?void 0:d.titleAndDescVOS},null,8,["guarantee-list"]),g(_t,{detail:c.value},{form:z(()=>[g(Nt,{ref_key:"formRef",ref:O,"is-show-package":"",disable:!m(u).showInsure,"form-auth":w.value,"form-info":m(e),premium:D.value,"product-detail":c.value,onOnReset:Se,onOnUpdate:be},null,8,["disable","form-auth","form-info","premium","product-detail"])]),_:1},8,["detail"]),k("div",bt,[k("div",Ot,[Ut,k("span",null,x(D.value?"\uFFE5":"")+x(m(lt)(D.value))+" "+x(D.value?m(e).paymentFrequency==m(ye).YEAR?"\u5143/\u5E74":"\u5143/\u6708":""),1)]),g(r,{type:"primary",class:"right",disabled:!(m(u).canInsure||m(u).canUpgrade),onClick:se},{default:z(()=>[Ne(x(m(u).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),m(te)!=="payBack"?(H(),pe(It,{key:1,"product-detail":c.value},null,8,["product-detail"])):G("",!0),g(wt,{"order-no":m(S),"tenant-id":m(v),"is-show":Y.value,onOnConfirm:ne,onOnClose:Te},null,8,["order-no","tenant-id","is-show"])]}),_:1},8,["theme-vars"]),g(At,{show:L.value,"onUpdate:show":a[0]||(a[0]=n=>L.value=n),"content-list":m(Be),"active-index":0,onOnConfirmHealth:Ve},null,8,["show","content-list"]),N.value?(H(),pe(kt,{key:0,show:N.value,"onUpdate:show":a[1]||(a[1]=n=>N.value=n),"content-list":m(ke),"active-index":ae.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9","force-read-cound":2,onSubmit:qe},null,8,["show","content-list","active-index"])):G("",!0),g(Bt,{"is-show":q.value},null,8,["is-show"])],64)}}});var Zt=ut(Lt,[["__scopeId","data-v-43d89088"]]);export{Zt as default};
