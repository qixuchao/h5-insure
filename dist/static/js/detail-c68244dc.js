import{d as e,r as t,c as a,h as n,j as l,g as o,k as i,f as r,w as s,n as d,t as u,af as c,a7 as f,F as m,cm as v,B as p,b4 as h,b3 as y,b_ as I,a as C,u as b,G as O,C as w,b as x,e as j,i as L,T as _,a3 as N,P as g,aF as k,aQ as E,a8 as T,bT as V,a9 as P}from"./index-b8ef7d55.js";import{g as S,i as R}from"./trial-d5b83a74.js";import{_ as H}from"./index-5aff87e5.js";import{s as U}from"./verify-f5af4199.js";import{n as A}from"./nextStep-ccd52280.js";import{p as B}from"./product-bdbda2d2.js";import{O as D,a as F}from"./order-09221ec7.js";import{P as $}from"./index-2500e426.js";import G from"./index-324dd9b8.js";import{u as q}from"./useDicData-f483f3c1.js";import{a as z}from"./trial-8213e5ec.js";import"./pdfh5-008ca364.js";import"./infoCollection-762a20da.js";import"./relativeTime-fde2a46e.js";import"./validator-5a13dc82.js";import"./core-b5348c72.js";import"./constant-c3f28a3b.js";import"./theme-65292714.js";import"./utils-7c528e3d.js";const W={class:"sign-wrap"},Y=["src"],M={class:"popup-body"},Q={class:"sign-container-wrap"},Z={class:"operate-bar"},J={class:"btns"},K=e({__name:"index",props:{option:{default:{}},modelValue:{default:""}},emits:["update:modelValue"],setup(e,{emit:I}){const C=t(!1),b=t(),O=t(""),w=t(!0),x=()=>{var e;C.value=!0,null==(e=b.value)||e.clear()},j=()=>{v({images:[O.value],className:"customer-sign-preview"})},L=()=>{C.value=!1},_=()=>{var e,t;null==(t=null==(e=b.value)?void 0:e.clear)||t.call(e)},N=()=>{var e;O.value=null==(e=b.value)?void 0:e.save(),I("update:modelValue",O.value),C.value=!1};return(e,t)=>{const v=p,I=h,g=y;return a(),n(m,null,[l("div",W,[o(O)?(a(),n("img",{key:0,class:"preview-sign",src:o(O),alt:"",onClick:j},null,8,Y)):i("",!0),r(v,{type:"primary",round:"",size:"small",onClick:x},{default:s((()=>[d(u(o(O)?"重新签名":"点击签字"),1)])),_:1})]),r(g,{show:o(C),"onUpdate:show":t[1]||(t[1]=e=>f(C)?C.value=e:null),position:"bottom",style:{height:"100%",overflow:"hidden"}},{default:s((()=>[l("div",M,[l("div",Q,[r(c,{ref_key:"signRef",ref:b,placeholder:"请在此处签名",onStroke:t[0]||(t[0]=e=>w.value=!1)},null,512),l("div",Z,[l("span",null,[r(I,{name:"info",color:"#ffaf22"}),d(" 请投保人正楷签署您的签名:")]),l("div",J,[r(v,{type:"default",class:"btn",onClick:L},{default:s((()=>[d("返回")])),_:1}),r(v,{type:"default",class:"btn",onClick:_},{default:s((()=>[d("重写")])),_:1}),r(v,{type:"primary",class:"btn",disabled:o(w),onClick:N},{default:s((()=>[d("确定签字")])),_:1},8,["disabled"])])])])])])),_:1},8,["show"])],64)}}});const X={key:0,class:"net-sale-detail-wrap"},ee={class:"sign-cell"},te=l("div",{class:"sign-label"},"签名",-1),ae={class:"footer"},ne={class:"footer"},le=e({__name:"detail",setup(e){const d=I(),u=C(),c=b(),{orderNo:v="2022113021181894998",tenantId:p="9991000001"}=u.query,h=t({}),y=t(!1),W=q("NATIONAL_REGION_CODE"),Y=t({commencementTime:"",expiryDate:"",extInfo:{buttonCode:"EVENT_NETSALE_airSignature",pageCode:"infoCollection",templateId:3,iseeBizNo:""},orderCategory:1,tenantId:p,venderCode:"",tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}],tenantOrderProductList:[{}]}],tenantOrderSubjectList:[{extInfo:{subjectRelatedFirm:"",subjectRelatedUserId:""},subjectName:"",subjectObjectType:"HOLDER",subjectType:"GENERAL",subjectNo:"",tenantId:p}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}}),M=t(!1),Q=t(),Z=t(),J=t(),le=t(""),oe=t(""),ie=t(!1),re=t(!1),se=t(0),de=t([]),ue=t(""),ce=t("");t("");const fe=t([]),me=()=>{ie.value=!1,re.value=!1},ve=async()=>{ie.value=!1,re.value=!0,await U("HOLDER",le.value,Y.value.id,`${p}`),A(Y.value)},pe=async()=>{const{data:e,code:t}=await B({productCode:ce.value,tenantId:p,withInsureInfo:!0});"10000"===t&&(J.value=e,(()=>{var e,t,a,n,l,o;let i={};if(i=oe.value?(null==(a=((null==(t=null==(e=J.value)?void 0:e.tenantProductInsureVO)?void 0:t.planList)||[]).find((e=>e.planCode===oe.value)))?void 0:a.attachmentVOList)||[]:(null==(o=null==(l=null==(n=J.value)?void 0:n.tenantProductInsureVO)?void 0:l.planInsureVO)?void 0:o.attachmentVOList)||[],!i)return void(de.value=[]);const r={2:"richText",3:"link"};de.value=Object.keys(i).map((e=>(i[e].forEach((e=>{if("1"===e.attachmentType){const t=e.attachmentUri.split("?"),a=t[0].substr(t[0].lastIndexOf(".")+1);e.attachmentType="pdf"===a?"pdf":"picture"}else e.attachmentType=r[e.attachmentType]})),{attachmentName:e,attachmentList:i[e]})))||[],fe.value=de.value.map((e=>({attachmentName:e.attachmentName,attachmentList:e.attachmentList.filter((e=>e.mustReadFlag===P.YES))}))).filter((e=>e.attachmentList.length))})())},he=async()=>{var e;const{code:t,data:a}=await S({orderNo:v,tenantId:p});"10000"===t&&(a.extInfo.buttonCode="EVENT_NETSALE_airSignature",Y.value=a,oe.value=null==(e=a.tenantOrderInsuredList[0])?void 0:e.planCode,ce.value=a.tenantOrderInsuredList[0].tenantOrderProductList[0].productCode,y.value=!0,(e=>{const t=e.find((e=>1===e.riskType));var a,n;t&&(ue.value=(a=t.insurancePeriodValue,-1!==(n=z[t.insurancePeriodType]).indexOf("$")?n.replace("$",`${a}`):`${a||""}${n}`))})(a.tenantOrderInsuredList[0].tenantOrderProductList[0].tenantOrderRiskList||[]),(async()=>{const{code:e,data:t}=await R({productCode:ce.value,tenantId:p});"10000"===e&&(Z.value=t,h.value=t.productFactor)})(),pe(),a.orderStatus!==F.UNDER_WRITING_SUCCESS&&c.push({path:"/baseInsurance/orderDetail",query:{...u.query,productCode:ce.value,ISEE_BIZ:a.extInfo.iseeBizNo}}))},ye=async()=>{le.value?(re.value=!1,fe.value.length?ie.value=!0:ve()):_("请先签字")};return O((()=>{he()})),(e,t)=>{const u=N,c=g,v=k,p=w,I=x("ProPageWrap"),C=E,b=T,O=V;return a(),j(O,{"theme-vars":o(d)},{default:s((()=>{var e;return[r(I,null,{default:s((()=>{var e;return[(null==(e=o(Z))?void 0:e.productBasicInfoVO)?(a(),n("div",X,[r(c,null,{default:s((()=>{var e;return[r(u,{title:"产品名称",content:null==(e=o(Z))?void 0:e.productBasicInfoVO.productFullName},null,8,["content"])]})),_:1}),o(Y).id?(a(),j(c,{key:0,"show-line":!1,title:"投保信息"},{default:s((()=>{var e,a,n,l;return[r(u,{title:"保费",content:o(Y).orderAmount+"元"},null,8,["content"]),r(u,{title:"保险期限",content:o(ue)},null,8,["content"]),r(u,{title:"起保日期",content:o(Y).commencementTime},null,8,["content"]),r(u,{title:"终保日期",content:o(Y).expiryDate},null,8,["content"]),r(u,{title:"保单状态",content:o(D)[o(Y).orderStatus]},null,8,["content"]),r(u,{title:"订单编号",content:o(Y).orderNo},null,8,["content"]),r(v,{modelValue:o(Y).tenantOrderHolder.extInfo.familyAreaCode,"onUpdate:modelValue":t[0]||(t[0]=e=>o(Y).tenantOrderHolder.extInfo.familyAreaCode=e),field1:o(Y).tenantOrderHolder.extInfo.familyProvinceCode,"onUpdate:field1":t[1]||(t[1]=e=>o(Y).tenantOrderHolder.extInfo.familyProvinceCode=e),field2:o(Y).tenantOrderHolder.extInfo.familyCityCode,"onUpdate:field2":t[2]||(t[2]=e=>o(Y).tenantOrderHolder.extInfo.familyCityCode=e),field3:o(Y).tenantOrderHolder.extInfo.familyAreaCode,"onUpdate:field3":t[3]||(t[3]=e=>o(Y).tenantOrderHolder.extInfo.familyAreaCode=e),label:"房产所在地",name:"familyProvinceCode","is-link":"","is-view":"",class:"insured-info","data-source":o(W),mapping:{label:"name",value:"code",children:"children"}},null,8,["modelValue","field1","field2","field3","data-source"]),r(u,{title:"详细地址",content:null==(a=null==(e=o(Y).tenantOrderHolder)?void 0:e.extInfo)?void 0:a.familyAddress},null,8,["content"]),r(u,{title:"燃气编号",content:null==(l=null==(n=o(Y).tenantOrderSubjectList)?void 0:n[0])?void 0:l.subjectNo},null,8,["content"])]})),_:1})):i("",!0),o(y)?(a(),j(H,{key:1,ref:"formRef","title-collection":{HOLDER:"投保人信息",INSURER:"被保人信息",BENEFICIARY:"受益人"},"is-view":!0,"form-info":o(Y),"factor-object":o(h),"input-align":"right"},null,8,["form-info","factor-object"])):i("",!0),r(c,{title:"阅读条款合同",class:"file-list-card"},{default:s((()=>[(a(!0),n(m,null,L(o(de),((e,t)=>(a(),j(p,{key:t,title:e.attachmentName,"is-link":"",onClick:t=>{return a=e.attachmentName,n=e.attachmentList,M.value=!0,void(Q.value={title:a,fileContent:null==n?void 0:n[0]});var a,n}},null,8,["title","onClick"])))),128))])),_:1}),r(c,{title:"客户签名"},{default:s((()=>[l("div",ee,[te,r(K,{modelValue:o(le),"onUpdate:modelValue":t[4]||(t[4]=e=>f(le)?le.value=e:null)},null,8,["modelValue"])])])),_:1}),l("div",ae,[r($,{shadow:!1,text:"提 交",onClick:ye})])])):i("",!0)]})),_:1}),r(b,{show:o(M),"onUpdate:show":t[6]||(t[6]=e=>f(M)?M.value=e:null),class:"pre-notice-wrap",title:null==(e=o(Q))?void 0:e.title,position:"bottom",style:{height:"600px"}},{default:s((()=>{var e,a,n,i;return[r(C,{content:null==(a=null==(e=o(Q))?void 0:e.fileContent)?void 0:a.attachmentUri,type:null==(i=null==(n=o(Q))?void 0:n.fileContent)?void 0:i.attachmentType},null,8,["content","type"]),l("div",ne,[r($,{shadow:!1,text:"关闭",onClick:t[5]||(t[5]=e=>M.value=!1)})])]})),_:1},8,["show","title"]),o(ie)&&0!==o(fe).length?(a(),j(G,{key:0,show:o(ie),"onUpdate:show":t[7]||(t[7]=e=>f(ie)?ie.value=e:null),"content-list":o(fe),"is-only-view":o(re),"active-index":o(se),text:o(re)?"关闭":"我已逐页阅读上述内容并同意","force-read-cound":0,"on-close-file-preview":"",onSubmit:ve,onOnCloseFilePreview:me,onOnCloseFilePreviewByMask:t[8]||(t[8]=e=>ie.value=!1)},null,8,["show","content-list","is-only-view","active-index","text"])):i("",!0)]})),_:1},8,["theme-vars"])}}});export{le as default};
