var je=Object.defineProperty,ze=Object.defineProperties;var Je=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var Qe=Object.prototype.hasOwnProperty,Xe=Object.prototype.propertyIsEnumerable;var le=(_,y,D)=>y in _?je(_,y,{enumerable:!0,configurable:!0,writable:!0,value:D}):_[y]=D,h=(_,y)=>{for(var D in y||(y={}))Qe.call(y,D)&&le(_,D,y[D]);if(se)for(var D of se(y))Xe.call(y,D)&&le(_,D,y[D]);return _},v=(_,y)=>ze(_,Je(y));import{g as Ze,a9 as ea,O as aa,E as F,M as ue,y as ie,_ as ta,l as oa,h as ra,r as ce,af as na,j as Y,n as de,p as N,m as z,H as sa,t as J,z as L,A as C,J as me,C as Te,k as pe,F as la,T as fe,X as ua}from"./vendor-17026bfd.js";import{_ as ia,C as he,$ as ca,G as ve,a1 as ye}from"./index-7d1477f9.js";import{a as T}from"./order-c0ced472.js";import{S as k,R as De,f as da,i as ma}from"./infoCollection-3dff23c4.js";import{p as ge,i as pa,s as fa,g as ha,a as va,u as ya,b as Da}from"./trial-ae7e3385.js";import{p as ga}from"./product-7517e448.js";import{d as Fe,B as Fa,D as Ea,G as Ia,S as Ca,H as _a,P as Na,U as wa,_ as ba,W as Ta,v as Pa,a as Ee,c as $,f as Ie,o as Ce,b as q,n as _e,h as Ne}from"./auth-7ccd4305.js";import{_ as Aa,g as we,o as be,t as ka,a as Oa}from"./index-5ca8316d.js";import{t as Sa}from"./theme-ea709837.js";import"./utils-b6782348.js";import"./index-9d64a3bd.js";import"./bankCard-b9d5732e.js";import"./trial-9abd68d0.js";const Ua={key:0},Ba={class:"page-internet-product-detail"},La={class:"info"},Ma={class:"footer-button"},Ha={class:"price"},xa=Te(" \u603B\u4FDD\u8D39"),Ra=Ze({setup(_){const y=ea(),D=aa(),{productCode:M="BWYL2021",tenantId:E,orderNo:O,phoneNo:H,agentCode:x="",saleChannelId:Pe,paymentMethod:g,certNo:Q,name:X,pageCode:S,from:Z}=D.query,K=F(),m=F(),U=F(),P=F(),B=S==="payBack",ee=F(!1),R=F(!1),A=F(!1),ae=F(0),G=F(!1),W=F(!1),V=F({show:!1,html:""});let j="";const s=ue({holder:{certNo:Q,certType:he.CERT,mobile:H,name:X,socialFlag:k.HAS},insured:{certNo:Q,certType:he.CERT,name:X,socialFlag:k.HAS,relationToHolder:De.SELF},paymentMethod:g,renewalDK:"Y",paymentFrequency:da.YEAR,packageProductList:[],mobileSmsCode:""}),w=F(Fe),I=F(Fe),l=ue({showInsure:!B,canInsure:!1,canUpgrade:!1}),Ae=ie(()=>{var a,t;return((t=(a=m.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(e=>e.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),ke=ie(()=>{var a,t;return((t=(a=m.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(e=>e.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),Oe=()=>{const{holder:{certNo:a,mobile:t,name:e,socialFlag:n},insured:{certNo:r,name:o,socialFlag:u,relationToHolder:c},paymentMethod:p}=s,f=ve(a)&&Pa(t)&&Ee(e)&&!!n,i=ve(r)&&Ee(o)&&!!u&&!!c;return!!(f&&i&&!!p)},te=()=>{y.push({path:"/internet/guaranteeUpgrade",query:v(h({},D.query),{tenantId:E,productCode:"BWYL2022",orderNo:O,agentCode:x})})},Se=()=>{W.value=!1},Ue=()=>{I.value=w.value},Be=()=>{I.value=v(h({},I.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},Le=async a=>{fe.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const t=await ya(a),{code:e}=t;if(e==="10000"){fe.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const n=await Da({orderNo:a.orderNo,tenantId:E}),{data:r}=n;n.code==="10000"&&(r.type===2?(V.value={show:!0,html:r.paymentUrl},console.log("data.paymentUrl",V.value),ua(()=>{console.log("document.forms",document.forms);const o=document.getElementById("cashierSubmit");o==null||o.addEventListener("submit",u=>{u.preventDefault()}),o==null||o.submit()})):window.location.href=r.paymentUrl)}l.canInsure=!0}catch{l.canInsure=!0}},Me=a=>`${ye}/internet/productDetail?tenantId=${E}&productCode=${M}&orderNo=${a}&agentCode=${x}&pageCode=payBack&from=${Z||"normal"}`,He=a=>`${ye}/internet/payFail?tenantId=${E}&orderNo=${a}&agentCode=${x}&pageCode=payBack&from=${Z||"normal"}`,xe=async a=>{console.log("risk",a);const t=Oa({tenantId:E,saleUserId:x,saleChannelId:Pe,detail:m.value,insureDetail:U.value,paymentMethod:s.paymentMethod,renewalDK:s.renewalDK,iseeBizNo:j,successJumpUrl:"",premium:P.value,holder:s.holder,insured:s.insured,tenantOrderRiskList:a,orderStatus:"",orderTopStatus:""});try{const e=await fa(t),{code:n,data:r}=e;n==="10000"&&Le(v(h({},t),{orderNo:r.data,extInfo:{extraInfo:{renewalDK:s.renewalDK,paymentMethod:s.paymentMethod,successJumpUrl:Me(r.data),failUrl:He(r.data)},iseeBizNo:j}}))}catch{l.canInsure=!0}},Re=async()=>{console.log("trialData",s);const{calcData:a,riskVOList:t}=we({holder:s.holder,insured:s.insured,tenantId:E,productDetail:m.value,insureDetail:U.value,paymentFrequency:s.paymentFrequency,packageRiskIdList:be(s.packageProductList)}),e=await ge(a),{code:n,data:r}=e;return n==="10000"?(P.value=r.premium,{condition:t,data:r}):{}},Ve=a=>{ae.value=a,A.value=!0},Ye=()=>new Promise((a,t)=>{var e,n;(n=(e=K.value)==null?void 0:e.validateForm)==null||n.call(e).then(async()=>{var i;if(!(((i=K.value)==null?void 0:i.isAgreeFile)||ee.value)){A.value=!0,Ve(0);return}const{calcData:o,riskVOList:u}=we({holder:s.holder,insured:s.insured,tenantId:E,productDetail:m.value,insureDetail:U.value,paymentFrequency:s.paymentFrequency,packageRiskIdList:be(s.packageProductList)}),c=await ge(o),{code:p,data:f}=c;p==="10000"?(P.value=f.premium,a({condition:u,data:f})):t(new Error)}).catch(()=>{l.canInsure=!0})}),oe=async()=>{var a;if(B){te();return}l.canInsure=!1;try{const{condition:t,data:e}=await Ye(),n={},r=(u=[])=>{(u||[]).forEach(c=>{var p;n[c.riskCode]=c,((p=c.riskPremiumDetailVOList)==null?void 0:p.length)&&r(c.riskPremiumDetailVOList)})};r(e.riskPremiumDetailVOList);const o=ka({tenantId:E,riskList:t,riskPremium:n,productId:(a=m.value)==null?void 0:a.id});xe(o)}catch{l.canInsure=!0}},$e=a=>{a==="allFalse"&&(R.value=!1,oe()),l.canInsure=!0},qe=()=>{ee.value=!0,A.value=!1,R.value=!0};ta(()=>s,oa.exports.debounce(()=>{m.value&&U.value&&S!=="payBack"&&Oe()&&Re()},500),{deep:!0,immediate:!0});const re=async()=>{var n,r,o,u,c,p,f,i;const a=await ha({orderNo:O,tenantId:E}),{code:t,data:e}=a;if(t==="10000"){const{tenantOrderHolder:d,tenantOrderInsuredList:b,extInfo:ne}=e;if(!B){Object.assign(s,{holder:{certNo:d.certNo,certType:d.certType,mobile:d.mobile,name:d.name,socialFlag:k.HAS},insured:{certNo:d.certNo,certType:d.certType,name:d.name,socialFlag:k.HAS,relationToHolder:De.SELF},paymentMethod:g,renewalDK:"Y"}),l.canInsure=!0,I.value=_e,w.value=_e;return}Object.assign(s,{holder:{certNo:d.certNo,certType:d.certType,mobile:d.mobile,name:d.name,socialFlag:k.HAS},insured:{certNo:b==null?void 0:b[0].certNo,certType:(n=b[0])==null?void 0:n.certType,name:(r=b[0])==null?void 0:r.name,socialFlag:(u=(o=b[0])==null?void 0:o.extInfo)==null?void 0:u.hasSocialInsurance,relationToHolder:(c=b[0])==null?void 0:c.relationToHolder},paymentMethod:ne.extraInfo.paymentMethod,renewalDK:ne.extraInfo.renewalDK||"N"}),P.value=(i=(f=(p=b[0])==null?void 0:p.tenantOrderProductList)==null?void 0:f[0])==null?void 0:i.premium,(e.orderStatus===T.ACCEPT_POLICY||e.orderStatus===T.PAYMENT_SUCCESS)&&(l.canUpgrade=!0,G.value=!1,W.value=!0),e.orderStatus===T.PAYING&&(G.value=!0,setTimeout(()=>{re()},3*1e3))}},Ke=async()=>{var n,r,o,u,c,p;console.log("\u77ED\u4FE1\u8FDB\u5165\uFF0C\u5E26\u4E86orderNo, mobile");const a=await va({holderPhone:H,orderStatus:[T.PAYING.toUpperCase(),T.TIMEOUT.toUpperCase(),"ACCEPT_POLICY"],productCode:M,tenantId:E}),{code:t,data:e}=a;if(e.orderStatus===T.ACCEPT_POLICY&&(console.log("\u5DF2\u627F\u4FDD\uFF0C\u88AB\u4FDD\u4EBA\u4FE1\u606F\u4E0D\u80FD\u4FEE\u6539"),I.value=v(h({},Ne),{paymentDisable:!!g}),w.value=v(h({},Ne),{paymentDisable:!!g})),(e.orderStatus===T.PAYING||e.orderStatus===T.TIMEOUT)&&(console.log("\u652F\u4ED8\u4E2D\uFF0C\u8D85\u65F6\u53EF\u4EE5\u4FEE\u6539\u6295\u4FDD\u4EBA\u4FE1\u606F"),I.value=v(h({},q),{paymentDisable:!!g}),w.value=v(h({},q),{paymentDisable:!!g})),t==="10000"&&((n=e==null?void 0:e.tenantOrderHolder)==null?void 0:n.certNo)){l.canInsure=!0;const{tenantOrderHolder:f,tenantOrderInsuredList:i,extInfo:d}=e;Object.assign(s,{holder:{certNo:f.certNo,certType:f.certType,mobile:f.mobile,name:f.name,socialFlag:k.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(r=i[0])==null?void 0:r.certType,name:(o=i[0])==null?void 0:o.name,socialFlag:(c=(u=i[0])==null?void 0:u.extInfo)==null?void 0:c.hasSocialInsurance,relationToHolder:(p=i[0])==null?void 0:p.relationToHolder},paymentMethod:g||d.extraInfo.paymentMethod,renewalDK:d.extraInfo.renewalDK})}else I.value=v(h({},$),{paymentDisable:!!g}),w.value=v(h({},$),{paymentDisable:!!g}),l.canInsure=!0},Ge=async()=>{const a=ga({productCode:M,withInsureInfo:!0,tenantId:E}),t=pa({productCode:M});await Promise.all([a,t]).then(([e,n])=>{var r,o;e.code==="10000"&&(m.value=e.data,document.title=((r=e.data)==null?void 0:r.productFullName)||""),n.code==="10000"&&(s.packageProductList=(((o=n.data)==null?void 0:o.packageProductVOList)||[]).map(u=>v(h({},u),{value:ma.UN_INSURE})),U.value=n.data)}),O?re():H&&S==="productDetail"&&Ke()},We=()=>{S==="free"?B?(I.value=v(h({},Ie),{paymentDisable:!!g}),w.value=v(h({},Ie),{paymentDisable:!!g}),l.canInsure=!0):(I.value=v(h({},$),{paymentDisable:!!g}),w.value=v(h({},$),{paymentDisable:!!g}),l.canInsure=!0):B?(I.value=Ce,w.value=Ce,console.log("\u652F\u4ED8\u5B8C\u6210\u8FDB\u5165")):H||O||(console.log("\u6295\u4FDD\u94FE\u63A5"),I.value=q,w.value=q,l.canInsure=!0)};return ra(()=>{We(),Ge(),setTimeout(async()=>{j=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(a,t)=>{const e=ce("van-button"),n=ce("van-config-provider"),r=na("dompurify-html");return Y(),de(la,null,[N(n,{"theme-vars":C(Sa)},{default:z(()=>{var o,u,c,p,f,i,d;return[V.value.show?sa((Y(),de("div",Ua,null,512)),[[r,V.value.html]]):J("",!0),L("div",Ba,[L("div",La,[N(Fa,{url:(u=(o=m.value)==null?void 0:o.tenantProductInsureVO)==null?void 0:u.banner[0]},null,8,["url"]),N(Ea,{"product-name":(c=m.value)==null?void 0:c.productFullName,"product-desc":(f=(p=m.value)==null?void 0:p.showConfigVO)==null?void 0:f.desc},null,8,["product-name","product-desc"])]),N(Ia,{"guarantee-list":(d=(i=m.value)==null?void 0:i.tenantProductInsureVO)==null?void 0:d.titleAndDescVOS},null,8,["guarantee-list"]),N(Ca,{detail:m.value},{form:z(()=>[N(_a,{ref_key:"formRef",ref:K,"is-show-package":"",disable:!C(l).showInsure,"form-auth":I.value,"form-info":C(s),premium:P.value,"product-detail":m.value,onOnReset:Ue,onOnUpdate:Be},null,8,["disable","form-auth","form-info","premium","product-detail"])]),_:1},8,["detail"]),L("div",Ma,[L("div",Ha,[xa,L("span",null,"\uFFE5"+me(C(ca)(P.value))+"/\u6708",1)]),N(e,{type:"primary",class:"right",disabled:!(C(l).canInsure||C(l).canUpgrade),onClick:oe},{default:z(()=>[Te(me(C(l).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),C(S)!=="payBack"?(Y(),pe(Na,{key:1,"product-detail":m.value},null,8,["product-detail"])):J("",!0),N(wa,{"order-no":C(O),"tenant-id":C(E),"is-show":W.value,onOnConfirm:te,onOnClose:Se},null,8,["order-no","tenant-id","is-show"])]}),_:1},8,["theme-vars"]),N(ba,{show:R.value,"onUpdate:show":t[0]||(t[0]=o=>R.value=o),"content-list":C(Ae),"active-index":0,onOnConfirmHealth:$e},null,8,["show","content-list"]),A.value?(Y(),pe(Aa,{key:0,show:A.value,"onUpdate:show":t[1]||(t[1]=o=>A.value=o),"content-list":C(ke),"active-index":ae.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9","force-read-cound":2,onSubmit:qe},null,8,["show","content-list","active-index"])):J("",!0),N(Ta,{"is-show":G.value},null,8,["is-show"])],64)}}});var at=ia(Ra,[["__scopeId","data-v-7d133ebe"]]);export{at as default};
