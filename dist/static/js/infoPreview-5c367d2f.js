import{d as e,af as a,ag as t,i as o,h as n,c9 as s,r as i,j as r,aG as l,l as u,o as c,c as d,b as f,u as p,p as m,q as y,f as I,w as v,F as h,s as b,a as w,g,v as j,e as x,dG as C,ah as q,bH as V,ak as P,bK as k,aS as T,dM as L,aQ as _,aN as E,c3 as N,T as O,c6 as R}from"./index-79a426f7.js";import{P as U,a as A}from"./PolicyInfo-5c7d220b.js";import{g as M,m as S}from"./trial-b5974af7.js";import{n as D}from"./nextStep-f8ab1a96.js";import{b as F,l as Q}from"./product-0ba13c55.js";import{u as B}from"./useOrder-fe3354f4.js";import{P as G}from"./constants-6c7c253a.js";import{P as J}from"./index-3fc66a31.js";import{P as $}from"./index-cfdc9b60.js";import{_ as W}from"./InsureInfo-14af6381.js";import{p as z,d as H}from"./utils-75835d1c.js";import{Q as K}from"./notice-33e6eedd.js";import{g as X}from"./utils-548cbd4a.js";import{Q as Y}from"./questionnaire-42dcb602.js";import{P as Z}from"./constants-b39aa53b.js";import{T as ee}from"./infoCollection-848023bb.js";import{i as ae}from"./core-cf39029c.js";import"./cloneDeep-bd91ad6b.js";import"./util-c5d6e8b5.js";import"./trial-973f3bcf.js";const te={class:"long-info-preview"},oe={class:"footer-button"},ne=e({__name:"infoPreview",setup(e){const ne=a((()=>t((()=>import("./index-b9978aee.js")),["static/js/index-b9978aee.js","static/css/index-fa4edf2a.css","static/js/index-79a426f7.js","static/css/index-3ce2d7e3.css","static/js/theme-94cf7d00.js","static/js/index-cfdc9b60.js","static/css/index-bbfdd7ec.css","static/js/utils-548cbd4a.js","static/js/infoCollection-848023bb.js","static/js/trial-973f3bcf.js"]))),se=o(),ie=n(),re=B({}),{productCode:le="",tenantId:ue,agentCode:ce="",agencyCode:de,saleChannelId:fe,isShare:pe,orderNo:me,extraInfo:ye,insurerCode:Ie,objectType:ve="1",templateId:he,preview:be,origin:we,pageType:ge}=se.query;let je={};try{je=JSON.parse(decodeURIComponent(ye))}catch(Qe){}const[xe,Ce]=s(!1),qe=i({isView:!1,personalInfo:{},policyInfo:{schema:[],config:[],formData:{}},payInfo:{schema:[],config:[],formData:[]},customerQuestions:[]}),Ve=`${window.origin}/baseInsurance/long/phoneVerify${window.location.search}`;r({imgUrl:"",desc:"",title:"",link:Ve});const Pe=r(),ke=r(),Te=r(!1),Le=r(!1),_e=r(0),Ee=r(!1),Ne=()=>{Le.value=!1},Oe=()=>{Te.value=!0,re.value.extInfo.buttonCode=C.short.underWrite,re.value.extInfo.pageCode="infoPreview",D(re.value,((e,a,t)=>{_.JUMP_ALERT===a&&E.confirm({title:"核保失败",message:t,cancelButtonText:"修改信息",confirmButtonText:"放弃投保"}).then((()=>{ae?N.closeWindow():window.close()})).catch((()=>{ie.push({path:G.productInfo,query:se.query})}))}))},Re=()=>{he===ee.FREE?(re.value.extInfo.buttonCode=C.free.faceVerify,re.value.extInfo.pageCode="faceAuth",D(re.value,((e,a)=>{a===_.JUMP_PAGE&&O("被保人已完成认证")}))):ge?(delete se.query.pageType,ie.push({path:G.holderInfoPreview,query:se.query})):(re.value.extInfo.buttonCode=C.short.faceVerify,re.value.extInfo.pageCode="faceAuth",D(re.value,((e,a)=>{a===_.JUMP_PAGE&&O("被保人已完成认证")})))},Ue=async()=>{if(he===ee.FREE){re.value.extInfo.buttonCode=C.free.faceVerify,re.value.extInfo.pageCode="faceAuth",await D(re.value);const{code:e,data:a}=await M({orderNo:me,tenantId:ue});"10000"===e&&(Object.assign(re.value,a),re.value.extInfo.buttonCode=C.free.underWriteAndIssue,re.value.extInfo.pageCode="productInfo",D(re.value,((e,a)=>{a===_.JUMP_PAGE&&(delete se.query.pageType,ie.push({path:Z[e.nextPageCode],query:se.query}))})))}else{if(Te.value)return void Oe();Ce(!0)}},Ae=r(),Me=r(),Se=r([]),De=async()=>{let e={};const{code:a,data:t}=await M({orderNo:me,tenantId:ue});"10000"===a&&(Object.assign(re.value,t),e=z(t.insuredList[0].productList),Ae.value=t,Ee.value=!0),(async e=>{let a=[];const{code:t,data:o}=await R({orderNo:me,tenantId:ue});"10000"===t&&(a=o.productQuestionnaireVOList);const{code:n,data:s}=await Q(e);if("10000"===n){const{productQuestionnaireVOList:e}=s||{},t=e.filter((e=>e.businessType!==K.VISIT));qe.customerQuestions=t.map((e=>{const{questionnaireDetailResponseVO:t,questionnaireId:o,questionnaireName:n}=e||{},{questions:s,basicInfo:i}=t||{},{objectType:r,questionnaireType:l}=i||{};if(l===Y.TEXT){const{content:e,textType:a}=(null==s?void 0:s[0])||{};return{content:e,contentType:X(`${a}`,e),questionnaireId:o,questionnaireName:n}}const u=(a||[]).find((e=>e.questionnaireId===o));return{...t,contentType:"question",...null==u?void 0:u.questionnaireDetailResponseVO,questionnaireId:o,questionnaireName:n}}))}})({productCodeList:e.productList.map((e=>e.productCode))}),F(e).then((({code:e,data:a})=>{if("10000"===e){const{productMaterialList:e,riskMaterialList:t}=H(a);qe.fileList=e.map((e=>({tabName:e.attachmentName,isExpand:!0,files:e.attachmentList.map((e=>({name:e.materialName,file:e.materialContent,type:e.materialSource,mustRead:e.mustReadFlag===q.YES})))}))),Se.value=e.concat(t)}})),S(e).then((({data:e,code:a})=>{if("10000"===a){const{productDetailResList:a,productFactor:t}=e;Me.value=t;const{payInfo:o,other:n}=V(t);qe.payInfo={...qe.payInfo,...o},qe.policyInfo={...qe.policyInfo,...n}}}))};l((()=>{De()}));const Fe=r();return u((()=>{setTimeout((async()=>{Fe.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,a)=>{var t,o,n;const s=P,i=k,r=T,l=L;return c(),d("div",te,[f(s),f(W,{"product-data":null==(o=null==(t=p(re).insuredList)?void 0:t[0])?void 0:o.productList},null,8,["product-data"]),(null==(n=Object.keys(p(Me)||{}))?void 0:n.length)?(c(),m(J,{key:0,ref_key:"personalInfoRef",ref:ke,modelValue:p(Ae),"onUpdate:modelValue":a[0]||(a[0]=e=>y(Ae)?Ae.value=e:null),"product-factor":p(Me),"is-view":"","input-align":"left"},null,8,["modelValue","product-factor"])):I("",!0),p(qe).payInfo.schema.length?(c(),m(p(U),{key:1,ref_key:"payInfoRef",ref:Pe,modelValue:p(re).tenantOrderPayInfoList,"onUpdate:modelValue":a[1]||(a[1]=e=>p(re).tenantOrderPayInfoList=e),schema:p(qe).payInfo.schema,"is-view":""},null,8,["modelValue","schema"])):I("",!0),p(qe).policyInfo.schema.length?(c(),m(p(A),{key:2,modelValue:p(re).extInfo,"onUpdate:modelValue":a[2]||(a[2]=e=>p(re).extInfo=e),schema:p(qe).policyInfo.schema,"is-view":""},null,8,["modelValue","schema"])):I("",!0),f(r,{title:"产品资料","show-line":!1,"show-icon":!1},{default:v((()=>[(c(!0),d(h,null,b(p(Se),((e,a)=>(c(),m(i,{key:a,"is-link":"",title:e.attachmentName,onClick:e=>(e=>{_e.value=e,Le.value=!0})(a)},null,8,["title","onClick"])))),128))])),_:1}),w("div",oe,["share"===p(we)||p(ge)?(c(),m($,{key:0,shadow:!1,onClick:Re},{default:v((()=>[g(e.$slots,"default",{},(()=>[j("确认")]))])),_:3})):(c(),m($,{key:1,shadow:!1,onClick:Ue},{default:v((()=>[g(e.$slots,"default",{},(()=>[j(x(p(he)===p(ee).FREE?"领取保障并激活":"确认支付"),1)]))])),_:3}))]),p(Le)?(c(),m(p(ne),{key:3,show:p(Le),"onUpdate:show":a[3]||(a[3]=e=>y(Le)?Le.value=e:null),"content-list":[p(Se)[p(_e)]],"is-only-view":"","active-index":0,text:"关闭","force-read-cound":0,onOnCloseFilePreviewByMask:Ne},null,8,["show","content-list"])):I("",!0),p(xe)?(c(),m(l,{key:4,modelValue:p(xe),"onUpdate:modelValue":a[4]||(a[4]=e=>y(xe)?xe.value=e:null),closeable:!1,"data-source":p(qe).fileList,onSubmit:Oe},null,8,["modelValue","data-source"])):I("",!0)])}}});export{ne as default};
