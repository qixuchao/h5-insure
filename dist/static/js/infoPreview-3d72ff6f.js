import{d as e,af as a,ag as t,i as o,h as s,c9 as n,r as i,j as l,aG as r,l as d,o as u,c,b as f,u as m,p,q as y,f as I,w as v,F as h,s as w,a as b,g as j,v as g,e as k,dG as C,T as V,ah as x,bH as q,ak as L,bK as P,aS as T,dM as _,aQ as O,c6 as N}from"./index-657cc27b.js";import{P as R,a as E}from"./PolicyInfo-7b7b8942.js";import{g as S,m as U}from"./trial-8783906c.js";import{n as D}from"./nextStep-535e4312.js";import{b as Q,l as F}from"./product-2037c25d.js";import{u as M}from"./useOrder-11beb15b.js";import{P as $}from"./index-cad6c016.js";import{P as A}from"./index-09ea9074.js";import{_ as B}from"./InsureInfo-c3d05ddd.js";import{p as G,d as z}from"./utils-075195f8.js";import{Q as J}from"./notice-33e6eedd.js";import{g as W}from"./utils-9b082850.js";import{Q as H}from"./questionnaire-42dcb602.js";import{P as K}from"./constants-b39aa53b.js";import{T as X}from"./infoCollection-ae71c391.js";import"./core-48032154.js";import"./cloneDeep-71f4700f.js";import"./util-daa58a3d.js";import"./trial-e8bfffa2.js";const Y={class:"long-info-preview"},Z={class:"footer-button"},ee=e({__name:"infoPreview",setup(e){const ee=a((()=>t((()=>import("./index-46cc2af8.js")),["static/js/index-46cc2af8.js","static/css/index-fa4edf2a.css","static/js/index-657cc27b.js","static/css/index-3dd092cb.css","static/js/theme-94cf7d00.js","static/js/index-09ea9074.js","static/css/index-bbfdd7ec.css","static/js/utils-9b082850.js","static/js/infoCollection-ae71c391.js","static/js/trial-e8bfffa2.js"]))),ae=o(),te=s(),oe=M(),{productCode:se="",tenantId:ne,agentCode:ie="",agencyCode:le,saleChannelId:re,isShare:de,orderNo:ue,extraInfo:ce,insurerCode:fe,objectType:me="1",templateId:pe,preview:ye,origin:Ie}=ae.query;let ve={};try{ve=JSON.parse(decodeURIComponent(ce))}catch(Ue){}const[he,we]=n(!1),be=i({isView:!1,personalInfo:{},policyInfo:{schema:[],config:[],formData:{}},payInfo:{schema:[],config:[],formData:[]},customerQuestions:[]}),je=`${window.origin}/baseInsurance/long/phoneVerify${window.location.search}`;l({imgUrl:"",desc:"",title:"",link:je});const ge=l(),ke=l(),Ce=l(!1),Ve=l(!1),xe=l(0),qe=l(!1),Le=()=>{Ve.value=!1},Pe=()=>{Ce.value=!0,oe.value.extInfo.buttonCode=C.short.underWrite,oe.value.extInfo.pageCode="infoPreview",D(oe.value,((e,a)=>{}))},Te=()=>{if(pe===X.FREE)oe.value.extInfo.buttonCode=C.free.underWriteAndIssue,oe.value.extInfo.pageCode="productInfo",D(oe.value,((e,a)=>{a===O.JUMP_PAGE&&te.push({path:K[e.nextPageCode],query:ae.query})}));else{if(Ce.value)return void Pe();we(!0)}},_e=async()=>{pe===X.FREE?V("被保人已完成认证"):we(!0)},Oe=l(),Ne=l(),Re=l([]),Ee=async()=>{let e={};const{code:a,data:t}=await S({orderNo:ue,tenantId:ne});"10000"===a&&(Object.assign(oe.value,t),e=G(t.insuredList[0].productList),Oe.value=t,qe.value=!0),(async e=>{let a=[];const{code:t,data:o}=await N({orderNo:ue,tenantId:ne});"10000"===t&&(a=o.productQuestionnaireVOList);const{code:s,data:n}=await F(e);if("10000"===s){const{productQuestionnaireVOList:e}=n||{},t=e.filter((e=>e.businessType!==J.VISIT));be.customerQuestions=t.map((e=>{const{questionnaireDetailResponseVO:t,questionnaireId:o,questionnaireName:s}=e||{},{questions:n,basicInfo:i}=t||{},{objectType:l,questionnaireType:r}=i||{};if(r===H.TEXT){const{content:e,textType:a}=(null==n?void 0:n[0])||{};return{content:e,contentType:W(`${a}`,e),questionnaireId:o,questionnaireName:s}}const d=(a||[]).find((e=>e.questionnaireId===o));return{...t,contentType:"question",...null==d?void 0:d.questionnaireDetailResponseVO,questionnaireId:o,questionnaireName:s}}))}})({productCodeList:e.productList.map((e=>e.productCode))}),Q(e).then((({code:e,data:a})=>{if("10000"===e){const{productMaterialList:e,riskMaterialList:t}=z(a);be.fileList=e.map((e=>({tabName:e.attachmentName,isExpand:!0,files:e.attachmentList.map((e=>({name:e.materialName,file:e.materialContent,type:e.materialSource,mustRead:e.mustReadFlag===x.YES})))}))),Re.value=e.concat(t)}})),U(e).then((({data:e,code:a})=>{if("10000"===a){const{productDetailResList:a,productFactor:t}=e;Ne.value=t;const{payInfo:o,other:s}=q(t);be.payInfo={...be.payInfo,...o},be.policyInfo={...be.policyInfo,...s}}}))};r((()=>{Ee()}));const Se=l();return d((()=>{setTimeout((async()=>{Se.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,a)=>{var t,o,s;const n=L,i=P,l=T,r=_;return u(),c("div",Y,[f(n),f(B,{"product-data":null==(o=null==(t=m(oe).insuredList)?void 0:t[0])?void 0:o.productList},null,8,["product-data"]),(null==(s=Object.keys(m(Ne)||{}))?void 0:s.length)?(u(),p($,{key:0,ref_key:"personalInfoRef",ref:ke,modelValue:m(Oe),"onUpdate:modelValue":a[0]||(a[0]=e=>y(Oe)?Oe.value=e:null),"product-factor":m(Ne),"is-view":"","input-align":"left"},null,8,["modelValue","product-factor"])):I("",!0),m(be).payInfo.schema.length?(u(),p(m(R),{key:1,ref_key:"payInfoRef",ref:ge,modelValue:m(oe).tenantOrderPayInfoList,"onUpdate:modelValue":a[1]||(a[1]=e=>m(oe).tenantOrderPayInfoList=e),schema:m(be).payInfo.schema,"is-view":""},null,8,["modelValue","schema"])):I("",!0),m(be).policyInfo.schema.length?(u(),p(m(E),{key:2,modelValue:m(oe).extInfo,"onUpdate:modelValue":a[2]||(a[2]=e=>m(oe).extInfo=e),schema:m(be).policyInfo.schema,"is-view":""},null,8,["modelValue","schema"])):I("",!0),f(l,{title:"产品资料","show-line":!1,"show-icon":!1},{default:v((()=>[(u(!0),c(h,null,w(m(Re),((e,a)=>(u(),p(i,{key:a,"is-link":"",title:e.attachmentName,onClick:e=>(e=>{xe.value=e,Ve.value=!0})(a)},null,8,["title","onClick"])))),128))])),_:1}),b("div",Z,["share"===m(Ie)?(u(),p(A,{key:0,shadow:!1,onClick:_e},{default:v((()=>[j(e.$slots,"default",{},(()=>[g("确认")]))])),_:3})):(u(),p(A,{key:1,shadow:!1,onClick:Te},{default:v((()=>[j(e.$slots,"default",{},(()=>[g(k(m(pe)===m(X).free?"领取保障并激活":"确认支付"),1)]))])),_:3}))]),m(Ve)?(u(),p(m(ee),{key:3,show:m(Ve),"onUpdate:show":a[3]||(a[3]=e=>y(Ve)?Ve.value=e:null),"content-list":[m(Re)[m(xe)]],"is-only-view":"","active-index":0,text:"关闭","force-read-cound":0,onOnCloseFilePreviewByMask:Le},null,8,["show","content-list"])):I("",!0),m(he)?(u(),p(r,{key:4,modelValue:m(he),"onUpdate:modelValue":a[4]||(a[4]=e=>y(he)?he.value=e:null),closeable:!1,"data-source":m(be).fileList,onSubmit:Pe},null,8,["modelValue","data-source"])):I("",!0)])}}});export{ee as default};
