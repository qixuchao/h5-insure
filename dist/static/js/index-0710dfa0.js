var Ge=Object.defineProperty,We=Object.defineProperties;var je=Object.getOwnPropertyDescriptors;var ne=Object.getOwnPropertySymbols;var ze=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable;var se=(w,h,v)=>h in w?Ge(w,h,{enumerable:!0,configurable:!0,writable:!0,value:v}):w[h]=v,D=(w,h)=>{for(var v in h||(h={}))ze.call(h,v)&&se(w,v,h[v]);if(ne)for(var v of ne(h))Je.call(h,v)&&se(w,v,h[v]);return w},y=(w,h)=>We(w,je(h));import{g as Xe,a9 as Qe,O as Ze,E as F,M as le,y as ue,_ as et,l as tt,h as at,r as ie,af as ot,j,n as ce,p as E,m as z,H as rt,t as de,z as k,A as _,J as me,C as Ne,k as nt,F as st,T as pe,X as lt}from"./vendor-17026bfd.js";import{_ as ut,C as fe,$ as it,G as he,a1 as ve}from"./index-cb62c71a.js";import{a as T}from"./order-c0ced472.js";import{S as O,R as De}from"./infoCollection-9663350e.js";import{p as ye,i as ct,s as dt,g as mt,a as pt,u as ft,b as ht}from"./trial-56325317.js";import{p as vt}from"./product-80b7c393.js";import{d as ge,B as Dt,D as yt,G as gt,S as Ft,H as Ct,P as It,U as _t,_ as Et,W as wt,v as Nt,a as Fe,c as R,f as Ce,o as Ie,b as $,n as _e,h as Ee}from"./auth-8eca2e3e.js";import{_ as bt,g as we,t as Tt,a as At}from"./index-c4a97394.js";import{t as Ot}from"./theme-ea709837.js";import"./utils-b6782348.js";import"./index-d2072e5e.js";import"./bankCard-b9d5732e.js";import"./trial-f72813b7.js";const Pt={key:0},St={class:"page-internet-product-detail"},Bt={class:"info"},Ut={class:"footer-button"},kt={class:"price"},Ht=Ne(" \u603B\u4FDD\u8D39"),xt=Xe({setup(w){const h=Qe(),v=Ze(),{productCode:H="BWYL2021",tenantId:C,orderNo:P,phoneNo:x,agentCode:M="",saleChannelId:be,paymentMethod:g,certNo:J,name:X,pageCode:S,from:Q}=v.query;console.log(v.query,"route.query");const Y=F(),m=F(),B=F(),A=F(),U=S==="payBack",Z=F(!1),L=F(!1),K=F(!1),ee=F(0),q=F(!1),G=F(!1),V=F({show:!1,html:""});let W="";const c=le({holder:{certNo:J,certType:fe.CERT,mobile:x,name:X,socialFlag:O.HAS},insured:{certNo:J,certType:fe.CERT,name:X,socialFlag:O.HAS,relationToHolder:De.SELF},paymentMethod:g,renewalDK:"Y"}),N=F(ge),I=F(ge),s=le({showInsure:!U,canInsure:!1,canUpgrade:!1}),Te=ue(()=>{var t,a;return((a=(t=m.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:a.attachmentVOList.filter(e=>e.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),Ae=ue(()=>{var t,a;return((a=(t=m.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:a.attachmentVOList.filter(e=>e.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),Oe=()=>{const{holder:{certNo:t,mobile:a,name:e,socialFlag:r},insured:{certNo:o,name:n,socialFlag:d,relationToHolder:u},paymentMethod:p}=c,f=he(t)&&Nt(a)&&Fe(e)&&!!r,l=he(o)&&Fe(n)&&!!d&&!!u;return!!(f&&l&&!!p)},te=()=>{h.push({path:"/internet/guaranteeUpgrade",query:y(D({},v.query),{tenantId:C,productCode:"BWYL2022",orderNo:P,agentCode:M})})},Pe=()=>{G.value=!1},Se=()=>{I.value=N.value},Be=()=>{I.value=y(D({},I.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},Ue=async t=>{pe.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const a=await ft(t),{code:e}=a;if(e==="10000"){pe.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const r=await ht({orderNo:t.orderNo,tenantId:C}),{data:o}=r;r.code==="10000"&&(o.type===2?(V.value={show:!0,html:o.paymentUrl},console.log("data.paymentUrl",V.value),lt(()=>{console.log("document.forms",document.forms);const n=document.getElementById("cashierSubmit");n==null||n.addEventListener("submit",d=>{d.preventDefault()}),n==null||n.submit()})):window.location.href=o.paymentUrl)}s.canInsure=!0}catch{s.canInsure=!0}},ke=t=>`${ve}/internet/productDetail?tenantId=${C}&productCode=${H}&orderNo=${t}&agentCode=${M}&pageCode=payBack&from=${Q||"normal"}`,He=t=>`${ve}/internet/payFail?tenantId=${C}&orderNo=${t}&agentCode=${M}&pageCode=payBack&from=${Q||"normal"}`,xe=async t=>{const a=At({tenantId:C,saleUserId:M,saleChannelId:be,detail:m.value,insureDetail:B.value,paymentMethod:c.paymentMethod,renewalDK:c.renewalDK,iseeBizNo:W,successJumpUrl:"",premium:A.value,holder:c.holder,insured:c.insured,tenantOrderRiskList:t,orderStatus:"",orderTopStatus:""});try{const e=await dt(a),{code:r,data:o}=e;r==="10000"&&Ue(y(D({},a),{orderNo:o.data,extInfo:{extraInfo:{renewalDK:c.renewalDK,paymentMethod:c.paymentMethod,successJumpUrl:ke(o.data),failUrl:He(o.data)},iseeBizNo:W}}))}catch{s.canInsure=!0}},Me=async()=>{const{calcData:t,riskVOList:a}=we({holder:c.holder,insured:c.insured,tenantId:C,productDetail:m.value,insureDetail:B.value}),e=await ye(t),{code:r,data:o}=e;return r==="10000"?(A.value=o.premium,{condition:a,data:o}):{}},Le=t=>{ee.value=t,K.value=!0},Ve=()=>new Promise((t,a)=>{var e,r;(r=(e=Y.value)==null?void 0:e.validateForm)==null||r.call(e).then(async()=>{var l;if(!(((l=Y.value)==null?void 0:l.isAgreeFile)||Z.value)){L.value=!0;return}const{calcData:n,riskVOList:d}=we({holder:c.holder,insured:c.insured,tenantId:C,productDetail:m.value,insureDetail:B.value},!0),u=await ye(n),{code:p,data:f}=u;p==="10000"?(A.value=f.premium,t({condition:d,data:f})):a(new Error)}).catch(()=>{s.canInsure=!0})}),ae=async()=>{var t;if(U){te();return}s.canInsure=!1;try{const{condition:a,data:e}=await Ve(),r={},o=(d=[])=>{(d||[]).forEach(u=>{var p;r[u.riskCode]=u,((p=u.riskPremiumDetailVOList)==null?void 0:p.length)&&o(u.riskPremiumDetailVOList)})};o(e.riskPremiumDetailVOList);const n=Tt({tenantId:C,riskList:a,riskPremium:r,productId:(t=m.value)==null?void 0:t.id});xe(n)}catch{s.canInsure=!0}},Re=t=>{t==="allFalse"&&(L.value=!1,Le(0)),s.canInsure=!0},$e=()=>{Z.value=!0,ae()};et(()=>c,tt.exports.debounce(()=>{m.value&&B.value&&S!=="payBack"&&Oe()&&Me()},500),{deep:!0,immediate:!0});const oe=async()=>{var r,o,n,d,u,p,f,l;const t=await mt({orderNo:P,tenantId:C}),{code:a,data:e}=t;if(a==="10000"){const{tenantOrderHolder:i,tenantOrderInsuredList:b,extInfo:re}=e;if(!U){Object.assign(c,{holder:{certNo:i.certNo,certType:i.certType,mobile:i.mobile,name:i.name,socialFlag:O.HAS},insured:{certNo:i.certNo,certType:i.certType,name:i.name,socialFlag:O.HAS,relationToHolder:De.SELF},paymentMethod:g,renewalDK:"Y"}),s.canInsure=!0,I.value=_e,N.value=_e;return}Object.assign(c,{holder:{certNo:i.certNo,certType:i.certType,mobile:i.mobile,name:i.name,socialFlag:O.HAS},insured:{certNo:b==null?void 0:b[0].certNo,certType:(r=b[0])==null?void 0:r.certType,name:(o=b[0])==null?void 0:o.name,socialFlag:(d=(n=b[0])==null?void 0:n.extInfo)==null?void 0:d.hasSocialInsurance,relationToHolder:(u=b[0])==null?void 0:u.relationToHolder},paymentMethod:re.extraInfo.paymentMethod,renewalDK:re.extraInfo.renewalDK||"N"}),A.value=(l=(f=(p=b[0])==null?void 0:p.tenantOrderProductList)==null?void 0:f[0])==null?void 0:l.premium,(e.orderStatus===T.ACCEPT_POLICY||e.orderStatus===T.PAYMENT_SUCCESS)&&(s.canUpgrade=!0,q.value=!1,G.value=!0),e.orderStatus===T.PAYING&&(q.value=!0,setTimeout(()=>{oe()},3*1e3))}},Ye=async()=>{var r,o,n,d,u,p;console.log("\u77ED\u4FE1\u8FDB\u5165\uFF0C\u5E26\u4E86orderNo, mobile");const t=await pt({holderPhone:x,orderStatus:[T.PAYING.toUpperCase(),T.TIMEOUT.toUpperCase(),"ACCEPT_POLICY"],productCode:H,tenantId:C}),{code:a,data:e}=t;if(e.orderStatus===T.ACCEPT_POLICY&&(console.log("\u5DF2\u627F\u4FDD\uFF0C\u88AB\u4FDD\u4EBA\u4FE1\u606F\u4E0D\u80FD\u4FEE\u6539"),I.value=y(D({},Ee),{paymentDisable:!!g}),N.value=y(D({},Ee),{paymentDisable:!!g})),(e.orderStatus===T.PAYING||e.orderStatus===T.TIMEOUT)&&(console.log("\u652F\u4ED8\u4E2D\uFF0C\u8D85\u65F6\u53EF\u4EE5\u4FEE\u6539\u6295\u4FDD\u4EBA\u4FE1\u606F"),I.value=y(D({},$),{paymentDisable:!!g}),N.value=y(D({},$),{paymentDisable:!!g})),a==="10000"&&((r=e==null?void 0:e.tenantOrderHolder)==null?void 0:r.certNo)){s.canInsure=!0;const{tenantOrderHolder:f,tenantOrderInsuredList:l,extInfo:i}=e;Object.assign(c,{holder:{certNo:f.certNo,certType:f.certType,mobile:f.mobile,name:f.name,socialFlag:O.HAS},insured:{certNo:l==null?void 0:l[0].certNo,certType:(o=l[0])==null?void 0:o.certType,name:(n=l[0])==null?void 0:n.name,socialFlag:(u=(d=l[0])==null?void 0:d.extInfo)==null?void 0:u.hasSocialInsurance,relationToHolder:(p=l[0])==null?void 0:p.relationToHolder},paymentMethod:g||i.extraInfo.paymentMethod,renewalDK:i.extraInfo.renewalDK})}else I.value=y(D({},R),{paymentDisable:!!g}),N.value=y(D({},R),{paymentDisable:!!g}),s.canInsure=!0},Ke=async()=>{const t=vt({productCode:H,withInsureInfo:!0,tenantId:C}),a=ct({productCode:H});await Promise.all([t,a]).then(([e,r])=>{var o;e.code==="10000"&&(m.value=e.data,document.title=((o=e.data)==null?void 0:o.productFullName)||""),r.code==="10000"&&(B.value=r.data)}),P?oe():x&&S==="productDetail"&&Ye()},qe=()=>{S==="free"?U?(I.value=y(D({},Ce),{paymentDisable:!!g}),N.value=y(D({},Ce),{paymentDisable:!!g}),s.canInsure=!0):(I.value=y(D({},R),{paymentDisable:!!g}),N.value=y(D({},R),{paymentDisable:!!g}),s.canInsure=!0):U?(I.value=Ie,N.value=Ie,console.log("\u652F\u4ED8\u5B8C\u6210\u8FDB\u5165")):x||P||(console.log("\u6295\u4FDD\u94FE\u63A5"),I.value=$,N.value=$,s.canInsure=!0)};return at(()=>{qe(),Ke(),setTimeout(async()=>{W=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(t,a)=>{const e=ie("van-button"),r=ie("van-config-provider"),o=ot("dompurify-html");return j(),ce(st,null,[E(r,{"theme-vars":_(Ot)},{default:z(()=>{var n,d,u,p,f,l,i;return[V.value.show?rt((j(),ce("div",Pt,null,512)),[[o,V.value.html]]):de("",!0),k("div",St,[k("div",Bt,[E(Dt,{url:(d=(n=m.value)==null?void 0:n.tenantProductInsureVO)==null?void 0:d.banner[0]},null,8,["url"]),E(yt,{"product-name":(u=m.value)==null?void 0:u.productFullName,"product-desc":(f=(p=m.value)==null?void 0:p.showConfigVO)==null?void 0:f.desc},null,8,["product-name","product-desc"])]),E(gt,{"guarantee-list":(i=(l=m.value)==null?void 0:l.tenantProductInsureVO)==null?void 0:i.titleAndDescVOS},null,8,["guarantee-list"]),E(Ft,{detail:m.value},{form:z(()=>[E(Ct,{ref_key:"formRef",ref:Y,disable:!_(s).showInsure,"form-auth":I.value,"form-info":_(c),premium:A.value,"product-detail":m.value,payments:[1],"payment-method":[0],onOnReset:Se,onOnUpdate:Be},null,8,["disable","form-auth","form-info","premium","product-detail"])]),_:1},8,["detail"]),k("div",Ut,[k("div",kt,[Ht,k("span",null,"\uFFE5"+me(_(it)(A.value))+"/\u6708",1)]),E(e,{type:"primary",class:"right",disabled:!(_(s).canInsure||_(s).canUpgrade),onClick:ae},{default:z(()=>[Ne(me(_(s).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),_(S)!=="payBack"?(j(),nt(It,{key:1,"product-detail":m.value},null,8,["product-detail"])):de("",!0),E(_t,{"order-no":_(P),"tenant-id":_(C),"is-show":G.value,onOnConfirm:te,onOnClose:Pe},null,8,["order-no","tenant-id","is-show"])]}),_:1},8,["theme-vars"]),E(Et,{show:L.value,"onUpdate:show":a[0]||(a[0]=n=>L.value=n),"content-list":_(Te),"active-index":0,onOnConfirmHealth:Re},null,8,["show","content-list"]),E(bt,{show:K.value,"onUpdate:show":a[1]||(a[1]=n=>K.value=n),"content-list":_(Ae),"active-index":ee.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9",onSubmit:$e},null,8,["show","content-list","active-index"]),E(wt,{"is-show":q.value},null,8,["is-show"])],64)}}});var Qt=ut(xt,[["__scopeId","data-v-12cc8ba0"]]);export{Qt as default};
