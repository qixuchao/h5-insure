var j=Object.defineProperty,R=Object.defineProperties;var $=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var M=(r,o,u)=>o in r?j(r,o,{enumerable:!0,configurable:!0,writable:!0,value:u}):r[o]=u,x=(r,o)=>{for(var u in o||(o={}))z.call(o,u)&&M(r,u,o[u]);if(T)for(var u of T(o))G.call(o,u)&&M(r,u,o[u]);return r},k=(r,o)=>R(r,$(o));import{g as S,E as h,M as P,_ as J,r as v,j as g,k as y,m as D,p as F,A as n,z as d,J as W,L as X,T as A,O as Y,a9 as K,h as Q,n as Z,G as ee,F as te,C as ae}from"./vendor-667a94d7.js";import{a as oe}from"./infoCollection-242da9b6.js";import{s as ne,c as ue}from"./phoneVerify-270f9e92.js";import{v as U,a as q,b as se}from"./validator-ebd71d12.js";import{F as L,g as re,t as le,a as ie}from"./theme-7decec6d.js";import{a3 as ce}from"./index-b09072ab.js";import{g as me,m as de,i as fe}from"./trial-844d61d0.js";import{p as ve}from"./product-2b8d9c0e.js";import"./trial-4c05804a.js";const pe=S({props:{userInfo:{type:Object,default:()=>{}}},emits:["on-verify"],setup(r,{emit:o}){var i;const u=r,s=h({}),c=h(!1),V=30,l=h(0),p=h("\u83B7\u53D6\u9A8C\u8BC1\u7801"),e=P({mobile:(i=u.userInfo)==null?void 0:i.mobile,smsCode:""}),f=t=>U(t)?!0:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7",b=t=>q(t)?!0:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u9A8C\u8BC1\u7801",E=()=>{if(l.value>0)return;l.value=V;const t=()=>{p.value=`${l.value}s`,l.value-=1};t();const a=setInterval(()=>{l.value===0?(p.value="\u83B7\u53D6\u9A8C\u8BC1\u7801",l.value=0,clearInterval(a)):t()},1e3)},N=async()=>{l.value>0||s==null||s.value.validate("mobile").then(async()=>{const t=await ne(e.mobile),{code:a,data:m}=t;a==="10000"&&(c.value=!0,A({message:"\u77ED\u4FE1\u53D1\u9001\u6210\u529F\uFF0C\u8BF7\u67E5\u6536"}),E())})},_=async()=>{const t=await ue(e.mobile,e.smsCode),{data:a}=t;a&&o("on-verify",e)},w=async()=>{s==null||s.value.validate().then(async()=>{_()})};return J(()=>e,()=>{U(e.mobile)&&q(e.smsCode)&&c.value&&_()},{deep:!0,immediate:!0}),(t,a)=>{const m=v("van-field"),B=v("van-cell-group"),C=v("VanForm");return g(),y(C,{ref_key:"formRef",ref:s,"label-width":"60"},{default:D(()=>[F(B,null,{default:D(()=>[F(m,{modelValue:n(e).mobile,"onUpdate:modelValue":a[0]||(a[0]=I=>n(e).mobile=I),name:"mobile",label:"\u624B\u673A\u53F7",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",maxlength:n(L).MOBILE,rules:[{validator:f}]},null,8,["modelValue","maxlength","rules"]),F(m,{modelValue:n(e).smsCode,"onUpdate:modelValue":a[1]||(a[1]=I=>n(e).smsCode=I),name:"smsCode",label:"\u9A8C\u8BC1\u7801",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",maxlength:n(L).SMS_CODE,rules:[{validator:b}]},{button:D(()=>[d("div",{class:X(["sms-code",{"count-down":l.value>0}]),onClick:N},W(p.value),3)]),_:1},8,["modelValue","maxlength","rules"])]),_:1}),d("div",{class:"submit",onClick:w})]),_:1},512)}}}),_e=S({props:{userInfo:{type:Object,default:()=>{}}},emits:["on-submit"],setup(r,{emit:o}){const u=r,s=h({}),c=P({name:u.userInfo.name,certNo:u.userInfo.certNo}),V=e=>ce(c.certNo)?!0:"\u8BF7\u586B\u5199\u6B63\u786E\u7684\u8BC1\u4EF6\u53F7",l=e=>se(e)?!0:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u59D3\u540D",p=()=>{s==null||s.value.validate().then(async e=>{o("on-submit",c)})};return(e,f)=>{const b=v("van-field"),E=v("van-cell-group"),N=v("VanForm");return g(),y(N,{ref_key:"formRef",ref:s,"label-width":"60"},{default:D(()=>[F(E,null,{default:D(()=>[F(b,{modelValue:n(c).name,"onUpdate:modelValue":f[0]||(f[0]=_=>n(c).name=_),name:"name",label:"\u59D3\u540D",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D",maxlength:n(L).NAME,rules:[{validator:l}]},null,8,["modelValue","maxlength","rules"]),F(b,{modelValue:n(c).certNo,"onUpdate:modelValue":f[1]||(f[1]=_=>n(c).certNo=_),name:"certNo",label:"\u8EAB\u4EFD\u8BC1",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u8EAB\u4EFD\u8BC1\u53F7",maxlength:n(L).ID_CARD,rules:[{validator:V}]},null,8,["modelValue","maxlength","rules"])]),_:1}),d("div",{class:"submit",onClick:p})]),_:1},512)}}});var he="/static/assets/title-step1.97cb9efa.png",be="/static/assets/title-step2.258af5e9.png";const Ce={class:"page-activity-invite"},ge=["src"],Fe={class:"container"},Be={class:"main-form"},Ie={class:"title"},ye=["src"],De={class:"agree"},Ve=ae(" \u6211\u5DF2\u9605\u8BFB\u5E76\u540C\u610F "),Te=S({setup(r){const o=Y(),u=K(),{productCode:s="7X9",tenantId:c="",extInfo:V}=o.query,l=re(V),p=h(!0),e=P({title:he,attachmentList:[{attachmentName:"",attachmentUrl:""}],userInfo:{mobile:l.phoneNo,certNo:"",name:""},agree:!1}),f=h(),b=h(),E=async i=>{var B,C;e.userInfo.mobile=i.mobile;const t=await me({holderPhone:e.userInfo.mobile,productCode:s,tenantId:c}),{code:a,data:m}=t;a==="10000"&&(e.userInfo.name=(B=m.tenantOrderHolder)==null?void 0:B.name,e.userInfo.certNo=(C=m.tenantOrderHolder)==null?void 0:C.certNo),e.title=be,p.value=!1},N=async i=>{if(!e.agree){A("\u8BF7\u52FE\u9009\u534F\u8BAE");return}try{A({message:"\u9886\u53D6\u4E2D...",forbidClick:!0,loadingType:"spinner"}),e.userInfo.certNo=i.certNo,e.userInfo.name=i.name;const t=ie(k(x({tenantId:c,detail:f.value},l),{holder:e.userInfo,insured:k(x({},e.userInfo),{relationToHolder:oe.SELF})})),a=await de(t),{code:m}=a;m==="10000"&&u.push({path:"/chuangxin/baigebao/productDetail",query:k(x({},o.query),{tenantId:c,productCode:"BWYL2021",extInfo:JSON.stringify(k(x({},l),{phoneNo:e.userInfo.mobile,certNo:e.userInfo.certNo,name:e.userInfo.name}))})}),A.clear()}catch(t){console.log(t),A.clear()}},_=()=>{let i=[];return b.value.productRiskVoList.forEach(t=>{t.riskDetailVOList.forEach(a=>{i=i.concat(a.riskAttachmentVOList)})}),i},w=async()=>{const i=ve({productCode:s,withInsureInfo:!0}),t=fe({productCode:s});Promise.all([i,t]).then(([a,m])=>{a.code==="10000"&&(f.value=a.data),m.code==="10000"&&(b.value=m.data,e.attachmentList=_())})};return Q(()=>{w()}),(i,t)=>{const a=v("van-checkbox"),m=v("ProPDFviewer"),B=v("van-config-provider");return g(),y(B,{"theme-vars":n(le)},{default:D(()=>{var C,I;return[d("div",Ce,[d("img",{src:(I=(C=f.value)==null?void 0:C.tenantProductInsureVO)==null?void 0:I.banner[0],class:"banner"},null,8,ge),d("div",Fe,[d("div",Be,[d("div",Ie,[d("img",{src:n(e).title},null,8,ye)]),p.value?(g(),y(pe,{key:0,"user-info":n(e).userInfo,onOnVerify:E},null,8,["user-info"])):(g(),y(_e,{key:1,"user-info":n(e).userInfo,onOnSubmit:N},null,8,["user-info"])),d("div",De,[F(a,{modelValue:n(e).agree,"onUpdate:modelValue":t[0]||(t[0]=O=>n(e).agree=O),name:"agree",shape:"square"},null,8,["modelValue"]),d("div",null,[Ve,(g(!0),Z(te,null,ee(n(e).attachmentList||[],(O,H)=>(g(),y(m,{key:H,class:"file-name",title:`\u300A${O.attachmentName}\u300B`,content:O.attachmentUrl,type:"pdf"},null,8,["title","content"]))),128))])])])])])]}),_:1},8,["theme-vars"])}}});export{Te as default};
