import{l as e,a as i,P as l}from"./index-a38fa86a.js";import{d as a,z as s,o as t,a1 as n,R as o,c as u,A as r,V as d,U as c,g as p,i as v,w as k,h as m,G as f,aN as I,r as y,e as L,f as h,aO as g,aP as V,L as R,ah as b,j as C,E as P,aB as O,aZ as x,a3 as T,ab as D,B as S,a_ as w,a$ as F,am as _,an as E,u as M,a as N,$ as j,k as A,n as U,av as q,T as B,P as $,p as K}from"./index-e32ca97e.js";import{I as Q}from"./index-c514e492.js";/* empty css              */import{S as W}from"./index-111ade0a.js";import{P as z}from"./index-be618631.js";import{S as H,_ as G}from"./box-title-6c7b23cb.js";import{_ as J}from"./index-eb642a45.js";import{T as Z}from"./Table-8cdb65e7.js";import{R as X}from"./trial-b1e13459.js";import{u as Y,b as ee,p as ie,q as le,c as ae}from"./trial-791014af.js";import{u as se}from"./useOrder-63393888.js";import{t as te}from"./utils-58f4fae0.js";import{P as ne,B as oe}from"./constants-7afb7c3d.js";import{n as ue}from"./nextStep-c2049299.js";const re={key:0},de={key:0,class:"risk2-field"},ce=a({name:"ProductRiskList"});var pe=f(a({...ce,props:{dataSource:{type:Array,default:()=>[]},productInfo:{type:Object,default:()=>({productCode:"",productName:""})},showMainRisk:{type:Boolean,default:()=>!0},defaultValue:{type:Object,default:()=>{}}},emits:["trialChange"],setup(e,{emit:i}){const l=e,a=s({loading:!1,show:!0,select:{},list:[],userData:{},riskIsInsure:{},submitData:{},disabledRiskInfo:[],risksDefaultValue:{}}),f=e=>{const i=[];return e.riskLiabilityInfoVOList.map((e=>(1!=+e.showFlag&&i.push({...e}),[]))),i},y=(e,s,t)=>{var n;a.riskIsInsure[s].data=e;const o=[...a.disabledRiskInfo];null==(n=l.dataSource.insureProductRiskVOList)||n.forEach((e=>{if(1!==e.mainRiskFlag){const i=a.riskIsInsure[e.riskId];i.data&&Object.keys(i.data).length>0&&"1"===i.selected&&o.push(i.data)}})),i("trialChange",o,t)},L=(e,i)=>{var s;null==(s=l.dataSource.productRiskRelationVOList)||s.forEach((l=>{1!==l.collocationType&&(i.riskId===l.riskId?(a.riskIsInsure[i.riskId]&&a.riskIsInsure[i.riskId].selected,2===l.collocationType&&a.riskIsInsure[l.collocationRiskId]&&(a.riskIsInsure[l.collocationRiskId].selected=e),3===l.collocationType&&a.riskIsInsure[l.collocationRiskId]&&"1"===e&&(a.riskIsInsure[l.collocationRiskId].selected="1"===e?"2":"1")):i.riskId===l.collocationRiskId&&(3===l.collocationType&&"1"===e&&a.riskIsInsure[l.riskId]&&(a.riskIsInsure[l.riskId].selected="1"===e?"2":"1"),2===l.collocationType&&a.riskIsInsure[l.riskId]&&(a.riskIsInsure[l.riskId].selected=e)))})),"2"===e?y({},i.riskId):(e=>{var i,l,a,s,t,n,o,u,r,d,c,p;if(1!==(null==e?void 0:e.factorDisPlayFlag)){const v=null==(i=null==e?void 0:e.productRiskInsureLimitVO)?void 0:i.amountPremiumConfigVO,k={riskCategory:e.riskCategory,riskCode:e.riskCode,riskName:e.riskName,riskId:e.riskId,riskType:e.riskType,mainRiskId:e.mainRiskId,mainRiskCode:e.mainRiskCode,liabilityList:f(e)};k.chargePeriod=(null==(a=null==(l=null==e?void 0:e.productRiskInsureLimitVO)?void 0:l.paymentPeriodValueList)?void 0:a.length)>0&&(null==(s=null==e?void 0:e.productRiskInsureLimitVO)?void 0:s.paymentPeriodValueList[0].code)||null,k.coveragePeriod=(null==(n=null==(t=null==e?void 0:e.productRiskInsureLimitVO)?void 0:t.insurancePeriodValueList)?void 0:n.length)>0&&(null==(o=null==e?void 0:e.productRiskInsureLimitVO)?void 0:o.insurancePeriodValueList[0].code)||null,k.paymentFrequency=(null==(r=null==(u=null==e?void 0:e.productRiskInsureLimitVO)?void 0:u.paymentFrequencyList)?void 0:r.length)>0&&(null==(d=null==e?void 0:e.productRiskInsureLimitVO)?void 0:d.paymentFrequencyList[0].code)||null;let m=0;1===v.displayType?m=(null==v?void 0:v.minStepValue)>0?null==v?void 0:v.minStepValue:0:3===v.displayType&&2===v.requireCopies?m=(null==(c=null==v?void 0:v.displayValues)?void 0:c.length)>0?null==v?void 0:v.displayValues[0].value:0:3===v.displayType&&1===v.requireCopies?(m=(null==(p=null==v?void 0:v.displayValues)?void 0:p.length)>0?null==v?void 0:v.displayValues[0].value:0,k.copy=v.minCopiesValue):2===v.displayType?k.copy=v.minCopiesValue:m=0,1===v.saleMethod?k.initialAmount=m:k.initialPremium=m,y(k,e.riskId)}})(i)};return t((()=>{(()=>{var e,i;a.disabledRiskInfo=[];let s=null;if(null==(e=l.dataSource.insureProductRiskVOList)||e.forEach((e=>{var i;const t=1!==e.mainRiskFlag?null==(i=l.dataSource.productRiskRelationVOList)?void 0:i.find((i=>i.collocationRiskId===e.riskId)):{};1===e.mainRiskFlag&&(s=e),a.riskIsInsure[e.riskId]?(a.riskIsInsure[e.riskId].data=null,a.riskIsInsure[e.riskId].relation=t,a.riskIsInsure[e.riskId].isMust=!1):a.riskIsInsure[e.riskId]={selected:"2",data:null,relation:t,isMust:!1}})),s){const e=null==(i=l.dataSource.productRiskRelationVOList)?void 0:i.filter((e=>e.riskId===s.riskId));if(!e)return;null==e||e.forEach((e=>{var i,s,t,n,o,u,r,d,c,p,v,k,m,I,L;if(2===e.collocationType){a.riskIsInsure[e.collocationRiskId].selected="1",a.riskIsInsure[e.collocationRiskId].isMust=!0;const h=null==(i=l.dataSource.insureProductRiskVOList)?void 0:i.find((i=>e.collocationRiskId===i.riskId));if(h&&1!==h.factorDisPlayFlag&&(null==(s=null==h?void 0:h.productRiskInsureLimitVO)?void 0:s.amountPremiumConfigVO)){const i=null==(t=h.riskLiabilityInfoVOList)?void 0:t.every((e=>1!==e.showFlag)),l=null==(n=null==h?void 0:h.productRiskInsureLimitVO)?void 0:n.amountPremiumConfigVO;if(i){a.riskIsInsure[e.collocationRiskId].isDisabled=!0;const i={riskCategory:h.riskCategory,riskCode:h.riskCode,riskName:h.riskName,riskId:h.riskId,riskType:h.riskType,mainRiskId:h.mainRiskId,mainRiskCode:h.mainRiskCode,liabilityList:f(h)};i.chargePeriod=(null==(u=null==(o=null==h?void 0:h.productRiskInsureLimitVO)?void 0:o.paymentPeriodValueList)?void 0:u.length)>0&&(null==(r=null==h?void 0:h.productRiskInsureLimitVO)?void 0:r.paymentPeriodValueList[0].code)||null,i.coveragePeriod=(null==(c=null==(d=null==h?void 0:h.productRiskInsureLimitVO)?void 0:d.insurancePeriodValueList)?void 0:c.length)>0&&(null==(p=null==h?void 0:h.productRiskInsureLimitVO)?void 0:p.insurancePeriodValueList[0].code)||null,i.paymentFrequency=(null==(k=null==(v=null==h?void 0:h.productRiskInsureLimitVO)?void 0:v.paymentFrequencyList)?void 0:k.length)>0&&(null==(m=null==h?void 0:h.productRiskInsureLimitVO)?void 0:m.paymentFrequencyList[0].code)||null;let s=0;1===l.displayType?s=(null==l?void 0:l.minStepValue)>0?null==l?void 0:l.minStepValue:0:3===l.displayType&&2===l.requireCopies?s=(null==(I=null==l?void 0:l.displayValues)?void 0:I.length)>0?null==l?void 0:l.displayValues[0].value:0:3===l.displayType&&1===l.requireCopies?(s=(null==(L=null==l?void 0:l.displayValues)?void 0:L.length)>0?null==l?void 0:l.displayValues[0].value:0,i.copy=l.minCopiesValue):2===l.displayType&&(i.copy=l.minCopiesValue),1===l.saleMethod?i.initialAmount=s:i.initialPremium=s,a.disabledRiskInfo.push(i),y(i,h.riskId)}}}3===e.collocationType&&(a.riskIsInsure[e.collocationRiskId].selected="2",a.riskIsInsure[e.collocationRiskId].isMust=!0)}))}})()})),n((()=>{a.loading=!0})),o((()=>a.riskIsInsure),(e=>{}),{deep:!0,immediate:!0}),o((()=>l.defaultValue),(e=>{(null==e?void 0:e.length)>0&&e.forEach((e=>{a.risksDefaultValue[e.riskCode]=e,a.riskIsInsure[e.riskId]?(a.riskIsInsure[e.riskId].selected="1",y(e,e.riskId)):a.riskIsInsure[e.riskId]={selected:"1",isMust:!1}}))}),{deep:!0,immediate:!0}),(i,l)=>{const s=W,t=I;return u(!0),r(c,null,d(e.dataSource.insureProductRiskVOList,(i=>{var l,n;return u(),r(c,{key:i.riskCode},[(!e.showMainRisk&&1!==i.mainRiskFlag||e.showMainRisk)&&(null==(n=null==(l=p(a).riskIsInsure)?void 0:l[i.riskId])?void 0:n.relation)?(u(),r("div",re,[v(t,{modelValue:p(a).riskIsInsure[i.riskId].selected,"onUpdate:modelValue":e=>p(a).riskIsInsure[i.riskId].selected=e,label:i.riskName,name:"selected","label-width":"50%",border:!1,class:"risk-select-field risk-name"},{input:k((()=>[v(s,{modelValue:p(a).riskIsInsure[i.riskId].selected,"onUpdate:modelValue":e=>p(a).riskIsInsure[i.riskId].selected=e,"active-value":"1","inactive-value":"2",size:"0.74rem",disabled:p(a).riskIsInsure[i.riskId].isMust,style:{"margin-right":"8px"},onChange:e=>L(e,i)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])])),_:2},1032,["modelValue","onUpdate:modelValue","label"]),"1"===p(a).riskIsInsure[i.riskId].selected?(u(),r("div",de,[v(Q,{modelValue:p(a).riskIsInsure[i.riskId].data,"onUpdate:modelValue":e=>p(a).riskIsInsure[i.riskId].data=e,"origin-data":i,"product-factor":e.dataSource.productFactor,"default-value":p(a).risksDefaultValue[i.riskCode],onTrialChange:(e,l)=>y(e,i.riskId,l)},null,8,["modelValue","onUpdate:modelValue","origin-data","product-factor","default-value","onTrialChange"])])):m("",!0)])):m("",!0)],64)})),128)}}}),[["__scopeId","data-v-d3264472"]]);const ve={class:"pro-radio-wrap"},ke=a({name:"PlanSelect"}),me=a({...ke,props:{planList:{default:()=>[]},defaultPlan:{default:()=>{}}},emits:["planChange"],setup(e,{emit:i}){const l=e,a=y("");let s=!1;return n((()=>{l.defaultPlan&&(s=!0,a.value=l.defaultPlan.planCode)})),o((()=>a),(e=>{s||i("planChange",a.value),s&&(s=!1)}),{deep:!0,immediate:!0}),(i,s)=>{const t=g,n=V;return e.planList.length>0?(u(),L(n,{key:0,modelValue:a.value,"onUpdate:modelValue":s[1]||(s[1]=e=>a.value=e),label:"保障计划",name:"planCode",class:"risk-select-field"},{input:k((()=>[h("div",ve,[v(t,{modelValue:a.value,"onUpdate:modelValue":s[0]||(s[0]=e=>a.value=e),options:l.planList.map((e=>({label:e.planName,value:e.planCode})))},null,8,["modelValue","options"])])])),_:1},8,["modelValue"])):m("",!0)}}});const fe={class:"benefit-table"},Ie=a({name:"benefitTable"}),ye=a({...Ie,props:{dataSource:null},setup(e){const i=e,l=R((()=>{const e=i.dataSource.headers.length,l=12*i.dataSource.headers.join("").length+20*i.dataSource.headers.length;return i.dataSource.headers.map(((i,a)=>{const s=l>320?12*i.length+20:Math.max(12*i.length+20,320/e);return console.log("totalWordWidth:",l,"titleWidth:",s,"word-width:",12*i.length+20),{title:i,key:`header_${a}`,fixed:a<2,minWidth:s}}))})),a=R((()=>i.dataSource.dataList.map((e=>{const i={};return e.forEach(((e,l)=>{i[`header_${l}`]=e})),i}))));return n((()=>{})),(e,i)=>(u(),r("div",fe,[v(Z,{"top-height":400,columns:p(l),data:p(a),"is-clone":!0},null,8,["columns","data"])]))}});const Le=e=>(_("data-v-d9a31ad8"),e=e(),E(),e),he={key:0,class:"benefit-container"},ge={key:0,class:"benefit"},Ve=Le((()=>h("div",{class:"line"},null,-1))),Re={class:"box-title box-title-chart"},be=Le((()=>h("img",{class:"tl",src:G,alt:""},null,-1))),Ce=Le((()=>h("img",{class:"transform-z180 tr",src:G,alt:""},null,-1))),Pe={key:0},Oe={class:"box"},xe={class:"box-title"},Te=Le((()=>h("img",{class:"tl",src:G,alt:""},null,-1))),De=Le((()=>h("img",{class:"transform-z180 tr",src:G,alt:""},null,-1))),Se={class:"box-price"},we={class:"text1"},Fe={class:"text2"},_e={key:1},Ee={key:2,style:{width:"100%, minWidth: 338px"}},Me={class:"slider"},Ne={style:{flex:"1",margin:"0px 5px"}},je={class:"custom-button"},Ae=Le((()=>h("p",{class:"slider-dec"},"拖动按钮查看不同年龄保障",-1))),Ue={class:"btn-two"},qe={key:1,class:"benefit-container"},Be={key:0},$e={class:"benefit"},Ke=Le((()=>h("div",{class:"line"},null,-1))),Qe=Le((()=>h("div",null,[h("div",{class:"box"},[h("p",{class:"box-title"},[h("img",{class:"tl",src:G,alt:""}),C(" 保单年度"),h("span",null,"-"),C("年度，被保人"),h("span",null,"-"),C("岁时 "),h("img",{class:"transform-z180 tr",src:G,alt:""})]),h("div",{class:"box-price"})])],-1))),We={class:"slider"},ze={class:"opt lf"},He={style:{flex:"1",margin:"0px 5px"}},Ge=Le((()=>h("div",{class:"custom-button"},"0 岁",-1))),Je={class:"opt rg"},Ze=Le((()=>h("p",{class:"slider-dec"},"拖动按钮查看不同年龄保障",-1))),Xe={class:"btn-two"},Ye={key:1,class:"empty-box"},ei=a({name:"Benefit"});var ii=f(a({...ei,props:{dataSource:{default:()=>({showTypeList:["1"]})},productInfo:{default:()=>null}},setup(e){var i;const l=e,a="1",s="2",t="3",n=y(0),f=y(0),I=y(0),g=y(),V=y(0),R=y(null==(i=l.dataSource.showTypeList)?void 0:i[0]),_=y(),E=e=>{if(!(null==e?void 0:e.benefitRiskResultVOList))return;const i=null==e?void 0:e.benefitRiskResultVOList[n.value];f.value=i.ageBegin+1,V.value=i.ageBegin+1,I.value=i.ageEnd},M=()=>{var e,i,a,s,t,o;const u=null==(i=null==(e=l.dataSource)?void 0:e.benefitRiskResultVOList)?void 0:i[n.value];_.value=null==(t=null==(s=null==(a=l.dataSource)?void 0:a.benefitRiskResultVOList)?void 0:s[n.value].benefitRiskTableResultVOList)?void 0:t[0];const{a:r,year:d}=((e,i)=>{const l=[],a=[];for(let s=e,t=0;s<=i;s++,t++)l.push(s.toString()),a.push(t+1);return{a:l,year:a}})(f.value,I.value),c={index:r.indexOf(V.value.toString()),age:r,year:d,result:null==(o=null==u?void 0:u.benefitRiskItemResultVOList)?void 0:o[0]};g.value=c},N=()=>{V.value>I.value-1||(V.value+=1,M())},j=()=>{V.value>f.value&&(V.value-=1,M())},A=e=>{n.value=e.name,E(l.dataSource),M()};return o((()=>l.dataSource),(e=>{var i;e&&(E(e),M(),R.value=null==(i=e.showTypeList)?void 0:i[0])}),{deep:!0,immediate:!0}),o(V,(()=>{M()})),(i,o)=>{var y;const E=D,M=H,U=S,q=w,B=F,$=z;return(null==(y=e.dataSource)?void 0:y.benefitRiskResultVOList)?(u(),r("div",he,[v(B,{active:p(n),onClickTab:A},{default:k((()=>{var e;return[(u(!0),r(c,null,d(null==(e=l.dataSource)?void 0:e.benefitRiskResultVOList,((e,i)=>(u(),L(q,{key:i,name:i,title:e.riskName},{default:k((()=>{var e,y,D,S,w,F,A,q,B,$,K,Q,W,z,H,G;return[i==p(n)?(u(),r("div",ge,[Ve,b(h("p",Re,[be,C(" 保单年度"),h("span",null,P(null==(D=null==(e=p(g))?void 0:e.year)?void 0:D[null==(y=p(g))?void 0:y.index]),1),C("年度，被保人"),h("span",null,P(null==(F=null==(S=p(g))?void 0:S.age)?void 0:F[null==(w=p(g))?void 0:w.index]),1),C("岁时 "),Ce],512),[[O,p(R)===s]]),p(R)===a?(u(),r("div",Pe,[h("div",Oe,[h("p",xe,[Te,C(" 保单年度"),h("span",null,P(null==(B=null==(A=p(g))?void 0:A.year)?void 0:B[null==(q=p(g))?void 0:q.index]),1),C("年度，被保人"),h("span",null,P(null==(Q=null==($=p(g))?void 0:$.age)?void 0:Q[null==(K=p(g))?void 0:K.index]),1),C("岁时 "),De]),h("div",Se,[(u(!0),r(c,null,d(null==(z=null==(W=p(g))?void 0:W.result)?void 0:z.headers,((e,i)=>{var l,a,s,t,n,o,d,c,v,k;return u(),r("div",{key:i,style:{width:"33%"}},[h("p",we,P(("0"==(null==(n=null==(t=null==(a=null==(l=p(g))?void 0:l.result)?void 0:a.dataList)?void 0:t[null==(s=p(g))?void 0:s.index])?void 0:n[i])?"0":p(x)(Number(null==(k=null==(v=null==(d=null==(o=p(g))?void 0:o.result)?void 0:d.dataList)?void 0:v[null==(c=p(g))?void 0:c.index])?void 0:k[i])))||"0"),1),h("p",Fe,P(e)+"(元）",1)])})),128))])])])):m("",!0),p(R)===t?(u(),r("div",_e,[v(ye,{"data-source":p(_)},null,8,["data-source"])])):m("",!0),p(R)==s?(u(),r("div",Ee,[v(J,{min:p(f),max:p(I),current:p(V),data:null==(G=null==(H=p(g))?void 0:H.result)?void 0:G.benefitRiskItemList},null,8,["min","max","current","data"])])):m("",!0),p(R)!=t?(u(),r(c,{key:3},[h("div",Me,[h("div",{class:"opt lf",onClick:j},[v(E,{name:"minus"})]),h("div",Ne,[p(f)?(u(),L(M,{key:0,modelValue:p(V),"onUpdate:modelValue":o[0]||(o[0]=e=>T(V)?V.value=e:null),min:p(f),max:p(I),"bar-height":"8px"},{button:k((()=>[h("div",je,P(p(V))+" 岁",1)])),_:1},8,["modelValue","min","max"])):m("",!0)]),h("div",{class:"opt rg",onClick:N},[v(E,{name:"plus"})])]),Ae],64)):m("",!0),h("div",Ue,[l.dataSource.showTypeList.includes(a)?(u(),L(U,{key:0,round:"",plain:p(R)!==a,type:"primary",class:"btn",onClick:o[1]||(o[1]=e=>R.value=a)},{default:k((()=>[C("图表展示")])),_:1},8,["plain"])):m("",!0),l.dataSource.showTypeList.includes(s)?(u(),L(U,{key:1,round:"",plain:p(R)!==s,type:"primary",class:"btn",onClick:o[2]||(o[2]=e=>R.value=s)},{default:k((()=>[C("趋势展示")])),_:1},8,["plain"])):m("",!0),l.dataSource.showTypeList.includes(t)?(u(),L(U,{key:2,round:"",plain:p(R)!==t,type:"primary",class:"btn",onClick:o[3]||(o[3]=e=>R.value=t)},{default:k((()=>[C("表格展示")])),_:1},8,["plain"])):m("",!0)])])):m("",!0)]})),_:2},1032,["name","title"])))),128))]})),_:1},8,["active"])])):(u(),r("div",qe,[l.productInfo?(u(),r("div",Be,[v(B,{active:p(n),onClickTab:A},{default:k((()=>[(u(),L(q,{key:1,name:1,title:e.productInfo.insureProductRiskVOList[0].riskName},{default:k((()=>[h("div",$e,[Ke,Qe,h("div",We,[h("div",ze,[v(E,{name:"minus"})]),h("div",He,[v(M,{modelValue:p(V),"onUpdate:modelValue":o[4]||(o[4]=e=>T(V)?V.value=e:null),min:0,max:80,"bar-height":"8px",disabled:""},{button:k((()=>[Ge])),_:1},8,["modelValue"])]),h("div",Je,[v(E,{name:"plus"})])]),Ze,h("div",Xe,[v(U,{round:"",plain:!0,type:"primary",class:"btn",disabled:""},{default:k((()=>[C("图表展示")])),_:1}),v(U,{round:"",plain:!1,type:"primary",class:"btn",disabled:""},{default:k((()=>[C("趋势展示")])),_:1}),v(U,{round:"",plain:!1,type:"primary",class:"btn",disabled:""},{default:k((()=>[C("表格展示")])),_:1})])])])),_:1},8,["title"]))])),_:1},8,["active"])])):(u(),r("div",Ye,[v($,{title:"试算结果正在计算中...","empty-class":"empty-select"})]))]))}}}),[["__scopeId","data-v-d9a31ad8"]]);const li={key:0,class:"head-warning-wrap"},ai=h("div",{class:"warning-icon"},[h("span",null,"!")],-1),si={class:"warning-text"},ti=a({name:"HeadWaring"}),ni=a({...ti,props:{labels:{default:()=>[]}},setup:e=>(i,l)=>e.labels.length>0?(u(),r("div",li,[ai,h("div",si,[(u(!0),r(c,null,d(e.labels,(e=>(u(),r("span",{key:e},P(e),1)))),128))])])):m("",!0)}),oi=(i,l,a)=>{const s=i,{holder:t}=a,n=a.insuredList[0],o=(l||"").split("_");if(o.length<2)return l;if(e.exports.isNaN(Number(o[1])))return l;if(o[1]-=1,1===s.exemptFlag){if("to"===o[0]){let e=0;1===s.exemptType?(null==t?void 0:t.birthday)&&(e=parseInt(""+((new Date).getTime()-new Date(t.birthday).getTime())/31536e6,10)):2===s.exemptType&&(null==n?void 0:n.birthday)&&(e=parseInt(""+(+(new Date).getTime()-new Date(n.birthday).getTime())/31536e6,10)),o[1]=+o[1]-e}o[0]="year"}return o.join("_")},ui=(e,i)=>{const l=[],a={};return null==e||e.forEach((e=>{a[e.riskId]=e})),null==i||i.forEach((e=>{var i,s,t,n;const{collocationType:o,collocationRiskId:u,riskId:r}=e;switch(o){case 2:{const e=null==(i=a[r])?void 0:i.riskName,t=null==(s=a[u])?void 0:s.riskName;l.push(`${e} 和 ${t} 必须同时投保`);break}case 3:{const e=null==(t=a[r])?void 0:t.riskName,i=null==(n=a[u])?void 0:n.riskName;l.push(`${e} 和 ${i} 不能同时投保`);break}}})),l};const ri={class:"com-body"},di={class:"trial-body"},ci={class:"container"},pi=(e=>(_("data-v-124c7c41"),e=e(),E(),e))((()=>h("div",{class:"empty"},null,-1))),vi=a({name:"TrialBody"});var ki=f(a({...vi,props:{dataSource:{default:()=>[]},productInfo:{default:()=>({productCode:"",productName:"",insurerCode:"",tenantId:"",planList:[]})},tenantProductDetail:{default:()=>({})},hideBenefit:{type:Boolean,default:!1},hidePopupButton:{type:Boolean,default:!1},title:{default:"算一算保费"},defaultData:{default:null},isTrial:{type:Boolean,default:!1}},emits:["trialStart","trialEnd"],setup(a,{expose:d,emit:c}){const k=a,f=y(null),I=M();N();const{tenantId:g,templateId:V,preview:R}=I.query,b=y(),C=s({loading:!1,show:!1,select:{},list:[],userData:{},riskIsInsure:{},submitData:{},riskList:[{}],mainRiskVO:{},ifPersonalInfoSuccess:!1,trialMsg:"",trialResultPremium:0,trialResult:{initialPremium:0,initialAmount:0},isAniShow:!1,defaultValue:null,isAutoChange:!1,planIndex:0,isSkipFirstTrial:!1,hadSkipFirstTrial:!1,isQuerying:!1,currentPlanCode:""}),P=se();y();const O=y(),x=y(k.dataSource),T=y([]),D=e=>{const{holder:i,insuredList:l}=e||{};i&&(C.submitData.holder=i),l&&l.length>0&&l.forEach(((e,i)=>{var l;C.submitData.insuredList&&C.submitData.insuredList.length>i?C.submitData.insuredList[i]=e:((null==(l=C.submitData)?void 0:l.insuredList)||(C.submitData.insuredList=[]),C.submitData.insuredList.push(e))}))},S=()=>{console.log("--current plan = ",x.value),console.log("---current submit = ",C.submitData);const i=e.exports.cloneDeep(C.submitData);if(i.holder){const e=x.value.productFactor[1]||[];Object.keys(i.holder).forEach((l=>{if(i.holder[l]){e.find((e=>e.code===l))||(i.holder[l]=null)}}))}const l={occupationClass:"occupationCodeList",occupationCode:"occupationCodeList"};if(i.insuredList){const e=x.value.productFactor[2]||[],a=["productList","beneficiaryList"],s=e.some((e=>"2"==`${e.subModuleType}`));i.insuredList.forEach(((i,t)=>{var n,o;const u=t>=1&&s?2:1;if(Object.keys(i).forEach((s=>{if(!(a.indexOf(s)>=0)&&i[s]){const a=e.find((e=>e.code===s&&(null===e.subModuleType||e.subModuleType===u)));if(l[s]&&!a){if(e.find((e=>e.code===l[s]&&(null===e.subModuleType||e.subModuleType===u))))return}a||(i[s]=null)}})),(null==(n=i.beneficiaryList)?void 0:n.length)>0){const e=x.value.productFactor[3]||[];i.beneficiaryList.forEach((i=>{Object.keys(i).forEach((l=>{e.find((e=>e.code===l))||(i[l]=null)}))}))}i.planCode=x.value.planCode;const r=(null==(o=i.productList[0])?void 0:o.riskList)||[],d=x.value.insureProductRiskVOList||[];if(r&&d){const e=r.filter((e=>null!==d.find((i=>i.riskCode===e.riskCode))));i.productList[0].riskList=e}}))}return i},w=y(),F=y({}),_=["annuityDrawDate","coveragePeriod","chargePeriod","paymentFrequency"],E=e=>{var i,a,s,t,n,o;if(null==(a=null==(i=null==e?void 0:e.data)?void 0:i[0])?void 0:a.productRiskDyInsureFactorVOList){const i=[];if(null==(s=x.value)||s.insureProductRiskVOList.forEach((a=>{var s,t;const n=null==(t=null==(s=null==e?void 0:e.data)?void 0:s[0])?void 0:t.productRiskDyInsureFactorVOList.find((e=>e.riskCode===a.riskCode));if(n){a.productRiskInsureLimitVO={...a.productRiskInsureLimitVO,...n};const e=C.riskList.find((e=>e.riskCode===a.riskCode));let s=!1;l.forEach((i=>{if(_.indexOf(i.valueKey)>=0){const l=a.productRiskInsureLimitVO[i.configKey];if(l&&e){const a=l.find((l=>l.code===e[i.valueKey]));if(a&&2===a.useFlag){const a=l.find((e=>1===e.defaultFlag));e[i.valueKey]=a.code,s=!0}}}})),s&&i.push({...e,...n,riskCode:a.riskCode})}})),i.length>0&&(null==(o=null==(n=null==(t=C.defaultValue)?void 0:t.insuredList)?void 0:n[0])?void 0:o.productList))return i.forEach((e=>{var i,l,a;C.defaultValue.insuredList[0].productList=null==(a=null==(l=null==(i=C.defaultValue)?void 0:i.insuredList)?void 0:l[0])?void 0:a.productList.map((i=>(i.riskList=null==i?void 0:i.riskList.map((i=>(i.riskCode===e.riskCode&&(i=e),i))),i)))})),!1}return!0},W=async(e,i=!0)=>{C.trialMsg="试算中...",C.trialResultPremium=0,C.loading=!0,c("trialStart");let l=!1;if(i){const{code:i}=await Y(e);l="10000"===i}!l&&i||(C.isQuerying=!0,k.hideBenefit||ee(e).then((e=>{e.data&&e.code===q&&(F.value=e.data)})).finally((()=>{C.loading=!1})),ie(e).then((i=>{var l,a;if(i.data&&i.code===q){(null==(l=null==i?void 0:i.data)?void 0:l.errorInfo)&&B(`${null==(a=null==i?void 0:i.data)?void 0:a.errorInfo}`),C.trialMsg="",C.trialResultPremium=i.data.initialPremium,C.trialResult=i.data;const s={};i.data.riskPremiumDetailVOList&&i.data.riskPremiumDetailVOList.length&&i.data.riskPremiumDetailVOList.forEach((e=>{s[e.riskCode]={initialAmount:e.initialAmount,initialPremium:e.initialPremium}})),w.value=s,c("trialEnd",i.data,e)}})).finally((()=>{C.loading=!1,C.isQuerying=!1})))},z=e.exports.debounce((async()=>{console.log(">>>>>调用试算<<<<<",C.ifPersonalInfoSuccess);const{productCode:e,productName:i}=k.productInfo||{};if(C.ifPersonalInfoSuccess||b.value.canTrail()){C.submitData.productCode=e,C.submitData.productName=i,C.submitData.tenantId=k.productInfo.tenantId,C.riskList=C.riskList.map((e=>(e=>{var i,a,s,t;const n=null==(i=x.value.insureProductRiskVOList)?void 0:i.find((i=>e.riskId===i.riskId));if(n&&1!==n.mainRiskFlag){const i=null==(s=null==(a=x.value)?void 0:a.productRiskRelationVOList)?void 0:s.filter((e=>{var i;if(e.collocationRiskId===n.riskId&&3!==e.collocationType){const l=null==(i=x.value.insureProductRiskVOList)?void 0:i.find((i=>e.riskId===i.riskId));if(l&&l.riskType===X.MAIN_RISK)return!0}return!1})),o=i.length>0?i[0]:null;if(o){const i=null==(t=C.riskList)?void 0:t.find((e=>e.riskId===o.riskId));l.forEach((l=>{l.ruleKey&&n.productRiskInsureLimitVO&&i&&(1===n.productRiskInsureLimitVO[l.ruleKey]&&(e[l.valueKey]=i[l.valueKey]),3===n.productRiskInsureLimitVO[l.ruleKey]&&(1!==n.exemptFlag?e[l.valueKey]=oi(n,i[l.valueKey],C.submitData):e[l.valueKey]=oi(n,i[l.ruleValueKey],C.submitData)))}))}}return e})(e))),C.submitData.insuredList&&C.submitData.insuredList.forEach((l=>{l.productList=[{productCode:e,productName:i,riskList:C.riskList}]}));const a=S();console.log(">>>数据构建<<<",a),await W(a)}}),300),H=async e=>{var i;const{insuredList:l,isFirstInsuredChange:a}=e;if(D(e),C.ifPersonalInfoSuccess=!0,a){console.log("处理第一被保人修改的dy变化"),C.isQuerying=!0;const e=await le({calcProductFactorList:[{planCode:x.value.planCode,productCode:k.productInfo.productCode,riskEditVOList:[{insureProductRiskVO:null==(i=x.value.insureProductRiskVOList)?void 0:i[0]}]}],...l[0]});if(C.isQuerying=!1,!E(e))return}console.log("投被保人的信息回传 ",e),z()},G=async(i,l)=>{var a,s,t,n;if(l){const o=e.exports.cloneDeep(i);delete o.insurancePeriodValueList,delete o.paymentFrequencyList,delete o.paymentPeriodValueList;if(_.indexOf(l.key)>=0&&`${l.oldValue}`!=`${l.newValue}`){const e={};switch(l.key){case"annuityDrawDate":e.changeType=3;break;case"coveragePeriod":e.changeType=2;break;case"chargePeriod":e.changeType=1}const u=null==(s=null==(a=C.submitData)?void 0:a.insuredList)?void 0:s[0],r=null==(n=null==(t=x.value)?void 0:t.insureProductRiskVOList)?void 0:n.find((e=>e.riskCode===i.riskCode));if(!C.isAutoChange){C.isQuerying=!0;const l=await le({calcProductFactorList:[{planCode:x.value.planCode,productCode:k.productInfo.productCode,riskEditVOList:[{insureProductRiskVO:r,insureRiskEditReqVO:{riskId:i.riskId,riskCode:i.riskCode,...o,...e}}]}],...u});C.isQuerying=!1;const a=E(l);return a||(C.isAutoChange=!0),a}C.isAutoChange=!1}}return!0},J=async(e,i)=>{C.mainRiskVO=e;await G(e,i)&&(C.riskList.length>0&&(C.riskList[0]=e),console.log("标准险种的信息回传",e),z())},Z=async(e,i)=>{if(C.riskList=[C.mainRiskVO,...e],console.log("附加险列表数据回传",e),i){const l=e.find((e=>e.riskCode===i.riskCode));if(!(await G(l,i)))return}z()},re=e=>{var i,l,a,s;C.userData=e,C.defaultValue=e;const t=(null==(i=e.insuredList)?void 0:i[0].productList.findIndex((e=>e.planCode===x.value.planCode)))||0;C.planIndex=-1===t?0:t,C.riskList=(null==(s=null==(a=null==(l=null==e?void 0:e.insuredList)?void 0:l[0].productList)?void 0:a[C.planIndex])?void 0:s.riskList)||[],W(e,!0)},de=async e=>{var i;if(k.defaultData){const e=k.defaultData.find((e=>e.productCode===k.productInfo.productCode))||k.defaultData[0];re(e),D(null==(i=k.defaultData)?void 0:i[0])}else T.value.push(x.value.planCode),await(async()=>{var e;const i=await ae({calcProductFactorList:[{planCode:x.value.planCode,productCode:k.productInfo.productCode}]});if(i.data){const l=i.data.find((e=>e.productCode===k.productInfo.productCode))||i.data[0];re(l),D(null==(e=i.data)?void 0:e[0])}})()},ce=async e=>{var i,l;const a=k.productInfo.planList.findIndex((i=>i.planCode===e)),s=(null==(l=null==(i=C.defaultValue)?void 0:i.insuredList)?void 0:l[0].productList.findIndex((i=>i.planCode===e)))||0,t=a>=0?k.productInfo.planList[a]:null;t&&(C.currentPlanCode=e,x.value=t,C.planIndex=s>=0?s:0,C.defaultValue.insuredList[0].productList[C.planIndex].riskList=C.riskList,T.value.findIndex((i=>i===e))<0&&T.value.push(e))};t((()=>{var e,i;C.select={},C.list=[],C.userData={},C.riskIsInsure={},C.submitData={},C.riskList=[{}],C.mainRiskVO={},C.ifPersonalInfoSuccess=!1,C.trialMsg="",C.trialResultPremium=0,C.riskIsInsure={},null==(i=null==(e=x.value)?void 0:e.insureProductRiskVOList)||i.forEach((e=>{var i;const l=null==(i=x.value.productRiskRelationVOList)?void 0:i.find((i=>i.collocationRiskId===e.riskId));l&&(C.riskIsInsure[e.riskCode]={selected:"2",data:null,relation:l})}))})),n((()=>{x.value=k.dataSource,C.loading=!0,C.show=!0,C.isAniShow=!0,C.isSkipFirstTrial=!0,C.hadSkipFirstTrial=!1,j((()=>{de()}))}));return d({getTrialSuccessFlag:()=>C.trialResultPremium>0,validate:()=>b.value.validate(!1),validateTrialFields:()=>b.value.validateTrialFields(),validateHolder:e=>{var i;return null==(i=b.value)?void 0:i.validateHolder(e)},getUserData:()=>({...C.userData}),onShare:e=>{var i;C.trialResultPremium&&(null==(i=f.value)||i.validate().then((()=>{Object.assign(P.value,{extInfo:{...P.value.extInfo,buttonCode:oe.TRIAL_PREMIUM,pageCode:ne.TRIAL_PREMIUM,templateId:V}});const i=te(k.productInfo,w.value,P.value);ue(i,((i,l)=>{l===$.JUMP_PAGE&&(O.value.link=`${window.location.href}&isShare=1&orderNo=${i.orderNo}`,e())})),console.log("---- validate success ----")})))},onNext:()=>{var e;R?U(ne.TRIAL_PREMIUM,I.query):C.trialResultPremium&&(null==(e=f.value)||e.validate().then((()=>{Object.assign(P.value,{extInfo:{...P.value.extInfo,buttonCode:oe.TRIAL_PREMIUM,pageCode:ne.TRIAL_PREMIUM,templateId:V}});const e=te(S(),C.trialResult,P.value);ue(e,((e,i)=>{i===$.JUMP_PAGE&&K(e.nextPageCode,{...I.query,orderNo:e.orderNo})})),console.log("---- validate success ----")})),C.loading=!1,C.show=!0,C.isAniShow=!0)}}),o((()=>C.riskIsInsure),(e=>{}),{deep:!0,immediate:!0}),o((()=>C.userData),(e=>{if(e){const{holder:i,insuredList:l}=e||{};Object.assign(C.submitData,{holder:i,insuredList:l})}}),{deep:!0}),o((()=>k.dataSource),(e=>{x.value=e}),{deep:!0,immediate:!0}),(e,l)=>{var s,t,n,o,d,c,k,I;return u(),r("div",ri,[A(e.$slots,"trialHead",{},void 0,!0),h("div",di,[v(ni,{labels:p(ui)((null==(s=x.value)?void 0:s.insureProductRiskVOList)||[],x.value.productRiskRelationVOList)},null,8,["labels"]),h("div",ci,[!a.hideBenefit&&(null==(t=F.value)?void 0:t.benefitRiskResultVOList)?(u(),L(ii,{key:0,class:"benefit-wrap","data-source":F.value,"product-info":x.value,"show-type-list":F.value.showTypList},null,8,["data-source","product-info","show-type-list"])):m("",!0),a.productInfo.planList&&a.productInfo.planList.length>2?(u(),L(me,{key:1,"plan-list":a.productInfo.planList,"default-plan":x.value,onPlanChange:ce},null,8,["plan-list","default-plan"])):m("",!0),x.value.productFactor?(u(),L(p(i),{ref_key:"personalInfoRef",ref:b,key:x.value.planCode,modelValue:p(C).userData,"onUpdate:modelValue":l[0]||(l[0]=e=>p(C).userData=e),"is-trial":a.isTrial,"product-factor":x.value.productFactor,"multi-insured-config":null==(n=x.value)?void 0:n.multiInsuredConfigVO,onTrailChange:H},null,8,["modelValue","is-trial","product-factor","multi-insured-config"])):m("",!0),(u(),L(Q,{ref_key:"insureInfosRef",ref:f,key:x.value.planCode,"origin-data":null==(o=x.value.insureProductRiskVOList)?void 0:o[0],"product-factor":x.value.productFactor,"default-value":p(C).defaultValue?null==(c=null==(d=p(C).defaultValue)?void 0:d.insuredList[0].productList[p(C).planIndex])?void 0:c.riskList[0]:null,"trial-result":p(C).trialResult,onTrialChange:J},null,8,["origin-data","product-factor","default-value","trial-result"])),x.value.insureProductRiskVOList?(u(),L(pe,{key:x.value.planCode,"data-source":x.value,"show-main-risk":!1,"default-value":p(C).defaultValue?null==(I=null==(k=p(C).defaultValue)?void 0:k.insuredList[0].productList[p(C).planIndex])?void 0:I.riskList:[],onTrialChange:Z},null,8,["data-source","default-value"])):m("",!0),pi])]),A(e.$slots,"trialBtn",{trialData:p(C).submitData,riskPremium:p(C).trialResult,loading:p(C).isQuerying},void 0,!0)])}}}),[["__scopeId","data-v-124c7c41"]]);export{ki as T};
