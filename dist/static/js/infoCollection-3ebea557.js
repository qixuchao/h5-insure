import{d as e,X as t,Y as a,u as o,z as n,r,L as i,Z as s,o as l,b as d,c as u,e as c,w as p,f as m,g as f,h as v,i as h,a2 as I,j as C,n as O,T as y,P as j,p as b,a3 as _,a4 as L,C as x}from"./index-77c302b9.js";import{t as g}from"./ProRenderFormWithCard.vue_vue_type_style_index_0_scoped_true_lang-4e7aa167.js";/* empty css              */import"./bankCard-3b2e2ed7.js";import{_ as P}from"./PayInfo-10017e36.js";import{g as w,i as T}from"./trial-1329902d.js";import{_ as V}from"./TrialButton-90990011.js";import{n as N}from"./nextStep-68aafa24.js";import{u as k}from"./useAttachment-8706f6b2.js";import{a as E,q as S}from"./product-2a1030c0.js";import{t as F,g as R}from"./utils-834e8d09.js";import{u as q}from"./useOrder-c0e2df3c.js";import{P as A,B as U}from"./constants-7afb7c3d.js";import{f as D}from"./utils-6f00b003.js";import{T as B}from"./index-c38835f5.js";import"./pdfh5-008ca364.js";import"./phoneVerify-8bbd0364.js";import"./_initCloneObject-0663309f.js";import"./isObjectLike-a9798079.js";import"./debounce-eed12388.js";import"./index-370c1183.js";import"./index-ae8f591f.js";import"./index-6683e55f.js";import"./core-a1508ca5.js";import"./constant-8927d485.js";import"./infoCollection-cbc2db04.js";import"./trial-58ba8a4d.js";import"./createProposal-1a4fc1c2.js";import"./index-c1cb4b1a.js";import"./cloneDeep-1de8e9b0.js";import"./index-bf9511e4.js";import"./index-8d1686ce.js";import"./empty-c926d8ec.js";import"./box-title-0bdfd1d2.js";import"./index-9ce465e7.js";import"./echarts-ac920fed.js";import"./Table-4eb08cac.js";const H={class:"long-info-collection"},M=e({__name:"infoCollection",setup(e){const M=t((()=>a((()=>import("./index-82c4345f.js")),["static/js/index-82c4345f.js","static/css/index-fa4edf2a.css","static/js/index-77c302b9.js","static/css/index-491aafee.css","static/js/pdfh5-008ca364.js","static/js/index-6683e55f.js","static/css/index-827a8544.css","static/js/utils-834e8d09.js","static/js/infoCollection-cbc2db04.js","static/js/trial-58ba8a4d.js"]))),J=t((()=>a((()=>import("./index-2e7d4b70.js")),["static/js/index-2e7d4b70.js","static/css/index-3329e46f.css","static/js/index-77c302b9.js","static/css/index-491aafee.css","static/js/pdfh5-008ca364.js"]))),W=o(),z=q(),{productCode:G="",tenantId:X,agentCode:Y="",agencyCode:$,saleChannelId:Q,isShare:Z,orderNo:K,extraInfo:ee,insurerCode:te,preview:ae}=W.query;let oe={};try{oe=JSON.parse(decodeURIComponent(ee))}catch(Ae){}const ne=n({isView:!1,personalInfo:{},payInfo:{schema:[],config:[],formData:[]},defaultValue:null,isAutoChange:!1}),re=`${window.origin}/baseInsurance/long/phoneVerify${window.location.search}`,ie=r({imgUrl:"",desc:"",title:"",link:re}),se=r(),le=r(),de=r({}),ue=r({}),ce=r([]),pe=r(),me=r({}),fe=r(!1),ve=r(!1),he=r(0),Ie=r(!0),{fileList:Ce,mustReadFileCount:Oe,popupFileList:ye}=k(me,pe),je=r(!1),be=r(!1),_e=()=>{ve.value=!1,Ie.value=!0,ce.value.length<1||(fe.value=!0)},Le=()=>{fe.value=!1,ve.value=!1,Ie.value=!0};r({}),r(!1);const xe=r([{}]),ge=r(""),Pe=r(0),we=r(!1);r();const Te=r();r(),i((()=>{var e,t;const{insureProductRiskVOList:a}=(null==(t=null==(e=ue.value)?void 0:e.productPlanInsureVOList)?void 0:t[0])||{};return(a||[]).find((e=>e.mainRiskFlag===s.YES))}));const Ve=r(0),Ne=r({}),ke=()=>{ge.value="试算中...",Pe.value=0,we.value=!0},Ee=e=>{ge.value="",Ve.value=e.premium,Pe.value=e,we.value=!1},Se=(e={},t={},a={})=>{var o;const n={...a},{tenantOrderHolder:r,tenantOrderInsuredList:i}=D({holder:null==(o=ne.personalInfo.holder)?void 0:o.personVO,insuredList:(ne.personalInfo.insuredVOList||[]).map((e=>e.personVO))}),s={tenantId:X,riskList:xe.value||[],riskPremium:t,productId:e.id};return n.extInfo.iseeBizNo=Te.value,n.productCode=e.productCode,n.commencementTime=n.insuranceStartDate,n.expiryDate=n.insuranceEndDate,n.premium=Ve.value,n.orderAmount=Ve.value,n.orderRealAmount=Ve.value,n.tenantOrderHolder=r,n.tenantOrderInsuredList=i.map((t=>({...t,certType:t.certType||x.CERT,certNo:(t.certNo||"").toLocaleUpperCase(),planCode:me.value.planCode,tenantOrderProductList:[{premium:Ve.value,productCode:e.productCode,productName:e.productName,planCode:me.value.planCode,tenantOrderRiskList:F(s)}]}))),n},Fe=async()=>{var e,t,a;ae?O(A.INFO_COLLECTION,W.query):je.value?Promise.all([null==(e=le.value)?void 0:e.validate(!1),null==(a=null==(t=se.value)?void 0:t.validate)?void 0:a.call(t)]).then((()=>{Object.assign(z.value,{extInfo:{...z.value.extInfo,buttonCode:U.INFO_COLLECTION,pageCode:A.INFO_COLLECTION}});const e=Se(ue.value,Ne.value,z.value);N(e,((e,t)=>{t===j.JUMP_PAGE&&(console.log("12313"),b(e.nextPageCode,W.query))}))})):y("请勾选投保人阅读并接受")},Re=e=>{le.value.validateHolder("mobile").then((()=>{Object.assign(z.value,{extInfo:{...z.value.extInfo,buttonCode:U.INFO_COLLECTION,pageCode:A.INFO_COLLECTION}});const t=Se(ue.value,Ne.value,z.value);N(t,((t,a)=>{a===j.JUMP_PAGE&&(null==e||e())}))})).catch((()=>{y("请录入投保人手机号后进行分享")}))};n({tenantOrderPayInfoList:[]});const qe=async()=>{E({productCode:G,tenantId:X}).then((({data:e,code:t})=>{if("10000"===t){de.value=e;const{wxShareConfig:t,showWXShare:a,title:o,desc:n,image:r}=(null==e?void 0:e.PRODUCT_LIST)||{};a?Object.assign(ie.value,{...t,isShare:a}):Object.assign(ie.value,{title:o,desc:n,image:r,isShare:a}),_(e.BASIC_INFO.themeType)}})),K&&w({orderNo:K,tenantId:X}).then((({code:e,data:t})=>{"10000"===e&&(Pe.value=t.orderAmount,Object.assign(z.value,t,{tenantOrderPayInfoList:t.tenantOrderPayInfoList||[],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0,withPayInfo:!0},productCode:G}),ne.defaultValue=z.value,be.value=!0)})),S({productCode:G}).then((({code:e,data:t})=>{var a,o,n,r;if("10000"===e){const{productMaterialPlanVOList:e,productQuestionnaireVOList:i}=t;pe.value=e||[];const{basicInfo:{questionnaireType:s},questions:l,questionnaireName:d}=(null==(a=null==i?void 0:i[0])?void 0:a.questionnaireDetailResponseVO)||{basicInfo:{}};s&&(ce.value=2===s?[{attachmentName:d,attachmentUri:l,attachmentType:"question"}]:[{attachmentName:d,attachmentUri:null==(o=null==l?void 0:l[0])?void 0:o.content,attachmentType:R(String(null==(n=null==l?void 0:l[0])?void 0:n.textType),null==(r=null==l?void 0:l[0])?void 0:r.content)}])}})),await T({productCode:G,isTenant:!ae}).then((({data:e,code:t})=>{var a,o;if("10000"===t){ue.value=e,me.value=(null==(a=e.productPlanInsureVOList)?void 0:a[0])||{};const{payInfo:t}=g(null==(o=me.value)?void 0:o.productFactor);ne.payInfo={...ne.payInfo,...t}}}))};return l((()=>{qe()})),(e,t)=>{const a=L,o=d("ProPageWrap");return u(),c(o,null,{default:p((()=>{var e,o;return[m("div",H,[f(ne).defaultValue?(u(),c(B,{key:0,"data-source":f(me),"product-info":{productCode:f(G),productName:f(ue).productName,insurerCode:f(te),tenantId:f(X)},"tenant-product-detail":f(de),"hide-benefit":"","default-data":[f(ne).defaultValue],onTrialStart:ke,onTrialEnd:Ee},null,8,["data-source","product-info","tenant-product-detail","default-data"])):v("",!0),f(ne).payInfo.schema.length?(u(),c(f(P),{key:1,ref_key:"payInfoRef",ref:se,modelValue:f(z).tenantOrderPayInfoList,"onUpdate:modelValue":t[0]||(t[0]=e=>f(z).tenantOrderPayInfoList=e),schema:f(ne).payInfo.schema,"is-view":f(ne).isView},null,8,["modelValue","schema","is-view"])):v("",!0),h(a,null,{default:p((()=>{var e;return[(null==(e=f(Ce))?void 0:e.length)?(u(),c(f(J),{key:0,modelValue:f(je),"onUpdate:modelValue":t[1]||(t[1]=e=>I(je)?je.value=e:null),"attachment-list":f(Ce),"is-show-radio":"","pre-text":"投保人阅读并接受",onPreviewFile:t[2]||(t[2]=e=>(e=>{he.value=e,ve.value=!0})(e))},null,8,["modelValue","attachment-list"])):v("",!0)]})),_:1}),h(V,{"is-share":f(ie).isShare&&!f(Z),premium:f(Pe),"share-info":f(ie),"loading-text":f(ge),"payment-frequency":null==(o=null==(e=f(xe))?void 0:e[0])?void 0:o.paymentFrequency,"tenant-product-detail":f(de),"handle-share":Re,onHandleClick:Fe},{default:p((()=>[C("下一步")])),_:1},8,["is-share","premium","share-info","loading-text","payment-frequency","tenant-product-detail"]),f(ve)?(u(),c(f(M),{key:2,show:f(ve),"onUpdate:show":t[3]||(t[3]=e=>I(ve)?ve.value=e:null),"content-list":f(Ie)?f(Ce):f(ye),"is-only-view":f(Ie),"active-index":f(he),text:f(Ie)?"关闭":"我已逐页阅读并确认告知内容","force-read-count":f(Ie)?0:f(Oe),onSubmit:_e,onOnCloseFilePreviewByMask:Le},null,8,["show","content-list","is-only-view","active-index","text","force-read-count"])):v("",!0)])]})),_:1})}}});export{M as default};
