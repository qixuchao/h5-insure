var q=Object.defineProperty,H=Object.defineProperties;var j=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var P=(l,n,s)=>n in l?q(l,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[n]=s,N=(l,n)=>{for(var s in n||(n={}))R.call(n,s)&&P(l,s,n[s]);if(T)for(var s of T(n))$.call(n,s)&&P(l,s,n[s]);return l},x=(l,n)=>H(l,j(n));import{g as O,E as F,M as w,_ as z,r as h,j as C,k as D,m as E,p as B,A as a,z as d,J as G,L as J,T as k,O as W,a9 as X,h as Y,n as K,G as Q,F as Z,C as ee}from"./vendor-667a94d7.js";import{a as te}from"./infoCollection-242da9b6.js";import{s as oe,c as ae}from"./phoneVerify-e542e1fa.js";import{v as S,a as M,b as ne}from"./validator-ebd71d12.js";import{F as L,g as se,l as ue,t as re,a as le}from"./logo-3104ecab.js";import{a3 as ie}from"./index-ef35bdf0.js";import{g as ce,m as me,i as de}from"./trial-99588317.js";import{p as fe}from"./product-ff9e61ea.js";import{b as pe}from"./blank-84b83865.js";import"./trial-cfdae7e2.js";const ve=O({props:{userInfo:{type:Object,default:()=>{}}},emits:["on-verify"],setup(l,{emit:n}){var A;const s=l,u=F({}),c=30,m=F(0),v=F("\u83B7\u53D6\u9A8C\u8BC1\u7801"),r=w({mobile:(A=s.userInfo)==null?void 0:A.mobile,smsCode:""}),e=t=>S(t)?!0:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7",_=t=>M(t)?!0:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u9A8C\u8BC1\u7801",g=()=>{if(m.value>0)return;m.value=c;const t=()=>{v.value=`${m.value}s`,m.value-=1};t();const o=setInterval(()=>{m.value===0?(v.value="\u83B7\u53D6\u9A8C\u8BC1\u7801",m.value=0,clearInterval(o)):t()},1e3)},V=async()=>{m.value>0||u==null||u.value.validate("mobile").then(async()=>{const t=await oe(r.mobile),{code:o,data:i}=t;o==="10000"&&(k({message:"\u77ED\u4FE1\u53D1\u9001\u6210\u529F\uFF0C\u8BF7\u67E5\u6536"}),g())})},I=async()=>{const t=await ae(r.mobile,r.smsCode),{data:o}=t;o&&n("on-verify",r)},b=async()=>{u==null||u.value.validate().then(async()=>{I()})};return z(()=>r,()=>{S(r.mobile)&&M(r.smsCode)&&I()},{deep:!0,immediate:!0}),(t,o)=>{const i=h("van-field"),f=h("van-cell-group"),y=h("VanForm");return C(),D(y,{ref_key:"formRef",ref:u,"label-width":"60"},{default:E(()=>[B(f,null,{default:E(()=>[B(i,{modelValue:a(r).mobile,"onUpdate:modelValue":o[0]||(o[0]=p=>a(r).mobile=p),name:"mobile",label:"\u624B\u673A\u53F7",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",maxlength:a(L).MOBILE,rules:[{validator:e}]},null,8,["modelValue","maxlength","rules"]),B(i,{modelValue:a(r).smsCode,"onUpdate:modelValue":o[1]||(o[1]=p=>a(r).smsCode=p),name:"smsCode",label:"\u9A8C\u8BC1\u7801",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",maxlength:a(L).SMS_CODE,rules:[{validator:_}]},{button:E(()=>[d("div",{class:J(["sms-code",{"count-down":m.value>0}]),onClick:V},G(v.value),3)]),_:1},8,["modelValue","maxlength","rules"])]),_:1}),d("div",{class:"submit",onClick:b})]),_:1},512)}}}),_e=O({props:{userInfo:{type:Object,default:()=>{}}},emits:["on-submit"],setup(l,{emit:n}){const s=l,u=F({}),c=w({name:s.userInfo.name,certNo:s.userInfo.certNo}),m=e=>ie(c.certNo)?!0:"\u8BF7\u586B\u5199\u6B63\u786E\u7684\u8BC1\u4EF6\u53F7",v=e=>ne(e)?!0:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u59D3\u540D",r=()=>{u==null||u.value.validate().then(async e=>{n("on-submit",c)})};return(e,_)=>{const g=h("van-field"),V=h("van-cell-group"),I=h("VanForm");return C(),D(I,{ref_key:"formRef",ref:u,"label-width":"60"},{default:E(()=>[B(V,null,{default:E(()=>[B(g,{modelValue:a(c).name,"onUpdate:modelValue":_[0]||(_[0]=b=>a(c).name=b),name:"name",label:"\u59D3\u540D",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D",maxlength:a(L).NAME,rules:[{validator:v}]},null,8,["modelValue","maxlength","rules"]),B(g,{modelValue:a(c).certNo,"onUpdate:modelValue":_[1]||(_[1]=b=>a(c).certNo=b),name:"certNo",label:"\u8EAB\u4EFD\u8BC1",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u8EAB\u4EFD\u8BC1\u53F7",maxlength:a(L).ID_CARD,rules:[{validator:m}]},null,8,["modelValue","maxlength","rules"])]),_:1}),d("div",{class:"submit",onClick:r})]),_:1},512)}}});var he="/static/assets/title-step1.97cb9efa.png",ge="/static/assets/title-step2.258af5e9.png";const be={class:"page-activity-invite"},Ce=["src"],Fe=["src"],Be={class:"container"},Ie={class:"main-form"},ye={class:"title"},De=["src"],Ee={class:"agree"},Ve=ee(" \u6211\u5DF2\u9605\u8BFB\u5E76\u540C\u610F "),Ue=O({setup(l){const n=W(),s=X(),{productCode:u="7X9",tenantId:c="",extInfo:m}=n.query,v=se(m),r=F(!0),e=w({title:he,attachmentList:[{attachmentName:"",attachmentUrl:""}],userInfo:{mobile:v.phoneNo,certNo:"",name:""},agree:!1}),_=F(),g=F(),V=async t=>{var y,p;e.userInfo.mobile=t.mobile;const o=await ce({holderPhone:e.userInfo.mobile,productCode:u,tenantId:c}),{code:i,data:f}=o;i==="10000"&&(e.userInfo.name=(y=f.tenantOrderHolder)==null?void 0:y.name,e.userInfo.certNo=(p=f.tenantOrderHolder)==null?void 0:p.certNo),e.title=ge,r.value=!1},I=async t=>{if(!e.agree){k("\u8BF7\u52FE\u9009\u534F\u8BAE");return}try{k({message:"\u9886\u53D6\u4E2D...",forbidClick:!0,loadingType:"spinner"}),e.userInfo.certNo=t.certNo,e.userInfo.name=t.name;const o=le(x(N({tenantId:c,detail:_.value},v),{holder:e.userInfo,insured:x(N({},e.userInfo),{relationToHolder:te.SELF})})),i=await me(o),{code:f}=i;f==="10000"&&s.push({path:"/chuangxin/baigebao/productDetail",query:x(N({},n.query),{tenantId:c,productCode:"BWYL2021",extInfo:JSON.stringify(x(N({},v),{phoneNo:e.userInfo.mobile,certNo:e.userInfo.certNo,name:e.userInfo.name}))})}),k.clear()}catch(o){console.log(o),k.clear()}},b=()=>{let t=[];return g.value.productRiskVoList.forEach(o=>{o.riskDetailVOList.forEach(i=>{t=t.concat(i.riskAttachmentVOList)})}),t},A=async()=>{const t=fe({productCode:u,withInsureInfo:!0}),o=de({productCode:u});Promise.all([t,o]).then(([i,f])=>{i.code==="10000"&&(_.value=i.data),f.code==="10000"&&(g.value=f.data,e.attachmentList=b())})};return Y(()=>{A()}),(t,o)=>{const i=h("van-checkbox"),f=h("ProPDFviewer"),y=h("van-config-provider");return C(),D(y,{"theme-vars":a(re)},{default:E(()=>[d("div",be,[d("img",{class:"logo",src:a(ue)},null,8,Ce),d("img",{class:"banner",src:a(pe)},null,8,Fe),d("div",Be,[d("div",Ie,[d("div",ye,[d("img",{src:a(e).title},null,8,De)]),r.value?(C(),D(ve,{key:0,"user-info":a(e).userInfo,onOnVerify:V},null,8,["user-info"])):(C(),D(_e,{key:1,"user-info":a(e).userInfo,onOnSubmit:I},null,8,["user-info"])),d("div",Ee,[B(i,{modelValue:a(e).agree,"onUpdate:modelValue":o[0]||(o[0]=p=>a(e).agree=p),name:"agree",shape:"square"},null,8,["modelValue"]),d("div",null,[Ve,(C(!0),K(Z,null,Q(a(e).attachmentList||[],(p,U)=>(C(),D(f,{key:U,class:"file-name",title:`\u300A${p.attachmentName}\u300B`,content:p.attachmentUrl,type:"pdf"},null,8,["title","content"]))),128))])])])])])]),_:1},8,["theme-vars"])}}});export{Ue as default};
