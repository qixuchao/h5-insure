import{bv as e,z as i,d as a,r as o,b as l,Y as t,w as r,f as n,e as s,g as d,B as u,t as m,bw as c,v as p,c as f,i as v,ad as y,W as k,X as g,bx as V,x as I,by as b,bz as h,bA as L,bB as D,an as O,U as C,V as R,N as P,av as A,I as _,s as x,Z as T,bo as w,bC as F,ay as M,aX as U,b4 as N,bg as q,o as E,Q as j,bn as Y,aY as S,D as $,b6 as B,b1 as G,bD as K,ai as H,a7 as z}from"./index-3300826d.js";import{T as J}from"./index-e8d7649c.js";import{S as X,b as Q,c as W,d as Z,A as ee,e as ie,L as ae,f as oe}from"./trial-28355e02.js";import{u as le}from"./useDicData-bdf2d123.js";import{S as te}from"./index-8a71e66b.js";import{P as re}from"./index-aea4611b.js";import{i as ne,p as se}from"./trial-fa78661d.js";const de=e({id:"createProposal",state:()=>({proposalInfo:{},trialData:[],excludeProduct:[],proposalId:0}),actions:{setProposalInfo(e){this.$state.proposalInfo=e},setTrialData(e){this.$state.trialData=e},setExcludeProduct(e){this.$state.excludeProduct=e}}});const ue={class:"trial-button"};var me=i(a({__name:"TrialPopup",props:{productCode:{default:""}},setup(e,{expose:i}){const a=o(null);return i({open:(...e)=>{var i;null==(i=a.value)||i.open(...e)}}),(i,o)=>{const m=u;return l(),t(J,{ref_key:"trialRef",ref:a,"hide-benefit":"",title:"选择保障方案",class:"proposal-trial","share-info":{},"product-info":{productCode:e.productCode},"tenant-product-detail":{}},{default:r((()=>[n("div",ue,[s(m,{type:"primary"},{default:r((()=>[d("确定")])),_:1})])])),_:1},8,["product-info"])}}}),[["__scopeId","data-v-e549ec96"]]);const ce={class:"com-risk-list-wrapper"},pe=(e=>(C("data-v-7d3c3028"),e=e(),R(),e))((()=>n("div",{class:"popup-title"},"选择附加险",-1))),fe={class:"risk-list"},ve={class:"cell-title"},ye={class:"title"},ke={class:"footer-button"};var ge=i(a({__name:"index",props:{riskList:{default:()=>[]},show:{type:Boolean,default:!1},collocationList:{default:()=>[]},disabled:{default:()=>[]},modelValue:{default:()=>[]}},emits:["finished","close","update:modelValue"],setup(e,{emit:i}){const a=e,C=o([]),R=o([]),P=o([...a.disabled]),A=m({show:a.show,currentChecked:[...a.modelValue]}),_=e=>{var i,o,l;if(P.value.includes(e))return;((e,i)=>{if(!a.collocationList.length)return i?void(A.currentChecked=[]):void A.currentChecked.push(e);let o=A.currentChecked,l=P.value;i?(a.collocationList.forEach((i=>{e===i.riskId&&(2===i.collocationType?o=o.filter((a=>a!==i.collocationRiskId||a!==e)):3===i.collocationType?(o=o.filter((i=>i!==e)),l=l.filter((e=>e!==i.collocationRiskId))):o=o.filter((i=>i!==e)))})),A.currentChecked=o,P.value=l):(a.collocationList.forEach((a=>{e===a.riskId&&(i||(2===a.collocationType?o.push(a.collocationRiskId):3===a.collocationType&&l.push(a.collocationRiskId),o.push(e)))})),A.currentChecked.push(...o),P.value=l)})(e,A.currentChecked.includes(e)),null==(l=null==(o=null==(i=null==C?void 0:C.value)?void 0:i[e])?void 0:o.toggle)||l.call(o)},x=()=>{i("close")},T=()=>{const e=a.riskList.filter((e=>A.currentChecked.includes(e.id)));i("update:modelValue",[...new Set(R.value)]),i("finished",e,P.value),i("close")};return c((()=>{C.value=[]})),p((()=>A.currentChecked),(e=>{R.value=e}),{deep:!0,immediate:!0}),p((()=>a.modelValue),(e=>{R.value=e||[],P.value.push(...e||[])}),{deep:!0,immediate:!0}),(i,a)=>{const o=b,m=h,c=L,p=D,w=u,F=O;return l(),f("div",ce,[s(F,{show:v(A).show,"onUpdate:show":a[1]||(a[1]=e=>v(A).show=e),title:"选择附加险","show-footer":"",round:"",position:"bottom",closeable:"",onClose:x},{default:r((()=>[pe,n("div",fe,[s(p,{modelValue:v(R),"onUpdate:modelValue":a[0]||(a[0]=e=>y(R)?R.value=e:null)},{default:r((()=>[s(c,{inset:""},{default:r((()=>[(l(!0),f(k,null,g(e.riskList,(e=>(l(),t(m,{key:e.id,title:e.riskName,disabled:v(P).includes(e.id),onClick:i=>_(e.id)},{"right-icon":r((()=>[s(o,{ref_for:!0,ref:i=>v(C)[e.id]=i,shape:"square",disabled:v(P).includes(e.id),name:e.id,onClick:V((i=>_(e.id)),["stop"])},null,8,["disabled","name","onClick"])])),title:r((()=>[n("div",ve,[n("div",ye,I(e.riskName),1)])])),_:2},1032,["title","disabled","onClick"])))),128))])),_:1})])),_:1},8,["modelValue"])]),n("div",ke,[s(w,{type:"primary",disabled:!v(A).currentChecked.length,block:"",onClick:T},{default:r((()=>[d("确认")])),_:1},8,["disabled"])])])),_:1},8,["show"])])}}}),[["__scopeId","data-v-7d3c3028"]]);const Ve={class:"com-personal-info-wrapper"},Ie={class:"pro-radio-wrap"},be={class:"pro-radio-wrap"};var he=i(a({__name:"index",props:{formInfo:{default:()=>({})},insuredCode:{default:""},factorList:{default:()=>[]},ageRange:{default:()=>[]}},setup(e,{expose:i}){var a,d;const u=e,c=le(`${null==(d=null==(a=u.insuredCode)?void 0:a.toLocaleUpperCase)?void 0:d.call(a)}_OCCUPATION`),[p,k]=P(),g=o(),V=A("source")||{},I=m({formInfo:u.formInfo,occupationalText:"",occupationCodeList:[]}),b=_((()=>{const e=(e=>{const i=e||[];for(let a=0,o=i.length;a<o;a++)for(let e=a+1;e<o;e++){const o=i[a].split("_"),l=i[e].split("_"),t=i[a];o[0]===l[0]?o>l&&(i[a]=i[e],i[e]=t):"age"===o[0]&&(i[a]=i[e],i[e]=t)}return i})(null==u?void 0:u.ageRange),i=(e="")=>[+e.split("_")[1],e.split("_")[0]],a=i(e[0]),o=i(e[e.length-1]),l=x().subtract(a[0],"age"===a[1]?"year":"day").format("YYYY-MM-DD");let t=x().subtract(o[0],"age"===o[1]?"year":"day").format("YYYY-MM-DD");return x(t).subtract(1,"year").isBefore(l)&&(t=x(t).subtract(1,"year").add(1,"day").format("YYYY-MM-DD")),{minAge:new Date(t),maxAge:new Date(l)}}));return i({validateForm:()=>new Promise(((e,i)=>{var a;null==(a=g.value)||a.validate().then((()=>{e("")}),(e=>{var a;null==(a=g.value)||a.scrollToField(null==e?void 0:e[0].name),i()}))})),ageRangeObj:b.value}),(i,a)=>{const o=M,d=U,u=N,m=q,h=O;return l(),f("div",Ve,[s(u,{ref_key:"formRef",ref:g,"input-align":"right","error-message-align":"right"},{default:r((()=>["proposal"===v(V).type&&("add"===v(V).type||"repeatAdd"===v(V).type)||"proposal"!==v(V).type&&(e.factorList.includes("APPLICANT.AGE")||e.factorList.includes("AGE")||e.factorList.includes("DAY")||e.factorList.includes("APPLICANT.DAY"))?(l(),t(o,{key:0,modelValue:v(I).formInfo.birthday,"onUpdate:modelValue":a[0]||(a[0]=e=>v(I).formInfo.birthday=e),rules:[{required:!0,message:"请选择出生日期"}],name:"birth",label:"出生日期",class:"isLink",readonly:"","is-link":"",formatter:e=>e?v(x)(e).format("YYYY-MM-DD"):e,placeholder:"请选择",onClick:a[1]||(a[1]=e=>v(k)(!0))},null,8,["modelValue","formatter"])):T("",!0),"proposal"===v(V).type&&("add"===v(V).type||"repeatAdd"===v(V).type)||"proposal"!==v(V).type&&(e.factorList.includes("APPLICANT.GENDER")||e.factorList.includes("GENDER"))?(l(),t(o,{key:1,modelValue:v(I).formInfo.gender,"onUpdate:modelValue":a[3]||(a[3]=e=>v(I).formInfo.gender=e),name:"gender",label:"性别",rules:[{required:!0,message:"请选择性别"}]},{input:r((()=>[n("div",Ie,[s(d,{modelValue:v(I).formInfo.gender,"onUpdate:modelValue":a[2]||(a[2]=e=>v(I).formInfo.gender=e),options:v(w)},null,8,["modelValue","options"])])])),_:1},8,["modelValue"])):T("",!0),e.factorList.includes("SOCIAL_INS")||e.factorList.includes("APPLICANT.SOCIAL_INS")?(l(),t(o,{key:2,modelValue:v(I).formInfo.socialFlag,"onUpdate:modelValue":a[5]||(a[5]=e=>v(I).formInfo.socialFlag=e),name:"socialFlag",label:"社保",rules:[{required:!0,message:"请选择社保"}]},{input:r((()=>[n("div",be,[s(d,{modelValue:v(I).formInfo.socialFlag,"onUpdate:modelValue":a[4]||(a[4]=e=>v(I).formInfo.socialFlag=e),options:v(X)},null,8,["modelValue","options"])])])),_:1},8,["modelValue"])):T("",!0),e.factorList.includes("OCCUPATION_CATEGORY")||e.factorList.includes("APPLICANT.OCCUPATION_CATEGORY")?(l(),t(F,{key:3,modelValue:v(I).formInfo.occupationCodeList[0],"onUpdate:modelValue":a[6]||(a[6]=e=>v(I).formInfo.occupationCodeList[0]=e),field0:v(I).formInfo.occupationCodeList[0],"onUpdate:field0":a[7]||(a[7]=e=>v(I).formInfo.occupationCodeList[0]=e),field1:v(I).formInfo.occupationCodeList[1],"onUpdate:field1":a[8]||(a[8]=e=>v(I).formInfo.occupationCodeList[1]=e),field2:v(I).formInfo.occupationCodeList[2],"onUpdate:field2":a[9]||(a[9]=e=>v(I).formInfo.occupationCodeList[2]=e),required:"",name:"occupationCodeList",label:"职业类型","data-source":v(c),mapping:{label:"value",value:"code",children:"children"},"show-full-value":"","need-key":"name"},null,8,["modelValue","field0","field1","field2","data-source"])):T("",!0)])),_:1},512),s(h,{show:v(p),"onUpdate:show":a[12]||(a[12]=e=>y(p)?p.value=e:null),position:"bottom"},{default:r((()=>[s(m,{type:"date","min-date":v(b).minAge,"max-date":v(b).maxAge,onConfirm:a[10]||(a[10]=e=>{v(I).formInfo.birthday=v(x)(e).format("YYYY-MM-DD"),v(k)(!1)}),onCancel:a[11]||(a[11]=e=>v(k)(!1))},null,8,["min-date","max-date"])])),_:1},8,["show"])])}}}),[["__scopeId","data-v-b6a7c104"]]);const Le={class:"com-risk-card-wrapper part-card"},De={class:"custom-field"},Oe={class:"field-tip"},Ce={class:"custom-field"},Re={class:"field-tip"},Pe={class:"custom-field"},Ae={class:"field-tip"},_e={class:"pro-radio-wrap"},xe={class:"pro-radio-wrap"},Te={class:"pro-radio-wrap"},we={class:"pro-radio-wrap"},Fe={class:"pro-radio-wrap"},Me={key:0},Ue={key:1,class:"pro-radio-wrap"},Ne={key:9,class:"liab-desc"};var qe=i(a({__name:"index",props:{originData:{default:()=>({})},formInfo:{default:()=>({})},mainRiskData:{default:()=>({})},mainRiskInfo:{default:()=>({})},index:{default:0},removeRisk:{type:Function,default:()=>{}},removeRiskList:{default:()=>[]},enums:{default:()=>({})}},setup(e){const i=e,a=o({}),d=A("premium")||{};a.value=A("enumList")||{};const u=o({chargePeriod:{disabled:!1,prevent:!1},coveragePeriod:{disabled:!1,prevent:!1},paymentFrequency:{disabled:!1,prevent:!1}}),c=m({formInfo:i.formInfo}),y=e=>"boolean"!=typeof e&&!e||(!(!Array.isArray(e)||e.length)||"[object Object]"==={}.toString.call(e)&&Object.keys(e).length),V=(e,i,a={})=>{let o=i;return Array.isArray(i)||(o=[`${o}`]),(e||[]).filter((e=>o.includes(`${e.value}`)||o.includes(e.value)))},b=_((()=>{var e,a,o,l,t,r,n,s;return 1===(null==(e=i.originData)?void 0:e.riskType)?V(i.enums.RISK_INSURANCE_PERIOD,(null==(a=i.originData.riskInsureLimitVO)?void 0:a.insurancePeriodValueList)||[]):2===(null==(o=i.originData)?void 0:o.periodType)?V([{value:"year_1",name:"1年"}],["year_1"]):1===(null==(l=i.originData)?void 0:l.exemptFlag)?V(Q,[`${null==(r=null==(t=null==i?void 0:i.originData)?void 0:t.riskInsureLimitVO)?void 0:r.insurancePeriodRule}`]):V(null==(n=i.enums)?void 0:n.RISK_INSURANCE_PERIOD,(null==(s=i.mainRiskData.riskInsureLimitVO)?void 0:s.insurancePeriodValueList)||[])})),h=_((()=>{var e,a,o,l,t,r,n,s;return 1===(null==(e=i.originData)?void 0:e.riskType)?V(null==(a=null==i?void 0:i.enums)?void 0:a.RISK_PAYMENT_PERIOD,(null==(o=i.originData.riskInsureLimitVO)?void 0:o.paymentPeriodValueList)||[]):1===(null==(l=i.originData)?void 0:l.exemptFlag)?V(W,[`${null==(r=null==(t=null==i?void 0:i.originData)?void 0:t.riskInsureLimitVO)?void 0:r.paymentPeriodRule}`]):2===(null==(n=i.originData)?void 0:n.periodType)?V([{value:"year_1",name:"1年交"}],["year_1"]):V(i.enums.RISK_PAYMENT_PERIOD,(null==(s=i.mainRiskData.riskInsureLimitVO)?void 0:s.paymentPeriodValueList)||[])})),L=_((()=>{var e,a,o,l,t;return 1===(null==(e=i.originData)?void 0:e.riskType)?V(Z,(null==(a=i.originData.riskInsureLimitVO)?void 0:a.paymentFrequencyList)||[]):1===(null==(o=i.originData.riskInsureLimitVO)?void 0:o.paymentTypeRule)?V(Z,(null==(l=i.mainRiskData.riskInsureLimitVO)?void 0:l.paymentFrequencyList)||[]):V(Z,(null==(t=i.mainRiskData.riskInsureLimitVO)?void 0:t.paymentFrequencyList)||[])})),D=_((()=>{var e,a;let o=0,l=0;return((null==(a=null==(e=i.originData)?void 0:e.riskCalcMethodInfoVO)?void 0:a.paymentMethodLimitList)||[]).forEach(((e,i)=>{0===i&&(o=e.minAmount,l=e.maxAmount),o>e.minAmount&&(o=e.minAmount),l<e.maxAmount&&(l=e.maxAmount)})),c.formInfo.amount=c.formInfo.amount||o,{min:o,max:l||1/0}})),O=_((()=>{var e,a;let o=0,l=0;return((null==(a=null==(e=i.originData)?void 0:e.riskCalcMethodInfoVO)?void 0:a.paymentMethodLimitList)||[]).forEach(((e,i)=>{0===i&&(o=e.minPremium,l=e.maxPremium),o>e.minPremium&&(o=e.minPremium),l<e.maxPremium&&(l=e.maxPremium)})),c.formInfo.premium=c.formInfo.premium||o,{min:o,max:l||1/0}})),C=_((()=>{var e,a,o,l;const t=(null==(a=null==(e=i.originData)?void 0:e.riskCalcMethodInfoVO)?void 0:a.minCopy)||1,r=null==(l=null==(o=i.originData)?void 0:o.riskCalcMethodInfoVO)?void 0:l.maxCopy;return c.formInfo.copy=`${c.formInfo.copy||t||1}`,{min:t,max:r}})),R=(e,a,o)=>{var l,t;const r=(null==(t=null==(l=i.originData)?void 0:l.riskCalcMethodInfoVO)?void 0:t.increaseDecreaseNum)||1;if("sumInsured"===o){if(D.value.max&&+e>D.value.max)return`金额最大${D.value.max}元`;if(+e<D.value.min)return`金额最小${D.value.min}元`}else{if(O.value.max&&+e>O.value.max)return`金额最大${O.value.max}元`;if(+e<O.value.min)return`金额最小${O.value.min}元`}return+e%r==0?"":`金额必须是${r}的倍数`},P=e=>{var i;const a=((null==(i=c.formInfo)?void 0:i.liabilityVOList)||[]).find((i=>i.liabilityCode===e.liabilityCode));return a?a.liabilityAttributeValue?a.liabilityAttributeValue:1!==e.optionalFlag?"0":"-1":""};return E((()=>{var e,a,o,l;const t={riskType:i.originData.riskType,riskId:i.originData.id,riskName:i.originData.riskName,riskCode:i.originData.riskCode,amount:c.formInfo.amount,mainRiskCode:1!==i.originData.riskType?null==(e=i.mainRiskData)?void 0:e.riskCode:void 0,mainRiskId:1!==i.originData.riskType?null==(a=i.mainRiskData)?void 0:a.id:void 0,exemptFlag:i.originData.exemptFlag,exemptType:i.originData.exemptType,riskCategory:i.originData.riskCategory,liabilityVOList:(i.originData.riskLiabilityInfoVOList||[]).map((e=>({...e,liabilityAttributeCode:e.liabilityAttributeType,liabilityCode:e.liabilityCode,liabilityRateType:e.liabilityRateType,liabilityAttributeValue:P(e)})))};[1].includes((null==(o=i.originData.riskCalcMethodInfoVO)?void 0:o.saleMethod)||0)&&1!==(null==(l=i.originData)?void 0:l.exemptFlag)||!i.originData.riskCalcMethodInfoVO.fixedAmount||(t.amount=i.originData.riskCalcMethodInfoVO.fixedAmount),Object.assign(c.formInfo,t)})),p((()=>{var e;return null==(e=c.formInfo)?void 0:e.paymentFrequency}),((e=0)=>{var a,o,l;[3].includes((null==(a=i.originData.riskCalcMethodInfoVO)?void 0:a.saleMethod)||0)&&((null==(l=null==(o=i.originData)?void 0:o.riskCalcMethodInfoVO)?void 0:l.paymentMethodLimitList)||[]).forEach((i=>{+i.paymentFrequency==+e&&Object.assign(c.formInfo,{amount:i.perCopyAmount,premium:i.perCopyPremium})})),1==+e&&"single"!==c.formInfo.chargePeriod&&(c.formInfo.chargePeriod="single")})),p((()=>{var e;return null==(e=c.formInfo)?void 0:e.copy}),(e=>{var a,o;4===(null==(a=i.originData.riskCalcMethodInfoVO)?void 0:a.saleMethod)&&(c.formInfo.amount=null==(o=i.originData.riskCalcMethodInfoVO)?void 0:o.fixedAmount)})),p((()=>{var e;return null==(e=c.formInfo)?void 0:e.chargePeriod}),(e=>{"single"===e&&1!=+(c.formInfo.paymentFrequency||0)&&(c.formInfo.paymentFrequency=1)})),p((()=>null==i?void 0:i.mainRiskInfo),(e=>{var a,o,l,t,r,n;e&&2===i.originData.riskType&&(1===(null==(o=null==(a=i.originData)?void 0:a.riskInsureLimitVO)?void 0:o.insurancePeriodRule)&&(e.coveragePeriod?u.value.coveragePeriod.disabled=!0:u.value.coveragePeriod.prevent=!0,c.formInfo.coveragePeriod=e.coveragePeriod||""),1===(null==(t=null==(l=i.originData)?void 0:l.riskInsureLimitVO)?void 0:t.paymentPeriodRule)&&(e.chargePeriod?u.value.chargePeriod.disabled=!0:u.value.chargePeriod.prevent=!0,c.formInfo.chargePeriod=e.chargePeriod||""),1===(null==(n=null==(r=i.originData)?void 0:r.riskInsureLimitVO)?void 0:n.paymentTypeRule)&&(e.paymentFrequency?u.value.paymentFrequency.disabled=!0:u.value.paymentFrequency.prevent=!0,c.formInfo.paymentFrequency=e.paymentFrequency||0))}),{immediate:!0,deep:!0}),(i,a)=>{var o,m,p,P,A,_,x,w,F,N,q,E,$,B,G,K,H,z,J,X,Q,W,Z,le,ne,se,de,ue,me,ce;const pe=j,fe=Y,ve=te,ye=M,ke=U,ge=S;return l(),f("div",Le,[s(fe,{"risk-type":e.originData.riskType,title:e.originData.riskName},{default:r((()=>[e.removeRiskList.includes(e.originData.id)?(l(),f("div",{key:0,class:"delete-risk",onClick:a[0]||(a[0]=i=>e.removeRisk(e.originData.id))},[s(pe,{name:"img-lajitong",color:"#0d6efe"})])):T("",!0)])),_:1},8,["risk-type","title"]),1===(null==(o=e.originData.riskCalcMethodInfoVO)?void 0:o.saleMethod)&&2===e.originData.exemptFlag?(l(),t(ye,{key:0,modelValue:v(c).formInfo.amount,"onUpdate:modelValue":a[2]||(a[2]=e=>v(c).formInfo.amount=e),label:"保额",name:"amount",rules:[{required:!0,message:"请填写"},{trigger:"onChange",validator:(...e)=>R(...e,"sumInsured")}]},{input:r((()=>{var i,o;return[n("div",De,[s(ve,{modelValue:v(c).formInfo.amount,"onUpdate:modelValue":a[1]||(a[1]=e=>v(c).formInfo.amount=e),"input-width":"64px",min:v(D).min,step:(null==(i=e.originData.riskCalcMethodInfoVO)?void 0:i.increaseDecreaseNum)||1,max:v(D).max},null,8,["modelValue","min","step","max"]),n("span",Oe,I(`金额最低${v(D).min}元，为${(null==(o=e.originData.riskCalcMethodInfoVO)?void 0:o.increaseDecreaseNum)||1}的倍数`),1)])]})),_:1},8,["modelValue","rules"])):T("",!0),2===(null==(p=null==(m=e.originData)?void 0:m.riskCalcMethodInfoVO)?void 0:p.saleMethod)?(l(),t(ye,{key:1,modelValue:v(c).formInfo.premium,"onUpdate:modelValue":a[4]||(a[4]=e=>v(c).formInfo.premium=e),label:"保费",name:"premium",rules:[{required:!0,message:"请填写"},{trigger:"onChange",validator:(...e)=>R(...e,"premium")}]},{input:r((()=>{var i,o,l,t;return[n("div",Ce,[s(ve,{modelValue:v(c).formInfo.premium,"onUpdate:modelValue":a[3]||(a[3]=e=>v(c).formInfo.premium=e),step:(null==(o=null==(i=e.originData)?void 0:i.riskCalcMethodInfoVO)?void 0:o.increaseDecreaseNum)||1,min:v(O).min,"input-width":"64px",max:v(O).max},null,8,["modelValue","step","min","max"]),n("span",Re,I(`金额最低${v(O).min}元，为${(null==(t=null==(l=e.originData)?void 0:l.riskCalcMethodInfoVO)?void 0:t.increaseDecreaseNum)||1}的倍数`),1)])]})),_:1},8,["modelValue","rules"])):T("",!0),3===(null==(A=null==(P=e.originData)?void 0:P.riskCalcMethodInfoVO)?void 0:A.saleMethod)||4===(null==(x=null==(_=e.originData)?void 0:_.riskCalcMethodInfoVO)?void 0:x.saleMethod)&&((null==(F=null==(w=e.originData)?void 0:w.riskCalcMethodInfoVO)?void 0:F.minCopy)||(null==(q=null==(N=e.originData)?void 0:N.riskCalcMethodInfoVO)?void 0:q.maxCopy))?(l(),t(ye,{key:2,modelValue:v(c).formInfo.copy,"onUpdate:modelValue":a[6]||(a[6]=e=>v(c).formInfo.copy=e),label:"投保份数",name:"copy",rules:[{required:!0,message:"请填写"}]},{input:r((()=>[n("div",Pe,[s(ve,{modelValue:v(c).formInfo.copy,"onUpdate:modelValue":a[5]||(a[5]=e=>v(c).formInfo.copy=e),step:1,min:v(C).min,max:v(C).max},null,8,["modelValue","min","max"]),n("span",Ae,I(`${v(C).min}份起购，最多购买${v(C).max}份`),1)])])),_:1},8,["modelValue"])):T("",!0),[1].includes((null==(E=e.originData.riskCalcMethodInfoVO)?void 0:E.saleMethod)||0)&&1!==(null==($=e.originData)?void 0:$.exemptFlag)||!e.originData.riskCalcMethodInfoVO.fixedAmount&&!(null==(G=v(d))?void 0:G[null==(B=e.originData)?void 0:B.riskCode])?T("",!0):(l(),t(ye,{key:3,label:"保额"},{input:r((()=>{var i,a,o,l;return[n("div",null,I((null==(i=e.originData.riskCalcMethodInfoVO)?void 0:i.fixedAmount)||(null==(l=null==(o=v(d))?void 0:o[null==(a=e.originData)?void 0:a.riskCode])?void 0:l.amount)),1)]})),_:1})),y(null==(H=null==(K=e.originData)?void 0:K.riskInsureLimitVO)?void 0:H.insurancePeriodValueList)&&y(null==(J=null==(z=e.originData)?void 0:z.riskInsureLimitVO)?void 0:J.insurancePeriodRule)?T("",!0):(l(),t(ge,{key:4,modelValue:v(c).formInfo.coveragePeriod,"onUpdate:modelValue":a[8]||(a[8]=e=>v(c).formInfo.coveragePeriod=e),label:"保障期间",name:"coveragePeriod",rules:[{required:!0,message:"请选择保障期间"}]},{input:r((()=>[n("div",_e,[s(ke,{modelValue:v(c).formInfo.coveragePeriod,"onUpdate:modelValue":a[7]||(a[7]=e=>v(c).formInfo.coveragePeriod=e),disabled:v(u).coveragePeriod.disabled,prevent:v(u).coveragePeriod.prevent?"请先选择主险保障期间":"",options:v(b),prop:{label:"name",value:"value"}},null,8,["modelValue","disabled","prevent","options"])])])),_:1},8,["modelValue"])),y(null==(Q=null==(X=e.originData)?void 0:X.riskInsureLimitVO)?void 0:Q.paymentPeriodValueList)&&y(null==(Z=null==(W=e.originData)?void 0:W.riskInsureLimitVO)?void 0:Z.paymentPeriodRule)?T("",!0):(l(),t(ge,{key:5,modelValue:v(c).formInfo.chargePeriod,"onUpdate:modelValue":a[10]||(a[10]=e=>v(c).formInfo.chargePeriod=e),label:"交费期间",name:"chargePeriod",rules:[{required:!0,message:"请选择交费期间"}]},{input:r((()=>[n("div",xe,[s(ke,{modelValue:v(c).formInfo.chargePeriod,"onUpdate:modelValue":a[9]||(a[9]=e=>v(c).formInfo.chargePeriod=e),disabled:v(u).chargePeriod.disabled,prevent:v(u).chargePeriod.prevent?"请先选择主险交费期间":"",options:v(h),prop:{label:"name",value:"value"}},null,8,["modelValue","disabled","prevent","options"])])])),_:1},8,["modelValue"])),y(null==(le=e.originData.riskInsureLimitVO)?void 0:le.paymentFrequencyList)&&y(null==(ne=e.originData.riskInsureLimitVO)?void 0:ne.paymentPeriodRule)?T("",!0):(l(),t(ge,{key:6,modelValue:v(c).formInfo.paymentFrequency,"onUpdate:modelValue":a[12]||(a[12]=e=>v(c).formInfo.paymentFrequency=e),label:"交费方式",name:"paymentFrequency",rules:[{required:!0,message:"请选择交费方式"}]},{input:r((()=>[n("div",Te,[s(ke,{modelValue:v(c).formInfo.paymentFrequency,"onUpdate:modelValue":a[11]||(a[11]=e=>v(c).formInfo.paymentFrequency=e),disabled:v(u).paymentFrequency.disabled,prevent:v(u).paymentFrequency.prevent?"请先选择主险交费方式":"",options:v(L)},null,8,["modelValue","disabled","prevent","options"])])])),_:1},8,["modelValue"])),y(null==(de=null==(se=e.originData)?void 0:se.riskInsureLimitVO)?void 0:de.annuityDrawValueList)?T("",!0):(l(),t(ge,{key:7,modelValue:v(c).formInfo.annuityDrawDate,"onUpdate:modelValue":a[14]||(a[14]=e=>v(c).formInfo.annuityDrawDate=e),label:"领取时间",name:"annuityDrawDate"},{input:r((()=>{var i;return[n("div",we,[s(ke,{modelValue:v(c).formInfo.annuityDrawDate,"onUpdate:modelValue":a[13]||(a[13]=e=>v(c).formInfo.annuityDrawDate=e),options:V(v(ee),(null==(i=e.originData.riskInsureLimitVO)?void 0:i.annuityDrawValueList)||[])},null,8,["modelValue","options"])])]})),_:1},8,["modelValue"])),y(null==(me=null==(ue=e.originData)?void 0:ue.riskInsureLimitVO)?void 0:me.annuityDrawFrequencyList)?T("",!0):(l(),t(ge,{key:8,modelValue:v(c).formInfo.annuityDrawType,"onUpdate:modelValue":a[16]||(a[16]=e=>v(c).formInfo.annuityDrawType=e),label:"领取方式",name:"annuityDrawType"},{input:r((()=>{var i;return[n("div",Fe,[s(ke,{modelValue:v(c).formInfo.annuityDrawType,"onUpdate:modelValue":a[15]||(a[15]=e=>v(c).formInfo.annuityDrawType=e),options:V(v(ie),(null==(i=e.originData.riskInsureLimitVO)?void 0:i.annuityDrawFrequencyList)||[])},null,8,["modelValue","options"])])]})),_:1},8,["modelValue"])),(l(!0),f(k,null,g(e.originData.riskLiabilityInfoVOList||[],((i,a)=>(l(),f(k,{key:a},[1!==i.optionalFlag||y(i.liabilityAttributeValueList)?T("",!0):(l(),t(ye,{key:0,modelValue:v(c).formInfo.liabilityVOList[a].liabilityAttributeValue,"onUpdate:modelValue":e=>v(c).formInfo.liabilityVOList[a].liabilityAttributeValue=e,label:i.liabilityName,name:"liabilityAttributeValue",rules:[{required:i.liabilityAttributeValue,message:`请选择${i.liabilityName}`}]},{input:r((()=>{var o,t;return[n("div",null,[y(i.liabilityAttributeValueList)?(l(),f("span",Me,"50万")):(l(),f("div",Ue,[s(ke,{modelValue:v(c).formInfo.liabilityVOList[a].liabilityAttributeValue,"onUpdate:modelValue":e=>v(c).formInfo.liabilityVOList[a].liabilityAttributeValue=e,options:V(v(ae),null==(t=null==(o=e.originData.riskLiabilityInfoVOList)?void 0:o[a])?void 0:t.liabilityAttributeValueList)},null,8,["modelValue","onUpdate:modelValue","options"])]))])]})),_:2},1032,["modelValue","onUpdate:modelValue","label","rules"])),1!==i.optionalFlag?(l(),t(ye,{key:1,modelValue:v(c).formInfo.liabilityVOList[a].liabilityAttributeValue,"onUpdate:modelValue":e=>v(c).formInfo.liabilityVOList[a].liabilityAttributeValue=e,label:i.liabilityName,name:"liabilityAttributeValue"},{input:r((()=>{var o,r;return[n("div",null,[y(i.liabilityAttributeValueList)?(l(),t(ke,{key:0,modelValue:v(c).formInfo.liabilityVOList[a].liabilityAttributeValue,"onUpdate:modelValue":e=>v(c).formInfo.liabilityVOList[a].liabilityAttributeValue=e,options:v(oe)},null,8,["modelValue","onUpdate:modelValue","options"])):(l(),t(ke,{key:1,modelValue:v(c).formInfo.liabilityVOList[a].liabilityAttributeValue,"onUpdate:modelValue":e=>v(c).formInfo.liabilityVOList[a].liabilityAttributeValue=e,options:V(v(ae),null==(r=null==(o=e.originData.riskLiabilityInfoVOList)?void 0:o[a])?void 0:r.liabilityAttributeValueList)},null,8,["modelValue","onUpdate:modelValue","options"]))])]})),_:2},1032,["modelValue","onUpdate:modelValue","label"])):T("",!0)],64)))),128)),(null==(ce=e.originData)?void 0:ce.relationDesc)?(l(),f("div",Ne,[s(re,{title:"责任投保说明"},{default:r((()=>[n("div",null,I(e.originData.relationDesc),1)])),_:1})])):T("",!0)])}}}),[["__scopeId","data-v-3b9c2786"]]);const Ee={class:"risk-list-wrapper"},je={key:0,class:"add-rider-risk"},Ye={class:"left-part"},Se=(e=>(C("data-v-4e393d2a"),e=e(),R(),e))((()=>n("span",{class:"btn-plus"},"+",-1)));var $e=i(a({__name:"index",props:{riskInfo:{default:()=>({})},originData:{default:()=>[]},pickFactor:{type:Function,default:()=>{}},enums:{default:()=>{}}},setup(e){const i=e,a=A("source")||{},[u,c]=P(!1);o(null),o(null);const y=m({mainRiskInfo:i.riskInfo,riskInfo:i.riskInfo,requiredRiderRiskData:[],mainRiskData:{},riderRiskList:[],checkedList:[],relationListNum:0,disabledList:[],currentRiskList:[]}),V=(e,i)=>{y.currentRiskList=y.currentRiskList.concat(e),y.disabledList=i},b=e=>{$.confirm({message:"确定要删除附加险么？",confirmButtonText:"删除"}).then((()=>{var i;const a=[e];((null==(i=y.mainRiskData)?void 0:i.collocationVOList)||[]).forEach((i=>{e!==i.riskId||2!==i.collocationType&&3!==i.collocationType||a.push(i.collocationRiskId)})),y.checkedList=y.checkedList.filter((e=>!a.includes(e))),y.currentRiskList=y.currentRiskList.filter((e=>!a.includes(e.id)||(Object.assign(y.riskInfo,{[e.id]:void 0}),!1))),y.disabledList=y.disabledList.filter((e=>!a.includes(e)))})).catch((()=>{}))},h=(e,i)=>{var a,o;const l=((null==(o=null==(a=y.riskInfo)?void 0:a[i])?void 0:o.liabilityVOList)||[]).find((i=>i.liabilityCode===e.liabilityCode));return l?l.liabilityAttributeValue?l.liabilityAttributeValue:1!==e.optionalFlag?"0":"-1":""};return p((()=>y.currentRiskList),(e=>{const a=[y.mainRiskData,...e];let o=[],l=[];const t=[];a.forEach(((e,i)=>{var a,r,n;const s=(null==(a=null==e?void 0:e.riskCalcMethodInfoVO)?void 0:a.riskFactorRelationList)||[];o=o.concat(s.filter((e=>"insured"===e.factorObject)).map((e=>e.factorCode))),l=l.concat(s.filter((e=>"holder"===e.factorObject)).map((e=>e.factorCode))),t.push(null==(r=null==e?void 0:e.riskInsureLimitVO)?void 0:r.minHolderAge,null==(n=null==e?void 0:e.riskInsureLimitVO)?void 0:n.maxHolderAge)})),(e||[]).forEach((e=>{var a,o;const l={riskType:e.riskType,riskId:e.id,riskCode:e.riskCode,riskName:e.riskName,mainRiskCode:1!==e.riskType?null==(a=y.mainRiskData)?void 0:a.riskCode:void 0,mainRiskId:1!==e.riskType?null==(o=y.mainRiskData)?void 0:o.id:void 0,riskCategory:e.riskCategory,exemptFlag:i.originData.exemptFlag,exemptType:i.originData.exemptType,liabilityVOList:(e.riskLiabilityInfoVOList||[]).map((i=>({...i,liabilityAttributeCode:i.liabilityAttributeType,liabilityCode:i.liabilityCode,liabilityRateType:i.liabilityRateType,liabilityAttributeValue:h(i,e.id)})))};y.riskInfo[e.id]||Object.assign(y.riskInfo,{[e.id]:l})})),i.pickFactor({insuredFactorList:[...new Set(o)],holderFactorList:[...new Set(l)],ageRange:t})}),{deep:!0,immediate:!0}),p((()=>i.riskInfo),(e=>{y.mainRiskInfo=Object.values(e||{}).find((e=>1===(null==e?void 0:e.riskType)))||{}}),{deep:!0,immediate:!0}),p((()=>i.originData),(e=>{let i=[];const o=[];"proposal"===a.origin&&"add"!==a.type&&"repeatAdd"!==a.type?((e||[]).forEach((e=>{1===e.riskType&&(y.mainRiskData=e),i.push(e)})),i=i.filter((e=>a.showRiskList.includes(e.id)))):(e||[]).forEach((e=>{1===e.riskType?(y.mainRiskData=e,i.push(e)):2===e.collocationType?i.push(e):o.push(e)})),y.riderRiskList=o,y.currentRiskList=i}),{deep:!0,immediate:!0}),(i,o)=>{var m,p,h;const L=B;return l(),f("div",Ee,[(l(!0),f(k,null,g(v(y).currentRiskList,((i,a)=>(l(),t(qe,{key:i.id,"form-info":v(y).riskInfo[i.id],index:a,enums:e.enums,"main-risk-data":v(y).mainRiskData,"main-risk-info":v(y).mainRiskInfo,"origin-data":i,"remove-risk":b,"remove-risk-list":v(y).checkedList},null,8,["form-info","index","enums","main-risk-data","main-risk-info","origin-data","remove-risk-list"])))),128)),(null==(m=v(y).riderRiskList)?void 0:m.length)-(null==(p=v(y).checkedList)?void 0:p.length)&&"proposal"!==v(a).origin?(l(),f("div",je,[n("span",Ye,I(`共有${v(y).riderRiskList.length-v(y).checkedList.length}款附加险可以添加`),1),s(L,{activated:"",class:"btn-rider-risk",onClick:o[0]||(o[0]=e=>v(c)(!0))},{default:r((()=>[Se,d(" 附加险")])),_:1})])):T("",!0),v(u)?(l(),t(ge,{key:1,modelValue:v(y).checkedList,"onUpdate:modelValue":o[1]||(o[1]=e=>v(y).checkedList=e),show:v(u),disabled:v(y).disabledList,"risk-list":v(y).riderRiskList,"collocation-list":(null==(h=v(y).mainRiskData)?void 0:h.collocationVOList)||[],onFinished:V,onClose:o[2]||(o[2]=e=>v(c)(!1))},null,8,["modelValue","show","disabled","risk-list","collocation-list"])):T("",!0)])}}}),[["__scopeId","data-v-4e393d2a"]]);const Be={class:"com-product-risk-wrapper"},Ge={class:"popup-container"},Ke=(e=>(C("data-v-6c73a33e"),e=e(),R(),e))((()=>n("div",{class:"popup-title"},"请选择保障方案",-1))),He={class:"risk-trial-wrapper"},ze={class:"risk-content"},Je={key:0,class:"risk"},Xe={class:"footer-bar"},Qe=a({name:"ProductRisk"});var We=i(a({...Qe,props:{isShow:{type:Boolean,default:!1},type:{default:"add"},productId:{default:0},riskType:{default:1},formInfo:{default:{}},productData:{default:()=>({})},holder:{default:()=>({})},insured:{default:()=>({})},riderRisk:{default:()=>[]},currentRisk:{default:()=>[]}},emits:["close","finished"],setup(e,{emit:i}){var a,c;const y=e,k=o({personVO:{occupationCodeList:[],...y.holder}}),g=o({insuredCode:"",personVO:{occupationCodeList:(null==(c=((null==(a=y.insured)?void 0:a.proposalInsuredProductList)||[]).find((e=>e.productId===y.productData.productBasicInfoVO.id)))?void 0:c.occupationCodeList)||[],...y.insured}}),V=o({}),I=o({}),b=o({}),h=o({}),L=o({}),D=m({currentPlan:"0",isShow:y.isShow,riskBaseInfo:{},holderFactor:[],insuredFactor:[],riskData:[],riskPlanData:[],trialResult:{},canTrial:!0,retrialTip:!1,enumList:{},ageRange:[],collapseName:["1"],type:y.type});G("premium",L.value),G("source",{type:D.type,origin:"proposal",showRiskList:y.currentRisk});const C=_((()=>{var e;let i="";if(null==(e=D.riskData)?void 0:e[0]){const e=D.riskData[0],a=((null==e?void 0:e.requiredRiderRiskVOList)||[]).map((e=>e.riskName));a.length&&(i=`特殊提示: ${e.riskName}和${a.join("、")}必须同时投保`)}return i})),R=()=>{var e;const a=JSON.parse(JSON.stringify(V.value[D.currentPlan])),o=Object.values(a).find((e=>1===e.riskType)),l=Object.values(a).map((e=>{const i=e;return((e,i)=>{var a,o,l,t;const r=e;if("3"===r.chargePeriod){const e=(i.chargePeriod||"").split("_");if(e[1]-=1,1===r.exemptFlag){if("to"===e[0]){let i=0;1===r.exemptType?(null==(a=k.value.personVO)?void 0:a.birthday)&&(i=parseInt(""+(+new Date-new Date(null==(o=k.value.personVO)?void 0:o.birthday))/31536e6,10)):2===r.exemptType&&(null==(l=g.value.personVO)?void 0:l.birthday)&&(i=parseInt(""+(+new Date-new Date(null==(t=g.value.personVO)?void 0:t.birthday))/31536e6,10)),e[1]=e[1]-i}e[0]="year",r.coveragePeriod=e.join("_")}r.chargePeriod=e.join("_")}})(i,o),i.liabilityVOList=(i.liabilityVOList||[]).filter((e=>1===e.optionalFlag||e.liabilityAttributeValue&&"-1"!==e.liabilityAttributeValue)).map((e=>{const i=e;return"0"===i.liabilityAttributeValue&&(i.liabilityAttributeValue=""),i})),i})),t={holder:k.value,productCode:D.riskBaseInfo.productCode,insuredVOList:[{...g.value,productPlanVOList:[{planCode:D.currentPlan||"",insurerCode:null==(e=D.riskBaseInfo)?void 0:e.insurerCode,riskVOList:l}]}]};se({...t}).then((({code:e,data:a})=>{if("10000"===e){D.retrialTip=!1,D.trialResult=a,D.canTrial=!1;const e={},o=(i=[])=>{(i||[]).forEach((i=>{var a;e[i.riskCode]=i,(null==(a=i.riskPremiumDetailVOList)?void 0:a.length)&&o(i.riskPremiumDetailVOList)}))};o(a.riskPremiumDetailVOList),Object.assign(L.value,e),i("finished",((e,i)=>{var a,o,l,t,r,n,s,d,u;const m=(e.insuredVOList[0].productPlanVOList[0].riskVOList||[]).map((e=>({...e,premium:i[e.riskCode].premium,amount:i[e.riskCode].amount})));return{proposalHolder:{...null==(a=e.holder)?void 0:a.personVO},proposalInsuredList:[{...e.insuredVOList[0].personVO,dateRange:{min:null==(l=null==(o=b.value)?void 0:o.ageRangeObj)?void 0:l.minAge,max:null==(r=null==(t=b.value)?void 0:t.ageRangeObj)?void 0:r.maxAge},proposalInsuredProductList:[{productId:D.riskBaseInfo.id,productName:D.riskBaseInfo.productName,dateRange:{min:null==(s=null==(n=b.value)?void 0:n.ageRangeObj)?void 0:s.minAge,max:null==(u=null==(d=b.value)?void 0:d.ageRangeObj)?void 0:u.maxAge},occupationCodeList:e.insuredVOList[0].personVO.occupationCodeList,proposalProductRiskList:m}]}]}})(t,e))}else D.retrialTip=!0}))},P=()=>{var e,i,a,o,l;Promise.all([null==(i=null==(e=I.value)?void 0:e.validateForm)?void 0:i.call(e),null==(o=null==(a=b.value)?void 0:a.validateForm)?void 0:o.call(a),null==(l=h.value)?void 0:l.validate()]).then((()=>{R()}))},A=()=>{i("close")},x=e=>{D.holderFactor=e.holderFactorList,D.insuredFactor=e.insuredFactorList,D.ageRange=e.ageRange};return p([()=>V.value,()=>k.value,()=>g.value],(e=>{e&&!D.canTrial&&(D.canTrial=!0,D.retrialTip=!0)}),{deep:!0}),p((()=>y.isShow),(e=>{D.isShow=e}),{immediate:!0}),p((()=>y.productId),(e=>{e&&ne({productId:y.productId,source:2}).then((({code:e,data:i})=>{"10000"===e&&(D.riskBaseInfo=i.productBasicInfoVO,(i.productRiskVoList[0].riskDetailVOList||[]).forEach(((e,i)=>{0===i&&(D.currentPlan=e.planCode||"0"),Object.assign(V.value,{[e.planCode||i]:{}})})),D.riskData=i.productRiskVoList[0].riskDetailVOList||[],D.riskPlanData=i.productRelationPlanVOList||[])})).finally((()=>{}))}),{immediate:!0}),p((()=>y.formInfo),((e={})=>{if("add"!==y.type&&"repeatAdd"!==y.type){const i={};e.proposalProductRiskList.forEach((e=>{i[e.riskId]=e})),Object.assign(V.value,{0:i})}}),{deep:!0,immediate:!0}),p((()=>y.productData),(e=>{var i;"add"!==y.type&&"repeatAdd"!==y.type&&(D.riskBaseInfo=e.productBasicInfoVO,D.riskData=(null==(i=e.productRiskVoList)?void 0:i[0].riskDetailVOList)||[])}),{deep:!0,immediate:!0}),p((()=>y.type),(e=>{D.type=e})),E((()=>{K({dictCodeList:["RISK_PAYMENT_PERIOD","RISK_INSURANCE_PERIOD"]}).then((({code:e,data:i})=>{if("10000"===e){const e={};i.forEach((i=>{e[i.dictCode]=i.dictItemList})),D.enumList=e}}))})),(e,i)=>{const a=H,o=z,m=N,c=u,p=O;return l(),f("div",Be,[s(p,{show:v(D).isShow,"onUpdate:show":i[0]||(i[0]=e=>v(D).isShow=e),round:"",position:"bottom",closeable:"",style:{height:"80%"},onClose:A},{default:r((()=>[n("div",Ge,[Ke,v(C)?(l(),t(a,{key:0,content:v(C)},null,8,["content"])):T("",!0),n("div",He,[v(D).holderFactor.length?(l(),t(o,{key:0,title:"投保人",class:"part-card"},{default:r((()=>{var e;return[s(he,{ref_key:"holderRef",ref:I,"insured-code":null==(e=v(D).riskBaseInfo)?void 0:e.insurerCode,"form-info":v(k).personVO,"factor-list":v(D).holderFactor,"age-range":v(D).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])]})),_:1})):T("",!0),v(D).insuredFactor.length?(l(),t(o,{key:1,title:"被保人",class:"part-card"},{default:r((()=>{var e;return[s(he,{ref_key:"insuredRef",ref:b,"insured-code":null==(e=v(D).riskBaseInfo)?void 0:e.insurerCode,"form-info":v(g).personVO,"factor-list":v(D).insuredFactor,"age-range":v(D).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])]})),_:1})):T("",!0),n("div",ze,[s(o,{title:"投保方案",class:"part-card"},{default:r((()=>[v(D).riskData.length?(l(),f("div",Je,[s(m,{ref_key:"riskFormRef",ref:h,"input-align":"right","error-message-align":"right"},{default:r((()=>[s($e,{"risk-info":v(V)[0],enums:v(D).enumList,"origin-data":v(D).riskData,"pick-factor":x},null,8,["risk-info","enums","origin-data"])])),_:1},512)])):T("",!0)])),_:1})])]),n("div",Xe,[s(c,{block:"",type:"primary",onClick:P},{default:r((()=>[d("确定")])),_:1})])])])),_:1},8,["show"])])}}}),[["__scopeId","data-v-6c73a33e"]]);export{We as P,ge as R,me as T,de as u};
