import{d as e,j as a,i as l,z as s,o as i,l as n,w as o,a as u,e as r,u as d,b as t,V as v,W as m,bU as c,bV as p,bW as f,bX as h,as as y,ao as g,h as b,g as S,O as V,c as C,q as k,F as q,bY as x,a8 as L,bk as w,a6 as j,T as I,aD as U,a9 as _,aa as E,bZ as O,aq as P,an as $}from"./index-24f84c11.js";import{n as F}from"./nextStep-15bb20b3.js";import{c as D}from"./format-b5e9d8b9.js";import{g as A,m as N}from"./trial-18dfdc89.js";import{p as R}from"./utils-0af605ab.js";import{u as W}from"./useOrder-03de0b09.js";import{a as z}from"./constants-6162d78d.js";import"./core-ae287bb1.js";import"./constant-8927d485.js";const B={class:"popup-container"},G={class:"popup-header"},J={class:"title"},M={class:"popup-body"},T=e({name:"checkCodePopup"}),X=e({...T,props:{show:{type:Boolean,default:!1},type:{default:"agent"},data:{default:()=>({})}},emits:["cancel","confirm"],setup(e,{emit:g}){const b=e,S=a((()=>b.show)),V=l({mobile:"",verifyCode:""}),C=a((()=>b.type)),k=l({holder:{type:"投保人",name:"",mobile:"",desc:""},agent:{type:"代理人",name:"李三",mobile:"13262278989",desc:"色卡上会计核算看回放独守空房还是空巅峰计划收款方"},insured:{type:"被保人",name:"",mobile:"",desc:""}}),q=()=>{g("cancel")},x=()=>{g("confirm")};return s([()=>b.data,b.type],(([e,a])=>{var l,s,i;e&&(Object.assign(k.value.holder,e.holder),Object.assign(k.value.insured,null==(l=null==e?void 0:e.insuredList)?void 0:l[0]),V.value.mobile=null==(i=null==(s=k.value)?void 0:s[`${b.type}`])?void 0:i.mobile)}),{immediate:!0,deep:!0}),(e,a)=>{const l=p,s=f,g=h,b=y;return i(),n(b,{show:S.value,"onUpdate:show":a[2]||(a[2]=e=>S.value=e),class:"popup-check-mobile",closeable:!1,"close-on-click-overlay":!1},{default:o((()=>[u("div",B,[u("div",G,[u("span",{class:"clear-all",onClick:q}," 取消 "),u("span",J,r(`${k.value[C.value].type}手机号验证`),1),u("span",{class:"close",onClick:x},"确认")]),u("div",M,[u("h3",null,r(`尊敬的${k.value[C.value].type}:${k.value[C.value].name}`),1),u("p",null,r(k.value[C.value].desc),1),u("h3",null,r(`${k.value[C.value].type}手机号验证 ${d(D)(k.value[C.value].mobile||"")}`),1),t(g,{model:V.value},{default:o((()=>[v(t(l,{modelValue:V.value.mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>V.value.mobile=e),label:"被保人手机号",name:"mobile",maxlength:"11",required:""},null,8,["modelValue"]),[[m,!1]]),t(s,{modelValue:V.value.verifyCode,"onUpdate:modelValue":a[1]||(a[1]=e=>V.value.verifyCode=e),"related-name":"mobile",label:" ",maxlength:"6","input-align":"left",placeholder:"请输入验证码",name:"verifyCode","send-s-m-s-code":d(c),rules:""},null,8,["modelValue","send-s-m-s-code"])])),_:1},8,["model"])])])])),_:1},8,["show"])}}}),Y=g([{label:"签名完成",value:1},{label:"去签名",value:2},{label:"认证失败，请联系内勤人员",value:3}]);const Z={class:"page-verify-wrap"},H={key:0,class:"header"},K={class:"sign-list"},Q={class:"inner-cell"},ee={class:"inner-cell"},ae={class:"footer-button"},le=e({name:"verify"}),se=e({...le,setup(e){const s=b(),r=S(),{orderNo:v,tenantId:m}=s.query,y=l(!1),g=l({holder:{},insuredList:[{}]}),D=W(),B=l(!1),G=l({sign:[],verify:[],scribing:""}),J=l({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{},verifyStatus:2},agent:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2}}),M=l("agent"),T=a((()=>e=>G.value.sign.includes(e)||G.value.verify.includes(e))),le=a((()=>e=>J.value[e].isSign||J.value[e].isVerify)),se=a((()=>e=>J.value[e].isShareSign)),ie=e=>{M.value=e,B.value=!0},ne=()=>{B.value=!1},oe=()=>{let e="";e="agent"===M.value?z.agentSign:"holder"===M.value?(J.value[M.value].isVerify,z.holderSign):(J.value[M.value].isVerify,z.insuredSign),r.push({path:e,query:{...s.query,type:M.value}})},ue=()=>{const{holder:e,insuredList:a,extInfo:l}=D.value;[l.agentAuthFlag,e.isCert,a[0].isCert].includes(j.NO)?I("请先完成签名"):F(D.value,((e,a)=>{a===U.JUMP_PAGE&&_(e.nextPageCode,s.query)}))};return V((()=>{(async()=>{let e={};await A({orderNo:v,tenantId:m}).then((({code:a,data:l})=>{var s;"10000"===a&&(Object.assign(D.value,l),g.value=l,e=R(l.insuredList[0].productList),J.value.agent.verifyStatus=l.extInfo.agentAuthFlag,J.value.holder.verifyStatus=l.holder.isCert,J.value.insured.verifyStatus=null==(s=l.extInfo.insured)?void 0:s[0].isCert)})),await N(e).then((({data:e,code:a})=>{if("10000"===a){const{signInfo:a}=w(e.productFactor);a.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((a=>{e.required&&G.value.sign.push(a.code),"1"===a.code?J.value.agent.isSign=!0:"2"===a.code?J.value.holder.isSign=!0:"3"===a.code?J.value.insured.isSign=!0:"4"===a.code?J.value.holder.isShareSign=!0:"5"===a.code&&(J.value.insured.isShareSign=!0)})),"customerFace"===e.name&&e.columns.forEach((a=>{e.required&&G.value.verify.push(a.code),"1"===a.code?J.value.holder.isVerify=!0:"2"===a.code&&(J.value.insured.isVerify=!0)}))}))}}))})()})),(e,a)=>{const l=E,s=O,r=P,v=$;return i(),C("div",Z,[t(l),d(y)?(i(),C("div",H,[t(s,{type:"warning",content:"为保障您的合法权益，当前保单需要进行双录"})])):k("",!0),u("div",K,[d(le)("agent")?(i(),n(r,{key:0,title:"代理人签名",required:d(T)("agent"),"is-link":"",value:d(Y)[d(J).agent.verifyStatus],onClick:a[0]||(a[0]=e=>ie("agent"))},null,8,["required","value"])):k("",!0),d(y)?(i(),n(d(h),{key:2,model:d(g)},{default:o((()=>[t(d(p),{modelValue:d(g).holder.mobile,"onUpdate:modelValue":a[3]||(a[3]=e=>d(g).holder.mobile=e),rules:[{pattern:new RegExp(d(x).isPhone)}],label:"投保人手机号",name:"holder.mobile",maxlength:"11",required:""},null,8,["modelValue","rules"]),t(d(f),{modelValue:d(g).holder.verifyCode,"onUpdate:modelValue":a[4]||(a[4]=e=>d(g).holder.verifyCode=e),"related-name":"holder.mobile",label:"验证码",maxlength:"6",name:"holder.verifyCode","send-s-m-s-code":d(c),rules:"",required:""},null,8,["modelValue","send-s-m-s-code"]),t(d(p),{modelValue:d(g).insuredList[0].mobile,"onUpdate:modelValue":a[5]||(a[5]=e=>d(g).insuredList[0].mobile=e),label:"被保人手机号",name:"insuredList.0.mobile",maxlength:"11",required:"",rules:[{pattern:new RegExp(d(x).isPhone)}]},null,8,["modelValue","rules"]),t(d(f),{modelValue:d(g).insuredList[0].verifyCode,"onUpdate:modelValue":a[6]||(a[6]=e=>d(g).insuredList[0].verifyCode=e),label:"验证码",maxlength:"6",name:"insuredList.0.verifyCode","related-name":"insuredList.0.mobile","send-s-m-s-code":d(c),required:""},null,8,["modelValue","send-s-m-s-code"])])),_:1},8,["model"])):(i(),C(q,{key:1},[d(le)("holder")?(i(),n(r,{key:0,title:"投保人签名",required:d(T)("holder")},{value:o((()=>[u("div",Q,[d(se)("holder")?(i(),n(r,{key:0,"is-link":"",value:"分享空签邀约"})):k("",!0),t(r,{"is-link":"",value:d(Y)[d(J).holder.verifyStatus],onClick:a[1]||(a[1]=e=>ie("holder"))},null,8,["value"])])])),_:1},8,["required"])):k("",!0),d(le)("insured")?(i(),n(r,{key:1,title:"被保人签名",required:d(T)("insured")},{value:o((()=>[u("div",ee,[d(se)("insured")?(i(),n(r,{key:0,"is-link":"",value:"分享空签邀约"})):k("",!0),t(r,{"is-link":"",value:d(Y)[d(J).insured.verifyStatus],onClick:a[2]||(a[2]=e=>ie("insured"))},null,8,["value"])])])),_:1},8,["required"])):k("",!0)],64))]),u("div",ae,[t(v,{type:"primary",onClick:ue},{default:o((()=>[L("下一步")])),_:1})]),t(X,{type:d(M),show:d(B),data:d(D),onCancel:ne,onConfirm:oe},null,8,["type","show","data"])])}}});export{se as default};
