import{d as e,a4 as a,a5 as t,i as o,j as n,r as l,aE as i,O as s,bV as r,o as u,c as d,b as c,u as f,m as p,w as v,f as m,p as I,a8 as h,aJ as y,aH as C,aK as O,a9 as g,T as j,bu as L,aa as b,ab as w}from"./index-71665d4a.js";import{_ as x,a as P}from"./PolicyInfo-07fc4d0e.js";import{s as _,g as N,m as E}from"./trial-55cd87a0.js";import{_ as D}from"./TrialButton-d656eaff.js";import{n as V}from"./nextStep-8f8b52cd.js";import{u as T}from"./useAttachment-a6d69534.js";import"./infoCollection-349e3309.js";import"./trial-277f6f8b.js";import{u as F}from"./useOrder-20156d83.js";import{a as k,B as U}from"./constants-4b08cf92.js";import{t as q}from"./utils-dc686cf5.js";import{T as A}from"./index-34ed3bdf.js";import{p as R}from"./utils-8c2d369c.js";import"./index-2adbe796.js";import"./format-31cde443.js";import"./core-f1d1e983.js";import"./utils-05c294a3.js";import"./createProposal-b36f5c57.js";import"./cloneDeep-990c9ba1.js";import"./InsureInfos-6eeab10a.js";import"./index-de590a0b.js";import"./index-a3be9e44.js";import"./index-620c0c5e.js";import"./lodash-ebf6f437.js";import"./questionnaire-42dcb602.js";import"./util-165cbd86.js";import"./product-7bbf9c44.js";import"./constants-e7ba4f30.js";import"./config-98e8d477.js";const S={class:"long-info-collection"},M=e({name:"InfoCollection"}),B=e({...M,setup(e){const M=a((()=>t((()=>import("./index-49427eaf.js")),["static/js/index-49427eaf.js","static/css/index-fa4edf2a.css","static/js/index-71665d4a.js","static/css/index-e41fee2e.css","static/js/theme-94cf7d00.js","static/js/index-2adbe796.js","static/css/index-bbfdd7ec.css","static/js/utils-05c294a3.js","static/js/infoCollection-349e3309.js","static/js/trial-277f6f8b.js"]))),B=a((()=>t((()=>import("./index-1f7456c0.js")),["static/js/index-1f7456c0.js","static/css/index-bf024e9b.css","static/js/index-71665d4a.js","static/css/index-e41fee2e.css"]))),J=o(),H=F(),{productCode:$="",tenantId:G,agentCode:K="",agencyCode:z,saleChannelId:Q,isShare:W,orderNo:X,extraInfo:Y,insurerCode:Z,preview:ee}=J.query;let ae={},te=null;const oe=n(2);try{ae=JSON.parse(decodeURIComponent(Y))}catch(qe){}const ne=l({isView:!1,personalInfo:{},payInfo:{schema:[],config:[],formData:[]},policyInfo:{schema:[],config:[],formData:{}},defaultValue:null,isAutoChange:!1,defaultPlanCode:"",userData:{}}),le=`${window.origin}/baseInsurance/long/phoneVerify${window.location.search}`,ie=n({imgUrl:"",desc:"",title:"",link:le}),se=n();n();const re=n(),ue=n({}),de=n({}),ce=n([]),fe=n(),pe=n({}),ve=n(!1),me=n(!1),Ie=n(0),he=n(!0),{fileList:ye,mustReadFileCount:Ce,popupFileList:Oe}=T(pe,fe),ge=n(!1),je=n(!1),Le=()=>{me.value=!1,he.value=!0,ce.value.length<1||(ve.value=!0)},be=()=>{ve.value=!1,me.value=!1,he.value=!0};n({}),n(!1),n([{}]);const we=n(""),xe=n(0),Pe=n(!1);n(),n(),n();const _e=n(0);n({});const Ne=n(),Ee=()=>{we.value="试算中...",xe.value=0,Pe.value=!0},De=(e,a)=>{we.value="",_e.value=e.premium,xe.value=e,Ne.value=a,Pe.value=!1},Ve=async()=>{var e,a;if(ee)return void y(k.INFO_COLLECTION,J.query);if(!xe.value)return;const t=[];re.value&&t.push(null==(e=re.value)?void 0:e.validate(!1)),se.value&&t.push(null==(a=se.value)?void 0:a.validate(!1)),Promise.all(t).then((e=>{Object.assign(H.value,{extInfo:{...H.value.extInfo,buttonCode:U.INFO_COLLECTION,pageCode:k.INFO_COLLECTION}});const a=re.value.dealMixData(),t=q({...a,productCode:$,productName:de.value.productName},xe.value,H.value);J.query.productClass=oe.value;const o=(()=>{var e,a;const{holder:t,insuredList:o}=ne.userData,n=[],l=(e,a)=>{e.ocrData&&Object.keys(e.ocrData).find((a=>(e[a]||e.ocrData[a])&&e.ocrData[a]!==e[a]))&&n.push(`${a}信息影像识别与录入信息不一致，请确认`)};return l(t,"投保人"),l(null==o?void 0:o[0],"被保人"),((null==(e=null==o?void 0:o[0])?void 0:e.beneficiaryList)||[]).forEach(((e,a)=>{l(e,`收益人${a}`)})),l(null==o?void 0:o[0].guardian,"监护人"),l(null==o?void 0:o[0].guardian,"监护人"),((null==(a=H.value)?void 0:a.tenantOrderPayInfoList)||[]).forEach((e=>{l(null==o?void 0:o[0].guardian,"银行卡")})),n})();(null==o?void 0:o.length)?C.confirm({message:null==o?void 0:o[0]}).then((()=>{clearInterval(te),V(t,((e,a)=>{a===O.JUMP_PAGE&&g(e.nextPageCode,J.query)}),J)})):(clearInterval(te),V(t,((e,a)=>{a===O.JUMP_PAGE&&g(e.nextPageCode,J.query)}),J))}),(e=>{console.log("formRef",e),e[0].scrollToField()})).catch((e=>{console.log("e",e)}))},Te=e=>{const a=H.value.tenantOrderPayInfoList[0];H.value.tenantOrderPayInfoList.splice(0,1,{...a,...e})},Fe=e=>{Object.assign(ne.userData,e)},ke=n({}),Ue=n();return i((()=>{(async()=>{let e={};X&&await N({orderNo:X,tenantId:G}).then((({code:a,data:t})=>{var o;if("10000"===a){if(xe.value=t.orderAmount,(null==(o=t.insuredList)?void 0:o.length)>0){const{planCode:e}=t.insuredList[0];ne.defaultPlanCode=e}Object.assign(H.value,t,{tenantOrderPayInfoList:t.tenantOrderPayInfoList||[],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0,withPayInfo:!0},productCode:$}),ne.defaultValue=H.value,e=R(t.insuredList[0].productList),oe.value=t.insuredList[0].productList.length>1?1:2,je.value=!0}})),await E(e).then((({data:e,code:a})=>{if("10000"===a){const{productDetailResList:a,productFactor:t}=e;Ue.value=t;const o={};a.forEach((e=>{o[e.productCode]=e})),ke.value=o;const{payInfo:n,other:l}=L(Ue.value);ne.payInfo={...ne.payInfo,...n},ne.policyInfo={...ne.policyInfo,...l}}}))})()})),s((()=>{te=setInterval((()=>{(()=>{Object.assign(H.value,{extInfo:{...H.value.extInfo,buttonCode:U.INFO_COLLECTION,pageCode:k.INFO_COLLECTION}});const e=re.value.dealMixData(),a=q(e,xe.value,H.value);a.orderStatus="collectInfo",_(a)})()}),3e4)})),r((()=>{clearInterval(te)})),(e,a)=>{var t,o,n,l,i,s;const r=b,y=w;return u(),d("div",S,[c(r),f(je)||f(ee)?(u(),p(A,{key:0,ref_key:"personalInfoRef",ref:re,"product-info":{productCode:f($),productName:f(de).productName,insurerCode:f(Z),tenantId:f(G),planList:[]},"tenant-product-detail":f(ue),"hide-benefit":"","product-collection":f(ke),"default-data":f(H),"product-factor":f(Ue),onTrialStart:Ee,onTrialEnd:De,"onUpdate:userData":Fe,onUpdateBank:Te},{middleInfo:v((()=>[f(ne).payInfo.schema.length?(u(),p(f(x),{key:0,ref_key:"payInfoRef",ref:se,modelValue:f(H).tenantOrderPayInfoList,"onUpdate:modelValue":a[0]||(a[0]=e=>f(H).tenantOrderPayInfoList=e),schema:f(ne).payInfo.schema,"is-view":f(ne).isView,"user-data":f(ne).userData},null,8,["modelValue","schema","is-view","user-data"])):m("",!0),f(ne).policyInfo.schema.length?(u(),p(f(P),{key:1,modelValue:f(H),"onUpdate:modelValue":a[1]||(a[1]=e=>I(H)?H.value=e:null),schema:f(ne).policyInfo.schema,"is-view":f(ne).isView},null,8,["modelValue","schema","is-view"])):m("",!0)])),_:1},8,["product-info","tenant-product-detail","product-collection","default-data","product-factor"])):m("",!0),c(y,null,{default:v((()=>{var e;return[(null==(e=f(ye))?void 0:e.length)?(u(),p(f(B),{key:0,modelValue:f(ge),"onUpdate:modelValue":a[2]||(a[2]=e=>I(ge)?ge.value=e:null),"has-bg-color":!1,"attachment-list":f(ye),"is-show-radio":"","pre-text":"投保人阅读并接受",onPreviewFile:a[3]||(a[3]=e=>(e=>{Ie.value=e,me.value=!0})(e))},null,8,["modelValue","attachment-list"])):m("",!0)]})),_:1}),f(me)?(u(),p(f(M),{key:1,show:f(me),"onUpdate:show":a[4]||(a[4]=e=>I(me)?me.value=e:null),"content-list":f(he)?f(ye):f(Oe),"is-only-view":f(he),"active-index":f(Ie),text:f(he)?"关闭":"我已逐页阅读并确认告知内容","force-read-count":f(he)?0:f(Ce),onSubmit:Le,onOnCloseFilePreviewByMask:be},null,8,["show","content-list","is-only-view","active-index","text","force-read-count"])):m("",!0),c(D,{"is-share":f(ie).isShare&&!f(W),premium:null==(t=f(xe))?void 0:t.initialPremium,"share-info":f(ie),"loading-text":f(we),"payment-frequency":(null==(s=null==(i=null==(l=null==(n=null==(o=f(Ne))?void 0:o.insuredList)?void 0:n[0].productList)?void 0:l[0].riskList)?void 0:i[0])?void 0:s.paymentFrequency)+"","tenant-product-detail":f(ue),"handle-share":e=>(e=>{re.value.validateHolder(["mobile"]).then((()=>{Object.assign(H.value,{extInfo:{...H.value.extInfo,buttonCode:U.INFO_COLLECTION,pageCode:k.INFO_COLLECTION}});const a=re.value.getUserData(),t=q({...Ne.value,holder:null==a?void 0:a.holder},xe.value||{},H.value);V(t,((a,t)=>{t===O.JUMP_PAGE&&(null==e||e())}),J)})).catch((()=>{j("请录入投保人手机号后进行分享")}))})(e),disabled:!f(xe),onHandleClick:Ve},{default:v((()=>[h("下一步 ")])),_:1},8,["is-share","premium","share-info","loading-text","payment-frequency","tenant-product-detail","handle-share","disabled"])])}}});export{B as default};
