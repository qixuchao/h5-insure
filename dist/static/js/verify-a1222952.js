import{d as e,j as a,i as l,z as s,o as i,l as o,w as n,a as u,e as r,u as d,b as t,V as v,W as c,c4 as m,c5 as f,c6 as p,c7 as y,as as h,ao as g,h as b,g as S,O as C,c as k,q as V,F as q,a8 as j,T as L,bj as x,a6 as w,aC as I,a9 as U,aa as _,c8 as F,aq as O,an as N}from"./index-5f0b7c0f.js";import{n as P}from"./nextStep-10f5de0a.js";import{c as $}from"./format-b5e9d8b9.js";import{g as A,m as E}from"./trial-702131ae.js";import{p as D}from"./utils-394f97a4.js";import{u as G}from"./useOrder-737dc359.js";import{P as R,a as B,B as T}from"./constants-fe95ef6f.js";import{d as z,q as J}from"./verify-fccd4748.js";import"./core-3af9d072.js";const M={class:"popup-container"},W={class:"popup-header"},H={class:"title"},K={class:"popup-body"},Q=e({name:"checkCodePopup"}),X=e({...Q,props:{show:{type:Boolean,default:!1},type:{default:"agent"},data:{default:()=>({})}},emits:["cancel","confirm"],setup(e,{emit:g}){const b=e,S=a((()=>b.show)),C=l({mobile:"",verifyCode:""}),k=a((()=>b.type)),V=l({holder:{type:"投保人",name:"",mobile:"",desc:""},agent:{type:"代理人",name:"李三",mobile:"13262278989",desc:"色卡上会计核算看回放独守空房还是空巅峰计划收款方"},insured:{type:"被保人",name:"",mobile:"",desc:""}}),q=()=>{g("cancel")},j=()=>{g("confirm")};return s([()=>b.data,b.type],(([e,a])=>{var l,s,i;e&&(Object.assign(V.value.holder,e.holder),Object.assign(V.value.insured,null==(l=null==e?void 0:e.insuredList)?void 0:l[0]),C.value.mobile=null==(i=null==(s=V.value)?void 0:s[`${b.type}`])?void 0:i.mobile)}),{immediate:!0,deep:!0}),(e,a)=>{const l=f,s=p,g=y,b=h;return i(),o(b,{show:S.value,"onUpdate:show":a[2]||(a[2]=e=>S.value=e),class:"popup-check-mobile",closeable:!1,"close-on-click-overlay":!1},{default:n((()=>[u("div",M,[u("div",W,[u("span",{class:"clear-all",onClick:q}," 取消 "),u("span",H,r(`${V.value[k.value].type}手机号验证`),1),u("span",{class:"close",onClick:j},"确认")]),u("div",K,[u("h3",null,r(`尊敬的${V.value[k.value].type}:${V.value[k.value].name}`),1),u("p",null,r(V.value[k.value].desc),1),u("h3",null,r(`${V.value[k.value].type}手机号验证 ${d($)(V.value[k.value].mobile||"")}`),1),t(g,{model:C.value},{default:n((()=>[v(t(l,{modelValue:C.value.mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>C.value.mobile=e),label:"被保人手机号",name:"mobile",maxlength:"11",required:""},null,8,["modelValue"]),[[c,!1]]),t(s,{modelValue:C.value.verifyCode,"onUpdate:modelValue":a[1]||(a[1]=e=>C.value.verifyCode=e),"related-name":"mobile",label:" ",maxlength:"6","input-align":"left",placeholder:"请输入验证码",name:"verifyCode","send-s-m-s-code":d(m),rules:""},null,8,["modelValue","send-s-m-s-code"])])),_:1},8,["model"])])])])),_:1},8,["show"])}}}),Y=g([{label:"签名完成",value:1},{label:"去签名",value:2},{label:"认证失败，请联系内勤人员",value:3}]);const Z={class:"page-verify-wrap"},ee={key:0,class:"header"},ae={class:"sign-list"},le={class:"inner-cell"},se={class:"inner-cell"},ie={class:"footer-button"},oe=e({name:"verify"}),ne=e({...oe,setup(e){const s=b(),r=S(),{orderNo:v,tenantId:c}=s.query,h=l(!1),g=l(!1),$=l(),M=l({holder:{},insuredList:[{}]}),W=G(),H=l(!1),K=l({sign:[],verify:[],scribing:""}),Q=l({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{},verifyStatus:2},agent:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2}}),oe=l("agent"),ne=a((()=>e=>K.value.sign.includes(e)||K.value.verify.includes(e))),ue=a((()=>e=>Q.value[e].isSign||Q.value[e].isVerify)),re=a((()=>e=>Q.value[e].isShareSign)),de=e=>{oe.value=e,"agent"!==e?H.value=!0:r.push({path:R.agentSign,query:s.query})},te=()=>{z(W.value).then((({code:e,data:a})=>{"10000"===e&&a&&L("双录已完成")}))},ve=()=>{H.value=!1},ce=()=>{let e="";e=("agent"===oe.value||(oe.value,Q.value[oe.value].isVerify),R.infoPreview),r.push({path:e,query:{...s.query,objectType:oe.value}})},me=()=>{const{holder:e,insuredList:a,extInfo:l}=W.value;if(h.value){if(!l.agentAuthFlag)return void L("请先完成代理人签名")}else if([l.agentAuthFlag,e.isCert,a[0].isCert].includes(w.NO))return void L("请先完成签名");const i=Object.assign(W.value,{extInfo:{...W.value.extInfo,pageCode:B.SIGN,buttonCode:T.SIGN}});P(i,((e,a)=>{a===I.JUMP_PAGE&&U(e.nextPageCode,s.query)}))};return C((()=>{(async()=>{let e={};J({orderNo:v,tenantId:c}).then((({code:e,data:a})=>{if("10000"===e){const{doubleRecordFlag:e,doubleRecordStatus:l}=a;h.value=!!e,g.value=!!l}})),await A({orderNo:v,tenantId:c}).then((({code:a,data:l})=>{var s,i;if("10000"===a){Object.assign(W.value,l);const{agentAuthFlag:a}=l.extInfo;M.value=l,e=D(l.insuredList[0].productList),Q.value.agent.verifyStatus=a,Q.value.holder.verifyStatus=l.holder.isCert,Q.value.insured.verifyStatus=null==(i=null==(s=l.insuredList)?void 0:s[0])?void 0:i.isCert}})),await E(e).then((({data:e,code:a})=>{if("10000"===a){const{signInfo:a}=x(e.productFactor);a.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((a=>{e.required&&K.value.sign.push(a.code),"1"===a.code?Q.value.agent.isSign=!0:"2"===a.code?Q.value.holder.isSign=!0:"3"===a.code?Q.value.insured.isSign=!0:"4"===a.code?Q.value.holder.isShareSign=!0:"5"===a.code&&(Q.value.insured.isShareSign=!0)})),"customerFace"===e.name&&e.columns.forEach((a=>{e.required&&K.value.verify.push(a.code),"1"===a.code?Q.value.holder.isVerify=!0:"2"===a.code&&(Q.value.insured.isVerify=!0)}))}))}}))})()})),(e,a)=>{const l=_,s=F,r=O,v=N;return i(),k("div",Z,[t(l),d(h)?(i(),k("div",ee,[t(s,{type:"warning",content:"为保障您的合法权益，当前保单需要进行双录"})])):V("",!0),u("div",ae,[d(ue)("agent")?(i(),o(r,{key:0,title:"代理人签名",required:d(ne)("agent"),"is-link":"",value:d(Y)[d(Q).agent.verifyStatus],onClick:a[0]||(a[0]=e=>de("agent"))},null,8,["required","value"])):V("",!0),d(h)?(i(),o(d(y),{key:2,ref_key:"formRef",ref:$,model:d(M)},{default:n((()=>[t(d(f),{modelValue:d(M).holder.mobile,"onUpdate:modelValue":a[3]||(a[3]=e=>d(M).holder.mobile=e),label:"投保人手机号",name:"holder.mobile",maxlength:"11",required:""},null,8,["modelValue"]),t(d(p),{modelValue:d(M).holder.verifyCode,"onUpdate:modelValue":a[4]||(a[4]=e=>d(M).holder.verifyCode=e),"related-name":"holder.mobile",label:"验证码",maxlength:"6",name:"holder.verifyCode","send-s-m-s-code":d(m),rules:"",required:""},null,8,["modelValue","send-s-m-s-code"]),t(d(f),{modelValue:d(M).insuredList[0].mobile,"onUpdate:modelValue":a[5]||(a[5]=e=>d(M).insuredList[0].mobile=e),label:"被保人手机号",name:"insuredList.0.mobile",maxlength:"11",required:""},null,8,["modelValue"]),t(d(p),{modelValue:d(M).insuredList[0].verifyCode,"onUpdate:modelValue":a[6]||(a[6]=e=>d(M).insuredList[0].verifyCode=e),label:"验证码",maxlength:"6",name:"insuredList.0.verifyCode","related-name":"insuredList.0.mobile","send-s-m-s-code":d(m),required:""},null,8,["modelValue","send-s-m-s-code"])])),_:1},8,["model"])):(i(),k(q,{key:1},[d(ue)("holder")?(i(),o(r,{key:0,title:"投保人签名",required:d(ne)("holder")},{value:n((()=>[u("div",le,[d(re)("holder")?(i(),o(r,{key:0,"is-link":"",value:"分享空签邀约"})):V("",!0),t(r,{"is-link":"",value:d(Y)[d(Q).holder.verifyStatus],onClick:a[1]||(a[1]=e=>de("holder"))},null,8,["value"])])])),_:1},8,["required"])):V("",!0),d(ue)("insured")?(i(),o(r,{key:1,title:"被保人签名",required:d(ne)("insured")},{value:n((()=>[u("div",se,[d(re)("insured")?(i(),o(r,{key:0,"is-link":"",value:"分享空签邀约"})):V("",!0),t(r,{"is-link":"",value:d(Y)[d(Q).insured.verifyStatus],onClick:a[2]||(a[2]=e=>de("insured"))},null,8,["value"])])])),_:1},8,["required"])):V("",!0)],64)),d(h)?(i(),o(r,{key:3,title:"保单双录",required:"","is-link":"",value:"去双录",onClick:te})):V("",!0)]),u("div",ie,[t(v,{type:"primary",onClick:me},{default:n((()=>[j("下一步")])),_:1})]),t(X,{type:d(oe),show:d(H),data:d(W),onCancel:ve,onConfirm:ce},null,8,["type","show","data"])])}}});export{ne as default};
