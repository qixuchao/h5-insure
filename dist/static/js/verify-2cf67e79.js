import{d as e,k as l,j as a,z as s,o as i,m as u,w as o,a as n,e as r,u as d,b as t,V as v,W as c,cc as m,cd as f,ce as p,cf as y,aB as h,ao as b,i as g,h as S,a6 as V,aj as C,O as k,c as q,q as j,F as w,a8 as x,T as I,bq as M,aL as L,a9 as _,aa as O,bn as U,ag as E}from"./index-ec1c03b4.js";import{n as F}from"./nextStep-c4538d0b.js";import{c as $}from"./format-b5e9d8b9.js";import{g as N,m as P}from"./trial-6749751c.js";import{p as A}from"./utils-a1c62da6.js";import{u as R}from"./useOrder-0292f21a.js";import{P as T,a as B,B as D}from"./constants-fe95ef6f.js";import{d as G,q as Y}from"./verify-7acd6062.js";import"./core-88669932.js";import"./utils-8850fe98.js";import"./infoCollection-93f3881c.js";import"./trial-672aeef3.js";const z={class:"popup-container"},H={class:"popup-header"},J={class:"title"},W={class:"popup-body"},K=e({name:"checkCodePopup"}),Q=e({...K,props:{show:{type:Boolean,default:!1},type:{default:"agent"},data:{default:()=>({})}},emits:["cancel","confirm"],setup(e,{emit:b}){const g=e,S=l((()=>g.show)),V=a({mobile:"",verifyCode:""}),C=l((()=>g.type)),k=a({holder:{type:"投保人",name:"",mobile:"",desc:""},agent:{type:"代理人",name:"李三",mobile:"13262278989",desc:"色卡上会计核算看回放独守空房还是空巅峰计划收款方"},insured:{type:"被保人",name:"",mobile:"",desc:""}}),q=()=>{b("cancel")},j=()=>{b("confirm")};return s([()=>g.data,g.type],(([e,l])=>{var a,s,i;e&&(Object.assign(k.value.holder,e.holder),Object.assign(k.value.insured,null==(a=null==e?void 0:e.insuredList)?void 0:a[0]),V.value.mobile=null==(i=null==(s=k.value)?void 0:s[`${g.type}`])?void 0:i.mobile)}),{immediate:!0,deep:!0}),(e,l)=>{const a=f,s=p,b=y,g=h;return i(),u(g,{show:S.value,"onUpdate:show":l[2]||(l[2]=e=>S.value=e),class:"popup-check-mobile",closeable:!1,"close-on-click-overlay":!1},{default:o((()=>[n("div",z,[n("div",H,[n("span",{class:"clear-all",onClick:q}," 取消 "),n("span",J,r(`${k.value[C.value].type}手机号验证`),1),n("span",{class:"close",onClick:j},"确认")]),n("div",W,[n("h3",null,r(`尊敬的${k.value[C.value].type}:${k.value[C.value].name}`),1),n("p",null,r(k.value[C.value].desc),1),n("h3",null,r(`${k.value[C.value].type}手机号验证 ${d($)(k.value[C.value].mobile||"")}`),1),t(b,{model:V.value},{default:o((()=>[v(t(a,{modelValue:V.value.mobile,"onUpdate:modelValue":l[0]||(l[0]=e=>V.value.mobile=e),label:"被保人手机号",name:"mobile",maxlength:"11",required:""},null,8,["modelValue"]),[[c,!1]]),t(s,{modelValue:V.value.verifyCode,"onUpdate:modelValue":l[1]||(l[1]=e=>V.value.verifyCode=e),"related-name":"mobile",label:" ",maxlength:"6","input-align":"left",placeholder:"请输入验证码",name:"verifyCode","send-s-m-s-code":d(m),rules:""},null,8,["modelValue","send-s-m-s-code"])])),_:1},8,["model"])])])])),_:1},8,["show"])}}}),X=b([{label:"签名完成",value:1},{label:"去签名",value:2},{label:"认证失败，请联系内勤人员",value:3}]),Z=2,ee=b([{label:"去双录",value:1},{label:"双录完成",value:Z},{label:"双录失败",value:3}]);const le={class:"page-verify-wrap"},ae={class:"sign-list"},se={class:"inner-cell"},ie={class:"inner-cell"},ue={class:"inner-cell"},oe={class:"inner-cell"},ne={class:"footer-button"},re=e({name:"verify"}),de=e({...re,setup(e){const r=g(),v=S(),{orderNo:c,tenantId:h}=r.query,b=a(!1),$=a(),z=a(),H=a({holderMobile:"",holderVerifyCode:"",insuredMobile:"",insuredVerifyCode:""}),J=R(),W=a(!1),K=a({sign:[],verify:[],scribing:""}),re=a({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{},verifyStatus:2},agent:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2}}),de=a("agent"),te=l((()=>e=>K.value.sign.includes(e)||K.value.verify.includes(e))),ve=l((()=>re.value.agent.verifyStatus!==V.YES)),ce=l((()=>{const{insuredList:e}=J.value||{},{age:l,relationToHolder:a}=e[0]||{};return!(l<18||`${a}`===C.CERT)})),me=l((()=>e=>re.value[e].isSign||re.value[e].isVerify)),fe=l((()=>e=>re.value[e].isShareSign)),pe=e=>{de.value=e,"agent"!==e?ve.value||(W.value=!0):v.push({path:T.agentSign,query:r.query})},ye=()=>{ve.value||$.value===Z||G(J.value).then((({code:e,data:l})=>{"10000"===e&&l&&I("双录已完成")}))},he=()=>{W.value=!1},be=()=>{let e="";e=("agent"===de.value||(de.value,re.value[de.value].isVerify),T.infoPreview),v.push({path:e,query:{...r.query,objectType:de.value}})},ge=()=>{const{holder:e,insuredList:l,extInfo:a}=J.value;if(b.value){if(!a.agentAuthFlag)return void I("请先完成代理人签名")}else if([a.agentAuthFlag,e.isCert,l[0].isCert].includes(V.NO))return void I("请先完成签名");const s=Object.assign(J.value,{extInfo:{...J.value.extInfo,pageCode:B.SIGN,buttonCode:D.SIGN}});F(s,((e,l)=>{l===L.JUMP_PAGE&&_(e.nextPageCode,r.query)}),r)};return s((()=>H.value),(()=>{}),{deep:!0,immediate:!0}),k((()=>{(async()=>{let e={};Y({orderNo:c,tenantId:h}).then((({code:e,data:l})=>{if("10000"===e){const{doubleRecordFlag:e,doubleRecordStatus:a}=l;b.value=e===V.YES,$.value=a}})),await N({orderNo:c,tenantId:h}).then((({code:l,data:a})=>{var s,i,u;if("10000"===l){Object.assign(J.value,a);const{agentAuthFlag:l}=a.extInfo,{mobile:o}=a.holder,{mobile:n}=(null==(s=a.insuredList)?void 0:s[0])||{};Object.assign(H.value,{holderMobile:o,insuredMobile:n}),e=A(a.insuredList[0].productList),re.value.agent.verifyStatus=l,re.value.holder.verifyStatus=a.holder.isCert,re.value.insured.verifyStatus=null==(u=null==(i=a.insuredList)?void 0:i[0])?void 0:u.isCert}})),await P(e).then((({data:e,code:l})=>{if("10000"===l){const{signInfo:l}=M(e.productFactor);l.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((l=>{e.required&&K.value.sign.push(l.code),"1"===l.code?re.value.agent.isSign=!0:"2"===l.code?re.value.holder.isSign=!0:"3"===l.code?re.value.insured.isSign=!0:"4"===l.code?re.value.holder.isShareSign=!0:"5"===l.code&&(re.value.insured.isShareSign=!0)})),"customerFace"===e.name&&e.columns.forEach((l=>{e.required&&K.value.verify.push(l.code),"1"===l.code?re.value.holder.isVerify=!0:"2"===l.code&&(re.value.insured.isVerify=!0)}))}))}}))})()})),(e,l)=>{const a=O,s=U,r=E;return i(),q("div",le,[t(a),n("div",ae,[d(me)("agent")?(i(),u(s,{key:0,title:"代理人签名",required:d(te)("agent")},{value:o((()=>[n("div",se,[t(s,{"is-link":"",value:d(X)[d(re).agent.verifyStatus],onClick:l[0]||(l[0]=e=>pe("agent"))},null,8,["value"])])])),_:1},8,["required"])):j("",!0),d(b)?(i(),u(d(y),{key:2,ref_key:"formRef",ref:z,model:d(H)},{default:o((()=>[t(d(f),{modelValue:d(H).holderMobile,"onUpdate:modelValue":l[3]||(l[3]=e=>d(H).holderMobile=e),label:"投保人手机号",name:"holderMobile",maxlength:"11",required:"","is-view":""},null,8,["modelValue"]),t(d(p),{modelValue:d(H).holderVerifyCode,"onUpdate:modelValue":l[4]||(l[4]=e=>d(H).holderVerifyCode=e),"related-name":"holderMobile",label:"验证码",maxlength:"6",name:"holderVerifyCode","send-s-m-s-code":d(m),rules:"",required:""},null,8,["modelValue","send-s-m-s-code"]),d(ce)?(i(),q(w,{key:0},[t(d(f),{modelValue:d(H).insuredMobile,"onUpdate:modelValue":l[5]||(l[5]=e=>d(H).insuredMobile=e),label:"被保人手机号",name:"insuredMobile",maxlength:"11",required:"","is-view":""},null,8,["modelValue"]),t(d(p),{modelValue:d(H).insuredVerifyCode,"onUpdate:modelValue":l[6]||(l[6]=e=>d(H).insuredVerifyCode=e),label:"验证码",maxlength:"6",name:"insuredVerifyCode","related-name":"insuredMobile","send-s-m-s-code":d(m),required:""},null,8,["modelValue","send-s-m-s-code"])],64)):j("",!0)])),_:1},8,["model"])):(i(),q(w,{key:1},[d(me)("holder")?(i(),u(s,{key:0,title:"投保人签名",required:d(te)("holder")},{value:o((()=>[n("div",ie,[d(fe)("holder")?(i(),u(s,{key:0,"value-class":""+(d(ve)?"disable":""),"is-link":"",value:"分享空签邀约"},null,8,["value-class"])):j("",!0),t(s,{"is-link":"",value:d(X)[d(re).holder.verifyStatus],"value-class":""+(d(ve)?"disable":""),onClick:l[1]||(l[1]=e=>pe("holder"))},null,8,["value","value-class"])])])),_:1},8,["required"])):j("",!0),d(me)("insured")&&d(ce)?(i(),u(s,{key:1,title:"被保人签名",required:d(te)("insured")},{value:o((()=>[n("div",ue,[d(fe)("insured")?(i(),u(s,{key:0,"value-class":""+(d(ve)?"disable":""),"is-link":"",value:"分享空签邀约"},null,8,["value-class"])):j("",!0),t(s,{"is-link":"","value-class":""+(d(ve)?"disable":""),value:d(X)[d(re).insured.verifyStatus],onClick:l[2]||(l[2]=e=>pe("insured"))},null,8,["value-class","value"])])])),_:1},8,["required"])):j("",!0)],64)),d(b)?(i(),u(s,{key:3,title:"保单双录",required:""},{value:o((()=>[n("div",oe,[t(s,{"is-link":"","value-class":""+(d(ve)?"disable":""),value:d(ee)[d($)],onClick:ye},null,8,["value-class","value"])])])),_:1})):j("",!0)]),n("div",ne,[t(r,{type:"primary",onClick:ge},{default:o((()=>[x("下一步")])),_:1})]),t(Q,{type:d(de),show:d(W),data:d(J),onCancel:he,onConfirm:be},null,8,["type","show","data"])])}}});export{de as default};
