var Oe=Object.defineProperty,Se=Object.defineProperties;var Ie=Object.getOwnPropertyDescriptors;var de=Object.getOwnPropertySymbols;var Le=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable;var Be=(E,r,f)=>r in E?Oe(E,r,{enumerable:!0,configurable:!0,writable:!0,value:f}):E[r]=f,h=(E,r)=>{for(var f in r||(r={}))Le.call(r,f)&&Be(E,f,r[f]);if(de)for(var f of de(r))xe.call(r,f)&&Be(E,f,r[f]);return E},L=(E,r)=>Se(E,Ie(r));import{g as be,O as we,a9 as Pe,E as g,d as $e,y as He,h as Ue,r as W,j as d,k as x,m as _,z as l,p as v,J as T,n as D,L as Ce,t as b,A as k,G as M,F as j,a4 as Me,a5 as je,C as P,T as w,D as qe}from"./vendor-af6fda0a.js";import{q as Qe}from"./index-a99815ab.js";import{_ as Ve,S as Ye,L as Ge,M as Je,q as K,l as q,Q as Ee,r as fe,H as ze,n as We,P as Ke,R as X,T as Q,B as _e}from"./index-ff53cb00.js";import{_ as Xe}from"./index-d304b0c4.js";import{f as Ze,s as ve,g as De,a as et}from"./verify-a02fa3aa.js";import{a as tt}from"./order-35b0e3c5.js";import{l as pe,g as ut}from"./inform-be7cdc30.js";const Z=E=>(Me("data-v-3c9ce673"),E=E(),je(),E),st={class:"page-verify"},ot={class:"people"},nt={class:"name"},rt={class:"verify-item"},at=Z(()=>l("div",{class:"label"},"\u8BC1\u4EF6\u53F7\u7801",-1)),it={class:"no"},lt=P(" \u53BB\u8BA4\u8BC1 "),ct={class:"sign-body"},dt={class:"date"},Bt={class:"file"},Ct=P(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A "),Et={class:"people"},ft={class:"name"},_t={class:"verify-item"},vt=Z(()=>l("div",{class:"label"},"\u8BC1\u4EF6\u53F7\u7801",-1)),Dt={class:"no"},pt=["onClick"],Ft=P(" \u53BB\u8BA4\u8BC1 "),At=["onClick"],yt={class:"sign-body"},ht={class:"date"},gt={class:"file"},Tt=P(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A "),mt={class:"footer-button footer"},Nt=Z(()=>l("div",{class:"text"},"\u5237\u65B0",-1)),Rt=P("\u5206\u4EAB"),kt=P("\u63D0\u4EA4"),Ot=be({setup(E){const r={CERT:1,NO_CERT:2},f=we(),Fe=Pe(),{saleUserId:V="D1234567-1",tenantId:p="9991000007",templateId:Ae=1,productCode:ye="CQ75CQ76",insurerCode:Y="ancheng",isShare:G,orderCode:$,orderNo:m,productCategory:ee}=f.query,te=()=>{const u=f.query;return u.orderCode&&(u.orderNo=u.orderCode),u},J=new Ye({source:"localStorage"}),ue=g([]),se=g([]),oe=g([]),ne=g([]),c=g(),O=g(),N=[],S=g(""),H=g(),re=$e().format("YYYY-MM-DD"),he=()=>{var u;(u=O.value)==null||u.clear()},ge=u=>{N[u].clear()},ae=(u,i)=>{let s=window.location.href;s=s.includes("orderCode")?s:s.replace("orderNo","orderCode"),et({callbackUrl:s,certiNo:u,faceAuthMode:"TENCENT",userName:i,tenantId:9991000007}).then(t=>{const{code:B,data:o}=t;if(B==="10000"){const{originalUrl:e,serialNo:n}=o;window.location.href=e,J.set("verifyData",{serialNo:n,certNo:u,name:i})}})},ie=u=>{const{id:i,objectType:s}=u;S.value="",H.value="";const t={1:"pdf",2:"richText",3:"link"};ut({insurerCode:Y,id:i,objectType:s,productCategory:ee,orderNo:m,tenantId:p}).then(({code:B,data:o})=>{B==="10000"&&(console.log(o),(o==null?void 0:o[0].questionType)===2?(S.value="question",H.value=o):((o==null?void 0:o[0].textType)===1&&(o==null?void 0:o[0].content.includes("png"))?S.value="picture":S.value=t[o==null?void 0:o[0].textType],H.value=o==null?void 0:o[0].content))})},I=u=>`${u}`===Je.CERT,le=u=>{var i,s,t,B;u===-1?ae((i=c.value.tenantOrderHolder)==null?void 0:i.certNo,(s=c.value.tenantOrderHolder)==null?void 0:s.name):ae((t=c.value.tenantOrderInsuredList[u])==null?void 0:t.certNo,(B=c.value.tenantOrderInsuredList[u])==null?void 0:B.name)},Te=u=>{u&&N.every(i=>i!==u)&&N.push(u)},me=()=>{var i,s,t,B,o;if((i=O.value)==null?void 0:i.isEmpty()){w.fail("\u8BF7\u6295\u4FDD\u4EBA\u7B7E\u540D");return}if(N.some(e=>e.isEmpty())){w.fail("\u8BF7\u88AB\u4FDD\u4EBA\u7B7E\u540D");return}if(((t=(s=c.value.tenantOrderHolder)==null?void 0:s.extInfo)==null?void 0:t.isCert)!==r.CERT&&I((B=c.value.tenantOrderHolder)==null?void 0:B.certType)){w.fail("\u8BF7\u6295\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}if((o=c.value.tenantOrderInsuredList)==null?void 0:o.some(e=>{var n;return((n=e.extInfo)==null?void 0:n.isCert)!==r.CERT&&I(e.certType)})){w.fail("\u8BF7\u88AB\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}fe({orderNo:$||m,saleUserId:V,tenantId:p}).then(e=>{const{code:n,data:a}=e;n==="10000"&&(a.orderStatus!==tt.PENDING?ze("paymentResult",te()):qe.confirm({title:"\u63D0\u793A",message:"\u8BF7\u786E\u8BA4\u4FE1\u606F\u586B\u5199\u65E0\u8BEF\u540E\uFF0C\u518D\u8FDB\u884C\u652F\u4ED8"}).then(()=>{var F,y;const C=(F=O.value)==null?void 0:F.save();Promise.all([ve("HOLDER",C,(y=c.value)==null?void 0:y.id,`${p}`),...N.map(A=>{var R;return ve("INSURED",A.save(),(R=c.value)==null?void 0:R.id,`${p}`)})]).then(()=>{We(L(h({},c.value),{pageCode:"sign",operateOption:{withSignInfo:!0},extInfo:L(h({},c.value.extInfo),{pageCode:"sign",templateId:Ae,shareFlag:G?"Y":"N"}),venderCode:Y})).then(A=>{const{code:R,data:U}=A;n==="10000"&&U.success&&Fe.push({path:Ke[U.pageAction.data.nextPageCode],query:{orderNo:$||m,saleUserId:V,tenantId:p}})})})}))})},z=(u=!1)=>{fe({orderNo:$||m,saleUserId:V,tenantId:p}).then(i=>{var B,o;const{code:s,data:t}=i;s==="10000"&&(c.value=t,u&&(((o=(B=t==null?void 0:t.tenantOrderHolder)==null?void 0:B.extInfo)==null?void 0:o.isCert)===r.NO_CERT||(t==null?void 0:t.tenantOrderInsuredList.some(e=>{var n;return((n=e.extInfo)==null?void 0:n.isCert)===r.NO_CERT}))?w("\u7528\u6237\u672A\u5B8C\u8EAB\u4EFD\u8BA4\u8BC1\u53CA\u7B7E\u5B57"):(!(t==null?void 0:t.tenantOrderAttachmentList.find(e=>e.category===X.ELECTRIC_SIGN&&e.objectType===Q.HOLDER))||!(t==null?void 0:t.tenantOrderAttachmentList.find(e=>e.category===X.ELECTRIC_SIGN&&e.objectType===Q.INSURED)))&&w("\u7528\u6237\u672A\u5B8C\u8EAB\u4EFD\u8BA4\u8BC1\u53CA\u7B7E\u5B57")),setTimeout(()=>{let e=0;t.tenantOrderAttachmentList.forEach(n=>{n.category===X.ELECTRIC_SIGN&&(n.objectType===Q.HOLDER?(O.value.clear(),O.value.setDataURL(n.fileBase64)):n.objectType===Q.INSURED&&(N[e].clear(),N[e].setDataURL(n.fileBase64),e+=1))})}))})},Ne=()=>{z(!0)},Re=He(()=>{const u=L(h({},te()),{isShare:1,sharePageCode:"sign"});return`${window.location.origin}/phoneVerify?${Qe.stringify(u)}`}),ke=()=>{const u={orderNo:$||m,productCode:ye,tenantId:p,objectType:1},i={insurerCode:Y,orderNo:m,productCategory:ee,tenantId:p,noticeType:4,objectType:1};De(h({},u)).then(({code:s,data:t})=>{s==="10000"&&(se.value=t||[])}),De(L(h({},u),{objectType:2})).then(({code:s,data:t})=>{s==="10000"&&(ue.value=t||[])}),pe(h({},i)).then(({code:s,data:t})=>{s==="10000"&&(ne.value=t||[])}),pe(L(h({},i),{noticeType:5,objectType:2})).then(({code:s,data:t})=>{s==="10000"&&(oe.value=t||[])})};return Ue(()=>{z(),ke();const u=J.get("verifyData");if(u){const{serialNo:i,certNo:s,name:t}=u;Ze({certiNo:s,orderNo:$||m,serialNo:i,tenantId:p,userName:t}).then(B=>{const{code:o,data:e}=B;o==="10000"&&(J.remove("verifyData"),z())})}}),(u,i)=>{const s=W("ProPDFviewer"),t=W("van-button"),B=W("ProPageWrap");return d(),x(B,null,{default:_(()=>{var o;return[l("div",st,[v(Ge,{type:"warning",title:"\u5C0A\u656C\u7684\u5BA2\u6237\uFF0C\u672C\u6B21\u6295\u4FDD\u9700\u8981\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",content:"\u672C\u4EA7\u54C1\u6295\u4FDD\u9700\u8981\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u8FDB\u884C\u5B9E\u540D\u8BA4\u8BC1\uFF0C\u60A8\u8D2D\u4E70\u672C\u4EA7\u54C1\u7684\u7D2F\u8BA1\u603B\u4FDD\u8D39\u5DF2\u8D85\u8FC720\u4E07\uFF0C\u6309\u76D1\u7BA1\u8981\u6C42\uFF0C\u9700\u8981\u63D0\u4F9B\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u3001\u6307\u5B9A\u53D7\u76CA\u4EBA\u8BC1\u4EF6\u5F71\u50CF\uFF0C\u672C\u4EA7\u54C1\u975E\u672C\u4EBA\u6295\u4FDD\u4E14\u5E26\u8EAB\u6545\u8D23\u4EFB\u3001\u9700\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\uFF08\u6210\u4EBA\uFF09\u7684\u6295\u4FDD\u610F\u613F\u8FDB\u884C\u7B7E\u5B57\u786E\u8BA4\u3002"}),v(q,{title:"\u6295\u4FDD\u4EBA",class:"card"},{extra:_(()=>{var e,n,a,C,F,y,A,R,U,ce;return[l("div",ot,[l("div",nt,T((n=(e=c.value)==null?void 0:e.tenantOrderHolder)==null?void 0:n.name),1),I((C=(a=c.value)==null?void 0:a.tenantOrderHolder)==null?void 0:C.certType)?(d(),D("div",{key:0,class:Ce(["status",{verified:((A=(y=(F=c.value)==null?void 0:F.tenantOrderHolder)==null?void 0:y.extInfo)==null?void 0:A.isCert)===r.CERT}])},T(((ce=(U=(R=c.value)==null?void 0:R.tenantOrderHolder)==null?void 0:U.extInfo)==null?void 0:ce.isCert)===r.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)):b("",!0)])]}),default:_(()=>{var e,n,a,C,F,y,A;return[l("div",rt,[at,l("div",it,T((n=(e=c.value)==null?void 0:e.tenantOrderHolder)==null?void 0:n.certNo),1),((F=(C=(a=c.value)==null?void 0:a.tenantOrderHolder)==null?void 0:C.extInfo)==null?void 0:F.isCert)!==r.CERT&&I((A=(y=c.value)==null?void 0:y.tenantOrderHolder)==null?void 0:A.certType)?(d(),D("div",{key:0,class:"action",onClick:i[0]||(i[0]=R=>le(-1))},[lt,v(K,{name:"right_arrow",class:"icon"})])):b("",!0)])]}),_:1}),v(q,{title:"\u6295\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:_(()=>[l("div",{class:"resign",onClick:he},"\u91CD\u7B7E")]),default:_(()=>[v(Ee,{ref_key:"holderSign",ref:O,class:"sign"},null,512),l("div",ct,[l("div",dt,"\u7B7E\u540D\u65E5\u671F\uFF1A "+T(k(re)),1),l("div",Bt,[Ct,(d(!0),D(j,null,M(se.value,(e,n)=>(d(),x(s,{key:`holderFileList-${n}`,class:"file",title:`\u300A${e.materialName}\u300B`,content:e.materialContent,type:k(_e)(e.materialContent,e.materialSource+"")},null,8,["title","content","type"]))),128)),(d(!0),D(j,null,M(ne.value,(e,n)=>(d(),x(s,{key:`holderQuestionList-${n}`,class:"file",title:`\u300A${e.title}\u300B`,content:H.value,type:S.value,onClick:a=>ie(e)},null,8,["title","content","type","onClick"]))),128))])])]),_:1}),(d(!0),D(j,null,M((o=c.value)==null?void 0:o.tenantOrderInsuredList,(e,n)=>(d(),D("div",{key:n},[v(q,{title:"\u88AB\u4FDD\u4EBA",class:"card"},{extra:_(()=>{var a,C;return[l("div",Et,[l("div",ft,T(e.name),1),I(e.certType)?(d(),D("div",{key:0,class:Ce(["status",{verified:((a=e.extInfo)==null?void 0:a.isCert)===r.CERT}])},T(((C=e.extInfo)==null?void 0:C.isCert)===r.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)):b("",!0)])]}),default:_(()=>{var a;return[l("div",_t,[vt,l("div",Dt,T(e.certNo),1),((a=e.extInfo)==null?void 0:a.isCert)!==r.CERT&&I(e.certType)?(d(),D("div",{key:0,class:"action",onClick:C=>le(n)},[Ft,v(K,{name:"right_arrow",class:"icon"})],8,pt)):b("",!0)])]}),_:2},1024),v(q,{title:"\u88AB\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:_(()=>[l("div",{class:"resign",onClick:a=>ge(n)},"\u91CD\u7B7E",8,At)]),default:_(()=>[v(Ee,{ref_for:!0,ref:Te,class:"sign"}),l("div",yt,[l("div",ht,"\u7B7E\u540D\u65E5\u671F\uFF1A "+T(k(re)),1),l("div",gt,[Tt,(d(!0),D(j,null,M(ue.value,(a,C)=>(d(),x(s,{key:`insuredFileList-${C}`,class:"file",title:`\u300A${a.materialName}\u300B`,content:a.materialContent,type:k(_e)(a.materialContent,a.materialSource+"")},null,8,["title","content","type"]))),128)),(d(!0),D(j,null,M(oe.value,(a,C)=>(d(),x(s,{key:`insuredQuestionList-${C}`,class:"file",title:`\u300A${a.title}\u300B`,content:H.value,type:S.value,onClick:F=>ie(a)},null,8,["title","content","type","onClick"]))),128))])])]),_:2},1024)]))),128)),l("div",mt,[k(G)?b("",!0):(d(),D("div",{key:0,class:"refresh-btn",onClick:Ne},[l("div",null,[v(K,{name:"refresh"})]),Nt])),k(G)?b("",!0):(d(),x(Xe,{key:1,title:"\u9080\u8BF7\u60A8\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",desc:"\u9080\u8BF7\u60A8\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",link:k(Re)},{default:_(()=>[v(t,{plain:"",type:"primary",class:"share-btn"},{default:_(()=>[Rt]),_:1})]),_:1},8,["link"])),v(t,{type:"primary",class:"submit-btn",onClick:me},{default:_(()=>[kt]),_:1})])])]}),_:1})}}});var Ht=Ve(Ot,[["__scopeId","data-v-3c9ce673"]]);export{Ht as default};
