import{g as I,k as l,m as p,E as b,y as t,I as c,z as n,d as A,F as L,G as w,H as x,s as k,B as P,a2 as H,a3 as M,a0 as R,C as _,L as W,M as Z,T as O,h as U,j as B,r as S,n as D}from"./vendor-e9263418.js";import{a as K,g as J}from"./visit-bddb9367.js";import{u as j}from"./index-b8742a0a.js";import{_ as Q}from"./plugin-vue_export-helper-46f75680.js";import{_ as X}from"./index-e4c11be9.js";import{_ as Y}from"./index-654379f5.js";const tt=h=>(H("data-v-5067867e"),h=h(),M(),h),et={class:"visitor-page-list-title"},st=["onClick"],at={class:"item-top"},ot={class:"item-right-content"},it={class:"content-top"},nt={class:"top-left"},ut=["src"],lt={class:"name-area"},ct={class:"top"},rt={class:"top-name"},dt={class:"top-check-times"},_t=P(" \u672C\u6B21\u8BBF\u95EE"),vt={key:0,style:{color:"#b39366"}},pt={key:1},ht={key:2,style:{color:"#b39366"}},mt={class:"time"},ft={class:"time-text"},gt=["src"],yt=tt(()=>t("div",{class:"content-mid"},[t("div",{class:"triangle"})],-1)),Ct={class:"content-bottom"},Bt={class:"content-bottom-top"},Dt={class:"title-name"},Et=["src"],Tt=I({props:{visitorList:{type:Array,default:()=>[]}},emits:["onClick"],setup(h,{emit:g}){const{getIconUrl:m}=j(),r=o=>{g("onClick",o)},d=o=>(console.log(o,"typeName"),o==="vcard"?"\u540D\u7247":o==="poster"?"\u6D77\u62A5":o==="activity"?"\u6D3B\u52A8":o==="article"?"\u6587\u7AE0":"");return(o,y)=>(l(!0),p(L,null,b(h.visitorList,(u,E)=>(l(),p("div",{key:E,class:"com-visitor-page-list"},[t("div",et,c(n(A)().diff(n(A)(u.lastVisitContentDate),"day")===0?"\u4ECA\u5929":n(A)().diff(n(A)(u.lastVisitContentDate),"day")===1?"\u6628\u5929":u.lastVisitContentDate||""),1),(l(!0),p(L,null,b(u.list,(e,T)=>(l(),p("div",{key:T,class:"visitor-page-list-item",onClick:a=>r(e)},[t("div",at,[t("div",ot,[t("div",it,[t("div",nt,[t("img",{src:e.wechatImageUrl,alt:"",class:"head-image"},null,8,ut),t("div",lt,[t("div",ct,[t("div",rt,c(e.relatedCustomerId?e.relatedCustomerName:e.wechatNickname),1)]),w(t("div",dt,[_t,t("span",null,c(e.viewTimeStr&&(e.viewTimeStr.indexOf("\u5206")===-1?e.viewTimeStr.split("\u79D2")[0]:e.viewTimeStr.split("\u5206")[0])),1),e.viewTimeStr&&e.viewTimeStr.indexOf("\u5206")!==-1?(l(),p("span",vt,"\u5206")):k("",!0),e.viewTimeStr&&e.viewTimeStr.indexOf("\u5206")!==-1?(l(),p("span",pt,c(e.viewTimeStr&&e.viewTimeStr.indexOf("\u5206")!==-1&&e.viewTimeStr.split("\u5206")[1].split("\u79D2")[0]),1)):k("",!0),e.viewTimeStr&&e.viewTimeStr.indexOf("\u79D2")!==-1?(l(),p("span",ht,"\u79D2")):k("",!0)],512),[[x,e.viewTimeStr]])])]),t("div",mt,[t("div",ft,c(e.lastVisitContentTimeStr),1),t("img",{src:n(m)("article.rightImg"),alt:"",class:"time-right-img"},null,8,gt)])]),yt,t("div",Ct,[t("div",Bt,[t("div",Dt,c(`\u67E5\u770B\u4E86${d(e.lastVisitContentType)}   ${e.lastVisitContentTitle} `),1),t("img",{src:n(m)("visitor.lineImg"),alt:"",class:"right-line"},null,8,Et)])])])])],8,st))),128))]))),128))}});var Vt=Q(Tt,[["__scopeId","data-v-5067867e"]]);const At={class:"visitor-page-top"},St={class:"top-item"},kt=["src"],wt={class:"top-rigth"},xt=t("div",{class:"text"},"\u7D2F\u8BA1\u8BBF\u95EE",-1),$t={class:"number"},Ft={class:"today-add"},Nt=t("div",{class:"line"},null,-1),bt={class:"top-item"},Lt=["src"],Ot={class:"top-rigth"},Ut=t("div",{class:"text"},"\u8D85\u8D8A\u4E86\u7528\u6237",-1),It={class:"number"},Pt=P("\u83B7\u5BA2\u7D20\u6750"),Rt=I({setup(h){const{getIconUrl:g}=j(),m=R(),r=_(!1),d=_(!1),o=_(!1),y=_(!1),u=_(0),E=_(0),e=_("0%"),T=_(0),a=W([]),$=()=>{y.value&&(a.splice(0,a.length),y.value=!1),u.value+=1,u.value===1&&(r.value=!0),J({pageNum:u.value,pageSize:5,queryBean:{}}).then(s=>{console.log(s.data.data,"list");const i=[];s.data.data.list.forEach((v,f)=>{let V=-1;i.some((C,G)=>v.lastVisitContentDate===C.lastVisitContentDate?(V=G,!0):!1)?i[V].list.push(v):i.push({lastVisitContentDate:v.lastVisitContentDate,list:[v]})}),(s.data.data.list.length===0||s.data.data.list===null)&&(o.value=!0),s.data.data.pageNum===1?a.push(...i):i.forEach((v,f)=>{i[f].lastVisitContentDate===a[a.length-1].lastVisitContentDate?a[a.length-1].list=a[a.length-1].list.concat(i[f].list):a.push(i[f])}),d.value=!1,(s.data.data.list.length<5||s.data.data===null)&&(d.value=!1,o.value=!0),r.value=!1,console.log("visitorList===>>",a)}).catch(s=>{console.log(s),O.fail("\u8BBF\u5BA2\u6570\u636E\u67E5\u8BE2\u5931\u8D25"),d.value=!1,r.value=!1,o.value=!0})},F=()=>{o.value=!1,d.value=!0,u.value=0,$()},q=s=>{console.log("fuzujian",s),s.relatedCustomerId?(console.log("\u6211\u5DF2\u7ECF\u5173\u8054\u4E86"),m.push({name:"customerDetail",query:{agentCustomerId:s.relatedCustomerId,customerType:s.relatedCustomerType},hash:"#1"})):(console.log("\u6211\u6CA1\u6709\u5173\u8054\u4E86"),m.push({path:"/visitorDetail",query:{shareId:s.shareId,tenantId:s.tenantId,visitId:s.id}}))},z=()=>{m.push("/article")};return Z(()=>{K({}).then(s=>{console.log(s.data.data,"\u5206\u6790\u8BBF\u5BA2"),E.value=s.data.data.totalVisitor||0,e.value=s.data.data.visitorPercent||"0%",T.value=s.data.data.dailyVisitor||0}).catch(s=>{console.log(s),O.fail("\u5206\u6790\u8BBF\u5BA2\u6570\u636E\u67E5\u8BE2\u5931\u8D25")}),a.splice(0,a.length),F()}),(s,i)=>{const v=S("van-list"),f=S("van-pull-refresh"),V=S("van-button"),N=S("ZaPageWrap");return l(),U(N,{id:"outer","main-class":"page-visitors"},{default:B(()=>[t("div",At,[t("div",St,[t("img",{src:n(g)("visitor.bookImg"),alt:"",class:"top-img"},null,8,kt),t("div",wt,[xt,t("div",$t,c(E.value),1),t("div",Ft,[t("span",null,c(`+${T.value}`),1)])])]),Nt,t("div",bt,[t("img",{src:n(g)("visitor.peopleImg"),alt:"",class:"top-img"},null,8,Lt),t("div",Ot,[Ut,t("div",It,c(e.value),1)])])]),w(D(f,{modelValue:y.value,"onUpdate:modelValue":i[1]||(i[1]=C=>y.value=C),onRefresh:F},{default:B(()=>[D(v,{loading:d.value,"onUpdate:loading":i[0]||(i[0]=C=>d.value=C),finished:o.value,"finished-text":"\u6CA1\u6709\u66F4\u591A\u4E86",onLoad:$},{default:B(()=>[D(Vt,{"visitor-list":n(a),onOnClick:q},null,8,["visitor-list"])]),_:1},8,["loading","finished"])]),_:1},8,["modelValue"]),[[x,n(a).length!==0&&!r.value]]),r.value?(l(),U(Y,{key:0,vertical:!0})):k("",!0),w(D(X,{"empty-class":"empty-area",title:"\u6682\u65E0\u8BBF\u5BA2",desc:"\u60A8\u8FD8\u6CA1\u6709\u8BBF\u5BA2\uFF0C\u5148\u6765\u5206\u4EAB\u4E00\u4E2A\u83B7\u5BA2\u7D20\u6750\u5427~","empty-img":n(g)("visitor.emptyImg")},{emptyBtn:B(()=>[D(V,{round:"",type:"primary",class:"empty-btn",onClick:z},{default:B(()=>[Pt]),_:1})]),_:1},8,["empty-img"]),[[x,n(a).length===0&&!r.value]])]),_:1})}}});export{Rt as default};
