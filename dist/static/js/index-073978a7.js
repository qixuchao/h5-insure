var j=Object.defineProperty,G=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var U=(l,o,n)=>o in l?j(l,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[o]=n,A=(l,o)=>{for(var n in o||(o={}))J.call(o,n)&&U(l,n,o[n]);if(M)for(var n of M(o))K.call(o,n)&&U(l,n,o[n]);return l},L=(l,o)=>G(l,z(o));import{g as S,E as g,M as P,_ as W,r as h,j as B,k as D,m as V,p as I,A as s,z as f,J as X,L as q,T as x,O as Y,a9 as Q,h as Z,n as ee,G as te,F as ae,C as oe}from"./vendor-06835924.js";import{R as ne}from"./infoCollection-b0426750.js";import{s as se,c as ue}from"./phoneVerify-e68b7acd.js";import{v as H,a as R,b as re}from"./validator-ebd71d12.js";import{F as w,g as le}from"./utils-c553f170.js";import{G as ie}from"./index-0a41d5e9.js";import{g as ce,m as me,i as de}from"./trial-cd591d1b.js";import{p as fe}from"./product-f3899646.js";import{t as pe}from"./theme-eeb93d73.js";import"./trial-030094db.js";const ve=S({props:{isCheck:{type:Boolean,default:!1},userInfo:{type:Object,default:()=>{}}},emits:["on-verify"],setup(l,{emit:o}){var N;const n=l,r=g({}),i=g(!1),E=30,c=g(0),C=g("\u83B7\u53D6\u9A8C\u8BC1\u7801"),u=P({mobile:(N=n.userInfo)==null?void 0:N.mobile,smsCode:""}),v=a=>H(a)?!0:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7",e=a=>R(a)?!0:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u9A8C\u8BC1\u7801",b=()=>{if(c.value>0)return;c.value=E;const a=()=>{C.value=`${c.value}s`,c.value-=1};a();const t=setInterval(()=>{c.value===0?(C.value="\u83B7\u53D6\u9A8C\u8BC1\u7801",c.value=0,clearInterval(t)):a()},1e3)},y=async()=>{c.value>0||r==null||r.value.validate("mobile").then(async()=>{const a=await se(u.mobile),{code:t,data:m}=a;t==="10000"&&(i.value=!0,x({message:"\u77ED\u4FE1\u53D1\u9001\u6210\u529F\uFF0C\u8BF7\u67E5\u6536"}),b())})},F=async()=>{const a=await ue(u.mobile,u.smsCode),{data:t}=a;t&&o("on-verify",u)},O=async()=>{r==null||r.value.validate().then(async()=>{F()})};return W(()=>u,()=>{H(u.mobile)&&R(u.smsCode)&&i.value&&F()},{deep:!0,immediate:!0}),(a,t)=>{const m=h("van-field"),p=h("van-cell-group"),_=h("VanForm");return B(),D(_,{ref_key:"formRef",ref:r,"label-width":"80"},{default:V(()=>[I(p,null,{default:V(()=>[I(m,{modelValue:s(u).mobile,"onUpdate:modelValue":t[0]||(t[0]=d=>s(u).mobile=d),name:"mobile",label:"\u624B\u673A\u53F7",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",maxlength:s(w).MOBILE,rules:[{validator:v}]},null,8,["modelValue","maxlength","rules"]),I(m,{modelValue:s(u).smsCode,"onUpdate:modelValue":t[1]||(t[1]=d=>s(u).smsCode=d),name:"smsCode",label:"\u9A8C\u8BC1\u7801",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",maxlength:s(w).SMS_CODE,rules:[{validator:e}]},{button:V(()=>[f("div",{class:q(["sms-code",{"count-down":c.value>0}]),onClick:y},X(C.value),3)]),_:1},8,["modelValue","maxlength","rules"])]),_:1}),f("div",{class:q([{"check-submit":n.isCheck},{submit:!n.isCheck}]),onClick:O},null,2)]),_:1},512)}}}),_e=S({props:{userInfo:{type:Object,default:()=>{}}},emits:["on-submit"],setup(l,{emit:o}){const n=l,r=g({}),i=P({name:n.userInfo.name,certNo:n.userInfo.certNo}),E=u=>ie(i.certNo)?!0:"\u8BF7\u586B\u5199\u6B63\u786E\u7684\u8BC1\u4EF6\u53F7",c=u=>re(u)?!0:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u59D3\u540D",C=()=>{r==null||r.value.validate().then(async u=>{o("on-submit",i)})};return(u,v)=>{const e=h("van-field"),b=h("van-cell-group"),y=h("VanForm");return B(),D(y,{ref_key:"formRef",ref:r,"label-width":"80"},{default:V(()=>[I(b,null,{default:V(()=>[I(e,{modelValue:s(i).name,"onUpdate:modelValue":v[0]||(v[0]=F=>s(i).name=F),name:"name",label:"\u59D3\u540D",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D",maxlength:s(w).NAME,rules:[{validator:c}]},null,8,["modelValue","maxlength","rules"]),I(e,{modelValue:s(i).certNo,"onUpdate:modelValue":v[1]||(v[1]=F=>s(i).certNo=F),name:"certNo",label:"\u8EAB\u4EFD\u8BC1",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u8EAB\u4EFD\u8BC1\u53F7",maxlength:s(w).ID_CARD,rules:[{validator:E}]},null,8,["modelValue","maxlength","rules"])]),_:1}),f("div",{class:"submit",onClick:C})]),_:1},512)}}});var he="/static/assets/title-step1.97cb9efa.png",Ce="/static/assets/title-step2.258af5e9.png";const be={class:"page-activity-invite"},Fe=["src"],ge={class:"container"},Be={class:"main-form"},Ie={class:"title"},ye=["src"],De={class:"agree"},Ve={class:"check-wrap"},Ee=oe(" \u6211\u5DF2\u9605\u8BFB\u5E76\u540C\u610F "),Ue=S({setup(l){const o=Y(),n=Q(),{productCode:r="7X9",tenantId:i="",phoneNo:E,saleChannelId:c,agentCode:C="",paymentMethod:u}=o.query,v=g(!0),e=P({title:he,attachmentList:[{attachmentName:"",attachmentUri:""}],userInfo:{mobile:E,certNo:"",name:""},agree:!1}),b=g(),y=g(),F=async a=>{var _,d;e.userInfo.mobile=a.mobile;const t=await ce({holderPhone:e.userInfo.mobile,productCode:r,tenantId:i}),{code:m,data:p}=t;m==="10000"&&(e.userInfo.name=(_=p.tenantOrderHolder)==null?void 0:_.name,e.userInfo.certNo=(d=p.tenantOrderHolder)==null?void 0:d.certNo),e.title=Ce,v.value=!1},O=async a=>{if(!e.agree){x("\u8BF7\u52FE\u9009\u534F\u8BAE");return}try{x({message:"\u9886\u53D6\u4E2D...",forbidClick:!0,loadingType:"spinner"}),e.userInfo.certNo=a.certNo,e.userInfo.name=a.name;const t=le({tenantId:i,detail:b.value,insureDetail:y.value,saleChannelId:c,saleUserId:C,holder:e.userInfo,insured:L(A({},e.userInfo),{relationToHolder:ne.SELF}),paymentMethod:u,renewalDK:"",successJumpUrl:"",premium:0,orderStatus:"",orderTopStatus:"",tenantOrderRiskList:[]}),m=await me(t),{code:p}=m;p==="10000"&&n.push({path:"/chuangxin/baigebao/productDetail",query:L(A({},o.query),{tenantId:i,phoneNo:e.userInfo.mobile,certNo:e.userInfo.certNo,name:e.userInfo.name,productCode:"BWYL2021",agentCode:C})})}catch(t){console.log(t),x.clear()}},N=async()=>{const a=fe({productCode:r,withInsureInfo:!0,tenantId:i}),t=de({productCode:r});Promise.all([a,t]).then(([m,p])=>{var _,d;m.code==="10000"&&(b.value=m.data,e.attachmentList=((d=(_=b.value)==null?void 0:_.tenantProductInsureVO)==null?void 0:d.attachmentVOList)||[]),p.code==="10000"&&(y.value=p.data)})};return Z(()=>{N()}),(a,t)=>{const m=h("van-checkbox"),p=h("ProPDFviewer"),_=h("van-config-provider");return B(),D(_,{"theme-vars":s(pe)},{default:V(()=>{var d,T;return[f("div",be,[f("img",{src:(T=(d=b.value)==null?void 0:d.tenantProductInsureVO)==null?void 0:T.banner[0],class:"banner"},null,8,Fe),f("div",ge,[f("div",Be,[f("div",Ie,[f("img",{src:s(e).title},null,8,ye)]),v.value?(B(),D(ve,{key:0,"is-check":a.isCheck,"user-info":s(e).userInfo,onOnVerify:F},null,8,["is-check","user-info"])):(B(),D(_e,{key:1,"user-info":s(e).userInfo,onOnSubmit:O},null,8,["user-info"])),f("div",De,[f("div",Ve,[I(m,{modelValue:s(e).agree,"onUpdate:modelValue":t[0]||(t[0]=k=>s(e).agree=k),name:"agree",shape:"square"},null,8,["modelValue"])]),f("div",null,[Ee,(B(!0),ee(ae,null,te(s(e).attachmentList||[],(k,$)=>(B(),D(p,{key:$,class:"file-name",title:`\u300A${k.attachmentName}\u300B`,content:k.attachmentUri,type:"pdf"},null,8,["title","content"]))),128))])])])])])]}),_:1},8,["theme-vars"])}}});export{Ue as default};
