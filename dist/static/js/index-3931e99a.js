import{d as e,j as i,r as n,z as r,aK as o,o as a,m as s,w as l,g as t,u as d,bj as u,bk as c,_ as m,bl as p,bm as f,bn as g,bo as v,T as y,bp as V,ap as O,aM as h,ai as b,bq as T,a6 as I,k as S,aO as L,br as C,bg as x,bs as w,c as k,b as j,f as F,F as N,q as H,a8 as E,aN as $,bt as B,af as _,bu as J,i as P,ad as M,bv as A,bw as R,bx as U,a0 as Y,a as q,a9 as D,bd as z,bi as K,by as G,bz as Q}from"./index-bc4609b3.js";import{c as W}from"./cloneDeep-34845b0f.js";import"./PolicyInfo-8ab2b82e.js";import{l as X}from"./lodash-56b81632.js";import{B as Z}from"./infoCollection-9f721879.js";import{O as ee}from"./questionnaire-42dcb602.js";import{s as ie,g as ne,a as re,c as oe,b as ae,t as se,i as le}from"./util-ec12770b.js";const te=e({name:"BeneficiaryItem"});var de=m(e({...te,props:{modelValue:{default:()=>({})},schema:{default:()=>[]},config:{default:()=>({})},isView:{type:Boolean,default:!1},isTrial:{type:Boolean,default:!1},title:{default:"受益人"},holderPersonVO:{default:()=>({})}},emits:["update:modelValue","trailChange"],setup(e,{expose:m,emit:S}){const L=e,C=i(null),x=n({validated:!1,schema:[],config:{},personVO:{}});r((()=>L.config),(e=>{e&&Object.assign(x.config,e)}),{deep:!0,immediate:!0}),r((()=>L.schema),(e=>{e&&(g(L.schema,L.modelValue,(()=>{x.personVO.certType="1"})),Object.assign(x.schema,W(L.schema)))}),{deep:!0,immediate:!0}),r((()=>W(L.modelValue)),((e,i)=>{JSON.stringify(e)!==JSON.stringify(i)&&(v("受益人数据变动了"),Object.assign(x.personVO,e),g(L.schema,L.modelValue,(()=>{Object.assign(x.personVO,{certType:"1"})})))}),{deep:!0,immediate:!0}),r((()=>x.personVO),(e=>{e&&(`${x.personVO.isHolder}`!=`${I.YES}`&&(Object.keys(x.personVO).filter((e=>{var i,n;return!(!["gender","birthday","certType","certNo","name"].includes(e)||!x.personVO[e]||`${null==(i=x.personVO)?void 0:i[e]}`!=`${null==(n=null==L?void 0:L.holderPersonVO)?void 0:n[e]}`)}))||[]).length>=2&&y("录入的受益人同投保人基本信息，请勾选“同投保人"),S("update:modelValue",e))}),{deep:!0,immediate:!0});return r((()=>L.holderPersonVO),o((e=>{(e=>{var i,n;const r={};(null==(i=x.personVO)?void 0:i.age)&&(null==(n=x.personVO)?void 0:n.age)<18&&(x.schema.find((e=>"mobile"===e.name))&&(r.mobile=(null==e?void 0:e.mobile)||""),x.schema.find((e=>"annuallyComeList"===e.name))&&(r.annuallyComeList=["7"],r.annuallyComeDesc="无")),Object.assign(x.personVO,r)})(e)}),300),{deep:!0,immediate:!0}),r((()=>{var e;return null==(e=x.personVO)?void 0:e.relationToInsured}),((e,i)=>{if(e===i)return!1;v("受益人与被保人关系变动了");const{certType:n}=x.personVO||{},[r,o]=V(x.schema,{certType:n,relationToHolder:e}),a={gender:{...o.gender,isView:L.isView}};if(!L.isView&&e!==i&&i){let i=null;"3"==`${e}`&&(a.gender.isView=!0,i=O.FEMALE),"2"==`${e}`&&(a.gender.isView=!0,i=O.MALE),Object.assign(x.personVO,{...h(x.personVO,(e=>!(r&&"certType"===e))),gender:i,relationToInsured:e})}return b(x.config,o,a),!1}),{immediate:!0}),r((()=>{var e;return null==(e=x.personVO)?void 0:e.nationalityCode}),((e,i)=>{e!==i&&b(x.config,T(x.personVO))}),{immediate:!0}),m({validate:e=>f(C,L.trialFactorCodes,e),validateTrialFields:()=>p({personVO:x.personVO,trialFactorCodes:L.trialFactorCodes})}),(e,i)=>(a(),s(d(c),{ref_key:"formRef",ref:C,class:"personal-info-card",title:e.title,model:d(x).personVO,schema:d(x).schema,config:d(x).config,"is-view":e.isView,"extra-provision":{objectType:d(u).BENEFICIARY,objectId:d(x).personVO.id}},{cardTitleExtra:l((()=>[t(e.$slots,"default",{},void 0,!0)])),"header-item":l((()=>[t(e.$slots,"header-item",{},void 0,!0)])),customer:l((()=>[t(e.$slots,"customer",{},void 0,!0)])),_:3},8,["title","model","schema","config","is-view","extra-provision"]))}}),[["__scopeId","data-v-43de123e"]]);const ue=["onClick"],ce=e({name:"InsuredItem"});var me=m(e({...ce,props:{modelValue:{default:()=>({})},title:{default:""},holderPersonVO:{default:()=>({})},schema:{default:()=>[]},config:{default:()=>({})},isView:{type:Boolean,default:!1},isTrial:{type:Boolean,default:!1},trialFactorCodes:{default:()=>[]},multiBeneficiaryMaxNum:{default:null},beneficiaryList:{default:()=>[]},beneficiarySchema:{default:()=>[]},guardian:{default:()=>({})},guardianSchema:{default:()=>[]}},emits:["update:modelValue","update:beneficiaryList","update:guardian"],setup(e,{expose:o,emit:m}){const J=e,P=i(null),M=i(null),A=i(null),R=i(null),U={schema:[],trialFactorCodes:[],config:{occupationCode:{isView:!0}},personVO:{}},Y=n({validated:!1,schema:[],config:{},personVO:{},beneficiaryTypeSchemaList:[],beneficiarySchemaList:[],beneficiaryList:[],guardianSchema:[],guardian:{personVO:{},config:{}}}),q=i(!1),D=S((()=>{const{age:e,relationToHolder:i}=Y.personVO;return!["1","4","5"].includes(`${i}`)&&null!==e&&+e<18||(Y.guardian={personVO:{},config:{}},!1)})),z=()=>{const e={};return Y.beneficiarySchemaList.reduce(((e,i)=>{var n,r;return(null==(n=J.holderPersonVO)?void 0:n[i.name])&&(e[i.name]=null==(r=J.holderPersonVO)?void 0:r[i.name]),e}),e),e},K=(e={})=>{const i=e;return Y.beneficiarySchemaList.reduce(((e,i)=>{var n;return(null==(n=J.holderPersonVO)?void 0:n[i.name])&&(e[i.name]=null),e}),i),i},G=()=>{Y.beneficiaryList.push(W({...U,nanoid:C(),schema:J.beneficiarySchema}))},Q=S((()=>!J.multiBeneficiaryMaxNum||Y.beneficiaryList.length<J.multiBeneficiaryMaxNum)),ie=S((()=>!Y.schema.filter((e=>{var i;return!(e.hidden||(null==(i=Y.config[e.name])?void 0:i.hidden))})).length)),ne=S((()=>Y.schema.filter((e=>e.isSelfInsuredNeed)).map((e=>e.name)))),re=S((()=>L(J.beneficiarySchema))),oe=S((()=>{var e;return String(null==(e=Y.personVO)?void 0:e.insuredBeneficiaryType)===Z.SPECIFY})),ae=i(!0);return r((()=>J.holderPersonVO),X.exports.debounce((e=>{var i;v("------投保人信息变动了-----");const{id:n,...r}=e||{};if("1"===String(null==(i=Y.personVO)?void 0:i.relationToHolder)){q.value=!0,Y.beneficiaryList=Y.beneficiaryList.map(((e,i)=>{var n,r;return`${e.personVO.isHolder}`==`${I.YES}`?{...e,personVO:{...K(null==(r=null==(n=Y.beneficiaryList)?void 0:n[i])?void 0:r.personVO),isHolder:2}}:e}));const e=L(ne.value)?Object.keys(r).reduce(((e,i)=>([...ne.value,"occupationClass"].includes(i)&&!["birthday","age","gender"].includes(i)||(e[i]=r[i]),e)),{}):r,i=(r.certImage||[]).map((e=>(delete e.id,{...e,objectId:Y.personVO.id,objectType:ee.INSURED})));Object.assign(Y.personVO,e,{certImage:i})}else((e,i)=>{if(!ae.value)return;const n={};(null==i?void 0:i.age)&&(+i.age||0)<18&&(Y.schema.find((e=>"mobile"===e.name))&&(n.mobile=(null==e?void 0:e.mobile)||""),Y.schema.find((e=>"personalAnnualIncome"===e.name))&&(Y.personVO.personalAnnualIncome="0"),Y.schema.find((e=>"annuallyComeList"===e.name))&&(n.annuallyComeList=["7"],n.annuallyComeDesc="无")),ae.value=!1,Object.assign(Y.personVO,n)})(e,Y.personVO),q.value=!1}),300),{deep:!0,immediate:!0}),r([()=>{var e;return null==(e=J.holderPersonVO)?void 0:e.familyAnnualIncome},()=>{var e;return null==(e=Y.personVO)?void 0:e.familyAnnualIncome}],X.exports.debounce((([e,i],[n,r])=>{(e!==n&&(+e).toFixed().length>5||i!==r&&(+i).toFixed().length>5)&&y("请核实年收入是否准确")}),300)),r((()=>J.beneficiarySchema),(e=>{Y.beneficiarySchemaList=L(e)?e.filter((e=>"insuredBeneficiaryType"!==e.name)):[],Y.beneficiaryTypeSchemaList=L(e)?e.filter((e=>"insuredBeneficiaryType"===e.name)):[]}),{deep:!0,immediate:!0}),r((()=>J.guardianSchema),(e=>{Y.guardianSchema=e}),{deep:!0,immediate:!0}),r(oe,((e,i)=>{String(e)!==String(i)&&(v("受益人类型关系变动了"),e?(Y.beneficiaryList=L(J.beneficiaryList)?J.beneficiaryList.map((e=>({...e,nanoid:e.nanoid||C()}))):[],!L(Y.beneficiaryList)&&G()):Y.beneficiaryList=[])}),{immediate:!0}),r((()=>W(Y.beneficiaryList).map((e=>({personVO:null==e?void 0:e.personVO,nanoid:e.nanoid})))),((e,i)=>{JSON.stringify(e)!==JSON.stringify(i)&&m("update:beneficiaryList",e)}),{deep:!0,immediate:!0}),r((()=>Y.guardian),(e=>{m("update:guardian",e)}),{deep:!0,immediate:!0}),r((()=>{var e;return null==(e=Y.personVO)?void 0:e.relationToHolder}),((e,i)=>{if(!e)return;v("与投保人关系变动了");const{personVO:n,schema:r=[],config:o}=Y||{},{id:a,...s}=J.holderPersonVO||{},l="1"===String(n.relationToHolder);if(r.forEach((e=>{e.relationToHolder=n.relationToHolder,e.hidden=!e.isSelfInsuredNeed&&l})),!J.isView&&i&&String(e)!==String(i)){let e={...n,...s};const[i,a]=V(r,n);l||(e={...h(n,(e=>!(i&&"certType"===e))),relationToHolder:n.relationToHolder});const t={gender:{...o.gender,isView:J.isView}};"2"==`${n.relationToHolder}`&&(t.gender.isView=!0,e.gender=O.FEMALE),"3"==`${n.relationToHolder}`&&(t.gender.isView=!0,e.gender=O.MALE),b(o,t),Object.assign(Y.personVO,e)}const[t,d]=V(r,n);b(o,d)}),{deep:!0}),r((()=>{var e;return null==(e=Y.personVO)?void 0:e.nationalityCode}),((e,i)=>{e!==i&&b(Y.config,T(Y.personVO))}),{immediate:!0}),r((()=>{var e;return null==(e=Y.guardian.personVO)?void 0:e.nationalityCode}),((e,i)=>{var n;e!==i&&b(Y.guardian.config,T(null==(n=Y.guardian)?void 0:n.personVO))}),{immediate:!0}),r((()=>{var e,i;return null==(i=null==(e=Y.guardian)?void 0:e.personVO)?void 0:i.relationToInsured}),((e,i)=>{if(e===i)return;v("监护人与被保人关系变动了");const{certType:n}=Y.guardian.personVO||{},[r,o]=V(Y.guardianSchema,{certType:n,relationToInsured:e}),a={gender:{...o.gender,isView:J.isView}};if(!J.isView&&e!==i){let n=null;"2"==`${e}`&&(a.gender.isView=!0,n=O.FEMALE),"3"==`${e}`&&(a.gender.isView=!0,n=O.MALE),i&&Object.assign(Y.guardian.personVO,{...h(Y.guardian.personVO,(e=>!(r&&"certType"===e))),gender:n,relationToInsured:e})}b(Y.guardian.config,o,a)}),{immediate:!0}),r((()=>{var e;return null==(e=Y.personVO)?void 0:e.relationToMainInsured}),((e,i)=>{if(!e)return;v("次被保人与主被保人关系变动了");const{personVO:n,schema:r=[],config:o}=Y||{},{certType:a}=n||{},[s,l]=V(r,{certType:a,relationToHolder:e});b(o,l),!J.isView&&i&&String(e)!==String(i)&&Object.assign(Y.personVO,{...h(n,(e=>!(s&&"certType"===e))),relationToMainInsured:n.relationToMainInsured})})),r((()=>J.config),(e=>{e&&Object.assign(Y.config,e)}),{deep:!0,immediate:!0}),r((()=>J.schema),((e,i)=>{var n;if(e&&JSON.stringify(e)!==JSON.stringify(Y.schema)){const i="1"===String(null==(n=J.modelValue)?void 0:n.relationToHolder);Y.schema=W(e).map((e=>{var n;return g(J.schema,J.modelValue,(()=>{Y.personVO.certType="1"})),e.relationToHolder=null==(n=J.modelValue)?void 0:n.relationToHolder,e.hidden=!e.isSelfInsuredNeed&&i,e}))}}),{deep:!0,immediate:!0}),r((()=>W(J.modelValue)),((e,i)=>{if(JSON.stringify(e)!==JSON.stringify(i)){const{beneficiaryList:n,...r}=e;e.age!==(null==i?void 0:i.age)&&e.age&&(ae.value=!0),b(Y.personVO,r),g(J.schema,J.modelValue,(()=>{Y.personVO.certType="1"}))}}),{deep:!0,immediate:!0}),r((()=>W(J.beneficiaryList)),X.exports.debounce(((e,i)=>{JSON.stringify(e)!==JSON.stringify(i)&&(Y.beneficiaryList=L(e)?e.map((e=>({...e,nanoid:e.nanoid||C()}))):[])}),500),{deep:!0,immediate:!0}),r((()=>{var e;return null==(e=J.guardian)?void 0:e.personVO}),((e,i)=>{console.log("value",e),JSON.stringify(e)!==JSON.stringify(i)&&Object.assign(Y.guardian.personVO,e)}),{deep:!0,immediate:!0}),r((()=>Y.personVO),(e=>{e&&m("update:modelValue",e)}),{deep:!0,immediate:!0}),o({validate:e=>{var i;return Promise.all([f(P,J.trialFactorCodes,e),f(R,[],e),f(M,[],e),...(null==(i=A.value)?void 0:i.map((i=>i.validate(e))))||[]])},validateTrialFields:()=>p({personVO:Y.personVO,trialFactorCodes:J.trialFactorCodes})}),(e,i)=>{var n,r;const o=x,m=B,p=_,f=w;return a(),k(N,null,[j(d(c),{ref_key:"insuredFormRef",ref:P,class:"personal-info-card",title:d(ie)?"":e.title,model:d(Y).personVO,schema:d(Y).schema,config:d(Y).config,"is-view":e.isView,"extra-provision":{objectType:d(u).INSURED,objectId:d(Y).personVO.id}},{cardTitleExtra:l((()=>[t(e.$slots,"default",{},void 0,!0)])),customer:l((()=>[t(e.$slots,"customer",{},void 0,!0)])),_:3},8,["title","model","schema","config","is-view","extra-provision"]),d(D)?(a(),s(d(c),{key:0,ref_key:"guardianFormRef",ref:R,class:"personal-info-card",title:"监护人",model:d(Y).guardian.personVO,schema:d(Y).guardianSchema,config:d(Y).config,"is-view":e.isView,"extra-provision":{objectType:d(u).GUARDIAN,objectId:null==(r=null==(n=d(Y).guardian)?void 0:n.personVO)?void 0:r.id}},{cardTitleExtra:l((()=>[t(e.$slots,"default",{},void 0,!0)])),customer:l((()=>[t(e.$slots,"guardianCustomer",{},void 0,!0)])),_:3},8,["model","schema","config","is-view","extra-provision"])):F("",!0),d(re)?(a(),k(N,{key:1},[j(d(c),{ref_key:"beneficiaryTypeFormRef",ref:M,class:"personal-info-card",title:"受益人",model:d(Y).personVO,schema:d(Y).beneficiaryTypeSchemaList,"is-view":e.isView},null,8,["model","schema","is-view"]),d(oe)?(a(),k(N,{key:0},[(a(!0),k(N,null,H(d(Y).beneficiaryList,((i,n)=>{var r,c;return a(),s(de,{ref_for:!0,ref_key:"beneficiaryFormRef",ref:A,key:`${i.nanoid}_${n}`,modelValue:i.personVO,"onUpdate:modelValue":e=>i.personVO=e,title:`受益人${n+1}`,schema:d(Y).beneficiarySchemaList,config:i.config,"holder-person-v-o":e.holderPersonVO,"is-view":e.isView||(null==(r=i.personVO)?void 0:r.isHolder)===d(I).YES,"extra-provision":{objectType:d(u).BENEFICIARY,objectId:null==(c=null==i?void 0:i.personVO)?void 0:c.id}},{customer:l((()=>{var r;return[e.isView||(null==(r=i.personVO)?void 0:r.isHolder)===d(I).YES?F("",!0):t(e.$slots,"benefitCustomer",{key:0,index:n},void 0,!0)]})),"header-item":l((()=>[d(q)?F("",!0):(a(),s(m,{key:0,label:"是否同投保人","input-align":"right"},{input:l((()=>[j(o,{modelValue:i.personVO.isHolder,"onUpdate:modelValue":e=>i.personVO.isHolder=e,"active-value":1,"inactive-value":2,onClick:()=>(e=>{var i,n,r,o;null==(i=Y.beneficiaryList)||i[e],`${null==(o=null==(r=null==(n=Y.beneficiaryList)?void 0:n[e])?void 0:r.personVO)?void 0:o.isHolder}`==`${I.YES}`?J.holderPersonVO&&(Y.beneficiaryList=Y.beneficiaryList.map(((i,n)=>{var r;if(e===n){const e={...null==i?void 0:i.personVO,...z()};return(null==(r=null==e?void 0:e.certImage)?void 0:r.length)&&(e.certImage=null==e?void 0:e.certImage.map((i=>(delete i.id,{...i,objectId:e.id,objectType:u.BENEFICIARY})))),console.log("beneficiaryPersonVO",e),{...i,personVO:e,config:{...i.config,benefitRate:{isView:!1},benefitOrder:{isView:!1},relationToInsured:{isView:!1},beneficiaryType:{isView:!1}}}}return i}))):Y.beneficiaryList=Y.beneficiaryList.map(((i,n)=>{var r,o;return e===n?{...i,personVO:{...K(null==(o=null==(r=Y.beneficiaryList)?void 0:r[e])?void 0:o.personVO)}}:i}))})(n)},{default:l((()=>[E("同投保人")])),_:2},1032,["modelValue","onUpdate:modelValue","onClick"])])),_:2},1024))])),default:l((()=>[n>0&&!e.isView?(a(),k("span",{key:0,class:"delete-button",onClick:e=>(e=>{$.confirm({message:"确定要删除该受益人吗？"}).then((()=>{Y.beneficiaryList.splice(e,1)}))})(n)},[j(p,{name:"delete"})],8,ue)):F("",!0)])),_:2},1032,["modelValue","onUpdate:modelValue","title","schema","config","holder-person-v-o","is-view","extra-provision"])})),128)),!e.isView&&d(Q)?(a(),k("span",{key:0,class:"add-button",onClick:G},[j(f,{name:"plus"}),E("添加受益人")])):F("",!0)],64)):F("",!0)],64)):F("",!0),t(e.$slots,"riskList",{},void 0,!0)],64)}}}),[["__scopeId","data-v-8eda792a"]]);const pe=["onClick"],fe=["onClick"],ge=["onClick"],ve=["onClick"],ye=e({name:"PersonalInfo"});var Ve=m(e({...ye,props:{productFactor:{default:()=>({})},modelValue:{default:()=>({})},isTrial:{type:Boolean,default:!1},isView:{type:Boolean,default:!1},isOnlyHolder:{type:Boolean,default:!1},isHolderExempt:{type:Boolean,default:!1},multiInsuredConfig:{}},emits:["update:modelValue","trailChange","trailValidateFailed","closeCustomerPopoup","update-bank"],setup(e,{expose:m,emit:O}){const h=e,{x:I,y:x}=J(),B=P(),X=M(),{isShare:Z,saleChannelId:ee}=B.query,te=i(null),de=i(null),ue=n({count:0,slotProps:{},uniqKey:"",currentIndex:0,currentBenifitIndex:0,currentType:"",keyword:void 0,show:!1,list:[],config:{},trialValidated:!1,holder:{personVO:{},schema:[],trialFactorCodes:[],config:{occupationCode:{isView:!0}}},beneficiarySchema:[],initInsuredIList:[],insured:[]}),ce=S((()=>!h.isTrial||h.isHolderExempt)),ye=e=>{Object.assign(ue.holder.personVO,e)},Ve=S((()=>!(Z||h.isView||h.isTrial||X))),Oe=(e,i,n,r)=>{ue.currentType=e,"benifit"!==e?ue.currentIndex=i:(ue.currentIndex=i,ue.currentBenifitIndex=n);const{selectedType:o,customerId:a,selected:s,...l}=B.query;console.log("选择的关系relation:",r),D("customerList",{...l,selectedType:e,relation:r})},he=e=>{var i,n,r,o,a,s,l,t,d,u;const c="holder"===ue.currentType?ue.holder.schema.map((e=>e.name))||[]:"insured"===ue.currentType?ue.insured[ue.currentIndex].schema.map((e=>e.name))||[]:"benifit"===ue.currentType?ue.beneficiarySchema.map((e=>e.name))||[]:"guardian"===ue.currentType&&ue.guardianSchema.map((e=>e.name))||[];c.push("certEndType","age","gender");const m=se(e,c);if(console.log(ue.currentType,"的keys:",c,"转换后的客户信息:",m),"holder"===ue.currentType)console.log("当前是投保人选信息state?.holder:",null==ue?void 0:ue.holder),Object.assign(null==(i=null==ue?void 0:ue.holder)?void 0:i.personVO,m),O("update-bank",e.bankCardInfo);else if("insured"===ue.currentType){const e=null==(n=null==ue?void 0:ue.insured[ue.currentIndex])?void 0:n.schema.some((e=>"relationToHolder"===e.name&&e.attributeValueList.some((e=>"1"===e.code))));if(le(null==(r=null==ue?void 0:ue.holder)?void 0:r.personVO,m))return e?void Object.assign((null==(o=null==ue?void 0:ue.insured[ue.currentIndex])?void 0:o.personVO)||{},{relationToHolder:"1"}):void y("与投保人关系未配置本人");Object.assign((null==(a=null==ue?void 0:ue.insured[ue.currentIndex])?void 0:a.personVO)||{},m)}else"benifit"===ue.currentType?le(null==(s=null==ue?void 0:ue.insured[ue.currentIndex])?void 0:s.personVO,m)?y("指定受益人不可为被保人本人"):Object.assign((null==(t=null==(l=null==ue?void 0:ue.insured[ue.currentIndex])?void 0:l.beneficiaryList[ue.currentBenifitIndex])?void 0:t.personVO)||{},m):"guardian"===ue.currentType&&(console.log("selectedCustomer",m),Object.assign((null==(u=null==(d=null==ue?void 0:ue.insured[ue.currentIndex])?void 0:d.guardian)?void 0:u.personVO)||{},m))},be=()=>{var e;const i=!de.value||(null==(e=de.value)?void 0:e.every((e=>e.validateTrialFields())));return(!te.value||p(ue.holder))&&i},Te=e=>{var i;return Promise.all([...(null==(i=de.value)?void 0:i.map((i=>i.validate(e))))||[],f(te,ue.holder.trialFactorCodes,e)])},Ie=e=>{const{productList:i,config:n,schema:r,trialFactorCodes:o,beneficiaryList:a,guardian:s,personVO:l,nanoid:t,...d}=W(e)||{};return d},Se=()=>{const{length:e,[e-1]:i}=ue.initInsuredIList;ue.insured.push(W({...i,nanoid:C()}))},Le=S((()=>{const{multiInsuredMaxNum:e,multiInsuredSupportFlag:i}=ue.config;return i&&(!e||ue.insured.length<e)})),Ce=S((()=>L(ue.holder.schema))),xe=S((()=>ue.insured.some((e=>L(e.schema))))),we=(e,i)=>L(e)?e.reduce(((e,n)=>(e[n]=i[n],e)),{}):{},ke=(e,i,n={})=>!!L(e)&&JSON.stringify(we(e,i))!==JSON.stringify(we(e,n));r((()=>{var e;return null==(e=ue.holder.personVO)?void 0:e.certType}),o(((e,i)=>{if(`${e}`==`${i}`)return!1;v("投保人信息变动了====");const[n,r]=V(ue.holder.schema,{certType:e});return b(ue.holder.config,r),!1}),0)),r((()=>{var e;return null==(e=ue.holder.personVO)?void 0:e.nationalityCode}),((e,i)=>{e!==i&&b(ue.holder.config,T(ue.holder.personVO))}),{immediate:!0});let je=!1;r([()=>{var e;return{...null==(e=ue.holder)?void 0:e.personVO}},()=>ue.insured.map((e=>{const{beneficiaryList:i,guardian:n,personVO:r}=e||{},o=L(i)?i.map((e=>({...null==e?void 0:e.personVO}))):[];return{...r,guardian:(null==n?void 0:n.personVO)||{},beneficiaryList:o}}))],o(((e,i)=>{var n,r,o,a;if(JSON.stringify(e)===JSON.stringify(i)&&je)return je=!0,!1;je=!1;const[s,l]=e;g(ue.holder.schema,s,(()=>{s.certType=s.certType||"1"}));const t=((e,i)=>{const n=ke(ue.holder.trialFactorCodes,null==e?void 0:e[0],null==i?void 0:i[0]),r=ue.insured.some(((e,n)=>{var r;const{trialFactorCodes:o,personVO:a}=e;return ke(o,a,null==(r=i[1])?void 0:r[n])}));return n||r})([s,l],i),{insuredList:d}=h.modelValue,u={holder:s,insuredList:l.map(((e,i)=>({...(null==d?void 0:d[i])||{},...e})))};if(null==(n=ue.config)?void 0:n.isSpouseInsured){const[e,i]=l.map((e=>null==e?void 0:e.gender));if(e&&i&&String(e)===String(i))return y("被保人性别与投保要求不符")}if(JSON.stringify(null==(r=null==l?void 0:l[0])?void 0:r.personVO),Ie(null==(a=null==(o=h.modelValue)?void 0:o.insuredList)?void 0:a[0]),console.log("-------result = ",u),O("update:modelValue",u),!be())return ue.trialValidated=!1,O("trailValidateFailed",u);Te(!0).then((()=>{console.log("trialEnd"),ue.trialValidated=!0,!h.isOnlyHolder&&t&&O("trailChange",u)})).catch((()=>{ue.trialValidated=!1,O("trailValidateFailed",u)}))}),0),{deep:!0}),r([()=>h.productFactor,()=>h.isTrial],o(((e,i)=>{if(z(e,i)||!(null==e?void 0:e[0]))return!1;v("投被保人要素变动了");const{insuredFactorCodes:n,holderFactorCodes:r}=K(G)||{},{holder:o,insured:a,beneficiary:s,guardian:l,config:t}=Q(e[0],{isTrial:e[1],...h.multiInsuredConfig,insuredFactorCodes:n,holderFactorCodes:r});return Object.assign(ue.holder,o),ue.config=t,L(a)&&(ue.initInsuredIList=a.map((e=>({...e,guardian:{},beneficiaryList:[]})))),ue.beneficiarySchema=W((null==s?void 0:s.schema)||[]),ue.guardianSchema=W((null==l?void 0:l.schema)||[]),!1}),300),{deep:!0,immediate:!0}),r((()=>{var e,i,n,r;return null==(r=null==(n=null==(i=null==(e=null==ue?void 0:ue.insured)?void 0:e[ue.currentIndex])?void 0:i.guardian)?void 0:n.personVO)?void 0:r.relationToInsured}),((e,i)=>{e!==i&&i&&(v("监护人关系变动了+++++"),Object.assign(ue.insured[ue.currentIndex],{guardian:{personVO:{relationToInsured:e}}}))}));const Fe=i(!1);return r([()=>{const{holder:e,insuredList:i=[]}=h.modelValue,n=L(i)?i.map((e=>({config:e.config,personVO:Ie(e),guardian:{personVO:e.guardian||{}},beneficiaryList:L(e.beneficiaryList)?e.beneficiaryList.map((({config:e,...i})=>({config:e,personVO:Ie(i)}))):[]}))):[];return[(null==e?void 0:e.config)||{},Ie(e),n]},()=>ue.config,()=>ue.initInsuredIList],(([[e,i,n],r,o],[a,s,l])=>{const[t,d,u]=a||[];if(JSON.stringify(e)===JSON.stringify(t)&&JSON.stringify(i)===JSON.stringify(d)&&JSON.stringify(n)===JSON.stringify(u)&&JSON.stringify(o)===JSON.stringify(l)&&Fe.value)return;Fe.value=!0,Object.assign(ue.holder.config,e),console.log("投保人数据===",W(ue.holder.personVO),W(i)),console.log("投保人数据===",W(ue.holder.personVO),W(i)),g(ue.holder.schema,i,(()=>{i.certType=i.certType||"1"})),Object.assign(ue.holder.personVO,i);const{length:c}=n||[],{length:m}=ue.insured,{length:p,0:f={},[p-1]:v}=ue.initInsuredIList,{multiInsuredMaxNum:y=1,multiInsuredMinNum:V=1,multiInsuredSupportFlag:O}=(null==ue?void 0:ue.config)||{},T=h.isView||c>m?Math.min(c,y):m||V,I=W(n);ue.insured=Array.from({length:T}).reduce(((e,i,n)=>{const{personVO:r,config:o={},guardian:a,beneficiaryList:s}=(null==I?void 0:I[n])||{},l=W(0===n?f:v);return e[n]?(e[n].schema=l.schema,b(e[n],{...W(l),personVO:r,config:o,guardian:a,beneficiaryList:s})):e[n]={...W(l),personVO:r,config:o,guardian:a,beneficiaryList:s,nanoid:C()},e}),ue.insured)}),{deep:!0,immediate:!0}),r((()=>ue.list),((e,i)=>{e&&(ue.list=e)})),m({validate:Te,validateTrialFields:be,validateHolder:(...e)=>{var i;return null==(i=te.value)?void 0:i.validate(...e)},canTrail:()=>ue.trialValidated}),A((()=>{ie({currentIndex:ue.currentIndex,currentBenifitIndex:ue.currentBenifitIndex,scrollTop:x.value})})),R((()=>{const e=ne(),i=re();ue.currentType=B.query.selectedType||ue.currentType,console.log("onActivated:",i),i&&(ue.currentIndex=i.currentIndex,ue.currentBenifitIndex=i.currentBenifitIndex,document.documentElement.scrollTo(0,i.scrollTop),document.body.scrollTop=i.scrollTop,oe()),e&&(he(e),ae())})),(e,i)=>{var n,r;const o=_,m=w,p=U;return a(),k(N,null,[d(Ce)&&d(ce)?(a(),s(d(c),{key:0,ref_key:"holderFormRef",ref:te,title:"投保人信息",class:"personal-info-card",model:d(ue).holder.personVO,schema:d(ue).holder.schema,config:d(ue).holder.config,"is-view":e.isView,"extra-provision":{objectType:d(u).HOLDER,objectId:null==(r=null==(n=d(ue).holder)?void 0:n.personVO)?void 0:r.id},onOcr:ye},{customer:l((()=>[d(Ve)?(a(),k("div",{key:0,class:"choose-customer",onClick:i[0]||(i[0]=e=>Oe("holder",1,0))},[j(o,{name:"customer",color:"#333"})])):F("",!0)])),_:1},8,["model","schema","config","is-view","extra-provision"])):F("",!0),d(xe)&&!e.isOnlyHolder?(a(),k(N,{key:1},[(a(!0),k(N,null,H(d(ue).insured,((i,n)=>{var r;return a(),s(me,Y({ref_for:!0,ref_key:"insuredFormRef",ref:de,key:`${i.nanoid}_${n}`,modelValue:i.personVO,"onUpdate:modelValue":e=>i.personVO=e,"beneficiary-list":i.beneficiaryList,"onUpdate:beneficiaryList":e=>i.beneficiaryList=e,guardian:i.guardian,"onUpdate:guardian":e=>i.guardian=e,title:""+(d(ue).insured.length>1?`被保人${n+1}`:"被保人信息"),"holder-person-v-o":d(ue).holder.personVO},i,{"beneficiary-schema":d(ue).beneficiarySchema,"guardian-schema":d(ue).guardianSchema,"is-view":e.isView,"multi-beneficiary-num":null==(r=d(ue).config)?void 0:r.multiBeneficiaryMaxNum}),{riskList:l((()=>[t(e.$slots,"riskInfo",{insuredIndex:n},void 0,!0)])),customer:l((()=>[1!=+i.personVO.relationToHolder&&d(Ve)?(a(),k("div",{key:0,class:"choose-customer",onClick:e=>Oe("insured",n,0,i.personVO.relationToHolder)},[j(o,{name:"customer",color:"#333"})],8,pe)):F("",!0)])),guardianCustomer:l((e=>[d(Ve)?(a(),k("div",{key:0,class:"choose-customer",onClick:e=>Oe("guardian",n,0,i.guardian.personVO.relationToInsured)},[j(o,{name:"customer",color:"#333"})],8,fe)):F("",!0)])),benefitCustomer:l((e=>[d(Ve)?(a(),k("div",{key:0,class:"choose-customer",onClick:r=>{var o;return Oe("benifit",n,null==e?void 0:e.index,null==(o=i.beneficiaryList[null==e?void 0:e.index])?void 0:o.personVO.relationToInsured)}},[j(o,{name:"customer",color:"#333"})],8,ge)):F("",!0)])),default:l((()=>[!e.isView&&n+1>d(ue).config.multiInsuredMinNum?(a(),k("span",{key:0,class:"delete-button",onClick:e=>(e=>{$.confirm({message:"确定要删除该被保人吗？"}).then((()=>{ue.insured.splice(e,1)}))})(n)},[j(o,{name:"delete",color:"var(--van-primary-color)"})],8,ve)):F("",!0)])),_:2},1040,["modelValue","onUpdate:modelValue","beneficiary-list","onUpdate:beneficiaryList","guardian","onUpdate:guardian","title","holder-person-v-o","beneficiary-schema","guardian-schema","is-view","multi-beneficiary-num"])})),128)),!e.isView&&d(Le)?(a(),s(p,{key:0,class:"add-button-wrap"},{title:l((()=>[q("span",{class:"add-button",onClick:Se},[j(m,{name:"plus"}),E("添加被保人")])])),_:1})):F("",!0)],64)):F("",!0)],64)}}}),[["__scopeId","data-v-2372677b"]]);export{Ve as P};
