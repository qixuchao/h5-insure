import{h as e,l as a,y as t,z as l,I as o,A as n,s,a3 as d,a4 as r,a8 as i,N as u,r as c,j as v,k as p,m,n as f,Q as I,T as h}from"./vendor-d6fdc679.js";import{j as w}from"./infoCollection-467b6f5a.js";import{_ as y,a4 as g}from"./index-60277a18.js";import{c as C,_ as N}from"./index-f3096ddc.js";import{a as b}from"./order-41d0799a.js";import{d as O,i as U,g as $,s as k,e as S,E as x}from"./trial-a2000d96.js";import{t as j}from"./theme-ea709837.js";import{n as D,i as L,m as _,e as P,g as R,t as V,k as B,f as z,h as F}from"./utils-d05a714f.js";import{p as H}from"./product-d4af34db.js";import"./trial-51097f61.js";const J={class:"com-field-info"},T={class:"title"},q={class:"desc"};var E=y(e({props:{title:{type:String,default:""},desc:{type:String,default:""}},setup:e=>(n,s)=>(a(),t("div",J,[l("div",T,o(e.title),1),l("div",q,o(e.desc),1)]))}),[["__scopeId","data-v-2ff3e068"]]);const K=e=>(d("data-v-ed9081ee"),e=e(),r(),e),M={key:0,class:"pro-modal"},A=K((()=>l("div",{class:"pro-overlay"},null,-1))),G={class:"pro-modal-wrapper"},Q=K((()=>l("div",{class:"pro-modal-content"},[l("p",null,"恭喜您"),l("p",null,"保障升级成功")],-1))),W=["src"];var Y=y(e({props:{bg:{type:String,default:""},btn:{type:String,default:""},isShow:{type:Boolean,default:()=>{}}},emits:["on-confirm","on-close"],setup(e,{emit:o}){const d=e,r=()=>{o("on-close")},i=()=>{o("on-confirm")};return(e,o)=>d.isShow?(a(),t("div",M,[A,l("div",G,[l("div",{class:"pro-modal-body"},[Q,l("div",{class:"pro-modal-btn",onClick:i},"我知道了")]),l("div",{class:"pro-modal-close",onClick:r},[l("img",{src:n(C)},null,8,W)])])])):s("",!0)}}),[["__scopeId","data-v-ed9081ee"]]);const X={class:"page-activity-upgrade"},Z=["src"],ee={class:"container"},ae={class:"main-form"};var te=y(e({setup(e){const t=i(),o=u(),{productCode:s="BWYL2022",tenantId:d,orderNo:r,agentCode:y="",from:C}=o.query,J=c(),T=c(),q=c(),K=c(),M=c(),A=c(),G=c(!1),Q="check"===C,W=c(!1),te=c(0),le=c("");let oe="";const ne=()=>{G.value=!1},se=e=>`${g}/pay?orderNo=${e}&saleUserId=${y}&tenantId=${d}`,de=()=>{t.replace(`/pay?orderNo=${le.value}&saleUserId=${y}&tenantId=${d}`)},re=async e=>{try{h.loading({forbidClick:!0,message:"升级中",duration:15e3});const e=await(async()=>{var e,a,t,l,o;const n=R({tenantId:d,applicationNo:q.value.applicationNo,policyNo:q.value.policyNo,saleUserId:y,saleChannelId:q.value.saleChannelId,orderStatus:b.UP_PROCESSING,orderTopStatus:"-1",orderCategory:2,detail:J.value,insureDetail:T.value,paymentMethod:null==(a=null==(e=q.value.extInfo)?void 0:e.extraInfo)?void 0:a.paymentMethod,renewalDK:null==(l=null==(t=q.value.extInfo)?void 0:t.extraInfo)?void 0:l.renewalDK,iseeBizNo:oe,successJumpUrl:"",premium:K.value,holder:{...q.value.tenantOrderHolder,socialFlag:q.value.tenantOrderHolder.extInfo.hasSocialInsurance},insured:{...q.value.tenantOrderInsuredList[0],socialFlag:q.value.tenantOrderInsuredList[0].extInfo.hasSocialInsurance},tenantOrderRiskList:V({tenantId:d,riskList:B(T.value.productRiskVoList[0].riskDetailVOList,J.value),riskPremium:{},productId:null==(o=J.value)?void 0:o.id})}),s=await k(n),{code:r,data:i}=s;return"10000"===r?i.data:""})();await O({tenantId:d,applicationNo:q.value.applicationNo});if(le.value=e,A.value){if(Q){const a=encodeURIComponent(encodeURIComponent(se(e))),t=`${A.value}&successUrl=${a}`;window.location.href=t}else{const e=encodeURIComponent(encodeURIComponent(window.location.href)),a=`${A.value}&failUrl=${e}`;window.location.href=a}h.clear()}else(async e=>{const a=z({tenantId:d,premium:K.value,orderDetail:q.value,productDetail:J.value,insureDetail:T.value,successJumpUrl:se(e),iseeBizNo:oe}),l=await x({orderNo:e,...a}),{code:o,data:n}=l;"10000"===o&&(Q?t.replace(`/internet/orderDetail?orderNo=${e}&productCode=${s}&tenantId=${d}`):(h.clear(),de()))})(e)}catch(a){h.clear()}},ie=async e=>{Q?W.value=!0:re()},ue=()=>{h.loading({forbidClick:!0,duration:2e4,message:"试算中"});const e=H({productCode:s,withInsureInfo:!0,tenantId:d}),a=U({productCode:s}),t=$({orderNo:r,tenantId:d});Promise.all([e,a,t]).then((([e,a,t])=>{var l;"10000"===e.code&&(J.value=e.data,document.title=(null==(l=e.data)?void 0:l.productFullName)||""),"10000"===a.code&&(T.value=a.data),"10000"===t.code&&(q.value=t.data,M.value=t.data.tenantOrderInsuredList[0].extInfo.hasSocialInsurance),(async()=>{try{const e=z({tenantId:d,premium:K.value,orderDetail:q.value,productDetail:J.value,insureDetail:T.value,successJumpUrl:""},F),a=await S(e),{code:t,data:l}=a;"10000"===t&&(K.value=l.installmentPremium,A.value=l.signUrl)}catch(e){}finally{h.clear()}})()}))};return v((()=>{ue(),setTimeout((async()=>{oe=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,t)=>{const o=p("ProRadioButton"),s=p("ProField"),d=p("van-config-provider");return a(),m(d,{"theme-vars":n(j)},{default:f((()=>{var e,a,d,r,i,u,c,v,p,m;return[l("div",X,[l("img",{src:null==(a=null==(e=J.value)?void 0:e.tenantProductInsureVO)?void 0:a.banner[0],class:"banner"},null,8,Z),l("div",ee,[l("div",ae,[I(E,{title:"姓名",desc:n(D)(null==(r=null==(d=q.value)?void 0:d.tenantOrderInsuredList)?void 0:r[0].name)},null,8,["desc"]),I(E,{title:"证件号码",desc:n(L)(null==(u=null==(i=q.value)?void 0:i.tenantOrderInsuredList)?void 0:u[0].certNo)},null,8,["desc"]),I(E,{title:"手机号码",desc:n(_)(null==(v=null==(c=q.value)?void 0:c.tenantOrderHolder)?void 0:v.mobile)},null,8,["desc"]),I(E,{title:"每月保费",desc:`${n(P)(K.value||0)}元 / 每月`},null,8,["desc"]),I(s,{label:"有无社保",name:"name",required:"",placeholder:"请选择"},{input:f((()=>[I(o,{modelValue:M.value,"onUpdate:modelValue":t[0]||(t[0]=e=>M.value=e),disabled:!0,options:n(w)},null,8,["modelValue","options"])])),_:1}),l("div",{class:"submit",onClick:ie})])]),I(Y,{"is-show":G.value,onOnConfirm:de,onOnClose:ne},null,8,["is-show"])]),I(N,{show:W.value,"onUpdate:show":t[1]||(t[1]=e=>W.value=e),"content-list":null==(m=null==(p=J.value)?void 0:p.tenantProductInsureVO)?void 0:m.attachmentVOList,"active-index":te.value,text:"我已逐页阅读并确认告知内容",onSubmit:re},null,8,["show","content-list","active-index"])]})),_:1},8,["theme-vars"])}}}),[["__scopeId","data-v-72c7b778"]]);export{te as default};
