import{d as e,ay as a,az as i,i as s,h as n,bP as t,bY as o,j as r,ad as l,af as d,aR as c,l as u,o as g,c as f,b as m,a as p,u as v,w as h,v as y,q as S,aY as j,aQ as b,cy as I,cz as _,y as E,T as w,cA as N,bv as L,aE as O,cB as V,aI as T}from"./index-2cd6533c.js";import{b as C}from"./product-b43e9af0.js";import{g as q,m as A}from"./trial-d4f61e37.js";import{_ as P}from"./SignPart-234436fe.js";import{u as D}from"./useOrder-2a7889a8.js";import{N as x}from"./notice-8f4bc18f.js";import"./PolicyInfo-f179e114.js";import{p as z}from"./utils-6f9a4840.js";import{g as G}from"./utils-2b5f715d.js";import{_ as $}from"./MessagePopup-5c5351d2.js";import{q as B}from"./qianming-ece13dd4.js";import"./index-b7dd12ef.js";import"./utils-75e7582c.js";import"./createProposal-023fa395.js";import"./trial-ff92f49f.js";import"./infoCollection-ee8e29ff.js";const R={class:"long-verify"},M={class:"header"},U={class:"verify-content"},k={class:"footer-button"},F={class:"content-inner"},Y=["src"],H=p("h4",null,"本次签名已完成",-1),J=p("p",null,"感谢您对本次投保的签字确认，后续流程由销售人员在您的配合下进行",-1),Q=e({__name:"agentSign",setup(e){a((()=>i((()=>import("./index-ec801cd6.js")),["static/js/index-ec801cd6.js","static/css/index-4822eb94.css","static/js/index-2cd6533c.js","static/css/index-efad381f.css"]))),a((()=>i((()=>import("./index-713cfbe4.js")),["static/js/index-713cfbe4.js","static/css/index-fa4edf2a.css","static/js/index-2cd6533c.js","static/css/index-efad381f.css","static/js/theme-94cf7d00.js","static/js/index-f8ee5a93.js","static/css/index-bbfdd7ec.css","static/js/utils-2b5f715d.js","static/js/infoCollection-ee8e29ff.js","static/js/trial-ff92f49f.js"])));const Q=s(),K=n(),{productCode:W="",tenantId:X,agentCode:Z="",agencyCode:ee,saleChannelId:ae,saleUserId:ie,orderNo:se,orderCode:ne,extraInfo:te,isShare:oe,insurerCode:re,preview:le}=Q.query;let de={};try{de=JSON.parse(decodeURIComponent(te))}catch(be){}const ce=D(),ue=`${window.origin}/baseInsurance/long/phoneVerify?${t.stringify({...Q.query,orderNo:ne||se})}`,[ge,fe]=o(!1),me=r(),pe=l.get(`${d}_userInfo`),ve=r({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:""},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{}},agent:{fileList:[],personalInfo:{name:(null==pe?void 0:pe.name)||""},isSign:!1,isVerify:!1,isShareSign:!1,signData:[],compositionSign:""}}),he=r({sign:[],verify:[],scribing:""}),ye=()=>{if(le)return void j(b.SIGN,Q.query);const e=[];me.value&&he.value.sign.includes("1")&&e.push(me.value.validateSign()),Promise.all(e).then((e=>{I({bizObjectId:[],bizObjectType:_.AGENT,orderId:ce.value.id,tenantId:X}).then((({code:e,data:a})=>{"10000"===e&&a&&K.push({path:E.sign,query:Q.query})}))})).catch((e=>{w(e.message)}))};r();const Se=(e,a,i)=>{var s;N(e,a,null==(s=ce.value)?void 0:s.id,X,i).then((({code:e,message:a})=>{"10000"===e?se&&q({orderNo:ne||se,tenantId:X}).then((({code:e,data:a})=>{if("10000"===e){Object.assign(ce.value,a);const e=[];a.tenantOrderAttachmentList.forEach((a=>{a.objectType===x.AGENT&&(30===a.category?e.push(a.fileBase64):21===a.category&&(ve.value.agent.compositionSign=a.uri))})),ve.value.agent.signData=e}})):w(a)}))};r({imgUrl:"",desc:"",title:"",link:ue});c((()=>{(async()=>{let e={};const{code:a,data:i}=await q({orderNo:se,tenantId:X});"10000"===a&&(Object.assign(ce.value,i),e=z(i.insuredList[0].productList),i.tenantOrderAttachmentList.forEach((e=>{e.objectType===x.AGENT&&(30===e.category?ve.value.agent.signData.push(e.fileBase64):21===e.category&&(ve.value.agent.compositionSign=e.uri))}))),C(e).then((({code:e,data:a})=>{var i;if("10000"===e){const{signMaterialMap:e}=(null==(i=a.productMaterialPlanVOList)?void 0:i[1])||{};(Object.values(e||{}).flat()||[]).forEach((e=>{e.noticeObject===x.AGENT&&ve.value.agent.fileList.push({attachmentName:e.materialName,attachmentList:[{...e,materialSource:G(`${null==e?void 0:e.materialSource}`,null==e?void 0:e.materialContent)}]})}))}})),A(e).then((({data:e,code:a})=>{if("10000"===a){const{signInfo:a}=L(e.productFactor);a.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((a=>{e.required&&he.value.sign.push(a.code),"1"===a.code?ve.value.agent.isSign=!0:"2"===a.code?ve.value.holder.isSign=!0:"3"===a.code?ve.value.insured.isSign=!0:"4"===a.code?ve.value.holder.isShareSign=!0:"5"===a.code&&(ve.value.insured.isShareSign=!0)})),"customerFace"===e.name&&e.columns.forEach((a=>{e.required&&he.value.verify.push(a.code),"1"===a.code?ve.value.holder.isVerify=!0:"2"===a.code&&(ve.value.insured.isVerify=!0)}))}))}}))})()}));const je=r();return u((()=>{setTimeout((async()=>{je.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,a)=>{var i,s;const n=O,t=V,o=T;return g(),f("div",R,[m(n),p("div",M,[m(t,{type:"warning",content:`本人${null==(i=v(pe))?void 0:i.name}已面晤投保人、被保险人(被保险人为未成年人的，还包括其法定监护人)，投保过程中的告知事项已逐一向投保人、被保险人/法定监护人当面询问，并亲自见证投保人、被保险人/法定监护人在电子投保单上签名。如有不实见证或报告，本人愿承担相应的法律责任。请${null==(s=v(pe))?void 0:s.name}签名确认。`},null,8,["content"])]),p("div",U,[m(P,{ref_key:"agentSignRef",ref:me,"order-detail":v(ce),"sign-string":v(ve).agent.signData,"show-sign":v(ve).agent.isSign,"show-verify":v(ve).agent.isVerify,"file-list":v(ve).agent.fileList,"personal-info":v(ve).agent.personalInfo,"composition-sign":v(ve).agent.compositionSign,disabled:!!v(oe),title:"销售人员",onHandleSign:a[0]||(a[0]=e=>Se("AGENT",e))},null,8,["order-detail","sign-string","show-sign","show-verify","file-list","personal-info","composition-sign","disabled"])]),p("div",k,[m(o,{type:"primary",onClick:ye},{default:h((()=>[y("确定")])),_:1})]),m($,{modelValue:v(ge),"onUpdate:modelValue":a[1]||(a[1]=e=>S(ge)?ge.value=e:null),onClose:a[2]||(a[2]=e=>v(fe)(!1))},{default:h((()=>[p("div",F,[p("img",{src:v(B),alt:"",class:"header-img"},null,8,Y),H,J])])),_:1},8,["modelValue"])])}}});export{Q as default};
