import{d as e,j as a,i as l,z as s,o as i,l as n,w as o,a as r,e as u,u as d,b as t,V as m,W as v,as as c,an as p,h as f,g as h,O as y,c as g,q as b,F as S,a8 as V,aa as k,bK as j,ap as C,am as q}from"./index-8adcf781.js";import{s as L,_ as w,b as x,d as I,R as _,t as U}from"./index-418b3936.js";import{c as O}from"./format-b5e9d8b9.js";import{g as $,m as D}from"./trial-4664166c.js";import{p as E}from"./utils-6fc00a71.js";import{u as F}from"./useOrder-d39898d7.js";import{a as P}from"./constants-71331306.js";import"./keysIn-131bbce9.js";import"./isObjectLike-a9798079.js";import"./_getTag-0507d0b1.js";import"./debounce-6981b306.js";import"./phoneVerify-d0716a19.js";import"./merge-e7788e50.js";import"./index-54fb4308.js";import"./useDicData-6e736c53.js";const R={class:"popup-container"},N={class:"popup-header"},z={class:"title"},A={class:"popup-body"},B=e({name:"checkCodePopup"}),K=e({...B,props:{show:{type:Boolean,default:!1},type:{default:"agent"},data:{default:()=>({})}},emits:["cancel","confirm"],setup(e,{emit:p}){const f=e,h=a((()=>f.show)),y=l({mobile:"",verifyCode:""}),g=a((()=>f.type)),b=l({holder:{type:"投保人",name:"",mobile:"",desc:""},agent:{type:"代理人",name:"李三",mobile:"13262278989",desc:"色卡上会计核算看回放独守空房还是空巅峰计划收款方"},insured:{type:"被保人",name:"",mobile:"",desc:""}}),S=()=>{p("cancel")},V=()=>{p("confirm")};return s([()=>f.data,f.type],(([e,a])=>{var l,s,i;e&&(Object.assign(b.value.holder,e.holder),Object.assign(b.value.insured,null==(l=null==e?void 0:e.insuredList)?void 0:l[0]),y.value.mobile=null==(i=null==(s=b.value)?void 0:s[`${f.type}`])?void 0:i.mobile)}),{immediate:!0,deep:!0}),(e,a)=>{const l=w,s=x,p=I,f=c;return i(),n(f,{show:h.value,"onUpdate:show":a[2]||(a[2]=e=>h.value=e),class:"popup-check-mobile",closeable:!1,"close-on-click-overlay":!1},{default:o((()=>[r("div",R,[r("div",N,[r("span",{class:"clear-all",onClick:S}," 取消 "),r("span",z,u(`${b.value[g.value].type}手机号验证`),1),r("span",{class:"close",onClick:V},"确认")]),r("div",A,[r("h3",null,u(`尊敬的${b.value[g.value].type}:${b.value[g.value].name}`),1),r("p",null,u(b.value[g.value].desc),1),r("h3",null,u(`${b.value[g.value].type}手机号验证 ${d(O)(b.value[g.value].mobile||"")}`),1),t(p,{model:y.value},{default:o((()=>[m(t(l,{modelValue:y.value.mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>y.value.mobile=e),label:"被保人手机号",name:"mobile",maxlength:"11",required:""},null,8,["modelValue"]),[[v,!1]]),t(s,{modelValue:y.value.verifyCode,"onUpdate:modelValue":a[1]||(a[1]=e=>y.value.verifyCode=e),"related-name":"mobile",label:" ",maxlength:"6","input-align":"left",placeholder:"请输入验证码",name:"verifyCode","send-s-m-s-code":d(L),rules:""},null,8,["modelValue","send-s-m-s-code"])])),_:1},8,["model"])])])])),_:1},8,["show"])}}}),T=p([{label:"签名完成",value:1},{label:"去签名",value:2},{label:"认证失败，请联系内勤人员",value:3}]);const W={class:"page-verify-wrap"},G={key:0,class:"header"},H={class:"sign-list"},J={class:"inner-cell"},M={class:"inner-cell"},Q={class:"footer-button"},X=e({name:"verify"}),Y=e({...X,setup(e){const s=f(),u=h(),{orderNo:m,tenantId:v}=s.query,c=l(!1),p=l({holder:{},insuredList:[{}]}),O=F(),R=l(!1),N=l({sign:[],verify:[],scribing:""}),z=l({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{},verifyStatus:2},agent:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2}}),A=l("agent"),B=a((()=>e=>N.value.sign.includes(e)||N.value.verify.includes(e))),X=a((()=>e=>z.value[e].isSign||z.value[e].isVerify)),Y=a((()=>e=>z.value[e].isShareSign)),Z=e=>{A.value=e,R.value=!0},ee=()=>{R.value=!1},ae=()=>{let e="";e="agent"===A.value?P.agentSign:"holder"===A.value?(z.value[A.value].isVerify,P.holderSign):z.value[A.value].isVerify?P.checkFace:P.insuredSign,u.push({path:e,query:{...s.query,type:A.value}})};return y((()=>{(async()=>{let e={};await $({orderNo:m,tenantId:v}).then((({code:a,data:l})=>{var s;"10000"===a&&(Object.assign(O.value,l),p.value=l,e=E(l.insuredList[0].productList),z.value.agent.verifyStatus=l.extInfo.agentAuthFlag,z.value.holder.verifyStatus=l.holder.isCert,z.value.insured.verifyStatus=null==(s=l.extInfo.insured)?void 0:s[0].isCert)})),await D(e).then((({data:e,code:a})=>{if("10000"===a){const{signInfo:a}=U(e.productFactor);a.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((a=>{e.required&&N.value.sign.push(a.code),"1"===a.code?z.value.agent.isSign=!0:"2"===a.code?z.value.holder.isSign=!0:"3"===a.code?z.value.insured.isSign=!0:"4"===a.code?z.value.holder.isShareSign=!0:"5"===a.code&&(z.value.insured.isShareSign=!0)})),"customerFace"===e.name&&e.columns.forEach((a=>{e.required&&N.value.verify.push(a.code),"1"===a.code?z.value.holder.isVerify=!0:"2"===a.code&&(z.value.insured.isVerify=!0)}))}))}}))})()})),(e,a)=>{const l=k,s=j,u=C,m=q;return i(),g("div",W,[t(l),d(c)?(i(),g("div",G,[t(s,{type:"warning",content:"为保障您的合法权益，当前保单需要进行双录"})])):b("",!0),r("div",H,[d(X)("agent")?(i(),n(u,{key:0,title:"代理人签名",required:d(B)("agent"),"is-link":"",value:d(T)[d(z).agent.verifyStatus],onClick:a[0]||(a[0]=e=>Z("agent"))},null,8,["required","value"])):b("",!0),d(c)?(i(),n(d(I),{key:2,model:d(p)},{default:o((()=>[t(d(w),{modelValue:d(p).holder.mobile,"onUpdate:modelValue":a[3]||(a[3]=e=>d(p).holder.mobile=e),rules:[{pattern:new RegExp(d(_).isPhone)}],label:"投保人手机号",name:"holder.mobile",maxlength:"11",required:""},null,8,["modelValue","rules"]),t(d(x),{modelValue:d(p).holder.verifyCode,"onUpdate:modelValue":a[4]||(a[4]=e=>d(p).holder.verifyCode=e),"related-name":"holder.mobile",label:"验证码",maxlength:"6",name:"holder.verifyCode","send-s-m-s-code":d(L),rules:"",required:""},null,8,["modelValue","send-s-m-s-code"]),t(d(w),{modelValue:d(p).insuredList[0].mobile,"onUpdate:modelValue":a[5]||(a[5]=e=>d(p).insuredList[0].mobile=e),label:"被保人手机号",name:"insuredList.0.mobile",maxlength:"11",required:"",rules:[{pattern:new RegExp(d(_).isPhone)}]},null,8,["modelValue","rules"]),t(d(x),{modelValue:d(p).insuredList[0].verifyCode,"onUpdate:modelValue":a[6]||(a[6]=e=>d(p).insuredList[0].verifyCode=e),label:"验证码",maxlength:"6",name:"insuredList.0.verifyCode","related-name":"insuredList.0.mobile","send-s-m-s-code":d(L),required:""},null,8,["modelValue","send-s-m-s-code"])])),_:1},8,["model"])):(i(),g(S,{key:1},[d(X)("holder")?(i(),n(u,{key:0,title:"投保人签名",required:d(B)("holder")},{value:o((()=>[r("div",J,[d(Y)("holder")?(i(),n(u,{key:0,"is-link":"",value:"分享空签邀约"})):b("",!0),t(u,{"is-link":"",value:d(T)[d(z).holder.verifyStatus],onClick:a[1]||(a[1]=e=>Z("holder"))},null,8,["value"])])])),_:1},8,["required"])):b("",!0),d(X)("insured")?(i(),n(u,{key:1,title:"被保人签名",required:d(B)("insured")},{value:o((()=>[r("div",M,[d(Y)("insured")?(i(),n(u,{key:0,"is-link":"",value:"分享空签邀约"})):b("",!0),t(u,{"is-link":"",value:d(T)[d(z).insured.verifyStatus],onClick:a[2]||(a[2]=e=>Z("insured"))},null,8,["value"])])])),_:1},8,["required"])):b("",!0)],64))]),r("div",Q,[t(m,{type:"primary"},{default:o((()=>[V("下一步")])),_:1})]),t(K,{type:d(A),show:d(R),data:d(O),onCancel:ee,onConfirm:ae},null,8,["type","show","data"])])}}});export{Y as default};
