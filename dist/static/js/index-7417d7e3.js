import{_ as e,d as s,G as r,r as a,x as o,aa as t,b as l,c as d,h as i,F as u,i as p,j as n,f as c,n as m,t as k,g as v,av as I,e as f,w as L,k as h,K as P,L as R,u as y,a as g,al as b,ar as V,X as _,a6 as C}from"./index-3898adba.js";import{u as D,P as j}from"./index-80d96ca9.js";import{q as O,a as w,b as T}from"./createProposal-3ca66378.js";import{R as x}from"./index-ea4f0007.js";import{u as N}from"./useDicData-e6df81e6.js";import"./pdfh5-008ca364.js";import"./trial-90934487.js";import"./trial-0423da29.js";const U=e=>(P("data-v-cd47605e"),e=e(),R(),e),S={class:"com-product-list-wrapper"},$={class:"risk-item-wrapper"},q={class:"content"},E={class:"risk-premium"},F={class:"premium"},A={class:"risk-factor"},B={class:"factor"},K={class:"factor-value"},H=U((()=>n("span",{class:"factor-name"}," 保额(元) ",-1))),G={class:"factor"},M={class:"factor-value"},W=U((()=>n("span",{class:"factor-name"}," 保障期间 ",-1))),X={class:"factor"},Y={class:"factor-value"},z=U((()=>n("span",{class:"factor-name"}," 缴费期间 ",-1))),J={class:"operate-bar"},Q=U((()=>n("span",{class:"btn-plus"},"+",-1))),Z={key:0,class:"premium-total"},ee={class:"premium"};var se=e(s({__name:"index",props:{productRiskList:{default:()=>[]},productInfo:{default:()=>({})},productData:{default:()=>({})},pickProductPremium:{type:Function,default:()=>{}},productNum:{default:0}},emits:["deleteRisk","updateRisk","addRiderRisk"],setup(e,{emit:s}){const P=e,[R,y]=r(),g=a({checkedList:[],disabledList:[],riderRiskList:[],mainRiskData:{},totalPremium:0,currentRiskRecord:{},productRiskList:[]}),b=N("RISK_PAYMENT_PERIOD"),V=N("RISK_INSURANCE_PERIOD"),_=o((()=>{var e,s;return(null==(s=null==(e=P.productData)?void 0:e.productRiskVoList)?void 0:s[0].riskDetailVOList.filter((e=>1===e.collocationType)))||[]})),C=o((()=>{var e,s;const r=P.productRiskList.map((e=>e.riskId)),a=((null==(s=null==(e=P.productData)?void 0:e.productRiskVoList)?void 0:s[0].riskDetailVOList)||[]).filter((e=>r.includes(e.id)&&1===e.collocationType));return _.value.length-a.length})),D=o((()=>e=>{var s,r;const a=(null==(r=null==(s=P.productData)?void 0:s.productRiskVoList)?void 0:r[0].riskDetailVOList.find((s=>s.id!==e)))||{};let o=!1;return o=!!P.productNum||2===a.riskType&&1===a.collocationType,o})),j=o((()=>{var e,s;return(null==(s=null==(e=P.productData)?void 0:e.productRiskVoList)?void 0:s[0].riskDetailVOList.find((e=>1===e.riskType)))||{}})),O=o((()=>j.value.collocationVOList||[])),w=(e,r)=>{const a=e.map((e=>e.id)).filter((e=>!g.value.disabledList.includes(e)));s("addRiderRisk",a,P.productInfo)};return t((()=>P.productInfo),(e=>{var s;let r=0;(e.proposalProductRiskList||[]).forEach((e=>{r+=e.premium})),null==(s=P.pickProductPremium)||s.call(P,{[`${e.productId}`]:r}),g.value.totalPremium=r}),{deep:!0,immediate:!0}),t((()=>P.productRiskList),(e=>{const s=[],r=[],a=[];(e||[]).forEach((e=>{1===e.riskType?s.unshift(e):(r.push(e.riskId),a.push(e.riskId),s.push(e))})),g.value.disabledList=r,g.value.checkedList=a,g.value.productRiskList=s}),{deep:!0,immediate:!0}),(e,r)=>{const a=l("ProTitle"),o=l("ProCheckButton");return d(),i("div",S,[(d(!0),i(u,null,p(v(g).productRiskList,(e=>{var r,t;return d(),i("div",{key:e.riskId},[n("div",$,[c(a,{"risk-type":e.riskType,title:e.riskName,class:"no-border"},null,8,["risk-type","title"]),n("div",q,[n("div",E,[m(" 保费:"),n("span",F,"￥"+k(null==(r=e.premium)?void 0:r.toLocaleString()),1)]),n("div",A,[n("div",B,[n("span",K,k(null==(t=e.amount)?void 0:t.toLocaleString()),1),H]),n("div",G,[n("span",M,k(v(I)(v(V),e.coveragePeriod)),1),W]),n("div",X,[n("span",Y,k(v(I)(v(b),e.chargePeriod)),1),z])]),n("div",J,[v(D)(e.riskId)?(d(),f(o,{key:0,round:32,class:"border",onClick:r=>{s("deleteRisk",e,P.productInfo)}},{default:L((()=>[m("删除")])),_:2},1032,["onClick"])):h("",!0),v(C)?(d(),f(o,{key:1,activated:"",round:32,class:"btn-rider-risk",onClick:s=>{return r=e,y(!0),void(g.value.currentRiskRecord=r);var r}},{default:L((()=>[Q,m(" 附加险")])),_:2},1032,["onClick"])):h("",!0),c(o,{activated:"",round:32,onClick:r=>{s("updateRisk",e,P.productInfo)}},{default:L((()=>[m("修改")])),_:2},1032,["onClick"])])])])])})),128)),v(g).productRiskList.length>1?(d(),i("div",Z,[m(" 保费: "),n("span",ee,"￥"+k(v(g).totalPremium.toLocaleString()),1)])):h("",!0),v(R)?(d(),f(x,{key:1,modelValue:v(g).checkedList,"onUpdate:modelValue":r[0]||(r[0]=e=>v(g).checkedList=e),show:v(R),disabled:v(g).disabledList,"risk-list":v(_),"collocation-list":v(O),onFinished:w,onClose:r[1]||(r[1]=e=>v(y)(!1))},null,8,["modelValue","show","disabled","risk-list","collocation-list"])):h("",!0)])}}}),[["__scopeId","data-v-cd47605e"]]);const re={class:"container"},ae=(e=>(P("data-v-4f24fb6d"),e=e(),R(),e))((()=>n("span",{class:"plan-name"},"计划书名称",-1))),oe={class:"operate-bar"},te={class:"footer-bar"},le={class:"trial-result"},de={class:"result-num"},ie={class:"trial-operate"};var ue=e(s({__name:"index",setup(e){const s=[{name:"保存修改"},{name:"另存为新计划书"}],[I,P]=r(),[R,x]=r(),N=a({proposalHolder:{},proposalInsuredList:[{name:"",gender:"",birthday:"",proposalInsuredProductList:[]}],proposalName:"",totalPremium:0,relationUserType:2}),U=y(),S=g(),$=D(),{id:q,type:E="add",isCreateProposal:F}=S.query,A=a({productId:0,productCollection:{},productInfo:{},productPremium:{},riderRisk:{},type:"add",currentRisk:[]}),B=a();a({}),a([]),o((()=>({min:"",max:""})));const K=()=>{B.value.validate().then((()=>{T(N.value).then((({code:e,data:s})=>{"10000"===e&&($.$reset(),$.proposalId=s,U.push({path:"/compositionProposal",query:{id:s}}))}))}))},H=()=>{!q&&$.proposalId?x(!0):K()},G=(e,s)=>{s&&(N.value.id=null),K()},M=(e,s,r)=>s?/^.{1,20}$/.test(s)?"":`${e}不能超过20个字符`:"",W=(e={})=>{Object.assign(A.value.productPremium,e),N.value.totalPremium=Object.values(A.value.productPremium).reduce(((e,s)=>e+s),0)},X=(e,s)=>{const r=s;C.confirm({message:"确认删除该险种？"}).then((()=>{1===e.riskType?(N.value.proposalInsuredList[0].proposalInsuredProductList=N.value.proposalInsuredList[0].proposalInsuredProductList.filter((e=>e.productId!==r.productId)),W({[r.productId]:0})):r.proposalProductRiskList=r.proposalProductRiskList.filter((s=>s.riskId!==e.riskId))}))},Y=(e,s)=>{A.value.productId=s.productId,A.value.productInfo=s,A.value.type="edit",A.value.currentRisk=[e.riskId],P(!0)},z=(e,s)=>{A.value.productId=s.productId,A.value.productInfo=s,A.value.type="addRiderRisk",A.value.currentRisk=e,P(!0)},J=e=>{N.value.proposalInsuredList[0].proposalInsuredProductList=N.value.proposalInsuredList[0].proposalInsuredProductList.map((s=>{let r=s;return s.productId===e.proposalInsuredList[0].proposalInsuredProductList[0].productId&&(r={...e.proposalInsuredList[0].proposalInsuredProductList[0]}),r})),P(!1)},Q=()=>{$.setProposalInfo(N.value),$.setTrialData([]),$.setExcludeProduct(Object.keys(A.value.productCollection)),U.push({path:"/proposalList",query:{isCreateProposal:"1",...S.query}})},Z=()=>{P(!1)};return b((()=>{const e=$.$state.trialData,s=$.$state.proposalInfo,r=$.$state.proposalId;q&&!F||r?(((e={})=>{O(e).then((({code:e,data:s})=>{"10000"===e&&Object.assign(N.value,s)}))})({id:q||r}),$.$reset()):!Object.keys(s).length&&e.length?Object.assign(N.value,e[0]):Object.keys(s).length&&e.length?(s.proposalInsuredList[0].proposalInsuredProductList.push(...e[0].proposalInsuredList[0].proposalInsuredProductList),N.value=s):Object.keys(s).length&&!e.length&&(N.value=s),$.setTrialData([])})),t((()=>{var e;return null==(e=N.value.proposalInsuredList[0].proposalInsuredProductList)?void 0:e.length}),(()=>{const e=N.value.proposalInsuredList[0].proposalInsuredProductList.map((e=>({productId:e.productId,source:2})));w({voList:e}).then((({code:e,data:s})=>{"10000"===e&&(A.value.productCollection=s)})).finally((()=>{}))})),(e,r)=>{const a=l("VanField"),o=l("ProCard"),t=l("ProDatePicker"),P=l("ProRadioButton"),y=l("VanForm"),g=l("ProCheckButton"),b=l("VanButton"),C=l("VanActionSheet"),D=l("ProPageWrap");return d(),f(D,{class:"page-create-wrapper"},{default:L((()=>{var e;return[n("div",re,[c(y,{ref_key:"formRef",ref:B,"input-align":"right","error-message-align":"right"},{default:L((()=>[c(o,{"show-line":!1},{default:L((()=>[c(a,{modelValue:v(N).proposalName,"onUpdate:modelValue":r[0]||(r[0]=e=>v(N).proposalName=e),class:"border-radius",name:"proposalName",placeholder:"请输入计划书名称",rules:[{validator:(...e)=>M("计划书名称",...e)}]},{label:L((()=>[ae])),_:1},8,["modelValue","rules"])])),_:1}),c(o,{title:"被保人信息"},{default:L((()=>[c(a,{modelValue:v(N).proposalInsuredList[0].name,"onUpdate:modelValue":r[1]||(r[1]=e=>v(N).proposalInsuredList[0].name=e),name:"name",label:"姓名",rules:[{validator:(...e)=>M("姓名",...e)}],placeholder:"请输入（选填）"},null,8,["modelValue","rules"]),c(t,{modelValue:v(N).proposalInsuredList[0].birthday,"onUpdate:modelValue":r[2]||(r[2]=e=>v(N).proposalInsuredList[0].birthday=e),name:"birthday",label:"出生日期",type:"date","is-link":"",readonly:"",placeholder:"请选择",rules:[{required:!0,message:"请选择"}]},null,8,["modelValue"]),c(a,{modelValue:v(N).proposalInsuredList[0].gender,"onUpdate:modelValue":r[4]||(r[4]=e=>v(N).proposalInsuredList[0].gender=e),name:"gender",label:"性别",class:"border-radius",rules:[{required:!0,message:"请选择"}]},{input:L((()=>[c(P,{modelValue:v(N).proposalInsuredList[0].gender,"onUpdate:modelValue":r[3]||(r[3]=e=>v(N).proposalInsuredList[0].gender=e),options:v(V)},null,8,["modelValue","options"])])),_:1},8,["modelValue"])])),_:1})])),_:1},512),(d(!0),i(u,null,p(v(N).proposalInsuredList[0].proposalInsuredProductList||[],(e=>(d(),f(o,{key:e.productId,"show-line":!1},{default:L((()=>{var s,r;return[c(se,{"product-risk-list":e.proposalProductRiskList,"product-info":e,"product-num":(null==(r=null==(s=v(N).proposalInsuredList[0])?void 0:s.proposalInsuredProductList)?void 0:r.length)-1,"product-data":v(A).productCollection[e.productId],"pick-product-premium":W,onAddRiderRisk:z,onUpdateRisk:Y,onDeleteRisk:X},null,8,["product-risk-list","product-info","product-num","product-data"])]})),_:2},1024)))),128)),n("div",oe,[c(g,{activated:"",round:34,onClick:Q},{default:L((()=>[m("添加主险")])),_:1})])]),n("div",te,[n("span",le,[m("总保费"),n("span",de,"￥"+k(v(N).totalPremium.toLocaleString()),1)]),n("div",ie,[c(b,{type:"primary",onClick:H},{default:L((()=>[m("保存并预览")])),_:1})])]),v(I)?(d(),f(j,{key:0,"is-show":v(I),type:v(A).type,"rider-risk":(null==(e=v(A).riderRisk)?void 0:e[v(A).productId])||[],"product-data":v(A).productCollection[v(A).productId],"form-info":v(A).productInfo,holder:v(N).proposalHolder,insured:v(N).proposalInsuredList[0],"current-risk":v(A).currentRisk,onClose:Z,onFinished:J},null,8,["is-show","type","rider-risk","product-data","form-info","holder","insured","current-risk"])):h("",!0),c(C,{show:v(R),"onUpdate:show":r[5]||(r[5]=e=>_(R)?R.value=e:null),actions:s,"cancel-text":"取消","close-on-click-action":"",onCancel:r[6]||(r[6]=e=>v(x)(!1)),onSelect:G},null,8,["show"])]})),_:1})}}}),[["__scopeId","data-v-4f24fb6d"]]);export{ue as default};
