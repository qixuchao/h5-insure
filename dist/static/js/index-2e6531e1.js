var J=Object.defineProperty,G=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var U=(i,a,n)=>a in i?J(i,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[a]=n,E=(i,a)=>{for(var n in a||(a={}))X.call(a,n)&&U(i,n,a[n]);if($)for(var n of $(a))Y.call(a,n)&&U(i,n,a[n]);return i},N=(i,a)=>G(i,W(a));import{g as L,E as C,M as O,_ as K,r as p,j as _,k as D,m as k,p as h,A as s,z as c,J as Q,L as Z,n as P,G as S,F as M,C as j,T as x,O as ee,a9 as te,h as oe}from"./vendor-667a94d7.js";import{a as ae}from"./infoCollection-242da9b6.js";import{s as ne,c as ue}from"./phoneVerify-6067c041.js";import{v as q,a as se}from"./validator-f4617c0e.js";import{a3 as le}from"./index-a9a5ff01.js";import{g as re,m as ie,i as ce}from"./trial-5950a30e.js";import{p as me}from"./product-14de8ff2.js";import{g as de,l as fe,a as pe}from"./logo-8952d90d.js";import{b as ve}from"./blank-84b83865.js";import"./trial-7213523e.js";const _e={class:"agree"},ge=j(" \u6211\u5DF2\u9605\u8BFB\u5E76\u540C\u610F "),he=L({props:{info:{type:Object,default:()=>{}}},emits:["on-verify"],setup(i,{emit:a}){var y,u;const n=i,l=C({}),r=30,m=C(0),v=C("\u83B7\u53D6\u9A8C\u8BC1\u7801"),b=/^\d{6}$/,e=O({mobile:(u=(y=n.info)==null?void 0:y.userInfo)==null?void 0:u.mobile,smsCode:"",agree:""}),d=t=>q(e.mobile)?!0:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7",F=()=>{if(m.value>0)return;m.value=r;const t=()=>{v.value=`${m.value}s`,m.value-=1};t();const o=setInterval(()=>{m.value===0?(v.value="\u83B7\u53D6\u9A8C\u8BC1\u7801",m.value=0,clearInterval(o)):t()},1e3)},V=async()=>{m.value>0||l==null||l.value.validate("mobile").then(async()=>{const t=await ne(e.mobile),{code:o,data:f}=t;o==="10000"&&(x({message:"\u77ED\u4FE1\u53D1\u9001\u6210\u529F\uFF0C\u8BF7\u67E5\u6536"}),F())})},B=async()=>{const t=await ue(e.mobile,e.smsCode),{data:o}=t;o&&a("on-verify",e)},I=async()=>{l==null||l.value.validate().then(async()=>{B()})};return K(()=>e,()=>{q(e.mobile)&&b.test(e.smsCode)&&B()},{deep:!0,immediate:!0}),(t,o)=>{const f=p("van-field"),w=p("van-cell-group"),A=p("van-checkbox"),H=p("ProPDFviewer"),R=p("VanForm");return _(),D(R,{ref_key:"formRef",ref:l,"label-width":"60"},{default:k(()=>{var T;return[h(w,null,{default:k(()=>[h(f,{modelValue:s(e).mobile,"onUpdate:modelValue":o[0]||(o[0]=g=>s(e).mobile=g),name:"mobile",label:"\u624B\u673A\u53F7",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",maxlength:"11",rules:[{validator:d}]},null,8,["modelValue","rules"]),h(f,{modelValue:s(e).smsCode,"onUpdate:modelValue":o[1]||(o[1]=g=>s(e).smsCode=g),name:"smsCode",label:"\u9A8C\u8BC1\u7801",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",maxlength:"6",rules:[{pattern:b,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u9A8C\u8BC1\u7801"}]},{button:k(()=>[c("div",{class:Z(["sms-code",{"count-down":m.value>0}]),onClick:V},Q(v.value),3)]),_:1},8,["modelValue","rules"])]),_:1}),c("div",{class:"submit",onClick:I}),c("div",_e,[h(A,{modelValue:s(e).agree,"onUpdate:modelValue":o[2]||(o[2]=g=>s(e).agree=g),name:"agree",shape:"square"},null,8,["modelValue"]),c("div",null,[ge,(_(!0),P(M,null,S(((T=n.info)==null?void 0:T.attachmentList)||[],(g,z)=>(_(),D(H,{key:z,class:"file-name",title:`\u300A${g.attachmentName}\u300B`,content:g.attachmentUrl,type:"pdf"},null,8,["title","content"]))),128))])])]}),_:1},512)}}}),be={class:"agree"},Fe=j(" \u6211\u5DF2\u9605\u8BFB\u5E76\u540C\u610F "),Ce=L({props:{info:{type:Object,default:()=>{}}},emits:["on-submit"],setup(i,{emit:a}){const n=i,l=C({}),r=O({name:n.info.userInfo.name,certNo:n.info.userInfo.certNo,agree:""}),m=e=>le(r.certNo)?!0:"\u8BF7\u586B\u5199\u6B63\u786E\u7684\u8BC1\u4EF6\u53F7",v=e=>se(e)?!0:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u59D3\u540D",b=()=>{l==null||l.value.validate().then(async e=>{if(!r.agree){x("\u8BF7\u52FE\u9009\u534F\u8BAE");return}a("on-submit",r)})};return(e,d)=>{const F=p("van-field"),V=p("van-cell-group"),B=p("van-checkbox"),I=p("ProPDFviewer"),y=p("VanForm");return _(),D(y,{ref_key:"formRef",ref:l,"label-width":"60"},{default:k(()=>{var u;return[h(V,null,{default:k(()=>[h(F,{modelValue:s(r).name,"onUpdate:modelValue":d[0]||(d[0]=t=>s(r).name=t),name:"name",label:"\u59D3\u540D",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D",maxlength:"10",rules:[{validator:v}]},null,8,["modelValue","rules"]),h(F,{modelValue:s(r).certNo,"onUpdate:modelValue":d[1]||(d[1]=t=>s(r).certNo=t),name:"certNo",label:"\u8EAB\u4EFD\u8BC1",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u8EAB\u4EFD\u8BC1\u53F7",maxlength:"20",rules:[{validator:m}]},null,8,["modelValue","rules"])]),_:1}),c("div",{class:"submit",onClick:b}),c("div",be,[h(B,{modelValue:s(r).agree,"onUpdate:modelValue":d[2]||(d[2]=t=>s(r).agree=t),name:"agree",shape:"square"},null,8,["modelValue"]),c("div",null,[Fe,(_(!0),P(M,null,S(((u=n.info)==null?void 0:u.attachmentList)||[],(t,o)=>(_(),D(I,{key:o,class:"file-name",title:`\u300A${t.attachmentName}\u300B`,content:t.attachmentUrl,type:"pdf"},null,8,["title","content"]))),128))])])]}),_:1},512)}}});var Be="/static/assets/title-step1.97cb9efa.png",ye="/static/assets/title-step2.258af5e9.png";const De={class:"page-activity-invite"},Ve=["src"],Ie=["src"],Ee={class:"container"},Ne={class:"main-form"},ke={class:"title"},xe=["src"],je=L({setup(i){const a=ee(),n=te(),{productCode:l="7X9",tenantId:r="",extInfo:m}=a.query,v=de(m),b=C(!0),e=O({title:Be,attachmentList:[{}],userInfo:{mobile:v.phoneNo,certNo:"",name:""}}),d=C(),F=C(),V=async u=>{var w,A;e.userInfo.mobile=u.mobile;const t=await re({holderPhone:e.userInfo.mobile,productCode:l,tenantId:r}),{code:o,data:f}=t;o==="10000"&&(e.userInfo.name=(w=f.tenantOrderHolder)==null?void 0:w.name,e.userInfo.certNo=(A=f.tenantOrderHolder)==null?void 0:A.certNo),e.title=ye,b.value=!1},B=async u=>{try{x({message:"\u9886\u53D6\u4E2D...",forbidClick:!0,loadingType:"spinner"}),e.userInfo.certNo=u.certNo,e.userInfo.name=u.name;const t=pe(N(E({tenantId:r,detail:d.value},v),{holder:e.userInfo,insured:N(E({},e.userInfo),{relationToHolder:ae.SELF})})),o=await ie(t),{code:f}=o;f==="10000"&&n.push({path:"/chuangxin/baigebao/productDetail",query:N(E({},a.query),{tenantId:r,productCode:"BWYL2021",extInfo:JSON.stringify(N(E({},v),{phoneNo:e.userInfo.mobile,certNo:e.userInfo.certNo,name:e.userInfo.name}))})}),x.clear()}catch(t){console.log(t),x.clear()}},I=()=>{let u=[];return F.value.productRiskVoList.forEach(t=>{t.riskDetailVOList.forEach(o=>{u=u.concat(o.riskAttachmentVOList)})}),u},y=async()=>{const u=me({productCode:l,withInsureInfo:!0}),t=ce({productCode:l});Promise.all([u,t]).then(([o,f])=>{o.code==="10000"&&(d.value=o.data),f.code==="10000"&&(F.value=f.data,e.attachmentList=I())})};return oe(()=>{y()}),(u,t)=>(_(),P("div",De,[c("img",{class:"logo",src:s(fe)},null,8,Ve),c("img",{src:s(ve)},null,8,Ie),c("div",Ee,[c("div",Ne,[c("div",ke,[c("img",{src:s(e).title},null,8,xe)]),b.value?(_(),D(he,{key:0,info:s(e),onOnVerify:V},null,8,["info"])):(_(),D(Ce,{key:1,info:s(e),onOnSubmit:B},null,8,["info"]))])])]))}});export{je as default};
