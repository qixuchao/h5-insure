import{d as e,r as a,aQ as n,aS as t,z as i,bK as r,L as o,R as m,aR as s,c as d,A as c,V as l,e as p,g as u,U as y}from"./index-cc4926f5.js";import{c as f,m as E,n as T,o as R}from"./ProRenderFormWithCard.vue_vue_type_style_index_0_scoped_true_lang-2d65ee71.js";import{i as h,P as I}from"./index-6585dc3f.js";/* empty css              */import"./useDicData-423d4475.js";import{P as _,B as v,a as S}from"./bankCard-8ac6497c.js";const M=e({__name:"PayInfo",props:{schema:{default:()=>[]},config:{default:()=>[]},modelValue:{default:()=>[]},isView:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{expose:M,emit:L}){const g=e,D={BANK_PAY:"1",ALI_PAY:"2",WECHAT_PAY:"3"},A=a(null);a();const P=["cardType","bankCard"],N=[{title:"首期支付",schema:[],payInfoType:_.FIRST_TERM,formData:{paymentType:"1",paymentMethod:"1",cardType:v.DEBIT},config:{cardType:{isView:!0}},objectType:n.INIT_SIGN},{title:"续期支付",schema:[],payInfoType:_.RENEW_TERM,formData:{paymentType:"1",paymentMethod:"1",paymentGenre:String(S.FIRST_SAME),cardType:v.DEBIT},config:{cardType:{isView:!0}},objectType:n.RENEWAL_SIGN},{title:"年金领取银行卡",schema:[],payInfoType:_.REPRISE,formData:{paymentMethod:"1",paymentGenre:String(S.FIRST_SAME)},config:{},objectType:n.ANNUAL_SIGN}].map((e=>({...e,nanoid:t()}))),b=[["initialPaymentMethod","initialCardType","initialBankCard","initialPaymentType"],["renewalPaymentGenre","renewalPaymentMethod","renewalCardType","renewalBankCard","renewalPaymentType","expiryMethod"],["annuityPaymentGenre","annuityBankCard"]],F=i({schemaList:r(N)}),j=o((()=>["FIRST_TERM","RENEW_TERM","REPRISE"].reduce(((e,a)=>{const n=(t=a,F.schemaList.findIndex((e=>String(e.payInfoType)===String(_[t]))));var t;return n>-1&&(e[a]=n),e}),{}))),G=(e,a)=>{var n,t;return e>-1&&(null==(t=null==(n=F.schemaList[e])?void 0:n.formData)?void 0:t.paymentGenre)===`${S[a]}`},W=e=>{if("string"!=typeof e||!e)return"";const[a,n]=e.match(/^(?:initial|renewal|annuity)(.*)$/)||[];return n?R(n):e},C=(e,a)=>{var n;const{formData:t}=F.schemaList[a]||{},{paymentGenre:i,id:r,...o}=t||{},m={...o,bankCardImage:s(o.bankCardImage)?o.bankCardImage.map((a=>({...a,objectType:N[e].objectType}))):o.bankCardImage};Object.assign(null==(n=F.schemaList[e])?void 0:n.formData,m)};return m((()=>F.schemaList.map((e=>{var a,n;return[null==(a=null==e?void 0:e.formData)?void 0:a.paymentMethod,null==(n=null==e?void 0:e.formData)?void 0:n.paymentGenre]}))),((e,a)=>{f("支付方式/支付类型变动"),F.schemaList.forEach(((e,a)=>{const{formData:n,schema:i}=e||{},r=[D.ALI_PAY,D.WECHAT_PAY].includes(String(null==n?void 0:n.paymentMethod)),o=[S.FIRST_SAME,S.RENEW_SAME].includes(Number(null==n?void 0:n.paymentGenre));i.forEach((e=>{e.hidden=(o||r)&&((e,a=!1)=>{if(e){const n=[...P];return a&&n.push("paymentMethod"),n.includes(e)}return!1})(e.name,o)})),e.nanoid=t()}))}),{deep:!0,immediate:!0}),m((()=>{var e;return null==(e=F.schemaList[j.value.FIRST_TERM])?void 0:e.formData}),((e,a)=>{if(h(e,a))return!1;const{REPRISE:n,RENEW_TERM:t}=j.value;f("首期数据变动"),G(t,"FIRST_SAME")&&C(t,j.value.FIRST_TERM),G(n,"FIRST_SAME")&&C(n,t)}),{deep:!0}),m((()=>{var e;return null==(e=F.schemaList[j.value.RENEW_TERM])?void 0:e.formData}),((e,a)=>{if(h(e,a))return!1;f("续期数据变动");const{REPRISE:n,RENEW_TERM:t}=j.value;G(n,"RENEW_SAME")&&C(n,t)}),{deep:!0}),m((()=>{var e,a;return null==(a=null==(e=F.schemaList[j.value.RENEW_TERM])?void 0:e.formData)?void 0:a.paymentGenre}),(e=>{f("续期支付类型变动");const{FIRST_TERM:a,RENEW_TERM:n}=j.value;String(e)===String(S.FIRST_SAME)?C(n,a):F.schemaList[n]&&(E(F.schemaList[n].formData,{...T(F.schemaList[n].formData,(e=>!["orderId","tenantId","id"].includes(e))),...N[n].formData,paymentGenre:e}),F.schemaList[n].nanoid=t())})),m((()=>{var e,a;return null==(a=null==(e=F.schemaList[j.value.REPRISE])?void 0:e.formData)?void 0:a.paymentGenre}),((e,a)=>{if(e===a)return!1;const{FIRST_TERM:n,RENEW_TERM:i,REPRISE:r}=j.value,o=[S.FIRST_SAME,S.RENEW_SAME].includes(Number(e));if(f("年金支付类型变动"),o){const a=String(e)===String(S.FIRST_SAME)?n:i;C(r,a)}else F.schemaList[r]&&(E(F.schemaList[r].formData,{...T(F.schemaList[r].formData,(e=>!["orderId","tenantId","id"].includes(e))),...N[r].formData,paymentGenre:e}),F.schemaList[r].nanoid=t())}),{immediate:!0}),m([()=>g.schema,()=>g.config],(()=>{let e=[];F.schemaList=g.schema.reduce(((a,n)=>{const t=b.findIndex((e=>e.includes(n.name)));return"paymentDrawType"===n.name&&(e=n.columns.map((e=>e.code))),t>-1&&a[t].schema.push({...n,name:W(n.name),payInfoType:N[t].payInfoType}),a}),r(N)).map(((e,a)=>({...e,config:{...e.config,...g.config[a]||{}},nanoid:t()}))).filter((({schema:a,...n})=>e.includes(`${n.payInfoType}`)&&s(a)))}),{deep:!0,immediate:!0}),m((()=>g.modelValue),(e=>{s(e)&&F.schemaList.forEach(((a,n)=>{E(a.formData,e[n])}))}),{deep:!0,immediate:!0}),m((()=>{var e;return null==(e=F.schemaList)?void 0:e.map((e=>e.formData))}),(e=>{s(e)&&L("update:modelValue",e.map(((e,a)=>{const{payInfoType:n}=F.schemaList[a];return{...e,payInfoType:n}})))}),{deep:!0,immediate:!0}),M({validate:e=>Promise.all(A.value?A.value.map((e=>e.validate())):[])}),(a,n)=>(d(!0),c(y,null,l(u(F).schemaList,((a,n)=>(d(),p(u(I),{ref_for:!0,ref_key:"payInfoFormRef",ref:A,key:`${a.nanoid}_${n}`,schema:a.schema,model:a.formData,config:a.config,title:a.title,"is-view":e.isView,"extra-provision":{objectType:a.objectType,objectId:a.formData.id}},null,8,["schema","model","config","title","is-view","extra-provision"])))),128))}});export{M as _};
