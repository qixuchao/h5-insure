import{_ as a,d as e,r as l,x as t,a8 as d,c as o,g as n,e as u,l as s,a9 as r,j as i,aa as m,w as p,i as c,f as y,ab as v,ac as b,Y as I,ad as k,ae as E,K as f,L as g,n as N,a as _,u as h,y as R,O as T,b as A,af as V,m as D,h as C,B as S,t as B,F as M,W as O,ag as U,a2 as L,ah as j,p as P,a4 as K,T as x,a6 as q,a7 as w,C as F,N as G,D as W}from"./index-0879500c.js";import{l as H}from"./index-c6b2b786.js";import{B as Y,a as z,P as $,E as J,b as Q,c as X,d as Z,e as aa,f as ea}from"./bankCard-d5014d5a.js";import{u as la}from"./useDicData-5037eb69.js";import{a as ta}from"./order-d40ed240.js";import"./pdfh5-e5c0db2a.js";const da={class:"com-bank-card-info"},oa=(a=>(f("data-v-bb02bba6"),a=a(),g(),a))((()=>c("span",{class:"field-title"},[N("银行卡照片 "),c("span",{class:"sub-title"},"(需上传正反两面)")],-1))),na={class:"image-wrap"};var ua=a(e({props:{modelValue:{type:Object,default:()=>{}},holderName:{type:String,default:""},factor:{type:Object,default:()=>{}}},emits:["update:modelValue"],setup(a,{emit:e}){const f=a,g=la("BANK"),N=l({bankCardType:Y.DEBIT,bankCardNo:"",accountName:"",payBank:"",mobile:"",images:[]}),_=a=>f.factor&&f.factor[a]&&f.factor[a].isDisplay===I.YES,h=a=>!(!a||2!==a.length)||"请上传银行卡正反面照片",R=t((()=>g.value.map((a=>({label:a.name,value:a.code}))))),T=a=>{k({ossKey:[a],imageType:E.BANK_CARD}).then((a=>{const{data:e,code:l}=a;if("10000"===l&&e&&e.bankCardOcrVO){N.value.bankCardNo=e.bankCardOcrVO.cardNo;const a=R.value.find((a=>a.label===e.bankCardOcrVO.bankName));a&&(N.value.payBank=a.value)}}))};return d((()=>f.modelValue),(a=>{N.value=a}),{immediate:!0}),d(N,(a=>{e("update:modelValue",a)})),(e,l)=>(o(),n("div",da,[_("cardType")?(o(),u(r,{key:0,modelValue:N.value.bankCardType,"onUpdate:modelValue":l[0]||(l[0]=a=>N.value.bankCardType=a),label:"卡片类型",name:"bankCardType","data-source":s(z),"is-view":""},null,8,["modelValue","data-source"])):i("",!0),_("bankCardNumber")?(o(),u(m,{key:1,modelValue:N.value.bankCardNo,"onUpdate:modelValue":l[1]||(l[1]=a=>N.value.bankCardNo=a),label:"银行卡号",name:"bankCardNo",type:"number",required:""},null,8,["modelValue"])):i("",!0),_("cardHolder")?(o(),u(m,{key:2,"model-value":a.holderName,label:"持卡人",name:"accountName","is-view":""},null,8,["model-value"])):i("",!0),_("bank")?(o(),u(r,{key:3,modelValue:N.value.payBank,"onUpdate:modelValue":l[2]||(l[2]=a=>N.value.payBank=a),name:"payBank",label:"开户银行","data-source":s(R),required:""},null,8,["modelValue","data-source"])):i("",!0),_("bankCardAttachment")?(o(),u(m,{key:4,label:"银行卡照片",block:"","label-width":"100%",name:"images",rules:[{validator:h}]},{label:p((()=>[oa])),input:p((()=>[c("div",na,[y(b,{modelValue:N.value.images,"onUpdate:modelValue":l[3]||(l[3]=a=>N.value.images=a),"max-count":2,"upload-type":s(v).BANK_CARD,onOnUploadFinished:T},null,8,["modelValue","upload-type"])])])),_:1},8,["rules"])):i("",!0),_("bankPreMobile")?(o(),u(m,{key:5,modelValue:N.value.mobile,"onUpdate:modelValue":l[4]||(l[4]=a=>N.value.mobile=a),label:"预留手机号",type:"number",required:"",name:"mobile","validate-type":["phone"]},null,8,["modelValue"])):i("",!0)]))}}),[["__scopeId","data-v-bb02bba6"]]);const sa=a=>(f("data-v-7a52b3b4"),a=a(),g(),a),ra={class:"page-bank-card"},ia={class:"reprise-card-list"},ma=["onClick"],pa={class:"agree"},ca=N(" 投保人阅读并接受 "),ya={class:"footer-button footer"},va=sa((()=>c("div",{class:"text"},"刷新",-1))),ba=N("分享"),Ia=N("下一步");var ka=a(e({setup(a){const e=_(),d=h(),{orderNo:v="2022072710380711215",agentCode:b="D1234567-1",tenantId:k="9991000007",templateId:E=1,isShare:f,insurerCode:g="kunlunhealth"}=e.query,N={bankCardType:Y.DEBIT};let z={};const la=l(""),da=l({payMethod:$.REAL_TIME,bankData:{...N,imagesId:[],images:[]}}),oa=l({payMethod:$.REAL_TIME,expiryMethod:J.AUTOMATIC_PADDING,bankData:{...N,imagesId:[],images:[]},payInfoType:Q.FIRST_SAME}),na=l({bankData:{...N,imagesId:[],images:[]}}),sa=l(Q.FIRST_SAME),ka=l({}),Ea=l(!1),fa=l(),ga=l(),Na=l(),_a=l({}),ha=(a,e)=>ka.value&&ka.value[e]&&ka.value[e][a]&&ka.value[e][a].isDisplay===I.YES,Ra=()=>{P({orderNo:v,saleUserId:b,tenantId:k}).then((a=>{var l,t,o;const{code:n,data:u}=a;"10000"===n&&([ta.PENDING,ta.PAYMENT_FAILED,ta.UNDER_WRITING_SUCCESS].includes(u.orderStatus)?Promise.all([null==(l=fa.value)?void 0:l.validate(),null==(t=ga.value)?void 0:t.validate(),null==(o=Na.value)?void 0:o.validate()]).then((a=>{if(!Ea.value)return void x.fail("请勾选同意银行转账授权");const l=[{...a[0],id:da.value.id,paymentType:ea.FIRST_TERM},{...a[1],id:oa.value.id,paymentType:ea.RENEW_TERM},{...a[2],id:na.value.id,paymentType:ea.REPRISE,payInfoType:sa.value}],t=[{category:q.OBVERSE_BANK_CARD,name:"首期签约银行卡正面",objectType:w.INIT_SIGN,type:"png",uri:a[0].images[0],id:da.value.bankData.imagesId[0]},{category:q.REVERSE_BANK_CARD,name:"首期签约银行卡背面",objectType:w.INIT_SIGN,type:"png",uri:a[0].images[1],id:da.value.bankData.imagesId[1]}];oa.value.payInfoType===Q.OTHER&&(t.push({category:q.OBVERSE_BANK_CARD,name:"续期签约银行卡正面",objectType:w.RENEWAL_SIGN,type:"png",uri:a[1].images[0],id:oa.value.bankData.imagesId[0]}),t.push({category:q.REVERSE_BANK_CARD,name:"续期签约银行卡正面",objectType:w.RENEWAL_SIGN,type:"png",uri:a[1].images[1],id:oa.value.bankData.imagesId[1]})),sa.value===Q.OTHER&&(t.push({category:q.OBVERSE_BANK_CARD,name:"年金签约银行卡正面",objectType:w.ANNUAL_SIGN,type:"png",uri:a[2].images[0],id:na.value.bankData.imagesId[0]}),t.push({category:q.REVERSE_BANK_CARD,name:"年金签约银行卡背面",objectType:w.ANNUAL_SIGN,type:"png",uri:a[2].images[1],id:na.value.bankData.imagesId[1]})),F({...z,pageCode:"payInfo",tenantOrderPayInfoList:l,extInfo:{...z.extInfo,templateId:E,pageCode:"payInfo",shareFlag:f?"Y":"N",buttonCode:G.payInfo},operateOption:{withPayInfo:!0,withAttachmentInfo:!0},tenantOrderAttachmentList:t}).then((a=>{const{code:l,data:t}=a;"10000"===l&&t.success&&d.push({path:W[t.pageAction.data.nextPageCode],query:e.query})}))})):K("paymentResult",e.query))}))},Ta=t((()=>{const a={...e.query,isShare:1,sharePageCode:"payInfo"};return`${window.location.origin}/phoneVerify?${H.stringify(a)}`})),Aa=(a=!1)=>{P({orderNo:v,saleUserId:b,tenantId:k}).then((e=>{const{code:l,data:t}=e;"10000"===l&&t&&(z=t,la.value=t.tenantOrderHolder.name,t.tenantOrderPayInfoList.forEach((a=>{a.paymentType===ea.FIRST_TERM?(da.value=a,da.value.bankData={...N,...a,images:[],imagesId:[]}):a.paymentType===ea.RENEW_TERM?(oa.value=a,oa.value.bankData={...a,images:[],imagesId:[]}):a.paymentType===ea.REPRISE&&(na.value=a,na.value.bankData={...a,images:[],imagesId:[]},sa.value=a.payInfoType)})),t.tenantOrderAttachmentList.forEach((a=>{a.objectType===w.INIT_SIGN?(a.category===q.OBVERSE_BANK_CARD&&(da.value.bankData.images[0]=a.uri,da.value.bankData.imagesId[0]=a.id),a.category===q.REVERSE_BANK_CARD&&(da.value.bankData.images[1]=a.uri,da.value.bankData.imagesId[1]=a.id)):a.objectType===w.RENEWAL_SIGN?(a.category===q.OBVERSE_BANK_CARD&&(oa.value.bankData.images[0]=a.uri,oa.value.bankData.imagesId[0]=a.id),a.category===q.REVERSE_BANK_CARD&&(oa.value.bankData.images[1]=a.uri,oa.value.bankData.imagesId[1]=a.id)):a.objectType===w.ANNUAL_SIGN&&(a.category===q.OBVERSE_BANK_CARD&&(na.value.bankData.images[0]=a.uri,na.value.bankData.imagesId[0]=a.id),a.category===q.REVERSE_BANK_CARD&&(na.value.bankData.images[1]=a.uri,na.value.bankData.imagesId[1]=a.id))})),a&&(t.tenantOrderPayInfoList.find((a=>a.paymentType===ea.FIRST_TERM&&a.bankCardNo))||x("用户未完成银行卡信息填写")))}))},Va=()=>{Aa(!0)};return R((()=>{j({insureCode:g,objectType:4,tenantId:k,orderNo:v}).then((({code:a,data:e})=>{"10000"===a&&(_a.value=e)})),T({pageCode:"payInfo",templateId:E}).then((a=>{const{code:e,data:l}=a;if("10000"===e){const a={};l.productInsureFactorList.forEach((e=>{a[e.moduleType]||(a[e.moduleType]={}),a[e.moduleType][e.code]=e})),ka.value=a}})),Aa()})),(a,e)=>{const l=A("van-switch"),t=A("van-checkbox"),d=A("ProSvg"),v=A("van-button"),b=A("ProPageWrap");return o(),u(b,null,{default:p((()=>[c("div",ra,[y(D,{title:"首期支付"},{default:p((()=>[y(V,{ref_key:"form1",ref:fa},{default:p((()=>[ha("paymentMethod","INIT")?(o(),u(r,{key:0,modelValue:da.value.payMethod,"onUpdate:modelValue":e[0]||(e[0]=a=>da.value.payMethod=a),name:"payMethod",required:"",label:"支付方式","is-link":"",placeholder:"请选择","data-source":s(X)},null,8,["modelValue","data-source"])):i("",!0),y(ua,{modelValue:da.value.bankData,"onUpdate:modelValue":e[1]||(e[1]=a=>da.value.bankData=a),"holder-name":la.value,factor:ka.value.INIT},null,8,["modelValue","holder-name","factor"])])),_:1},512)])),_:1}),y(D,{title:"续期支付"},{default:p((()=>[y(V,{ref_key:"form2",ref:ga},{default:p((()=>[ha("sameAsInit","RENEWAL")?(o(),u(m,{key:0,label:"同首期",name:"payInfoType"},{input:p((()=>[y(l,{modelValue:oa.value.payInfoType,"onUpdate:modelValue":e[2]||(e[2]=a=>oa.value.payInfoType=a),size:"22","active-value":s(Q).FIRST_SAME,"inactive-value":s(Q).OTHER},null,8,["modelValue","active-value","inactive-value"])])),_:1})):i("",!0),ha("paymentMethod","RENEWAL")?(o(),u(r,{key:1,modelValue:oa.value.payMethod,"onUpdate:modelValue":e[3]||(e[3]=a=>oa.value.payMethod=a),name:"payMethod",label:"支付方式","is-link":"",placeholder:"请选择","data-source":s(X),required:""},null,8,["modelValue","data-source"])):i("",!0),ha("overduePayment","RENEWAL")?(o(),u(r,{key:2,modelValue:oa.value.expiryMethod,"onUpdate:modelValue":e[4]||(e[4]=a=>oa.value.expiryMethod=a),name:"expiryMethod",label:"保费逾期未支付","is-link":"",placeholder:"请选择","data-source":s(Z),required:"","label-width":"200"},null,8,["modelValue","data-source"])):i("",!0),oa.value.payInfoType!==s(Q).FIRST_SAME?(o(),u(ua,{key:3,modelValue:oa.value.bankData,"onUpdate:modelValue":e[5]||(e[5]=a=>oa.value.bankData=a),"holder-name":la.value,factor:ka.value.RENEWAL},null,8,["modelValue","holder-name","factor"])):i("",!0)])),_:1},512)])),_:1}),y(D,{title:"年金领取银行卡",class:"reprise-card","show-divider":!1},{default:p((()=>[c("div",ia,[(o(!0),n(M,null,C(s(aa),((a,e)=>(o(),n("div",{key:e,class:S(["reprise-card-item",{selected:sa.value===a.value}]),onClick:e=>{return l=a.value,void(sa.value=l);var l}},B(a.label),11,ma)))),128))]),y(V,{ref_key:"form3",ref:Na},{default:p((()=>[sa.value===s(Q).OTHER?(o(),u(ua,{key:0,modelValue:na.value.bankData,"onUpdate:modelValue":e[6]||(e[6]=a=>na.value.bankData=a),"holder-name":la.value,factor:ka.value.ANNUITY},null,8,["modelValue","holder-name","factor"])):i("",!0)])),_:1},512)])),_:1}),c("div",pa,[y(t,{modelValue:Ea.value,"onUpdate:modelValue":e[7]||(e[7]=a=>Ea.value=a),class:"checkbox",shape:"square","icon-size":16},null,8,["modelValue"]),ca,y(U,{class:"file",title:"《银行转账授权》",content:_a.value.materialContent,type:s(O)(_a.value.materialContent,_a.value.materialSource+"")},null,8,["content","type"])]),c("div",ya,[s(f)?i("",!0):(o(),n("div",{key:0,class:"refresh-btn",onClick:Va},[c("div",null,[y(d,{name:"refresh"})]),va])),s(f)?i("",!0):(o(),u(L,{key:1,title:"邀请您填写银行卡信息",desc:"邀请您填写银行卡信息",link:s(Ta),"-":""},{default:p((()=>[y(v,{plain:"",type:"primary"},{default:p((()=>[ba])),_:1})])),_:1},8,["link"])),y(v,{type:"primary",class:"submit-btn",onClick:Ra},{default:p((()=>[Ia])),_:1})])])])),_:1})}}}),[["__scopeId","data-v-7a52b3b4"]]);export{ka as default};
