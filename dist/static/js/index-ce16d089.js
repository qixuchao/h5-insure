var rt=Object.defineProperty,it=Object.defineProperties;var ht=Object.getOwnPropertyDescriptors;var tt=Object.getOwnPropertySymbols;var mt=Object.prototype.hasOwnProperty,yt=Object.prototype.propertyIsEnumerable;var et=(t,n,e)=>n in t?rt(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e,W=(t,n)=>{for(var e in n||(n={}))mt.call(n,e)&&et(t,e,n[e]);if(tt)for(var e of tt(n))yt.call(n,e)&&et(t,e,n[e]);return t},j=(t,n)=>it(t,ht(n));import{a8 as vt,g as X,d as s,C as E,a4 as at,ak as ft,M as Q,r as z,k as d,m as i,y as l,I,z as _,B as K,J as b,F as A,E as O,s as q,n as U,j as nt,al as pt,a0 as G,v as ot,a2 as Dt,a3 as _t,ab as gt,T as kt,x as Yt,h as H,Q as Mt,L as xt}from"./vendor-e9263418.js";import{d as $t}from"./constant-023ef5c0.js";import{u as ct}from"./index-b8742a0a.js";import{_ as Ct}from"./plugin-vue_export-helper-46f75680.js";import{a as Et,d as ut,e as wt}from"./schedule-eb6c7bee.js";var Tt="/static/assets/arrow-down.0e3c907f.png",lt={exports:{}};(function(t,n){(function(e,a){t.exports=a()})(vt,function(){return function(e,a,p){a.prototype.isToday=function(){var h="YYYY-MM-DD",r=p();return this.format(h)===r.format(h)}}})})(lt);var Bt=lt.exports;function St(t){return{all:t=t||new Map,on:function(n,e){var a=t.get(n);a?a.push(e):t.set(n,[e])},off:function(n,e){var a=t.get(n);a&&(e?a.splice(a.indexOf(e)>>>0,1):t.set(n,[]))},emit:function(n,e){var a=t.get(n);a&&a.slice().map(function(p){p(e)}),(a=t.get("*"))&&a.slice().map(function(p){p(n,e)})}}}const P=St();const bt={class:"calenda-header"},It={class:"filter"},At={class:"title"},Ft={key:0,class:"time"},Ot=l("img",{class:"img-add",src:Tt},null,-1),Nt={class:"right"},Vt={class:"sw"},Lt=pt('<div class="comm"><div class="item"><div class="wd">\u4E00</div></div><div class="item"><div class="wd">\u4E8C</div></div><div class="item"><div class="wd">\u4E09</div></div><div class="item"><div class="wd">\u56DB</div></div><div class="item"><div class="wd">\u4E94</div></div><div class="item"><div class="wd">\u516D</div></div><div class="item"><div class="wd">\u65E5</div></div></div>',1),qt={key:0,class:"comm day-height"},Rt=["onClick"],Ut=X({props:{chooseType:{type:String,default:"day"},selectMonth:{type:Date,default:new Date},selectDay:{type:Date,default:new Date}},emits:["change-month","change-type","click-today","click-day"],setup(t,{emit:n}){const e=t;s.extend(Bt);const a={touching:!1,trace:[]},p=E([]),h=E(s()),r=E(!1),m=E(e.selectMonth),g=E(new Date(2022,0,1)),k=E(new Date(2040,12,31)),Y=(c,v)=>c==="month"?`${v}\u6708`:c==="year"?`${v}\u5E74`:v;at(()=>e.selectMonth,c=>{c&&(m.value=new Date(s(c).format("YYYY-MM-DD")))}),at(()=>e.chooseType,c=>{c==="day"&&S()});const D=c=>{if(c.touches.length!==1){a.touching=!1,a.trace=[];return}a.touching=!0,a.trace=[{x:c.touches[0].screenX,y:c.touches[0].screenY}]},B=c=>{!a.touching||a.trace.push({x:c.touches[0].screenX,y:c.touches[0].screenY})},M=()=>{if(!a.touching)return;let c=a.trace;a.touching=!1,a.trace=[],w(c)},w=c=>{let v=c[0],x=c[c.length-1];if(x.x-v.x>50){console.log(">>>>>>>>,",s().subtract(7,"day").format());let o=h.value.subtract(7,"day");N(o),h.value=o,S(o)}else if(v.x-x.x>50){console.log("<<<<<<<<<<<<<<<<,",s().add(7,"day").format("YYYY-MM-DD"));let o=h.value.add(7,"day");N(o),h.value=o,S(o)}},N=c=>{F(s(c).startOf("week").format("YYYY-MM-DD"))},F=c=>{n("click-day",c)},L=c=>s(c).day()===0?7:s(c).day(),S=c=>{const v=[];for(let x=1;x<L(c);x++)v.unshift(s(c).subtract(x,"day").format());for(let x=0;x<7-L(c)+1;x++)v.push(s(c).add(x,"day").format());p.value=v};P.on("changeOtherMonth",c=>{c===-1&&R(s(e.selectMonth).subtract(1,"month")),c===1&&R(s(e.selectMonth).add(1,"month"))}),ft(()=>{P.off("changeOtherMonth")}),Q(()=>{S()});const y=()=>{S(),n("click-today")},$=c=>{n("change-type",c)},R=c=>{console.log("?>????",s(c).format()),r.value=!1,n("change-month",c)};return(c,v)=>{const x=z("van-datetime-picker"),o=z("van-popup");return d(),i("div",bt,[l("div",It,[l("div",At,[t.chooseType==="day"?(d(),i("span",Ft,I(_(s)(t.selectDay).format("YYYY\u5E74MM\u6708DD\u65E5")),1)):(d(),i("span",{key:1,class:"time",onClick:v[0]||(v[0]=u=>r.value=!0)},[K(I(_(s)(t.selectMonth).format("YYYY\u5E74MM\u6708"))+" ",1),Ot])),l("div",Nt,[l("span",Vt,[l("span",{class:b([t.chooseType==="day"&&"checked"]),onClick:v[1]||(v[1]=u=>$("day"))}," \u65E5 ",2),l("span",{class:b([t.chooseType==="month"&&"checked"]),onClick:v[2]||(v[2]=u=>$("month"))},"\u6708 ",2)]),l("span",{class:"today",onClick:y}," \u4ECA ")])]),l("div",{class:"week",onTouchmove:v[3]||(v[3]=u=>B(u)),onTouchstart:v[4]||(v[4]=u=>D(u)),onTouchend:v[5]||(v[5]=u=>M())},[Lt,t.chooseType==="day"?(d(),i("div",qt,[(d(!0),i(A,null,O(_(p),(u,C)=>(d(),i("div",{key:C,class:"item"},[l("div",{class:b(["day",[_(s)(u).isToday()?"td":"",_(s)(u).diff(_(s)())>=0?"after":"befer"]]),onClick:f=>F(u)},[l("div",{class:b([_(s)(t.selectDay).format("YYYY-MM-DD")===_(s)(u).format("YYYY-MM-DD")&&"checked-day"])},I(_(s)(u).date()),3)],10,Rt)]))),128))])):q("",!0)],32)]),U(o,{show:r.value,position:"bottom",style:{height:"40%"}},{default:nt(()=>[U(x,{modelValue:m.value,"onUpdate:modelValue":v[6]||(v[6]=u=>m.value=u),type:"year-month",title:"\u9009\u62E9\u5E74\u6708","min-date":g.value,"max-date":k.value,formatter:Y,onConfirm:R,onCancel:v[7]||(v[7]=u=>r.value=!1)},null,8,["modelValue","min-date","max-date"])]),_:1},8,["show"])])}}});const J=t=>(Dt("data-v-321adea9"),t=t(),_t(),t),Xt={class:"day-line"},Jt={class:"item"},zt=J(()=>l("div",{class:"tm"},"\u5168\u5929",-1)),Gt={class:"event"},Wt={key:0,class:"event-detail allday"},jt=J(()=>l("div",{class:"tl"},null,-1)),Ht=["onClick"],Pt={class:"tm"},Qt={class:"event"},Kt={key:0,class:"curt-time"},Zt=J(()=>l("div",{class:"left-dot"},null,-1)),te=J(()=>l("div",{class:"right-line"},null,-1)),ee=[Zt,te],ae=J(()=>l("div",{class:"tl"},null,-1)),se=["onClick"],ne=["src"],oe=X({props:{list:{type:Array,default:()=>[]},date:{type:s,default:()=>""}},emits:["handle-detail"],setup(t,{emit:n}){const e=t,{getIconUrl:a}=ct(),p=G(),{list:h}=ot(e),r={\u5BA2\u6237:"customer",\u56E2\u961F:"team",\u6D3B\u52A8:"activity",\u5B66\u4E60:"learning",\u62DB\u52DF:"recruit",\u5176\u4ED6:"others"},m=()=>{p.push({name:"addSchedule",query:{chooseDate:s(e.date).format(),chooseType:"day"}})},g=k=>{n("handle-detail",k.contentId,k.mold)};return(k,Y)=>(d(),i("div",Xt,[l("div",Jt,[zt,l("div",Gt,[(d(!0),i(A,null,O(_(h),(D,B)=>(d(),i("div",{key:B},[D.isAllDay==="Y"?(d(),i("div",Wt,[jt,l("div",{class:"detail",onClick:M=>g(D)},I(D.title),9,Ht)])):q("",!0)]))),128))])]),(d(!0),i(A,null,O(_($t),(D,B)=>(d(),i("div",{key:B,class:"item"},[l("div",Pt,I(D.lable),1),l("div",Qt,[_(s)().hour()===D.value&&_(s)(t.date).format("YYYY-MM-DD")===_(s)().format("YYYY-MM-DD")?(d(),i("div",Kt,ee)):q("",!0),(d(!0),i(A,null,O(_(h),(M,w)=>(d(),i("div",{key:w},[_(s)(M.startTime).hour()===D.value&&M.isAllDay==="N"?(d(),i("div",{key:0,class:b(["event-detail",[M.status==="Y"&&"done",r[M.type]]])},[ae,l("div",{class:"detail",onClick:N=>g(M)},I(M.title),9,se)],2)):q("",!0)]))),128))])]))),128)),l("div",{class:"add-btn",onClick:m},[l("img",{src:_(a)("schedule.add"),alt:""},null,8,ne)])]))}});var ce=Ct(oe,[["__scopeId","data-v-321adea9"]]),ue="/static/assets/down.62de96aa.png",le="/static/assets/empty01.cbbab7c5.png";const Z=(t,n)=>{const e=s(t).startOf("month"),a=s(t).endOf("month"),p=s(e).day(),h=s(a).diff(e,"day")+1;console.log("monthDays",h);const r=[];for(let m=0;m<h;m++){const g=k=>s(e).add(m,"day").format(k);r.push({currentMonth:0,day:(p+m)%7,date:g(n),month:g("M"),days:g("D"),valueOf:s(e).add(m,"day").unix()})}return r},de=(t,n,e)=>e===0?[]:[...Z(s(t).subtract(1,"month"),n)].map(h=>j(W({},h),{currentMonth:-1})).slice(-e),re=(t,n,e)=>{if(e===0)return[];const p=[...Z(s(t).add(1,"month"),n)].map(h=>j(W({},h),{currentMonth:1}));return p.splice(e),p},st=(t,n)=>n===-1?t===0?6:t-1:t===0?t:7-t,ie=(t=s(),n)=>{const e=Z(t,n),a=e[0].day,p=e[e.length-1].day;return[...de(t,n,st(a,-1)),...e,...re(t,n,st(p,1))]};const he={class:"cal-schedule"},me=X({props:{item:{type:Object,default:()=>{}}},emits:["on-click"],setup(t,{emit:n}){const e=t,a=E(!1),p=G();gt(()=>{a.value=e.item.status==="Y"});const h=async()=>{await Et({contentId:e.item.contentId,status:e.item.status==="Y"?"N":"Y"}),n("on-click"),kt(e.item.status==="Y"?"\u4E8B\u9879\u91CD\u65B0\u6253\u5F00":"\u606D\u559C\u4F60 \u5B8C\u6210\u4E86\u4E00\u4E2A\u4E8B\u9879")},r=g=>{switch(g){case"\u5BA2\u6237":return"tag2";case"\u56E2\u961F":return"tag0";case"\u5B66\u4E60":return"tag1";case"\u62DB\u52DF":return"tag3";case"\u5176\u4ED6":return"tag4";case"\u6D3B\u52A8":return"tag5";default:return"tag0"}},m=(g,k)=>{p.push({name:"addSchedule",query:{contentId:g,chooseType:"month",mold:k}})};return(g,k)=>{const Y=z("van-checkbox");return d(),i("div",he,[l("div",{class:b(["schedule-item",[t.item.status==="Y"&&"disable"]])},[U(Y,{modelValue:a.value,"onUpdate:modelValue":k[0]||(k[0]=D=>a.value=D),shape:"square",onClick:h},null,8,["modelValue"]),l("span",{class:b(["comm",[r(t.item.type)]])},I(t.item.type),3),l("div",{class:"tl",onClick:k[1]||(k[1]=D=>m(t.item.contentId,t.item.mold))},I(t.item.title),1)],2)])}}});const ye=["onClick"],ve={key:1},fe=l("div",{class:"tg-color"},null,-1),pe=K(" \u5C55\u5F00\u65E5\u5386 "),De=l("img",{src:ue,class:"img"},null,-1),_e=[pe,De],ge={key:0,class:"calendat-schedule"},ke={key:0},Ye=l("img",{src:le,class:"emt"},null,-1),Me=l("p",{class:"p1"},"\u6682\u65E0\u65E5\u7A0B\u5B89\u6392",-1),xe=l("p",{class:"p2"},"\u60F3\u505A\u70B9\u4EC0\u4E48\uFF1F\u70B9\u51FB\u521B\u5EFA\u8BB0\u5F55\u4E0B\u6765",-1),$e=K("\u521B\u5EFA\u65E5\u7A0B"),Ce=["src"],Ee=X({props:{dataList:{type:Object,default:()=>{}},format:{type:String,default:"YYYY-MM-DD"},date:{type:Date,default:new Date}},emits:["change-month"],setup(t,{expose:n,emit:e}){const a=t,{getIconUrl:p}=ct(),h={\u5BA2\u6237:"customer",\u56E2\u961F:"team",\u6D3B\u52A8:"activity",\u5B66\u4E60:"learning",\u62DB\u52DF:"recruit",\u5176\u4ED6:"others"},r=E(),m=E(!0),g=E([]),k=G(),Y={touching:!1,trace:[]},D=async o=>{const{data:u}=await ut({day:s(o).format("YYYY-MM-DD")});g.value=u.data||[]},B=()=>{D(r.value.date)},M=Yt(()=>ie(new Date(a.date),a.format)),w=(o,u)=>M.value[(o-1)*7+(u-1)],N=o=>{var f,T,V;const u=[],C=s().format(a.format);return o.currentMonth!==0&&u.push("pass-day"),o.date<C,o.date>C,console.log(o.date,(f=r.value)==null?void 0:f.date,!m.value,888),o.date===((T=r.value)==null?void 0:T.date)&&!m.value&&(console.log(o.date,(V=r.value)==null?void 0:V.date,!m.value),u.push("checked-day")),o.date===C&&u.push("month-today"),u.join(" ")},F=o=>{let u=[],C=0;return Object.keys(a.dataList).forEach(f=>{Number(f)===s(o.date).date()&&o.currentMonth===0&&(u=a.dataList[f])}),C=u.findIndex(f=>f.status==="N"),{arr:u,flag:C}},L=()=>{D(),r.value={date:s().format("YYYY-MM-DD")}},S=o=>{m.value=o,o&&(r.value=null)},y=o=>{sessionStorage.setItem("currentMonth",JSON.stringify(o)),P.emit("changeOtherMonth",o.currentMonth),r.value=o,console.log("checkDay.value?????",r.value.date),D(o.date),S(!1)},$=o=>{const u=o[0],C=o[o.length-1];if(C.x-u.x>50&&Math.abs(C.y-u.y)<20){console.log("\u4E0A\u6708");const f=s(a.date).add(-1,"month").startOf("month");e("change-month",f)}else if(u.x-C.x>50){console.log("\u4E0B\u6708");const f=s(a.date).add(1,"month").startOf("month");e("change-month",f)}},R=o=>{if(o.touches.length!==1){Y.touching=!1,Y.trace=[];return}Y.touching=!0,Y.trace=[{x:o.touches[0].screenX,y:o.touches[0].screenY}]},c=o=>{!Y.touching||Y.trace.push({x:o.touches[0].screenX,y:o.touches[0].screenY})},v=()=>{if(!Y.touching)return;const{trace:o}=Y;Y.touching=!1,Y.trace=[],$(o)},x=()=>{k.push({name:"addSchedule",query:{chooseDate:r.value&&r.value.date||s().format(),chooseType:"month"}})};return Q(()=>{}),n({resetDate:L,todayData:g,handleDay:y}),(o,u)=>{const C=z("van-button");return d(),i(A,null,[l("div",{class:"calendat-month",onTouchmove:u[1]||(u[1]=f=>c(f)),onTouchstart:u[2]||(u[2]=f=>R(f)),onTouchend:u[3]||(u[3]=f=>v())},[(d(!0),i(A,null,O(_(M).length/7,f=>(d(),i("div",{key:f,class:"month-row"},[(d(),i(A,null,O(7,T=>l("div",{key:`${f}-${T}`,class:b(["month-day",[m.value&&"expan-height"]])},[l("div",{class:"com-flex",onClick:V=>y(w(f,T))},[l("div",{class:b([N(w(f,T))])},I(w(f,T).days.toString()),3),m.value?(d(),i("div",ve,[(d(!0),i(A,null,O(F(w(f,T)).arr.slice(0,3),(V,dt)=>(d(),i("div",{key:dt,class:b(["day-sch",[V.status==="Y"&&"done",h[V.type]]])},[fe,l("div",null,I(V.title),1)],2))),128))])):(d(),i("div",{key:0,class:b(["dat",[F(w(f,T)).arr.length>0?"":"dat-hid",F(w(f,T)).flag===-1&&"dat-done"]])},null,2))],8,ye)],2)),64))]))),128)),m.value?q("",!0):(d(),i("div",{key:0,class:"expan-can",onClick:u[0]||(u[0]=f=>S(!0))},_e))],32),m.value?q("",!0):(d(),i("div",ge,[g.value.length===0?(d(),i("div",ke,[Ye,Me,xe,U(C,{type:"primary",class:"btn",onClick:x},{default:nt(()=>[$e]),_:1})])):(d(!0),i(A,{key:1},O(g.value,(f,T)=>(d(),H(me,{key:T,item:f,onOnClick:B},null,8,["item"]))),128))])),l("div",{class:"can-add-btn",onClick:x},[l("img",{src:_(p)("schedule.add"),alt:""},null,8,Ce)])],64)}}});const we={class:"schedule"},Fe=X({setup(t){var S;const n=G(),e=Mt(),a=E(new Date),p=sessionStorage.getItem("currentDay");sessionStorage.removeItem("currentDay");const h=E(p?s(p):((S=e.query)==null?void 0:S.isTomorrow)==="Y"?s().add(1,"day"):s()),r=E(sessionStorage.getItem("schedule_type")||"day"),m=E(),g=xt({dayData:[],monthData:[]}),{dayData:k,monthData:Y}=ot(g),D=async y=>{const{data:$}=await ut({day:s(y).format("YYYY-MM-DD")});k.value=$.data},B=async y=>{const{data:$}=await wt({yearMonth:s(y).format("YYYY-MM")});Y.value=$.data.scheduleMonth};Q(()=>{var y;if(r.value==="day"&&D(p),r.value==="month"){B();const $=sessionStorage.getItem("currentMonth");m.value&&$&&(m.value.handleDay(JSON.parse($)),sessionStorage.removeItem("currentMonth"))}sessionStorage.removeItem("schedule_type"),((y=e.query)==null?void 0:y.isTomorrow)==="Y"&&D(h.value)});const M=y=>{console.log(y,11),a.value=y,m.value.todayData=[],B(y)},w=y=>{window.scrollTo(0,0),r.value=y,y==="month"&&(a.value=new Date,B()),y==="day"&&(h.value=s(),D())},N=(y,$)=>{sessionStorage.setItem("currentDay",h.value),n.push({name:"addSchedule",query:{contentId:y,chooseType:"day",mold:$}})},F=y=>{console.log(y),h.value=s(y),D(y)},L=()=>{var y;h.value=s(),D(),m.value&&(M(new Date),(y=m.value)==null||y.resetDate())};return(y,$)=>(d(),i("div",we,[U(Ut,{"choose-type":r.value,"select-month":a.value,"select-day":h.value,onChangeMonth:M,onChangeType:w,onClickDay:F,onClickToday:L},null,8,["choose-type","select-month","select-day"]),r.value==="day"?(d(),H(ce,{key:0,list:_(k),date:h.value,onHandleDetail:N},null,8,["list","date"])):(d(),H(Ee,{key:1,ref_key:"calendarRef",ref:m,date:a.value,"data-list":_(Y),onChangeMonth:M},null,8,["date","data-list"]))]))}});export{Fe as default};
