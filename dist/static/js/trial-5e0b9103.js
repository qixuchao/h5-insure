import{d as e,i as a,j as o,k as t,l as s,o as i,p as l,w as r,a as d,e as u,b as c,u as n,q as p,c as v,F as m,s as f,v as k,_ as R,T as C,z as L,az as I,aA as y,A as h,aB as j,aC as g,aD as b,h as _,aE as w,aF as q,aG as T,f as P,aH as N}from"./index-c51609f0.js";import S from"./index-4dfa1361.js";import{a as x,b as V,g as A,s as M,i as D,m as K}from"./trial-65451a5d.js";import{R as E}from"./trial-c4d1a79a.js";import{_ as B}from"./TrialButton-d33cc034.js";import{u as O}from"./useOrder-ce8543e9.js";import{p as F,a as z}from"./utils-6aca78ad.js";import{q as U}from"./createProposal-4e85526d.js";import{g as H}from"./util-aa40439c.js";import{f as $,a as G}from"./findLastIndex-62ea668c.js";import{c as J}from"./cloneDeep-4739f4a5.js";import"./InsureInfos-efbc191a.js";import"./index-de590a0b.js";import"./index-f97bf81a.js";import"./infoCollection-d6b918a5.js";import"./index-7abb83a2.js";import"./PolicyInfo-febde2ed.js";import"./questionnaire-42dcb602.js";import"./product-7bbf9c44.js";import"./utils-82fc05b7.js";import"./constants-7afb7c3d.js";import"./nextStep-cbd132c3.js";import"./core-7fad25dc.js";import"./format-31cde443.js";import"./index-0b2f1235.js";import"./utils-84030229.js";const Q={class:"popup-container"},W={class:"popup-header"},X={class:"title"},Y=(e=>(g("data-v-9f30e43a"),e=e(),b(),e))((()=>d("p",{class:"tip"},"已为您挑选出以下险种",-1))),Z={class:"search"},ee={key:0,class:"risk-list"},ae=e({name:"riskSelect"});var oe=R(e({...ae,props:{type:{default:2},show:{type:Boolean,default:!1},title:{},insuredList:{default:()=>[]},mainRiskCode:{default:""},selectList:{default:()=>[]},currentProductCode:{default:""}},emits:["cancel","confirm"],setup(e,{emit:R}){const g=e,b=a(),{insurerCode:_}=b.query,w=o([]),q=o([]),T=o([]),P=o(),N=t((()=>g.show)),S=()=>{R("cancel")},A=()=>{var e;if(!(null==(e=w.value)?void 0:e.length))return void C(`暂未添加任何${g.type===E.MAIN_RISK?"主":"附加"}险`);let a=[];a=g.type===E.RIDER_RISK?w.value:q.value.filter((e=>w.value.includes(e.productCode))).map((e=>({productCode:e.productCode,mergeRiskReqList:(e.mainRiskCollocationList||[]).map((e=>({riskCode:e.collocationRiskCode,riskType:e.mainRiskCode?2:1,mainRiskCode:e.mainRiskCode})))}))),R("confirm",a)},M=async()=>{var e;const a={insuredList:g.insuredList,mainRiskCode:g.mainRiskCode,insurerCode:_,productCategory:"",keyword:P.value,selectProductCodes:[],selectRiskCodes:[],filterFlag:(null==(e=g.selectList)?void 0:e.length)?1:2};if(a.selectProductCodes=g.selectList.map((e=>(e.productCode===g.currentProductCode&&a.selectRiskCodes.push(...e.mergeRiskReqList.map((e=>e.riskCode))),e.productCode))),g.type===E.MAIN_RISK){const{code:e,data:o}=await x(a);"10000"===e&&(q.value=o)}else{const{code:e,data:o}=await V(a);"10000"===e&&(q.value=o.riskInfoList,T.value=o.collocationInfoResList)}};return s((()=>{M()})),(e,a)=>{const o=L,t=I,s=y,R=h,C=j;return i(),l(C,{show:n(N),"onUpdate:show":a[2]||(a[2]=e=>p(N)?N.value=e:null),class:"popup-risk-select",closeable:!1},{default:r((()=>{var C;return[d("div",Q,[d("div",W,[d("span",{class:"clear-all",onClick:S}," 取消 "),d("span",X,u(e.title),1),d("span",{class:"close",onClick:A},"确认")]),Y,d("div",Z,[c(o,{modelValue:n(P),"onUpdate:modelValue":a[0]||(a[0]=e=>p(P)?P.value=e:null),placeholder:"请输入产品名称进行搜索",onSearch:M},null,8,["modelValue"])]),(null==(C=n(q))?void 0:C.length)?(i(),v("div",ee,[c(s,{modelValue:n(w),"onUpdate:modelValue":a[1]||(a[1]=e=>p(w)?w.value=e:null)},{default:r((()=>[(i(!0),v(m,null,f(n(q),(e=>(i(),l(t,{key:e.riskCode||e.productCode,name:e.riskCode||e.productCode,onClick:()=>{return a=e.riskCode,g.type===E.RIDER_RISK&&(T.value||[]).forEach((e=>{w.value.includes(a)?a===e.relatedRiskCode?(2===e.collocationType&&w.value.push(e.collocationRiskCode),3===e.collocationType&&(w.value.push(a),w.value=w.value.filter((a=>a!==e.collocationRiskCode)))):a===e.collocationRiskCode&&(2===e.collocationType&&w.value.push(e.relatedRiskCode),3===e.collocationType&&(w.value=w.value.filter((a=>a!==e.relatedRiskCode)))):a===e.relatedRiskCode?(2===e.collocationType&&(w.value=w.value.filter((a=>a!==e.collocationRiskCode))),3===e.collocationType&&(w.value.push(a),w.value=w.value.filter((a=>a!==e.collocationRiskCode)))):a===e.collocationRiskCode&&(2===e.collocationType&&(w.value=w.value.filter((a=>a!==e.relatedRiskCode))),3===e.collocationType&&(w.value=w.value.filter((a=>a!==e.relatedRiskCode))))})),void(w.value=[...new Set(w.value)]);var a}},{default:r((()=>[k(u(e.riskName||e.productName),1)])),_:2},1032,["name","onClick"])))),128))])),_:1},8,["modelValue"])])):(i(),l(R,{key:1,title:`暂无关联${e.type===n(E).MAIN_RISK?"主":"附加"}险、请选择其他险种`},null,8,["title"]))])]})),_:1},8,["show"])}}}),[["__scopeId","data-v-9f30e43a"]]);const te={class:"page-trial-wrap"},se=e({name:"trial"}),ie=e({...se,setup(e){const d=a(),u=_(),{productCode:p,orderNo:m,tenantId:f,proposalId:k,proposalInsuredId:R}=d.query,C=o({}),L=o({productList:[]}),I=o([]),y=o({}),h=o(),j=o(),g=o(),b=O({extInfo:{buttonCode:w.TRIAL_PREMIUM,pageCode:q.TRIAL_PREMIUM}});H();const x=o(),V=o(),Q=o(1),W=t((()=>Q.value===E.MAIN_RISK?"添加主险":"添加附加险")),X=o(!1),Y=()=>{K(L.value).then((({code:e,data:a})=>{if("10000"===e){const{productDetailResList:e,productFactor:o}=a;V.value=o,L.value=z(e);const t={};e.forEach((e=>{t[e.productCode]=e})),C.value=t}}))},Z=()=>{X.value=!1},ee=e=>{if(Q.value===E.MAIN_RISK){L.value.productList.push(...e);const a=e.map((e=>e.productCode));h.value.getProductDefaultValue(a)}else{const a=L.value.productList.find((e=>e.productCode===j.value)),o=e.map((e=>({riskCode:e,riskType:E.RIDER_RISK,mainRiskCode:y.value.riskCode}))),t=$(a.mergeRiskReqList,(e=>e.riskCode===y.value.riskCode)),s=G(a.mergeRiskReqList,(e=>e.mainRiskCode===y.value.riskCode));let i=t;-1!==s&&(i=s),a.mergeRiskReqList=[...a.mergeRiskReqList.slice(0,i+1),...o,...a.mergeRiskReqList.slice(i+1,a.mergeRiskReqList.length)],h.value.getRiderRiskDefaultValue(j.value,e,y.value.riskCode,a.mergeRiskReqList)}Y(),X.value=!1},ae=(e,a,o)=>{X.value=!0,Q.value=E.RIDER_RISK,I.value=o,y.value=a,j.value=e},se=e=>{X.value=!0,Q.value=E.MAIN_RISK,I.value=e},ie=(e,a,o)=>{C.value[e],o?(C.value[e].productPlanInsureVOList[0].insureProductRiskVOList=C.value[e].productPlanInsureVOList[0].insureProductRiskVOList.filter((e=>e.riskCode!==a)),L.value.productList=L.value.productList.map((o=>(o.productCode===e&&(o.mergeRiskReqList=o.mergeRiskReqList.filter((e=>e.riskCode!==a))),o)))):(L.value.productList=L.value.productList.filter((a=>a.productCode!==e)),Y())},le=()=>{h.value.onNext((async e=>{var a;const o=J(e),t=["id","relationToHolder","beneficiaryList","guardian","insuredBeneficiaryType"];m||Object.keys(null==(a=o.insuredList)?void 0:a[0]).reduce(((e,a)=>{var s,i,l,r;return!t.includes(a)&&(null==(i=null==(s=o.insuredList)?void 0:s[0])?void 0:i[a])&&(e[a]=null==(r=null==(l=o.insuredList)?void 0:l[0])?void 0:r[a]),e}),o.holder),o.extInfo&&(o.extInfo.iseeBizNo=g.value);const{code:s,data:i}=await M(o);"10000"===s&&u.push({path:N.questionNotice,query:{...d.query,orderNo:i}})}))};return T((()=>{m?A({orderNo:m,tenantId:f}).then((({code:e,data:a})=>{"10000"===e&&(x.value=a,b.value=a,L.value=F(a.insuredList[0].productList),Y())})):k?U({id:k,tenantId:f}).then((({code:e,data:a})=>{if("10000"===e){const{holder:e,insuredList:o}=a,t=(p||"").split(",");let s=[];const i=(o||[]).filter((e=>e.id===+R)).map((e=>({...e,relationToHolder:null,productList:e.productList.filter((e=>!!t.includes(e.productCode)&&(s=e.occupationCodeList,!0)))})));i[0].occupationCodeList=s,Object.assign(b.value,{renewFlag:"",holder:e,tenantId:f,proposalId:k,insuredList:i}),x.value=b.value,L.value=F(b.value.insuredList[0].productList),Y()}})):D({productCode:p,isTenant:!1}).then((({data:e,code:a})=>{var o,t;"10000"===a&&(C.value[`${p}`]=e,V.value=null==(t=null==(o=null==e?void 0:e.productPlanInsureVOList)?void 0:o[0])?void 0:t.productFactor,L.value=z([e]))}))})),s((()=>{setTimeout((async()=>{g.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,a)=>(i(),v("div",te,[c(S,{ref_key:"trialRef",ref:h,"product-collection":n(C),"default-data":n(x),"product-factor":n(V),"product-risk-code-map":n(L),"is-trial":"","hide-benefit":"",onAddRisk:ae,onAddMainRisk:se,onDeleteRisk:ie},{trialBtn:r((({riskPremium:e})=>[c(B,{premium:null==e?void 0:e.initialPremium,onHandleClick:le},null,8,["premium"])])),_:1},8,["product-collection","default-data","product-factor","product-risk-code-map"]),n(X)?(i(),l(oe,{key:0,type:n(Q),show:n(X),"insured-list":n(I),title:n(W),"current-product-code":n(j),"main-risk-code":n(y).riskCode,"select-list":n(L).productList,onCancel:Z,onConfirm:ee},null,8,["type","show","insured-list","title","current-product-code","main-risk-code","select-list"])):P("",!0)]))}});export{ie as default};
