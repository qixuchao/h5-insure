import{d as e,h as s,i as t,j as a,O as o,o as i,l as r,w as l,a as d,e as u,b as c,u as n,c as p,m,F as f,n as v,_ as k,T as C,ao as j,ap as R,aq as I,ar as b,as as _,at as h,au as L,g as y,av as g,aw as x,q as P,s as w}from"./index-a3c15377.js";import{T as q}from"./index-fdc5001d.js";import{q as N,a as V,g as M,s as S,i as A,m as D}from"./trial-0f8ffd87.js";import{_ as O}from"./index-d4c9f564.js";import{S as K}from"./index-6d959cd9.js";import{R as T}from"./trial-ba75aeed.js";import{_ as E}from"./TrialButton-0a885527.js";import{u as B}from"./useOrder-c00b2635.js";import{B as F,P as U}from"./constants-71331306.js";import{p as $}from"./utils-6fc00a71.js";import"./debounce-6981b306.js";import"./isObjectLike-a9798079.js";import"./cloneDeep-5d541e55.js";import"./keysIn-131bbce9.js";import"./_getTag-0507d0b1.js";import"./InsureInfos-195d1fd5.js";import"./index-85b786dc.js";import"./get-4ac0f9ad.js";import"./infoCollection-de566c01.js";import"./index-965bea78.js";import"./empth-c0adfdba.js";import"./merge-e7788e50.js";import"./index-7a6b9f7e.js";import"./ProRenderFormWithCard.vue_vue_type_style_index_0_scoped_true_lang-42bf787b.js";import"./phoneVerify-0c603305.js";/* empty css              */import"./index-e90e719d.js";import"./useDicData-0f8b6ef2.js";import"./bankCard-7e0b096a.js";import"./lodash-501ea5dd.js";import"./index-450547c0.js";import"./search-6fc8dcc1.js";import"./product-585b0e6f.js";import"./constants-62ebe5d1.js";import"./utils-5296f1e3.js";import"./createProposal-c1247707.js";import"./nextStep-20168817.js";import"./core-dfa3de57.js";import"./constant-8927d485.js";import"./empty-ae586b6c.js";import"./index-ec2bc1e0.js";const W={class:"popup-container"},z={class:"popup-header"},G={class:"title"},H=(e=>(h("data-v-124bec92"),e=e(),L(),e))((()=>d("p",{class:"tip"},"已为您挑选出以下险种",-1))),J={class:"search"},Q={key:0,class:"risk-list"},X=e({name:"riskSelect"});var Y=k(e({...X,props:{type:{default:2},show:{type:Boolean,default:!1},title:null,insuredList:{default:()=>[]},mainRiskCode:{default:""},selectList:{default:()=>[]}},emits:["cancel","confirm"],setup(e,{emit:k}){const h=e,L=s(),{insurerCode:y}=L.query,g=t(),x=t([]),P=a((()=>h.show)),w=()=>{k("cancel")},q=()=>{g.value?k("confirm",g.value):C(`暂未添加任何${h.type===T.MAIN_RISK?"主":"附加"}险`)};return o((()=>{(async()=>{const e={insuredVO:h.insuredList,mainRiskCode:h.mainRiskCode,insurerCode:y,productCategory:"",selectProductCodes:[],selectRiskCodes:[]};if(e.selectProductCodes=h.selectList.map((s=>(e.selectRiskCodes.push(...s.mergeRiskReqList.map((e=>e.riskCode))),s.productCode))),h.type===T.MAIN_RISK){const{code:s,data:t}=await N(e);"10000"===s&&(x.value=t)}else{const{code:s,data:t}=await V(e);"10000"===s&&(x.value=t)}})()})),(s,t)=>{const a=K,o=j,k=R,C=I,h=b,L=O,y=_;return i(),r(y,{show:n(P),"onUpdate:show":t[1]||(t[1]=e=>m(P)?P.value=e:null),class:"popup-risk-select",closeable:!1},{default:l((()=>[d("div",W,[d("div",z,[d("span",{class:"clear-all",onClick:w}," 取消 "),d("span",G,u(e.title),1),d("span",{class:"close",onClick:q},"确认")]),H,d("div",J,[c(a,{shape:"round",placeholder:"请输入产品名称进行搜索"})]),n(x).length?(i(),p("div",Q,[c(h,{modelValue:n(g),"onUpdate:modelValue":t[0]||(t[0]=e=>m(g)?g.value=e:null)},{default:l((()=>[c(C,{inset:""},{default:l((()=>[(i(!0),p(f,null,v(n(x),(e=>(i(),r(k,{key:e.riskCode||e.productCode,title:e.riskName||e.productName,clickable:"",onClick:s=>g.value=e.riskCode||e.productCode},{icon:l((()=>[c(o,{name:e.riskCode||e.productCode},null,8,["name"])])),_:2},1032,["title","onClick"])))),128))])),_:1})])),_:1},8,["modelValue"])])):(i(),r(L,{key:1,title:`暂无关联${e.type===n(T).MAIN_RISK?"主":"附加"}险、请选择其他险种`},null,8,["title"]))])])),_:1},8,["show"])}}}),[["__scopeId","data-v-124bec92"]]);const Z={class:"page-trial-wrap"},ee=e({name:"trial"}),se=e({...ee,setup(e){const o=s(),d=y(),{productCode:u,orderNo:m,tenantId:f}=o.query,v=t({}),k=t({productList:[]}),C=t([]),j=t({}),R=t(),I=t(),b=B({extInfo:{templateId:201,buttonCode:F.TRIAL_PREMIUM,pageCode:U.TRIAL_PREMIUM}}),_=t(),h=t(1),L=a((()=>h.value===T.MAIN_RISK?"添加主险":"添加附加险")),N=t(!1),V=()=>{N.value=!1},O=e=>{if(h.value===T.MAIN_RISK)k.value.productList.push({productCode:e,mergeRiskReqList:[]}),R.value.getProductDefaultValue(e);else{k.value.productList.find((e=>e.productCode===I.value)).mergeRiskReqList.push({riskCode:e,riskType:T.RIDER_RISK,mainRiskCode:j.value.riskCode}),R.value.getRiderRiskDefaultValue(I.value,e,j.value.riskCode)}D(k.value).then((({code:e,data:s})=>{if("10000"===e){const{productDetailResList:e,productFactor:t}=s;_.value=t,k.value=$(e);const a={};e.forEach((e=>{a[e.productCode]=e})),v.value=a}})),N.value=!1},K=(e,s,t)=>{N.value=!0,h.value=T.RIDER_RISK,C.value=t,j.value=s,I.value=e},W=e=>{N.value=!0,h.value=T.MAIN_RISK,C.value=e},z=(e,s,t)=>{v.value[e],t?(v.value[e].productPlanInsureVOList[0].insureProductRiskVOList=v.value[e].productPlanInsureVOList[0].insureProductRiskVOList.filter((e=>e.riskCode!==s)),k.value.productList=k.value.productList.map((t=>(t.productCode===e&&(t.mergeRiskReqList=t.mergeRiskReqList.filter((e=>e.riskCode!==s))),t)))):(delete v.value[e],k.value.productList=k.value.productList.filter((s=>s.productCode!==e)))},G=()=>{R.value.onNext((async e=>{const{code:s,data:t}=await S(e);"10000"===s&&d.push({path:w.infoCollection,query:{...o.query,orderNo:t}})}))};return g((()=>{A({productCode:u,isTenant:!1}).then((({data:e,code:s})=>{var t,a;"10000"===s&&(v.value[`${u}`]=e,_.value=null==(a=null==(t=null==e?void 0:e.productPlanInsureVOList)?void 0:t[0])?void 0:a.productFactor,k.value=$([e]))})),m&&M({orderNo:m,tenantId:f}).then((({code:e,data:s})=>{"10000"===e&&(b.value=s)}))})),(e,s)=>(i(),p("div",Z,[c(q,{ref_key:"trialRef",ref:R,"product-collection":n(v),"default-value":n(b),"product-factor":n(_),"is-trial":"","hide-benefit":"",onAddRisk:K,onAddMainRisk:W,onDeleteRisk:z},{trialBtn:l((({riskPremium:e})=>[c(E,{premium:e.initialPremium,onClick:x(G,["stop"])},null,8,["premium","onClick"])])),_:1},8,["product-collection","default-value","product-factor"]),n(N)?(i(),r(Y,{key:0,type:n(h),show:n(N),"insured-list":n(C),title:n(L),"main-risk-code":n(j).riskCode,"select-list":n(k).productList,onCancel:V,onConfirm:O},null,8,["type","show","insured-list","title","main-risk-code","select-list"])):P("",!0)]))}});export{se as default};
