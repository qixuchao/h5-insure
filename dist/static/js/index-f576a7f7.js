var De=Object.defineProperty,ge=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var ie=Object.getOwnPropertySymbols;var Pe=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable;var de=(m,d,l)=>d in m?De(m,d,{enumerable:!0,configurable:!0,writable:!0,value:l}):m[d]=l,L=(m,d)=>{for(var l in d||(d={}))Pe.call(d,l)&&de(m,l,d[l]);if(ie)for(var l of ie(d))Te.call(d,l)&&de(m,l,d[l]);return m},P=(m,d)=>ge(m,he(d));import{g as me,E as A,_ as ae,r as O,j as E,k as N,m as c,z as u,p as f,n as Z,G as Ie,J as V,F as ve,C as w,a9 as Re,O as be,Q as xe,M as Fe,y as le,o as Ne,A as p,t as X,d as ce,T as Ve}from"./vendor-af6fda0a.js";import{_ as ke,z as He,w as Se,r as Ue,R as Y,T as F,n as we,P as $e}from"./index-58cf39d7.js";import{p as je}from"./trial-b8518ff2.js";import{g as fe,h as pe,e as Me}from"./trial-258c1e86.js";import{u as Ye}from"./useDicData-454f1fec.js";import{_ as oe,R as qe,B as Ge,a as ze,b as Je}from"./index-bb806145.js";const Ke={class:"com-select-container"},We={class:"radio-item-wrapper"},Qe={class:"name"},Xe={class:"hone"},Ze={class:"address"},et={class:"footer-button"},tt=w("\u53D6\u6D88"),nt=w("\u786E\u8BA4"),rt=me({props:{dataSource:{type:Array,default:()=>[]},show:{type:Boolean,default:!1},modelValue:{type:[String,Number],default:null}},emits:["update","update:modelValue","submit","close"],setup(m,{emit:d}){const l=m,T=A(l.modelValue),q=A(l.show),ee=()=>{d("submit",T.value),q.value=!1},te=()=>{d("close")};return ae(()=>l.modelValue,$=>{console.log("newVal",$),T.value=$}),ae(()=>T.value,$=>{d("update:modelValue",$)}),($,k)=>{const Q=O("van-radio"),G=O("van-radio-group"),z=O("VanButton");return E(),N(He,{show:q.value,"onUpdate:show":k[1]||(k[1]=B=>q.value=B),class:"com-select",title:"\u9009\u62E9\u4FDD\u5355\u901A\u8BAF\u4FE1\u606F",onClose:te},{default:c(()=>[u("div",Ke,[f(G,{modelValue:T.value,"onUpdate:modelValue":k[0]||(k[0]=B=>T.value=B)},{default:c(()=>[(E(!0),Z(ve,null,Ie(m.dataSource,(B,H)=>(E(),N(Q,{key:H,name:H+1,class:"radio-item"},{default:c(()=>[u("div",We,[u("p",null,[u("span",Qe,V(B.contactName),1),u("span",Xe,V(B.contactPhoneNo),1)]),u("p",Ze,V(B.contactAddress),1)])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),u("div",et,[f(z,{plain:"",type:"primary"},{default:c(()=>[tt]),_:1}),f(z,{type:"primary",onClick:ee},{default:c(()=>[nt]),_:1})])]),_:1},8,["show"])}}});var ot=ke(rt,[["__scopeId","data-v-9c6de82e"]]);const at={key:0,class:"beneficiary-part"},st={class:"part-title"},ut={class:"title"},it=w("\u5220\u9664"),dt=w("+\u6DFB\u52A0\u53D7\u76CA\u4EBA"),lt=w("\u9009\u62E9\u4FDD\u5355\u901A\u8BAF\u4FE1\u606F"),ct={class:"radio-item-wrapper"},ft={class:"name"},pt={class:"hone"},mt={class:"address"},It={class:"footer-button","safe-area-inset-bottom":""},vt={class:"left"},Ot={class:"trial-result"},_t=w(" \u9996\u671F"),Et={class:"result-num"},Lt=u("div",{class:"result-desc"},"\u5B9E\u9645\u4FDD\u8D39\u4EE5\u540E\u7EED\u4E3A\u51C6",-1),yt={class:"operate-btn"},Ct=w("\u4E0B\u4E00\u6B65"),Rt=me({setup(m){const d=Re(),l=be(),{templateId:T=1,orderNo:q="2022072710380711215",productCode:ee,tenantId:te="9991000007",proposalId:$,insurerCode:k="kunlunhealth"}=l.query,[Q,G]=xe(),z=l.path==="/infoPreview"?"infoPreview":"infoCollection",B=Ye("NATIONAL_REGION_CODE"),H=A({}),e=A({extInfo:{pageCode:z},tenantOrderHolder:{extInfo:{occupationCodeList:[]},holderType:1},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},insuredBeneficiaryType:"1",tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}]}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}}),ne=A(null),R=A([]),j=A([]),J=A([]),re=A([]),se=A([]),b=Fe({beneficiaryId:0,nextPage:"",currentAddress:null,isLoading:!0}),ue=le(()=>{var t,i,s,r,a,I,v,D,g,h;return[{contactAddress:(i=(t=e.value.tenantOrderHolder)==null?void 0:t.extInfo)==null?void 0:i.familyAddress,contactName:e.value.tenantOrderHolder.name,contactPhoneNo:e.value.tenantOrderHolder.mobile},{contactAddress:(r=(s=e.value.tenantOrderHolder)==null?void 0:s.extInfo)==null?void 0:r.workAddress,contactName:e.value.tenantOrderHolder.name,contactPhoneNo:e.value.tenantOrderHolder.mobile},{contactAddress:(I=(a=e.value.tenantOrderInsuredList[0])==null?void 0:a.extInfo)==null?void 0:I.familyAddress,contactName:(v=e.value.tenantOrderInsuredList[0])==null?void 0:v.name,contactPhoneNo:(D=e.value.tenantOrderInsuredList[0])==null?void 0:D.mobile},{contactAddress:(h=(g=e.value.tenantOrderInsuredList[0])==null?void 0:g.extInfo)==null?void 0:h.workAddress,contactName:e.value.tenantOrderInsuredList[0].name,contactPhoneNo:e.value.tenantOrderInsuredList[0].mobile}].filter(y=>y.contactAddress&&y.contactName&&y.contactPhoneNo)||[]}),K=le(()=>{var o,t;return b.currentAddress?ue.value[b.currentAddress-1]||{}:((t=(o=e.value.extInfo)==null?void 0:o.contactInfo)==null?void 0:t[0])||{}}),Oe=o=>{const t={};return o.map(i=>{const{initialAmount:s,annuityDrawFrequency:r,annuityDrawType:a,paymentFrequency:I,paymentPeriod:v,paymentPeriodType:D,insurancePeriodType:g,insurancePeriodValue:h,riskCode:y,riskType:S,initialPremium:M,liabilityDetails:U,extInfo:C}=i,{riskId:x,copy:n}=C,_={amount:s,annuityDrawDate:r,annuityDrawType:a,paymentFrequency:I,riskId:x,copy:n,chargePeriod:v?`${fe[D]}_${v}`:fe[D],coveragePeriod:h?`${pe[g]}_${h}`:pe[g],riskCode:y,riskType:S,premium:M,liabilityVOList:U};return S===Me.MAIN_RISK?(t.mainRiskCode=y,t.mainRiskId=x):Object.assign(_,t),_})},_e=()=>{var t;const o=L({},e.value);o.extInfo=P(L({},o.extInfo),{contactInfo:[K.value]}),o.tenantOrderAttachmentList=[{category:Y.OBVERSE_CERT,objectType:F.HOLDER,objectId:e.value.tenantOrderHolder.id,name:"\u6295\u4FDD\u4EBA\u8BC1\u4EF6\u6B63\u9762",uri:R.value[0],id:J.value[0]},{category:Y.REVERSE_CERT,objectType:F.HOLDER,objectId:e.value.tenantOrderHolder.id,name:"\u6295\u4FDD\u4EBA\u8BC1\u4EF6\u80CC\u9762",uri:R.value[1],id:J.value[1]},{category:Y.OBVERSE_CERT,objectType:F.INSURED,objectId:e.value.tenantOrderInsuredList[0].id,name:"\u88AB\u4FDD\u4EBA\u8BC1\u4EF6\u6B63\u9762",uri:j.value[0]||R.value[0],id:re.value[1]},{category:Y.REVERSE_CERT,objectType:F.INSURED,objectId:e.value.tenantOrderInsuredList[0].id,name:"\u88AB\u4FDD\u4EBA\u8BC1\u4EF6\u80CC\u9762",uri:j.value[1]||R.value[1],id:re.value[1]}],(t=ne.value)==null||t.validate().then(i=>{if(o.tenantOrderInsuredList[0].insuredBeneficiaryType===Je.SPECIFY){const s={};if(o.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.forEach(r=>{s[r.benefitOrder]?s[r.benefitOrder].sum+=Number(r.benefitRate):s[r.benefitOrder]={sum:Number(r.benefitRate)}}),Object.values(s).some(r=>r.sum!==100)){Ve.fail("\u540C\u4E00\u987A\u4F4D\u7684\u53D7\u76CA\u4EBA\u6BD4\u4F8B\u4E4B\u548C\u5FC5\u987B\u4E3A100");return}}we(o).then(({code:s,data:r})=>{s==="10000"&&r.pageAction.pageAction==="jumpToPage"&&d.push({path:$e[r.pageAction.data.nextPageCode],query:l.query})})})},Ee=()=>{var o;(o=ne.value)==null||o.validate().then(()=>{const{birthday:t,gender:i,extInfo:s}=e.value.tenantOrderHolder,{hasSocialInsurance:r,occupationCodeList:a}=s,{birthday:I,gender:v,extInfo:D,tenantOrderProductList:g}=e.value.tenantOrderInsuredList[0],{hasSocialInsurance:h,occupationCodeList:y}=D,S={holder:{personVO:{birthday:ce(t).format("YYYY-MM-DD"),gender:i,socialFlag:r,occupationCodeList:a}},productCode:ee,insuredVOList:[{insurerCode:k,personVO:{birthday:ce(I).format("YYYY-MM-DD"),gender:v,socialFlag:h,occupationCodeList:y},productPlanVOList:[{insurerCode:k,planCode:"",riskVOList:Oe(g[0].tenantOrderRiskList)}]}]};je(L({},S)).then(({code:M,data:U})=>{if(M==="10000"){const C={},x=(n=[])=>{(n||[]).forEach(_=>{var W;C[_.riskCode]=_,((W=_.riskPremiumDetailVOList)==null?void 0:W.length)&&x(_.riskPremiumDetailVOList)})};x(U.riskPremiumDetailVOList),e.value.tenantOrderInsuredList[0].tenantOrderProductList[0]=P(L({},e.value.tenantOrderInsuredList[0].tenantOrderProductList[0]),{premium:U.premium,tenantOrderRiskList:e.value.tenantOrderInsuredList[0].tenantOrderProductList[0].tenantOrderRiskList.map(n=>P(L({},n),{initialAmount:C[n.riskCode].amount,initialPremium:C[n.riskCode].premium}))}),_e()}})})},Le=o=>{console.log("value",o)},ye=()=>{b.beneficiaryId+=1,e.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.push({id:b.beneficiaryId,extInfo:{}})},Ce=o=>{e.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList=e.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.filter(t=>t.beneficiaryId!==o.beneficiaryId||o.id!==t.id)},Ae=()=>{Ue({orderNo:q,tenantId:te}).then(({code:o,data:t})=>{var i,s;if(o==="10000"){const r=t;r.extInfo=P(L({},r.extInfo),{pageCode:z,templateId:T}),r.tenantOrderHolder=r.tenantOrderHolder||{holderType:1},r.tenantOrderHolder.extInfo=P(L({},r.tenantOrderHolder.extInfo),{occupationCodeList:((i=r.tenantOrderHolder.extInfo)==null?void 0:i.occupationCodeList)||[]}),r.tenantOrderInsuredList[0].extInfo=P(L({},r.tenantOrderInsuredList[0].extInfo),{occupationCodeList:((s=r.tenantOrderInsuredList[0].extInfo)==null?void 0:s.occupationCodeList)||[]}),r.tenantOrderInsuredList[0].tenantOrderBeneficiaryList=r.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.map(a=>{var v;const I=a;return I.extInfo=P(L({},I.extInfo),{occupationCodeList:((v=I.extInfo)==null?void 0:v.occupationCodeList)||[]}),I}),r.tenantOrderAttachmentList.forEach(a=>{a.category===Y.OBVERSE_CERT?a.objectType===F.HOLDER?(R.value[0]=a.uri,J.value[0]=a.id):a.objectType===F.INSURED&&(j.value[0]=a.uri,re.value[0]=a.id):a.category===Y.REVERSE_CERT&&(a.objectType===F.HOLDER?(R.value[1]=a.uri,J.value[1]=a.id):a.objectType===F.INSURED&&(j.value[1]=a.uri,J.value[1]=a.id))}),Object.assign(e.value,r)}}).finally(()=>{b.isLoading=!1})},Be=()=>{Object.assign(e.value.tenantOrderInsuredList[0],e.value.tenantOrderHolder,{id:e.value.tenantOrderInsuredList[0].id,extInfo:P(L({},e.value.tenantOrderHolder.extInfo),{insureProvinceCode:e.value.tenantOrderInsuredList[0].extInfo.insureProvinceCode,insureCityCode:e.value.tenantOrderInsuredList[0].extInfo.insureCityCode,insureAreaCode:e.value.tenantOrderInsuredList[0].extInfo.insureAreaCode})})};return Ne(()=>{Ae(),Se({pageCode:"infoCollection",templateId:T}).then(({code:o,data:t})=>{if(o==="10000"){const i={BENEFICIARY:[],INSURER:[],HOLDER:[]};t.productInsureFactorList.forEach(s=>{(i[s.moduleType]=i[s.moduleType]||[]).push(s)}),H.value=i}})}),ae([()=>e.value.tenantOrderInsuredList[0].relationToHolder,()=>e.value.tenantOrderHolder],()=>{`${e.value.tenantOrderInsuredList[0].relationToHolder}`===ze.SELF&&Be()},{deep:!0,immediate:!0}),(o,t)=>{const i=O("ProCard"),s=O("ProRadioButton"),r=O("ProField"),a=O("ProCascader"),I=O("ProSvg"),v=O("VanButton"),D=O("ProCheckButton"),g=O("van-cell"),h=O("ProForm"),y=O("ProPageWrap");return E(),N(y,{class:"page-info-wrapper"},{default:c(()=>{var S,M,U,C,x;return[p(b).isLoading?X("",!0):(E(),N(h,{key:0,ref_key:"formRef",ref:ne},{default:c(()=>[f(i,{title:"\u6295\u4FDD\u4EBA"},{default:c(()=>[f(oe,{images:R.value,"onUpdate:images":t[0]||(t[0]=n=>R.value=n),"form-info":e.value.tenantOrderHolder,"factor-list":H.value.HOLDER,prefix:"holder"},null,8,["images","form-info","factor-list"])]),_:1}),f(i,{title:"\u88AB\u4FDD\u4EBA"},{default:c(()=>[f(r,{modelValue:e.value.tenantOrderInsuredList[0].relationToHolder,"onUpdate:modelValue":t[2]||(t[2]=n=>e.value.tenantOrderInsuredList[0].relationToHolder=n),label:"\u4E3A\u8C01\u4FDD\u5355",name:"relationToHolder",placeholder:"\u8BF7\u9009\u62E9"},{input:c(()=>[f(s,{modelValue:e.value.tenantOrderInsuredList[0].relationToHolder,"onUpdate:modelValue":t[1]||(t[1]=n=>e.value.tenantOrderInsuredList[0].relationToHolder=n),options:p(qe)},null,8,["modelValue","options"])]),_:1},8,["modelValue"]),+e.value.tenantOrderInsuredList[0].relationToHolder!=1?(E(),N(oe,{key:0,images:j.value,"onUpdate:images":t[3]||(t[3]=n=>j.value=n),"form-info":e.value.tenantOrderInsuredList[0],"factor-list":H.value.INSURER||[],prefix:"insure"},null,8,["images","form-info","factor-list"])):X("",!0),f(a,{modelValue:e.value.tenantOrderInsuredList[0].extInfo.insureAreaCode,"onUpdate:modelValue":t[4]||(t[4]=n=>e.value.tenantOrderInsuredList[0].extInfo.insureAreaCode=n),field1:e.value.tenantOrderInsuredList[0].extInfo.insureProvinceCode,"onUpdate:field1":t[5]||(t[5]=n=>e.value.tenantOrderInsuredList[0].extInfo.insureProvinceCode=n),field2:e.value.tenantOrderInsuredList[0].extInfo.insureCityCode,"onUpdate:field2":t[6]||(t[6]=n=>e.value.tenantOrderInsuredList[0].extInfo.insureCityCode=n),field3:e.value.tenantOrderInsuredList[0].extInfo.insureAreaCode,"onUpdate:field3":t[7]||(t[7]=n=>e.value.tenantOrderInsuredList[0].extInfo.insureAreaCode=n),label:"\u6295\u4FDD\u5730\u533A",name:"insureAreaCode",placeholder:"\u8BF7\u9009\u62E9","is-link":"",required:"","data-source":p(B),mapping:{label:"name",value:"code",children:"children"}},null,8,["modelValue","field1","field2","field3","data-source"])]),_:1}),f(i,{title:"\u53D7\u76CA\u4EBA"},{default:c(()=>[f(r,{modelValue:e.value.tenantOrderInsuredList[0].insuredBeneficiaryType,"onUpdate:modelValue":t[9]||(t[9]=n=>e.value.tenantOrderInsuredList[0].insuredBeneficiaryType=n),label:"\u53D7\u76CA\u4EBA\u7C7B\u578B",name:"insuredBeneficiaryType",placeholder:"\u8BF7\u9009\u62E9"},{input:c(()=>[f(s,{modelValue:e.value.tenantOrderInsuredList[0].insuredBeneficiaryType,"onUpdate:modelValue":t[8]||(t[8]=n=>e.value.tenantOrderInsuredList[0].insuredBeneficiaryType=n),options:p(Ge)},null,8,["modelValue","options"])]),_:1},8,["modelValue"]),e.value.tenantOrderInsuredList[0].insuredBeneficiaryType==2?(E(),Z("div",at,[(E(!0),Z(ve,null,Ie(e.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList,(n,_)=>(E(),Z("div",{key:n.beneficiaryId||n.id,class:"beneficiary-item"},[u("div",st,[u("span",ut,V(`\u53D7\u76CA\u4EBA${_+1}`),1),f(I,{name:"delete",onClick:W=>Ce(n)},{default:c(()=>[it]),_:2},1032,["onClick"])]),f(oe,{images:se.value,"onUpdate:images":t[10]||(t[10]=W=>se.value=W),"form-info":n,"factor-list":H.value.BENEFICIARY||[],prefix:`beneficiary-${_}`,"beneficiary-list":e.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList},null,8,["images","form-info","factor-list","prefix","beneficiary-list"])]))),128)),f(v,{onClick:ye},{default:c(()=>[dt]),_:1})])):X("",!0)]),_:1}),f(i,{title:"\u4FDD\u5355\u901A\u8BAF\u4FE1\u606F"},{default:c(()=>{var n;return[((n=Object.keys(p(K)))==null?void 0:n.length)?(E(),N(g,{key:1,title:"\u5355\u5143\u683C","is-link":"",onClick:t[12]||(t[12]=_=>p(G)(!0))},{title:c(()=>[u("div",ct,[u("p",null,[u("span",ft,V(p(K).contactName),1),u("span",pt,V(p(K).contactPhoneNo),1)]),u("p",mt,V(p(K).contactAddress),1)])]),_:1})):(E(),N(D,{key:0,activated:"",onClick:t[11]||(t[11]=_=>p(G)(!0))},{default:c(()=>[lt]),_:1}))]}),_:1})]),_:1},512)),u("div",It,[u("div",vt,[u("div",Ot,[_t,u("span",Et,"\uFFE5"+V((x=(C=(U=(M=(S=e.value.tenantOrderInsuredList)==null?void 0:S[0])==null?void 0:M.tenantOrderProductList)==null?void 0:U[0].premium)==null?void 0:C.toLocaleString)==null?void 0:x.call(C)),1)]),Lt]),u("div",yt,[f(v,{block:"",type:"primary",onClick:Ee},{default:c(()=>[Ct]),_:1})])]),p(Q)?(E(),N(ot,{key:1,modelValue:p(b).currentAddress,"onUpdate:modelValue":t[13]||(t[13]=n=>p(b).currentAddress=n),show:p(Q),"data-source":p(ue),onSubmit:Le,onClose:t[14]||(t[14]=n=>p(G)(!1))},null,8,["modelValue","show","data-source"])):X("",!0)]}),_:1})}}});export{Rt as default};
