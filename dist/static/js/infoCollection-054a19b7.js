import{d as e,ae as a,af as t,i as o,j as l,r as n,aH as i,l as s,c7 as u,o as r,c as d,b as c,u as f,p,w as v,f as m,q as I,v as h,aP as y,aG as g,aF as C,aN as O,aQ as L,ai as b,c8 as j,T as w,bJ as x,ak as P,al as _,ag as N}from"./index-460c0153.js";import{P as V,a as F}from"./PolicyInfo-3c9f34d0.js";import{s as E,g as k,m as D}from"./trial-1402e9bc.js";import{_ as T}from"./TrialButton-3f483d10.js";import{n as R}from"./nextStep-18ff634b.js";import{u as U}from"./useAttachment-a477dcb0.js";import"./infoCollection-d9cad4fb.js";import"./trial-e12e2e8f.js";import{u as q}from"./useOrder-2f92a31b.js";import{t as S}from"./utils-c6cf9b65.js";import A from"./index-88eebd3d.js";import{p as M}from"./utils-f22b0005.js";import"./index-8ddcf62a.js";import"./format-31cde443.js";import"./core-54ea4cd0.js";import"./utils-ca69a306.js";import"./createProposal-c8e7155e.js";import"./cloneDeep-eef9132f.js";import"./InsureInfos-bc61a150.js";import"./index-de590a0b.js";import"./index-7115685c.js";import"./index-79c9363d.js";import"./questionnaire-42dcb602.js";import"./util-1f97618f.js";import"./product-7bbf9c44.js";import"./constants-7afb7c3d.js";const B={class:"long-info-collection"},H=e({name:"InfoCollection"}),J=e({...H,setup(e){const H=a((()=>t((()=>import("./index-a6bc8b57.js")),["static/js/index-a6bc8b57.js","static/css/index-fa4edf2a.css","static/js/index-460c0153.js","static/css/index-d294c49a.css","static/js/theme-94cf7d00.js","static/js/index-8ddcf62a.js","static/css/index-bbfdd7ec.css","static/js/utils-ca69a306.js","static/js/infoCollection-d9cad4fb.js","static/js/trial-e12e2e8f.js"]))),J=a((()=>t((()=>import("./index-48f9c2e4.js")),["static/js/index-48f9c2e4.js","static/css/index-bf024e9b.css","static/js/index-460c0153.js","static/css/index-d294c49a.css"]))),G=o(),$=q(),{productCode:z="",tenantId:Q,agentCode:Y="",agencyCode:K,saleChannelId:W,isShare:X,orderNo:Z,extraInfo:ee,insurerCode:ae,preview:te}=G.query;let oe={},le=null;const ne=l(2);try{oe=JSON.parse(decodeURIComponent(ee))}catch(He){}const ie={moduleType:7,subModuleType:null,code:"renewFlag",title:"保单领取方式",planCode:null,displayName:null,defaultValue:null,isHidden:null,isReadOnly:null,isMustInput:1,isExtend:null,regex:null,displayType:6,datasource:null,factorScript:null,isCalculationFactor:2,attributeValueList:[{code:"1",value:"是",defaultFlag:null,useFlag:null},{code:"2",value:"否",defaultFlag:null,useFlag:null}],position:null,remark:""},se=n({isView:!1,personalInfo:{},payInfo:{schema:[],config:[],formData:[]},policyInfo:{schema:[],config:[],formData:{}},defaultValue:null,isAutoChange:!1,defaultPlanCode:"",userData:{}}),ue=`${window.origin}/baseInsurance/long/phoneVerify${window.location.search}`,re=l({imgUrl:"",desc:"",title:"",link:ue}),de=l();l();const ce=l(),fe=l({}),pe=l({}),ve=l([]),me=l(),Ie=l({}),he=l(!1),ye=l(!1),ge=l(0),Ce=l(!0),{fileList:Oe,mustReadFileCount:Le,popupFileList:be}=U(Ie,me),je=l(!1),we=l(!1),xe=()=>{ye.value=!1,Ce.value=!0,ve.value.length<1||(he.value=!0)},Pe=()=>{he.value=!1,ye.value=!1,Ce.value=!0};l({}),l(!1),l([{}]);const _e=l(""),Ne=l({}),Ve=l(!1);l();const Fe=l();l();const Ee=l(0);l({});const ke=l(),De=()=>{_e.value="试算中...",Ne.value=null,Ve.value=!0},Te=(e,a)=>{_e.value="",Ee.value=e.premium,Ne.value=e,ke.value=a,Ve.value=!1},Re=l(!1),Ue=async()=>{var e,a;if(te)return void y(g.INFO_COLLECTION,G.query);if(!Ne.value)return;const t=[];ce.value&&t.push(null==(e=ce.value)?void 0:e.validate(!1)),de.value&&t.push(null==(a=de.value)?void 0:a.validate(!1)),Promise.all(t).then((e=>{Object.assign($.value,{extInfo:{...$.value.extInfo,buttonCode:C.INFO_COLLECTION,pageCode:g.INFO_COLLECTION}});const a=ce.value.dealMixData(),t=S({...a,productCode:z,productName:pe.value.productName},Ne.value,$.value);G.query.productClass=ne.value;const o=(()=>{var e,a;const{holder:t,insuredList:o}=se.userData,l=[],n=(e,a)=>{e.ocrData&&Object.keys(e.ocrData).find((a=>(e[a]||e.ocrData[a])&&e.ocrData[a]!==e[a]))&&l.push(`${a}信息影像识别与录入信息不一致，请确认`)};return n(t,"投保人"),n(null==o?void 0:o[0],"被保人"),((null==(e=null==o?void 0:o[0])?void 0:e.beneficiaryList)||[]).forEach(((e,a)=>{n(e,`受益人${a+1}`)})),n(null==o?void 0:o[0].guardian,"监护人"),n(null==o?void 0:o[0].guardian,"监护人"),((null==(a=$.value)?void 0:a.tenantOrderPayInfoList)||[]).forEach((e=>{n(null==o?void 0:o[0].guardian,"银行卡")})),l})();Re.value=!0,(null==o?void 0:o.length)?O.confirm({message:null==o?void 0:o[0]}).then((()=>{clearInterval(le),R(t,((e,a)=>{Re.value=!1,a===L.JUMP_PAGE&&b(e.nextPageCode,G.query)}),G)})):(clearInterval(le),R(t,((e,a)=>{Re.value=!1,a===L.JUMP_PAGE&&b(e.nextPageCode,G.query)}),G))}),(e=>{j(".long-info-collection",".van-field--error")})).catch((e=>{console.log("e",e)}))},qe=e=>{const a=$.value.tenantOrderPayInfoList[0];$.value.tenantOrderPayInfoList.splice(0,1,{...a,...e})},Se=e=>{Object.assign(se.userData,e)},Ae=l({}),Me=l(),Be=async()=>{let e={};Z&&await k({orderNo:Z,tenantId:Q}).then((({code:a,data:t})=>{var o;if("10000"===a){if((null==(o=t.insuredList)?void 0:o.length)>0){const{planCode:e}=t.insuredList[0];se.defaultPlanCode=e}Object.assign($.value,t,{tenantOrderPayInfoList:t.tenantOrderPayInfoList||[],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0,withPayInfo:!0},productCode:z}),se.defaultValue=$.value,e=M(t.insuredList[0].productList),ne.value=t.insuredList[0].productList.length>1?1:2,we.value=!0}})),await D(e).then((({data:e,code:a})=>{var t;if("10000"===a){const{productDetailResList:a,productFactor:o}=e,l=(e=>{const a=[];return e.forEach((e=>{var t;const{insureProductRiskVOList:o}=(null==(t=e.productPlanInsureVOList)?void 0:t[0])||{};o.reduce(((e,a)=>{const{riskFixedRuleVO:{guaranteedRenewalFlag:t},riskCode:o}=(null==a?void 0:a.riskDetailResVO)||{};return t===N.YES&&e.push(o),e}),a)})),a})(a);Object.assign($.value.extInfo,{renewRisk:l.join(",")}),(null==l?void 0:l.length)&&((null==(t=o[7])?void 0:t.length)?o[7].push(ie):o[7]=[ie]),Me.value=o;const n={};a.forEach((e=>{n[e.productCode]=e})),Ae.value=n;const{payInfo:i,other:s}=x(Me.value);se.payInfo={...se.payInfo,...i},se.policyInfo={...se.policyInfo,...s}}}))};return i((()=>{Be()})),s((()=>{le=setInterval((()=>{(()=>{Object.assign($.value,{extInfo:{...$.value.extInfo,buttonCode:C.INFO_COLLECTION,pageCode:g.INFO_COLLECTION}});const e=ce.value.dealMixData(),a=S(e,Ne.value,$.value);a.orderStatus="collectInfo",E(a)})()}),3e4),setTimeout((async()=>{Fe.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),u((()=>{clearInterval(le)})),(e,a)=>{var t,o,l,n,i,s;const u=P,y=_;return r(),d("div",B,[c(u),f(we)||f(te)?(r(),p(A,{key:0,ref_key:"personalInfoRef",ref:ce,"product-info":{productCode:f(z),productName:f(pe).productName,insurerCode:f(ae),tenantId:f(Q),planList:[]},"tenant-product-detail":f(fe),"hide-benefit":"","product-collection":f(Ae),"default-data":f($),"product-factor":f(Me),onTrialStart:De,onTrialEnd:Te,"onUpdate:userData":Se,onUpdateBank:qe},{middleInfo:v((()=>[f(se).payInfo.schema.length?(r(),p(f(V),{key:0,ref_key:"payInfoRef",ref:de,modelValue:f($).tenantOrderPayInfoList,"onUpdate:modelValue":a[0]||(a[0]=e=>f($).tenantOrderPayInfoList=e),schema:f(se).payInfo.schema,"is-view":f(se).isView,"user-data":f(se).userData},null,8,["modelValue","schema","is-view","user-data"])):m("",!0),f(se).policyInfo.schema.length?(r(),p(f(F),{key:1,modelValue:f($).extInfo,"onUpdate:modelValue":a[1]||(a[1]=e=>f($).extInfo=e),schema:f(se).policyInfo.schema,"is-view":f(se).isView},null,8,["modelValue","schema","is-view"])):m("",!0)])),_:1},8,["product-info","tenant-product-detail","product-collection","default-data","product-factor"])):m("",!0),c(y,null,{default:v((()=>{var e;return[(null==(e=f(Oe))?void 0:e.length)?(r(),p(f(J),{key:0,modelValue:f(je),"onUpdate:modelValue":a[2]||(a[2]=e=>I(je)?je.value=e:null),"has-bg-color":!1,"attachment-list":f(Oe),"is-show-radio":"","pre-text":"投保人阅读并接受",onPreviewFile:a[3]||(a[3]=e=>(e=>{ge.value=e,ye.value=!0})(e))},null,8,["modelValue","attachment-list"])):m("",!0)]})),_:1}),f(ye)?(r(),p(f(H),{key:1,show:f(ye),"onUpdate:show":a[4]||(a[4]=e=>I(ye)?ye.value=e:null),"content-list":f(Ce)?f(Oe):f(be),"is-only-view":f(Ce),"active-index":f(ge),text:f(Ce)?"关闭":"我已逐页阅读并确认告知内容","force-read-count":f(Ce)?0:f(Le),onSubmit:xe,onOnCloseFilePreviewByMask:Pe},null,8,["show","content-list","is-only-view","active-index","text","force-read-count"])):m("",!0),c(T,{"is-share":f(re).isShare&&!f(X),premium:null==(t=f(Ne))?void 0:t.initialPremium,"share-info":f(re),"loading-text":f(_e),"payment-frequency":(null==(s=null==(i=null==(n=null==(l=null==(o=f(ke))?void 0:o.insuredList)?void 0:l[0].productList)?void 0:n[0].riskList)?void 0:i[0])?void 0:s.paymentFrequency)+"","tenant-product-detail":f(fe),"handle-share":e=>(e=>{ce.value.validateHolder(["mobile"]).then((()=>{Object.assign($.value,{extInfo:{...$.value.extInfo,buttonCode:C.INFO_COLLECTION,pageCode:g.INFO_COLLECTION}});const a=ce.value.getUserData(),t=S({...ke.value,holder:null==a?void 0:a.holder},Ne.value||{},$.value);R(t,((a,t)=>{t===L.JUMP_PAGE&&(null==e||e())}),G)})).catch((()=>{w("请录入投保人手机号后进行分享")}))})(e),disabled:!f(Ne)||f(Re),onHandleClick:Ue},{default:v((()=>[h("下一步 ")])),_:1},8,["is-share","premium","share-info","loading-text","payment-frequency","tenant-product-detail","handle-share","disabled"])])}}});export{J as default};
