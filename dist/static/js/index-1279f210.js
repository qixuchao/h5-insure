import{h as J,R as M,r as g,A as E,$ as H,k as I,m as h,s as A,F as Q,H as Z,B as a,t as k,L as B,C as m,n as C,p as f,x as S,G as L,a5 as ee,a6 as te,aa as me,P as _e,o as ke,U as ve,D as fe}from"./vendor-d350434b.js";import{u as Ie,P as he}from"./index-ef0bd474.js";import{q as Re,a as Le,b as Pe}from"./createProposal-af0ca908.js";import{_ as oe,R as X,L as De}from"./index-3cda190c.js";import{R as Fe}from"./index-f27bdc20.js";import{u as z}from"./useDicData-b9d06d36.js";import"./trial-d10f442f.js";import"./trial-38a8e06c.js";const U=R=>(ee("data-v-cd47605e"),R=R(),te(),R),ye={class:"com-product-list-wrapper"},ge={class:"risk-item-wrapper"},Ee={class:"content"},Be={class:"risk-premium"},Ce=L(" \u4FDD\u8D39:"),Ve={class:"premium"},be={class:"risk-factor"},$e={class:"factor"},Ae={class:"factor-value"},Se=U(()=>a("span",{class:"factor-name"}," \u4FDD\u989D(\u5143) ",-1)),Te={class:"factor"},Ne={class:"factor-value"},we=U(()=>a("span",{class:"factor-name"}," \u4FDD\u969C\u671F\u95F4 ",-1)),Oe={class:"factor"},xe={class:"factor-value"},Ue=U(()=>a("span",{class:"factor-name"}," \u7F34\u8D39\u671F\u95F4 ",-1)),qe={class:"operate-bar"},je=L("\u5220\u9664"),Me=U(()=>a("span",{class:"btn-plus"},"+",-1)),He=L(" \u9644\u52A0\u9669"),Ke=L("\u4FEE\u6539"),We={key:0,class:"premium-total"},Ye=L(" \u4FDD\u8D39: "),Ge={class:"premium"},Xe=J({props:{productRiskList:{default:()=>[]},productInfo:{default:()=>({})},productData:{default:()=>({})},pickProductPremium:{type:Function,default:()=>{}},productNum:{default:0}},emits:["deleteRisk","updateRisk","addRiderRisk"],setup(R,{emit:V}){const p=R,[P,F]=M(),_=g({checkedList:[],disabledList:[],riderRiskList:[],mainRiskData:{},totalPremium:0,currentRiskRecord:{},productRiskList:[]}),o=z("RISK_PAYMENT_PERIOD"),T=z("RISK_INSURANCE_PERIOD"),b=E(()=>{var i,r;return((r=(i=p.productData)==null?void 0:i.productRiskVoList)==null?void 0:r[0].riskDetailVOList.filter(u=>u.collocationType===1))||[]}),v=E(()=>{var u,d;const i=p.productRiskList.map(s=>s.riskId),r=(((d=(u=p.productData)==null?void 0:u.productRiskVoList)==null?void 0:d[0].riskDetailVOList)||[]).filter(s=>i.includes(s.id)&&s.collocationType===1);return b.value.length-r.length}),$=E(()=>i=>{var d,s;const r=((s=(d=p.productData)==null?void 0:d.productRiskVoList)==null?void 0:s[0].riskDetailVOList.find(y=>y.id!==i))||{};let u=!1;return p.productNum||r.riskType===2&&r.collocationType===1?u=!0:u=!1,u}),K=E(()=>{var r,u;return((u=(r=p.productData)==null?void 0:r.productRiskVoList)==null?void 0:u[0].riskDetailVOList.find(d=>d.riskType===1))||{}}),q=E(()=>K.value.collocationVOList||[]),l=i=>{V("deleteRisk",i,p.productInfo)},N=i=>{V("updateRisk",i,p.productInfo)},w=i=>{F(!0),_.value.currentRiskRecord=i},j=(i,r)=>{const u=i.map(d=>d.id).filter(d=>!_.value.disabledList.includes(d));V("addRiderRisk",u,p.productInfo)};return H(()=>p.productInfo,i=>{var u;let r=0;(i.proposalProductRiskList||[]).forEach(d=>{r+=d.premium}),(u=p.pickProductPremium)==null||u.call(p,{[`${i.productId}`]:r}),_.value.totalPremium=r},{deep:!0,immediate:!0}),H(()=>p.productRiskList,i=>{const r=[],u=[],d=[];(i||[]).forEach(s=>{s.riskType===1?r.unshift(s):(u.push(s.riskId),d.push(s.riskId),r.push(s))}),_.value.disabledList=u,_.value.checkedList=d,_.value.productRiskList=r},{deep:!0,immediate:!0}),(i,r)=>{const u=I("ProTitle"),d=I("ProCheckButton");return h(),A("div",ye,[(h(!0),A(Q,null,Z(_.value.productRiskList,s=>{var y,O;return h(),A("div",{key:s.riskId},[a("div",ge,[k(u,{"risk-type":s.riskType,title:s.riskName,class:"no-border"},null,8,["risk-type","title"]),a("div",Ee,[a("div",Be,[Ce,a("span",Ve,"\uFFE5"+B((y=s.premium)==null?void 0:y.toLocaleString()),1)]),a("div",be,[a("div",$e,[a("span",Ae,B((O=s.amount)==null?void 0:O.toLocaleString()),1),Se]),a("div",Te,[a("span",Ne,B(m(X)(m(T),s.coveragePeriod)),1),we]),a("div",Oe,[a("span",xe,B(m(X)(m(o),s.chargePeriod)),1),Ue])]),a("div",qe,[m($)(s.riskId)?(h(),C(d,{key:0,round:32,class:"border",onClick:x=>l(s)},{default:f(()=>[je]),_:2},1032,["onClick"])):S("",!0),m(v)?(h(),C(d,{key:1,activated:"",round:32,class:"btn-rider-risk",onClick:x=>w(s)},{default:f(()=>[Me,He]),_:2},1032,["onClick"])):S("",!0),k(d,{activated:"",round:32,onClick:x=>N(s)},{default:f(()=>[Ke]),_:2},1032,["onClick"])])])])])}),128)),_.value.productRiskList.length>1?(h(),A("div",We,[Ye,a("span",Ge,"\uFFE5"+B(_.value.totalPremium.toLocaleString()),1)])):S("",!0),m(P)?(h(),C(Fe,{key:1,modelValue:_.value.checkedList,"onUpdate:modelValue":r[0]||(r[0]=s=>_.value.checkedList=s),show:m(P),disabled:_.value.disabledList,"risk-list":m(b),"collocation-list":m(q),onFinished:j,onClose:r[1]||(r[1]=s=>m(F)(!1))},null,8,["modelValue","show","disabled","risk-list","collocation-list"])):S("",!0)])}}});var ze=oe(Xe,[["__scopeId","data-v-cd47605e"]]);const Je=R=>(ee("data-v-4f24fb6d"),R=R(),te(),R),Qe={class:"container"},Ze=Je(()=>a("span",{class:"plan-name"},"\u8BA1\u5212\u4E66\u540D\u79F0",-1)),et={class:"operate-bar"},tt=L("\u6DFB\u52A0\u4E3B\u9669"),ot={class:"footer-bar"},st={class:"trial-result"},rt=L("\u603B\u4FDD\u8D39"),ut={class:"result-num"},at={class:"trial-operate"},it=L("\u4FDD\u5B58\u5E76\u9884\u89C8"),lt=J({setup(R){const V=[{name:"\u4FDD\u5B58\u4FEE\u6539"},{name:"\u53E6\u5B58\u4E3A\u65B0\u8BA1\u5212\u4E66"}],[p,P]=M(),[F,_]=M(),o=g({proposalHolder:{},proposalInsuredList:[{name:"",gender:"",birthday:"",proposalInsuredProductList:[]}],proposalName:"",totalPremium:0,relationUserType:2}),T=me(),b=_e(),v=Ie(),{id:$,type:K="add",isCreateProposal:q}=b.query,l=g({productId:0,productCollection:{},productInfo:{},productPremium:{},riderRisk:{},type:"add",currentRisk:[]}),N=g();g({}),g([]),E(()=>({min:"",max:""}));const w=()=>{N.value.validate().then(()=>{Pe(o.value).then(({code:t,data:e})=>{t==="10000"&&(v.$reset(),v.proposalId=e,T.push({path:"/compositionProposal",query:{id:e}}))})})},j=()=>{!$&&v.proposalId?_(!0):w()},i=(t,e)=>{e&&(o.value.id=null),w()},r=(t,e,n)=>e?/^.{1,20}$/.test(e)?"":`${t}\u4E0D\u80FD\u8D85\u8FC720\u4E2A\u5B57\u7B26`:"",u=(t={})=>{Object.assign(l.value.productPremium,t),o.value.totalPremium=Object.values(l.value.productPremium).reduce((e,n)=>e+n,0)},d=(t,e)=>{const n=e;fe.confirm({message:"\u786E\u8BA4\u5220\u9664\u8BE5\u9669\u79CD\uFF1F"}).then(()=>{t.riskType===1?(o.value.proposalInsuredList[0].proposalInsuredProductList=o.value.proposalInsuredList[0].proposalInsuredProductList.filter(D=>D.productId!==n.productId),u({[n.productId]:0})):n.proposalProductRiskList=n.proposalProductRiskList.filter(D=>D.riskId!==t.riskId)})},s=(t,e)=>{l.value.productId=e.productId,l.value.productInfo=e,l.value.type="edit",l.value.currentRisk=[t.riskId],P(!0)},y=(t,e)=>{l.value.productId=e.productId,l.value.productInfo=e,l.value.type="addRiderRisk",l.value.currentRisk=t,P(!0)},O=(t={})=>{Re(t).then(({code:e,data:n})=>{e==="10000"&&Object.assign(o.value,n)})},x=t=>{o.value.proposalInsuredList[0].proposalInsuredProductList=o.value.proposalInsuredList[0].proposalInsuredProductList.map(e=>{let n=e;return e.productId===t.proposalInsuredList[0].proposalInsuredProductList[0].productId&&(n={...t.proposalInsuredList[0].proposalInsuredProductList[0]}),n}),P(!1)},se=t=>{Le(t).then(({code:e,data:n})=>{e==="10000"&&(l.value.productCollection=n)}).finally(()=>{})},re=()=>{v.setProposalInfo(o.value),v.setTrialData([]),v.setExcludeProduct(Object.keys(l.value.productCollection)),T.push({path:"/proposalList",query:{isCreateProposal:"1",...b.query}})},ue=()=>{P(!1)};return ke(()=>{const t=v.$state.trialData,e=v.$state.proposalInfo,n=v.$state.proposalId;$&&!q||n?(O({id:$||n}),v.$reset()):!Object.keys(e).length&&t.length?Object.assign(o.value,t[0]):Object.keys(e).length&&t.length?(e.proposalInsuredList[0].proposalInsuredProductList.push(...t[0].proposalInsuredList[0].proposalInsuredProductList),o.value=e):Object.keys(e).length&&!t.length&&(o.value=e),v.setTrialData([])}),H(()=>{var t;return(t=o.value.proposalInsuredList[0].proposalInsuredProductList)==null?void 0:t.length},()=>{const t=o.value.proposalInsuredList[0].proposalInsuredProductList.map(e=>({productId:e.productId,source:2}));se({voList:t})}),(t,e)=>{const n=I("VanField"),D=I("ProCard"),ae=I("ProDatePicker"),ie=I("ProRadioButton"),le=I("VanForm"),de=I("ProCheckButton"),ne=I("VanButton"),ce=I("VanActionSheet"),pe=I("ProPageWrap");return h(),C(pe,{class:"page-create-wrapper"},{default:f(()=>{var W;return[a("div",Qe,[k(le,{ref_key:"formRef",ref:N,"input-align":"right","error-message-align":"right"},{default:f(()=>[k(D,{"show-line":!1},{default:f(()=>[k(n,{modelValue:o.value.proposalName,"onUpdate:modelValue":e[0]||(e[0]=c=>o.value.proposalName=c),class:"border-radius",name:"proposalName",placeholder:"\u8BF7\u8F93\u5165\u8BA1\u5212\u4E66\u540D\u79F0",rules:[{validator:(...c)=>r("\u8BA1\u5212\u4E66\u540D\u79F0",...c)}]},{label:f(()=>[Ze]),_:1},8,["modelValue","rules"])]),_:1}),k(D,{title:"\u88AB\u4FDD\u4EBA\u4FE1\u606F"},{default:f(()=>[k(n,{modelValue:o.value.proposalInsuredList[0].name,"onUpdate:modelValue":e[1]||(e[1]=c=>o.value.proposalInsuredList[0].name=c),name:"name",label:"\u59D3\u540D",rules:[{validator:(...c)=>r("\u59D3\u540D",...c)}],placeholder:"\u8BF7\u8F93\u5165\uFF08\u9009\u586B\uFF09"},null,8,["modelValue","rules"]),k(ae,{modelValue:o.value.proposalInsuredList[0].birthday,"onUpdate:modelValue":e[2]||(e[2]=c=>o.value.proposalInsuredList[0].birthday=c),name:"birthday",label:"\u51FA\u751F\u65E5\u671F",type:"date","is-link":"",readonly:"",placeholder:"\u8BF7\u9009\u62E9",rules:[{required:!0,message:"\u8BF7\u9009\u62E9"}]},null,8,["modelValue"]),k(n,{modelValue:o.value.proposalInsuredList[0].gender,"onUpdate:modelValue":e[4]||(e[4]=c=>o.value.proposalInsuredList[0].gender=c),name:"gender",label:"\u6027\u522B",class:"border-radius",rules:[{required:!0,message:"\u8BF7\u9009\u62E9"}]},{input:f(()=>[k(ie,{modelValue:o.value.proposalInsuredList[0].gender,"onUpdate:modelValue":e[3]||(e[3]=c=>o.value.proposalInsuredList[0].gender=c),options:m(De)},null,8,["modelValue","options"])]),_:1},8,["modelValue"])]),_:1})]),_:1},512),(h(!0),A(Q,null,Z(o.value.proposalInsuredList[0].proposalInsuredProductList||[],c=>(h(),C(D,{key:c.productId,"show-line":!1},{default:f(()=>{var Y,G;return[k(ze,{"product-risk-list":c.proposalProductRiskList,"product-info":c,"product-num":((G=(Y=o.value.proposalInsuredList[0])==null?void 0:Y.proposalInsuredProductList)==null?void 0:G.length)-1,"product-data":l.value.productCollection[c.productId],"pick-product-premium":u,onAddRiderRisk:y,onUpdateRisk:s,onDeleteRisk:d},null,8,["product-risk-list","product-info","product-num","product-data"])]}),_:2},1024))),128)),a("div",et,[k(de,{activated:"",round:34,onClick:re},{default:f(()=>[tt]),_:1})])]),a("div",ot,[a("span",st,[rt,a("span",ut,"\uFFE5"+B(o.value.totalPremium.toLocaleString()),1)]),a("div",at,[k(ne,{type:"primary",onClick:j},{default:f(()=>[it]),_:1})])]),m(p)?(h(),C(he,{key:0,"is-show":m(p),type:l.value.type,"rider-risk":((W=l.value.riderRisk)==null?void 0:W[l.value.productId])||[],"product-data":l.value.productCollection[l.value.productId],"form-info":l.value.productInfo,holder:o.value.proposalHolder,insured:o.value.proposalInsuredList[0],"current-risk":l.value.currentRisk,onClose:ue,onFinished:x},null,8,["is-show","type","rider-risk","product-data","form-info","holder","insured","current-risk"])):S("",!0),k(ce,{show:m(F),"onUpdate:show":e[5]||(e[5]=c=>ve(F)?F.value=c:null),actions:V,"cancel-text":"\u53D6\u6D88","close-on-click-action":"",onCancel:e[6]||(e[6]=c=>m(_)(!1)),onSelect:i},null,8,["show"])]}),_:1})}}});var ft=oe(lt,[["__scopeId","data-v-4f24fb6d"]]);export{ft as default};
