import{T as e,d as a,i as l,j as s,z as n,cm as u,cn as t,o as i,c as o,a as r,f as v,u as c,q as d,b as g,w as p,a8 as m,e as f,F as h,n as y,l as S,co as w,m as _,_ as b,cp as k,cq as V,ag as C,cr as A}from"./index-c05ad1f7.js";var E=e;const T={class:"sign-wrap"},U=["src"],x={class:"popup-body"},R={class:"sign-container-wrap"},j={class:"operate-bar"},q=a({name:"sign"});var z=b(a({...q,props:{option:{default:{}},modelValue:{default:()=>[]},signString:{default:"房间卡贺卡和大伙副书记环境发好"},signAccount:{default:3}},emits:["update:modelValue","submitSign"],setup(e,{expose:a,emit:b}){const q=e,z=l(!1),I=l(),N=l([]),D=l(0),F=s((()=>{if(q.signString&&q.signString.length>=q.signAccount){const e=[];let a=0;for(let l=0;l<=q.signString.length;l++)!l||l%q.signAccount||(a+=1),q.signString[l]&&(e[a]?e[a]+=q.signString[l]:e[a]=q.signString[l]);return e}return[""]})),L=s((()=>{var e,a;return(null==(e=F.value)?void 0:e.length)!==(null==(a=N.value)?void 0:a.length)})),P=l(!0),$=l(),B=()=>{0!==D.value&&$.value&&(D.value-=1,$.value.swipeTo(D.value))},G=()=>{z.value=!0,I.value&&((I.value||[]).forEach(((e,a)=>{var l;a===D.value&&(null==(l=e.clear)||l.call(e))})),setTimeout((()=>{var e;(I.value||[]).forEach(((e,a)=>{var l,s;a===D.value&&(null==(s=e.setDataURL)||s.call(e,(null==(l=N.value)?void 0:l[a])||""))})),(null==(e=q.modelValue)?void 0:e.length)?P.value=!1:P.value=!0})))},H=()=>{k({images:N.value,className:"customer-sign-preview"})},J=()=>{z.value=!1},K=()=>{if(D.value===F.value.length-1)return;D.value,q.signAccount;F.value[D.value].length,$.value&&(D.value+=1,$.value.swipeTo(D.value))},M=()=>{(I.value||[]).forEach(((e,a)=>{var l;a===D.value&&(null==(l=e.clear)||l.call(e))}))},O=()=>{var e,a;if((null==(e=N.value)?void 0:e.length)!==(null==(a=F.value)?void 0:a.length))return void E({message:"请完成抄录",className:"toast-vertical"});const l=[];N.value.forEach((async(e,a)=>{l.push(V(e,270))})),Promise.all(l).then((e=>{e.map(((e,a)=>e)),b("update:modelValue",N.value),b("submitSign",N.value),z.value=!1}))};return n((()=>q.modelValue),(()=>{N.value=q.modelValue}),{immediate:!0,deep:!0}),a({rewrite:M,openSign:G}),(e,a)=>{var l;const s=C,n=u,b=t,k=A;return i(),o(h,null,[r("div",T,[v(e.$slots,"signImg",{data:null==(l=c(N))?void 0:l[0]},(()=>{var a;return[c(N).length?(i(),o("img",{key:0,class:"preview-sign",src:null==(a=c(N))?void 0:a[0],alt:"",onClick:H},null,8,U)):d("",!0),g(s,{type:"primary",round:"",size:"small",onClick:G},{default:p((()=>[m(f(e.signString?"重新签名":"点击签字"),1)])),_:1})]}),!0)]),g(k,{show:c(z),"onUpdate:show":a[1]||(a[1]=e=>_(z)?z.value=e:null),position:"bottom",style:{height:"100%",overflow:"hidden"}},{default:p((()=>[r("div",x,[r("div",R,[g(b,{ref_key:"swipeRef",ref:$,vertical:"",loop:!1,"show-indicators":!1,touchable:!1},{default:p((()=>[(i(!0),o(h,null,y(c(F),((e,l)=>(i(),S(n,{key:l},{default:p((()=>[g(w,{ref_for:!0,ref_key:"signRef",ref:I,modelValue:c(N)[l],"onUpdate:modelValue":e=>c(N)[l]=e,placeholder:e,onStroke:a[0]||(a[0]=e=>P.value=!1),onSignSuccess:K},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1024)))),128))])),_:1},512),r("div",j,[g(s,{type:"primary",class:"btn",disabled:c(L),onClick:O},{default:p((()=>[m("确定")])),_:1},8,["disabled"]),g(s,{type:"primary",plain:"",class:"btn",onClick:B},{default:p((()=>[m("上一页")])),_:1}),g(s,{type:"primary",plain:"",class:"btn",onClick:M},{default:p((()=>[m("重签")])),_:1}),g(s,{type:"default",class:"btn",onClick:J},{default:p((()=>[m("取消")])),_:1})])])])])),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-c5728146"]]);export{z as S};
