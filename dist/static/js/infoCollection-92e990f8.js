import{d as e,aV as a,aW as t,i as o,j as l,r as n,bc as i,l as s,ca as r,o as u,c as d,b as c,u as p,p as f,ak as v,w as m,f as h,q as I,v as y,bj as g,bb as L,ba as C,bi as k,bk as R,a_ as O,cb as b,T as w,bO as j,a$ as P,aX as _,aY as x}from"./index-4d5fa34d.js";import{P as V,a as D}from"./PolicyInfo-6b9907fb.js";import{g as E,m as q}from"./trial-7f683ad0.js";import{_ as F}from"./TrialButton-e7c83415.js";import{n as N}from"./nextStep-a03c6ded.js";import{u as T}from"./useAttachment-f4a1397a.js";import"./infoCollection-5f2115ca.js";import{R as U}from"./trial-ed50f9b6.js";import{u as S}from"./useOrder-a6e85070.js";import{t as A}from"./utils-4f369f99.js";import B from"./index-5985fe74.js";import{p as M,a as $}from"./utils-f5504a35.js";import{f as H,a as J}from"./findLastIndex-a17a8fa4.js";import"./cloneDeep-9c9c9929.js";import"./index-4b59d81b.js";import"./format-31cde443.js";import"./core-7b92637e.js";import"./utils-40b0d14f.js";import"./createProposal-6ed222b2.js";import"./InsureInfos-67056fea.js";import"./index-92e379ba.js";import"./index-df5dbe1e.js";import"./questionnaire-42dcb602.js";import"./util-304146fd.js";import"./product-7bbf9c44.js";import"./constants-6ad2f07c.js";const G={class:"long-info-collection"},z=e({name:"InfoCollection"}),K=e({...z,setup(e){const z=a((()=>t((()=>import("./index-d50ffe0d.js")),["static/js/index-d50ffe0d.js","static/css/index-fa4edf2a.css","static/js/index-4d5fa34d.js","static/css/index-59abbbb4.css","static/js/theme-94cf7d00.js","static/js/index-4b59d81b.js","static/css/index-bbfdd7ec.css","static/js/utils-40b0d14f.js","static/js/infoCollection-5f2115ca.js","static/js/trial-ed50f9b6.js"]))),K=a((()=>t((()=>import("./index-d5f9b4dd.js")),["static/js/index-d5f9b4dd.js","static/css/index-4822eb94.css","static/js/index-4d5fa34d.js","static/css/index-59abbbb4.css"]))),Y=a((()=>t((()=>import("./SelectRiskList-7d8cf286.js")),["static/js/SelectRiskList-7d8cf286.js","static/css/SelectRiskList-e1e05c2e.css","static/js/index-4d5fa34d.js","static/css/index-59abbbb4.css","static/js/trial-7f683ad0.js","static/js/trial-ed50f9b6.js"]))),W=o(),X=S({}),Q=l(!0),{productCode:Z="",tenantId:ee,agentCode:ae="",agencyCode:te,saleChannelId:oe,isShare:le,orderNo:ne,extraInfo:ie,insurerCode:se,preview:re}=W.query;let ue={},de=null;const ce=l(2);try{ue=JSON.parse(decodeURIComponent(ie))}catch(ia){}const pe={moduleType:7,subModuleType:null,code:"renewFlag",title:"保证续保型的一年期产品在保证续保期间是否申请续保",planCode:null,displayName:null,defaultValue:null,isHidden:null,isReadOnly:null,isMustInput:1,isExtend:null,regex:null,displayType:6,datasource:null,factorScript:null,isCalculationFactor:2,attributeValueList:[{code:"1",value:"是",defaultFlag:null,useFlag:null},{code:"2",value:"否",defaultFlag:null,useFlag:null}],position:null,remark:""},fe=n({isView:!1,personalInfo:{},payInfo:{schema:[],config:[],formData:[]},policyInfo:{schema:[],config:[],formData:{}},defaultValue:null,isAutoChange:!1,defaultPlanCode:"",userData:{}}),ve=`${window.origin}/baseInsurance/long/phoneVerify${window.location.search}`,me=l({imgUrl:"",desc:"",title:"",link:ve}),he=l(),Ie=l();l();const ye=l(),ge=l({}),Le=l({}),Ce=l([]),ke=l(),Re=l({}),Oe=l(!1),be=l(!1),we=l(0),je=l(!0),{fileList:Pe,mustReadFileCount:_e,popupFileList:xe}=T(Re,ke),Ve=l(!1),De=l(!1),Ee=()=>{be.value=!1,je.value=!0,Ce.value.length<1||(Oe.value=!0)},qe=()=>{Oe.value=!1,be.value=!1,je.value=!0};l({}),l(!1),l([{}]);const Fe=l(""),Ne=l({}),Te=l(!1);l();const Ue=l();l();const Se=l([]),Ae=l(0);l({});const Be=l(),Me=()=>{Fe.value="试算中...",Ne.value=null,Te.value=!0},$e=(e,a)=>{Fe.value="",Ae.value=e.premium,Ne.value=e,Be.value=a,Te.value=!1},He=l(!1),Je=l(),Ge=l({}),ze=l({productList:[]}),Ke=l({}),Ye=l(),We=(e,a)=>{var t;const o=[],l=a;return e.forEach((e=>{var a;const{insureProductRiskVOList:t}=(null==(a=e.productPlanInsureVOList)?void 0:a[0])||{};t.reduce(((e,a)=>{const{riskFixedRuleVO:{guaranteedRenewalFlag:t},riskCode:o}=(null==a?void 0:a.riskDetailResVO)||{};return t===x.YES&&e.push(o),e}),o)})),Object.assign(X.value.extInfo,{renewRisk:o.join(",")}),(null==o?void 0:o.length)?(null==(t=l[7])?void 0:t.length)?l[7].push(pe):l[7]=[pe]:l[7]=(l[7]||[]).filter((e=>e.code!==pe.code)),l},Xe=()=>{q(ze.value).then((({code:e,data:a})=>{if("10000"===e){const{productDetailResList:e,productFactor:t}=a;ze.value=$(e),Ye.value=We(e,t);const{other:o}=j(Ye.value);fe.policyInfo=o;const l={};e.forEach((e=>{l[e.productCode]=e})),Ke.value=l}}))},Qe=()=>{He.value=!1},Ze=e=>{const a=ze.value.productList.find((e=>e.productCode===Je.value)),t=e.map((e=>({riskCode:e,riskType:U.RIDER_RISK,mainRiskCode:Ge.value.riskCode}))),o=H(a.mergeRiskReqList,(e=>e.riskCode===Ge.value.riskCode)),l=J(a.mergeRiskReqList,(e=>e.mainRiskCode===Ge.value.riskCode));let n=o;-1!==l&&(n=l),a.mergeRiskReqList=[...a.mergeRiskReqList.slice(0,n+1),...t,...a.mergeRiskReqList.slice(n+1,a.mergeRiskReqList.length)],ye.value.getRiderRiskDefaultValue(Je.value,e,Ge.value.riskCode,a.mergeRiskReqList),Xe(),He.value=!1},ea=(e,a,t)=>{He.value=!0,Se.value=t,Ge.value=a,Je.value=e},aa=(e,a,t)=>{Ke.value[e],t?(Ke.value[e].productPlanInsureVOList[0].insureProductRiskVOList=Ke.value[e].productPlanInsureVOList[0].insureProductRiskVOList.filter((e=>e.riskCode!==a)),ze.value.productList=ze.value.productList.map((t=>(t.productCode===e&&(t.mergeRiskReqList=t.mergeRiskReqList.filter((e=>e.riskCode!==a))),t)))):(ze.value.productList=ze.value.productList.filter((a=>a.productCode!==e)),Xe())},ta=l(!1),oa=async()=>{var e,a,t;if(re)return void g(L.INFO_COLLECTION,W.query);if(!Ne.value)return;const o=[];ye.value&&o.push(null==(e=ye.value)?void 0:e.validate(!1)),he.value&&o.push(null==(a=he.value)?void 0:a.validate(!1)),Ie.value&&o.push(null==(t=Ie.value)?void 0:t.validate(!1)),Promise.all(o).then((e=>{Object.assign(X.value,{extInfo:{...X.value.extInfo,buttonCode:C.INFO_COLLECTION,pageCode:L.INFO_COLLECTION}});const a=ye.value.dealMixData(),t=A({...a,productCode:Z,productName:Le.value.productName},Ne.value,X.value);W.query.productClass=`${ce.value}`,delete W.query.canBack;const o=(()=>{var e,a;const{holder:t,insuredList:o}=fe.userData,l=[],n=(e,a)=>{e.ocrData&&Object.keys(e.ocrData).find((a=>(e[a]||e.ocrData[a])&&e.ocrData[a]!==e[a]))&&l.push(`${a}信息影像识别与录入信息不一致，请确认`)};return n(t,"投保人"),n(null==o?void 0:o[0],"被保险人"),((null==(e=null==o?void 0:o[0])?void 0:e.beneficiaryList)||[]).forEach(((e,a)=>{n(e,`受益人${a+1}`)})),n(null==o?void 0:o[0].guardian,"监护人"),n(null==o?void 0:o[0].guardian,"监护人"),((null==(a=X.value)?void 0:a.tenantOrderPayInfoList)||[]).forEach((e=>{n(null==o?void 0:o[0].guardian,"银行卡")})),l})();ta.value=!0,(null==o?void 0:o.length)?k.confirm({message:null==o?void 0:o[0]}).then((()=>{clearInterval(de),N(t,((e,a)=>{ta.value=!1,a===R.JUMP_PAGE&&O(e.nextPageCode,W.query)}),W)})):(clearInterval(de),N(t,((e,a)=>{ta.value=!1,a===R.JUMP_PAGE&&O(e.nextPageCode,W.query)}),W))}),(e=>{b(".long-info-collection",".van-field--error")})).catch((e=>{console.log("e",e)}))},la=e=>{const a=X.value.tenantOrderPayInfoList[0];X.value.tenantOrderPayInfoList.splice(0,1,{...a,...e})},na=e=>{Object.assign(fe.userData,e)};return i((()=>{(async()=>{w.loading("加载中..."),ne&&await E({orderNo:ne,tenantId:ee}).then((({code:e,data:a})=>{var t;if("10000"===e){if((null==(t=a.insuredList)?void 0:t.length)>0){const{planCode:e}=a.insuredList[0];fe.defaultPlanCode=e}Object.assign(X.value,a,{tenantOrderPayInfoList:a.tenantOrderPayInfoList||[],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0,withPayInfo:!0},productCode:Z}),fe.defaultValue=X.value,ze.value=M(a.insuredList[0].productList),ce.value=a.insuredList[0].productList.length>1?1:2,De.value=!0}})),await q(ze.value).then((({data:e,code:a})=>{if("10000"===a){const{productDetailResList:a,productFactor:t}=e;Ye.value=We(a,t);const o={};a.forEach((e=>{o[e.productCode]=e})),Ke.value=o;const{payInfo:l,other:n}=j(Ye.value);fe.payInfo={...fe.payInfo,...l},fe.policyInfo={...fe.policyInfo,...n},setTimeout((()=>{Q.value=!1}),500)}}))})()})),s((()=>{de=setInterval((()=>{}),3e4),setTimeout((async()=>{Ue.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),r((()=>{clearInterval(de)})),(e,a)=>{var t,o,l,n,i,s;const r=P,g=_;return u(),d("div",G,[c(r),p(De)||p(re)?(u(),f(B,{key:0,ref_key:"personalInfoRef",ref:ye,"product-info":{productCode:p(Z),productName:p(Le).productName,insurerCode:p(se),tenantId:p(ee),planList:[]},"tenant-product-detail":p(ge),"hide-benefit":"","product-collection":p(Ke),"default-data":p(X),"product-factor":p(Ye),"page-loading":p(Q),onTrialStart:Me,onTrialEnd:$e,"onUpdate:userData":na,onUpdateBank:la,onAddRisk:ea,onDeleteRisk:aa},v({_:2},[p(Q)?void 0:{name:"middleInfo",fn:m((()=>[p(fe).payInfo.schema.length?(u(),f(p(V),{key:0,ref_key:"payInfoRef",ref:he,modelValue:p(X).tenantOrderPayInfoList,"onUpdate:modelValue":a[0]||(a[0]=e=>p(X).tenantOrderPayInfoList=e),schema:p(fe).payInfo.schema,"is-view":p(fe).isView,"user-data":p(fe).userData},null,8,["modelValue","schema","is-view","user-data"])):h("",!0),p(fe).policyInfo.schema.length?(u(),f(p(D),{key:1,ref_key:"policyInfoRef",ref:Ie,modelValue:p(X).extInfo,"onUpdate:modelValue":a[1]||(a[1]=e=>p(X).extInfo=e),schema:p(fe).policyInfo.schema,"is-view":p(fe).isView},null,8,["modelValue","schema","is-view"])):h("",!0)])),key:"0"}]),1032,["product-info","tenant-product-detail","product-collection","default-data","product-factor","page-loading"])):h("",!0),c(g,null,{default:m((()=>{var e;return[(null==(e=p(Pe))?void 0:e.length)?(u(),f(p(K),{key:0,modelValue:p(Ve),"onUpdate:modelValue":a[2]||(a[2]=e=>I(Ve)?Ve.value=e:null),"has-bg-color":!1,"attachment-list":p(Pe),"is-show-radio":"","pre-text":"投保人阅读并接受",onPreviewFile:a[3]||(a[3]=e=>(e=>{we.value=e,be.value=!0})(e))},null,8,["modelValue","attachment-list"])):h("",!0)]})),_:1}),p(be)?(u(),f(p(z),{key:1,show:p(be),"onUpdate:show":a[4]||(a[4]=e=>I(be)?be.value=e:null),"content-list":p(je)?p(Pe):p(xe),"is-only-view":p(je),"active-index":p(we),text:p(je)?"关闭":"我已逐页阅读并确认告知内容","force-read-count":p(je)?0:p(_e),onSubmit:Ee,onOnCloseFilePreviewByMask:qe},null,8,["show","content-list","is-only-view","active-index","text","force-read-count"])):h("",!0),c(F,{"is-share":p(me).isShare&&!p(le),premium:null==(t=p(Ne))?void 0:t.initialPremium,"share-info":p(me),"loading-text":p(Fe),"payment-frequency":(null==(s=null==(i=null==(n=null==(l=null==(o=p(Be))?void 0:o.insuredList)?void 0:l[0].productList)?void 0:n[0].riskList)?void 0:i[0])?void 0:s.paymentFrequency)+"","tenant-product-detail":p(ge),"handle-share":e=>(e=>{ye.value.validateHolder(["mobile"]).then((()=>{Object.assign(X.value,{extInfo:{...X.value.extInfo,buttonCode:C.INFO_COLLECTION,pageCode:L.INFO_COLLECTION}});const a=ye.value.getUserData(),t=A({...Be.value,holder:null==a?void 0:a.holder},Ne.value||{},X.value);N(t,((a,t)=>{t===R.JUMP_PAGE&&(null==e||e())}),W)})).catch((()=>{w("请录入投保人手机号后进行分享")}))})(e),disabled:!p(Ne)||p(ta)||p(Q),onHandleClick:oa},{label:m((()=>[y(" 首年总保费 ")])),default:m((()=>[y("下一步 ")])),_:1},8,["is-share","premium","share-info","loading-text","payment-frequency","tenant-product-detail","handle-share","disabled"]),p(He)?(u(),f(p(Y),{key:2,type:p(U).RIDER_RISK,"product-class":p(ce),show:p(He),"insured-list":p(Se),title:"添加附加险","current-product-code":p(Je),"main-risk-code":p(Ge).riskCode,"select-list":p(ze).productList,onCancel:Qe,onConfirm:Ze},null,8,["type","product-class","show","insured-list","current-product-code","main-risk-code","select-list"])):h("",!0)])}}});export{K as default};
