var ie=Object.defineProperty,le=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable;var q=(d,s,E)=>s in d?ie(d,s,{enumerable:!0,configurable:!0,writable:!0,value:E}):d[s]=E,z=(d,s)=>{for(var E in s||(s={}))de.call(s,E)&&q(d,E,s[E]);if(Y)for(var E of Y(s))Be.call(s,E)&&q(d,E,s[E]);return d},G=(d,s)=>le(d,ce(s));import{g as Ee,P as fe,O as _e,E as x,d as De,h as Fe,r as b,j as F,k,m as _,z as t,p as D,J as v,L as J,n as m,t as Q,A as N,G as w,F as P,a5 as Ce,a6 as ve,C as y,T as I,D as Ae}from"./vendor-8ff1e78f.js";import{_ as he,S as pe,I as ge,q as W,l as R,J as K,N as X,n as me,P as ye,r as Ne}from"./index-70b1a785.js";import{g as Ie,f as Re,s as Z,a as Te}from"./verify-d13ddc46.js";const ee=d=>(Ce("data-v-eb3ef9fc"),d=d(),ve(),d),Oe={class:"page-verify"},Se={class:"people"},xe={class:"name"},be={class:"verify-item"},ke=ee(()=>t("div",{class:"label"},"\u8EAB\u4EFD\u8BC1\u53F7\u7801",-1)),we={class:"no"},Pe=y(" \u53BB\u8BA4\u8BC1 "),Le={class:"sign-body"},Ue={class:"date"},He={class:"file"},Me=y(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A "),Ve={class:"people"},$e={class:"name"},je={class:"verify-item"},Ye=ee(()=>t("div",{class:"label"},"\u8EAB\u4EFD\u8BC1\u53F7\u7801",-1)),qe={class:"no"},ze=["onClick"],Ge=y(" \u53BB\u8BA4\u8BC1 "),Je=["onClick"],Qe={class:"sign-body"},We={class:"date"},Ke={class:"file"},Xe=y(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A "),Ze={class:"footer-button footer"},eu=y("\u63D0\u4EA4"),uu=Ee({setup(d){const s={CERT:1,NO_CERT:2},E=fe(),ue=_e(),{saleUserId:L="D1234567-1",tenantId:p="9991000007",templateId:te=1,productCode:se="CQ75CQ76",insurerCode:tu="ancheng"}=E.query;let{orderNo:A}=E.query;typeof A=="object"&&(A=(A||[])[0]);const T=new pe({source:"localStorage"}),O=x([]),l=x(),g=x(),h=[],U=De().format("YYYY-MM-DD"),ae=()=>{var u;(u=g.value)==null||u.clear()},oe=u=>{h[u].clear()},H=(u,o)=>{Te({callbackUrl:window.location.href,certiNo:u,faceAuthMode:"TENCENT",userName:o,tenantId:9991000007}).then(n=>{const{code:r,data:i}=n;if(r==="10000"){const{originalUrl:f,serialNo:e}=i;window.location.href=f,T.set("verifyData",{serialNo:e,certNo:u,name:o})}})},M=u=>{var o,n,r,i;u===-1?H((o=l.value.tenantOrderHolder)==null?void 0:o.certNo,(n=l.value.tenantOrderHolder)==null?void 0:n.name):H((r=l.value.tenantOrderInsuredList[u])==null?void 0:r.certNo,(i=l.value.tenantOrderInsuredList[u])==null?void 0:i.name)},ne=u=>{u&&h.every(o=>o!==u)&&h.push(u)},re=()=>{var o,n,r,i;if((o=g.value)==null?void 0:o.isEmpty()){I.fail("\u8BF7\u6295\u4FDD\u4EBA\u7B7E\u540D");return}if(h.some(f=>f.isEmpty())){I.fail("\u8BF7\u88AB\u4FDD\u4EBA\u7B7E\u540D");return}if(((r=(n=l.value.tenantOrderHolder)==null?void 0:n.extInfo)==null?void 0:r.isCert)!==s.CERT){I.fail("\u8BF7\u6295\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}if((i=l.value.tenantOrderInsuredList)==null?void 0:i.some(f=>{var e;return((e=f.extInfo)==null?void 0:e.isCert)!==s.CERT})){I.fail("\u8BF7\u88AB\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}Ae.confirm({title:"\u63D0\u793A",message:"\u8BF7\u786E\u8BA4\u4FE1\u606F\u586B\u5199\u65E0\u8BEF\u540E\uFF0C\u518D\u8FDB\u884C\u652F\u4ED8"}).then(()=>{var e,B;const f=(e=g.value)==null?void 0:e.save();Promise.all([Z("HOLDER",f,(B=l.value)==null?void 0:B.id,`${p}`),...h.map(a=>{var c;return Z("INSURED",a.save(),(c=l.value)==null?void 0:c.id,`${p}`)})]).then(()=>{me(G(z({},l.value),{pageCode:"sign",operateOption:{withSignInfo:!0},extInfo:{pageCode:"sign",templateId:te},venderCode:"ancheng"})).then(a=>{const{code:c,data:C}=a;c==="10000"&&C.success&&ue.push({path:ye[C.pageAction.data.nextPageCode],query:{orderNo:A,saleUserId:L,tenantId:p}})})})})},V=()=>{Ne({orderNo:A,saleUserId:L,tenantId:p}).then(u=>{const{code:o,data:n}=u;o==="10000"&&(l.value=n,setTimeout(()=>{let r=0;n.tenantOrderAttachmentList.forEach(i=>{i.category===21&&(i.objectType===2?(g.value.clear(),g.value.setDataURL(i.fileBase64)):i.objectType===1&&(h[r].clear(),h[r].setDataURL(i.fileBase64),r+=1))})}))})};return Fe(()=>{V(),Ie({orderNo:A,productCode:se,tenantId:p}).then(o=>{const{code:n,data:r}=o;n==="10000"&&(O.value=r||[])});const u=T.get("verifyData");if(u){const{serialNo:o,certNo:n,name:r}=u;Re({certiNo:n,orderNo:A,serialNo:o,tenantId:p,userName:r}).then(i=>{const{code:f,data:e}=i;f==="10000"&&(T.remove("verifyData"),V())})}}),(u,o)=>{const n=b("ProPDFviewer"),r=b("van-button"),i=b("ProPageWrap");return F(),k(i,null,{default:_(()=>{var f;return[t("div",Oe,[D(ge,{type:"warning",title:"\u5C0A\u656C\u7684\u5BA2\u6237\uFF0C\u672C\u6B21\u6295\u4FDD\u9700\u8981\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",content:"\u672C\u4EA7\u54C1\u6295\u4FDD\u9700\u8981\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u8FDB\u884C\u5B9E\u540D\u8BA4\u8BC1\uFF0C\u60A8\u8D2D\u4E70\u672C\u4EA7\u54C1\u7684\u7D2F\u8BA1\u603B\u4FDD\u8D39\u5DF2\u8D85\u8FC720\u4E07\uFF0C\u6309\u76D1\u7BA1\u8981\u6C42\uFF0C\u9700\u8981\u63D0\u4F9B\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u3001\u6307\u5B9A\u53D7\u76CA\u4EBA\u8BC1\u4EF6\u5F71\u50CF\uFF0C\u672C\u4EA7\u54C1\u975E\u672C\u4EBA\u6295\u4FDD\u4E14\u5E26\u8EAB\u6545\u8D23\u4EFB\u3001\u9700\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\uFF08\u6210\u4EBA\uFF09\u7684\u6295\u4FDD\u610F\u613F\u8FDB\u884C\u7B7E\u5B57\u786E\u8BA4\u3002"}),D(R,{title:"\u6295\u4FDD\u4EBA",class:"card"},{extra:_(()=>{var e,B,a,c,C,S,$,j;return[t("div",Se,[t("div",xe,v((B=(e=l.value)==null?void 0:e.tenantOrderHolder)==null?void 0:B.name),1),t("div",{class:J(["status",{verified:((C=(c=(a=l.value)==null?void 0:a.tenantOrderHolder)==null?void 0:c.extInfo)==null?void 0:C.isCert)===s.CERT}])},v(((j=($=(S=l.value)==null?void 0:S.tenantOrderHolder)==null?void 0:$.extInfo)==null?void 0:j.isCert)===s.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)])]}),default:_(()=>{var e,B,a,c,C;return[t("div",be,[ke,t("div",we,v((B=(e=l.value)==null?void 0:e.tenantOrderHolder)==null?void 0:B.certNo),1),((C=(c=(a=l.value)==null?void 0:a.tenantOrderHolder)==null?void 0:c.extInfo)==null?void 0:C.isCert)!==s.CERT?(F(),m("div",{key:0,class:"action",onClick:o[0]||(o[0]=S=>M(-1))},[Pe,D(W,{name:"right_arrow",class:"icon"})])):Q("",!0)])]}),_:1}),D(R,{title:"\u6295\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:_(()=>[t("div",{class:"resign",onClick:ae},"\u91CD\u7B7E")]),default:_(()=>[D(K,{ref_key:"holderSign",ref:g,class:"sign"},null,512),t("div",Le,[t("div",Ue,"\u7B7E\u540D\u65E5\u671F\uFF1A "+v(N(U)),1),t("div",He,[Me,(F(!0),m(P,null,w(O.value.filter(e=>e.noticeObject===N(X).HOLDER),(e,B)=>(F(),k(n,{key:B,class:"file",title:`\u300A${e.materialName}\u300B`,url:e.materialSource},null,8,["title","url"]))),128))])])]),_:1}),(F(!0),m(P,null,w((f=l.value)==null?void 0:f.tenantOrderInsuredList,(e,B)=>(F(),m("div",{key:B},[D(R,{title:"\u88AB\u4FDD\u4EBA",class:"card"},{extra:_(()=>{var a,c;return[t("div",Ve,[t("div",$e,v(e.name),1),t("div",{class:J(["status",{verified:((a=e.extInfo)==null?void 0:a.isCert)===s.CERT}])},v(((c=e.extInfo)==null?void 0:c.isCert)===s.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)])]}),default:_(()=>{var a;return[t("div",je,[Ye,t("div",qe,v(e.certNo),1),((a=e.extInfo)==null?void 0:a.isCert)!==s.CERT?(F(),m("div",{key:0,class:"action",onClick:c=>M(B)},[Ge,D(W,{name:"right_arrow",class:"icon"})],8,ze)):Q("",!0)])]}),_:2},1024),D(R,{title:"\u88AB\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:_(()=>[t("div",{class:"resign",onClick:a=>oe(B)},"\u91CD\u7B7E",8,Je)]),default:_(()=>[D(K,{ref_for:!0,ref:ne,class:"sign"}),t("div",Qe,[t("div",We,"\u7B7E\u540D\u65E5\u671F\uFF1A "+v(N(U)),1),t("div",Ke,[Xe,(F(!0),m(P,null,w(O.value.filter(a=>a.noticeObject===N(X).INSURED),(a,c)=>(F(),k(n,{key:c,class:"file",title:`\u300A${a.materialName}\u300B`,url:a.materialSource},null,8,["title","url"]))),128))])])]),_:2},1024)]))),128)),t("div",Ze,[D(r,{type:"primary",class:"submit-btn",onClick:re},{default:_(()=>[eu]),_:1})])])]}),_:1})}}});var ru=he(uu,[["__scopeId","data-v-eb3ef9fc"]]);export{ru as default};
