import{d as e,i as a,j as s,o as t,c as l,a as n,F as i,n as c,e as o,p as r,b as u,w as d,u as v,l as p,a0 as g,a8 as m,T as f,cE as h,co as b,cm as x,cn as y,ag as k,g as w,h as C,cu as S}from"./index-17cd0657.js";import{s as _,c as N}from"./scribing-18c81ddd.js";const T={class:"com-handle-scribing"},A={class:"sign-container-wrap"},V={class:"scribing-text"},E={class:"sign-wrap"},j={class:"sign-preview"},I={class:"scribing-text"},L={class:"sign-result"},O=["onClick"],P=["src"],R={class:"sign-list"},U={class:"sign-item"},$={class:"operate-bar"},q=e({name:"handleScribing"}),D=e({...q,props:{text:{default:""},modelValue:{default:()=>[]},signAccount:{default:1}},emits:["onSubmit","onCancel"],setup(e,{emit:w}){const C=e,S=a(0),_=a(),N=s((()=>{if(C.text&&C.text.length>=C.signAccount){const e=[];let a=0;for(let s=0;s<=C.text.length;s++)!s||s%C.signAccount||(a+=1),C.text[s]&&(e[a]?e[a]+=C.text[s]:e[a]=C.text[s]);return e}return[""]})),q=a([]);a("");const D=()=>{if(S.value===N.value.length-1)return;S.value,C.signAccount;N.value[S.value].length;let e="";N.value.forEach(((a,s)=>{s===S.value&&(q.value[s]||(e="请抄录当前页面文字"))})),e?f({message:e,className:"toast-vertical"}):_.value&&(S.value+=1,_.value.swipeTo(S.value))},F=()=>{0!==S.value&&_.value&&(S.value-=1,_.value.swipeTo(S.value))},H=()=>{w("onCancel")},z=()=>{var e;if((null==(e=q.value)?void 0:e.length)!==C.text.length)return void f({message:"请完成抄录",className:"toast-vertical"});const a=[];q.value.forEach((async(e,s)=>{a.push(h(e,270))})),Promise.all(a).then((e=>{const a=e.map(((e,a)=>({position:a+1,content:C.text[a],image:e})));w("onSubmit",a)}))};return(e,a)=>{const s=b,f=x,h=y,w=k;return t(),l("div",T,[n("div",A,[n("p",V,[(t(),l(i,null,c("请投保人抄录并确保内容清晰完整",((e,a)=>n("span",{key:a,class:"text-item"},o(e),1))),64))]),n("div",E,[n("div",j,[n("p",I,[(t(!0),l(i,null,c(e.text,((e,a)=>(t(),l("span",{key:a,class:r(`text-item ${S.value===a?"activity":""} `)},o(e),3)))),128))]),n("div",L,[(t(!0),l(i,null,c(q.value,((e,a)=>(t(),l("div",{key:a,class:"scribing-item",onClick:e=>(e=>{S.value=e,_.value.swipeTo(S.value)})(a)},[n("img",{src:e,alt:""},null,8,P)],8,O)))),128))])]),u(h,{ref_key:"swipeRef",ref:_,loop:!1,"initial-swipe":0,"show-indicators":!1,vertical:"",touchable:!1},{default:d((()=>[(t(!0),l(i,null,c(v(N),((a,l)=>(t(),p(f,{key:l},{default:d((()=>[n("div",R,[n("div",U,[(t(),p(s,g({ref_for:!0,ref:"signRef",key:l,modelValue:q.value[l],"onUpdate:modelValue":e=>q.value[l]=e,placeholder:a},e.$attrs,{onSignSuccess:D}),null,16,["modelValue","onUpdate:modelValue","placeholder"]))])])])),_:2},1024)))),128))])),_:1},512)]),n("div",$,[u(w,{plain:"",hairline:"",type:"primary",disabled:0===S.value,class:"btn",onClick:F},{default:d((()=>[m("后退")])),_:1},8,["disabled"]),u(w,{plain:"",hairline:"",type:"primary",class:"btn",onClick:H},{default:d((()=>[m("取消")])),_:1}),u(w,{type:"primary",class:"btn",onClick:z},{default:d((()=>[m("保存")])),_:1})])])])}}}),F={class:"handle-scribing-wrap"},H=e({name:"handleScribingPage"}),z=e({...H,setup(e){const a=w(),s=C(),{orderNo:n,text:i,tenantId:c}=s.query,o=()=>{a.back()},r=e=>{_({orderNo:n,tenantId:c,riskTranscriptionList:e}).then((({code:e,data:s})=>{"10000"===e&&N({content:i,image:"",orderNo:n,tenantId:c,transcriptionType:S.HANDLE}).then((({code:e})=>{"10000"===e&&a.back()}))}))};return(e,a)=>(t(),l("div",F,[u(D,{text:v(i),closeable:"","has-bg":"",onOnCancel:o,onOnSubmit:r},null,8,["text"])]))}});export{z as default};
