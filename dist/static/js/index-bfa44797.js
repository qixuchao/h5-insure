var X=Object.defineProperty,G=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var j=(r,c,s)=>c in r?X(r,c,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[c]=s,m=(r,c)=>{for(var s in c||(c={}))W.call(c,s)&&j(r,s,c[s]);if(E)for(var s of E(c))Z.call(c,s)&&j(r,s,c[s]);return r},y=(r,c)=>G(r,Q(c));import{a as ee,g as te,C as h,L as se,a3 as $,x as ae,X as v,o as oe,r as V,h as D,m as L,n as f,k as b,y as I,z as l,j as re,s as O,a1 as ie,a2 as ne,B as ue}from"./vendor-bf3e5d1d.js";import{P as q,R as ce,i as le,p as de}from"./trial-c6085ba0.js";import{g as pe}from"./index-5c366fd7.js";import{_ as fe}from"./index-398f32c2.js";const be=ee({id:"createProposal",state:()=>({proposalInfo:{},trialData:[],excludeProduct:[]}),actions:{setProposalInfo(r){this.$state.proposalInfo=r},setTrialData(r){this.$state.trialData=r},setExcludeProduct(r){this.$state.excludeProduct=r}}});const me=r=>(ie("data-v-4f8eda3b"),r=r(),ne(),r),ke={class:"com-product-risk-wrapper"},ge={class:"popup-container"},he=me(()=>I("div",{class:"popup-title"},"\u8BF7\u9009\u62E9\u4FDD\u969C\u65B9\u6848",-1)),_e={class:"risk-trial-wrapper"},ve={key:0,class:"part-card"},Re={key:1,class:"part-card"},Pe={class:"risk-content"},Ve={key:0,class:"risk"},De={class:"footer-bar"},Ie=ue("\u786E\u8BA4"),ye=te({props:{isShow:{type:Boolean,default:!1},type:{default:"add"},productId:{default:0},riskType:{default:1},formInfo:{default:{}},productData:{default:()=>({})},holder:{default:()=>({})},insured:{default:()=>({})},riderRisk:{default:()=>[]},currentRisk:{default:()=>[]}},emits:["close","finished"],setup(r,{emit:c}){const s=r,B=h({personVO:m({},s.holder)}),C=h({insuredCode:"",personVO:m({},s.insured)}),R=h({}),A=h({}),_=h({}),S=h({}),T=h({}),e=se({currentPlan:"0",isShow:s.isShow,riskBaseInfo:{},holderFactor:[],insuredFactor:[],riskData:[],riskPlanData:[],trialResult:{},canTrial:!0,retrialTip:!1,enumList:{},ageRange:[],collapseName:["1"],type:s.type});$("premium",T.value),$("source",{type:e.type,origin:"proposal",showRiskList:s.currentRisk});const w=ae(()=>{var a;let t="";if((a=e.riskData)==null?void 0:a[0]){const o=e.riskData[0],i=((o==null?void 0:o.requiredRiderRiskVOList)||[]).map(n=>n.riskName);i.length&&(t=`\u7279\u6B8A\u63D0\u793A: ${o.riskName}\u548C${i.join("\u3001")}\u5FC5\u987B\u540C\u65F6\u6295\u4FDD`)}return t}),M=(t,a)=>{var n,p,u,d,k,g,P,N,x;const o=(t.insuredVOList[0].productPlanVOList[0].riskVOList||[]).map(F=>y(m({},F),{premium:a[F.riskCode].premium,amount:a[F.riskCode].amount}));return{proposalHolder:m({},(n=t.holder)==null?void 0:n.personVO),proposalInsuredList:[y(m({},t.insuredVOList[0].personVO),{dateRange:{min:(u=(p=_.value)==null?void 0:p.ageRangeObj)==null?void 0:u.minAge,max:(k=(d=_.value)==null?void 0:d.ageRangeObj)==null?void 0:k.maxAge},proposalInsuredProductList:[{productId:e.riskBaseInfo.id,productName:e.riskBaseInfo.productName,dateRange:{min:(P=(g=_.value)==null?void 0:g.ageRangeObj)==null?void 0:P.minAge,max:(x=(N=_.value)==null?void 0:N.ageRangeObj)==null?void 0:x.maxAge},proposalProductRiskList:o}]})]}},J=()=>{const t=JSON.parse(JSON.stringify(R.value[e.currentPlan])),a=Object.values(t).find(n=>n.riskType===1),o=Object.values(t).map(n=>{const p=n;if(p.chargePeriod==="3"){const u=(a.chargePeriod||"").split("_");u[1]&&(u[1]-=1),p.chargePeriod=u.join("_")}return p.liabilityVOList=(p.liabilityVOList||[]).filter(u=>u.optionalFlag===1||u.liabilityAttributeValue&&u.liabilityAttributeValue!=="-1").map(u=>{const d=u;return d.liabilityAttributeValue==="0"&&(d.liabilityAttributeValue=""),d}),p}),i={holder:B.value,productCode:e.riskBaseInfo.productCode,insuredVOList:[y(m({},C.value),{productPlanVOList:[{planCode:e.currentPlan||"",riskVOList:o}]})]};de(m({},i)).then(({code:n,data:p})=>{if(n==="10000"){e.retrialTip=!1,e.trialResult=p,e.canTrial=!1;const u={},d=(k=[])=>{(k||[]).forEach(g=>{var P;u[g.riskCode]=g,((P=g.riskPremiumDetailVOList)==null?void 0:P.length)&&d(g.riskPremiumDetailVOList)})};d(p.riskPremiumDetailVOList),Object.assign(T.value,u),c("finished",M(i,u))}else e.retrialTip=!0})},K=()=>{var t,a,o,i,n;Promise.all([(a=(t=A.value)==null?void 0:t.validateForm)==null?void 0:a.call(t),(i=(o=_.value)==null?void 0:o.validateForm)==null?void 0:i.call(o),(n=S.value)==null?void 0:n.validate()]).then(()=>{J()})},U=()=>{c("close")},Y=()=>{pe({dictCodeList:["RISK_PAYMENT_PERIOD","RISK_INSURANCE_PERIOD"]}).then(({code:a,data:o})=>{if(a==="10000"){const i={};o.forEach(n=>{i[n.dictCode]=n.dictItemList}),e.enumList=i}})},z=()=>{le({productId:s.productId,source:2}).then(({code:t,data:a})=>{t==="10000"&&(e.riskBaseInfo=a.productBasicInfoVO,(a.productRiskVoList[0].riskDetailVOList||[]).forEach((o,i)=>{i===0&&(e.currentPlan=o.planCode||"0"),Object.assign(R.value,{[o.planCode||i]:{}})}),e.riskData=a.productRiskVoList[0].riskDetailVOList||[],e.riskPlanData=a.productRelationPlanVOList||[])}).finally(()=>{})},H=t=>{e.holderFactor=t.holderFactorList,e.insuredFactor=t.insuredFactorList,e.ageRange=t.ageRange};return v([()=>R.value,()=>B.value,()=>C.value],t=>{t&&!e.canTrial&&(e.canTrial=!0,e.retrialTip=!0)},{deep:!0}),v(()=>s.isShow,t=>{e.isShow=t},{immediate:!0}),v(()=>s.productId,t=>{t&&z()},{immediate:!0}),v(()=>s.formInfo,(t={})=>{if(!(s.type==="add"||s.type==="repeatAdd")){const a={};t.proposalProductRiskList.forEach(o=>{a[o.riskId]=o}),Object.assign(R.value,{0:a})}},{deep:!0,immediate:!0}),v(()=>s.productData,t=>{var a;s.type==="add"||s.type==="repeatAdd"||(e.riskBaseInfo=t.productBasicInfoVO,e.riskData=((a=t.productRiskVoList)==null?void 0:a[0].riskDetailVOList)||[])},{deep:!0,immediate:!0}),v(()=>s.type,t=>{e.type=t}),oe(()=>{Y()}),(t,a)=>{const o=V("ProMessage"),i=V("ProTitle"),n=V("VanForm"),p=V("VanButton"),u=V("VanPopup");return D(),L("div",ke,[f(u,{show:l(e).isShow,"onUpdate:show":a[0]||(a[0]=d=>l(e).isShow=d),round:"",position:"bottom",closeable:"",style:{height:"80%"},onClose:U},{default:b(()=>{var d,k;return[I("div",ge,[he,l(w)?(D(),re(o,{key:0,content:l(w)},null,8,["content"])):O("",!0),I("div",_e,[l(e).holderFactor.length?(D(),L("div",ve,[f(i,{title:"\u6295\u4FDD\u4EBA"}),f(q,{ref_key:"holderRef",ref:A,"insured-code":(d=l(e).riskBaseInfo)==null?void 0:d.insurerCode,"form-info":B.value.personVO,"factor-list":l(e).holderFactor,"age-range":l(e).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):O("",!0),l(e).insuredFactor.length?(D(),L("div",Re,[f(i,{title:"\u88AB\u4FDD\u4EBA"}),f(q,{ref_key:"insuredRef",ref:_,"insured-code":(k=l(e).riskBaseInfo)==null?void 0:k.insurerCode,"form-info":C.value.personVO,"factor-list":l(e).insuredFactor,"age-range":l(e).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):O("",!0),I("div",Pe,[f(i,{title:"\u6295\u4FDD\u65B9\u6848"}),l(e).riskData.length?(D(),L("div",Ve,[f(n,{ref_key:"riskFormRef",ref:S,"input-align":"right","error-message-align":"right"},{default:b(()=>[f(ce,{"risk-info":R.value[0],enums:l(e).enumList,"origin-data":l(e).riskData,"pick-factor":H},null,8,["risk-info","enums","origin-data"])]),_:1},512)])):O("",!0)])]),I("div",De,[f(p,{block:"",type:"primary",onClick:K},{default:b(()=>[Ie]),_:1})])])]}),_:1},8,["show"])])}}});var Ae=fe(ye,[["__scopeId","data-v-4f8eda3b"]]);export{Ae as P,be as u};
