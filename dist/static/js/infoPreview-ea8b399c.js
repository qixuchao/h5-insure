import{d as e,af as a,ag as t,i as o,h as n,ca as s,r as i,j as l,aG as r,l as u,o as c,c as d,b as f,w as p,u as m,p as y,q as I,f as v,F as h,s as w,a as g,g as C,v as b,e as j,as as q,dI as x,ah as P,bH as V,ak as T,d4 as k,bK as L,aS as _,dO as E,aQ as O,aN as N,c3 as R,T as U,c7 as A}from"./index-4a902c97.js";import{P as S,a as D}from"./PolicyInfo-95fc680c.js";import{g as F,m as M}from"./trial-15f59f1d.js";import{n as Q}from"./nextStep-0f639354.js";import{b as B,l as J}from"./product-85d6e3f1.js";import{u as $}from"./useOrder-a971accb.js";import{P as G}from"./constants-6c7c253a.js";import{P as W}from"./index-54a33f75.js";import{P as z}from"./index-6894ad01.js";import{_ as H}from"./InsureInfo-8e679965.js";import{p as K,d as X}from"./utils-ef26a2a6.js";import{Q as Y}from"./notice-2124862a.js";import{P as Z,g as ee}from"./utils-cdf863c9.js";import{Q as ae}from"./questionnaire-42dcb602.js";import{P as te}from"./constants-b39aa53b.js";import{T as oe}from"./infoCollection-09bdda8d.js";import{i as ne}from"./core-9b7499f8.js";import"./cloneDeep-83387a9a.js";import"./util-9af1f062.js";import"./trial-aee3c88c.js";const se={class:"long-info-preview"},ie={class:"footer-button"},le=e({__name:"infoPreview",setup(e){const le=a((()=>t((()=>import("./index-f19a434c.js")),["static/js/index-f19a434c.js","static/css/index-fa4edf2a.css","static/js/index-4a902c97.js","static/css/index-df050663.css","static/js/theme-94cf7d00.js","static/js/index-6894ad01.js","static/css/index-bbfdd7ec.css","static/js/utils-cdf863c9.js","static/js/infoCollection-09bdda8d.js","static/js/trial-aee3c88c.js"]))),re=o(),ue=n(),ce=$({}),{productCode:de="",tenantId:fe,agentCode:pe="",agencyCode:me,saleChannelId:ye,isShare:Ie,orderNo:ve,extraInfo:he,insurerCode:we,objectType:ge="1",templateId:Ce,preview:be,origin:je,pageType:qe}=re.query;let xe={};try{xe=JSON.parse(decodeURIComponent(he))}catch(Ge){}const[Pe,Ve]=s(!1),Te=i({isView:!1,personalInfo:{},policyInfo:{schema:[],config:[],formData:{}},payInfo:{schema:[],config:[],formData:[]},customerQuestions:[]}),ke=`${window.origin}/baseInsurance/long/phoneVerify${window.location.search}`;l({imgUrl:"",desc:"",title:"",link:ke});const Le=l(),_e=l(),Ee=l(!1),Oe=l(!1),Ne=l(0),Re=l(!1),Ue=()=>{Oe.value=!1},Ae=({file:e,type:a},t)=>{q.set(Z,{fileUri:e,fileType:a}),ue.push({path:"/template/filePreview",query:{fileId:e.id}}),t()},Se=()=>{Ee.value=!0,ce.value.extInfo.buttonCode=x.short.underWrite,ce.value.extInfo.pageCode="infoPreview",Q(ce.value,((e,a,t)=>{O.JUMP_ALERT===a&&N.confirm({title:"核保失败",message:t,cancelButtonText:"修改信息",confirmButtonText:"放弃投保"}).then((()=>{ne?R.closeWindow():window.close()})).catch((()=>{delete re.query.questionnaireId,ue.push({path:G.productInfo,query:re.query})}))}))},De=()=>{Ce===oe.FREE?(ce.value.extInfo.buttonCode=x.free.faceVerify,ce.value.extInfo.pageCode="faceAuth",Q(ce.value,((e,a)=>{a===O.JUMP_PAGE&&U("被保人已完成认证")}))):"true"===qe?(delete re.query.pageType,ue.push({path:G.holderInfoPreview,query:re.query})):(ce.value.extInfo.buttonCode=x.short.faceVerify,ce.value.extInfo.pageCode="faceAuth",Q(ce.value,((e,a)=>{a===O.JUMP_PAGE&&U("被保人已完成认证")})))},Fe=async()=>{if(Ce===oe.FREE){ce.value.extInfo.buttonCode=x.free.faceVerify,ce.value.extInfo.pageCode="faceAuth",await Q(ce.value);const{code:e,data:a}=await F({orderNo:ve,tenantId:fe});"10000"===e&&(Object.assign(ce.value,a),ce.value.extInfo.buttonCode=x.free.underWriteAndIssue,ce.value.extInfo.pageCode="productInfo",Q(ce.value,((e,a)=>{a===O.JUMP_PAGE&&(delete re.query.pageType,ue.push({path:te[e.nextPageCode],query:re.query}))})))}else{if(Ee.value)return void Se();Ve(!0)}},Me=l(),Qe=l(),Be=l([]),Je=async()=>{var e;let a={};const{code:t,data:o}=await F({orderNo:ve,tenantId:fe});"10000"===t&&(Object.assign(ce.value,o),a=K(o.insuredList[0].productList),Me.value=o,Re.value=!0);const{planCode:n}=(null==(e=o.insuredList)?void 0:e[0])||{};(async e=>{let a=[];const{code:t,data:o}=await A({orderNo:ve,tenantId:fe});"10000"===t&&(a=o.productQuestionnaireVOList);const{code:n,data:s}=await J(e);if("10000"===n){const{productQuestionnaireVOList:e}=s||{},t=e.filter((e=>e.businessType!==Y.VISIT));Te.customerQuestions=t.map((e=>{const{questionnaireDetailResponseVO:t,questionnaireId:o,questionnaireName:n}=e||{},{questions:s,basicInfo:i}=t||{},{objectType:l,questionnaireType:r}=i||{};if(r===ae.TEXT){const{content:e,textType:a}=(null==s?void 0:s[0])||{};return{content:e,contentType:ee(`${a}`,e),questionnaireId:o,questionnaireName:n}}const u=(a||[]).find((e=>e.questionnaireId===o));return{...t,contentType:"question",...null==u?void 0:u.questionnaireDetailResponseVO,questionnaireId:o,questionnaireName:n}}))}})({productCodeList:a.productList.map((e=>e.productCode))}),B(a).then((({code:e,data:a})=>{if("10000"===e){const{productMaterialList:e,riskMaterialList:t}=X(a,n);Te.fileList=e.map((e=>({tabName:e.attachmentName,isExpand:!0,files:e.attachmentList.map((e=>({name:e.materialName,file:e.materialContent,type:e.materialSource,mustRead:e.mustReadFlag===P.YES})))}))),Be.value=e.concat(t)}})),M(a).then((({data:e,code:a})=>{if("10000"===a){const{productDetailResList:a,productFactor:t}=e;Qe.value=t;const{payInfo:o,other:n}=V(t);Te.payInfo={...Te.payInfo,...o},Te.policyInfo={...Te.policyInfo,...n}}}))};r((()=>{Je()}));const $e=l();return u((()=>{setTimeout((async()=>{$e.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,a)=>{var t,o,n;const s=T,i=k,l=L,r=_,u=E;return c(),d("div",se,[f(s),f(H,{"product-data":null==(o=null==(t=m(ce).insuredList)?void 0:t[0])?void 0:o.productList},{default:p((()=>[f(i,{title:"生效时间",content:m(ce).commencementTime},null,8,["content"])])),_:1},8,["product-data"]),(null==(n=Object.keys(m(Qe)||{}))?void 0:n.length)?(c(),y(W,{key:0,ref_key:"personalInfoRef",ref:_e,modelValue:m(Me),"onUpdate:modelValue":a[0]||(a[0]=e=>I(Me)?Me.value=e:null),"product-factor":m(Qe),"is-view":""},null,8,["modelValue","product-factor"])):v("",!0),m(Te).payInfo.schema.length?(c(),y(m(S),{key:1,ref_key:"payInfoRef",ref:Le,modelValue:m(ce).tenantOrderPayInfoList,"onUpdate:modelValue":a[1]||(a[1]=e=>m(ce).tenantOrderPayInfoList=e),schema:m(Te).payInfo.schema,"is-view":""},null,8,["modelValue","schema"])):v("",!0),m(Te).policyInfo.schema.length?(c(),y(m(D),{key:2,modelValue:m(ce).extInfo,"onUpdate:modelValue":a[2]||(a[2]=e=>m(ce).extInfo=e),schema:m(Te).policyInfo.schema,"is-view":""},null,8,["modelValue","schema"])):v("",!0),f(r,{title:"产品资料","show-line":!1,"show-icon":!1},{default:p((()=>[(c(!0),d(h,null,w(m(Be),((e,a)=>(c(),y(l,{key:a,"is-link":"",title:e.attachmentName,onClick:e=>(e=>{Ne.value=e,Oe.value=!0})(a)},null,8,["title","onClick"])))),128))])),_:1}),g("div",ie,["share"===m(je)||m(qe)?(c(),y(z,{key:0,shadow:!1,onClick:De},{default:p((()=>[C(e.$slots,"default",{},(()=>[b("确认")]))])),_:3})):(c(),y(z,{key:1,shadow:!1,onClick:Fe},{default:p((()=>[C(e.$slots,"default",{},(()=>[b(j(m(Ce)===m(oe).FREE?"领取保障并激活":"确认支付"),1)]))])),_:3}))]),m(Oe)?(c(),y(m(le),{key:3,show:m(Oe),"onUpdate:show":a[3]||(a[3]=e=>I(Oe)?Oe.value=e:null),"content-list":[m(Be)[m(Ne)]],"is-only-view":"","active-index":0,text:"关闭","force-read-cound":0,onOnCloseFilePreviewByMask:Ue},null,8,["show","content-list"])):v("",!0),m(Pe)?(c(),y(u,{key:4,modelValue:m(Pe),"onUpdate:modelValue":a[4]||(a[4]=e=>I(Pe)?Pe.value=e:null),closeable:!1,"data-source":m(Te).fileList,onClickBtn:Ae,onSubmit:Se},null,8,["modelValue","data-source"])):v("",!0)])}}});export{le as default};
