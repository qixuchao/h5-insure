import{d as e,a4 as a,a5 as t,i as o,j as n,r as l,aJ as i,l as s,bZ as r,o as u,c as d,b as c,u as f,p,w as v,f as m,q as I,a8 as h,aP as y,aI as C,aH as b,aN as g,aQ as O,a9 as L,b_ as j,T as w,bz as x,ab as P,ac as _}from"./index-7888b407.js";import{_ as N,a as D}from"./PolicyInfo-abcca7e2.js";import{s as E,g as V,m as T}from"./trial-c117c527.js";import{_ as k}from"./TrialButton-088b7c4e.js";import{n as F}from"./nextStep-11526026.js";import{u as U}from"./useAttachment-b8e35cb4.js";import"./infoCollection-4bc53fdc.js";import"./trial-de72d182.js";import{u as q}from"./useOrder-122e7433.js";import{t as A}from"./utils-c1d50d6c.js";import{T as R}from"./index-3959a9f5.js";import{p as S}from"./utils-925c01af.js";import"./index-b811b5a9.js";import"./format-31cde443.js";import"./core-1f1840d2.js";import"./utils-b32e9da7.js";import"./createProposal-7813c168.js";import"./cloneDeep-f7dcc649.js";import"./InsureInfos-f75f116d.js";import"./index-de590a0b.js";import"./index-26d22f5c.js";import"./index-4712337a.js";import"./lodash-b0c5aaba.js";import"./questionnaire-42dcb602.js";import"./util-73fba688.js";import"./product-7bbf9c44.js";import"./constants-2fa4c2a7.js";import"./config-98e8d477.js";const B={class:"long-info-collection"},M=e({name:"InfoCollection"}),J=e({...M,setup(e){const M=a((()=>t((()=>import("./index-061b1b34.js")),["static/js/index-061b1b34.js","static/css/index-fa4edf2a.css","static/js/index-7888b407.js","static/css/index-7af33e5c.css","static/js/theme-94cf7d00.js","static/js/index-b811b5a9.js","static/css/index-bbfdd7ec.css","static/js/utils-b32e9da7.js","static/js/infoCollection-4bc53fdc.js","static/js/trial-de72d182.js"]))),J=a((()=>t((()=>import("./index-8788604b.js")),["static/js/index-8788604b.js","static/css/index-bf024e9b.css","static/js/index-7888b407.js","static/css/index-7af33e5c.css"]))),H=o(),$=q(),{productCode:z="",tenantId:G,agentCode:Q="",agencyCode:Z,saleChannelId:K,isShare:W,orderNo:X,extraInfo:Y,insurerCode:ee,preview:ae}=H.query;let te={},oe=null;const ne=n(2);try{te=JSON.parse(decodeURIComponent(Y))}catch(Se){}const le=l({isView:!1,personalInfo:{},payInfo:{schema:[],config:[],formData:[]},policyInfo:{schema:[],config:[],formData:{}},defaultValue:null,isAutoChange:!1,defaultPlanCode:"",userData:{}}),ie=`${window.origin}/baseInsurance/long/phoneVerify${window.location.search}`,se=n({imgUrl:"",desc:"",title:"",link:ie}),re=n();n();const ue=n(),de=n({}),ce=n({}),fe=n([]),pe=n(),ve=n({}),me=n(!1),Ie=n(!1),he=n(0),ye=n(!0),{fileList:Ce,mustReadFileCount:be,popupFileList:ge}=U(ve,pe),Oe=n(!1),Le=n(!1),je=()=>{Ie.value=!1,ye.value=!0,fe.value.length<1||(me.value=!0)},we=()=>{me.value=!1,Ie.value=!1,ye.value=!0};n({}),n(!1),n([{}]);const xe=n(""),Pe=n({}),_e=n(!1);n();const Ne=n();n();const De=n(0);n({});const Ee=n(),Ve=()=>{xe.value="试算中...",Pe.value=null,_e.value=!0},Te=(e,a)=>{xe.value="",De.value=e.premium,Pe.value=e,Ee.value=a,_e.value=!1},ke=n(!1),Fe=async()=>{var e,a;if(ae)return void y(C.INFO_COLLECTION,H.query);if(!Pe.value)return;const t=[];ue.value&&t.push(null==(e=ue.value)?void 0:e.validate(!1)),re.value&&t.push(null==(a=re.value)?void 0:a.validate(!1)),Promise.all(t).then((e=>{Object.assign($.value,{extInfo:{...$.value.extInfo,buttonCode:b.INFO_COLLECTION,pageCode:C.INFO_COLLECTION}});const a=ue.value.dealMixData(),t=A({...a,productCode:z,productName:ce.value.productName},Pe.value,$.value);H.query.productClass=ne.value;const o=(()=>{var e,a;const{holder:t,insuredList:o}=le.userData,n=[],l=(e,a)=>{e.ocrData&&Object.keys(e.ocrData).find((a=>(e[a]||e.ocrData[a])&&e.ocrData[a]!==e[a]))&&n.push(`${a}信息影像识别与录入信息不一致，请确认`)};return l(t,"投保人"),l(null==o?void 0:o[0],"被保人"),((null==(e=null==o?void 0:o[0])?void 0:e.beneficiaryList)||[]).forEach(((e,a)=>{l(e,`受益人${a+1}`)})),l(null==o?void 0:o[0].guardian,"监护人"),l(null==o?void 0:o[0].guardian,"监护人"),((null==(a=$.value)?void 0:a.tenantOrderPayInfoList)||[]).forEach((e=>{l(null==o?void 0:o[0].guardian,"银行卡")})),n})();ke.value=!0,(null==o?void 0:o.length)?g.confirm({message:null==o?void 0:o[0]}).then((()=>{clearInterval(oe),F(t,((e,a)=>{ke.value=!1,a===O.JUMP_PAGE&&L(e.nextPageCode,H.query)}),H)})):(clearInterval(oe),F(t,((e,a)=>{ke.value=!1,a===O.JUMP_PAGE&&L(e.nextPageCode,H.query)}),H))}),(e=>{j(".long-info-collection",".van-field--error")})).catch((e=>{console.log("e",e)}))},Ue=e=>{const a=$.value.tenantOrderPayInfoList[0];$.value.tenantOrderPayInfoList.splice(0,1,{...a,...e})},qe=e=>{Object.assign(le.userData,e)},Ae=n({}),Re=n();return i((()=>{(async()=>{let e={};X&&await V({orderNo:X,tenantId:G}).then((({code:a,data:t})=>{var o;if("10000"===a){if((null==(o=t.insuredList)?void 0:o.length)>0){const{planCode:e}=t.insuredList[0];le.defaultPlanCode=e}Object.assign($.value,t,{tenantOrderPayInfoList:t.tenantOrderPayInfoList||[],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0,withPayInfo:!0},productCode:z}),le.defaultValue=$.value,e=S(t.insuredList[0].productList),ne.value=t.insuredList[0].productList.length>1?1:2,Le.value=!0}})),await T(e).then((({data:e,code:a})=>{if("10000"===a){const{productDetailResList:a,productFactor:t}=e;Re.value=t;const o={};a.forEach((e=>{o[e.productCode]=e})),Ae.value=o;const{payInfo:n,other:l}=x(Re.value);le.payInfo={...le.payInfo,...n},le.policyInfo={...le.policyInfo,...l}}}))})()})),s((()=>{oe=setInterval((()=>{(()=>{Object.assign($.value,{extInfo:{...$.value.extInfo,buttonCode:b.INFO_COLLECTION,pageCode:C.INFO_COLLECTION}});const e=ue.value.dealMixData(),a=A(e,Pe.value,$.value);a.orderStatus="collectInfo",E(a)})()}),3e4),setTimeout((async()=>{Ne.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),r((()=>{clearInterval(oe)})),(e,a)=>{var t,o,n,l,i,s;const r=P,y=_;return u(),d("div",B,[c(r),f(Le)||f(ae)?(u(),p(R,{key:0,ref_key:"personalInfoRef",ref:ue,"product-info":{productCode:f(z),productName:f(ce).productName,insurerCode:f(ee),tenantId:f(G),planList:[]},"tenant-product-detail":f(de),"hide-benefit":"","product-collection":f(Ae),"default-data":f($),"product-factor":f(Re),onTrialStart:Ve,onTrialEnd:Te,"onUpdate:userData":qe,onUpdateBank:Ue},{middleInfo:v((()=>[f(le).payInfo.schema.length?(u(),p(f(N),{key:0,ref_key:"payInfoRef",ref:re,modelValue:f($).tenantOrderPayInfoList,"onUpdate:modelValue":a[0]||(a[0]=e=>f($).tenantOrderPayInfoList=e),schema:f(le).payInfo.schema,"is-view":f(le).isView,"user-data":f(le).userData},null,8,["modelValue","schema","is-view","user-data"])):m("",!0),f(le).policyInfo.schema.length?(u(),p(f(D),{key:1,modelValue:f($),"onUpdate:modelValue":a[1]||(a[1]=e=>I($)?$.value=e:null),schema:f(le).policyInfo.schema,"is-view":f(le).isView},null,8,["modelValue","schema","is-view"])):m("",!0)])),_:1},8,["product-info","tenant-product-detail","product-collection","default-data","product-factor"])):m("",!0),c(y,null,{default:v((()=>{var e;return[(null==(e=f(Ce))?void 0:e.length)?(u(),p(f(J),{key:0,modelValue:f(Oe),"onUpdate:modelValue":a[2]||(a[2]=e=>I(Oe)?Oe.value=e:null),"has-bg-color":!1,"attachment-list":f(Ce),"is-show-radio":"","pre-text":"投保人阅读并接受",onPreviewFile:a[3]||(a[3]=e=>(e=>{he.value=e,Ie.value=!0})(e))},null,8,["modelValue","attachment-list"])):m("",!0)]})),_:1}),f(Ie)?(u(),p(f(M),{key:1,show:f(Ie),"onUpdate:show":a[4]||(a[4]=e=>I(Ie)?Ie.value=e:null),"content-list":f(ye)?f(Ce):f(ge),"is-only-view":f(ye),"active-index":f(he),text:f(ye)?"关闭":"我已逐页阅读并确认告知内容","force-read-count":f(ye)?0:f(be),onSubmit:je,onOnCloseFilePreviewByMask:we},null,8,["show","content-list","is-only-view","active-index","text","force-read-count"])):m("",!0),c(k,{"is-share":f(se).isShare&&!f(W),premium:null==(t=f(Pe))?void 0:t.initialPremium,"share-info":f(se),"loading-text":f(xe),"payment-frequency":(null==(s=null==(i=null==(l=null==(n=null==(o=f(Ee))?void 0:o.insuredList)?void 0:n[0].productList)?void 0:l[0].riskList)?void 0:i[0])?void 0:s.paymentFrequency)+"","tenant-product-detail":f(de),"handle-share":e=>(e=>{ue.value.validateHolder(["mobile"]).then((()=>{Object.assign($.value,{extInfo:{...$.value.extInfo,buttonCode:b.INFO_COLLECTION,pageCode:C.INFO_COLLECTION}});const a=ue.value.getUserData(),t=A({...Ee.value,holder:null==a?void 0:a.holder},Pe.value||{},$.value);F(t,((a,t)=>{t===O.JUMP_PAGE&&(null==e||e())}),H)})).catch((()=>{w("请录入投保人手机号后进行分享")}))})(e),disabled:!f(Pe)||f(ke),onHandleClick:Fe},{default:v((()=>[h("下一步 ")])),_:1},8,["is-share","premium","share-info","loading-text","payment-frequency","tenant-product-detail","handle-share","disabled"])])}}});export{J as default};
