var U=Object.defineProperty,Y=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var A=(n,l,i)=>l in n?U(n,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[l]=i,d=(n,l)=>{for(var i in l||(l={}))H.call(l,i)&&A(n,i,l[i]);if(T)for(var i of T(l))X.call(l,i)&&A(n,i,l[i]);return n},k=(n,l)=>Y(n,z(l));import{a as G,g as Q,C as V,L as W,a3 as w,x as Z,X as L,o as ee,r as O,h as g,m as R,n as p,k as y,y as P,z as c,j as te,s as D,a1 as se,a2 as re,B as ie}from"./vendor-4dbfa310.js";import{P as E,R as oe,i as ae,p as ne}from"./trial-5b7db6fc.js";import{g as ue}from"./index-cff3571e.js";import{_ as le}from"./index-21ff2934.js";const ye=G({id:"createProposal",state:()=>({proposalInfo:{},trialData:[]}),actions:{setProposalInfo(n){this.$state.proposalInfo=n},setTrialData(n){this.$state.trialData=n}}});const ce=n=>(se("data-v-96b41f6c"),n=n(),re(),n),de={class:"com-product-risk-wrapper"},pe={class:"popup-container"},fe=ce(()=>P("div",{class:"popup-title"},"\u8BF7\u9009\u62E9\u4FDD\u969C\u65B9\u6848",-1)),me={class:"risk-trial-wrapper"},ke={key:0,class:"part-card"},Ve={key:1,class:"part-card"},he={class:"risk-content"},_e={key:0,class:"risk"},Le={class:"footer-bar"},Oe=ie("\u786E\u8BA4"),ge=Q({props:{isShow:{type:Boolean,default:!1},type:{default:"add"},productId:{default:0},riskType:{default:1},formInfo:{default:{}},productData:{default:{}},holder:{default:{}},insured:{default:{}}},emits:["close","finished"],setup(n,{emit:l}){const i=n,I=V({personVO:d({},i.holder)}),v=V({insuredCode:"",personVO:d({},i.insured)}),h=V({}),b=V({}),B=V({}),C=V({}),F=V({}),e=W({currentPlan:"0",isShow:i.isShow,riskBaseInfo:{},holderFactor:[],insuredFactor:[],riskData:[],riskPlanData:[],trialResult:{},canTrial:!0,retrialTip:!1,enumList:{},ageRange:[],collapseName:["1"]});w("premium",F.value),w("source","proposal");const S=Z(()=>{var o;let t="";if((o=e.riskData)==null?void 0:o[0]){const a=e.riskData[0],r=((a==null?void 0:a.requiredRiderRiskVOList)||[]).map(s=>s.riskName);r.length&&(t=`\u7279\u6B8A\u63D0\u793A: ${a.riskName}\u548C${r.join("\u3001")}\u5FC5\u987B\u540C\u65F6\u6295\u4FDD`)}return t}),x=(t,o)=>{var s;const a=(t.insuredVOList[0].productPlanVOList[0].riskVOList[0].riderRiskVOList||[]).map(u=>k(d({},u),{premium:o[u.riskCode].premium}));debugger;return{proposalHolder:((s=t.holder)==null?void 0:s.personVO)||{},proposalInsuredList:[k(d({},t.insuredVOList[0].personVO),{proposalInsuredProductList:[{productId:e.riskBaseInfo.id,productName:e.riskBaseInfo.productName,proposalProductRiskList:[k(d({},t.insuredVOList[0].productPlanVOList[0].riskVOList[0]),{premium:o[t.insuredVOList[0].productPlanVOList[0].riskVOList[0].riskCode].premium,riderRiskVOList:a})]}]})]}},j=()=>{const t=JSON.parse(JSON.stringify(h.value[e.currentPlan])),o=Object.values(t.riderRiskVOList||[]).map(r=>{const s=r;if(s.chargePeriod==="3"){const u=(h.value[e.currentPlan].chargePeriod||"").split("_");u[1]&&(u[1]-=1),s.chargePeriod=u.join("_")}return s.liabilityVOList=(s.liabilityVOList||[]).filter(u=>u.liabilityAttributeValue!=="-1").map(u=>{const f=u;return f.liabilityAttributeValue==="0"&&(f.liabilityAttributeValue=""),f}),s});t.liabilityVOList=t.liabilityVOList.filter(r=>r.liabilityAttributeValue!=="-1").map(r=>{const s=r;return s.liabilityAttributeValue==="0"&&(s.liabilityAttributeValue=""),s});const a={holder:{personVO:I.value.personVO},productCode:e.riskBaseInfo.productCode,insuredVOList:[k(d({},v.value),{personVO:v.value.personVO,productPlanVOList:[{planCode:e.currentPlan||"",riskVOList:[k(d({},t),{riderRiskVOList:o})]}]})]};ne(d({},a)).then(({code:r,data:s})=>{if(r==="10000"){e.retrialTip=!1,e.trialResult=s,e.canTrial=!1;const u={},f=(_=[])=>{_.forEach(m=>{var N;u[m.riskCode]=m,((N=m.riskPremiumDetailVOList)==null?void 0:N.length)&&f(m.riskPremiumDetailVOList)})};f(s.riskPremiumDetailVOList),Object.assign(F.value,u),l("finished",x(a,u))}else e.retrialTip=!0})},q=()=>{var t,o,a,r,s;Promise.all([(o=(t=b.value)==null?void 0:t.validateForm)==null?void 0:o.call(t),(r=(a=B.value)==null?void 0:a.validateForm)==null?void 0:r.call(a),(s=C.value)==null?void 0:s.validate()]).then(()=>{j()})},M=()=>{l("close")},$=()=>{ue({dictCodeList:["RISK_PAYMENT_PERIOD","RISK_INSURANCE_PERIOD"]}).then(({code:o,data:a})=>{if(o==="10000"){const r={};a.forEach(s=>{r[s.dictCode]=s.dictItemList}),e.enumList=r}})},J=()=>{ae({productId:i.productId,source:2}).then(({code:t,data:o})=>{t==="10000"&&(e.riskBaseInfo=o.productBasicInfoVO,(o.productRelationPlanVOList||o.riskDetailVOList||[]).forEach((a,r)=>{r===0&&(e.currentPlan=a.planCode||"0"),Object.assign(h.value,{[a.planCode||r]:{liabilityVOList:[],riderRiskVOList:{}}})}),e.riskData=o.riskDetailVOList||[],e.riskPlanData=o.productRelationPlanVOList||[])}).finally(()=>{})},K=t=>{e.holderFactor=t.holderFactorList,e.insuredFactor=t.insuredFactorList,e.ageRange=t.ageRange};return L([()=>h.value,()=>I.value,()=>v.value],t=>{t&&!e.canTrial&&(e.canTrial=!0,e.retrialTip=!0)},{deep:!0}),L(()=>i.isShow,t=>{e.isShow=t},{immediate:!0}),L(()=>i.productId,t=>{t&&J()},{immediate:!0}),L(()=>i.formInfo,(t={})=>{if(i.type==="edit"){const o={0:k(d({},t.proposalProductRiskList[0]),{riderRiskVOList:t.proposalProductRiskList[0].proposalProductRiskVOList})};Object.assign(h.value,o)}},{deep:!0,immediate:!0}),L(()=>i.productData,t=>{i.type==="edit"&&(console.log("newVal",t),e.riskBaseInfo=t.productBasicInfoVO,e.riskData=t.riskDetailVOList)},{deep:!0,immediate:!0}),L(()=>i,()=>{console.log("props",i)},{deep:!0,immediate:!0}),ee(()=>{$()}),(t,o)=>{const a=O("ProMessage"),r=O("ProTitle"),s=O("VanForm"),u=O("VanButton"),f=O("VanPopup");return g(),R("div",de,[p(f,{show:c(e).isShow,"onUpdate:show":o[0]||(o[0]=_=>c(e).isShow=_),round:"",position:"bottom",closeable:"",style:{height:"80%"},onClose:M},{default:y(()=>{var _,m;return[P("div",pe,[fe,c(S)?(g(),te(a,{key:0,content:c(S)},null,8,["content"])):D("",!0),P("div",me,[c(e).holderFactor.length?(g(),R("div",ke,[p(r,{title:"\u6295\u4FDD\u4EBA"}),p(E,{ref_key:"holderRef",ref:b,"insured-code":(_=c(e).riskBaseInfo)==null?void 0:_.insurerCode,"form-info":I.value.personVO,"factor-list":c(e).holderFactor,"age-range":c(e).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):D("",!0),c(e).insuredFactor.length?(g(),R("div",Ve,[p(r,{title:"\u88AB\u4FDD\u4EBA"}),p(E,{ref_key:"insuredRef",ref:B,"insured-code":(m=c(e).riskBaseInfo)==null?void 0:m.insurerCode,"form-info":v.value.personVO,"factor-list":c(e).insuredFactor,"age-range":c(e).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):D("",!0),P("div",he,[p(r,{title:"\u6295\u4FDD\u65B9\u6848"}),c(e).riskData.length?(g(),R("div",_e,[p(s,{ref_key:"riskFormRef",ref:C,"input-align":"right","error-message-align":"right"},{default:y(()=>[p(oe,{"risk-info":h.value[0],enums:c(e).enumList,"origin-data":c(e).riskData,"pick-factor":K},null,8,["risk-info","enums","origin-data"])]),_:1},512)])):D("",!0)])]),P("div",Le,[p(u,{block:"",type:"primary",onClick:q},{default:y(()=>[Oe]),_:1})])])]}),_:1},8,["show"])])}}});var be=le(ge,[["__scopeId","data-v-96b41f6c"]]);export{be as P,ye as u};
