var ve=Object.defineProperty;var Q=Object.getOwnPropertySymbols;var ke=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var G=(r,p,s)=>p in r?ve(r,p,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[p]=s,J=(r,p)=>{for(var s in p||(p={}))ke.call(p,s)&&G(r,s,p[s]);if(Q)for(var s of Q(p))fe.call(p,s)&&G(r,s,p[s]);return r};import{g as te,a5 as M,C as V,x as O,X as oe,r as I,h as L,m as w,F as se,E as re,y as u,n as k,I as C,z as l,j as B,k as f,s as T,B as D,a1 as ue,a2 as ae,af as Ie,Q as Re,o as Le,d as Pe,a6 as he,D as De}from"./vendor-d47732e4.js";import{u as Fe,P as ge}from"./index-33051361.js";import{b as K,_ as ie,p as Z,o as ye}from"./index-0127c0ca.js";import{a as Ve}from"./trial-adb53a44.js";import{u as ee}from"./useDicData-d50f0087.js";import"./index-2ce256f6.js";import"./trial-45042d91.js";import"./useStorage-47bde96d.js";const Ce=r=>K.post("/api/app/insure/proposal/AddOrUpdateProposal",r),Be=(r={})=>K.get(`/api/app/insure/proposal/queryProposalDetail/${r.id}`,r),Ee=(r={})=>K.post("/api/app/insure/product/listInsureProductDetail",r);const H=r=>(ue("data-v-24d2eeff"),r=r(),ae(),r),be={class:"com-product-list-wrapper"},$e={class:"risk-item-wrapper"},Oe={class:"content"},Ae={class:"risk-premium"},Ne=D(" \u4FDD\u8D39:"),Se={class:"premium"},xe={class:"risk-factor"},we={class:"factor"},Te={class:"factor-value"},Ue=H(()=>u("span",{class:"factor-name"}," \u4FDD\u989D(\u5143) ",-1)),qe={class:"factor"},Ye={class:"factor-value"},je=H(()=>u("span",{class:"factor-name"}," \u4FDD\u969C\u671F\u95F4 ",-1)),Me={class:"factor"},Ke={class:"factor-value"},He=H(()=>u("span",{class:"factor-name"}," \u7F34\u8D39\u671F\u95F4 ",-1)),We={class:"operate-bar"},Xe=D("\u5220\u9664"),ze=D("+ \u9644\u52A0\u9669"),Qe=D("\u4FEE\u6539"),Ge={class:"premium-total"},Je=D(" \u4FDD\u8D39: "),Ze={class:"premium"},et=te({props:{productRiskList:{default:()=>[]},productInfo:{default:()=>({})},productData:{default:()=>({})},pickProductPremium:{type:Function,default:()=>{}},productNum:{default:0}},emits:["deleteRisk","updateRisk","addRiderRisk"],setup(r,{emit:p}){const s=r,[E,F]=M(),t=V({checkedList:[],disabledList:[],riderRiskList:[],mainRiskData:{},totalPremium:0,currentRiskRecord:{}}),A=ee("RISK_PAYMENT_PERIOD"),U=ee("RISK_INSURANCE_PERIOD"),P=O(()=>{var d,i;return((i=(d=s.productData)==null?void 0:d.productRiskVoList)==null?void 0:i[0].riskDetailVOList.filter(c=>c.collocationType!==1))||[]}),N=O(()=>{const d=s.productRiskList.map(i=>i.riskType===2);return P.value.length-d.length}),W=O(()=>d=>{var c,_;const i=((_=(c=s.productData)==null?void 0:c.productRiskVoList)==null?void 0:_[0].riskDetailVOList.find(n=>n.id!==d))||{};return!!(s.productNum||i.collectionType===1)}),a=O(()=>{var i,c;return((c=(i=s.productData)==null?void 0:i.productRiskVoList)==null?void 0:c[0].riskDetailVOList.find(_=>_.riskType===1))||{}}),S=O(()=>a.value.collocationVOList||[]),x=d=>{p("deleteRisk",d,s.productInfo)},q=d=>{p("updateRisk",d,s.productInfo)},Y=d=>{F(!0),t.value.currentRiskRecord=d},j=(d,i)=>{t.value.disabledList=i;const c=d.map(_=>_.id);p("addRiderRisk",c,s.productInfo)};return oe(()=>s.productInfo,d=>{var _;let i=0;const c=n=>{n.forEach(h=>{var g;i+=h.premium,((g=h.riderRiskVOList)==null?void 0:g.length)&&c(h.riderRiskVOList)})};c(d.proposalProductRiskList||[]),(_=s.pickProductPremium)==null||_.call(s,{[`${d.productId}`]:i}),t.value.totalPremium=i},{deep:!0,immediate:!0}),(d,i)=>{const c=I("ProTitle"),_=I("ProCheckButton");return L(),w("div",be,[(L(!0),w(se,null,re(r.productRiskList,n=>{var h,g;return L(),w("div",{key:n.riskId},[u("div",$e,[k(c,{"risk-type":n.riskType,title:n.riskName},null,8,["risk-type","title"]),u("div",Oe,[u("div",Ae,[Ne,u("span",Se,"\uFFE5"+C((h=n.premium)==null?void 0:h.toLocaleString()),1)]),u("div",xe,[u("div",we,[u("span",Te,C((g=n.amount)==null?void 0:g.toLocaleString()),1),Ue]),u("div",qe,[u("span",Ye,C(l(Z)(l(U),n.coveragePeriod)),1),je]),u("div",Me,[u("span",Ke,C(l(Z)(l(A),n.chargePeriod)),1),He])]),u("div",We,[l(W)(n.riskId)?(L(),B(_,{key:0,round:32,class:"border",onClick:o=>x(n)},{default:f(()=>[Xe]),_:2},1032,["onClick"])):T("",!0),l(N)?(L(),B(_,{key:1,activated:"",round:32,onClick:o=>Y(n)},{default:f(()=>[ze]),_:2},1032,["onClick"])):T("",!0),k(_,{activated:"",round:32,onClick:o=>q(n)},{default:f(()=>[Qe]),_:2},1032,["onClick"])])])]),u("div",Ge,[Je,u("span",Ze,"\uFFE5"+C(t.value.totalPremium.toLocaleString()),1)])])}),128)),l(E)?(L(),B(Ve,{key:0,modelValue:t.value.checkedList,"onUpdate:modelValue":i[0]||(i[0]=n=>t.value.checkedList=n),show:l(E),disabled:t.value.disabledList,"risk-list":l(P),"collocation-list":l(S),onFinished:j,onClose:i[1]||(i[1]=n=>l(F)(!1))},null,8,["modelValue","show","disabled","risk-list","collocation-list"])):T("",!0)])}}});var tt=ie(et,[["__scopeId","data-v-24d2eeff"]]);const ot=r=>(ue("data-v-49e4ed7e"),r=r(),ae(),r),st={class:"container"},rt=ot(()=>u("span",null,"\u8BA1\u5212\u4E66\u540D\u79F0",-1)),ut={class:"operate-bar"},at=D("\u6DFB\u52A0\u4E3B\u9669"),it={class:"footer-bar"},dt={class:"trial-result"},nt=D(" \u603B\u4FDD\u8D39 "),lt={class:"result-num"},pt={class:"trial-operate"},ct=D("\u4FDD\u5B58\u5E76\u9884\u89C8"),mt=te({setup(r){const[p,s]=M(),[E,F]=M(),t=V({proposalHolder:{},proposalInsuredList:[{name:"",gender:"",birthday:"",proposalInsuredProductList:[]}],proposalName:"",totalPremium:0,relationUserType:2}),A=Ie(),U=Re(),P=Fe(),{id:N,type:W="add"}=U.query,a=V({productId:0,productCollection:{},productInfo:{},productPremium:{},riderRisk:{},type:"add",currentRisk:[]}),S=V();V({}),V([]);const x=(o,e,v)=>/^.{1,20}$/.test(e)?"":`${o}\u4E0D\u80FD\u8D85\u8FC720\u4E2A\u5B57\u7B26`,q=(o,e)=>{const v=e;De.confirm({message:"\u786E\u8BA4\u5220\u9664\u8BE5\u9669\u79CD\uFF1F"}).then(()=>{o.riskType===1?t.value.proposalInsuredList[0].proposalInsuredProductList=t.value.proposalInsuredList[0].proposalInsuredProductList.filter(y=>y.productId!==e.productId):v.proposalProductRiskList[0].riderRiskVOList=v.proposalProductRiskList[0].riderRiskVOList.filter(y=>y.riskId!==o.riskId)})},Y=(o,e)=>{a.value.productId=e.productId,a.value.productInfo=e,a.value.type="edit",a.value.currentRisk=[o.riskId],F(!0)},j=(o,e)=>{a.value.productId=e.productId,a.value.productInfo=e,a.value.type="addRiderRisk",a.value.currentRisk=o,F(!0)},d=(o={})=>{Object.assign(a.value.productPremium,o),t.value.totalPremium=Object.values(a.value.productPremium).reduce((e,v)=>e+v,0)},i=()=>{Be({id:N}).then(({code:o,data:e})=>{o==="10000"&&Object.assign(t.value,e)})},c=()=>{S.value.validate().then(()=>{Ce(t.value).then(({code:o,data:e})=>{o==="10000"&&(P.$reset(),A.push({path:"/compositionProposal",query:{id:e}}))})})},_=o=>{t.value.proposalInsuredList[0].proposalInsuredProductList=t.value.proposalInsuredList[0].proposalInsuredProductList.map(e=>{let v=e;return e.productId===o.proposalInsuredList[0].proposalInsuredProductList[0].productId&&(v=J({},o.proposalInsuredList[0].proposalInsuredProductList[0])),v}),F(!1)},n=o=>{Ee(o).then(({code:e,data:v})=>{e==="10000"&&(a.value.productCollection=v)}).finally(()=>{})},h=()=>{P.setProposalInfo(t.value),P.setExcludeProduct(Object.keys(a.value.productCollection)),A.push({path:"/proposalList",query:{isCreateProposal:"1"}})},g=()=>{F(!1)};return Le(()=>{const o=P.$state.trialData,e=P.$state.proposalInfo;N?i():!Object.keys(e).length&&o.length?Object.assign(t.value,o[0]):Object.keys(e).length&&o.length&&(e.proposalInsuredList[0].proposalInsuredProductList.push(...o[0].proposalInsuredList[0].proposalInsuredProductList),t.value=e)}),oe(()=>{var o;return(o=t.value.proposalInsuredList[0].proposalInsuredProductList)==null?void 0:o.length},()=>{const o=t.value.proposalInsuredList[0].proposalInsuredProductList.map(e=>({productId:e.productId,source:2}));n({voList:o})}),(o,e)=>{const v=I("VanField"),y=I("ProCard"),de=I("ProRadioButton"),ne=I("VanForm"),le=I("ProCheckButton"),pe=I("VanButton"),ce=I("van-datetime-picker"),me=I("van-popup"),_e=I("ProPageWrap");return L(),B(_e,{class:"page-create-wrapper"},{default:f(()=>{var X;return[u("div",st,[k(ne,{ref_key:"formRef",ref:S,"input-align":"right","error-message-align":"right"},{default:f(()=>[k(y,null,{default:f(()=>[k(v,{modelValue:t.value.proposalName,"onUpdate:modelValue":e[0]||(e[0]=m=>t.value.proposalName=m),name:"proposalName",placeholder:"\u8BF7\u8F93\u5165\u8BA1\u5212\u4E66\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u8BA1\u5212\u4E66\u540D\u79F0"},{validator:(...m)=>x("\u8BA1\u5212\u4E66\u540D\u79F0",...m)}]},{label:f(()=>[rt]),_:1},8,["modelValue","rules"])]),_:1}),k(y,{title:"\u88AB\u4FDD\u4EBA\u4FE1\u606F"},{default:f(()=>{var m,b,$,z;return[k(v,{modelValue:t.value.proposalInsuredList[0].name,"onUpdate:modelValue":e[1]||(e[1]=R=>t.value.proposalInsuredList[0].name=R),name:"name",label:"\u59D3\u540D",rules:[{validator:(...R)=>x("\u59D3\u540D",...R)}],placeholder:"\u8BF7\u8F93\u5165\uFF08\u9009\u586B\uFF09"},null,8,["modelValue","rules"]),k(v,{modelValue:t.value.proposalInsuredList[0].birthday,"onUpdate:modelValue":e[2]||(e[2]=R=>t.value.proposalInsuredList[0].birthday=R),name:"birthday",label:"\u51FA\u751F\u65E5\u671F",formate:"YYYY-MM-DD","is-link":"",readonly:"","min-date":(b=(m=t.value.proposalInsuredList[0])==null?void 0:m.dateRange)==null?void 0:b.minAge,"max-date":(z=($=t.value.proposalInsuredList[0])==null?void 0:$.dateRange)==null?void 0:z.maxAge,placeholder:"\u8BF7\u9009\u62E9",rules:[{required:!0,message:"\u8BF7\u9009\u62E9"}],onClick:e[3]||(e[3]=R=>l(s)(!0))},null,8,["modelValue","min-date","max-date"]),k(v,{modelValue:t.value.proposalInsuredList[0].gender,"onUpdate:modelValue":e[5]||(e[5]=R=>t.value.proposalInsuredList[0].gender=R),name:"gender",label:"\u6027\u522B",rules:[{required:!0,message:"\u8BF7\u9009\u62E9"}]},{input:f(()=>[k(de,{modelValue:t.value.proposalInsuredList[0].gender,"onUpdate:modelValue":e[4]||(e[4]=R=>t.value.proposalInsuredList[0].gender=R),options:l(ye)},null,8,["modelValue","options"])]),_:1},8,["modelValue"])]}),_:1})]),_:1},512),(L(!0),w(se,null,re(t.value.proposalInsuredList[0].proposalInsuredProductList||[],m=>(L(),B(y,{key:m.productId},{default:f(()=>{var b,$;return[k(tt,{"product-risk-list":m.proposalProductRiskList,"product-info":m,"product-num":(($=(b=t.value.proposalInsuredList[0])==null?void 0:b.proposalInsuredProductList)==null?void 0:$.length)-1,"product-data":a.value.productCollection[m.productId],"pick-product-premium":d,onAddRiderRisk:j,onUpdateRisk:Y,onDeleteRisk:q},null,8,["product-risk-list","product-info","product-num","product-data"])]}),_:2},1024))),128)),u("div",ut,[k(le,{activated:"",round:34,onClick:h},{default:f(()=>[at]),_:1})])]),u("div",it,[u("span",dt,[nt,u("span",lt,"\uFFE5"+C(t.value.totalPremium.toLocaleString()),1)]),u("div",pt,[k(pe,{type:"primary",onClick:c},{default:f(()=>[ct]),_:1})])]),k(me,{show:l(p),"onUpdate:show":e[8]||(e[8]=m=>he(p)?p.value=m:null),position:"bottom"},{default:f(()=>[k(ce,{type:"date",onConfirm:e[6]||(e[6]=m=>{t.value.proposalInsuredList[0].birthday=l(Pe)(m).format("YYYY-MM-DD"),l(s)(!1)}),onCancel:e[7]||(e[7]=m=>l(s)(!1))})]),_:1},8,["show"]),l(E)?(L(),B(ge,{key:0,"is-show":l(E),type:a.value.type,"rider-risk":((X=a.value.riderRisk)==null?void 0:X[a.value.productId])||[],"product-data":a.value.productCollection[a.value.productId],"form-info":a.value.productInfo,holder:t.value.proposalHolder,insured:t.value.proposalInsuredList[0],"current-risk":a.value.currentRisk,onClose:g,onFinished:_},null,8,["is-show","type","rider-risk","product-data","form-info","holder","insured","current-risk"])):T("",!0)]}),_:1})}}});var Dt=ie(mt,[["__scopeId","data-v-49e4ed7e"]]);export{Dt as default};
