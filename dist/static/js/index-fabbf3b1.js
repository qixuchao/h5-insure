var je=Object.defineProperty,ze=Object.defineProperties;var Je=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var Qe=Object.prototype.hasOwnProperty,Xe=Object.prototype.propertyIsEnumerable;var de=(N,f,h)=>f in N?je(N,f,{enumerable:!0,configurable:!0,writable:!0,value:h}):N[f]=h,m=(N,f)=>{for(var h in f||(f={}))Qe.call(f,h)&&de(N,h,f[h]);if(ce)for(var h of ce(f))Xe.call(f,h)&&de(N,h,f[h]);return N},p=(N,f)=>ze(N,Je(f));import{g as Ze,a9 as et,O as tt,E as F,M as me,y as Q,T as b,_ as at,l as ot,h as rt,r as pe,af as ut,j as k,n as X,p as _,m as Z,H as nt,t as q,z as K,A as E,J as fe,C as Be,k as he,F as st,D as lt,X as it}from"./vendor-17026bfd.js";import{_ as ct,C as ve,I as ye,H as dt,a0 as mt,a2 as De}from"./index-b0dabf8b.js";import{a as w}from"./order-26db6dbf.js";import{S as O,R as x,f as pt}from"./infoCollection-192ba138.js";import{p as Fe,i as ft,s as ht,g as vt,a as yt,u as Dt,b as Ft}from"./trial-15b712f9.js";import{p as Et}from"./product-a446fd24.js";import{g as ee,a as Ee,t as gt,b as Ct}from"./utils-085c6c29.js";import{t as Nt}from"./theme-ea709837.js";import{d as ge,B as It,D as _t,G as Bt,S as At,H as wt,P as Tt,U as bt,_ as Ot,W as St,c as W,f as Ce,o as Ne,a as G,n as Ie,h as _e}from"./auth-804a81cd.js";import{_ as Pt}from"./index-560e0eb2.js";import"./utils-b6782348.js";import"./trial-0a4413a4.js";import"./index-b2c83ae6.js";import"./bankCard-0e4ce564.js";import"./phoneVerify-35e18af0.js";const Ut={key:0},Ht={class:"page-internet-product-detail"},kt={class:"info"},xt={class:"footer-button"},Mt={class:"price"},Lt=Be(" \u603B\u4FDD\u8D39"),Rt={key:0},Vt=Ze({setup(N){const f=et(),h=tt(),{productCode:M="BWYL2021",tenantId:g,orderNo:S,phoneNo:L,agentCode:R="",saleChannelId:Ae,paymentMethod:y,certNo:te,name:ae,pageCode:P,upgradeCode:we,from:oe}=h.query;console.log(h.query,"route.query");const re=F(),v=F(),U=F(),T=F(),H=P==="payBack",Te=F(!1),V=F(!1),Y=F(!1),be=F(0),j=F(!1),z=F(!1),$=F({show:!1,html:""});let J="";const o=me({holder:{certNo:te,certType:ve.CERT,mobile:L,name:ae,socialFlag:O.HAS},insured:{certNo:te,certType:ve.CERT,name:ae,socialFlag:O.HAS,relationToHolder:x.SELF},paymentMethod:y,renewalDK:"Y",paymentFrequency:pt.MONTH}),B=F(ge),C=F(ge),s=me({showInsure:!H,canInsure:!1,canUpgrade:!1}),Oe=Q(()=>{var a,t;return((t=(a=v.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(e=>e.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),Se=Q(()=>{var a,t;return((t=(a=v.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(e=>e.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),ue=Q(()=>{if(o.holder.certNo){const a=ee(o.holder.certNo,"year"),t=ye(o.holder.certNo);if(a<18)return b("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E18\u5C81\uFF01"),!1;if(o.insured.certNo&&o.insured.relationToHolder===x.MATE){const e=ye(o.insured.certNo);if(t===e)return b("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(o.insured.certNo){const a=ee(o.holder.certNo,"day"),t=ee(o.holder.certNo,"year");if(o.insured.relationToHolder===x.CHILD&&a<30)return b("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(o.insured.relationToHolder===x.PARENT&&t>=71)return b("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E70\u5C81\uFF01"),!1}return!0}),Pe=()=>{const{holder:{certNo:a,mobile:t,name:e,socialFlag:n},insured:{certNo:r,name:u,socialFlag:i,relationToHolder:c},paymentMethod:d}=o;return dt(r)&&!!i},ne=()=>{f.push({path:"/internet/guaranteeUpgrade",query:p(m({},h.query),{tenantId:g,productCode:"BWYL2022",orderNo:S,agentCode:R})})},Ue=()=>{z.value=!1},He=()=>{C.value=B.value},ke=()=>{C.value=p(m({},C.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},xe=async a=>{b.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const t=await Dt(a),{code:e}=t;if(e==="10000"){b.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const n=await Ft({orderNo:a.orderNo,tenantId:g}),{data:r}=n;n.code==="10000"&&(r.type===2?($.value={show:!0,html:r.paymentUrl},console.log("data.paymentUrl",$.value),it(()=>{console.log("document.forms",document.forms);const u=document.getElementById("cashierSubmit");u==null||u.addEventListener("submit",i=>{i.preventDefault()}),u==null||u.submit()})):window.location.href=r.paymentUrl)}s.canInsure=!0}catch{s.canInsure=!0}},Me=a=>{var r,u;const t=JSON.parse((u=(r=U.value)==null?void 0:r.productBasicInfoVO)==null?void 0:u.extInfo);let e="";return t.endorsementFlag===1&&(e=`&upgradeCode=${t.endorsementCode}`),`${De}/internet/productDetail?tenantId=${g}&productCode=${M}&orderNo=${a}&agentCode=${R}&pageCode=payBack${e}&from=${oe||"normal"}`},Le=a=>`${De}/internet/payFail?tenantId=${g}&orderNo=${a}&agentCode=${R}&pageCode=payBack&from=${oe||"normal"}`,Re=async a=>{const t=Ct({tenantId:g,saleUserId:R,saleChannelId:Ae,detail:v.value,insureDetail:U.value,paymentMethod:o.paymentMethod,renewalDK:o.renewalDK,iseeBizNo:J,successJumpUrl:"",premium:T.value,holder:o.holder,insured:o.insured,tenantOrderRiskList:a,orderStatus:"",orderTopStatus:""});try{const e=await ht(t),{code:n,data:r}=e;n==="10000"&&xe(p(m({},t),{orderNo:r.data,extInfo:{extraInfo:{renewalDK:o.renewalDK,paymentMethod:o.paymentMethod,successJumpUrl:Me(r.data),failUrl:Le(r.data)},iseeBizNo:J}}))}catch{s.canInsure=!0}},Ve=async()=>{if(!ue.value)return{};const{calcData:a,riskVOList:t}=Ee({holder:o.holder,insured:o.insured,tenantId:g,paymentFrequency:o.paymentFrequency,productDetail:v.value,insureDetail:U.value},!0),e=await Fe(a),{code:n,data:r}=e;return n==="10000"?(T.value=r.premium,{condition:t,data:r}):{}},Ye=()=>new Promise((a,t)=>{var e,n;(n=(e=re.value)==null?void 0:e.validateForm)==null||n.call(e).then(async()=>{if(!ue.value)return;const{calcData:r,riskVOList:u}=Ee({holder:o.holder,insured:o.insured,tenantId:g,paymentFrequency:o.paymentFrequency,productDetail:v.value,insureDetail:U.value},!0),i=await Fe(r),{code:c,data:d}=i;c==="10000"?(T.value=d.premium,a({condition:u,data:d})):t(new Error)}).catch(()=>{s.canInsure=!0})}),se=async()=>{var a;if(H){ne();return}s.canInsure=!1;try{const{condition:t,data:e}=await Ye(),n={},r=(i=[])=>{(i||[]).forEach(c=>{var d;n[c.riskCode]=c,((d=c.riskPremiumDetailVOList)==null?void 0:d.length)&&r(c.riskPremiumDetailVOList)})};r(e.riskPremiumDetailVOList);const u=gt({tenantId:g,riskList:t,riskPremium:n,productId:(a=v.value)==null?void 0:a.id});Re(u)}catch{s.canInsure=!0}},$e=a=>{a==="allFalse"?(V.value=!1,se(),s.canInsure=!0):lt.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"}).then(()=>{window.history.back()})},qe=()=>{Te.value=!0,Y.value=!1,V.value=!0};at([()=>o.insured.certNo,()=>o.insured.socialFlag],ot.exports.debounce(()=>{o.insured.certNo&&o.insured.socialFlag&&P!=="payBack"&&Pe()&&Ve()},500),{deep:!0,immediate:!0});const le=async()=>{var n,r,u,i,c,d,I,D;const a=await vt({orderNo:S,tenantId:g}),{code:t,data:e}=a;if(t==="10000"){const{tenantOrderHolder:l,tenantOrderInsuredList:A,extInfo:ie}=e;if(!H){Object.assign(o,{holder:{certNo:l.certNo,certType:l.certType,mobile:l.mobile,name:l.name,socialFlag:O.HAS},insured:{certNo:l.certNo,certType:l.certType,name:l.name,socialFlag:O.HAS,relationToHolder:x.SELF},paymentMethod:y,renewalDK:"Y"}),s.canInsure=!0,C.value=Ie,B.value=Ie;return}Object.assign(o,{holder:{certNo:l.certNo,certType:l.certType,mobile:l.mobile,name:l.name,socialFlag:O.HAS},insured:{certNo:A==null?void 0:A[0].certNo,certType:(n=A[0])==null?void 0:n.certType,name:(r=A[0])==null?void 0:r.name,socialFlag:(i=(u=A[0])==null?void 0:u.extInfo)==null?void 0:i.hasSocialInsurance,relationToHolder:(c=A[0])==null?void 0:c.relationToHolder},paymentMethod:ie.extraInfo.paymentMethod,renewalDK:ie.extraInfo.renewalDK||"N"}),T.value=(D=(I=(d=A[0])==null?void 0:d.tenantOrderProductList)==null?void 0:I[0])==null?void 0:D.premium,(e.orderStatus===w.ACCEPT_POLICY||e.orderStatus===w.PAYMENT_SUCCESS)&&(s.canUpgrade=!0,j.value=!1,z.value=!0),e.orderStatus===w.PAYING&&(j.value=!0,setTimeout(()=>{le()},3*1e3))}},Ke=async()=>{var n,r,u,i,c,d;console.log("\u77ED\u4FE1\u8FDB\u5165\uFF0C\u5E26\u4E86orderNo, mobile");const a=await yt({holderPhone:L,orderStatus:[w.PAYING.toUpperCase(),w.TIMEOUT.toUpperCase(),"ACCEPT_POLICY"],productCode:M,tenantId:g}),{code:t,data:e}=a;if(e.orderStatus===w.ACCEPT_POLICY&&(console.log("\u5DF2\u627F\u4FDD\uFF0C\u88AB\u4FDD\u4EBA\u4FE1\u606F\u4E0D\u80FD\u4FEE\u6539"),C.value=p(m({},_e),{paymentDisable:!!y}),B.value=p(m({},_e),{paymentDisable:!!y})),(e.orderStatus===w.PAYING||e.orderStatus===w.TIMEOUT)&&(console.log("\u652F\u4ED8\u4E2D\uFF0C\u8D85\u65F6\u53EF\u4EE5\u4FEE\u6539\u6295\u4FDD\u4EBA\u4FE1\u606F"),C.value=p(m({},G),{paymentDisable:!!y}),B.value=p(m({},G),{paymentDisable:!!y})),t==="10000"&&((n=e==null?void 0:e.tenantOrderHolder)==null?void 0:n.certNo)){s.canInsure=!0;const{tenantOrderHolder:I,tenantOrderInsuredList:D,extInfo:l}=e;Object.assign(o,{holder:{certNo:I.certNo,certType:I.certType,mobile:I.mobile,name:I.name,socialFlag:O.HAS},insured:{certNo:D==null?void 0:D[0].certNo,certType:(r=D[0])==null?void 0:r.certType,name:(u=D[0])==null?void 0:u.name,socialFlag:(c=(i=D[0])==null?void 0:i.extInfo)==null?void 0:c.hasSocialInsurance,relationToHolder:(d=D[0])==null?void 0:d.relationToHolder},paymentMethod:y||l.extraInfo.paymentMethod,renewalDK:l.extraInfo.renewalDK})}else C.value=p(m({},W),{paymentDisable:!!y}),B.value=p(m({},W),{paymentDisable:!!y}),s.canInsure=!0},We=async()=>{const a=Et({productCode:M,withInsureInfo:!0,tenantId:g}),t=ft({productCode:M});await Promise.all([a,t]).then(([e,n])=>{var r;e.code==="10000"&&(v.value=e.data,document.title=((r=e.data)==null?void 0:r.productFullName)||""),n.code==="10000"&&(U.value=n.data)}),S?le():L&&P==="productDetail"&&Ke()},Ge=()=>{P==="free"?H?(C.value=p(m({},Ce),{paymentDisable:!!y}),B.value=p(m({},Ce),{paymentDisable:!!y}),s.canInsure=!0):(C.value=p(m({},W),{paymentDisable:!!y}),B.value=p(m({},W),{paymentDisable:!!y}),s.canInsure=!0):H?(C.value=Ne,B.value=Ne,console.log("\u652F\u4ED8\u5B8C\u6210\u8FDB\u5165")):L||S||(console.log("\u6295\u4FDD\u94FE\u63A5"),C.value=p(m({},G),{paymentFrequencyDisable:!0}),B.value=G,s.canInsure=!0)};return rt(()=>{Ge(),We(),setTimeout(async()=>{J=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(a,t)=>{const e=pe("van-button"),n=pe("van-config-provider"),r=ut("dompurify-html");return k(),X(st,null,[_(n,{"theme-vars":E(Nt)},{default:Z(()=>{var u,i,c,d,I,D,l;return[$.value.show?nt((k(),X("div",Ut,null,512)),[[r,$.value.html]]):q("",!0),K("div",Ht,[K("div",kt,[_(It,{url:(i=(u=v.value)==null?void 0:u.tenantProductInsureVO)==null?void 0:i.banner[0]},null,8,["url"]),_(_t,{"product-name":(c=v.value)==null?void 0:c.productFullName,"product-desc":(I=(d=v.value)==null?void 0:d.showConfigVO)==null?void 0:I.desc},null,8,["product-name","product-desc"])]),_(Bt,{"guarantee-list":(l=(D=v.value)==null?void 0:D.tenantProductInsureVO)==null?void 0:l.titleAndDescVOS},null,8,["guarantee-list"]),_(At,{detail:v.value},{form:Z(()=>[_(wt,{ref_key:"formRef",ref:re,disable:!E(s).showInsure,"form-auth":C.value,"form-info":E(o),premium:T.value,"product-detail":v.value,payments:[1],"payment-method":[0],onOnReset:He,onOnUpdate:ke},null,8,["disable","form-auth","form-info","premium","product-detail"])]),_:1},8,["detail"]),K("div",xt,[K("div",Mt,[Lt,T.value?(k(),X("span",Rt,"\uFFE5"+fe(E(mt)(T.value))+"/\u6708",1)):q("",!0)]),_(e,{type:"primary",class:"right",disabled:!(E(s).canInsure||E(s).canUpgrade),onClick:se},{default:Z(()=>[Be(fe(E(s).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),E(P)!=="payBack"?(k(),he(Tt,{key:1,"product-detail":v.value},null,8,["product-detail"])):q("",!0),_(bt,{"order-no":E(S),"tenant-id":E(g),"upgrade-code":E(we),"is-show":z.value,onOnConfirm:ne,onOnClose:Ue},null,8,["order-no","tenant-id","upgrade-code","is-show"])]}),_:1},8,["theme-vars"]),_(Ot,{show:V.value,"onUpdate:show":t[0]||(t[0]=u=>V.value=u),"content-list":E(Oe),"active-index":0,onOnConfirmHealth:$e},null,8,["show","content-list"]),Y.value?(k(),he(Pt,{key:0,show:Y.value,"onUpdate:show":t[1]||(t[1]=u=>Y.value=u),"content-list":E(Se),"active-index":be.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9",onSubmit:qe},null,8,["show","content-list","active-index"])):q("",!0),_(St,{"is-show":j.value},null,8,["is-show"])],64)}}});var ra=ct(Vt,[["__scopeId","data-v-54a613da"]]);export{ra as default};
