var Re=Object.defineProperty,Ze=Object.defineProperties;var Qe=Object.getOwnPropertyDescriptors;var pe=Object.getOwnPropertySymbols;var ze=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable;var he=(k,p,i)=>p in k?Re(k,p,{enumerable:!0,configurable:!0,writable:!0,value:i}):k[p]=i,se=(k,p)=>{for(var i in p||(p={}))ze.call(p,i)&&he(k,i,p[i]);if(pe)for(var i of pe(p))Je.call(p,i)&&he(k,i,p[i]);return k},De=(k,p)=>Ze(k,Qe(p));import{g as je,C as h,d as t,Q as Le,a0 as $e,L as Ge,M as ge,v as Pe,a4 as ue,m as Y,y as o,n as r,j as D,z as s,J as We,s as B,h as V,F as _e,T as E,D as ye,r as M,k as m,a6 as Ye,I as F,E as Xe,B as Fe,aj as ea}from"./vendor-e9263418.js";/* empty css              */import{s as Ae,c as aa,r as ta,a as sa,b as ua,u as la,g as oa}from"./schedule-eb6c7bee.js";import{a as na}from"./select-105475a6.js";import{_ as ia}from"./index-b2499265.js";import{u as J}from"./useCheckBack-f80d3d5c.js";import{S as ca}from"./index-b8742a0a.js";import{s as da,r as Be,w as Ee}from"./constant-023ef5c0.js";import"./index-e4c11be9.js";var ra="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAA/CAYAAADpCUiCAAAAAXNSR0IArs4c6QAABFdJREFUWEedl01oXVUQx/9z82GTiBJsFUNM7p1zXyI2GAqpNpUWoZuAX1VqBMV0USXWjy666EK00YoLF8VFWy1SQYsoGOsHFaSbQrWtH01Ao9jKu+fc17wQUIzJIjZ5eb47csJNSZuvd3J2F2Z+53/mzpmZQwAQx/Em3/d/IqLEfrssMsYcF5GniaibmftdnK0txXHcmyTJUQADSqmNqwGsSZIkB+C2ioqKbb7vn3aBkDU2xrwsIm+KyKkwDLucAUNDQ/V1dXWXAdxIRBuY+ZdyIbMKUhUHRWQvgI+VUk85A0ZGRhoLhYIWEa+ioiITBIGNy4rrqoJUxQcispOIDjHznhW97W+cb5TNZtd7nvcrEV2prq5ubmxsHFsJcg3AGmutTwJ4EMBrSqnXnQHGmC0i8i2Av2tqapobGhquLAdZoCCNxXkR6SSil5j5sDMgiqLtRPQFgBwzh0RUWgqyqAIRsZfsdwB3ep73ZBAEnzgB0mPsEpFjRPQzM29wBohItdY6JqKGJEm6MpnMqcUgix5hzjCKon1E9BaA00qpbc6AsbGxmyYmJoYB3Axgo1Jq4HrIsgrSxLIK9olIfxiG3c6AXC53e6lUigFUVlVVtTY1Nen5kBUVpCqOAdgF4KhSarczwBjTKiI2Lwoi4odh+NccpCwFqQqbmdtt6QvD8BVngO0dSZJ8D2B8amqqqa2tbdJCylaQZucZEdkKYK9S6m1ngNb6AQBfA8iPj4+rjo6OopOC9JINAWgjop3MfNwJkB6jR0Q+BPAbM9/tDBgYGKiqr6+3yXSHLX3OgPSX2v5xEMCJVQGiKOoiom8AnF0VwBjTLyI7ABxwBgwPD6tisfgHgP88z/OdAcaYwyLyAhG9z8zPOAFGRkZuKRQKw0S0xvO8Nt/3LzoBjDGvisgBm41KqYecUjmOYzvJ2BniVs/z7g+C4IwTIIqiXiKys9QFpdQ9Tte5r6/P6+npuQigJUmSJzKZzKdOgDiOH0mS5EsiMkEQtMxvdWUFUWt9FsB9RLSHmQ851cRsNtvped55AP9MTk42tbe3/+sE0FqfAPDY9bWwrBjk8/mwWCxeEpEiEfnM/KdTY9FavwNgt+3SYRg+69QbR0dH105PT18WEZu264MguOQE0Fr32UELwEml1MNO80E+n6+ZmZmxabuOiLYy83dOgDiOn0uS5F0i+pGZNy3lvOhdsKOuMcaeN1NZWfl4c3PzZ06AKIoeJaLP7cw5ODjY2t3dveSEtqgCrfU5AJuJ6EVmPrLc7gsAuVxuc6lUOiciY7W1tU0rTakLAFprK90e4Q1m3r/S7tcAtNYtAOydnxGR5vlDRFlB1FrbamOrznvM3FvO7lcVZLPZdZ7n2cS5gYjuYmZb98taswVFa23fBfuJ6Ctm3l6WZ2pEadraYXItgC1KKVt9yl6ktX4ewBEi+oGZO8v2nFOgtf4IgH3m7VBK2erjtGZjEMfxvb7vX1jN6/1/ManZmX9zuvMAAAAASUVORK5CYII=",ma="/static/assets/delete.2c9e7b28.png";const va={class:"add-schedule"},fa={class:"container"},pa={class:"bottom"},ha={class:"tim-com"},Da={key:0,class:"time"},ga={class:"day"},_a=o("div",null,[o("img",{class:"ig-arrow",src:ra,alt:""})],-1),ya={key:0,class:"time"},Ya={class:"day"},Aa={class:"img-com"},Ba={class:"com-ig"},Ea=["src","onClick"],Fa=["onClick"],ka=o("div",{class:"del-line"},null,-1),wa=[ka],Ca={key:0},Ma={key:0,class:"img-add"},Ta=o("div",null,"+",-1),ba=[Ta],Ha={key:0},xa=o("div",{class:"icon"},[o("img",{src:ma,class:"item-im1"})],-1),Sa=o("div",null,"\u5220\u9664",-1),Ia=[xa,Sa],Oa={key:1,class:"item check"},Ua={class:"item-check icon"},Va=o("div",null,"\u6807\u8BB0\u5B8C\u6210",-1),qa=Fe("\u4FDD\u5B58"),Na=Fe("\u7F16\u8F91"),Ka={key:1,class:"footer"},Ra={class:"item check else"},Za={class:"item-check icon"},Qa=o("div",{class:"text"},"\u6807\u8BB0\u5B8C\u6210",-1),tt=je({setup(k){const p=new ca({source:"localStorage"}),i="2022-01-01",j="2030-12-31",L=h(!0),$=h(null),le=h(0),ke=e=>e.replace(/\s+/g,""),G=(e,a)=>{const l=[],u=e.split("-"),v=a.split("-"),f=new Date;f.setUTCFullYear(u[0],u[1]-1,u[2]);const y=new Date;y.setUTCFullYear(v[0],v[1]-1,v[2]);const x=f.getTime(),ae=y.getTime();for(let U=x;U<=ae;)l.push(`${t(U).format("YYYY\u5E74MM\u6708DD\u65E5")} \u5468${["\u65E5","\u4E00","\u4E8C","\u4E09","\u56DB","\u4E94","\u516D"][+t(U).format("d")]}`),U+=24*60*60*1e3;return l},q=e=>{const a=[];for(let l=0;l<=e;)l<=9?a.push(`0${l}\u65F6`):a.push(`${l}\u65F6`),l+=1;return a},N=()=>{const e=[];for(let a=0;a<=60;)a<=9?e.push(`0${a}\u5206`):e.push(`${a}\u5206`),a+=5;return e},P=h([{values:G(i,j),defaultIndex:+t().diff(t(i),"day"),className:"date-pick"},{values:q(23),defaultIndex:t().format("HH")},{values:N(),defaultIndex:0}]),K=h(!1),R=h(!1),g=h(!1),W=h(!1),A=h(0),w=h([]),_=h(!0),S=h(!1),Z=h(!1),X=h([]),b=Le(),oe=$e(),ne=t(b.query.chooseDate).format("YYYY-MM-DD"),ie=t().format("HH:mm"),Q=Ge({title:"",type:"\u5BA2\u6237",startTime:t(`${ne} ${ie}`).startOf("hours"),endTime:t(`${ne} ${ie}`).startOf("hours"),remark:"",dispatch:"",dispatchTarget:[],pushType:{name:"\u63D0\u524D30\u5206\u949F",value:"b_30"},source:"\u7CFB\u7EDF",notifier:""});console.log(">>>> route.query",b.query),ge(()=>{window.scrollTo(0,0),sessionStorage.setItem("schedule_type",b.query.chooseType)});const{title:H,type:I,startTime:c,endTime:d,remark:O,dispatch:za,dispatchTarget:T,pushType:z}=Pe(Q),{contentId:C,mold:ce}=b.query,de=async()=>{var a;const{data:e}=await Ae({contentId:C,mold:ce});if(H.value=e.data.title,I.value=e.data.type||"\u5BA2\u6237",c.value=e.data.startTime,d.value=e.data.endTime,X.value=[c.value,d.value],Q.notifier=((a=e.data)==null?void 0:a.assignor)||"",e.data.pushType&&(z.value=Be.find(l=>l.name===e.data.pushType)||{name:"\u63D0\u524D30\u5206\u949F",value:"b_30"}),e.data.dispatch==="Y"){const l=JSON.parse(e.data.dispatchTarget);T.value=l.map(u=>De(se({},u),{agencyId:u.id,agencyName:u.name}))}O.value=e.data.remark,S.value=e.data.status==="Y",_.value=!1,w.value=e.data.images?e.data.images.split(","):[],g.value=e.data.isAllDay==="Y",J(H,I,g,c,d,w,O,T)};ge(()=>{const e=p.get("userInfo");(e==null?void 0:e.userType)==="I"||(e==null?void 0:e.userType)==="O"&&(e==null?void 0:e.agentLevel)<=80?L.value=!0:L.value=!1,C&&de(),C&&(document.title="\u65E5\u7A0B\u8BE6\u60C5")}),J(H,I,g,c,d,w,O,T);const ee=()=>{let e=t(c.value).format("YYYY-MM-DD HH:mm:ss"),a=t(d.value).format("YYYY-MM-DD HH:mm:ss");console.log("sw.value: ",g.value),g.value&&(e=t(c.value).startOf("day").format("YYYY-MM-DD HH:mm:ss"),a=t(d.value).endOf("day").format("YYYY-MM-DD HH:mm:ss")),ua({title:H.value,contentId:C,mold:"",type:I.value,isAllDay:g.value?"Y":"N",crossDayFlag:"N",startTime:e,endTime:a,images:w.value.toString(),remark:O.value,pushType:z.value.name,dispatch:T.value.length?"Y":"N",dispatchTarget:T.value}).then(l=>{Z.value=!0,l.data.data&&E("\u4FDD\u5B58\u6210\u529F").$nextTick(()=>{J(),oe.back()})}).finally(()=>{Z.value=!1})},we=async()=>{if(!H.value)return E("\u8BF7\u586B\u5199\u65E5\u7A0B\u6807\u9898");if(!I.value)return E("\u8BF7\u9009\u62E9\u65E5\u7A0B\u7C7B\u578B");if(t(c.value).diff(d.value)>0)return E("\u65E5\u7A0B\u7ED3\u675F\u65F6\u95F4\u4E0D\u80FD\u5C0F\u4E8E\u5F00\u59CB\u65F6\u95F4");const e=t(X.value[0]).format("YYYY-MM-DD HH:mm:ss");let a=t(c.value).format("YYYY-MM-DD HH:mm:ss");const l=t(X.value[1]).format("YYYY-MM-DD HH:mm:ss");let u=t(d.value).format("YYYY-MM-DD HH:mm:ss");if(g.value&&(a=t(c.value).startOf("day").format("YYYY-MM-DD HH:mm:ss"),u=t(d.value).endOf("day").format("YYYY-MM-DD HH:mm:ss")),console.log("oldStartTime: ",e),console.log("newStartTime: ",a),console.log("oldEndTime: ",l),console.log("newEndTime: ",u),e!==a||l!==u){const{data:f}=await aa({startTime:a,endTime:u});f.data?ee():ye.confirm({title:"\u6E29\u99A8\u63D0\u793A",message:"\u5F53\u524D\u65F6\u95F4\u6BB5\u5DF2\u5B58\u5728\u5F85\u529E\u65E5\u7A0B\uFF0C\u662F\u5426\u786E\u8BA4\u7EE7\u7EED\u6DFB\u52A0\uFF1F"}).then(()=>{ee()}).catch(()=>{Z.value=!1})}else ee()},Ce=e=>{I.value=e.value},Me=e=>{z.value=e},re=e=>{_.value&&(A.value=e)},Te=(e,a)=>{if(g.value){const[l]=e,u=l.slice(0,-3),v=[u].join(""),f=v.replace(/年|月|日|时|分/g,"");console.log(l,u,v,f),A.value===1?c.value=t(f).format("YYYY-MM-DD HH:mm"):A.value===2&&(d.value=t(f).format("YYYY-MM-DD HH:mm")),A.value=0}else{const[l,u,v]=e,f=l.slice(0,-3),y=[f,u,v].join(""),x=y.replace(/年|月|日|时|分/g,"");console.log(l,u,v,f,y,x),A.value===1?c.value=t(x).format("YYYY-MM-DD HH:mm:ss"):A.value===2&&(d.value=t(x).format("YYYY-MM-DD HH:mm:ss")),A.value=0}};ue(g,(e,a)=>{e?P.value=[{values:G(i,j),defaultIndex:+t().diff(t(i),"day"),className:"date-pick"}]:P.value=[{values:G(i,j),defaultIndex:+t().diff(t(i),"day"),className:"date-pick"},{values:q(23),defaultIndex:0},{values:N(),defaultIndex:0}]}),ue(A,(e,a)=>{e===1&&setTimeout(()=>{t(c.value).format("YYYY-MM-DD");const l=`${t(c.value).format("HH")}\u65F6`,u=`${t(c.value).format("mm")}\u5206`;$.value.setIndexes([+t(c.value).diff(t(i),"day"),q(23).indexOf(l),N().indexOf(u)])},0),e===2&&setTimeout(()=>{t(d.value).format("YYYY-MM-DD");const l=`${t(d.value).format("HH")}\u65F6`,u=`${t(d.value).format("mm")}\u5206`;$.value.setIndexes([+t(d.value).diff(t(i),"day"),q(23).indexOf(l),N().indexOf(u)])},0)}),ue(T,async e=>{const a=[];e.forEach(u=>{const{id:v,memberCode:f,memberType:y}=u;a.push({memberCode:f||v,memberType:y})});const{data:{data:l=0}}=await na({codeList:a});le.value=l});const be=()=>{E("\u6587\u4EF6\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7 5M")},He=e=>{E.loading({message:"\u56FE\u7247\u4E0A\u4F20\u4E2D..."});try{const a=new FileReader;a.readAsDataURL(e),a.onload=async l=>{var y;const u=await la({fileBase64:(y=l==null?void 0:l.target)==null?void 0:y.result}),{data:v}=u.data,f=await oa({key:v});w.value.push(f.data.data.fileOriginalUrl),E.clear()}}catch{E.clear()}},xe=e=>{ea({images:w.value,startPosition:e})},Se=e=>{T.value=e.map(a=>se({id:a.agencyId,name:a.agencyName},a))},Ie=async()=>{var a;const{data:e}=await Ae({contentId:C,mold:ce});((a=e.data)==null?void 0:a.dispatchStatus)==="2"?_.value=!0:E("\u65E5\u7A0B\u901A\u77E5\u4E0B\u53D1\u4E2D\uFF0C\u8BF7\u7A0D\u540E\u64CD\u4F5C")},Oe=()=>{_.value&&(R.value=!0)},Ue=()=>{ye.confirm({title:"\u63D0\u793A",message:"\u786E\u8BA4\u5220\u9664\uFF1F"}).then(async()=>{await ta({contentId:C}),E("\u5220\u9664\u6210\u529F").$nextTick(()=>{J(),oe.back()})})},Ve=()=>{_.value&&(W.value=!0)},qe=()=>{_.value&&(K.value=!0)},Ne=e=>{_.value&&w.value.splice(e,1)},me=()=>{sa({contentId:C,status:S.value?"Y":"N"}).then(()=>{de(),E(S.value?"\u606D\u559C\u4F60\uFF0C\u5B8C\u6210\u4E86\u4E00\u4E2A\u4E8B\u9879":"\u8BE5\u4E8B\u9879\u88AB\u91CD\u65B0\u6253\u5F00")})};return(e,a)=>{const l=M("van-field"),u=M("van-cell"),v=M("van-cell-group"),f=M("van-switch"),y=M("van-uploader"),x=M("van-action-sheet"),ae=M("van-picker"),U=M("van-popup"),ve=M("van-checkbox"),fe=M("van-button");return m(),Y(_e,null,[o("div",va,[o("div",fa,[r(v,{inset:""},{default:D(()=>[r(l,{modelValue:s(H),"onUpdate:modelValue":a[0]||(a[0]=n=>Ye(H)?H.value=n:null),disabled:!_.value,placeholder:"\u6DFB\u52A0\u65E5\u7A0B\u6807\u9898",formatter:ke,class:"title-input",maxlength:"15"},null,8,["modelValue","disabled"]),r(u,{title:"\u65E5\u7A0B\u7C7B\u578B","is-link":"",onClick:Oe},{value:D(()=>[o("span",null,F(s(I)),1)]),_:1}),r(u,{title:"\u5185\u5BB9"}),r(l,{modelValue:s(O),"onUpdate:modelValue":a[1]||(a[1]=n=>Ye(O)?O.value=n:null),placeholder:"\u8BF7\u8F93\u5165\u8BE6\u7EC6\u5185\u5BB9",rows:"4",type:"textarea",class:"input-addschedule-area",maxlength:"200","show-word-limit":"",disabled:!_.value},null,8,["modelValue","disabled"])]),_:1}),o("div",pa,[r(v,{inset:""},{default:D(()=>[r(u,{center:"",title:"\u5168\u5929\u4E8B\u9879",class:"all-day"},{value:D(()=>[r(f,{modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=n=>g.value=n),disabled:!_.value,size:"22"},null,8,["modelValue","disabled"])]),_:1}),r(u,null,{default:D(()=>[o("div",ha,[o("div",{onClick:a[3]||(a[3]=n=>re(1))},[g.value?B("",!0):(m(),Y("p",Da,F(s(c)?s(t)(s(c)).format("HH:mm"):s(t)().format("HH:00")),1)),o("p",ga,F(s(t)(s(c)).format("MM\u6708DD\u65E5"))+" \u5468"+F(s(Ee)[s(t)(s(c)).day()]),1)]),_a,o("div",{onClick:a[4]||(a[4]=n=>re(2))},[g.value?B("",!0):(m(),Y("p",ya,F(s(d)?s(t)(s(d)).format("HH:mm"):s(t)().format("HH:00")),1)),o("p",Ya,F(s(t)(s(d)).format("MM\u6708DD\u65E5"))+" \u5468"+F(s(Ee)[s(t)(s(d)).day()]),1)])])]),_:1}),r(u,{title:"\u65E5\u7A0B\u63D0\u9192","is-link":"",onClick:qe},{value:D(()=>[o("span",null,F(s(z).name),1)]),_:1}),r(u,{title:"\u56FE\u7247"}),r(u,null,{default:D(()=>[o("div",Aa,[o("div",Ba,[(m(!0),Y(_e,null,Xe(s(w),(n,te)=>(m(),Y("div",{key:te,class:"img-prw"},[o("img",{src:n,onClick:Ke=>xe(te)},null,8,Ea),o("div",{class:"del",onClick:Ke=>Ne(te)},wa,8,Fa)]))),128)),s(w).length===0&&!_.value?(m(),Y("div",Ca,"-")):B("",!0),_.value?(m(),V(y,{key:1,"max-size":5*1024*1024,"result-type":"file","max-count":3,"before-read":He,"preview-size":"80",onOversize:be},{default:D(()=>[s(w).length<3?(m(),Y("div",Ma,ba)):B("",!0)]),_:1})):B("",!0)])])]),_:1}),s(b).query.mold==="issued"?(m(),V(u,{key:0,title:"\u6765\u6E90"},{value:D(()=>[o("span",null,F(s(Q).source),1)]),_:1})):B("",!0),s(b).query.mold==="issued"?(m(),V(u,{key:1,title:"\u901A\u77E5\u4EBA"},{value:D(()=>[o("span",null,F(s(Q).notifier),1)]),_:1})):B("",!0),L.value&&s(b).query.mold!=="issued"?(m(),V(u,{key:2,title:"\u901A\u77E5\u4EBA\u7FA4","is-link":"",onClick:Ve},{value:D(()=>[s(T).length?(m(),Y("span",Ha," \u5DF2\u9009"+F(le.value)+" \u4EBA ",1)):B("",!0)]),_:1})):B("",!0)]),_:1})])]),r(x,{show:R.value,"onUpdate:show":a[5]||(a[5]=n=>R.value=n),actions:s(da),"close-on-click-action":"","cancel-text":"\u53D6\u6D88",onSelect:Ce,onCancel:a[6]||(a[6]=n=>R.value=!1)},null,8,["show","actions"]),r(x,{show:K.value,"onUpdate:show":a[7]||(a[7]=n=>K.value=n),actions:s(Be),"close-on-click-action":"","cancel-text":"\u53D6\u6D88",onSelect:Me,onCancel:a[8]||(a[8]=n=>K.value=!1)},null,8,["show","actions"]),r(ia,{visible:W.value,"onUpdate:visible":a[9]||(a[9]=n=>W.value=n),mode:"multiple","select-value":s(T),onOnSubmit:Se},null,8,["visible","select-value"]),r(U,{show:A.value>0,position:"bottom",style:{height:"40%"}},{default:D(()=>[r(ae,{ref_key:"pickerRef",ref:$,title:"\u9009\u62E9\u65E5\u671F",show:A.value>0,class:"picker-lct",columns:P.value,onCancel:a[10]||(a[10]=n=>A.value=0),onConfirm:Te},null,8,["show","columns"])]),_:1},8,["show"])]),s(b).query.mold!=="issued"?(m(),Y("div",{key:0,class:We(["footer",[!s(C)&&"footer-bt"]])},[s(C)?(m(),Y("div",{key:0,class:"item",onClick:Ue},Ia)):B("",!0),s(C)?(m(),Y("div",Oa,[o("div",Ua,[r(ve,{modelValue:S.value,"onUpdate:modelValue":a[11]||(a[11]=n=>S.value=n),shape:"square","icon-size":"18",onClick:me},null,8,["modelValue"])]),Va])):B("",!0),_.value?(m(),V(fe,{key:2,class:"btn",block:!0,disabled:Z.value,onClick:we},{default:D(()=>[qa]),_:1},8,["disabled"])):(m(),V(fe,{key:3,class:"btn",onClick:Ie},{default:D(()=>[Na]),_:1}))],2)):(m(),Y("div",Ka,[o("div",Ra,[o("div",Za,[r(ve,{modelValue:S.value,"onUpdate:modelValue":a[12]||(a[12]=n=>S.value=n),shape:"square","icon-size":"18",onClick:me},null,8,["modelValue"])]),Qa])]))],64)}}});export{tt as default};
