var je=Object.defineProperty,ze=Object.defineProperties;var Je=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var Qe=Object.prototype.hasOwnProperty,Xe=Object.prototype.propertyIsEnumerable;var ue=(w,h,v)=>h in w?je(w,h,{enumerable:!0,configurable:!0,writable:!0,value:v}):w[h]=v,y=(w,h)=>{for(var v in h||(h={}))Qe.call(h,v)&&ue(w,v,h[v]);if(se)for(var v of se(h))Xe.call(h,v)&&ue(w,v,h[v]);return w},D=(w,h)=>ze(w,Je(h));import{g as Ze,a9 as et,O as tt,E as g,M as le,y as ie,_ as at,l as ot,h as rt,r as ce,af as nt,j,n as de,p as I,m as z,H as st,t as me,z as k,A as E,J as pe,C as be,k as ut,F as lt,T as fe,X as it}from"./vendor-505c98f2.js";import{_ as ct,C as he,$ as dt,G as ve,a1 as ye}from"./index-52478e3d.js";import{a as T}from"./order-c0ced472.js";import{S as O,R as De,f as mt}from"./infoCollection-3dff23c4.js";import{p as ge,i as pt,s as ft,g as ht,a as vt,u as yt,b as Dt}from"./trial-bc264902.js";import{p as gt}from"./product-461203cc.js";import{d as Fe,B as Ft,D as Ct,G as _t,S as Et,H as It,P as wt,U as Nt,_ as bt,W as Tt,v as At,a as Ce,c as R,f as _e,o as Ee,b as Y,n as Ie,h as we}from"./auth-a426bd7f.js";import{_ as Ot,g as Ne,t as Pt,a as St}from"./index-a68cb009.js";import{t as Bt}from"./theme-ea709837.js";import"./utils-b6782348.js";import"./index-229b5f6e.js";import"./bankCard-b9d5732e.js";import"./phoneVerify-a41da179.js";import"./trial-40e8fb76.js";const Ut={key:0},kt={class:"page-internet-product-detail"},Ht={class:"info"},Mt={class:"footer-button"},xt={class:"price"},Vt=be(" \u603B\u4FDD\u8D39"),Lt=Ze({setup(w){const h=et(),v=tt(),{productCode:H="BWYL2021",tenantId:C,orderNo:P,phoneNo:M,agentCode:x="",saleChannelId:Te,paymentMethod:F,certNo:J,name:Q,pageCode:S,from:X}=v.query;console.log(v.query,"route.query");const $=g(),m=g(),B=g(),A=g(),U=S==="payBack",Z=g(!1),V=g(!1),q=g(!1),ee=g(0),K=g(!1),G=g(!1),L=g({show:!1,html:""}),te=g(!0);let W="";const s=le({holder:{certNo:J,certType:he.CERT,mobile:M,name:Q,socialFlag:O.HAS},insured:{certNo:J,certType:he.CERT,name:Q,socialFlag:O.HAS,relationToHolder:De.SELF},paymentMethod:F,renewalDK:"Y",paymentFrequency:mt.MONTH}),N=g(Fe),_=g(Fe),u=le({showInsure:!U,canInsure:!1,canUpgrade:!1}),Ae=t=>{te.value=!t},Oe=ie(()=>{var t,a;return((a=(t=m.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:a.attachmentVOList.filter(e=>e.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),Pe=ie(()=>{var t,a;return((a=(t=m.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:a.attachmentVOList.filter(e=>e.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),Se=()=>{const{holder:{certNo:t,mobile:a,name:e,socialFlag:r},insured:{certNo:o,name:n,socialFlag:d,relationToHolder:i},paymentMethod:p}=s,f=ve(t)&&At(a)&&Ce(e)&&!!r,l=ve(o)&&Ce(n)&&!!d&&!!i;return!!(f&&l&&!!p)},ae=()=>{h.push({path:"/internet/guaranteeUpgrade",query:D(y({},v.query),{tenantId:C,productCode:"BWYL2022",orderNo:P,agentCode:x})})},Be=()=>{G.value=!1},Ue=()=>{_.value=N.value},ke=()=>{_.value=D(y({},_.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},He=async t=>{fe.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const a=await yt(t),{code:e}=a;if(e==="10000"){fe.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const r=await Dt({orderNo:t.orderNo,tenantId:C}),{data:o}=r;r.code==="10000"&&(o.type===2?(L.value={show:!0,html:o.paymentUrl},console.log("data.paymentUrl",L.value),it(()=>{console.log("document.forms",document.forms);const n=document.getElementById("cashierSubmit");n==null||n.addEventListener("submit",d=>{d.preventDefault()}),n==null||n.submit()})):window.location.href=o.paymentUrl)}u.canInsure=!0}catch{u.canInsure=!0}},Me=t=>`${ye}/internet/productDetail?tenantId=${C}&productCode=${H}&orderNo=${t}&agentCode=${x}&pageCode=payBack&from=${X||"normal"}`,xe=t=>`${ye}/internet/payFail?tenantId=${C}&orderNo=${t}&agentCode=${x}&pageCode=payBack&from=${X||"normal"}`,Ve=async t=>{const a=St({tenantId:C,saleUserId:x,saleChannelId:Te,detail:m.value,insureDetail:B.value,paymentMethod:s.paymentMethod,renewalDK:s.renewalDK,iseeBizNo:W,successJumpUrl:"",premium:A.value,holder:s.holder,insured:s.insured,tenantOrderRiskList:t,orderStatus:"",orderTopStatus:""});try{const e=await ft(a),{code:r,data:o}=e;r==="10000"&&He(D(y({},a),{orderNo:o.data,extInfo:{extraInfo:{renewalDK:s.renewalDK,paymentMethod:s.paymentMethod,successJumpUrl:Me(o.data),failUrl:xe(o.data)},iseeBizNo:W}}))}catch{u.canInsure=!0}},Le=async()=>{const{calcData:t,riskVOList:a}=Ne({holder:s.holder,insured:s.insured,tenantId:C,paymentFrequency:s.paymentFrequency,productDetail:m.value,insureDetail:B.value}),e=await ge(t),{code:r,data:o}=e;return r==="10000"?(A.value=o.premium,{condition:a,data:o}):{}},Re=t=>{ee.value=t,q.value=!0},Ye=()=>new Promise((t,a)=>{var e,r;(r=(e=$.value)==null?void 0:e.validateForm)==null||r.call(e).then(async()=>{var l;if(!(((l=$.value)==null?void 0:l.isAgreeFile)||Z.value)){V.value=!0;return}const{calcData:n,riskVOList:d}=Ne({holder:s.holder,insured:s.insured,tenantId:C,paymentFrequency:s.paymentFrequency,productDetail:m.value,insureDetail:B.value},!0),i=await ge(n),{code:p,data:f}=i;p==="10000"?(A.value=f.premium,t({condition:d,data:f})):a(new Error)}).catch(()=>{u.canInsure=!0})}),oe=async()=>{var t;if(U){ae();return}u.canInsure=!1;try{const{condition:a,data:e}=await Ye(),r={},o=(d=[])=>{(d||[]).forEach(i=>{var p;r[i.riskCode]=i,((p=i.riskPremiumDetailVOList)==null?void 0:p.length)&&o(i.riskPremiumDetailVOList)})};o(e.riskPremiumDetailVOList);const n=Pt({tenantId:C,riskList:a,riskPremium:r,productId:(t=m.value)==null?void 0:t.id});Ve(n)}catch{u.canInsure=!0}},$e=t=>{t==="allFalse"&&(V.value=!1,Re(0)),u.canInsure=!0},qe=()=>{Z.value=!0,oe()};at(()=>s,ot.exports.debounce(()=>{m.value&&B.value&&S!=="payBack"&&Se()&&Le()},500),{deep:!0,immediate:!0});const re=async()=>{var r,o,n,d,i,p,f,l;const t=await ht({orderNo:P,tenantId:C}),{code:a,data:e}=t;if(a==="10000"){const{tenantOrderHolder:c,tenantOrderInsuredList:b,extInfo:ne}=e;if(!U){Object.assign(s,{holder:{certNo:c.certNo,certType:c.certType,mobile:c.mobile,name:c.name,socialFlag:O.HAS},insured:{certNo:c.certNo,certType:c.certType,name:c.name,socialFlag:O.HAS,relationToHolder:De.SELF},paymentMethod:F,renewalDK:"Y"}),u.canInsure=!0,_.value=Ie,N.value=Ie;return}Object.assign(s,{holder:{certNo:c.certNo,certType:c.certType,mobile:c.mobile,name:c.name,socialFlag:O.HAS},insured:{certNo:b==null?void 0:b[0].certNo,certType:(r=b[0])==null?void 0:r.certType,name:(o=b[0])==null?void 0:o.name,socialFlag:(d=(n=b[0])==null?void 0:n.extInfo)==null?void 0:d.hasSocialInsurance,relationToHolder:(i=b[0])==null?void 0:i.relationToHolder},paymentMethod:ne.extraInfo.paymentMethod,renewalDK:ne.extraInfo.renewalDK||"N"}),A.value=(l=(f=(p=b[0])==null?void 0:p.tenantOrderProductList)==null?void 0:f[0])==null?void 0:l.premium,(e.orderStatus===T.ACCEPT_POLICY||e.orderStatus===T.PAYMENT_SUCCESS)&&(u.canUpgrade=!0,K.value=!1,G.value=!0),e.orderStatus===T.PAYING&&(K.value=!0,setTimeout(()=>{re()},3*1e3))}},Ke=async()=>{var r,o,n,d,i,p;console.log("\u77ED\u4FE1\u8FDB\u5165\uFF0C\u5E26\u4E86orderNo, mobile");const t=await vt({holderPhone:M,orderStatus:[T.PAYING.toUpperCase(),T.TIMEOUT.toUpperCase(),"ACCEPT_POLICY"],productCode:H,tenantId:C}),{code:a,data:e}=t;if(e.orderStatus===T.ACCEPT_POLICY&&(console.log("\u5DF2\u627F\u4FDD\uFF0C\u88AB\u4FDD\u4EBA\u4FE1\u606F\u4E0D\u80FD\u4FEE\u6539"),_.value=D(y({},we),{paymentDisable:!!F}),N.value=D(y({},we),{paymentDisable:!!F})),(e.orderStatus===T.PAYING||e.orderStatus===T.TIMEOUT)&&(console.log("\u652F\u4ED8\u4E2D\uFF0C\u8D85\u65F6\u53EF\u4EE5\u4FEE\u6539\u6295\u4FDD\u4EBA\u4FE1\u606F"),_.value=D(y({},Y),{paymentDisable:!!F}),N.value=D(y({},Y),{paymentDisable:!!F})),a==="10000"&&((r=e==null?void 0:e.tenantOrderHolder)==null?void 0:r.certNo)){u.canInsure=!0;const{tenantOrderHolder:f,tenantOrderInsuredList:l,extInfo:c}=e;Object.assign(s,{holder:{certNo:f.certNo,certType:f.certType,mobile:f.mobile,name:f.name,socialFlag:O.HAS},insured:{certNo:l==null?void 0:l[0].certNo,certType:(o=l[0])==null?void 0:o.certType,name:(n=l[0])==null?void 0:n.name,socialFlag:(i=(d=l[0])==null?void 0:d.extInfo)==null?void 0:i.hasSocialInsurance,relationToHolder:(p=l[0])==null?void 0:p.relationToHolder},paymentMethod:F||c.extraInfo.paymentMethod,renewalDK:c.extraInfo.renewalDK})}else _.value=D(y({},R),{paymentDisable:!!F}),N.value=D(y({},R),{paymentDisable:!!F}),u.canInsure=!0},Ge=async()=>{const t=gt({productCode:H,withInsureInfo:!0,tenantId:C}),a=pt({productCode:H});await Promise.all([t,a]).then(([e,r])=>{var o;e.code==="10000"&&(m.value=e.data,document.title=((o=e.data)==null?void 0:o.productFullName)||""),r.code==="10000"&&(B.value=r.data)}),P?re():M&&S==="productDetail"&&Ke()},We=()=>{S==="free"?U?(_.value=D(y({},_e),{paymentDisable:!!F}),N.value=D(y({},_e),{paymentDisable:!!F}),u.canInsure=!0):(_.value=D(y({},R),{paymentDisable:!!F}),N.value=D(y({},R),{paymentDisable:!!F}),u.canInsure=!0):U?(_.value=Ee,N.value=Ee,console.log("\u652F\u4ED8\u5B8C\u6210\u8FDB\u5165")):M||P||(console.log("\u6295\u4FDD\u94FE\u63A5"),_.value=Y,N.value=Y,u.canInsure=!0)};return rt(()=>{We(),Ge(),setTimeout(async()=>{W=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(t,a)=>{const e=ce("van-button"),r=ce("van-config-provider"),o=nt("dompurify-html");return j(),de(lt,null,[I(r,{"theme-vars":E(Bt)},{default:z(()=>{var n,d,i,p,f,l,c;return[L.value.show?st((j(),de("div",Ut,null,512)),[[o,L.value.html]]):me("",!0),k("div",kt,[k("div",Ht,[I(Ft,{url:(d=(n=m.value)==null?void 0:n.tenantProductInsureVO)==null?void 0:d.banner[0]},null,8,["url"]),I(Ct,{"product-name":(i=m.value)==null?void 0:i.productFullName,"product-desc":(f=(p=m.value)==null?void 0:p.showConfigVO)==null?void 0:f.desc},null,8,["product-name","product-desc"])]),I(_t,{"guarantee-list":(c=(l=m.value)==null?void 0:l.tenantProductInsureVO)==null?void 0:c.titleAndDescVOS},null,8,["guarantee-list"]),I(Et,{detail:m.value},{form:z(()=>[I(It,{ref_key:"formRef",ref:$,disable:!E(u).showInsure,"form-auth":_.value,"form-info":E(s),premium:A.value,"product-detail":m.value,payments:[1],"payment-method":[0],onOnVerify:Ae,onOnReset:Ue,onOnUpdate:ke},null,8,["disable","form-auth","form-info","premium","product-detail"])]),_:1},8,["detail"]),k("div",Mt,[k("div",xt,[Vt,k("span",null,"\uFFE5"+pe(E(dt)(A.value))+"/\u6708",1)]),I(e,{type:"primary",class:"right",disabled:te.value||!(E(u).canInsure||E(u).canUpgrade),onClick:oe},{default:z(()=>[be(pe(E(u).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),E(S)!=="payBack"?(j(),ut(wt,{key:1,"product-detail":m.value},null,8,["product-detail"])):me("",!0),I(Nt,{"order-no":E(P),"tenant-id":E(C),"is-show":G.value,onOnConfirm:ae,onOnClose:Be},null,8,["order-no","tenant-id","is-show"])]}),_:1},8,["theme-vars"]),I(bt,{show:V.value,"onUpdate:show":a[0]||(a[0]=n=>V.value=n),"content-list":E(Oe),"active-index":0,onOnConfirmHealth:$e},null,8,["show","content-list"]),I(Ot,{show:q.value,"onUpdate:show":a[1]||(a[1]=n=>q.value=n),"content-list":E(Pe),"active-index":ee.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9",onSubmit:qe},null,8,["show","content-list","active-index"]),I(Tt,{"is-show":K.value},null,8,["is-show"])],64)}}});var aa=ct(Lt,[["__scopeId","data-v-e0e7231a"]]);export{aa as default};
