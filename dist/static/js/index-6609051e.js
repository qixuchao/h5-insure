var z=Object.defineProperty,J=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var U=(i,s,u)=>s in i?z(i,s,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[s]=u,E=(i,s)=>{for(var u in s||(s={}))G.call(s,u)&&U(i,u,s[u]);if($)for(var u of $(s))X.call(s,u)&&U(i,u,s[u]);return i},N=(i,s)=>J(i,W(s));import{g as L,E as C,M as O,_ as Y,r as f,j as _,k as D,m as k,p as g,A as r,z as m,J as K,L as Q,n as P,G as q,F as S,C as R,T as x,O as Z,a9 as ee,h as te}from"./vendor-667a94d7.js";import{a as oe}from"./infoCollection-242da9b6.js";import{s as ne,c as ae}from"./phoneVerify-cb26bf6e.js";import{a3 as se}from"./index-dea51c7e.js";import{g as ue,m as le,i as re}from"./trial-8a3a4846.js";import{p as ce}from"./product-3bf586c8.js";import{g as ie,l as me,a as de}from"./logo-5f850c58.js";import{b as fe}from"./blank-84b83865.js";import"./trial-524ba1cc.js";const pe={class:"agree"},_e=R(" \u6211\u5DF2\u9605\u8BFB\u5E76\u540C\u610F "),ve=L({props:{info:{type:Object,default:()=>{}}},emits:["on-verify"],setup(i,{emit:s}){var y,l;const u=i,c=C({}),F=30,a=C(0),p=C("\u83B7\u53D6\u9A8C\u8BC1\u7801"),b=/\d{9}/,n=/^\d{6}$/,t=O({mobile:(l=(y=u.info)==null?void 0:y.userInfo)==null?void 0:l.mobile,smsCode:"",agree:""}),h=()=>{if(a.value>0)return;a.value=F;const e=()=>{p.value=`${a.value}s`,a.value-=1};e();const o=setInterval(()=>{a.value===0?(p.value="\u83B7\u53D6\u9A8C\u8BC1\u7801",a.value=0,clearInterval(o)):e()},1e3)},I=async()=>{a.value>0||c==null||c.value.validate("mobile").then(async()=>{const e=await ne(t.mobile),{code:o,data:d}=e;o==="10000"&&(x({message:"\u77ED\u4FE1\u53D1\u9001\u6210\u529F\uFF0C\u8BF7\u67E5\u6536"}),h())})},B=async()=>{const e=await ae(t.mobile,t.smsCode),{data:o}=e;o&&s("on-verify",t)},V=async()=>{c==null||c.value.validate().then(async()=>{B()})};return Y(()=>t,()=>{b.test(t.mobile)&&n.test(t.smsCode)&&B()},{deep:!0,immediate:!0}),(e,o)=>{const d=f("van-field"),A=f("van-cell-group"),w=f("van-checkbox"),j=f("ProPDFviewer"),H=f("VanForm");return _(),D(H,{ref_key:"formRef",ref:c},{default:k(()=>{var T;return[g(A,null,{default:k(()=>[g(d,{modelValue:r(t).mobile,"onUpdate:modelValue":o[0]||(o[0]=v=>r(t).mobile=v),name:"mobile",label:"\u624B\u673A\u53F7",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",rules:[{pattern:b,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7"}]},null,8,["modelValue","rules"]),g(d,{modelValue:r(t).smsCode,"onUpdate:modelValue":o[1]||(o[1]=v=>r(t).smsCode=v),name:"smsCode",label:"\u9A8C\u8BC1\u7801",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",rules:[{pattern:n,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u9A8C\u8BC1\u7801"}]},{button:k(()=>[m("div",{class:Q(["sms-code",{"count-down":a.value>0}]),onClick:I},K(p.value),3)]),_:1},8,["modelValue","rules"])]),_:1}),m("div",{class:"submit",onClick:V}),m("div",pe,[g(w,{modelValue:r(t).agree,"onUpdate:modelValue":o[2]||(o[2]=v=>r(t).agree=v),name:"agree",shape:"square"},null,8,["modelValue"]),m("div",null,[_e,(_(!0),P(S,null,q(((T=u.info)==null?void 0:T.attachmentList)||[],(v,M)=>(_(),D(j,{key:M,class:"file-name",title:`\u300A${v.attachmentName}\u300B`,content:v.attachmentUrl,type:"pdf"},null,8,["title","content"]))),128))])])]}),_:1},512)}}}),ge={class:"agree"},Fe=R(" \u6211\u5DF2\u9605\u8BFB\u5E76\u540C\u610F "),be=L({props:{info:{type:Object,default:()=>{}}},emits:["on-submit"],setup(i,{emit:s}){const u=i,c=C({}),F=/\W/,a=O({name:u.info.userInfo.name,certNo:u.info.userInfo.certNo,agree:""}),p=n=>se(a.certNo)?!0:"\u8BF7\u586B\u5199\u6B63\u786E\u7684\u8BC1\u4EF6\u53F7",b=()=>{c==null||c.value.validate().then(async n=>{if(!a.agree){x("\u8BF7\u52FE\u9009\u534F\u8BAE");return}s("on-submit",a)})};return(n,t)=>{const h=f("van-field"),I=f("van-cell-group"),B=f("van-checkbox"),V=f("ProPDFviewer"),y=f("VanForm");return _(),D(y,{ref_key:"formRef",ref:c},{default:k(()=>{var l;return[g(I,null,{default:k(()=>[g(h,{modelValue:r(a).name,"onUpdate:modelValue":t[0]||(t[0]=e=>r(a).name=e),name:"name",label:"\u59D3\u540D",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D",rules:[{pattern:F,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u59D3\u540D"}]},null,8,["modelValue","rules"]),g(h,{modelValue:r(a).certNo,"onUpdate:modelValue":t[1]||(t[1]=e=>r(a).certNo=e),name:"certNo",label:"\u8EAB\u4EFD\u8BC1",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u8EAB\u4EFD\u8BC1\u53F7",rules:[{validator:p}]},null,8,["modelValue","rules"])]),_:1}),m("div",{class:"submit",onClick:b}),m("div",ge,[g(B,{modelValue:r(a).agree,"onUpdate:modelValue":t[2]||(t[2]=e=>r(a).agree=e),name:"agree",shape:"square"},null,8,["modelValue"]),m("div",null,[Fe,(_(!0),P(S,null,q(((l=u.info)==null?void 0:l.attachmentList)||[],(e,o)=>(_(),D(V,{key:o,class:"file-name",title:`\u300A${e.attachmentName}\u300B`,content:e.attachmentUrl,type:"pdf"},null,8,["title","content"]))),128))])])]}),_:1},512)}}});var he="/static/assets/title-step1.97cb9efa.png",Ce="/static/assets/title-step2.258af5e9.png";const Be={class:"page-activity-invite"},ye=["src"],De=["src"],Ie={class:"container"},Ve={class:"main-form"},Ee={class:"title"},Ne=["src"],qe=L({setup(i){const s=Z(),u=ee(),{productCode:c="7X9",tenantId:F="",extInfo:a}=s.query,p=ie(a),b=C(!0),n=O({title:he,attachmentList:[{}],userInfo:{mobile:p.phoneNo,certNo:"",name:""}}),t=C(),h=C(),I=async l=>{var A,w;n.userInfo.mobile=l.mobile;const e=await ue({holderPhone:n.userInfo.mobile,productCode:c,tenantId:F}),{code:o,data:d}=e;o==="10000"&&(n.userInfo.name=(A=d.tenantOrderHolder)==null?void 0:A.name,n.userInfo.certNo=(w=d.tenantOrderHolder)==null?void 0:w.certNo),n.title=Ce,b.value=!1},B=async l=>{try{x({message:"\u9886\u53D6\u4E2D...",forbidClick:!0,loadingType:"spinner"}),n.userInfo.certNo=l.certNo,n.userInfo.name=l.name;const e=de(N(E({tenantId:F,detail:t.value},p),{holder:n.userInfo,insured:N(E({},n.userInfo),{relationToHolder:oe.SELF})})),o=await le(e),{code:d}=o;d==="10000"&&u.push({path:"/chuangxin/baigebao/productDetail",query:N(E({},s.query),{tenantId:F,productCode:"BWYL2021",extInfo:JSON.stringify(N(E({},p),{phoneNo:n.userInfo.mobile,certNo:n.userInfo.certNo,name:n.userInfo.name}))})}),x.clear()}catch(e){console.log(e),x.clear()}},V=()=>{let l=[];return h.value.productRiskVoList.forEach(e=>{e.riskDetailVOList.forEach(o=>{l=l.concat(o.riskAttachmentVOList)})}),l},y=async()=>{const l=ce({productCode:c,withInsureInfo:!0}),e=re({productCode:c});Promise.all([l,e]).then(([o,d])=>{o.code==="10000"&&(t.value=o.data),d.code==="10000"&&(h.value=d.data,n.attachmentList=V())})};return te(()=>{y()}),(l,e)=>(_(),P("div",Be,[m("img",{class:"logo",src:r(me)},null,8,ye),m("img",{src:r(fe)},null,8,De),m("div",Ie,[m("div",Ve,[m("div",Ee,[m("img",{src:r(n).title},null,8,Ne)]),b.value?(_(),D(ve,{key:0,info:r(n),onOnVerify:I},null,8,["info"])):(_(),D(be,{key:1,info:r(n),onOnSubmit:B},null,8,["info"]))])])]))}});export{qe as default};
