import{_ as e,d as t,a,r as n,a0 as r,x as o,aa as l,y as i,b as d,c as u,e as s,w as c,f as v,j as p,t as m,g as f,X as I,k as O,a6 as L,K as D,L as C,a4 as V,T as y}from"./index-3898adba.js";import{d as Y}from"./debounce-2dbbea42.js";import{r as x,t as h}from"./utils-e8cb0724.js";import{p as j}from"./product-511cfeb4.js";import{i as b,b as w,p as T}from"./trial-90934487.js";import R from"./index-0e7c179e.js";import{u as P}from"./theme-65292714.js";import{n as k}from"./nextStep-bea0bd37.js";import g from"./index-0743af83.js";import{n as N,o as M}from"./infoCollection-f73cacca.js";import"./pdfh5-008ca364.js";import"./isObjectLike-d00d103b.js";import"./useStorage-e5ca6bac.js";import"./trial-0423da29.js";import"./relativeTime-fde2a46e.js";import"./validator-5a13dc82.js";import"./useDicData-e6df81e6.js";import"./core-eb5ed187.js";const E=e=>(D("data-v-f9a99178"),e=e(),C(),e),H={class:"net-sale-wrap"},B={class:"part product-name"},_=E((()=>p("span",null,null,-1))),S=E((()=>p("span",null,null,-1))),U={class:"part"},$={class:"footer"};var F=e(t({__name:"index",setup(e){const t=P(),D=a(),{productCode:C="HTEJBX",tenantId:E="9991000001",agentCode:F="",agencyCode:A,saleChannelId:z,extraInfo:q,preview:J}=D.query,W=n(),X=n("0"),G=n(),K=n(),Q=n(),Z=n([{}]),ee=n([]),te=n({}),ae=n(""),ne=n({min:new Date(r().add(1,"day").format("YYYY-MM-DD")),max:new Date,currentDate:""});let re={};try{re=JSON.parse(decodeURIComponent(q))}catch(me){}const oe=n({agencyId:A,agentCode:F,commencementTime:"",expiryDate:"",extInfo:{buttonCode:"EVENT_NETSALE_underWrite",pageCode:"infoCollection",templateId:re.templateId,iseeBizNo:ae.value,extraInfo:re},orderCategory:1,saleUserId:F,saleChannelId:z,tenantId:E,venderCode:"",tenantOrderHolder:{extInfo:{occupationCodeList:[]}},tenantOrderInsuredList:[{relationToHolder:"1",extInfo:{occupationCodeList:[]},tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{}}],tenantOrderProductList:[{}]}],tenantOrderSubjectList:[{extInfo:{subjectRelatedFirm:"xinao",subjectRelatedUserId:""},subjectName:"",subjectObjectType:"HOLDER",subjectType:"GENERAL",subjectNo:"",tenantId:E}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}}),le=o((()=>{var e,t;return((null==(t=null==(e=G.value)?void 0:e.productRelationPlanVOList)?void 0:t.length)||0)>1})),ie=n();l([()=>Q.value,()=>K.value,()=>X.value],(()=>{var e,t;const{premium:a}=Q.value||{};if(a)ie.value=a&&`￥${a}元`;else{const{tenantProductInsureVO:a}=K.value||{};let n={};n=(null==(e=null==a?void 0:a.planList)?void 0:e.length)?((null==a?void 0:a.planList)||[]).find((e=>e.planCode===X.value)):null==a?void 0:a.planInsureVO;const{paymentFrequencyValue:r,premiumUnit:o}=(null==(t=null==n?void 0:n.productPremiumVOList)?void 0:t[0])||{};ie.value=r&&`￥${r}${o||"元"}`}}),{deep:!0,immediate:!0});const de=o((()=>{var e,t,a,n,o,l,i;let d=[];d=(null==(t=null==(e=G.value)?void 0:e.productRelationPlanVOList)?void 0:t.length)?(null==(n=null==(a=G.value)?void 0:a.productRelationPlanVOList.find((e=>e.planCode===X.value)))?void 0:n.productRiskVoList)||[]:(null==(o=G.value)?void 0:o.productRiskVoList)||[];const{insuranceStartType:u,riskInsureLimitVO:s}=(null==(i=null==(l=null==d?void 0:d[0])?void 0:l.riskDetailVOList)?void 0:i[0])||{},{maxInsuranceDay:c}=s||{};if(u===+N.CUSTOM_DAY){const[e,t]=(c||"").split(",");e&&t&&t!==e?(ne.value.min=new Date(r(new Date).add(+e||0,"day").format("YYYY-MM-DD")),ne.value.max=new Date(r(new Date).add(+t||0,"day").format("YYYY-MM-DD"))):e&&t&&t===e?ne.value.currentDate=r(new Date).add(t,"day").format("YYYY-MM-DD HH:mm:ss"):t||(ne.value.max=new Date(r(new Date).add(+t||0,"day").format("YYYY-MM-DD")))}return d})),ue=o((()=>{var e,t,a;const{insuranceStartType:n,riskInsureLimitVO:r}=(null==(a=null==(t=null==(e=de.value)?void 0:e[0])?void 0:t.riskDetailVOList)?void 0:a[0])||{},{maxInsuranceDay:o}=r||{};if(n!==+N.CUSTOM_DAY)return!0;const[l,i]=(o||"").split(",");return l===i})),se=o((()=>{var e,t,a;const n=de.value||[],o=(null==(a=null==(t=null==(e=null==n?void 0:n[0])?void 0:e.riskDetailVOList)?void 0:t[0])?void 0:a.insuranceStartType)||1;return ne.value.currentDate?`${r(ne.value.currentDate).format("YYYY-MM-DD")} 00:00:00`:o===+N.CURRENT_DAY?`${r(new Date).format("YYYY-MM-DD HH:mm:ss")}`:`${r(new Date).add(1,"day").format("YYYY-MM-DD")} 00:00:00`})),ce=o((()=>{var e,t;const a=de.value||[],{insuranceEndType:n,riskInsureLimitVO:o}=(null==(t=null==(e=null==a?void 0:a[0])?void 0:e.riskDetailVOList)?void 0:t[0])||{},{insurancePeriodValueList:l}=o||{},[i,d]=((null==l?void 0:l[0])||"").split("_");return n===+M.CURRENT_DAY?`${r(se.value).add(d||0,i).subtract(1,"day").format("YYYY-MM-DD")} 23:59:59`:n?`${r(se.value).add(d,i).format("YYYY-MM-DD")} 00:00:00`:""})),ve=async()=>{var e,t,a;oe.value.venderCode=null==(e=G.value)?void 0:e.productBasicInfoVO.insurerCode,oe.value.orderAmount=null==(t=Q.value)?void 0:t.premium,oe.value.orderRealAmount=null==(a=Q.value)?void 0:a.premium,oe.value.commencementTime=se.value,oe.value.expiryDate=ce.value,oe.value.extInfo&&(oe.value.extInfo.iseeBizNo=ae.value),oe.value.tenantOrderInsuredList&&(oe.value.tenantOrderInsuredList[0].planCode=X.value),k(((e,t,a)=>{var n,r;const o={},l=(e=[])=>{(e||[]).forEach((e=>{var t;o[e.riskCode]=e,(null==(t=e.riskPremiumDetailVOList)?void 0:t.length)&&l(e.riskPremiumDetailVOList)}))};l(null==t?void 0:t.riskPremiumDetailVOList);const i={...a},d={tenantId:E,riskList:(null==(n=ee.value)?void 0:n[0].riskVOList)||[],riskPremium:o,productId:(null==e?void 0:e.productBasicInfoVO.id)||0};return i.tenantOrderHolder&&(i.tenantOrderHolder.certType=i.tenantOrderHolder.certType||V.CERT,i.tenantOrderHolder.certNo=(i.tenantOrderHolder.certNo||"").toLocaleUpperCase()),i.tenantOrderInsuredList&&(i.tenantOrderInsuredList[0].certType=i.tenantOrderInsuredList[0].certType||V.CERT,i.tenantOrderInsuredList[0].certNo=(i.tenantOrderInsuredList[0].certNo||"").toLocaleUpperCase(),i.tenantOrderInsuredList[0].tenantOrderProductList=[{premium:null==(r=Q.value)?void 0:r.premium,productCode:null==e?void 0:e.productBasicInfoVO.productCode,productName:null==e?void 0:e.productBasicInfoVO.productName,tenantOrderRiskList:h(d)}]),i})(G.value,Q.value,oe.value),((e,t)=>{"jumpToPage"===t&&y("提交成功")}))},pe=async()=>{var e;null==(e=W.value)||e.validateForm().then((()=>{var e,t;L.confirm({title:"分享",message:`即将向客户【${null==(t=null==(e=oe.value)?void 0:e.tenantOrderHolder)?void 0:t.name}】发送投保确认信息,请确认是否继续？`}).then((()=>{J||ve()}))}))};l([()=>{var e;return null==(e=oe.value.tenantOrderInsuredList)?void 0:e[0].name},()=>{var e;return null==(e=oe.value.tenantOrderInsuredList)?void 0:e[0].birthday},()=>X.value],Y((([e,t])=>{e&&t&&(J||(async(e,t,a)=>{var n,r,o,l,i,d;const u={holder:{personVO:{certType:V.CERT,...e.tenantOrderHolder,socialFlag:`${(null==(r=null==(n=e.tenantOrderHolder)?void 0:n.extInfo)?void 0:r.hasSocialInsurance)||""}`,occupationCodeList:null==(l=null==(o=e.tenantOrderHolder)?void 0:o.extInfo)?void 0:l.occupationCodeList}},insuredVOList:((null==e?void 0:e.tenantOrderInsuredList)||[]).map((e=>{var n,r;return{insuredCode:"",personVO:{...e,certType:V.CERT,socialFlag:`${(null==(n=null==e?void 0:e.extInfo)?void 0:n.hasSocialInsurance)||""}`,occupationCodeList:null==(r=null==e?void 0:e.extInfo)?void 0:r.occupationCodeList},productPlanVOList:[{insurerCode:null==t?void 0:t.productBasicInfoVO.insurerCode,planCode:X.value||"",riskVOList:x(a)}]}})),productCode:null==t?void 0:t.productBasicInfoVO.productCode,productId:null==t?void 0:t.productBasicInfoVO.id,tenantId:E},{code:s}=await w(u);if("10000"===s){const{code:e,data:t}=await T(u);"10000"===e?(Q.value=t,ee.value=(null==(d=null==(i=null==u?void 0:u.insuredVOList)?void 0:i[0])?void 0:d.productPlanVOList)||[]):Q.value=void 0}})(oe.value,G.value,de.value))}),500));return l((()=>X.value),(()=>{Z.value&&(te.value=Z.value[X.value])})),i((()=>{(async()=>{await j({productCode:C,withInsureInfo:!0,tenantId:E}).then((({code:e,data:t})=>{var a;"10000"===e&&(K.value=t,document.title=(null==(a=t.tenantProductInsureVO)?void 0:a.productName)||"")})),b({productCode:C}).then((({code:e,data:t})=>{var a;"10000"===e&&(G.value=t,Z.value=t.planFactor,(null==(a=t.productRelationPlanVOList)?void 0:a.length)&&(X.value=t.productRelationPlanVOList[0].planCode||""),t.productFactor?te.value=t.productFactor:t.planFactor&&(te.value=t.planFactor[X.value]))}))})(),setTimeout((async()=>{ae.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,a)=>{const n=d("ProRadioButton"),r=d("ProCard"),o=d("ProCell"),l=d("ProDatePicker"),i=d("ProPageWrap"),L=d("van-config-provider");return u(),s(L,{"theme-vars":f(t)},{default:c((()=>[v(i,null,{default:c((()=>{var e,t;return[p("div",H,[p("div",B,m(null==(t=null==(e=f(G))?void 0:e.productBasicInfoVO)?void 0:t.productFullName),1),f(le)?(u(),s(r,{key:0,"show-line":!1,title:"保障年期"},{default:c((()=>{var e;return[v(n,{modelValue:f(X),"onUpdate:modelValue":a[0]||(a[0]=e=>I(X)?X.value=e:null),class:"radio-group",prop:{label:"planName",value:"planCode"},options:null==(e=f(G))?void 0:e.productRelationPlanVOList},null,8,["modelValue","options"])]})),_:1})):O("",!0),v(R,{ref_key:"formRef",ref:W,"title-collection":{HOLDER:"投保人",INSURER:"被保人",BENEFICIARY:"收益人"},"form-info":f(oe),"send-sms-code":()=>{},"input-align":"left","factor-object":f(te)},{holderName:c((()=>[_])),insurerName:c((()=>[S])),_:1},8,["form-info","send-sms-code","factor-object"]),p("div",U,[v(o,{title:"保费",content:f(ie)},null,8,["content"]),f(ue)?(u(),s(o,{key:0,title:"保障期间",content:`${f(se).split(" ")[0]}~${f(ce).split(" ")[0]}`},null,8,["content"])):(u(),s(l,{key:1,modelValue:f(ne).currentDate,"onUpdate:modelValue":a[1]||(a[1]=e=>f(ne).currentDate=e),label:"生效日期",name:"currentDate",type:"date",min:f(ne).min,max:f(ne).max,required:!0},null,8,["modelValue","min","max"]))]),p("div",$,[v(g,{shadow:!1,text:"分享用户确认投保",onClick:pe})])])]})),_:1})])),_:1},8,["theme-vars"])}}}),[["__scopeId","data-v-f9a99178"]]);export{F as default};
