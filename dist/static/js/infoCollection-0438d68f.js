import{q as e,u as t,Y as a,j as n,T as o,b as u,p as r,v as i}from"./index-deb4ddfb.js";import{defineAsyncComponent as l,reactive as s,ref as d,computed as c,onBeforeMount as f}from"vue";/* empty css              */import{_ as p,t as m}from"./PayInfo-e8550347.js";import{g as v,i as V}from"./trial-90e504aa.js";import{_ as h}from"./TrialButton-46a442f7.js";import{n as I}from"./nextStep-0d38f4c6.js";import{u as C}from"./useAttachment-3dae9e30.js";import{a as y,q as j}from"./product-c166a0f6.js";import{g as O}from"./utils-f063477c.js";import{u as g}from"./useOrder-d6d1fc9b.js";import{P as b,B as L}from"./constants-7afb7c3d.js";import{t as P}from"./utils-8df944cf.js";import{T as N}from"./index-83ab55b1.js";import"./pdfh5-e588f83d.js";import"./merge-e7788e50.js";import"./keysIn-131bbce9.js";import"./isObjectLike-a9798079.js";import"./_getTag-d5b47d26.js";import"./debounce-6981b306.js";import"./phoneVerify-8d7afc24.js";import"./useDicData-48f91541.js";import"./bankCard-1cedc592.js";import"./index-593ee4c8.js";import"./core-5f3b09dd.js";import"./constant-8927d485.js";import"./infoCollection-f930e52f.js";import"./trial-a75330fd.js";import"./createProposal-a7e18ac8.js";import"./cloneDeep-6abacc69.js";import"./index-9ba6d482.js";import"./index-11981141.js";import"./box-title-70dc1627.js";import"./index-97a63e34.js";import"./echarts-6ee22673.js";import"./empty-ae586b6c.js";const x={class:"long-info-collection"},_=Vue.defineComponent({__name:"infoCollection",setup(_){const w=l((()=>e((()=>import("./index-52712cf2.js")),["static/js/index-52712cf2.js","static/css/index-fa4edf2a.css","static/js/index-deb4ddfb.js","static/css/index-5064de6f.css","static/js/pdfh5-e588f83d.js","static/js/theme-65292714.js","static/js/index-593ee4c8.js","static/css/index-827a8544.css","static/js/utils-f063477c.js","static/js/infoCollection-f930e52f.js","static/js/trial-a75330fd.js"]))),k=l((()=>e((()=>import("./index-3ccd2494.js")),["static/js/index-3ccd2494.js","static/css/index-4640d9aa.css"]))),T=t(),B=g(),{productCode:S="",tenantId:F,agentCode:D="",agencyCode:E,saleChannelId:U,isShare:q,orderNo:R,extraInfo:A,insurerCode:M,preview:H}=T.query;let J={};try{J=JSON.parse(decodeURIComponent(A))}catch(je){}const G=s({isView:!1,personalInfo:{},payInfo:{schema:[],config:[],formData:[]},defaultValue:null,isAutoChange:!1,defaultPlanCode:"",userData:{}}),Y=`${window.origin}/baseInsurance/long/phoneVerify${window.location.search}`,$=d({imgUrl:"",desc:"",title:"",link:Y}),z=d();d();const Q=d(),W=d({}),X=d({}),K=d([]),Z=d(),ee=d({}),te=d(!1),ae=d(!1),ne=d(0),oe=d(!0),{fileList:ue,mustReadFileCount:re,popupFileList:ie}=C(ee,Z),le=d(!1),se=d(!1),de=()=>{ae.value=!1,oe.value=!0,K.value.length<1||(te.value=!0)},ce=()=>{te.value=!1,ae.value=!1,oe.value=!0};d({}),d(!1),d([{}]);const fe=d(""),pe=d(0),me=d(!1);d(),d(),d(),c((()=>{var e,t;const{insureProductRiskVOList:n}=(null==(t=null==(e=X.value)?void 0:e.productPlanInsureVOList)?void 0:t[0])||{};return(n||[]).find((e=>e.mainRiskFlag===a.YES))}));const ve=d(0);d({});const Ve=d(),he=()=>{fe.value="试算中...",pe.value=0,me.value=!0},Ie=(e,t)=>{fe.value="",ve.value=e.premium,pe.value=e,Ve.value=t,me.value=!1},Ce=async()=>{var e,t;if(H)return void n(b.INFO_COLLECTION,T.query);if(!pe.value)return;const a=[];Q.value&&a.push(null==(e=Q.value)?void 0:e.validate(!1)),z.value&&a.push(null==(t=z.value)?void 0:t.validate(!1)),Promise.all(a).then((()=>{if(!le.value)return void o("请勾选投保人阅读并接受");Object.assign(B.value,{extInfo:{...B.value.extInfo,buttonCode:L.INFO_COLLECTION,pageCode:b.INFO_COLLECTION}});const e=Q.value.dealMixData(),t=P({...e,productCode:S,productName:X.value.productName},pe.value,B.value);I(t,((e,t)=>{t===u.JUMP_PAGE&&r(e.nextPageCode,T.query)}))}))};s({tenantOrderPayInfoList:[]});const ye=async()=>{y({productCode:S,tenantId:F}).then((({data:e,code:t})=>{if("10000"===t){W.value=e;const{wxShareConfig:t,showWXShare:a,title:n,desc:o,image:u}=(null==e?void 0:e.PRODUCT_LIST)||{};a?Object.assign($.value,{...t,imgUrl:t.image,isShare:a}):Object.assign($.value,{title:n,desc:o,imgUrl:u,isShare:a}),e.BASIC_INFO&&e.BASIC_INFO.themeType&&i(e.BASIC_INFO.themeType)}})),R&&await v({orderNo:R,tenantId:F}).then((({code:e,data:t})=>{var a;if("10000"===e){if(pe.value=t.orderAmount,(null==(a=t.insuredList)?void 0:a.length)>0){const{planCode:e}=t.insuredList[0];G.defaultPlanCode=e}Object.assign(B.value,t,{tenantOrderPayInfoList:t.tenantOrderPayInfoList||[],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0,withPayInfo:!0},productCode:S}),G.defaultValue=B.value,se.value=!0}})),j({productCode:S}).then((({code:e,data:t})=>{var a,n,o,u;if("10000"===e){const{productMaterialPlanVOList:e,productQuestionnaireVOList:r}=t;Z.value=e||[];const{basicInfo:{questionnaireType:i},questions:l,questionnaireName:s}=(null==(a=null==r?void 0:r[0])?void 0:a.questionnaireDetailResponseVO)||{basicInfo:{}};i&&(K.value=2===i?[{attachmentName:s,attachmentUri:l,attachmentType:"question"}]:[{attachmentName:s,attachmentUri:null==(n=null==l?void 0:l[0])?void 0:n.content,attachmentType:O(String(null==(o=null==l?void 0:l[0])?void 0:o.textType),null==(u=null==l?void 0:l[0])?void 0:u.content)}])}})),await V({productCode:S,isTenant:!H}).then((({data:e,code:t})=>{var a;if("10000"===t){X.value=e,console.log("state.defaultPlanCode",G.defaultPlanCode),ee.value=e.productPlanInsureVOList.find((e=>e.planCode===G.defaultPlanCode))||{};const{payInfo:t}=m(null==(a=ee.value)?void 0:a.productFactor);G.payInfo={...G.payInfo,...t}}}))};return f((()=>{ye()})),(e,t)=>{var a,n,r,i,l,s;const d=Vue.resolveComponent("ProNavigator"),c=Vue.resolveComponent("ProLazyComponent");return Vue.openBlock(),Vue.createElementBlock("div",x,[Vue.createVNode(d),Vue.unref(se)||Vue.unref(H)?(Vue.openBlock(),Vue.createBlock(N,{key:0,ref_key:"personalInfoRef",ref:Q,"data-source":Vue.unref(ee),"product-info":{productCode:Vue.unref(S),productName:Vue.unref(X).productName,insurerCode:Vue.unref(M),tenantId:Vue.unref(F),planList:Vue.unref(X).productPlanInsureVOList},"tenant-product-detail":Vue.unref(W),"hide-benefit":"","default-data":[Vue.unref(G).defaultValue],onTrialStart:he,onTrialEnd:Ie,"onUpdate:userData":t[0]||(t[0]=e=>Vue.unref(G).userData=e)},null,8,["data-source","product-info","tenant-product-detail","default-data"])):Vue.createCommentVNode("",!0),Vue.unref(G).payInfo.schema.length?(Vue.openBlock(),Vue.createBlock(Vue.unref(p),{key:1,ref_key:"payInfoRef",ref:z,modelValue:Vue.unref(B).tenantOrderPayInfoList,"onUpdate:modelValue":t[1]||(t[1]=e=>Vue.unref(B).tenantOrderPayInfoList=e),schema:Vue.unref(G).payInfo.schema,"is-view":Vue.unref(G).isView,"user-data":Vue.unref(G).userData},null,8,["modelValue","schema","is-view","user-data"])):Vue.createCommentVNode("",!0),Vue.createVNode(c,null,{default:Vue.withCtx((()=>{var e;return[(null==(e=Vue.unref(ue))?void 0:e.length)?(Vue.openBlock(),Vue.createBlock(Vue.unref(k),{key:0,modelValue:Vue.unref(le),"onUpdate:modelValue":t[2]||(t[2]=e=>Vue.isRef(le)?le.value=e:null),"attachment-list":Vue.unref(ue),"is-show-radio":"","pre-text":"投保人阅读并接受",onPreviewFile:t[3]||(t[3]=e=>(e=>{ne.value=e,ae.value=!0})(e))},null,8,["modelValue","attachment-list"])):Vue.createCommentVNode("",!0)]})),_:1}),Vue.unref(ae)?(Vue.openBlock(),Vue.createBlock(Vue.unref(w),{key:2,show:Vue.unref(ae),"onUpdate:show":t[4]||(t[4]=e=>Vue.isRef(ae)?ae.value=e:null),"content-list":Vue.unref(oe)?Vue.unref(ue):Vue.unref(ie),"is-only-view":Vue.unref(oe),"active-index":Vue.unref(ne),text:Vue.unref(oe)?"关闭":"我已逐页阅读并确认告知内容","force-read-count":Vue.unref(oe)?0:Vue.unref(re),onSubmit:de,onOnCloseFilePreviewByMask:ce},null,8,["show","content-list","is-only-view","active-index","text","force-read-count"])):Vue.createCommentVNode("",!0),Vue.createVNode(h,{"is-share":Vue.unref($).isShare&&!Vue.unref(q),premium:null==(a=Vue.unref(pe))?void 0:a.initialPremium,"share-info":Vue.unref($),"loading-text":Vue.unref(fe),"payment-frequency":(null==(s=null==(l=null==(i=null==(r=null==(n=Vue.unref(Ve))?void 0:n.insuredList)?void 0:r[0].productList)?void 0:i[0].riskList)?void 0:l[0])?void 0:s.paymentFrequency)+"","tenant-product-detail":Vue.unref(W),"handle-share":e=>(e=>{Q.value.validateHolder(["mobile"]).then((()=>{Object.assign(B.value,{extInfo:{...B.value.extInfo,buttonCode:L.INFO_COLLECTION,pageCode:b.INFO_COLLECTION}});const t=Q.value.getUserData(),a=P({...Ve.value,holder:null==t?void 0:t.holder},pe.value||{},B.value);I(a,((t,a)=>{a===u.JUMP_PAGE&&(null==e||e())}))})).catch((()=>{o("请录入投保人手机号后进行分享")}))})(e),disabled:!Vue.unref(pe),onHandleClick:Ce},{default:Vue.withCtx((()=>[Vue.createTextVNode("下一步")])),_:1},8,["is-share","premium","share-info","loading-text","payment-frequency","tenant-product-detail","handle-share","disabled"])])}}});export{_ as default};
