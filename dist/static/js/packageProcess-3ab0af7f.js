var Xe=Object.defineProperty,Qe=Object.defineProperties;var Ze=Object.getOwnPropertyDescriptors;var de=Object.getOwnPropertySymbols;var ea=Object.prototype.hasOwnProperty,aa=Object.prototype.propertyIsEnumerable;var me=(N,f,y)=>f in N?Xe(N,f,{enumerable:!0,configurable:!0,writable:!0,value:y}):N[f]=y,m=(N,f)=>{for(var y in f||(f={}))ea.call(f,y)&&me(N,y,f[y]);if(de)for(var y of de(f))aa.call(f,y)&&me(N,y,f[y]);return N},p=(N,f)=>Qe(N,Ze(f));import{g as ta,a9 as oa,O as ra,E as g,M as pe,y as Z,T as P,_ as ua,l as na,h as sa,r as fe,af as la,j as q,n as he,p as _,m as ee,H as ia,t as ae,z as U,A as D,J as $,C as be,k as ve,F as ca,D as da,X as ma}from"./vendor-505c98f2.js";import{_ as pa,C as Fe,I as De,a0 as fa,H as ha,a2 as ye}from"./index-ccab46db.js";import{a as T}from"./order-26db6dbf.js";import{S as k,R as H,f as Ee,I as va}from"./infoCollection-192ba138.js";import{p as ge,i as Fa,s as Da,g as ya,a as Ea,u as ga,b as Ca}from"./trial-3db49d37.js";import{p as Ia}from"./product-2c6affbc.js";import{g as te,a as Ce,o as Ie,t as Na,b as _a,h as Ne}from"./utils-aaab73d4.js";import{t as Aa}from"./theme-ea709837.js";import{d as _e,B as wa,D as Ba,G as Ta,S as ba,H as Pa,P as ka,U as Sa,_ as Oa,W as Ua,c as K,f as Ae,o as we,a as W,n as Be,h as Te}from"./auth-5d8912f9.js";import{_ as Ha}from"./index-28b0971c.js";import"./utils-b6782348.js";import"./trial-df167647.js";import"./index-4b5cfbbb.js";import"./bankCard-0e4ce564.js";import"./phoneVerify-6cb5283d.js";const La={key:0},Ra={class:"page-internet-product-detail"},xa={class:"info"},Ma={class:"footer-button"},Va={class:"price"},Ya=be(" \u603B\u4FDD\u8D39"),qa=ta({setup(N){const f=oa(),y=ra(),{productCode:L="BWYL2021",tenantId:C,orderNo:S,phoneNo:R,agentCode:G="",saleChannelId:Pe,paymentMethod:E,certNo:oe,name:re,pageCode:x,from:ke}=y.query,j=g(),h=g(),M=g(),w=g(),O=x==="payBack",ue=g(!1),V=g(!1),b=g(!1),ne=g(0),z=g(!1),J=g(!1),Y=g({show:!1,html:""});let X="";const a=pe({holder:{certNo:oe,certType:Fe.CERT,mobile:R,name:re,socialFlag:k.HAS},insured:{certNo:oe,certType:Fe.CERT,name:re,socialFlag:k.HAS,relationToHolder:H.SELF},paymentMethod:E,renewalDK:"Y",paymentFrequency:Ee.YEAR,packageProductList:[],mobileSmsCode:""}),A=g(_e),I=g(_e),s=pe({showInsure:!O,canInsure:!1,canUpgrade:!1}),Se=Z(()=>{var t,o;return((o=(t=h.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:o.attachmentVOList.filter(e=>e.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),Oe=Z(()=>{var t,o;return((o=(t=h.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:o.attachmentVOList.filter(e=>e.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),Q=Z(()=>{if(a.holder.certNo){const t=te(a.holder.certNo,"year"),o=De(a.holder.certNo);if(t<18)return P("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E18\u5C81\uFF01"),!1;if(a.insured.certNo&&a.insured.relationToHolder===H.MATE){const e=De(a.insured.certNo);if(o===e)return P("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(a.insured.certNo){const t=te(a.holder.certNo,"day"),o=te(a.holder.certNo,"year");if(a.insured.relationToHolder===H.CHILD&&t<30)return P("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(a.insured.relationToHolder===H.PARENT&&o>=61)return P("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E60\u5C81\uFF01"),!1}return!0}),Ue=()=>{const{holder:{certNo:t,mobile:o,name:e,socialFlag:n},insured:{certNo:r,name:u,socialFlag:l,relationToHolder:c},paymentMethod:v}=a;return!!(ha(r)&&!!l)},se=()=>{f.push({path:"/internet/guaranteeUpgrade",query:p(m({},y.query),{tenantId:C,productCode:"BWYL2022",orderNo:S,agentCode:G})})},He=()=>{J.value=!1},Le=()=>{I.value=A.value},Re=()=>{I.value=p(m({},I.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},xe=async t=>{P.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const o=await ga(t),{code:e}=o;if(e==="10000"){P.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const n=await Ca({orderNo:t.orderNo,tenantId:C}),{data:r}=n;n.code==="10000"&&(r.type===2?(Y.value={show:!0,html:r.paymentUrl},console.log("data.paymentUrl",Y.value),ma(()=>{console.log("document.forms",document.forms);const u=document.getElementById("cashierSubmit");u==null||u.addEventListener("submit",l=>{l.preventDefault()}),u==null||u.submit()})):window.location.href=r.paymentUrl)}s.canInsure=!0}catch{s.canInsure=!0}},Me=t=>`${ye}/internet/orderDetail?orderNo=${t}&productCode=${L}&tenantId=${C}`,Ve=t=>`${ye}/internet/payFail?tenantId=${C}&orderNo=${t}&agentCode=${G}&pageCode=payBack&from=${ke||"normal"}`,Ye=async t=>{console.log("risk",t);const o=_a({tenantId:C,saleUserId:G,saleChannelId:Pe,detail:h.value,insureDetail:M.value,paymentMethod:a.paymentMethod,renewalDK:a.renewalDK,iseeBizNo:X,successJumpUrl:"",premium:w.value,holder:a.holder,insured:a.insured,tenantOrderRiskList:t,orderStatus:"",orderTopStatus:""});try{const e=await Da(o),{code:n,data:r}=e;n==="10000"&&xe(p(m({},o),{orderNo:r.data,extInfo:{extraInfo:{renewalDK:a.renewalDK,paymentMethod:a.paymentMethod,successJumpUrl:Me(r.data),failUrl:Ve(r.data)},iseeBizNo:X}}))}catch{s.canInsure=!0}},qe=async()=>{if(!Q.value)return{};const{calcData:t,riskVOList:o}=Ce({holder:a.holder,insured:a.insured,tenantId:C,productDetail:h.value,insureDetail:M.value,paymentFrequency:a.paymentFrequency,packageRiskIdList:Ie(a.packageProductList)},!1,Ne),e=await ge(t),{code:n,data:r}=e;return n==="10000"?(w.value=r.premium,{condition:o,data:r}):{}},$e=t=>{ne.value=t,b.value=!0},Ke=()=>new Promise((t,o)=>{var e,n;(n=(e=j.value)==null?void 0:e.validateForm)==null||n.call(e).then(async()=>{var d;if(console.log("checkCustomerResult.value",Q.value),!Q.value)return;if(!(((d=j.value)==null?void 0:d.isAgreeFile)||ue.value)){b.value=!0,$e(0);return}const{calcData:u,riskVOList:l}=Ce({holder:a.holder,insured:a.insured,tenantId:C,productDetail:h.value,insureDetail:M.value,paymentFrequency:a.paymentFrequency,packageRiskIdList:Ie(a.packageProductList)},!1,Ne),c=await ge(u),{code:v,data:F}=c;v==="10000"?(w.value=F.premium,t({condition:l,data:F})):o(new Error)}).catch(()=>{s.canInsure=!0})}),le=async()=>{var t;if(O){se();return}s.canInsure=!1;try{const{condition:o,data:e}=await Ke(),n={},r=(l=[])=>{(l||[]).forEach(c=>{var v;n[c.riskCode]=c,((v=c.riskPremiumDetailVOList)==null?void 0:v.length)&&r(c.riskPremiumDetailVOList)})};r(e.riskPremiumDetailVOList);const u=Na({tenantId:C,riskList:o,riskPremium:n,productId:(t=h.value)==null?void 0:t.id});Ye(u)}catch{s.canInsure=!0}},We=t=>{t==="allFalse"?(V.value=!1,le(),s.canInsure=!0):da.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"})},Ge=()=>{ue.value=!0,b.value=!1,V.value=!0};ua([()=>a.insured.certNo,()=>a.insured.socialFlag,()=>a.packageProductList,()=>a.paymentFrequency],na.exports.debounce(()=>{a.insured.certNo&&a.insured.socialFlag&&Ue()&&qe()},500),{deep:!0,immediate:!0});const ie=async()=>{var n,r,u,l,c,v,F,d;const t=await ya({orderNo:S,tenantId:C}),{code:o,data:e}=t;if(o==="10000"){const{tenantOrderHolder:i,tenantOrderInsuredList:B,extInfo:ce}=e;if(!O){Object.assign(a,{holder:{certNo:i.certNo,certType:i.certType,mobile:i.mobile,name:i.name,socialFlag:k.HAS},insured:{certNo:i.certNo,certType:i.certType,name:i.name,socialFlag:k.HAS,relationToHolder:H.SELF},paymentMethod:E,renewalDK:"Y"}),s.canInsure=!0,I.value=Be,A.value=Be;return}Object.assign(a,{holder:{certNo:i.certNo,certType:i.certType,mobile:i.mobile,name:i.name,socialFlag:k.HAS},insured:{certNo:B==null?void 0:B[0].certNo,certType:(n=B[0])==null?void 0:n.certType,name:(r=B[0])==null?void 0:r.name,socialFlag:(l=(u=B[0])==null?void 0:u.extInfo)==null?void 0:l.hasSocialInsurance,relationToHolder:(c=B[0])==null?void 0:c.relationToHolder},paymentMethod:ce.extraInfo.paymentMethod,renewalDK:ce.extraInfo.renewalDK||"N"}),w.value=(d=(F=(v=B[0])==null?void 0:v.tenantOrderProductList)==null?void 0:F[0])==null?void 0:d.premium,(e.orderStatus===T.ACCEPT_POLICY||e.orderStatus===T.PAYMENT_SUCCESS)&&(s.canUpgrade=!0,z.value=!1,J.value=!0),e.orderStatus===T.PAYING&&(z.value=!0,setTimeout(()=>{ie()},3*1e3))}},je=async()=>{var n,r,u,l,c,v;console.log("\u77ED\u4FE1\u8FDB\u5165\uFF0C\u5E26\u4E86orderNo, mobile");const t=await Ea({holderPhone:R,orderStatus:[T.PAYING.toUpperCase(),T.TIMEOUT.toUpperCase(),"ACCEPT_POLICY"],productCode:L,tenantId:C}),{code:o,data:e}=t;if(e.orderStatus===T.ACCEPT_POLICY&&(console.log("\u5DF2\u627F\u4FDD\uFF0C\u88AB\u4FDD\u4EBA\u4FE1\u606F\u4E0D\u80FD\u4FEE\u6539"),I.value=p(m({},Te),{paymentDisable:!!E}),A.value=p(m({},Te),{paymentDisable:!!E})),(e.orderStatus===T.PAYING||e.orderStatus===T.TIMEOUT)&&(console.log("\u652F\u4ED8\u4E2D\uFF0C\u8D85\u65F6\u53EF\u4EE5\u4FEE\u6539\u6295\u4FDD\u4EBA\u4FE1\u606F"),I.value=p(m({},W),{paymentDisable:!!E}),A.value=p(m({},W),{paymentDisable:!!E})),o==="10000"&&((n=e==null?void 0:e.tenantOrderHolder)==null?void 0:n.certNo)){s.canInsure=!0;const{tenantOrderHolder:F,tenantOrderInsuredList:d,extInfo:i}=e;Object.assign(a,{holder:{certNo:F.certNo,certType:F.certType,mobile:F.mobile,name:F.name,socialFlag:k.HAS},insured:{certNo:d==null?void 0:d[0].certNo,certType:(r=d[0])==null?void 0:r.certType,name:(u=d[0])==null?void 0:u.name,socialFlag:(c=(l=d[0])==null?void 0:l.extInfo)==null?void 0:c.hasSocialInsurance,relationToHolder:(v=d[0])==null?void 0:v.relationToHolder},paymentMethod:E||i.extraInfo.paymentMethod,renewalDK:i.extraInfo.renewalDK})}else I.value=p(m({},K),{paymentDisable:!!E}),A.value=p(m({},K),{paymentDisable:!!E}),s.canInsure=!0},ze=async()=>{const t=Ia({productCode:L,withInsureInfo:!0,tenantId:C}),o=Fa({productCode:L});await Promise.all([t,o]).then(([e,n])=>{var r,u;e.code==="10000"&&(h.value=e.data,document.title=((r=e.data)==null?void 0:r.productFullName)||""),n.code==="10000"&&(a.packageProductList=(((u=n.data)==null?void 0:u.packageProductVOList)||[]).map(l=>p(m({},l),{value:va.UN_INSURE,disabled:!1})),M.value=n.data)}),S?ie():R&&x==="productDetail"&&je()},Je=()=>{x==="free"?O?(I.value=p(m({},Ae),{paymentDisable:!!E}),A.value=p(m({},Ae),{paymentDisable:!!E}),s.canInsure=!0):(I.value=p(m({},K),{paymentDisable:!!E}),A.value=p(m({},K),{paymentDisable:!!E}),s.canInsure=!0):O?(I.value=we,A.value=we,console.log("\u652F\u4ED8\u5B8C\u6210\u8FDB\u5165")):R||S||(console.log("\u6295\u4FDD\u94FE\u63A5"),I.value=W,A.value=W,s.canInsure=!0)};return sa(()=>{Je(),ze(),setTimeout(async()=>{X=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(t,o)=>{const e=fe("van-button"),n=fe("van-config-provider"),r=la("dompurify-html");return q(),he(ca,null,[_(n,{"theme-vars":D(Aa)},{default:ee(()=>{var u,l,c,v,F,d,i;return[Y.value.show?ia((q(),he("div",La,null,512)),[[r,Y.value.html]]):ae("",!0),U("div",Ra,[U("div",xa,[_(wa,{url:(l=(u=h.value)==null?void 0:u.tenantProductInsureVO)==null?void 0:l.banner[0]},null,8,["url"]),_(Ba,{"product-name":(c=h.value)==null?void 0:c.productFullName,"product-desc":(F=(v=h.value)==null?void 0:v.showConfigVO)==null?void 0:F.desc},null,8,["product-name","product-desc"])]),_(Ta,{"show-service-config":"","guarantee-list":(i=(d=h.value)==null?void 0:d.tenantProductInsureVO)==null?void 0:i.titleAndDescVOS},null,8,["guarantee-list"]),_(ba,{detail:h.value},{form:ee(()=>[_(Pa,{ref_key:"formRef",ref:j,"is-show-package":"",disable:!D(s).showInsure,"form-auth":I.value,"form-info":D(a),premium:w.value,"product-detail":h.value,onOnReset:Le,onOnUpdate:Re},null,8,["disable","form-auth","form-info","premium","product-detail"])]),_:1},8,["detail"]),U("div",Ma,[U("div",Va,[Ya,U("span",null,$(w.value?"\uFFE5":"")+$(D(fa)(w.value))+" "+$(w.value?D(a).paymentFrequency==D(Ee).YEAR?"\u5143/\u5E74":"\u5143/\u6708":""),1)]),_(e,{type:"primary",class:"right",disabled:!(D(s).canInsure||D(s).canUpgrade),onClick:le},{default:ee(()=>[be($(D(s).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),D(x)!=="payBack"?(q(),ve(ka,{key:1,"product-detail":h.value},null,8,["product-detail"])):ae("",!0),_(Sa,{"order-no":D(S),"tenant-id":D(C),"is-show":J.value,onOnConfirm:se,onOnClose:He},null,8,["order-no","tenant-id","is-show"])]}),_:1},8,["theme-vars"]),_(Oa,{show:V.value,"onUpdate:show":o[0]||(o[0]=u=>V.value=u),"content-list":D(Se),"active-index":0,onOnConfirmHealth:We},null,8,["show","content-list"]),b.value?(q(),ve(Ha,{key:0,show:b.value,"onUpdate:show":o[1]||(o[1]=u=>b.value=u),"content-list":D(Oe),"active-index":ne.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9","force-read-cound":2,onSubmit:Ge},null,8,["show","content-list","active-index"])):ae("",!0),_(Ua,{"is-show":z.value},null,8,["is-show"])],64)}}});var nt=pa(qa,[["__scopeId","data-v-21be9c1e"]]);export{nt as default};
