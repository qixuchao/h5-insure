import{ae as e,d as a,o as n,c as t,f as l,a as i,F as o,s,e as r,j as m,ai as u,aj as d,r as c,k as p,E as f,b as v,ak as E,w as y,p as h,u as R,al as T,q as I,_ as S,am as g,an as _,ao as D,ag as b,ap as M,aq as w,ar as N,as as L,at as k,au as P,av as V,aw as A}from"./index-a5faea38.js";import{c as F}from"./cloneDeep-4e5b548c.js";const C=[{value:5,label:"支付宝",iconName:"ali"},{value:6,label:"微信",iconName:"wechat"}];e([{value:1,label:"实时转账"},{value:2,label:"批量扣款"}]);var j=(e=>(e[e.DEBIT=1]="DEBIT",e[e.CREDIT=2]="CREDIT",e[e.PRE_PAY=3]="PRE_PAY",e[e.PRE_CREDIT=4]="PRE_CREDIT",e[e.OTHER=5]="OTHER",e))(j||{});e([{value:1,label:"借记卡"},{value:2,label:"贷记卡"},{value:3,label:"预付费卡"},{value:4,label:"准贷记卡"},{value:5,label:"其他"}]);var W=(e=>(e[e.FIRST_TERM=1]="FIRST_TERM",e[e.RENEW_TERM=2]="RENEW_TERM",e[e.REPRISE=3]="REPRISE",e[e.OTHER=4]="OTHER",e))(W||{});const G=[{value:1,label:"首期支付"},{value:2,label:"续期支付"},{value:3,label:"年金领取"},{value:4,label:"其他"}];e(G);var x=(e=>(e[e.FIRST_SAME=1]="FIRST_SAME",e[e.RENEW_SAME=2]="RENEW_SAME",e[e.OTHER=3]="OTHER",e))(x||{});e(G);e([{value:1,label:"自动垫付"},{value:2,label:"中止合同"}]);const O={key:0,class:"head-warning-wrap"},B={key:0,class:"warning-icon"},$=[i("span",null,"!",-1)],H={class:"warning-text"},J=a({name:"HeadWaring"}),U=a({...J,props:{labels:{default:()=>[]},showIcon:{type:Boolean,default:!0}},setup:e=>(e,a)=>e.labels.length>0?(n(),t("div",O,[e.showIcon?(n(),t("div",B,$)):l("",!0),i("div",H,[(n(!0),t(o,null,s(e.labels,(e=>(n(),t("span",{key:e},r(e),1)))),128))])])):l("",!0)});const q={class:"img-wrap"},z=["src"];var Y=S(a({__name:"PayInfo",props:{schema:{default:()=>[]},config:{default:()=>[]},modelValue:{default:()=>[]},isView:{type:Boolean,default:!1},userData:{default:()=>({})}},emits:["update:modelValue"],setup(e,{expose:a,emit:l}){const r=e,S="1",C=m(!1),G=m(0),O=[{img:"/h5insure/static/jpg/picidikou-cd1b0c24.jpg",title:"实时转账"},{img:"/h5insure/static/jpg/shishizhuanzhang-680e7d84.jpg",title:"批次抵扣"}],B=()=>{C.value=!0},$=m(null),H=["cardType","bankCard"],J=["orderId","tenantId","id"],Y={paymentType:"1",paymentMethod:"1",expiryMethod:"1",cardType:j.DEBIT},K=[...Object.keys(Y),"paymentGenre"],Q=[{title:"首期支付",schema:[],payInfoType:W.FIRST_TERM,formData:{},config:{cardType:{isView:!0},bankCard:{accountName:{isView:!0}}},objectType:u.INIT_SIGN},{title:"续期支付",schema:[],payInfoType:W.RENEW_TERM,formData:{paymentGenre:String(x.FIRST_SAME)},config:{cardType:{isView:!0},bankCard:{accountName:{isView:!0}}},objectType:u.RENEWAL_SIGN},{title:"年金领取银行卡",schema:[],payInfoType:W.REPRISE,formData:{paymentMethod:"1",paymentGenre:String(x.FIRST_SAME)},config:{},objectType:u.ANNUAL_SIGN}].map((e=>({...e,nanoid:d()}))),X=[["initialPaymentMethod","initialCardType","initialBankCard","initialPaymentType"],["renewalPaymentGenre","renewalPaymentMethod","renewalCardType","renewalBankCard","renewalPaymentType","expiryMethod"],["annuityPaymentGenre","annuityBankCard"]],Z=c({schemaList:[]}),ee=p((()=>{var e,a;return(null==(a=null==(e=r.userData.insuredList)?void 0:e[0])?void 0:a.name)||null})),ae=p((()=>{var e,a;return(null==(a=null==(e=r.userData)?void 0:e.holder)?void 0:a.name)||null})),ne=p((()=>["FIRST_TERM","RENEW_TERM","REPRISE"].reduce(((e,a)=>{const n=(t=a,Z.schemaList.findIndex((e=>String(e.payInfoType)===String(W[t]))));var t;return n>-1&&(e[a]=n),e}),{}))),te=(e,a)=>{var n,t;return e>-1&&(null==(t=null==(n=Z.schemaList[e])?void 0:n.formData)?void 0:t.paymentGenre)===`${x[a]}`},le=p((()=>{const e=Z.schemaList.map((e=>`${e.payInfoType}`));return Q.filter((a=>e.includes(String(a.payInfoType))))})),ie=(e,a)=>{var n;const{formData:t}=Z.schemaList[a]||{},{paymentGenre:l,id:i,...o}=t||{},s={bankCardImage:D(o.bankCardImage)?o.bankCardImage.map((a=>{var n,t;return{...a,objectType:null==(t=null==(n=le.value)?void 0:n[e])?void 0:t.objectType}})):[]};Object.keys(o).reduce(((e,a)=>(o[a]&&(e[a]=o[a]),e)),s),b(null==(n=Z.schemaList[e])?void 0:n.formData,s)};return f((()=>Z.schemaList.map((e=>{var a,n;return[null==(a=null==e?void 0:e.formData)?void 0:a.paymentMethod,null==(n=null==e?void 0:e.formData)?void 0:n.paymentGenre]}))),((e,a)=>{g("支付方式/支付类型变动"),Z.schemaList.forEach(((e,a)=>{const{formData:n,schema:t}=e||{},l=S===String(null==n?void 0:n.paymentMethod),i=[x.FIRST_SAME,x.RENEW_SAME].includes(Number(null==n?void 0:n.paymentGenre));t.forEach((e=>{e.hidden=(i||!l)&&((e,a=!1)=>{if(e){const n=[...H];return a&&n.push("paymentMethod"),n.includes(e)}return!1})(e.name,i)})),e.nanoid=d()}))}),{deep:!0,immediate:!0}),f((()=>Z.schemaList.map((e=>{var a;return null==(a=null==e?void 0:e.formData)?void 0:a.paymentType}))),((e,a)=>{!_(e,a)&&D(a)&&Z.schemaList.forEach(((e,n)=>{var t;(null==(t=null==e?void 0:e.formData)?void 0:t.paymentType)!==(null==a?void 0:a[n])&&b(e.formData,M(null==e?void 0:e.formData,(e=>["bankCardNo","payBank","mobile","bankCardImage","verificationCode"].includes(e))))}))}),{deep:!0}),f((()=>{var e;return F(null==(e=Z.schemaList[ne.value.FIRST_TERM])?void 0:e.formData)}),((e,a)=>{if(r.isView||JSON.stringify(e)===JSON.stringify(a))return!1;const{REPRISE:n,RENEW_TERM:t}=ne.value;g("首期数据变动"),te(t,"FIRST_SAME")&&ie(t,ne.value.FIRST_TERM),te(n,"FIRST_SAME")&&ie(n,t)}),{deep:!0}),f((()=>{var e;return null==(e=Z.schemaList[ne.value.RENEW_TERM])?void 0:e.formData}),((e,a)=>{if(r.isView||_(e,a))return!1;g("续期数据变动");const{REPRISE:n,RENEW_TERM:t}=ne.value;te(n,"RENEW_SAME")&&ie(n,t)}),{deep:!0}),f((()=>Z.schemaList.map((e=>{var a;return null==(a=null==e?void 0:e.formData)?void 0:a.paymentMethod}))),((e,a)=>{JSON.stringify(e)!==JSON.stringify(a)&&Z.schemaList.forEach(((n,t)=>{const l=e[t],i=a[t],o=l&&i&&String(l)!==String(i);n.payInfoType!==W.REPRISE&&o&&"1"!==String(l)&&b(n.formData,{...M(n.formData,(e=>A.includes(e))),bankCardImage:null})}))}),{deep:!0}),f((()=>{var e,a;return null==(a=null==(e=Z.schemaList[ne.value.RENEW_TERM])?void 0:e.formData)?void 0:a.paymentGenre}),(e=>{var a,n;if(r.isView)return!1;g("续期支付类型变动");const{FIRST_TERM:t,RENEW_TERM:l}=ne.value;String(e)===String(x.FIRST_SAME)?ie(l,t):Z.schemaList[l]&&(b(Z.schemaList[l].formData,{...M(Z.schemaList[l].formData,(e=>!J.includes(e))),...null==(n=null==(a=le.value)?void 0:a[l])?void 0:n.formData,accountName:ae.value,paymentGenre:e}),Z.schemaList[l].nanoid=d())})),f((()=>{var e,a;return null==(a=null==(e=Z.schemaList[ne.value.REPRISE])?void 0:e.formData)?void 0:a.paymentGenre}),((e,a)=>{var n,t;if(r.isView||!e||!a||e===a)return!1;const{FIRST_TERM:l,RENEW_TERM:i,REPRISE:o}=ne.value,s=[x.FIRST_SAME,x.RENEW_SAME].includes(Number(e));if(g("年金支付类型变动"),s){const a=String(e)===String(x.FIRST_SAME)?l:i;ie(o,a)}else Z.schemaList[o]&&(b(Z.schemaList[o].formData,{...M(Z.schemaList[o].formData,(e=>!J.includes(e))),...null==(t=null==(n=le.value)?void 0:n[o])?void 0:t.formData,accountName:ee.value,paymentGenre:e}),Z.schemaList[o].nanoid=d())}),{immediate:!0}),f([()=>r.schema,()=>r.config],(()=>{let e=[];Z.schemaList=r.schema.reduce(((a,n)=>{const t=X.findIndex((e=>e.includes(n.name)));if("paymentDrawType"===n.name&&(e=n.columns.map((e=>e.code))),t>-1){const e=(e=>{if("string"!=typeof e||!e)return"";const[a,n]=e.match(/^(?:initial|renewal|annuity)(.*)$/)||[];return n?V(n):e})(n.name);if(K.includes(e)){const l=(({name:e,columns:a},n)=>{if(D(a)){const t={...n,...Y},l=D(a)&&a.find((a=>`${a.code}`==`${t[e]}`));return{[e]:l?t[e]:null}}return{}})({name:e,columns:n.columns},Q[t].formData);b(a[t].formData,l),b(Q[t].formData,l)}a[t].schema.push({...n,name:e,payInfoType:Q[t].payInfoType})}return a}),w(Q)).map(((e,a)=>({...e,config:{...e.config,...r.config[a]||{}},nanoid:d()}))).filter((({schema:a,...n})=>e.includes(`${n.payInfoType}`)&&D(a)))}),{deep:!0,immediate:!0}),f((()=>r.modelValue),(e=>{D(e)&&Z.schemaList.forEach(((a,n)=>{var t;b(a.formData,e[n]),b(a.config,{payBank:{category:null==(t=null==e?void 0:e[n])?void 0:t.paymentType}})}))}),{deep:!0,immediate:!0}),f((()=>{var e;return null==(e=Z.schemaList)?void 0:e.map((e=>e.formData))}),(e=>{D(e)&&l("update:modelValue",e.map(((e,a)=>{const{payInfoType:n}=Z.schemaList[a];return{...e,payInfoType:n}})))}),{deep:!0,immediate:!0}),f((()=>[ae.value,ee.value]),(([e,a])=>{(e||a)&&Z.schemaList.forEach((n=>{const t=n.payInfoType===W.REPRISE;n.formData.accountName=t?a:e}))}),{deep:!0}),a({validate:e=>{var a;return Promise.all($.value?null==(a=$.value)?void 0:a.map((e=>null==e?void 0:e.validate())):[])}}),(e,a)=>{const l=N,r=L,m=k,u=P;return n(),t(o,null,[v(l,{title:"支付方式","show-line":!1,"show-divider":!1},E({_:2},[e.isView?void 0:{name:"extra",fn:y((()=>[i("span",{class:"extra",onClick:B},"银行限额表")])),key:"0"}]),1024),(n(!0),t(o,null,s(R(Z).schemaList,((a,t)=>(n(),h(R(T),{ref_for:!0,ref_key:"payInfoFormRef",ref:$,key:`${a.nanoid}_${t}`,schema:a.schema,model:a.formData,config:a.config,title:a.title,"show-icon":!1,"is-view":e.isView,"extra-provision":{objectType:a.objectType,objectId:a.formData.id}},null,8,["schema","model","config","title","is-view","extra-provision"])))),128)),v(u,{show:R(C),"onUpdate:show":a[1]||(a[1]=e=>I(C)?C.value=e:null),title:"银行卡可用列表"},{default:y((()=>[v(U,{"show-icon":!1,labels:["只支持借记卡，不支持信用卡和存折"]}),v(m,{active:R(G),"onUpdate:active":a[0]||(a[0]=e=>I(G)?G.value=e:null)},{default:y((()=>[(n(),t(o,null,s(O,((e,a)=>v(r,{key:a,title:e.title},{default:y((()=>[i("div",q,[i("img",{src:e.img,alt:""},null,8,z)])])),_:2},1032,["title"]))),64))])),_:1},8,["active"])])),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-3303dca1"]]);const K=a({name:"policyInfo"}),Q=a({...K,props:{schema:{default:()=>[]},config:{default:()=>[]},modelValue:{default:()=>[]},isView:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{expose:a,emit:t}){const l=e,i=c({schema:{},modelValue:{},config:{}}),o=m();return f([()=>l.schema,()=>l.config],(()=>{i.schema=l.schema,i.config=l.config}),{deep:!0,immediate:!0}),f((()=>l.modelValue),((e,a)=>{e!==a&&Object.assign(i.modelValue,e)}),{deep:!0,immediate:!0}),f((()=>i.modelValue),(e=>{t("update:modelValue",e)}),{deep:!0,immediate:!0}),a({validate:()=>{var e;return null==(e=o.value)?void 0:e.validate()}}),(e,a)=>(n(),h(R(T),{ref_key:"policyInfoFormRef",ref:o,schema:R(i).schema,model:R(i).modelValue,config:R(i).config,title:"保单信息","is-view":e.isView},null,8,["schema","model","config","is-view"]))}});export{C as A,Y as P,U as _,Q as a};
