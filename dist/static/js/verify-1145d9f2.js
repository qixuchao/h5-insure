import{d as e,j as a,i as l,z as s,o as i,l as o,w as n,a as u,e as r,u as t,b as d,V as v,W as c,c4 as m,c5 as f,c6 as p,c7 as y,as as h,ao as g,h as b,g as S,O as C,c as k,q as V,F as q,a8 as j,T as L,a6 as x,bj as w,aC as I,a9 as U,aa as _,c8 as F,aq as O,an as E}from"./index-70866bb3.js";import{n as N}from"./nextStep-73676ab5.js";import{c as P}from"./format-b5e9d8b9.js";import{g as $,m as A}from"./trial-55b7b6bf.js";import{p as D}from"./utils-394f97a4.js";import{u as G}from"./useOrder-4c3b96c8.js";import{P as R,a as B,B as T}from"./constants-fe95ef6f.js";import{d as Y,q as z}from"./verify-a27a8cb4.js";import"./core-00714f77.js";const J={class:"popup-container"},M={class:"popup-header"},W={class:"title"},H={class:"popup-body"},K=e({name:"checkCodePopup"}),Q=e({...K,props:{show:{type:Boolean,default:!1},type:{default:"agent"},data:{default:()=>({})}},emits:["cancel","confirm"],setup(e,{emit:g}){const b=e,S=a((()=>b.show)),C=l({mobile:"",verifyCode:""}),k=a((()=>b.type)),V=l({holder:{type:"投保人",name:"",mobile:"",desc:""},agent:{type:"代理人",name:"李三",mobile:"13262278989",desc:"色卡上会计核算看回放独守空房还是空巅峰计划收款方"},insured:{type:"被保人",name:"",mobile:"",desc:""}}),q=()=>{g("cancel")},j=()=>{g("confirm")};return s([()=>b.data,b.type],(([e,a])=>{var l,s,i;e&&(Object.assign(V.value.holder,e.holder),Object.assign(V.value.insured,null==(l=null==e?void 0:e.insuredList)?void 0:l[0]),C.value.mobile=null==(i=null==(s=V.value)?void 0:s[`${b.type}`])?void 0:i.mobile)}),{immediate:!0,deep:!0}),(e,a)=>{const l=f,s=p,g=y,b=h;return i(),o(b,{show:S.value,"onUpdate:show":a[2]||(a[2]=e=>S.value=e),class:"popup-check-mobile",closeable:!1,"close-on-click-overlay":!1},{default:n((()=>[u("div",J,[u("div",M,[u("span",{class:"clear-all",onClick:q}," 取消 "),u("span",W,r(`${V.value[k.value].type}手机号验证`),1),u("span",{class:"close",onClick:j},"确认")]),u("div",H,[u("h3",null,r(`尊敬的${V.value[k.value].type}:${V.value[k.value].name}`),1),u("p",null,r(V.value[k.value].desc),1),u("h3",null,r(`${V.value[k.value].type}手机号验证 ${t(P)(V.value[k.value].mobile||"")}`),1),d(g,{model:C.value},{default:n((()=>[v(d(l,{modelValue:C.value.mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>C.value.mobile=e),label:"被保人手机号",name:"mobile",maxlength:"11",required:""},null,8,["modelValue"]),[[c,!1]]),d(s,{modelValue:C.value.verifyCode,"onUpdate:modelValue":a[1]||(a[1]=e=>C.value.verifyCode=e),"related-name":"mobile",label:" ",maxlength:"6","input-align":"left",placeholder:"请输入验证码",name:"verifyCode","send-s-m-s-code":t(m),rules:""},null,8,["modelValue","send-s-m-s-code"])])),_:1},8,["model"])])])])),_:1},8,["show"])}}}),X=g([{label:"签名完成",value:1},{label:"去签名",value:2},{label:"认证失败，请联系内勤人员",value:3}]);const Z={class:"page-verify-wrap"},ee={key:0,class:"header"},ae={class:"sign-list"},le={class:"inner-cell"},se={class:"inner-cell"},ie={class:"footer-button"},oe=e({name:"verify"}),ne=e({...oe,setup(e){const s=b(),r=S(),{orderNo:v,tenantId:c}=s.query,h=l(!1),g=l(!1),P=l(),J=l({holder:{},insuredList:[{}]}),M=G(),W=l(!1),H=l({sign:[],verify:[],scribing:""}),K=l({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{},verifyStatus:2},agent:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2}}),oe=l("agent"),ne=a((()=>e=>H.value.sign.includes(e)||H.value.verify.includes(e))),ue=a((()=>e=>K.value[e].isSign||K.value[e].isVerify)),re=a((()=>e=>K.value[e].isShareSign)),te=e=>{oe.value=e,"agent"!==e?W.value=!0:r.push({path:R.agentSign,query:s.query})},de=()=>{Y(M.value).then((({code:e,data:a})=>{"10000"===e&&a&&L("双录已完成")}))},ve=()=>{W.value=!1},ce=()=>{let e="";e=("agent"===oe.value||(oe.value,K.value[oe.value].isVerify),R.infoPreview),r.push({path:e,query:{...s.query,objectType:oe.value}})},me=()=>{const{holder:e,insuredList:a,extInfo:l}=M.value;if(h.value){if(!l.agentAuthFlag)return void L("请先完成代理人签名")}else if([l.agentAuthFlag,e.isCert,a[0].isCert].includes(x.NO))return void L("请先完成签名");const i=Object.assign(M.value,{extInfo:{...M.value.extInfo,pageCode:B.SIGN,buttonCode:T.SIGN}});N(i,((e,a)=>{a===I.JUMP_PAGE&&U(e.nextPageCode,s.query)}),s)};return C((()=>{(async()=>{let e={};z({orderNo:v,tenantId:c}).then((({code:e,data:a})=>{if("10000"===e){const{doubleRecordFlag:e,doubleRecordStatus:l}=a;h.value=e===x.YES,g.value=l===x.YES}})),await $({orderNo:v,tenantId:c}).then((({code:a,data:l})=>{var s,i;if("10000"===a){Object.assign(M.value,l);const{agentAuthFlag:a}=l.extInfo;J.value=l,e=D(l.insuredList[0].productList),K.value.agent.verifyStatus=a,K.value.holder.verifyStatus=l.holder.isCert,K.value.insured.verifyStatus=null==(i=null==(s=l.insuredList)?void 0:s[0])?void 0:i.isCert}})),await A(e).then((({data:e,code:a})=>{if("10000"===a){const{signInfo:a}=w(e.productFactor);a.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((a=>{e.required&&H.value.sign.push(a.code),"1"===a.code?K.value.agent.isSign=!0:"2"===a.code?K.value.holder.isSign=!0:"3"===a.code?K.value.insured.isSign=!0:"4"===a.code?K.value.holder.isShareSign=!0:"5"===a.code&&(K.value.insured.isShareSign=!0)})),"customerFace"===e.name&&e.columns.forEach((a=>{e.required&&H.value.verify.push(a.code),"1"===a.code?K.value.holder.isVerify=!0:"2"===a.code&&(K.value.insured.isVerify=!0)}))}))}}))})()})),(e,a)=>{const l=_,s=F,r=O,v=E;return i(),k("div",Z,[d(l),t(h)?(i(),k("div",ee,[d(s,{type:"warning",content:"为保障您的合法权益，当前保单需要进行双录"})])):V("",!0),u("div",ae,[t(ue)("agent")?(i(),o(r,{key:0,title:"代理人签名",required:t(ne)("agent"),"is-link":"",value:t(X)[t(K).agent.verifyStatus],onClick:a[0]||(a[0]=e=>te("agent"))},null,8,["required","value"])):V("",!0),t(h)?(i(),o(t(y),{key:2,ref_key:"formRef",ref:P,model:t(J)},{default:n((()=>[d(t(f),{modelValue:t(J).holder.mobile,"onUpdate:modelValue":a[3]||(a[3]=e=>t(J).holder.mobile=e),label:"投保人手机号",name:"holder.mobile",maxlength:"11",required:""},null,8,["modelValue"]),d(t(p),{modelValue:t(J).holder.verifyCode,"onUpdate:modelValue":a[4]||(a[4]=e=>t(J).holder.verifyCode=e),"related-name":"holder.mobile",label:"验证码",maxlength:"6",name:"holder.verifyCode","send-s-m-s-code":t(m),rules:"",required:""},null,8,["modelValue","send-s-m-s-code"]),d(t(f),{modelValue:t(J).insuredList[0].mobile,"onUpdate:modelValue":a[5]||(a[5]=e=>t(J).insuredList[0].mobile=e),label:"被保人手机号",name:"insuredList.0.mobile",maxlength:"11",required:""},null,8,["modelValue"]),d(t(p),{modelValue:t(J).insuredList[0].verifyCode,"onUpdate:modelValue":a[6]||(a[6]=e=>t(J).insuredList[0].verifyCode=e),label:"验证码",maxlength:"6",name:"insuredList.0.verifyCode","related-name":"insuredList.0.mobile","send-s-m-s-code":t(m),required:""},null,8,["modelValue","send-s-m-s-code"])])),_:1},8,["model"])):(i(),k(q,{key:1},[t(ue)("holder")?(i(),o(r,{key:0,title:"投保人签名",required:t(ne)("holder")},{value:n((()=>[u("div",le,[t(re)("holder")?(i(),o(r,{key:0,"is-link":"",value:"分享空签邀约"})):V("",!0),d(r,{"is-link":"",value:t(X)[t(K).holder.verifyStatus],onClick:a[1]||(a[1]=e=>te("holder"))},null,8,["value"])])])),_:1},8,["required"])):V("",!0),t(ue)("insured")?(i(),o(r,{key:1,title:"被保人签名",required:t(ne)("insured")},{value:n((()=>[u("div",se,[t(re)("insured")?(i(),o(r,{key:0,"is-link":"",value:"分享空签邀约"})):V("",!0),d(r,{"is-link":"",value:t(X)[t(K).insured.verifyStatus],onClick:a[2]||(a[2]=e=>te("insured"))},null,8,["value"])])])),_:1},8,["required"])):V("",!0)],64)),t(h)?(i(),o(r,{key:3,title:"保单双录",required:"","is-link":"",value:"去双录",onClick:de})):V("",!0)]),u("div",ie,[d(v,{type:"primary",onClick:me},{default:n((()=>[j("下一步")])),_:1})]),d(Q,{type:t(oe),show:t(W),data:t(M),onCancel:ve,onConfirm:ce},null,8,["type","show","data"])])}}});export{ne as default};
