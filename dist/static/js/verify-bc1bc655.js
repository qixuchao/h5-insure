import{d as e,j as a,i as l,z as s,o as i,l as n,w as o,a as r,e as u,u as d,b as t,V as v,W as m,bU as c,m as p,bV as f,bW as h,bX as y,as as g,ao as b,h as S,g as V,O as k,c as C,q,F as w,bY as L,a8 as x,bk as j,aa as I,bZ as U,aq as $,an as _}from"./index-2b9d0680.js";import{c as E}from"./format-b5e9d8b9.js";import{g as F,m as O}from"./trial-965388ea.js";import{p as D}from"./utils-6fc00a71.js";import{u as P}from"./useOrder-ad5f75e9.js";import{a as N}from"./constants-71331306.js";const R={class:"popup-container"},W={class:"popup-header"},z={class:"title"},A={class:"popup-body"},B=e({name:"checkCodePopup"}),X=e({...B,props:{show:{type:Boolean,default:!1},type:{default:"agent"},data:{default:()=>({})}},emits:["cancel","confirm"],setup(e,{emit:b}){const S=e,V=a((()=>S.show)),k=l({mobile:"",verifyCode:""}),C=a((()=>S.type)),q=l({holder:{type:"投保人",name:"",mobile:"",desc:""},agent:{type:"代理人",name:"李三",mobile:"13262278989",desc:"色卡上会计核算看回放独守空房还是空巅峰计划收款方"},insured:{type:"被保人",name:"",mobile:"",desc:""}}),w=()=>{b("cancel")},L=()=>{b("confirm")};return s([()=>S.data,S.type],(([e,a])=>{var l,s,i;e&&(Object.assign(q.value.holder,e.holder),Object.assign(q.value.insured,null==(l=null==e?void 0:e.insuredList)?void 0:l[0]),k.value.mobile=null==(i=null==(s=q.value)?void 0:s[`${S.type}`])?void 0:i.mobile)}),{immediate:!0,deep:!0}),(e,a)=>{const l=f,s=h,b=y,S=g;return i(),n(S,{show:d(V),"onUpdate:show":a[2]||(a[2]=e=>p(V)?V.value=e:null),class:"popup-check-mobile",closeable:!1,"close-on-click-overlay":!1},{default:o((()=>[r("div",R,[r("div",W,[r("span",{class:"clear-all",onClick:w}," 取消 "),r("span",z,u(`${q.value[d(C)].type}手机号验证`),1),r("span",{class:"close",onClick:L},"确认")]),r("div",A,[r("h3",null,u(`尊敬的${q.value[d(C)].type}:${q.value[d(C)].name}`),1),r("p",null,u(q.value[d(C)].desc),1),r("h3",null,u(`${q.value[d(C)].type}手机号验证 ${d(E)(q.value[d(C)].mobile||"")}`),1),t(b,{model:k.value},{default:o((()=>[v(t(l,{modelValue:k.value.mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>k.value.mobile=e),label:"被保人手机号",name:"mobile",maxlength:"11",required:""},null,8,["modelValue"]),[[m,!1]]),t(s,{modelValue:k.value.verifyCode,"onUpdate:modelValue":a[1]||(a[1]=e=>k.value.verifyCode=e),"related-name":"mobile",label:" ",maxlength:"6","input-align":"left",placeholder:"请输入验证码",name:"verifyCode","send-s-m-s-code":d(c),rules:""},null,8,["modelValue","send-s-m-s-code"])])),_:1},8,["model"])])])])),_:1},8,["show"])}}}),Y=b([{label:"签名完成",value:1},{label:"去签名",value:2},{label:"认证失败，请联系内勤人员",value:3}]);const Z={class:"page-verify-wrap"},G={key:0,class:"header"},H={class:"sign-list"},J={class:"inner-cell"},K={class:"inner-cell"},M={class:"footer-button"},Q=e({name:"verify"}),T=e({...Q,setup(e){const s=S(),u=V(),{orderNo:v,tenantId:m}=s.query,p=l(!1),g=l({holder:{},insuredList:[{}]}),b=P(),E=l(!1),R=l({sign:[],verify:[],scribing:""}),W=l({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{},verifyStatus:2},agent:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2}}),z=l("agent"),A=a((()=>e=>R.value.sign.includes(e)||R.value.verify.includes(e))),B=a((()=>e=>W.value[e].isSign||W.value[e].isVerify)),Q=a((()=>e=>W.value[e].isShareSign)),T=e=>{z.value=e,E.value=!0},ee=()=>{E.value=!1},ae=()=>{let e="";e="agent"===z.value?N.agentSign:"holder"===z.value?(W.value[z.value].isVerify,N.holderSign):W.value[z.value].isVerify?N.checkFace:N.insuredSign,u.push({path:e,query:{...s.query,type:z.value}})};return k((()=>{(async()=>{let e={};await F({orderNo:v,tenantId:m}).then((({code:a,data:l})=>{var s;"10000"===a&&(Object.assign(b.value,l),g.value=l,e=D(l.insuredList[0].productList),W.value.agent.verifyStatus=l.extInfo.agentAuthFlag,W.value.holder.verifyStatus=l.holder.isCert,W.value.insured.verifyStatus=null==(s=l.extInfo.insured)?void 0:s[0].isCert)})),await O(e).then((({data:e,code:a})=>{if("10000"===a){const{signInfo:a}=j(e.productFactor);a.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((a=>{e.required&&R.value.sign.push(a.code),"1"===a.code?W.value.agent.isSign=!0:"2"===a.code?W.value.holder.isSign=!0:"3"===a.code?W.value.insured.isSign=!0:"4"===a.code?W.value.holder.isShareSign=!0:"5"===a.code&&(W.value.insured.isShareSign=!0)})),"customerFace"===e.name&&e.columns.forEach((a=>{e.required&&R.value.verify.push(a.code),"1"===a.code?W.value.holder.isVerify=!0:"2"===a.code&&(W.value.insured.isVerify=!0)}))}))}}))})()})),(e,a)=>{const l=I,s=U,u=$,v=_;return i(),C("div",Z,[t(l),d(p)?(i(),C("div",G,[t(s,{type:"warning",content:"为保障您的合法权益，当前保单需要进行双录"})])):q("",!0),r("div",H,[d(B)("agent")?(i(),n(u,{key:0,title:"代理人签名",required:d(A)("agent"),"is-link":"",value:d(Y)[d(W).agent.verifyStatus],onClick:a[0]||(a[0]=e=>T("agent"))},null,8,["required","value"])):q("",!0),d(p)?(i(),n(d(y),{key:2,model:d(g)},{default:o((()=>[t(d(f),{modelValue:d(g).holder.mobile,"onUpdate:modelValue":a[3]||(a[3]=e=>d(g).holder.mobile=e),rules:[{pattern:new RegExp(d(L).isPhone)}],label:"投保人手机号",name:"holder.mobile",maxlength:"11",required:""},null,8,["modelValue","rules"]),t(d(h),{modelValue:d(g).holder.verifyCode,"onUpdate:modelValue":a[4]||(a[4]=e=>d(g).holder.verifyCode=e),"related-name":"holder.mobile",label:"验证码",maxlength:"6",name:"holder.verifyCode","send-s-m-s-code":d(c),rules:"",required:""},null,8,["modelValue","send-s-m-s-code"]),t(d(f),{modelValue:d(g).insuredList[0].mobile,"onUpdate:modelValue":a[5]||(a[5]=e=>d(g).insuredList[0].mobile=e),label:"被保人手机号",name:"insuredList.0.mobile",maxlength:"11",required:"",rules:[{pattern:new RegExp(d(L).isPhone)}]},null,8,["modelValue","rules"]),t(d(h),{modelValue:d(g).insuredList[0].verifyCode,"onUpdate:modelValue":a[6]||(a[6]=e=>d(g).insuredList[0].verifyCode=e),label:"验证码",maxlength:"6",name:"insuredList.0.verifyCode","related-name":"insuredList.0.mobile","send-s-m-s-code":d(c),required:""},null,8,["modelValue","send-s-m-s-code"])])),_:1},8,["model"])):(i(),C(w,{key:1},[d(B)("holder")?(i(),n(u,{key:0,title:"投保人签名",required:d(A)("holder")},{value:o((()=>[r("div",J,[d(Q)("holder")?(i(),n(u,{key:0,"is-link":"",value:"分享空签邀约"})):q("",!0),t(u,{"is-link":"",value:d(Y)[d(W).holder.verifyStatus],onClick:a[1]||(a[1]=e=>T("holder"))},null,8,["value"])])])),_:1},8,["required"])):q("",!0),d(B)("insured")?(i(),n(u,{key:1,title:"被保人签名",required:d(A)("insured")},{value:o((()=>[r("div",K,[d(Q)("insured")?(i(),n(u,{key:0,"is-link":"",value:"分享空签邀约"})):q("",!0),t(u,{"is-link":"",value:d(Y)[d(W).insured.verifyStatus],onClick:a[2]||(a[2]=e=>T("insured"))},null,8,["value"])])])),_:1},8,["required"])):q("",!0)],64))]),r("div",M,[t(v,{type:"primary"},{default:o((()=>[x("下一步")])),_:1})]),t(X,{type:d(z),show:d(E),data:d(b),onCancel:ee,onConfirm:ae},null,8,["type","show","data"])])}}});export{T as default};
