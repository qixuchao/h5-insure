import{n as e,o as n,m as a,p as t}from"./infoCollection-f7e519d7.js";import{$ as l,_ as i,d as r,r as o,z as u,a8 as s,x as c,G as m,a3 as d,am as f,ao as p,b as v,c as y,g as I,f as D,w as V,i as P,l as g,j as k,t as b,au as C,F as O,n as E,K as L,L as h,e as x,h as Y,B as F,T as S}from"./index-27f97798.js";import{u as N}from"./useDicData-9ea647d0.js";import{k as q}from"./trial-8a09f559.js";import{o as R}from"./utils-568eb461.js";import"./pdfh5-e5c0db2a.js";import"./useStorage-bb4dd5cd.js";const T=(e,n="YYYY-MM-DD")=>l(e).format(n),_=(e,n=0,a="day",t="YYYY-MM-DD")=>l(e).add(n,a).format(t),w=(e,n=0,a="day",t="YYYY-MM-DD")=>l(e).subtract(n,a).format(t);const M=e=>(L("data-v-37bee7cd"),e=e(),h(),e),U={class:"com-period-cell"},$={key:0,class:"period-custom-cell period-check-btn-cell"},j=M((()=>P("div",{class:"period-cell-label"},"保障期间",-1))),A={class:"period-cell-content"},B={class:"period-custom-cell period-common-cell"},G=M((()=>P("div",{class:"period-cell-label"},"保障期限",-1))),K={class:"period-cell-content"},z=M((()=>P("div",{class:"picker-custom-title"},"保险开始生效日期",-1))),H=E("确 定");var X=i(r({props:{formInfo:{type:Object,default:()=>{}},insureDetail:{type:Object,default:()=>{}}},emits:["onReset","onUpdate","onVerify"],setup(a,{expose:t,emit:l}){const i=a;o({});const r=(e,n)=>"year"===e?`${n}年`:"month"===e?`${n}月`:"day"===e?`${n}日`:n,E=o(new Date),L=N("RISK_INSURANCE_PERIOD"),h=u({formInfo:i.formInfo});s((()=>h.formInfo.insuranceStartDate),(e=>{e&&"string"==typeof e&&(E.value=new Date(e))}));const x=o(),Y=o([]);s([()=>i.insureDetail,()=>h.formInfo.activePlanCode],(()=>{var e;if(h.formInfo.insuranceStartDate="",h.formInfo.insuranceEndDate="",h.formInfo.commencementTime="",i.insureDetail)if(i.insureDetail.productRelationPlanVOList&&i.insureDetail.productRelationPlanVOList.length>0){let n=0;const a=i.insureDetail.productRelationPlanVOList.findIndex((e=>e.planCode===h.formInfo.activePlanCode));a>-1&&(n=a);const t=((null==(e=i.insureDetail.productRelationPlanVOList[n])?void 0:e.productRiskVoList[0].riskDetailVOList)||[]).find((e=>1===e.riskType));t&&(x.value=t)}else{const e=(i.insureDetail.productRiskVoList[0].riskDetailVOList||[]).find((e=>1===e.riskType));e&&(x.value=e)}}),{deep:!0,immediate:!0}),s([()=>x.value,()=>L.value],(()=>{Y.value=[],Array.isArray(L.value)&&L.value.length>1&&x.value&&(Y.value=(x.value.riskInsureLimitVO.insurancePeriodValueList||[]).map((e=>{const n=L.value.find((n=>n.value===e));return n?{label:n.name,value:n.value}:null})).filter((e=>!!e))),Y.value.length>0?Y.value.findIndex((e=>e.value===h.formInfo.insurancePeriodValue))<0&&(h.formInfo.insurancePeriodValue=Y.value[0].value):h.formInfo.insurancePeriodValue=q.YEAR_1}),{deep:!0,immediate:!0});const F=c((()=>{var n,a;return(null==(n=x.value)?void 0:n.insuranceStartType)?String(null==(a=x.value)?void 0:a.insuranceStartType):e.CURRENT_DAY})),S=c((()=>{var e,a;return(null==(e=x.value)?void 0:e.insuranceEndType)?String(null==(a=x.value)?void 0:a.insuranceEndType):n.CURRENT_DAY})),[R,M]=m(!1),X=new Date(_(new Date,1,"day")),J=c((()=>{var n;if(F.value===e.CUSTOM_DAY){const e=null==(n=x.value)?void 0:n.riskInsureLimitVO.maxInsuranceDay;if(!e)return new Date;const a=_(new Date,Number(e),"day");return new Date(a)}return new Date})),Q=e=>{h.formInfo.insuranceStartDate=`${T(e)} 00:00:00`,M(!1)},W=()=>{M(!1)};return s([()=>F.value,()=>h.formInfo.insurancePeriodValue,()=>h.formInfo.insuranceStartDate,()=>x.value],(()=>{var a;if(!h.formInfo.insurancePeriodValue)return;const[t,l]=h.formInfo.insurancePeriodValue.split("_");if(!h.formInfo.insuranceStartDate)if(F.value===e.CUSTOM_DAY){const e=null==(a=x.value)?void 0:a.riskInsureLimitVO.maxInsuranceDay;h.formInfo.insuranceStartDate=e?`${_(new Date,e,"day")} 00:00:00`:`${_(new Date,1,"day")} 00:00:00`}else F.value===e.NEXT_DAY?h.formInfo.insuranceStartDate=`${_(new Date,1,"day")} 00:00:00`:h.formInfo.insuranceStartDate=`${T(new Date)} 00:00:00`;if("to"!==t){const e=`${w(h.formInfo.insuranceStartDate,1,"day")} 00:00:00`;S.value===n.CURRENT_DAY?h.formInfo.insuranceEndDate=`${_(e,Number(l),t)} 23:59:59`:h.formInfo.insuranceEndDate=`${_(h.formInfo.insuranceStartDate,Number(l),t)} 00:00:00`}else{let e=h.formInfo.tenantOrderInsuredList[0].birthday;h.formInfo.tenantOrderInsuredList[0].certType===d.CERT&&h.formInfo.tenantOrderInsuredList[0].certNo&&f(h.formInfo.tenantOrderInsuredList[0].certNo)&&(e=p(h.formInfo.tenantOrderInsuredList[0].certNo));const a=`${w(e,1,"day")} 00:00:00`;"single"===l&&(h.formInfo.insuranceEndDate="9999-99-99 23:59:59"),S.value===n.CURRENT_DAY?h.formInfo.insuranceEndDate=`${_(a,Number(l),t)} 23:59:59`:h.formInfo.insuranceEndDate=`${_(e,Number(l),t)} 00:00:00`}}),{immediate:!0}),t({}),(e,n)=>{const a=v("ProRadioButton"),t=v("van-config-provider"),l=v("VanButton"),i=v("van-datetime-picker"),o=v("ProPopup");return y(),I(O,null,[D(t,null,{default:V((()=>[P("div",U,[Y.value.length>1?(y(),I("div",$,[j,P("div",A,[D(a,{modelValue:g(h).formInfo.insurancePeriodValue,"onUpdate:modelValue":n[0]||(n[0]=e=>g(h).formInfo.insurancePeriodValue=e),options:Y.value},null,8,["modelValue","options"])])])):k("",!0),P("div",B,[G,P("div",K,b(g(h).formInfo.insuranceStartDate?g(T)(g(h).formInfo.insuranceStartDate,"YYYY.MM.DD"):"")+"-"+b(g(h).formInfo.insuranceEndDate?g(T)(g(h).formInfo.insuranceEndDate,"YYYY.MM.DD"):""),1)])])])),_:1}),D(o,{show:g(R),"onUpdate:show":n[3]||(n[3]=e=>C(R)?R.value=e:null),height:"340",closeable:!0},{default:V((()=>[D(i,{modelValue:E.value,"onUpdate:modelValue":n[2]||(n[2]=e=>E.value=e),type:"date",title:"保险开始生效日期","min-date":g(X),"max-date":g(J),formatter:r,"visible-item-count":5,class:"custom-date-picker",onConfirm:Q,onCancel:W},{cancel:V((()=>[])),title:V((()=>[z])),confirm:V((()=>[D(l,{type:"primary",round:"",block:"",class:"linear-btn custom-picker-btn",onClick:n[1]||(n[1]=e=>R.value=!1)},{default:V((()=>[H])),_:1})])),_:1},8,["modelValue","min-date","max-date"])])),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-37bee7cd"]]);const J=e=>(L("data-v-1defc39e"),e=e(),h(),e),Q={class:"com-payment-type"},W={class:"title"},Z={key:0,class:"picture-payment-content"},ee=["onClick"],ne=["src"],ae=["src"],te={key:1,class:"custom-cell check-btn-cell"},le=J((()=>P("div",{class:"cell-label"},"保障方案",-1))),ie={class:"cell-content"},re={key:0,class:"picture-payment-content"},oe=["onClick"],ue=["src"],se=["src"],ce={key:1,class:"custom-cell check-btn-cell"},me=J((()=>P("div",{class:"cell-label"},"交费方式",-1))),de={class:"cell-content"},fe={class:"custom-cell common-cell"},pe=J((()=>P("div",{class:"cell-label"},"实付保费",-1))),ve={key:0,class:"cell-content actual-premium"},ye={class:"cell-content actual-premium"},Ie={key:0,class:"actual-premium actual-premium-month-tip"},De={key:0,class:"feerate-explain"},Ve={class:"content"},Pe=J((()=>P("div",{class:"triangle-top"},null,-1)));var ge=i(r({props:{formInfo:{type:Object,default:()=>{}},insureDetail:{type:Object,default:()=>{}},configDetail:{type:Object,default:()=>{}},isMultiplePlan:{type:Boolean,default:!1},premiumInfo:{type:Object,default:()=>{}}},emits:["update-active-plan"],setup(e,{expose:n,emit:l}){const i=e;o({});const r=u({formInfo:i.formInfo}),m=o([]),d=o(),f=o(),p=c((()=>{var e;return"1"===String(null==(e=d.value)?void 0:e.paymentFrequencyFlag)}));c((()=>{var e;return null==(e=f.value)?void 0:e.productPremiumVOList.find((e=>e.paymentFrequency===r.formInfo.paymentFrequency))}));const C=c((()=>i.premiumInfo.premiumLoadingText?i.premiumInfo.premiumLoadingText:i.premiumInfo.premium?`${i.premiumInfo.premium||""}${i.premiumInfo.actualUnit||"元"}`:`${i.premiumInfo.minPremiun||""}${i.premiumInfo.unit||""}`)),E=c((()=>{if(f){const{premiumExplain:e,premiumExplainViewName:n,premiumExplainUri:a}=f.value||{};return{premiumExplain:e,premiumExplainUri:a,premiumExplainViewName:n}}return null})),L=c((()=>E.value&&E.value.premiumExplain&&E.value.premiumExplainViewName));s((()=>i.configDetail),(()=>{var e;i.isMultiplePlan&&i.configDetail&&(m.value=null==(e=i.configDetail.tenantProductInsureVO)?void 0:e.planList)}),{immediate:!0,deep:!0}),s([()=>i.configDetail,()=>i.isMultiplePlan,()=>r.formInfo.activePlanCode],(()=>{if(i.configDetail)if(i.isMultiplePlan){let e=0;const n=i.configDetail.tenantProductInsureVO.planList.findIndex((e=>e.planCode===r.formInfo.activePlanCode));n>-1&&(e=n),d.value=i.configDetail.tenantProductInsureVO.planList[e].productPlanInsureConditionVO,f.value=i.configDetail.tenantProductInsureVO.planList[e]}else d.value=i.configDetail.tenantProductInsureVO.planInsureVO.productPlanInsureConditionVO,f.value=i.configDetail.tenantProductInsureVO.planInsureVO}),{deep:!0,immediate:!0});const h=c((()=>{var e;if(d.value&&d.value.paymentFrequency){return((null==(e=d.value.paymentFrequency)?void 0:e.split(","))||[]).length>1}return!1}));s((()=>d.value),(()=>{var e;if(d.value){const n=(null==(e=d.value.paymentFrequency)?void 0:e.split(","))||[];if(1===n.length)return void(r.formInfo.paymentFrequency=d.value.paymentFrequency);if(2===n.length&&n.filter((e=>![a.SINGLE,a.MONTH].includes(e))).length<1)return void(r.formInfo.paymentFrequency||(r.formInfo.paymentFrequency=a.SINGLE));n.length>1&&!r.formInfo.paymentFrequency&&(r.formInfo.paymentFrequency=null==n?void 0:n[0])}}),{immediate:!0,deep:!0});const N=c((()=>{var e;return d.value?null==(e=d.value.paymentFrequencyList||[])?void 0:e.map((e=>({...e,paymentFrequency:e.skinValue}))):[]})),q=c((()=>N.value.length>0)),T=c((()=>i.isMultiplePlan?i.configDetail.tenantProductInsureVO.planList.map((e=>e.planPicList?{...e.planPicList,planCode:e.planCode,planName:e.planName}:null)).filter((e=>!!e)):[])),_=c((()=>{var e,n;if(d.value){const a=(null==(e=d.value.paymentFrequency)?void 0:e.split(","))||[];return 1===a.length&&(r.formInfo.paymentFrequency=a[0]),null==(n=a||[])?void 0:n.map((e=>({label:t[e],value:e})))}return[]})),w=e=>{r.formInfo.activePlanCode=e},M=()=>{var e,n;(null==(e=E.value)?void 0:e.premiumExplainUri)?R({fileType:"pdf",fileUri:null==(n=E.value)?void 0:n.premiumExplainUri}):S("无费率文件！")};return n({}),(n,a)=>{const t=v("ProRadioButton"),l=v("templat"),o=v("ProDivider"),u=v("van-config-provider");return y(),x(u,null,{default:V((()=>[P("div",Q,[P("div",W,b(g(h)?"交费方式":"保障计划"),1),e.isMultiplePlan?(y(),I(O,{key:0},[g(T).length>0?(y(),I("div",Z,[(y(!0),I(O,null,Y(g(T),(e=>(y(),I("div",{key:e.planCode,class:F("picture-payment-item"),onClick:n=>w(e.planCode)},[g(r).formInfo.activePlanCode==e.planCode?(y(),I("img",{key:0,src:e.selectedPic},null,8,ne)):(y(),I("img",{key:1,src:e.unSelectedPic},null,8,ae))],8,ee)))),128))])):(y(),I("div",te,[le,P("div",ie,[D(t,{modelValue:g(r).formInfo.activePlanCode,"onUpdate:modelValue":a[0]||(a[0]=e=>g(r).formInfo.activePlanCode=e),options:m.value,prop:{value:"planCode",label:"planName"},onChange:w},null,8,["modelValue","options"])])]))],64)):k("",!0),g(p)?(y(),x(l,{key:1},{default:V((()=>[g(q)&&g(N).length>1?(y(),I("div",re,[(y(!0),I(O,null,Y(g(N),(e=>(y(),I("div",{key:e.paymentFrequency,class:F("picture-payment-item"),onClick:n=>{return a=e.paymentFrequency,void(r.formInfo.paymentFrequency=a);var a}},[g(r).formInfo.paymentFrequency==e.paymentFrequency?(y(),I("img",{key:0,src:e.selectedPic},null,8,ue)):(y(),I("img",{key:1,src:e.unSelectedPic},null,8,se))],8,oe)))),128))])):g(_).length>1?(y(),I("div",ce,[me,P("div",de,[D(t,{modelValue:g(r).formInfo.paymentFrequency,"onUpdate:modelValue":a[1]||(a[1]=e=>g(r).formInfo.paymentFrequency=e),options:g(_)},null,8,["modelValue","options"])])])):k("",!0)])),_:1})):k("",!0),D(X,{"form-info":g(r).formInfo,"insure-detail":e.insureDetail,"config-detail":e.configDetail},null,8,["form-info","insure-detail","config-detail"]),g(C)&&g(L)?(y(),I(O,{key:2},[P("div",fe,[pe,i.premiumInfo.premiumLoadingText?(y(),I("div",ve,b(g(C)),1)):(y(),I(O,{key:1},[P("div",ye,b(g(C)),1),"5"===g(r).formInfo.paymentFrequency?(y(),I("div",Ie," 共12期 ")):k("",!0)],64))]),g(L)?(y(),I("div",De,[P("div",Ve,[Pe,P("div",null,[P("span",null,b(g(E).premiumExplain||""),1),P("span",{class:"file-name",onClick:M},"《"+b(g(E).premiumExplainViewName||"")+"》",1)])])])):k("",!0)],64)):k("",!0)]),D(o)])),_:1})}}}),[["__scopeId","data-v-1defc39e"]]);export{ge as default};
