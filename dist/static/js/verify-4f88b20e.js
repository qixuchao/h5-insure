import{d as e,j as a,k as l,B as s,o as i,m as o,w as n,a as r,e as d,u,b as t,V as c,W as v,cj as m,ck as f,p,bm as h,cl as y,cm as g,aB as b,ao as S,cn as V,i as k,h as C,a6 as q,aj as j,O as w,c as x,f as I,F as $,a8 as _,co as L,bW as M,cp as O,cq as U,b_ as E,cr as P,cs as F,bx as N,ah as T,bt as R,T as D,aL as A,a9 as B,aa as H,bq as Y,ag as G}from"./index-2ddfdf05.js";import{P as W}from"./index-c09cd98d.js";import{n as z}from"./nextStep-5c47dedf.js";import{c as J}from"./format-666c4946.js";import{g as K,m as Q}from"./trial-2e4023be.js";import{p as Z}from"./utils-7b2611ba.js";import{u as X}from"./useOrder-5edab455.js";import{M as ee,P as ae,a as le,B as se}from"./constants-4b08cf92.js";import{d as ie,q as oe}from"./verify-0877903d.js";import"./core-65ff1a24.js";import"./utils-dc39ceda.js";import"./infoCollection-17bec859.js";import"./trial-97568174.js";const ne={class:"popup-container"},re={class:"popup-header"},de={class:"title"},ue={class:"popup-body"},te=e({name:"checkCodePopup"}),ce=e({...te,props:{show:{type:Boolean,default:!1},type:{default:"agent"},data:{default:()=>({})}},emits:["cancel","confirm"],setup(e,{emit:S}){const V=e,k=a(),C=l((()=>V.show)),q=a({mobile:"",verifyCode:""}),j=l((()=>V.type)),w=a({holder:{type:"投保人",name:"",mobile:"",desc:""},agent:{type:"代理人",name:"",mobile:"",desc:"色卡上会计核算看回放独守空房还是空巅峰计划收款方"},insured:{type:"被保人",name:"",mobile:"",desc:""}}),x=()=>{S("cancel")},I=()=>{k.value.validate().then((()=>{S("confirm")}))};return s([()=>V.data,V.type],(([e,a])=>{var l,s,i;e&&(Object.assign(w.value.holder,e.holder),Object.assign(w.value.insured,null==(l=null==e?void 0:e.insuredList)?void 0:l[0]),q.value.mobile=null==(i=null==(s=w.value)?void 0:s[V.type])?void 0:i.mobile)}),{immediate:!0,deep:!0}),(e,a)=>{const l=h,s=y,S=g,V=b;return i(),o(V,{show:u(C),"onUpdate:show":a[2]||(a[2]=e=>p(C)?C.value=e:null),class:"popup-check-mobile",closeable:!1,"close-on-click-overlay":!1},{default:n((()=>[r("div",ne,[r("div",re,[r("span",{class:"clear-all",onClick:x}," 取消 "),r("span",de,d(`${w.value[u(j)].type}手机号验证`),1),r("span",{class:"close",onClick:I},"确认")]),r("div",ue,[r("h3",null,d(`尊敬的${w.value[u(j)].type}:${w.value[u(j)].name}`),1),r("p",null,d(w.value[u(j)].desc),1),r("h3",null,d(`${w.value[u(j)].type}手机号验证 ${u(J)(w.value[u(j)].mobile||"")}`),1),t(S,{ref_key:"formRef",ref:k,"validate-method":"toast",model:q.value},{default:n((()=>[c(t(l,{modelValue:q.value.mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>q.value.mobile=e),label:"被保人手机号",name:"mobile",maxlength:"11",rules:[{required:!0,message:"请输入手机号"}]},null,8,["modelValue"]),[[v,!1]]),t(s,{modelValue:q.value.verifyCode,"onUpdate:modelValue":a[1]||(a[1]=e=>q.value.verifyCode=e),"related-name":"mobile",label:" ",maxlength:"6","input-align":"left",placeholder:"请输入验证码",name:"verifyCode",rules:[{required:!0,message:"请输入验证码"}],"send-s-m-s-code":u(m),"check-s-m-s-code":u(f)},null,8,["modelValue","send-s-m-s-code","check-s-m-s-code"])])),_:1},8,["model"])])])])),_:1},8,["show"])}}}),ve=S([{label:"签名完成",value:1},{label:"去签名",value:2},{label:"认证失败，请联系内勤人员",value:3}]),me=2,fe=S([{label:"去双录",value:1},{label:"双录完成",value:me},{label:"双录失败",value:3}]);const pe={class:"page-verify-wrap"},he={class:"sign-list"},ye={class:"inner-cell"},ge={class:"inner-cell"},be={class:"inner-cell"},Se={class:"inner-cell"},Ve={class:"footer-button"},ke=e({name:"verify"}),Ce=e({...ke,setup(e){const s=V(),d=k(),c=C(),{orderNo:v,tenantId:b}=d.query,S=a(!1),J=a(),ne=a(!1),re=a(),de=a({holderMobile:"",holderVerifyCode:"",insuredMobile:"",insuredVerifyCode:""}),ue=X(),te=a(!1),ke=a({sign:[],verify:[],scribing:""}),Ce=a(""),qe=a({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{},verifyStatus:2},agent:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2}}),je=a("agent"),we=l((()=>e=>ke.value.sign.includes(e)||ke.value.verify.includes(e))),xe=l((()=>qe.value.agent.verifyStatus!==q.YES)),Ie=l((()=>{const{insuredList:e}=ue.value||{},{age:a,relationToHolder:l}=e[0]||{};return!(a<18||`${l}`===j.CERT)})),$e=l((()=>e=>qe.value[e].isSign||qe.value[e].isVerify)),_e=l((()=>e=>qe.value[e].isShareSign)),Le=e=>{var a;const{holder:l,insured:s}=ue.value;let i={name:l.name,gender:`${L[l.gender]}士`};"insured"===e&&(i={name:null==s?void 0:s[0].name,gender:`${L[null==(a=null==s?void 0:s[0])?void 0:a.gender]}士`}),M({messageType:ee.HOLDER,orderNo:v,tenantId:b}),O({shareType:0,title:`${U.sign.title}（${E[e.toLocaleUpperCase()]}）`,desc:U.sign.desc.replace("{name}",`${i.name||""}${i.gender||""},代理人`),url:`${window.location.href}&objectType=${e}&nextPageCode=infoPreview`.replace("/verify","/phoneVerify"),imageUrl:"https://zatech-aquarius-v2-private-test.oss-cn-hangzhou.aliyuncs.com/lian_logo.png?OSSAccessKeyId=LTAI5t9uBW78vZ4sm5i3oQ5C&Expires=1697288114&Signature=S87PMeDRxltLovmmHVTeiHoew1c%3D"})},Me=e=>{je.value=e,"agent"!==e?xe.value||(te.value=!0):c.push({path:ae.agentSign,query:d.query})},Oe=()=>{xe.value||J.value===me||ie(ue.value).then((({code:e,data:a})=>{"10000"===e&&a&&Ce.value&&P(Ce).then((e=>{e.isInstall===q.YES&&F(Ce)}))}))},Ue=()=>{te.value=!1},Ee=()=>{let e="";e="agent"===je.value?ae.infoPreview:(je.value,qe.value[je.value].isVerify?ae.verifyFace:ae.infoPreview),s.set(`${N}_orderDetail`,ue.value),c.push({path:e,query:{...d.query,objectType:je.value,isFirst:1}})},Pe=async()=>{let e={};const a=T.get(`${N}_deviceInfo`);oe({orderNo:v,tenantId:b}).then((({code:e,data:l})=>{if("10000"===e){const{doubleRecordFlag:e,doubleRecordStatus:s}=l;S.value=e===q.YES,J.value=s,a&&(Ce.value=l.andUrl||"","iOS"===a.platform&&(Ce.value=l.iosUrl||""))}})),await K({orderNo:v,tenantId:b}).then((({code:a,data:l})=>{var s,i,o;if("10000"===a){Object.assign(ue.value,l);const{agentAuthFlag:a}=l.extInfo,{mobile:n}=l.holder,{mobile:r}=(null==(s=l.insuredList)?void 0:s[0])||{};Object.assign(de.value,{holderMobile:n,insuredMobile:r}),e=Z(l.insuredList[0].productList),qe.value.agent.verifyStatus=a,qe.value.holder.verifyStatus=l.holder.isCert,qe.value.insured.verifyStatus=null==(o=null==(i=l.insuredList)?void 0:i[0])?void 0:o.isCert}})),await Q(e).then((({data:e,code:a})=>{if("10000"===a){const{signInfo:a}=R(e.productFactor);a.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((a=>{e.required&&ke.value.sign.push(a.code),"1"===a.code?qe.value.agent.isSign=!0:"2"===a.code?qe.value.holder.isSign=!0:"3"===a.code?qe.value.insured.isSign=!0:"4"===a.code?qe.value.holder.isShareSign=!0:"5"===a.code&&(qe.value.insured.isShareSign=!0)})),"customerFace"===e.name&&e.columns.forEach((a=>{e.required&&ke.value.verify.push(a.code),"1"===a.code?qe.value.holder.isVerify=!0:"2"===a.code&&(qe.value.insured.isVerify=!0)}))}))}})),ne.value=!1},Fe=async()=>{var e;const{holder:a,insuredList:l,extInfo:s}=ue.value;if(S.value){if(s.agentAuthFlag!==q.YES)return void D("代理人签名未完成")}else{if(s.agentAuthFlag===q.NO)return void D("代理人签名未完成");if(a.isCert===q.NO)return void D("投保人签名未完成");if(l[0].isCert===q.NO)return void D("被保人签名未完成")}await(null==(e=re.value)?void 0:e.validate());const i=Object.assign(ue.value,{extInfo:{...ue.value.extInfo,pageCode:le.SIGN,buttonCode:se.SIGN}});z(i,((e,a)=>{a===A.JUMP_PAGE&&B(e.nextPageCode,d.query)}),d)};return w((()=>{Pe()})),(e,a)=>{const l=H,s=Y,d=W,c=G;return i(),x("div",pe,[t(l),t(d,{modelValue:u(ne),"onUpdate:modelValue":a[9]||(a[9]=e=>p(ne)?ne.value=e:null),onRefresh:Pe},{default:n((()=>[r("div",he,[u($e)("agent")?(i(),o(s,{key:0,title:"代理人签名",required:u(we)("agent")},{value:n((()=>[r("div",ye,[t(s,{"is-link":"",value:u(ve)[u(qe).agent.verifyStatus],onClick:a[0]||(a[0]=e=>Me("agent"))},null,8,["value"])])])),_:1},8,["required"])):I("",!0),u(S)?(i(),o(u(g),{key:2,ref_key:"formRef",ref:re,"validate-method":"toast",model:u(de)},{default:n((()=>[t(u(h),{modelValue:u(de).holderMobile,"onUpdate:modelValue":a[5]||(a[5]=e=>u(de).holderMobile=e),label:"投保人手机号",name:"holderMobile",maxlength:"11",required:"","is-view":""},null,8,["modelValue"]),t(u(y),{modelValue:u(de).holderVerifyCode,"onUpdate:modelValue":a[6]||(a[6]=e=>u(de).holderVerifyCode=e),"related-name":"holderMobile",label:"验证码",maxlength:"6",name:"holderVerifyCode","send-s-m-s-code":u(m),"check-s-m-s-code":u(f),required:""},null,8,["modelValue","send-s-m-s-code","check-s-m-s-code"]),u(Ie)?(i(),x($,{key:0},[t(u(h),{modelValue:u(de).insuredMobile,"onUpdate:modelValue":a[7]||(a[7]=e=>u(de).insuredMobile=e),label:"被保人手机号",name:"insuredMobile",maxlength:"11",required:"","is-view":""},null,8,["modelValue"]),t(u(y),{modelValue:u(de).insuredVerifyCode,"onUpdate:modelValue":a[8]||(a[8]=e=>u(de).insuredVerifyCode=e),label:"验证码",maxlength:"6",name:"insuredVerifyCode","related-name":"insuredMobile","send-s-m-s-code":u(m),"check-s-m-s-code":u(f),required:""},null,8,["modelValue","send-s-m-s-code","check-s-m-s-code"])],64)):I("",!0)])),_:1},8,["model"])):(i(),x($,{key:1},[u($e)("holder")?(i(),o(s,{key:0,title:"投保人签名",required:u(we)("holder")},{value:n((()=>[r("div",ge,[u(_e)("holder")?(i(),o(s,{key:0,"value-class":""+(u(xe)?"disable":""),"is-link":"",value:"分享空签邀约",onClick:a[1]||(a[1]=e=>Le("holder"))},null,8,["value-class"])):I("",!0),t(s,{"is-link":"",value:u(ve)[u(qe).holder.verifyStatus],"value-class":""+(u(xe)?"disable":""),onClick:a[2]||(a[2]=e=>Me("holder"))},null,8,["value","value-class"])])])),_:1},8,["required"])):I("",!0),u($e)("insured")&&u(Ie)?(i(),o(s,{key:1,title:"被保人签名",required:u(we)("insured")},{value:n((()=>[r("div",be,[u(_e)("insured")?(i(),o(s,{key:0,"value-class":""+(u(xe)?"disable":""),"is-link":"",value:"分享空签邀约",onClick:a[3]||(a[3]=e=>Le("insured"))},null,8,["value-class"])):I("",!0),t(s,{"is-link":"","value-class":""+(u(xe)?"disable":""),value:u(ve)[u(qe).insured.verifyStatus],onClick:a[4]||(a[4]=e=>Me("insured"))},null,8,["value-class","value"])])])),_:1},8,["required"])):I("",!0)],64)),u(S)?(i(),o(s,{key:3,title:"保单双录",required:""},{value:n((()=>[r("div",Se,[t(s,{"is-link":"","value-class":""+(u(xe)?"disable":""),value:u(fe)[u(J)],onClick:Oe},null,8,["value-class","value"])])])),_:1})):I("",!0)])])),_:1},8,["modelValue"]),r("div",Ve,[t(c,{type:"primary",onClick:Fe},{default:n((()=>[_("下一步")])),_:1})]),u(te)?(i(),o(ce,{key:0,type:u(je),show:u(te),data:u(ue),onCancel:Ue,onConfirm:Ee},null,8,["type","show","data"])):I("",!0)])}}});export{Ce as default};
