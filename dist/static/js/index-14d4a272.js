import{d as e,L as a,a1 as t,c as i,A as s,i as l,g as r,r as o,R as n,w as u,U as d,V as c,e as p,ag as m,f,j as v,E as k,as as h,at as V,h as y,a2 as I,G as O,aa as g,B as L,au as b,av as R,al as S,am as C,u as P,a as x,z as D,o as w,$ as T,k as _,aw as F,T as E,F as M,ax as j,ay as A,n as B,az as K,ak as N,C as $,P as q,p as U}from"./index-655f425b.js";import{l as z,P as H}from"./index-f4d83aba.js";import{_ as W}from"./TrialButton-6701fc8a.js";import{u as G,b as J,p as Q,q as X,a as Y}from"./trial-2de6224d.js";import{I as Z,P as ee}from"./index-2ccac246.js";import{P as ae,d as te}from"./index-077618d3.js";import{u as ie}from"./useOrder-2c54ca32.js";import{f as se}from"./utils-40fead7a.js";import{t as le}from"./utils-bc4d0c77.js";import{P as re,B as oe}from"./constants-7afb7c3d.js";import{n as ne}from"./nextStep-d9062bc0.js";import"./infoCollection-e004c5a6.js";import{P as ue}from"./index-413ac418.js";import{S as de,_ as ce}from"./box-title-8bf5c5cf.js";import{_ as pe}from"./index-b97e7ad0.js";import{T as me}from"./Table-8d86c818.js";import"./trial-a9922483.js";import"./core-05f5b046.js";const fe={class:"benefit-table"},ve=e({name:"benefitTable"}),ke=e({...ve,props:{dataSource:null},setup(e){const o=e,n=a((()=>{const e=o.dataSource.headers.length,a=12*o.dataSource.headers.join("").length+20*o.dataSource.headers.length;return o.dataSource.headers.map(((t,i)=>{const s=a>320?12*t.length+20:Math.max(12*t.length+20,320/e);return console.log("totalWordWidth:",a,"titleWidth:",s,"word-width:",12*t.length+20),{title:t,key:`header_${i}`,fixed:i<2,minWidth:s}}))})),u=a((()=>o.dataSource.dataList.map((e=>{const a={};return e.forEach(((e,t)=>{a[`header_${t}`]=e})),a}))));return t((()=>{})),(e,a)=>(i(),s("div",fe,[l(me,{"top-height":400,columns:r(n),data:r(u),"is-clone":!0},null,8,["columns","data"])]))}});const he=e=>(S("data-v-414a32d4"),e=e(),C(),e),Ve={key:0,class:"benefit-container"},ye={key:0,class:"benefit"},Ie=he((()=>f("div",{class:"line"},null,-1))),Oe={class:"box-title box-title-chart"},ge=he((()=>f("img",{class:"tl",src:ce,alt:""},null,-1))),Le=he((()=>f("img",{class:"transform-z180 tr",src:ce,alt:""},null,-1))),be={key:0},Re={class:"box"},Se={class:"box-title"},Ce=he((()=>f("img",{class:"tl",src:ce,alt:""},null,-1))),Pe=he((()=>f("img",{class:"transform-z180 tr",src:ce,alt:""},null,-1))),xe={class:"box-price"},De={class:"text1"},we={class:"text2"},Te={key:1},_e={key:2,style:{width:"100%, minWidth: 338px"}},Fe={class:"slider"},Ee={style:{flex:"1",margin:"0px 5px"}},Me={class:"custom-button"},je=he((()=>f("p",{class:"slider-dec"},"拖动按钮查看不同年龄保障",-1))),Ae={class:"btn-two"},Be={key:1,class:"benefit-container"},Ke={key:0},Ne={class:"benefit"},$e=he((()=>f("div",{class:"line"},null,-1))),qe=he((()=>f("div",null,[f("div",{class:"box"},[f("p",{class:"box-title"},[f("img",{class:"tl",src:ce,alt:""}),v(" 保单年度"),f("span",null,"-"),v("年度，被保人"),f("span",null,"-"),v("岁时 "),f("img",{class:"transform-z180 tr",src:ce,alt:""})]),f("div",{class:"box-price"})])],-1))),Ue={class:"slider"},ze={class:"opt lf"},He={style:{flex:"1",margin:"0px 5px"}},We=he((()=>f("div",{class:"custom-button"},"0 岁",-1))),Ge={class:"opt rg"},Je=he((()=>f("p",{class:"slider-dec"},"拖动按钮查看不同年龄保障",-1))),Qe={class:"btn-two"},Xe={key:1,class:"empty-box"},Ye=e({name:"benefit"});var Ze=O(e({...Ye,props:{dataSource:{default:()=>({showTypeList:["1"]})},productInfo:{default:()=>null}},setup(e){var a;const t=e,O="1",S="2",C="3",P=o(0),x=o(0),D=o(0),w=o(),T=o(0),_=o(null==(a=t.dataSource.showTypeList)?void 0:a[0]),F=o(),E=e=>{if(!(null==e?void 0:e.benefitRiskResultVOList))return;const a=null==e?void 0:e.benefitRiskResultVOList[P.value];x.value=a.ageBegin+1,T.value=a.ageBegin+1,D.value=a.ageEnd},M=()=>{var e,a,i,s,l,r;const o=null==(a=null==(e=t.dataSource)?void 0:e.benefitRiskResultVOList)?void 0:a[P.value];F.value=null==(l=null==(s=null==(i=t.dataSource)?void 0:i.benefitRiskResultVOList)?void 0:s[P.value].benefitRiskTableResultVOList)?void 0:l[0];const{a:n,year:u}=((e,a)=>{const t=[],i=[];for(let s=e,l=0;s<=a;s++,l++)t.push(s.toString()),i.push(l+1);return{a:t,year:i}})(x.value,D.value),d={index:n.indexOf(T.value.toString()),age:n,year:u,result:null==(r=null==o?void 0:o.benefitRiskItemResultVOList)?void 0:r[0]};w.value=d},j=()=>{T.value>D.value-1||(T.value+=1,M())},A=()=>{T.value>x.value&&(T.value-=1,M())},B=e=>{P.value=e.name,E(t.dataSource),M()};return n((()=>t.dataSource),(e=>{var a;e&&(E(e),M(),_.value=null==(a=e.showTypeList)?void 0:a[0])}),{deep:!0,immediate:!0}),n(T,(()=>{M()})),(a,o)=>{var n;const E=g,M=de,K=L,N=b,$=R,q=ue;return(null==(n=e.dataSource)?void 0:n.benefitRiskResultVOList)?(i(),s("div",Ve,[l($,{active:r(P),onClickTab:B},{default:u((()=>{var e;return[(i(!0),s(d,null,c(null==(e=t.dataSource)?void 0:e.benefitRiskResultVOList,((e,a)=>(i(),p(N,{key:a,name:a,title:e.riskName},{default:u((()=>{var e,n,g,L,b,R,B,N,$,q,U,z,H,W,G,J;return[a==r(P)?(i(),s("div",ye,[Ie,m(f("p",Oe,[ge,v(" 保单年度"),f("span",null,k(null==(g=null==(e=r(w))?void 0:e.year)?void 0:g[null==(n=r(w))?void 0:n.index]),1),v("年度，被保人"),f("span",null,k(null==(R=null==(L=r(w))?void 0:L.age)?void 0:R[null==(b=r(w))?void 0:b.index]),1),v("岁时 "),Le],512),[[h,r(_)===S]]),r(_)===O?(i(),s("div",be,[f("div",Re,[f("p",Se,[Ce,v(" 保单年度"),f("span",null,k(null==($=null==(B=r(w))?void 0:B.year)?void 0:$[null==(N=r(w))?void 0:N.index]),1),v("年度，被保人"),f("span",null,k(null==(z=null==(q=r(w))?void 0:q.age)?void 0:z[null==(U=r(w))?void 0:U.index]),1),v("岁时 "),Pe]),f("div",xe,[(i(!0),s(d,null,c(null==(W=null==(H=r(w))?void 0:H.result)?void 0:W.headers,((e,a)=>{var t,l,o,n,u,d,c,p,m,v;return i(),s("div",{key:a,style:{width:"33%"}},[f("p",De,k(("0"==(null==(u=null==(n=null==(l=null==(t=r(w))?void 0:t.result)?void 0:l.dataList)?void 0:n[null==(o=r(w))?void 0:o.index])?void 0:u[a])?"0":r(V)(Number(null==(v=null==(m=null==(c=null==(d=r(w))?void 0:d.result)?void 0:c.dataList)?void 0:m[null==(p=r(w))?void 0:p.index])?void 0:v[a])))||"0"),1),f("p",we,k(e)+"(元）",1)])})),128))])])])):y("",!0),r(_)===C?(i(),s("div",Te,[l(ke,{"data-source":r(F)},null,8,["data-source"])])):y("",!0),r(_)==S?(i(),s("div",_e,[l(pe,{min:r(x),max:r(D),current:r(T),data:null==(J=null==(G=r(w))?void 0:G.result)?void 0:J.benefitRiskItemList},null,8,["min","max","current","data"])])):y("",!0),r(_)!=C?(i(),s(d,{key:3},[f("div",Fe,[f("div",{class:"opt lf",onClick:A},[l(E,{name:"minus"})]),f("div",Ee,[r(x)?(i(),p(M,{key:0,modelValue:r(T),"onUpdate:modelValue":o[0]||(o[0]=e=>I(T)?T.value=e:null),min:r(x),max:r(D),"bar-height":"8px"},{button:u((()=>[f("div",Me,k(r(T))+" 岁",1)])),_:1},8,["modelValue","min","max"])):y("",!0)]),f("div",{class:"opt rg",onClick:j},[l(E,{name:"plus"})])]),je],64)):y("",!0),f("div",Ae,[t.dataSource.showTypeList.includes(O)?(i(),p(K,{key:0,round:"",plain:r(_)!==O,type:"primary",class:"btn",onClick:o[1]||(o[1]=e=>_.value=O)},{default:u((()=>[v("图表展示")])),_:1},8,["plain"])):y("",!0),t.dataSource.showTypeList.includes(S)?(i(),p(K,{key:1,round:"",plain:r(_)!==S,type:"primary",class:"btn",onClick:o[2]||(o[2]=e=>_.value=S)},{default:u((()=>[v("趋势展示")])),_:1},8,["plain"])):y("",!0),t.dataSource.showTypeList.includes(C)?(i(),p(K,{key:2,round:"",plain:r(_)!==C,type:"primary",class:"btn",onClick:o[3]||(o[3]=e=>_.value=C)},{default:u((()=>[v("表格展示")])),_:1},8,["plain"])):y("",!0)])])):y("",!0)]})),_:2},1032,["name","title"])))),128))]})),_:1},8,["active"])])):(i(),s("div",Be,[t.productInfo?(i(),s("div",Ke,[l($,{active:r(P),onClickTab:B},{default:u((()=>[(i(),p(N,{key:1,name:1,title:e.productInfo.insureProductRiskVOList[0].riskName},{default:u((()=>[f("div",Ne,[$e,qe,f("div",Ue,[f("div",ze,[l(E,{name:"minus"})]),f("div",He,[l(M,{modelValue:r(T),"onUpdate:modelValue":o[4]||(o[4]=e=>I(T)?T.value=e:null),min:0,max:80,"bar-height":"8px",disabled:""},{button:u((()=>[We])),_:1},8,["modelValue"])]),f("div",Ge,[l(E,{name:"plus"})])]),Je,f("div",Qe,[l(K,{round:"",plain:!0,type:"primary",class:"btn",disabled:""},{default:u((()=>[v("图表展示")])),_:1}),l(K,{round:"",plain:!1,type:"primary",class:"btn",disabled:""},{default:u((()=>[v("趋势展示")])),_:1}),l(K,{round:"",plain:!1,type:"primary",class:"btn",disabled:""},{default:u((()=>[v("表格展示")])),_:1})])])])),_:1},8,["title"]))])),_:1},8,["active"])])):(i(),s("div",Xe,[l(q,{title:"试算结果正在计算中...","empty-class":"empty-select"})]))]))}}}),[["__scopeId","data-v-414a32d4"]]);const ea={key:0,class:"head-warning-wrap"},aa=f("div",{class:"warning-icon"},[f("span",null,"!")],-1),ta={class:"warning-text"},ia=e({__name:"index",props:{labels:{default:()=>[]}},setup:e=>(a,t)=>e.labels.length>0?(i(),s("div",ea,[aa,f("div",ta,[(i(!0),s(d,null,c(e.labels,(e=>(i(),s("span",{key:e},k(e),1)))),128))])])):y("",!0)}),sa=(e,a,t)=>{var i,s,l,r;const o=e,{holder:n}=t,u=t.insuredVOList[0],d=(a||"").split("_");if(d.length<2)return a;if(z.exports.isNaN(Number(d[1])))return a;if(d[1]-=1,1===o.exemptFlag){if("to"===d[0]){let e=0;1===o.exemptType?(null==(i=null==n?void 0:n.personVO)?void 0:i.birthday)&&(e=parseInt(""+((new Date).getTime()-new Date(null==(s=n.personVO)?void 0:s.birthday).getTime())/31536e6,10)):2===o.exemptType&&(null==(l=null==u?void 0:u.personVO)?void 0:l.birthday)&&(e=parseInt(""+(+(new Date).getTime()-new Date(null==(r=u.personVO)?void 0:r.birthday).getTime())/31536e6,10)),d[1]=+d[1]-e}d[0]="year"}return d.join("_")},la=(e,a)=>{const t=[],i={};return null==e||e.forEach((e=>{i[e.riskId]=e})),null==a||a.forEach((e=>{var a,s,l,r;const{collocationType:o,collocationRiskId:n,riskId:u}=e;switch(o){case 2:{const e=null==(a=i[u])?void 0:a.riskName,l=null==(s=i[n])?void 0:s.riskName;t.push(`${e} 和 ${l} 必须同时投保`);break}case 3:{const e=null==(l=i[u])?void 0:l.riskName,a=null==(r=i[n])?void 0:r.riskName;t.push(`${e} 和 ${a} 不能同时投保`);break}}})),t};const ra={class:"com-body"},oa={class:"trial-body"},na={class:"container"},ua=(e=>(S("data-v-f007d852"),e=e(),C(),e))((()=>f("div",{class:"empty"},null,-1))),da=e({name:"TrialPop"});var ca=O(e({...da,props:{dataSource:{default:()=>[]},productInfo:{default:()=>({productCode:"",productName:"",insurerCode:"",tenantId:""})},tenantProductDetail:{default:()=>({})},hideBenefit:{type:Boolean,default:!1},hidePopupButton:{type:Boolean,default:!1},title:{default:"算一算保费"},defaultData:{default:null}},emits:["trialStart","trialEnd"],setup(e,{expose:a,emit:u}){const d=e,c=o(null),m=P();x(),m.query;const v=D({loading:!1,show:!1,select:{},list:[],userData:{},riskIsInsure:{},submitData:{},riskVOList:[{}],mainRiskVO:{},ifPersonalInfoSuccess:!1,trialMsg:"",trialResultPremium:0,trialResult:{premium:0,amount:0},isAniShow:!1,defaultValue:null,isAutoChange:!1,planIndex:0,isSkipFirstTrial:!1,hadSkipFirstTrial:!1});ie(),o(),o();const k=e=>{const{holder:a,insuredVOList:t}=e||{};a&&(v.submitData.holder=a),t&&t.length>0&&t.forEach(((e,a)=>{var t;v.submitData.insuredVOList&&v.submitData.insuredVOList.length>a?v.submitData.insuredVOList[a].personVO={...e.personVO,socialFlag:e.personVO.hasSocialInsurance}:((null==(t=v.submitData)?void 0:t.insuredVOList)||(v.submitData.insuredVOList=[]),v.submitData.insuredVOList.push({personVO:{...e.personVO,socialFlag:e.personVO.hasSocialInsurance}}))}))},h=o(),V=o({}),I=["annuityDrawDate","coveragePeriod","chargePeriod"],O=e=>{var a,t,i,s,l,r;if(null==(t=null==(a=null==e?void 0:e.data)?void 0:a[0])?void 0:t.productRiskDyInsureFactorVOList){const a=[];if(null==(i=d.dataSource)||i.insureProductRiskVOList.forEach((t=>{var i,s;const l=null==(s=null==(i=null==e?void 0:e.data)?void 0:i[0])?void 0:s.productRiskDyInsureFactorVOList.find((e=>e.riskCode===t.riskCode));if(l){t.productRiskInsureLimitVO={...t.productRiskInsureLimitVO,...l};const e=v.riskVOList.find((e=>e.riskCode===t.riskCode));let i=!1;ee.forEach((a=>{if(I.indexOf(a.valueKey)>=0){const s=t.productRiskInsureLimitVO[a.configKey];if(s&&e){const t=s.find((t=>t.code===e[a.valueKey]));if(t&&2===t.useFlag){const t=s.find((e=>1===e.defaultFlag));e[a.valueKey]=t.code,i=!0}}}})),i&&a.push({...e,...l,riskCode:t.riskCode})}})),a.length>0&&(null==(r=null==(l=null==(s=v.defaultValue)?void 0:s.insuredVOList)?void 0:l[0])?void 0:r.productPlanVOList))return a.forEach((e=>{var a,t,i;v.defaultValue.insuredVOList[0].productPlanVOList=null==(i=null==(t=null==(a=v.defaultValue)?void 0:a.insuredVOList)?void 0:t[0])?void 0:i.productPlanVOList.map((a=>(a.riskVOList=null==a?void 0:a.riskVOList.map((a=>(a.riskCode===e.riskCode&&(a=e),a))),a)))})),!1}return!0},g=async(e,a=!0)=>{v.trialMsg="试算中...",v.trialResultPremium=0,v.loading=!0,u("trialStart");let t=!1;if(a){const{code:a}=await G(e);t="10000"===a}!t&&a||(d.hideBenefit||J(e).then((e=>{e.data&&e.code===F&&(V.value=e.data)})).finally((()=>{v.loading=!1})),Q(e).then((e=>{var a,t;if(e.data&&e.code===F){(null==(a=null==e?void 0:e.data)?void 0:a.errorInfo)&&E(`${null==(t=null==e?void 0:e.data)?void 0:t.errorInfo}`),v.trialMsg="",v.trialResultPremium=e.data.premium,v.trialResult=e.data;const i={};e.data.riskPremiumDetailVOList&&e.data.riskPremiumDetailVOList.length&&e.data.riskPremiumDetailVOList.forEach((e=>{i[e.riskCode]={premium:e.premium,amount:e.amount}})),h.value=i,u("trialEnd",e.data)}})).finally((()=>{v.loading=!1})))},L=z.exports.debounce((async()=>{if(console.log(">>>>>调用试算<<<<<"),v.ifPersonalInfoSuccess){if(v.submitData.productCode=d.productInfo.productCode,v.submitData.tenantId=d.productInfo.tenantId,v.riskVOList=v.riskVOList.map((e=>(e=>{var a,t,i,s;const l=null==(a=d.dataSource.insureProductRiskVOList)?void 0:a.find((a=>e.riskId===a.riskId));if(l&&1!==l.mainRiskFlag){const a=null==(i=null==(t=d.dataSource)?void 0:t.productRiskRelationVOList)?void 0:i.find((e=>e.collocationRiskId===l.riskId));if(a){const t=null==(s=v.riskVOList)?void 0:s.find((e=>e.riskId===a.riskId));ee.forEach((a=>{a.ruleKey&&l.productRiskInsureLimitVO&&t&&(1===l.productRiskInsureLimitVO[a.ruleKey]&&(e[a.valueKey]=t[a.valueKey]),3===l.productRiskInsureLimitVO[a.ruleKey]&&(1!==l.exemptFlag?e[a.valueKey]=sa(l,t[a.valueKey],v.submitData):e[a.valueKey]=sa(l,t[a.ruleValueKey],v.submitData)))}))}}return e})(e))),v.submitData.insuredVOList&&v.submitData.insuredVOList.forEach((e=>{e.productPlanVOList=[{insurerCode:d.productInfo.insurerCode,planCode:d.dataSource.planCode,riskVOList:v.riskVOList}]})),v.isSkipFirstTrial&&!v.hadSkipFirstTrial)return void(v.hadSkipFirstTrial=!0);console.log(">>>数据构建<<<",v.submitData);const e=z.exports.cloneDeep(v.submitData);await g(e)}}),300),b=async e=>{var a;const{insuredVOList:t,isFirstInsuredChange:i}=e;if(k(e),v.ifPersonalInfoSuccess=!0,i){console.log("处理第一被保人修改的dy变化");const e=await X({calcProductFactorList:[{planCode:d.dataSource.planCode,productCode:d.productInfo.productCode,riskEditVOList:[{insureProductRiskVO:null==(a=d.dataSource.insureProductRiskVOList)?void 0:a[0]}]}],...t[0].personVO});if(!O(e))return}console.log("投被保人的信息回传 ",v.submitData,e),L()},R=async(e,a)=>{var t,i,s,l;if(a){const r=z.exports.cloneDeep(e);delete r.insurancePeriodValueList,delete r.paymentFrequencyList,delete r.paymentPeriodValueList;if(I.indexOf(a.key)>=0){const o={};switch(a.key){case"annuityDrawDate":o.changeType=3;break;case"coveragePeriod":o.changeType=2;break;case"chargePeriod":o.changeType=1}const n=null==(i=null==(t=v.submitData)?void 0:t.insuredVOList)?void 0:i[0].personVO,u=null==(l=null==(s=d.dataSource)?void 0:s.insureProductRiskVOList)?void 0:l.find((a=>a.riskCode===e.riskCode));if(!v.isAutoChange){const a=await X({calcProductFactorList:[{planCode:d.dataSource.planCode,productCode:d.productInfo.productCode,riskEditVOList:[{insureProductRiskVO:u,insureRiskEditReqVO:{riskId:e.riskId,riskCode:e.riskCode,...r,...o}}]}],...n}),t=O(a);return t||(v.isAutoChange=!0),t}v.isAutoChange=!1}}return!0},S=async(e,a)=>{v.mainRiskVO=e;await R(e,a)&&(v.riskVOList.length>0&&(v.riskVOList[0]=e),console.log("标准险种的信息回传",e),L())},C=async(e,a)=>{if(v.riskVOList=[v.mainRiskVO,...e],console.log("附加险列表数据回传",e),a){const t=e.find((e=>e.riskCode===a.riskCode));if(!(await R(t,a)))return}L()},M=e=>{v.userData=e,v.defaultValue=e;const a=e.insuredVOList[0].productPlanVOList.findIndex((e=>e.planCode===d.dataSource.planCode));v.planIndex=-1===a?0:a,g(e,!0)};return w((()=>{var e,a;v.select={},v.list=[],v.userData={},v.riskIsInsure={},v.submitData={},v.riskVOList=[{}],v.mainRiskVO={},v.ifPersonalInfoSuccess=!1,v.trialMsg="",v.trialResultPremium=0,v.riskIsInsure={},null==(a=null==(e=null==d?void 0:d.dataSource)?void 0:e.insureProductRiskVOList)||a.forEach((e=>{var a;const t=null==(a=d.dataSource.productRiskRelationVOList)?void 0:a.find((a=>a.collocationRiskId===e.riskId));t&&(v.riskIsInsure[e.riskCode]={selected:"2",data:null,relation:t})}))})),t((()=>{v.loading=!0,v.show=!0,v.isAniShow=!0,v.isSkipFirstTrial=!0,v.hadSkipFirstTrial=!1,T((()=>{(async e=>{var a;if(d.defaultData){const e=d.defaultData.find((e=>e.productCode===d.productInfo.productCode))||d.defaultData[0];M(e),k(null==(a=d.defaultData)?void 0:a[0])}else{const e=await Y({calcProductFactorList:[{planCode:d.dataSource.planCode,productCode:d.productInfo.productCode}]});if(e.data){const a=e.data.find((e=>e.productCode===d.productInfo.productCode))||e.data[0];M(a)}}})()}))})),a({getTrialSuccessFlag:()=>v.trialResultPremium>0}),n((()=>v.riskIsInsure),(e=>{}),{deep:!0,immediate:!0}),(a,t)=>{var o,n,u,d,m,k;return i(),s("div",ra,[_(a.$slots,"trialHead",{},void 0,!0),f("div",oa,[l(ia,{labels:r(la)(e.dataSource.insureProductRiskVOList,e.dataSource.productRiskRelationVOList)},null,8,["labels"]),f("div",na,[e.hideBenefit?y("",!0):(i(),p(Ze,{key:0,class:"benefit-wrap","data-source":V.value,"product-info":e.dataSource,"show-type-list":V.value.showTypList},null,8,["data-source","product-info","show-type-list"])),e.dataSource.productFactor?(i(),p(r(H),{key:1,ref:"personalInfoRef",modelValue:r(v).userData,"onUpdate:modelValue":t[0]||(t[0]=e=>r(v).userData=e),"is-trial":"","product-factor":e.dataSource.productFactor,"multi-insured-config":null==(o=e.dataSource)?void 0:o.multiInsuredConfigVO,onTrailChange:b},null,8,["modelValue","product-factor","multi-insured-config"])):y("",!0),l(Z,{ref_key:"insureInfosRef",ref:c,"origin-data":null==(n=e.dataSource.insureProductRiskVOList)?void 0:n[0],"product-factor":e.dataSource.productFactor,"default-value":r(v).defaultValue?null==(d=null==(u=r(v).defaultValue)?void 0:u.insuredVOList[0].productPlanVOList[r(v).planIndex])?void 0:d.riskVOList[0]:null,"trial-result":r(v).trialResult,onTrialChange:S},null,8,["origin-data","product-factor","default-value","trial-result"]),l(ae,{"data-source":e.dataSource,"show-main-risk":!1,"default-value":r(v).defaultValue?null==(k=null==(m=r(v).defaultValue)?void 0:m.insuredVOList[0].productPlanVOList[r(v).planIndex])?void 0:k.riskVOList:[],onTrialChange:C},null,8,["data-source","default-value"]),ua])]),_(a.$slots,"trialBtn",{trialData:r(v).submitData,riskPremium:h.value},void 0,!0)])}}}),[["__scopeId","data-v-f007d852"]]);const pa={class:"header"},ma={class:"header-title"},fa=e({name:"TrialPop"});var va=O(e({...fa,props:{dataSource:{default:()=>[]},productInfo:{default:()=>({productCode:"",productName:"",insurerCode:"",tenantId:""})},shareInfo:{default:()=>({})},tenantProductDetail:{default:()=>({})},hideBenefit:{type:Boolean,default:!1},hidePopupButton:{type:Boolean,default:!1},title:{default:"算一算保费"},defaultData:{default:null}},setup(e,{expose:a}){const c=e,m="试算中...",h=o(null),V=P();x();const{tenantId:I,templateId:O,preview:g}=V.query,L=D({loading:!1,show:!1,select:{},list:[],userData:{},riskIsInsure:{},submitData:{},riskVOList:[{}],mainRiskVO:{},ifPersonalInfoSuccess:!1,trialMsg:"",trialResultPremium:0,trialResult:{premium:0,amount:0},isAniShow:!1,defaultValue:null,isAutoChange:!1,planIndex:0,isSkipFirstTrial:!1,hadSkipFirstTrial:!1}),b=ie(),R=o(),S=o(),C=(e={},a={},t={})=>{var i;const s={...t},{tenantOrderHolder:l,tenantOrderInsuredList:r}=se({holder:null==(i=L.submitData.holder)?void 0:i.personVO,insuredList:(L.submitData.insuredVOList||[]).map((e=>e.personVO))}),o=L.submitData.insuredVOList.map((e=>{var a,t;return null==(t=null==(a=e.productPlanVOList)?void 0:a[0])?void 0:t.riskVOList})).flat(),n={tenantId:I,riskList:o,riskPremium:a,productId:e.id};return s.extInfo.iseeBizNo=R.value,s.productCode=e.productCode,s.commencementTime=s.insuranceStartDate,s.expiryDate=s.insuranceEndDate,s.premium=L.trialResultPremium,s.orderAmount=L.trialResultPremium,s.orderRealAmount=L.trialResultPremium,s.tenantOrderHolder=l,s.tenantOrderInsuredList=r.map((a=>({...a,certType:a.certType||$.CERT,certNo:(a.certNo||"").toLocaleUpperCase(),planCode:c.dataSource.planCode,tenantOrderProductList:[{premium:L.trialResultPremium,productCode:e.productCode,productName:e.productName,planCode:c.dataSource.planCode,tenantOrderRiskList:le(n)}]}))),console.log("nextStepParams",s),s},T=o(),H=()=>{var e;g?B(re.TRIAL_PREMIUM,V.query):L.trialResultPremium&&(null==(e=h.value)||e.validate().then((()=>{Object.assign(b.value,{extInfo:{...b.value.extInfo,buttonCode:oe.TRIAL_PREMIUM,pageCode:re.TRIAL_PREMIUM,templateId:O}});const e=C(c.productInfo,T.value,b.value);ne(e,((e,a)=>{a===q.JUMP_PAGE&&U(e.nextPageCode,{...V.query,orderNo:e.orderNo})})),console.log("---- validate success ----")})),L.loading=!1,L.show=!0,L.isAniShow=!0)},X=e=>{var a;L.trialResultPremium&&(null==(a=h.value)||a.validate().then((()=>{Object.assign(b.value,{extInfo:{...b.value.extInfo,buttonCode:oe.TRIAL_PREMIUM,pageCode:re.TRIAL_PREMIUM,templateId:O}});const a=C(c.productInfo,T.value,b.value);ne(a,((a,t)=>{t===q.JUMP_PAGE&&(S.value.link=`${window.location.href}&isShare=1&orderNo=${a.orderNo}`,e())})),console.log("---- validate success ----")})))},Y=()=>{console.log("---close"),L.show=!1,L.loading=!1},Z=o({}),ae=()=>{var e,a;L.riskIsInsure={},null==(a=null==(e=null==c?void 0:c.dataSource)?void 0:e.insureProductRiskVOList)||a.forEach((e=>{var a;const t=null==(a=c.dataSource.productRiskRelationVOList)?void 0:a.find((a=>a.collocationRiskId===e.riskId));t&&(L.riskIsInsure[e.riskCode]={selected:"2",data:null,relation:t})}))};z.exports.debounce((async()=>{if(console.log(">>>>>调用试算<<<<<"),L.ifPersonalInfoSuccess){if(L.submitData.productCode=c.productInfo.productCode,L.submitData.tenantId=c.productInfo.tenantId,L.riskVOList=L.riskVOList.map((e=>(e=>{var a,t,i,s;const l=null==(a=c.dataSource.insureProductRiskVOList)?void 0:a.find((a=>e.riskId===a.riskId));if(l&&1!==l.mainRiskFlag){const a=null==(i=null==(t=c.dataSource)?void 0:t.productRiskRelationVOList)?void 0:i.find((e=>e.collocationRiskId===l.riskId));if(a){const t=null==(s=L.riskVOList)?void 0:s.find((e=>e.riskId===a.riskId));ee.forEach((a=>{a.ruleKey&&l.productRiskInsureLimitVO&&t&&(1===l.productRiskInsureLimitVO[a.ruleKey]&&(e[a.valueKey]=t[a.valueKey]),3===l.productRiskInsureLimitVO[a.ruleKey]&&(1!==l.exemptFlag?e[a.valueKey]=te(l,t[a.valueKey],L.submitData):e[a.valueKey]=te(l,t[a.ruleValueKey],L.submitData)))}))}}return e})(e))),L.submitData.insuredVOList&&L.submitData.insuredVOList.forEach((e=>{e.productPlanVOList=[{insurerCode:c.productInfo.insurerCode,planCode:c.dataSource.planCode,riskVOList:L.riskVOList}]})),L.isSkipFirstTrial&&!L.hadSkipFirstTrial)return void(L.hadSkipFirstTrial=!0);console.log(">>>数据构建<<<",L.submitData);const e=z.exports.cloneDeep(L.submitData);await(async(e,a=!0)=>{L.trialMsg=m,L.trialResultPremium=0,L.loading=!0;let t=!1;if(a){const{code:a}=await G(e);t="10000"===a}!t&&a||(c.hideBenefit||J(e).then((e=>{e.data&&e.code===F&&(Z.value=e.data)})).finally((()=>{L.loading=!1})),Q(e).then((e=>{var a,t;if(e.data&&e.code===F){(null==(a=null==e?void 0:e.data)?void 0:a.errorInfo)&&E(`${null==(t=null==e?void 0:e.data)?void 0:t.errorInfo}`),L.trialMsg="",L.trialResultPremium=e.data.premium,L.trialResult=e.data;const i={};e.data.riskPremiumDetailVOList&&e.data.riskPremiumDetailVOList.length&&e.data.riskPremiumDetailVOList.forEach((e=>{i[e.riskCode]={premium:e.premium,amount:e.amount}})),T.value=i}})).finally((()=>{L.loading=!1})))})(e)}}),300);const ue=()=>{L.isAniShow=!1},de=()=>{L.trialMsg=m,L.trialResultPremium=0,L.loading=!0},ce=e=>{L.trialMsg="",L.trialResultPremium=e.premium,L.trialResult=e,L.loading=!1};w((()=>{ae()})),t((()=>{L.loading=!0})),n((()=>L.show),(e=>{e&&(L.select={},L.list=[],L.userData={},L.riskIsInsure={},L.submitData={},L.riskVOList=[{}],L.mainRiskVO={},L.ifPersonalInfoSuccess=!1,L.trialMsg="",L.trialResultPremium=0,ae())}));const pe=()=>{L.show=!0,L.isAniShow=!0,L.isSkipFirstTrial=!0,L.hadSkipFirstTrial=!1};return a({open:pe,close:Y,getTrialSuccessFlag:()=>L.trialResultPremium>0}),n((()=>L.riskIsInsure),(e=>{}),{deep:!0,immediate:!0}),n((()=>c.shareInfo),(()=>{S.value=c.shareInfo}),{deep:!0,immediate:!0}),(a,t)=>{const o=K,n=N;return i(),s(d,null,[e.hidePopupButton?y("",!0):(i(),s("div",{key:0,class:M(`trial-button ${a.$attrs.class}`)},[l(W,{"is-share":S.value.isShare,premium:r(L).trialResultPremium,"share-info":S.value,"loading-text":r(L).trialMsg,"plan-code":c.dataSource.planCode,"payment-frequency":r(L).mainRiskVO.paymentFrequency+"","tenant-product-detail":e.tenantProductDetail,onHandleClick:pe},{default:u((()=>[v("立即投保")])),_:1},8,["is-share","premium","share-info","loading-text","plan-code","payment-frequency","tenant-product-detail"])],2)),r(L).isAniShow||r(L).show?(i(),p(n,{key:1,class:M(`com-trial-wrap ${a.$attrs.class}`),show:r(L).show,closeable:!1,onClose:Y,onClosed:ue},{default:u((()=>[l(ca,{"data-source":e.dataSource,"share-info":e.shareInfo,"product-info":e.productInfo,"tenant-product-detail":e.tenantProductDetail,"hide-benefit":e.hideBenefit,"default-data":e.defaultData,onTrialStart:de,onTrialEnd:ce},{trialHead:u((()=>[f("div",pa,[f("span",ma,k(e.title),1),l(o,{name:"cross",onClick:t[0]||(t[0]=e=>r(L).show=!1)})])])),trialBtn:u((t=>[_(a.$slots,"trialBtn",j(A(t)),(()=>[l(W,{"is-share":S.value.isShare,premium:r(L).trialResultPremium,"share-info":S.value,"loading-text":r(L).trialMsg,"plan-code":c.dataSource.planCode,"payment-frequency":r(L).mainRiskVO.paymentFrequency+"","tenant-product-detail":e.tenantProductDetail,"handle-share":X,onHandleClick:H},{default:u((()=>[v("立即投保")])),_:1},8,["is-share","premium","share-info","loading-text","plan-code","payment-frequency","tenant-product-detail"])]),!0)])),_:3},8,["data-source","share-info","product-info","tenant-product-detail","hide-benefit","default-data"])])),_:3},8,["class","show"])):y("",!0)],64)}}}),[["__scopeId","data-v-65a6c8be"]]);export{va as T};
