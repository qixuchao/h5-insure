import{aT as a,cz as e,d as t,a4 as i,a5 as r,i as l,h as s,g as n,r as o,ax as u,av as d,O as c,z as m,o as p,c as f,p as h,b as v,w as k,a8 as y,u as I,q as g,l as P,a as b,e as D,f as S,cA as O,cB as R,F as L,ay as V,T as w,bh as C,ab as T,as as _}from"./index-0bb786f6.js";import{c as F}from"./cloneDeep-bbb87a92.js";import{_ as x}from"./TrialButton-118c5199.js";import{u as j,b as B,j as q}from"./trial-07cd8d4e.js";import{P as A}from"./config-98e8d477.js";import{u as M}from"./useOrder-cb44d726.js";function K(t){return function(t){return"number"==typeof t||a(t)&&"[object Number]"==e(t)}(t)&&t!=+t}const E=(a,e,t)=>{const i=a,{holder:r}=t,l=t.insuredList[0],s=(e||"").split("_");if(s.length<2)return e;if(K(Number(s[1])))return e;if(s[1]-=1,1===i.exemptFlag){if("to"===s[0]){let a=0;1===i.exemptType?(null==r?void 0:r.birthday)&&(a=parseInt(""+((new Date).getTime()-new Date(r.birthday).getTime())/31536e6,10)):2===i.exemptType&&(null==l?void 0:l.birthday)&&(a=parseInt(""+(+(new Date).getTime()-new Date(l.birthday).getTime())/31536e6,10)),s[1]=+s[1]-a}s[0]="year"}return s.join("_")};const $={class:"trial-wrap"},H={class:"pop-header"},N={class:"header-title"},z=t({name:"TrialPop"}),U=t({...z,props:{dataSource:{default:()=>[]},productInfo:{default:()=>({productCode:"",productName:"",insurerCode:"",tenantId:"",planList:[]})},shareInfo:{default:()=>({})},tenantProductDetail:{default:()=>({})},hideBenefit:{type:Boolean,default:!1},hidePopupButton:{type:Boolean,default:!1},title:{default:"算一算保费"},defaultData:{default:null},currentOrderDetail:{default:null}},setup(a,{expose:e}){const t=a,K=i((()=>r((()=>import("./index-2a0450c9.js")),["static/js/index-2a0450c9.js","static/css/index-161c448c.css","static/js/index-0bb786f6.js","static/css/index-2278f771.css","static/js/cloneDeep-bbb87a92.js","static/js/index-0db73c5f.js","static/css/index-30776b7a.css","static/js/get-575805a5.js","static/css/get-539f9e39.css","static/js/infoCollection-2c314413.js","static/js/index-7203eb57.js","static/css/index-f7532773.css","static/js/empth-c0adfdba.js","static/js/PayInfo-15e83218.js","static/js/bankCard-978540a1.js","static/js/trial-07cd8d4e.js","static/js/search-cc26e254.js","static/css/search-bc6440c8.css","static/js/config-98e8d477.js","static/js/product-585b0e6f.js","static/js/index-de590a0b.js","static/js/index-9ba0265b.js","static/css/index-f3b4b476.css","static/js/empty-ae586b6c.js","static/js/index-d9c1ecaa.js","static/css/index-08db7891.css","static/js/box-title-70dc1627.js","static/js/index-4d41223f.js","static/js/trial-1eefae76.js","static/js/constants-3a57ba7c.js","static/css/constants-f61ff7a3.css","static/js/useOrder-cb44d726.js","static/js/utils-d0efec6b.js","static/js/createProposal-2914cbe0.js","static/js/nextStep-eef5b5e2.js","static/js/core-938079de.js","static/js/constant-8927d485.js","static/js/TrialButton-118c5199.js","static/css/TrialButton-dea42d8e.css","static/js/index-1e7fb083.js","static/css/index-bbfdd7ec.css"]))),z="试算中...",U=l(null),G=s();n(),G.query;const J=o({loading:!1,show:!1,select:{},list:[],userData:{},riskIsInsure:{},submitData:{},riskVOList:[{}],mainRiskVO:{},ifPersonalInfoSuccess:!1,trialMsg:"",trialResultPremium:0,trialResult:{initialPremium:0,initialAmount:0},isAniShow:!1,defaultValue:null,isAutoChange:!1,planIndex:0,isSkipFirstTrial:!1,hadSkipFirstTrial:!1}),Q=l(),W=M();l();const X=l(),Y=l(),Z=()=>{console.log("---close"),J.show=!1,J.loading=!1},aa=l({}),ea=()=>{var a,e;J.riskIsInsure={},null==(e=null==(a=null==t?void 0:t.dataSource)?void 0:a.insureProductRiskVOList)||e.forEach((a=>{var e;const i=null==(e=t.dataSource.productRiskRelationVOList)?void 0:e.find((e=>e.collocationRiskId===a.riskId));i&&(J.riskIsInsure[a.riskCode]={selected:"2",data:null,relation:i})}))};u((async()=>{if(console.log(">>>>>调用试算<<<<<"),J.ifPersonalInfoSuccess){if(J.submitData.productCode=t.productInfo.productCode,J.submitData.tenantId=t.productInfo.tenantId,J.riskVOList=J.riskVOList.map((a=>(a=>{var e,i,r,l;const s=null==(e=t.dataSource.insureProductRiskVOList)?void 0:e.find((e=>a.riskId===e.riskId));if(s&&1!==s.mainRiskFlag){const e=null==(r=null==(i=t.dataSource)?void 0:i.productRiskRelationVOList)?void 0:r.find((a=>a.collocationRiskId===s.riskId));if(e){const t=null==(l=J.riskVOList)?void 0:l.find((a=>a.riskId===e.riskId));A.forEach((e=>{e.ruleKey&&s.productRiskInsureLimitVO&&t&&(1===s.productRiskInsureLimitVO[e.ruleKey]&&(a[e.valueKey]=t[e.valueKey]),3===s.productRiskInsureLimitVO[e.ruleKey]&&(1!==s.exemptFlag?a[e.valueKey]=E(s,t[e.valueKey],J.submitData):a[e.valueKey]=E(s,t[e.ruleValueKey],J.submitData)))}))}}return a})(a))),J.submitData.insuredVOList&&J.submitData.insuredVOList.forEach((a=>{a.productPlanVOList=[{insurerCode:t.productInfo.insurerCode,planCode:t.dataSource.planCode,riskVOList:J.riskVOList}]})),J.isSkipFirstTrial&&!J.hadSkipFirstTrial)return void(J.hadSkipFirstTrial=!0);console.log(">>>数据构建<<<",J.submitData);const a=F(J.submitData);await(async(a,e=!0)=>{J.trialMsg=z,J.trialResultPremium=0,J.loading=!0;let i=!1;if(e){const{code:e}=await j(a);i="10000"===e}!i&&e||(t.hideBenefit||B(a).then((a=>{a.data&&a.code===V&&(aa.value=a.data)})).finally((()=>{J.loading=!1})),q(a).then((a=>{var e,t;if(a.data&&a.code===V){(null==(e=null==a?void 0:a.data)?void 0:e.errorInfo)&&w(`${null==(t=null==a?void 0:a.data)?void 0:t.errorInfo}`),J.trialMsg="",J.trialResultPremium=a.data.initialPremium,J.trialResult=a.data;const i={};a.data.riskPremiumDetailVOList&&a.data.riskPremiumDetailVOList.length&&a.data.riskPremiumDetailVOList.forEach((a=>{i[a.riskCode]={initialPremium:a.initialPremium,initialAmount:a.initialAmount}})),Y.value=i}})).finally((()=>{J.loading=!1})))})(a)}}),300);const ta=()=>{J.isAniShow=!1},ia=()=>{J.trialMsg=z,J.trialResultPremium=0,J.loading=!0},ra=a=>{J.trialMsg="",J.trialResultPremium=a.initialPremium,J.trialResult=a,J.loading=!1};d((()=>{ea()})),c((()=>{J.loading=!0})),m((()=>t.currentOrderDetail),(a=>{Q.value=a||W.value}),{deep:!0,immediate:!0});const la=l();m((()=>t.tenantProductDetail),(()=>{var a,e,i;const r=((null==(a=null==t?void 0:t.tenantProductDetail)?void 0:a.PREMIUM)||[]).find((a=>{var e;return!a.planCode||a.planCode===(null==(e=null==t?void 0:t.dataSource)?void 0:e.planCode)}))||{};la.value=null==(i=null==(e=(r.data||[]).sort(((a,e)=>+e.paymentFrequency-+a.paymentFrequency)))?void 0:e[0])?void 0:i.paymentFrequency}),{deep:!0,immediate:!0}),m((()=>J.show),(a=>{a&&(J.select={},J.list=[],J.userData={},J.riskIsInsure={},J.submitData={},J.riskVOList=[{}],J.mainRiskVO={},J.ifPersonalInfoSuccess=!1,J.trialMsg="",J.trialResultPremium=0,ea())}));const sa=()=>{J.show=!0,J.isAniShow=!0,J.isSkipFirstTrial=!0,J.hadSkipFirstTrial=!1};return e({open:sa,close:Z,getTrialSuccessFlag:()=>J.trialResultPremium>0}),m((()=>t.shareInfo),(()=>{X.value=t.shareInfo}),{deep:!0,immediate:!0}),(a,e)=>{const i=C,r=T,l=_;return p(),f(L,null,[a.hidePopupButton?g("",!0):(p(),f("div",{key:0,class:h(`trial-button ${a.$attrs.class}`)},[v(x,{"is-share":X.value.isShare,premium:I(J).trialResultPremium,"share-info":X.value,"loading-text":"","plan-code":t.dataSource.planCode,"payment-frequency":la.value,"tenant-product-detail":a.tenantProductDetail,onHandleClick:sa},{default:k((()=>[y("立即投保")])),_:1},8,["is-share","premium","share-info","plan-code","payment-frequency","tenant-product-detail"])],2)),I(J).isAniShow||I(J).show?(p(),P(l,{key:1,class:h(`com-trial-wrap ${a.$attrs.class}`),show:I(J).show,closeable:!1,onClose:Z,onClosed:ta},{default:k((()=>[v(r,null,{default:k((()=>[b("div",$,[v(I(K),{ref_key:"insureInfosRef",ref:U,"data-source":a.dataSource,"share-info":a.shareInfo,"is-trial":"","product-info":a.productInfo,"tenant-product-detail":a.tenantProductDetail,"hide-benefit":a.hideBenefit,"default-data":a.defaultData,"default-order":Q.value,onTrialStart:ia,onTrialEnd:ra},{trialHead:k((()=>[b("div",H,[b("span",N,D(a.title),1),v(i,{name:"cross",onClick:e[0]||(e[0]=a=>I(J).show=!1)})])])),trialBtn:k((e=>[S(a.$slots,"trialBtn",O(R(e)),(()=>{var i,r,l,s,n,o;return[v(x,{"is-share":X.value.isShare,premium:null==(i=e.riskPremium)?void 0:i.initialPremium,"share-info":X.value,"loading-text":I(J).trialMsg,"plan-code":t.dataSource.planCode,"payment-frequency":(null==(o=null==(n=null==(s=null==(l=null==(r=e.trialData)?void 0:r.insuredList)?void 0:l[0].productList)?void 0:s[0].riskList)?void 0:n[0])?void 0:o.paymentFrequency)+"","tenant-product-detail":a.tenantProductDetail,"handle-share":a=>((a,e)=>{U.value.onShare(a)})(a,e.trialData),onHandleClick:a=>(e.trialData,void U.value.onNext())},{default:k((()=>[y("立即投保")])),_:2},1032,["is-share","premium","share-info","loading-text","plan-code","payment-frequency","tenant-product-detail","handle-share","onHandleClick"])]}))])),_:3},8,["data-source","share-info","product-info","tenant-product-detail","hide-benefit","default-data","default-order"])])])),_:3})])),_:3},8,["class","show"])):g("",!0)],64)}}});var G=Object.freeze(Object.defineProperty({__proto__:null,default:U},Symbol.toStringTag,{value:"Module"}));export{U as _,G as a,K as i};
