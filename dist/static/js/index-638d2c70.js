import{ax as e,_ as a,d as i,r as t,z as r,ay as o,x as s,aa as l,al as n,b as d,c as u,h as c,f as p,w as f,j as v,g as m,e as k,k as g,n as h,ak as O,K as V,L as y}from"./index-4c2d8b53.js";import{P as L,a as I}from"./index-335cfb16.js";import{i as P,p as R}from"./trial-8c471e2f.js";const b=e({id:"createProposal",state:()=>({proposalInfo:{},trialData:[],excludeProduct:[],proposalId:0}),actions:{setProposalInfo(e){this.$state.proposalInfo=e},setTrialData(e){this.$state.trialData=e},setExcludeProduct(e){this.$state.excludeProduct=e}}});const D={class:"com-product-risk-wrapper"},C={class:"popup-container"},_=(e=>(V("data-v-65cbf84c"),e=e(),y(),e))((()=>v("div",{class:"popup-title"},"请选择保障方案",-1))),w={class:"risk-trial-wrapper"},j={class:"risk-content"},x={key:0,class:"risk"},F={class:"footer-bar"};var B=a(i({__name:"index",props:{isShow:{type:Boolean,default:!1},type:{default:"add"},productId:{default:0},riskType:{default:1},formInfo:{default:{}},productData:{default:()=>({})},holder:{default:()=>({})},insured:{default:()=>({})},riderRisk:{default:()=>[]},currentRisk:{default:()=>[]}},emits:["close","finished"],setup(e,{emit:a}){var i,V;const y=e,b=t({personVO:{occupationCodeList:[],...y.holder}}),B=t({insuredCode:"",personVO:{occupationCodeList:(null==(V=((null==(i=y.insured)?void 0:i.proposalInsuredProductList)||[]).find((e=>e.productId===y.productData.productBasicInfoVO.id)))?void 0:V.occupationCodeList)||[],...y.insured}}),T=t({}),A=t({}),S=t({}),N=t({}),E=t({}),$=r({currentPlan:"0",isShow:y.isShow,riskBaseInfo:{},holderFactor:[],insuredFactor:[],riskData:[],riskPlanData:[],trialResult:{},canTrial:!0,retrialTip:!1,enumList:{},ageRange:[],collapseName:["1"],type:y.type});o("premium",E.value),o("source",{type:$.type,origin:"proposal",showRiskList:y.currentRisk});const K=s((()=>{var e;let a="";if(null==(e=$.riskData)?void 0:e[0]){const e=$.riskData[0],i=((null==e?void 0:e.requiredRiderRiskVOList)||[]).map((e=>e.riskName));i.length&&(a=`特殊提示: ${e.riskName}和${i.join("、")}必须同时投保`)}return a})),J=()=>{var e;const i=JSON.parse(JSON.stringify(T.value[$.currentPlan])),t=Object.values(i).find((e=>1===e.riskType)),r=Object.values(i).map((e=>{const a=e;return((e,a)=>{var i,t,r,o;const s=e;if("3"===s.chargePeriod){const e=(a.chargePeriod||"").split("_");if(e[1]-=1,1===s.exemptFlag){if("to"===e[0]){let a=0;1===s.exemptType?(null==(i=b.value.personVO)?void 0:i.birthday)&&(a=parseInt(""+(+new Date-new Date(null==(t=b.value.personVO)?void 0:t.birthday))/31536e6,10)):2===s.exemptType&&(null==(r=B.value.personVO)?void 0:r.birthday)&&(a=parseInt(""+(+new Date-new Date(null==(o=B.value.personVO)?void 0:o.birthday))/31536e6,10)),e[1]=e[1]-a}e[0]="year",s.coveragePeriod=e.join("_")}s.chargePeriod=e.join("_")}})(a,t),a.liabilityVOList=(a.liabilityVOList||[]).filter((e=>1===e.optionalFlag||e.liabilityAttributeValue&&"-1"!==e.liabilityAttributeValue)).map((e=>{const a=e;return"0"===a.liabilityAttributeValue&&(a.liabilityAttributeValue=""),a})),a})),o={holder:b.value,productCode:$.riskBaseInfo.productCode,insuredVOList:[{...B.value,productPlanVOList:[{planCode:$.currentPlan||"",insurerCode:null==(e=$.riskBaseInfo)?void 0:e.insurerCode,riskVOList:r}]}]};R({...o}).then((({code:e,data:i})=>{if("10000"===e){$.retrialTip=!1,$.trialResult=i,$.canTrial=!1;const e={},t=(a=[])=>{(a||[]).forEach((a=>{var i;e[a.riskCode]=a,(null==(i=a.riskPremiumDetailVOList)?void 0:i.length)&&t(a.riskPremiumDetailVOList)}))};t(i.riskPremiumDetailVOList),Object.assign(E.value,e),a("finished",((e,a)=>{var i,t,r,o,s,l,n,d,u;const c=(e.insuredVOList[0].productPlanVOList[0].riskVOList||[]).map((e=>({...e,premium:a[e.riskCode].premium,amount:a[e.riskCode].amount})));return{proposalHolder:{...null==(i=e.holder)?void 0:i.personVO},proposalInsuredList:[{...e.insuredVOList[0].personVO,dateRange:{min:null==(r=null==(t=S.value)?void 0:t.ageRangeObj)?void 0:r.minAge,max:null==(s=null==(o=S.value)?void 0:o.ageRangeObj)?void 0:s.maxAge},proposalInsuredProductList:[{productId:$.riskBaseInfo.id,productName:$.riskBaseInfo.productName,dateRange:{min:null==(n=null==(l=S.value)?void 0:l.ageRangeObj)?void 0:n.minAge,max:null==(u=null==(d=S.value)?void 0:d.ageRangeObj)?void 0:u.maxAge},occupationCodeList:e.insuredVOList[0].personVO.occupationCodeList,proposalProductRiskList:c}]}]}})(o,e))}else $.retrialTip=!0}))},M=()=>{var e,a,i,t,r;Promise.all([null==(a=null==(e=A.value)?void 0:e.validateForm)?void 0:a.call(e),null==(t=null==(i=S.value)?void 0:i.validateForm)?void 0:t.call(i),null==(r=N.value)?void 0:r.validate()]).then((()=>{J()}))},U=()=>{a("close")},q=e=>{$.holderFactor=e.holderFactorList,$.insuredFactor=e.insuredFactorList,$.ageRange=e.ageRange};return l([()=>T.value,()=>b.value,()=>B.value],(e=>{e&&!$.canTrial&&($.canTrial=!0,$.retrialTip=!0)}),{deep:!0}),l((()=>y.isShow),(e=>{$.isShow=e}),{immediate:!0}),l((()=>y.productId),(e=>{e&&P({productId:y.productId,source:2}).then((({code:e,data:a})=>{"10000"===e&&($.riskBaseInfo=a.productBasicInfoVO,(a.productRiskVoList[0].riskDetailVOList||[]).forEach(((e,a)=>{0===a&&($.currentPlan=e.planCode||"0"),Object.assign(T.value,{[e.planCode||a]:{}})})),$.riskData=a.productRiskVoList[0].riskDetailVOList||[],$.riskPlanData=a.productRelationPlanVOList||[])})).finally((()=>{}))}),{immediate:!0}),l((()=>y.formInfo),((e={})=>{if("add"!==y.type&&"repeatAdd"!==y.type){const a={};e.proposalProductRiskList.forEach((e=>{a[e.riskId]=e})),Object.assign(T.value,{0:a})}}),{deep:!0,immediate:!0}),l((()=>y.productData),(e=>{var a;"add"!==y.type&&"repeatAdd"!==y.type&&($.riskBaseInfo=e.productBasicInfoVO,$.riskData=(null==(a=e.productRiskVoList)?void 0:a[0].riskDetailVOList)||[])}),{deep:!0,immediate:!0}),l((()=>y.type),(e=>{$.type=e})),n((()=>{O({dictCodeList:["RISK_PAYMENT_PERIOD","RISK_INSURANCE_PERIOD"]}).then((({code:e,data:a})=>{if("10000"===e){const e={};a.forEach((a=>{e[a.dictCode]=a.dictItemList})),$.enumList=e}}))})),(e,a)=>{const i=d("ProMessage"),t=d("ProCard"),r=d("VanForm"),o=d("VanButton"),s=d("VanPopup");return u(),c("div",D,[p(s,{show:m($).isShow,"onUpdate:show":a[0]||(a[0]=e=>m($).isShow=e),round:"",position:"bottom",closeable:"",style:{height:"80%"},onClose:U},{default:f((()=>[v("div",C,[_,m(K)?(u(),k(i,{key:0,content:m(K)},null,8,["content"])):g("",!0),v("div",w,[m($).holderFactor.length?(u(),k(t,{key:0,title:"投保人",class:"part-card"},{default:f((()=>{var e;return[p(L,{ref_key:"holderRef",ref:A,"insured-code":null==(e=m($).riskBaseInfo)?void 0:e.insurerCode,"form-info":m(b).personVO,"factor-list":m($).holderFactor,"age-range":m($).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])]})),_:1})):g("",!0),m($).insuredFactor.length?(u(),k(t,{key:1,title:"被保人",class:"part-card"},{default:f((()=>{var e;return[p(L,{ref_key:"insuredRef",ref:S,"insured-code":null==(e=m($).riskBaseInfo)?void 0:e.insurerCode,"form-info":m(B).personVO,"factor-list":m($).insuredFactor,"age-range":m($).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])]})),_:1})):g("",!0),v("div",j,[p(t,{title:"投保方案",class:"part-card"},{default:f((()=>[m($).riskData.length?(u(),c("div",x,[p(r,{ref_key:"riskFormRef",ref:N,"input-align":"right","error-message-align":"right"},{default:f((()=>[p(I,{"risk-info":m(T)[0],enums:m($).enumList,"origin-data":m($).riskData,"pick-factor":q},null,8,["risk-info","enums","origin-data"])])),_:1},512)])):g("",!0)])),_:1})])]),v("div",F,[p(o,{block:"",type:"primary",onClick:M},{default:f((()=>[h("确定")])),_:1})])])])),_:1},8,["show"])])}}}),[["__scopeId","data-v-65cbf84c"]]);export{B as P,b as u};
