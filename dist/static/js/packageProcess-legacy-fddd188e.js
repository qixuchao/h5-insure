!function(){var e=document.createElement("style");e.innerHTML=".page-internet-product-detail[data-v-224d0f1e]{padding-bottom:2rem;background:#f1f5fc}.page-internet-product-detail .footer-button[data-v-224d0f1e]{justify-content:space-between}.page-internet-product-detail .price[data-v-224d0f1e]{color:#393d46;font-size:.45333rem;font-weight:400;display:flex;align-items:center}.page-internet-product-detail .price span[data-v-224d0f1e]{color:var(--van-primary-color);font-weight:700}.page-internet-product-detail .price .premium-loading[data-v-224d0f1e]{display:inline-block;line-height:.69333rem;margin-left:.4rem}.page-internet-product-detail .price .premium-loading[data-v-224d0f1e] .van-loading__spinner{width:.45333rem!important;height:.45333rem!important}.page-internet-product-detail .right[data-v-224d0f1e]{width:3.73333rem;background:var(--van-primary-color);border-color:var(--van-primary-color)}\n",document.head.appendChild(e),System.register(["./index-legacy-e4f2ce46.js","./debounce-legacy-211ba60e.js","./order-legacy-7fb7158b.js","./infoCollection-legacy-2d7e53a0.js","./trial-legacy-0b4311fa.js","./product-legacy-00d5a5eb.js","./utils-legacy-3608028a.js","./theme-legacy-a8152f06.js","./auth-legacy-b3bc1947.js","./close-legacy-299f3a05.js","./pdfh5-legacy-9f98dc45.js","./isObject-legacy-83e04b6f.js","./isObjectLike-legacy-7cedb542.js","./trial-legacy-bf53cd9d.js","./index-legacy-ca268df6.js","./index-legacy-a51a51c7.js","./index-legacy-6af61dc4.js","./index-legacy-a8c5d4fc.js","./bankCard-legacy-f00b2305.js","./validator-legacy-5e43cc69.js","./phoneVerify-legacy-87e10465.js"],(function(e){"use strict";var n,a,t,r,o,l,i,d,u,c,s,v,m,p,f,y,g,h,I,N,w,b,k,T,C,O,F,L,P,j,D,S,H,x,E,U,A,q,R,V,_,B,M,K,Y,$,z,J,G,W,X,Q,Z,ee,ne,ae,te,re,oe,le,ie,de,ue,ce,se,ve,me,pe,fe,ye;return{setters:[function(e){n=e._,a=e.d,t=e.u,r=e.a,o=e.r,l=e.J,i=e.ah,d=e.E,u=e.an,c=e.G,s=e.aB,v=e.z,m=e.c,p=e.h,f=e.f,y=e.w,g=e.g,h=e.A,I=e.k,N=e.j,w=e.t,b=e.bB,k=e.e,T=e.n,C=e.a7,O=e.F,F=e.T,L=e.aj,P=e.B,j=e.bT,D=e.X,S=e.Y,H=e.aJ,x=e.b3,E=e.bI,U=e.aK},function(e){A=e.d},function(e){q=e.a},function(e){R=e.S,V=e.R,_=e.P,B=e.I},function(e){M=e.i,K=e.u,Y=e.a,$=e.s,z=e.p,J=e.g},function(e){G=e.p},function(e){W=e.t,X=e.g,Q=e.a,Z=e.o,ee=e.s,ne=e.v,ae=e.b,te=e.j},function(e){re=e.t},function(e){oe=e.d,le=e.B,ie=e.D,de=e.G,ue=e.S,ce=e.H,se=e.P,ve=e.U,me=e._,pe=e.W,fe=e.a},function(e){ye=e._},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){}],execute:function(){const ge={key:0},he={class:"page-internet-product-detail"},Ie={class:"info"},Ne={class:"footer-button"},we={class:"price"},be=(e=>(D("data-v-224d0f1e"),e=e(),S(),e))((()=>N("span",null,"总保费",-1))),ke={key:0};e("default",n(a({__name:"packageProcess",setup(e){const n=t(),a=r(),{productCode:D="BWYL2021",tenantId:S,orderNo:Te,phoneNo:Ce,agentCode:Oe="",saleChannelId:Fe,paymentMethod:Le,certNo:Pe,name:je,pageCode:De,from:Se}=a.query,He=o(),xe=o(),Ee=o(),Ue=o(),Ae="payBack"===De;o(!1);const qe=o(!1),Re=o(!1),Ve=o(0),_e=o(!1),Be=o(!1),Me=o({show:!1,html:""}),Ke=o({}),Ye=o(),$e=o(!1),ze=o("");let Je="";const Ge=l({holder:{certNo:Pe,certType:i.CERT,mobile:Ce,name:je,socialFlag:R.HAS},insured:{certNo:Pe,certType:i.CERT,name:je,socialFlag:R.HAS,relationToHolder:V.SELF},paymentMethod:Le,renewalDK:"Y",paymentFrequency:_.YEAR,packageProductList:[],mobileSmsCode:""}),We=o(oe),Xe=o(oe),Qe=l({showInsure:!Ae,canInsure:!1,canUpgrade:!1}),Ze=d((()=>{var e,n;return(null===(e=xe.value)||void 0===e||null===(n=e.tenantProductInsureVO)||void 0===n?void 0:n.attachmentVOList.filter((e=>"健康告知"===e.attachmentName)))||[]})),en=d((()=>{var e,n;return(null===(e=xe.value)||void 0===e||null===(n=e.tenantProductInsureVO)||void 0===n?void 0:n.attachmentVOList.filter((e=>"健康告知"!==e.attachmentName)))||[]})),nn=()=>{ze.value=Ue.value?Ge.paymentFrequency==_.YEAR?"元/年":"元/月":""},an=()=>{n.push({path:"/internet/guaranteeUpgrade",query:{...a.query,tenantId:S,productCode:"BWYL2022",orderNo:Te,agentCode:Oe}})},tn=()=>{Be.value=!1},rn=()=>{Xe.value=We.value},on=()=>{Xe.value={...Xe.value,relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1}},ln=e=>`${E}/internet/payFail?tenantId=${S}&orderNo=${e}&agentCode=${Oe}&pageCode=payBack&from=${Se||"normal"}`,dn=async e=>{const n=X({tenantId:S,saleUserId:Oe,saleChannelId:Fe,detail:xe.value,insureDetail:Ee.value,paymentMethod:Ge.paymentMethod,paymentFrequency:Ge.paymentFrequency,renewalDK:Ge.renewalDK,iseeBizNo:Je,successJumpUrl:"",premium:Ue.value,holder:Ge.holder,insured:Ge.insured,tenantOrderRiskList:e,orderStatus:"",orderTopStatus:"",orderNo:Te,originOrderIds:Ye.value});try{const e=await $(n),{code:t,data:r}=e;Re.value=!1,qe.value=!1,"10000"===t&&(F.clear(),delete n.id,Ke.value={orderNo:r.data,order:n},Re.value=!0,a=0,Ve.value=a,Re.value=!0)}catch(t){F.clear(),Qe.canInsure=!0}var a},un=()=>new Promise(((e,n)=>{var a,t;null===(a=He.value)||void 0===a||null===(t=a.validateForm)||void 0===t||t.call(a).then((async()=>{if(!(()=>{if(Ge.holder.certNo){const e=U(Ge.holder.certNo);if(ne(Ge.holder.certNo,18,"year"))return F("投保人年龄必须大于等于18岁！"),!1;if(Ge.insured.certNo&&Ge.insured.relationToHolder===V.MATE&&e===U(Ge.insured.certNo))return F("被保人为配偶时，性别不可相同！"),!1}if(Ge.insured.certNo){if(Ge.insured.relationToHolder===V.CHILD&&ne(Ge.insured.certNo,30,"day"))return F("被保人为子女时，年龄必须大于等于30天！"),!1;if(Ge.insured.relationToHolder===V.PARENT&&!ne(Ge.insured.certNo,71,"year"))return F("被保人为父母时，年龄必须小于等于70岁！"),!1}if([V.CHILD,V.PARENT].includes(Ge.insured.relationToHolder)){const e=ae(Ge.holder.certNo,"year"),n=ae(Ge.insured.certNo,"year");if(Ge.insured.relationToHolder===V.CHILD&&e-n<18)return F("投保人和子女年龄必须相差18岁！"),!1;if(Ge.insured.relationToHolder===V.PARENT&&n-e<18)return F("投保人和父母年龄必须相差18岁！"),!1}return!0})())return void(Qe.canInsure=!0);const{calcData:a,riskVOList:t}=Q({holder:Ge.holder,insured:Ge.insured,tenantId:S,productDetail:xe.value,insureDetail:Ee.value,paymentFrequency:Ge.paymentFrequency,packageRiskIdList:Z(Ge.packageProductList)},!1,te);(!Array.isArray(t)||t.length<1)&&(F("被保人年龄需在30天(含) - 70岁(含)之间！"),Ue.value=null,n(new Error));const r=await z(a),{code:o,data:l}=r;"10000"===o?(Ue.value=l.premium,e({condition:t,data:l})):(Ue.value=null,n(new Error))})).catch((e=>{Qe.canInsure=!0,ee(e)}))})),cn=async()=>{if(Ae)an();else try{var e;F.loading({message:"订单生成中...",forbidClick:!0,duration:0});const{condition:n,data:a}=await un(),t={},r=(e=[])=>{(e||[]).forEach((e=>{var n;t[e.riskCode]=e,null!==(n=e.riskPremiumDetailVOList)&&void 0!==n&&n.length&&r(e.riskPremiumDetailVOList)}))};r(a.riskPremiumDetailVOList);const o=W({tenantId:S,riskList:n,riskPremium:t,productId:null===(e=xe.value)||void 0===e?void 0:e.id});dn(o)}catch(n){Qe.canInsure=!0}finally{F.clear()}},sn=e=>{var n;"allFalse"===e?(qe.value=!1,Qe.canInsure=!0,(async e=>{F.loading({message:"核保中...",forbidClick:!0,duration:0});try{const n=await K(e),{code:a}=n;if("10000"===a){const n=await Y({orderNo:e.orderNo,tenantId:S}),{data:a}=n;"10000"===n.code&&(2===a.type?(Me.value={show:!0,html:a.paymentUrl},console.log("data.paymentUrl",Me.value),x((()=>{console.log("document.forms",document.forms);const e=document.getElementById("cashierSubmit");null==e||e.addEventListener("submit",(e=>{e.preventDefault()})),null==e||e.submit()}))):window.location.href=a.paymentUrl)}Qe.canInsure=!0}catch(n){Qe.canInsure=!0}finally{F.clear()}})({...Ke.value.order,orderNo:Ke.value.orderNo,extInfo:{extraInfo:{renewalDK:Ge.renewalDK,paymentMethod:Ge.paymentMethod,paymentFrequency:Ge.paymentFrequency,successJumpUrl:(n=Ke.value.orderNo,`${E}/pay?orderNo=${n}&saleUserId=${Oe}&tenantId=${S}`),failUrl:ln(Ke.value.orderNo)},iseeBizNo:Je}})):L.confirm({message:"您当前的健康状况不符合该产品",confirmButtonText:"确定"}).then((()=>{window.history.back()})).catch((()=>{Qe.canInsure=!0}))},vn=()=>{Re.value=!1,qe.value=!1,Qe.canInsure=!0},mn=()=>{Re.value=!1,qe.value=!0};u([()=>Ge.insured.certNo,()=>Ge.insured.socialFlag,()=>Ge.packageProductList,()=>Ge.paymentFrequency],A((()=>{Ge.insured.certNo&&Ge.insured.socialFlag&&(()=>{const{holder:{certNo:e,mobile:n,name:a,socialFlag:t},insured:{certNo:r,name:o,socialFlag:l,relationToHolder:i},paymentMethod:d}=Ge;return!(!H(r)||!l)})()&&(async()=>{const{calcData:e,riskVOList:n}=Q({holder:Ge.holder,insured:Ge.insured,tenantId:S,productDetail:xe.value,insureDetail:Ee.value,paymentFrequency:Ge.paymentFrequency,packageRiskIdList:Z(Ge.packageProductList)},!1,te);if(!Array.isArray(n)||n.length<1)return F("被保人年龄需在30天(含) - 70岁(含)之间！"),Ue.value=null,{};$e.value=!0;const a=await z(e);$e.value=!1;const{code:t,data:r}=a;"10000"===t?Ge.insured.certNo?(Ue.value=r.premium,nn()):(Ue.value=null,nn()):Ue.value=null})()}),500),{deep:!0,immediate:!0}),u((()=>Ge.insured.certNo),(()=>{Ge.insured.certNo||(Ue.value=null)}));const pn=async()=>{const e=await J({orderNo:Te,tenantId:S}),{code:n,data:a}=e;if("10000"===n){var t,r,o,l,i,d,u,c;const{id:e,tenantOrderHolder:n,tenantOrderInsuredList:h,extInfo:I}=a;if(!Ae){var s,v,m,p,f,y,g;Ye.value={id:e,holderId:null==n?void 0:n.id,insuredId:null==h?void 0:h[0].id};const a=((null===(s=h[0])||void 0===s||null===(v=s.tenantOrderProductList[0])||void 0===v?void 0:v.tenantOrderRiskList)||[]).map((e=>{var n;return(null===(n=e.extInfo)||void 0===n?void 0:n.riskId)||""}));return Ge.packageProductList.forEach((e=>{e.value=e.productRiskVoList.filter((e=>a.includes(e.id))).length>0?B.INSURE:B.UN_INSURE})),Object.assign(Ge,{holder:{certNo:n.certNo,certType:n.certType,mobile:n.mobile,name:n.name,socialFlag:R.HAS},insured:{certNo:null==h?void 0:h[0].certNo,certType:null===(m=h[0])||void 0===m?void 0:m.certType,name:null===(p=h[0])||void 0===p?void 0:p.name,socialFlag:null===(f=h[0])||void 0===f||null===(y=f.extInfo)||void 0===y?void 0:y.hasSocialInsurance,relationToHolder:null===(g=h[0])||void 0===g?void 0:g.relationToHolder},paymentMethod:I.extraInfo.paymentMethod,paymentFrequency:I.extraInfo.paymentFrequency,renewalDK:I.extraInfo.renewalDK||"N"}),void(Qe.canInsure=!0)}Object.assign(Ge,{holder:{certNo:n.certNo,certType:n.certType,mobile:n.mobile,name:n.name,socialFlag:R.HAS},insured:{certNo:null==h?void 0:h[0].certNo,certType:null===(t=h[0])||void 0===t?void 0:t.certType,name:null===(r=h[0])||void 0===r?void 0:r.name,socialFlag:null===(o=h[0])||void 0===o||null===(l=o.extInfo)||void 0===l?void 0:l.hasSocialInsurance,relationToHolder:null===(i=h[0])||void 0===i?void 0:i.relationToHolder},paymentMethod:I.extraInfo.paymentMethod,paymentFrequency:I.extraInfo.paymentFrequency,renewalDK:I.extraInfo.renewalDK||"N"}),Ue.value=null===(d=h[0])||void 0===d||null===(u=d.tenantOrderProductList)||void 0===u||null===(c=u[0])||void 0===c?void 0:c.premium,a.orderStatus!==q.ACCEPT_POLICY&&a.orderStatus!==q.PAYMENT_SUCCESS||(Qe.canUpgrade=!0,_e.value=!1,Be.value=!0),a.orderStatus===q.PAYING&&(_e.value=!0,setTimeout((()=>{pn()}),3e3))}};return c((()=>{console.log("投保链接"),Xe.value=fe,We.value=fe,Qe.canInsure=!0,(async()=>{const e=await G({productCode:D,withInsureInfo:!0,tenantId:S});var n;"10000"===e.code&&(xe.value=e.data,document.title=(null===(n=e.data)||void 0===n?void 0:n.productFullName)||"");const a=await M({productCode:D});var t;"10000"===a.code&&(Ge.packageProductList=((null===(t=a.data)||void 0===t?void 0:t.packageProductVOList)||[]).map((e=>({...e,value:B.UN_INSURE,disabled:!1}))),Ee.value=a.data),Te&&pn()})(),setTimeout((async()=>{Je=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,n)=>{const a=s,t=P,r=j,o=v("dompurify-html");return m(),p(O,null,[f(r,{"theme-vars":g(re)},{default:y((()=>{var e,n,r,l,i,d,u;return[g(Me).show?h((m(),p("div",ge,null,512)),[[o,g(Me).html]]):I("",!0),N("div",he,[N("div",Ie,[f(le,{url:null===(e=g(xe))||void 0===e||null===(n=e.tenantProductInsureVO)||void 0===n?void 0:n.banner[0]},null,8,["url"]),f(ie,{"product-name":null===(r=g(xe))||void 0===r?void 0:r.productFullName,"product-desc":null===(l=g(xe))||void 0===l||null===(i=l.showConfigVO)||void 0===i?void 0:i.desc},null,8,["product-name","product-desc"])]),f(de,{"show-service-config":"","guarantee-list":null===(d=g(xe))||void 0===d||null===(u=d.tenantProductInsureVO)||void 0===u?void 0:u.titleAndDescVOS},null,8,["guarantee-list"]),f(ue,{detail:g(xe).tenantProductInsureVO},{form:y((()=>[f(ce,{ref_key:"formRef",ref:He,"is-show-package":"",disable:!g(Qe).showInsure,"form-auth":g(Xe),"form-info":g(Ge),"product-detail":g(xe),onOnReset:rn,onOnUpdate:on},null,8,["disable","form-auth","form-info","product-detail"])])),_:1},8,["detail"]),N("div",Ne,[N("div",we,[be,g($e)?(m(),k(a,{key:1,class:"premium-loading",type:"spinner"})):(m(),p("span",ke,w(g(Ue)?"￥":"")+w(g(b)(g(Ue)))+" "+w(g(ze)),1))]),f(t,{type:"primary",class:"right",disabled:!(g(Qe).canInsure||g(Qe).canUpgrade),onClick:cn},{default:y((()=>[T(w(g(Qe).showInsure?"立即投保":"升级保障"),1)])),_:1},8,["disabled"])])]),g(Te)?I("",!0):(m(),k(se,{key:1,"product-detail":g(xe)},null,8,["product-detail"])),f(ve,{"order-no":g(Te),"tenant-id":g(S),"is-show":g(Be),onOnConfirm:an,onOnClose:tn},null,8,["order-no","tenant-id","is-show"])]})),_:1},8,["theme-vars"]),f(me,{show:g(qe),"onUpdate:show":n[0]||(n[0]=e=>C(qe)?qe.value=e:null),"content-list":g(Ze),"active-index":0,onOnConfirmHealth:sn,onOnCloseHealth:vn},null,8,["show","content-list"]),g(Re)?(m(),k(ye,{key:0,show:g(Re),"onUpdate:show":n[1]||(n[1]=e=>C(Re)?Re.value=e:null),"content-list":g(en),"active-index":g(Ve),text:"我已逐页阅读并确认告知内容","force-read-cound":2,"on-close-file-preview":"",onSubmit:mn,onOnCloseFilePreview:vn},null,8,["show","content-list","active-index"])):I("",!0),f(pe,{"is-show":g(_e)},null,8,["is-show"])],64)}}}),[["__scopeId","data-v-224d0f1e"]]))}}}))}();
