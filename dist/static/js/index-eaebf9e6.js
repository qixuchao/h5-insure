import{h as Oe,aa as Se,P as Re,G as i,N as be,z as Q,$ as X,l as Ue,j as Me,r as H,k as Z,p as Ve,s as I,n as x,A as qe,B as L,m as Ye,v as $e,F as Ke,E as We,D as je,T as y,Y as ze}from"./vendor-4d9de129.js";import{p as ee,i as Ge,g as Je,s as Qe,u as Xe,a as Ze}from"./trial-cab8a60b.js";import{_ as et}from"./index-1d8bcf53.js";import{_ as tt,C as te,I as at,J as ae,a4 as oe}from"./index-d062dbdc.js";import{g as re,o as ne,a as ue,t as ot,b as rt,d as A}from"./utils-ee41ab42.js";import{u as nt}from"./theme-775c7ab9.js";import{a as O}from"./order-d35b5f76.js";import{S as T,R as h,g as ut,I as st}from"./infoCollection-a644b651.js";import{a as lt,_ as it}from"./index-fef103b9.js";import"./relativeTime-4ed25667.js";import"./useDicData-8779baaa.js";import"./trial-49742e4b.js";const ct={class:"footer-button"},dt=We("\u5206\u4EAB\u7528\u6237\u786E\u8BA4\u6295\u4FDD"),mt=Oe({setup(ft){const se=nt(),le=Se(),S=Re(),{productCode:ie="03O4",tenantId:d="0",orderNo:P,phoneNo:ce,agentCode:w="",saleChannelId:de,paymentMethod:me,certNo:R,name:b,pageCode:fe,from:pe}=S.query,E=i(),m=i({tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},insuredBeneficiaryType:"1",tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}]}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}}),_=i(),f=i(),U=i({}),M=fe==="payBack",D=i(!1),N=i(!1),v=i(!1),V=i(0),q=i(!1),Fe=i(!1),Y=i({show:!1,html:""});let k="";const a=be({holder:{certNo:R,certType:te.CERT,mobile:ce,name:b,socialFlag:T.HAS},insured:{certNo:R,certType:te.CERT,name:b,socialFlag:T.HAS,relationToHolder:h.SELF},paymentMethod:me,renewalDK:"Y",paymentFrequency:ut.YEAR,packageProductList:[],mobileSmsCode:""}),ye=()=>{E.value&&E.value.validateForm().then(t=>{console.log("formData",t)})},he=Q(()=>{var t,e;return((e=(t=m.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:e.attachmentVOList.filter(o=>o.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),Ee=Q(()=>{var t,e;return((e=(t=m.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:e.attachmentVOList.filter(o=>o.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),ve=()=>{if(a.holder.certNo){const t=A(a.holder.certNo,"year"),e=ae(a.holder.certNo);if(t<18)return y("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E18\u5C81\uFF01"),!1;if(a.insured.certNo&&a.insured.relationToHolder===h.MATE){const o=ae(a.insured.certNo);if(e===o)return y("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(a.insured.certNo){const t=A(a.insured.certNo,"day"),e=A(a.insured.certNo,"year");if(a.insured.relationToHolder===h.CHILD&&t<30)return y("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(a.insured.relationToHolder===h.PARENT&&e>=71)return y("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E70\u5C81\uFF01"),!1}if([h.CHILD,h.PARENT].includes(a.insured.relationToHolder)){const t=A(a.holder.certNo,"year"),e=A(a.insured.certNo,"year");if(a.insured.relationToHolder===h.CHILD&&t-e<18)return y("\u6295\u4FDD\u4EBA\u548C\u5B50\u5973\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1;if(a.insured.relationToHolder===h.PARENT&&e-t<18)return y("\u6295\u4FDD\u4EBA\u548C\u7236\u6BCD\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1}return!0},Ce=()=>{const{holder:{certNo:t,mobile:e,name:o,socialFlag:n},insured:{certNo:r,name:u,socialFlag:l,relationToHolder:c},paymentMethod:p}=a;return!!(at(r)&&!!l)},ge=()=>{le.push({path:"/internet/guaranteeUpgrade",query:{...S.query,tenantId:d,productCode:"BWYL2022",orderNo:P,agentCode:w}})},De=async t=>{y.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const e=await Xe(t),{code:o}=e;if(o==="10000"){y.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const n=await Ze({orderNo:t.orderNo,tenantId:d}),{data:r}=n;n.code==="10000"&&(r.type===2?(Y.value={show:!0,html:r.paymentUrl},console.log("data.paymentUrl",Y.value),ze(()=>{console.log("document.forms",document.forms);const u=document.getElementById("cashierSubmit");u==null||u.addEventListener("submit",l=>{l.preventDefault()}),u==null||u.submit()})):window.location.href=r.paymentUrl)}}catch(e){console.log(e)}},Ne=t=>`${oe}/pay?orderNo=${t}&saleUserId=${w}&tenantId=${d}`,Be=t=>`${oe}/internet/payFail?tenantId=${d}&orderNo=${t}&agentCode=${w}&pageCode=payBack&from=${pe||"normal"}`,Ie=async t=>{console.log("risk",t);const e=rt({tenantId:d,saleUserId:w,saleChannelId:de,detail:m.value,insureDetail:_.value,paymentMethod:a.paymentMethod,paymentFrequency:a.paymentFrequency,renewalDK:a.renewalDK,iseeBizNo:k,successJumpUrl:"",premium:f.value,holder:a.holder,insured:a.insured,tenantOrderRiskList:t,orderStatus:"",orderTopStatus:""});try{const o=await Qe(e),{code:n,data:r}=o;n==="10000"&&De({...e,orderNo:r.data,extInfo:{extraInfo:{renewalDK:a.renewalDK,paymentMethod:a.paymentMethod,paymentFrequency:a.paymentFrequency,successJumpUrl:Ne(r.data),failUrl:Be(r.data)},iseeBizNo:k}})}catch(o){console.log(o)}},Ae=async()=>{const{calcData:t,riskVOList:e}=re({holder:a.holder,insured:a.insured,tenantId:d,productDetail:m.value,insureDetail:_.value,paymentFrequency:a.paymentFrequency,packageRiskIdList:ne(a.packageProductList)},!1,ue);if(!Array.isArray(e)||e.length<1)return f.value=null,{};const o=await ee(t),{code:n,data:r}=o;return n==="10000"?(f.value=r.premium,{condition:e,data:r}):(f.value=null,{})},we=t=>{V.value=t,v.value=!0},_e=()=>new Promise((t,e)=>{var o,n;(n=(o=E.value)==null?void 0:o.validateForm)==null||n.call(o).then(async()=>{var B;if(!ve())return;if(!(((B=E.value)==null?void 0:B.isAgreeFile)||D.value)){D.value=!1,v.value=!0,we(0);return}const{calcData:u,riskVOList:l}=re({holder:a.holder,insured:a.insured,tenantId:d,productDetail:m.value,insureDetail:_.value,paymentFrequency:a.paymentFrequency,packageRiskIdList:ne(a.packageProductList)},!1,ue);(!Array.isArray(l)||l.length<1)&&(f.value=null,e(new Error));const c=await ee(u),{code:p,data:C}=c;p==="10000"?(f.value=C.premium,t({condition:l,data:C})):(f.value=null,e(new Error))}).catch(()=>{})}),Te=async()=>{var t;if(M){ge();return}try{const{condition:e,data:o}=await _e(),n={},r=(l=[])=>{(l||[]).forEach(c=>{var p;n[c.riskCode]=c,(p=c.riskPremiumDetailVOList)!=null&&p.length&&r(c.riskPremiumDetailVOList)})};r(o.riskPremiumDetailVOList);const u=ot({tenantId:d,riskList:e,riskPremium:n,productId:(t=m.value)==null?void 0:t.id});Ie(u)}catch(e){console.log(e)}},Pe=t=>{t==="allFalse"?(N.value=!1,D.value=!0,Te()):je.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"}).then(()=>{window.history.back()}).catch(()=>{var e;(e=E.value)==null||e.reEditForm(),D.value=!1})},$=()=>{var t;(t=E.value)==null||t.reEditForm(),D.value=!1},ke=()=>{console.log("onCloseHealthPopup========"),N.value=!1,$()},He=()=>{console.log("onCloseFilePreview========"),v.value=!1,$()},xe=()=>{v.value=!1,N.value=!0};X(()=>m.value,()=>{console.log("123123")},{deep:!0}),X([()=>a.insured.certNo,()=>a.insured.socialFlag,()=>a.packageProductList,()=>a.paymentFrequency],Ue.exports.debounce(()=>{a.insured.certNo&&a.insured.socialFlag&&Ce()&&Ae()},500),{deep:!0,immediate:!0});const K=async()=>{var n,r,u,l,c,p,C,B,W,j,z,G,J;const t=await Je({orderNo:P,tenantId:d}),{code:e,data:o}=t;if(e==="10000"){const{tenantOrderHolder:F,tenantOrderInsuredList:s,extInfo:g}=o;if(!M){Object.assign(a,{holder:{certNo:F.certNo,certType:F.certType,mobile:F.mobile,name:F.name,socialFlag:T.HAS},insured:{certNo:s==null?void 0:s[0].certNo,certType:(n=s[0])==null?void 0:n.certType,name:(r=s[0])==null?void 0:r.name,socialFlag:(l=(u=s[0])==null?void 0:u.extInfo)==null?void 0:l.hasSocialInsurance,relationToHolder:(c=s[0])==null?void 0:c.relationToHolder},paymentMethod:g.extraInfo.paymentMethod,paymentFrequency:g.extraInfo.paymentFrequency,renewalDK:g.extraInfo.renewalDK||"N"});return}Object.assign(a,{holder:{certNo:F.certNo,certType:F.certType,mobile:F.mobile,name:F.name,socialFlag:T.HAS},insured:{certNo:s==null?void 0:s[0].certNo,certType:(p=s[0])==null?void 0:p.certType,name:(C=s[0])==null?void 0:C.name,socialFlag:(W=(B=s[0])==null?void 0:B.extInfo)==null?void 0:W.hasSocialInsurance,relationToHolder:(j=s[0])==null?void 0:j.relationToHolder},paymentMethod:g.extraInfo.paymentMethod,paymentFrequency:g.extraInfo.paymentFrequency,renewalDK:g.extraInfo.renewalDK||"N"}),f.value=(J=(G=(z=s[0])==null?void 0:z.tenantOrderProductList)==null?void 0:G[0])==null?void 0:J.premium,(o.orderStatus===O.ACCEPT_POLICY||o.orderStatus===O.PAYMENT_SUCCESS)&&(q.value=!1,Fe.value=!0),o.orderStatus===O.PAYING&&(q.value=!0,setTimeout(()=>{K()},3*1e3))}},Le=async()=>{var o;const{code:t,data:e}=await Ge({productCode:ie});t==="10000"&&(a.packageProductList=(((o=e.data)==null?void 0:o.packageProductVOList)||[]).map(n=>({...n,value:st.UN_INSURE,disabled:!1})),_.value=e.data,U.value=e.productFactor),P&&K()};return Me(()=>{Le(),setTimeout(async()=>{k=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(t,e)=>{const o=H("van-button"),n=H("ProPageWrap"),r=H("van-config-provider");return Z(),Ve(Ke,null,[I(r,{"theme-vars":L(se)},{default:x(()=>[I(n,{class:"net-sale-wrap"},{default:x(()=>[I(et,{ref_key:"formRef",ref:E,"title-collection":{HOLDER:"\u672C\u4EBA\u4FE1\u606F\uFF08\u6295\u4FDD\u4EBA\uFF09",INSURER:"\u4E3A\u8C01\u6295\u4FDD\uFF08\u88AB\u4FDD\u4EBA\uFF09",BENEFICIARY:"\u6536\u76CA\u4EBA"},"form-info":m.value,"send-sms-code":()=>{},"factor-object":U.value},null,8,["form-info","send-sms-code","factor-object"]),qe("div",ct,[I(o,{type:"primary",block:"",onClick:ye},{default:x(()=>[dt]),_:1})])]),_:1})]),_:1},8,["theme-vars"]),I(lt,{show:N.value,"onUpdate:show":e[0]||(e[0]=u=>N.value=u),"content-list":L(he),"active-index":0,onOnConfirmHealth:Pe,onOnCloseHealth:ke},null,8,["show","content-list"]),v.value?(Z(),Ye(it,{key:0,show:v.value,"onUpdate:show":e[1]||(e[1]=u=>v.value=u),"content-list":L(Ee),"active-index":V.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9","force-read-cound":2,"on-close-file-preview":"",onSubmit:xe,onOnCloseFilePreview:He},null,8,["show","content-list","active-index"])):$e("",!0)],64)}}});var At=tt(mt,[["__scopeId","data-v-d34381a8"]]);export{At as default};
