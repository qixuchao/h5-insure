import{reactive as e,computed as i,onMounted as a,ref as l,watch as t,inject as n}from"vue";import{a as u,B as o}from"./infoCollection-f930e52f.js";import{_ as r,J as s,K as c,L as d,D as V,T as m,M as p,N as f}from"./index-deb4ddfb.js";/* empty css              */import{c as y}from"./cloneDeep-6abacc69.js";import{d as v,i as g}from"./debounce-6981b306.js";import{m as h}from"./merge-e7788e50.js";import{c as k,g as b,r as C,P as L,v as O,a as B,i as S,t as N}from"./PayInfo-e8550347.js";import{a as w,M as F}from"./keysIn-131bbce9.js";import{S as x}from"./isObjectLike-a9798079.js";import{a as I}from"./trial-90e504aa.js";const D=[{name:"年金领取期间",type:"checkbox",configKey:["annuityDrawValueList"],valueKey:"annuityDrawDate"},{name:"领取频率",type:"checkbox",configKey:["annuityDrawFrequencyList"],valueKey:"annuityDrawFrequency"},{name:"交费方式",type:"checkbox",configKey:["paymentFrequencyList"],valueKey:"paymentFrequency",ruleKey:"paymentTypeRule"},{name:"交费期间",type:"checkbox",configKey:["paymentPeriodValueList"],valueKey:"chargePeriod",ruleKey:"paymentPeriodRule",ruleValueKey:"chargePeriod"},{name:"保障期间",type:"checkbox",configKey:["insurancePeriodValueList"],valueKey:"coveragePeriod",ruleKey:"insurancePeriodRule",ruleValueKey:"chargePeriod"}];const T={key:0},E={class:"custom-field"},_={key:1,class:"flex-field"},A={class:"pro-radio-wrap"},K={key:2},P={class:"pro-radio-wrap"},j={class:"custom-field"},U={key:1},R={key:3},J={class:"custom-field"},M={key:1},$={class:"custom-field"},H={key:0},q={key:1},Y={key:4},z=Vue.defineComponent({name:"BaoeBaofei"});var G=r(Vue.defineComponent({...z,props:{originData:{default:()=>({})},modelValue:{default:()=>({})},defalutValue:{default:()=>({})},trialResult:{default:()=>({})}},emits:["update:modelValue","trialChange"],setup(l,{emit:t}){const n=l,o=e({hadSetDefault:!1}),r=Vue.ref(n.originData),s=Vue.ref(n.modelValue),c=Vue.ref(0),d=()=>2===r.value.saleMethod?{label:"保费",key:"initialPremium"}:{label:"保额",key:"initialAmount"},V=()=>{switch(`${r.value.displayUnit}`){case u.YUAN:return"元";case u.MONTH_SALARY:return"倍月薪";case u.MILLION:return"万元";case u.COPY:return"份"}return""},m=i((()=>2===r.value.saleMethod?{label:"保费",key:"initialPremium"}:{label:"保额",key:"initialAmount"})),p=(...e)=>{if(1===c.value){const e=s.value[m.value.key],i=n.originData.minStepValue,a=n.originData.maxStepValue,l=n.originData.stepValue;if(+e>=+a)s.value[m.value.key]=a;else if(+e<=+i)s.value[m.value.key]=i;else{const a=+e-+i,t=Math.floor(a/+l);a%+l!=0&&(s.value[m.value.key]=+i+t*+l)}}return!0},f=()=>{const{displayType:e,requireCopies:i}=r.value,a=d().key,l=!s.value.riskCode;1===e?c.value=1:3===e&&2===i?(c.value=2,r.value.displayValues.length>=1&&l&&!s.value[a]&&(s.value[a]=r.value.displayValues[0].code||r.value.displayValues[0].value)):3===e&&1===i?(c.value=3,r.value.minCopiesValue===r.value.maxCopiesValue&&l&&!s.value.copy&&(s.value.copy=r.value.minCopiesValue),r.value.displayValues.length>=1&&l&&!s.value[a]&&(s.value[a]=r.value.displayValues[0].code||r.value.displayValues[0].value)):2===e&&(c.value=4,r.value.minCopiesValue===r.value.maxCopiesValue&&l&&!s.value.copy&&(s.value.copy=r.value.minCopiesValue),l&&!s.value.initialAmount&&(s.value.initialAmount=r.value.copiesAmount))},y=i((()=>{if(r.value.displayValues){const e=d().key;return 1!==r.value.displayValues.length||s.value.riskCode||(s.value[e]=r.value.displayValues[0].code),r.value.displayValues.map((e=>({label:e.value,value:e.code})))}return[]})),v=()=>{};return a((()=>{f(),t("update:modelValue",s.value)})),Vue.watch((()=>r),(e=>{f()}),{deep:!0}),Vue.watch((()=>n.defalutValue),(e=>{(null==e?void 0:e.riskCode)&&!o.hadSetDefault&&(o.hadSetDefault=!0,s.value={...s.value,initialAmount:e.initialAmount,initialPremium:e.initialPremium,copy:e.copy})}),{deep:!0,immediate:!0}),Vue.watch((()=>s.value),(e=>{(()=>{if(1===c.value){const e=s.value[m.value.key],i=n.originData.minStepValue,a=n.originData.maxStepValue,l=n.originData.stepValue;if(+e>+a)return!1;if(+e<+i)return!1;if((+e-+i)%+l!=0)return!1}return!0})()&&(t("update:modelValue",e),t("trialChange",e))}),{deep:!0,immediate:!0}),(e,i)=>{const a=Vue.resolveComponent("VanStepper"),l=Vue.resolveComponent("VanField"),t=Vue.resolveComponent("ProRadioButton"),n=Vue.resolveComponent("ProField");return Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,[1===c.value?(Vue.openBlock(),Vue.createElementBlock("div",T,[Vue.createVNode(l,{label:`基本${Vue.unref(m).label}`,name:Vue.unref(m).key,class:"risk-select-field"},{input:Vue.withCtx((()=>[Vue.createElementVNode("div",E,[Vue.createVNode(a,{modelValue:s.value[Vue.unref(m).key],"onUpdate:modelValue":i[0]||(i[0]=e=>s.value[Vue.unref(m).key]=e),"input-width":"80px","default-value":e.originData.minStepValue,min:e.originData.minStepValue,step:e.originData.stepValue,max:e.originData.maxStepValue,onBlur:p},null,8,["modelValue","default-value","min","step","max"])])])),_:1},8,["label","name"])])):2===c.value?(Vue.openBlock(),Vue.createElementBlock("div",_,[Vue.createVNode(n,{modelValue:s.value[Vue.unref(m).key],"onUpdate:modelValue":i[2]||(i[2]=e=>s.value[Vue.unref(m).key]=e),label:`基本${Vue.unref(m).label}`,name:Vue.unref(m).key,class:"risk-select-field"},{input:Vue.withCtx((()=>[Vue.createElementVNode("div",A,[Vue.createVNode(t,{modelValue:s.value[Vue.unref(m).key],"onUpdate:modelValue":i[1]||(i[1]=e=>s.value[Vue.unref(m).key]=e),options:Vue.unref(y),onclick:v},null,8,["modelValue","options"])])])),_:1},8,["modelValue","label","name"])])):3===c.value?(Vue.openBlock(),Vue.createElementBlock("div",K,[Vue.createVNode(n,{modelValue:s.value[Vue.unref(m).key],"onUpdate:modelValue":i[4]||(i[4]=e=>s.value[Vue.unref(m).key]=e),label:`基本${Vue.unref(m).label}`,name:Vue.unref(m).key,class:"risk-select-field"},{input:Vue.withCtx((()=>[Vue.createElementVNode("div",P,[Vue.createVNode(t,{modelValue:s.value[Vue.unref(m).key],"onUpdate:modelValue":i[3]||(i[3]=e=>s.value[Vue.unref(m).key]=e),options:Vue.unref(y),onclick:v},null,8,["modelValue","options"])])])),_:1},8,["modelValue","label","name"]),Vue.createElementVNode("div",null,[Vue.createVNode(l,{modelValue:s.value.copy,"onUpdate:modelValue":i[6]||(i[6]=e=>s.value.copy=e),label:"份数",name:"copy",class:"risk-select-field"},{input:Vue.withCtx((()=>[Vue.createElementVNode("div",j,[e.originData.minCopiesValue!==e.originData.maxCopiesValue?(Vue.openBlock(),Vue.createBlock(a,{key:0,modelValue:s.value.copy,"onUpdate:modelValue":i[5]||(i[5]=e=>s.value.copy=e),"input-width":"80px","default-value":e.originData.minCopiesValue,min:e.originData.minCopiesValue||1,step:1,max:e.originData.maxCopiesValue},null,8,["modelValue","default-value","min","max"])):(Vue.openBlock(),Vue.createElementBlock("span",U,Vue.toDisplayString(e.originData.minCopiesValue),1))])])),_:1},8,["modelValue"])])])):4===c.value?(Vue.openBlock(),Vue.createElementBlock("div",R,[Vue.createVNode(l,{modelValue:s.value.copy,"onUpdate:modelValue":i[8]||(i[8]=e=>s.value.copy=e),label:"份数",name:"copy",class:"risk-select-field"},{input:Vue.withCtx((()=>[Vue.createElementVNode("div",J,[e.originData.minCopiesValue!==e.originData.maxCopiesValue?(Vue.openBlock(),Vue.createBlock(a,{key:0,modelValue:s.value.copy,"onUpdate:modelValue":i[7]||(i[7]=e=>s.value.copy=e),"input-width":"64px","default-value":e.originData.minCopiesValue,min:e.originData.minCopiesValue||1,step:1,max:e.originData.maxCopiesValue},null,8,["modelValue","default-value","min","max"])):(Vue.openBlock(),Vue.createElementBlock("span",M,Vue.toDisplayString(e.originData.minCopiesValue),1))])])),_:1},8,["modelValue"]),Vue.createVNode(l,{label:Vue.unref(m).label,name:"copyAmount",class:"risk-select-field"},{input:Vue.withCtx((()=>[Vue.createElementVNode("div",$,[e.originData.minCopiesValue!==e.originData.maxCopiesValue?(Vue.openBlock(),Vue.createElementBlock("span",H,Vue.toDisplayString(+e.originData.copiesAmount*+s.value.copy+V()),1)):(Vue.openBlock(),Vue.createElementBlock("span",q,Vue.toDisplayString(+e.originData.minCopiesValue*+e.originData.copiesAmount+V()),1))])])),_:1},8,["label"])])):Vue.createCommentVNode("",!0),2===r.value.saleMethod&&e.trialResult&&e.trialResult.initialAmount>0?(Vue.openBlock(),Vue.createElementBlock("div",Y,[Vue.createVNode(l,{label:"保额",class:"risk-select-field"},{input:Vue.withCtx((()=>[Vue.createElementVNode("span",null,Vue.toDisplayString(e.trialResult.initialAmount),1)])),_:1})])):Vue.createCommentVNode("",!0)],64)}}}),[["__scopeId","data-v-7997a9f0"]]);const Q=Vue.defineComponent({name:"BeneficiaryItem"});var W=r(Vue.defineComponent({...Q,props:{modelValue:{default:()=>({})},schema:{default:()=>[]},config:{default:()=>({})},isView:{type:Boolean,default:!1},isTrial:{type:Boolean,default:!1},title:{default:"受益人"}},emits:["update:modelValue","trailChange"],setup(i,{expose:a,emit:n}){const u=i,o=l(null),r=e({validated:!1,schema:[],config:{},personVO:{}});return t((()=>u.config),(e=>{e&&Object.assign(r.config,e)}),{deep:!0,immediate:!0}),t((()=>u.schema),(e=>{e&&Object.assign(r.schema,y(u.schema))}),{deep:!0,immediate:!0}),t((()=>u.modelValue),((e,i)=>{JSON.stringify(e)!==JSON.stringify(i)&&(k("受益人数据变动了"),Object.assign(r.personVO,e))}),{deep:!0,immediate:!0}),t((()=>r.personVO),(e=>{e&&n("update:modelValue",e)}),{deep:!0,immediate:!0}),t((()=>{var e;return null==(e=r.personVO)?void 0:e.relationToInsured}),((e,i)=>{if(e===i)return!1;k("受益人与被保人关系变动了");const{certType:a}=r.personVO||{},[l,t]=b(r.schema,{certType:a,relationToHolder:e});return h(r.config,t),!u.isView&&e&&i&&Object.assign(r.personVO,{...C(r.personVO,(e=>!(l&&"certType"===e))),relationToInsured:e}),!1}),{immediate:!0}),a({validate:e=>B(o,u.trialFactorCodes,e),validateTrialFields:()=>O({personVO:r.personVO,trialFactorCodes:u.trialFactorCodes})}),(e,i)=>(Vue.openBlock(),Vue.createBlock(Vue.unref(L),{ref_key:"formRef",ref:o,class:"personal-info-card",title:e.title,model:Vue.unref(r).personVO,schema:Vue.unref(r).schema,config:Vue.unref(r).config,"is-view":e.isView,"extra-provision":{objectType:Vue.unref(s).BENEFICIARY,objectId:Vue.unref(r).personVO.id}},{cardTitleExtra:Vue.withCtx((()=>[Vue.renderSlot(e.$slots,"default",{},void 0,!0)])),_:3},8,["title","model","schema","config","is-view","extra-provision"]))}}),[["__scopeId","data-v-34580ae7"]]);const X=["onClick"],Z=Vue.defineComponent({name:"InsuredItem"});var ee=r(Vue.defineComponent({...Z,props:{modelValue:{default:()=>({})},title:{default:""},holderPersonVO:{},schema:{default:()=>[]},config:{default:()=>({})},isView:{type:Boolean,default:!1},isTrial:{type:Boolean,default:!1},trialFactorCodes:{default:()=>[]},multiBeneficiaryMaxNum:{default:null},beneficiaryList:{default:()=>[]},beneficiarySchema:{default:()=>[]}},emits:["update:modelValue","update:beneficiaryList"],setup(a,{expose:n,emit:u}){const r=a,m=l(null),p=l(null),f=l(null),v={schema:[],trialFactorCodes:[],config:{},personVO:{}},g=e({validated:!1,schema:[],config:{},personVO:{},beneficiaryTypeSchemaList:[],beneficiarySchemaList:[],beneficiaryList:[]}),S=()=>{g.beneficiaryList.push(y({...v,nanoid:d(),schema:r.beneficiarySchema}))},N=i((()=>!r.multiBeneficiaryMaxNum||g.beneficiaryList.length<r.multiBeneficiaryMaxNum)),w=i((()=>!g.schema.filter((e=>{var i;return!(e.hidden||(null==(i=g.config[e.name])?void 0:i.hidden))})).length)),F=i((()=>g.schema.filter((e=>e.isSelfInsuredNeed)).map((e=>e.name)))),x=i((()=>c(r.beneficiarySchema))),I=i((()=>{var e;return String(null==(e=g.personVO)?void 0:e.insuredBeneficiaryType)===o.SPECIFY}));return t((()=>r.holderPersonVO),(e=>{var i;k("投保人信息变动了");const{id:a,...l}=e||{};if("1"===String(null==(i=g.personVO)?void 0:i.relationToHolder)){const e=c(F.value)?Object.keys(l).reduce(((e,i)=>([...F.value,"occupationClass"].includes(i)&&!["birthday","age","gender"].includes(i)||(e[i]=l[i]),e)),{}):l;Object.assign(g.personVO,e)}}),{deep:!0,immediate:!0}),t((()=>r.beneficiarySchema),(e=>{g.beneficiarySchemaList=c(e)?e.filter((e=>"insuredBeneficiaryType"!==e.name)):[],g.beneficiaryTypeSchemaList=c(e)?e.filter((e=>"insuredBeneficiaryType"===e.name)):[]}),{deep:!0,immediate:!0}),t(I,((e,i)=>{String(e)!==String(i)&&(k("受益人类型关系变动了"),e?!c(g.beneficiaryList)&&S():g.beneficiaryList=[])}),{immediate:!0}),t((()=>g.beneficiaryList.map((e=>({personVO:e.personVO})))),((e,i)=>{JSON.stringify(e)!==JSON.stringify(i)&&u("update:beneficiaryList",e)}),{deep:!0}),t((()=>{var e;return null==(e=g.personVO)?void 0:e.relationToHolder}),((e,i)=>{if(!e)return;k("与投保人关系变动了");const{personVO:a,schema:l=[],config:t}=g||{},{id:n,...u}=r.holderPersonVO||{},o="1"===String(a.relationToHolder),[s,c]=b(l,a);if(h(t,c),l.forEach((e=>{e.relationToHolder=a.relationToHolder,e.hidden=!e.isSelfInsuredNeed&&o})),!r.isView&&i&&String(e)!==String(i)){let e={...a,...u};o||(e={...C(a,(e=>!(s&&"certType"===e))),relationToHolder:a.relationToHolder}),Object.assign(g.personVO,e)}}),{deep:!0}),t((()=>{var e;return null==(e=g.personVO)?void 0:e.relationToMainInsured}),((e,i)=>{if(!e)return;k("次被保人与主被保人关系变动了");const{personVO:a,schema:l=[],config:t}=g||{},{certType:n}=a||{},[u,o]=b(l,{certType:n,relationToHolder:e});h(t,o),!r.isView&&i&&String(e)!==String(i)&&Object.assign(g.personVO,{...C(a,(e=>!(u&&"certType"===e))),relationToMainInsured:a.relationToMainInsured})})),t((()=>r.config),(e=>{e&&Object.assign(g.config,e)}),{deep:!0,immediate:!0}),t((()=>r.schema),(e=>{e&&Object.assign(g.schema,y(e))}),{deep:!0,immediate:!0}),t((()=>r.modelValue),((e,i)=>{if(JSON.stringify(e)!==JSON.stringify(i)){const{beneficiaryList:i,...a}=e;h(g.personVO,a)}}),{deep:!0,immediate:!0}),t((()=>r.beneficiaryList),((e,i)=>{JSON.stringify(e)!==JSON.stringify(i)&&(g.beneficiaryList=c(e)?e.map((e=>({...e,nanoid:e.nanoid||d()}))):[])}),{deep:!0,immediate:!0}),t((()=>g.personVO),(e=>{e&&u("update:modelValue",e)}),{deep:!0,immediate:!0}),n({validate:e=>{var i;return Promise.all([B(m,r.trialFactorCodes,e),B(p,[],e),...(null==(i=f.value)?void 0:i.map((i=>i.validate(e))))||[]])},validateTrialFields:()=>O({personVO:g.personVO,trialFactorCodes:r.trialFactorCodes})}),(e,i)=>{const a=Vue.resolveComponent("van-icon");return Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,[Vue.createVNode(Vue.unref(L),{ref_key:"insuredFormRef",ref:m,class:"personal-info-card",title:Vue.unref(w)?"":e.title,model:Vue.unref(g).personVO,schema:Vue.unref(g).schema,config:Vue.unref(g).config,"is-view":e.isView,"extra-provision":{objectType:Vue.unref(s).INSURED,objectId:Vue.unref(g).personVO.id}},{cardTitleExtra:Vue.withCtx((()=>[Vue.renderSlot(e.$slots,"default",{},void 0,!0)])),_:3},8,["title","model","schema","config","is-view","extra-provision"]),Vue.unref(x)?(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,{key:0},[Vue.createVNode(Vue.unref(L),{ref_key:"beneficiaryTypeFormRef",ref:p,class:"personal-info-card",title:"受益人",model:Vue.unref(g).personVO,schema:Vue.unref(g).beneficiaryTypeSchemaList,"is-view":e.isView},null,8,["model","schema","is-view"]),Vue.unref(I)?(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,{key:0},[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(g).beneficiaryList,((i,l)=>(Vue.openBlock(),Vue.createBlock(W,{ref_for:!0,ref_key:"beneficiaryFormRef",ref:f,key:`${i.nanoid}_${l}`,modelValue:i.personVO,"onUpdate:modelValue":e=>i.personVO=e,title:`受益人${l+1}`,schema:Vue.unref(g).beneficiarySchemaList,config:i.config,"is-view":e.isView},{default:Vue.withCtx((()=>[l>0&&!e.isView?(Vue.openBlock(),Vue.createElementBlock("span",{key:0,class:"delete-button",onClick:e=>(e=>{V.confirm({message:"确定要删除该受益人吗？"}).then((()=>{g.beneficiaryList.splice(e,1)}))})(l)},[Vue.createVNode(a,{name:"delete-o"})],8,X)):Vue.createCommentVNode("",!0)])),_:2},1032,["modelValue","onUpdate:modelValue","title","schema","config","is-view"])))),128)),!e.isView&&Vue.unref(N)?(Vue.openBlock(),Vue.createElementBlock("span",{key:0,class:"add-button",onClick:S},[Vue.createVNode(a,{name:"plus"}),Vue.createTextVNode("添加受益人")])):Vue.createCommentVNode("",!0)],64)):Vue.createCommentVNode("",!0)],64)):Vue.createCommentVNode("",!0)],64)}}}),[["__scopeId","data-v-ac71bbac"]]);const ie=["onClick"],ae=Vue.defineComponent({name:"PersonalInfo"}),le=Vue.defineComponent({...ae,props:{productFactor:{default:()=>({})},modelValue:{default:()=>({})},isTrial:{type:Boolean,default:!1},isView:{type:Boolean,default:!1},isOnlyHolder:{type:Boolean,default:!1},multiInsuredConfig:{}},emits:["update:modelValue","trailChange","trailValidateFailed"],setup(a,{expose:u,emit:o}){const r=a,f=l(null),g=l(null),C=e({config:{},trialValidated:!1,holder:{personVO:{},schema:[],trialFactorCodes:[],config:{}},beneficiarySchema:[],initInsuredIList:[],insured:[]}),w=i((()=>!r.isTrial||r.isOnlyHolder)),F=()=>{var e;const i=!g.value||(null==(e=g.value)?void 0:e.every((e=>e.validateTrialFields())));return(!f.value||O(C.holder))&&i},x=e=>{var i;return Promise.all([...(null==(i=g.value)?void 0:i.map((i=>i.validate(e))))||[],B(f,C.holder.trialFactorCodes,e)])},I=e=>{const{productList:i,config:a,schema:l,trialFactorCodes:t,beneficiaryList:n,personVO:u,nanoid:o,...r}=e||{};return r},D=()=>{const{length:e,[e-1]:i}=C.initInsuredIList;C.insured.push(y({...i,nanoid:d()}))},T=i((()=>{const{multiInsuredMaxNum:e,multiInsuredSupportFlag:i}=C.config;return i&&(!e||C.insured.length<e)})),E=i((()=>c(C.holder.schema))),_=i((()=>C.insured.some((e=>c(e.schema))))),A=(e,i)=>c(e)?e.reduce(((e,a)=>(e[a]=i[a],e)),{}):{},K=(e,i,a={})=>!!c(e)&&JSON.stringify(A(e,i))!==JSON.stringify(A(e,a));return t((()=>{var e;return null==(e=C.holder.personVO)?void 0:e.certType}),((e,i)=>{if(e===i)return!1;k("投保人信息变动了");const[a,l]=b(C.holder.schema,{certType:e});return h(C.holder.config,l),!1})),t([()=>{var e;return{...null==(e=C.holder)?void 0:e.personVO}},()=>C.insured.map((e=>{const{beneficiaryList:i,personVO:a}=e||{};return{...a,beneficiaryList:c(i)?i.map((e=>({...e.personVO}))):[]}}))],v(((e,i)=>{var a,l,t;const[n,u]=e,s=((e,i)=>{const a=K(C.holder.trialFactorCodes,e[0],i[0]),l=C.insured.some(((e,a)=>{var l;const{trialFactorCodes:t,personVO:n}=e;return K(t,n,null==(l=i[1])?void 0:l[a])}));return a||l})([n,u],i);k(`投被保人信息变动了---${s}`);const{insuredList:c}=r.modelValue;console.log("insuredList",c,u);const d={holder:n,insuredList:u.map(((e,i)=>({...(null==c?void 0:c[i])||{},...e})))};if(C.config.isSpouseInsured){const[e,i]=u.map((e=>null==e?void 0:e.gender));if(e&&i&&String(e)===String(i))return m("被保人性别与投保要求不符")}if(JSON.stringify(null==(a=null==u?void 0:u[0])?void 0:a.personVO),I(null==(t=null==(l=r.modelValue)?void 0:l.insuredList)?void 0:t[0]),console.log("-------result = ",d),o("update:modelValue",d),!F())return C.trialValidated=!1,o("trailValidateFailed",d);x(!0).then((()=>{C.trialValidated=!0,s&&!r.isOnlyHolder&&o("trailChange",d)})).catch((()=>{C.trialValidated=!1,o("trailValidateFailed",d)}))}),500),{deep:!0}),t([()=>r.productFactor,()=>r.isTrial],((e,i)=>{if(S(e,i)||!e[0])return!1;k("投被保人要素变动了");const{insuredFactorCodes:a,holderFactorCodes:l}=n(p)||{},{holder:t,insured:u,beneficiary:o,config:s}=N(e[0],{isTrial:e[1],...r.multiInsuredConfig,insuredFactorCodes:a,holderFactorCodes:l});return Object.assign(C.holder,t),console.log("-----------",t,u),C.config=s,c(u)&&(C.initInsuredIList=u.map((e=>({...e,beneficiaryList:[]})))),C.beneficiarySchema=y((null==o?void 0:o.schema)||[]),!1}),{deep:!0,immediate:!0}),t([()=>{const{holder:e,insuredList:i}=r.modelValue,a=c(i)?i.map((e=>({config:e.config,personVO:I(e),beneficiaryList:c(e.beneficiaryList)?e.beneficiaryList.map((({config:e,...i})=>({config:e,personVO:I(i)}))):[]}))):[];return[null==e?void 0:e.config,I(e),a]},()=>C.config],(([[e,i,a]])=>{Object.assign(C.holder.config,e),Object.assign(C.holder.personVO,i);const{length:l}=a||[],{length:t}=C.insured,{length:n,0:u={},[n-1]:o}=C.initInsuredIList,{multiInsuredMaxNum:s,multiInsuredMinNum:c,multiInsuredSupportFlag:V}=C.config,m=r.isView||l>t?Math.min(l,s):t||c;console.log("-----change",C.config,m),C.insured=Array.from({length:m}).reduce(((e,i,l)=>{const{personVO:t,config:n={},beneficiaryList:r}=(null==a?void 0:a[l])||{},s=y(0===l?u:o);return e[l]?h(e[l],{personVO:t,config:n,beneficiaryList:r}):e[l]={...s,personVO:t,config:n,beneficiaryList:r,nanoid:d()},e}),C.insured)}),{deep:!0,immediate:!0}),u({validate:x,validateTrialFields:F,validateHolder:(...e)=>{var i;return null==(i=f.value)?void 0:i.validate(...e)},canTrail:()=>C.trialValidated}),(e,i)=>{const a=Vue.resolveComponent("van-icon"),l=Vue.resolveComponent("van-cell");return Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,[Vue.unref(E)&&Vue.unref(w)?(Vue.openBlock(),Vue.createBlock(Vue.unref(L),{key:0,ref_key:"holderFormRef",ref:f,title:"投保人信息",class:"personal-info-card",model:Vue.unref(C).holder.personVO,schema:Vue.unref(C).holder.schema,config:Vue.unref(C).holder.config,"is-view":e.isView,"extra-provision":{objectType:Vue.unref(s).HOLDER,objectId:Vue.unref(C).holder.personVO.id}},null,8,["model","schema","config","is-view","extra-provision"])):Vue.createCommentVNode("",!0),Vue.unref(_)&&!e.isOnlyHolder?(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,{key:1},[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(C).insured,((i,l)=>(Vue.openBlock(),Vue.createBlock(ee,Vue.mergeProps({ref_for:!0,ref_key:"insuredFormRef",ref:g,key:`${i.nanoid}_${l}`,modelValue:i.personVO,"onUpdate:modelValue":e=>i.personVO=e,"beneficiary-list":i.beneficiaryList,"onUpdate:beneficiaryList":e=>i.beneficiaryList=e,title:""+(Vue.unref(C).insured.length>1?`被保人${l+1}`:"被保人信息"),"holder-person-v-o":Vue.unref(C).holder.personVO},i,{"beneficiary-schema":Vue.unref(C).beneficiarySchema,"is-view":e.isView,"multi-beneficiary-num":Vue.unref(C).config.multiBeneficiaryMaxNum}),{default:Vue.withCtx((()=>[!e.isView&&l+1>Vue.unref(C).config.multiInsuredMinNum?(Vue.openBlock(),Vue.createElementBlock("span",{key:0,class:"delete-button",onClick:e=>(e=>{V.confirm({message:"确定要删除该被保人吗？"}).then((()=>{C.insured.splice(e,1)}))})(l)},[Vue.createVNode(a,{name:"delete-o"})],8,ie)):Vue.createCommentVNode("",!0)])),_:2},1040,["modelValue","onUpdate:modelValue","beneficiary-list","onUpdate:beneficiaryList","title","holder-person-v-o","beneficiary-schema","is-view","multi-beneficiary-num"])))),128)),!e.isView&&Vue.unref(T)?(Vue.openBlock(),Vue.createBlock(l,{key:0,class:"add-button-wrap"},{title:Vue.withCtx((()=>[Vue.createElementVNode("span",{class:"add-button",onClick:D},[Vue.createVNode(a,{name:"plus"}),Vue.createTextVNode("添加被保人")])])),_:1})):Vue.createCommentVNode("",!0)],64)):Vue.createCommentVNode("",!0)],64)}}});var te=r(le,[["__scopeId","data-v-6a1e3d74"]]),ne=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ue=/^\w*$/;function oe(e,i){if("function"!=typeof e||null!=i&&"function"!=typeof i)throw new TypeError("Expected a function");var a=function(){var l=arguments,t=i?i.apply(this,l):l[0],n=a.cache;if(n.has(t))return n.get(t);var u=e.apply(this,l);return a.cache=n.set(t,u)||n,u};return a.cache=new(oe.Cache||F),a}oe.Cache=F;var re,se,ce,de=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ve=/\\(\\)?/g,me=(re=function(e){var i=[];return 46===e.charCodeAt(0)&&i.push(""),e.replace(de,(function(e,a,l,t){i.push(l?t.replace(Ve,"$1"):a||e)})),i},se=oe(re,(function(e){return 500===ce.size&&ce.clear(),e})),ce=se.cache,se),pe=me;var fe=x?x.prototype:void 0,ye=fe?fe.toString:void 0;function ve(e){if("string"==typeof e)return e;if(w(e))return function(e,i){for(var a=-1,l=null==e?0:e.length,t=Array(l);++a<l;)t[a]=i(e[a],a,e);return t}(e,ve)+"";if(g(e))return ye?ye.call(e):"";var i=e+"";return"0"==i&&1/e==-Infinity?"-0":i}function ge(e,i){return w(e)?e:function(e,i){if(w(e))return!1;var a=typeof e;return!("number"!=a&&"symbol"!=a&&"boolean"!=a&&null!=e&&!g(e))||ue.test(e)||!ne.test(e)||null!=i&&e in Object(i)}(e,i)?[e]:pe(function(e){return null==e?"":ve(e)}(e))}function he(e){if("string"==typeof e||g(e))return e;var i=e+"";return"0"==i&&1/e==-Infinity?"-0":i}function ke(e,i,a){var l=null==e?void 0:function(e,i){for(var a=0,l=(i=ge(i,e)).length;null!=e&&a<l;)e=e[he(i[a++])];return a&&a==l?e:void 0}(e,i);return void 0===l?a:l}const be={class:"pro-radio-wrap"},Ce=Vue.defineComponent({name:"ProductKeys"});var Le=r(Vue.defineComponent({...Ce,props:{originData:{default:()=>({})},modelValue:{default:()=>({})},riskInfo:{default:()=>({})},defaultValue:{default:()=>({})},useData:{default:()=>({})}},emits:["trialChange","inputChange"],setup(e,{emit:i}){const l=e,t=Vue.ref(l.originData),n=Vue.ref(l.modelValue);Vue.ref(1);const u=e=>{const i=ke(l.originData,e),a=ke(l.originData,e);return i.map((e=>{const i=a?a.find((i=>i.code===e.code)):null;return{label:e.value,value:e.code,disabled:!(!i||null===i.useFlag||void 0===i.useFlag)&&1!==i.useFlag}}))},o=()=>{D.forEach((e=>{const i=ke(l.originData,e.configKey);"checkbox"===e.type&&i&&i.length>0&&!n.value.riskCode&&(n.value[e.valueKey]=i[0].code)}))};return a((()=>{o()})),Vue.watch((()=>l.defaultValue),(e=>{(null==e?void 0:e.riskCode)&&(n.value=JSON.parse(JSON.stringify(e)))}),{deep:!0,immediate:!0}),Vue.watch((()=>t.value),(e=>{o()}),{deep:!0,immediate:!0}),Vue.watch((()=>JSON.stringify(n.value)),((e,a)=>{const t=e&&JSON.parse(e)||{};console.log("---v new = ",t);const n=a&&JSON.parse(a)||{};let u=null;D.forEach((e=>{t[e.valueKey]&&n[e.valueKey]&&t[e.valueKey]!==n[e.valueKey]&&(u||(u={key:e.valueKey,oldValue:n[e.valueKey],newValue:t[e.valueKey],riskCode:l.riskInfo.riskCode}))})),e&&i("trialChange",JSON.parse(e),u)}),{deep:!0,immediate:!0}),(e,i)=>{const a=Vue.resolveComponent("ProRadioButton"),l=Vue.resolveComponent("ProField");return Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(D),(i=>(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,[Vue.unref(ke)(e.originData,i.configKey)&&(1===e.riskInfo.mainRiskFlag||i.ruleKey&&2===Vue.unref(ke)(e.originData,i.ruleKey)||!i.ruleKey)?(Vue.openBlock(),Vue.createElementBlock("div",{key:e.riskInfo.riskCode+"_"+i.name},["checkbox"===i.type?(Vue.openBlock(),Vue.createBlock(l,{key:0,modelValue:n.value[i.valueKey],"onUpdate:modelValue":e=>n.value[i.valueKey]=e,label:i.name,name:i.valueKey,class:"risk-select-field"},{input:Vue.withCtx((()=>[Vue.createElementVNode("div",be,[Vue.createVNode(a,{modelValue:n.value[i.valueKey],"onUpdate:modelValue":[e=>n.value[i.valueKey]=e,e=>((e,i)=>{console.log("-------change",e,i)})(e,i.valueKey)],options:u(i.configKey)},null,8,["modelValue","onUpdate:modelValue","options"])])])),_:2},1032,["modelValue","onUpdate:modelValue","label","name"])):Vue.createCommentVNode("",!0)])):Vue.createCommentVNode("",!0)],64)))),256)}}}),[["__scopeId","data-v-15c494f0"]]);const Oe={class:"com-risk-liabilityinfo"},Be={class:"item-wrap"},Se={key:0},Ne=(e=>(Vue.pushScopeId("data-v-50053b39"),e=e(),Vue.popScopeId(),e))((()=>Vue.createElementVNode("div",{class:"cell-content"},null,-1))),we=Vue.defineComponent({name:"riskLiabilityInfo"});var Fe=r(Vue.defineComponent({...we,props:{dataSource:{default:()=>({})},modelValue:{default:()=>({})},dataSourceFolmulate:{default:()=>({})},params:{default:()=>({amountUnit:"",basicsAmount:"",basicsPremium:"",riskId:""})},defaultValue:{default:()=>({})}},emits:["trialChange"],setup(e,{emit:n}){const u=e,o=l({formInfo:u.dataSource,isCheckList:[],checkValueList:[],liabilityList:[],signLiabilityClick:[]}),r=(e,i)=>{console.log("---click ",e,i),o.value.signLiabilityClick.push({item:e,index:i})},s=(e,i)=>{const a=o.value.liabilityList.map((e=>e.key)),l=0===e.liabilityAttributeValueList.length&&0===e.formula.length,t=o.value.isCheckList[i];l&&-1===a.indexOf(i)&&t&&o.value.liabilityList.push({liabilityValue:e,key:i,isSwitchOn:o.value.isCheckList[i]}),"1"===t?r(e,i):o.value.signLiabilityClick.splice(i,1),-1!==a.indexOf(i)&&o.value.liabilityList.forEach((e=>{e.key===i&&(e.isSwitchOn=o.value.isCheckList[i])}))},c=(e,i)=>{const a=e.liabilityAttributeValueList.filter((e=>e.displayValue===o.value.checkValueList[i])),l=JSON.parse(JSON.stringify(a))[0]||e.liabilityAttributeValueList[0],t={...e,liabilityValue:l};o.value.liabilityList.length>0&&Object.keys(o.value.checkValueList).indexOf(i)&&(o.value.liabilityList=o.value.liabilityList.filter((e=>e.key!==i))),o.value.checkValueList[i]=l.displayValue,o.value.liabilityList.push({liabilityValue:t,key:i,isSwitchOn:"1"})},d=i((()=>y(u.dataSourceFolmulate))),V=(e,i,a)=>{1===a?o.value.liabilityList.push({liabilityValue:{...e,liabilityValue:null==e?void 0:e.liabilityAttributeValueList[0]},key:i,isSwitchOn:"1"}):o.value.liabilityList.push({liabilityValue:{...e,liabilityValue:null==e?void 0:e.liabilityAttributeValueList[0]},key:i,isSwitchOn:"2"})};return t((()=>d.value),((e,i)=>{var a,l;const t=null==(a=u.dataSourceFolmulate)?void 0:a.initialAmount,n=null==(l=u.dataSourceFolmulate)?void 0:l.initialPremium,r={amountUnit:u.params.amountUnit,basicsAmount:t,basicsPremium:n,riskId:u.params.riskId},s=u.dataSource.riskLiabilityInfoVOList.map((async a=>{if(a.formula.length>0&&(t||n)&&((null==e?void 0:e.initialAmount)!==(null==i?void 0:i.initialAmount)||(null==e?void 0:e.initialPremium)!==(null==i?void 0:i.initialPremium))){const{code:e,data:i}=await I({...r,riskLiabilities:[a]});if("10000"===e){if(a.liabilityAttributeValueList=i[0].formulaResult,o.value.signLiabilityClick.length>0){const e=o.value.signLiabilityClick.find((e=>e.item.liabilityCode===a.liabilityCode));e&&c(e.item,e.index)}return{...a,liabilityAttributeValueList:i[0]}}return a}}));console.log("liabilityItem>>>>>>",s),console.log("riskLiabilityInfoVOList>>>>>>",u.dataSource.riskLiabilityInfoVOList)}),{deep:!0,immediate:!0}),t((()=>o.value.liabilityList),(e=>{const i=o.value.liabilityList.filter((e=>"1"===e.isSwitchOn)).map((e=>({...e.liabilityValue})));n("trialChange",i)}),{deep:!0,immediate:!0}),a((()=>{console.log("----mounted"),u.dataSource.riskLiabilityInfoVOList.map(((e,i)=>{const a=e.liabilityAttributeValueList.length>0&&0===e.formula.length&&e.liabilityAttributeValueList[0].displayValue;return o.value.checkValueList[i]||(o.value.checkValueList[i]=a),1!=+e.showFlag&&o.value.liabilityList.push({liabilityValue:e,key:i,isSwitchOn:"1"}),1==+e.showFlag&&(1===e.attributeFlag&&2===e.insureFlag&&0===e.formula.length&&V(e,i,1),1===e.attributeFlag&&1===e.insureFlag&&0===e.formula.length&&V(e,i,2),2===e.attributeFlag&&1===(null==e?void 0:e.liabilityAttributeValueList.length)&&2===e.insureFlag&&V(e,i,1),2===e.attributeFlag&&1===(null==e?void 0:e.liabilityAttributeValueList.length)&&1===e.insureFlag&&V(e,i,2)),null}))})),t((()=>u.defaultValue),(e=>{(null==e?void 0:e.riskCode)&&e.liabilityList&&(o.value.signLiabilityClick=[],u.dataSource.riskLiabilityInfoVOList.forEach(((i,a)=>{var l;const t=null==e?void 0:e.liabilityList.find((e=>e.liabilityCode===i.liabilityCode));console.log("--target lia = ",t),o.value.isCheckList[a]="2",t&&(o.value.isCheckList[a]="1",o.value.checkValueList[a]=null==(l=null==t?void 0:t.liabilityValue)?void 0:l.displayValue,1==+i.showFlag&&2==+i.optionalFlag?s(i,a):r(i,a))})))}),{deep:!0,immediate:!0}),(e,i)=>{const a=Vue.resolveComponent("van-switch"),l=Vue.resolveComponent("ProField"),t=Vue.resolveComponent("ProDivider"),n=Vue.resolveComponent("van-config-provider");return Vue.openBlock(),Vue.createBlock(n,null,{default:Vue.withCtx((()=>[Vue.createElementVNode("div",Oe,[Vue.createElementVNode("div",Be,[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(e.dataSource.riskLiabilityInfoVOList,((e,i)=>(Vue.openBlock(),Vue.createElementBlock("div",{key:i},[1!=+e.showFlag||2===e.attributeFlag&&1===(null==e?void 0:e.liabilityAttributeValueList.length)&&2===e.insureFlag?Vue.createCommentVNode("",!0):(Vue.openBlock(),Vue.createElementBlock("div",Se,[Vue.createVNode(l,{label:`${e.liabilityName}`,"label-width":"40%",name:"insuredRelation",class:"riskliab-select-field"},{input:Vue.withCtx((()=>[1==+e.insureFlag?(Vue.openBlock(),Vue.createBlock(a,{key:0,modelValue:Vue.unref(o).isCheckList[i],"onUpdate:modelValue":e=>Vue.unref(o).isCheckList[i]=e,"active-value":"1","inactive-value":"2",size:"0.74rem",onClick:a=>s(e,i)},null,8,["modelValue","onUpdate:modelValue","onClick"])):Vue.createCommentVNode("",!0)])),_:2},1032,["label"]),1==+Vue.unref(o).isCheckList[i]&&1===e.attributeFlag||1===e.attributeFlag&&2===e.insureFlag?(Vue.openBlock(),Vue.createBlock(l,{key:0,label:e.liabilityAttributeTypeDesc,"label-width":"40%",name:"insuredRelation",class:"riskliab-select-field-children"},{input:Vue.withCtx((()=>[Vue.createVNode(f,{modelValue:Vue.unref(o).checkValueList[i],"onUpdate:modelValue":e=>Vue.unref(o).checkValueList[i]=e,prop:{label:"displayValue",value:"displayValue"},options:(e.formula.length,e.liabilityAttributeValueList),"is-simply":!0,onClick:a=>c(e,i)},null,8,["modelValue","onUpdate:modelValue","options","onClick"])])),_:2},1032,["label"])):Vue.createCommentVNode("",!0)]))])))),128))])]),Ne,Vue.createVNode(t)])),_:1})}}}),[["__scopeId","data-v-50053b39"]]);export{G as B,D as P,Fe as R,te as a,Le as b};
