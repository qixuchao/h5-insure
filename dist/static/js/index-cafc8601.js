var M=Object.defineProperty,z=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var T=(i,s,u)=>s in i?M(i,s,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[s]=u,N=(i,s)=>{for(var u in s||(s={}))W.call(s,u)&&T(i,u,s[u]);if($)for(var u of $(s))G.call(s,u)&&T(i,u,s[u]);return i},k=(i,s)=>z(i,J(s));import{g as w,E as C,M as L,_ as X,r as f,j as v,k as V,m as E,p as g,A as c,z as m,J as Y,L as K,n as O,G as U,F as q,C as S,T as Q,O as Z,a9 as ee,h as te}from"./vendor-667a94d7.js";import{g as oe,m as ne,i as ae}from"./trial-c8488e9f.js";import{p as se}from"./product-44aa0e08.js";import{a as ue}from"./infoCollection-242da9b6.js";import{s as le,c as re}from"./phoneVerify-33af268e.js";import{a3 as ce}from"./index-d0831898.js";import{g as ie,l as me,a as de}from"./utils-3fe1f311.js";import"./trial-32d87b01.js";const fe={class:"agree"},pe=S(" \u6211\u5DF2\u9605\u8BFB\u5E76\u540C\u610F "),ve=w({props:{info:{type:Object,default:()=>{}}},emits:["on-verify"],setup(i,{emit:s}){var y,l;const u=i,r=C({}),F=30,a=C(0),p=C("\u83B7\u53D6\u9A8C\u8BC1\u7801"),h=/\d{9}/,o=/^\d{6}$/,e=L({mobile:(l=(y=u.info)==null?void 0:y.userInfo)==null?void 0:l.mobile,smsCode:"",agree:""}),B=()=>{if(a.value>0)return;a.value=F;const t=()=>{p.value=`${a.value}s`,a.value-=1};t();const n=setInterval(()=>{a.value===0?(p.value="\u83B7\u53D6\u9A8C\u8BC1\u7801",a.value=0,clearInterval(n)):t()},1e3)},I=async()=>{a.value>0||r==null||r.value.validate("mobile").then(async()=>{await le(e.mobile),B()})},b=async()=>{const t=await re(e.mobile,e.smsCode),{data:n}=t;n&&s("on-verify",e)},D=async()=>{r==null||r.value.validate().then(async()=>{b()})};return X(()=>e,()=>{h.test(e.mobile)&&o.test(e.smsCode)&&b()},{deep:!0,immediate:!0}),(t,n)=>{const d=f("van-field"),x=f("van-cell-group"),A=f("van-checkbox"),R=f("ProPDFviewer"),j=f("VanForm");return v(),V(j,{ref_key:"formRef",ref:r},{default:E(()=>{var P;return[g(x,null,{default:E(()=>[g(d,{modelValue:c(e).mobile,"onUpdate:modelValue":n[0]||(n[0]=_=>c(e).mobile=_),name:"mobile",label:"\u624B\u673A\u53F7",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",rules:[{pattern:h,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7"}]},null,8,["modelValue","rules"]),g(d,{modelValue:c(e).smsCode,"onUpdate:modelValue":n[1]||(n[1]=_=>c(e).smsCode=_),name:"smsCode",label:"\u9A8C\u8BC1\u7801",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",rules:[{pattern:o,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u9A8C\u8BC1\u7801"}]},{button:E(()=>[m("div",{class:K(["sms-code",{"count-down":a.value>0}]),onClick:I},Y(p.value),3)]),_:1},8,["modelValue","rules"])]),_:1}),m("div",{class:"submit",onClick:D}),m("div",fe,[g(A,{modelValue:c(e).agree,"onUpdate:modelValue":n[2]||(n[2]=_=>c(e).agree=_),name:"agree",shape:"square"},null,8,["modelValue"]),m("div",null,[pe,(v(!0),O(q,null,U(((P=u.info)==null?void 0:P.attachmentList)||[],(_,H)=>(v(),V(R,{key:H,class:"file-name",title:`\u300A${_.attachmentName}\u300B`,content:_.attachmentUrl,type:"pdf"},null,8,["title","content"]))),128))])])]}),_:1},512)}}}),_e={class:"agree"},ge=S(" \u6211\u5DF2\u9605\u8BFB\u5E76\u540C\u610F "),Fe=w({props:{info:{type:Object,default:()=>{}}},emits:["on-submit"],setup(i,{emit:s}){const u=i,r=C({}),F=/\W/,a=L({name:u.info.userInfo.name,certNo:u.info.userInfo.certNo,agree:""}),p=o=>ce(a.certNo)?!0:"\u8BF7\u586B\u5199\u6B63\u786E\u7684\u8BC1\u4EF6\u53F7",h=()=>{r==null||r.value.validate().then(async o=>{if(!a.agree){Q("\u8BF7\u52FE\u9009\u534F\u8BAE");return}s("on-submit",a)})};return(o,e)=>{const B=f("van-field"),I=f("van-cell-group"),b=f("van-checkbox"),D=f("ProPDFviewer"),y=f("VanForm");return v(),V(y,{ref_key:"formRef",ref:r},{default:E(()=>{var l;return[g(I,null,{default:E(()=>[g(B,{modelValue:c(a).name,"onUpdate:modelValue":e[0]||(e[0]=t=>c(a).name=t),name:"name",label:"\u59D3\u540D",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D",rules:[{pattern:F,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u59D3\u540D"}]},null,8,["modelValue","rules"]),g(B,{modelValue:c(a).certNo,"onUpdate:modelValue":e[1]||(e[1]=t=>c(a).certNo=t),name:"certNo",label:"\u8EAB\u4EFD\u8BC1",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u8EAB\u4EFD\u8BC1\u53F7",rules:[{validator:p}]},null,8,["modelValue","rules"])]),_:1}),m("div",{class:"submit",onClick:h}),m("div",_e,[g(b,{modelValue:c(a).agree,"onUpdate:modelValue":e[2]||(e[2]=t=>c(a).agree=t),name:"agree",shape:"square"},null,8,["modelValue"]),m("div",null,[ge,(v(!0),O(q,null,U(((l=u.info)==null?void 0:l.attachmentList)||[],(t,n)=>(v(),V(D,{key:n,class:"file-name",title:`\u300A${t.attachmentName}\u300B`,content:t.attachmentUrl,type:"pdf"},null,8,["title","content"]))),128))])])]}),_:1},512)}}});var he="/static/assets/title-step1.97cb9efa.png",Be="/static/assets/title-step2.258af5e9.png";const Ce={class:"page-activity-invite"},be=["src"],ye={class:"container"},Ve={class:"main-form"},Ie={class:"title"},De=["src"],$e=w({setup(i){const s=Z(),u=ee(),{productCode:r="7X9",tenantId:F="",extInfo:a}=s.query,p=ie(a),h=C(!0),o=L({title:he,attachmentList:[{}],userInfo:{mobile:p.phoneNo,certNo:"",name:""}}),e=C(),B=C(),I=async l=>{var x,A;o.userInfo.mobile=l.mobile;const t=await oe({holderPhone:o.userInfo.mobile,productCode:r,tenantId:F}),{code:n,data:d}=t;n==="10000"&&(o.userInfo.name=(x=d.tenantOrderHolder)==null?void 0:x.name,o.userInfo.certNo=(A=d.tenantOrderHolder)==null?void 0:A.certNo),o.title=Be,h.value=!1},b=async l=>{o.userInfo.certNo=l.certNo,o.userInfo.name=l.name;const t=de(k(N({tenantId:F,detail:e.value},p),{holder:o.userInfo,insured:k(N({},o.userInfo),{relationToHolder:ue.SELF})})),n=await ne(t),{code:d}=n;d==="10000"&&u.push({path:"/activity/productDetail",query:k(N({},s.query),{tenantId:F,productCode:"BWYL2021",extInfo:JSON.stringify(k(N({},p),{phoneNo:o.userInfo.mobile,certNo:o.userInfo.certNo,name:o.userInfo.name}))})})},D=()=>{let l=[];return B.value.productRiskVoList.forEach(t=>{t.riskDetailVOList.forEach(n=>{l=l.concat(n.riskAttachmentVOList)})}),l},y=async()=>{const l=se({productCode:r,withInsureInfo:!0}),t=ae({productCode:r});Promise.all([l,t]).then(([n,d])=>{n.code==="10000"&&(e.value=n.data),d.code==="10000"&&(B.value=d.data,o.attachmentList=D())})};return te(()=>{y()}),(l,t)=>(v(),O("div",Ce,[m("img",{class:"logo",src:c(me)},null,8,be),m("div",ye,[m("div",Ve,[m("div",Ie,[m("img",{src:c(o).title},null,8,De)]),h.value?(v(),V(ve,{key:0,info:c(o),onOnVerify:I},null,8,["info"])):(v(),V(Fe,{key:1,info:c(o),onOnSubmit:b},null,8,["info"]))])])]))}});export{$e as default};
