var $e=Object.defineProperty,Ye=Object.defineProperties;var Ke=Object.getOwnPropertyDescriptors;var le=Object.getOwnPropertySymbols;var We=Object.prototype.hasOwnProperty,ze=Object.prototype.propertyIsEnumerable;var ie=(F,l,i)=>l in F?$e(F,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):F[l]=i,N=(F,l)=>{for(var i in l||(l={}))We.call(l,i)&&ie(F,i,l[i]);if(le)for(var i of le(l))ze.call(l,i)&&ie(F,i,l[i]);return F},I=(F,l)=>Ye(F,Ke(l));import{g as Ge,a9 as Je,O as je,E as f,M as ce,y as G,T as w,_ as Qe,l as Xe,h as Ze,r as de,af as et,j as b,n as J,p as D,m as j,H as tt,t as R,z as q,A as h,J as me,C as Ee,k as pe,F as at,D as rt,X as ot}from"./vendor-ec22d003.js";import{_ as nt,C as fe,I as he,H as ut,a0 as st,a2 as ye}from"./index-cb391873.js";import{a as Q}from"./order-26db6dbf.js";import{S,R as P,f as lt}from"./infoCollection-192ba138.js";import{p as ve,i as it,s as ct,g as dt,u as mt,a as pt}from"./trial-50d1ba05.js";import{p as ft}from"./product-aa7700cb.js";import{g as X,a as Fe,t as ht,b as yt}from"./utils-e2a25950.js";import{t as vt}from"./theme-ea709837.js";import{d as De,B as Ft,D as Dt,G as gt,S as Et,H as Ct,P as _t,U as Nt,_ as It,W as wt,o as ge,a as V}from"./auth-076cb32c.js";import{_ as Bt}from"./index-91f95db1.js";import"./utils-b6782348.js";import"./trial-54e07952.js";import"./index-500e03d0.js";import"./bankCard-0e4ce564.js";import"./phoneVerify-eeb51c4c.js";const At={key:0},Tt={class:"page-internet-product-detail"},Ot={class:"info"},bt={class:"footer-button"},St={class:"price"},Pt=Ee(" \u603B\u4FDD\u8D39"),kt={key:0},xt=Ge({setup(F){const l=Je(),i=je(),{productCode:$="BWYL2021",tenantId:v,orderNo:_,phoneNo:Z,agentCode:k="",saleChannelId:Ce,paymentMethod:_e,certNo:ee,name:te,pageCode:Y,upgradeCode:Ne,from:ae}=i.query;console.log(i.query,"route.query");const re=f(),c=f(),B=f(),E=f(),x=Y==="payBack",Ie=f(!1),U=f(!1),H=f(!1),we=f(0),K=f(!1),W=f(!1),M=f({show:!1,html:""});let z="";const r=ce({holder:{certNo:ee,certType:fe.CERT,mobile:Z,name:te,socialFlag:S.HAS},insured:{certNo:ee,certType:fe.CERT,name:te,socialFlag:S.HAS,relationToHolder:P.SELF},paymentMethod:_e,renewalDK:"Y",paymentFrequency:lt.MONTH}),L=f(De),C=f(De),s=ce({showInsure:!x,canInsure:!1,canUpgrade:!1}),Be=G(()=>{var a,e;return((e=(a=c.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:e.attachmentVOList.filter(t=>t.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),Ae=G(()=>{var a,e;return((e=(a=c.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:e.attachmentVOList.filter(t=>t.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),oe=G(()=>{if(r.holder.certNo){const a=X(r.holder.certNo,"year"),e=he(r.holder.certNo);if(a<18)return w("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E18\u5C81\uFF01"),!1;if(r.insured.certNo&&r.insured.relationToHolder===P.MATE){const t=he(r.insured.certNo);if(e===t)return w("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(r.insured.certNo){const a=X(r.holder.certNo,"day"),e=X(r.holder.certNo,"year");if(r.insured.relationToHolder===P.CHILD&&a<30)return w("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(r.insured.relationToHolder===P.PARENT&&e>=71)return w("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E70\u5C81\uFF01"),!1}return!0}),Te=()=>{const{holder:{certNo:a,mobile:e,name:t,socialFlag:u},insured:{certNo:o,name:n,socialFlag:m,relationToHolder:p},paymentMethod:y}=r;return ut(o)&&!!m},ne=()=>{l.push({path:"/internet/guaranteeUpgrade",query:I(N({},i.query),{tenantId:v,productCode:"BWYL2022",orderNo:_,agentCode:k})})},Oe=()=>{W.value=!1},be=()=>{C.value=L.value},Se=()=>{C.value=I(N({},C.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},Pe=async a=>{w.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const e=await mt(a),{code:t}=e;if(t==="10000"){w.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const u=await pt({orderNo:a.orderNo,tenantId:v}),{data:o}=u;u.code==="10000"&&(o.type===2?(M.value={show:!0,html:o.paymentUrl},console.log("data.paymentUrl",M.value),ot(()=>{console.log("document.forms",document.forms);const n=document.getElementById("cashierSubmit");n==null||n.addEventListener("submit",m=>{m.preventDefault()}),n==null||n.submit()})):window.location.href=o.paymentUrl)}s.canInsure=!0}catch{s.canInsure=!0}},ke=a=>{var o,n;const e=JSON.parse((n=(o=B.value)==null?void 0:o.productBasicInfoVO)==null?void 0:n.extInfo);let t="";return e.endorsementFlag===1&&(t=`&upgradeCode=${e.endorsementCode}`),`${ye}/internet/productDetail?tenantId=${v}&productCode=${$}&orderNo=${a}&agentCode=${k}&pageCode=payBack${t}&from=${ae||"normal"}`},xe=a=>`${ye}/internet/payFail?tenantId=${v}&orderNo=${a}&agentCode=${k}&pageCode=payBack&from=${ae||"normal"}`,Ue=async a=>{const e=yt({tenantId:v,saleUserId:k,saleChannelId:Ce,detail:c.value,insureDetail:B.value,paymentMethod:r.paymentMethod,renewalDK:r.renewalDK,iseeBizNo:z,successJumpUrl:"",premium:E.value,holder:r.holder,insured:r.insured,tenantOrderRiskList:a,orderStatus:"",orderTopStatus:""});try{const t=await ct(e),{code:u,data:o}=t;u==="10000"&&Pe(I(N({},e),{orderNo:o.data,extInfo:{extraInfo:{renewalDK:r.renewalDK,paymentMethod:r.paymentMethod,paymentFrequency:r.paymentFrequency,successJumpUrl:ke(o.data),failUrl:xe(o.data)},iseeBizNo:z}}))}catch{s.canInsure=!0}},He=async()=>{if(!oe.value)return{};const{calcData:a,riskVOList:e}=Fe({holder:r.holder,insured:r.insured,tenantId:v,paymentFrequency:r.paymentFrequency,productDetail:c.value,insureDetail:B.value},!0),t=await ve(a),{code:u,data:o}=t;return u==="10000"?(E.value=o.premium,{condition:e,data:o}):{}},Me=()=>new Promise((a,e)=>{var t,u;(u=(t=re.value)==null?void 0:t.validateForm)==null||u.call(t).then(async()=>{if(!oe.value)return;const{calcData:o,riskVOList:n}=Fe({holder:r.holder,insured:r.insured,tenantId:v,paymentFrequency:r.paymentFrequency,productDetail:c.value,insureDetail:B.value},!0),m=await ve(o),{code:p,data:y}=m;p==="10000"?(E.value=y.premium,a({condition:n,data:y})):e(new Error)}).catch(()=>{s.canInsure=!0})}),ue=async()=>{var a;if(x){ne();return}s.canInsure=!1;try{const{condition:e,data:t}=await Me(),u={},o=(m=[])=>{(m||[]).forEach(p=>{var y;u[p.riskCode]=p,((y=p.riskPremiumDetailVOList)==null?void 0:y.length)&&o(p.riskPremiumDetailVOList)})};o(t.riskPremiumDetailVOList);const n=ht({tenantId:v,riskList:e,riskPremium:u,productId:(a=c.value)==null?void 0:a.id});Ue(n)}catch{s.canInsure=!0}},Le=a=>{a==="allFalse"?(U.value=!1,ue(),s.canInsure=!0):rt.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"}).then(()=>{window.history.back()})},Re=()=>{Ie.value=!0,H.value=!1,U.value=!0};Qe([()=>r.insured.certNo,()=>r.insured.socialFlag],Xe.exports.debounce(()=>{r.insured.certNo&&r.insured.socialFlag&&Y!=="payBack"&&Te()&&He()},500),{deep:!0,immediate:!0});const se=async()=>{var u,o,n,m,p,y,A,T;const a=await dt({orderNo:_,tenantId:v}),{code:e,data:t}=a;if(e==="10000"){const{tenantOrderHolder:d,tenantOrderInsuredList:g,extInfo:O}=t;if(!x){Object.assign(r,{holder:{certNo:d.certNo,certType:d.certType,mobile:d.mobile,name:d.name,socialFlag:S.HAS},insured:{certNo:d.certNo,certType:d.certType,name:d.name,socialFlag:S.HAS,relationToHolder:P.SELF},paymentMethod:O.extraInfo.paymentMethod,paymentFrequency:O.extraInfo.paymentFrequency,renewalDK:"Y"}),s.canInsure=!0;return}Object.assign(r,{holder:{certNo:d.certNo,certType:d.certType,mobile:d.mobile,name:d.name,socialFlag:S.HAS},insured:{certNo:g==null?void 0:g[0].certNo,certType:(u=g[0])==null?void 0:u.certType,name:(o=g[0])==null?void 0:o.name,socialFlag:(m=(n=g[0])==null?void 0:n.extInfo)==null?void 0:m.hasSocialInsurance,relationToHolder:(p=g[0])==null?void 0:p.relationToHolder},paymentMethod:O.extraInfo.paymentMethod,paymentFrequency:O.extraInfo.paymentFrequency,renewalDK:O.extraInfo.renewalDK||"N"}),E.value=(T=(A=(y=g[0])==null?void 0:y.tenantOrderProductList)==null?void 0:A[0])==null?void 0:T.premium,(t.orderStatus===Q.ACCEPT_POLICY||t.orderStatus===Q.PAYMENT_SUCCESS)&&(s.canUpgrade=!0,K.value=!1,W.value=!0),t.orderStatus===Q.PAYING&&(K.value=!0,setTimeout(()=>{se()},3*1e3))}},qe=async()=>{const a=ft({productCode:$,withInsureInfo:!0,tenantId:v}),e=it({productCode:$});await Promise.all([a,e]).then(([t,u])=>{var o;t.code==="10000"&&(c.value=t.data,document.title=((o=t.data)==null?void 0:o.productFullName)||""),u.code==="10000"&&(B.value=u.data)}),_&&se()},Ve=()=>{x?(C.value=ge,L.value=ge,console.log("\u652F\u4ED8\u5B8C\u6210\u8FDB\u5165")):_?(console.log("\u6295\u4FDD\u94FE\u63A5-\u6765\u4ED8\u94B1"),C.value=I(N({},V),{paymentFrequencyDisable:!0}),L.value=V,s.canInsure=!0):Z||_||(console.log("\u6295\u4FDD\u94FE\u63A5"),C.value=I(N({},V),{paymentFrequencyDisable:!0}),L.value=V,s.canInsure=!0)};return Ze(()=>{Ve(),qe(),setTimeout(async()=>{z=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(a,e)=>{const t=de("van-button"),u=de("van-config-provider"),o=et("dompurify-html");return b(),J(at,null,[D(u,{"theme-vars":h(vt)},{default:j(()=>{var n,m,p,y,A,T,d;return[M.value.show?tt((b(),J("div",At,null,512)),[[o,M.value.html]]):R("",!0),q("div",Tt,[q("div",Ot,[D(Ft,{url:(m=(n=c.value)==null?void 0:n.tenantProductInsureVO)==null?void 0:m.banner[0]},null,8,["url"]),D(Dt,{"product-name":(p=c.value)==null?void 0:p.productFullName,"product-desc":(A=(y=c.value)==null?void 0:y.showConfigVO)==null?void 0:A.desc},null,8,["product-name","product-desc"])]),D(gt,{"guarantee-list":(d=(T=c.value)==null?void 0:T.tenantProductInsureVO)==null?void 0:d.titleAndDescVOS},null,8,["guarantee-list"]),D(Et,{detail:c.value},{form:j(()=>[D(Ct,{ref_key:"formRef",ref:re,disable:!h(s).showInsure,"form-auth":C.value,"form-info":h(r),premium:E.value,"product-detail":c.value,payments:[1],"payment-method":[0],onOnReset:be,onOnUpdate:Se},null,8,["disable","form-auth","form-info","premium","product-detail"])]),_:1},8,["detail"]),q("div",bt,[q("div",St,[Pt,E.value?(b(),J("span",kt,"\uFFE5"+me(h(st)(E.value))+"/\u6708",1)):R("",!0)]),D(t,{type:"primary",class:"right",disabled:!(h(s).canInsure||h(s).canUpgrade),onClick:ue},{default:j(()=>[Ee(me(h(s).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),h(Y)!=="payBack"?(b(),pe(_t,{key:1,"product-detail":c.value},null,8,["product-detail"])):R("",!0),D(Nt,{"order-no":h(_),"tenant-id":h(v),"upgrade-code":h(Ne),"is-show":W.value,onOnConfirm:ne,onOnClose:Oe},null,8,["order-no","tenant-id","upgrade-code","is-show"])]}),_:1},8,["theme-vars"]),D(It,{show:U.value,"onUpdate:show":e[0]||(e[0]=n=>U.value=n),"content-list":h(Be),"active-index":0,onOnConfirmHealth:Le},null,8,["show","content-list"]),H.value?(b(),pe(Bt,{key:0,show:H.value,"onUpdate:show":e[1]||(e[1]=n=>H.value=n),"content-list":h(Ae),"active-index":we.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9",onSubmit:Re},null,8,["show","content-list","active-index"])):R("",!0),D(wt,{"is-show":K.value},null,8,["is-show"])],64)}}});var Xt=nt(xt,[["__scopeId","data-v-099234f2"]]);export{Xt as default};
