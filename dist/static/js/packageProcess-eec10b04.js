var na=Object.defineProperty,sa=Object.defineProperties;var la=Object.getOwnPropertyDescriptors;var Fe=Object.getOwnPropertySymbols;var ia=Object.prototype.hasOwnProperty,ca=Object.prototype.propertyIsEnumerable;var Ee=(g,d,v)=>d in g?na(g,d,{enumerable:!0,configurable:!0,writable:!0,value:v}):g[d]=v,b=(g,d)=>{for(var v in d||(d={}))ia.call(d,v)&&Ee(g,v,d[v]);if(Fe)for(var v of Fe(d))ca.call(d,v)&&Ee(g,v,d[v]);return g},L=(g,d)=>sa(g,la(d));import{g as da,a9 as ma,O as fa,E as c,M as ge,y as De,_ as Ce,l as pa,h as va,r as j,af as ha,j as k,n as X,p as D,m as Q,H as ya,t as Z,z as q,A as f,J as Y,k as ee,C as Ue,F as Fa,T as p,D as Ea,X as ga}from"./vendor-17026bfd.js";import{_ as Da,C as Ne,a1 as Ca,I as Na,a4 as Ie,J as _e}from"./index-a23cba14.js";import{a as ae}from"./order-bc7fdfb4.js";import{S as $,R as I,f as Be,I as te}from"./infoCollection-6ed40f4c.js";import{p as we,i as Ia,u as _a,a as Ba,s as wa,g as Aa}from"./trial-d9cc63b7.js";import{p as ka}from"./product-54f70e52.js";import{a as Ae,o as ke,t as Ta,v as re,g as Te,b as Pa,j as Pe}from"./utils-e436d7c5.js";import{t as Sa}from"./theme-ea709837.js";import{d as Se,B as Oa,D as Ua,G as ba,S as La,H as Ha,P as Ra,U as xa,_ as Ma,W as Va,a as Oe}from"./auth-1448b7a2.js";import{_ as qa}from"./index-25d55b40.js";import"./trial-f0f6ae58.js";import"./index-560156f5.js";import"./bankCard-219cc17e.js";import"./phoneVerify-d8201741.js";const Ya={key:0},$a={class:"page-internet-product-detail"},Ka={class:"info"},Wa={class:"footer-button"},za={class:"price"},Ga=Ue(" \u603B\u4FDD\u8D39"),Ja={key:0},ja=da({setup(g){const d=ma(),v=fa(),{productCode:oe="BWYL2021",tenantId:E,orderNo:_,phoneNo:be,agentCode:H="",saleChannelId:Le,paymentMethod:He,certNo:ue,name:ne,pageCode:Re,from:xe}=v.query,se=c(),m=c(),R=c(),h=c(),K=Re==="payBack";c(!1);const B=c(!1),C=c(!1),le=c(0),W=c(!1),z=c(!1),x=c({show:!1,html:""}),T=c({}),G=c(!1);let J="";const e=ge({holder:{certNo:ue,certType:Ne.CERT,mobile:be,name:ne,socialFlag:$.HAS},insured:{certNo:ue,certType:Ne.CERT,name:ne,socialFlag:$.HAS,relationToHolder:I.SELF},paymentMethod:He,renewalDK:"Y",paymentFrequency:Be.YEAR,packageProductList:[],mobileSmsCode:""}),ie=c(Se),P=c(Se),l=ge({showInsure:!K,canInsure:!1,canUpgrade:!1}),Me=De(()=>{var t,a;return((a=(t=m.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:a.attachmentVOList.filter(r=>r.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),Ve=De(()=>{var t,a;return((a=(t=m.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:a.attachmentVOList.filter(r=>r.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),qe=()=>{if(e.holder.certNo){const t=_e(e.holder.certNo);if(re(e.holder.certNo,18,"year"))return p("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E18\u5C81\uFF01"),!1;if(e.insured.certNo&&e.insured.relationToHolder===I.MATE){const a=_e(e.insured.certNo);if(t===a)return p("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(e.insured.certNo){if(e.insured.relationToHolder===I.CHILD&&re(e.insured.certNo,30,"day"))return p("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(e.insured.relationToHolder===I.PARENT&&!re(e.insured.certNo,71,"year"))return p("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E70\u5C81\uFF01"),!1}if([I.CHILD,I.PARENT].includes(e.insured.relationToHolder)){const t=Te(e.holder.certNo,"year"),a=Te(e.insured.certNo,"year");if(e.insured.relationToHolder===I.CHILD&&t-a<18)return p("\u6295\u4FDD\u4EBA\u548C\u5B50\u5973\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1;if(e.insured.relationToHolder===I.PARENT&&a-t<18)return p("\u6295\u4FDD\u4EBA\u548C\u7236\u6BCD\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1}return!0},Ye=()=>{const{holder:{certNo:t,mobile:a,name:r,socialFlag:u},insured:{certNo:o,name:n,socialFlag:s,relationToHolder:y},paymentMethod:F}=e;return!!(Na(o)&&!!s)},ce=()=>{d.push({path:"/internet/guaranteeUpgrade",query:L(b({},v.query),{tenantId:E,productCode:"BWYL2022",orderNo:_,agentCode:H})})},$e=()=>{z.value=!1},Ke=()=>{P.value=ie.value},We=()=>{P.value=L(b({},P.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},ze=async t=>{p.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0,duration:0});try{const a=await _a(t),{code:r}=a;if(r==="10000"){const u=await Ba({orderNo:t.orderNo,tenantId:E}),{data:o}=u;u.code==="10000"&&(o.type===2?(x.value={show:!0,html:o.paymentUrl},console.log("data.paymentUrl",x.value),ga(()=>{console.log("document.forms",document.forms);const n=document.getElementById("cashierSubmit");n==null||n.addEventListener("submit",s=>{s.preventDefault()}),n==null||n.submit()})):window.location.href=o.paymentUrl)}l.canInsure=!0}catch{l.canInsure=!0}finally{p.clear()}},Ge=t=>`${Ie}/pay?orderNo=${t}&saleUserId=${H}&tenantId=${E}`,Je=t=>`${Ie}/internet/payFail?tenantId=${E}&orderNo=${t}&agentCode=${H}&pageCode=payBack&from=${xe||"normal"}`,je=t=>{le.value=t,C.value=!0},Xe=async t=>{const a=Pa({tenantId:E,saleUserId:H,saleChannelId:Le,detail:m.value,insureDetail:R.value,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,renewalDK:e.renewalDK,iseeBizNo:J,successJumpUrl:"",premium:h.value,holder:e.holder,insured:e.insured,tenantOrderRiskList:t,orderStatus:"",orderTopStatus:"",orderNo:_});try{const r=await wa(a),{code:u,data:o}=r;C.value=!1,B.value=!1,u==="10000"&&(p.clear(),T.value={orderNo:o.data,order:a},C.value=!0,je(0))}catch{p.clear(),l.canInsure=!0}},Qe=async()=>{const{calcData:t,riskVOList:a}=Ae({holder:e.holder,insured:e.insured,tenantId:E,productDetail:m.value,insureDetail:R.value,paymentFrequency:e.paymentFrequency,packageRiskIdList:ke(e.packageProductList)},!1,Pe);if(!Array.isArray(a)||a.length<1)return p("\u88AB\u4FDD\u4EBA\u5E74\u9F84\u9700\u572830\u5929(\u542B) - 70\u5C81(\u542B)\u4E4B\u95F4\uFF01"),h.value=null,{};G.value=!0;const r=await we(t);G.value=!1;const{code:u,data:o}=r;return u==="10000"?e.insured.certNo?(h.value=o.premium,{condition:a,data:o}):(h.value=null,{condition:a,data:o}):(h.value=null,{})},Ze=()=>new Promise((t,a)=>{var r,u;(u=(r=se.value)==null?void 0:r.validateForm)==null||u.call(r).then(async()=>{if(!qe()){l.canInsure=!0;return}const{calcData:o,riskVOList:n}=Ae({holder:e.holder,insured:e.insured,tenantId:E,productDetail:m.value,insureDetail:R.value,paymentFrequency:e.paymentFrequency,packageRiskIdList:ke(e.packageProductList)},!1,Pe);(!Array.isArray(n)||n.length<1)&&(p("\u88AB\u4FDD\u4EBA\u5E74\u9F84\u9700\u572830\u5929(\u542B) - 70\u5C81(\u542B)\u4E4B\u95F4\uFF01"),h.value=null,a(new Error));const s=await we(o),{code:y,data:F}=s;y==="10000"?(h.value=F.premium,t({condition:n,data:F})):(h.value=null,a(new Error))}).catch(()=>{l.canInsure=!0})}),ea=async()=>{var t;if(K){ce();return}try{p.loading({message:"\u8BA2\u5355\u751F\u6210\u4E2D...",forbidClick:!0,duration:0});const{condition:a,data:r}=await Ze(),u={},o=(s=[])=>{(s||[]).forEach(y=>{var F;u[y.riskCode]=y,((F=y.riskPremiumDetailVOList)==null?void 0:F.length)&&o(y.riskPremiumDetailVOList)})};o(r.riskPremiumDetailVOList);const n=Ta({tenantId:E,riskList:a,riskPremium:u,productId:(t=m.value)==null?void 0:t.id});Xe(n)}catch{l.canInsure=!0}finally{p.clear()}},aa=t=>{t==="allFalse"?(B.value=!1,l.canInsure=!0,ze(L(b({},T.value.order),{orderNo:T.value.orderNo,extInfo:{extraInfo:{renewalDK:e.renewalDK,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,successJumpUrl:Ge(T.value.orderNo),failUrl:Je(T.value.orderNo)},iseeBizNo:J}}))):Ea.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"}).then(()=>{window.history.back()}).catch(()=>{l.canInsure=!0})},de=()=>{C.value=!1,B.value=!1,l.canInsure=!0},ta=()=>{C.value=!1,B.value=!0};Ce([()=>e.insured.certNo,()=>e.insured.socialFlag,()=>e.packageProductList,()=>e.paymentFrequency],pa.exports.debounce(()=>{e.insured.certNo&&e.insured.socialFlag&&Ye()&&Qe()},500),{deep:!0,immediate:!0}),Ce(()=>e.insured.certNo,()=>{e.insured.certNo||(h.value=null)});const me=async()=>{var u,o,n,s,y,F,w,S,O,U,fe,pe,ve,he,ye;const t=await Aa({orderNo:_,tenantId:E}),{code:a,data:r}=t;if(a==="10000"){const{tenantOrderHolder:N,tenantOrderInsuredList:i,extInfo:A}=r;if(!K){const ua=(((o=(u=i[0])==null?void 0:u.tenantOrderProductList[0])==null?void 0:o.tenantOrderRiskList)||[]).map(M=>{var V;return((V=M.extInfo)==null?void 0:V.riskId)||""});e.packageProductList.forEach(M=>{M.value=M.productRiskVoList.filter(V=>ua.includes(V.id)).length>0?te.INSURE:te.UN_INSURE}),Object.assign(e,{holder:{certNo:N.certNo,certType:N.certType,mobile:N.mobile,name:N.name,socialFlag:$.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(n=i[0])==null?void 0:n.certType,name:(s=i[0])==null?void 0:s.name,socialFlag:(F=(y=i[0])==null?void 0:y.extInfo)==null?void 0:F.hasSocialInsurance,relationToHolder:(w=i[0])==null?void 0:w.relationToHolder},paymentMethod:A.extraInfo.paymentMethod,paymentFrequency:A.extraInfo.paymentFrequency,renewalDK:A.extraInfo.renewalDK||"N"}),l.canInsure=!0;return}Object.assign(e,{holder:{certNo:N.certNo,certType:N.certType,mobile:N.mobile,name:N.name,socialFlag:$.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(S=i[0])==null?void 0:S.certType,name:(O=i[0])==null?void 0:O.name,socialFlag:(fe=(U=i[0])==null?void 0:U.extInfo)==null?void 0:fe.hasSocialInsurance,relationToHolder:(pe=i[0])==null?void 0:pe.relationToHolder},paymentMethod:A.extraInfo.paymentMethod,paymentFrequency:A.extraInfo.paymentFrequency,renewalDK:A.extraInfo.renewalDK||"N"}),h.value=(ye=(he=(ve=i[0])==null?void 0:ve.tenantOrderProductList)==null?void 0:he[0])==null?void 0:ye.premium,(r.orderStatus===ae.ACCEPT_POLICY||r.orderStatus===ae.PAYMENT_SUCCESS)&&(l.canUpgrade=!0,W.value=!1,z.value=!0),r.orderStatus===ae.PAYING&&(W.value=!0,setTimeout(()=>{me()},3*1e3))}},ra=async()=>{const t=ka({productCode:oe,withInsureInfo:!0,tenantId:E}),a=Ia({productCode:oe});await Promise.all([t,a]).then(([r,u])=>{var o,n;r.code==="10000"&&(m.value=r.data,document.title=((o=r.data)==null?void 0:o.productFullName)||""),u.code==="10000"&&(e.packageProductList=(((n=u.data)==null?void 0:n.packageProductVOList)||[]).map(s=>L(b({},s),{value:te.UN_INSURE,disabled:!1})),R.value=u.data)}),_&&me()},oa=()=>{console.log("\u6295\u4FDD\u94FE\u63A5"),P.value=Oe,ie.value=Oe,l.canInsure=!0};return va(()=>{oa(),ra(),setTimeout(async()=>{J=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(t,a)=>{const r=j("van-loading"),u=j("van-button"),o=j("van-config-provider"),n=ha("dompurify-html");return k(),X(Fa,null,[D(o,{"theme-vars":f(Sa)},{default:Q(()=>{var s,y,F,w,S,O,U;return[x.value.show?ya((k(),X("div",Ya,null,512)),[[n,x.value.html]]):Z("",!0),q("div",$a,[q("div",Ka,[D(Oa,{url:(y=(s=m.value)==null?void 0:s.tenantProductInsureVO)==null?void 0:y.banner[0]},null,8,["url"]),D(Ua,{"product-name":(F=m.value)==null?void 0:F.productFullName,"product-desc":(S=(w=m.value)==null?void 0:w.showConfigVO)==null?void 0:S.desc},null,8,["product-name","product-desc"])]),D(ba,{"show-service-config":"","guarantee-list":(U=(O=m.value)==null?void 0:O.tenantProductInsureVO)==null?void 0:U.titleAndDescVOS},null,8,["guarantee-list"]),D(La,{detail:m.value},{form:Q(()=>[D(Ha,{ref_key:"formRef",ref:se,"is-show-package":"",disable:!f(l).showInsure,"form-auth":P.value,"form-info":f(e),"product-detail":m.value,onOnReset:Ke,onOnUpdate:We},null,8,["disable","form-auth","form-info","product-detail"])]),_:1},8,["detail"]),q("div",Wa,[q("div",za,[Ga,G.value?(k(),ee(r,{key:1,class:"premium-loading",type:"spinner"})):(k(),X("span",Ja,Y(h.value?"\uFFE5":"")+Y(f(Ca)(h.value))+" "+Y(h.value?f(e).paymentFrequency==f(Be).YEAR?"\u5143/\u5E74":"\u5143/\u6708":""),1))]),D(u,{type:"primary",class:"right",disabled:!(f(l).canInsure||f(l).canUpgrade),onClick:ea},{default:Q(()=>[Ue(Y(f(l).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),f(_)?Z("",!0):(k(),ee(Ra,{key:1,"product-detail":m.value},null,8,["product-detail"])),D(xa,{"order-no":f(_),"tenant-id":f(E),"is-show":z.value,onOnConfirm:ce,onOnClose:$e},null,8,["order-no","tenant-id","is-show"])]}),_:1},8,["theme-vars"]),D(Ma,{show:B.value,"onUpdate:show":a[0]||(a[0]=s=>B.value=s),"content-list":f(Me),"active-index":0,onOnConfirmHealth:aa,onOnCloseHealth:de},null,8,["show","content-list"]),C.value?(k(),ee(qa,{key:0,show:C.value,"onUpdate:show":a[1]||(a[1]=s=>C.value=s),"content-list":f(Ve),"active-index":le.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9","force-read-cound":2,"on-close-file-preview":"",onSubmit:ta,onOnCloseFilePreview:de},null,8,["show","content-list","active-index"])):Z("",!0),D(Va,{"is-show":W.value},null,8,["is-show"])],64)}}});var mt=Da(ja,[["__scopeId","data-v-5caed779"]]);export{mt as default};
