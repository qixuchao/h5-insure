import{d as e,r as a,E as t,o,p as r,w as l,a as d,g as s,u as n,_ as i,d$ as u,j as c,cd as I,k as A,c as p,F as m,s as v,v as f,e as C,n as g,f as D,d7 as h,bo as E,bp as S,dS as T,ae as P,dh as x,h as w,i as L,l as b,b as U,q as y,c5 as G,ad as k,T as N,cm as Y,c9 as O,b9 as Q,e0 as R}from"./index-97c91859.js";import{a as M,e as B}from"./product-80ffd015.js";import{n as V,o as W,g as j,i as H}from"./trial-aac5df38.js";import{P as z}from"./index-effe3d7c.js";import{d as F,s as K}from"./core-0d45ac8c.js";import{O as q}from"./infoCollection-f01ff1c0.js";import{T as J}from"./constant-8927d485.js";import{u as Z}from"./useOrder-e11c9801.js";import{u as X}from"./useThread-637a02aa.js";import"./utils-b2956012.js";import"./createProposal-fb65ed67.js";import"./trial-c0a963cf.js";import"./PolicyInfo-965ab610.js";import"./cloneDeep-a0a80033.js";const _={class:"pro-curtain"},$=["src"],ee=e({name:"curtain"});var ae=i(e({...ee,props:{show:{type:Boolean,default:!0}},emits:["close"],setup(e,{emit:i}){const c=e,I=a({show:c.show});return t((()=>c.show),(()=>{I.show=c.show}),{immediate:!0}),(e,a)=>{const t=u;return o(),r(t,{show:n(I).show},{default:l((()=>[d("div",_,[s(e.$slots,"default",{},void 0,!0),d("img",{class:"close",src:n("data:image/png;base64,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"),onClick:a[0]||(a[0]=e=>i("close"))},null,8,$)])])),_:3},8,["show"])}}}),[["__scopeId","data-v-697ee98a"]]);const te={class:"guarantee-list"},oe=(e=>(E("data-v-186e639c"),e=e(),S(),e))((()=>d("div",{class:"title"},"保障内容",-1))),re=["src"],le=e({name:"guaranteeContent"});var de=i(e({...le,props:{dataSource:{default:()=>[]},isShowClose:{type:Boolean,default:!1},count:{default:10}},setup(e){const a=e,l=c(a.dataSource||[]),[s,i]=I(!1),u=A((()=>{var e;return!(!l.value||!(null==(e=l.value)?void 0:e.length))&&(l.value.length>a.count&&(!!a.isShowClose||!s.value))})),E=()=>{i()},S=A((()=>{var e;return l.value&&(null==(e=l.value)?void 0:e.length)?l.value.length<=a.count||s.value?l.value:l.value.slice(0,a.count):[]}));return t((()=>a.dataSource),(()=>{l.value=a.dataSource})),(e,a)=>{const t=h;return o(),p("div",te,[oe,(o(!0),p(m,null,v(n(S),((e,a)=>(o(),r(t,{key:a,title:e.title,content:e.desc,border:!1},null,8,["title","content"])))),128)),n(u)?(o(),p("div",{key:0,class:"show-more",onClick:E},[f(C(n(s)?"收起":"查看更多")+" ",1),d("img",{src:n("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAjNJREFUOE+1VEtPE1EUPufM9GXKCnWlqAQZuhEff8CNxpYdSReVatIWJMYI7FkYF+wtxsSCBWNLY4JhZxHd+AdMqhs6PmJJWMkPsO303mPmQs10GJuawOxu5tzvfK9chCP+8Ijx4HgAVyZGskgQEgIXJkvbO//D+sXtyDlN43mW8Du9Vp1VDPNJ4xkiRoC5DhKz6VJ1qxfQ/MTITUSeA8QgM29niuYDBbh6/XyQzwZmAPCWfUbmLdAb2dTLWt0LeDE6FOjr12YYMfp3freRTX2s1Ts8VBuJZwEwxBJ2SMDj1OtqzQn66u7gQIt9jwDwgq1IAixOFs137ZlDobgvMPPTzNrXTaUkcfEG6zTXbaFnyrakcL/+EBBi+5vlB2Cy2meW8j35mk+8LOlaG8VII9v0kA3LzA1gXmwz9vJXAS4njRQC+qnR2kivf99zDubigwO+gH8egbUWwsJUwfzp/L8SHzolA/o4Azeniubqfm3uGBlgPMMITSnE5r3St0ovtXmeHB7VkWLI4Afk3UzBzCvA3DXwkWHEiPCyqgFxxQqGy9NLnywvYHtejxhRALyiHJZckWGzPL0EVoeHzo3Mcs8i8eZ+4cevDgsSwydJwzgBngYAS0hRdio6FErOdYGkKKcOLFhOGJdQxzFbor2QmnLd7blnym5JguUXImohw1WVNsjP4kTfWy9LutZGMSIcQwT/gWzLyfiftemWqG2BT6NxZqYmtTbcnrrvHs972Evnep35AykjACSCRaPlAAAAAElFTkSuQmCC"),class:g(["icon",{showMore:n(s)}])},null,10,re)])):D("",!0)])}}}),[["__scopeId","data-v-186e639c"]]);const se=P([{value:T.PENDING,label:"待处理"},{value:T.PAYING,label:"订单未完成，逾期将失效"},{value:T.PAYMENT_SUCCESS,label:"支付成功"},{value:T.PAYMENT_FAILED,label:"支付失败"},{value:T.CANCELED,label:"已失效"},{value:T.ACCEPT_POLICY,label:"投保成功"},{value:T.INSURER_REJECT,label:"保司拒保"},{value:T.TIMEOUT,label:"订单已经关闭"},{value:T.UNDER_WRITING_SUCCESS,label:"核保通过"},{value:T.NOTE,label:"照会"},{value:T.MANUAL_UNDERWRITING,label:"人工核保"},{value:T.INSURANCE_PROCESSING,label:"保司处理中"},{value:T.ACCEPTING_POLICY,label:"待承保"}]),ne={[T.ACCEPT_POLICY]:"恭喜 您已成功购买保障",[T.CANCELED]:"赠险保单已失效",[T.TIMEOUT]:"请您重新提交订单"};const ie={class:"page-pay-result"},ue={class:"header"},ce={class:"product-status"},Ie=["innerHTML"],Ae={class:"prodouct-container"},pe={class:"product-card"},me={class:"product-name"},ve={class:"label"},fe={class:"value"},Ce=["src"],ge=["src"];var De=i(e({__name:"index",setup(e){const t=x(),s=w(),i=L(),{tenantId:u,from:I="other",orderNo:f,preview:g,productCode:h,channelCode:E="",templateView:S}=i.query;let P="";const _=a({insureDetail:{},detail:{},orderDetail:{},showOrderDetail:!1,guaranteeItemVOS:[],pageInfo:{title:"",desc:"",insureList:[],productImage:"",notificationImage:""},timeDown:{},templateId:"2"}),$=c(!1),ee=c(),te=A((()=>[T.ACCEPT_POLICY,T.CANCELED,T.PAYMENT_SUCCESS].includes(_.orderDetail.orderStatus)?"下载保单":[T.PAYING,T.PAYMENT_FAILED].includes(_.orderDetail.orderStatus)?"立即支付":T.TIMEOUT===_.orderDetail.orderStatus?"重下一单":"")),oe=A((()=>E||_.orderDetail.extInfo.extraInfo.channelCode)),re=A((()=>!!g)),le=async(e=!1,a="")=>{var t,o,r,l;try{const{templateId:d}=_.orderDetail.extInfo.extraInfo;delete _.orderDetail.extInfo.extraInfo.templateId;const n={insurerCode:e?null==(t=ee.value)?void 0:t.insurerCode:_.orderDetail.venderCode,productCode:e?null==(o=ee.value)?void 0:o.productCode:P,tenantId:u,agencyCode:_.orderDetail.agencyId,agentCode:_.orderDetail.agentCode,saleChannelId:null==(l=null==(r=_.orderDetail.extInfo)?void 0:r.extraInfo)?void 0:l.saleChannelId};if(d===J.UPGRADE)return n.extraInfo=decodeURIComponent(JSON.stringify({..._.orderDetail.extInfo.extraInfo,channelCode:oe.value,templateId:d})),n.orderNo=f,re.value&&(n.productCode="ZXYS2023"),void s.push(`/baseInsurance/upgrade?${G.stringify(n)}`);n.extraMap={..._.orderDetail.extInfo.extraInfo,channelCode:oe.value},e&&(n.extraMap.promotion=a),delete n.extraMap.templateId;const i=await V(n);if("10000"===i.code){if(!e){const{holder:e,insuredList:a}=_.orderDetail;k.set(q,{holder:e,insuredList:a})}window.location.href=i.data||""}}catch(d){console.log(d)}},De=async()=>{if("下载保单"===te.value){if(e="预览模式无法下载保单",!re.value||(N(e),0)){const e=await F({orderNo:f,tenantId:u});"10000"===e.code?window.location.href=e.data||"":N("电子保单单生成中，请稍后再试")}}else"立即支付"===te.value?W({..._.orderDetail,extInfo:{..._.orderDetail.extInfo,redirectUrl:window.location.href}}).then((e=>{"10000"===e.code&&K(e.data)})):"重下一单"===te.value&&le(!1);var e},he=()=>{var e,a,t,o,r,l,d,s,n,i,u,c,I;[T.PAYMENT_SUCCESS,T.ACCEPT_POLICY].includes(_.orderDetail.orderStatus)&&(_.orderDetail.orderStatus=T.ACCEPT_POLICY),_.pageInfo.title=se[_.orderDetail.orderStatus],_.pageInfo.desc=ne[_.orderDetail.orderStatus],O((null==(a=null==(e=_.detail)?void 0:e.PRODUCT_LIST)?void 0:a.title)||""),_.templateId=_.orderDetail.extInfo.templateId||"4";let A="";if("2"===_.templateId.toString()?_.orderDetail.insuredList[0].productList.forEach((e=>A?null:(e.riskList.forEach((e=>{1!==e.riskType||A||(A=e.coveragePeriodDesc)})),!1))):(_.pageInfo.insureList=[{label:(_.templateId===J.UPGRADE&&"1"===(null==(r=null==(o=null==(t=_.orderDetail)?void 0:t.extInfo)?void 0:o.extraInfo)?void 0:r.isUpgrade)?"下":"本")+"期缴费金额",value:`${_.orderDetail.orderAmount}元`}],A=`${Q(_.orderDetail.commencementTime).format("YYYY.MM.DD")}到${Q(_.orderDetail.expiryDate).format("YYYY.MM.DD")}`),_.pageInfo.insureList=[..._.pageInfo.insureList,{label:"被保险人",value:null==(s=null==(d=null==(l=_.orderDetail)?void 0:l.insuredList)?void 0:d[0])?void 0:s.name},{label:"保障期间",value:A||""}],_.templateId=_.orderDetail.extInfo.templateId,T.PAYING===_.orderDetail.orderStatus){const e=(null==(i=null==(n=_.orderDetail.tenantOrderPaymentInfoList)?void 0:n[0])?void 0:i.paymentExpiryDate)||Q().add(8.5,"hour");_.timeDown=R({time:Q(e).diff(new Date,"millisecond")}),_.timeDown.start()}const p=(null==(u=_.orderDetail.insuredList)?void 0:u[0].planCode)||"";_.guaranteeItemVOS=(null==(I=null==(c=_.detail)?void 0:c.GUARANTEE.find((e=>!e.planCode||e.planCode===p)))?void 0:I.data)||[]};let Ee;Ee=X({start(){console.log("轮询中..."),j({orderNo:f,tenantId:u,withProductInfo:!0},{loading:!1}).then((e=>{const{data:a}=e;"10000"===e.code&&a.orderStatus!==T.PAYING&&(_.orderDetail=a,he(),Ee.stop())}))},stop(){console.log("轮询结束,结束方式：配置轮询次数")},number:5,time:2e3});const Se=async()=>{var e,a,t,o;const r=await new Promise(((e,a)=>{if(re.value){const a=Z({extInfo:{buttonCode:"EVENT_SHORT_saveOrder",pageCode:"productInfo",iseeBizNo:"",templateId:S,extraInfo:{templateId:S}}});a.value.orderAmount=(1e3*Math.random()).toFixed(2),a.value.orderStatus="acceptPolicy",a.value.insuredList[0].name="小安",a.value.commencementTime=Q().format("YYYY-MM-DD HH:mm:ss"),a.value.expiryDate=Q().add(1,"year").format("YYYY-MM-DD HH:mm:ss"),a.value.insuredList[0].productList[0]={productCode:h,riskList:[{riskType:1,insurancePeriodValue:"1",insurancePeriodType:3}]},e({code:"10000",data:n(a)})}else j({orderNo:f,tenantId:u,withProductInfo:!0}).then((t=>{"10000"===t.code?e(t):a()}))}));if(console.log(r,"orderRes"),"10000"===r.code){if(_.orderDetail=r.data,P=(null==(o=null==(t=null==(a=null==(e=r.data.insuredList)?void 0:e[0])?void 0:a.productList)?void 0:t[0])?void 0:o.productCode)||"",!P)return"";const l=!Number.isNaN(+u)&&M({productCode:P}),d=H({productCode:P});(async e=>{var a,t;const{code:o,data:r}=await B({productCode:e});"10000"===o&&(ee.value=r,"free"!==I&&[T.PAYING,T.TIMEOUT].includes(_.orderDetail.orderStatus)?_.showOrderDetail=!0:r.productCode&&(_.pageInfo.notificationImage=(null==(a=null==r?void 0:r.notificationImage)?void 0:a[0])||"",_.pageInfo.productImage=(null==(t=null==r?void 0:r.productImage)?void 0:t[0])||"",$.value=!!_.pageInfo.notificationImage))})(P),Promise.all([l,d]).then((([e,a])=>{"10000"===e.code&&(_.detail=e.data,e.data.BASIC_INFO&&e.data.BASIC_INFO.themeType&&Y(e.data.BASIC_INFO.themeType)),"10000"===a.code&&(_.insureDetail=a.data),_.orderDetail.orderStatus===T.PAYING&&Ee.run(),he()}))}return""},Te=A((()=>_.pageInfo.desc));return b((()=>{Se()})),(e,a)=>{var s;return o(),p(m,null,[d("div",ie,[d("div",ue,[d("div",ce,C(n(_).pageInfo.title),1),"重下一单"!==n(te)||"3"!==n(_).templateId.toString()?(o(),p("div",{key:0,class:"desc",innerHTML:n(Te)},null,8,Ie)):D("",!0)]),d("div",Ae,[d("div",pe,[d("div",me,C((null==(s=n(_).insureDetail)?void 0:s.productName)||""),1),(o(!0),p(m,null,v(n(_).pageInfo.insureList,((e,a)=>(o(),p("div",{key:a,class:"list"},[d("span",ve,C(e.label),1),d("span",fe,C(e.value),1)])))),128)),"重下一单"===n(te)&&"3"===n(_).templateId.toString()||!n(te)?D("",!0):(o(),r(z,{key:0,"theme-vars":n(t),class:"btn",text:n(te),onClick:De},null,8,["theme-vars","text"]))]),n(_).pageInfo.productImage?(o(),p("img",{key:0,class:"product-img",src:n(_).pageInfo.productImage,onClick:a[0]||(a[0]=e=>le(!0,"GDGGW"))},null,8,Ce)):D("",!0),n(_).showOrderDetail?(o(),r(de,{key:1,"is-show-close":"",count:5,"data-source":n(_).guaranteeItemVOS},null,8,["data-source"])):D("",!0)])]),U(ae,{show:n($),"onUpdate:show":a[2]||(a[2]=e=>y($)?$.value=e:null),onClose:a[3]||(a[3]=e=>$.value=!1)},{default:l((()=>[d("img",{class:"jump-img",src:n(_).pageInfo.notificationImage,style:{display:"block"},onClick:a[1]||(a[1]=e=>le(!0,"TCGGW"))},null,8,ge)])),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-58aa9768"]]);export{De as default};
