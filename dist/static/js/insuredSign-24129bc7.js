import{d as e,h as i,g as s,bx as a,i as r,av as t,o as n,c as o,b as d,a as l,u,F as c,n as f,l as p,q as m,w as g,a8 as v,aB as h,bN as b,s as j,T as S,aa as y,bK as I,am as L}from"./index-a701edf7.js";import{c as N}from"./product-ad97da6e.js";import{g as O,m as D}from"./trial-be4721b4.js";import{_ as w,N as E}from"./notice-85ad535c.js";import{u as k}from"./useOrder-0f74fb68.js";import{M as C}from"./product-585b0e6f.js";import{s as V,a as q}from"./verify-b8d06411.js";import{t as x}from"./index-873f5512.js";import"./PayInfo-01655823.js";import{P as R}from"./constants-71331306.js";import{p as _}from"./utils-0af605ab.js";import"./useAttachment-35fb6d62.js";import"./utils-e08fe015.js";import"./infoCollection-c01830c2.js";import"./trial-d97dbb4f.js";import"./index-a521a3ec.js";import"./merge-e7788e50.js";import"./keysIn-131bbce9.js";import"./isObjectLike-a9798079.js";import"./_getTag-0507d0b1.js";import"./debounce-6981b306.js";import"./phoneVerify-307a6997.js";import"./index-f8d021e2.js";import"./useDicData-c5252af3.js";import"./bankCard-3afe4cad.js";const T={class:"long-verify"},U={class:"header"},M={class:"verify-content"},P={class:"footer-button footer-bar"},A=e({__name:"insuredSign",setup(e){const A=i(),G=s(),{tenantId:H,orderNo:z,orderCode:B,extraInfo:F,isShare:$,insurerCode:J,preview:K}=A.query;let Q={};try{Q=JSON.parse(decodeURIComponent(F))}catch(se){}const W=k(),X=`${window.origin}/baseInsurance/long/phoneVerify?${a.stringify({...A.query,orderNo:B||z})}`,Y=r(),Z=r({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:""},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{}},agent:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:""}}),ee=r({sign:[],verify:[],scribing:""}),ie=()=>{if(K)return void h(R.SIGN,A.query);const e=[];Y.value&&(($?ee.value.sign.includes("5"):ee.value.sign.includes("3"))&&e.push(...(Y.value||[]).map((e=>e.validateSign()))),ee.value.verify.includes("2")&&e.push(...(Y.value||[]).map((e=>e.validateVerify())))),Promise.all(e).then((e=>{q({bizObjectId:W.value.insuredList.map((e=>e.id)),bizObjectType:b.INSURED,orderId:W.value.id,tenantId:H}).then((({code:e,data:i})=>{"10000"===e&&i&&G.push({path:j.sign,query:A.query})}))})).catch((e=>{S(e.message)}))};r({imgUrl:"",desc:"",title:"",link:X});return t((()=>{(async()=>{let e={};const{code:i,data:s}=await O({orderNo:B||z,tenantId:H});"10000"===i&&(Object.assign(W.value,s),Z.value.insured.personalInfo=s.insuredList.map((e=>(e.isCert=1,e))),e=_(s.insuredList[0].productList),s.tenantOrderAttachmentList.forEach((e=>{e.objectType===E.INSURED&&(Z.value.insured.signData[e.objectId]=e.fileBase64)}))),N({productCodeList:[]}).then((({code:e,data:i})=>{var s;if("10000"===e){const{productMaterialMap:e}=(null==(s=i.productMaterialPlanVOList)?void 0:s[0])||{};(Object.values(e||{})||[]).flat().filter((e=>e.materialType===C.SIGN)).forEach((e=>{e.noticeObject===E.AGENT?Z.value.agent.fileList.push(e):e.noticeObject===E.HOlDER?Z.value.holder.fileList.push(e):e.noticeObject===E.INSURED&&Z.value.insured.fileList.push(e)}))}})),D(e).then((({data:e,code:i})=>{if("10000"===i){const{signInfo:i}=x(e.productFactor);i.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((i=>{e.required&&ee.value.sign.push(i.code),"1"===i.code?Z.value.agent.isSign=!0:"2"===i.code?Z.value.holder.isSign=!0:"3"===i.code?Z.value.insured.isSign=!0:"4"===i.code?Z.value.holder.isShareSign=!0:"5"===i.code&&(Z.value.insured.isShareSign=!0)}))}))}}))})()})),(e,i)=>{const s=y,a=I,r=L;return n(),o("div",T,[d(s),l("div",U,[d(a,{type:"warning",title:"尊敬的客户，本次投保需要进行身份认证",content:"本产品投保需要对投保人、被保人进行实名认证，您购买本产品的累计总保费已超过20万，按监管要求，需要提供投保人、被保人、指定受益人证件影像，本产品非本人投保且带身故责任、需对投保人、被保人（成人）的投保意愿进行签字确认。"})]),l("div",M,[!u($)||u(Z).insured.isShareSign?(n(!0),o(c,{key:0},f(u(Z).insured.personalInfo||[],(e=>(n(),p(w,{key:e.id,ref_for:!0,ref_key:"insuredSignRef",ref:Y,"data-source":[],"order-detail":u(W),"sign-string":u(Z).insured.signData[e.id],"show-sign":u($)?u(Z).insured.isShareSign:u(Z).insured.isSign,"show-verify":u(Z).insured.isVerify,"file-list":u(Z).insured.fileList,"personal-info":e||{},title:"被保人",onHandleSign:i=>((e,i,s)=>{var a;V(e,i,null==(a=W.value)?void 0:a.id,H,s)})("INSURED",i,e.id)},null,8,["order-detail","sign-string","show-sign","show-verify","file-list","personal-info","onHandleSign"])))),128)):m("",!0)]),l("div",P,[d(r,{type:"primary",class:"submit-btn",onClick:ie},{default:g((()=>[v("确定")])),_:1})])])}}});export{A as default};
