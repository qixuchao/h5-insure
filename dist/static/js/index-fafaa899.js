import{h as e,a8 as a,N as t,C as o,d as s,L as n,j as i,r as l,k as r,l as d,m as c,Q as u,x as p,E as v,J as f,z as y,F as g,y as m,I as C,B as h,T}from"./vendor-a7f495fb.js";import{_ as b,a as k,E as j,g as I,A as D,t as N,n as q,N as x,b as L}from"./index-099ce742.js";import{l as _,g as A}from"./inform-7263b1f3.js";import{s as E}from"./useStorage-142ac6a2.js";import{s as S}from"./verify-ff7b8149.js";import{d as P,A as B,e as M}from"./notice-a4a1c218.js";const Y={class:"date"},G={class:"inform-file"},R={class:"tips"},U=h(" 您的签名将被用于"),V=h("文件 "),w={class:"footer-button"},z=h("下一步");var F=b(e({setup(e){const h=a(),b=t(),{productCode:F="MMBBSF",agentCode:O="65434444",tenantId:$="9991000007",agencyCode:J="3311222",insurerCode:Q="zhongan",productCategory:W=1,templateId:H=1,orderNo:K="2022080217103534947"}=b.query,X=o(null),Z=o(!1),ee=s().format("YYYY-MM-DD"),ae=o(""),te=o(),oe=()=>{var e;null==(e=X.value)||e.clear()},se=n({noticeType:"",materialSource:"",noticeList:[],pageData:{}});i((()=>{I({orderNo:K,saleUserId:O,tenantId:$}).then((({code:e,data:a})=>{"10000"===e&&(Object.assign(se.pageData,a),a.tenantOrderAttachmentList.forEach((e=>{e.category===D.ELECTRIC_SIGN&&e.objectType===N.AGENT&&X.value.setDataURL(e.fileBase64)})))})),_({insurerCode:Q,orderNo:K,productCategory:W,tenantId:$,noticeType:B,objectType:M}).then((({code:e,data:a})=>{"10000"===e&&(se.noticeList=[...se.noticeList,...a])}))}));const ne=()=>{var e,a;if(!(se.noticeList&&se.noticeList.every((e=>1===e.isDone))))return void T("请完成所有告知进行下一步");if(null==(e=X.value)?void 0:e.isEmpty())return void T("请完成代理人签字进行下一步");if(!Z.value)return void T("请勾选同意签名");const t=null==(a=X.value)?void 0:a.save();S("AGENT",t,se.pageData.id,$).then((e=>{e&&q({...se.pageData,extInfo:{...se.pageData.extInfo,templateId:H,pageCode:"salesNotice",buttonCode:x.salesNotice},venderCode:Q}).then((({code:e,data:a})=>{"10000"===e&&"jumpToPage"===a.pageAction.pageAction&&h.push({path:L[a.pageAction.data.nextPageCode],query:{...b.query}})}))}))};return(e,a)=>{const t=l("van-cell"),o=l("ProSign"),s=l("van-checkbox"),n=l("van-button"),i=l("ProPageWrap");return r(),d(i,{class:"page-salesman-inform"},{default:c((()=>[u(k,{title:"营销员告知书"},{default:c((()=>[(r(!0),p(g,null,v(y(se).noticeList,(e=>(r(),d(t,{key:e.id,class:f({"is-active":2===e.isDone}),title:`《${e.title}》`,"is-link":"",value:""+(1===e.isDone?"已完成":"去完成"),onClick:a=>{return t=e,E.set("questionData",t),void h.push({path:"/healthNotice",query:{questionnaireType:t.questionnaireType,...b.query}});var t}},null,8,["class","title","value","onClick"])))),128))])),_:1}),u(k,{title:"营销员签字","show-divider":!1,"show-line":!1},{extra:c((()=>[m("div",{class:"resign",onClick:oe},"重签")])),default:c((()=>[u(o,{ref_key:"agentSignRef",ref:X,selector:"sign2"},null,512),m("div",Y,"签名日期： "+C(y(ee)),1)])),_:1}),m("div",G,[u(s,{modelValue:Z.value,"onUpdate:modelValue":a[0]||(a[0]=e=>Z.value=e),shape:"square"},null,8,["modelValue"]),m("p",R,[U,(r(!0),p(g,null,v(y(se).noticeList,((e,a)=>(r(),d(j,{key:a,class:"file",title:`《${e.title}》`,content:te.value,type:ae.value,onClick:a=>(e=>{const{id:a,objectType:t}=e,o={1:"pdf",2:"richText",3:"link"};A({insurerCode:Q,id:a,objectType:t,productCategory:W,orderNo:K,tenantId:$}).then((({code:e,data:a})=>{"10000"===e&&((null==a?void 0:a[0].questionType)===P?(ae.value="question",te.value=a):(1===(null==a?void 0:a[0].textType)&&(null==a?void 0:a[0].content.includes("png"))?ae.value="picture":ae.value=o[null==a?void 0:a[0].textType],te.value=null==a?void 0:a[0].content))}))})(e)},null,8,["title","content","type","onClick"])))),128)),V])]),m("div",w,[u(n,{type:"primary",block:"",onClick:ne},{default:c((()=>[z])),_:1})])])),_:1})}}}),[["__scopeId","data-v-1d1c7e90"]]);export{F as default};
