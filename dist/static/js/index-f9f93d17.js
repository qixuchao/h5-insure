var je=Object.defineProperty,Qe=Object.defineProperties;var Xe=Object.getOwnPropertyDescriptors;var fe=Object.getOwnPropertySymbols;var Ze=Object.prototype.hasOwnProperty,et=Object.prototype.propertyIsEnumerable;var he=(v,c,p)=>c in v?je(v,c,{enumerable:!0,configurable:!0,writable:!0,value:p}):v[c]=p,B=(v,c)=>{for(var p in c||(c={}))Ze.call(c,p)&&he(v,p,c[p]);if(fe)for(var p of fe(c))et.call(c,p)&&he(v,p,c[p]);return v},w=(v,c)=>Qe(v,Xe(c));import{g as tt,a9 as at,O as rt,E as h,M as ye,y as q,T as C,_ as ot,l as ut,h as nt,r as Fe,af as st,j as A,n as Q,p as D,m as X,H as lt,t as k,z as $,k as Z,A as f,J as ve,C as we,F as it,D as ct,X as dt}from"./vendor-ec22d003.js";import{_ as mt,C as De,I as Ee,H as pt,a0 as ft,a1 as Ce}from"./index-5890fb09.js";import{a as ee}from"./order-26db6dbf.js";import{S as Y,R as g,f as ht}from"./infoCollection-192ba138.js";import{p as ge,i as yt,s as Ft,g as vt,u as Dt,a as Et}from"./trial-a0b60b81.js";import{p as Ct}from"./product-6412de05.js";import{g as x,a as Ie,t as gt,b as It}from"./utils-dec89dfb.js";import{f as Nt,a as Ne}from"./utils-b77f2acb.js";import{t as _t}from"./theme-ea709837.js";import{d as _e,B as Bt,D as wt,G as At,S as Tt,H as Pt,P as Ot,U as St,_ as bt,W as Ht,p as Be,a as K}from"./auth-fa0b7e4a.js";import{_ as kt}from"./index-2e8ba848.js";import"./utils-b6782348.js";import"./trial-351a01a6.js";import"./index-9466176b.js";import"./bankCard-0e4ce564.js";import"./phoneVerify-4ca2ed07.js";const xt={key:0},Ut={class:"page-internet-product-detail"},Vt={class:"info"},Lt={class:"footer-button"},Mt={class:"price"},Rt=we(" \u603B\u4FDD\u8D39"),qt={key:0},$t=tt({setup(v){const c=at(),p=rt(),{productCode:W="BWYL2021",tenantId:y,orderNo:I,phoneNo:te,agentCode:T="",saleChannelId:Ae,paymentMethod:Te,certNo:ae,name:re,pageCode:z,upgradeCode:Pe,from:oe}=p.query;console.log(p.query,"route.query");const ue=h(),s=h(),P=h(),N=h(),U=z==="payBack",Oe=h(!1),V=h(!1),L=h(!1),Se=h(0),G=h(!1),J=h(!1),M=h({show:!1,html:""});let j="";const a=ye({holder:{certNo:ae,certType:De.CERT,mobile:te,name:re,socialFlag:Y.HAS},insured:{certNo:ae,certType:De.CERT,name:re,socialFlag:Y.HAS,relationToHolder:g.SELF},paymentMethod:Te,renewalDK:"Y",paymentFrequency:ht.MONTH}),R=h(_e),_=h(_e),d=ye({showInsure:!U,canInsure:!1,canUpgrade:!1}),be=q(()=>{var t,e;return((e=(t=s.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:e.attachmentVOList.filter(r=>r.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),He=q(()=>{var t,e,r,n,o,u,l,i;return[...((e=(t=s.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:e.titleAndDescVOS)||[],{desc:`\u51FA\u751F${Nt((n=(r=s.value)==null?void 0:r.tenantProductInsureVO)==null?void 0:n.holderAgeLimit)}`,title:"\u6295\u4FDD\u5E74\u9F84"},{desc:Ne((u=(o=s.value)==null?void 0:o.tenantProductInsureVO)==null?void 0:u.insurancePeriodValues),title:"\u4FDD\u969C\u671F\u9650"},{desc:Ne((i=(l=s.value)==null?void 0:l.tenantProductInsureVO)==null?void 0:i.waitPeriod)||"",title:"\u7B49\u5F85\u671F"}]}),ke=q(()=>{var t,e;return((e=(t=s.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:e.attachmentVOList.filter(r=>r.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),ne=q(()=>{if(a.holder.certNo){const t=x(a.holder.certNo,"year"),e=Ee(a.holder.certNo);if(t<18)return C("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E18\u5C81\uFF01"),!1;if(a.insured.certNo&&a.insured.relationToHolder===g.MATE){const r=Ee(a.insured.certNo);if(e===r)return C("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(a.insured.certNo){const t=x(a.insured.certNo,"day"),e=x(a.insured.certNo,"year");if(a.insured.relationToHolder===g.CHILD&&t<30)return C("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(a.insured.relationToHolder===g.PARENT&&e>=71)return C("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E70\u5C81\uFF01"),!1}if([g.CHILD,g.PARENT].includes(a.insured.relationToHolder)){const t=x(a.holder.certNo,"year"),e=x(a.insured.certNo,"year");if(a.insured.relationToHolder===g.CHILD&&t-e<18)return C("\u6295\u4FDD\u4EBA\u548C\u5B50\u5973\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1;if(a.insured.relationToHolder===g.PARENT&&e-t<18)return C("\u6295\u4FDD\u4EBA\u548C\u7236\u6BCD\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1}return!0}),xe=()=>{const{holder:{certNo:t,mobile:e,name:r,socialFlag:n},insured:{certNo:o,name:u,socialFlag:l,relationToHolder:i},paymentMethod:F}=a;return pt(o)&&!!l},se=()=>{c.push({path:"/internet/guaranteeUpgrade",query:w(B({},p.query),{tenantId:y,productCode:"BWYL2022",orderNo:I,agentCode:T})})},Ue=()=>{J.value=!1,c.replace(`/pay?orderNo=${I}&saleUserId=${T}&tenantId=${y}`)},Ve=()=>{_.value=R.value},Le=()=>{_.value=w(B({},_.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},Me=async t=>{C.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const e=await Dt(t),{code:r}=e;if(r==="10000"){C.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const n=await Et({orderNo:t.orderNo,tenantId:y}),{data:o}=n;n.code==="10000"&&(o.type===2?(M.value={show:!0,html:o.paymentUrl},console.log("data.paymentUrl",M.value),dt(()=>{console.log("document.forms",document.forms);const u=document.getElementById("cashierSubmit");u==null||u.addEventListener("submit",l=>{l.preventDefault()}),u==null||u.submit()})):window.location.href=o.paymentUrl)}d.canInsure=!0}catch{d.canInsure=!0}},Re=t=>{var o,u;const e=JSON.parse((u=(o=P.value)==null?void 0:o.productBasicInfoVO)==null?void 0:u.extInfo);let r="";return e.endorsementFlag===1&&(r=`&upgradeCode=${e.endorsementCode}`),`${Ce}/internet/productDetail?tenantId=${y}&productCode=${W}&orderNo=${t}&agentCode=${T}&pageCode=payBack${r}&from=${oe||"normal"}`},qe=t=>`${Ce}/internet/payFail?tenantId=${y}&orderNo=${t}&agentCode=${T}&pageCode=payBack&from=${oe||"normal"}`,$e=async t=>{const e=It({tenantId:y,saleUserId:T,saleChannelId:Ae,detail:s.value,insureDetail:P.value,paymentMethod:a.paymentMethod,renewalDK:a.renewalDK,iseeBizNo:j,successJumpUrl:"",premium:N.value,holder:a.holder,insured:a.insured,tenantOrderRiskList:t,orderStatus:"",orderTopStatus:""});try{const r=await Ft(e),{code:n,data:o}=r;n==="10000"&&Me(w(B({},e),{orderNo:o.data,extInfo:{extraInfo:{renewalDK:a.renewalDK,paymentMethod:a.paymentMethod,paymentFrequency:a.paymentFrequency,successJumpUrl:Re(o.data),failUrl:qe(o.data)},iseeBizNo:j}}))}catch{d.canInsure=!0}},Ye=async()=>{if(!ne.value)return{};const{calcData:t,riskVOList:e}=Ie({holder:a.holder,insured:a.insured,tenantId:y,paymentFrequency:a.paymentFrequency,productDetail:s.value,insureDetail:P.value},!0),r=await ge(t),{code:n,data:o}=r;return n==="10000"?(N.value=o.premium,{condition:e,data:o}):{}},Ke=()=>new Promise((t,e)=>{var r,n;(n=(r=ue.value)==null?void 0:r.validateForm)==null||n.call(r).then(async()=>{if(!ne.value)return;const{calcData:o,riskVOList:u}=Ie({holder:a.holder,insured:a.insured,tenantId:y,paymentFrequency:a.paymentFrequency,productDetail:s.value,insureDetail:P.value},!0),l=await ge(o),{code:i,data:F}=l;i==="10000"?(N.value=F.premium,t({condition:u,data:F})):e(new Error)}).catch(()=>{d.canInsure=!0})}),le=async()=>{var t;if(U){se();return}d.canInsure=!1;try{const{condition:e,data:r}=await Ke(),n={},o=(l=[])=>{(l||[]).forEach(i=>{var F;n[i.riskCode]=i,((F=i.riskPremiumDetailVOList)==null?void 0:F.length)&&o(i.riskPremiumDetailVOList)})};o(r.riskPremiumDetailVOList);const u=gt({tenantId:y,riskList:e,riskPremium:n,productId:(t=s.value)==null?void 0:t.id});$e(u)}catch{d.canInsure=!0}},We=t=>{t==="allFalse"?(V.value=!1,le(),d.canInsure=!0):ct.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"}).then(()=>{window.history.back()})},ze=()=>{Oe.value=!0,L.value=!1,V.value=!0};ot([()=>a.insured.certNo,()=>a.insured.socialFlag],ut.exports.debounce(()=>{a.insured.certNo&&a.insured.socialFlag&&z!=="payBack"&&xe()&&Ye()},500),{deep:!0,immediate:!0});const ie=async()=>{var n,o,u,l,i,F,O,S,b,ce,de,me,pe;const t=await vt({orderNo:I,tenantId:y}),{code:e,data:r}=t;if(e==="10000"){const{tenantOrderHolder:E,tenantOrderInsuredList:m,extInfo:H}=r;if(!U){Object.assign(a,{holder:{certNo:E.certNo,certType:E.certType,mobile:E.mobile,name:E.name,socialFlag:Y.HAS},insured:{certNo:m==null?void 0:m[0].certNo,certType:(n=m[0])==null?void 0:n.certType,name:(o=m[0])==null?void 0:o.name,socialFlag:(l=(u=m[0])==null?void 0:u.extInfo)==null?void 0:l.hasSocialInsurance,relationToHolder:(i=m[0])==null?void 0:i.relationToHolder},paymentMethod:H.extraInfo.paymentMethod,paymentFrequency:H.extraInfo.paymentFrequency,renewalDK:"Y"}),d.canInsure=!0;return}Object.assign(a,{holder:{certNo:E.certNo,certType:E.certType,mobile:E.mobile,name:E.name,socialFlag:Y.HAS},insured:{certNo:m==null?void 0:m[0].certNo,certType:(F=m[0])==null?void 0:F.certType,name:(O=m[0])==null?void 0:O.name,socialFlag:(b=(S=m[0])==null?void 0:S.extInfo)==null?void 0:b.hasSocialInsurance,relationToHolder:(ce=m[0])==null?void 0:ce.relationToHolder},paymentMethod:H.extraInfo.paymentMethod,paymentFrequency:H.extraInfo.paymentFrequency,renewalDK:H.extraInfo.renewalDK||"N"}),N.value=(pe=(me=(de=m[0])==null?void 0:de.tenantOrderProductList)==null?void 0:me[0])==null?void 0:pe.premium,(r.orderStatus===ee.ACCEPT_POLICY||r.orderStatus===ee.PAYMENT_SUCCESS)&&(d.canUpgrade=!0,G.value=!1,J.value=!0),r.orderStatus===ee.PAYING&&(G.value=!0,setTimeout(()=>{ie()},3*1e3))}},Ge=async()=>{const t=Ct({productCode:W,withInsureInfo:!0,tenantId:y}),e=yt({productCode:W});await Promise.all([t,e]).then(([r,n])=>{var o;r.code==="10000"&&(s.value=r.data,document.title=((o=r.data)==null?void 0:o.productFullName)||""),n.code==="10000"&&(P.value=n.data)}),I&&ie()},Je=()=>{U?(_.value=Be,R.value=Be,console.log("\u652F\u4ED8\u5B8C\u6210\u8FDB\u5165")):I?(console.log("\u6295\u4FDD\u94FE\u63A5-\u6765\u4ED8\u94B1"),_.value=w(B({},K),{paymentFrequencyDisable:!0}),R.value=K,d.canInsure=!0):te||I||(console.log("\u6295\u4FDD\u94FE\u63A5"),_.value=w(B({},K),{paymentFrequencyDisable:!0}),R.value=K,d.canInsure=!0)};return nt(()=>{Je(),Ge(),setTimeout(async()=>{j=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(t,e)=>{const r=Fe("van-button"),n=Fe("van-config-provider"),o=st("dompurify-html");return A(),Q(it,null,[D(n,{"theme-vars":f(_t)},{default:X(()=>{var u,l,i,F,O,S,b;return[M.value.show?lt((A(),Q("div",xt,null,512)),[[o,M.value.html]]):k("",!0),$("div",Ut,[$("div",Vt,[D(Bt,{url:(l=(u=s.value)==null?void 0:u.tenantProductInsureVO)==null?void 0:l.banner[0]},null,8,["url"]),D(wt,{"product-name":(i=s.value)==null?void 0:i.productFullName,"product-desc":(O=(F=s.value)==null?void 0:F.showConfigVO)==null?void 0:O.desc},null,8,["product-name","product-desc"])]),((b=(S=s.value)==null?void 0:S.tenantProductInsureVO)==null?void 0:b.titleAndDescVOS)?(A(),Z(At,{key:0,"guarantee-list":f(He)},null,8,["guarantee-list"])):k("",!0),D(Tt,{detail:s.value},{form:X(()=>[D(Pt,{ref_key:"formRef",ref:ue,disable:!f(d).showInsure,"form-auth":_.value,"form-info":f(a),premium:N.value,"product-detail":s.value,payments:[1],"payment-method":[0],onOnReset:Ve,onOnUpdate:Le},null,8,["disable","form-auth","form-info","premium","product-detail"])]),_:1},8,["detail"]),$("div",Lt,[$("div",Mt,[Rt,N.value?(A(),Q("span",qt,"\uFFE5"+ve(f(ft)(N.value))+"/\u6708",1)):k("",!0)]),D(r,{type:"primary",class:"right",disabled:!(f(d).canInsure||f(d).canUpgrade),onClick:le},{default:X(()=>[we(ve(f(d).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),f(z)!=="payBack"?(A(),Z(Ot,{key:1,"product-detail":s.value},null,8,["product-detail"])):k("",!0),D(St,{"order-no":f(I),"tenant-id":f(y),"upgrade-code":f(Pe),"is-show":J.value,onOnConfirm:se,onOnClose:Ue},null,8,["order-no","tenant-id","upgrade-code","is-show"])]}),_:1},8,["theme-vars"]),D(bt,{show:V.value,"onUpdate:show":e[0]||(e[0]=u=>V.value=u),"content-list":f(be),"active-index":0,onOnConfirmHealth:We},null,8,["show","content-list"]),L.value?(A(),Z(kt,{key:0,show:L.value,"onUpdate:show":e[1]||(e[1]=u=>L.value=u),"content-list":f(ke),"active-index":Se.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9",onSubmit:ze},null,8,["show","content-list","active-index"])):k("",!0),D(Ht,{"is-show":G.value},null,8,["is-show"])],64)}}});var sa=mt($t,[["__scopeId","data-v-34ec6486"]]);export{sa as default};
