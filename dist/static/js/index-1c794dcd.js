var W=Object.defineProperty,X=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var $=(a,u,o)=>u in a?W(a,u,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[u]=o,k=(a,u)=>{for(var o in u||(u={}))ee.call(u,o)&&$(a,o,u[o]);if(M)for(var o of M(u))te.call(u,o)&&$(a,o,u[o]);return a},D=(a,u)=>X(a,Z(u));import{a as oe,g as se,E as h,M as re,a6 as q,y as ae,_ as I,o as ie,r as v,j as P,n as y,p as m,m as A,z as R,A as d,k as ne,t as C,a4 as ue,a5 as ce,C as de}from"./vendor-1bbe4951.js";import{P as J,R as le}from"./index-48c9ea17.js";import{i as pe,p as fe}from"./trial-0bdfed81.js";import{_ as me,g as ke}from"./index-04f90493.js";const Se=oe({id:"createProposal",state:()=>({proposalInfo:{},trialData:[],excludeProduct:[],proposalId:0}),actions:{setProposalInfo(a){this.$state.proposalInfo=a},setTrialData(a){this.$state.trialData=a},setExcludeProduct(a){this.$state.excludeProduct=a}}});const ge=a=>(ue("data-v-3f7a5d08"),a=a(),ce(),a),he={class:"com-product-risk-wrapper"},_e={class:"popup-container"},Ie=ge(()=>R("div",{class:"popup-title"},"\u8BF7\u9009\u62E9\u4FDD\u969C\u65B9\u6848",-1)),Le={class:"risk-trial-wrapper"},Ve={key:0,class:"part-card"},ve={key:1,class:"part-card"},Pe={class:"risk-content"},Re={key:0,class:"risk"},Oe={class:"footer-bar"},De=de("\u786E\u8BA4"),ye=se({props:{isShow:{type:Boolean,default:!1},type:{default:"add"},productId:{default:0},riskType:{default:1},formInfo:{default:{}},productData:{default:()=>({})},holder:{default:()=>({})},insured:{default:()=>({})},riderRisk:{default:()=>[]},currentRisk:{default:()=>[]}},emits:["close","finished"],setup(a,{emit:u}){var N,x;const o=a,B=h({personVO:k({occupationCodeList:[]},o.holder)}),F=h({insuredCode:"",personVO:k({occupationCodeList:((x=(((N=o.insured)==null?void 0:N.proposalInsuredProductList)||[]).find(t=>t.productId===o.productData.productBasicInfoVO.id))==null?void 0:x.occupationCodeList)||[]},o.insured)}),L=h({}),S=h({}),_=h({}),T=h({}),w=h({}),e=re({currentPlan:"0",isShow:o.isShow,riskBaseInfo:{},holderFactor:[],insuredFactor:[],riskData:[],riskPlanData:[],trialResult:{},canTrial:!0,retrialTip:!1,enumList:{},ageRange:[],collapseName:["1"],type:o.type});q("premium",w.value),q("source",{type:e.type,origin:"proposal",showRiskList:o.currentRisk});const E=ae(()=>{var s;let t="";if((s=e.riskData)==null?void 0:s[0]){const r=e.riskData[0],n=((r==null?void 0:r.requiredRiderRiskVOList)||[]).map(c=>c.riskName);n.length&&(t=`\u7279\u6B8A\u63D0\u793A: ${r.riskName}\u548C${n.join("\u3001")}\u5FC5\u987B\u540C\u65F6\u6295\u4FDD`)}return t}),K=(t,s)=>{var c,f,l,i,p,O,g,V,j;const r=(t.insuredVOList[0].productPlanVOList[0].riskVOList||[]).map(b=>D(k({},b),{premium:s[b.riskCode].premium,amount:s[b.riskCode].amount}));return{proposalHolder:k({},(c=t.holder)==null?void 0:c.personVO),proposalInsuredList:[D(k({},t.insuredVOList[0].personVO),{dateRange:{min:(l=(f=_.value)==null?void 0:f.ageRangeObj)==null?void 0:l.minAge,max:(p=(i=_.value)==null?void 0:i.ageRangeObj)==null?void 0:p.maxAge},proposalInsuredProductList:[{productId:e.riskBaseInfo.id,productName:e.riskBaseInfo.productName,dateRange:{min:(g=(O=_.value)==null?void 0:O.ageRangeObj)==null?void 0:g.minAge,max:(j=(V=_.value)==null?void 0:V.ageRangeObj)==null?void 0:j.maxAge},occupationCodeList:t.insuredVOList[0].personVO.occupationCodeList,proposalProductRiskList:r}]})]}},U=()=>{var c;const t=JSON.parse(JSON.stringify(L.value[e.currentPlan])),s=Object.values(t).find(f=>f.riskType===1),r=Object.values(t).map(f=>{const l=f;if(l.chargePeriod==="3"){const i=(s.chargePeriod||"").split("_");i[1]&&(i[1]-=1),l.chargePeriod=i.join("_")}return l.liabilityVOList=(l.liabilityVOList||[]).filter(i=>i.optionalFlag===1||i.liabilityAttributeValue&&i.liabilityAttributeValue!=="-1").map(i=>{const p=i;return p.liabilityAttributeValue==="0"&&(p.liabilityAttributeValue=""),p}),l}),n={holder:B.value,productCode:e.riskBaseInfo.productCode,insuredVOList:[D(k({},F.value),{productPlanVOList:[{planCode:e.currentPlan||"",insurerCode:(c=e.riskBaseInfo)==null?void 0:c.insurerCode,riskVOList:r}]})]};fe(k({},n)).then(({code:f,data:l})=>{if(f==="10000"){e.retrialTip=!1,e.trialResult=l,e.canTrial=!1;const i={},p=(O=[])=>{(O||[]).forEach(g=>{var V;i[g.riskCode]=g,((V=g.riskPremiumDetailVOList)==null?void 0:V.length)&&p(g.riskPremiumDetailVOList)})};p(l.riskPremiumDetailVOList),Object.assign(w.value,i),u("finished",K(n,i))}else e.retrialTip=!0})},Y=()=>{var t,s,r,n,c;Promise.all([(s=(t=S.value)==null?void 0:t.validateForm)==null?void 0:s.call(t),(n=(r=_.value)==null?void 0:r.validateForm)==null?void 0:n.call(r),(c=T.value)==null?void 0:c.validate()]).then(()=>{U()})},z=()=>{u("close")},H=()=>{ke({dictCodeList:["RISK_PAYMENT_PERIOD","RISK_INSURANCE_PERIOD"]}).then(({code:s,data:r})=>{if(s==="10000"){const n={};r.forEach(c=>{n[c.dictCode]=c.dictItemList}),e.enumList=n}})},G=()=>{pe({productId:o.productId,source:2}).then(({code:t,data:s})=>{t==="10000"&&(e.riskBaseInfo=s.productBasicInfoVO,(s.productRiskVoList[0].riskDetailVOList||[]).forEach((r,n)=>{n===0&&(e.currentPlan=r.planCode||"0"),Object.assign(L.value,{[r.planCode||n]:{}})}),e.riskData=s.productRiskVoList[0].riskDetailVOList||[],e.riskPlanData=s.productRelationPlanVOList||[])}).finally(()=>{})},Q=t=>{e.holderFactor=t.holderFactorList,e.insuredFactor=t.insuredFactorList,e.ageRange=t.ageRange};return I([()=>L.value,()=>B.value,()=>F.value],t=>{t&&!e.canTrial&&(e.canTrial=!0,e.retrialTip=!0)},{deep:!0}),I(()=>o.isShow,t=>{e.isShow=t},{immediate:!0}),I(()=>o.productId,t=>{t&&G()},{immediate:!0}),I(()=>o.formInfo,(t={})=>{if(!(o.type==="add"||o.type==="repeatAdd")){const s={};t.proposalProductRiskList.forEach(r=>{s[r.riskId]=r}),Object.assign(L.value,{0:s})}},{deep:!0,immediate:!0}),I(()=>o.productData,t=>{var s;o.type==="add"||o.type==="repeatAdd"||(e.riskBaseInfo=t.productBasicInfoVO,e.riskData=((s=t.productRiskVoList)==null?void 0:s[0].riskDetailVOList)||[])},{deep:!0,immediate:!0}),I(()=>o.type,t=>{e.type=t}),ie(()=>{H()}),(t,s)=>{const r=v("ProMessage"),n=v("ProTitle"),c=v("VanForm"),f=v("VanButton"),l=v("VanPopup");return P(),y("div",he,[m(l,{show:d(e).isShow,"onUpdate:show":s[0]||(s[0]=i=>d(e).isShow=i),round:"",position:"bottom",closeable:"",style:{height:"80%"},onClose:z},{default:A(()=>{var i,p;return[R("div",_e,[Ie,d(E)?(P(),ne(r,{key:0,content:d(E)},null,8,["content"])):C("",!0),R("div",Le,[d(e).holderFactor.length?(P(),y("div",Ve,[m(n,{title:"\u6295\u4FDD\u4EBA"}),m(J,{ref_key:"holderRef",ref:S,"insured-code":(i=d(e).riskBaseInfo)==null?void 0:i.insurerCode,"form-info":B.value.personVO,"factor-list":d(e).holderFactor,"age-range":d(e).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):C("",!0),d(e).insuredFactor.length?(P(),y("div",ve,[m(n,{title:"\u88AB\u4FDD\u4EBA"}),m(J,{ref_key:"insuredRef",ref:_,"insured-code":(p=d(e).riskBaseInfo)==null?void 0:p.insurerCode,"form-info":F.value.personVO,"factor-list":d(e).insuredFactor,"age-range":d(e).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):C("",!0),R("div",Pe,[m(n,{title:"\u6295\u4FDD\u65B9\u6848"}),d(e).riskData.length?(P(),y("div",Re,[m(c,{ref_key:"riskFormRef",ref:T,"input-align":"right","error-message-align":"right"},{default:A(()=>[m(le,{"risk-info":L.value[0],enums:d(e).enumList,"origin-data":d(e).riskData,"pick-factor":Q},null,8,["risk-info","enums","origin-data"])]),_:1},512)])):C("",!0)])]),R("div",Oe,[m(f,{block:"",type:"primary",onClick:Y},{default:A(()=>[De]),_:1})])])]}),_:1},8,["show"])])}}});var Te=me(ye,[["__scopeId","data-v-3f7a5d08"]]);export{Te as P,Se as u};
