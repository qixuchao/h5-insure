var Ie=Object.defineProperty;var Q=Object.getOwnPropertySymbols;var fe=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable;var X=(a,_,r)=>_ in a?Ie(a,_,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[_]=r,j=(a,_)=>{for(var r in _||(_={}))fe.call(_,r)&&X(a,r,_[r]);if(Q)for(var r of Q(_))Re.call(_,r)&&X(a,r,_[r]);return a};import{g as te,Q as M,E,y as C,_ as K,r as h,j as L,n as w,F as oe,G as se,z as l,p as I,J as V,A as k,k as B,m as R,t as x,C as P,a4 as re,a5 as ue,ak as he,O as Le,o as Pe,R as De,D as Fe}from"./vendor-276186d8.js";import{u as ye,P as ge}from"./index-45c92859.js";import{b as H,_ as ae,s as Z,t as Ee}from"./index-7e17623a.js";import{a as Ce}from"./trial-b7ae5671.js";import{u as ee}from"./useDicData-5e34a407.js";import"./trial-0af41819.js";const Ve=a=>H.post("/api/app/insure/proposal/addOrUpdateProposal",a),Be=(a={})=>H.get(`/api/app/insure/proposal/queryProposalDetail/${a.id}`,a),be=(a={})=>H.post("/api/app/insure/product/listInsureProductDetail",a);const W=a=>(re("data-v-7995980e"),a=a(),ue(),a),$e={class:"com-product-list-wrapper"},Ae={class:"risk-item-wrapper"},Se={class:"content"},Oe={class:"risk-premium"},Te=P(" \u4FDD\u8D39:"),Ne={class:"premium"},we={class:"risk-factor"},xe={class:"factor"},Ue={class:"factor-value"},qe=W(()=>l("span",{class:"factor-name"}," \u4FDD\u989D(\u5143) ",-1)),je={class:"factor"},Me={class:"factor-value"},Ke=W(()=>l("span",{class:"factor-name"}," \u4FDD\u969C\u671F\u95F4 ",-1)),He={class:"factor"},We={class:"factor-value"},Ye=W(()=>l("span",{class:"factor-name"}," \u7F34\u8D39\u671F\u95F4 ",-1)),ze={class:"operate-bar"},Ge=P("\u5220\u9664"),Je=P("+ \u9644\u52A0\u9669"),Qe=P("\u4FEE\u6539"),Xe={class:"premium-total"},Ze=P(" \u4FDD\u8D39: "),et={class:"premium"},tt=te({props:{productRiskList:{default:()=>[]},productInfo:{default:()=>({})},productData:{default:()=>({})},pickProductPremium:{type:Function,default:()=>{}},productNum:{default:0}},emits:["deleteRisk","updateRisk","addRiderRisk"],setup(a,{emit:_}){const r=a,[D,y]=M(),v=E({checkedList:[],disabledList:[],riderRiskList:[],mainRiskData:{},totalPremium:0,currentRiskRecord:{},productRiskList:[]}),o=ee("RISK_PAYMENT_PERIOD"),A=ee("RISK_INSURANCE_PERIOD"),b=C(()=>{var n,u;return((u=(n=r.productData)==null?void 0:n.productRiskVoList)==null?void 0:u[0].riskDetailVOList.filter(i=>i.collocationType===1))||[]}),f=C(()=>{var i,c;const n=r.productRiskList.map(s=>s.riskId),u=(((c=(i=r.productData)==null?void 0:i.productRiskVoList)==null?void 0:c[0].riskDetailVOList)||[]).filter(s=>n.includes(s.id)&&s.collocationType===1);return b.value.length-u.length}),$=C(()=>n=>{var c,s;const u=((s=(c=r.productData)==null?void 0:c.productRiskVoList)==null?void 0:s[0].riskDetailVOList.find(g=>g.id!==n))||{};let i=!1;return r.productNum||u.riskType===2&&u.collocationType===1?i=!0:i=!1,i}),Y=C(()=>{var u,i;return((i=(u=r.productData)==null?void 0:u.productRiskVoList)==null?void 0:i[0].riskDetailVOList.find(c=>c.riskType===1))||{}}),U=C(()=>Y.value.collocationVOList||[]),d=n=>{_("deleteRisk",n,r.productInfo)},S=n=>{_("updateRisk",n,r.productInfo)},O=n=>{y(!0),v.value.currentRiskRecord=n},q=(n,u)=>{const i=n.map(c=>c.id).filter(c=>!v.value.disabledList.includes(c));_("addRiderRisk",i,r.productInfo)};return K(()=>r.productInfo,n=>{var i;let u=0;(n.proposalProductRiskList||[]).forEach(c=>{u+=c.premium}),(i=r.pickProductPremium)==null||i.call(r,{[`${n.productId}`]:u}),v.value.totalPremium=u},{deep:!0,immediate:!0}),K(()=>r.productRiskList,n=>{const u=[],i=[],c=[];(n||[]).forEach(s=>{s.riskType===1?u.unshift(s):(i.push(s.riskId),c.push(s.riskId),u.push(s))}),v.value.disabledList=i,v.value.checkedList=c,v.value.productRiskList=u},{deep:!0,immediate:!0}),(n,u)=>{const i=h("ProTitle"),c=h("ProCheckButton");return L(),w("div",$e,[(L(!0),w(oe,null,se(v.value.productRiskList,s=>{var g,T;return L(),w("div",{key:s.riskId},[l("div",Ae,[I(i,{"risk-type":s.riskType,title:s.riskName},null,8,["risk-type","title"]),l("div",Se,[l("div",Oe,[Te,l("span",Ne,"\uFFE5"+V((g=s.premium)==null?void 0:g.toLocaleString()),1)]),l("div",we,[l("div",xe,[l("span",Ue,V((T=s.amount)==null?void 0:T.toLocaleString()),1),qe]),l("div",je,[l("span",Me,V(k(Z)(k(A),s.coveragePeriod)),1),Ke]),l("div",He,[l("span",We,V(k(Z)(k(o),s.chargePeriod)),1),Ye])]),l("div",ze,[k($)(s.riskId)?(L(),B(c,{key:0,round:32,class:"border",onClick:N=>d(s)},{default:R(()=>[Ge]),_:2},1032,["onClick"])):x("",!0),k(f)?(L(),B(c,{key:1,activated:"",round:32,onClick:N=>O(s)},{default:R(()=>[Je]),_:2},1032,["onClick"])):x("",!0),I(c,{activated:"",round:32,onClick:N=>S(s)},{default:R(()=>[Qe]),_:2},1032,["onClick"])])])])])}),128)),l("div",Xe,[Ze,l("span",et,"\uFFE5"+V(v.value.totalPremium.toLocaleString()),1)]),k(D)?(L(),B(Ce,{key:0,modelValue:v.value.checkedList,"onUpdate:modelValue":u[0]||(u[0]=s=>v.value.checkedList=s),show:k(D),disabled:v.value.disabledList,"risk-list":k(b),"collocation-list":k(U),onFinished:q,onClose:u[1]||(u[1]=s=>k(y)(!1))},null,8,["modelValue","show","disabled","risk-list","collocation-list"])):x("",!0)])}}});var ot=ae(tt,[["__scopeId","data-v-7995980e"]]);const st=a=>(re("data-v-9b8052b4"),a=a(),ue(),a),rt={class:"container"},ut=st(()=>l("span",null,"\u8BA1\u5212\u4E66\u540D\u79F0",-1)),at={class:"operate-bar"},it=P("\u6DFB\u52A0\u4E3B\u9669"),lt={class:"footer-bar"},nt={class:"trial-result"},dt=P(" \u603B\u4FDD\u8D39 "),ct={class:"result-num"},pt={class:"trial-operate"},mt=P("\u4FDD\u5B58\u5E76\u9884\u89C8"),_t=te({setup(a){const _=[{name:"\u4FDD\u5B58\u4FEE\u6539"},{name:"\u53E6\u5B58\u4E3A\u65B0\u8BA1\u5212\u4E66"}],[r,D]=M(),[y,v]=M(),o=E({proposalHolder:{},proposalInsuredList:[{name:"",gender:"",birthday:"",proposalInsuredProductList:[]}],proposalName:"",totalPremium:0,relationUserType:2}),A=he(),b=Le(),f=ye(),{id:$,type:Y="add",isCreateProposal:U}=b.query,d=E({productId:0,productCollection:{},productInfo:{},productPremium:{},riderRisk:{},type:"add",currentRisk:[]}),S=E();E({}),E([]),C(()=>({min:"",max:""}));const O=()=>{S.value.validate().then(()=>{Ve(o.value).then(({code:t,data:e})=>{t==="10000"&&(f.$reset(),f.proposalId=e,A.push({path:"/compositionProposal",query:{id:e}}))})})},q=()=>{!$&&f.proposalId?v(!0):O()},n=(t,e)=>{e&&(o.value.id=null),O()},u=(t,e,p)=>e?/^.{1,20}$/.test(e)?"":`${t}\u4E0D\u80FD\u8D85\u8FC720\u4E2A\u5B57\u7B26`:"",i=(t={})=>{Object.assign(d.value.productPremium,t),o.value.totalPremium=Object.values(d.value.productPremium).reduce((e,p)=>e+p,0)},c=(t,e)=>{const p=e;Fe.confirm({message:"\u786E\u8BA4\u5220\u9664\u8BE5\u9669\u79CD\uFF1F"}).then(()=>{t.riskType===1?(o.value.proposalInsuredList[0].proposalInsuredProductList=o.value.proposalInsuredList[0].proposalInsuredProductList.filter(F=>F.productId!==p.productId),i({[p.productId]:0})):p.proposalProductRiskList=p.proposalProductRiskList.filter(F=>F.riskId!==t.riskId)})},s=(t,e)=>{d.value.productId=e.productId,d.value.productInfo=e,d.value.type="edit",d.value.currentRisk=[t.riskId],D(!0)},g=(t,e)=>{d.value.productId=e.productId,d.value.productInfo=e,d.value.type="addRiderRisk",d.value.currentRisk=t,D(!0)},T=(t={})=>{Be(t).then(({code:e,data:p})=>{e==="10000"&&Object.assign(o.value,p)})},N=t=>{o.value.proposalInsuredList[0].proposalInsuredProductList=o.value.proposalInsuredList[0].proposalInsuredProductList.map(e=>{let p=e;return e.productId===t.proposalInsuredList[0].proposalInsuredProductList[0].productId&&(p=j({},t.proposalInsuredList[0].proposalInsuredProductList[0])),p}),D(!1)},ie=t=>{be(t).then(({code:e,data:p})=>{e==="10000"&&(d.value.productCollection=p)}).finally(()=>{})},le=()=>{f.setProposalInfo(o.value),f.setTrialData([]),f.setExcludeProduct(Object.keys(d.value.productCollection)),A.push({path:"/proposalList",query:j({isCreateProposal:"1"},b.query)})},ne=()=>{D(!1)};return Pe(()=>{const t=f.$state.trialData,e=f.$state.proposalInfo,p=f.$state.proposalId;$&&!U||p?T({id:$||p}):!Object.keys(e).length&&t.length?Object.assign(o.value,t[0]):Object.keys(e).length&&t.length?(e.proposalInsuredList[0].proposalInsuredProductList.push(...t[0].proposalInsuredList[0].proposalInsuredProductList),o.value=e):Object.keys(e).length&&!t.length&&(o.value=e),f.setTrialData([])}),K(()=>{var t;return(t=o.value.proposalInsuredList[0].proposalInsuredProductList)==null?void 0:t.length},()=>{const t=o.value.proposalInsuredList[0].proposalInsuredProductList.map(e=>({productId:e.productId,source:2}));ie({voList:t})}),(t,e)=>{const p=h("VanField"),F=h("ProCard"),de=h("ProDatePicker"),ce=h("ProRadioButton"),pe=h("VanForm"),me=h("ProCheckButton"),_e=h("VanButton"),ke=h("VanActionSheet"),ve=h("ProPageWrap");return L(),B(ve,{class:"page-create-wrapper"},{default:R(()=>{var z;return[l("div",rt,[I(pe,{ref_key:"formRef",ref:S,"input-align":"right","error-message-align":"right"},{default:R(()=>[I(F,null,{default:R(()=>[I(p,{modelValue:o.value.proposalName,"onUpdate:modelValue":e[0]||(e[0]=m=>o.value.proposalName=m),name:"proposalName",placeholder:"\u8BF7\u8F93\u5165\u8BA1\u5212\u4E66\u540D\u79F0",rules:[{validator:(...m)=>u("\u8BA1\u5212\u4E66\u540D\u79F0",...m)}]},{label:R(()=>[ut]),_:1},8,["modelValue","rules"])]),_:1}),I(F,{title:"\u88AB\u4FDD\u4EBA\u4FE1\u606F"},{default:R(()=>[I(p,{modelValue:o.value.proposalInsuredList[0].name,"onUpdate:modelValue":e[1]||(e[1]=m=>o.value.proposalInsuredList[0].name=m),name:"name",label:"\u59D3\u540D",rules:[{validator:(...m)=>u("\u59D3\u540D",...m)}],placeholder:"\u8BF7\u8F93\u5165\uFF08\u9009\u586B\uFF09"},null,8,["modelValue","rules"]),I(de,{modelValue:o.value.proposalInsuredList[0].birthday,"onUpdate:modelValue":e[2]||(e[2]=m=>o.value.proposalInsuredList[0].birthday=m),name:"birthday",label:"\u51FA\u751F\u65E5\u671F",type:"date","is-link":"",readonly:"",placeholder:"\u8BF7\u9009\u62E9",rules:[{required:!0,message:"\u8BF7\u9009\u62E9"}]},null,8,["modelValue"]),I(p,{modelValue:o.value.proposalInsuredList[0].gender,"onUpdate:modelValue":e[4]||(e[4]=m=>o.value.proposalInsuredList[0].gender=m),name:"gender",label:"\u6027\u522B",rules:[{required:!0,message:"\u8BF7\u9009\u62E9"}]},{input:R(()=>[I(ce,{modelValue:o.value.proposalInsuredList[0].gender,"onUpdate:modelValue":e[3]||(e[3]=m=>o.value.proposalInsuredList[0].gender=m),options:k(Ee)},null,8,["modelValue","options"])]),_:1},8,["modelValue"])]),_:1})]),_:1},512),(L(!0),w(oe,null,se(o.value.proposalInsuredList[0].proposalInsuredProductList||[],m=>(L(),B(F,{key:m.productId},{default:R(()=>{var G,J;return[I(ot,{"product-risk-list":m.proposalProductRiskList,"product-info":m,"product-num":((J=(G=o.value.proposalInsuredList[0])==null?void 0:G.proposalInsuredProductList)==null?void 0:J.length)-1,"product-data":d.value.productCollection[m.productId],"pick-product-premium":i,onAddRiderRisk:g,onUpdateRisk:s,onDeleteRisk:c},null,8,["product-risk-list","product-info","product-num","product-data"])]}),_:2},1024))),128)),l("div",at,[I(me,{activated:"",round:34,onClick:le},{default:R(()=>[it]),_:1})])]),l("div",lt,[l("span",nt,[dt,l("span",ct,"\uFFE5"+V(o.value.totalPremium.toLocaleString()),1)]),l("div",pt,[I(_e,{type:"primary",onClick:q},{default:R(()=>[mt]),_:1})])]),k(r)?(L(),B(ge,{key:0,"is-show":k(r),type:d.value.type,"rider-risk":((z=d.value.riderRisk)==null?void 0:z[d.value.productId])||[],"product-data":d.value.productCollection[d.value.productId],"form-info":d.value.productInfo,holder:o.value.proposalHolder,insured:o.value.proposalInsuredList[0],"current-risk":d.value.currentRisk,onClose:ne,onFinished:N},null,8,["is-show","type","rider-risk","product-data","form-info","holder","insured","current-risk"])):x("",!0),I(ke,{show:k(y),"onUpdate:show":e[5]||(e[5]=m=>De(y)?y.value=m:null),actions:_,"cancel-text":"\u53D6\u6D88","close-on-click-action":"",onCancel:e[6]||(e[6]=m=>k(v)(!1)),onSelect:n},null,8,["show"])]}),_:1})}}});var Pt=ae(_t,[["__scopeId","data-v-9b8052b4"]]);export{Pt as default};
