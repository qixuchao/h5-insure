var Ge=Object.defineProperty,We=Object.defineProperties;var je=Object.getOwnPropertyDescriptors;var ne=Object.getOwnPropertySymbols;var ze=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable;var se=(w,h,v)=>h in w?Ge(w,h,{enumerable:!0,configurable:!0,writable:!0,value:v}):w[h]=v,y=(w,h)=>{for(var v in h||(h={}))ze.call(h,v)&&se(w,v,h[v]);if(ne)for(var v of ne(h))Je.call(h,v)&&se(w,v,h[v]);return w},D=(w,h)=>We(w,je(h));import{g as Qe,a9 as Xe,O as Ze,E as F,M as ue,y as le,_ as et,l as tt,h as at,r as ie,af as ot,j,n as ce,p as I,m as z,H as rt,t as de,z as k,A as _,J as me,C as Ne,k as nt,F as st,T as pe,X as ut}from"./vendor-17026bfd.js";import{_ as lt,C as fe,$ as it,G as he,a1 as ve}from"./index-7d1477f9.js";import{a as T}from"./order-c0ced472.js";import{S as O,R as ye,f as ct}from"./infoCollection-3dff23c4.js";import{p as De,i as dt,s as mt,g as pt,a as ft,u as ht,b as vt}from"./trial-ae7e3385.js";import{p as yt}from"./product-7517e448.js";import{d as ge,B as Dt,D as gt,G as Ft,S as Ct,H as Et,P as _t,U as It,_ as wt,W as Nt,v as bt,a as Fe,c as R,f as Ce,o as Ee,b as Y,n as _e,h as Ie}from"./auth-7ccd4305.js";import{_ as Tt,g as we,t as At,a as Ot}from"./index-5ca8316d.js";import{t as Pt}from"./theme-ea709837.js";import"./utils-b6782348.js";import"./index-9d64a3bd.js";import"./bankCard-b9d5732e.js";import"./trial-9abd68d0.js";const St={key:0},Bt={class:"page-internet-product-detail"},Ut={class:"info"},kt={class:"footer-button"},Ht={class:"price"},Mt=Ne(" \u603B\u4FDD\u8D39"),xt=Qe({setup(w){const h=Xe(),v=Ze(),{productCode:H="BWYL2021",tenantId:C,orderNo:P,phoneNo:M,agentCode:x="",saleChannelId:be,paymentMethod:g,certNo:J,name:Q,pageCode:S,from:X}=v.query;console.log(v.query,"route.query");const $=F(),m=F(),B=F(),A=F(),U=S==="payBack",Z=F(!1),L=F(!1),q=F(!1),ee=F(0),K=F(!1),G=F(!1),V=F({show:!1,html:""});let W="";const s=ue({holder:{certNo:J,certType:fe.CERT,mobile:M,name:Q,socialFlag:O.HAS},insured:{certNo:J,certType:fe.CERT,name:Q,socialFlag:O.HAS,relationToHolder:ye.SELF},paymentMethod:g,renewalDK:"Y",paymentFrequency:ct.YEAR}),N=F(ge),E=F(ge),u=ue({showInsure:!U,canInsure:!1,canUpgrade:!1}),Te=le(()=>{var t,a;return((a=(t=m.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:a.attachmentVOList.filter(e=>e.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),Ae=le(()=>{var t,a;return((a=(t=m.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:a.attachmentVOList.filter(e=>e.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),Oe=()=>{const{holder:{certNo:t,mobile:a,name:e,socialFlag:r},insured:{certNo:o,name:n,socialFlag:d,relationToHolder:i},paymentMethod:p}=s,f=he(t)&&bt(a)&&Fe(e)&&!!r,l=he(o)&&Fe(n)&&!!d&&!!i;return!!(f&&l&&!!p)},te=()=>{h.push({path:"/internet/guaranteeUpgrade",query:D(y({},v.query),{tenantId:C,productCode:"BWYL2022",orderNo:P,agentCode:x})})},Pe=()=>{G.value=!1},Se=()=>{E.value=N.value},Be=()=>{E.value=D(y({},E.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},Ue=async t=>{pe.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const a=await ht(t),{code:e}=a;if(e==="10000"){pe.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const r=await vt({orderNo:t.orderNo,tenantId:C}),{data:o}=r;r.code==="10000"&&(o.type===2?(V.value={show:!0,html:o.paymentUrl},console.log("data.paymentUrl",V.value),ut(()=>{console.log("document.forms",document.forms);const n=document.getElementById("cashierSubmit");n==null||n.addEventListener("submit",d=>{d.preventDefault()}),n==null||n.submit()})):window.location.href=o.paymentUrl)}u.canInsure=!0}catch{u.canInsure=!0}},ke=t=>`${ve}/internet/productDetail?tenantId=${C}&productCode=${H}&orderNo=${t}&agentCode=${x}&pageCode=payBack&from=${X||"normal"}`,He=t=>`${ve}/internet/payFail?tenantId=${C}&orderNo=${t}&agentCode=${x}&pageCode=payBack&from=${X||"normal"}`,Me=async t=>{const a=Ot({tenantId:C,saleUserId:x,saleChannelId:be,detail:m.value,insureDetail:B.value,paymentMethod:s.paymentMethod,renewalDK:s.renewalDK,iseeBizNo:W,successJumpUrl:"",premium:A.value,holder:s.holder,insured:s.insured,tenantOrderRiskList:t,orderStatus:"",orderTopStatus:""});try{const e=await mt(a),{code:r,data:o}=e;r==="10000"&&Ue(D(y({},a),{orderNo:o.data,extInfo:{extraInfo:{renewalDK:s.renewalDK,paymentMethod:s.paymentMethod,successJumpUrl:ke(o.data),failUrl:He(o.data)},iseeBizNo:W}}))}catch{u.canInsure=!0}},xe=async()=>{const{calcData:t,riskVOList:a}=we({holder:s.holder,insured:s.insured,tenantId:C,paymentFrequency:s.paymentFrequency,productDetail:m.value,insureDetail:B.value}),e=await De(t),{code:r,data:o}=e;return r==="10000"?(A.value=o.premium,{condition:a,data:o}):{}},Le=t=>{ee.value=t,q.value=!0},Ve=()=>new Promise((t,a)=>{var e,r;(r=(e=$.value)==null?void 0:e.validateForm)==null||r.call(e).then(async()=>{var l;if(!(((l=$.value)==null?void 0:l.isAgreeFile)||Z.value)){L.value=!0;return}const{calcData:n,riskVOList:d}=we({holder:s.holder,insured:s.insured,tenantId:C,paymentFrequency:s.paymentFrequency,productDetail:m.value,insureDetail:B.value},!0),i=await De(n),{code:p,data:f}=i;p==="10000"?(A.value=f.premium,t({condition:d,data:f})):a(new Error)}).catch(()=>{u.canInsure=!0})}),ae=async()=>{var t;if(U){te();return}u.canInsure=!1;try{const{condition:a,data:e}=await Ve(),r={},o=(d=[])=>{(d||[]).forEach(i=>{var p;r[i.riskCode]=i,((p=i.riskPremiumDetailVOList)==null?void 0:p.length)&&o(i.riskPremiumDetailVOList)})};o(e.riskPremiumDetailVOList);const n=At({tenantId:C,riskList:a,riskPremium:r,productId:(t=m.value)==null?void 0:t.id});Me(n)}catch{u.canInsure=!0}},Re=t=>{t==="allFalse"&&(L.value=!1,Le(0)),u.canInsure=!0},Ye=()=>{Z.value=!0,ae()};et(()=>s,tt.exports.debounce(()=>{m.value&&B.value&&S!=="payBack"&&Oe()&&xe()},500),{deep:!0,immediate:!0});const oe=async()=>{var r,o,n,d,i,p,f,l;const t=await pt({orderNo:P,tenantId:C}),{code:a,data:e}=t;if(a==="10000"){const{tenantOrderHolder:c,tenantOrderInsuredList:b,extInfo:re}=e;if(!U){Object.assign(s,{holder:{certNo:c.certNo,certType:c.certType,mobile:c.mobile,name:c.name,socialFlag:O.HAS},insured:{certNo:c.certNo,certType:c.certType,name:c.name,socialFlag:O.HAS,relationToHolder:ye.SELF},paymentMethod:g,renewalDK:"Y"}),u.canInsure=!0,E.value=_e,N.value=_e;return}Object.assign(s,{holder:{certNo:c.certNo,certType:c.certType,mobile:c.mobile,name:c.name,socialFlag:O.HAS},insured:{certNo:b==null?void 0:b[0].certNo,certType:(r=b[0])==null?void 0:r.certType,name:(o=b[0])==null?void 0:o.name,socialFlag:(d=(n=b[0])==null?void 0:n.extInfo)==null?void 0:d.hasSocialInsurance,relationToHolder:(i=b[0])==null?void 0:i.relationToHolder},paymentMethod:re.extraInfo.paymentMethod,renewalDK:re.extraInfo.renewalDK||"N"}),A.value=(l=(f=(p=b[0])==null?void 0:p.tenantOrderProductList)==null?void 0:f[0])==null?void 0:l.premium,(e.orderStatus===T.ACCEPT_POLICY||e.orderStatus===T.PAYMENT_SUCCESS)&&(u.canUpgrade=!0,K.value=!1,G.value=!0),e.orderStatus===T.PAYING&&(K.value=!0,setTimeout(()=>{oe()},3*1e3))}},$e=async()=>{var r,o,n,d,i,p;console.log("\u77ED\u4FE1\u8FDB\u5165\uFF0C\u5E26\u4E86orderNo, mobile");const t=await ft({holderPhone:M,orderStatus:[T.PAYING.toUpperCase(),T.TIMEOUT.toUpperCase(),"ACCEPT_POLICY"],productCode:H,tenantId:C}),{code:a,data:e}=t;if(e.orderStatus===T.ACCEPT_POLICY&&(console.log("\u5DF2\u627F\u4FDD\uFF0C\u88AB\u4FDD\u4EBA\u4FE1\u606F\u4E0D\u80FD\u4FEE\u6539"),E.value=D(y({},Ie),{paymentDisable:!!g}),N.value=D(y({},Ie),{paymentDisable:!!g})),(e.orderStatus===T.PAYING||e.orderStatus===T.TIMEOUT)&&(console.log("\u652F\u4ED8\u4E2D\uFF0C\u8D85\u65F6\u53EF\u4EE5\u4FEE\u6539\u6295\u4FDD\u4EBA\u4FE1\u606F"),E.value=D(y({},Y),{paymentDisable:!!g}),N.value=D(y({},Y),{paymentDisable:!!g})),a==="10000"&&((r=e==null?void 0:e.tenantOrderHolder)==null?void 0:r.certNo)){u.canInsure=!0;const{tenantOrderHolder:f,tenantOrderInsuredList:l,extInfo:c}=e;Object.assign(s,{holder:{certNo:f.certNo,certType:f.certType,mobile:f.mobile,name:f.name,socialFlag:O.HAS},insured:{certNo:l==null?void 0:l[0].certNo,certType:(o=l[0])==null?void 0:o.certType,name:(n=l[0])==null?void 0:n.name,socialFlag:(i=(d=l[0])==null?void 0:d.extInfo)==null?void 0:i.hasSocialInsurance,relationToHolder:(p=l[0])==null?void 0:p.relationToHolder},paymentMethod:g||c.extraInfo.paymentMethod,renewalDK:c.extraInfo.renewalDK})}else E.value=D(y({},R),{paymentDisable:!!g}),N.value=D(y({},R),{paymentDisable:!!g}),u.canInsure=!0},qe=async()=>{const t=yt({productCode:H,withInsureInfo:!0,tenantId:C}),a=dt({productCode:H});await Promise.all([t,a]).then(([e,r])=>{var o;e.code==="10000"&&(m.value=e.data,document.title=((o=e.data)==null?void 0:o.productFullName)||""),r.code==="10000"&&(B.value=r.data)}),P?oe():M&&S==="productDetail"&&$e()},Ke=()=>{S==="free"?U?(E.value=D(y({},Ce),{paymentDisable:!!g}),N.value=D(y({},Ce),{paymentDisable:!!g}),u.canInsure=!0):(E.value=D(y({},R),{paymentDisable:!!g}),N.value=D(y({},R),{paymentDisable:!!g}),u.canInsure=!0):U?(E.value=Ee,N.value=Ee,console.log("\u652F\u4ED8\u5B8C\u6210\u8FDB\u5165")):M||P||(console.log("\u6295\u4FDD\u94FE\u63A5"),E.value=Y,N.value=Y,u.canInsure=!0)};return at(()=>{Ke(),qe(),setTimeout(async()=>{W=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(t,a)=>{const e=ie("van-button"),r=ie("van-config-provider"),o=ot("dompurify-html");return j(),ce(st,null,[I(r,{"theme-vars":_(Pt)},{default:z(()=>{var n,d,i,p,f,l,c;return[V.value.show?rt((j(),ce("div",St,null,512)),[[o,V.value.html]]):de("",!0),k("div",Bt,[k("div",Ut,[I(Dt,{url:(d=(n=m.value)==null?void 0:n.tenantProductInsureVO)==null?void 0:d.banner[0]},null,8,["url"]),I(gt,{"product-name":(i=m.value)==null?void 0:i.productFullName,"product-desc":(f=(p=m.value)==null?void 0:p.showConfigVO)==null?void 0:f.desc},null,8,["product-name","product-desc"])]),I(Ft,{"guarantee-list":(c=(l=m.value)==null?void 0:l.tenantProductInsureVO)==null?void 0:c.titleAndDescVOS},null,8,["guarantee-list"]),I(Ct,{detail:m.value},{form:z(()=>[I(Et,{ref_key:"formRef",ref:$,disable:!_(u).showInsure,"form-auth":E.value,"form-info":_(s),premium:A.value,"product-detail":m.value,payments:[1],"payment-method":[0],onOnReset:Se,onOnUpdate:Be},null,8,["disable","form-auth","form-info","premium","product-detail"])]),_:1},8,["detail"]),k("div",kt,[k("div",Ht,[Mt,k("span",null,"\uFFE5"+me(_(it)(A.value))+"/\u6708",1)]),I(e,{type:"primary",class:"right",disabled:!(_(u).canInsure||_(u).canUpgrade),onClick:ae},{default:z(()=>[Ne(me(_(u).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),_(S)!=="payBack"?(j(),nt(_t,{key:1,"product-detail":m.value},null,8,["product-detail"])):de("",!0),I(It,{"order-no":_(P),"tenant-id":_(C),"is-show":G.value,onOnConfirm:te,onOnClose:Pe},null,8,["order-no","tenant-id","is-show"])]}),_:1},8,["theme-vars"]),I(wt,{show:L.value,"onUpdate:show":a[0]||(a[0]=n=>L.value=n),"content-list":_(Te),"active-index":0,onOnConfirmHealth:Re},null,8,["show","content-list"]),I(Tt,{show:q.value,"onUpdate:show":a[1]||(a[1]=n=>q.value=n),"content-list":_(Ae),"active-index":ee.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9",onSubmit:Ye},null,8,["show","content-list","active-index"]),I(Nt,{"is-show":K.value},null,8,["is-show"])],64)}}});var Zt=lt(xt,[["__scopeId","data-v-21e01357"]]);export{Zt as default};
