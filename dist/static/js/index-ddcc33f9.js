import{G as e,d as a,a as i,u as r,r as t,z as o,b2 as s,cB as n,R as l,o as d,b as u,b5 as c,au as p,av as m,B as f,c as v,e as k,w as g,g as y,A as C,i as I,h as P,f as h,U as L,V as O,j as V,E as b,I as R,cC as _,ct as D,bW as T,bN as N,cD as B}from"./index-7c427e78.js";import{C as F}from"./index-ddf8eef9.js";import{i as j,p as x}from"./trial-ba45f3de.js";import{b as A}from"./createProposal-6c923e00.js";import{P as w,I as E}from"./trial-5c57c8b5.js";import{C as q}from"./index-d1e92626.js";import"./pdfh5-008ca364.js";const S={key:0,class:"part-card"},U={key:1,class:"part-card"},M={class:"risk-content"},z={key:0,class:"risk"},H={key:1,class:"plan-risk"},J={class:"footer-bar van-safe-area-bottom"},K={class:"trial-result"},W={class:"result-num"},Y={class:"trial-operate"},G={key:0,class:"retrial-tip"};var Q=e(a({__name:"index",setup(e){var a;const Q=i(),X=r(),{agentCode:Z="test",agencyCode:$="",tenantId:ee=9991000007,insurerCode:ae="99",proposalId:ie,saleChannelId:re}=X.query;let{productCode:te="MMBBSF",templateId:oe=1}=X.query;const se=t({personVO:{occupationCodeList:[]}}),ne=t({insuredCode:"",personVO:{occupationCodeList:[]}}),le=t({}),de=t({}),ue=t({}),ce=t(null),pe=t({}),me=o({currentPlan:"",riskBaseInfo:{},holderFactor:[],insuredFactor:[],riskData:[],riskPlanData:[],trialResult:{},canTrial:!0,retrialTip:!1,enumList:{},ageRange:[],collapseName:["1"],insuredRiskList:[],currentRiskList:[]});ie&&(te=null==(a=X.query||{})?void 0:a.productCenterCode),s("premium",pe.value),n().get("userInfo");const fe=()=>{me.retrialTip=!1},ve=()=>{R({agencyId:$,saleUserId:Z,saleChannelId:re,tenantId:ee,venderCode:me.riskBaseInfo.insurerCode,orderDataSource:1,proposalId:ie,extInfo:{templateId:+(oe||1),pageCode:"premiumTrial",iseeBizNo:window.iseeBiz,buttonCode:_.premiumTrial},tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{extInfo:{},tenantOrderProductList:[{productCode:me.riskBaseInfo.productCode||"",productName:me.riskBaseInfo.productName||"",premium:me.trialResult.premium||0,tenantOrderRiskList:me.insuredRiskList}]}]}).then((({code:e,data:a})=>{"10000"===e&&"jumpToPage"===a.pageAction.pageAction&&Q.push({path:D[a.pageAction.data.nextPageCode],query:{insurerCode:me.riskBaseInfo.insurerCode,templateId:oe,...X.query,productCategory:me.riskBaseInfo.productCategory,orderNo:a.pageAction.data.orderNo}})}))},ke=()=>{const e=JSON.parse(JSON.stringify(le.value[me.currentPlan])),a=Object.values(e).find((e=>1===e.riskType)),i=Object.values(e).map((e=>{const i=e;return((e,a)=>{var i,r,t,o;const s=e;if("3"===s.chargePeriod){const e=(a.chargePeriod||"").split("_");if(e[1]-=1,1===s.exemptFlag){if("to"===e[0]){let a=0;1===s.exemptType?(null==(i=se.value.personVO)?void 0:i.birthday)&&(a=parseInt(""+(+new Date-new Date(null==(r=se.value.personVO)?void 0:r.birthday))/31536e6,10)):2===s.exemptType&&(null==(t=ne.value.personVO)?void 0:t.birthday)&&(a=parseInt(""+(+new Date-new Date(null==(o=ne.value.personVO)?void 0:o.birthday))/31536e6,10)),e[1]=e[1]-a}e[0]="year",s.coveragePeriod=e.join("_")}s.chargePeriod=e.join("_")}})(i,a),i.liabilityVOList=(i.liabilityVOList||[]).filter((e=>1===e.optionalFlag||e.liabilityAttributeValue&&"-1"!==e.liabilityAttributeValue)).map((e=>{const a=e;return"0"===a.liabilityAttributeValue&&(a.liabilityAttributeValue=""),a})),i})),r={holder:se.value,productCode:me.riskBaseInfo.productCode,insuredVOList:[{...ne.value,productPlanVOList:[{planCode:me.currentPlan||"",insurerCode:me.riskBaseInfo.insurerCode,riskVOList:i}]}]};x({...r}).then((({code:e,data:a})=>{if("10000"===e){me.retrialTip=!1,me.trialResult=a,me.canTrial=!1;const e={},i=(a=[])=>{(a||[]).forEach((a=>{var r;e[a.riskCode]=a,(null==(r=a.riskPremiumDetailVOList)?void 0:r.length)&&i(a.riskPremiumDetailVOList)}))};i(a.riskPremiumDetailVOList),((e,a)=>{me.insuredRiskList=e.map((e=>{var i,r;return{initialAmount:null==(i=a[e.riskCode])?void 0:i.amount,amountUnit:1,annuityDrawFrequency:e.annuityDrawDate,annuityDrawType:e.annuityDrawType,paymentFrequency:e.paymentFrequency,paymentPeriod:e.chargePeriod.split("_")[1],paymentPeriodType:w[e.chargePeriod.split("_")[0]],insurancePeriodType:E["to_life"===e.coveragePeriod?"to_life":e.coveragePeriod.split("_")[0]],insurancePeriodValue:Number.isNaN(+e.coveragePeriod.split("_")[1])?0:e.coveragePeriod.split("_")[1],riskCode:e.riskCode,riskType:e.riskType,riskName:e.riskName,extInfo:{riskId:e.riskId,copy:e.copy},initialPremium:null==(r=a[e.riskCode])?void 0:r.premium,liabilityDetails:e.liabilityVOList.map((e=>({liabilityCode:e.liabilityCode,liabilityName:e.liabilityName,refundMethod:e.liabilityAttributeValue}))),productId:me.riskBaseInfo.id}}))})(r.insuredVOList[0].productPlanVOList[0].riskVOList,e),Object.assign(pe.value,e)}}))},ge=()=>{var e,a,i,r,t;Promise.all([null==(a=null==(e=de.value)?void 0:e.validateForm)?void 0:a.call(e),null==(r=null==(i=ue.value)?void 0:i.validateForm)?void 0:r.call(i),null==(t=ce.value)?void 0:t.validate()]).then((()=>{ke()}),(e=>{var a;(null==e?void 0:e.length)&&(null==(a=null==ce?void 0:ce.value)||a.scrollToField(e[0].name))}))},ye=()=>{j({productCode:te,source:ie?2:1}).then((({code:e,data:a})=>{var i,r,t,o;"10000"===e&&(me.riskBaseInfo=a.productBasicInfoVO,(a.productRelationPlanVOList.length?a.productRelationPlanVOList:a.productRiskVoList[0].riskDetailVOList||[]).forEach(((e,a)=>{0===a&&(me.currentPlan=e.planCode||"0"),ie||Object.assign(le.value,{[e.planCode||a]:{}})})),ie&&(t=me.riskBaseInfo.productCategory,o=me.riskBaseInfo.insurerCode,B({productCategory:t,venderCode:o}).then((e=>{var a;"10000"===e.code&&(oe=null==(a=e.data)?void 0:a.id)}))),me.riskData=(null==(i=a.productRiskVoList[0])?void 0:i.riskDetailVOList)||[],me.riskPlanData=a.productRelationPlanVOList||[],ie&&(r=a.productBasicInfoVO.id,A({id:ie,tenantId:ee}).then((({code:e,data:a})=>{var i;if("10000"===e){const{proposalInsuredProductList:e=[],...t}=(null==(i=a.proposalInsuredList)?void 0:i[0])||{};Object.assign(se.value.personVO,a.proposalHolder);const o=e.find((e=>e.productId===r));Object.assign(ne.value.personVO,t,{occupationCodeList:(null==o?void 0:o.occupationCodeList)||[]});const s={};((null==o?void 0:o.proposalProductRiskList)||[]).forEach((e=>{s[e.riskId]=e})),Object.assign(le.value,{0:s})}}))))})).finally((()=>{}))},Ce=e=>{me.holderFactor=e.holderFactorList,me.insuredFactor=e.insuredFactorList,me.ageRange=e.ageRange};return l([()=>le.value,()=>se.value,()=>ne.value],(e=>{e&&!me.canTrial&&(me.canTrial=!0,me.retrialTip=!0)}),{deep:!0}),d((()=>{ye(),T({dictCodeList:["RISK_PAYMENT_PERIOD","RISK_INSURANCE_PERIOD"]}).then((({code:e,data:a})=>{if("10000"===e){const e={};a.forEach((a=>{e[a.dictCode]=a.dictItemList})),me.enumList=e}}))})),(e,a)=>{const i=N,r=u("PersonalInfo"),t=u("RiskList"),o=c,s=u("ProTabButton"),n=p,l=m,d=F,R=q,_=f,D=u("ProPageWrap");return v(),k(D,{class:"page-trial-wrapper"},{default:g((()=>{var e,u,c;return[y(me).holderFactor.length?(v(),C("div",S,[I(i,{title:"投保人"}),I(r,{ref_key:"holderRef",ref:de,"insured-code":null==(e=y(me).riskBaseInfo)?void 0:e.insurerCode,"form-info":y(se).personVO,"factor-list":y(me).holderFactor,"age-range":y(me).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):P("",!0),y(me).insuredFactor.length?(v(),C("div",U,[I(i,{title:"被保人"}),I(r,{ref_key:"insuredRef",ref:ue,"insured-code":null==(u=y(me).riskBaseInfo)?void 0:u.insurerCode,"form-info":y(ne).personVO,"factor-list":y(me).insuredFactor,"age-range":y(me).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):P("",!0),h("div",M,[I(R,{modelValue:y(me).collapseName,"onUpdate:modelValue":a[1]||(a[1]=e=>y(me).collapseName=e)},{default:g((()=>[I(d,{name:"1"},{title:g((()=>[I(i,{title:"投保方案"})])),default:g((()=>[y(me).riskData.length&&y(le)[0]?(v(),C("div",z,[I(o,{ref_key:"riskFormRef",ref:ce,"input-align":"right","error-message-align":"right"},{default:g((()=>[I(t,{"risk-info":y(le)[0],enums:y(me).enumList,"origin-data":y(me).riskData,"pick-factor":Ce},null,8,["risk-info","enums","origin-data"])])),_:1},512)])):P("",!0),y(me).riskPlanData.length?(v(),C("div",H,[I(o,{ref_key:"riskFormRef",ref:ce,"input-align":"right","error-message-align":"right"},{default:g((()=>[I(l,{active:y(me).currentPlan,"onUpdate:active":a[0]||(a[0]=e=>y(me).currentPlan=e)},{default:g((()=>[(v(!0),C(L,null,O(y(me).riskPlanData,(e=>(v(),k(n,{key:e.planCode,name:e.planCode,title:e.planName},{title:g((()=>[I(s,{title:e.planName,active:y(me).currentPlan===e.planCode},null,8,["title","active"])])),default:g((()=>{var a;return[e.planCode===y(me).currentPlan?(v(),k(t,{key:0,"risk-info":y(le)[e.planCode],enums:y(me).enumList,"origin-data":null==(a=e.productRiskVoList)?void 0:a[0].riskDetailVOList,"pick-factor":Ce},null,8,["risk-info","enums","origin-data"])):P("",!0)]})),_:2},1032,["name","title"])))),128))])),_:1},8,["active"])])),_:1},512)])):P("",!0)])),_:1})])),_:1},8,["modelValue"])]),h("div",J,[h("span",K,[V("总保费"),h("span",W,b((y(me).retrialTip?0:(null==(c=y(me).trialResult)?void 0:c.premium)||0).toLocaleString("hanidec",{style:"currency",currency:"CNY"})),1)]),h("div",Y,[y(me).retrialTip?(v(),C("div",G,[V(" 条件更改后，需要重新试算 "),h("span",{class:"close-icon",onClick:fe})])):P("",!0),y(me).canTrial?(v(),k(_,{key:1,type:"primary",onClick:ge},{default:g((()=>[V("去试算")])),_:1})):(v(),k(_,{key:2,type:"primary",onClick:ve},{default:g((()=>[V("立即投保")])),_:1}))])])]})),_:1})}}}),[["__scopeId","data-v-1acad142"]]);export{Q as default};
