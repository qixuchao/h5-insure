import{_ as e,d as a,u as n,a as t,r,z as o,a4 as l,x as i,aa as d,y as s,b as u,q as c,c as m,h as p,f as v,w as y,g as f,s as h,k as I,j as N,e as g,n as w,t as b,aJ as C,X as T,F as D,a6 as O,ao as F,T as k,ap as P,aQ as H,aM as S}from"./index-9aeeb9a7.js";import{d as j}from"./debounce-2dbbea42.js";import{a as x}from"./order-7ab26291.js";import{S as $,R as L,P as V}from"./infoCollection-d956aa91.js";import{i as q,s as U,p as A,g as B,u as E,a as M}from"./trial-6154c396.js";import{p as _}from"./product-904909bc.js";import{t as R,g as K,a as Y,s as z,v as J,b as W}from"./utils-5c37ae63.js";import{f as G,a as Q}from"./utils-b77f2acb.js";import{t as X}from"./theme-ea709837.js";import{d as Z,B as ee,D as ae,G as ne,S as te,H as re,P as oe,U as le,_ as ie,W as de,a as se,p as ue}from"./auth-24f6b293.js";import{_ as ce}from"./index-696e84de.js";import"./pdfh5-008ca364.js";import"./isObjectLike-d00d103b.js";import"./trial-5d760582.js";import"./index-adb2363d.js";import"./bankCard-f6c4a558.js";import"./validator-5a13dc82.js";import"./phoneVerify-88c2b4d1.js";const me={key:0},pe={class:"page-internet-product-detail"},ve={class:"info"},ye={class:"footer-button"},fe={class:"price"},he={key:0};var Ie=e(a({__name:"index",setup(e){const a=n(),Ie=t(),{productCode:Ne="BWYL2021",tenantId:ge,orderNo:we,phoneNo:be,agentCode:Ce="",saleChannelId:Te,paymentMethod:De,certNo:Oe,name:Fe,pageCode:ke,upgradeCode:Pe="",from:He}=Ie.query,Se=r(),je=r(),xe=r(),$e=r(),Le="payBack"===ke,Ve=r(!1),qe=r(!1),Ue=r(!1),Ae=r(0),Be=r(!1),Ee=r(!1),Me=r({show:!1,html:""}),_e=r(!1),Re=r();let Ke="";const Ye=o({holder:{certNo:Oe,certType:l.CERT,mobile:be,name:Fe,socialFlag:$.HAS},insured:{certNo:Oe,certType:l.CERT,name:Fe,socialFlag:$.HAS,relationToHolder:L.SELF},paymentMethod:De,renewalDK:"Y",paymentFrequency:V.MONTH}),ze=r(Z),Je=r(Z),We=o({showInsure:!Le,canInsure:!1,canUpgrade:!1}),Ge=i((()=>{var e,a;return(null==(a=null==(e=je.value)?void 0:e.tenantProductInsureVO)?void 0:a.attachmentVOList.filter((e=>"健康告知"===e.attachmentName)))||[]})),Qe=i((()=>{var e,a,n,t,r,o,l,i;return[...(null==(a=null==(e=je.value)?void 0:e.tenantProductInsureVO)?void 0:a.titleAndDescVOS)||[],{desc:`出生${G(null==(t=null==(n=je.value)?void 0:n.tenantProductInsureVO)?void 0:t.holderAgeLimit)}`,title:"投保年龄",noDetail:!0},{desc:Q(null==(o=null==(r=je.value)?void 0:r.tenantProductInsureVO)?void 0:o.insurancePeriodValues),title:"保障期限",noDetail:!0},{desc:`${null==(i=null==(l=je.value)?void 0:l.tenantProductInsureVO)?void 0:i.waitPeriod}天，上一张保单期满后指定期限内重新投保、因遭受意外伤害导致的医疗无等待期`,title:"等待期",noDetail:!0}]})),Xe=i((()=>{var e,a;return(null==(a=null==(e=je.value)?void 0:e.tenantProductInsureVO)?void 0:a.attachmentVOList.filter((e=>"健康告知"!==e.attachmentName)))||[]})),Ze=()=>{if(Ye.holder.certNo){const e=P(Ye.holder.certNo);if(J(Ye.holder.certNo,18,"year"))return k("投保人年龄必须大于等于18岁！"),!1;if(Ye.insured.certNo&&Ye.insured.relationToHolder===L.MATE){if(e===P(Ye.insured.certNo))return k("被保人为配偶时，性别不可相同！"),!1}}if(Ye.insured.certNo){if(Ye.insured.relationToHolder===L.CHILD&&J(Ye.insured.certNo,30,"day"))return k("被保人为子女时，年龄必须大于等于30天！"),!1;if(Ye.insured.relationToHolder===L.PARENT&&!J(Ye.insured.certNo,71,"year"))return k("被保人为父母时，年龄必须小于等于70岁！"),!1}if([L.CHILD,L.PARENT].includes(Ye.insured.relationToHolder)){const e=W(Ye.holder.certNo,"year"),a=W(Ye.insured.certNo,"year");if(Ye.insured.relationToHolder===L.CHILD&&e-a<18)return k("投保人和子女年龄必须相差18岁！"),!1;if(Ye.insured.relationToHolder===L.PARENT&&a-e<18)return k("投保人和父母年龄必须相差18岁！"),!1}return!0},ea=()=>{a.push({path:"/internet/guaranteeUpgrade",query:{...Ie.query,tenantId:ge,productCode:"BWYL2022",orderNo:we,agentCode:Ce}})},aa=()=>{Ee.value=!1,a.replace(`/pay?orderNo=${we}&saleUserId=${Ce}&tenantId=${ge}`)},na=()=>{Je.value=ze.value},ta=()=>{Je.value={...Je.value,relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1}},ra=e=>{var a,n;const t=JSON.parse(null==(n=null==(a=xe.value)?void 0:a.productBasicInfoVO)?void 0:n.extInfo);let r="";if(1!==t.endorsementFlag||!t.endorsementCode)return`${S}/pay?orderNo=${e}&saleUserId=${Ce}&tenantId=${ge}`;r=`&upgradeCode=${t.endorsementCode}`;return`${S}/internet/productDetail?tenantId=${ge}&productCode=${Ne}&orderNo=${e}&agentCode=${Ce}&pageCode=payBack${r}&from=${He||"normal"}`},oa=async e=>{const a=K({tenantId:ge,saleUserId:Ce,saleChannelId:Te,detail:je.value,insureDetail:xe.value,paymentMethod:Ye.paymentMethod,renewalDK:Ye.renewalDK,iseeBizNo:Ke,successJumpUrl:"",premium:$e.value,holder:Ye.holder,insured:Ye.insured,tenantOrderRiskList:e,orderStatus:"",orderTopStatus:"",orderNo:we,originOrderIds:Re.value});try{const e=await U(a),{code:t,data:r}=e;"10000"===t&&(async e=>{k.loading({message:"核保中...",forbidClick:!0,duration:0});try{const a=await E(e),{code:n}=a;if("10000"===n){const a=await M({orderNo:e.orderNo,tenantId:ge}),{data:n}=a;"10000"===a.code&&(2===n.type?(Me.value={show:!0,html:n.paymentUrl},H((()=>{const e=document.getElementById("cashierSubmit");null==e||e.addEventListener("submit",(e=>{e.preventDefault()})),null==e||e.submit()}))):window.location.href=n.paymentUrl)}We.canInsure=!0}catch(a){We.canInsure=!0}finally{k.clear()}})({...a,orderNo:r.data,extInfo:{extraInfo:{renewalDK:Ye.renewalDK,paymentMethod:Ye.paymentMethod,paymentFrequency:Ye.paymentFrequency,successJumpUrl:ra(r.data),failUrl:(n=r.data,`${S}/internet/payFail?tenantId=${ge}&orderNo=${n}&agentCode=${Ce}&pageCode=payBack&from=${He||"normal"}`)},iseeBizNo:Ke}})}catch(t){We.canInsure=!0}var n},la=async()=>{var e;if(Le)ea();else{We.canInsure=!1;try{const{condition:a,data:n}=await new Promise(((e,a)=>{var n,t;null==(t=null==(n=Se.value)?void 0:n.validateForm)||t.call(n).then((async()=>{if(!Ze())return void a(new Error);const{calcData:n,riskVOList:t}=Y({holder:Ye.holder,insured:Ye.insured,tenantId:ge,paymentFrequency:Ye.paymentFrequency,productDetail:je.value,insureDetail:xe.value},!0),r=await A(n),{code:o,data:l}=r;"10000"===o?($e.value=l.premium,e({condition:t,data:l})):a(new Error)})).catch((e=>{We.canInsure=!0,z(e)}))})),t={},r=(e=[])=>{(e||[]).forEach((e=>{var a;t[e.riskCode]=e,(null==(a=e.riskPremiumDetailVOList)?void 0:a.length)&&r(e.riskPremiumDetailVOList)}))};r(n.riskPremiumDetailVOList);const o=R({tenantId:ge,riskList:a,riskPremium:t,productId:null==(e=je.value)?void 0:e.id});oa(o)}catch(a){We.canInsure=!0}}},ia=e=>{"allFalse"===e?(qe.value=!1,la(),We.canInsure=!0):O.confirm({message:"您当前的健康状况不符合该产品",confirmButtonText:"确定"}).then((()=>{window.history.back()}))},da=()=>{Ve.value=!0,Ue.value=!1,qe.value=!0};d([()=>Ye.insured.certNo,()=>Ye.insured.socialFlag],j((()=>{Ye.insured.certNo&&Ye.insured.socialFlag&&"payBack"!==ke&&(()=>{const{holder:{certNo:e,mobile:a,name:n,socialFlag:t},insured:{certNo:r,name:o,socialFlag:l,relationToHolder:i},paymentMethod:d}=Ye;return F(r)&&!!l})()&&(async()=>{if(We.canInsure=!0,!Ze())return{};const{calcData:e,riskVOList:a}=Y({holder:Ye.holder,insured:Ye.insured,tenantId:ge,paymentFrequency:Ye.paymentFrequency,productDetail:je.value,insureDetail:xe.value},!0);if(!Array.isArray(a)||a.length<1)return k("被保人年龄需在30天(含) - 70岁(含)之间！"),$e.value=null,{};_e.value=!0;const n=await A(e);_e.value=!1;const{code:t,data:r}=n;"10000"===t&&(Ye.insured.certNo?$e.value=r.premium:$e.value=null)})()}),500),{deep:!0,immediate:!0}),d((()=>Ye.insured.certNo),(()=>{Ye.insured.certNo||($e.value=null)}));const sa=async()=>{var e,a,n,t,r,o,l,i,d,s,u,c,m;const p=await B({orderNo:we,tenantId:ge}),{code:v,data:y}=p;if("10000"===v){const{id:p,tenantOrderHolder:v,tenantOrderInsuredList:f,extInfo:h}=y;if(!Le)return Re.value={id:p,holderId:null==v?void 0:v.id,insuredId:null==f?void 0:f[0].id},Object.assign(Ye,{holder:{certNo:v.certNo,certType:v.certType,mobile:v.mobile,name:v.name,socialFlag:$.HAS},insured:{certNo:null==f?void 0:f[0].certNo,certType:null==(e=f[0])?void 0:e.certType,name:null==(a=f[0])?void 0:a.name,socialFlag:null==(t=null==(n=f[0])?void 0:n.extInfo)?void 0:t.hasSocialInsurance,relationToHolder:null==(r=f[0])?void 0:r.relationToHolder},paymentMethod:h.extraInfo.paymentMethod,paymentFrequency:h.extraInfo.paymentFrequency,renewalDK:"Y"}),void(We.canInsure=!0);Object.assign(Ye,{holder:{certNo:v.certNo,certType:v.certType,mobile:v.mobile,name:v.name,socialFlag:$.HAS},insured:{certNo:null==f?void 0:f[0].certNo,certType:null==(o=f[0])?void 0:o.certType,name:null==(l=f[0])?void 0:l.name,socialFlag:null==(d=null==(i=f[0])?void 0:i.extInfo)?void 0:d.hasSocialInsurance,relationToHolder:null==(s=f[0])?void 0:s.relationToHolder},paymentMethod:h.extraInfo.paymentMethod,paymentFrequency:h.extraInfo.paymentFrequency,renewalDK:h.extraInfo.renewalDK||"N"}),$e.value=null==(m=null==(c=null==(u=f[0])?void 0:u.tenantOrderProductList)?void 0:c[0])?void 0:m.premium,y.orderStatus!==x.ACCEPT_POLICY&&y.orderStatus!==x.PAYMENT_SUCCESS||(We.canUpgrade=!0,Be.value=!1,Ee.value=!0),y.orderStatus===x.PAYING&&(Be.value=!0,setTimeout((()=>{sa()}),3e3))}};return s((()=>{we?Le&&Pe?(Je.value=ue,ze.value=ue):Pe||(Je.value={...se,paymentFrequencyDisable:!0},ze.value=se,We.canInsure=!0):(Je.value={...se,paymentFrequencyDisable:!0},ze.value=se,We.canInsure=!0),(async()=>{var e;const a=await _({productCode:Ne,withInsureInfo:!0,tenantId:ge});"10000"===a.code&&(je.value=a.data,document.title=(null==(e=a.data)?void 0:e.productFullName)||"");const n=await q({productCode:Ne});"10000"===n.code&&(xe.value=n.data),we&&sa()})(),setTimeout((async()=>{Ke=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,a)=>{const n=u("van-loading"),t=u("van-button"),r=u("van-config-provider"),o=c("dompurify-html");return m(),p(D,null,[v(r,{"theme-vars":f(X)},{default:y((()=>{var e,a,r,l,i,d,s;return[f(Me).show?h((m(),p("div",me,null,512)),[[o,f(Me).html]]):I("",!0),N("div",pe,[N("div",ve,[v(ee,{url:null==(a=null==(e=f(je))?void 0:e.tenantProductInsureVO)?void 0:a.banner[0]},null,8,["url"]),v(ae,{"product-name":null==(r=f(je))?void 0:r.productFullName,"product-desc":null==(i=null==(l=f(je))?void 0:l.showConfigVO)?void 0:i.desc},null,8,["product-name","product-desc"])]),(null==(s=null==(d=f(je))?void 0:d.tenantProductInsureVO)?void 0:s.titleAndDescVOS)?(m(),g(ne,{key:0,"img-type":"BW","guarantee-list":f(Qe)},null,8,["guarantee-list"])):I("",!0),v(te,{detail:f(je)},{form:y((()=>[v(re,{ref_key:"formRef",ref:Se,disable:!f(We).showInsure,"form-auth":f(Je),"form-info":f(Ye),premium:f($e),"product-detail":f(je),payments:[1],"payment-method":[0],onOnReset:na,onOnUpdate:ta},null,8,["disable","form-auth","form-info","premium","product-detail"])])),_:1},8,["detail"]),N("div",ye,[N("div",fe,[w(" 总保费"),f(_e)?(m(),g(n,{key:1,class:"premium-loading",type:"spinner"})):(m(),p("span",he,b(f($e)?"￥":"")+b(f(C)(f($e)))+b(f($e)?"元/月":""),1))]),v(t,{type:"primary",class:"right",disabled:!(f(We).canInsure||f(We).canUpgrade),onClick:la},{default:y((()=>[w(b(f(We).showInsure?"立即投保":"升级保障"),1)])),_:1},8,["disabled"])])]),f(we)?I("",!0):(m(),g(oe,{key:1,"product-detail":f(je)},null,8,["product-detail"])),f(Pe)?(m(),g(le,{key:2,"order-no":f(we),"tenant-id":f(ge),"upgrade-code":f(Pe),"is-show":f(Ee),onOnConfirm:ea,onOnClose:aa},null,8,["order-no","tenant-id","upgrade-code","is-show"])):I("",!0)]})),_:1},8,["theme-vars"]),v(ie,{show:f(qe),"onUpdate:show":a[0]||(a[0]=e=>T(qe)?qe.value=e:null),"content-list":f(Ge),"active-index":0,onOnConfirmHealth:ia},null,8,["show","content-list"]),f(Ue)?(m(),g(ce,{key:0,show:f(Ue),"onUpdate:show":a[1]||(a[1]=e=>T(Ue)?Ue.value=e:null),"content-list":f(Xe),"active-index":f(Ae),text:"我已逐页阅读并确认告知内容",onSubmit:da},null,8,["show","content-list","active-index"])):I("",!0),v(de,{"is-show":f(Be)},null,8,["is-show"])],64)}}}),[["__scopeId","data-v-591e64c6"]]);export{Ie as default};
