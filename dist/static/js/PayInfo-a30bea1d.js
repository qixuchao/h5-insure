import{d as e,r as a,aQ as n,aS as t,z as i,bK as r,L as m,R as o,aR as s,c as d,A as c,V as l,e as p,g as u,U as f}from"./index-1f01ea49.js";import{d as y}from"./debounce-eed12388.js";import{c as E,n as T}from"./ProRenderFormWithCard.vue_vue_type_style_index_0_scoped_true_lang-2bd2b939.js";/* empty css              */import"./useDicData-eef14bb7.js";import{P as R}from"./index-84a4665a.js";import{P as h,B as I,a as _}from"./bankCard-6b87051f.js";const v=e({__name:"PayInfo",props:{schema:{default:()=>[]},config:{default:()=>[]},modelValue:{default:()=>[]},isView:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{expose:v,emit:S}){const M=e,g={BANK_PAY:"1",ALI_PAY:"2",WECHAT_PAY:"3"},b=a(null);a();const L=["cardType","bankCard","paymentMethod"],D=[{title:"首期支付",schema:[],payInfoType:h.FIRST_TERM,formData:{paymentType:"1",paymentMethod:"1",cardType:I.DEBIT},config:{cardType:{isView:!0}},objectType:n.INIT_SIGN},{title:"续期支付",schema:[],payInfoType:h.RENEW_TERM,formData:{paymentType:"1",paymentMethod:"1",paymentGenre:String(_.FIRST_SAME),cardType:I.DEBIT},config:{cardType:{isView:!0}},objectType:n.RENEWAL_SIGN},{title:"年金领取银行卡",schema:[],payInfoType:h.REPRISE,formData:{paymentGenre:String(_.FIRST_SAME)},config:{},objectType:n.ANNUAL_SIGN}].map((e=>({...e,nanoid:t()}))),A=[["initialPaymentMethod","initialCardType","initialBankCard","initialPaymentType"],["renewalPaymentGenre","renewalPaymentMethod","renewalCardType","renewalBankCard","renewalPaymentType","premiumOverdue"],["annuityPaymentGenre","annuityBankCard"]],N=i({schemaList:r(D)}),P=m((()=>["FIRST_TERM","RENEW_TERM","REPRISE"].reduce(((e,a)=>{const n=(t=a,N.schemaList.findIndex((e=>String(e.payInfoType)===String(h[t]))));var t;return n>-1&&(e[a]=n),e}),{}))),j=(e,a)=>{var n,t;return e>-1&&(null==(t=null==(n=N.schemaList[e])?void 0:n.formData)?void 0:t.paymentGenre)===`${_[a]}`},F=e=>{if("string"!=typeof e||!e)return"";const[a,n]=e.match(/^(?:initial|renewal|annuity)(.*)$/)||[];return n?T(n):e},G=(e,a)=>{var n;const{formData:t}=N.schemaList[a]||{},{paymentGenre:i,id:r,...m}=t||{},o={...m,bankCardImage:s(m.bankCardImage)?m.bankCardImage.map((a=>({...a,objectType:D[e].objectType}))):m.bankCardImage};Object.assign(null==(n=N.schemaList[e])?void 0:n.formData,o)},W=e=>e&&L.includes(e);return o((()=>N.schemaList.map((e=>{var a,n;return[null==(a=null==e?void 0:e.formData)?void 0:a.paymentMethod,null==(n=null==e?void 0:e.formData)?void 0:n.paymentGenre]}))),((e,a)=>{if(JSON.stringify(e)===JSON.stringify(a))return!1;E("支付方式变动"),N.schemaList.forEach(((e,a)=>{const{formData:n,schema:i}=e||{},r=[g.ALI_PAY,g.WECHAT_PAY].includes(String(null==n?void 0:n.paymentMethod)),m=[_.FIRST_SAME,_.RENEW_SAME].includes(Number(null==n?void 0:n.paymentGenre));i.forEach((e=>{e.hidden=(m||r)&&W(e.name)})),e.nanoid=t()}))}),{deep:!0,immediate:!0}),o((()=>{var e;return null==(e=N.schemaList[P.value.FIRST_TERM])?void 0:e.formData}),y((e=>{const{REPRISE:a,RENEW_TERM:n}=P.value;E("首期数据变动"),j(n,"FIRST_SAME")&&G(n,P.value.FIRST_TERM),j(a,"FIRST_SAME")&&G(a,n)}),500),{deep:!0}),o((()=>{var e;return null==(e=N.schemaList[P.value.RENEW_TERM])?void 0:e.formData}),y((e=>{E("续期数据变动");const{REPRISE:a,RENEW_TERM:n}=P.value;j(a,"RENEW_SAME")&&G(a,n)}),500),{deep:!0}),o((()=>{var e,a;return null==(a=null==(e=N.schemaList[P.value.RENEW_TERM])?void 0:e.formData)?void 0:a.paymentGenre}),(e=>{E("续期支付类型变动");const{FIRST_TERM:a,RENEW_TERM:n}=P.value,t=String(e)===String(_.FIRST_SAME),{schema:i}=N.schemaList[n]||{};t?G(n,a):N.schemaList[n]&&(N.schemaList[n].formData={...D[n].formData,paymentGenre:e}),s(i)&&i.forEach((e=>{e.hidden=t&&W(e.name)}))})),o((()=>{var e,a;return null==(a=null==(e=N.schemaList[P.value.REPRISE])?void 0:e.formData)?void 0:a.paymentGenre}),((e,a)=>{if(e===a)return!1;const{FIRST_TERM:n,RENEW_TERM:t,REPRISE:i}=P.value,{schema:r}=N.schemaList[i]||{},m=[_.FIRST_SAME,_.RENEW_SAME].includes(Number(e));if(E("年金支付类型变动"),m){const a=String(e)===String(_.FIRST_SAME)?n:t;G(i,a)}else N.schemaList[i]&&(N.schemaList[i].formData={...D[i].formData,paymentGenre:e});s(r)&&r.forEach((e=>{e.hidden=m&&W(e.name)}))}),{immediate:!0}),o([()=>M.schema,()=>M.config],(()=>{let e=[];N.schemaList=M.schema.reduce(((a,n)=>{const t=A.findIndex((e=>e.includes(n.name)));return"paymentDrawType"===n.name&&(e=n.columns.map((e=>e.code))),t>-1&&a[t].schema.push({...n,name:F(n.name),payInfoType:D[t].payInfoType}),a}),r(D)).map(((e,a)=>({...e,config:{...e.config,...M.config[a]||{}},nanoid:t()}))).filter((({schema:a,...n})=>e.includes(`${n.payInfoType}`)&&s(a)))}),{deep:!0,immediate:!0}),o((()=>M.modelValue),(e=>{s(e)&&N.schemaList.forEach(((a,n)=>{Object.assign(a.formData,e[n])}))}),{deep:!0,immediate:!0}),o((()=>{var e;return null==(e=N.schemaList)?void 0:e.map((e=>e.formData))}),(e=>{s(e)&&S("update:modelValue",e.map(((e,a)=>{const{payInfoType:n}=N.schemaList[a];return{...e,payInfoType:n}})))}),{deep:!0,immediate:!0}),v({validate:e=>{var a;return Promise.all(null==(a=b.value)?void 0:a.map((e=>e.validate())))}}),(a,n)=>(d(!0),c(f,null,l(u(N).schemaList,((a,n)=>(d(),p(u(R),{ref_for:!0,ref_key:"payInfoFormRef",ref:b,key:`${a.nanoid}_${n}`,schema:a.schema,model:a.formData,config:a.config,title:a.title,"is-view":e.isView,"extra-provision":{objectType:a.objectType,objectId:a.formData.id}},null,8,["schema","model","config","title","is-view","extra-provision"])))),128))}});export{v as _};
