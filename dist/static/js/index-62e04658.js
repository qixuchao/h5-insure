import{d as e,j as r,ca as t,o as s,p as i,w as o,a as l,b as n,u as a,v as u,_ as d,bN as c,ao as p,b3 as m,r as v,dh as L,E as f,c as k,q as h,F as C,s as V,d6 as I,e as g,br as b,bR as y,bs as O,cs as S,bo as P,bp as R,ce as T,k as _,aY as D,f as M,bm as w,bn as j,i as E,be as x,l as A,g as q,T as N,z as F,A as U,au as H,bQ as Y,n as $,M as B,bi as K,di as W,h as z,d3 as Q,dj as X,bc as G,cn as J,m as Z,bL as ee,dk as re,dl as te,dm as se,dn as ie,al as oe,x as le,b9 as ne,b8 as ae,aj as ue,dp as de,cD as ce,dq as pe,dr as me,ar as ve,b2 as Le,bC as fe,bf as ke}from"./index-a46ed5f2.js";import{A as he}from"./index-fe40352a.js";import{l as Ce}from"./index-0acab77e.js";import{p as Ve}from"./utils-314da9e3.js";import{P as Ie,u as ge}from"./ProductTips-20054294.js";import"./PolicyInfo-7fa6960b.js";import{a as be,b as ye,c as Oe}from"./createProposal-d8161294.js";import{c as Se,a as Pe,m as Re,q as Te,p as _e}from"./trial-37a584f8.js";import De from"./index-6fbfad96.js";import{a as Me,b as we}from"./format-31cde443.js";import{C as je}from"./index-462c363b.js";import{R as Ee}from"./trial-076a6016.js";import{_ as xe}from"./InsureInfos-fc86230c.js";import{P as Ae}from"./index-7311ae45.js";import{f as qe,a as Ne}from"./findLastIndex-bb06115b.js";import{c as Fe}from"./cloneDeep-e696f885.js";import{R as Ue,a as He}from"./product-7bbf9c44.js";import{g as Ye,t as $e,c as Be}from"./util-32f4760f.js";import"./infoCollection-a15f60e2.js";import"./questionnaire-42dcb602.js";import"./utils-862cbc56.js";import"./TrialButton-53509d35.js";import"./useOrder-b56b77b3.js";import"./utils-df123879.js";import"./index-74644256.js";const Ke={class:"trial-button"};var We=d(e({__name:"TrialPopup",props:{productCode:{default:""},productName:{default:""}},emits:["finish"],setup(e,{expose:d,emit:v}){const L=v,f=r(null),k=e;t(c,{insuredFactorCodes:["hasSocialInsurance","occupationCodeList"],holderFactorCodes:["birthday","gender","hasSocialInsurance","occupationCodeList"]});const h=(e,r)=>{var t,s;const{holder:i,insuredList:o}=e||{},{productList:l,...n}=(null==o?void 0:o[0])||{},a=p(null==r?void 0:r.insuredPremiumList)?null==(s=null==(t=null==r?void 0:r.insuredPremiumList)?void 0:t[0])?void 0:s.productPremiumList.reduce(((e,r)=>(e[r.productCode]=r.riskPremiumDetailVOList.reduce(((e,r)=>(e[r.riskCode]={initialPremium:r.initialPremium,initialAmount:r.initialAmount,unitAmount:r.unitAmount,unitPremium:r.unitPremium},e)),{}),e)),{}):{};return{holder:i,insuredPersonVO:n,insuredProductList:l.map((e=>({productCode:e.productCode,productName:e.productName,occupationCodeList:null==n?void 0:n.occupationCodeList,occupationClass:null==n?void 0:n.occupationClass,riskList:e.riskList.map((r=>{var t,s,i,o,l,n,u,d;return{...r,unitPremium:null==(s=null==(t=null==a?void 0:a[e.productCode])?void 0:t[r.riskCode])?void 0:s.unitPremium,unitAmount:null==(o=null==(i=null==a?void 0:a[e.productCode])?void 0:i[r.riskCode])?void 0:o.unitAmount,initialPremium:null==(n=null==(l=null==a?void 0:a[e.productCode])?void 0:l[r.riskCode])?void 0:n.initialPremium,initialAmount:null==(d=null==(u=null==a?void 0:a[e.productCode])?void 0:u[r.riskCode])?void 0:d.initialAmount}}))})))}};return d({...["open","close"].reduce(((e,r)=>(e[r]=(...e)=>{var t;null==(t=f.value)||t[r](...e)},e)),{}),formatData:h}),(e,r)=>{const t=m;return s(),i(De,{ref_key:"trialRef",ref:f,"hide-benefit":"","hide-popup-button":"",title:"选择保障方案",class:"proposal-trial","product-info":{productCode:e.productCode},"tenant-product-detail":{}},{trialBtn:o((e=>{var r,s;return[l("div",Ke,[n(t,{disabled:!(null==(s=null==(r=a(f))?void 0:r.getTrialSuccessFlag)?void 0:s.call(r)),type:"primary",onClick:r=>(({trialData:e,riskPremium:r,personalInfoRef:t})=>L("finish",h({...e,productCode:k.productCode},r)))(e)},{default:o((()=>[u("确定")])),_:2},1032,["disabled","onClick"])])]})),_:1},8,["product-info"])}}}),[["__scopeId","data-v-33dad28c"]]);const ze={class:"com-risk-list-wrapper"},Qe=(e=>(P("data-v-7d3c3028"),e=e(),R(),e))((()=>l("div",{class:"popup-title"},"选择附加险",-1))),Xe={class:"risk-list"},Ge={class:"cell-title"},Je={class:"title"},Ze={class:"footer-button"};var er=d(e({__name:"index",props:{riskList:{default:()=>[]},show:{type:Boolean,default:!1},collocationList:{default:()=>[]},disabled:{default:()=>[]},modelValue:{default:()=>[]}},emits:["finished","close","update:modelValue"],setup(e,{emit:t}){const d=e,c=t,p=r([]),P=r([]),R=r([...d.disabled]),T=v({show:d.show,currentChecked:[...d.modelValue]}),_=e=>{var r,t,s;if(R.value.includes(e))return;((e,r)=>{if(!d.collocationList.length)return r?void(T.currentChecked=[]):void T.currentChecked.push(e);let t=T.currentChecked,s=R.value;r?(d.collocationList.forEach((r=>{e===r.riskId&&(2===r.collocationType?t=t.filter((t=>t!==r.collocationRiskId||t!==e)):3===r.collocationType?(t=t.filter((r=>r!==e)),s=s.filter((e=>e!==r.collocationRiskId))):t=t.filter((r=>r!==e)))})),T.currentChecked=t,R.value=s):(d.collocationList.forEach((i=>{e===i.riskId&&(r||(2===i.collocationType?t.push(i.collocationRiskId):3===i.collocationType&&s.push(i.collocationRiskId),t.push(e)))})),T.currentChecked.push(...t),R.value=s)})(e,T.currentChecked.includes(e)),null==(s=null==(t=null==(r=null==p?void 0:p.value)?void 0:r[e])?void 0:t.toggle)||s.call(t)},D=()=>{c("close")},M=()=>{const e=d.riskList.filter((e=>T.currentChecked.includes(e.id)));c("update:modelValue",[...new Set(P.value)]),c("finished",e,R.value),c("close")};return L((()=>{p.value=[]})),f((()=>T.currentChecked),(e=>{P.value=e}),{deep:!0,immediate:!0}),f((()=>d.modelValue),(e=>{P.value=e||[],R.value.push(...e||[])}),{deep:!0,immediate:!0}),(e,r)=>{const t=b,d=y,c=je,v=O,L=m,f=S;return s(),k("div",ze,[n(f,{show:a(T).show,"onUpdate:show":r[1]||(r[1]=e=>a(T).show=e),title:"选择附加险","show-footer":"",round:"",position:"bottom",closeable:"",onClose:D},{default:o((()=>[Qe,l("div",Xe,[n(v,{modelValue:a(P),"onUpdate:modelValue":r[0]||(r[0]=e=>h(P)?P.value=e:null)},{default:o((()=>[n(c,{inset:""},{default:o((()=>[(s(!0),k(C,null,V(e.riskList,(e=>(s(),i(d,{key:e.id,title:e.riskName,disabled:a(R).includes(e.id),onClick:r=>_(e.id)},{"right-icon":o((()=>[n(t,{ref_for:!0,ref:r=>a(p)[e.id]=r,shape:"square",disabled:a(R).includes(e.id),name:e.id,onClick:I((r=>_(e.id)),["stop"])},null,8,["disabled","name","onClick"])])),title:o((()=>[l("div",Ge,[l("div",Je,g(e.riskName),1)])])),_:2},1032,["title","disabled","onClick"])))),128))])),_:1})])),_:1},8,["modelValue"])]),l("div",Ze,[n(L,{type:"primary",disabled:!a(T).currentChecked.length,block:"",onClick:M},{default:o((()=>[u("确认")])),_:1},8,["disabled"])])])),_:1},8,["show"])])}}}),[["__scopeId","data-v-7d3c3028"]]);const rr=e=>(P("data-v-b4a11106"),e=e(),R(),e),tr={class:"com-product-list-wrapper"},sr={class:"risk-item-wrapper"},ir={class:"operate-bar"},or=["onClick"],lr=["onClick"],nr={class:"content"},ar={class:"risk-factor"},ur={class:"factor"},dr={class:"factor-value"},cr=rr((()=>l("span",{class:"factor-name"}," 基本保险金额(元) ",-1))),pr={class:"factor"},mr={class:"factor-value"},vr=rr((()=>l("span",{class:"factor-name"}," 保障期间 ",-1))),Lr={class:"factor"},fr={class:"factor-value"},kr=rr((()=>l("span",{class:"factor-name"}," 交费期间 ",-1))),hr={class:"operate-bar-wrap"},Cr={class:"risk-premium"},Vr={class:"premium"},Ir={key:0,class:"operate-bar"},gr=e({name:"ProductList"});var br=d(e({...gr,props:{productRiskList:{default:()=>[]},productInfo:{default:()=>({})},productData:{default:()=>({})},pickProductPremium:{type:Function,default:()=>{}},productNum:{default:0},errorMsg:{default:""},productIndex:{},currentSelectInsure:{default:0}},emits:["deleteRisk","updateRisk","addRiderRisk"],setup(e,{emit:t}){const d=e,c=t,[p,m]=T(),v=r({checkedList:[],disabledList:[],riderRiskList:[],mainRiskData:{},totalPremium:0,currentRiskRecord:{},productRiskList:[]}),L=_((()=>{var e,r;return(null==(r=null==(e=d.productData)?void 0:e.productRiskVoList)?void 0:r[0].riskDetailVOList.filter((e=>1===e.collocationType)))||[]}));_((()=>{var e,r;const t=d.productRiskList.map((e=>e.riskId)),s=((null==(r=null==(e=d.productData)?void 0:e.productRiskVoList)?void 0:r[0].riskDetailVOList)||[]).filter((e=>t.includes(e.id)&&1===e.collocationType));return L.value.length-s.length})),_((()=>e=>{var r,t;const s=(null==(t=null==(r=d.productData)?void 0:r.productRiskVoList)?void 0:t[0].riskDetailVOList.find((r=>r.id!==e)))||{};let i=!1;return i=!!d.productNum||2===s.riskType&&1===s.collocationType,i}));const h=_((()=>{var e,r;return(null==(r=null==(e=d.productData)?void 0:e.productRiskVoList)?void 0:r[0].riskDetailVOList.find((e=>1===e.riskType)))||{}})),I=_((()=>h.value.collocationVOList||[])),b=(e,r)=>{const t=e.map((e=>e.id)).filter((e=>!v.value.disabledList.includes(e)));c("addRiderRisk",t,d.productInfo)};return f((()=>d.productInfo),(e=>{let r=0;(e.riskList||[]).forEach((e=>{r+=e.initialPremium})),v.value.totalPremium=r}),{deep:!0,immediate:!0}),f((()=>d.productRiskList),(e=>{const r=[],t=[],s=[];(e||[]).forEach((e=>{1===e.riskType?r.unshift(e):(t.push(e.riskId),s.push(e.riskId),r.push(e))})),v.value.disabledList=t,v.value.checkedList=s,v.value.productRiskList=r}),{deep:!0,immediate:!0}),(e,r)=>{const t=w,f=j;return s(),k("div",tr,[(s(!0),k(C,null,V(a(v).productRiskList,(r=>{var i,p;return s(),k("div",{key:r.riskId},[l("div",sr,[n(t,{"risk-type":r.riskType,title:r.riskName,class:"no-border"},{default:o((()=>[l("div",ir,[r.exemptFlag!==a(D).YES?(s(),k("div",{key:0,class:"add-risk btn",onClick:e=>{c("updateRisk",r,d.productInfo)}},"修改",8,or)):M("",!0),l("div",{class:"delete-risk btn",onClick:e=>{c("deleteRisk",r,d.productInfo)}},"删除",8,lr)])])),_:2},1032,["risk-type","title"]),l("div",nr,[l("div",ar,[l("div",ur,[l("span",dr,g((null==(i=r.initialAmount)?void 0:i.toLocaleString())||"-"),1),cr]),l("div",pr,[l("span",mr,g(a(Me)(r.coveragePeriod)||"-"),1),vr]),l("div",Lr,[l("span",fr,g(a(we)(r.chargePeriod)||"-"),1),kr])]),l("div",hr,[l("div",Cr,[u(" 首年保费:"),l("span",Vr,g(!e.errorMsg&&r.initialPremium?`￥${null==(p=r.initialPremium)?void 0:p.toLocaleString()}`:"-"),1)]),r.riskType===a(Ee).MAIN_RISK?(s(),k("div",Ir,[n(f,{activated:"",onClick:t=>((e,r)=>{var t;const s=null==(t=d.productData.productPlanInsureVOList)?void 0:t[0].insureProductRiskVOList.find((e=>e.riskCode===r.riskCode));c("addRiderRisk",e,r,s)})(e.productInfo,r)},{default:o((()=>[u("+附加险")])),_:2},1032,["onClick"])])):M("",!0)])])])])})),128)),a(p)?(s(),i(er,{key:0,modelValue:a(v).checkedList,"onUpdate:modelValue":r[0]||(r[0]=e=>a(v).checkedList=e),show:a(p),disabled:a(v).disabledList,"risk-list":a(L),"collocation-list":a(I),onFinished:b,onClose:r[1]||(r[1]=e=>a(m)(!1))},null,8,["modelValue","show","disabled","risk-list","collocation-list"])):M("",!0),n(Ie,{"error-msg":e.errorMsg},null,8,["error-msg"])])}}}),[["__scopeId","data-v-b4a11106"]]);const yr={class:"popup-container"},Or={class:"popup-header"},Sr={class:"title"},Pr=(e=>(P("data-v-5bddf42e"),e=e(),R(),e))((()=>l("p",{class:"tip"},"已为您筛选符合被保险人年龄、性别的附加险",-1))),Rr={class:"search"},Tr={key:0,class:"risk-list"},_r={class:"footer-button"},Dr=e({name:"riskSelect"});var Mr=d(e({...Dr,props:{type:{default:2},show:{type:Boolean,default:!1},title:{default:"添加附加险"},holder:{default:()=>({})},insuredList:{default:()=>[]},mainRisk:{default:()=>({})},selectList:{default:()=>[]},currentProduct:{default:()=>({})},currentRiskData:{default:()=>({})}},emits:["cancel","confirm"],setup(e,{emit:t}){const d=e,c=E(),{insurerCode:p="lianlife"}=c.query,m=t,v=r([]),L=r([]),S=r([]),P=r(),R=_((()=>d.show)),T=r({}),w=r([]),j=r([]),Y=()=>{m("cancel")},$=()=>{v.value=[]},B=()=>{var e;if(!(null==(e=v.value)?void 0:e.length))return void N(`暂未添加任何${d.type===Ee.MAIN_RISK?"主":"附加"}险`);const r=qe(d.currentProduct.riskList,(e=>e.riskCode===d.mainRisk.riskCode)),t=Ne(d.currentProduct.riskList,(e=>e.mainRiskCode===d.mainRisk.riskCode));let s=r;-1!==t&&(s=t);const i=[...d.currentProduct.riskList.slice(0,s+1),...j.value,...d.currentProduct.riskList.slice(s+1)],o={holder:d.holder,insuredList:d.insuredList.map((e=>(e.productList=[{...d.currentProduct,riskList:i}],e)))},l=Object.keys(T.value||{}).reduce(((e,r)=>{var t;return(null==(t=T.value[r])?void 0:t.errorMessage)||e.push(T.value[r].riskDetail),e}),[]);m("confirm",o,l)},K=["annuityDrawDate","coveragePeriod","chargePeriod","paymentFrequency"],W=e=>{d.type===Ee.RIDER_RISK&&(S.value||[]).forEach((r=>{v.value.includes(e)?e===r.relatedRiskCode?(2===r.collocationType&&v.value.push(r.collocationRiskCode),3===r.collocationType&&(v.value.push(e),v.value=v.value.filter((e=>e!==r.collocationRiskCode)))):e===r.collocationRiskCode&&(2===r.collocationType&&v.value.push(r.relatedRiskCode),3===r.collocationType&&(v.value=v.value.filter((e=>e!==r.relatedRiskCode)))):e===r.relatedRiskCode?(2===r.collocationType&&(v.value=v.value.filter((e=>e!==r.collocationRiskCode))),3===r.collocationType&&(v.value.push(e),v.value=v.value.filter((e=>e!==r.collocationRiskCode)))):e===r.collocationRiskCode&&(2===r.collocationType&&(v.value=v.value.filter((e=>e!==r.relatedRiskCode))),3===r.collocationType&&(v.value=v.value.filter((e=>e!==r.relatedRiskCode))))})),v.value=[...new Set(v.value)]},z=async()=>{const e={insuredList:d.insuredList,holder:d.holder||{},mainRiskCode:d.mainRisk.riskCode,insureCode:p,productCategory:"",keyword:P.value,selectRiskCodes:d.selectList},{code:r,data:t}=await be(e);"10000"===r&&(L.value=t.riskInfoList,S.value=t.collocationInfoResList)};return f((()=>v.value),x((e=>{const r={};Object.keys(T.value).reduce(((r,t)=>((e||[]).includes(t)&&(r[t]=T.value[t]),r)),r),T.value=r;const t=(e||[]).filter((e=>!Object.keys(T.value).includes(e)));(null==t?void 0:t.length)&&(async e=>{const{code:r,data:t}=await Se({holder:d.holder,insuredList:d.insuredList,calcRiskDefaultFactorVO:{mainRiskInfo:d.mainRisk,riskCodeList:e}},{loading:!0});"10000"===r&&t.reduce(((e,{insureProductRiskVO:r,errorMessage:t,...s})=>(e[s.riskCode]={defaultValue:s,riskDetail:{...r,mainRiskCode:d.mainRisk.riskCode},errorMessage:t},e)),T.value)})(t)}),1e3),{immediate:!0,deep:!0}),f((()=>T.value),(e=>{j.value=Object.keys(T.value||{}).reduce(((e,r)=>{var t;return(null==(t=T.value[r])?void 0:t.errorMessage)||e.push(T.value[r].defaultValue),e}),[])}),{immediate:!0,deep:!0}),A((()=>{z()})),(e,r)=>{const t=F,c=b,p=y,m=je,f=O,S=U,_=H;return s(),i(_,{show:a(R),"onUpdate:show":r[3]||(r[3]=e=>h(R)?R.value=e:null),class:"popup-risk-select",closeable:!1},{default:o((()=>{var b,y;return[l("div",yr,[l("div",Or,[l("span",{class:"clear-all",onClick:$}," 清空选项 "),l("span",Sr,g(e.title),1),l("span",{class:"close",onClick:Y},"X")]),Pr,l("div",Rr,[n(t,{modelValue:a(P),"onUpdate:modelValue":r[0]||(r[0]=e=>h(P)?P.value=e:null),placeholder:"请输入附加险名称",onSearch:z},null,8,["modelValue"])]),(null==(b=a(L))?void 0:b.length)?(s(),k("div",Tr,[n(f,{modelValue:a(v),"onUpdate:modelValue":r[2]||(r[2]=e=>h(v)?v.value=e:null)},{default:o((()=>[n(m,{inset:""},{default:o((()=>[(s(!0),k(C,null,V(a(L),(({riskCode:t,riskName:l})=>{var u,m,v,L,f;return s(),k(C,{key:t},[n(p,{clickable:"",title:l,onClick:e=>W(t)},{"right-icon":o((()=>[n(c,{ref_for:!0,ref:r=>a(w)[e.index]=r,name:t,onClick:I((e=>W(t)),["stop"])},null,8,["name","onClick"])])),_:2},1032,["title","onClick"]),(null==(u=a(T)[t])?void 0:u.riskDetail)?(s(),i(xe,{key:0,ref_for:!0,ref:"insureInfosRef",class:"insure-part","origin-data":null==(m=a(T)[t])?void 0:m.riskDetail,"default-value":null==(v=a(T)[t])?void 0:v.defaultValue,onTrialChange:r[1]||(r[1]=(r,t)=>(async(e,r,t)=>{var s;if(e.exemptFlag===D.YES)return!1;if(r){const i=Fe(e);if(delete i.insurancePeriodValueList,delete i.paymentFrequencyList,delete i.paymentPeriodValueList,K.indexOf(r.key)>=0&&`${r.oldValue}`!=`${r.newValue}`){const o={};switch(r.key){case"annuityDrawDate":o.changeType=3;break;case"coveragePeriod":o.changeType=2;break;case"chargePeriod":o.changeType=1;break;case"paymentFrequency":o.changeType=4}const l=[{insureProductRiskVO:d.currentRiskData,insureRiskEditReqVO:d.mainRisk},{insureProductRiskVO:null==(s=T.value[e.riskCode])?void 0:s.riskDetail,insureRiskEditReqVO:{riskId:e.riskId,riskCode:e.riskCode,...i,...o}}],n=d.insuredList.filter((e=>e.birthday))||[];if(!n.length)return!1;await Pe({calcProductFactorList:[{planCode:"",productCode:t,riskEditVOList:l}],insuredVOList:n,holderVO:d.holder})}}else Object.assign(T.value[e.riskCode].defaultValue,e);return!0})(r,t,e.productCode))},null,8,["origin-data","default-value"])):M("",!0),(null==(L=a(T)[t])?void 0:L.errorMessage)?(s(),i(Ie,{key:1,"error-msg":null==(f=a(T)[t])?void 0:f.errorMessage},null,8,["error-msg"])):M("",!0)],64)})),128))])),_:1})])),_:1},8,["modelValue"])])):(s(),i(S,{key:1,title:`暂无关联${e.type===a(Ee).MAIN_RISK?"主":"附加"}险、请选择其他险种`},null,8,["title"])),l("div",_r,[n(Ae,{shadow:!1,disabled:!(null==(y=a(j))?void 0:y.length),onClick:B},{default:o((()=>[q(e.$slots,"default",{},(()=>[u("确定")]),!0)])),_:3},8,["disabled"])])])]})),_:3},8,["show"])}}}),[["__scopeId","data-v-5bddf42e"]]);const wr=e=>(P("data-v-6feef9e1"),e=e(),R(),e),jr={class:"insurer-list"},Er=["onClick"],xr=wr((()=>l("span",{class:"insure-name"},"被保险人",-1))),Ar={key:0,class:"insure-relate"},qr={key:1,class:"insure-relate"},Nr=["onClick"],Fr=wr((()=>l("div",{class:"gap"},null,-1))),Ur=wr((()=>l("span",null,"+",-1))),Hr=e({name:"InsurerSelect"});var Yr=d(e({...Hr,props:{insurerList:{default:()=>[]},config:{default:()=>{}},canChangeSelect:{type:Boolean,default:()=>!0}},emits:["listChange","currentChange","add","delete","validateTab"],setup(e,{expose:t,emit:i}){const o=e,n=r(),d=r(),c=r({currentSelected:0}),p=r(o.insurerList),m=i,v=(e=!1)=>{d.value&&B((()=>{var r;null==(r=n.value[c.value.currentSelected])||r.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),0===c.value.currentSelected?d.value.scrollLeft=0:e&&c.value.currentSelected>=3&&(d.value.scrollLeft=d.value.scrollWidth)}))};Y((()=>{v(!0)}));const L=e=>{var r;if((null==e?void 0:e.personVO)&&(null==(r=null==e?void 0:e.personVO)?void 0:r.relationToMainInsured)){const r=Ue.find((r=>{var t;return r.value===`${null==(t=null==e?void 0:e.personVO)?void 0:t.relationToMainInsured}`}));if(r)return r.label}return"关系"},h=()=>{var e,r,t,s,i;return!(!(null==(r=null==(e=p.value)?void 0:e[c.value.currentSelected])?void 0:r.productList)||(null==(i=null==(s=null==(t=p.value)?void 0:t[c.value.currentSelected])?void 0:s.productList)?void 0:i.length)<=0)},I=()=>{h()?m("validateTab",(()=>{p.value.push({}),c.value.currentSelected=p.value.length-1,m("add",{},p.value.length-1)})):N("请确认信息是否录入完整!")};return f((()=>o.insurerList.length),(()=>{p.value=o.insurerList,v()}),{deep:!0,immediate:!0}),t({updateInsurer:(e,r)=>{}}),(e,r)=>(s(),k("div",jr,[l("div",{ref_key:"tabsRef",ref:d,class:"list"},[(s(!0),k(C,null,V(a(p),((e,r)=>(s(),k("div",{ref_for:!0,ref_key:"tabRef",ref:n,key:`insure_${r}`,class:$("insure-box "+(r===a(c).currentSelected?"selected":"")),onClick:e=>((e,r)=>{h()?o.canChangeSelect&&m("validateTab",(()=>{c.value.currentSelected=r,m("currentChange",r),v()})):N("请确认信息是否录入完整!")})(0,r)},[xr,0===r?(s(),k("span",Ar,"本人")):(s(),k("span",qr,g(L(e)),1)),r>0?(s(),k("div",{key:2,class:"delete-btn",onClick:e=>((e,r)=>{e.preventDefault(),e.stopPropagation(),e.cancelBubble=!0,K.confirm({message:"确定要删除该被保险人吗？"}).then((()=>{m("delete",r,(()=>{r<c.value.currentSelected?(c.value.currentSelected-=1,m("currentChange",c.value.currentSelected)):r===c.value.currentSelected&&(c.value.currentSelected=0,m("currentChange",0))}))})).catch((()=>{}))})(e,r)},"×",8,Nr)):M("",!0)],10,Er)))),128))],512),l("div",{class:"operate"},[Fr,l("div",{class:"add-btn",onClick:I},[Ur,u(" 被保险人")])])]))}}),[["__scopeId","data-v-6feef9e1"]]);const $r=e=>(P("data-v-0cc36698"),e=e(),R(),e),Br={class:"proposal-header"},Kr={key:0,class:"container"},Wr=$r((()=>l("div",{class:"title-tip-icon"},"投保人信息",-1))),zr=$r((()=>l("span",null,"为TA换个产品",-1))),Qr={key:0,class:"operate-bar"},Xr={key:0,class:"operate-bar"},Gr={class:"footer-bar"},Jr={class:"trial-result"},Zr={class:"result-num"},et={class:"trial-operate"},rt=e({name:"CreateProposal"});var tt=d(e({...rt,setup(e){const t=[{name:"保存修改"},{name:"另存为新计划书"}],d=W(),[c,L]=T(),[I,b]=T(),y=r({holder:{},insuredList:[{name:"",gender:"",birthday:"",productList:[]}],proposalName:"",totalPremium:0,relationUserType:2}),O=z(),S=E(),P=ge(),R={};r(!1);const{productCode:w,id:A,preview:q}=S.query,F=["age","gender","birthday","hasSocialInsurance","occupationCodeList"];Q("LIANLIFE_OCCUPATION");const H=r(null),$=v({selectedProductCodeList:[],selectedProductList:[],insuredPersonVO:{},insurerList:[],currentProductCode:"",currentProduct:{},holder:{},productList:[],productCollection:{},productErrorMap:{},defaultData:null,currentSelectInsure:0,isLoading:!1,updateRiskCode:"",currentMainRisk:()=>({}),currentRiskData:()=>({})}),Ie=r(!1),be=r(null),Se=r(null),De=r(null),Me=(e,r,t)=>e?+e<18?"投保人年龄不得小于18周岁":"":"请输入投保人年龄";_((()=>{var e;return(null==(e=$.insurerList[$.currentSelectInsure])?void 0:e.productList)?$.insurerList[$.currentSelectInsure].productList.map((e=>e.productCode)).filter((e=>Boolean(e))):[]}));const we=()=>$.insurerList[$.currentSelectInsure].productList.map((e=>e.productCode)).filter((e=>Boolean(e))),je=_((()=>{const{productPlanInsureVOList:e}=$.productCollection[w]||{},[{insureProductRiskVOList:r=[]}={}]=e||[],{riskInsureLimitVO:t}=(null==r?void 0:r.find((e=>1===e.riskType)))||{};return null==t?void 0:t.sexLimit})),Ee=_((()=>"-1"!==je.value&&je.value?X.filter((e=>je.value===e.value)):X)),xe=_((()=>{var e;return(null==(e=$.productCollection)?void 0:e[$.currentProductCode])||{}}));_((()=>{var e,r;return(null==(r=null==(e=xe.value)?void 0:e.productPlanInsureVOList)?void 0:r[0])||{}})),_((()=>{var e,r,t;return null==(t=null==(r=null==(e=xe.value)?void 0:e.productPlanInsureVOList)?void 0:r[0])?void 0:t.multiInsuredConfigVO}));const Ae=_((()=>!Ie.value||Boolean(Object.values($.productErrorMap).join("")))),qe=r(),Ne=_((()=>"1"!=`${q}`)),Fe=_((()=>$.insurerList.reduce(((e,r)=>+(r.productList.reduce(((e,r)=>+e+ +r.riskList.reduce(((e,r)=>+e+ +(r.initialPremium||0)),0)),0)+ +e)),0))),Ke=e=>{var r,t;const s=[null==(r=Se.value)?void 0:r.validate()];if(0===$.currentSelectInsure){if(1===$.insurerList[0].personVO.relationToHolder&&$.insurerList[0].personVO.age<18||1!==$.insurerList[0].personVO.relationToHolder&&$.holder.age<18)return void N("投保人年龄不得小于18周岁");s.push(null==(t=De.value)?void 0:t.validate())}Promise.all(s).then((()=>{e()})).catch((e=>{N("请确认信息是否录入完整!")}))},ze=()=>{const e=$.insurerList.findIndex((({personVO:e})=>e.relationToMainInsured===+He.MATE));return Ue.map((r=>r.value===He.SELF||r.value===He.MATE&&e>=0&&e!==$.currentSelectInsure?{...r,disabled:!0}:{...r}))},Qe=(e,r="")=>{$.productErrorMap[e]=r},Xe=e=>{null==e||e.insuredProductList.reduce(((e,r)=>{var t,s;const i=null==(s=null==(t=$.insurerList)?void 0:t[$.currentSelectInsure])?void 0:s.productList.findIndex((e=>e.productCode===r.productCode));return-1!==i?e[i]=r:e.push(r),e}),$.insurerList[$.currentSelectInsure].productList)},Ge=e=>{var r;console.log("onFinished",e),Object.assign($.holder,e.holder),0===$.currentSelectInsure&&(e.insuredPersonVO.relationToHolder=$.insurerList[$.currentSelectInsure].personVO.relationToHolder),$.insurerList[$.currentSelectInsure]&&Object.assign($.insurerList[$.currentSelectInsure].personVO,e.insuredPersonVO),Xe(e),Qe(e.productCode),Ie.value=!0,null==(r=H.value)||r.close()},Je=_((()=>{var e;return 1===(null==(e=$.insurerList[$.currentSelectInsure].productList)?void 0:e.length)})),Ze=()=>{P.setInsuredPersonVO($.insurerList[$.currentSelectInsure].personVO),P.setHolderPersonVO($.holder),P.setExcludeProduct([]),P.setProposalInfo(y.value),$.insurerList[$.currentSelectInsure].productList=[],O.push({path:"/proposalListSelect",query:{isCreateProposal:"1"}})},er=()=>{var e,r;Promise.all([null==(e=Se.value)?void 0:e.validate(),null==(r=De.value)?void 0:r.validate()]).then((()=>{var e,r,t;P.setProposalInfo(y.value),P.setExcludeProduct(we()),P.setExcludeMainRiskCode($.insurerList[$.currentSelectInsure].productList.reduce(((e,r)=>e.concat(r.riskList.filter((e=>1===e.riskType)).map((e=>e.riskCode)))),[])),P.setInsuredPersonVO($.insurerList[$.currentSelectInsure].personVO),P.setHolderPersonVO($.holder);const s={isCreateProposal:"1"};!!(null==(t=null==(r=null==(e=$.insurerList)?void 0:e[$.currentSelectInsure])?void 0:r.productList)?void 0:t.length)&&(s.productClass=qe.value),O.push({path:"/proposalListSelect",query:s})})).catch((e=>{console.log("e",e),N("请确认被保险人信息是否录入完整!")}))},rr=(e,r)=>{const t=e;_e(t).then((({code:e,data:s,message:i})=>{var o;e===ke&&s?(null==r||r(),(null==s?void 0:s.errorInfo)&&N(`${null==s?void 0:s.errorInfo}`),p(s.insuredPremiumList)&&Xe(null==(o=H.value)?void 0:o.formatData(t,s)),Qe(t.productCode),Ie.value=!0):Qe(t.productCode,i)}))},tr=e=>{e&&($.insurerList[$.currentSelectInsure].personVO.age=ne(new Date).diff(e,"year"))},sr=e=>{e&&($.holder.age=ne(new Date).diff(e,"year"))},ir=e=>{const{value:r}=e;let t={age:30,birthday:ne().subtract(30,"year").format("YYYY-MM-DD"),gender:+ae.MALE};[He.MATE,He.CHILD].includes(r)?t={age:r===He.MATE?$.insurerList[0].personVO.age:0,birthday:r===He.MATE?$.insurerList[0].personVO.birthday:ne().subtract(28,"day").format("YYYY-MM-DD"),gender:r===He.MATE?1==+$.insurerList[0].personVO.gender?2:1:+ae.MALE}:He.PARENT===r&&(t={age:+$.insurerList[0].personVO.age+18,birthday:ne($.insurerList[0].personVO.birthday).subtract(18,"year").format("YYYY-MM-DD"),gender:+ae.MALE}),Object.assign($.insurerList[$.currentSelectInsure].personVO,t)},or=()=>{$.insurerList[$.currentSelectInsure].personVO.birthday=""},lr=()=>{if(0===$.currentSelectInsure){const e=$.insurerList.findIndex((e=>!(!e||!e.personVO)&&+e.personVO.relationToMainInsured==+He.MATE));-1!==e&&($.insurerList[e].personVO.gender=1==+$.insurerList[0].personVO.gender?2:1)}},nr=()=>{$.holder.birthday=""},ar=e=>{Re(e).then((({code:e,data:r})=>{var t,s;"10000"===e&&p(r.productDetailResList)&&(qe.value=null==(s=null==(t=null==r?void 0:r.productDetailResList)?void 0:t[0])?void 0:s.productClass,null==r||r.productDetailResList.reduce(((e,r)=>(e[r.productCode]=r,R[r.productCode]=r.productName,e)),$.productCollection))})).finally((()=>{}))},ur=()=>{if(1==+$.insurerList[0].personVO.relationToHolder){const{relationToHolder:e,relationToMainInsured:r,productList:t,...s}=$.insurerList[0].personVO;return A&&(s.id=$.holder.id),s}return $.holder},dr=e=>0===e&&2==+$.insurerList[e].personVO.relationToHolder?{...$.insurerList[e].personVO,relationToHolder:null}:$.insurerList[e].personVO,cr=async(e,r=!1)=>{var t;if(!p(e))return;const s=Ye();let i=[$.insurerList[$.currentSelectInsure]&&$.insurerList[$.currentSelectInsure].personVO||{}];if(s){const e=$e(s,[...F,"name"]);i=[e],Be()}const{code:o,data:l}=await Te({calcProductFactorList:e,insuredVOList:i},{isCustomError:!r});if("10000"===o&&l&&l){const{holder:e,insuredList:s}=l,{productList:o,...n}=(s||[])[0]||{},[{riskList:a=[],...u}={}]=o||[],d={...u,riskList:a};r&&($.insurerList[$.currentSelectInsure]&&Object.assign($.insurerList[$.currentSelectInsure].personVO,n,{relationToHolder:1,name:n.name||(null==(t=null==i?void 0:i[0])?void 0:t.name)}),Object.assign($.holder,e,{hasSocialInsurance:e.hasSocialInsurance||"1"})),s.forEach(((e,r)=>{var t;const{productList:s,...o}=e;0===$.insurerList.length&&(o.relationToMainInsured||(o.relationToMainInsured=He.SELF),$.insurerList.push({productList:s.map((e=>({...e}))),personVO:{...o,name:n.name||(null==(t=null==i?void 0:i[0])?void 0:t.name)}}))}));const c=we().findIndex((e=>e===(null==o?void 0:o[0].productCode)));c>-1?$.productList[c]=d:$.productList.push(d),B((()=>{rr({...l,holder:{...ur()},insuredList:[{...dr($.currentSelectInsure),productList:o}]})}))}},pr=e=>($.insurerList[$.currentSelectInsure].productList.find((r=>r.productCode===e)),{holder:{...ur()},insuredList:[{...dr($.currentSelectInsure),productList:$.insurerList[$.currentSelectInsure].productList}]}),mr=e=>{var r;return null==(r=e.find((e=>e.defaultFlag===D.YES)))?void 0:r.code},vr=(e,r)=>{const t=r;K.confirm({message:"确认删除该险种？"}).then((()=>{1===e.riskType?$.insurerList[$.currentSelectInsure].productList=$.insurerList[$.currentSelectInsure].productList.filter((e=>e.productCode!==t.productCode)).map((e=>({...e,nanoid:ue()}))):(t.riskList=t.riskList.filter((r=>r.riskId!==e.riskId)),$.productCollection[t.productCode].productPlanInsureVOList[0].insureProductRiskVOList=$.productCollection[t.productCode].productPlanInsureVOList[0].insureProductRiskVOList.filter((r=>r.riskCode!==e.riskCode)),console.log("stateInfo.productCollection",$.productCollection)),Qe(t.productCode)}))},Lr=r(!1),fr=(e,r)=>{var t;$.updateRiskCode=e.riskCode,$.currentProductCode=r.productCode;const s=Ce.exports.cloneDeep(pr(r.productCode));$.defaultData=s,Lr.value=!0,null==(t=H.value)||t.open()},kr=r({}),hr=(e,r,t)=>{var s,i;Promise.all([null==(s=Se.value)?void 0:s.validate(),null==(i=De.value)?void 0:i.validate()]).then((()=>{kr.value[e.productCode]=e.riskList.map((e=>e.riskCode)),$.currentProduct=e,$.currentMainRisk=r,$.currentRiskData=t,L(!0)})).catch((e=>{console.log("e",e),N("请确认投被保险人信息是否录入完整!")}))},Cr=(e,r)=>{rr(e,(()=>{$.productCollection[e.insuredList[0].productList[0].productCode].productPlanInsureVOList[0].insureProductRiskVOList.push(...r)})),L(!1)},Vr=()=>{L(!1)},Ir=e=>{var r,t,s;if($.insurerList.some((e=>0===e.productList.length)))return void N("请先添加产品");const i=[null==(r=be.value)?void 0:r.validate(),null==(t=Se.value)?void 0:t.validate()];if(0===$.currentSelectInsure){if(1===$.insurerList[0].personVO.relationToHolder&&$.insurerList[0].personVO.age<18||1!==$.insurerList[0].personVO.relationToHolder&&$.holder.age<18)return void N("投保人年龄不得小于18周岁");i.push(null==(s=De.value)?void 0:s.validate())}Promise.all(i).then((()=>{$.isLoading=!0,Oe({holder:{...ur()},insuredList:$.insurerList.map(((e,r)=>({...dr(r),productList:e.productList.map((e=>({...e,productName:R[e.productCode]})))}))),proposalName:$.insuredPersonVO.proposalName,totalPremium:Fe.value,relationUserType:2,id:e}).then((e=>{const{code:r,data:t}=e||{};"10000"===r&&(P.$reset(),O.push({path:"/compositionProposal",query:{id:t,preview:q}}))})).catch((()=>{$.isLoading=!1}))}))},gr=()=>{A?b(!0):Ir(A)},yr=(e,r)=>{Ir(r?void 0:A)},Or=e=>{var r;$.currentSelectInsure=e,(null==(r=$.insurerList[e])?void 0:r.productList.length)>0?ar(Ve($.insurerList[e].productList)):$.productCollection={}},Sr=(e,r)=>{if($.insurerList.length-1===r){const t=$.insurerList.findIndex((e=>!(!e||!e.personVO)&&+e.personVO.relationToMainInsured==+He.MATE));$.insurerList[r]={...e,personVO:{age:t<0?$.insurerList[0].personVO.age:0,birthday:t<0?$.insurerList[0].personVO.birthday:ne().subtract(28,"day").format("YYYY-MM-DD"),relationToMainInsured:t<0?He.MATE:He.CHILD,gender:t<0?1==+$.insurerList[0].personVO.gender?2:1:ae.MALE,hasSocialInsurance:de.NO},productList:[]}}$.currentSelectInsure=r,$.productCollection={}},Pr=(e,r)=>{$.insurerList.splice(e,1),null==r||r()};return f([()=>F.map((e=>$.insurerList[$.currentSelectInsure]?$.insurerList[$.currentSelectInsure].personVO[e]:"")),()=>$.currentSelectInsure,()=>F.map((e=>$.holder?$.holder[e]:""))],(([e,r,t],[s,i,o])=>{var l,n,a;(e.join(",")!==s.join(",")||2===$.insurerList[$.currentSelectInsure].personVO.relationToHolder&&(t||[]).join(",")!==(o||[]).join(","))&&r===i&&(1===$.insurerList[$.currentSelectInsure].personVO.relationToHolder&&Object.assign($.holder,null==(n=null==(l=null==$?void 0:$.insurerList)?void 0:l[0])?void 0:n.personVO,{id:null==(a=$.holder)?void 0:a.id}),p(Object.keys($.productCollection))&&(async e=>{try{const{code:e,data:r,message:t}=await Pe({calcProductFactorList:$.insurerList[$.currentSelectInsure].productList.map((({productCode:e,riskList:r})=>{const{productPlanInsureVOList:t}=$.productCollection[e]||{},[{insureProductRiskVOList:s}={}]=t||[];return{productCode:e,planCode:"",riskEditVOList:p(r)?r.map((e=>(console.log("riskItem",e,s),{insureProductRiskVO:(null==s?void 0:s.find((r=>r.riskCode===e.riskCode)))||{},insureRiskEditReqVO:e}))):[]}})),insuredVOList:[$.insurerList[$.currentSelectInsure].personVO],holderVO:$.holder},{isCustomError:!0});"10000"===e&&p(r)&&($.insurerList[$.currentSelectInsure].productList.forEach((({productCode:e,riskList:t})=>{const{productRiskDyInsureFactorVOList:s,errorMessage:i,productCode:o}=r.find((r=>r.productCode===e))||{};Qe(o,i),t.forEach((e=>{const r=(s||[]).find((r=>r.riskCode===e.riskCode));Object.assign(e,{...e,...r,coveragePeriod:mr(r.insurancePeriodValueList),chargePeriod:mr(r.paymentPeriodValueList),paymentFrequency:mr(r.paymentFrequencyList)})}))})),rr(pr()))}catch(r){console.log("Error",r)}})(we()))}),{deep:!0}),f((()=>$.selectedProductCodeList),x((e=>{if(p(e)){console.log("选择的产品变动了",e,Ce.exports.cloneDeep($.insurerList)),cr(e.map((e=>({productCode:e}))));const r=Object.keys($.productCollection),t=null==e?void 0:e.filter((e=>!r.includes(e)));p(t)&&ar({productList:null==t?void 0:t.map((e=>({mergeRiskReqList:[],productCode:e})))})}})),{deep:!0}),Y((()=>{const{selectedProduct:e,selectedProductList:r}=P.$state;$.selectedProductList=r,$.selectedProductCodeList=p(e)?e:[]})),G((()=>{if(J(),w){const e=[{productCode:w}];ar({productList:[{productCode:w,mergeRiskReqList:[]}]}),cr(e,!0)}A&&(((e={})=>{ye(e).then((({code:e,data:r})=>{if("10000"===e&&r){const{insuredList:e,holder:t,proposalName:s}=r||{},[{productList:i,...o}]=e||[];$.holder=t,$.insuredPersonVO={...o,proposalName:s};let l=!1;$.insurerList=e.map(((e,r)=>{const{productList:t,...s}=e,{occupationCodeList:i,occupationClass:o}=(null==t?void 0:t[0])||{};return Object.assign(s,{occupationCodeList:i,occupationClass:o}),0===r&&(s.relationToHolder=s.relationToHolder?1:2,sr($.holder.birthday)),{productList:t.filter((e=>(l||1===e.shelfStatus||(l=!0),1===e.shelfStatus))),personVO:s}})),l&&N("计划书中存在已下架产品，请重新生成计划书"),ar(Ve(i.filter((e=>1===e.shelfStatus)))),$.productList=i}}))})({id:A}),Ie.value=!0);const e=(A?"编辑":"创建")+"计划书";S.meta.title=e,document.title=e})),(e,r)=>{const p=ce,v=pe,L=me,f=ve,y=Le,O=j,S=m,P=he,R=Z("ProPageWrap"),T=fe;return s(),i(T,{"theme-vars":a(d)},{default:o((()=>[n(R,{class:"page-create-wrapper"},{default:o((()=>{var e,d;return[l("div",Br,[n(p,{ref_key:"formRef",ref:be,class:"mb20",model:a($).insuredPersonVO},{default:o((()=>[n(a(ee),{modelValue:a($).insuredPersonVO.proposalName,"onUpdate:modelValue":r[0]||(r[0]=e=>a($).insuredPersonVO.proposalName=e),class:"ra20",label:"计划书名称",name:"proposalName",maxlength:20},null,8,["modelValue"])])),_:1},8,["model"]),n(Yr,{config:a($),"insurer-list":a($).insurerList,"can-change-select":!0,onValidateTab:Ke,onCurrentChange:Or,onAdd:Sr,onDelete:Pr},null,8,["config","insurer-list"])]),a($).insurerList[a($).currentSelectInsure]?(s(),k("div",Kr,[n(f,{title:"被保险人信息",class:"com-pro-form-with-card com-card-body-no-padding insure-containe","show-divider":!1},{default:o((()=>[n(p,{ref_key:"insuredFormRef",ref:Se,model:a($).insurerList[a($).currentSelectInsure].personVO},{default:o((()=>[n(a(ee),{modelValue:a($).insurerList[a($).currentSelectInsure].personVO.name,"onUpdate:modelValue":r[1]||(r[1]=e=>a($).insurerList[a($).currentSelectInsure].personVO.name=e),label:"姓名",name:"name",maxlength:20,required:""},null,8,["modelValue"]),0!==a($).currentSelectInsure&&a($).insurerList[a($).currentSelectInsure]?(s(),i(v,{key:0,modelValue:a($).insurerList[a($).currentSelectInsure].personVO.relationToMainInsured,"onUpdate:modelValue":r[2]||(r[2]=e=>a($).insurerList[a($).currentSelectInsure].personVO.relationToMainInsured=e),label:"与主被保险人关系","is-default-selected":!0,name:"relationToMainInsured",columns:ze(),required:"",onConfirm:ir},null,8,["modelValue","columns"])):M("",!0),n(a(ee),{modelValue:a($).insurerList[a($).currentSelectInsure].personVO.age,"onUpdate:modelValue":r[4]||(r[4]=e=>a($).insurerList[a($).currentSelectInsure].personVO.age=e),class:"age-field-wrap",name:"age",label:"年龄",type:"digit",maxlength:3,required:"",onChange:or},{extra:o((()=>[n(a(re),{modelValue:a($).insurerList[a($).currentSelectInsure].personVO.birthday,"onUpdate:modelValue":[r[3]||(r[3]=e=>a($).insurerList[a($).currentSelectInsure].personVO.birthday=e),tr],class:"birthday-field-wrap",label:"出生日期",name:"birthday"},null,8,["modelValue"])])),_:1},8,["modelValue"]),n(a(te),{modelValue:a($).insurerList[a($).currentSelectInsure].personVO.gender,"onUpdate:modelValue":r[5]||(r[5]=e=>a($).insurerList[a($).currentSelectInsure].personVO.gender=e),label:"性别",name:"gender",columns:a(Ee),disabled:+a($).insurerList[a($).currentSelectInsure].personVO.relationToMainInsured==+a(He).MATE,required:"",onChange:lr},null,8,["modelValue","columns","disabled"]),n(a(te),{modelValue:a($).insurerList[a($).currentSelectInsure].personVO.hasSocialInsurance,"onUpdate:modelValue":r[6]||(r[6]=e=>a($).insurerList[a($).currentSelectInsure].personVO.hasSocialInsurance=e),label:"社保","show-extra":"",name:"hasSocialInsurance",columns:a(se),required:""},null,8,["modelValue","columns"]),n(L,{modelValue:a($).insurerList[a($).currentSelectInsure].personVO.occupationCodeList,"onUpdate:modelValue":r[7]||(r[7]=e=>a($).insurerList[a($).currentSelectInsure].personVO.occupationCodeList=e),label:"职业",name:"occupationCodeList","dict-code":"LIANLIFE_OCCUPATION",required:""},null,8,["modelValue"])])),_:1},8,["model"]),0===a($).currentSelectInsure?(s(),k(C,{key:0},[Wr,n(p,{ref_key:"holderFormRef",ref:De,model:a($).holder,class:"insure-container"},{default:o((()=>[n(a(te),{modelValue:a($).insurerList[0].personVO.relationToHolder,"onUpdate:modelValue":r[8]||(r[8]=e=>a($).insurerList[0].personVO.relationToHolder=e),label:"投被保险人是同一人",columns:a(ie),required:""},null,8,["modelValue","columns"]),2===a($).insurerList[0].personVO.relationToHolder?(s(),k(C,{key:0},[n(a(ee),{modelValue:a($).holder.name,"onUpdate:modelValue":r[9]||(r[9]=e=>a($).holder.name=e),name:"name",label:"姓名",maxlength:20,required:""},null,8,["modelValue"]),n(a(ee),{modelValue:a($).holder.age,"onUpdate:modelValue":r[11]||(r[11]=e=>a($).holder.age=e),class:"age-field-wrap",name:"age",label:"年龄",type:"digit",maxlength:3,required:"",rules:[{required:!0,message:"请输入年龄"},{trigger:"onChange",validator:Me}],onChange:nr},{extra:o((()=>[n(a(re),{modelValue:a($).holder.birthday,"onUpdate:modelValue":[r[10]||(r[10]=e=>a($).holder.birthday=e),sr],class:"birthday-field-wrap",label:"出生日期",name:"birthday"},null,8,["modelValue"])])),_:1},8,["modelValue","rules"]),n(a(te),{modelValue:a($).holder.gender,"onUpdate:modelValue":r[12]||(r[12]=e=>a($).holder.gender=e),label:"性别",name:"gender",columns:a(X),required:""},null,8,["modelValue","columns"]),n(a(te),{modelValue:a($).holder.hasSocialInsurance,"onUpdate:modelValue":r[13]||(r[13]=e=>a($).holder.hasSocialInsurance=e),label:"社保","show-extra":"",name:"hasSocialInsurance",columns:a(se),required:""},null,8,["modelValue","columns"]),n(L,{modelValue:a($).holder.occupationCodeList,"onUpdate:modelValue":r[14]||(r[14]=e=>a($).holder.occupationCodeList=e),label:"职业",name:"occupationCodeList","dict-code":"LIANLIFE_OCCUPATION",required:""},null,8,["modelValue"])],64)):M("",!0)])),_:1},8,["model"])],64)):M("",!0)])),_:1}),n(a(oe),{ref:"productFormRef",title:"保障计划",class:"product-container"},{cardTitleExtra:o((()=>[a(Je)?(s(),k("div",{key:0,class:"replace-product",onClick:Ze},[n(y,{name:"refresh",color:"var(--van-primary-color)"}),zr])):M("",!0)])),default:o((()=>{var e;return[a($).insurerList[a($).currentSelectInsure].productList.length>0?(s(!0),k(C,{key:0},V(a($).insurerList[a($).currentSelectInsure].productList,((e,r)=>(s(),i(f,{key:`${e.nanoid}_${r}_${e.productCode}`,class:"product-item-card","show-line":!1,"show-divider":!1},{default:o((()=>{var t;return[n(br,{"product-risk-list":e.riskList,"product-info":e,"product-num":(null==(t=a($).insurerList[a($).currentSelectInsure].productList)?void 0:t.length)-1,"product-data":a($).productCollection[e.productCode],"error-msg":a($).productErrorMap[e.productCode],"product-index":r,"current-select-insure":a($).currentSelectInsure,onUpdateRisk:fr,onDeleteRisk:vr,onAddRiderRisk:hr},null,8,["product-risk-list","product-info","product-num","product-data","error-msg","product-index","current-select-insure"])]})),_:2},1024)))),128)):(s(),k(C,{key:1},[a(Ne)?(s(),k("div",Qr,[(null==(e=a($).insurerList[a($).currentSelectInsure].productList)?void 0:e.length)<=0?(s(),i(U,{key:0,"empty-img":a(le),title:"该成员还未配置产品，去添加吧！","empty-class":"empty-select"},null,8,["empty-img"])):M("",!0),n(O,{activated:"",round:34,onClick:er},{default:o((()=>[u("+新增主险")])),_:1})])):M("",!0)],64))]})),_:1},512),a(Ne)&&4===a(qe)&&a($).insurerList[a($).currentSelectInsure].productList.length>0?(s(),k("div",Xr,[n(O,{activated:"",round:34,onClick:er},{default:o((()=>[u("+新增主险")])),_:1})])):M("",!0)])):M("",!0),l("div",Gr,[l("span",Jr,[u("首年总保费"),l("span",Zr,g(a(Ae)?"-":`￥${null==(e=a(Fe))?void 0:e.toLocaleString()}`),1)]),l("div",et,[n(S,{disabled:a(Ae)||a($).isLoading,loading:a($).isLoading,"loading-type":"spinner",type:"primary",onClick:gr},{default:o((()=>[u("保存并预览")])),_:1},8,["disabled","loading"])])]),a(c)?(s(),i(Mr,{key:1,show:a(c),holder:a($).holder,"insured-list":[null==(d=a($).insurerList[a($).currentSelectInsure])?void 0:d.personVO],"main-risk":a($).currentMainRisk,"current-risk-data":a($).currentRiskData,"current-product":a($).currentProduct,"select-list":a(kr)[a($).currentProduct.productCode],onCancel:Vr,onConfirm:Cr},null,8,["show","holder","insured-list","main-risk","current-risk-data","current-product","select-list"])):M("",!0),n(P,{show:a(I),"onUpdate:show":r[15]||(r[15]=e=>h(I)?I.value=e:null),actions:t,"cancel-text":"取消","close-on-click-action":"",onCancel:r[16]||(r[16]=e=>a(b)(!1)),onSelect:yr},null,8,["show"]),n(We,{ref_key:"trialPopupRef",ref:H,"data-source":{[a(xe).productCode]:a(xe)},"product-code":a($).currentProductCode,"default-data":a($).defaultData,"insurer-list":a($).insurerList,"update-risk-code":a($).updateRiskCode,onFinish:Ge},null,8,["data-source","product-code","default-data","insurer-list","update-risk-code"])]})),_:1})])),_:1},8,["theme-vars"])}}}),[["__scopeId","data-v-0cc36698"]]);export{tt as default};
