import{d as e,r as t,b as a,c as l,g as n,i as o,j as i,f as r,w as u,n as s,t as d,a2 as c,F as v,b7 as p,a as f,u as m,z as y,e as h,l as I,h as b,T as w}from"./index-737e0195.js";import{u as C}from"./theme-126054aa.js";import{g as j,i as O}from"./trial-e8fe0645.js";import{_ as x,n as L}from"./nextStep-6f3aae24.js";import{s as g}from"./verify-df8b6f9b.js";import{p as k}from"./product-2086da62.js";import{O as _,a as E}from"./order-cab73b13.js";import{u as T}from"./core-eeac9dd8.js";import{P as N}from"./index-1c1c3b1a.js";import{_ as P}from"./index-a93887b0.js";import{a as S}from"./trial-d8699e92.js";import"./pdfdist-c7cc8cdf.js";import"./infoCollection-ad503285.js";import"./relativeTime-d3ceefb6.js";import"./validator-5a13dc82.js";import"./useDicData-1904eb04.js";import"./index-e5f4cc40.js";import"./utils-2b42fabd.js";import"./useStorage-611a8435.js";const V={class:"sign-wrap"},R=["src"],U={class:"popup-body"},B={class:"sign-container-wrap"},D={class:"operate-bar"},F=s(" 请投保人正楷签署您的签名:"),A={class:"btns"},H=s("返回"),$=s("重写"),z=s("确定签字"),q=e({props:{option:{default:{}},modelValue:{default:""}},emits:["update:modelValue"],setup(e,{emit:f}){const m=t(!1),y=t(),h=t(""),I=t(!0),b=()=>{var e;m.value=!0,null==(e=y.value)||e.clear()},w=()=>{p({images:[h.value],className:"customer-sign-preview"})},C=()=>{m.value=!1},j=()=>{var e,t;null==(t=null==(e=y.value)?void 0:e.clear)||t.call(e)},O=()=>{var e;h.value=null==(e=y.value)?void 0:e.save(),f("update:modelValue",h.value),m.value=!1};return(e,t)=>{const p=a("van-button"),f=a("van-icon"),x=a("van-popup");return l(),n(v,null,[o("div",V,[h.value?(l(),n("img",{key:0,class:"preview-sign",src:h.value,alt:"",onClick:w},null,8,R)):i("",!0),r(p,{type:"primary",round:"",size:"small",onClick:b},{default:u((()=>[s(d(h.value?"重新签名":"点击签字"),1)])),_:1})]),r(x,{show:m.value,"onUpdate:show":t[1]||(t[1]=e=>m.value=e),position:"bottom",style:{height:"100%",overflow:"hidden"}},{default:u((()=>[o("div",U,[o("div",B,[r(c,{ref_key:"signRef",ref:y,placeholder:"请在此处签名",onStroke:t[0]||(t[0]=e=>I.value=!1)},null,512),o("div",D,[o("span",null,[r(f,{name:"info",color:"#ffaf22"}),F]),o("div",A,[r(p,{type:"default",class:"btn",onClick:C},{default:u((()=>[H])),_:1}),r(p,{type:"default",class:"btn",onClick:j},{default:u((()=>[$])),_:1}),r(p,{type:"primary",class:"btn",disabled:I.value,onClick:O},{default:u((()=>[z])),_:1},8,["disabled"])])])])])])),_:1},8,["show"])],64)}}});const G={key:0,class:"net-sale-detail-wrap"},W={class:"sign-cell"},M=o("div",{class:"sign-label"},"签名",-1),Y={class:"footer"},Z={class:"footer"},J=e({setup(e){const s=C(),d=f(),c=m(),{orderNo:p="2022113021181894998",tenantId:V="9991000001"}=d.query;t();const R=t({}),U=t(!1),B=t({commencementTime:"",expiryDate:"",extInfo:{buttonCode:"EVENT_NETSALE_airSignature",pageCode:"infoCollection",templateId:3,iseeBizNo:""},orderCategory:1,tenantId:V,venderCode:"",tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},insuredBeneficiaryType:"1",tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}],tenantOrderProductList:[{}]}],tenantOrderSubjectList:[{extInfo:{subjectRelatedFirm:"",subjectRelatedUserId:""},subjectName:"",subjectObjectType:"HOLDER",subjectType:"GENERAL",tenantId:V}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}}),D=t(!1),F=t({}),A=t(),H=t(),$=t(""),z=t(""),J=t(!1),K=t(!1),Q=t(0),X=t([]),ee=t(""),te=t("");t("");const ae=()=>{J.value=!1,K.value=!1},le=async()=>{J.value=!1,K.value=!0,await g("HOLDER",$.value,B.value.id,`${V}`),L(B.value)},ne=async()=>{const{data:e,code:t}=await k({productCode:te.value,tenantId:V,withInsureInfo:!0});"10000"===t&&(H.value=e,(()=>{var e,t,a,l,n,o;let i={};if(i=z.value?(null==(a=((null==(t=null==(e=H.value)?void 0:e.tenantProductInsureVO)?void 0:t.planList)||[]).find((e=>e.planCode===z.value)))?void 0:a.attachmentVOList)||[]:(null==(o=null==(n=null==(l=H.value)?void 0:l.tenantProductInsureVO)?void 0:n.planInsureVO)?void 0:o.attachmentVOList)||[],!i)return void(X.value=[]);const r={2:"richText",3:"link"};X.value=Object.keys(i).map((e=>(i[e].forEach((e=>{if("1"===e.attachmentType){const t=e.attachmentUri.split("?"),a=t[0].substr(t[0].lastIndexOf(".")+1);e.attachmentType="pdf"===a?"pdf":"picture"}else e.attachmentType=r[e.attachmentType]})),{attachmentName:e,attachmentList:i[e]})))||[]})())},oe=async()=>{var e;const{code:t,data:a}=await j({orderNo:p,tenantId:V});"10000"===t&&(a.extInfo.buttonCode="EVENT_NETSALE_airSignature",B.value=a,z.value=null==(e=a.tenantOrderInsuredList[0])?void 0:e.planCode,te.value=a.tenantOrderInsuredList[0].tenantOrderProductList[0].productCode,U.value=!0,(e=>{const t=e.find((e=>1===e.riskType));var a,l;t&&(ee.value=(a=t.insurancePeriodValue,-1!==(l=S[t.insurancePeriodType]).indexOf("$")?l.replace("$",`${a}`):`${a||""}${l}`))})(a.tenantOrderInsuredList[0].tenantOrderProductList[0].tenantOrderRiskList||[]),(async()=>{const{code:e,data:t}=await O({productCode:te.value,tenantId:V});"10000"===e&&(A.value=t,R.value=t.productFactor)})(),ne(),a.orderStatus!==E.UNDER_WRITING_SUCCESS&&c.replace({path:"/baseInsurance/orderDetail",query:{...d.query,productCode:te.value,ISEE_BIZ:a.extInfo.iseeBizNo}}))},ie=async()=>{$.value?(K.value=!1,J.value=!0):w("请先签字")};return T(),y((()=>{oe()})),(e,t)=>{const d=a("ProCell"),c=a("ProCard"),p=a("van-cell"),f=a("ProPageWrap"),m=a("ProFilePreview"),y=a("ProPopup"),w=a("van-config-provider");return l(),h(w,{"theme-vars":I(s)},{default:u((()=>{var e;return[r(f,null,{default:u((()=>{var e;return[(null==(e=A.value)?void 0:e.productBasicInfoVO)?(l(),n("div",G,[r(c,null,{default:u((()=>{var e;return[r(d,{title:"产品名称",content:null==(e=A.value)?void 0:e.productBasicInfoVO.productFullName},null,8,["content"])]})),_:1}),B.value.id?(l(),h(c,{key:0,"show-line":!1,title:"投保信息"},{default:u((()=>{var e,t,a,l,n;return[r(d,{title:"保费",content:B.value.orderAmount+"元"},null,8,["content"]),r(d,{title:"保险期限",content:ee.value},null,8,["content"]),r(d,{title:"起保日期",content:B.value.commencementTime},null,8,["content"]),r(d,{title:"终保日期",content:B.value.expiryDate},null,8,["content"]),r(d,{title:"保单状态",content:I(_)[B.value.orderStatus]},null,8,["content"]),r(d,{title:"订单编号",content:B.value.orderNo},null,8,["content"]),r(d,{title:"房屋地址",content:null==(t=null==(e=B.value.tenantOrderHolder)?void 0:e.extInfo)?void 0:t.familyAddress},null,8,["content"]),r(d,{title:"燃气编号",content:null==(n=null==(l=null==(a=B.value.tenantOrderSubjectList)?void 0:a[0])?void 0:l.extInfo)?void 0:n.subjectRelatedUserId},null,8,["content"])]})),_:1})):i("",!0),U.value?(l(),h(x,{key:1,ref:"formRef","title-collection":{HOLDER:"投保人信息",INSURER:"被保人信息",BENEFICIARY:"受益人"},"is-view":!0,"form-info":B.value,"factor-object":R.value,"input-align":"right"},null,8,["form-info","factor-object"])):i("",!0),r(c,{title:"阅读条款合同",class:"file-list-card"},{default:u((()=>[(l(!0),n(v,null,b(X.value,((e,t)=>(l(),h(p,{key:t,title:e.attachmentName,"is-link":"",onClick:t=>{return a=e.attachmentName,l=e.attachmentList,D.value=!0,void(F.value={title:a,fileContent:null==l?void 0:l[0]});var a,l}},null,8,["title","onClick"])))),128))])),_:1}),r(c,{title:"客户签名"},{default:u((()=>[o("div",W,[M,r(q,{modelValue:$.value,"onUpdate:modelValue":t[0]||(t[0]=e=>$.value=e)},null,8,["modelValue"])])])),_:1}),o("div",Y,[r(N,{shadow:!1,text:"提 交",onClick:ie})])])):i("",!0)]})),_:1}),r(y,{show:D.value,"onUpdate:show":t[2]||(t[2]=e=>D.value=e),class:"pre-notice-wrap",title:null==(e=F.value)?void 0:e.title,position:"bottom",style:{height:"600px"}},{default:u((()=>{var e,a,l,n;return[r(m,{content:null==(a=null==(e=F.value)?void 0:e.fileContent)?void 0:a.attachmentUri,type:null==(n=null==(l=F.value)?void 0:l.fileContent)?void 0:n.attachmentType},null,8,["content","type"]),o("div",Z,[r(N,{shadow:!1,text:"关闭",onClick:t[1]||(t[1]=e=>D.value=!1)})])]})),_:1},8,["show","title"]),J.value&&0!==X.value.length?(l(),h(P,{key:0,show:J.value,"onUpdate:show":t[3]||(t[3]=e=>J.value=e),"content-list":X.value,"is-only-view":K.value,"active-index":Q.value,text:K.value?"关闭":"我已逐页阅读上述内容并同意","force-read-cound":0,"on-close-file-preview":"",onSubmit:le,onOnCloseFilePreview:ae,onOnCloseFilePreviewByMask:t[4]||(t[4]=e=>J.value=!1)},null,8,["show","content-list","is-only-view","active-index","text"])):i("",!0)]})),_:1},8,["theme-vars"])}}});export{J as default};
