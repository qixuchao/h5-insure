import{l as i,a as e,P as a}from"./index-d65f4117.js";import{d as s,z as l,o as t,a1 as r,R as n,c as o,A as d,V as u,U as c,g as p,i as k,w as v,h as m,G as f,aM as I,L as y,r as g,e as h,ag as L,f as V,j as R,E as b,aA as C,aY as O,a2 as S,aa as P,B as x,aZ as T,a_ as D,al as w,am as F,u as _,a as E,$ as j,k as N,au as M,T as q}from"./index-de4790d4.js";import{I as A}from"./index-d5e26c68.js";/* empty css              */import{S as B}from"./index-257adf9c.js";import{P as K}from"./index-0c2b4dff.js";import{S as U,_ as $}from"./box-title-b6e48ab4.js";import{_ as Q}from"./index-fd612b62.js";import{T as W}from"./Table-f307e112.js";import{u as z,b as H,p as G,q as Y,c as Z}from"./trial-4fc0cb09.js";import{u as J}from"./useOrder-4ecb62b9.js";import"./trial-aa6d98c3.js";import"./infoCollection-1e34e0dc.js";import"./core-57a06bb9.js";const X={key:0},ii={key:0,class:"risk2-field"},ei=s({name:"ProductRiskList"});var ai=f(s({...ei,props:{dataSource:{type:Array,default:()=>[]},productInfo:{type:Object,default:()=>({productCode:"",productName:""})},showMainRisk:{type:Boolean,default:()=>!0},defaultValue:{type:Object,default:()=>{}}},emits:["trialChange"],setup(i,{emit:e}){const a=i,s=l({loading:!1,show:!0,select:{},list:[],userData:{},riskIsInsure:{},submitData:{},disabledRiskInfo:[],risksDefaultValue:{}}),f=i=>{const e=[];return i.riskLiabilityInfoVOList.map((i=>(1!=+i.showFlag&&e.push({...i}),[]))),e},y=(i,l,t)=>{var r;s.riskIsInsure[l].data=i;const n=[...s.disabledRiskInfo];null==(r=a.dataSource.insureProductRiskVOList)||r.forEach((i=>{if(1!==i.mainRiskFlag){const e=s.riskIsInsure[i.riskId];e.data&&Object.keys(e.data).length>0&&"1"===e.selected&&n.push(e.data)}})),e("trialChange",n,t)},g=(i,e)=>{var l;null==(l=a.dataSource.productRiskRelationVOList)||l.forEach((a=>{1!==a.collocationType&&(e.riskId===a.riskId?(s.riskIsInsure[e.riskId]&&s.riskIsInsure[e.riskId].selected,2===a.collocationType&&s.riskIsInsure[a.collocationRiskId]&&(s.riskIsInsure[a.collocationRiskId].selected=i),3===a.collocationType&&s.riskIsInsure[a.collocationRiskId]&&"1"===i&&(s.riskIsInsure[a.collocationRiskId].selected="1"===i?"2":"1")):e.riskId===a.collocationRiskId&&(3===a.collocationType&&"1"===i&&s.riskIsInsure[a.riskId]&&(s.riskIsInsure[a.riskId].selected="1"===i?"2":"1"),2===a.collocationType&&s.riskIsInsure[a.riskId]&&(s.riskIsInsure[a.riskId].selected=i)))})),"2"===i?y({},e.riskId):(i=>{var e,a,s,l,t,r,n,o,d,u,c,p;if(1!==(null==i?void 0:i.factorDisPlayFlag)){const k=null==(e=null==i?void 0:i.productRiskInsureLimitVO)?void 0:e.amountPremiumConfigVO,v={riskCategory:i.riskCategory,riskCode:i.riskCode,riskName:i.riskName,riskId:i.riskId,riskType:i.riskType,mainRiskId:i.mainRiskId,mainRiskCode:i.mainRiskCode,liabilityList:f(i)};v.chargePeriod=(null==(s=null==(a=null==i?void 0:i.productRiskInsureLimitVO)?void 0:a.paymentPeriodValueList)?void 0:s.length)>0&&(null==(l=null==i?void 0:i.productRiskInsureLimitVO)?void 0:l.paymentPeriodValueList[0].code)||null,v.coveragePeriod=(null==(r=null==(t=null==i?void 0:i.productRiskInsureLimitVO)?void 0:t.insurancePeriodValueList)?void 0:r.length)>0&&(null==(n=null==i?void 0:i.productRiskInsureLimitVO)?void 0:n.insurancePeriodValueList[0].code)||null,v.paymentFrequency=(null==(d=null==(o=null==i?void 0:i.productRiskInsureLimitVO)?void 0:o.paymentFrequencyList)?void 0:d.length)>0&&(null==(u=null==i?void 0:i.productRiskInsureLimitVO)?void 0:u.paymentFrequencyList[0].code)||null;let m=0;1===k.displayType?m=(null==k?void 0:k.minStepValue)>0?null==k?void 0:k.minStepValue:0:3===k.displayType&&2===k.requireCopies?m=(null==(c=null==k?void 0:k.displayValues)?void 0:c.length)>0?null==k?void 0:k.displayValues[0].value:0:3===k.displayType&&1===k.requireCopies?(m=(null==(p=null==k?void 0:k.displayValues)?void 0:p.length)>0?null==k?void 0:k.displayValues[0].value:0,v.copy=k.minCopiesValue):2===k.displayType?v.copy=k.minCopiesValue:m=0,1===k.saleMethod?v.initialAmount=m:v.initialPremium=m,y(v,i.riskId)}})(e)};return t((()=>{(()=>{var i,e;s.disabledRiskInfo=[];let l=null;if(null==(i=a.dataSource.insureProductRiskVOList)||i.forEach((i=>{var e;const t=1!==i.mainRiskFlag?null==(e=a.dataSource.productRiskRelationVOList)?void 0:e.find((e=>e.collocationRiskId===i.riskId)):{};1===i.mainRiskFlag&&(l=i),s.riskIsInsure[i.riskId]?(s.riskIsInsure[i.riskId].data=null,s.riskIsInsure[i.riskId].relation=t,s.riskIsInsure[i.riskId].isMust=!1):s.riskIsInsure[i.riskId]={selected:"2",data:null,relation:t,isMust:!1}})),l){const i=null==(e=a.dataSource.productRiskRelationVOList)?void 0:e.filter((i=>i.riskId===l.riskId));if(!i)return;null==i||i.forEach((i=>{var e,l,t,r,n,o,d,u,c,p,k,v,m,I,g;if(2===i.collocationType){s.riskIsInsure[i.collocationRiskId].selected="1",s.riskIsInsure[i.collocationRiskId].isMust=!0;const h=null==(e=a.dataSource.insureProductRiskVOList)?void 0:e.find((e=>i.collocationRiskId===e.riskId));if(h&&1!==h.factorDisPlayFlag&&(null==(l=null==h?void 0:h.productRiskInsureLimitVO)?void 0:l.amountPremiumConfigVO)){const e=null==(t=h.riskLiabilityInfoVOList)?void 0:t.every((i=>1!==i.showFlag)),a=null==(r=null==h?void 0:h.productRiskInsureLimitVO)?void 0:r.amountPremiumConfigVO;if(e){s.riskIsInsure[i.collocationRiskId].isDisabled=!0;const e={riskCategory:h.riskCategory,riskCode:h.riskCode,riskName:h.riskName,riskId:h.riskId,riskType:h.riskType,mainRiskId:h.mainRiskId,mainRiskCode:h.mainRiskCode,liabilityList:f(h)};e.chargePeriod=(null==(o=null==(n=null==h?void 0:h.productRiskInsureLimitVO)?void 0:n.paymentPeriodValueList)?void 0:o.length)>0&&(null==(d=null==h?void 0:h.productRiskInsureLimitVO)?void 0:d.paymentPeriodValueList[0].code)||null,e.coveragePeriod=(null==(c=null==(u=null==h?void 0:h.productRiskInsureLimitVO)?void 0:u.insurancePeriodValueList)?void 0:c.length)>0&&(null==(p=null==h?void 0:h.productRiskInsureLimitVO)?void 0:p.insurancePeriodValueList[0].code)||null,e.paymentFrequency=(null==(v=null==(k=null==h?void 0:h.productRiskInsureLimitVO)?void 0:k.paymentFrequencyList)?void 0:v.length)>0&&(null==(m=null==h?void 0:h.productRiskInsureLimitVO)?void 0:m.paymentFrequencyList[0].code)||null;let l=0;1===a.displayType?l=(null==a?void 0:a.minStepValue)>0?null==a?void 0:a.minStepValue:0:3===a.displayType&&2===a.requireCopies?l=(null==(I=null==a?void 0:a.displayValues)?void 0:I.length)>0?null==a?void 0:a.displayValues[0].value:0:3===a.displayType&&1===a.requireCopies?(l=(null==(g=null==a?void 0:a.displayValues)?void 0:g.length)>0?null==a?void 0:a.displayValues[0].value:0,e.copy=a.minCopiesValue):2===a.displayType&&(e.copy=a.minCopiesValue),1===a.saleMethod?e.initialAmount=l:e.initialPremium=l,s.disabledRiskInfo.push(e),y(e,h.riskId)}}}3===i.collocationType&&(s.riskIsInsure[i.collocationRiskId].selected="2",s.riskIsInsure[i.collocationRiskId].isMust=!0)}))}})()})),r((()=>{s.loading=!0})),n((()=>s.riskIsInsure),(i=>{}),{deep:!0,immediate:!0}),n((()=>a.defaultValue),(i=>{(null==i?void 0:i.length)>0&&i.forEach((i=>{s.risksDefaultValue[i.riskCode]=i,s.riskIsInsure[i.riskId]?(s.riskIsInsure[i.riskId].selected="1",y(i,i.riskId)):s.riskIsInsure[i.riskId]={selected:"1",isMust:!1}}))}),{deep:!0,immediate:!0}),(e,a)=>{const l=B,t=I;return o(!0),d(c,null,u(i.dataSource.insureProductRiskVOList,(e=>{var a,r;return o(),d(c,{key:e.riskCode},[(!i.showMainRisk&&1!==e.mainRiskFlag||i.showMainRisk)&&(null==(r=null==(a=p(s).riskIsInsure)?void 0:a[e.riskId])?void 0:r.relation)?(o(),d("div",X,[k(t,{modelValue:p(s).riskIsInsure[e.riskId].selected,"onUpdate:modelValue":i=>p(s).riskIsInsure[e.riskId].selected=i,label:e.riskName,name:"selected","label-width":"50%",border:!1,class:"risk-select-field risk-name"},{input:v((()=>[k(l,{modelValue:p(s).riskIsInsure[e.riskId].selected,"onUpdate:modelValue":i=>p(s).riskIsInsure[e.riskId].selected=i,"active-value":"1","inactive-value":"2",size:"26px",disabled:p(s).riskIsInsure[e.riskId].isMust,style:{"margin-right":"8px"},onChange:i=>g(i,e)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])])),_:2},1032,["modelValue","onUpdate:modelValue","label"]),"1"===p(s).riskIsInsure[e.riskId].selected?(o(),d("div",ii,[k(A,{modelValue:p(s).riskIsInsure[e.riskId].data,"onUpdate:modelValue":i=>p(s).riskIsInsure[e.riskId].data=i,"origin-data":e,"product-factor":i.dataSource.productFactor,"default-value":p(s).risksDefaultValue[e.riskCode],onTrialChange:(i,a)=>y(i,e.riskId,a)},null,8,["modelValue","onUpdate:modelValue","origin-data","product-factor","default-value","onTrialChange"])])):m("",!0)])):m("",!0)],64)})),128)}}}),[["__scopeId","data-v-52c11dde"]]);const si={class:"benefit-table"},li=s({name:"benefitTable"}),ti=s({...li,props:{dataSource:null},setup(i){const e=i,a=y((()=>{const i=e.dataSource.headers.length,a=12*e.dataSource.headers.join("").length+20*e.dataSource.headers.length;return e.dataSource.headers.map(((e,s)=>{const l=a>320?12*e.length+20:Math.max(12*e.length+20,320/i);return console.log("totalWordWidth:",a,"titleWidth:",l,"word-width:",12*e.length+20),{title:e,key:`header_${s}`,fixed:s<2,minWidth:l}}))})),s=y((()=>e.dataSource.dataList.map((i=>{const e={};return i.forEach(((i,a)=>{e[`header_${a}`]=i})),e}))));return r((()=>{})),(i,e)=>(o(),d("div",si,[k(W,{"top-height":400,columns:p(a),data:p(s),"is-clone":!0},null,8,["columns","data"])]))}});const ri=i=>(w("data-v-d9a31ad8"),i=i(),F(),i),ni={key:0,class:"benefit-container"},oi={key:0,class:"benefit"},di=ri((()=>V("div",{class:"line"},null,-1))),ui={class:"box-title box-title-chart"},ci=ri((()=>V("img",{class:"tl",src:$,alt:""},null,-1))),pi=ri((()=>V("img",{class:"transform-z180 tr",src:$,alt:""},null,-1))),ki={key:0},vi={class:"box"},mi={class:"box-title"},fi=ri((()=>V("img",{class:"tl",src:$,alt:""},null,-1))),Ii=ri((()=>V("img",{class:"transform-z180 tr",src:$,alt:""},null,-1))),yi={class:"box-price"},gi={class:"text1"},hi={class:"text2"},Li={key:1},Vi={key:2,style:{width:"100%, minWidth: 338px"}},Ri={class:"slider"},bi={style:{flex:"1",margin:"0px 5px"}},Ci={class:"custom-button"},Oi=ri((()=>V("p",{class:"slider-dec"},"拖动按钮查看不同年龄保障",-1))),Si={class:"btn-two"},Pi={key:1,class:"benefit-container"},xi={key:0},Ti={class:"benefit"},Di=ri((()=>V("div",{class:"line"},null,-1))),wi=ri((()=>V("div",null,[V("div",{class:"box"},[V("p",{class:"box-title"},[V("img",{class:"tl",src:$,alt:""}),R(" 保单年度"),V("span",null,"-"),R("年度，被保人"),V("span",null,"-"),R("岁时 "),V("img",{class:"transform-z180 tr",src:$,alt:""})]),V("div",{class:"box-price"})])],-1))),Fi={class:"slider"},_i={class:"opt lf"},Ei={style:{flex:"1",margin:"0px 5px"}},ji=ri((()=>V("div",{class:"custom-button"},"0 岁",-1))),Ni={class:"opt rg"},Mi=ri((()=>V("p",{class:"slider-dec"},"拖动按钮查看不同年龄保障",-1))),qi={class:"btn-two"},Ai={key:1,class:"empty-box"},Bi=s({name:"Benefit"});var Ki=f(s({...Bi,props:{dataSource:{default:()=>({showTypeList:["1"]})},productInfo:{default:()=>null}},setup(i){var e;const a=i,s="1",l="2",t="3",r=g(0),f=g(0),I=g(0),y=g(),w=g(0),F=g(null==(e=a.dataSource.showTypeList)?void 0:e[0]),_=g(),E=i=>{if(!(null==i?void 0:i.benefitRiskResultVOList))return;const e=null==i?void 0:i.benefitRiskResultVOList[r.value];f.value=e.ageBegin+1,w.value=e.ageBegin+1,I.value=e.ageEnd},j=()=>{var i,e,s,l,t,n;const o=null==(e=null==(i=a.dataSource)?void 0:i.benefitRiskResultVOList)?void 0:e[r.value];_.value=null==(t=null==(l=null==(s=a.dataSource)?void 0:s.benefitRiskResultVOList)?void 0:l[r.value].benefitRiskTableResultVOList)?void 0:t[0];const{a:d,year:u}=((i,e)=>{const a=[],s=[];for(let l=i,t=0;l<=e;l++,t++)a.push(l.toString()),s.push(t+1);return{a:a,year:s}})(f.value,I.value),c={index:d.indexOf(w.value.toString()),age:d,year:u,result:null==(n=null==o?void 0:o.benefitRiskItemResultVOList)?void 0:n[0]};y.value=c},N=()=>{w.value>I.value-1||(w.value+=1,j())},M=()=>{w.value>f.value&&(w.value-=1,j())},q=i=>{r.value=i.name,E(a.dataSource),j()};return n((()=>a.dataSource),(i=>{var e;i&&(E(i),j(),F.value=null==(e=i.showTypeList)?void 0:e[0])}),{deep:!0,immediate:!0}),n(w,(()=>{j()})),(e,n)=>{var g;const E=P,j=U,A=x,B=T,$=D,W=K;return(null==(g=i.dataSource)?void 0:g.benefitRiskResultVOList)?(o(),d("div",ni,[k($,{active:p(r),onClickTab:q},{default:v((()=>{var i;return[(o(!0),d(c,null,u(null==(i=a.dataSource)?void 0:i.benefitRiskResultVOList,((i,e)=>(o(),h(B,{key:e,name:e,title:i.riskName},{default:v((()=>{var i,g,P,x,T,D,q,B,K,U,$,W,z,H,G,Y;return[e==p(r)?(o(),d("div",oi,[di,L(V("p",ui,[ci,R(" 保单年度"),V("span",null,b(null==(P=null==(i=p(y))?void 0:i.year)?void 0:P[null==(g=p(y))?void 0:g.index]),1),R("年度，被保人"),V("span",null,b(null==(D=null==(x=p(y))?void 0:x.age)?void 0:D[null==(T=p(y))?void 0:T.index]),1),R("岁时 "),pi],512),[[C,p(F)===l]]),p(F)===s?(o(),d("div",ki,[V("div",vi,[V("p",mi,[fi,R(" 保单年度"),V("span",null,b(null==(K=null==(q=p(y))?void 0:q.year)?void 0:K[null==(B=p(y))?void 0:B.index]),1),R("年度，被保人"),V("span",null,b(null==(W=null==(U=p(y))?void 0:U.age)?void 0:W[null==($=p(y))?void 0:$.index]),1),R("岁时 "),Ii]),V("div",yi,[(o(!0),d(c,null,u(null==(H=null==(z=p(y))?void 0:z.result)?void 0:H.headers,((i,e)=>{var a,s,l,t,r,n,u,c,k,v;return o(),d("div",{key:e,style:{width:"33%"}},[V("p",gi,b(("0"==(null==(r=null==(t=null==(s=null==(a=p(y))?void 0:a.result)?void 0:s.dataList)?void 0:t[null==(l=p(y))?void 0:l.index])?void 0:r[e])?"0":p(O)(Number(null==(v=null==(k=null==(u=null==(n=p(y))?void 0:n.result)?void 0:u.dataList)?void 0:k[null==(c=p(y))?void 0:c.index])?void 0:v[e])))||"0"),1),V("p",hi,b(i)+"(元）",1)])})),128))])])])):m("",!0),p(F)===t?(o(),d("div",Li,[k(ti,{"data-source":p(_)},null,8,["data-source"])])):m("",!0),p(F)==l?(o(),d("div",Vi,[k(Q,{min:p(f),max:p(I),current:p(w),data:null==(Y=null==(G=p(y))?void 0:G.result)?void 0:Y.benefitRiskItemList},null,8,["min","max","current","data"])])):m("",!0),p(F)!=t?(o(),d(c,{key:3},[V("div",Ri,[V("div",{class:"opt lf",onClick:M},[k(E,{name:"minus"})]),V("div",bi,[p(f)?(o(),h(j,{key:0,modelValue:p(w),"onUpdate:modelValue":n[0]||(n[0]=i=>S(w)?w.value=i:null),min:p(f),max:p(I),"bar-height":"8px"},{button:v((()=>[V("div",Ci,b(p(w))+" 岁",1)])),_:1},8,["modelValue","min","max"])):m("",!0)]),V("div",{class:"opt rg",onClick:N},[k(E,{name:"plus"})])]),Oi],64)):m("",!0),V("div",Si,[a.dataSource.showTypeList.includes(s)?(o(),h(A,{key:0,round:"",plain:p(F)!==s,type:"primary",class:"btn",onClick:n[1]||(n[1]=i=>F.value=s)},{default:v((()=>[R("图表展示")])),_:1},8,["plain"])):m("",!0),a.dataSource.showTypeList.includes(l)?(o(),h(A,{key:1,round:"",plain:p(F)!==l,type:"primary",class:"btn",onClick:n[2]||(n[2]=i=>F.value=l)},{default:v((()=>[R("趋势展示")])),_:1},8,["plain"])):m("",!0),a.dataSource.showTypeList.includes(t)?(o(),h(A,{key:2,round:"",plain:p(F)!==t,type:"primary",class:"btn",onClick:n[3]||(n[3]=i=>F.value=t)},{default:v((()=>[R("表格展示")])),_:1},8,["plain"])):m("",!0)])])):m("",!0)]})),_:2},1032,["name","title"])))),128))]})),_:1},8,["active"])])):(o(),d("div",Pi,[a.productInfo?(o(),d("div",xi,[k($,{active:p(r),onClickTab:q},{default:v((()=>[(o(),h(B,{key:1,name:1,title:i.productInfo.insureProductRiskVOList[0].riskName},{default:v((()=>[V("div",Ti,[Di,wi,V("div",Fi,[V("div",_i,[k(E,{name:"minus"})]),V("div",Ei,[k(j,{modelValue:p(w),"onUpdate:modelValue":n[4]||(n[4]=i=>S(w)?w.value=i:null),min:0,max:80,"bar-height":"8px",disabled:""},{button:v((()=>[ji])),_:1},8,["modelValue"])]),V("div",Ni,[k(E,{name:"plus"})])]),Mi,V("div",qi,[k(A,{round:"",plain:!0,type:"primary",class:"btn",disabled:""},{default:v((()=>[R("图表展示")])),_:1}),k(A,{round:"",plain:!1,type:"primary",class:"btn",disabled:""},{default:v((()=>[R("趋势展示")])),_:1}),k(A,{round:"",plain:!1,type:"primary",class:"btn",disabled:""},{default:v((()=>[R("表格展示")])),_:1})])])])),_:1},8,["title"]))])),_:1},8,["active"])])):(o(),d("div",Ai,[k(W,{title:"试算结果正在计算中...","empty-class":"empty-select"})]))]))}}}),[["__scopeId","data-v-d9a31ad8"]]);const Ui={key:0,class:"head-warning-wrap"},$i=V("div",{class:"warning-icon"},[V("span",null,"!")],-1),Qi={class:"warning-text"},Wi=s({name:"HeadWaring"}),zi=s({...Wi,props:{labels:{default:()=>[]}},setup:i=>(e,a)=>i.labels.length>0?(o(),d("div",Ui,[$i,V("div",Qi,[(o(!0),d(c,null,u(i.labels,(i=>(o(),d("span",{key:i},b(i),1)))),128))])])):m("",!0)}),Hi=(e,a,s)=>{const l=e,{holder:t}=s,r=s.insuredList[0],n=(a||"").split("_");if(n.length<2)return a;if(i.exports.isNaN(Number(n[1])))return a;if(n[1]-=1,1===l.exemptFlag){if("to"===n[0]){let i=0;1===l.exemptType?(null==t?void 0:t.birthday)&&(i=parseInt(""+((new Date).getTime()-new Date(t.birthday).getTime())/31536e6,10)):2===l.exemptType&&(null==r?void 0:r.birthday)&&(i=parseInt(""+(+(new Date).getTime()-new Date(r.birthday).getTime())/31536e6,10)),n[1]=+n[1]-i}n[0]="year"}return n.join("_")},Gi=(i,e)=>{const a=[],s={};return null==i||i.forEach((i=>{s[i.riskId]=i})),null==e||e.forEach((i=>{var e,l,t,r;const{collocationType:n,collocationRiskId:o,riskId:d}=i;switch(n){case 2:{const i=null==(e=s[d])?void 0:e.riskName,t=null==(l=s[o])?void 0:l.riskName;a.push(`${i} 和 ${t} 必须同时投保`);break}case 3:{const i=null==(t=s[d])?void 0:t.riskName,e=null==(r=s[o])?void 0:r.riskName;a.push(`${i} 和 ${e} 不能同时投保`);break}}})),a};const Yi={class:"com-body"},Zi={class:"trial-body"},Ji={class:"container"},Xi=(i=>(w("data-v-38288da5"),i=i(),F(),i))((()=>V("div",{class:"empty"},null,-1))),ie=s({name:"TrialBody"});var ee=f(s({...ie,props:{dataSource:{default:()=>[]},productInfo:{default:()=>({productCode:"",productName:"",insurerCode:"",tenantId:""})},tenantProductDetail:{default:()=>({})},hideBenefit:{type:Boolean,default:!1},hidePopupButton:{type:Boolean,default:!1},title:{default:"算一算保费"},defaultData:{default:null},isTrial:{type:Boolean,default:!1}},emits:["trialStart","trialEnd"],setup(s,{expose:u,emit:c}){const v=s,f=g(null),I=_();E(),I.query;const y=g(),L=l({loading:!1,show:!1,select:{},list:[],userData:{},riskIsInsure:{},submitData:{},riskList:[{}],mainRiskVO:{},ifPersonalInfoSuccess:!1,trialMsg:"",trialResultPremium:0,trialResult:{initialPremium:0,initialAmount:0},isAniShow:!1,defaultValue:null,isAutoChange:!1,planIndex:0,isSkipFirstTrial:!1,hadSkipFirstTrial:!1,isQuerying:!1});J(),g(),g();const R=i=>{const{holder:e,insuredList:a}=i||{};e&&(L.submitData.holder=e),a&&a.length>0&&a.forEach(((i,e)=>{var a;L.submitData.insuredList&&L.submitData.insuredList.length>e?L.submitData.insuredList[e]=i:((null==(a=L.submitData)?void 0:a.insuredList)||(L.submitData.insuredList=[]),L.submitData.insuredList.push(i))}))},b=g(),C=g({}),O=["annuityDrawDate","coveragePeriod","chargePeriod"],S=i=>{var e,s,l,t,r,n;if(null==(s=null==(e=null==i?void 0:i.data)?void 0:e[0])?void 0:s.productRiskDyInsureFactorVOList){const e=[];if(null==(l=v.dataSource)||l.insureProductRiskVOList.forEach((s=>{var l,t;const r=null==(t=null==(l=null==i?void 0:i.data)?void 0:l[0])?void 0:t.productRiskDyInsureFactorVOList.find((i=>i.riskCode===s.riskCode));if(r){s.productRiskInsureLimitVO={...s.productRiskInsureLimitVO,...r};const i=L.riskList.find((i=>i.riskCode===s.riskCode));let l=!1;a.forEach((e=>{if(O.indexOf(e.valueKey)>=0){const a=s.productRiskInsureLimitVO[e.configKey];if(a&&i){const s=a.find((a=>a.code===i[e.valueKey]));if(s&&2===s.useFlag){const s=a.find((i=>1===i.defaultFlag));i[e.valueKey]=s.code,l=!0}}}})),l&&e.push({...i,...r,riskCode:s.riskCode})}})),e.length>0&&(null==(n=null==(r=null==(t=L.defaultValue)?void 0:t.insuredList)?void 0:r[0])?void 0:n.productList))return e.forEach((i=>{var e,a,s;L.defaultValue.insuredList[0].productList=null==(s=null==(a=null==(e=L.defaultValue)?void 0:e.insuredList)?void 0:a[0])?void 0:s.productList.map((e=>(e.riskList=null==e?void 0:e.riskList.map((e=>(e.riskCode===i.riskCode&&(e=i),e))),e)))})),!1}return!0},P=async(i,e=!0)=>{L.trialMsg="试算中...",L.trialResultPremium=0,L.loading=!0,c("trialStart");let a=!1;if(e){const{code:e}=await z(i);a="10000"===e}!a&&e||(L.isQuerying=!0,v.hideBenefit||H(i).then((i=>{i.data&&i.code===M&&(C.value=i.data)})).finally((()=>{L.loading=!1})),G(i).then((i=>{var e,a;if(i.data&&i.code===M){(null==(e=null==i?void 0:i.data)?void 0:e.errorInfo)&&q(`${null==(a=null==i?void 0:i.data)?void 0:a.errorInfo}`),L.trialMsg="",L.trialResultPremium=i.data.initialPremium,L.trialResult=i.data;const s={};i.data.riskPremiumDetailVOList&&i.data.riskPremiumDetailVOList.length&&i.data.riskPremiumDetailVOList.forEach((i=>{s[i.riskCode]={initialAmount:i.initialAmount,initialPremium:i.initialPremium}})),b.value=s,c("trialEnd",i.data)}})).finally((()=>{L.loading=!1,L.isQuerying=!1})))},x=i.exports.debounce((async()=>{if(console.log(">>>>>调用试算<<<<<",L.ifPersonalInfoSuccess),L.ifPersonalInfoSuccess||y.value.canTrail()){if(L.submitData.productCode=v.productInfo.productCode,L.submitData.productName=v.productInfo.productName,L.submitData.tenantId=v.productInfo.tenantId,L.riskList=L.riskList.map((i=>(i=>{var e,s,l,t;const r=null==(e=v.dataSource.insureProductRiskVOList)?void 0:e.find((e=>i.riskId===e.riskId));if(r&&1!==r.mainRiskFlag){const e=null==(l=null==(s=v.dataSource)?void 0:s.productRiskRelationVOList)?void 0:l.filter((i=>i.collocationRiskId===r.riskId&&3!==i.collocationType)),n=e.length>0?e[0]:null;if(n){const e=null==(t=L.riskList)?void 0:t.find((i=>i.riskId===n.riskId));a.forEach((a=>{a.ruleKey&&r.productRiskInsureLimitVO&&e&&(1===r.productRiskInsureLimitVO[a.ruleKey]&&(i[a.valueKey]=e[a.valueKey]),3===r.productRiskInsureLimitVO[a.ruleKey]&&(1!==r.exemptFlag?i[a.valueKey]=Hi(r,e[a.valueKey],L.submitData):i[a.valueKey]=Hi(r,e[a.ruleValueKey],L.submitData)))}))}}return i})(i))),L.submitData.insuredList&&L.submitData.insuredList.forEach((i=>{i.productList=[{insurerCode:v.productInfo.insurerCode,planCode:v.dataSource.planCode,riskList:L.riskList}]})),L.isSkipFirstTrial&&!L.hadSkipFirstTrial)return void(L.hadSkipFirstTrial=!0);console.log(">>>数据构建<<<",i.exports.cloneDeep(L.submitData));const e=i.exports.cloneDeep(L.submitData);await P(e)}}),300),T=async i=>{var e;const{insuredList:a,isFirstInsuredChange:s}=i;if(R(i),L.ifPersonalInfoSuccess=!0,s){console.log("处理第一被保人修改的dy变化"),L.isQuerying=!0;const i=await Y({calcProductFactorList:[{planCode:v.dataSource.planCode,productCode:v.productInfo.productCode,riskEditVOList:[{insureProductRiskVO:null==(e=v.dataSource.insureProductRiskVOList)?void 0:e[0]}]}],...a[0]});if(L.isQuerying=!1,!S(i))return}console.log("投被保人的信息回传 ",i),x()},D=async(e,a)=>{var s,l,t,r;if(a){const n=i.exports.cloneDeep(e);delete n.insurancePeriodValueList,delete n.paymentFrequencyList,delete n.paymentPeriodValueList;if(O.indexOf(a.key)>=0){const i={};switch(a.key){case"annuityDrawDate":i.changeType=3;break;case"coveragePeriod":i.changeType=2;break;case"chargePeriod":i.changeType=1}const o=null==(l=null==(s=L.submitData)?void 0:s.insuredList)?void 0:l[0],d=null==(r=null==(t=v.dataSource)?void 0:t.insureProductRiskVOList)?void 0:r.find((i=>i.riskCode===e.riskCode));if(!L.isAutoChange){L.isQuerying=!0;const a=await Y({calcProductFactorList:[{planCode:v.dataSource.planCode,productCode:v.productInfo.productCode,riskEditVOList:[{insureProductRiskVO:d,insureRiskEditReqVO:{riskId:e.riskId,riskCode:e.riskCode,...n,...i}}]}],...o});L.isQuerying=!1;const s=S(a);return s||(L.isAutoChange=!0),s}L.isAutoChange=!1}}return!0},w=async(i,e)=>{L.mainRiskVO=i;await D(i,e)&&(L.riskList.length>0&&(L.riskList[0]=i),console.log("标准险种的信息回传",i),x())},F=async(i,e)=>{if(L.riskList=[L.mainRiskVO,...i],console.log("附加险列表数据回传",i),e){const a=i.find((i=>i.riskCode===e.riskCode));if(!(await D(a,e)))return}x()},B=i=>{var e,a,s,l;L.userData=i,L.defaultValue=i;const t=(null==(e=i.insuredList)?void 0:e[0].productList.findIndex((i=>i.planCode===v.dataSource.planCode)))||0;L.planIndex=-1===t?0:t,L.riskList=(null==(l=null==(s=null==(a=null==i?void 0:i.insuredList)?void 0:a[0].productList)?void 0:s[L.planIndex])?void 0:l.riskList)||[],P(i,!0)};t((()=>{var i,e;L.select={},L.list=[],L.userData={},L.riskIsInsure={},L.submitData={},L.riskList=[{}],L.mainRiskVO={},L.ifPersonalInfoSuccess=!1,L.trialMsg="",L.trialResultPremium=0,L.riskIsInsure={},null==(e=null==(i=null==v?void 0:v.dataSource)?void 0:i.insureProductRiskVOList)||e.forEach((i=>{var e;const a=null==(e=v.dataSource.productRiskRelationVOList)?void 0:e.find((e=>e.collocationRiskId===i.riskId));a&&(L.riskIsInsure[i.riskCode]={selected:"2",data:null,relation:a})}))})),r((()=>{L.loading=!0,L.show=!0,L.isAniShow=!0,L.isSkipFirstTrial=!0,L.hadSkipFirstTrial=!1,j((()=>{(async i=>{var e;if(console.log("props.defaultData",v.defaultData),v.defaultData){const i=v.defaultData.find((i=>i.productCode===v.productInfo.productCode))||v.defaultData[0];B(i),R(null==(e=v.defaultData)?void 0:e[0])}else{const i=await Z({calcProductFactorList:[{planCode:v.dataSource.planCode,productCode:v.productInfo.productCode}]});if(i.data){const e=i.data.find((i=>i.productCode===v.productInfo.productCode))||i.data[0];console.log("targetProduct",e),B(e)}}})()}))}));return u({getTrialSuccessFlag:()=>L.trialResultPremium>0,validate:()=>y.value.validate(!1),validateTrialFields:()=>y.value.validateTrialFields(),validateHolder:i=>{var e;return null==(e=y.value)?void 0:e.validateHolder(i)},getUserData:()=>({...L.userData})}),n((()=>L.riskIsInsure),(i=>{}),{deep:!0,immediate:!0}),(i,a)=>{var l,t,r,n,u,c,v;return o(),d("div",Yi,[N(i.$slots,"trialHead",{},void 0,!0),V("div",Zi,[k(zi,{labels:p(Gi)((null==(l=s.dataSource)?void 0:l.insureProductRiskVOList)||[],s.dataSource.productRiskRelationVOList)},null,8,["labels"]),V("div",Ji,[s.hideBenefit?m("",!0):(o(),h(Ki,{key:0,class:"benefit-wrap","data-source":C.value,"product-info":s.dataSource,"show-type-list":C.value.showTypList},null,8,["data-source","product-info","show-type-list"])),s.dataSource.productFactor?(o(),h(p(e),{key:1,ref_key:"personalInfoRef",ref:y,modelValue:p(L).userData,"onUpdate:modelValue":a[0]||(a[0]=i=>p(L).userData=i),"is-trial":s.isTrial,"product-factor":s.dataSource.productFactor,"multi-insured-config":null==(t=s.dataSource)?void 0:t.multiInsuredConfigVO,onTrailChange:T},null,8,["modelValue","is-trial","product-factor","multi-insured-config"])):m("",!0),k(A,{ref_key:"insureInfosRef",ref:f,"origin-data":null==(r=s.dataSource.insureProductRiskVOList)?void 0:r[0],"product-factor":s.dataSource.productFactor,"default-value":p(L).defaultValue?null==(u=null==(n=p(L).defaultValue)?void 0:n.insuredList[0].productList[p(L).planIndex])?void 0:u.riskList[0]:null,"trial-result":p(L).trialResult,onTrialChange:w},null,8,["origin-data","product-factor","default-value","trial-result"]),s.dataSource.insureProductRiskVOList?(o(),h(ai,{key:2,"data-source":s.dataSource,"show-main-risk":!1,"default-value":p(L).defaultValue?null==(v=null==(c=p(L).defaultValue)?void 0:c.insuredList[0].productList[p(L).planIndex])?void 0:v.riskList:[],onTrialChange:F},null,8,["data-source","default-value"])):m("",!0),Xi])]),N(i.$slots,"trialBtn",{trialData:p(L).submitData,riskPremium:p(L).trialResult,loading:p(L).isQuerying},void 0,!0)])}}}),[["__scopeId","data-v-38288da5"]]);export{ee as T};
