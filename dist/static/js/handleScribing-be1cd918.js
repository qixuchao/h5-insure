import{d as e,i as a,j as l,o as s,c as t,a as n,F as i,n as c,e as r,p as u,b as o,w as d,u as p,l as v,a0 as g,a8 as m,T as f,cf as b,c5 as h,cg as x,ch as y,an as k,g as w,h as _}from"./index-232d6b3e.js";import{S as C}from"./index-91d499bc.js";import{s as S}from"./scribing-1e277da4.js";const A={class:"com-handle-scribing"},V={class:"sign-container-wrap"},j={class:"scribing-text"},N={class:"sign-wrap"},T={class:"sign-preview"},q={class:"scribing-text"},E={class:"sign-result"},P=["onClick"],I=["src"],O={class:"sign-list"},R={class:"operate-bar"},U={class:"btns"},$=e({name:"handleScribing"}),F=e({...$,props:{text:{default:""},modelValue:{default:()=>[]},signAccount:{default:1}},emits:["onSubmit","onCancel"],setup(e,{emit:w}){const _=e,S=a(0),$=a(),F=l((()=>{if(_.text&&_.text.length>=_.signAccount){const e=[];let a=0;for(let l=0;l<=_.text.length;l++)!l||l%_.signAccount||(a+=1),_.text[l]&&(e[a]?e[a]+=_.text[l]:e[a]=_.text[l]);return e}return[""]})),L=a([]);a("");const z=()=>{if(S.value===F.value.length-1)return;S.value,_.signAccount;F.value[S.value].length;let e="";F.value.forEach(((a,l)=>{l===S.value&&a.split("").forEach(((a,s)=>{L.value[l+s+l]||(e="请抄录当前页面文字")}))})),e?f({message:e,className:"toast-vertical"}):$.value&&(S.value+=1,$.value.swipeTo(S.value))},B=()=>{0!==S.value&&$.value&&(S.value-=1,$.value.swipeTo(S.value))},D=()=>{w("onCancel")},G=()=>{var e;if((null==(e=L.value)?void 0:e.length)!==_.text.length)return void f({message:"请完成抄录",className:"toast-vertical"});const a=[];L.value.forEach((async(e,l)=>{a.push(b(e,270))})),Promise.all(a).then((e=>{const a=e.map(((e,a)=>({position:a+1,content:_.text[a],image:e})));w("onSubmit",a)}))};return(e,a)=>{const l=C,f=h,b=x,w=y,_=k;return s(),t("div",A,[n("div",V,[n("p",j,[(s(),t(i,null,c("请投保人王小于抄录并确保内容清晰完整",((e,a)=>n("span",{key:a,class:"text-item"},r(e),1))),64))]),n("div",N,[n("div",T,[n("p",q,[(s(!0),t(i,null,c(e.text,((a,l)=>(s(),t("span",{key:l,class:u(`text-item ${S.value*e.signAccount>l?"activity":""} `)},r(a),3)))),128))]),n("div",E,[o(l,{wrap:""},{default:d((()=>[(s(!0),t(i,null,c(L.value,((a,l)=>(s(),t("div",{key:l,class:"scribing-item",onClick:l=>e.updateSign(a)},[n("img",{src:a,alt:""},null,8,I)],8,P)))),128))])),_:1})])]),o(w,{ref_key:"swipeRef",ref:$,loop:!1,"initial-swipe":0,"show-indicators":!1,vertical:"",touchable:!1},{default:d((()=>[(s(!0),t(i,null,c(p(F),((a,l)=>(s(),v(b,{key:l},{default:d((()=>[n("div",O,[(s(!0),t(i,null,c(a,((a,n)=>(s(),t("div",{key:n+l+l,class:"sign-item"},[(s(),v(f,g({ref_for:!0,ref:"signRef",key:l+l+n,modelValue:L.value[l+l+n],"onUpdate:modelValue":e=>L.value[l+l+n]=e,placeholder:a},e.$attrs),null,16,["modelValue","onUpdate:modelValue","placeholder"]))])))),128))])])),_:2},1024)))),128))])),_:1},512)]),n("div",R,[n("div",U,[o(l,null,{default:d((()=>[o(_,{plain:"",hairline:"",type:"primary",disabled:0===S.value,class:"btn",onClick:B},{default:d((()=>[m("上一页")])),_:1},8,["disabled"]),o(_,{plain:"",hairline:"",type:"primary",disabled:S.value===p(F).length-1,class:"btn",onClick:z},{default:d((()=>[m("下一页")])),_:1},8,["disabled"]),o(_,{plain:"",hairline:"",type:"primary",class:"btn",onClick:D},{default:d((()=>[m("取消")])),_:1}),o(_,{type:"primary",class:"btn",onClick:G},{default:d((()=>[m("保存")])),_:1})])),_:1})])])])])}}}),L={class:"handle-scribing-wrap"},z=e({name:"handleScribingPage"}),B=e({...z,setup(e){const a=w(),l=_(),{orderNo:n,text:i,tenantId:c}=l.query,r=()=>{a.back()},u=e=>{S({orderNo:n,tenantId:c,riskTranscriptionList:e}).then((({code:e,data:s})=>{"10000"===e&&a.replace({path:"scribingPreview",query:l.query})}))};return(e,a)=>(s(),t("div",L,[o(F,{text:p(i),closeable:"","has-bg":"",onOnCancel:r,onOnSubmit:u},null,8,["text"])]))}});export{B as default};
