var qe=Object.defineProperty,Ke=Object.defineProperties;var Ge=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var We=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var re=(N,v,g)=>v in N?qe(N,v,{enumerable:!0,configurable:!0,writable:!0,value:g}):N[v]=g,f=(N,v)=>{for(var g in v||(v={}))We.call(v,g)&&re(N,g,v[g]);if(oe)for(var g of oe(v))je.call(v,g)&&re(N,g,v[g]);return N},h=(N,v)=>Ke(N,Ge(v));import{g as ze,a9 as Je,O as Qe,E as I,M as ne,y as se,_ as Xe,l as Ze,h as ea,r as le,j as ue,n as aa,p as _,m as W,z as U,A as E,J as ie,C as _e,k as ta,t as oa,F as ra,T as ce}from"./vendor-17026bfd.js";import{_ as na,C as de,$ as sa,G as me,a1 as pe}from"./index-cddbf15c.js";import{a as T}from"./order-c0ced472.js";import{S as O,R as fe,i as la,h as ua}from"./infoCollection-8fbe54c6.js";import{p as he,i as ia,s as ca,g as da,a as ma,u as pa,b as fa}from"./trial-58bb9d3f.js";import{p as ha}from"./product-afb4fe8a.js";import{d as ve,B as va,D as Da,G as ga,S as ya,H as Fa,P as Ca,U as Ia,_ as Ea,W as _a,v as Na,a as De,c as x,f as ge,o as ye,b as V,n as Fe,h as Ce}from"./auth-945e07ac.js";import{_ as wa,g as Ie,o as Ee,t as Pa,a as Ta}from"./index-746d85f9.js";import{t as ba}from"./theme-ea709837.js";import"./utils-b6782348.js";import"./index-dd96cbcb.js";import"./bankCard-b9d5732e.js";import"./trial-ba30bb18.js";const Aa={class:"page-internet-product-detail"},Oa={class:"info"},ka={class:"footer-button"},Sa={class:"price"},Ba=_e(" \u603B\u4FDD\u8D39"),Ua=ze({setup(N){const v=Je(),g=Qe(),{productCode:L="BWYL2021",tenantId:F,orderNo:k,phoneNo:M,agentCode:H="",saleChannelId:Ne,paymentMethod:y,certNo:j,name:z,pageCode:S,from:J}=g.query,Y=I(),d=I(),B=I(),b=I(),A=S==="payBack",Q=I(!1),R=I(!1),$=I(!1),X=I(0),q=I(!1),K=I(!1);let G="";const n=ne({holder:{certNo:j,certType:de.CERT,mobile:M,name:z,socialFlag:O.HAS},insured:{certNo:j,certType:de.CERT,name:z,socialFlag:O.HAS,relationToHolder:fe.SELF},paymentMethod:y,renewalDK:"Y",paymentFrequency:la.YEAR,packageProductList:[],mobileSmsCode:""}),w=I(ve),C=I(ve),s=ne({showInsure:!A,canInsure:!1,canUpgrade:!1}),we=se(()=>{var a,t;return((t=(a=d.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(e=>e.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),Pe=se(()=>{var a,t;return((t=(a=d.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(e=>e.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),Te=()=>{const{holder:{certNo:a,mobile:t,name:e,socialFlag:r},insured:{certNo:o,name:l,socialFlag:c,relationToHolder:i},paymentMethod:m}=n,p=me(a)&&Na(t)&&De(e)&&!!r,u=me(o)&&De(l)&&!!c&&!!i;return!!(p&&u&&!!m)},Z=()=>{v.push({path:"/internet/guaranteeUpgrade",query:h(f({},g.query),{tenantId:F,productCode:"BWYL2022",orderNo:k,agentCode:H})})},be=()=>{K.value=!1},Ae=()=>{C.value=w.value},Oe=()=>{C.value=h(f({},C.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},ke=async a=>{ce.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const t=await pa(a),{code:e}=t;if(e==="10000"){ce.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const r=await fa({orderNo:a.orderNo,tenantId:F}),{data:o}=r;e==="10000"&&(window.location.href=o)}s.canInsure=!0}catch{s.canInsure=!0}},Se=a=>`${pe}/internet/productDetail?tenantId=${F}&productCode=${L}&orderNo=${a}&agentCode=${H}&pageCode=payBack&from=${J||"normal"}`,Be=a=>`${pe}/internet/payFail?tenantId=${F}&orderNo=${a}&agentCode=${H}&pageCode=payBack&from=${J||"normal"}`,Ue=async a=>{console.log("risk",a);const t=Ta({tenantId:F,saleUserId:H,saleChannelId:Ne,detail:d.value,insureDetail:B.value,paymentMethod:n.paymentMethod,renewalDK:n.renewalDK,iseeBizNo:G,successJumpUrl:"",premium:b.value,holder:n.holder,insured:n.insured,tenantOrderRiskList:a,orderStatus:"",orderTopStatus:""});try{const e=await ca(t),{code:r,data:o}=e;r==="10000"&&ke(h(f({},t),{orderNo:o.data,extInfo:{extraInfo:{renewalDK:n.renewalDK,paymentMethod:n.paymentMethod,successJumpUrl:Se(o.data),failUrl:Be(o.data)},iseeBizNo:G}}))}catch{s.canInsure=!0}},Le=async()=>{console.log("trialData",n);const{calcData:a,riskVOList:t}=Ie({holder:n.holder,insured:n.insured,tenantId:F,productDetail:d.value,insureDetail:B.value,paymentFrequency:n.paymentFrequency,packageRiskIdList:Ee(n.packageProductList)}),e=await he(a),{code:r,data:o}=e;return r==="10000"?(b.value=o.premium,{condition:t,data:o}):{}},Me=a=>{X.value=a,$.value=!0},He=()=>new Promise((a,t)=>{var e,r;(r=(e=Y.value)==null?void 0:e.validateForm)==null||r.call(e).then(async()=>{var u;if(!(((u=Y.value)==null?void 0:u.isAgreeFile)||Q.value)){R.value=!0;return}const{calcData:l,riskVOList:c}=Ie({holder:n.holder,insured:n.insured,tenantId:F,productDetail:d.value,insureDetail:B.value,paymentFrequency:n.paymentFrequency,packageRiskIdList:Ee(n.packageProductList)}),i=await he(l),{code:m,data:p}=i;m==="10000"?(b.value=p.premium,a({condition:c,data:p})):t(new Error)}).catch(()=>{console.log("33333"),s.canInsure=!0})}),ee=async()=>{var a;if(console.log("1111",A),A){Z();return}s.canInsure=!1;try{const{condition:t,data:e}=await He();console.log("condition",t),console.log("data",e);const r={},o=(c=[])=>{(c||[]).forEach(i=>{var m;r[i.riskCode]=i,((m=i.riskPremiumDetailVOList)==null?void 0:m.length)&&o(i.riskPremiumDetailVOList)})};o(e.riskPremiumDetailVOList);const l=Pa({tenantId:F,riskList:t,riskPremium:r,productId:(a=d.value)==null?void 0:a.id});console.log("risk",l),Ue(l)}catch{s.canInsure=!0}},Re=a=>{a==="allFalse"&&(R.value=!1,Me(0)),s.canInsure=!0},xe=()=>{Q.value=!0,ee()};Xe(()=>n,Ze.exports.debounce(()=>{d.value&&B.value&&S!=="payBack"&&Te()&&Le()},500),{deep:!0,immediate:!0});const ae=async()=>{var r,o,l,c,i,m,p,u;const a=await da({orderNo:k,tenantId:F}),{code:t,data:e}=a;if(t==="10000"){const{tenantOrderHolder:D,tenantOrderInsuredList:P,extInfo:te}=e;if(!A){Object.assign(n,{holder:{certNo:D.certNo,certType:D.certType,mobile:D.mobile,name:D.name,socialFlag:O.HAS},insured:{certNo:D.certNo,certType:D.certType,name:D.name,socialFlag:O.HAS,relationToHolder:fe.SELF},paymentMethod:y,renewalDK:"Y"}),s.canInsure=!0,C.value=Fe,w.value=Fe;return}Object.assign(n,{holder:{certNo:D.certNo,certType:D.certType,mobile:D.mobile,name:D.name,socialFlag:O.HAS},insured:{certNo:P==null?void 0:P[0].certNo,certType:(r=P[0])==null?void 0:r.certType,name:(o=P[0])==null?void 0:o.name,socialFlag:(c=(l=P[0])==null?void 0:l.extInfo)==null?void 0:c.hasSocialInsurance,relationToHolder:(i=P[0])==null?void 0:i.relationToHolder},paymentMethod:te.extraInfo.paymentMethod,renewalDK:te.extraInfo.renewalDK||"N"}),b.value=(u=(p=(m=P[0])==null?void 0:m.tenantOrderProductList)==null?void 0:p[0])==null?void 0:u.premium,(e.orderStatus===T.ACCEPT_POLICY||e.orderStatus===T.PAYMENT_SUCCESS)&&(s.canUpgrade=!0,q.value=!1,K.value=!0),e.orderStatus===T.PAYING&&(q.value=!0,setTimeout(()=>{ae()},3*1e3))}},Ve=async()=>{var r,o,l,c,i,m;console.log("\u77ED\u4FE1\u8FDB\u5165\uFF0C\u5E26\u4E86orderNo, mobile");const a=await ma({holderPhone:M,orderStatus:[T.PAYING.toUpperCase(),T.TIMEOUT.toUpperCase(),"ACCEPT_POLICY"],productCode:L,tenantId:F}),{code:t,data:e}=a;if(e.orderStatus===T.ACCEPT_POLICY&&(console.log("\u5DF2\u627F\u4FDD\uFF0C\u88AB\u4FDD\u4EBA\u4FE1\u606F\u4E0D\u80FD\u4FEE\u6539"),C.value=h(f({},Ce),{paymentDisable:!!y}),w.value=h(f({},Ce),{paymentDisable:!!y})),(e.orderStatus===T.PAYING||e.orderStatus===T.TIMEOUT)&&(console.log("\u652F\u4ED8\u4E2D\uFF0C\u8D85\u65F6\u53EF\u4EE5\u4FEE\u6539\u6295\u4FDD\u4EBA\u4FE1\u606F"),C.value=h(f({},V),{paymentDisable:!!y}),w.value=h(f({},V),{paymentDisable:!!y})),t==="10000"&&((r=e==null?void 0:e.tenantOrderHolder)==null?void 0:r.certNo)){s.canInsure=!0;const{tenantOrderHolder:p,tenantOrderInsuredList:u,extInfo:D}=e;Object.assign(n,{holder:{certNo:p.certNo,certType:p.certType,mobile:p.mobile,name:p.name,socialFlag:O.HAS},insured:{certNo:u==null?void 0:u[0].certNo,certType:(o=u[0])==null?void 0:o.certType,name:(l=u[0])==null?void 0:l.name,socialFlag:(i=(c=u[0])==null?void 0:c.extInfo)==null?void 0:i.hasSocialInsurance,relationToHolder:(m=u[0])==null?void 0:m.relationToHolder},paymentMethod:y||D.extraInfo.paymentMethod,renewalDK:D.extraInfo.renewalDK})}else C.value=h(f({},x),{paymentDisable:!!y}),w.value=h(f({},x),{paymentDisable:!!y}),s.canInsure=!0},Ye=async()=>{const a=ha({productCode:L,withInsureInfo:!0,tenantId:F}),t=ia({productCode:L});await Promise.all([a,t]).then(([e,r])=>{var o,l;e.code==="10000"&&(d.value=e.data,document.title=((o=e.data)==null?void 0:o.productFullName)||""),r.code==="10000"&&(n.packageProductList=(((l=r.data)==null?void 0:l.packageProductVOList)||[]).map(c=>h(f({},c),{value:ua.UN_INSURE})),B.value=r.data)}),k?ae():M&&S==="productDetail"&&Ve()},$e=()=>{S==="free"?A?(C.value=h(f({},ge),{paymentDisable:!!y}),w.value=h(f({},ge),{paymentDisable:!!y}),s.canInsure=!0):(C.value=h(f({},x),{paymentDisable:!!y}),w.value=h(f({},x),{paymentDisable:!!y}),s.canInsure=!0):A?(C.value=ye,w.value=ye,console.log("\u652F\u4ED8\u5B8C\u6210\u8FDB\u5165")):M||k||(console.log("\u6295\u4FDD\u94FE\u63A5"),C.value=V,w.value=V,s.canInsure=!0)};return ea(()=>{$e(),Ye(),setTimeout(async()=>{G=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(a,t)=>{const e=le("van-button"),r=le("van-config-provider");return ue(),aa(ra,null,[_(r,{"theme-vars":E(ba)},{default:W(()=>{var o,l,c,i,m,p,u;return[U("div",Aa,[U("div",Oa,[_(va,{url:(l=(o=d.value)==null?void 0:o.tenantProductInsureVO)==null?void 0:l.banner[0]},null,8,["url"]),_(Da,{"product-name":(c=d.value)==null?void 0:c.productFullName,"product-desc":(m=(i=d.value)==null?void 0:i.showConfigVO)==null?void 0:m.desc},null,8,["product-name","product-desc"])]),_(ga,{"guarantee-list":(u=(p=d.value)==null?void 0:p.tenantProductInsureVO)==null?void 0:u.titleAndDescVOS},null,8,["guarantee-list"]),_(ya,{detail:d.value},{form:W(()=>[_(Fa,{ref_key:"formRef",ref:Y,"is-show-package":"",disable:!E(s).showInsure,"form-auth":C.value,"form-info":E(n),premium:b.value,"product-detail":d.value,onOnReset:Ae,onOnUpdate:Oe},null,8,["disable","form-auth","form-info","premium","product-detail"])]),_:1},8,["detail"]),U("div",ka,[U("div",Sa,[Ba,U("span",null,"\uFFE5"+ie(E(sa)(b.value))+"/\u6708",1)]),_(e,{type:"primary",class:"right",disabled:!(E(s).canInsure||E(s).canUpgrade),onClick:ee},{default:W(()=>[_e(ie(E(s).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),E(S)!=="payBack"?(ue(),ta(Ca,{key:0,"product-detail":d.value},null,8,["product-detail"])):oa("",!0),_(Ia,{"order-no":E(k),"tenant-id":E(F),"is-show":K.value,onOnConfirm:Z,onOnClose:be},null,8,["order-no","tenant-id","is-show"])]}),_:1},8,["theme-vars"]),_(Ea,{show:R.value,"onUpdate:show":t[0]||(t[0]=o=>R.value=o),"content-list":E(we),"active-index":0,onOnConfirmHealth:Re},null,8,["show","content-list"]),_(wa,{show:$.value,"onUpdate:show":t[1]||(t[1]=o=>$.value=o),"content-list":E(Pe),"active-index":X.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9",onSubmit:xe},null,8,["show","content-list","active-index"]),_(_a,{"is-show":q.value},null,8,["is-show"])],64)}}});var Ja=na(Ua,[["__scopeId","data-v-36ce9629"]]);export{Ja as default};
