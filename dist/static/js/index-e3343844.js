import{ref as e,computed as t,watch as n,onMounted as o}from"vue";import{_ as a,aI as r,u,h as l,C as i,D as d,T as s}from"./index-d66a20d8.js";/* empty css              */import{d as c}from"./debounce-6981b306.js";import{r as v,t as p}from"./utils-57fec98c.js";import{p as m}from"./product-d1af8bd8.js";import{u as f,p as I,i as h}from"./trial-0ac61dce.js";import{_ as O}from"./index-bb9d1cea.js";import{n as y}from"./nextStep-3971c3a9.js";import{P as L}from"./index-88613e6f.js";import{c as C,d as D}from"./infoCollection-e6a8a0ee.js";import"./pdfh5-e588f83d.js";import"./isObjectLike-a9798079.js";import"./trial-b3f7bf73.js";import"./PersonalInfo-4143a04f.js";import"./useDicData-b539129e.js";import"./core-15eeb464.js";import"./constant-8927d485.js";!function(){if("undefined"!=typeof window){var e,t="ontouchstart"in window;document.createTouch||(document.createTouch=function(e,t,o,a,r,u,l){return new n(t,o,{pageX:a,pageY:r,screenX:u,screenY:l,clientX:a-window.pageXOffset,clientY:r-window.pageYOffset},0,0)}),document.createTouchList||(document.createTouchList=function(){for(var e=a(),t=0;t<arguments.length;t++)e[t]=arguments[t];return e.length=arguments.length,e}),Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null});var n=function(e,t,n,o,a){o=o||0,a=a||0,this.identifier=t,this.target=e,this.clientX=n.clientX+o,this.clientY=n.clientY+a,this.screenX=n.screenX+o,this.screenY=n.screenY+a,this.pageX=n.pageX+o,this.pageY=n.pageY+a},o=!1;i.multiTouchOffset=75,t||new i}function a(){var e=[];return e.item=function(e){return this[e]||null},e.identifiedTouch=function(e){return this[e+1]||null},e}function r(t){return function(n){var a,r,i;("mousedown"===n.type&&(o=!0),"mouseup"===n.type&&(o=!1),"mousemove"!==n.type||o)&&(("mousedown"===n.type||!e||e&&!e.dispatchEvent)&&(e=n.target),null==e.closest("[data-no-touch-simulate]")&&(a=t,r=n,(i=document.createEvent("Event")).initEvent(a,!0,!0),i.altKey=r.altKey,i.ctrlKey=r.ctrlKey,i.metaKey=r.metaKey,i.shiftKey=r.shiftKey,i.touches=l(r),i.targetTouches=l(r),i.changedTouches=u(r),e.dispatchEvent(i)),"mouseup"===n.type&&(e=null))}}function u(t){var o=a();return o.push(new n(e,1,t,0,0)),o}function l(e){return"mouseup"===e.type?a():u(e)}function i(){window.addEventListener("mousedown",r("touchstart"),!0),window.addEventListener("mousemove",r("touchmove"),!0),window.addEventListener("mouseup",r("touchend"),!0)}}();const V=e=>(vue.pushScopeId("data-v-5bf39d91"),e=e(),vue.popScopeId(),e),w={class:"net-sale-wrap"},Y={class:"part product-name"},E=V((()=>vue.createElementVNode("span",null,null,-1))),T=V((()=>vue.createElementVNode("span",null,null,-1))),g={class:"part"},x={class:"footer"};var N=a(vue.defineComponent({__name:"index",setup(a){r();const V=u(),{productCode:N="HTEJBX",tenantId:k="9991000001",agentCode:b="",agencyCode:P,saleChannelId:R,extraInfo:j,preview:B}=V.query,M=e(),H=e("0"),S=e(),_=e(),U=e(),$=e([{}]),F=e([]),X=e({}),A=e(""),K=e({min:new Date(l().add(1,"day").format("YYYY-MM-DD")),max:new Date,currentDate:""});let z={};try{z=JSON.parse(decodeURIComponent(j))}catch(oe){}const q=e({agencyId:P,agentCode:b,commencementTime:"",expiryDate:"",extInfo:{buttonCode:"EVENT_NETSALE_underWrite",pageCode:"infoCollection",templateId:z.templateId,iseeBizNo:A.value,extraInfo:z},orderCategory:1,saleUserId:b,saleChannelId:R,tenantId:k,venderCode:"",tenantOrderHolder:{extInfo:{occupationCodeList:[]}},tenantOrderInsuredList:[{relationToHolder:"1",extInfo:{occupationCodeList:[]},tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{}}],tenantOrderProductList:[{}]}],tenantOrderSubjectList:[{extInfo:{subjectRelatedFirm:"xinao",subjectRelatedUserId:""},subjectName:"",subjectObjectType:"HOLDER",subjectType:"GENERAL",subjectNo:"",tenantId:k}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}}),J=t((()=>{var e,t;return((null==(t=null==(e=S.value)?void 0:e.productRelationPlanVOList)?void 0:t.length)||0)>1})),W=e();n([()=>U.value,()=>_.value,()=>H.value],(()=>{var e,t;const{premium:n}=U.value||{};if(n)W.value=n&&`￥${n}元`;else{const{tenantProductInsureVO:n}=_.value||{};let o={};o=(null==(e=null==n?void 0:n.planList)?void 0:e.length)?((null==n?void 0:n.planList)||[]).find((e=>e.planCode===H.value)):null==n?void 0:n.planInsureVO;const{paymentFrequencyValue:a,premiumUnit:r}=(null==(t=null==o?void 0:o.productPremiumVOList)?void 0:t[0])||{};W.value=a&&`￥${a}${r||"元"}`}}),{deep:!0,immediate:!0});const G=t((()=>{var e,t,n,o,a,r,u;let i=[];i=(null==(t=null==(e=S.value)?void 0:e.productRelationPlanVOList)?void 0:t.length)?(null==(o=null==(n=S.value)?void 0:n.productRelationPlanVOList.find((e=>e.planCode===H.value)))?void 0:o.productRiskVoList)||[]:(null==(a=S.value)?void 0:a.productRiskVoList)||[];const{insuranceStartType:d,riskInsureLimitVO:s}=(null==(u=null==(r=null==i?void 0:i[0])?void 0:r.riskDetailVOList)?void 0:u[0])||{},{maxInsuranceDay:c}=s||{};if(d===+C.CUSTOM_DAY){const[e,t]=(c||"").split(",");e&&t&&t!==e?(K.value.min=new Date(l(new Date).add(+e||0,"day").format("YYYY-MM-DD")),K.value.max=new Date(l(new Date).add(+t||0,"day").format("YYYY-MM-DD"))):e&&t&&t===e?K.value.currentDate=l(new Date).add(t,"day").format("YYYY-MM-DD HH:mm:ss"):t||(K.value.max=new Date(l(new Date).add(+t||0,"day").format("YYYY-MM-DD")))}return i})),Q=t((()=>{var e,t,n;const{insuranceStartType:o,riskInsureLimitVO:a}=(null==(n=null==(t=null==(e=G.value)?void 0:e[0])?void 0:t.riskDetailVOList)?void 0:n[0])||{},{maxInsuranceDay:r}=a||{};if(o!==+C.CUSTOM_DAY)return!0;const[u,l]=(r||"").split(",");return u===l})),Z=t((()=>{var e,t,n;const o=G.value||[],a=(null==(n=null==(t=null==(e=null==o?void 0:o[0])?void 0:e.riskDetailVOList)?void 0:t[0])?void 0:n.insuranceStartType)||1;return K.value.currentDate?`${l(K.value.currentDate).format("YYYY-MM-DD")} 00:00:00`:a===+C.CURRENT_DAY?`${l(new Date).format("YYYY-MM-DD HH:mm:ss")}`:`${l(new Date).add(1,"day").format("YYYY-MM-DD")} 00:00:00`})),ee=t((()=>{var e,t;const n=G.value||[],{insuranceEndType:o,riskInsureLimitVO:a}=(null==(t=null==(e=null==n?void 0:n[0])?void 0:e.riskDetailVOList)?void 0:t[0])||{},{insurancePeriodValueList:r}=a||{};r||console.warn("insurancePeriodValueList","保障信息不存在");const[u,i]=((null==r?void 0:r[0])||"").split("_");return o===+D.CURRENT_DAY?`${l(Z.value).add(i||0,u).subtract(1,"day").format("YYYY-MM-DD")} 23:59:59`:o?`${l(Z.value).add(i,u).format("YYYY-MM-DD")} 00:00:00`:""})),te=async()=>{var e,t,n;q.value.venderCode=null==(e=S.value)?void 0:e.productBasicInfoVO.insurerCode,q.value.orderAmount=null==(t=U.value)?void 0:t.premium,q.value.orderRealAmount=null==(n=U.value)?void 0:n.premium,q.value.commencementTime=Z.value,q.value.expiryDate=ee.value,q.value.extInfo&&(q.value.extInfo.iseeBizNo=A.value),q.value.tenantOrderInsuredList&&(q.value.tenantOrderInsuredList[0].planCode=H.value),y(((e,t,n)=>{var o,a;const r={},u=(e=[])=>{(e||[]).forEach((e=>{var t;r[e.riskCode]=e,(null==(t=e.riskPremiumDetailVOList)?void 0:t.length)&&u(e.riskPremiumDetailVOList)}))};u(null==t?void 0:t.riskPremiumDetailVOList);const l={...n},d={tenantId:k,riskList:(null==(o=F.value)?void 0:o[0].riskVOList)||[],riskPremium:r,productId:(null==e?void 0:e.productBasicInfoVO.id)||0};return l.tenantOrderHolder&&(l.tenantOrderHolder.certType=l.tenantOrderHolder.certType||i.CERT,l.tenantOrderHolder.certNo=(l.tenantOrderHolder.certNo||"").toLocaleUpperCase()),l.tenantOrderInsuredList&&(l.tenantOrderInsuredList[0].certType=l.tenantOrderInsuredList[0].certType||i.CERT,l.tenantOrderInsuredList[0].certNo=(l.tenantOrderInsuredList[0].certNo||"").toLocaleUpperCase(),l.tenantOrderInsuredList[0].tenantOrderProductList=[{premium:null==(a=U.value)?void 0:a.premium,productCode:null==e?void 0:e.productBasicInfoVO.productCode,productName:null==e?void 0:e.productBasicInfoVO.productName,tenantOrderRiskList:p(d)}]),l})(S.value,U.value,q.value),((e,t)=>{"jumpToPage"===t&&s("提交成功")}))},ne=async()=>{var e;null==(e=M.value)||e.validateForm().then((()=>{var e,t;d.confirm({title:"分享",message:`即将向客户【${null==(t=null==(e=q.value)?void 0:e.tenantOrderHolder)?void 0:t.name}】发送投保确认信息,请确认是否继续？`}).then((()=>{B||te()}))}))};n([()=>{var e;return null==(e=q.value.tenantOrderInsuredList)?void 0:e[0].name},()=>{var e;return null==(e=q.value.tenantOrderInsuredList)?void 0:e[0].birthday},()=>H.value],c((([e,t])=>{e&&t&&(B||(async(e,t,n)=>{var o,a,r,u,l,d;const s={holder:{personVO:{certType:i.CERT,...e.tenantOrderHolder,socialFlag:`${(null==(a=null==(o=e.tenantOrderHolder)?void 0:o.extInfo)?void 0:a.hasSocialInsurance)||""}`,occupationCodeList:null==(u=null==(r=e.tenantOrderHolder)?void 0:r.extInfo)?void 0:u.occupationCodeList}},insuredVOList:((null==e?void 0:e.tenantOrderInsuredList)||[]).map((e=>{var o,a;return{insuredCode:"",personVO:{...e,certType:i.CERT,socialFlag:`${(null==(o=null==e?void 0:e.extInfo)?void 0:o.hasSocialInsurance)||""}`,occupationCodeList:null==(a=null==e?void 0:e.extInfo)?void 0:a.occupationCodeList},productPlanVOList:[{insurerCode:null==t?void 0:t.productBasicInfoVO.insurerCode,planCode:H.value||"",riskVOList:v(n)}]}})),productCode:null==t?void 0:t.productBasicInfoVO.productCode,productId:null==t?void 0:t.productBasicInfoVO.id,tenantId:k},{code:c}=await f(s);if("10000"===c){const{code:e,data:t}=await I(s);"10000"===e?(U.value=t,F.value=(null==(d=null==(l=null==s?void 0:s.insuredVOList)?void 0:l[0])?void 0:d.productPlanVOList)||[]):U.value=void 0}})(q.value,S.value,G.value))}),500));return n((()=>H.value),(()=>{$.value&&(X.value=$.value[H.value])})),o((()=>{(async()=>{await m({productCode:N,withInsureInfo:!0,tenantId:k}).then((({code:e,data:t})=>{var n;"10000"===e&&(_.value=t,document.title=(null==(n=t.tenantProductInsureVO)?void 0:n.productName)||"")})),h({productCode:N}).then((({code:e,data:t})=>{var n;"10000"===e&&(S.value=t,$.value=t.planFactor,(null==(n=t.productRelationPlanVOList)?void 0:n.length)&&(H.value=t.productRelationPlanVOList[0].planCode||""),t.productFactor?X.value=t.productFactor:t.planFactor&&(X.value=t.planFactor[H.value]))}))})(),setTimeout((async()=>{A.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,t)=>{const n=vue.resolveComponent("ProRadioButton"),o=vue.resolveComponent("ProCard"),a=vue.resolveComponent("ProCell"),r=vue.resolveComponent("ProDatePicker"),u=vue.resolveComponent("ProPageWrap");return vue.openBlock(),vue.createBlock(u,null,{default:vue.withCtx((()=>{var e,u;return[vue.createElementVNode("div",w,[vue.createElementVNode("div",Y,vue.toDisplayString(null==(u=null==(e=vue.unref(S))?void 0:e.productBasicInfoVO)?void 0:u.productFullName),1),vue.unref(J)?(vue.openBlock(),vue.createBlock(o,{key:0,"show-line":!1,title:"保障年期"},{default:vue.withCtx((()=>{var e;return[vue.createVNode(n,{modelValue:vue.unref(H),"onUpdate:modelValue":t[0]||(t[0]=e=>vue.isRef(H)?H.value=e:null),class:"radio-group",prop:{label:"planName",value:"planCode"},options:null==(e=vue.unref(S))?void 0:e.productRelationPlanVOList},null,8,["modelValue","options"])]})),_:1})):vue.createCommentVNode("",!0),vue.createVNode(O,{ref_key:"formRef",ref:M,"title-collection":{HOLDER:"投保人",INSURER:"被保人",BENEFICIARY:"收益人"},"form-info":vue.unref(q),"send-sms-code":()=>{},"input-align":"left","factor-object":vue.unref(X)},{holderName:vue.withCtx((()=>[E])),insurerName:vue.withCtx((()=>[T])),_:1},8,["form-info","factor-object"]),vue.createElementVNode("div",g,[vue.createVNode(a,{title:"保费",content:vue.unref(W)},null,8,["content"]),vue.unref(Q)?(vue.openBlock(),vue.createBlock(a,{key:0,title:"保障期间",content:`${vue.unref(Z).split(" ")[0]}~${vue.unref(ee).split(" ")[0]}`},null,8,["content"])):(vue.openBlock(),vue.createBlock(r,{key:1,modelValue:vue.unref(K).currentDate,"onUpdate:modelValue":t[1]||(t[1]=e=>vue.unref(K).currentDate=e),label:"生效日期",name:"currentDate",type:"date",min:vue.unref(K).min,max:vue.unref(K).max,required:!0},null,8,["modelValue","min","max"]))]),vue.createElementVNode("div",x,[vue.createVNode(L,{shadow:!1,text:"分享用户确认投保",onClick:ne})])])]})),_:1})}}}),[["__scopeId","data-v-5bf39d91"]]);export{N as default};
