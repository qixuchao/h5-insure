import{h as e,N as t,a8 as a,r as l,d as n,x as o,j as r,k as s,l as i,m as d,n as c,z as u,Q as v,I as f,y as p,J as y,s as C,A as m,E as I,F as g,C as N,T as h,D as k,a3 as T,a4 as b}from"./vendor-0381d15c.js";import{l as x}from"./index-38a8c5cf.js";import{_ as O,S as E,p as _,e as w,a as L,q as j,l as D,C as S,g as H,s as R,n as U,N as $,b as A,A as P,t as F}from"./index-bf77031d.js";import{_ as Y}from"./index-0db3fc8a.js";import{f as q,s as G,g as Q,a as M}from"./verify-7ce6bed1.js";import{a as B}from"./order-54328cdf.js";import{g as W,l as z}from"./inform-bb4e9d4e.js";const J=e=>(T("data-v-7e8d1d5c"),e=e(),b(),e),V={class:"page-verify"},K={class:"people"},X={class:"name"},Z={class:"verify-item"},ee=J((()=>u("div",{class:"label"},"证件号码",-1))),te={class:"no"},ae=N(" 去认证 "),le={class:"sign-body"},ne={class:"date"},oe={class:"file"},re=N(" 签名将被用于以下文件： "),se={class:"people"},ie={class:"name"},de={class:"verify-item"},ce=J((()=>u("div",{class:"label"},"证件号码",-1))),ue={class:"no"},ve=["onClick"],fe=N(" 去认证 "),pe=["onClick"],ye={class:"sign-body"},Ce={class:"date"},me={class:"file"},Ie=N(" 签名将被用于以下文件： "),ge={class:"footer-button footer"},Ne=J((()=>u("div",{class:"text"},"刷新",-1))),he=N("分享"),ke=N("提交");var Te=O(e({setup(e){const N=1,T=2,b=t(),O=a(),J=(()=>{const e=b.query;return e.orderCode&&(e.orderNo=e.orderCode,delete e.orderCode),e})(),{saleUserId:Te="D1234567-1",tenantId:be="9991000007",templateId:xe=1,productCode:Oe="CQ75CQ76",insurerCode:Ee="ancheng",isShare:_e,orderCode:we,orderNo:Le,productCategory:je}=J,De=new E({source:"localStorage"}),Se=l([]),He=l([]),Re=l([]),Ue=l([]),$e=l(),Ae=l(),Pe=[],Fe=l(""),Ye=l(),qe=n().format("YYYY-MM-DD"),Ge=()=>{var e,t;null==(t=null==(e=Ae.value)?void 0:e.clear)||t.call(e)},Qe=(e,t)=>{let a=window.location.href;a=a.includes("orderCode")?a:a.replace("orderNo","orderCode"),M({callbackUrl:a,certiNo:e,faceAuthMode:"TENCENT",userName:t,tenantId:9991000007}).then((a=>{const{code:l,data:n}=a;if("10000"===l){const{originalUrl:a,serialNo:l}=n;window.location.href=a,De.set("verifyData",{serialNo:l,certNo:e,name:t})}}))},Me=e=>{const{id:t,objectType:a}=e;Fe.value="",Ye.value="";const l={1:"pdf",2:"richText",3:"link"};W({insurerCode:Ee,id:t,objectType:a,productCategory:je,orderNo:Le,tenantId:be}).then((({code:e,data:t})=>{if("10000"===e){const{textType:e,content:a,questionType:n}=(null==t?void 0:t[0])||{};2===n?(Fe.value="question",Ye.value=t):(1===e&&a.includes("png")?Fe.value="picture":Fe.value=l[e],Ye.value=a)}}))},Be=e=>`${e}`===S.CERT,We=e=>{var t,a,l,n;-1===e?Qe(null==(t=$e.value.tenantOrderHolder)?void 0:t.certNo,null==(a=$e.value.tenantOrderHolder)?void 0:a.name):Qe(null==(l=$e.value.tenantOrderInsuredList[e])?void 0:l.certNo,null==(n=$e.value.tenantOrderInsuredList[e])?void 0:n.name)},ze=e=>{e&&Pe.every((t=>t!==e))&&Pe.push(e)},Je=()=>{var e,t,a,l;(null==(e=Ae.value)?void 0:e.isEmpty())?h.fail("请投保人签名"):(null==(a=null==(t=$e.value.tenantOrderHolder)?void 0:t.extInfo)?void 0:a.isCert)!==N&&Be(null==(l=$e.value.tenantOrderHolder)?void 0:l.certType)?h.fail("请投保人去认证"):H({orderNo:we||Le,saleUserId:Te,tenantId:be}).then((e=>{const{code:t,data:a}=e;"10000"===t&&([B.PENDING,B.PAYMENT_FAILED,B.UNDER_WRITING_SUCCESS].includes(a.orderStatus)?k.confirm({title:"提示",message:"请确认信息填写无误后，再进行支付"}).then((()=>{var e,a;const l=null==(e=Ae.value)?void 0:e.save();Promise.all([G("HOLDER",l,null==(a=$e.value)?void 0:a.id,`${be}`)]).then((()=>{U({...$e.value,pageCode:"sign",operateOption:{withSignInfo:!0},extInfo:{...$e.value.extInfo,pageCode:"sign",templateId:xe,shareFlag:_e?"Y":"N",buttonCode:$.sign},venderCode:Ee}).then((e=>{const{code:a,data:l}=e;"10000"===t&&l.success&&O.push({path:A[l.pageAction.data.nextPageCode],query:{orderNo:we||Le,saleUserId:Te,tenantId:be}})}))}))})):R("paymentResult",J))}))},Ve=(e=!1)=>{H({orderNo:we||Le,saleUserId:Te,tenantId:be}).then((t=>{var a,l;const{code:n,data:o}=t;"10000"===n&&($e.value=o,e&&((null==(l=null==(a=null==o?void 0:o.tenantOrderHolder)?void 0:a.extInfo)?void 0:l.isCert)===T||(null==o?void 0:o.tenantOrderInsuredList.some((e=>{var t;return(null==(t=e.extInfo)?void 0:t.isCert)===T})))?h("用户未完身份认证及签字"):(null==o?void 0:o.tenantOrderAttachmentList.find((e=>e.category===P.ELECTRIC_SIGN&&e.objectType===F.HOLDER)))&&(null==o?void 0:o.tenantOrderAttachmentList.find((e=>e.category===P.ELECTRIC_SIGN&&e.objectType===F.INSURED)))||h("用户未完身份认证及签字")),setTimeout((()=>{let e=0;o.tenantOrderAttachmentList.forEach((t=>{var a,l,n,o;t.category===P.ELECTRIC_SIGN&&(t.objectType===F.HOLDER?(null==(l=null==(a=Ae.value)?void 0:a.clear)||l.call(a),Ae.value.setDataURL(t.fileBase64)):t.objectType===F.INSURED&&(null==(o=null==(n=Pe[e])?void 0:n.clear)||o.call(n),Pe[e].setDataURL(t.fileBase64),e+=1))}))})))}))},Ke=()=>{Ve(!0)},Xe=o((()=>{const e={...J,isShare:1,sharePageCode:"sign"};return`${window.location.origin}/phoneVerify?${x.stringify(e)}`}));return r((()=>{Ve(),(async()=>{const e={orderNo:we||Le,productCode:Oe,tenantId:be,objectType:1},t={insurerCode:Ee,orderNo:Le,productCategory:je,tenantId:be,noticeType:4,objectType:1},{code:a,data:l}=await Q(e),{code:n,data:o}=await Q({...e,objectType:2}),{code:r,data:s}=await z(t),{code:i,data:d}=await z({...t,noticeType:5,objectType:2});"10000"===a&&(He.value=l||[]),"10000"===n&&(Se.value=o||[]),"10000"===r&&(Ue.value=s||[]),"10000"===i&&(Re.value=d||[])})();const e=De.get("verifyData");if(e){const{serialNo:t,certNo:a,name:l}=e;q({certiNo:a,orderNo:we||Le,serialNo:t,tenantId:be,userName:l}).then((e=>{const{code:t,data:a}=e;"10000"===t&&(De.remove("verifyData"),Ve())}))}})),(e,t)=>{const a=s("ProPDFviewer"),l=s("van-button"),n=s("ProPageWrap");return i(),d(n,null,{default:c((()=>{var e;return[u("div",V,[v(_,{type:"warning",title:"尊敬的客户，本次投保需要进行身份认证",content:"本产品投保需要对投保人、被保人进行实名认证，您购买本产品的累计总保费已超过20万，按监管要求，需要提供投保人、被保人、指定受益人证件影像，本产品非本人投保且带身故责任、需对投保人、被保人（成人）的投保意愿进行签字确认。"}),v(L,{title:"投保人",class:"card"},{extra:c((()=>{var e,t,a,l,n,o,r,s,d,c;return[u("div",K,[u("div",X,f(null==(t=null==(e=$e.value)?void 0:e.tenantOrderHolder)?void 0:t.name),1),Be(null==(l=null==(a=$e.value)?void 0:a.tenantOrderHolder)?void 0:l.certType)?(i(),p("div",{key:0,class:y(["status",{verified:(null==(r=null==(o=null==(n=$e.value)?void 0:n.tenantOrderHolder)?void 0:o.extInfo)?void 0:r.isCert)===N}])},f((null==(c=null==(d=null==(s=$e.value)?void 0:s.tenantOrderHolder)?void 0:d.extInfo)?void 0:c.isCert)===N?"已认证":"待认证"),3)):C("",!0)])]})),default:c((()=>{var e,a,l,n,o,r,s;return[u("div",Z,[ee,u("div",te,f(null==(a=null==(e=$e.value)?void 0:e.tenantOrderHolder)?void 0:a.certNo),1),(null==(o=null==(n=null==(l=$e.value)?void 0:l.tenantOrderHolder)?void 0:n.extInfo)?void 0:o.isCert)!==N&&Be(null==(s=null==(r=$e.value)?void 0:r.tenantOrderHolder)?void 0:s.certType)?(i(),p("div",{key:0,class:"action",onClick:t[0]||(t[0]=e=>We(-1))},[ae,v(w,{name:"right_arrow",class:"icon"})])):C("",!0)])]})),_:1}),v(L,{key:"-1",title:"投保人签名","show-icon":!1,class:"sign-card","show-line":!1},{extra:c((()=>[u("div",{class:"resign",onClick:Ge},"重签")])),default:c((()=>[v(j,{ref_key:"holderSign",ref:Ae,class:"sign"},null,512),u("div",le,[u("div",ne,"签名日期： "+f(m(qe)),1),u("div",oe,[re,u("span",null,[(i(!0),p(g,null,I(He.value,((e,l)=>(i(),d(a,{key:`holderFileList-${l}`,class:"file",title:`《${e.materialName}》`,content:e.materialContent,type:m(D)(e.materialContent,e.materialSource+""),onClick:t[1]||(t[1]=()=>"")},null,8,["title","content","type"])))),128))]),(i(!0),p(g,null,I(Ue.value,((e,t)=>(i(),d(a,{key:`holderQuestionList-${t}`,class:"file",title:`《${e.title}》`,content:Ye.value,type:Fe.value,onClick:()=>Me(e)},null,8,["title","content","type","onClick"])))),128))])])])),_:1}),(i(!0),p(g,null,I(null==(e=$e.value)?void 0:e.tenantOrderInsuredList,((e,l)=>(i(),p("div",{key:l},[v(L,{title:"被保人",class:"card"},{extra:c((()=>{var t,a;return[u("div",se,[u("div",ie,f(e.name),1),Be(e.certType)?(i(),p("div",{key:0,class:y(["status",{verified:(null==(t=e.extInfo)?void 0:t.isCert)===N}])},f((null==(a=e.extInfo)?void 0:a.isCert)===N?"已认证":"待认证"),3)):C("",!0)])]})),default:c((()=>{var t;return[u("div",de,[ce,u("div",ue,f(e.certNo),1),(null==(t=e.extInfo)?void 0:t.isCert)!==N&&Be(e.certType)?(i(),p("div",{key:0,class:"action",onClick:e=>We(l)},[fe,v(w,{name:"right_arrow",class:"icon"})],8,ve)):C("",!0)])]})),_:2},1024),v(L,{title:"被保人签名","show-icon":!1,class:"sign-card","show-line":!1},{extra:c((()=>[u("div",{class:"resign",onClick:e=>(e=>{var t,a;null==(a=null==(t=Pe[e])?void 0:t.clear)||a.call(t)})(l)},"重签",8,pe)])),default:c((()=>[v(j,{ref_for:!0,ref:ze,class:"sign"}),u("div",ye,[u("div",Ce,"签名日期： "+f(m(qe)),1),u("div",me,[Ie,(i(!0),p(g,null,I(Se.value,((e,l)=>(i(),d(a,{key:`insuredFileList-${l}`,class:"file",title:`《${e.materialName}》`,content:e.materialContent,type:m(D)(e.materialContent,e.materialSource+""),onClick:t[2]||(t[2]=()=>"")},null,8,["title","content","type"])))),128)),(i(!0),p(g,null,I(Re.value,((e,t)=>(i(),d(a,{key:`insuredQuestionList-${t}`,class:"file",title:`《${e.title}》`,content:Ye.value,type:Fe.value,onClick:()=>Me(e)},null,8,["title","content","type","onClick"])))),128))])])])),_:2},1024)])))),128)),u("div",ge,[m(_e)?C("",!0):(i(),p("div",{key:0,class:"refresh-btn",onClick:Ke},[u("div",null,[v(w,{name:"refresh"})]),Ne])),m(_e)?C("",!0):(i(),d(Y,{key:1,title:"邀请您进行身份认证",desc:"邀请您进行身份认证",link:m(Xe)},{default:c((()=>[v(l,{plain:"",type:"primary",class:"share-btn"},{default:c((()=>[he])),_:1})])),_:1},8,["link"])),v(l,{type:"primary",class:"submit-btn",onClick:Je},{default:c((()=>[ke])),_:1})])])]})),_:1})}}}),[["__scopeId","data-v-7e8d1d5c"]]);export{Te as default};
