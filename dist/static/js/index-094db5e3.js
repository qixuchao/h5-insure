import{_ as e,d as t,r as a,am as n,c as r,e as i,w as d,i as o,f as l,g as s,h as u,t as c,F as f,a7 as p,n as v,R as m,s as I,B as O,u as y,a as L,S as C,J as b,E as h,aD as x,$ as E,C as g,b as T,m as R,j as V,ac as k,p as A,aj as P,ak as H,P as _,l as N,ao as j,aE as D,V as B,aF as w,at as S,N as U,T as F,M as Y,O as M}from"./index-dae3ff12.js";import{p as $}from"./trial-b645c7f1.js";import{P as q,I as G,R as J}from"./trial-75f9914d.js";import{u as K}from"./useDicData-33c7e9bb.js";import{R as W,a as z,B as Q,b as X}from"./infoCollection-89fc213f.js";import{_ as Z}from"./index-526f11e7.js";import"./pdfh5-008ca364.js";import"./relativeTime-fde2a46e.js";const ee={class:"com-select-container"},te={class:"radio-item-wrapper"},ae={class:"name"},ne={class:"hone"},re={class:"address"},ie={class:"footer-button"},de=v("取消"),oe=v("确认");var le=e(t({props:{dataSource:{type:Array,default:()=>[]},show:{type:Boolean,default:!1},modelValue:{type:[String,Number],default:null}},emits:["update","update:modelValue","submit","close"],setup(e,{emit:t}){const v=e,y=a(v.modelValue),L=a(v.show),C=()=>{t("submit",y.value),L.value=!1},b=()=>{t("close")};return n((()=>v.modelValue),(e=>{y.value=e})),n((()=>y.value),(e=>{t("update:modelValue",e)})),(t,a)=>{const n=m,v=I,h=O;return r(),i(p,{show:L.value,"onUpdate:show":a[1]||(a[1]=e=>L.value=e),class:"com-select",title:"选择保单通讯信息",onClose:b},{default:d((()=>[o("div",ee,[l(v,{modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=e=>y.value=e)},{default:d((()=>[(r(!0),s(f,null,u(e.dataSource,((e,t)=>(r(),i(n,{key:t,name:t+1,class:"radio-item"},{default:d((()=>[o("div",te,[o("p",null,[o("span",ae,c(e.contactName),1),o("span",ne,c(e.contactPhoneNo),1)]),o("p",re,c(e.contactAddress),1)])])),_:2},1032,["name"])))),128))])),_:1},8,["modelValue"])]),o("div",ie,[l(h,{plain:"",type:"primary"},{default:d((()=>[de])),_:1}),l(h,{type:"primary",onClick:C},{default:d((()=>[oe])),_:1})])])),_:1},8,["show"])}}}),[["__scopeId","data-v-a821acd4"]]);const se={key:0,class:"beneficiary-part"},ue={class:"part-title"},ce={class:"title"},fe=v("删除"),pe=v("+添加受益人"),ve=v("选择保单通讯信息"),me={class:"radio-item-wrapper"},Ie={class:"name"},Oe={class:"hone"},ye={class:"address"},Le={class:"footer-button","safe-area-inset-bottom":""},Ce={class:"left"},be={class:"trial-result"},he=v(" 首期"),xe={class:"result-num"},Ee=o("div",{class:"result-desc"},"实际保费以后续为准",-1),ge={class:"operate-btn"},Te=v("下一步"),Re=t({setup(e){const t=y(),p=L(),{templateId:v=1,orderNo:m="2022072710380711215",productCode:I,tenantId:ee="9991000007",proposalId:te,insurerCode:ae="kunlunhealth"}=p.query,[ne,re]=C(),ie="/infoPreview"===p.path?"infoPreview":"infoCollection",de=K("NATIONAL_REGION_CODE"),oe=a({}),Re=a({extInfo:{pageCode:ie},tenantOrderHolder:{extInfo:{occupationCodeList:[]},holderType:1},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},insuredBeneficiaryType:"1",tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}]}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}}),Ve=a(null),ke=a([]),Ae=a([]),Pe=a([]),He=a([]),_e=a([]),Ne=b({beneficiaryId:0,nextPage:"",currentAddress:null,isLoading:!0}),je=h((()=>{var e,t,a,n,r,i,d,o,l,s;return[{contactAddress:null==(t=null==(e=Re.value.tenantOrderHolder)?void 0:e.extInfo)?void 0:t.familyAddress,contactName:Re.value.tenantOrderHolder.name,contactPhoneNo:Re.value.tenantOrderHolder.mobile},{contactAddress:null==(n=null==(a=Re.value.tenantOrderHolder)?void 0:a.extInfo)?void 0:n.workAddress,contactName:Re.value.tenantOrderHolder.name,contactPhoneNo:Re.value.tenantOrderHolder.mobile},{contactAddress:null==(i=null==(r=Re.value.tenantOrderInsuredList[0])?void 0:r.extInfo)?void 0:i.familyAddress,contactName:null==(d=Re.value.tenantOrderInsuredList[0])?void 0:d.name,contactPhoneNo:null==(o=Re.value.tenantOrderInsuredList[0])?void 0:o.mobile},{contactAddress:null==(s=null==(l=Re.value.tenantOrderInsuredList[0])?void 0:l.extInfo)?void 0:s.workAddress,contactName:Re.value.tenantOrderInsuredList[0].name,contactPhoneNo:Re.value.tenantOrderInsuredList[0].mobile}].filter((e=>e.contactAddress&&e.contactName&&e.contactPhoneNo))||[]})),De=h((()=>{var e,t;return Ne.currentAddress?je.value[Ne.currentAddress-1]||{}:(null==(t=null==(e=Re.value.extInfo)?void 0:e.contactInfo)?void 0:t[0])||{}})),Be=e=>{const t={};return e.map((e=>{const{initialAmount:a,annuityDrawFrequency:n,annuityDrawType:r,paymentFrequency:i,paymentPeriod:d,paymentPeriodType:o,insurancePeriodType:l,insurancePeriodValue:s,riskCode:u,riskType:c,initialPremium:f,liabilityDetails:p,extInfo:v}=e,{riskId:m,copy:I}=v,O={amount:a,annuityDrawDate:n,annuityDrawType:r,paymentFrequency:i,riskId:m,copy:I,chargePeriod:d?`${q[o]}_${d}`:q[o],coveragePeriod:s?`${G[l]}_${s}`:G[l],riskCode:u,riskType:c,premium:f,liabilityVOList:p.map((e=>({...e,liabilityAttributeValue:e.refundMethod,liabilityAttributeCode:e.refundMethod&&1})))};return c===J.MAIN_RISK?(t.mainRiskCode=u,t.mainRiskId=m):Object.assign(O,t),O}))},we=()=>{var e;null==(e=Ve.value)||e.validate().then((()=>{const{birthday:e,gender:a,extInfo:n}=Re.value.tenantOrderHolder,{hasSocialInsurance:r,occupationCodeList:i}=n,{birthday:d,gender:o,extInfo:l,tenantOrderProductList:s}=Re.value.tenantOrderInsuredList[0],{hasSocialInsurance:u,occupationCodeList:c}=l,f={holder:{personVO:{birthday:k(e).format("YYYY-MM-DD"),gender:a,socialFlag:r,occupationCodeList:i}},productCode:I,insuredVOList:[{insurerCode:ae,personVO:{birthday:k(d).format("YYYY-MM-DD"),gender:o,socialFlag:u,occupationCodeList:c},productPlanVOList:[{insurerCode:ae,planCode:"",riskVOList:Be(s[0].tenantOrderRiskList)}]}]};$({...f}).then((({code:e,data:a})=>{if("10000"===e){const e={},n=(t=[])=>{(t||[]).forEach((t=>{var a;e[t.riskCode]=t,(null==(a=t.riskPremiumDetailVOList)?void 0:a.length)&&n(t.riskPremiumDetailVOList)}))};n(a.riskPremiumDetailVOList),Re.value.tenantOrderInsuredList[0].tenantOrderProductList[0]={...Re.value.tenantOrderInsuredList[0].tenantOrderProductList[0],premium:a.premium,tenantOrderRiskList:Re.value.tenantOrderInsuredList[0].tenantOrderProductList[0].tenantOrderRiskList.map((t=>({...t,initialAmount:e[t.riskCode].amount,initialPremium:e[t.riskCode].premium})))},(()=>{var e;const a={...Re.value};a.extInfo={...a.extInfo,contactInfo:[De.value],buttonCode:U.infoCollection},a.tenantOrderAttachmentList=[{category:P.OBVERSE_CERT,objectType:H.HOLDER,objectId:Re.value.tenantOrderHolder.id,name:"投保人证件正面",uri:ke.value[0],id:Pe.value[0]},{category:P.REVERSE_CERT,objectType:H.HOLDER,objectId:Re.value.tenantOrderHolder.id,name:"投保人证件背面",uri:ke.value[1],id:Pe.value[1]},{category:P.OBVERSE_CERT,objectType:H.INSURED,objectId:Re.value.tenantOrderInsuredList[0].id,name:"被保人证件正面",uri:Ae.value[0]||ke.value[0],id:He.value[1]},{category:P.REVERSE_CERT,objectType:H.INSURED,objectId:Re.value.tenantOrderInsuredList[0].id,name:"被保人证件背面",uri:Ae.value[1]||ke.value[1],id:He.value[1]}].filter((e=>e.uri)),null==(e=Ve.value)||e.validate().then((e=>{if(a.tenantOrderInsuredList[0].insuredBeneficiaryType===X.SPECIFY){const e={};if(a.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.forEach((t=>{e[t.benefitOrder]?e[t.benefitOrder].sum+=Number(t.benefitRate):e[t.benefitOrder]={sum:Number(t.benefitRate)}})),Object.values(e).some((e=>100!==e.sum)))return void F.fail("同一顺位的受益人比例之和必须为100")}Y(a).then((({code:e,data:a})=>{"10000"===e&&"jumpToPage"===a.pageAction.pageAction&&t.push({path:M[a.pageAction.data.nextPageCode],query:p.query})}))}))})()}}))}))},Se=e=>{},Ue=()=>{Ne.beneficiaryId+=1,Re.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.push({id:Ne.beneficiaryId,extInfo:{}})};return x((()=>{A({orderNo:m,tenantId:ee}).then((({code:e,data:t})=>{var a,n;if("10000"===e){const e=t;e.extInfo={...e.extInfo,pageCode:ie,templateId:v},e.tenantOrderHolder=e.tenantOrderHolder||{holderType:1},e.tenantOrderHolder.extInfo={...e.tenantOrderHolder.extInfo,occupationCodeList:(null==(a=e.tenantOrderHolder.extInfo)?void 0:a.occupationCodeList)||[]},e.tenantOrderInsuredList[0].extInfo={...e.tenantOrderInsuredList[0].extInfo,occupationCodeList:(null==(n=e.tenantOrderInsuredList[0].extInfo)?void 0:n.occupationCodeList)||[]},e.tenantOrderInsuredList[0].tenantOrderBeneficiaryList=e.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.map((e=>{var t;const a=e;return a.extInfo={...a.extInfo,occupationCodeList:(null==(t=a.extInfo)?void 0:t.occupationCodeList)||[]},a})),e.tenantOrderAttachmentList.forEach((e=>{e.category===P.OBVERSE_CERT?e.objectType===H.HOLDER?(ke.value[0]=e.uri,Pe.value[0]=e.id):e.objectType===H.INSURED&&(Ae.value[0]=e.uri,He.value[0]=e.id):e.category===P.REVERSE_CERT&&(e.objectType===H.HOLDER?(ke.value[1]=e.uri,Pe.value[1]=e.id):e.objectType===H.INSURED&&(Ae.value[1]=e.uri,Pe.value[1]=e.id))})),Object.assign(Re.value,e)}})).finally((()=>{Ne.isLoading=!1})),E({pageCode:"infoCollection",templateId:v}).then((({code:e,data:t})=>{if("10000"===e){const e={BENEFICIARY:[],INSURER:[],HOLDER:[]};t.productInsureFactorList.forEach((t=>{(e[t.moduleType]=e[t.moduleType]||[]).push(t)})),oe.value=e}}))})),n([()=>Re.value.tenantOrderInsuredList[0].relationToHolder,()=>Re.value.tenantOrderHolder],(()=>{`${Re.value.tenantOrderInsuredList[0].relationToHolder}`===W.SELF&&Object.assign(Re.value.tenantOrderInsuredList[0],Re.value.tenantOrderHolder,{id:Re.value.tenantOrderInsuredList[0].id,extInfo:{...Re.value.tenantOrderHolder.extInfo,insureProvinceCode:Re.value.tenantOrderInsuredList[0].extInfo.insureProvinceCode,insureCityCode:Re.value.tenantOrderInsuredList[0].extInfo.insureCityCode,insureAreaCode:Re.value.tenantOrderInsuredList[0].extInfo.insureAreaCode}})}),{deep:!0,immediate:!0}),(e,t)=>{const a=_,n=N,p=j,v=D,m=B,I=O,y=w,L=g,C=S,b=T("ProPageWrap");return r(),i(b,{class:"page-info-wrapper"},{default:d((()=>{var e,O,b,h,x;return[R(Ne).isLoading?V("",!0):(r(),i(C,{key:0,ref_key:"formRef",ref:Ve},{default:d((()=>[l(a,{title:"投保人"},{default:d((()=>[l(Z,{images:ke.value,"onUpdate:images":t[0]||(t[0]=e=>ke.value=e),"form-info":Re.value.tenantOrderHolder,"factor-list":oe.value.HOLDER,prefix:"holder"},null,8,["images","form-info","factor-list"])])),_:1}),l(a,{title:"被保人"},{default:d((()=>[l(p,{modelValue:Re.value.tenantOrderInsuredList[0].relationToHolder,"onUpdate:modelValue":t[2]||(t[2]=e=>Re.value.tenantOrderInsuredList[0].relationToHolder=e),label:"为谁保单",name:"relationToHolder",placeholder:"请选择"},{input:d((()=>[l(n,{modelValue:Re.value.tenantOrderInsuredList[0].relationToHolder,"onUpdate:modelValue":t[1]||(t[1]=e=>Re.value.tenantOrderInsuredList[0].relationToHolder=e),options:R(z)},null,8,["modelValue","options"])])),_:1},8,["modelValue"]),1!=+Re.value.tenantOrderInsuredList[0].relationToHolder?(r(),i(Z,{key:0,images:Ae.value,"onUpdate:images":t[3]||(t[3]=e=>Ae.value=e),"form-info":Re.value.tenantOrderInsuredList[0],"factor-list":oe.value.INSURER||[],prefix:"insure"},null,8,["images","form-info","factor-list"])):V("",!0),l(v,{modelValue:Re.value.tenantOrderInsuredList[0].extInfo.insureAreaCode,"onUpdate:modelValue":t[4]||(t[4]=e=>Re.value.tenantOrderInsuredList[0].extInfo.insureAreaCode=e),field1:Re.value.tenantOrderInsuredList[0].extInfo.insureProvinceCode,"onUpdate:field1":t[5]||(t[5]=e=>Re.value.tenantOrderInsuredList[0].extInfo.insureProvinceCode=e),field2:Re.value.tenantOrderInsuredList[0].extInfo.insureCityCode,"onUpdate:field2":t[6]||(t[6]=e=>Re.value.tenantOrderInsuredList[0].extInfo.insureCityCode=e),field3:Re.value.tenantOrderInsuredList[0].extInfo.insureAreaCode,"onUpdate:field3":t[7]||(t[7]=e=>Re.value.tenantOrderInsuredList[0].extInfo.insureAreaCode=e),label:"投保地区",name:"insureAreaCode",placeholder:"请选择","is-link":"",required:"","data-source":R(de),mapping:{label:"name",value:"code",children:"children"}},null,8,["modelValue","field1","field2","field3","data-source"])])),_:1}),l(a,{title:"受益人"},{default:d((()=>[l(p,{modelValue:Re.value.tenantOrderInsuredList[0].insuredBeneficiaryType,"onUpdate:modelValue":t[9]||(t[9]=e=>Re.value.tenantOrderInsuredList[0].insuredBeneficiaryType=e),label:"受益人类型",name:"insuredBeneficiaryType",placeholder:"请选择"},{input:d((()=>[l(n,{modelValue:Re.value.tenantOrderInsuredList[0].insuredBeneficiaryType,"onUpdate:modelValue":t[8]||(t[8]=e=>Re.value.tenantOrderInsuredList[0].insuredBeneficiaryType=e),options:R(Q)},null,8,["modelValue","options"])])),_:1},8,["modelValue"]),2==Re.value.tenantOrderInsuredList[0].insuredBeneficiaryType?(r(),s("div",se,[(r(!0),s(f,null,u(Re.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList,((e,a)=>(r(),s("div",{key:e.beneficiaryId||e.id,class:"beneficiary-item"},[o("div",ue,[o("span",ce,c(`受益人${a+1}`),1),l(m,{name:"delete",onClick:t=>{return a=e,void(Re.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList=Re.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.filter((e=>e.beneficiaryId!==a.beneficiaryId||a.id!==e.id)));var a}},{default:d((()=>[fe])),_:2},1032,["onClick"])]),l(Z,{images:_e.value,"onUpdate:images":t[10]||(t[10]=e=>_e.value=e),"form-info":e,"factor-list":oe.value.BENEFICIARY||[],prefix:`beneficiary-${a}`,"beneficiary-list":Re.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList},null,8,["images","form-info","factor-list","prefix","beneficiary-list"])])))),128)),l(I,{onClick:Ue},{default:d((()=>[pe])),_:1})])):V("",!0)])),_:1}),l(a,{title:"保单通讯信息"},{default:d((()=>{var e;return[(null==(e=Object.keys(R(De)))?void 0:e.length)?(r(),i(L,{key:1,title:"单元格","is-link":"",onClick:t[12]||(t[12]=e=>R(re)(!0))},{title:d((()=>[o("div",me,[o("p",null,[o("span",Ie,c(R(De).contactName),1),o("span",Oe,c(R(De).contactPhoneNo),1)]),o("p",ye,c(R(De).contactAddress),1)])])),_:1})):(r(),i(y,{key:0,activated:"",onClick:t[11]||(t[11]=e=>R(re)(!0))},{default:d((()=>[ve])),_:1}))]})),_:1})])),_:1},512)),o("div",Le,[o("div",Ce,[o("div",be,[he,o("span",xe,"￥"+c(null==(x=null==(h=null==(b=null==(O=null==(e=Re.value.tenantOrderInsuredList)?void 0:e[0])?void 0:O.tenantOrderProductList)?void 0:b[0].premium)?void 0:h.toLocaleString)?void 0:x.call(h)),1)]),Ee]),o("div",ge,[l(I,{block:"",type:"primary",onClick:we},{default:d((()=>[Te])),_:1})])]),R(ne)?(r(),i(le,{key:1,modelValue:R(Ne).currentAddress,"onUpdate:modelValue":t[13]||(t[13]=e=>R(Ne).currentAddress=e),show:R(ne),"data-source":R(je),onSubmit:Se,onClose:t[14]||(t[14]=e=>R(re)(!1))},null,8,["modelValue","show","data-source"])):V("",!0)]})),_:1})}}});export{Re as default};
