import{d as e,j as a,k as l,z as s,o as i,m as o,w as n,a as r,e as d,u,b as t,V as c,W as v,ch as m,ci as f,cj as p,ck as h,cl as y,aB as g,ao as b,cm as S,i as k,h as C,a6 as V,aj as q,O as j,c as w,f as x,F as M,a8 as I,cn as L,bU as $,co as _,cp as O,bY as U,T as E,bw as P,bs as F,aL as N,a9 as T,aa as D,bp as R,ag as A}from"./index-cdaa140a.js";import{n as B}from"./nextStep-faf8ad1d.js";import{c as H}from"./format-b5e9d8b9.js";import{g as Y,m as z}from"./trial-2eb9b511.js";import{p as G}from"./utils-9b0a2f4a.js";import{u as W}from"./useOrder-aedde4eb.js";import{M as J,P as K,a as Q,B as Z}from"./constants-4b08cf92.js";import{d as X,q as ee}from"./verify-bdac398e.js";import"./core-19ec719b.js";import"./utils-e89deedc.js";import"./infoCollection-61892f90.js";import"./trial-8ea1dd07.js";const ae={class:"popup-container"},le={class:"popup-header"},se={class:"title"},ie={class:"popup-body"},oe=e({name:"checkCodePopup"}),ne=e({...oe,props:{show:{type:Boolean,default:!1},type:{default:"agent"},data:{default:()=>({})}},emits:["cancel","confirm"],setup(e,{emit:b}){const S=e,k=a(),C=l((()=>S.show)),V=a({mobile:"",verifyCode:""}),q=l((()=>S.type)),j=a({holder:{type:"投保人",name:"",mobile:"",desc:""},agent:{type:"代理人",name:"",mobile:"",desc:"色卡上会计核算看回放独守空房还是空巅峰计划收款方"},insured:{type:"被保人",name:"",mobile:"",desc:""}}),w=()=>{b("cancel")},x=()=>{k.value.validate().then((()=>{b("confirm")}))};return s([()=>S.data,S.type],(([e,a])=>{var l,s,i;e&&(Object.assign(j.value.holder,e.holder),Object.assign(j.value.insured,null==(l=null==e?void 0:e.insuredList)?void 0:l[0]),V.value.mobile=null==(i=null==(s=j.value)?void 0:s[S.type])?void 0:i.mobile)}),{immediate:!0,deep:!0}),(e,a)=>{const l=p,s=h,b=y,S=g;return i(),o(S,{show:C.value,"onUpdate:show":a[2]||(a[2]=e=>C.value=e),class:"popup-check-mobile",closeable:!1,"close-on-click-overlay":!1},{default:n((()=>[r("div",ae,[r("div",le,[r("span",{class:"clear-all",onClick:w}," 取消 "),r("span",se,d(`${j.value[q.value].type}手机号验证`),1),r("span",{class:"close",onClick:x},"确认")]),r("div",ie,[r("h3",null,d(`尊敬的${j.value[q.value].type}:${j.value[q.value].name}`),1),r("p",null,d(j.value[q.value].desc),1),r("h3",null,d(`${j.value[q.value].type}手机号验证 ${u(H)(j.value[q.value].mobile||"")}`),1),t(b,{ref_key:"formRef",ref:k,"validate-method":"toast",model:V.value},{default:n((()=>[c(t(l,{modelValue:V.value.mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>V.value.mobile=e),label:"被保人手机号",name:"mobile",maxlength:"11",rules:[{required:!0,message:"请输入手机号"}]},null,8,["modelValue"]),[[v,!1]]),t(s,{modelValue:V.value.verifyCode,"onUpdate:modelValue":a[1]||(a[1]=e=>V.value.verifyCode=e),"related-name":"mobile",label:" ",maxlength:"6","input-align":"left",placeholder:"请输入验证码",name:"verifyCode",rules:[{required:!0,message:"请输入验证码"}],"send-s-m-s-code":u(m),"check-s-m-s-code":u(f)},null,8,["modelValue","send-s-m-s-code","check-s-m-s-code"])])),_:1},8,["model"])])])])),_:1},8,["show"])}}}),re=b([{label:"签名完成",value:1},{label:"去签名",value:2},{label:"认证失败，请联系内勤人员",value:3}]),de=2,ue=b([{label:"去双录",value:1},{label:"双录完成",value:de},{label:"双录失败",value:3}]);const te={class:"page-verify-wrap"},ce={class:"sign-list"},ve={class:"inner-cell"},me={class:"inner-cell"},fe={class:"inner-cell"},pe={class:"inner-cell"},he={class:"footer-button"},ye=e({name:"verify"}),ge=e({...ye,setup(e){const s=S(),d=k(),c=C(),{orderNo:v,tenantId:m}=d.query,g=a(!1),b=a(),H=a(),ae=a({holderMobile:"",holderVerifyCode:"",insuredMobile:"",insuredVerifyCode:""}),le=W(),se=a(!1),ie=a({sign:[],verify:[],scribing:""}),oe=a({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{},verifyStatus:2},agent:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2}}),ye=a("agent"),ge=l((()=>e=>ie.value.sign.includes(e)||ie.value.verify.includes(e))),be=l((()=>oe.value.agent.verifyStatus!==V.YES)),Se=l((()=>{const{insuredList:e}=le.value||{},{age:a,relationToHolder:l}=e[0]||{};return!(a<18||`${l}`===q.CERT)})),ke=l((()=>e=>oe.value[e].isSign||oe.value[e].isVerify)),Ce=l((()=>e=>oe.value[e].isShareSign)),Ve=e=>{var a;const{holder:l,insured:s}=le.value;let i={name:l.name,gender:`${L[l.gender]}士`};"insured"===e&&(i={name:null==s?void 0:s[0].name,gender:`${L[null==(a=null==s?void 0:s[0])?void 0:a.gender]}士`}),$({messageType:J.HOLDER,orderNo:v,tenantId:m}),_({shareType:0,title:`${O.sign.title}（${U[e.toLocaleUpperCase()]}）`,desc:O.sign.desc.replace("{name}",`${i.name||""}${i.gender||""},代理人`),url:`${window.location.href}&objectType=${e}&nextPageCode=infoPreview`.replace("/verify","/phoneVerify"),imageUrl:"https://zatech-aquarius-v2-private-test.oss-cn-hangzhou.aliyuncs.com/lian_logo.png?OSSAccessKeyId=LTAI5t9uBW78vZ4sm5i3oQ5C&Expires=1697288114&Signature=S87PMeDRxltLovmmHVTeiHoew1c%3D"})},qe=e=>{ye.value=e,"agent"!==e?be.value||(se.value=!0):c.push({path:K.agentSign,query:d.query})},je=()=>{be.value||b.value===de||X(le.value).then((({code:e,data:a})=>{"10000"===e&&a&&E("双录已完成")}))},we=()=>{se.value=!1},xe=()=>{let e="";e="agent"===ye.value?K.infoPreview:(ye.value,oe.value[ye.value].isVerify?K.verifyFace:K.infoPreview),s.set(`${P}_orderDetail`,le.value),c.push({path:e,query:{...d.query,objectType:ye.value,isFirst:1}})},Me=async()=>{var e;const{holder:a,insuredList:l,extInfo:s}=le.value;if(g.value){if(s.agentAuthFlag!==V.YES)return void E("代理人签名未完成")}else{if(s.agentAuthFlag===V.NO)return void E("代理人签名未完成");if(a.isCert===V.NO)return void E("投保人签名未完成");if(l[0].isCert===V.NO)return void E("被保人签名未完成")}await(null==(e=H.value)?void 0:e.validate());const i=Object.assign(le.value,{extInfo:{...le.value.extInfo,pageCode:Q.SIGN,buttonCode:Z.SIGN}});B(i,((e,a)=>{a===N.JUMP_PAGE&&T(e.nextPageCode,d.query)}),d)};return j((()=>{(async()=>{let e={};ee({orderNo:v,tenantId:m}).then((({code:e,data:a})=>{if("10000"===e){const{doubleRecordFlag:e,doubleRecordStatus:l}=a;g.value=e===V.YES,b.value=l}})),await Y({orderNo:v,tenantId:m}).then((({code:a,data:l})=>{var s,i,o;if("10000"===a){Object.assign(le.value,l);const{agentAuthFlag:a}=l.extInfo,{mobile:n}=l.holder,{mobile:r}=(null==(s=l.insuredList)?void 0:s[0])||{};Object.assign(ae.value,{holderMobile:n,insuredMobile:r}),e=G(l.insuredList[0].productList),oe.value.agent.verifyStatus=a,oe.value.holder.verifyStatus=l.holder.isCert,oe.value.insured.verifyStatus=null==(o=null==(i=l.insuredList)?void 0:i[0])?void 0:o.isCert}})),await z(e).then((({data:e,code:a})=>{if("10000"===a){const{signInfo:a}=F(e.productFactor);a.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((a=>{e.required&&ie.value.sign.push(a.code),"1"===a.code?oe.value.agent.isSign=!0:"2"===a.code?oe.value.holder.isSign=!0:"3"===a.code?oe.value.insured.isSign=!0:"4"===a.code?oe.value.holder.isShareSign=!0:"5"===a.code&&(oe.value.insured.isShareSign=!0)})),"customerFace"===e.name&&e.columns.forEach((a=>{e.required&&ie.value.verify.push(a.code),"1"===a.code?oe.value.holder.isVerify=!0:"2"===a.code&&(oe.value.insured.isVerify=!0)}))}))}}))})()})),(e,a)=>{const l=D,s=R,d=A;return i(),w("div",te,[t(l),r("div",ce,[u(ke)("agent")?(i(),o(s,{key:0,title:"代理人签名",required:u(ge)("agent")},{value:n((()=>[r("div",ve,[t(s,{"is-link":"",value:u(re)[u(oe).agent.verifyStatus],onClick:a[0]||(a[0]=e=>qe("agent"))},null,8,["value"])])])),_:1},8,["required"])):x("",!0),u(g)?(i(),o(u(y),{key:2,ref_key:"formRef",ref:H,"validate-method":"toast",model:u(ae)},{default:n((()=>[t(u(p),{modelValue:u(ae).holderMobile,"onUpdate:modelValue":a[5]||(a[5]=e=>u(ae).holderMobile=e),label:"投保人手机号",name:"holderMobile",maxlength:"11",required:"","is-view":""},null,8,["modelValue"]),t(u(h),{modelValue:u(ae).holderVerifyCode,"onUpdate:modelValue":a[6]||(a[6]=e=>u(ae).holderVerifyCode=e),"related-name":"holderMobile",label:"验证码",maxlength:"6",name:"holderVerifyCode","send-s-m-s-code":e.sendSMSCode,"check-s-m-s-code":u(f),required:""},null,8,["modelValue","send-s-m-s-code","check-s-m-s-code"]),u(Se)?(i(),w(M,{key:0},[t(u(p),{modelValue:u(ae).insuredMobile,"onUpdate:modelValue":a[7]||(a[7]=e=>u(ae).insuredMobile=e),label:"被保人手机号",name:"insuredMobile",maxlength:"11",required:"","is-view":""},null,8,["modelValue"]),t(u(h),{modelValue:u(ae).insuredVerifyCode,"onUpdate:modelValue":a[8]||(a[8]=e=>u(ae).insuredVerifyCode=e),label:"验证码",maxlength:"6",name:"insuredVerifyCode","related-name":"insuredMobile","send-s-m-s-code":e.sendSMSCode,"check-s-m-s-code":u(f),required:""},null,8,["modelValue","send-s-m-s-code","check-s-m-s-code"])],64)):x("",!0)])),_:1},8,["model"])):(i(),w(M,{key:1},[u(ke)("holder")?(i(),o(s,{key:0,title:"投保人签名",required:u(ge)("holder")},{value:n((()=>[r("div",me,[u(Ce)("holder")?(i(),o(s,{key:0,"value-class":""+(u(be)?"disable":""),"is-link":"",value:"分享空签邀约",onClick:a[1]||(a[1]=e=>Ve("holder"))},null,8,["value-class"])):x("",!0),t(s,{"is-link":"",value:u(re)[u(oe).holder.verifyStatus],"value-class":""+(u(be)?"disable":""),onClick:a[2]||(a[2]=e=>qe("holder"))},null,8,["value","value-class"])])])),_:1},8,["required"])):x("",!0),u(ke)("insured")&&u(Se)?(i(),o(s,{key:1,title:"被保人签名",required:u(ge)("insured")},{value:n((()=>[r("div",fe,[u(Ce)("insured")?(i(),o(s,{key:0,"value-class":""+(u(be)?"disable":""),"is-link":"",value:"分享空签邀约",onClick:a[3]||(a[3]=e=>Ve("insured"))},null,8,["value-class"])):x("",!0),t(s,{"is-link":"","value-class":""+(u(be)?"disable":""),value:u(re)[u(oe).insured.verifyStatus],onClick:a[4]||(a[4]=e=>qe("insured"))},null,8,["value-class","value"])])])),_:1},8,["required"])):x("",!0)],64)),u(g)?(i(),o(s,{key:3,title:"保单双录",required:""},{value:n((()=>[r("div",pe,[t(s,{"is-link":"","value-class":""+(u(be)?"disable":""),value:u(ue)[u(b)],onClick:je},null,8,["value-class","value"])])])),_:1})):x("",!0)]),r("div",he,[t(d,{type:"primary",onClick:Me},{default:n((()=>[I("下一步")])),_:1})]),u(se)?(i(),o(ne,{key:0,type:u(ye),show:u(se),data:u(le),onCancel:we,onConfirm:xe},null,8,["type","show","data"])):x("",!0)])}}});export{ge as default};
