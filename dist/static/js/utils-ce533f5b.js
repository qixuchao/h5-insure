import{d as O}from"./vendor-d350434b.js";import{I as B,R as F,g as S}from"./infoCollection-a3c0529c.js";import{b as x,a as U,R as D,i as M}from"./trial-38a8e06c.js";import{a6 as A,K as p,C as h,J as T,a3 as K}from"./index-3cda190c.js";const W=e=>{const{tenantId:t,riskList:i,riskPremium:n,productId:a}=e;return i.map(r=>{var o;return{tenantId:t,amountUnit:1,annuityDrawFrequency:r.annuityDrawDate,annuityDrawType:r.annuityDrawType,paymentFrequency:r.paymentFrequency,paymentPeriod:r.chargePeriod.split("_")[1],paymentPeriodType:x[r.chargePeriod.split("_")[0]],insurancePeriodType:U[r.coveragePeriod==="to_life"?"to_life":r.coveragePeriod.split("_")[0]],insurancePeriodValue:Number.isNaN(+r.coveragePeriod.split("_")[1])?0:r.coveragePeriod.split("_")[1],riskCode:r.riskCode,riskType:r.riskType,riskName:r.riskName,extInfo:{riskId:r.riskId,copy:r.copy},initialPremium:(o=n[r.riskCode])==null?void 0:o.premium,liabilityDetails:r.liabilityVOList.map(s=>({liabilityCode:s.liabilityCode,liabilityName:s.liabilityName,refundMethod:s.liabilityAttributeValue})),productId:a,currentAmount:r.amount,initialAmount:r.amount}})},ee=e=>{const t=e.find(a=>a.riskType===D.MAIN_RISK),i=e.filter(a=>a.riskType===D.RIDER_RISK),n=a=>a.map(r=>{const{riskCategory:l,riskCode:o,riskType:s,id:d,riskInsureLimitVO:m,riskCalcMethodInfoVO:c}=r,{annuityDrawFrequencyList:u,annuityDrawValueList:y,insurancePeriodValueList:I,paymentFrequencyList:f,paymentPeriodValueList:C}=m,{minCopy:V,maxCopy:N,fixedAmount:g,singeAmount:k}=c;return{amount:g||k,annuityDrawDate:y==null?void 0:y[0],annuityDrawFrequency:u==null?void 0:u[0],chargePeriod:C==null?void 0:C[0],copy:V||N||0,coveragePeriod:I==null?void 0:I[0],liabilityVOList:r.riskLiabilityInfoVOList,mainRisk:r.riskCode===t.riskCode,mainRiskCode:r.riskCode===t.riskCode?t.riskCode:void 0,mainRiskId:r.riskCode===t.riskCode?t.riskId:void 0,paymentFrequency:f==null?void 0:f[0],riderRisk:!0,riderRiskVOList:n(i),riskCategory:l,riskCode:o,riskId:d,riskType:s}});return n([t])},P=(e,t,i=[],n=S.YEAR,a=!1)=>{const r=e.filter(o=>{try{return o.extraInfo?JSON.parse(o.extraInfo).packageCode?!!i.includes(o.id):!0:!1}catch{return!1}});console.log("lastRiskList",r);const l=r.find(o=>o.riskType===D.MAIN_RISK);return r.map(o=>{const{riskInsureLimitVO:s,riskCategory:d,id:m,riskType:c,riskName:u,riskCode:y,extraInfo:I,riskLiabilityInfoVOList:f,riskCalcMethodInfoVO:C}=o,{insurancePeriodType:V,insurancePeriodValueList:N,paymentFrequencyList:g,paymentPeriodValueList:k,paymentPeriodType:$,annuityDrawFrequencyList:L,annuityDrawValueList:b,insurancePeriodRule:H,paymentPeriodRule:q}=s,{fixedAmount:v,minCopy:w}=C,R={amount:v,riskCode:y,riskId:m,riskName:u,paymentFrequency:(g==null?void 0:g[0])||S.YEAR,extraInfo:I,chargePeriod:k==null?void 0:k[0],annuityDrawDate:b==null?void 0:b[0],riskType:c,annuityDrawFrequency:L==null?void 0:L[0],copy:w,coveragePeriod:N==null?void 0:N[0],insuredCode:t==null?void 0:t.insurerCode,liabilityVOList:f,riskCategory:d};return c===D.MAIN_RISK?R:(H===M.ONE_YEAR&&(R.coveragePeriod="year_1"),q===M.ONE_YEAR&&(R.chargePeriod="year_1"),{...R,mainRiskId:l==null?void 0:l.id,mainRiskCode:l==null?void 0:l.riskCode})})},re=e=>{var i,n,a;return{orderAmount:e.premium,tenantId:e.tenantId,venderCode:(i=e.detail)==null?void 0:i.insurerCode,applicationNo:e.applicationNo,policyNo:e.policyNo,orderDataSource:"1",saleUserId:e.saleUserId,saleChannelId:e.saleChannelId,orderCategory:e.orderCategory,orderStatus:e.orderStatus,orderTopStatus:e.orderTopStatus,tenantOrderHolder:{tenantId:e.tenantId,name:e.holder.name,certNo:e.holder.certNo,certType:h.CERT,mobile:e.holder.mobile,birthday:p(e.holder.certNo),gender:T(e.holder.certNo),extInfo:{hasSocialInsurance:e.holder.socialFlag}},extInfo:{extraInfo:{renewalDK:e.renewalDK,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,successJumpUrl:e.successJumpUrl},iseeBizNo:e.iseeBizNo},tenantOrderInsuredList:[{tenantId:e.tenantId,relationToHolder:e.insured.relationToHolder,certNo:e.insured.certNo,certType:h.CERT,name:e.insured.name,mobile:e.insured.relationToHolder===F.SELF?e.holder.mobile:"",birthday:p(e.insured.certNo),gender:T(e.insured.certNo),extInfo:{hasSocialInsurance:e.insured.socialFlag},tenantOrderProductList:[{tenantId:e.tenantId,productCode:(n=e.detail)==null?void 0:n.productCode,productName:(a=e.detail)==null?void 0:a.productName,premium:e.premium,tenantOrderRiskList:e.tenantOrderRiskList}]}]}},_=(e,t)=>{if(!e)return"";const[i,n]=e.split("_"),a=parseInt(n,10);return i==="day"?O(t).add(a,"day").format("YYYY-MM-DD"):O(t).add(a,"year").format("YYYY-MM-DD")},E=(e,t=O().format("YYYY-MM-DD"))=>O(e).diff(t,"day"),z=(e,t,i)=>{const n=_(e,i),a=_(t,i);return E(n)<=1&&E(a)>=0},te=e=>{const{riskCode:t,liabilityCode:i,birth:n,sex:a}=e,r=_("max_18",n);return console.log("lastDate",r),console.log("diffDate(lastDate)",E(r)),!(t==="7Y7"&&i==="FXG086"&&!(a===K.FEMALE&&E(r)<=0))},Y=(e,t,i=n=>!0)=>{const n=p(t),a=T(t),r=[];return e.forEach(l=>{const{riskDetailVOList:o}=l,s=o.map(d=>{const{maxHolderAge:m,minHolderAge:c}=d.riskInsureLimitVO;return z(c,m,n)?(d.riskLiabilityInfoVOList=d.riskLiabilityInfoVOList.filter(u=>i({riskCode:d.riskCode,liabilityCode:u.liabilityCode,birth:n,sex:a})),d):null});r.push({riskDetailVOList:s.filter(d=>!!(d&&d.riskLiabilityInfoVOList.length>0))})}),r},ie=(e,t=!1,i=n=>!0)=>{var r,l,o;let n=[];if(t)n=P((l=(r=Y(A(e.insureDetail.productRiskVoList),e.insured.certNo,i))==null?void 0:r[0])==null?void 0:l.riskDetailVOList,e.productDetail,[],e.paymentFrequency,t);else{const s=Y(A(e.insureDetail.productRiskVoList),e.insured.certNo,i);console.log("===result",[...s]),n=s.map(d=>P(d.riskDetailVOList,e.productDetail,e.packageRiskIdList,e.paymentFrequency,t))}return{calcData:{holder:{personVO:{birthday:p(e.holder.certNo),certType:h.CERT,certNo:e.holder.certNo,gender:Number(T(e.holder.certNo)),mobile:e.holder.mobile,name:e.holder.name,socialFlag:e.holder.socialFlag}},insuredVOList:[{insuredCode:(o=e.productDetail)==null?void 0:o.insurerCode,relationToHolder:e.insured.relationToHolder,personVO:{birthday:p(e.insured.certNo),certType:h.CERT,certNo:e.insured.certNo,gender:Number(T(e.insured.certNo)),name:e.insured.name,socialFlag:e.insured.socialFlag},productPlanVOList:[{riskVOList:n.flat()}]}],productCode:e.productDetail.productCode,tenantId:e.tenantId},riskVOList:n.flat()}},ne=e=>e&&e.length?e.filter(i=>i.value===B.INSURE).map(i=>i.productRiskVoList.map(n=>n.id)).flat():[],ae=e=>{let t=(Math.round(parseFloat(e.toString())*100)/100).toString();const i=t.toString().split(".");return i.length===1?(t=`${t.toString()}.00`,t):i.length>1?(i[1].length<2&&(t=`${t.toString()}0`),t):e},oe=(e,t="year")=>O().diff(p(e),t,!0),J=e=>!e||Number.isNaN(+e.split("_")[1])?0:e==null?void 0:e.split("_")[1],X=e=>{const{tenantId:t,riskList:i,riskPremium:n,productId:a}=e;return i.map(r=>{var o,s,d,m,c;return{tenantId:t,amountUnit:1,annuityDrawFrequency:r.annuityDrawDate,annuityDrawType:r.annuityDrawType,paymentFrequency:r.paymentFrequency,paymentPeriod:0,paymentPeriodType:(o=x)==null?void 0:o[r.chargePeriod],insurancePeriodType:U[r.coveragePeriod==="to_life"?"to_life":(d=(s=r.coveragePeriod)==null?void 0:s.split("_"))==null?void 0:d[0]],insurancePeriodValue:J(r.coveragePeriod),riskCode:r.riskCode,riskType:r.riskType,riskName:r.riskName,extInfo:{riskId:r.riskId,copy:r.copy},initialPremium:(m=n[r.riskCode])==null?void 0:m.premium,liabilityDetails:(c=r.liabilityVOList)==null?void 0:c.map(u=>({liabilityCode:u.liabilityCode,liabilityName:u.liabilityName,refundMethod:u.liabilityAttributeValue})),productId:a,currentAmount:r.amount,initialAmount:r.amount}})},se=e=>{var i,n,a,r;return console.log(e,"freeTransform"),{orderAmount:0,tenantId:e.tenantId,venderCode:e.insureDetail.productBasicInfoVO.insurerCode,orderDataSource:"1",saleUserId:e.saleUserId,saleChannelId:e.saleChannelId,orderCategory:"1",tenantOrderHolder:{tenantId:e.tenantId,certType:e.order.tenantOrderHolder.certEndType,...e.order.tenantOrderHolder},extInfo:{...e.extInfo,templateId:2,buttonCode:e.buttonCode,pageCode:e.pageCode,iseeBizNo:e.iseeBizNo},tenantOrderInsuredList:[{...e.order.tenantOrderInsuredList[0],tenantId:e.tenantId,certType:e.order.tenantOrderInsuredList[0].certEndType,mobile:e.order.tenantOrderInsuredList[0].relationToHolder===F.SELF?e.order.tenantOrderHolder.mobile:"",tenantOrderProductList:[{tenantId:e.tenantId,productCode:(i=e.insureDetail)==null?void 0:i.productBasicInfoVO.productCode,productName:(n=e.insureDetail)==null?void 0:n.productBasicInfoVO.productName,premium:0,tenantOrderRiskList:X({tenantId:e.tenantId,riskList:P(e.insureDetail.productRiskVoList[0].riskDetailVOList,e.detail),riskPremium:{},productId:(a=e.detail)==null?void 0:a.id})}]}],operateOption:(r=e.order)==null?void 0:r.operateOption}};export{re as a,oe as b,ae as c,se as f,ie as g,ne as o,ee as r,W as t,te as v};
