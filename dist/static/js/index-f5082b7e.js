import{T as e,d as a,j as l,k as s,z as n,cG as t,cH as u,o as i,c as o,a as r,g as v,u as d,f as c,b as g,w as p,a8 as m,e as f,F as h,q as S,m as y,cI as w,p as _,_ as b,cJ as k,ai as V,c9 as C}from"./index-92d58610.js";var A=e;const T={class:"sign-wrap"},U=["src"],x={class:"popup-body"},I={class:"sign-container-wrap"},R={class:"operate-bar"},j=a({name:"sign"});var z=b(a({...j,props:{option:{default:{}},modelValue:{default:()=>[]},signString:{default:"房间卡贺卡和大伙副书记环境发好"},signAccount:{default:3}},emits:["update:modelValue","submitSign"],setup(e,{expose:a,emit:b}){const j=e,z=l(!1),E=l(),N=l([]),q=l(0),D=s((()=>{if(j.signString&&j.signString.length>=j.signAccount){const e=[];let a=0;for(let l=0;l<=j.signString.length;l++)!l||l%j.signAccount||(a+=1),j.signString[l]&&(e[a]?e[a]+=j.signString[l]:e[a]=j.signString[l]);return e}return[j.signString||""]})),F=s((()=>{var e;const a=N.value.filter((e=>e));return(null==(e=D.value)?void 0:e.length)>(null==a?void 0:a.length)})),G=l(!0),H=l(),J=()=>{0!==q.value&&H.value&&(q.value-=1,H.value.swipeTo(q.value))},L=e=>{z.value=!0,e||setTimeout((()=>{var e;E.value&&((E.value||[]).forEach(((e,a)=>{var l,s;null==(s=e.setDataURL)||s.call(e,(null==(l=N.value)?void 0:l[a])||"")})),(null==(e=j.modelValue)?void 0:e.length)?G.value=!1:G.value=!0)}),200)},$=()=>{k({images:N.value,className:"customer-sign-preview"})},B=()=>{z.value=!1},K=()=>{if(q.value===D.value.length-1)return;q.value,j.signAccount;D.value[q.value].length,H.value&&(q.value+=1,H.value.swipeTo(q.value))},M=()=>{(E.value||[]).forEach(((e,a)=>{var l;a===q.value&&(null==(l=e.clear)||l.call(e))}))},O=()=>{var e,a;(null==(e=N.value)?void 0:e.length)<(null==(a=D.value)?void 0:a.length)?A({message:"请完成签名",className:"toast-vertical"}):(b("update:modelValue",N.value),b("submitSign",N.value),z.value=!1)};return n([()=>j.modelValue,()=>D.value],(()=>{N.value=(j.modelValue||[]).slice(0,D.value.length)}),{immediate:!0,deep:!0}),a({rewrite:M,openSign:L}),(a,l)=>{var s;const n=V,b=t,k=u,A=C;return i(),o(h,null,[r("div",T,[v(a.$slots,"signImg",{data:null==(s=d(N))?void 0:s[0]},(()=>{var a;return[d(N).length?(i(),o("img",{key:0,class:"preview-sign",src:null==(a=d(N))?void 0:a[0],alt:"",onClick:$},null,8,U)):c("",!0),g(n,{type:"primary",round:"",size:"small",onClick:L},{default:p((()=>[m(f(e.signString?"重新签名":"点击签字"),1)])),_:1})]}),!0)]),g(A,{show:d(z),"onUpdate:show":l[1]||(l[1]=e=>_(z)?z.value=e:null),position:"bottom",style:{height:"100%",overflow:"hidden"}},{default:p((()=>[r("div",x,[r("div",I,[g(k,{ref_key:"swipeRef",ref:H,vertical:"",loop:!1,"show-indicators":!1,touchable:!1},{default:p((()=>[(i(!0),o(h,null,S(d(D),((e,a)=>(i(),y(b,{key:a},{default:p((()=>[g(w,{ref_for:!0,ref_key:"signRef",ref:E,modelValue:d(N)[a],"onUpdate:modelValue":e=>d(N)[a]=e,placeholder:e,onStroke:l[0]||(l[0]=e=>G.value=!1),onSignSuccess:K},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1024)))),128))])),_:1},512),r("div",R,[g(n,{type:"primary",class:"btn",disabled:d(F),onClick:O},{default:p((()=>[m("确定")])),_:1},8,["disabled"]),g(n,{type:"primary",plain:"",class:"btn",onClick:J},{default:p((()=>[m("上一页")])),_:1}),g(n,{type:"primary",plain:"",class:"btn",onClick:M},{default:p((()=>[m("重签")])),_:1}),g(n,{type:"default",class:"btn",onClick:B},{default:p((()=>[m("取消")])),_:1})])])])])),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-5dfa327d"]]);export{z as S};
