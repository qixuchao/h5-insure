import{d as e,j as a,i as l,z as s,o as i,l as n,w as o,a as r,e as u,u as t,b as d,V as m,W as v,as as c,an as p,h as f,g as h,O as y,c as g,q as b,F as S,a8 as V,a6 as C,T as k,aC as j,a9 as q,aa as x,bK as L,ap as w,am as I}from"./index-a701edf7.js";import{n as _}from"./nextStep-53012c09.js";import{s as U,_ as O,b as E,d as P,R as $,t as D}from"./index-873f5512.js";import{c as F}from"./format-b5e9d8b9.js";import{g as A,m as N}from"./trial-be4721b4.js";import{p as R}from"./utils-0af605ab.js";import{u as T}from"./useOrder-0f74fb68.js";import{a as z}from"./constants-71331306.js";import"./core-2f757857.js";import"./constant-8927d485.js";import"./keysIn-131bbce9.js";import"./isObjectLike-a9798079.js";import"./_getTag-0507d0b1.js";import"./debounce-6981b306.js";import"./phoneVerify-307a6997.js";import"./merge-e7788e50.js";import"./index-f8d021e2.js";import"./useDicData-c5252af3.js";const B={class:"popup-container"},G={class:"popup-header"},J={class:"title"},K={class:"popup-body"},M=e({name:"checkCodePopup"}),W=e({...M,props:{show:{type:Boolean,default:!1},type:{default:"agent"},data:{default:()=>({})}},emits:["cancel","confirm"],setup(e,{emit:p}){const f=e,h=a((()=>f.show)),y=l({mobile:"",verifyCode:""}),g=a((()=>f.type)),b=l({holder:{type:"投保人",name:"",mobile:"",desc:""},agent:{type:"代理人",name:"李三",mobile:"13262278989",desc:"色卡上会计核算看回放独守空房还是空巅峰计划收款方"},insured:{type:"被保人",name:"",mobile:"",desc:""}}),S=()=>{p("cancel")},V=()=>{p("confirm")};return s([()=>f.data,f.type],(([e,a])=>{var l,s,i;e&&(Object.assign(b.value.holder,e.holder),Object.assign(b.value.insured,null==(l=null==e?void 0:e.insuredList)?void 0:l[0]),y.value.mobile=null==(i=null==(s=b.value)?void 0:s[`${f.type}`])?void 0:i.mobile)}),{immediate:!0,deep:!0}),(e,a)=>{const l=O,s=E,p=P,f=c;return i(),n(f,{show:h.value,"onUpdate:show":a[2]||(a[2]=e=>h.value=e),class:"popup-check-mobile",closeable:!1,"close-on-click-overlay":!1},{default:o((()=>[r("div",B,[r("div",G,[r("span",{class:"clear-all",onClick:S}," 取消 "),r("span",J,u(`${b.value[g.value].type}手机号验证`),1),r("span",{class:"close",onClick:V},"确认")]),r("div",K,[r("h3",null,u(`尊敬的${b.value[g.value].type}:${b.value[g.value].name}`),1),r("p",null,u(b.value[g.value].desc),1),r("h3",null,u(`${b.value[g.value].type}手机号验证 ${t(F)(b.value[g.value].mobile||"")}`),1),d(p,{model:y.value},{default:o((()=>[m(d(l,{modelValue:y.value.mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>y.value.mobile=e),label:"被保人手机号",name:"mobile",maxlength:"11",required:""},null,8,["modelValue"]),[[v,!1]]),d(s,{modelValue:y.value.verifyCode,"onUpdate:modelValue":a[1]||(a[1]=e=>y.value.verifyCode=e),"related-name":"mobile",label:" ",maxlength:"6","input-align":"left",placeholder:"请输入验证码",name:"verifyCode","send-s-m-s-code":t(U),rules:""},null,8,["modelValue","send-s-m-s-code"])])),_:1},8,["model"])])])])),_:1},8,["show"])}}}),H=p([{label:"签名完成",value:1},{label:"去签名",value:2},{label:"认证失败，请联系内勤人员",value:3}]);const Q={class:"page-verify-wrap"},X={key:0,class:"header"},Y={class:"sign-list"},Z={class:"inner-cell"},ee={class:"inner-cell"},ae={class:"footer-button"},le=e({name:"verify"}),se=e({...le,setup(e){const s=f(),u=h(),{orderNo:m,tenantId:v}=s.query,c=l(!1),p=l({holder:{},insuredList:[{}]}),F=T(),B=l(!1),G=l({sign:[],verify:[],scribing:""}),J=l({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{},verifyStatus:2},agent:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2}}),K=l("agent"),M=a((()=>e=>G.value.sign.includes(e)||G.value.verify.includes(e))),le=a((()=>e=>J.value[e].isSign||J.value[e].isVerify)),se=a((()=>e=>J.value[e].isShareSign)),ie=e=>{K.value=e,B.value=!0},ne=()=>{B.value=!1},oe=()=>{let e="";e="agent"===K.value?z.agentSign:"holder"===K.value?(J.value[K.value].isVerify,z.holderSign):(J.value[K.value].isVerify,z.insuredSign),u.push({path:e,query:{...s.query,type:K.value}})},re=()=>{const{holder:e,insuredList:a,extInfo:l}=F.value;[l.agentAuthFlag,e.isCert,a[0].isCert].includes(C.NO)?k("请先完成签名"):_(F.value,((e,a)=>{a===j.JUMP_PAGE&&q(e.nextPageCode,s.query)}))};return y((()=>{(async()=>{let e={};await A({orderNo:m,tenantId:v}).then((({code:a,data:l})=>{var s;"10000"===a&&(Object.assign(F.value,l),p.value=l,e=R(l.insuredList[0].productList),J.value.agent.verifyStatus=l.extInfo.agentAuthFlag,J.value.holder.verifyStatus=l.holder.isCert,J.value.insured.verifyStatus=null==(s=l.extInfo.insured)?void 0:s[0].isCert)})),await N(e).then((({data:e,code:a})=>{if("10000"===a){const{signInfo:a}=D(e.productFactor);a.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((a=>{e.required&&G.value.sign.push(a.code),"1"===a.code?J.value.agent.isSign=!0:"2"===a.code?J.value.holder.isSign=!0:"3"===a.code?J.value.insured.isSign=!0:"4"===a.code?J.value.holder.isShareSign=!0:"5"===a.code&&(J.value.insured.isShareSign=!0)})),"customerFace"===e.name&&e.columns.forEach((a=>{e.required&&G.value.verify.push(a.code),"1"===a.code?J.value.holder.isVerify=!0:"2"===a.code&&(J.value.insured.isVerify=!0)}))}))}}))})()})),(e,a)=>{const l=x,s=L,u=w,m=I;return i(),g("div",Q,[d(l),t(c)?(i(),g("div",X,[d(s,{type:"warning",content:"为保障您的合法权益，当前保单需要进行双录"})])):b("",!0),r("div",Y,[t(le)("agent")?(i(),n(u,{key:0,title:"代理人签名",required:t(M)("agent"),"is-link":"",value:t(H)[t(J).agent.verifyStatus],onClick:a[0]||(a[0]=e=>ie("agent"))},null,8,["required","value"])):b("",!0),t(c)?(i(),n(t(P),{key:2,model:t(p)},{default:o((()=>[d(t(O),{modelValue:t(p).holder.mobile,"onUpdate:modelValue":a[3]||(a[3]=e=>t(p).holder.mobile=e),rules:[{pattern:new RegExp(t($).isPhone)}],label:"投保人手机号",name:"holder.mobile",maxlength:"11",required:""},null,8,["modelValue","rules"]),d(t(E),{modelValue:t(p).holder.verifyCode,"onUpdate:modelValue":a[4]||(a[4]=e=>t(p).holder.verifyCode=e),"related-name":"holder.mobile",label:"验证码",maxlength:"6",name:"holder.verifyCode","send-s-m-s-code":t(U),rules:"",required:""},null,8,["modelValue","send-s-m-s-code"]),d(t(O),{modelValue:t(p).insuredList[0].mobile,"onUpdate:modelValue":a[5]||(a[5]=e=>t(p).insuredList[0].mobile=e),label:"被保人手机号",name:"insuredList.0.mobile",maxlength:"11",required:"",rules:[{pattern:new RegExp(t($).isPhone)}]},null,8,["modelValue","rules"]),d(t(E),{modelValue:t(p).insuredList[0].verifyCode,"onUpdate:modelValue":a[6]||(a[6]=e=>t(p).insuredList[0].verifyCode=e),label:"验证码",maxlength:"6",name:"insuredList.0.verifyCode","related-name":"insuredList.0.mobile","send-s-m-s-code":t(U),required:""},null,8,["modelValue","send-s-m-s-code"])])),_:1},8,["model"])):(i(),g(S,{key:1},[t(le)("holder")?(i(),n(u,{key:0,title:"投保人签名",required:t(M)("holder")},{value:o((()=>[r("div",Z,[t(se)("holder")?(i(),n(u,{key:0,"is-link":"",value:"分享空签邀约"})):b("",!0),d(u,{"is-link":"",value:t(H)[t(J).holder.verifyStatus],onClick:a[1]||(a[1]=e=>ie("holder"))},null,8,["value"])])])),_:1},8,["required"])):b("",!0),t(le)("insured")?(i(),n(u,{key:1,title:"被保人签名",required:t(M)("insured")},{value:o((()=>[r("div",ee,[t(se)("insured")?(i(),n(u,{key:0,"is-link":"",value:"分享空签邀约"})):b("",!0),d(u,{"is-link":"",value:t(H)[t(J).insured.verifyStatus],onClick:a[2]||(a[2]=e=>ie("insured"))},null,8,["value"])])])),_:1},8,["required"])):b("",!0)],64))]),r("div",ae,[d(m,{type:"primary",onClick:re},{default:o((()=>[V("下一步")])),_:1})]),d(W,{type:t(K),show:t(B),data:t(F),onCancel:ne,onConfirm:oe},null,8,["type","show","data"])])}}});export{se as default};
