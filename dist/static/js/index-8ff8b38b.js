import{_ as e,d as a,S as s,r,E as o,am as t,c as l,g as d,F as i,h as u,i as p,f as n,t as c,m as v,aT as m,e as k,w as I,j as f,n as L,aU as h,aF as R,X as y,Y as P,u as b,a as g,aD as V,b as _,aL as j,aV as C,ai as D,y as O,P as w,aO as T,l as U,aW as N,B as x}from"./index-dae3ff12.js";import{A as S}from"./index-18affc0d.js";import{R as E,u as $,P as q}from"./index-bf46b782.js";import{q as F,a as A,b as H}from"./createProposal-1d57feb8.js";import{u as K}from"./useDicData-33c7e9bb.js";import"./pdfh5-008ca364.js";import"./trial-75f9914d.js";import"./index-8907c337.js";import"./index-1a266313.js";import"./trial-b645c7f1.js";const W=e=>(y("data-v-cd47605e"),e=e(),P(),e),Y={class:"com-product-list-wrapper"},B={class:"risk-item-wrapper"},M={class:"content"},X={class:"risk-premium"},z=L(" 保费:"),G={class:"premium"},J={class:"risk-factor"},Q={class:"factor"},Z={class:"factor-value"},ee=W((()=>p("span",{class:"factor-name"}," 保额(元) ",-1))),ae={class:"factor"},se={class:"factor-value"},re=W((()=>p("span",{class:"factor-name"}," 保障期间 ",-1))),oe={class:"factor"},te={class:"factor-value"},le=W((()=>p("span",{class:"factor-name"}," 缴费期间 ",-1))),de={class:"operate-bar"},ie=L("删除"),ue=W((()=>p("span",{class:"btn-plus"},"+",-1))),pe=L(" 附加险"),ne=L("修改"),ce={key:0,class:"premium-total"},ve=L(" 保费: "),me={class:"premium"};var ke=e(a({props:{productRiskList:{default:()=>[]},productInfo:{default:()=>({})},productData:{default:()=>({})},pickProductPremium:{type:Function,default:()=>{}},productNum:{default:0}},emits:["deleteRisk","updateRisk","addRiderRisk"],setup(e,{emit:a}){const L=e,[y,P]=s(),b=r({checkedList:[],disabledList:[],riderRiskList:[],mainRiskData:{},totalPremium:0,currentRiskRecord:{},productRiskList:[]}),g=K("RISK_PAYMENT_PERIOD"),V=K("RISK_INSURANCE_PERIOD"),_=o((()=>{var e,a;return(null==(a=null==(e=L.productData)?void 0:e.productRiskVoList)?void 0:a[0].riskDetailVOList.filter((e=>1===e.collocationType)))||[]})),j=o((()=>{var e,a;const s=L.productRiskList.map((e=>e.riskId)),r=((null==(a=null==(e=L.productData)?void 0:e.productRiskVoList)?void 0:a[0].riskDetailVOList)||[]).filter((e=>s.includes(e.id)&&1===e.collocationType));return _.value.length-r.length})),C=o((()=>e=>{var a,s;const r=(null==(s=null==(a=L.productData)?void 0:a.productRiskVoList)?void 0:s[0].riskDetailVOList.find((a=>a.id!==e)))||{};let o=!1;return o=!!L.productNum||2===r.riskType&&1===r.collocationType,o})),D=o((()=>{var e,a;return(null==(a=null==(e=L.productData)?void 0:e.productRiskVoList)?void 0:a[0].riskDetailVOList.find((e=>1===e.riskType)))||{}})),O=o((()=>D.value.collocationVOList||[])),w=(e,s)=>{const r=e.map((e=>e.id)).filter((e=>!b.value.disabledList.includes(e)));a("addRiderRisk",r,L.productInfo)};return t((()=>L.productInfo),(e=>{var a;let s=0;(e.proposalProductRiskList||[]).forEach((e=>{s+=e.premium})),null==(a=L.pickProductPremium)||a.call(L,{[`${e.productId}`]:s}),b.value.totalPremium=s}),{deep:!0,immediate:!0}),t((()=>L.productRiskList),(e=>{const a=[],s=[],r=[];(e||[]).forEach((e=>{1===e.riskType?a.unshift(e):(s.push(e.riskId),r.push(e.riskId),a.push(e))})),b.value.disabledList=s,b.value.checkedList=r,b.value.productRiskList=a}),{deep:!0,immediate:!0}),(e,s)=>{const r=h,o=R;return l(),d("div",Y,[(l(!0),d(i,null,u(b.value.productRiskList,(e=>{var s,t;return l(),d("div",{key:e.riskId},[p("div",B,[n(r,{"risk-type":e.riskType,title:e.riskName,class:"no-border"},null,8,["risk-type","title"]),p("div",M,[p("div",X,[z,p("span",G,"￥"+c(null==(s=e.premium)?void 0:s.toLocaleString()),1)]),p("div",J,[p("div",Q,[p("span",Z,c(null==(t=e.amount)?void 0:t.toLocaleString()),1),ee]),p("div",ae,[p("span",se,c(v(m)(v(V),e.coveragePeriod)),1),re]),p("div",oe,[p("span",te,c(v(m)(v(g),e.chargePeriod)),1),le])]),p("div",de,[v(C)(e.riskId)?(l(),k(o,{key:0,round:32,class:"border",onClick:s=>{a("deleteRisk",e,L.productInfo)}},{default:I((()=>[ie])),_:2},1032,["onClick"])):f("",!0),v(j)?(l(),k(o,{key:1,activated:"",round:32,class:"btn-rider-risk",onClick:a=>{return s=e,P(!0),void(b.value.currentRiskRecord=s);var s}},{default:I((()=>[ue,pe])),_:2},1032,["onClick"])):f("",!0),n(o,{activated:"",round:32,onClick:s=>{a("updateRisk",e,L.productInfo)}},{default:I((()=>[ne])),_:2},1032,["onClick"])])])])])})),128)),b.value.productRiskList.length>1?(l(),d("div",ce,[ve,p("span",me,"￥"+c(b.value.totalPremium.toLocaleString()),1)])):f("",!0),v(y)?(l(),k(E,{key:1,modelValue:b.value.checkedList,"onUpdate:modelValue":s[0]||(s[0]=e=>b.value.checkedList=e),show:v(y),disabled:b.value.disabledList,"risk-list":v(_),"collocation-list":v(O),onFinished:w,onClose:s[1]||(s[1]=e=>v(P)(!1))},null,8,["modelValue","show","disabled","risk-list","collocation-list"])):f("",!0)])}}}),[["__scopeId","data-v-cd47605e"]]);const Ie={class:"container"},fe=(e=>(y("data-v-4f24fb6d"),e=e(),P(),e))((()=>p("span",{class:"plan-name"},"计划书名称",-1))),Le={class:"operate-bar"},he=L("添加主险"),Re={class:"footer-bar"},ye={class:"trial-result"},Pe=L("总保费"),be={class:"result-num"},ge={class:"trial-operate"},Ve=L("保存并预览");var _e=e(a({setup(e){const a=[{name:"保存修改"},{name:"另存为新计划书"}],[m,L]=s(),[h,y]=s(),P=r({proposalHolder:{},proposalInsuredList:[{name:"",gender:"",birthday:"",proposalInsuredProductList:[]}],proposalName:"",totalPremium:0,relationUserType:2}),E=b(),K=g(),W=$(),{id:Y,type:B="add",isCreateProposal:M}=K.query,X=r({productId:0,productCollection:{},productInfo:{},productPremium:{},riderRisk:{},type:"add",currentRisk:[]}),z=r();r({}),r([]),o((()=>({min:"",max:""})));const G=()=>{z.value.validate().then((()=>{H(P.value).then((({code:e,data:a})=>{"10000"===e&&(W.$reset(),W.proposalId=a,E.push({path:"/compositionProposal",query:{id:a}}))}))}))},J=()=>{!Y&&W.proposalId?y(!0):G()},Q=(e,a)=>{a&&(P.value.id=null),G()},Z=(e,a,s)=>a?/^.{1,20}$/.test(a)?"":`${e}不能超过20个字符`:"",ee=(e={})=>{Object.assign(X.value.productPremium,e),P.value.totalPremium=Object.values(X.value.productPremium).reduce(((e,a)=>e+a),0)},ae=(e,a)=>{const s=a;D.confirm({message:"确认删除该险种？"}).then((()=>{1===e.riskType?(P.value.proposalInsuredList[0].proposalInsuredProductList=P.value.proposalInsuredList[0].proposalInsuredProductList.filter((e=>e.productId!==s.productId)),ee({[s.productId]:0})):s.proposalProductRiskList=s.proposalProductRiskList.filter((a=>a.riskId!==e.riskId))}))},se=(e,a)=>{X.value.productId=a.productId,X.value.productInfo=a,X.value.type="edit",X.value.currentRisk=[e.riskId],L(!0)},re=(e,a)=>{X.value.productId=a.productId,X.value.productInfo=a,X.value.type="addRiderRisk",X.value.currentRisk=e,L(!0)},oe=e=>{P.value.proposalInsuredList[0].proposalInsuredProductList=P.value.proposalInsuredList[0].proposalInsuredProductList.map((a=>{let s=a;return a.productId===e.proposalInsuredList[0].proposalInsuredProductList[0].productId&&(s={...e.proposalInsuredList[0].proposalInsuredProductList[0]}),s})),L(!1)},te=()=>{W.setProposalInfo(P.value),W.setTrialData([]),W.setExcludeProduct(Object.keys(X.value.productCollection)),E.push({path:"/proposalList",query:{isCreateProposal:"1",...K.query}})},le=()=>{L(!1)};return V((()=>{const e=W.$state.trialData,a=W.$state.proposalInfo,s=W.$state.proposalId;Y&&!M||s?(((e={})=>{F(e).then((({code:e,data:a})=>{"10000"===e&&Object.assign(P.value,a)}))})({id:Y||s}),W.$reset()):!Object.keys(a).length&&e.length?Object.assign(P.value,e[0]):Object.keys(a).length&&e.length?(a.proposalInsuredList[0].proposalInsuredProductList.push(...e[0].proposalInsuredList[0].proposalInsuredProductList),P.value=a):Object.keys(a).length&&!e.length&&(P.value=a),W.setTrialData([])})),t((()=>{var e;return null==(e=P.value.proposalInsuredList[0].proposalInsuredProductList)?void 0:e.length}),(()=>{const e=P.value.proposalInsuredList[0].proposalInsuredProductList.map((e=>({productId:e.productId,source:2})));A({voList:e}).then((({code:e,data:a})=>{"10000"===e&&(X.value.productCollection=a)})).finally((()=>{}))})),(e,s)=>{const r=O,o=w,t=T,L=U,b=N,g=R,V=x,D=S,E=_("ProPageWrap");return l(),k(E,{class:"page-create-wrapper"},{default:I((()=>{var e;return[p("div",Ie,[n(b,{ref_key:"formRef",ref:z,"input-align":"right","error-message-align":"right"},{default:I((()=>[n(o,{"show-line":!1},{default:I((()=>[n(r,{modelValue:P.value.proposalName,"onUpdate:modelValue":s[0]||(s[0]=e=>P.value.proposalName=e),class:"border-radius",name:"proposalName",placeholder:"请输入计划书名称",rules:[{validator:(...e)=>Z("计划书名称",...e)}]},{label:I((()=>[fe])),_:1},8,["modelValue","rules"])])),_:1}),n(o,{title:"被保人信息"},{default:I((()=>[n(r,{modelValue:P.value.proposalInsuredList[0].name,"onUpdate:modelValue":s[1]||(s[1]=e=>P.value.proposalInsuredList[0].name=e),name:"name",label:"姓名",rules:[{validator:(...e)=>Z("姓名",...e)}],placeholder:"请输入（选填）"},null,8,["modelValue","rules"]),n(t,{modelValue:P.value.proposalInsuredList[0].birthday,"onUpdate:modelValue":s[2]||(s[2]=e=>P.value.proposalInsuredList[0].birthday=e),name:"birthday",label:"出生日期",type:"date","is-link":"",readonly:"",placeholder:"请选择",rules:[{required:!0,message:"请选择"}]},null,8,["modelValue"]),n(r,{modelValue:P.value.proposalInsuredList[0].gender,"onUpdate:modelValue":s[4]||(s[4]=e=>P.value.proposalInsuredList[0].gender=e),name:"gender",label:"性别",class:"border-radius",rules:[{required:!0,message:"请选择"}]},{input:I((()=>[n(L,{modelValue:P.value.proposalInsuredList[0].gender,"onUpdate:modelValue":s[3]||(s[3]=e=>P.value.proposalInsuredList[0].gender=e),options:v(j)},null,8,["modelValue","options"])])),_:1},8,["modelValue"])])),_:1})])),_:1},512),(l(!0),d(i,null,u(P.value.proposalInsuredList[0].proposalInsuredProductList||[],(e=>(l(),k(o,{key:e.productId,"show-line":!1},{default:I((()=>{var a,s;return[n(ke,{"product-risk-list":e.proposalProductRiskList,"product-info":e,"product-num":(null==(s=null==(a=P.value.proposalInsuredList[0])?void 0:a.proposalInsuredProductList)?void 0:s.length)-1,"product-data":X.value.productCollection[e.productId],"pick-product-premium":ee,onAddRiderRisk:re,onUpdateRisk:se,onDeleteRisk:ae},null,8,["product-risk-list","product-info","product-num","product-data"])]})),_:2},1024)))),128)),p("div",Le,[n(g,{activated:"",round:34,onClick:te},{default:I((()=>[he])),_:1})])]),p("div",Re,[p("span",ye,[Pe,p("span",be,"￥"+c(P.value.totalPremium.toLocaleString()),1)]),p("div",ge,[n(V,{type:"primary",onClick:J},{default:I((()=>[Ve])),_:1})])]),v(m)?(l(),k(q,{key:0,"is-show":v(m),type:X.value.type,"rider-risk":(null==(e=X.value.riderRisk)?void 0:e[X.value.productId])||[],"product-data":X.value.productCollection[X.value.productId],"form-info":X.value.productInfo,holder:P.value.proposalHolder,insured:P.value.proposalInsuredList[0],"current-risk":X.value.currentRisk,onClose:le,onFinished:oe},null,8,["is-show","type","rider-risk","product-data","form-info","holder","insured","current-risk"])):f("",!0),n(D,{show:v(h),"onUpdate:show":s[5]||(s[5]=e=>C(h)?h.value=e:null),actions:a,"cancel-text":"取消","close-on-click-action":"",onCancel:s[6]||(s[6]=e=>v(y)(!1)),onSelect:Q},null,8,["show"])]})),_:1})}}}),[["__scopeId","data-v-4f24fb6d"]]);export{_e as default};
