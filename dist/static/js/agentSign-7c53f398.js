import{d as e,ax as a,ay as i,i as s,h as t,c5 as n,j as o,ad as r,af as d,aQ as l,l as c,o as u,c as g,b as f,a as m,u as p,w as h,v,aX as y,aP as S,cN as j,cO as b,y as I,T as _,cP as E,bO as O,aC as w,aH as N}from"./index-b79a8342.js";import{b as L}from"./product-5552a48c.js";import{g as T,m as C}from"./trial-597560d2.js";import{_ as V}from"./SignPart-1dd31469.js";import{u as A}from"./useOrder-8cc47da5.js";import{a as D}from"./notice-5d1ed2dc.js";import"./PolicyInfo-0e99b181.js";import{p as P}from"./utils-cc4d00ea.js";import{g as q}from"./utils-eba979e1.js";import"./index-d89cb3d4.js";import"./cloneDeep-f8d0d812.js";import"./utils-8a3803fc.js";import"./createProposal-0e4cd6d1.js";import"./trial-802f2d1c.js";import"./infoCollection-208d71bc.js";const x={class:"long-verify"},G={class:"verify-content"},z={class:"footer-button"},B=e({__name:"agentSign",setup(e){a((()=>i((()=>import("./index-93d83a5f.js")),["static/js/index-93d83a5f.js","static/css/index-793d1580.css","static/js/index-b79a8342.js","static/css/index-a7bf09dc.css"]))),a((()=>i((()=>import("./index-95c7b976.js")),["static/js/index-95c7b976.js","static/css/index-fa4edf2a.css","static/js/index-b79a8342.js","static/css/index-a7bf09dc.css","static/js/theme-94cf7d00.js","static/js/index-60f764b1.js","static/css/index-bbfdd7ec.css","static/js/utils-eba979e1.js","static/js/infoCollection-208d71bc.js","static/js/trial-802f2d1c.js"])));const B=s(),R=t(),{productCode:$="",tenantId:k,agentCode:M="",agencyCode:U,saleChannelId:F,saleUserId:H,orderNo:J,orderCode:Q,extraInfo:X,isShare:K,insurerCode:W,preview:Y}=B.query;let Z={};try{Z=JSON.parse(decodeURIComponent(X))}catch(le){}const ee=A(),ae=`${window.origin}/baseInsurance/long/phoneVerify?${n.stringify({...B.query,orderNo:Q||J})}`,ie=o(),se=r.get(`${d}_userInfo`),te=o({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:""},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{}},agent:{fileList:[],personalInfo:{name:(null==se?void 0:se.name)||""},isSign:!1,isVerify:!1,isShareSign:!1,signData:[]}}),ne=o({sign:[],verify:[],scribing:""}),oe=()=>{if(Y)return void y(S.SIGN,B.query);const e=[];ie.value&&ne.value.sign.includes("1")&&e.push(ie.value.validateSign()),Promise.all(e).then((e=>{j({bizObjectId:[],bizObjectType:b.AGENT,orderId:ee.value.id,tenantId:k}).then((({code:e,data:a})=>{"10000"===e&&a&&R.push({path:I.sign,query:B.query})}))})).catch((e=>{_(e.message)}))};o();const re=(e,a,i)=>{var s;E(e,a,null==(s=ee.value)?void 0:s.id,k,i).then((()=>{J&&T({orderNo:Q||J,tenantId:k}).then((({code:e,data:a})=>{if("10000"===e){Object.assign(ee.value,a);const e=[];a.tenantOrderAttachmentList.forEach((a=>{a.objectType===D.AGENT&&30===a.category&&e.push(a.fileBase64)})),te.value.agent.signData=e}}))}))};o({imgUrl:"",desc:"",title:"",link:ae});l((()=>{(async()=>{let e={};const{code:a,data:i}=await T({orderNo:J,tenantId:k});"10000"===a&&(Object.assign(ee.value,i),e=P(i.insuredList[0].productList),i.tenantOrderAttachmentList.forEach((e=>{e.objectType===D.AGENT&&30===e.category&&te.value.agent.signData.push(e.fileBase64)}))),L(e).then((({code:e,data:a})=>{var i;if("10000"===e){const{signMaterialMap:e}=(null==(i=a.productMaterialPlanVOList)?void 0:i[1])||{};(Object.values(e||{}).flat()||[]).forEach((e=>{e.noticeObject===D.AGENT&&te.value.agent.fileList.push({attachmentName:e.materialName,attachmentList:[{...e,materialSource:q(`${null==e?void 0:e.materialSource}`,null==e?void 0:e.materialContent)}]})}))}})),C(e).then((({data:e,code:a})=>{if("10000"===a){const{signInfo:a}=O(e.productFactor);a.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((a=>{e.required&&ne.value.sign.push(a.code),"1"===a.code?te.value.agent.isSign=!0:"2"===a.code?te.value.holder.isSign=!0:"3"===a.code?te.value.insured.isSign=!0:"4"===a.code?te.value.holder.isShareSign=!0:"5"===a.code&&(te.value.insured.isShareSign=!0)})),"customerFace"===e.name&&e.columns.forEach((a=>{e.required&&ne.value.verify.push(a.code),"1"===a.code?te.value.holder.isVerify=!0:"2"===a.code&&(te.value.insured.isVerify=!0)}))}))}}))})()}));const de=o();return c((()=>{setTimeout((async()=>{de.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,a)=>{const i=w,s=N;return u(),g("div",x,[f(i),m("div",G,[f(V,{ref_key:"agentSignRef",ref:ie,"order-detail":p(ee),"sign-string":p(te).agent.signData,"show-sign":p(te).agent.isSign,"show-verify":p(te).agent.isVerify,"file-list":p(te).agent.fileList,"personal-info":p(te).agent.personalInfo,disabled:!!p(K),title:"代理人",onHandleSign:a[0]||(a[0]=e=>re("AGENT",e))},null,8,["order-detail","sign-string","show-sign","show-verify","file-list","personal-info","disabled"])]),m("div",z,[f(s,{type:"primary",onClick:oe},{default:h((()=>[v("确定")])),_:1})])])}}});export{B as default};
