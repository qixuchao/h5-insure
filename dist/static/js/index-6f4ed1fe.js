import{l as i,a as e,P as s}from"./index-2216eba3.js";import{d as a,z as l,o as t,a1 as r,R as n,c as o,A as d,V as u,U as c,g as p,i as k,w as v,h as m,G as f,aN as I,L as y,r as g,e as h,ah as L,f as V,j as R,E as b,aB as C,aZ as O,a3 as S,ab as P,B as x,a_ as D,a$ as T,am as w,an as F,u as _,a as E,$ as j,k as N,av as M,T as q}from"./index-d4c3d055.js";import{I as B}from"./index-1b65c29d.js";/* empty css              */import{S as A}from"./index-ec754b20.js";import{P as K}from"./index-e5ce1b9d.js";import{S as $,_ as U}from"./box-title-71b6b0de.js";import{_ as Q}from"./index-840498f6.js";import{T as W}from"./Table-716bd174.js";import{R as z}from"./trial-3f350ac0.js";import{u as H,b as G,p as Z,q as J,c as X}from"./trial-f728de2b.js";import{u as Y}from"./useOrder-9e3d69ff.js";import"./infoCollection-564e479c.js";import"./core-6502dc1f.js";const ii={key:0},ei={key:0,class:"risk2-field"},si=a({name:"ProductRiskList"});var ai=f(a({...si,props:{dataSource:{type:Array,default:()=>[]},productInfo:{type:Object,default:()=>({productCode:"",productName:""})},showMainRisk:{type:Boolean,default:()=>!0},defaultValue:{type:Object,default:()=>{}}},emits:["trialChange"],setup(i,{emit:e}){const s=i,a=l({loading:!1,show:!0,select:{},list:[],userData:{},riskIsInsure:{},submitData:{},disabledRiskInfo:[],risksDefaultValue:{}}),f=i=>{const e=[];return i.riskLiabilityInfoVOList.map((i=>(1!=+i.showFlag&&e.push({...i}),[]))),e},y=(i,l,t)=>{var r;a.riskIsInsure[l].data=i;const n=[...a.disabledRiskInfo];null==(r=s.dataSource.insureProductRiskVOList)||r.forEach((i=>{if(1!==i.mainRiskFlag){const e=a.riskIsInsure[i.riskId];e.data&&Object.keys(e.data).length>0&&"1"===e.selected&&n.push(e.data)}})),e("trialChange",n,t)},g=(i,e)=>{var l;null==(l=s.dataSource.productRiskRelationVOList)||l.forEach((s=>{1!==s.collocationType&&(e.riskId===s.riskId?(a.riskIsInsure[e.riskId]&&a.riskIsInsure[e.riskId].selected,2===s.collocationType&&a.riskIsInsure[s.collocationRiskId]&&(a.riskIsInsure[s.collocationRiskId].selected=i),3===s.collocationType&&a.riskIsInsure[s.collocationRiskId]&&"1"===i&&(a.riskIsInsure[s.collocationRiskId].selected="1"===i?"2":"1")):e.riskId===s.collocationRiskId&&(3===s.collocationType&&"1"===i&&a.riskIsInsure[s.riskId]&&(a.riskIsInsure[s.riskId].selected="1"===i?"2":"1"),2===s.collocationType&&a.riskIsInsure[s.riskId]&&(a.riskIsInsure[s.riskId].selected=i)))})),"2"===i?y({},e.riskId):(i=>{var e,s,a,l,t,r,n,o,d,u,c,p;if(1!==(null==i?void 0:i.factorDisPlayFlag)){const k=null==(e=null==i?void 0:i.productRiskInsureLimitVO)?void 0:e.amountPremiumConfigVO,v={riskCategory:i.riskCategory,riskCode:i.riskCode,riskName:i.riskName,riskId:i.riskId,riskType:i.riskType,mainRiskId:i.mainRiskId,mainRiskCode:i.mainRiskCode,liabilityList:f(i)};v.chargePeriod=(null==(a=null==(s=null==i?void 0:i.productRiskInsureLimitVO)?void 0:s.paymentPeriodValueList)?void 0:a.length)>0&&(null==(l=null==i?void 0:i.productRiskInsureLimitVO)?void 0:l.paymentPeriodValueList[0].code)||null,v.coveragePeriod=(null==(r=null==(t=null==i?void 0:i.productRiskInsureLimitVO)?void 0:t.insurancePeriodValueList)?void 0:r.length)>0&&(null==(n=null==i?void 0:i.productRiskInsureLimitVO)?void 0:n.insurancePeriodValueList[0].code)||null,v.paymentFrequency=(null==(d=null==(o=null==i?void 0:i.productRiskInsureLimitVO)?void 0:o.paymentFrequencyList)?void 0:d.length)>0&&(null==(u=null==i?void 0:i.productRiskInsureLimitVO)?void 0:u.paymentFrequencyList[0].code)||null;let m=0;1===k.displayType?m=(null==k?void 0:k.minStepValue)>0?null==k?void 0:k.minStepValue:0:3===k.displayType&&2===k.requireCopies?m=(null==(c=null==k?void 0:k.displayValues)?void 0:c.length)>0?null==k?void 0:k.displayValues[0].value:0:3===k.displayType&&1===k.requireCopies?(m=(null==(p=null==k?void 0:k.displayValues)?void 0:p.length)>0?null==k?void 0:k.displayValues[0].value:0,v.copy=k.minCopiesValue):2===k.displayType?v.copy=k.minCopiesValue:m=0,1===k.saleMethod?v.initialAmount=m:v.initialPremium=m,y(v,i.riskId)}})(e)};return t((()=>{(()=>{var i,e;a.disabledRiskInfo=[];let l=null;if(null==(i=s.dataSource.insureProductRiskVOList)||i.forEach((i=>{var e;const t=1!==i.mainRiskFlag?null==(e=s.dataSource.productRiskRelationVOList)?void 0:e.find((e=>e.collocationRiskId===i.riskId)):{};1===i.mainRiskFlag&&(l=i),a.riskIsInsure[i.riskId]?(a.riskIsInsure[i.riskId].data=null,a.riskIsInsure[i.riskId].relation=t,a.riskIsInsure[i.riskId].isMust=!1):a.riskIsInsure[i.riskId]={selected:"2",data:null,relation:t,isMust:!1}})),l){const i=null==(e=s.dataSource.productRiskRelationVOList)?void 0:e.filter((i=>i.riskId===l.riskId));if(!i)return;null==i||i.forEach((i=>{var e,l,t,r,n,o,d,u,c,p,k,v,m,I,g;if(2===i.collocationType){a.riskIsInsure[i.collocationRiskId].selected="1",a.riskIsInsure[i.collocationRiskId].isMust=!0;const h=null==(e=s.dataSource.insureProductRiskVOList)?void 0:e.find((e=>i.collocationRiskId===e.riskId));if(h&&1!==h.factorDisPlayFlag&&(null==(l=null==h?void 0:h.productRiskInsureLimitVO)?void 0:l.amountPremiumConfigVO)){const e=null==(t=h.riskLiabilityInfoVOList)?void 0:t.every((i=>1!==i.showFlag)),s=null==(r=null==h?void 0:h.productRiskInsureLimitVO)?void 0:r.amountPremiumConfigVO;if(e){a.riskIsInsure[i.collocationRiskId].isDisabled=!0;const e={riskCategory:h.riskCategory,riskCode:h.riskCode,riskName:h.riskName,riskId:h.riskId,riskType:h.riskType,mainRiskId:h.mainRiskId,mainRiskCode:h.mainRiskCode,liabilityList:f(h)};e.chargePeriod=(null==(o=null==(n=null==h?void 0:h.productRiskInsureLimitVO)?void 0:n.paymentPeriodValueList)?void 0:o.length)>0&&(null==(d=null==h?void 0:h.productRiskInsureLimitVO)?void 0:d.paymentPeriodValueList[0].code)||null,e.coveragePeriod=(null==(c=null==(u=null==h?void 0:h.productRiskInsureLimitVO)?void 0:u.insurancePeriodValueList)?void 0:c.length)>0&&(null==(p=null==h?void 0:h.productRiskInsureLimitVO)?void 0:p.insurancePeriodValueList[0].code)||null,e.paymentFrequency=(null==(v=null==(k=null==h?void 0:h.productRiskInsureLimitVO)?void 0:k.paymentFrequencyList)?void 0:v.length)>0&&(null==(m=null==h?void 0:h.productRiskInsureLimitVO)?void 0:m.paymentFrequencyList[0].code)||null;let l=0;1===s.displayType?l=(null==s?void 0:s.minStepValue)>0?null==s?void 0:s.minStepValue:0:3===s.displayType&&2===s.requireCopies?l=(null==(I=null==s?void 0:s.displayValues)?void 0:I.length)>0?null==s?void 0:s.displayValues[0].value:0:3===s.displayType&&1===s.requireCopies?(l=(null==(g=null==s?void 0:s.displayValues)?void 0:g.length)>0?null==s?void 0:s.displayValues[0].value:0,e.copy=s.minCopiesValue):2===s.displayType&&(e.copy=s.minCopiesValue),1===s.saleMethod?e.initialAmount=l:e.initialPremium=l,a.disabledRiskInfo.push(e),y(e,h.riskId)}}}3===i.collocationType&&(a.riskIsInsure[i.collocationRiskId].selected="2",a.riskIsInsure[i.collocationRiskId].isMust=!0)}))}})()})),r((()=>{a.loading=!0})),n((()=>a.riskIsInsure),(i=>{}),{deep:!0,immediate:!0}),n((()=>s.defaultValue),(i=>{(null==i?void 0:i.length)>0&&i.forEach((i=>{a.risksDefaultValue[i.riskCode]=i,a.riskIsInsure[i.riskId]?(a.riskIsInsure[i.riskId].selected="1",y(i,i.riskId)):a.riskIsInsure[i.riskId]={selected:"1",isMust:!1}}))}),{deep:!0,immediate:!0}),(e,s)=>{const l=A,t=I;return o(!0),d(c,null,u(i.dataSource.insureProductRiskVOList,(e=>{var s,r;return o(),d(c,{key:e.riskCode},[(!i.showMainRisk&&1!==e.mainRiskFlag||i.showMainRisk)&&(null==(r=null==(s=p(a).riskIsInsure)?void 0:s[e.riskId])?void 0:r.relation)?(o(),d("div",ii,[k(t,{modelValue:p(a).riskIsInsure[e.riskId].selected,"onUpdate:modelValue":i=>p(a).riskIsInsure[e.riskId].selected=i,label:e.riskName,name:"selected","label-width":"50%",border:!1,class:"risk-select-field risk-name"},{input:v((()=>[k(l,{modelValue:p(a).riskIsInsure[e.riskId].selected,"onUpdate:modelValue":i=>p(a).riskIsInsure[e.riskId].selected=i,"active-value":"1","inactive-value":"2",size:"0.74rem",disabled:p(a).riskIsInsure[e.riskId].isMust,style:{"margin-right":"8px"},onChange:i=>g(i,e)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])])),_:2},1032,["modelValue","onUpdate:modelValue","label"]),"1"===p(a).riskIsInsure[e.riskId].selected?(o(),d("div",ei,[k(B,{modelValue:p(a).riskIsInsure[e.riskId].data,"onUpdate:modelValue":i=>p(a).riskIsInsure[e.riskId].data=i,"origin-data":e,"product-factor":i.dataSource.productFactor,"default-value":p(a).risksDefaultValue[e.riskCode],onTrialChange:(i,s)=>y(i,e.riskId,s)},null,8,["modelValue","onUpdate:modelValue","origin-data","product-factor","default-value","onTrialChange"])])):m("",!0)])):m("",!0)],64)})),128)}}}),[["__scopeId","data-v-d3264472"]]);const li={class:"benefit-table"},ti=a({name:"benefitTable"}),ri=a({...ti,props:{dataSource:null},setup(i){const e=i,s=y((()=>{const i=e.dataSource.headers.length,s=12*e.dataSource.headers.join("").length+20*e.dataSource.headers.length;return e.dataSource.headers.map(((e,a)=>{const l=s>320?12*e.length+20:Math.max(12*e.length+20,320/i);return console.log("totalWordWidth:",s,"titleWidth:",l,"word-width:",12*e.length+20),{title:e,key:`header_${a}`,fixed:a<2,minWidth:l}}))})),a=y((()=>e.dataSource.dataList.map((i=>{const e={};return i.forEach(((i,s)=>{e[`header_${s}`]=i})),e}))));return r((()=>{})),(i,e)=>(o(),d("div",li,[k(W,{"top-height":400,columns:p(s),data:p(a),"is-clone":!0},null,8,["columns","data"])]))}});const ni=i=>(w("data-v-d9a31ad8"),i=i(),F(),i),oi={key:0,class:"benefit-container"},di={key:0,class:"benefit"},ui=ni((()=>V("div",{class:"line"},null,-1))),ci={class:"box-title box-title-chart"},pi=ni((()=>V("img",{class:"tl",src:U,alt:""},null,-1))),ki=ni((()=>V("img",{class:"transform-z180 tr",src:U,alt:""},null,-1))),vi={key:0},mi={class:"box"},fi={class:"box-title"},Ii=ni((()=>V("img",{class:"tl",src:U,alt:""},null,-1))),yi=ni((()=>V("img",{class:"transform-z180 tr",src:U,alt:""},null,-1))),gi={class:"box-price"},hi={class:"text1"},Li={class:"text2"},Vi={key:1},Ri={key:2,style:{width:"100%, minWidth: 338px"}},bi={class:"slider"},Ci={style:{flex:"1",margin:"0px 5px"}},Oi={class:"custom-button"},Si=ni((()=>V("p",{class:"slider-dec"},"拖动按钮查看不同年龄保障",-1))),Pi={class:"btn-two"},xi={key:1,class:"benefit-container"},Di={key:0},Ti={class:"benefit"},wi=ni((()=>V("div",{class:"line"},null,-1))),Fi=ni((()=>V("div",null,[V("div",{class:"box"},[V("p",{class:"box-title"},[V("img",{class:"tl",src:U,alt:""}),R(" 保单年度"),V("span",null,"-"),R("年度，被保人"),V("span",null,"-"),R("岁时 "),V("img",{class:"transform-z180 tr",src:U,alt:""})]),V("div",{class:"box-price"})])],-1))),_i={class:"slider"},Ei={class:"opt lf"},ji={style:{flex:"1",margin:"0px 5px"}},Ni=ni((()=>V("div",{class:"custom-button"},"0 岁",-1))),Mi={class:"opt rg"},qi=ni((()=>V("p",{class:"slider-dec"},"拖动按钮查看不同年龄保障",-1))),Bi={class:"btn-two"},Ai={key:1,class:"empty-box"},Ki=a({name:"Benefit"});var $i=f(a({...Ki,props:{dataSource:{default:()=>({showTypeList:["1"]})},productInfo:{default:()=>null}},setup(i){var e;const s=i,a="1",l="2",t="3",r=g(0),f=g(0),I=g(0),y=g(),w=g(0),F=g(null==(e=s.dataSource.showTypeList)?void 0:e[0]),_=g(),E=i=>{if(!(null==i?void 0:i.benefitRiskResultVOList))return;const e=null==i?void 0:i.benefitRiskResultVOList[r.value];f.value=e.ageBegin+1,w.value=e.ageBegin+1,I.value=e.ageEnd},j=()=>{var i,e,a,l,t,n;const o=null==(e=null==(i=s.dataSource)?void 0:i.benefitRiskResultVOList)?void 0:e[r.value];_.value=null==(t=null==(l=null==(a=s.dataSource)?void 0:a.benefitRiskResultVOList)?void 0:l[r.value].benefitRiskTableResultVOList)?void 0:t[0];const{a:d,year:u}=((i,e)=>{const s=[],a=[];for(let l=i,t=0;l<=e;l++,t++)s.push(l.toString()),a.push(t+1);return{a:s,year:a}})(f.value,I.value),c={index:d.indexOf(w.value.toString()),age:d,year:u,result:null==(n=null==o?void 0:o.benefitRiskItemResultVOList)?void 0:n[0]};y.value=c},N=()=>{w.value>I.value-1||(w.value+=1,j())},M=()=>{w.value>f.value&&(w.value-=1,j())},q=i=>{r.value=i.name,E(s.dataSource),j()};return n((()=>s.dataSource),(i=>{var e;i&&(E(i),j(),F.value=null==(e=i.showTypeList)?void 0:e[0])}),{deep:!0,immediate:!0}),n(w,(()=>{j()})),(e,n)=>{var g;const E=P,j=$,B=x,A=D,U=T,W=K;return(null==(g=i.dataSource)?void 0:g.benefitRiskResultVOList)?(o(),d("div",oi,[k(U,{active:p(r),onClickTab:q},{default:v((()=>{var i;return[(o(!0),d(c,null,u(null==(i=s.dataSource)?void 0:i.benefitRiskResultVOList,((i,e)=>(o(),h(A,{key:e,name:e,title:i.riskName},{default:v((()=>{var i,g,P,x,D,T,q,A,K,$,U,W,z,H,G,Z;return[e==p(r)?(o(),d("div",di,[ui,L(V("p",ci,[pi,R(" 保单年度"),V("span",null,b(null==(P=null==(i=p(y))?void 0:i.year)?void 0:P[null==(g=p(y))?void 0:g.index]),1),R("年度，被保人"),V("span",null,b(null==(T=null==(x=p(y))?void 0:x.age)?void 0:T[null==(D=p(y))?void 0:D.index]),1),R("岁时 "),ki],512),[[C,p(F)===l]]),p(F)===a?(o(),d("div",vi,[V("div",mi,[V("p",fi,[Ii,R(" 保单年度"),V("span",null,b(null==(K=null==(q=p(y))?void 0:q.year)?void 0:K[null==(A=p(y))?void 0:A.index]),1),R("年度，被保人"),V("span",null,b(null==(W=null==($=p(y))?void 0:$.age)?void 0:W[null==(U=p(y))?void 0:U.index]),1),R("岁时 "),yi]),V("div",gi,[(o(!0),d(c,null,u(null==(H=null==(z=p(y))?void 0:z.result)?void 0:H.headers,((i,e)=>{var s,a,l,t,r,n,u,c,k,v;return o(),d("div",{key:e,style:{width:"33%"}},[V("p",hi,b(("0"==(null==(r=null==(t=null==(a=null==(s=p(y))?void 0:s.result)?void 0:a.dataList)?void 0:t[null==(l=p(y))?void 0:l.index])?void 0:r[e])?"0":p(O)(Number(null==(v=null==(k=null==(u=null==(n=p(y))?void 0:n.result)?void 0:u.dataList)?void 0:k[null==(c=p(y))?void 0:c.index])?void 0:v[e])))||"0"),1),V("p",Li,b(i)+"(元）",1)])})),128))])])])):m("",!0),p(F)===t?(o(),d("div",Vi,[k(ri,{"data-source":p(_)},null,8,["data-source"])])):m("",!0),p(F)==l?(o(),d("div",Ri,[k(Q,{min:p(f),max:p(I),current:p(w),data:null==(Z=null==(G=p(y))?void 0:G.result)?void 0:Z.benefitRiskItemList},null,8,["min","max","current","data"])])):m("",!0),p(F)!=t?(o(),d(c,{key:3},[V("div",bi,[V("div",{class:"opt lf",onClick:M},[k(E,{name:"minus"})]),V("div",Ci,[p(f)?(o(),h(j,{key:0,modelValue:p(w),"onUpdate:modelValue":n[0]||(n[0]=i=>S(w)?w.value=i:null),min:p(f),max:p(I),"bar-height":"8px"},{button:v((()=>[V("div",Oi,b(p(w))+" 岁",1)])),_:1},8,["modelValue","min","max"])):m("",!0)]),V("div",{class:"opt rg",onClick:N},[k(E,{name:"plus"})])]),Si],64)):m("",!0),V("div",Pi,[s.dataSource.showTypeList.includes(a)?(o(),h(B,{key:0,round:"",plain:p(F)!==a,type:"primary",class:"btn",onClick:n[1]||(n[1]=i=>F.value=a)},{default:v((()=>[R("图表展示")])),_:1},8,["plain"])):m("",!0),s.dataSource.showTypeList.includes(l)?(o(),h(B,{key:1,round:"",plain:p(F)!==l,type:"primary",class:"btn",onClick:n[2]||(n[2]=i=>F.value=l)},{default:v((()=>[R("趋势展示")])),_:1},8,["plain"])):m("",!0),s.dataSource.showTypeList.includes(t)?(o(),h(B,{key:2,round:"",plain:p(F)!==t,type:"primary",class:"btn",onClick:n[3]||(n[3]=i=>F.value=t)},{default:v((()=>[R("表格展示")])),_:1},8,["plain"])):m("",!0)])])):m("",!0)]})),_:2},1032,["name","title"])))),128))]})),_:1},8,["active"])])):(o(),d("div",xi,[s.productInfo?(o(),d("div",Di,[k(U,{active:p(r),onClickTab:q},{default:v((()=>[(o(),h(A,{key:1,name:1,title:i.productInfo.insureProductRiskVOList[0].riskName},{default:v((()=>[V("div",Ti,[wi,Fi,V("div",_i,[V("div",Ei,[k(E,{name:"minus"})]),V("div",ji,[k(j,{modelValue:p(w),"onUpdate:modelValue":n[4]||(n[4]=i=>S(w)?w.value=i:null),min:0,max:80,"bar-height":"8px",disabled:""},{button:v((()=>[Ni])),_:1},8,["modelValue"])]),V("div",Mi,[k(E,{name:"plus"})])]),qi,V("div",Bi,[k(B,{round:"",plain:!0,type:"primary",class:"btn",disabled:""},{default:v((()=>[R("图表展示")])),_:1}),k(B,{round:"",plain:!1,type:"primary",class:"btn",disabled:""},{default:v((()=>[R("趋势展示")])),_:1}),k(B,{round:"",plain:!1,type:"primary",class:"btn",disabled:""},{default:v((()=>[R("表格展示")])),_:1})])])])),_:1},8,["title"]))])),_:1},8,["active"])])):(o(),d("div",Ai,[k(W,{title:"试算结果正在计算中...","empty-class":"empty-select"})]))]))}}}),[["__scopeId","data-v-d9a31ad8"]]);const Ui={key:0,class:"head-warning-wrap"},Qi=V("div",{class:"warning-icon"},[V("span",null,"!")],-1),Wi={class:"warning-text"},zi=a({name:"HeadWaring"}),Hi=a({...zi,props:{labels:{default:()=>[]}},setup:i=>(e,s)=>i.labels.length>0?(o(),d("div",Ui,[Qi,V("div",Wi,[(o(!0),d(c,null,u(i.labels,(i=>(o(),d("span",{key:i},b(i),1)))),128))])])):m("",!0)}),Gi=(e,s,a)=>{const l=e,{holder:t}=a,r=a.insuredList[0],n=(s||"").split("_");if(n.length<2)return s;if(i.exports.isNaN(Number(n[1])))return s;if(n[1]-=1,1===l.exemptFlag){if("to"===n[0]){let i=0;1===l.exemptType?(null==t?void 0:t.birthday)&&(i=parseInt(""+((new Date).getTime()-new Date(t.birthday).getTime())/31536e6,10)):2===l.exemptType&&(null==r?void 0:r.birthday)&&(i=parseInt(""+(+(new Date).getTime()-new Date(r.birthday).getTime())/31536e6,10)),n[1]=+n[1]-i}n[0]="year"}return n.join("_")},Zi=(i,e)=>{const s=[],a={};return null==i||i.forEach((i=>{a[i.riskId]=i})),null==e||e.forEach((i=>{var e,l,t,r;const{collocationType:n,collocationRiskId:o,riskId:d}=i;switch(n){case 2:{const i=null==(e=a[d])?void 0:e.riskName,t=null==(l=a[o])?void 0:l.riskName;s.push(`${i} 和 ${t} 必须同时投保`);break}case 3:{const i=null==(t=a[d])?void 0:t.riskName,e=null==(r=a[o])?void 0:r.riskName;s.push(`${i} 和 ${e} 不能同时投保`);break}}})),s};const Ji={class:"com-body"},Xi={class:"trial-body"},Yi={class:"container"},ie=(i=>(w("data-v-7c02f828"),i=i(),F(),i))((()=>V("div",{class:"empty"},null,-1))),ee=a({name:"TrialBody"});var se=f(a({...ee,props:{dataSource:{default:()=>[]},productInfo:{default:()=>({productCode:"",productName:"",insurerCode:"",tenantId:""})},tenantProductDetail:{default:()=>({})},hideBenefit:{type:Boolean,default:!1},hidePopupButton:{type:Boolean,default:!1},title:{default:"算一算保费"},defaultData:{default:null},isTrial:{type:Boolean,default:!1}},emits:["trialStart","trialEnd"],setup(a,{expose:u,emit:c}){const v=a,f=g(null),I=_();E(),I.query;const y=g(),L=l({loading:!1,show:!1,select:{},list:[],userData:{},riskIsInsure:{},submitData:{},riskList:[{}],mainRiskVO:{},ifPersonalInfoSuccess:!1,trialMsg:"",trialResultPremium:0,trialResult:{initialPremium:0,initialAmount:0},isAniShow:!1,defaultValue:null,isAutoChange:!1,planIndex:0,isSkipFirstTrial:!1,hadSkipFirstTrial:!1,isQuerying:!1});Y(),g(),g();const R=i=>{const{holder:e,insuredList:s}=i||{};e&&(L.submitData.holder=e),s&&s.length>0&&s.forEach(((i,e)=>{var s;L.submitData.insuredList&&L.submitData.insuredList.length>e?L.submitData.insuredList[e]=i:((null==(s=L.submitData)?void 0:s.insuredList)||(L.submitData.insuredList=[]),L.submitData.insuredList.push(i))}))},b=g(),C=g({}),O=["annuityDrawDate","coveragePeriod","chargePeriod","paymentFrequency"],S=i=>{var e,a,l,t,r,n;if(null==(a=null==(e=null==i?void 0:i.data)?void 0:e[0])?void 0:a.productRiskDyInsureFactorVOList){const e=[];if(null==(l=v.dataSource)||l.insureProductRiskVOList.forEach((a=>{var l,t;const r=null==(t=null==(l=null==i?void 0:i.data)?void 0:l[0])?void 0:t.productRiskDyInsureFactorVOList.find((i=>i.riskCode===a.riskCode));if(r){a.productRiskInsureLimitVO={...a.productRiskInsureLimitVO,...r};const i=L.riskList.find((i=>i.riskCode===a.riskCode));let l=!1;s.forEach((e=>{if(O.indexOf(e.valueKey)>=0){const s=a.productRiskInsureLimitVO[e.configKey];if(s&&i){const a=s.find((s=>s.code===i[e.valueKey]));if(a&&2===a.useFlag){const a=s.find((i=>1===i.defaultFlag));i[e.valueKey]=a.code,l=!0}}}})),l&&e.push({...i,...r,riskCode:a.riskCode})}})),e.length>0&&(null==(n=null==(r=null==(t=L.defaultValue)?void 0:t.insuredList)?void 0:r[0])?void 0:n.productList))return e.forEach((i=>{var e,s,a;L.defaultValue.insuredList[0].productList=null==(a=null==(s=null==(e=L.defaultValue)?void 0:e.insuredList)?void 0:s[0])?void 0:a.productList.map((e=>(e.riskList=null==e?void 0:e.riskList.map((e=>(e.riskCode===i.riskCode&&(e=i),e))),e)))})),!1}return!0},P=async(i,e=!0)=>{L.trialMsg="试算中...",L.trialResultPremium=0,L.loading=!0,c("trialStart");let s=!1;if(e){const{code:e}=await H(i);s="10000"===e}!s&&e||(L.isQuerying=!0,v.hideBenefit||G(i).then((i=>{i.data&&i.code===M&&(C.value=i.data)})).finally((()=>{L.loading=!1})),Z(i).then((i=>{var e,s;if(i.data&&i.code===M){(null==(e=null==i?void 0:i.data)?void 0:e.errorInfo)&&q(`${null==(s=null==i?void 0:i.data)?void 0:s.errorInfo}`),L.trialMsg="",L.trialResultPremium=i.data.initialPremium,L.trialResult=i.data;const a={};i.data.riskPremiumDetailVOList&&i.data.riskPremiumDetailVOList.length&&i.data.riskPremiumDetailVOList.forEach((i=>{a[i.riskCode]={initialAmount:i.initialAmount,initialPremium:i.initialPremium}})),b.value=a,c("trialEnd",i.data)}})).finally((()=>{L.loading=!1,L.isQuerying=!1})))},x=i.exports.debounce((async()=>{if(console.log(">>>>>调用试算<<<<<",L.ifPersonalInfoSuccess),L.ifPersonalInfoSuccess||y.value.canTrail()){L.submitData.productCode=v.productInfo.productCode,L.submitData.productName=v.productInfo.productName,L.submitData.tenantId=v.productInfo.tenantId,L.riskList=L.riskList.map((i=>(i=>{var e,a,l,t;const r=null==(e=v.dataSource.insureProductRiskVOList)?void 0:e.find((e=>i.riskId===e.riskId));if(r&&1!==r.mainRiskFlag){const e=null==(l=null==(a=v.dataSource)?void 0:a.productRiskRelationVOList)?void 0:l.filter((i=>{var e;if(i.collocationRiskId===r.riskId&&3!==i.collocationType){const s=null==(e=v.dataSource.insureProductRiskVOList)?void 0:e.find((e=>i.riskId===e.riskId));if(s&&s.riskType===z.MAIN_RISK)return!0}return!1})),n=e.length>0?e[0]:null;if(n){const e=null==(t=L.riskList)?void 0:t.find((i=>i.riskId===n.riskId));s.forEach((s=>{s.ruleKey&&r.productRiskInsureLimitVO&&e&&(1===r.productRiskInsureLimitVO[s.ruleKey]&&(i[s.valueKey]=e[s.valueKey]),3===r.productRiskInsureLimitVO[s.ruleKey]&&(1!==r.exemptFlag?i[s.valueKey]=Gi(r,e[s.valueKey],L.submitData):i[s.valueKey]=Gi(r,e[s.ruleValueKey],L.submitData)))}))}}return i})(i))),L.submitData.insuredList&&L.submitData.insuredList.forEach((i=>{i.productList=[{insurerCode:v.productInfo.insurerCode,planCode:v.dataSource.planCode,riskList:L.riskList}]})),console.log(">>>数据构建<<<",i.exports.cloneDeep(L.submitData));const e=i.exports.cloneDeep(L.submitData);await P(e)}}),300),D=async i=>{var e;const{insuredList:s,isFirstInsuredChange:a}=i;if(R(i),L.ifPersonalInfoSuccess=!0,a){console.log("处理第一被保人修改的dy变化"),L.isQuerying=!0;const i=await J({calcProductFactorList:[{planCode:v.dataSource.planCode,productCode:v.productInfo.productCode,riskEditVOList:[{insureProductRiskVO:null==(e=v.dataSource.insureProductRiskVOList)?void 0:e[0]}]}],...s[0]});if(L.isQuerying=!1,!S(i))return}console.log("投被保人的信息回传 ",i),x()},T=async(e,s)=>{var a,l,t,r;if(s){const n=i.exports.cloneDeep(e);delete n.insurancePeriodValueList,delete n.paymentFrequencyList,delete n.paymentPeriodValueList;if(O.indexOf(s.key)>=0&&`${s.oldValue}`!=`${s.newValue}`){const i={};switch(s.key){case"annuityDrawDate":i.changeType=3;break;case"coveragePeriod":i.changeType=2;break;case"chargePeriod":i.changeType=1}const o=null==(l=null==(a=L.submitData)?void 0:a.insuredList)?void 0:l[0],d=null==(r=null==(t=v.dataSource)?void 0:t.insureProductRiskVOList)?void 0:r.find((i=>i.riskCode===e.riskCode));if(!L.isAutoChange){L.isQuerying=!0;const s=await J({calcProductFactorList:[{planCode:v.dataSource.planCode,productCode:v.productInfo.productCode,riskEditVOList:[{insureProductRiskVO:d,insureRiskEditReqVO:{riskId:e.riskId,riskCode:e.riskCode,...n,...i}}]}],...o});L.isQuerying=!1;const a=S(s);return a||(L.isAutoChange=!0),a}L.isAutoChange=!1}}return!0},w=async(i,e)=>{L.mainRiskVO=i;await T(i,e)&&(L.riskList.length>0&&(L.riskList[0]=i),console.log("标准险种的信息回传",i),x())},F=async(i,e)=>{if(L.riskList=[L.mainRiskVO,...i],console.log("附加险列表数据回传",i),e){const s=i.find((i=>i.riskCode===e.riskCode));if(!(await T(s,e)))return}x()},A=i=>{var e,s,a,l;L.userData=i,L.defaultValue=i;const t=(null==(e=i.insuredList)?void 0:e[0].productList.findIndex((i=>i.planCode===v.dataSource.planCode)))||0;L.planIndex=-1===t?0:t,L.riskList=(null==(l=null==(a=null==(s=null==i?void 0:i.insuredList)?void 0:s[0].productList)?void 0:a[L.planIndex])?void 0:l.riskList)||[],P(i,!0)};t((()=>{var i,e;L.select={},L.list=[],L.userData={},L.riskIsInsure={},L.submitData={},L.riskList=[{}],L.mainRiskVO={},L.ifPersonalInfoSuccess=!1,L.trialMsg="",L.trialResultPremium=0,L.riskIsInsure={},null==(e=null==(i=null==v?void 0:v.dataSource)?void 0:i.insureProductRiskVOList)||e.forEach((i=>{var e;const s=null==(e=v.dataSource.productRiskRelationVOList)?void 0:e.find((e=>e.collocationRiskId===i.riskId));s&&(L.riskIsInsure[i.riskCode]={selected:"2",data:null,relation:s})}))})),r((()=>{L.loading=!0,L.show=!0,L.isAniShow=!0,L.isSkipFirstTrial=!0,L.hadSkipFirstTrial=!1,j((()=>{(async i=>{var e,s;if(console.log("props.defaultData",!v.defaultData),v.defaultData){const i=v.defaultData.find((i=>i.productCode===v.productInfo.productCode))||v.defaultData[0];A(i),R(null==(s=v.defaultData)?void 0:s[0])}else{const i=await X({calcProductFactorList:[{planCode:v.dataSource.planCode,productCode:v.productInfo.productCode}]});if(i.data){const s=i.data.find((i=>i.productCode===v.productInfo.productCode))||i.data[0];A(s),R(null==(e=i.data)?void 0:e[0])}}})()}))}));return u({getTrialSuccessFlag:()=>L.trialResultPremium>0,validate:()=>y.value.validate(!1),validateTrialFields:()=>y.value.validateTrialFields(),validateHolder:i=>{var e;return null==(e=y.value)?void 0:e.validateHolder(i)},getUserData:()=>({...L.userData})}),n((()=>L.riskIsInsure),(i=>{}),{deep:!0,immediate:!0}),n((()=>L.userData),(i=>{if(i){const{holder:e,insuredList:s}=i||{};Object.assign(L.submitData,{holder:e,insuredList:s})}}),{deep:!0}),(i,s)=>{var l,t,r,n,u,c,v,I;return o(),d("div",Ji,[N(i.$slots,"trialHead",{},void 0,!0),V("div",Xi,[k(Hi,{labels:p(Zi)((null==(l=a.dataSource)?void 0:l.insureProductRiskVOList)||[],a.dataSource.productRiskRelationVOList)},null,8,["labels"]),V("div",Yi,[!a.hideBenefit&&(null==(t=C.value)?void 0:t.benefitRiskResultVOList)?(o(),h($i,{key:0,class:"benefit-wrap","data-source":C.value,"product-info":a.dataSource,"show-type-list":C.value.showTypList},null,8,["data-source","product-info","show-type-list"])):m("",!0),a.dataSource.productFactor?(o(),h(p(e),{key:1,ref_key:"personalInfoRef",ref:y,modelValue:p(L).userData,"onUpdate:modelValue":s[0]||(s[0]=i=>p(L).userData=i),"is-trial":a.isTrial,"product-factor":a.dataSource.productFactor,"multi-insured-config":null==(r=a.dataSource)?void 0:r.multiInsuredConfigVO,onTrailChange:D},null,8,["modelValue","is-trial","product-factor","multi-insured-config"])):m("",!0),k(B,{ref_key:"insureInfosRef",ref:f,"origin-data":null==(n=a.dataSource.insureProductRiskVOList)?void 0:n[0],"product-factor":a.dataSource.productFactor,"default-value":p(L).defaultValue?null==(c=null==(u=p(L).defaultValue)?void 0:u.insuredList[0].productList[p(L).planIndex])?void 0:c.riskList[0]:null,"trial-result":p(L).trialResult,onTrialChange:w},null,8,["origin-data","product-factor","default-value","trial-result"]),a.dataSource.insureProductRiskVOList?(o(),h(ai,{key:2,"data-source":a.dataSource,"show-main-risk":!1,"default-value":p(L).defaultValue?null==(I=null==(v=p(L).defaultValue)?void 0:v.insuredList[0].productList[p(L).planIndex])?void 0:I.riskList:[],onTrialChange:F},null,8,["data-source","default-value"])):m("",!0),ie])]),N(i.$slots,"trialBtn",{trialData:p(L).submitData,riskPremium:p(L).trialResult,loading:p(L).isQuerying},void 0,!0)])}}}),[["__scopeId","data-v-7c02f828"]]);export{se as T};
