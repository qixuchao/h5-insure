import{q as e}from"./index-deb4ddfb.js";import{defineAsyncComponent as t,ref as l,computed as a,watch as o,nextTick as u}from"vue";import{u as n}from"./theme-65292714.js";import{P as r}from"./index-593ee4c8.js";import{o as i}from"./utils-f063477c.js";import"./pdfh5-e588f83d.js";import"./infoCollection-f930e52f.js";import"./trial-a75330fd.js";const s={key:0,class:"item"},c={key:1,class:"attachment-list"},d=["onClick"],m={class:"attachment-list-item-name"},v={class:"attachment-list-item-icon"},f={class:"footer"},V=Vue.defineComponent({name:"filePreview"}),p=Vue.defineComponent({...V,props:{show:{type:Boolean,default:!1},contentList:{default:()=>[]},activeIndex:{default:0},text:{default:""},beforeReadOverText:{default:"同意，下一条"},forceReadCount:{default:0},isOnlyView:{type:Boolean,default:!1}},emits:["update:show","submit","onCloseFilePreviewByMask"],setup(V,{emit:p}){const h=V,k=t((()=>e((()=>import("./index-deb4ddfb.js").then((function(e){return e.bg}))),["static/js/index-deb4ddfb.js","static/css/index-5064de6f.css","static/js/pdfh5-e588f83d.js"]))),b=n(),C=l(!0),w=l(h.show),B=l(h.contentList.map(((e,t)=>({...e,disabled:!0,readDisabled:!0})))),y=l(h.activeIndex),x=l(0),g=l(null),E=a((()=>{var e,t;return null==(t=null==(e=B.value)?void 0:e[y.value])?void 0:t.attachmentList})),R=a((()=>{var e;return null==(e=B.value[y.value])?void 0:e.readDisabled})),N=a((()=>!(y.value>=h.forceReadCount-1)&&(!(x.value>=h.forceReadCount)&&(x.value<h.forceReadCount&&y.value!==h.forceReadCount-1)))),P=()=>{y.value+=1},T=()=>{h.isOnlyView?p("update:show",!1):(p("update:show",!1),p("submit"))};o((()=>h),(()=>{w.value=h.show,y.value=h.activeIndex}),{deep:!0,immediate:!0});const j=e=>{var t,l,a;if(e){const o=(null==(t=e.target)?void 0:t.scrollHeight)||e.scrollHeight,u=(null==(l=e.target)?void 0:l.scrollTop)||e.scrollTop,n=(null==(a=e.target)?void 0:a.clientHeight)||e.clientHeight;Math.floor(o-u-15)<=n&&C.value&&B.value[y.value].readDisabled&&(B.value[y.value].disabled=!1,B.value[y.value].readDisabled=!1,B.value[y.value+1].disabled=!1,x.value+=1)}};return o((()=>y.value),(()=>{C.value=!1,h.show&&(x.value>=h.forceReadCount&&B.value.forEach((e=>{e.disabled=!1,e.readDisabled=!1})),setTimeout((()=>{C.value=!0}),800)),u((()=>{setTimeout((()=>{const e=document.querySelector(".viewerContainer")||document.querySelector(".com-file-preview .content");e&&(e.removeEventListener("scroll",j),j(e),e.addEventListener("scroll",j))}),2e3)}))}),{immediate:!0}),(e,t)=>{const l=Vue.resolveComponent("ProTab"),a=Vue.resolveComponent("ProSvg"),o=Vue.resolveComponent("ProPopup");return Vue.openBlock(),Vue.createBlock(o,{show:Vue.unref(w),"onUpdate:show":t[1]||(t[1]=e=>Vue.isRef(w)?w.value=e:null),class:"file-preview-popup-wrap",closeable:!1,onClose:t[2]||(t[2]=e=>p("onCloseFilePreviewByMask"))},{default:Vue.withCtx((()=>[Vue.unref(w)?(Vue.openBlock(),Vue.createBlock(l,{key:0,active:Vue.unref(y),"onUpdate:active":t[0]||(t[0]=e=>Vue.isRef(y)?y.value=e:null),list:Vue.unref(B).map(((e,t)=>({title:e.attachmentName,disabled:t!=Vue.unref(y)&&(e.disabled||!1),slotName:`guarantee-${t}`}))),class:"tab"},null,8,["active","list"])):Vue.createCommentVNode("",!0),Vue.createElementVNode("div",{ref_key:"previewRef",ref:g,class:"list"},[1===Vue.unref(E).length?(Vue.openBlock(),Vue.createElementBlock("div",s,[(Vue.openBlock(),Vue.createBlock(Vue.unref(k),{key:Vue.unref(E)[0].materialSourceDesc,content:Vue.unref(E)[0].materialContent,type:Vue.unref(E)[0].materialSource,"forbid-click":!0},null,8,["content","type"]))])):(Vue.openBlock(),Vue.createElementBlock("div",c,[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(E),((e,t)=>(Vue.openBlock(),Vue.createElementBlock("div",{key:t,class:"attachment-list-item",onClick:t=>(e=>{const t={fileType:e.materialSource,fileUri:e.materialContent};i(t)})(e)},[Vue.createElementVNode("div",m,Vue.toDisplayString(e.materialName),1),Vue.createElementVNode("div",v,[Vue.createVNode(a,{name:"arrow-right"})])],8,d)))),128))]))],512),Vue.createElementVNode("div",f,[Vue.unref(N)?(Vue.openBlock(),Vue.createBlock(r,{key:0,shadow:!1,"theme-vars":Vue.unref(b),disabled:Vue.unref(R),class:"right",text:`${e.beforeReadOverText}(${Vue.unref(y)+1}/${e.forceReadCount})`,onClick:P},null,8,["theme-vars","disabled","text"])):(Vue.openBlock(),Vue.createBlock(r,{key:1,disabled:Vue.unref(R),shadow:!1,"theme-vars":Vue.unref(b),text:h.text,onClick:T},null,8,["disabled","theme-vars","text"]))])])),_:1},8,["show"])}}});export{p as default};
