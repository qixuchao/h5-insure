import{_ as e,d as t,a_ as r,r as a,A as n,a8 as o,c as i,g as l,i as d,l as s,t as u,e as c,a9 as p,u as f,a as m,y as v,z as A,a$ as w,b0 as h,b as I,w as y,f as O,j as b,h as C,F as P,T as D,b1 as g,a0 as V}from"./index-3f4e11a7.js";import{P as j}from"./index-7cfcd13f.js";import{u as k,B as F,A as x,I as L,P as T}from"./useAddressList-b75ebcf6.js";import{_ as H,n as N}from"./nextStep-f9696783.js";import{a as E,s as B,c as Y}from"./phoneVerify-3d89c65a.js";import{p as U,g as _}from"./product-864a8146.js";import{i as M,t as S}from"./trial-0b306e41.js";import{_ as R}from"./index-af41bbe7.js";import{j as z}from"./trial-db9c8b85.js";import{v as $,f as Z}from"./utils-c17ad52c.js";import{u as G}from"./theme-edf8d8fd.js";import"./pdfdist-2833f734.js";import"./infoCollection-a8956135.js";import"./relativeTime-6197d89d.js";import"./validator-5a13dc82.js";import"./useDicData-8439e425.js";import"./core-0a5e613d.js";import"./index-ca243f8f.js";import"./useStorage-6c718bc0.js";var J="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFYAAAAeCAMAAACBgxnEAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAA8UExURUdwTPpkAPpkAPpkAPlkAPlkAP9fAPpkAP9jAPljAPljAPlkAPdhAP9VAPhlAPpjAPpiAPpkAPlhAPpkAKrbDd8AAAATdFJOUwCe3XX6YBgzC+yKwSIDTrE+0C9Hm6hZAAAAf0lEQVR42u2MSw6AIAxEi6CCf+j976ommvG3omxMOqv2vczQmZa3tPRMptdZndVZndXZf892/JGOxN68qUEr24/zk84jSvne93fae3Qk3scrjZeWzDcVaNUQIvRDOGkYQOU+hYMmsBJ+cTt1C0gZP7mNTvhL+Zq5xlfOW4tb6le9ZDBDk4RvXwAAAABJRU5ErkJggg==";const Q={class:"free-crad"},X={class:"container"},q={class:"title"},K=["src"],W=["src"];var ee=e(t({props:{colors:{type:Array,default:()=>["#CDDFFE","#F1F7FE"]},detail:{type:Object,default:()=>{}},isFirst:{type:Boolean,default:!0},insureDetail:{type:Object,default:()=>{}},previewMode:{type:Boolean,default:!1}},setup(e,{expose:t}){const f=e;r((e=>({"7c399bd7":f.colors[0],"7c399bf6":f.colors[1]})));const m=a(),v=n({factorObj:{1:[{attributeValues:null,code:"mobile",datasource:null,defaultValue:null,displayType:null,factorId:null,factorScript:null,hasDefaultValue:1,id:8249,isDisplay:1,isHidden:1,isMustInput:1,isReadOnly:null,moduleType:1,placeholder:null,planCode:null,position:null,productCode:"lin23323",productId:null,title:"手机号"},{attributeValues:null,code:"verificationCode",datasource:null,defaultValue:null,displayType:null,factorId:null,factorScript:null,hasDefaultValue:1,id:8249,isDisplay:1,isHidden:1,isMustInput:1,isReadOnly:null,moduleType:1,placeholder:null,planCode:null,position:null,productCode:"lin23323",productId:null,title:"验证码"}],2:[],3:[]},isFirst:!0}),A=async({mobile:e,type:t},r)=>{var a;if(m.value){if(f.previewMode)return void(null==r||r());null==(a=m.value)||a.validateForm(`${t}_mobile`).then((async()=>{const t=f.isFirst?E:B,a=await t(e),{code:n,data:o}=a;"10000"===n&&(null==r||r())}))}};return o((()=>f.isFirst),(()=>{var e;f.isFirst||(v.factorObj=null==(e=f.insureDetail)?void 0:e.productFactor)})),t({validateForm:()=>new Promise(((e,t)=>{m.value.validateForm().then((t=>{e(!0)})).catch((()=>{t()}))}))}),(t,r)=>(i(),l("div",Q,[d("div",X,[d("div",q,[d("img",{src:s(J)},null,8,K),d("span",null,u(e.isFirst?"凭手机号 免费领取":"最后一步 填写信息"),1),d("img",{src:s(J)},null,8,W)]),(i(),c(H,{ref_key:"formRef",ref:m,key:e.isFirst?1:2,"send-sms-code":A,"need-desensitize":"","form-info":e.detail,"factor-object":s(v).factorObj},null,8,["form-info","factor-object"])),p(t.$slots,"default",{},void 0,!0)])]))}}),[["__scopeId","data-v-6cc132c6"]]);const te={class:"page-free-product-detail"},re={class:"product-desc"},ae={key:1,class:"page-free-footer"};var ne=e(t({setup(e){r((e=>({"21560fd3":s(se).colors[1]})));const t=G(),u=f(),p=m(),{productCode:H="",agencyCode:E="",tenantId:B="",saleUserId:J="",saleChannelId:Q="",extraInfo:X,preview:q}=p.query;let K={};try{K=JSON.parse(decodeURIComponent(X))}catch(Ie){}const{openId:W,indirectCode:ne="",agentCode:oe}=K,ie=a(),le=a(),de=a(),se=n({colors:["#fff"],detail:{},order:{tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},insuredBeneficiaryType:"1",tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}]}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}},relationList:{},banner:"",productDesc:[],newAuth:!0,isValidateCode:!1,insureDetail:{},loading:!0,isSelfInsure:!0,showBtn:!1,activeIndex:0,showFilePreview:!1,isOnlyView:!0}),ue=a();W&&k({openId:W},(e=>{se.relationList=e}));const ce=v((()=>!!q)),pe=()=>{var e,t,r;const a=se.insureDetail.productRiskVoList||[];return 1===((null==(r=null==(t=null==(e=null==a?void 0:a[0])?void 0:e.riskDetailVOList)?void 0:t[0])?void 0:r.insuranceStartType)||1)?`${V(new Date).format("YYYY-MM-DD")} 00:00:00`:`${V(new Date).add(1,"day").format("YYYY-MM-DD")} 00:00:00`},fe=()=>{var e,t;const r=se.insureDetail.productRiskVoList||[],{insuranceEndType:a,riskInsureLimitVO:n}=(null==(t=null==(e=null==r?void 0:r[0])?void 0:e.riskDetailVOList)?void 0:t[0])||{},{insurancePeriodValueList:o}=n||{},[i,l]=((null==o?void 0:o[0])||"").split("_");return 1===a?`${V(new Date).add(l||0,i).format("YYYY-MM-DD")} 23:59:59`:a?`${V(new Date).add(l,i).format("YYYY-MM-DD")} 00:00:00`:""},me=async()=>{se.loading=!0;const e=U({productCode:H,withInsureInfo:!0,tenantId:B}),t=M({productCode:H}),r=_({openId:W});await Promise.all([e,t,r]).then((([e,t,r])=>{var a,n,o,i,l;if("10000"===e.code){se.detail=e.data,se.banner=null==(a=se.detail.tenantProductInsureVO)?void 0:a.banner[0];const{colorEnd:t,colorStart:r}=(null==(n=se.detail.tenantProductInsureVO)?void 0:n.backgroundInsureVO)||{};se.colors=[r,t],se.productDesc=se.detail.tenantProductInsureVO.spec||[],document.title=(null==(i=null==(o=se.detail)?void 0:o.tenantProductInsureVO)?void 0:i.productName)||""}if("10000"===t.code&&(se.insureDetail=t.data,se.insureDetail.productFactor[1].forEach((e=>{"verificationCode"===e.code&&1===e.isDisplay&&(se.isValidateCode=!0)})),se.insureDetail.productFactor[2]=null==(l=se.insureDetail.productFactor)?void 0:l[2].map((e=>{var t,r;return"relationToHolder"===e.code&&1===e.isDisplay&&(e.title="被保人",se.order.tenantOrderInsuredList[0].relationToHolder=(null==(r=null==(t=e.attributeValueList)?void 0:t[0])?void 0:r.code)||""),e}))),"10000"===r.code&&(se.newAuth=!r.data,se.isSelfInsure=!!r.data,r.data)){const e=r.data;se.order.tenantOrderHolder={certNo:null==e?void 0:e.certiNo,extInfo:{},mobile:null==e?void 0:e.mobile,name:null==e?void 0:e.name}}(()=>{var e;let t={};if(t=(null==(e=se.detail.tenantProductInsureVO.planInsureVO)?void 0:e.attachmentVOList)||[],!t)return void(ue.value=[]);const r={2:"richText",3:"link"};ue.value=Object.keys(t).map((e=>(t[e].forEach((e=>{if("1"===e.attachmentType){const t=e.attachmentUri.split("?"),r=t[0].substr(t[0].lastIndexOf(".")+1);e.attachmentType="pdf"===r?"pdf":"picture"}else e.attachmentType=r[e.attachmentType]})),{attachmentName:e,attachmentList:t[e]})))||[]})(),se.loading=!1}))},ve=async()=>{let e={loginType:"2",openId:W,thirdUserType:"XINAO_WECHAT",indirectCode:ne};try{if(se.newAuth?(e.loginName=se.order.tenantOrderHolder.mobile,e.password=se.order.tenantOrderHolder.verificationCode):e=Z({order:se.order,tenantId:B,extraInfo:K,commencementTime:pe(),expiryDate:fe(),detail:se.detail,insureDetail:se.insureDetail,iseeBizNo:ie.value,agentCode:oe,agencyCode:E,saleUserId:J,templateId:null==K?void 0:K.templateId,saleChannelId:Q,pageCode:"infoCollection",buttonCode:"EVENT_FREE_multiIssuePolicy"}),se.newAuth)if(ce.value)se.newAuth=!1;else{const{code:t,data:r}=await S(e);"10000"===t&&(se.newAuth=!1)}else N(e,((e,t)=>{t===g.JUMP_PAGE&&e.orderNo&&u.push(`/baseInsurance/orderDetail?from=free&tenantId=${B}&orderNo=${e.orderNo}&productCode=${H}`)}))}catch(t){}},Ae=async()=>await(async()=>{var e;if(ce.value)return!0;await de.value.validateForm();const t=null==(e=se.order.tenantOrderHolder)?void 0:e.verificationCode;if((se.isValidateCode||se.newAuth)&&(!t||!$(t)))return D({message:"请输入正确的验证码"}),!1;if(se.newAuth||!se.isValidateCode)return!0;const{code:r,data:a}=await Y(se.order.tenantOrderHolder.mobile,t);return!!a})()?(se.newAuth||0===ue.value.length?ve():(se.isOnlyView=!1,se.showFilePreview=!0),!1):null,we=()=>{se.showFilePreview=!1,se.isOnlyView=!0},he=()=>{se.showFilePreview=!1,se.isOnlyView=!0,ve()};return A((()=>{me(),setTimeout((async()=>{ie.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),o((()=>se.order.tenantOrderInsuredList[0]),(e=>{if(w(se.relationList)||se.newAuth)return null;const t=se.relationList[e.relationToHolder]||[];return 1===t.length&&(z.SELF!==e.relationToHolder?(se.order.tenantOrderInsuredList[0].certNo=se.order.tenantOrderInsuredList[0].certNo?se.order.tenantOrderInsuredList[0].certNo:t[0].cert[0].certNo,se.order.tenantOrderInsuredList[0].name=se.order.tenantOrderInsuredList[0].name?se.order.tenantOrderInsuredList[0].name:t[0].cert[0].certName,se.order.tenantOrderInsuredList[0].mobile=se.order.tenantOrderInsuredList[0].mobile?se.order.tenantOrderInsuredList[0].mobile:t[0].contact[0].mobile):se.isSelfInsure&&(se.isSelfInsure=!1,se.order.tenantOrderHolder.certNo=se.order.tenantOrderHolder.certNo?se.order.tenantOrderHolder.certNo:t[0].cert[0].certNo,se.order.tenantOrderHolder.name=se.order.tenantOrderHolder.name?se.order.tenantOrderHolder.name:t[0].cert[0].certName,se.order.tenantOrderHolder.mobile=se.order.tenantOrderHolder.mobile?se.order.tenantOrderHolder.mobile:t[0].contact[0].mobile)),!1}),{immediate:!0,deep:!0}),h(le,(([{isIntersecting:e}],t)=>{se.showBtn=!e})),(e,r)=>{const a=I("van-image"),n=I("van-config-provider");return i(),c(n,{"theme-vars":s(t)},{default:y((()=>{var e,t,n,o;return[d("div",te,[O(F,{url:s(se).banner},null,8,["url"]),O(ee,{ref_key:"formRef",ref:de,"is-first":s(se).newAuth,"insure-detail":s(se).insureDetail,detail:s(se).order,colors:s(se).colors,"preview-mode":s(ce)},{default:y((()=>[O(j,{ref_key:"root",ref:le,class:"submit-btn",disabled:!s(se).newAuth&&s(ce),"is-gradient":!1,text:s(se).newAuth?"立即领取":"激活保障",onClick:Ae},null,8,["disabled","text"]),!s(se).newAuth&&ue.value&&ue.value.length>0?(i(),c(x,{key:0,"attachement-list":ue.value,"has-bg-color":!1,"pre-text":"请阅读",onPreviewFile:r[0]||(r[0]=e=>(e=>{se.isOnlyView=!0,se.activeIndex=e,se.showFilePreview=!0})(e))},null,8,["attachement-list"])):b("",!0)])),_:1},8,["is-first","insure-detail","detail","colors","preview-mode"]),d("div",re,[(i(!0),l(P,null,C(s(se).productDesc,((e,t)=>(i(),c(a,{key:t,width:"100%","lazy-load":"",src:e,class:""},null,8,["src"])))),128))]),(null==(t=null==(e=s(se).detail)?void 0:e.tenantProductInsureVO)?void 0:t.inscribedContent)?(i(),c(L,{key:0,"inscribed-content":null==(o=null==(n=s(se).detail)?void 0:n.tenantProductInsureVO)?void 0:o.inscribedContent},null,8,["inscribed-content"])):b("",!0),s(se).showBtn?(i(),l("footer",ae,[O(j,{disabled:!s(se).newAuth&&s(ce),"is-gradient":!1,text:s(se).newAuth?"立即领取":"激活保障",onClick:Ae},null,8,["disabled","text"])])):b("",!0)]),s(se).showFilePreview&&0!==ue.value.length?(i(),c(R,{key:0,show:s(se).showFilePreview,"onUpdate:show":r[1]||(r[1]=e=>s(se).showFilePreview=e),"content-list":ue.value,"is-only-view":s(se).isOnlyView,"active-index":s(se).activeIndex,text:s(se).isOnlyView?"关闭":"我已逐页阅读上述内容并同意","force-read-cound":0,"on-close-file-preview":"",onSubmit:he,onOnCloseFilePreview:we},null,8,["show","content-list","is-only-view","active-index","text"])):b("",!0),s(se).loading?b("",!0):(i(),c(T,{key:1,"product-detail":s(se).detail},null,8,["product-detail"]))]})),_:1},8,["theme-vars"])}}}),[["__scopeId","data-v-78919ac3"]]);export{ne as default};
