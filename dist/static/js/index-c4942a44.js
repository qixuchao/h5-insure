var ye=Object.defineProperty,me=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var ae=Object.getOwnPropertySymbols;var Te=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable;var re=(c,r,_)=>r in c?ye(c,r,{enumerable:!0,configurable:!0,writable:!0,value:_}):c[r]=_,I=(c,r)=>{for(var _ in r||(r={}))Te.call(r,_)&&re(c,_,r[_]);if(ae)for(var _ of ae(r))Ne.call(r,_)&&re(c,_,r[_]);return c},L=(c,r)=>me(c,ge(r));import{g as Re,O as Oe,ak as Ie,E as U,d as Se,y as ne,h as ke,r as Y,j as f,k as w,m as C,z as o,p as D,J as y,n as p,L as oe,t as S,A as N,G,F as J,a4 as be,a5 as xe,C as b,T as k,D as Le}from"./vendor-e057bbeb.js";import{q as Pe}from"./index-15376f4b.js";import{_ as Ue,S as we,K as He,L as Me,q as Q,l as H,M as ie,r as le,G as $e,n as je,P as Ve,Q as z,R as M}from"./index-13719b30.js";import{_ as qe}from"./index-ff061103.js";import{f as Ye,s as ce,g as de,a as Ge}from"./verify-0a3d98b0.js";import{a as Je}from"./order-35b0e3c5.js";import{f as Qe}from"./format-c14686c5.js";const W=c=>(be("data-v-7b1bc4b6"),c=c(),xe(),c),ze={class:"page-verify"},We={class:"people"},Ke={class:"name"},Xe={class:"verify-item"},Ze=W(()=>o("div",{class:"label"},"\u8BC1\u4EF6\u53F7\u7801",-1)),et={class:"no"},tt=b(" \u53BB\u8BA4\u8BC1 "),ut={class:"sign-body"},st={class:"date"},at={class:"file"},rt=b(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A "),nt={class:"people"},ot={class:"name"},it={class:"verify-item"},lt=W(()=>o("div",{class:"label"},"\u8BC1\u4EF6\u53F7\u7801",-1)),ct={class:"no"},dt=["onClick"],Et=b(" \u53BB\u8BA4\u8BC1 "),Bt=["onClick"],ft={class:"sign-body"},_t={class:"date"},Ct={class:"file"},Dt=b(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A "),Ft={class:"footer-button footer"},pt=W(()=>o("div",{class:"text"},"\u5237\u65B0",-1)),vt=b("\u5206\u4EAB"),At=b("\u63D0\u4EA4"),ht=Re({setup(c){const r={CERT:1,NO_CERT:2},_={1:"pdf",4:"picture",2:"richText",3:"link"},P=Oe(),Ee=Ie(),{saleUserId:$="D1234567-1",tenantId:m="9991000007",templateId:Be=1,productCode:fe="CQ75CQ76",insurerCode:_e="ancheng",isShare:j}=P.query;let{orderNo:v}=P.query;typeof v=="object"&&(v=(v||[])[0]);const V=new we({source:"localStorage"}),K=U([]),X=U([]),i=U(),R=U(),g=[],Z=Se().format("YYYY-MM-DD"),ee=ne(()=>t=>{let a=1;return t.materialSource===1?t.materialContent.indexOf(".pdf")!==-1?a=1:a=4:a=t.materialSource,_[a]}),Ce=()=>{var t;(t=R.value)==null||t.clear()},De=t=>{g[t].clear()},te=(t,a)=>{Ge({callbackUrl:window.location.href,certiNo:t,faceAuthMode:"TENCENT",userName:a,tenantId:9991000007}).then(l=>{const{code:s,data:d}=l;if(s==="10000"){const{originalUrl:E,serialNo:e}=d,u=E.split("?")[0],n=Object.fromEntries(new URLSearchParams(E.split("?")[1]));n.orderNo=n.orderNo[0]||n.orderNo,window.location.href=`${u}?${Qe(n)}`,V.set("verifyData",{serialNo:e,certNo:t,name:a})}})},O=t=>`${t}`===Me.CERT,ue=t=>{var a,l,s,d;t===-1?te((a=i.value.tenantOrderHolder)==null?void 0:a.certNo,(l=i.value.tenantOrderHolder)==null?void 0:l.name):te((s=i.value.tenantOrderInsuredList[t])==null?void 0:s.certNo,(d=i.value.tenantOrderInsuredList[t])==null?void 0:d.name)},Fe=t=>{t&&g.every(a=>a!==t)&&g.push(t)},pe=()=>{var a,l,s,d,E;if((a=R.value)==null?void 0:a.isEmpty()){k.fail("\u8BF7\u6295\u4FDD\u4EBA\u7B7E\u540D");return}if(g.some(e=>e.isEmpty())){k.fail("\u8BF7\u88AB\u4FDD\u4EBA\u7B7E\u540D");return}if(((s=(l=i.value.tenantOrderHolder)==null?void 0:l.extInfo)==null?void 0:s.isCert)!==r.CERT&&O((d=i.value.tenantOrderHolder)==null?void 0:d.certType)){k.fail("\u8BF7\u6295\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}if((E=i.value.tenantOrderInsuredList)==null?void 0:E.some(e=>{var u;return((u=e.extInfo)==null?void 0:u.isCert)!==r.CERT&&O(e.certType)})){k.fail("\u8BF7\u88AB\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}le({orderNo:v,saleUserId:$,tenantId:m}).then(e=>{const{code:u,data:n}=e;u==="10000"&&(n.orderStatus!==Je.PENDING?$e("paymentResult",P.query):Le.confirm({title:"\u63D0\u793A",message:"\u8BF7\u786E\u8BA4\u4FE1\u606F\u586B\u5199\u65E0\u8BEF\u540E\uFF0C\u518D\u8FDB\u884C\u652F\u4ED8"}).then(()=>{var A,h;const B=(A=R.value)==null?void 0:A.save();Promise.all([ce("HOLDER",B,(h=i.value)==null?void 0:h.id,`${m}`),...g.map(F=>{var T;return ce("INSURED",F.save(),(T=i.value)==null?void 0:T.id,`${m}`)})]).then(()=>{je(L(I({},i.value),{pageCode:"sign",operateOption:{withSignInfo:!0},extInfo:L(I({},i.value.extInfo),{pageCode:"sign",templateId:Be,shareFlag:j?"Y":"N"}),venderCode:_e})).then(F=>{const{code:T,data:x}=F;u==="10000"&&x.success&&Ee.push({path:Ve[x.pageAction.data.nextPageCode],query:{orderNo:v,saleUserId:$,tenantId:m}})})})}))})},q=(t=!1)=>{le({orderNo:v,saleUserId:$,tenantId:m}).then(a=>{var d,E;const{code:l,data:s}=a;l==="10000"&&(i.value=s,t&&(((E=(d=s==null?void 0:s.tenantOrderHolder)==null?void 0:d.extInfo)==null?void 0:E.isCert)===r.NO_CERT||(s==null?void 0:s.tenantOrderInsuredList.some(e=>{var u;return((u=e.extInfo)==null?void 0:u.isCert)===r.NO_CERT}))?k("\u7528\u6237\u672A\u5B8C\u8EAB\u4EFD\u8BA4\u8BC1\u53CA\u7B7E\u5B57"):(!(s==null?void 0:s.tenantOrderAttachmentList.find(e=>e.category===z.ELECTRIC_SIGN&&e.objectType===M.HOLDER))||!(s==null?void 0:s.tenantOrderAttachmentList.find(e=>e.category===z.ELECTRIC_SIGN&&e.objectType===M.INSURED)))&&k("\u7528\u6237\u672A\u5B8C\u8EAB\u4EFD\u8BA4\u8BC1\u53CA\u7B7E\u5B57")),setTimeout(()=>{let e=0;s.tenantOrderAttachmentList.forEach(u=>{u.category===z.ELECTRIC_SIGN&&(u.objectType===M.HOLDER?(R.value.clear(),R.value.setDataURL(u.fileBase64)):u.objectType===M.INSURED&&(g[e].clear(),g[e].setDataURL(u.fileBase64),e+=1))})}))})},ve=()=>{q(!0)},Ae=ne(()=>{const t=L(I({},P.query),{isShare:1,sharePageCode:"sign"});return`${window.location.origin}/phoneVerify?${Pe.stringify(t)}`}),he=()=>{const t={orderNo:v,productCode:fe,tenantId:m,objectType:1};de(I({},t)).then(({code:a,data:l})=>{a==="10000"&&(X.value=l||[])}),de(L(I({},t),{objectType:2})).then(({code:a,data:l})=>{a==="10000"&&(K.value=l||[])})};return ke(()=>{q(),he();const t=V.get("verifyData");if(t){const{serialNo:a,certNo:l,name:s}=t;Ye({certiNo:l,orderNo:v,serialNo:a,tenantId:m,userName:s}).then(d=>{const{code:E,data:e}=d;E==="10000"&&(V.remove("verifyData"),q())})}}),(t,a)=>{const l=Y("ProPDFviewer"),s=Y("van-button"),d=Y("ProPageWrap");return f(),w(d,null,{default:C(()=>{var E;return[o("div",ze,[D(He,{type:"warning",title:"\u5C0A\u656C\u7684\u5BA2\u6237\uFF0C\u672C\u6B21\u6295\u4FDD\u9700\u8981\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",content:"\u672C\u4EA7\u54C1\u6295\u4FDD\u9700\u8981\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u8FDB\u884C\u5B9E\u540D\u8BA4\u8BC1\uFF0C\u60A8\u8D2D\u4E70\u672C\u4EA7\u54C1\u7684\u7D2F\u8BA1\u603B\u4FDD\u8D39\u5DF2\u8D85\u8FC720\u4E07\uFF0C\u6309\u76D1\u7BA1\u8981\u6C42\uFF0C\u9700\u8981\u63D0\u4F9B\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u3001\u6307\u5B9A\u53D7\u76CA\u4EBA\u8BC1\u4EF6\u5F71\u50CF\uFF0C\u672C\u4EA7\u54C1\u975E\u672C\u4EBA\u6295\u4FDD\u4E14\u5E26\u8EAB\u6545\u8D23\u4EFB\u3001\u9700\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\uFF08\u6210\u4EBA\uFF09\u7684\u6295\u4FDD\u610F\u613F\u8FDB\u884C\u7B7E\u5B57\u786E\u8BA4\u3002"}),D(H,{title:"\u6295\u4FDD\u4EBA",class:"card"},{extra:C(()=>{var e,u,n,B,A,h,F,T,x,se;return[o("div",We,[o("div",Ke,y((u=(e=i.value)==null?void 0:e.tenantOrderHolder)==null?void 0:u.name),1),O((B=(n=i.value)==null?void 0:n.tenantOrderHolder)==null?void 0:B.certType)?(f(),p("div",{key:0,class:oe(["status",{verified:((F=(h=(A=i.value)==null?void 0:A.tenantOrderHolder)==null?void 0:h.extInfo)==null?void 0:F.isCert)===r.CERT}])},y(((se=(x=(T=i.value)==null?void 0:T.tenantOrderHolder)==null?void 0:x.extInfo)==null?void 0:se.isCert)===r.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)):S("",!0)])]}),default:C(()=>{var e,u,n,B,A,h,F;return[o("div",Xe,[Ze,o("div",et,y((u=(e=i.value)==null?void 0:e.tenantOrderHolder)==null?void 0:u.certNo),1),((A=(B=(n=i.value)==null?void 0:n.tenantOrderHolder)==null?void 0:B.extInfo)==null?void 0:A.isCert)!==r.CERT&&O((F=(h=i.value)==null?void 0:h.tenantOrderHolder)==null?void 0:F.certType)?(f(),p("div",{key:0,class:"action",onClick:a[0]||(a[0]=T=>ue(-1))},[tt,D(Q,{name:"right_arrow",class:"icon"})])):S("",!0)])]}),_:1}),D(H,{title:"\u6295\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:C(()=>[o("div",{class:"resign",onClick:Ce},"\u91CD\u7B7E")]),default:C(()=>[D(ie,{ref_key:"holderSign",ref:R,class:"sign"},null,512),o("div",ut,[o("div",st,"\u7B7E\u540D\u65E5\u671F\uFF1A "+y(N(Z)),1),o("div",at,[rt,(f(!0),p(J,null,G(X.value,(e,u)=>(f(),w(l,{key:u,class:"file",title:`\u300A${e.materialName}\u300B`,content:e.materialContent,type:N(ee)(e)},null,8,["title","content","type"]))),128))])])]),_:1}),(f(!0),p(J,null,G((E=i.value)==null?void 0:E.tenantOrderInsuredList,(e,u)=>(f(),p("div",{key:u},[D(H,{title:"\u88AB\u4FDD\u4EBA",class:"card"},{extra:C(()=>{var n,B;return[o("div",nt,[o("div",ot,y(e.name),1),O(e.certType)?(f(),p("div",{key:0,class:oe(["status",{verified:((n=e.extInfo)==null?void 0:n.isCert)===r.CERT}])},y(((B=e.extInfo)==null?void 0:B.isCert)===r.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)):S("",!0)])]}),default:C(()=>{var n;return[o("div",it,[lt,o("div",ct,y(e.certNo),1),((n=e.extInfo)==null?void 0:n.isCert)!==r.CERT&&O(e.certType)?(f(),p("div",{key:0,class:"action",onClick:B=>ue(u)},[Et,D(Q,{name:"right_arrow",class:"icon"})],8,dt)):S("",!0)])]}),_:2},1024),D(H,{title:"\u88AB\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:C(()=>[o("div",{class:"resign",onClick:n=>De(u)},"\u91CD\u7B7E",8,Bt)]),default:C(()=>[D(ie,{ref_for:!0,ref:Fe,class:"sign"}),o("div",ft,[o("div",_t,"\u7B7E\u540D\u65E5\u671F\uFF1A "+y(N(Z)),1),o("div",Ct,[Dt,(f(!0),p(J,null,G(K.value,(n,B)=>(f(),w(l,{key:B,class:"file",title:`\u300A${n.materialName}\u300B`,content:n.materialContent,type:N(ee)(n)},null,8,["title","content","type"]))),128))])])]),_:2},1024)]))),128)),o("div",Ft,[N(j)?S("",!0):(f(),p("div",{key:0,class:"refresh-btn",onClick:ve},[o("div",null,[D(Q,{name:"refresh"})]),pt])),N(j)?S("",!0):(f(),w(qe,{key:1,title:"\u9080\u8BF7\u60A8\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",desc:"\u9080\u8BF7\u60A8\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",link:N(Ae)},{default:C(()=>[D(s,{plain:"",type:"primary",class:"share-btn"},{default:C(()=>[vt]),_:1})]),_:1},8,["link"])),D(s,{type:"primary",class:"submit-btn",onClick:pe},{default:C(()=>[At]),_:1})])])]}),_:1})}}});var St=Ue(ht,[["__scopeId","data-v-7b1bc4b6"]]);export{St as default};
