import{_ as e,d as t,u as a,a as n,r,y as o,a8 as l,z as d,b as i,c as u,e as s,w as c,f as v,i as p,t as m,l as f,j as O,a0 as I,a5 as L,L as C,M as V,T as y,a3 as h}from"./index-e0d5649a.js";import{d as j}from"./debounce-6e1aa0a4.js";import{r as b,t as P}from"./utils-e2d8634c.js";import{p as D}from"./product-778d2aed.js";import{i as R,b as g,p as w}from"./trial-883d34cb.js";import{_ as T,n as k}from"./nextStep-6c31ec39.js";import{u as x}from"./theme-126054aa.js";import{P as Y}from"./index-383071cd.js";import"./pdfh5-3b8067b2.js";import"./pdfdist-82d43a90.js";import"./infoCollection-2d7c6e58.js";import"./useStorage-80b5febf.js";import"./trial-4d97b702.js";import"./relativeTime-891cd96d.js";import"./validator-5a13dc82.js";import"./useDicData-3ec6123a.js";import"./core-bd4b3eb8.js";import"./index-012a751a.js";const B=e=>(C("data-v-091dd9db"),e=e(),V(),e),E={class:"net-sale-wrap"},N={class:"part product-name"},H=B((()=>p("span",null,null,-1))),_=B((()=>p("span",null,null,-1))),F={class:"part"},$={class:"footer"};var M=e(t({setup(e){const t=x();a();const C=n(),{productCode:V="HTEJBX",tenantId:B="9991000001",agentCode:M="",agencyCode:S,saleChannelId:z,extraInfo:A,preview:U}=C.query,q=r(),J=r(),W=r(),G=r(),X=r(),K=r({}),Q=r({}),Z=r({}),ee=r();let te={};try{te=JSON.parse(decodeURIComponent(A))}catch(se){}const ae=r({agencyId:S,agentCode:M,commencementTime:"",expiryDate:"",extInfo:{buttonCode:"EVENT_NETSALE_underWrite",pageCode:"infoCollection",templateId:null==te?void 0:te.templateId,iseeBizNo:ee,extraInfo:te},orderCategory:1,saleChannelId:z,tenantId:B,venderCode:"",tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{relationToHolder:"1",extInfo:{occupationCodeList:[]},tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}],tenantOrderProductList:[{}]}],tenantOrderSubjectList:[{extInfo:{subjectRelatedFirm:"xinao",subjectRelatedUserId:""},subjectName:"",subjectObjectType:"HOLDER",subjectType:"GENERAL",tenantId:B}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}}),ne=o((()=>{var e,t;return((null==(t=null==(e=W.value)?void 0:e.productRelationPlanVOList)?void 0:t.length)||0)>1})),re=r();l([()=>X.value,()=>G.value,()=>J.value],(()=>{var e,t;const{premium:a}=X.value||{};if(a)re.value=a&&`￥${a}元`;else{const{tenantProductInsureVO:a}=G.value||{};let n={};n=(null==(e=null==a?void 0:a.planList)?void 0:e.length)?((null==a?void 0:a.planList)||[]).find((e=>e.planCode===J.value)):null==a?void 0:a.planInsureVO;const{paymentFrequencyValue:r,premiumUnit:o}=(null==(t=null==n?void 0:n.productPremiumVOList)?void 0:t[0])||{};re.value=r&&`￥${r}${o||"元"}`}}),{deep:!0,immediate:!0});const oe=o((()=>{var e,t,a,n,r;let o=[];return o=(null==(t=null==(e=W.value)?void 0:e.productRelationPlanVOList)?void 0:t.length)?(null==(n=null==(a=W.value)?void 0:a.productRelationPlanVOList.find((e=>e.planCode===J.value)))?void 0:n.productRiskVoList)||[]:(null==(r=W.value)?void 0:r.productRiskVoList)||[],o})),le=o((()=>{var e,t,a;const n=oe.value||[];return 1===((null==(a=null==(t=null==(e=null==n?void 0:n[0])?void 0:e.riskDetailVOList)?void 0:t[0])?void 0:a.insuranceStartType)||1)?`${I(new Date).format("YYYY-MM-DD")} 00:00:00`:`${I(new Date).add(1,"day").format("YYYY-MM-DD")} 00:00:00`})),de=o((()=>{var e,t;const a=oe.value||[],{insuranceEndType:n,riskInsureLimitVO:r}=(null==(t=null==(e=null==a?void 0:a[0])?void 0:e.riskDetailVOList)?void 0:t[0])||{},{insurancePeriodValueList:o}=r||{},[l,d]=((null==o?void 0:o[0])||"").split("_");return 1===n?`${I(new Date).add(d||0,l).format("YYYY-MM-DD")} 23:59:59`:n?`${I(new Date).add(d,l).format("YYYY-MM-DD")} 00:00:00`:""})),ie=async()=>{var e;ae.value.venderCode=null==(e=W.value)?void 0:e.productBasicInfoVO.insurerCode,ae.value.orderAmount=X.value.premium,ae.value.orderRealAmount=X.value.premium,ae.value.commencementTime=le.value,ae.value.expiryDate=de.value,ae.value.extInfo.iseeBizNo=ee.value,ae.value.tenantOrderInsuredList[0].planCode=J.value,k(((e={},t={},a={})=>{var n;const r={},o=(e=[])=>{(e||[]).forEach((e=>{var t;r[e.riskCode]=e,(null==(t=e.riskPremiumDetailVOList)?void 0:t.length)&&o(e.riskPremiumDetailVOList)}))};o(t.riskPremiumDetailVOList);const l={...a},d={tenantId:B,riskList:(null==(n=Q.value)?void 0:n[0].riskVOList)||[],riskPremium:r,productId:null==e?void 0:e.productBasicInfoVO.id};return l.tenantOrderHolder.certType=l.tenantOrderHolder.certType||h.CERT,l.tenantOrderInsuredList[0].certType=l.tenantOrderInsuredList[0].certType||h.CERT,l.tenantOrderInsuredList[0].tenantOrderProductList=[{premium:X.value.premium,productCode:e.productBasicInfoVO.productCode,productName:e.productBasicInfoVO.productName,tenantOrderRiskList:P(d)}],l})(W.value,X.value,ae.value),((e,t)=>{"jumpToPage"===t&&y("提交成功")}))},ue=async()=>{var e;null==(e=q.value)||e.validateForm().then((()=>{L.confirm({title:"分享",message:`即将向客户【${ae.value.tenantOrderHolder.name}】发送投保确认信息,请确认是否继续？`}).then((()=>{U||ie()}))}))};l([()=>ae.value.tenantOrderHolder.gender,()=>ae.value.tenantOrderHolder.name,()=>ae.value.tenantOrderHolder.birthday,()=>{var e;return null==(e=ae.value.tenantOrderInsuredList)?void 0:e[0].name},()=>{var e;return null==(e=ae.value.tenantOrderInsuredList)?void 0:e[0].gender},()=>{var e;return null==(e=ae.value.tenantOrderInsuredList)?void 0:e[0].birthday},()=>J.value],j((([e,t,a,n,r,o])=>{t&&n&&r&&o&&(U||(async(e,t,a)=>{var n;const r={holder:{personVO:{certType:1,...e.tenantOrderHolder}},insuredVOList:e.tenantOrderInsuredList.map((e=>({insuredCode:"",personVO:{...e,certType:1},productPlanVOList:[{insurerCode:t.productBasicInfoVO.insurerCode,planCode:J.value||0,riskVOList:b(a)}]}))),productCode:t.productBasicInfoVO.productCode,tenantId:B},{code:o}=await g(r);if("10000"===o){const{code:e,data:t}=await w(r);"10000"===e?(X.value=t,Q.value=null==(n=r.insuredVOList[0])?void 0:n.productPlanVOList):X.value=null}})(ae.value,W.value,oe.value))}),500));return l((()=>J.value),(()=>{K.value&&(Z.value=K.value[J.value])})),d((()=>{D({productCode:V,withInsureInfo:!0,tenantId:B}).then((({code:e,data:t})=>{var a;"10000"===e&&(G.value=t,document.title=(null==(a=t.tenantProductInsureVO)?void 0:a.productNam)||"")})),R({productCode:V}).then((({code:e,data:t})=>{var a;"10000"===e&&(W.value=t,K.value=t.planFactor,(null==(a=t.productRelationPlanVOList)?void 0:a.length)&&(J.value=t.productRelationPlanVOList[0].planCode),t.productFactor?Z.value=t.productFactor:t.planFactor&&(Z.value=t.planFactor[J.value]))})),setTimeout((async()=>{ee.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,a)=>{const n=i("ProRadioButton"),r=i("ProCard"),o=i("ProCell"),l=i("ProPageWrap"),d=i("van-config-provider");return u(),s(d,{"theme-vars":f(t)},{default:c((()=>[v(l,null,{default:c((()=>{var e,t;return[p("div",E,[p("div",N,m(null==(t=null==(e=W.value)?void 0:e.productBasicInfoVO)?void 0:t.productFullName),1),f(ne)?(u(),s(r,{key:0,"show-line":!1,title:"保障年期"},{default:c((()=>{var e;return[v(n,{modelValue:J.value,"onUpdate:modelValue":a[0]||(a[0]=e=>J.value=e),class:"radio-group",prop:{label:"planName",value:"planCode"},options:null==(e=W.value)?void 0:e.productRelationPlanVOList},null,8,["modelValue","options"])]})),_:1})):O("",!0),v(T,{ref_key:"formRef",ref:q,"title-collection":{HOLDER:"投保人",INSURER:"被保人",BENEFICIARY:"收益人"},"need-desensitize":"","form-info":ae.value,"send-sms-code":()=>{},"input-align":"left","factor-object":Z.value},{holderName:c((()=>[H])),insurerName:c((()=>[_])),_:1},8,["form-info","send-sms-code","factor-object"]),p("div",F,[v(o,{title:"保费",content:re.value},null,8,["content"]),v(o,{title:"保障期间",content:`${f(le).split(" ")[0]}~${f(de).split(" ")[0]}`},null,8,["content"])]),p("div",$,[v(Y,{shadow:!1,text:"分享用户确认投保",onClick:ue})])])]})),_:1})])),_:1},8,["theme-vars"])}}}),[["__scopeId","data-v-091dd9db"]]);export{M as default};
