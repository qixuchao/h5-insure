import{d as e,i as t,h as a,j as n,k as o,aG as i,l as s,o as r,c as u,u as c,p as l,bL as d,w as p,a as f,v as m,f as v,b as y,c5 as h,aN as b,dG as g,ar as q,an as j,aQ as T,dF as w,c4 as I,c6 as N,T as x}from"./index-317fe516.js";import{l as C}from"./product-b2900c6a.js";import{O,Q as k}from"./questionnaire-42dcb602.js";import{g as $}from"./utils-6bcd1a83.js";import{n as _}from"./nextStep-a99ccab9.js";import{u as L}from"./useOrder-c2fee243.js";import{g as P}from"./trial-aa1d6cf6.js";import{Q as R}from"./notice-33e6eedd.js";import{N as V}from"./data-b55e8045.js";import{P as A}from"./constants-a91dacd0.js";import"./infoCollection-73b145a3.js";import"./trial-1b3459d5.js";import"./core-5b4c0234.js";const B={class:"long-health-notice-wrap"},E={class:"footer-button"},Q=e({__name:"healthNotice",setup(e){const Q=t(),D=a(),G=L(),{orderNo:S,tenantId:U,preview:z,agentCode:J,questionnaireId:M}=Q.query,F=n({}),H=n(),W=n(),X=n(),K=n([]),Y=n({orderNo:S,tenantId:U,noticeType:W}),Z=n(),ee=n(),te=n(!1),ae=n(),ne=()=>{H.value?D.push({path:`${A.questionNotice}/${H.value}`,query:{...Q.query,questionnaireId:H.value}}):b.confirm({title:"告知提醒",message:V.join("\n"),confirmButtonText:"确定",messageAlign:"left",className:"notice-dialog"}).then((()=>{z?D.push({path:A.infoPreview,query:Q.query}):(G.value.extInfo.buttonCode=g.short.saveNoticeNextPage,G.value.extInfo.pageCode="healthNotice",_(G.value,((e,t,a)=>{t===T.JUMP_PAGE?D.push({path:A[e.nextPageCode],query:Q.query}):t===T.JUMP_ALERT&&"faceAuth"===e.alertType&&b.confirm({message:a,confirmButtonText:"去分享",cancelButtonText:"被保人确认"}).then((()=>{const e={...Q.query,isShare:1,orderNo:S,agentCode:J,objectType:"insured",origin:"share"};Z.value={title:"标题",desc:"描述",imageUrl:w,url:`${window.location.origin}${window.location.pathname}?${I.stringify(e)}`,link:`${window.location.origin}${window.location.pathname}?${I.stringify(e)}`},ee.value.handleShare(Z.value),te.value=!0,ae.value.run()})).catch((()=>{D.push({path:A.faceVerify,query:{...Q.query,objectType:"insured",origin:"confirm"}})}))})))}))},oe=n([]),ie=o((()=>!(!oe.value.length||W.value!==O.HOLDER)&&!!oe.value.find((e=>`${e.id}`===M)))),se=()=>{const e=K.value.find((e=>e.id===X.value));Object.assign(F.value,null==e?void 0:e.questionnaireDetailResponseVO)},re=async()=>{const{code:e,data:t}=await P({orderNo:S,tenantId:U});if("10000"===e){Object.assign(G.value,t,{extInfo:{...t.extInfo,pageCode:"healthNotice",buttonCode:g.short.saveNotice}});const e=t.insuredList[0].productList.map((e=>e.productCode));Y.value.objectId=t.insuredList[0].id,(async e=>{var t;const{code:a,data:n}=await N({orderNo:S,tenantId:U});"10000"===a&&(K.value=n.productQuestionnaireVOList);const{code:o,data:i}=await C(e);if("10000"===o){const{productQuestionnaireVOList:e}=i||{},a=e.filter((e=>e.businessType===R.NEW_CONTRACT&&-1!==e.noticeObject));(null==a?void 0:a.length)||x("未匹配到健康告知问卷"),oe.value=a;let n=a[0]||{};if((null==a?void 0:a.length)>1)if(M){const e=a.findIndex((e=>`${e.id}`===M));a[e]&&(n=a[e]),a[e+1]&&(H.value=a[e+1].id)}else H.value=null==(t=a[1])?void 0:t.id;const{questionnaireDetailResponseVO:o,questionnaireId:s,questionnaireName:r,noticeObject:u}=n||{},{questions:c,basicInfo:l}=o||{},{questionnaireType:d}=l||{};if(W.value=u,X.value=s,d===k.TEXT){const{content:e,textType:t}=(null==c?void 0:c[0])||{};F.value={content:e,contentType:$(`${t}`,e),questionnaireId:s,questionnaireName:r}}else{const e=(K.value||[]).find((e=>e.questionnaireId===X.value&&e.noticeObject===W.value));F.value={...o,questionnaireId:s,contentType:"question",...null==e?void 0:e.questionnaireDetailResponseVO}}}})({productCodeList:e})}};i((()=>{!z&&re()}));const ue=n();return s((()=>{setTimeout((async()=>{ue.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,t)=>{const a=q,n=j;return r(),u("div",B,[c(F)?(r(),l(h,{key:0,type:c(F).contentType,content:c(F),params:c(Y),"success-callback":ne},d({_:2},["question"===c(F).contentType&&c(F).questionnaireId?{name:"footer",fn:p((()=>[f("div",E,[c(ie)?(r(),l(a,{key:0,round:"",type:"primary",plain:"",onClick:se},{default:p((()=>[m("同被保人")])),_:1})):v("",!0),y(a,{round:"",type:"primary",block:"","native-type":"submit"},{default:p((()=>[m(" 下一步 ")])),_:1})])])),key:"0"}:{name:"footer-btn",fn:p((()=>[f("div",{class:"footer-btn"},[y(a,{round:"",type:"primary",block:"",onClick:ne},{default:p((()=>[m(" 下一步 ")])),_:1})])])),key:"1"}]),1032,["type","content","params"])):v("",!0),y(n,{ref_key:"shareRef",ref:ee},null,512)])}}});export{Q as default};
