var ie=Object.defineProperty,le=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable;var K=(u,n,v)=>n in u?ie(u,n,{enumerable:!0,configurable:!0,writable:!0,value:v}):u[n]=v,V=(u,n)=>{for(var v in n||(n={}))de.call(n,v)&&K(u,v,n[v]);if(J)for(var v of J(n))ve.call(n,v)&&K(u,v,n[v]);return u},X=(u,n)=>le(u,ce(n));import{g as q,r as I,p as oe,ad as fe,o as f,i as D,j as t,J as E,O as $,a1 as Z,H as A,$ as Q,v as _e,K as Be,d as De,A as ee,E as Ee,B as p,t as g,k as R,F as M,G as Y,P as Fe,Q as he,T as te,D as pe}from"./vendor-8d9a202a.js";import{_ as G,S as ge,g as ue,N as U,P as Ce}from"./index-e25d276f.js";import{P as H}from"./index-29abeb96.js";import{g as Ae,f as me,s as se,a as ye}from"./verify-6f6864c8.js";import{a as ke,n as Ie}from"./index-06a2eef5.js";const Se={class:"com-sign-wrapper"},be={key:0,class:"placeholder"},Ne=q({props:{options:{type:Object,default:()=>{}},placeholder:{type:String,default:"\u8BF7\u8F93\u5165"}},setup(u,{expose:n}){const v=u,_=I(),m=I(),h=I(),w=I(!0);I({options:V({penColor:"rgb(0, 0, 0)",backgroundColor:"rgb(255,255,255)"},v.options),disabled:!1});const T=(a="image/png",b=.8)=>{var C,L,N,P;return console.log("length",(L=(C=_.value)==null?void 0:C.toDataURL)==null?void 0:L.call(C,a,b).length),(P=(N=_.value)==null?void 0:N.toDataURL)==null?void 0:P.call(N,a,b)},x=()=>{var a;(a=_.value)==null||a.off()},S=()=>{var a;(a=_.value)==null||a.off()},l=()=>{var a;return(a=_.value)==null?void 0:a.isEmpty()},y=()=>{var a;(a=_.value)==null||a.clear(),w.value=!0},k=(a,b={ratio:1})=>{var C;y(),(C=_.value)==null||C.fromDataURL(a,b),w.value=!1};return oe(()=>{m.value&&h.value&&(m.value.width=h.value.getBoundingClientRect().width,m.value.height=h.value.getBoundingClientRect().height,_.value=new fe(m.value),_.value.addEventListener("beginStroke",()=>{w.value=!1}))}),n({save:T,isEmpty:l,clear:y,setDataURL:k,lockSign:x,unlockSign:S}),(a,b)=>(f(),D("div",Se,[t("div",{ref_key:"container",ref:h,class:"sign-container"},[w.value?(f(),D("div",be,E(u.placeholder),1)):$("",!0),t("canvas",{ref_key:"canvas",ref:m,class:"canvas"},null,512)],512)]))}});var ae=G(Ne,[["__scopeId","data-v-2d04db05"]]);const Oe={key:0,class:"message-title"},we={class:"message-content"},Re=q({props:{type:{default:"warning"},title:{default:""},content:{default:""}},setup(u){return(n,v)=>(f(),D("div",{class:Q(`com-message-wrapper ${u.type}`)},[u.title?(f(),D("div",Oe,[Z(n.$slots,"title",{},()=>[A(E(u.title),1)],!0)])):$("",!0),t("div",we,[Z(n.$slots,"content",{},()=>[A(E(u.content),1)],!0)])],2))}});var $e=G(Re,[["__scopeId","data-v-b66f4d6a"]]);const ne=u=>(Fe("data-v-5ed1f3b2"),u=u(),he(),u),xe={class:"page-verify"},Le={class:"people"},Pe={class:"name"},Ue={class:"verify-item"},He=ne(()=>t("div",{class:"label"},"\u8EAB\u4EFD\u8BC1\u53F7\u7801",-1)),Te={class:"no"},je=A(" \u53BB\u8BA4\u8BC1 "),Ve={class:"sign-body"},Me={class:"date"},Ye={class:"file"},Qe=A(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A"),qe={key:0,class:"dun-hao"},Ge={class:"people"},We={class:"name"},ze={class:"verify-item"},Je=ne(()=>t("div",{class:"label"},"\u8EAB\u4EFD\u8BC1\u53F7\u7801",-1)),Ke={class:"no"},Xe=["onClick"],Ze=A(" \u53BB\u8BA4\u8BC1 "),et=["onClick"],tt={class:"sign-body"},ut={class:"date"},st={class:"file"},at=A(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A"),ot={key:0,class:"dun-hao"},nt={class:"footer-button footer"},rt=A("\u63D0\u4EA4"),it=q({setup(u){const n=_e(),v=Be(),{orderNo:_="2022072810590219649",saleUserId:m="D1234567-1",tenantId:h="9991000007",templateId:w=1,productCode:T="CQ75CQ76"}=n.query,x=new ge({source:"localStorage"}),S=I([]),l=I(),y=I(),k=[],a=De().format("YYYY-MM-DD"),b=()=>{var o;(o=y.value)==null||o.clear()},C=o=>{k[o].clear()},L=(o,r)=>{ye({callbackUrl:window.location.href,certiNo:o,faceAuthMode:"TENCENT",userName:r,tenantId:9991000007}).then(c=>{const{code:d,data:B}=c;if(d==="10000"){const{originalUrl:e,serialNo:i}=B;window.location.href=e,x.set("verifyData",{serialNo:i,certNo:o,name:r})}})},N=o=>{var r,c,d,B;o===-1?L((r=l.value.tenantOrderHolder)==null?void 0:r.certNo,(c=l.value.tenantOrderHolder)==null?void 0:c.name):L((d=l.value.tenantOrderInsuredList[o])==null?void 0:d.certNo,(B=l.value.tenantOrderInsuredList[o])==null?void 0:B.name)},P=o=>{o&&k.every(r=>r!==o)&&k.push(o)},re=()=>{var r;if((r=y.value)==null?void 0:r.isEmpty()){te.fail("\u8BF7\u6295\u4FDD\u4EBA\u7B7E\u540D");return}if(k.some(c=>c.isEmpty())){te.fail("\u8BF7\u88AB\u4FDD\u4EBA\u7B7E\u540D");return}pe.confirm({title:"\u63D0\u793A",message:"\u8BF7\u786E\u8BA4\u4FE1\u606F\u586B\u5199\u65E0\u8BEF\u540E\uFF0C\u518D\u8FDB\u884C\u652F\u4ED8"}).then(()=>{var d,B;const c=(d=y.value)==null?void 0:d.save();Promise.all([se("HOLDER",c,(B=l.value)==null?void 0:B.id,`${h}`),...k.map(e=>{var i;return se("INSURED",e.save(),(i=l.value)==null?void 0:i.id,`${h}`)})]).then(()=>{Ie(X(V({},l.value),{pageCode:"sign",operateOption:{withSignInfo:!0},extInfo:{pageCode:"sign",templateId:w}})).then(e=>{const{code:i,data:s}=e;i==="10000"&&s.success&&v.push({path:Ce[s.pageAction.data.nextPageCode],query:{orderNo:_,saleUserId:m,tenantId:h}})})})})};return oe(()=>{ke({orderNo:_,saleUserId:m,tenantId:h}).then(r=>{const{code:c,data:d}=r;if(c==="10000"){l.value=d;let B=0;d.tenantOrderAttachmentList.forEach(e=>{e.category===21&&(e.objectType===2?y.value.setDataURL(e.fileBase64):e.objectType===1&&(k[B].setDataURL(e.fileBase64),B+=1))})}}),Ae({orderNo:_,productCode:T,tenantId:h}).then(r=>{const{code:c,data:d}=r;c==="10000"&&(S.value=d||[])});const o=x.get("verifyData");if(o){const{serialNo:r,certNo:c,name:d}=o;me({certiNo:c,orderNo:_,serialNo:r,tenantId:h,userName:d}).then(B=>{x.remove("verifyData")})}}),(o,r)=>{const c=ee("van-button"),d=ee("ProPageWrap");return f(),Ee(d,null,{default:p(()=>{var B;return[t("div",xe,[g($e,{type:"warning",title:"\u5C0A\u656C\u7684\u5BA2\u6237\uFF0C\u672C\u6B21\u6295\u4FDD\u9700\u8981\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",content:"\u672C\u4EA7\u54C1\u6295\u4FDD\u9700\u8981\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u8FDB\u884C\u5B9E\u540D\u8BA4\u8BC1\uFF0C\u60A8\u8D2D\u4E70\u672C\u4EA7\u54C1\u7684\u7D2F\u8BA1\u603B\u4FDD\u8D39\u5DF2\u8D85\u8FC720\u4E07\uFF0C\u6309\u76D1\u7BA1\u8981\u6C42\uFF0C\u9700\u8981\u63D0\u4F9B\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u3001\u6307\u5B9A\u53D7\u76CA\u4EBA\u8BC1\u4EF6\u5F71\u50CF\uFF0C\u672C\u4EA7\u54C1\u975E\u672C\u4EBA\u6295\u4FDD\u4E14\u5E26\u8EAB\u6545\u8D23\u4EFB\u3001\u9700\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\uFF08\u6210\u4EBA\uFF09\u7684\u6295\u4FDD\u610F\u613F\u8FDB\u884C\u7B7E\u5B57\u786E\u8BA4\u3002"}),g(H,{title:"\u6295\u4FDD\u4EBA",class:"card"},{extra:p(()=>{var e,i,s,F,O,j,W,z;return[t("div",Le,[t("div",Pe,E((i=(e=l.value)==null?void 0:e.tenantOrderHolder)==null?void 0:i.name),1),t("div",{class:Q(["status",{verified:(O=(F=(s=l.value)==null?void 0:s.tenantOrderHolder)==null?void 0:F.extInfo)==null?void 0:O.isCert}])},E(((z=(W=(j=l.value)==null?void 0:j.tenantOrderHolder)==null?void 0:W.extInfo)==null?void 0:z.isCert)?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)])]}),default:p(()=>{var e,i,s,F,O;return[t("div",Ue,[He,t("div",Te,E((i=(e=l.value)==null?void 0:e.tenantOrderHolder)==null?void 0:i.certNo),1),((O=(F=(s=l.value)==null?void 0:s.tenantOrderHolder)==null?void 0:F.extInfo)==null?void 0:O.isCert)?$("",!0):(f(),D("div",{key:0,class:"action",onClick:r[0]||(r[0]=j=>N(-1))},[je,g(ue,{name:"right_arrow",class:"icon"})]))])]}),_:1}),g(H,{title:"\u6295\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:p(()=>[t("div",{class:"resign",onClick:b},"\u91CD\u7B7E")]),default:p(()=>[g(ae,{ref_key:"holderSign",ref:y,class:"sign"},null,512),t("div",Ve,[t("div",Me,"\u7B7E\u540D\u65E5\u671F\uFF1A "+E(R(a)),1),t("div",Ye,[Qe,(f(!0),D(Y,null,M(S.value.filter(e=>e.noticeObject===R(U).HOLDER),(e,i)=>(f(),D("span",{key:i,class:"file-name"},[A(E(`\u300A${e.materialName}\u300B`),1),i!==S.value.filter(s=>s.noticeObject===R(U).HOLDER).length-1?(f(),D("span",qe,"\u3001")):$("",!0)]))),128))])])]),_:1}),(f(!0),D(Y,null,M((B=l.value)==null?void 0:B.tenantOrderInsuredList,(e,i)=>(f(),D("div",{key:i},[g(H,{title:"\u88AB\u4FDD\u4EBA",class:"card"},{extra:p(()=>{var s,F;return[t("div",Ge,[t("div",We,E(e.name),1),t("div",{class:Q(["status",{verified:(s=e.extInfo)==null?void 0:s.isCert}])},E(((F=e.extInfo)==null?void 0:F.isCert)?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)])]}),default:p(()=>{var s;return[t("div",ze,[Je,t("div",Ke,E(e.certNo),1),((s=e.extInfo)==null?void 0:s.isCert)?$("",!0):(f(),D("div",{key:0,class:"action",onClick:F=>N(i)},[Ze,g(ue,{name:"right_arrow",class:"icon"})],8,Xe))])]}),_:2},1024),g(H,{title:"\u88AB\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:p(()=>[t("div",{class:"resign",onClick:s=>C(i)},"\u91CD\u7B7E",8,et)]),default:p(()=>[g(ae,{ref_for:!0,ref:P,class:"sign"}),t("div",tt,[t("div",ut,"\u7B7E\u540D\u65E5\u671F\uFF1A "+E(R(a)),1),t("div",st,[at,(f(!0),D(Y,null,M(S.value.filter(s=>s.noticeObject===R(U).INSURED),(s,F)=>(f(),D("span",{key:F,class:"file-name"},[A(E(`\u300A${s.materialName}\u300B`),1),F!==S.value.filter(O=>O.noticeObject===R(U).INSURED).length-1?(f(),D("span",ot,"\u3001")):$("",!0)]))),128))])])]),_:2},1024)]))),128)),t("div",nt,[g(c,{type:"primary",class:"submit-btn",onClick:re},{default:p(()=>[rt]),_:1})])])]}),_:1})}}});var Bt=G(it,[["__scopeId","data-v-5ed1f3b2"]]);export{Bt as default};
