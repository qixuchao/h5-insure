var pe=Object.defineProperty,me=Object.defineProperties;var fe=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var W=(n,u,s)=>u in n?pe(n,u,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[u]=s,F=(n,u)=>{for(var s in u||(u={}))X.call(u,s)&&W(n,s,u[s]);if(T)for(var s of T(u))Q.call(u,s)&&W(n,s,u[s]);return n},E=(n,u)=>me(n,fe(u));var Z=(n,u)=>{var s={};for(var f in n)X.call(n,f)&&u.indexOf(f)<0&&(s[f]=n[f]);if(n!=null&&T)for(var f of T(n))u.indexOf(f)<0&&Q.call(n,f)&&(s[f]=n[f]);return s};import{g as _e,ak as ge,O as ke,E as h,M as Pe,a6 as ve,_ as ye,o as he,r as y,j as _,k as D,m as g,A as o,n as V,p as m,t as L,z as R,F as Ce,G as Ve,J as Le,C as N}from"./vendor-df2d8bed.js";import{P as $,R as ee,i as Re,p as Oe}from"./trial-9000068f.js";import{q as De}from"./createProposal-6aab6270.js";import{_ as Ie,n as Be,P as Te,g as Fe}from"./index-87784872.js";import{u as Ne}from"./useStorage-3b29dc10.js";import{P as be,I as Ee}from"./trial-c8eb8ed0.js";import"./useDicData-0fdeb116.js";const Ae={key:0,class:"part-card"},Se={key:1,class:"part-card"},xe={class:"risk-content"},qe={key:0,class:"risk"},je={key:1,class:"plan-risk"},Ue={class:"footer-bar"},Me={class:"trial-result"},we={class:"result-num"},Ye=N(" \u5143\u8D77 "),Je={class:"trial-operate"},ze={key:0,class:"retrial-tip"},Ge=N(" \u6761\u4EF6\u66F4\u6539\u540E\uFF0C\u9700\u8981\u91CD\u65B0\u8BD5\u7B97 "),He=N("\u53BB\u8BD5\u7B97"),Ke=N("\u7ACB\u5373\u6295\u4FDD"),We=_e({setup(n){var Y,J;const u=ge(),s=ke(),{templateId:f=1,agentCode:te="test",agencyCode:re="",tenantId:A=9991000007,venderCode:ae="99",proposalId:S}=s.query;let{productCode:x="MMBBSF"}=s.query;const I=h({personVO:{occupationCodeList:[]}}),B=h({insuredCode:"",personVO:{occupationCodeList:[]}}),C=h({}),q=h({}),j=h({}),b=h({}),U=h({}),e=Pe({currentPlan:"",riskBaseInfo:{},holderFactor:[],insuredFactor:[],riskData:[],riskPlanData:[],trialResult:{},canTrial:!0,retrialTip:!1,enumList:{},ageRange:[],collapseName:["1"],insuredRiskList:[],currentRiskList:[]});if(S)try{x=(J=JSON.parse(((Y=s.query)==null?void 0:Y.extInfo)||"{}"))==null?void 0:J.productCenterCode}catch(a){console.log(a)}ve("premium",U.value),Ne().get("userInfo");const M="premiumTrial",oe=()=>{e.retrialTip=!1},ie=(a,r)=>{e.insuredRiskList=a.map(t=>{var i,d;return{initialAmount:(i=r[t.riskCode])==null?void 0:i.amount,amountUnit:1,paymentFrequency:t.paymentFrequency,paymentPeriod:t.chargePeriod.split("_")[1],paymentPeriodType:be[t.chargePeriod.split("_")[0]],insurancePeriodType:Ee[t.coveragePeriod==="to_life"?"to_life":t.coveragePeriod.split("_")[0]],insurancePeriodValue:Number.isNaN(+t.coveragePeriod.split("_")[1])?0:t.coveragePeriod.split("_")[1],riskCode:t.riskCode,riskType:t.riskType,initialPremium:(d=r[t.riskCode])==null?void 0:d.premium}})},se=()=>{Be({agencyId:re,saleUserId:te,tenantId:A,venderCode:ae,orderDataSource:1,pageCode:M,extInfo:{templateId:+(f||1),pageCode:M,iseeBizNo:window.iseeBiz},tenantOrderHolder:{},tenantOrderInsuredList:[{tenantOrderProductList:[{productCode:e.riskBaseInfo.productCode||"",productName:e.riskBaseInfo.productName||"",premium:e.trialResult.premium||0,tenantOrderRiskList:e.insuredRiskList}]}]}).then(({code:a,data:r})=>{a==="10000"&&r.pageAction.pageAction==="jumpToPage"&&u.push({path:Te[r.pageAction.data.nextPageCode],query:E(F({},s.query),{orderNo:r.pageAction.data.orderNo})})})},ne=()=>{const a=JSON.parse(JSON.stringify(C.value[e.currentPlan])),r=Object.values(a).find(i=>i.riskType===1),t=Object.values(a).map(i=>{const d=i;if(d.chargePeriod==="3"){const c=(r.chargePeriod||"").split("_");c[1]&&(c[1]-=1),d.chargePeriod=c.join("_")}return d.liabilityVOList=(d.liabilityVOList||[]).filter(c=>c.optionalFlag===1||c.liabilityAttributeValue&&c.liabilityAttributeValue!=="-1").map(c=>{const k=c;return k.liabilityAttributeValue==="0"&&(k.liabilityAttributeValue=""),k}),d}),l={holder:I.value,productCode:e.riskBaseInfo.productCode,insuredVOList:[E(F({},B.value),{productPlanVOList:[{planCode:e.currentPlan||"",riskVOList:t}]})]};Oe(F({},l)).then(({code:i,data:d})=>{if(i==="10000"){e.retrialTip=!1,e.trialResult=d,e.canTrial=!1;const c={},k=(O=[])=>{(O||[]).forEach(P=>{var v;c[P.riskCode]=P,((v=P.riskPremiumDetailVOList)==null?void 0:v.length)&&k(P.riskPremiumDetailVOList)})};k(d.riskPremiumDetailVOList),ie(l.insuredVOList[0].productPlanVOList[0].riskVOList,c),Object.assign(U.value,c)}})},le=()=>{var a,r,t,l,i;Promise.all([(r=(a=q.value)==null?void 0:a.validateForm)==null?void 0:r.call(a),(l=(t=j.value)==null?void 0:t.validateForm)==null?void 0:l.call(t),(i=b.value)==null?void 0:i.validate()]).then(()=>{ne()})},ue=()=>{Fe({dictCodeList:["RISK_PAYMENT_PERIOD","RISK_INSURANCE_PERIOD"]}).then(({code:r,data:t})=>{if(r==="10000"){const l={};t.forEach(i=>{l[i.dictCode]=i.dictItemList}),e.enumList=l}})},ce=a=>{De({id:S,tenantId:A}).then(({code:r,data:t})=>{var l,d;if(r==="10000"){const i=((l=t.proposalInsuredList)==null?void 0:l[0])||{},{proposalInsuredProductList:c=[]}=i,k=Z(i,["proposalInsuredProductList"]);Object.assign(I.value.personVO,t.proposalHolder),Object.assign(B.value.personVO,k);const O=(d=c.find(v=>v.productId===a))==null?void 0:d.proposalProductRiskList,P={};O.forEach(v=>{P[v.riskId]=v}),Object.assign(C.value,{0:P})}})},de=()=>{Re({productCode:x,source:1}).then(({code:a,data:r})=>{var t;a==="10000"&&(e.riskBaseInfo=r.productBasicInfoVO,(r.productRelationPlanVOList.length?r.productRelationPlanVOList:r.productRiskVoList[0].riskDetailVOList||[]).forEach((l,i)=>{i===0&&(e.currentPlan=l.planCode||"0"),Object.assign(C.value,{[l.planCode||i]:{}})}),e.riskData=((t=r.productRiskVoList[0])==null?void 0:t.riskDetailVOList)||[],e.riskPlanData=r.productRelationPlanVOList||[],ce(r.productBasicInfoVO.id))}).finally(()=>{})},w=a=>{e.holderFactor=a.holderFactorList,e.insuredFactor=a.insuredFactorList,e.ageRange=a.ageRange};return ye([()=>C.value,()=>I.value,()=>B.value],a=>{a&&!e.canTrial&&(e.canTrial=!0,e.retrialTip=!0)},{deep:!0}),he(()=>{de(),ue()}),(a,r)=>{const t=y("ProTitle"),l=y("VanForm"),i=y("ProTabButton"),d=y("VanTab"),c=y("VanTabs"),k=y("van-collapse-item"),O=y("van-collapse"),P=y("VanButton"),v=y("ProPageWrap");return _(),D(v,{class:"page-trial-wrapper"},{default:g(()=>{var z,G,H;return[o(e).holderFactor.length?(_(),V("div",Ae,[m(t,{title:"\u6295\u4FDD\u4EBA"}),m($,{ref_key:"holderRef",ref:q,"insured-code":(z=o(e).riskBaseInfo)==null?void 0:z.insurerCode,"form-info":I.value.personVO,"factor-list":o(e).holderFactor,"age-range":o(e).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):L("",!0),o(e).insuredFactor.length?(_(),V("div",Se,[m(t,{title:"\u88AB\u4FDD\u4EBA"}),m($,{ref_key:"insuredRef",ref:j,"insured-code":(G=o(e).riskBaseInfo)==null?void 0:G.insurerCode,"form-info":B.value.personVO,"factor-list":o(e).insuredFactor,"age-range":o(e).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):L("",!0),R("div",xe,[m(O,{modelValue:o(e).collapseName,"onUpdate:modelValue":r[1]||(r[1]=p=>o(e).collapseName=p)},{default:g(()=>[m(k,{name:"1"},{title:g(()=>[m(t,{title:"\u6295\u4FDD\u65B9\u6848"})]),default:g(()=>[o(e).riskData.length?(_(),V("div",qe,[m(l,{ref_key:"riskFormRef",ref:b,"input-align":"right","error-message-align":"right"},{default:g(()=>[m(ee,{"risk-info":C.value[0],enums:o(e).enumList,"origin-data":o(e).riskData,"pick-factor":w},null,8,["risk-info","enums","origin-data"])]),_:1},512)])):L("",!0),o(e).riskPlanData.length?(_(),V("div",je,[m(l,{ref_key:"riskFormRef",ref:b,"input-align":"right","error-message-align":"right"},{default:g(()=>[m(c,{active:o(e).currentPlan,"onUpdate:active":r[0]||(r[0]=p=>o(e).currentPlan=p)},{default:g(()=>[(_(!0),V(Ce,null,Ve(o(e).riskPlanData,p=>(_(),D(d,{key:p.planCode,name:p.planCode,title:p.planName},{title:g(()=>[m(i,{title:p.planName,active:o(e).currentPlan===p.planCode},null,8,["title","active"])]),default:g(()=>{var K;return[p.planCode===o(e).currentPlan?(_(),D(ee,{key:0,"risk-info":C.value[p.planCode],enums:o(e).enumList,"origin-data":(K=p.productRiskVoList)==null?void 0:K[0].riskDetailVOList,"pick-factor":w},null,8,["risk-info","enums","origin-data"])):L("",!0)]}),_:2},1032,["name","title"]))),128))]),_:1},8,["active"])]),_:1},512)])):L("",!0)]),_:1})]),_:1},8,["modelValue"])]),R("div",Ue,[R("span",Me,[R("span",we,Le((o(e).retrialTip?"0":((H=o(e).trialResult)==null?void 0:H.premium)||"0").toLocaleString()),1),Ye]),R("div",Je,[o(e).retrialTip?(_(),V("div",ze,[Ge,R("span",{class:"close-icon",onClick:oe},"X")])):L("",!0),o(e).canTrial?(_(),D(P,{key:1,type:"primary",onClick:le},{default:g(()=>[He]),_:1})):(_(),D(P,{key:2,type:"primary",onClick:se},{default:g(()=>[Ke]),_:1}))])])]}),_:1})}}});var ot=Ie(We,[["__scopeId","data-v-23bea8f0"]]);export{ot as default};
