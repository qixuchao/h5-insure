import{y as e,d as a,a as t,u as n,r,t as o,C as l,H as d,ag as s,Z as i,bj as u,aZ as c,a4 as m,b as p,c as v,e as y,w as f,i as h,a8 as I,Y as N,f as g,X as w,g as b,v as C,bD as D,ac as O,V as T,D as F,B as j,c9 as k,T as P,q as H,as as x,b$ as S}from"./index-eff7527d.js";import{d as V}from"./debounce-eed12388.js";import{O as $}from"./order-09102ab8.js";import{S as L,R as q,P as U}from"./infoCollection-dec1d9ca.js";import{i as A,s as B,p as E,g as M,d as _,e as R}from"./trial-b8818c4a.js";import{p as K}from"./product-7d21937c.js";import{t as Y,g as z,a as W,s as J,v as G,b as Z}from"./utils-c5fcd0dd.js";import{f as X,a as Q}from"./utils-b77f2acb.js";import{t as ee}from"./theme-ea709837.js";import{d as ae,B as te,D as ne,G as re,S as oe,H as le,P as de,U as se,_ as ie,W as ue,a as ce,p as me}from"./auth-6520e6a1.js";import{_ as pe}from"./close-011cbf1b.js";import"./pdfh5-008ca364.js";import"./isObjectLike-a9798079.js";import"./trial-82ecfdbb.js";import"./index-da2f2150.js";import"./index-e73ebcf4.js";import"./index-c963a75d.js";/* empty css              */import"./bankCard-02614606.js";import"./validator-5a13dc82.js";import"./phoneVerify-dd6b7e53.js";import"./index-0dacb5d5.js";const ve={key:0},ye={class:"page-internet-product-detail"},fe={class:"info"},he={class:"footer-button"},Ie={class:"price"},Ne={key:0};var ge=e(a({__name:"index",setup(e){const a=t(),ge=n(),{productCode:we="BWYL2021",tenantId:be,orderNo:Ce,phoneNo:De,agentCode:Oe="",saleChannelId:Te,paymentMethod:Fe,certNo:je,name:ke,pageCode:Pe,upgradeCode:He="",from:xe}=ge.query,Se=r(),Ve=r(),$e=r(),Le=r(),qe="payBack"===Pe,Ue=r(!1),Ae=r(!1),Be=r(!1),Ee=r(0),Me=r(!1),_e=r(!1),Re=r({show:!1,html:""}),Ke=r(!1),Ye=r();let ze="";const We=o({holder:{certNo:je,certType:l.CERT,mobile:De,name:ke,socialFlag:L.HAS},insured:{certNo:je,certType:l.CERT,name:ke,socialFlag:L.HAS,relationToHolder:q.SELF},paymentMethod:Fe,renewalDK:"Y",paymentFrequency:U.MONTH}),Je=r(ae),Ge=r(ae),Ze=o({showInsure:!qe,canInsure:!1,canUpgrade:!1}),Xe=d((()=>{var e,a;return(null==(a=null==(e=Ve.value)?void 0:e.tenantProductInsureVO)?void 0:a.attachmentVOList.filter((e=>"健康告知"===e.attachmentName)))||[]})),Qe=d((()=>{var e,a,t,n,r,o,l,d;return[...(null==(a=null==(e=Ve.value)?void 0:e.tenantProductInsureVO)?void 0:a.titleAndDescVOS)||[],{desc:`出生${X(null==(n=null==(t=Ve.value)?void 0:t.tenantProductInsureVO)?void 0:n.holderAgeLimit)}`,title:"投保年龄",noDetail:!0},{desc:Q(null==(o=null==(r=Ve.value)?void 0:r.tenantProductInsureVO)?void 0:o.insurancePeriodValues),title:"保障期限",noDetail:!0},{desc:`${null==(d=null==(l=Ve.value)?void 0:l.tenantProductInsureVO)?void 0:d.waitPeriod}天，上一张保单期满后指定期限内重新投保、因遭受意外伤害导致的医疗无等待期`,title:"等待期",noDetail:!0}]})),ea=d((()=>{var e,a;return(null==(a=null==(e=Ve.value)?void 0:e.tenantProductInsureVO)?void 0:a.attachmentVOList.filter((e=>"健康告知"!==e.attachmentName)))||[]})),aa=()=>{if(We.holder.certNo){const e=H(We.holder.certNo);if(G(We.holder.certNo,18,"year"))return P("投保人年龄必须大于等于18岁！"),!1;if(We.insured.certNo&&We.insured.relationToHolder===q.MATE){if(e===H(We.insured.certNo))return P("被保人为配偶时，性别不可相同！"),!1}}if(We.insured.certNo){if(We.insured.relationToHolder===q.CHILD&&G(We.insured.certNo,30,"day"))return P("被保人为子女时，年龄必须大于等于30天！"),!1;if(We.insured.relationToHolder===q.PARENT&&!G(We.insured.certNo,71,"year"))return P("被保人为父母时，年龄必须小于等于70岁！"),!1}if([q.CHILD,q.PARENT].includes(We.insured.relationToHolder)){const e=Z(We.holder.certNo,"year"),a=Z(We.insured.certNo,"year");if(We.insured.relationToHolder===q.CHILD&&e-a<18)return P("投保人和子女年龄必须相差18岁！"),!1;if(We.insured.relationToHolder===q.PARENT&&a-e<18)return P("投保人和父母年龄必须相差18岁！"),!1}return!0},ta=()=>{a.push({path:"/internet/guaranteeUpgrade",query:{...ge.query,tenantId:be,productCode:"BWYL2022",orderNo:Ce,agentCode:Oe}})},na=()=>{_e.value=!1,a.replace(`/pay?orderNo=${Ce}&saleUserId=${Oe}&tenantId=${be}`)},ra=()=>{Ge.value=Je.value},oa=()=>{Ge.value={...Ge.value,relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1}},la=e=>{var a,t;const n=JSON.parse(null==(t=null==(a=$e.value)?void 0:a.productBasicInfoVO)?void 0:t.extInfo);let r="";if(1!==n.endorsementFlag||!n.endorsementCode)return`${S}/pay?orderNo=${e}&saleUserId=${Oe}&tenantId=${be}`;r=`&upgradeCode=${n.endorsementCode}`;return`${S}/internet/productDetail?tenantId=${be}&productCode=${we}&orderNo=${e}&agentCode=${Oe}&pageCode=payBack${r}&from=${xe||"normal"}`},da=async e=>{const a=z({tenantId:be,saleUserId:Oe,saleChannelId:Te,detail:Ve.value,insureDetail:$e.value,paymentMethod:We.paymentMethod,renewalDK:We.renewalDK,iseeBizNo:ze,successJumpUrl:"",premium:Le.value,holder:We.holder,insured:We.insured,tenantOrderRiskList:e,orderStatus:"",orderTopStatus:"",orderNo:Ce,originOrderIds:Ye.value});try{const e=await B(a),{code:n,data:r}=e;"10000"===n&&(async e=>{P.loading({message:"核保中...",forbidClick:!0,duration:0});try{const a=await _(e),{code:t}=a;if("10000"===t){const a=await R({orderNo:e.orderNo,tenantId:be}),{data:t}=a;"10000"===a.code&&(2===t.type?(Re.value={show:!0,html:t.paymentUrl},x((()=>{const e=document.getElementById("cashierSubmit");null==e||e.addEventListener("submit",(e=>{e.preventDefault()})),null==e||e.submit()}))):window.location.href=t.paymentUrl)}Ze.canInsure=!0}catch(a){Ze.canInsure=!0}finally{P.clear()}})({...a,orderNo:r.data,extInfo:{extraInfo:{renewalDK:We.renewalDK,paymentMethod:We.paymentMethod,paymentFrequency:We.paymentFrequency,successJumpUrl:la(r.data),failUrl:(t=r.data,`${S}/internet/payFail?tenantId=${be}&orderNo=${t}&agentCode=${Oe}&pageCode=payBack&from=${xe||"normal"}`)},iseeBizNo:ze}})}catch(n){Ze.canInsure=!0}var t},sa=async()=>{var e;if(qe)ta();else{Ze.canInsure=!1;try{const{condition:a,data:t}=await new Promise(((e,a)=>{var t,n;null==(n=null==(t=Se.value)?void 0:t.validateForm)||n.call(t).then((async()=>{if(!aa())return void a(new Error);const{calcData:t,riskVOList:n}=W({holder:We.holder,insured:We.insured,tenantId:be,paymentFrequency:We.paymentFrequency,productDetail:Ve.value,insureDetail:$e.value},!0),r=await E(t),{code:o,data:l}=r;"10000"===o?(Le.value=l.premium,e({condition:n,data:l})):a(new Error)})).catch((e=>{Ze.canInsure=!0,J(e)}))})),n={},r=(e=[])=>{(e||[]).forEach((e=>{var a;n[e.riskCode]=e,(null==(a=e.riskPremiumDetailVOList)?void 0:a.length)&&r(e.riskPremiumDetailVOList)}))};r(t.riskPremiumDetailVOList);const o=Y({tenantId:be,riskList:a,riskPremium:n,productId:null==(e=Ve.value)?void 0:e.id});da(o)}catch(a){Ze.canInsure=!0}}},ia=e=>{"allFalse"===e?(Ae.value=!1,sa(),Ze.canInsure=!0):F.confirm({message:"您当前的健康状况不符合该产品",confirmButtonText:"确定"}).then((()=>{window.history.back()}))},ua=()=>{Ue.value=!0,Be.value=!1,Ae.value=!0};s([()=>We.insured.certNo,()=>We.insured.socialFlag],V((()=>{We.insured.certNo&&We.insured.socialFlag&&"payBack"!==Pe&&(()=>{const{holder:{certNo:e,mobile:a,name:t,socialFlag:n},insured:{certNo:r,name:o,socialFlag:l,relationToHolder:d},paymentMethod:s}=We;return k(r)&&!!l})()&&(async()=>{if(Ze.canInsure=!0,!aa())return{};const{calcData:e,riskVOList:a}=W({holder:We.holder,insured:We.insured,tenantId:be,paymentFrequency:We.paymentFrequency,productDetail:Ve.value,insureDetail:$e.value},!0);if(!Array.isArray(a)||a.length<1)return P("被保人年龄需在30天(含) - 70岁(含)之间！"),Le.value=null,{};Ke.value=!0;const t=await E(e);Ke.value=!1;const{code:n,data:r}=t;"10000"===n&&(We.insured.certNo?Le.value=r.premium:Le.value=null)})()}),500),{deep:!0,immediate:!0}),s((()=>We.insured.certNo),(()=>{We.insured.certNo||(Le.value=null)}));const ca=async()=>{var e,a,t,n,r,o,l,d,s,i,u,c,m;const p=await M({orderNo:Ce,tenantId:be}),{code:v,data:y}=p;if("10000"===v){const{id:p,tenantOrderHolder:v,tenantOrderInsuredList:f,extInfo:h}=y;if(!qe)return Ye.value={id:p,holderId:null==v?void 0:v.id,insuredId:null==f?void 0:f[0].id},Object.assign(We,{holder:{certNo:v.certNo,certType:v.certType,mobile:v.mobile,name:v.name,socialFlag:L.HAS},insured:{certNo:null==f?void 0:f[0].certNo,certType:null==(e=f[0])?void 0:e.certType,name:null==(a=f[0])?void 0:a.name,socialFlag:null==(n=null==(t=f[0])?void 0:t.extInfo)?void 0:n.hasSocialInsurance,relationToHolder:null==(r=f[0])?void 0:r.relationToHolder},paymentMethod:h.extraInfo.paymentMethod,paymentFrequency:h.extraInfo.paymentFrequency,renewalDK:"Y"}),void(Ze.canInsure=!0);Object.assign(We,{holder:{certNo:v.certNo,certType:v.certType,mobile:v.mobile,name:v.name,socialFlag:L.HAS},insured:{certNo:null==f?void 0:f[0].certNo,certType:null==(o=f[0])?void 0:o.certType,name:null==(l=f[0])?void 0:l.name,socialFlag:null==(s=null==(d=f[0])?void 0:d.extInfo)?void 0:s.hasSocialInsurance,relationToHolder:null==(i=f[0])?void 0:i.relationToHolder},paymentMethod:h.extraInfo.paymentMethod,paymentFrequency:h.extraInfo.paymentFrequency,renewalDK:h.extraInfo.renewalDK||"N"}),Le.value=null==(m=null==(c=null==(u=f[0])?void 0:u.tenantOrderProductList)?void 0:c[0])?void 0:m.premium,y.orderStatus!==$.ACCEPT_POLICY&&y.orderStatus!==$.PAYMENT_SUCCESS||(Ze.canUpgrade=!0,Me.value=!1,_e.value=!0),y.orderStatus===$.PAYING&&(Me.value=!0,setTimeout((()=>{ca()}),3e3))}};return i((()=>{Ce?qe&&He?(console.log("投保完成来升级保障的"),Ge.value=me,Je.value=me,console.log("支付完成进入")):He||(console.log("投保链接-来付钱"),Ge.value={...ce,paymentFrequencyDisable:!0},Je.value=ce,Ze.canInsure=!0):(console.log("投保链接"),Ge.value={...ce,paymentFrequencyDisable:!0},Je.value=ce,Ze.canInsure=!0),(async()=>{var e;const a=await K({productCode:we,withInsureInfo:!0,tenantId:be});"10000"===a.code&&(Ve.value=a.data,document.title=(null==(e=a.data)?void 0:e.productFullName)||"");const t=await A({productCode:we});"10000"===t.code&&($e.value=t.data),Ce&&ca()})(),setTimeout((async()=>{ze=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,a)=>{const t=u,n=j,r=c,o=m("dompurify-html");return p(),v(T,null,[y(r,{"theme-vars":h(ee)},{default:f((()=>{var e,a,r,l,d,s,i;return[h(Re).show?I((p(),v("div",ve,null,512)),[[o,h(Re).html]]):N("",!0),g("div",ye,[g("div",fe,[y(te,{url:null==(a=null==(e=h(Ve))?void 0:e.tenantProductInsureVO)?void 0:a.banner[0]},null,8,["url"]),y(ne,{"product-name":null==(r=h(Ve))?void 0:r.productFullName,"product-desc":null==(d=null==(l=h(Ve))?void 0:l.showConfigVO)?void 0:d.desc},null,8,["product-name","product-desc"])]),(null==(i=null==(s=h(Ve))?void 0:s.tenantProductInsureVO)?void 0:i.titleAndDescVOS)?(p(),w(re,{key:0,"img-type":"BW","guarantee-list":h(Qe)},null,8,["guarantee-list"])):N("",!0),y(oe,{detail:h(Ve).tenantProductInsureVO},{form:f((()=>[y(le,{ref_key:"formRef",ref:Se,disable:!h(Ze).showInsure,"form-auth":h(Ge),"form-info":h(We),premium:h(Le),"product-detail":h(Ve),payments:[1],"payment-method":[0],onOnReset:ra,onOnUpdate:oa},null,8,["disable","form-auth","form-info","premium","product-detail"])])),_:1},8,["detail"]),g("div",he,[g("div",Ie,[b(" 总保费"),h(Ke)?(p(),w(t,{key:1,class:"premium-loading",type:"spinner"})):(p(),v("span",Ne,C(h(Le)?"￥":"")+C(h(D)(h(Le)))+C(h(Le)?"元/月":""),1))]),y(n,{type:"primary",class:"right",disabled:!(h(Ze).canInsure||h(Ze).canUpgrade),onClick:sa},{default:f((()=>[b(C(h(Ze).showInsure?"立即投保":"升级保障"),1)])),_:1},8,["disabled"])])]),h(Ce)?N("",!0):(p(),w(de,{key:1,"product-detail":h(Ve)},null,8,["product-detail"])),h(He)?(p(),w(se,{key:2,"order-no":h(Ce),"tenant-id":h(be),"upgrade-code":h(He),"is-show":h(_e),onOnConfirm:ta,onOnClose:na},null,8,["order-no","tenant-id","upgrade-code","is-show"])):N("",!0)]})),_:1},8,["theme-vars"]),y(ie,{show:h(Ae),"onUpdate:show":a[0]||(a[0]=e=>O(Ae)?Ae.value=e:null),"content-list":h(Xe),"active-index":0,onOnConfirmHealth:ia},null,8,["show","content-list"]),h(Be)?(p(),w(pe,{key:0,show:h(Be),"onUpdate:show":a[1]||(a[1]=e=>O(Be)?Be.value=e:null),"content-list":h(ea),"active-index":h(Ee),text:"我已逐页阅读并确认告知内容",onSubmit:ua},null,8,["show","content-list","active-index"])):N("",!0),y(ue,{"is-show":h(Me)},null,8,["is-show"])],64)}}}),[["__scopeId","data-v-c3d2395a"]]);export{ge as default};
