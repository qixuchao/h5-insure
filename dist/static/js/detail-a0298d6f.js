import{d as e,r as t,b as a,c as l,g as n,i as o,j as i,f as r,w as u,n as d,t as s,a1 as c,F as v,bh as f,a as m,u as p,y as h,e as y,l as I,h as C,T as b,Y as O}from"./index-8e56e59a.js";import{u as w}from"./theme-65292714.js";import{g as x,i as j}from"./trial-28e1c516.js";import L from"./index-e9564747.js";import{s as g}from"./verify-6dc0fa81.js";import{n as N}from"./nextStep-049702e7.js";import{p as k}from"./product-a9305e94.js";import{O as E,a as P}from"./order-f4be30e0.js";import _ from"./index-8b8986b9.js";import T from"./index-c49789ba.js";import{u as V}from"./useDicData-443a43c9.js";import{a as S}from"./trial-977d6da5.js";import"./pdfh5-e5c0db2a.js";import"./infoCollection-afeffebd.js";import"./relativeTime-190c9ccf.js";import"./validator-5a13dc82.js";import"./core-48a2e79c.js";import"./index-c6b2b786.js";import"./useStorage-5eb9ff61.js";import"./utils-708b7ef9.js";const R={class:"sign-wrap"},H=["src"],U={class:"popup-body"},A={class:"sign-container-wrap"},D={class:"operate-bar"},B=d(" 请投保人正楷签署您的签名:"),F={class:"btns"},$=d("返回"),q=d("重写"),z=d("确定签字"),G=e({props:{option:{default:{}},modelValue:{default:""}},emits:["update:modelValue"],setup(e,{emit:m}){const p=t(!1),h=t(),y=t(""),I=t(!0),C=()=>{var e;p.value=!0,null==(e=h.value)||e.clear()},b=()=>{f({images:[y.value],className:"customer-sign-preview"})},O=()=>{p.value=!1},w=()=>{var e,t;null==(t=null==(e=h.value)?void 0:e.clear)||t.call(e)},x=()=>{var e;y.value=null==(e=h.value)?void 0:e.save(),m("update:modelValue",y.value),p.value=!1};return(e,t)=>{const f=a("van-button"),m=a("van-icon"),j=a("van-popup");return l(),n(v,null,[o("div",R,[y.value?(l(),n("img",{key:0,class:"preview-sign",src:y.value,alt:"",onClick:b},null,8,H)):i("",!0),r(f,{type:"primary",round:"",size:"small",onClick:C},{default:u((()=>[d(s(y.value?"重新签名":"点击签字"),1)])),_:1})]),r(j,{show:p.value,"onUpdate:show":t[1]||(t[1]=e=>p.value=e),position:"bottom",style:{height:"100%",overflow:"hidden"}},{default:u((()=>[o("div",U,[o("div",A,[r(c,{ref_key:"signRef",ref:h,placeholder:"请在此处签名",onStroke:t[0]||(t[0]=e=>I.value=!1)},null,512),o("div",D,[o("span",null,[r(m,{name:"info",color:"#ffaf22"}),B]),o("div",F,[r(f,{type:"default",class:"btn",onClick:O},{default:u((()=>[$])),_:1}),r(f,{type:"default",class:"btn",onClick:w},{default:u((()=>[q])),_:1}),r(f,{type:"primary",class:"btn",disabled:I.value,onClick:x},{default:u((()=>[z])),_:1},8,["disabled"])])])])])])),_:1},8,["show"])],64)}}});const Y={key:0,class:"net-sale-detail-wrap"},W={class:"sign-cell"},M=o("div",{class:"sign-label"},"签名",-1),Z={class:"footer"},J={class:"footer"},K=e({setup(e){const d=w(),s=m(),c=p(),{orderNo:f="2022113021181894998",tenantId:R="9991000001"}=s.query,H=t({}),U=t(!1),A=V("NATIONAL_REGION_CODE"),D=t({commencementTime:"",expiryDate:"",extInfo:{buttonCode:"EVENT_NETSALE_airSignature",pageCode:"infoCollection",templateId:3,iseeBizNo:""},orderCategory:1,tenantId:R,venderCode:"",tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}],tenantOrderProductList:[{}]}],tenantOrderSubjectList:[{extInfo:{subjectRelatedFirm:"",subjectRelatedUserId:""},subjectName:"",subjectObjectType:"HOLDER",subjectType:"GENERAL",subjectNo:"",tenantId:R}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}}),B=t(!1),F=t(),$=t(),q=t(),z=t(""),K=t(""),Q=t(!1),X=t(!1),ee=t(0),te=t([]),ae=t(""),le=t("");t("");const ne=t([]),oe=()=>{Q.value=!1,X.value=!1},ie=async()=>{Q.value=!1,X.value=!0,await g("HOLDER",z.value,D.value.id,`${R}`),N(D.value)},re=async()=>{const{data:e,code:t}=await k({productCode:le.value,tenantId:R,withInsureInfo:!0});"10000"===t&&(q.value=e,(()=>{var e,t,a,l,n,o;let i={};if(i=K.value?(null==(a=((null==(t=null==(e=q.value)?void 0:e.tenantProductInsureVO)?void 0:t.planList)||[]).find((e=>e.planCode===K.value)))?void 0:a.attachmentVOList)||[]:(null==(o=null==(n=null==(l=q.value)?void 0:l.tenantProductInsureVO)?void 0:n.planInsureVO)?void 0:o.attachmentVOList)||[],!i)return void(te.value=[]);const r={2:"richText",3:"link"};te.value=Object.keys(i).map((e=>(i[e].forEach((e=>{if("1"===e.attachmentType){const t=e.attachmentUri.split("?"),a=t[0].substr(t[0].lastIndexOf(".")+1);e.attachmentType="pdf"===a?"pdf":"picture"}else e.attachmentType=r[e.attachmentType]})),{attachmentName:e,attachmentList:i[e]})))||[],ne.value=te.value.map((e=>({attachmentName:e.attachmentName,attachmentList:e.attachmentList.filter((e=>e.mustReadFlag===O.YES))}))).filter((e=>e.attachmentList.length))})())},ue=async()=>{var e;const{code:t,data:a}=await x({orderNo:f,tenantId:R});"10000"===t&&(a.extInfo.buttonCode="EVENT_NETSALE_airSignature",D.value=a,K.value=null==(e=a.tenantOrderInsuredList[0])?void 0:e.planCode,le.value=a.tenantOrderInsuredList[0].tenantOrderProductList[0].productCode,U.value=!0,(e=>{const t=e.find((e=>1===e.riskType));var a,l;t&&(ae.value=(a=t.insurancePeriodValue,-1!==(l=S[t.insurancePeriodType]).indexOf("$")?l.replace("$",`${a}`):`${a||""}${l}`))})(a.tenantOrderInsuredList[0].tenantOrderProductList[0].tenantOrderRiskList||[]),(async()=>{const{code:e,data:t}=await j({productCode:le.value,tenantId:R});"10000"===e&&($.value=t,H.value=t.productFactor)})(),re(),a.orderStatus!==P.UNDER_WRITING_SUCCESS&&c.push({path:"/baseInsurance/orderDetail",query:{...s.query,productCode:le.value,ISEE_BIZ:a.extInfo.iseeBizNo}}))},de=async()=>{z.value?(X.value=!1,ne.value.length?Q.value=!0:ie()):b("请先签字")};return h((()=>{ue()})),(e,t)=>{const s=a("ProCell"),c=a("ProCard"),f=a("ProCascader"),m=a("van-cell"),p=a("ProPageWrap"),h=a("ProFilePreview"),b=a("ProPopup"),O=a("van-config-provider");return l(),y(O,{"theme-vars":I(d)},{default:u((()=>{var e;return[r(p,null,{default:u((()=>{var e;return[(null==(e=$.value)?void 0:e.productBasicInfoVO)?(l(),n("div",Y,[r(c,null,{default:u((()=>{var e;return[r(s,{title:"产品名称",content:null==(e=$.value)?void 0:e.productBasicInfoVO.productFullName},null,8,["content"])]})),_:1}),D.value.id?(l(),y(c,{key:0,"show-line":!1,title:"投保信息"},{default:u((()=>{var e,a,l,n;return[r(s,{title:"保费",content:D.value.orderAmount+"元"},null,8,["content"]),r(s,{title:"保险期限",content:ae.value},null,8,["content"]),r(s,{title:"起保日期",content:D.value.commencementTime},null,8,["content"]),r(s,{title:"终保日期",content:D.value.expiryDate},null,8,["content"]),r(s,{title:"保单状态",content:I(E)[D.value.orderStatus]},null,8,["content"]),r(s,{title:"订单编号",content:D.value.orderNo},null,8,["content"]),r(f,{modelValue:D.value.tenantOrderHolder.extInfo.familyAreaCode,"onUpdate:modelValue":t[0]||(t[0]=e=>D.value.tenantOrderHolder.extInfo.familyAreaCode=e),field1:D.value.tenantOrderHolder.extInfo.familyProvinceCode,"onUpdate:field1":t[1]||(t[1]=e=>D.value.tenantOrderHolder.extInfo.familyProvinceCode=e),field2:D.value.tenantOrderHolder.extInfo.familyCityCode,"onUpdate:field2":t[2]||(t[2]=e=>D.value.tenantOrderHolder.extInfo.familyCityCode=e),field3:D.value.tenantOrderHolder.extInfo.familyAreaCode,"onUpdate:field3":t[3]||(t[3]=e=>D.value.tenantOrderHolder.extInfo.familyAreaCode=e),label:"房产所在地",name:"familyProvinceCode","is-link":"","is-view":"",class:"insured-info","data-source":I(A),mapping:{label:"name",value:"code",children:"children"}},null,8,["modelValue","field1","field2","field3","data-source"]),r(s,{title:"详细地址",content:null==(a=null==(e=D.value.tenantOrderHolder)?void 0:e.extInfo)?void 0:a.familyAddress},null,8,["content"]),r(s,{title:"燃气编号",content:null==(n=null==(l=D.value.tenantOrderSubjectList)?void 0:l[0])?void 0:n.subjectNo},null,8,["content"])]})),_:1})):i("",!0),U.value?(l(),y(L,{key:1,ref:"formRef","title-collection":{HOLDER:"投保人信息",INSURER:"被保人信息",BENEFICIARY:"受益人"},"is-view":!0,"form-info":D.value,"factor-object":H.value,"input-align":"right"},null,8,["form-info","factor-object"])):i("",!0),r(c,{title:"阅读条款合同",class:"file-list-card"},{default:u((()=>[(l(!0),n(v,null,C(te.value,((e,t)=>(l(),y(m,{key:t,title:e.attachmentName,"is-link":"",onClick:t=>{return a=e.attachmentName,l=e.attachmentList,B.value=!0,void(F.value={title:a,fileContent:null==l?void 0:l[0]});var a,l}},null,8,["title","onClick"])))),128))])),_:1}),r(c,{title:"客户签名"},{default:u((()=>[o("div",W,[M,r(G,{modelValue:z.value,"onUpdate:modelValue":t[4]||(t[4]=e=>z.value=e)},null,8,["modelValue"])])])),_:1}),o("div",Z,[r(_,{shadow:!1,text:"提 交",onClick:de})])])):i("",!0)]})),_:1}),r(b,{show:B.value,"onUpdate:show":t[6]||(t[6]=e=>B.value=e),class:"pre-notice-wrap",title:null==(e=F.value)?void 0:e.title,position:"bottom",style:{height:"600px"}},{default:u((()=>{var e,a,l,n;return[r(h,{content:null==(a=null==(e=F.value)?void 0:e.fileContent)?void 0:a.attachmentUri,type:null==(n=null==(l=F.value)?void 0:l.fileContent)?void 0:n.attachmentType},null,8,["content","type"]),o("div",J,[r(_,{shadow:!1,text:"关闭",onClick:t[5]||(t[5]=e=>B.value=!1)})])]})),_:1},8,["show","title"]),Q.value&&0!==ne.value.length?(l(),y(T,{key:0,show:Q.value,"onUpdate:show":t[7]||(t[7]=e=>Q.value=e),"content-list":ne.value,"is-only-view":X.value,"active-index":ee.value,text:X.value?"关闭":"我已逐页阅读上述内容并同意","force-read-cound":0,"on-close-file-preview":"",onSubmit:ie,onOnCloseFilePreview:oe,onOnCloseFilePreviewByMask:t[8]||(t[8]=e=>Q.value=!1)},null,8,["show","content-list","is-only-view","active-index","text"])):i("",!0)]})),_:1},8,["theme-vars"])}}});export{K as default};
