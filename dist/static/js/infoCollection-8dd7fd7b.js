import{d as e,a4 as a,a5 as t,i as o,r as n,j as l,aE as i,O as s,bT as r,o as u,c as d,b as c,u as f,m as p,w as v,f as m,p as I,a8 as h,aK as y,aI as C,aL as O,a9 as b,T as j,bs as L,aa as g,ab as w}from"./index-0cb46857.js";import{_ as x,a as P}from"./PolicyInfo-d9e300df.js";import{s as _,g as N,m as E}from"./trial-edd8350c.js";import{_ as D}from"./TrialButton-12b0b93a.js";import{n as V}from"./nextStep-9a029d18.js";import{u as T}from"./useAttachment-168904eb.js";import"./infoCollection-2d2f295c.js";import"./trial-6aa6389c.js";import{u as k}from"./useOrder-171a7ed0.js";import{a as F,B as U}from"./constants-4b08cf92.js";import{t as A}from"./utils-91ee3350.js";import{T as q}from"./index-65b6ab39.js";import{p as R}from"./utils-5ff2155c.js";import"./index-dab4aaa7.js";import"./core-50f831aa.js";import"./utils-e8be86b2.js";import"./createProposal-0ffe41cc.js";import"./cloneDeep-b16d9b11.js";import"./InsureInfos-851962ef.js";import"./index-de590a0b.js";import"./index-6927170b.js";import"./index-5edf2e91.js";import"./lodash-78051e2b.js";import"./questionnaire-62331097.js";import"./util-cff948f4.js";import"./product-7bbf9c44.js";import"./constants-824b5328.js";import"./config-98e8d477.js";const S={class:"long-info-collection"},M=e({name:"InfoCollection"}),B=e({...M,setup(e){const M=a((()=>t((()=>import("./index-61d8f8c7.js")),["static/js/index-61d8f8c7.js","static/css/index-fa4edf2a.css","static/js/index-0cb46857.js","static/css/index-ec3750c4.css","static/js/theme-94cf7d00.js","static/js/index-dab4aaa7.js","static/css/index-bbfdd7ec.css","static/js/utils-e8be86b2.js","static/js/infoCollection-2d2f295c.js","static/js/trial-6aa6389c.js"]))),B=a((()=>t((()=>import("./index-c4f45ae6.js")),["static/js/index-c4f45ae6.js","static/css/index-bf024e9b.css","static/js/index-0cb46857.js","static/css/index-ec3750c4.css"]))),J=o(),$=k(),{productCode:G="",tenantId:H,agentCode:K="",agencyCode:z,saleChannelId:Q,isShare:W,orderNo:X,extraInfo:Y,insurerCode:Z,preview:ee}=J.query;let ae={};try{ae=JSON.parse(decodeURIComponent(Y))}catch(Ue){}const te=n({isView:!1,personalInfo:{},payInfo:{schema:[],config:[],formData:[]},policyInfo:{schema:[],config:[],formData:{}},defaultValue:null,isAutoChange:!1,defaultPlanCode:"",userData:{}}),oe=`${window.origin}/baseInsurance/long/phoneVerify${window.location.search}`,ne=l({imgUrl:"",desc:"",title:"",link:oe}),le=l();l();const ie=l(),se=l({}),re=l({}),ue=l([]),de=l(),ce=l({}),fe=l(!1),pe=l(!1),ve=l(0),me=l(!0),{fileList:Ie,mustReadFileCount:he,popupFileList:ye}=T(ce,de),Ce=l(!1),Oe=l(!1),be=()=>{pe.value=!1,me.value=!0,ue.value.length<1||(fe.value=!0)},je=()=>{fe.value=!1,pe.value=!1,me.value=!0};l({}),l(!1),l([{}]);const Le=l(""),ge=l(0),we=l(!1);l(),l(),l();const xe=l(0);l({});const Pe=l(),_e=()=>{Le.value="试算中...",ge.value=0,we.value=!0},Ne=(e,a)=>{Le.value="",xe.value=e.premium,ge.value=e,Pe.value=a,we.value=!1},Ee=async()=>{var e,a;if(ee)return void y(F.INFO_COLLECTION,J.query);if(!ge.value)return;const t=[];ie.value&&t.push(null==(e=ie.value)?void 0:e.validate(!1)),le.value&&t.push(null==(a=le.value)?void 0:a.validate(!1)),Promise.all(t).then((()=>{Object.assign($.value,{extInfo:{...$.value.extInfo,buttonCode:U.INFO_COLLECTION,pageCode:F.INFO_COLLECTION}});const e=ie.value.dealMixData(),a=A({...e,productCode:G,productName:re.value.productName},ge.value,$.value),t=(()=>{var e,a;const{holder:t,insuredList:o}=te.userData,n=[],l=(e,a)=>{e.ocrData&&Object.keys(e.ocrData).find((a=>(e[a]||e.ocrData[a])&&e.ocrData[a]!==e[a]))&&n.push(`${a}信息影像识别与录入信息不一致，请确认`)};return l(t,"投保人"),l(null==o?void 0:o[0],"被保人"),((null==(e=null==o?void 0:o[0])?void 0:e.beneficiaryList)||[]).forEach(((e,a)=>{l(e,`收益人${a}`)})),l(null==o?void 0:o[0].guardian,"监护人"),l(null==o?void 0:o[0].guardian,"监护人"),((null==(a=$.value)?void 0:a.tenantOrderPayInfoList)||[]).forEach((e=>{l(null==o?void 0:o[0].guardian,"银行卡")})),n})();(null==t?void 0:t.length)?C.confirm({message:null==t?void 0:t[0]}).then((()=>{V(a,((e,a)=>{a===O.JUMP_PAGE&&b(e.nextPageCode,J.query)}),J)})):V(a,((e,a)=>{a===O.JUMP_PAGE&&b(e.nextPageCode,J.query)}),J)}))},De=e=>{const a=$.value.tenantOrderPayInfoList[0];$.value.tenantOrderPayInfoList.splice(0,1,{...a,...e})},Ve=e=>{Object.assign(te.userData,e)},Te=l({}),ke=l();i((()=>{(async()=>{let e={};X&&await N({orderNo:X,tenantId:H}).then((({code:a,data:t})=>{var o;if("10000"===a){if(ge.value=t.orderAmount,(null==(o=t.insuredList)?void 0:o.length)>0){const{planCode:e}=t.insuredList[0];te.defaultPlanCode=e}Object.assign($.value,t,{tenantOrderPayInfoList:t.tenantOrderPayInfoList||[],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0,withPayInfo:!0},productCode:G}),te.defaultValue=$.value,e=R(t.insuredList[0].productList),Oe.value=!0}})),await E(e).then((({data:e,code:a})=>{if("10000"===a){const{productDetailResList:a,productFactor:t}=e;ke.value=t;const o={};a.forEach((e=>{o[e.productCode]=e})),Te.value=o;const{payInfo:n,other:l}=L(ke.value);te.payInfo={...te.payInfo,...n},te.policyInfo={...te.policyInfo,...l}}}))})()}));let Fe=null;return s((()=>{Fe=setInterval((()=>{(()=>{Object.assign($.value,{extInfo:{...$.value.extInfo,buttonCode:U.INFO_COLLECTION,pageCode:F.INFO_COLLECTION}});const e=ie.value.dealMixData(),a=A(e,ge.value,$.value);a.orderStatus="collectInfo",_(a)})()}),3e4)})),r((()=>{clearInterval(Fe)})),(e,a)=>{var t,o,n,l,i,s;const r=g,y=w;return u(),d("div",S,[c(r),f(Oe)||f(ee)?(u(),p(q,{key:0,ref_key:"personalInfoRef",ref:ie,"product-info":{productCode:f(G),productName:f(re).productName,insurerCode:f(Z),tenantId:f(H),planList:[]},"tenant-product-detail":f(se),"hide-benefit":"","product-collection":f(Te),"default-data":f($),"product-factor":f(ke),onTrialStart:_e,onTrialEnd:Ne,"onUpdate:userData":Ve,onUpdateBank:De},{middleInfo:v((()=>[f(te).payInfo.schema.length?(u(),p(f(x),{key:0,ref_key:"payInfoRef",ref:le,modelValue:f($).tenantOrderPayInfoList,"onUpdate:modelValue":a[0]||(a[0]=e=>f($).tenantOrderPayInfoList=e),schema:f(te).payInfo.schema,"is-view":f(te).isView,"user-data":f(te).userData},null,8,["modelValue","schema","is-view","user-data"])):m("",!0),f(te).policyInfo.schema.length?(u(),p(f(P),{key:1,modelValue:f($),"onUpdate:modelValue":a[1]||(a[1]=e=>I($)?$.value=e:null),schema:f(te).policyInfo.schema,"is-view":f(te).isView},null,8,["modelValue","schema","is-view"])):m("",!0)])),_:1},8,["product-info","tenant-product-detail","product-collection","default-data","product-factor"])):m("",!0),c(y,null,{default:v((()=>{var e;return[(null==(e=f(Ie))?void 0:e.length)?(u(),p(f(B),{key:0,modelValue:f(Ce),"onUpdate:modelValue":a[2]||(a[2]=e=>I(Ce)?Ce.value=e:null),"has-bg-color":!1,"attachment-list":f(Ie),"is-show-radio":"","pre-text":"投保人阅读并接受",onPreviewFile:a[3]||(a[3]=e=>(e=>{ve.value=e,pe.value=!0})(e))},null,8,["modelValue","attachment-list"])):m("",!0)]})),_:1}),f(pe)?(u(),p(f(M),{key:1,show:f(pe),"onUpdate:show":a[4]||(a[4]=e=>I(pe)?pe.value=e:null),"content-list":f(me)?f(Ie):f(ye),"is-only-view":f(me),"active-index":f(ve),text:f(me)?"关闭":"我已逐页阅读并确认告知内容","force-read-count":f(me)?0:f(he),onSubmit:be,onOnCloseFilePreviewByMask:je},null,8,["show","content-list","is-only-view","active-index","text","force-read-count"])):m("",!0),c(D,{"is-share":f(ne).isShare&&!f(W),premium:null==(t=f(ge))?void 0:t.initialPremium,"share-info":f(ne),"loading-text":f(Le),"payment-frequency":(null==(s=null==(i=null==(l=null==(n=null==(o=f(Pe))?void 0:o.insuredList)?void 0:n[0].productList)?void 0:l[0].riskList)?void 0:i[0])?void 0:s.paymentFrequency)+"","tenant-product-detail":f(se),"handle-share":e=>(e=>{ie.value.validateHolder(["mobile"]).then((()=>{Object.assign($.value,{extInfo:{...$.value.extInfo,buttonCode:U.INFO_COLLECTION,pageCode:F.INFO_COLLECTION}});const a=ie.value.getUserData(),t=A({...Pe.value,holder:null==a?void 0:a.holder},ge.value||{},$.value);V(t,((a,t)=>{t===O.JUMP_PAGE&&(null==e||e())}),J)})).catch((()=>{j("请录入投保人手机号后进行分享")}))})(e),disabled:!f(ge),onHandleClick:Ee},{default:v((()=>[h("下一步 ")])),_:1},8,["is-share","premium","share-info","loading-text","payment-frequency","tenant-product-detail","handle-share","disabled"])])}}});export{B as default};
