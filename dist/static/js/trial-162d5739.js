import{d as e,i as a,j as o,k as t,O as s,o as i,m as l,w as r,a as d,e as u,b as c,u as n,p,c as v,F as m,q as k,a8 as R,_ as f,T as C,as as L,at as y,au as I,av as h,aw as j,h as g,ax as _,ay as b,az as q,f as w,s as T}from"./index-8ccea0ec.js";import P from"./index-66e02f32.js";import{a as S,b as x,g as N,s as V,i as M,m as A}from"./trial-eee9ad28.js";import{_ as K}from"./index-d680c3b2.js";import{S as D}from"./index-158d5796.js";import{R as E}from"./trial-c0526383.js";import{_ as O}from"./TrialButton-91a089dc.js";import{u as U}from"./useOrder-99173ff9.js";import{p as B,a as F}from"./utils-8936b658.js";import{f as $,a as H}from"./findLastIndex-2c59f8d7.js";import{c as z}from"./cloneDeep-5f280262.js";import"./InsureInfos-c802c7fc.js";import"./index-de590a0b.js";import"./createProposal-683c8b9a.js";import"./infoCollection-86362f87.js";import"./index-828ac02c.js";import"./PolicyInfo-11287dc5.js";import"./questionnaire-42dcb602.js";import"./util-c1f91244.js";import"./product-7bbf9c44.js";import"./constants-3e9a9875.js";import"./config-98e8d477.js";import"./utils-e94b6cd3.js";import"./nextStep-3fbda94c.js";import"./core-73a53a48.js";import"./format-31cde443.js";import"./empty-ae586b6c.js";import"./index-26608712.js";import"./utils-f86c0766.js";const G={class:"popup-container"},J={class:"popup-header"},Q={class:"title"},W=(e=>(h("data-v-0a46ec37"),e=e(),j(),e))((()=>d("p",{class:"tip"},"已为您挑选出以下险种",-1))),X={class:"search"},Y={key:0,class:"risk-list"},Z=e({name:"riskSelect"});var ee=f(e({...Z,props:{type:{default:2},show:{type:Boolean,default:!1},title:{},insuredList:{default:()=>[]},mainRiskCode:{default:""},selectList:{default:()=>[]},currentProductCode:{default:""}},emits:["cancel","confirm"],setup(e,{emit:f}){const h=e,j=a(),{insurerCode:g}=j.query,_=o([]),b=o([]),q=o([]),w=o(),T=t((()=>h.show)),P=()=>{f("cancel")},N=()=>{var e;if(!(null==(e=_.value)?void 0:e.length))return void C(`暂未添加任何${h.type===E.MAIN_RISK?"主":"附加"}险`);let a=[];a=h.type===E.RIDER_RISK?_.value:b.value.filter((e=>_.value.includes(e.productCode))).map((e=>({productCode:e.productCode,mergeRiskReqList:(e.mainRiskCollocationList||[]).map((e=>({riskCode:e.collocationRiskCode,riskType:e.mainRiskCode?2:1,mainRiskCode:e.mainRiskCode})))}))),f("confirm",a)},V=async()=>{var e;const a={insuredList:h.insuredList,mainRiskCode:h.mainRiskCode,insurerCode:g,productCategory:"",keyword:w.value,selectProductCodes:[],selectRiskCodes:[],filterFlag:(null==(e=h.selectList)?void 0:e.length)?1:2};if(a.selectProductCodes=h.selectList.map((e=>(e.productCode===h.currentProductCode&&a.selectRiskCodes.push(...e.mergeRiskReqList.map((e=>e.riskCode))),e.productCode))),h.type===E.MAIN_RISK){const{code:e,data:o}=await S(a);"10000"===e&&(b.value=o)}else{const{code:e,data:o}=await x(a);"10000"===e&&(b.value=o.riskInfoList,q.value=o.collocationInfoResList)}};return s((()=>{V()})),(e,a)=>{const o=D,t=L,s=y,f=K,C=I;return i(),l(C,{show:n(T),"onUpdate:show":a[2]||(a[2]=e=>p(T)?T.value=e:null),class:"popup-risk-select",closeable:!1},{default:r((()=>{var C;return[d("div",G,[d("div",J,[d("span",{class:"clear-all",onClick:P}," 取消 "),d("span",Q,u(e.title),1),d("span",{class:"close",onClick:N},"确认")]),W,d("div",X,[c(o,{modelValue:n(w),"onUpdate:modelValue":a[0]||(a[0]=e=>p(w)?w.value=e:null),shape:"round",placeholder:"请输入产品名称进行搜索","clear-trigger":"always","show-action":"",clearable:"",onSearch:V},null,8,["modelValue"])]),(null==(C=n(b))?void 0:C.length)?(i(),v("div",Y,[c(s,{modelValue:n(_),"onUpdate:modelValue":a[1]||(a[1]=e=>p(_)?_.value=e:null)},{default:r((()=>[(i(!0),v(m,null,k(n(b),(e=>(i(),l(t,{key:e.riskCode||e.productCode,name:e.riskCode||e.productCode,onClick:()=>{return a=e.riskCode,h.type===E.RIDER_RISK&&(q.value||[]).forEach((e=>{_.value.includes(a)?a===e.relatedRiskCode?(2===e.collocationType&&_.value.push(e.collocationRiskCode),3===e.collocationType&&(_.value.push(a),_.value=_.value.filter((a=>a!==e.collocationRiskCode)))):a===e.collocationRiskCode&&(2===e.collocationType&&_.value.push(e.relatedRiskCode),3===e.collocationType&&(_.value=_.value.filter((a=>a!==e.relatedRiskCode)))):a===e.relatedRiskCode?(2===e.collocationType&&(_.value=_.value.filter((a=>a!==e.collocationRiskCode))),3===e.collocationType&&(_.value.push(a),_.value=_.value.filter((a=>a!==e.collocationRiskCode)))):a===e.collocationRiskCode&&(2===e.collocationType&&(_.value=_.value.filter((a=>a!==e.relatedRiskCode))),3===e.collocationType&&(_.value=_.value.filter((a=>a!==e.relatedRiskCode))))})),void(_.value=[...new Set(_.value)]);var a}},{default:r((()=>[R(u(e.riskName||e.productName),1)])),_:2},1032,["name","onClick"])))),128))])),_:1},8,["modelValue"])])):(i(),l(f,{key:1,title:`暂无关联${e.type===n(E).MAIN_RISK?"主":"附加"}险、请选择其他险种`},null,8,["title"]))])]})),_:1},8,["show"])}}}),[["__scopeId","data-v-0a46ec37"]]);const ae={class:"page-trial-wrap"},oe=e({name:"trial"}),te=e({...oe,setup(e){const s=a(),d=g(),{productCode:u,orderNo:p,tenantId:m}=s.query,k=o({}),R=o({productList:[]}),f=o([]),C=o({}),L=o(),y=o(),I=U({extInfo:{templateId:201,buttonCode:_.TRIAL_PREMIUM,pageCode:b.TRIAL_PREMIUM}}),h=o(),j=o(),S=o(1),x=t((()=>S.value===E.MAIN_RISK?"添加主险":"添加附加险")),K=o(!1),D=()=>{A(R.value).then((({code:e,data:a})=>{if("10000"===e){const{productDetailResList:e,productFactor:o}=a;j.value=o,R.value=F(e);const t={};e.forEach((e=>{t[e.productCode]=e})),k.value=t}}))},G=()=>{K.value=!1},J=e=>{if(S.value===E.MAIN_RISK){R.value.productList.push(...e);const a=e.map((e=>e.productCode));L.value.getProductDefaultValue(a)}else{const a=R.value.productList.find((e=>e.productCode===y.value)),o=e.map((e=>({riskCode:e,riskType:E.RIDER_RISK,mainRiskCode:C.value.riskCode}))),t=$(a.mergeRiskReqList,(e=>e.riskCode===C.value.riskCode)),s=H(a.mergeRiskReqList,(e=>e.mainRiskCode===C.value.riskCode));let i=t;-1!==s&&(i=s),a.mergeRiskReqList=[...a.mergeRiskReqList.slice(0,i+1),...o,...a.mergeRiskReqList.slice(i+1,a.mergeRiskReqList.length)],L.value.getRiderRiskDefaultValue(y.value,e,C.value.riskCode)}D(),K.value=!1},Q=(e,a,o)=>{K.value=!0,S.value=E.RIDER_RISK,f.value=o,C.value=a,y.value=e},W=e=>{K.value=!0,S.value=E.MAIN_RISK,f.value=e},X=(e,a,o)=>{k.value[e],o?(k.value[e].productPlanInsureVOList[0].insureProductRiskVOList=k.value[e].productPlanInsureVOList[0].insureProductRiskVOList.filter((e=>e.riskCode!==a)),R.value.productList=R.value.productList.map((o=>(o.productCode===e&&(o.mergeRiskReqList=o.mergeRiskReqList.filter((e=>e.riskCode!==a))),o)))):(R.value.productList=R.value.productList.filter((a=>a.productCode!==e)),D())},Y=()=>{L.value.onNext((async e=>{var a;const o=z(e),t=["id","relationToHolder","beneficiaryList","guardian","insuredBeneficiaryType"];p||Object.keys(null==(a=o.insuredList)?void 0:a[0]).reduce(((e,a)=>{var s,i,l,r;return!t.includes(a)&&(null==(i=null==(s=o.insuredList)?void 0:s[0])?void 0:i[a])&&(e[a]=null==(r=null==(l=o.insuredList)?void 0:l[0])?void 0:r[a]),e}),o.holder);const{code:i,data:l}=await V(o);"10000"===i&&d.push({path:T.questionNotice,query:{...s.query,orderNo:l}})}))};return q((()=>{p?N({orderNo:p,tenantId:m}).then((({code:e,data:a})=>{"10000"===e&&(h.value=a,I.value=a,R.value=B(a.insuredList[0].productList),D())})):M({productCode:u,isTenant:!1}).then((({data:e,code:a})=>{var o,t;"10000"===a&&(k.value[`${u}`]=e,j.value=null==(t=null==(o=null==e?void 0:e.productPlanInsureVOList)?void 0:o[0])?void 0:t.productFactor,R.value=F([e]))}))})),(e,a)=>(i(),v("div",ae,[c(P,{ref_key:"trialRef",ref:L,"product-collection":n(k),"default-data":n(h),"product-factor":n(j),"product-risk-code-map":n(R),"is-trial":"","hide-benefit":"",onAddRisk:Q,onAddMainRisk:W,onDeleteRisk:X},{trialBtn:r((({riskPremium:e})=>[c(O,{premium:null==e?void 0:e.initialPremium,onHandleClick:Y},null,8,["premium"])])),_:1},8,["product-collection","default-data","product-factor","product-risk-code-map"]),n(K)?(i(),l(ee,{key:0,type:n(S),show:n(K),"insured-list":n(f),title:n(x),"current-product-code":n(y),"main-risk-code":n(C).riskCode,"select-list":n(R).productList,onCancel:G,onConfirm:J},null,8,["type","show","insured-list","title","current-product-code","main-risk-code","select-list"])):w("",!0)]))}});export{te as default};
