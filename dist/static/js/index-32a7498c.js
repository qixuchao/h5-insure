var de=Object.defineProperty,pe=Object.defineProperties;var me=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var K=(l,c,n)=>c in l?de(l,c,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[c]=n,N=(l,c)=>{for(var n in c||(c={}))W.call(c,n)&&K(l,n,c[n]);if(F)for(var n of F(c))X.call(c,n)&&K(l,n,c[n]);return l},A=(l,c)=>pe(l,me(c));var Q=(l,c)=>{var n={};for(var g in l)W.call(l,g)&&c.indexOf(g)<0&&(n[g]=l[g]);if(l!=null&&F)for(var g of F(l))c.indexOf(g)<0&&X.call(l,g)&&(n[g]=l[g]);return n};import{g as fe,ak as _e,O as ge,E as v,M as ke,a6 as ye,_ as Pe,o as Ce,r as P,j as k,k as B,m as y,A as a,n as V,p as _,t as h,z as I,F as ve,G as Le,J as Ve,C as b}from"./vendor-e057bbeb.js";import{P as Z,R as $}from"./index-f4077714.js";import{i as he,p as Ie}from"./trial-b949b810.js";import{q as Oe}from"./createProposal-3fdda73b.js";import{_ as De,n as Re,P as Be,g as Te}from"./index-13719b30.js";import{u as Fe}from"./useStorage-07a97fda.js";import{P as Ne,I as be}from"./trial-0ef4f7d6.js";import"./useDicData-dce8ff67.js";const Ee={key:0,class:"part-card"},Ae={key:1,class:"part-card"},xe={class:"risk-content"},Se={key:0,class:"risk"},qe={key:1,class:"plan-risk"},je={class:"footer-bar"},Me={class:"trial-result"},Ue={class:"result-num"},we=b(" \u5143\u8D77 "),Ye={class:"trial-operate"},Je={key:0,class:"retrial-tip"},ze=b(" \u6761\u4EF6\u66F4\u6539\u540E\uFF0C\u9700\u8981\u91CD\u65B0\u8BD5\u7B97 "),Ge=b("\u53BB\u8BD5\u7B97"),He=b("\u7ACB\u5373\u6295\u4FDD"),Ke=fe({setup(l){var w,Y;const c=_e(),n=ge(),{templateId:g=1,agentCode:ee="test",agencyCode:te="",tenantId:x=9991000007,insurerCode:We="99",proposalId:O}=n.query;let{productCode:S="MMBBSF"}=n.query;const D=v({personVO:{occupationCodeList:[]}}),R=v({insuredCode:"",personVO:{occupationCodeList:[]}}),C=v({}),q=v({}),j=v({}),E=v({}),M=v({}),e=ke({currentPlan:"",riskBaseInfo:{},holderFactor:[],insuredFactor:[],riskData:[],riskPlanData:[],trialResult:{},canTrial:!0,retrialTip:!1,enumList:{},ageRange:[],collapseName:["1"],insuredRiskList:[],currentRiskList:[]});if(O)try{S=(Y=JSON.parse(((w=n.query)==null?void 0:w.extInfo)||"{}"))==null?void 0:Y.productCenterCode}catch(o){console.log(o)}ye("premium",M.value),Fe().get("userInfo");const ie="premiumTrial",oe=()=>{e.retrialTip=!1},ae=(o,i)=>{e.insuredRiskList=o.map(t=>{var r,d;return{initialAmount:(r=i[t.riskCode])==null?void 0:r.amount,amountUnit:1,annuityDrawFrequency:t.annuityDrawDate,annuityDrawType:t.annuityDrawType,paymentFrequency:t.paymentFrequency,paymentPeriod:t.chargePeriod.split("_")[1],paymentPeriodType:Ne[t.chargePeriod.split("_")[0]],insurancePeriodType:be[t.coveragePeriod==="to_life"?"to_life":t.coveragePeriod.split("_")[0]],insurancePeriodValue:Number.isNaN(+t.coveragePeriod.split("_")[1])?0:t.coveragePeriod.split("_")[1],riskCode:t.riskCode,riskType:t.riskType,extInfo:{riskId:t.riskId,copy:t.copy},initialPremium:(d=i[t.riskCode])==null?void 0:d.premium,liabilityDetails:t.liabilityVOList.map(s=>({liabilityCode:s.liabilityCode,liabilityName:s.liabilityName,refundMethod:s.liabilityAttributeValue})),productId:e.riskBaseInfo.id}})},re=()=>{Re({agencyId:te,saleUserId:ee,tenantId:x,venderCode:e.riskBaseInfo.insurerCode,orderDataSource:1,proposalId:O,extInfo:{templateId:+(g||1),pageCode:ie,iseeBizNo:window.iseeBiz},tenantOrderHolder:{extInfo:{occupationCodeList:R.value.personVO.occupationCodeList}},tenantOrderInsuredList:[{extInfo:{occupationCodeList:D.value.personVO.occupationCodeList},tenantOrderProductList:[{productCode:e.riskBaseInfo.productCode||"",productName:e.riskBaseInfo.productName||"",premium:e.trialResult.premium||0,tenantOrderRiskList:e.insuredRiskList}]}]}).then(({code:o,data:i})=>{o==="10000"&&i.pageAction.pageAction==="jumpToPage"&&c.push({path:Be[i.pageAction.data.nextPageCode],query:A(N({insurerCode:e.riskBaseInfo.insurerCode},n.query),{orderNo:i.pageAction.data.orderNo})})})},se=()=>{const o=JSON.parse(JSON.stringify(C.value[e.currentPlan])),i=Object.values(o).find(r=>r.riskType===1),t=Object.values(o).map(r=>{const d=r;if(d.chargePeriod==="3"){const s=(i.chargePeriod||"").split("_");s[1]&&(s[1]-=1),d.chargePeriod=s.join("_")}return d.liabilityVOList=(d.liabilityVOList||[]).filter(s=>s.optionalFlag===1||s.liabilityAttributeValue&&s.liabilityAttributeValue!=="-1").map(s=>{const p=s;return p.liabilityAttributeValue==="0"&&(p.liabilityAttributeValue=""),p}),d}),u={holder:D.value,productCode:e.riskBaseInfo.productCode,insuredVOList:[A(N({},R.value),{productPlanVOList:[{planCode:e.currentPlan||"",insurerCode:e.riskBaseInfo.insurerCode,riskVOList:t}]})]};Ie(N({},u)).then(({code:r,data:d})=>{if(r==="10000"){e.retrialTip=!1,e.trialResult=d,e.canTrial=!1;const s={},p=(L=[])=>{(L||[]).forEach(m=>{var T;s[m.riskCode]=m,((T=m.riskPremiumDetailVOList)==null?void 0:T.length)&&p(m.riskPremiumDetailVOList)})};p(d.riskPremiumDetailVOList),ae(u.insuredVOList[0].productPlanVOList[0].riskVOList,s),Object.assign(M.value,s)}})},ne=()=>{var o,i,t,u,r;Promise.all([(i=(o=q.value)==null?void 0:o.validateForm)==null?void 0:i.call(o),(u=(t=j.value)==null?void 0:t.validateForm)==null?void 0:u.call(t),(r=E.value)==null?void 0:r.validate()]).then(()=>{se()})},le=()=>{Te({dictCodeList:["RISK_PAYMENT_PERIOD","RISK_INSURANCE_PERIOD"]}).then(({code:i,data:t})=>{if(i==="10000"){const u={};t.forEach(r=>{u[r.dictCode]=r.dictItemList}),e.enumList=u}})},ue=o=>{Oe({id:O,tenantId:x}).then(({code:i,data:t})=>{var u;if(i==="10000"){const r=((u=t.proposalInsuredList)==null?void 0:u[0])||{},{proposalInsuredProductList:d=[]}=r,s=Q(r,["proposalInsuredProductList"]);Object.assign(D.value.personVO,t.proposalHolder);const p=d.find(m=>m.productId===o);Object.assign(R.value.personVO,s,{occupationCodeList:(p==null?void 0:p.occupationCodeList)||[]});const L={};((p==null?void 0:p.proposalProductRiskList)||[]).forEach(m=>{L[m.riskId]=m}),Object.assign(C.value,{0:L})}})},ce=()=>{he({productCode:S,source:1}).then(({code:o,data:i})=>{var t;o==="10000"&&(e.riskBaseInfo=i.productBasicInfoVO,(i.productRelationPlanVOList.length?i.productRelationPlanVOList:i.productRiskVoList[0].riskDetailVOList||[]).forEach((u,r)=>{r===0&&(e.currentPlan=u.planCode||"0"),O||Object.assign(C.value,{[u.planCode||r]:{}})}),e.riskData=((t=i.productRiskVoList[0])==null?void 0:t.riskDetailVOList)||[],e.riskPlanData=i.productRelationPlanVOList||[],O&&ue(i.productBasicInfoVO.id))}).finally(()=>{})},U=o=>{e.holderFactor=o.holderFactorList,e.insuredFactor=o.insuredFactorList,e.ageRange=o.ageRange};return Pe([()=>C.value,()=>D.value,()=>R.value],o=>{o&&!e.canTrial&&(e.canTrial=!0,e.retrialTip=!0)},{deep:!0}),Ce(()=>{ce(),le()}),(o,i)=>{const t=P("ProTitle"),u=P("VanForm"),r=P("ProTabButton"),d=P("VanTab"),s=P("VanTabs"),p=P("van-collapse-item"),L=P("van-collapse"),m=P("VanButton"),T=P("ProPageWrap");return k(),B(T,{class:"page-trial-wrapper"},{default:y(()=>{var J,z,G;return[a(e).holderFactor.length?(k(),V("div",Ee,[_(t,{title:"\u6295\u4FDD\u4EBA"}),_(Z,{ref_key:"holderRef",ref:q,"insured-code":(J=a(e).riskBaseInfo)==null?void 0:J.insurerCode,"form-info":D.value.personVO,"factor-list":a(e).holderFactor,"age-range":a(e).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):h("",!0),a(e).insuredFactor.length?(k(),V("div",Ae,[_(t,{title:"\u88AB\u4FDD\u4EBA"}),_(Z,{ref_key:"insuredRef",ref:j,"insured-code":(z=a(e).riskBaseInfo)==null?void 0:z.insurerCode,"form-info":R.value.personVO,"factor-list":a(e).insuredFactor,"age-range":a(e).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):h("",!0),I("div",xe,[_(L,{modelValue:a(e).collapseName,"onUpdate:modelValue":i[1]||(i[1]=f=>a(e).collapseName=f)},{default:y(()=>[_(p,{name:"1"},{title:y(()=>[_(t,{title:"\u6295\u4FDD\u65B9\u6848"})]),default:y(()=>[a(e).riskData.length&&C.value[0]?(k(),V("div",Se,[_(u,{ref_key:"riskFormRef",ref:E,"input-align":"right","error-message-align":"right"},{default:y(()=>[_($,{"risk-info":C.value[0],enums:a(e).enumList,"origin-data":a(e).riskData,"pick-factor":U},null,8,["risk-info","enums","origin-data"])]),_:1},512)])):h("",!0),a(e).riskPlanData.length?(k(),V("div",qe,[_(u,{ref_key:"riskFormRef",ref:E,"input-align":"right","error-message-align":"right"},{default:y(()=>[_(s,{active:a(e).currentPlan,"onUpdate:active":i[0]||(i[0]=f=>a(e).currentPlan=f)},{default:y(()=>[(k(!0),V(ve,null,Le(a(e).riskPlanData,f=>(k(),B(d,{key:f.planCode,name:f.planCode,title:f.planName},{title:y(()=>[_(r,{title:f.planName,active:a(e).currentPlan===f.planCode},null,8,["title","active"])]),default:y(()=>{var H;return[f.planCode===a(e).currentPlan?(k(),B($,{key:0,"risk-info":C.value[f.planCode],enums:a(e).enumList,"origin-data":(H=f.productRiskVoList)==null?void 0:H[0].riskDetailVOList,"pick-factor":U},null,8,["risk-info","enums","origin-data"])):h("",!0)]}),_:2},1032,["name","title"]))),128))]),_:1},8,["active"])]),_:1},512)])):h("",!0)]),_:1})]),_:1},8,["modelValue"])]),I("div",je,[I("span",Me,[I("span",Ue,Ve((a(e).retrialTip?"0":((G=a(e).trialResult)==null?void 0:G.premium)||"0").toLocaleString()),1),we]),I("div",Ye,[a(e).retrialTip?(k(),V("div",Je,[ze,I("span",{class:"close-icon",onClick:oe},"X")])):h("",!0),a(e).canTrial?(k(),B(m,{key:1,type:"primary",onClick:ne},{default:y(()=>[Ge]),_:1})):(k(),B(m,{key:2,type:"primary",onClick:re},{default:y(()=>[He]),_:1}))])])]}),_:1})}}});var rt=De(Ke,[["__scopeId","data-v-c183ad30"]]);export{rt as default};
