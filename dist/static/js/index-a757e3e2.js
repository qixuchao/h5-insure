import{reactive as e,watch as t,ref as o,computed as a,onMounted as r,unref as l}from"vue";import{_ as n,x as u,aF as d,k as i,aI as s,a as c,u as v,o as m,s as p,aT as I,T as f,v as A,aU as C,h as g,F as D}from"./index-d66a20d8.js";import{a as E,c as h}from"./product-d1af8bd8.js";import{d as S,g as k,h as x,i as N}from"./trial-0ac61dce.js";import{P as T}from"./index-88613e6f.js";import{I as y}from"./trial-b3f7bf73.js";import{e as w}from"./utils-57fec98c.js";import{s as P}from"./core-15eeb464.js";import{O as U}from"./infoCollection-e6a8a0ee.js";import{T as L}from"./constant-8927d485.js";import{u as B}from"./useOrder-d2812e23.js";import{u as b}from"./useThread-c502137a.js";import"./pdfh5-e588f83d.js";import"./merge-e7788e50.js";import"./keysIn-131bbce9.js";import"./isObjectLike-a9798079.js";const G={class:"pro-curtain"},V=["src"],Y=vue.defineComponent({name:"curtain"});var O=n(vue.defineComponent({...Y,props:{show:{type:Boolean,default:!0}},emits:["close"],setup(o,{emit:a}){const r=o,l=e({show:r.show});return t((()=>r.show),(()=>{l.show=r.show}),{immediate:!0}),(e,t)=>{const o=vue.resolveComponent("van-overlay");return vue.openBlock(),vue.createBlock(o,{show:vue.unref(l).show},{default:vue.withCtx((()=>[vue.createElementVNode("div",G,[vue.renderSlot(e.$slots,"default",{},void 0,!0),vue.createElementVNode("img",{class:"close",src:vue.unref("data:image/png;base64,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"),onClick:t[0]||(t[0]=e=>a("close"))},null,8,V)])])),_:3},8,["show"])}}}),[["__scopeId","data-v-697ee98a"]]);const Q={class:"guarantee-list"},R=(e=>(vue.pushScopeId("data-v-186e639c"),e=e(),vue.popScopeId(),e))((()=>vue.createElementVNode("div",{class:"title"},"保障内容",-1))),M=["src"],F=vue.defineComponent({name:"guaranteeContent"});var W=n(vue.defineComponent({...F,props:{dataSource:{default:()=>[]},isShowClose:{type:Boolean,default:!1},count:{default:10}},setup(e){const r=e,l=o(r.dataSource||[]),[n,d]=u(!1),i=a((()=>{var e;return!(!l.value||!(null==(e=l.value)?void 0:e.length))&&(l.value.length>r.count&&(!!r.isShowClose||!n.value))})),s=()=>{d()},c=a((()=>{var e;return l.value&&(null==(e=l.value)?void 0:e.length)?l.value.length<=r.count||n.value?l.value:l.value.slice(0,r.count):[]}));return t((()=>r.dataSource),(()=>{l.value=r.dataSource})),(e,t)=>{const o=vue.resolveComponent("ProCell");return vue.openBlock(),vue.createElementBlock("div",Q,[R,(vue.openBlock(!0),vue.createElementBlock(vue.Fragment,null,vue.renderList(vue.unref(c),((e,t)=>(vue.openBlock(),vue.createBlock(o,{key:t,title:e.title,content:e.desc,border:!1},null,8,["title","content"])))),128)),vue.unref(i)?(vue.openBlock(),vue.createElementBlock("div",{key:0,class:"show-more",onClick:s},[vue.createTextVNode(vue.toDisplayString(vue.unref(n)?"收起":"查看更多")+" ",1),vue.createElementVNode("img",{src:vue.unref("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAjNJREFUOE+1VEtPE1EUPufM9GXKCnWlqAQZuhEff8CNxpYdSReVatIWJMYI7FkYF+wtxsSCBWNLY4JhZxHd+AdMqhs6PmJJWMkPsO303mPmQs10GJuawOxu5tzvfK9chCP+8Ijx4HgAVyZGskgQEgIXJkvbO//D+sXtyDlN43mW8Du9Vp1VDPNJ4xkiRoC5DhKz6VJ1qxfQ/MTITUSeA8QgM29niuYDBbh6/XyQzwZmAPCWfUbmLdAb2dTLWt0LeDE6FOjr12YYMfp3freRTX2s1Ts8VBuJZwEwxBJ2SMDj1OtqzQn66u7gQIt9jwDwgq1IAixOFs137ZlDobgvMPPTzNrXTaUkcfEG6zTXbaFnyrakcL/+EBBi+5vlB2Cy2meW8j35mk+8LOlaG8VII9v0kA3LzA1gXmwz9vJXAS4njRQC+qnR2kivf99zDubigwO+gH8egbUWwsJUwfzp/L8SHzolA/o4Azeniubqfm3uGBlgPMMITSnE5r3St0ovtXmeHB7VkWLI4Afk3UzBzCvA3DXwkWHEiPCyqgFxxQqGy9NLnywvYHtejxhRALyiHJZckWGzPL0EVoeHzo3Mcs8i8eZ+4cevDgsSwydJwzgBngYAS0hRdio6FErOdYGkKKcOLFhOGJdQxzFbor2QmnLd7blnym5JguUXImohw1WVNsjP4kTfWy9LutZGMSIcQwT/gWzLyfiftemWqG2BT6NxZqYmtTbcnrrvHs972Evnep35AykjACSCRaPlAAAAAElFTkSuQmCC"),class:vue.normalizeClass(["icon",{showMore:vue.unref(n)}])},null,10,M)])):vue.createCommentVNode("",!0)])}}}),[["__scopeId","data-v-186e639c"]]);const j=i([{value:d.PENDING,label:"待处理"},{value:d.PAYING,label:"订单未完成，逾期将失效"},{value:d.PAYMENT_SUCCESS,label:"支付成功"},{value:d.PAYMENT_FAILED,label:"支付失败"},{value:d.CANCELED,label:"已失效"},{value:d.ACCEPT_POLICY,label:"投保成功"},{value:d.INSURER_REJECT,label:"保司拒保"},{value:d.TIMEOUT,label:"订单已经关闭"},{value:d.UNDER_WRITING_SUCCESS,label:"核保通过"},{value:d.NOTE,label:"照会"},{value:d.MANUAL_UNDERWRITING,label:"人工核保"},{value:d.INSURANCE_PROCESSING,label:"保司处理中"}]),z={[d.ACCEPT_POLICY]:"恭喜 您已成功购买保障",[d.CANCELED]:"赠险保单已失效",[d.PAYING]:"剩余支付时间：23:59:59",[d.TIMEOUT]:"请您重新提交订单"};const H={class:"page-pay-result"},K={class:"header"},q={class:"product-status"},J=["innerHTML"],Z={class:"prodouct-container"},X={class:"product-card"},_={class:"product-name"},$={class:"label"},ee={class:"value"},te=["src"],oe=["src"];var ae=n(vue.defineComponent({__name:"index",setup(t){const n=s(),u=c(),i=v(),{tenantId:G,from:V="other",orderNo:Y,preview:Q,productCode:R,channelCode:M="",templateView:F}=i.query;let ae="";const re=e({insureDetail:{},detail:{},orderDetail:{},showOrderDetail:!1,guaranteeItemVOS:[],pageInfo:{title:"",desc:"",insureList:[],productImage:"",notificationImage:""},timeDown:{},templateId:"2"}),le=o(!1),ne=o(),ue=a((()=>[d.ACCEPT_POLICY,d.CANCELED,d.PAYMENT_SUCCESS].includes(re.orderDetail.orderStatus)?"下载保单":d.PAYING===re.orderDetail.orderStatus?"立即支付":d.TIMEOUT===re.orderDetail.orderStatus?"重下一单":"")),de=a((()=>M||re.orderDetail.extInfo.extraInfo.channelCode)),ie=a((()=>!!Q)),se=async(e=!1,t="")=>{var o,a,r,l;try{const{templateId:n}=re.orderDetail.extInfo.extraInfo;delete re.orderDetail.extInfo.extraInfo.templateId;const d={insurerCode:e?null==(o=ne.value)?void 0:o.insurerCode:re.orderDetail.venderCode,productCode:e?null==(a=ne.value)?void 0:a.productCode:ae,tenantId:G,agencyCode:re.orderDetail.agencyId,agentCode:re.orderDetail.agentCode,saleChannelId:null==(l=null==(r=re.orderDetail.extInfo)?void 0:r.extraInfo)?void 0:l.saleChannelId};if(n===L.UPGRADE)return d.extraInfo=decodeURIComponent(JSON.stringify({...re.orderDetail.extInfo.extraInfo,channelCode:de.value,templateId:n})),d.orderNo=Y,ie.value&&(d.productCode="ZXYS2023"),void u.push(`/baseInsurance/upgrade?${m.stringify(d)}`);d.extraMap={...re.orderDetail.extInfo.extraInfo,channelCode:de.value},e&&(d.extraMap.promotion=t),delete d.extraMap.templateId;const i=await S(d);if("10000"===i.code){if(!e){const{holder:e,insuredList:t}=re.orderDetail;p.set(U,{holder:e,insuredList:t})}window.location.href=i.data||""}}catch(n){console.log(n)}},ce=async()=>{var e,t,o,a,r,l;if("下载保单"===ue.value){if(l="预览模式无法下载保单",!ie.value||(f(l),0))if(null==(e=re.orderDetail.extInfo)?void 0:e.policyUrl)(null==(a=re.orderDetail.extInfo)?void 0:a.policyUrl)&&I(null==(r=re.orderDetail.extInfo)?void 0:r.policyUrl);else{const e=await k({orderNo:Y,tenantId:G});"10000"===e.code&&(re.orderDetail=e.data,(null==(t=re.orderDetail.extInfo)?void 0:t.policyUrl)?I(null==(o=re.orderDetail.extInfo)?void 0:o.policyUrl):f("电子保单单生成中，请稍后再试"))}}else"立即支付"===ue.value?x({...re.orderDetail,extInfo:{...re.orderDetail.extInfo,redirectUrl:window.location.href}}).then((e=>{"10000"===e.code&&P(e.data.paymentUrl)})):"重下一单"===ue.value&&se(!1)},ve=()=>{var e,t,o,a,r,l,n,u,i,s,c,v,m;[d.PAYMENT_SUCCESS,d.ACCEPT_POLICY].includes(re.orderDetail.orderStatus)&&(re.orderDetail.orderStatus=d.ACCEPT_POLICY),re.pageInfo.title=j[re.orderDetail.orderStatus],re.pageInfo.desc=z[re.orderDetail.orderStatus],C((null==(t=null==(e=re.detail)?void 0:e.tenantProductInsureVO)?void 0:t.productName)||""),re.templateId=re.orderDetail.extInfo.templateId||"4";let p="";if("2"===re.templateId.toString()?re.orderDetail.insuredList[0].productList.forEach((e=>p?null:(e.riskList.forEach((e=>{1!==e.riskType||p||(p=w(e.insurancePeriodValue,y[e.insurancePeriodType]))})),!1))):(re.pageInfo.insureList=[{label:(re.templateId===L.UPGRADE&&"1"===(null==(r=null==(a=null==(o=re.orderDetail)?void 0:o.extInfo)?void 0:a.extraInfo)?void 0:r.isUpgrade)?"下":"本")+"期缴费金额",value:`${re.orderDetail.orderAmount}元`}],p=`${g(re.orderDetail.commencementTime).format("YYYY.MM.DD")}到${g(re.orderDetail.expiryDate).format("YYYY.MM.DD")}`),re.pageInfo.insureList=[...re.pageInfo.insureList,{label:"被保人",value:null==(u=null==(n=null==(l=re.orderDetail)?void 0:l.insuredList)?void 0:n[0])?void 0:u.name},{label:"保障期间",value:p||""}],re.templateId=re.orderDetail.extInfo.templateId,d.PAYING===re.orderDetail.orderStatus){const e=(null==(s=null==(i=re.orderDetail.tenantOrderPaymentInfoList)?void 0:i[0])?void 0:s.paymentExpiryDate)||g().add(8.5,"hour");re.timeDown=D({time:g(e).diff(new Date,"millisecond")}),re.timeDown.start()}const I=(null==(c=re.orderDetail.insuredList)?void 0:c[0].planCode)||"";re.guaranteeItemVOS=(null==(m=null==(v=re.detail)?void 0:v.GUARANTEE.find((e=>!e.planCode||e.planCode===I)))?void 0:m.data)||[]};let me;me=b({start(){console.log("轮询中..."),k({orderNo:Y,tenantId:G,withProductInfo:!0}).then((e=>{const{data:t}=e;"10000"===e.code&&t.orderStatus!==d.PAYING&&(re.orderDetail=t,ve(),me.stop())}))},stop(){console.log("轮询结束,结束方式：配置轮询次数")},number:5,time:2e3});const pe=async()=>{var e,t,o,a;const r=await new Promise(((e,t)=>{if(ie.value){const t=B({extInfo:{buttonCode:"EVENT_SHORT_saveOrder",pageCode:"productInfo",iseeBizNo:"",templateId:F,extraInfo:{templateId:F}}});t.value.orderAmount=(1e3*Math.random()).toFixed(2),t.value.orderStatus="acceptPolicy",t.value.insuredList[0].name="小安",t.value.commencementTime=g().format("YYYY-MM-DD HH:mm:ss"),t.value.expiryDate=g().add(1,"year").format("YYYY-MM-DD HH:mm:ss"),t.value.insuredList[0].productList[0]={productCode:R,riskList:[{riskType:1,insurancePeriodValue:"1",insurancePeriodType:3}]},e({code:"10000",data:l(t)})}else k({orderNo:Y,tenantId:G,withProductInfo:!0}).then((o=>{"10000"===o.code?e(o):t()}))}));if(console.log(r,"orderRes"),"10000"===r.code){if(re.orderDetail=r.data,ae=(null==(a=null==(o=null==(t=null==(e=r.data.insuredList)?void 0:e[0])?void 0:t.productList)?void 0:o[0])?void 0:a.productCode)||"",!ae)return"";const l=!Number.isNaN(+G)&&E({productCode:ae,withInsureInfo:!0,tenantId:G}),n=N({productCode:ae});(async e=>{var t,o;const{code:a,data:r}=await h({productCode:e});"10000"===a&&(ne.value=r,"free"!==V&&[d.PAYING,d.TIMEOUT].includes(re.orderDetail.orderStatus)?re.showOrderDetail=!0:r.productCode&&(re.pageInfo.notificationImage=(null==(t=null==r?void 0:r.notificationImage)?void 0:t[0])||"",re.pageInfo.productImage=(null==(o=null==r?void 0:r.productImage)?void 0:o[0])||"",le.value=!!re.pageInfo.notificationImage))})(ae),Promise.all([l,n]).then((([e,t])=>{"10000"===e.code&&(re.detail=e.data,e.data.BASIC_INFO&&e.data.BASIC_INFO.themeType&&A(e.data.BASIC_INFO.themeType)),"10000"===t.code&&(re.insureDetail=t.data),re.orderDetail.orderStatus===d.PAYING&&me.run(),ve()}))}return""},Ie=e=>{const t=`${e}`.length;let o="";for(let a=0;a<2-t;a++)o+="0";return o+e},fe=a((()=>{var e,t,o;return d.PAYING===(null==(e=re.orderDetail)?void 0:e.orderStatus)?(null==(o=null==(t=re.timeDown)?void 0:t.current)?void 0:o.total)<=0?(re.orderDetail.orderStatus=d.TIMEOUT,re.pageInfo.title=j[re.orderDetail.orderStatus],re.pageInfo.desc=z[re.orderDetail.orderStatus],re.timeDown.pause(),re.pageInfo.desc):`剩余支付时间：${Ie(re.timeDown.current.hours)}:${Ie(re.timeDown.current.minutes)}:${Ie(re.timeDown.current.seconds)}`:re.pageInfo.desc}));return r((()=>{pe()})),(e,t)=>{var o;return vue.openBlock(),vue.createElementBlock(vue.Fragment,null,[vue.createElementVNode("div",H,[vue.createElementVNode("div",K,[vue.createElementVNode("div",q,vue.toDisplayString(vue.unref(re).pageInfo.title),1),"重下一单"!==vue.unref(ue)||"3"!==vue.unref(re).templateId.toString()?(vue.openBlock(),vue.createElementBlock("div",{key:0,class:"desc",innerHTML:vue.unref(fe)},null,8,J)):vue.createCommentVNode("",!0)]),vue.createElementVNode("div",Z,[vue.createElementVNode("div",X,[vue.createElementVNode("div",_,vue.toDisplayString((null==(o=vue.unref(re).insureDetail)?void 0:o.productName)||""),1),(vue.openBlock(!0),vue.createElementBlock(vue.Fragment,null,vue.renderList(vue.unref(re).pageInfo.insureList,((e,t)=>(vue.openBlock(),vue.createElementBlock("div",{key:t,class:"list"},[vue.createElementVNode("span",$,vue.toDisplayString(e.label),1),vue.createElementVNode("span",ee,vue.toDisplayString(e.value),1)])))),128)),"重下一单"!==vue.unref(ue)||"3"!==vue.unref(re).templateId.toString()?(vue.openBlock(),vue.createBlock(T,{key:0,"theme-vars":vue.unref(n),class:"btn",text:vue.unref(ue),onClick:ce},null,8,["theme-vars","text"])):vue.createCommentVNode("",!0)]),vue.unref(re).pageInfo.productImage?(vue.openBlock(),vue.createElementBlock("img",{key:0,class:"product-img",src:vue.unref(re).pageInfo.productImage,onClick:t[0]||(t[0]=e=>se(!0,"GDGGW"))},null,8,te)):vue.createCommentVNode("",!0),vue.unref(re).showOrderDetail?(vue.openBlock(),vue.createBlock(W,{key:1,"is-show-close":"",count:5,"data-source":vue.unref(re).guaranteeItemVOS},null,8,["data-source"])):vue.createCommentVNode("",!0)])]),vue.createVNode(O,{show:vue.unref(le),"onUpdate:show":t[2]||(t[2]=e=>vue.isRef(le)?le.value=e:null),onClose:t[3]||(t[3]=e=>le.value=!1)},{default:vue.withCtx((()=>[vue.createElementVNode("img",{class:"jump-img",src:vue.unref(re).pageInfo.notificationImage,style:{display:"block"},onClick:t[1]||(t[1]=e=>se(!0,"TCGGW"))},null,8,oe)])),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-769c96ae"]]);export{ae as default};
