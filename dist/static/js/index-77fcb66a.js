var vt=Object.defineProperty;var J=Object.getOwnPropertySymbols;var ft=Object.prototype.hasOwnProperty,kt=Object.prototype.propertyIsEnumerable;var Z=(a,i,u)=>i in a?vt(a,i,{enumerable:!0,configurable:!0,writable:!0,value:u}):a[i]=u,tt=(a,i)=>{for(var u in i||(i={}))ft.call(i,u)&&Z(a,u,i[u]);if(J)for(var u of J(i))kt.call(i,u)&&Z(a,u,i[u]);return a};import{g as st,a5 as H,C as E,x as et,X as at,r as P,h as k,m as B,F as W,E as X,y as e,n as d,I as D,z as _,j as b,k as p,s as K,B as I,a1 as ut,a2 as rt,af as It,Q as ht,o as Pt,d as Lt,a6 as Dt,D as Ft}from"./vendor-d47732e4.js";import{u as Rt,P as gt}from"./index-c3aba4bb.js";import{b as z,_ as it,p as M,o as yt}from"./index-dcbfa701.js";import{u as ot}from"./useDicData-cf40d739.js";import"./index-557f54f0.js";import"./trial-f272328d.js";import"./index-1e238587.js";import"./useStorage-6aadb995.js";import"./trial-e4e6422f.js";const Ct=a=>z.post("/api/app/insure/proposal/AddOrUpdateProposal",a),Vt=(a={})=>z.get(`/api/app/insure/proposal/queryProposalDetail/${a.id}`,a),Et=(a={})=>z.post("/api/app/insure/product/listInsureProductDetail",a);const $=a=>(ut("data-v-2be45547"),a=a(),rt(),a),Bt={class:"com-product-list-wrapper"},bt={class:"risk-item-wrapper"},$t={class:"content"},Ot={class:"risk-premium"},At=I(" \u4FDD\u8D39:"),Nt={class:"premium"},St={class:"risk-factor"},xt={class:"factor"},wt={class:"factor-value"},Tt=$(()=>e("span",{class:"factor-name"}," \u4FDD\u989D(\u5143) ",-1)),Ut={class:"factor"},qt={class:"factor-value"},Yt=$(()=>e("span",{class:"factor-name"}," \u4FDD\u969C\u671F\u95F4 ",-1)),jt={class:"factor"},Mt={class:"factor-value"},Kt=$(()=>e("span",{class:"factor-name"}," \u7F34\u8D39\u671F\u95F4 ",-1)),Ht={class:"operate-bar"},Wt=I("\u5220\u9664"),Xt=I("+ \u9644\u52A0\u9669"),zt=I("\u4FEE\u6539"),Qt={class:"content"},Gt={class:"risk-premium"},Jt=I(" \u4FDD\u8D39:"),Zt={class:"premium"},te={class:"risk-factor"},ee={class:"factor"},oe={class:"factor-value"},se=$(()=>e("span",{class:"factor-name"}," \u4FDD\u989D(\u5143) ",-1)),ae={class:"factor"},ue={class:"factor-value"},re=$(()=>e("span",{class:"factor-name"}," \u4FDD\u969C\u671F\u95F4 ",-1)),ie={class:"factor"},ne={class:"factor-value"},de=$(()=>e("span",{class:"factor-name"}," \u7F34\u8D39\u671F\u95F4 ",-1)),le={class:"operate-bar"},ce=I("\u5220\u9664"),pe=I("+ \u9644\u52A0\u9669"),_e=I("\u4FEE\u6539"),me={class:"premium-total"},ve=I(" \u4FDD\u8D39: "),fe={class:"premium"},ke=st({props:{productRiskList:{default:()=>[]},productInfo:{default:()=>({})},productData:{default:()=>({})},pickProductPremium:{type:Function,default:()=>{}},productNum:{default:0}},emits:["deleteRisk","updateRisk","addRiderRisk"],setup(a,{emit:i}){const u=a;H();const V=E({checkedList:[],disabledList:[],riderRiskList:[],mainRiskData:{},totalPremium:0,currentRiskRecord:{}}),g=ot("RISK_PAYMENT_PERIOD"),o=ot("RISK_INSURANCE_PERIOD");et(()=>{var n,h;return((h=(n=u.productData)==null?void 0:n.riskDetailVOList)==null?void 0:h[0].optionalRiderRiskVOList)||[]}),et(()=>{var n,h;return((h=(n=u.productData)==null?void 0:n.riskDetailVOList)==null?void 0:h[0].collocationVOList)||[]});const O=n=>{i("deleteRisk",n,u.productInfo)},S=n=>{i("updateRisk",n,u.productInfo)},F=n=>{V.value.currentRiskRecord=n,i("addRiderRisk",u.productInfo)};return at(()=>u.productInfo,n=>{var f;let h=0;const r=l=>{l.forEach(R=>{var y;h+=R.premium,((y=R.riderRiskVOList)==null?void 0:y.length)&&r(R.riderRiskVOList)})};r(n.proposalProductRiskList||[]),(f=u==null?void 0:u.pickProductPremium)==null||f.call(u,{[`${n.productId}`]:h}),V.value.totalPremium=h},{deep:!0,immediate:!0}),(n,h)=>{const r=P("ProTitle"),f=P("ProCheckButton");return k(),B("div",Bt,[(k(!0),B(W,null,X(a.productRiskList,l=>{var R,y,x,w;return k(),B("div",{key:l.riskId},[e("div",bt,[d(r,{"risk-type":l.riskType,title:l.riskName},null,8,["risk-type","title"]),e("div",$t,[e("div",Ot,[At,e("span",Nt,"\uFFE5"+D(l.premium.toLocaleString()),1)]),e("div",St,[e("div",xt,[e("span",wt,D(l.amount.toLocaleString()),1),Tt]),e("div",Ut,[e("span",qt,D(_(M)(_(o),l.coveragePeriod)),1),Yt]),e("div",jt,[e("span",Mt,D(_(M)(_(g),l.chargePeriod)),1),Kt])]),e("div",Ht,[a.productNum?(k(),b(f,{key:0,round:32,class:"border",onClick:v=>O(l)},{default:p(()=>[Wt]),_:2},1032,["onClick"])):K("",!0),((w=(x=(y=(R=a.productData)==null?void 0:R.riskDetailVOList)==null?void 0:y[0])==null?void 0:x.optionalRiderRiskVOList)==null?void 0:w.length)?(k(),b(f,{key:1,activated:"",round:32,onClick:v=>F(l)},{default:p(()=>[Xt]),_:2},1032,["onClick"])):K("",!0),d(f,{activated:"",round:32,onClick:v=>S(l)},{default:p(()=>[zt]),_:2},1032,["onClick"])])])]),(k(!0),B(W,null,X(l.riderRiskVOList,v=>{var T,U,q,Y;return k(),B("div",{key:v.riskCode,class:"risk-item-wrapper"},[d(r,{"risk-type":v.riskType,title:v.riskName},null,8,["risk-type","title"]),e("div",Qt,[e("div",Gt,[Jt,e("span",Zt,"\uFFE5"+D(v.premium.toLocaleString()),1)]),e("div",te,[e("div",ee,[e("span",oe,D(l.amount.toLocaleString()),1),se]),e("div",ae,[e("span",ue,D(_(M)(_(o),v.coveragePeriod)),1),re]),e("div",ie,[e("span",ne,D(_(M)(_(g),v.chargePeriod)),1),de])]),e("div",le,[d(f,{round:32,class:"border",onClick:j=>O(v)},{default:p(()=>[ce]),_:2},1032,["onClick"]),((Y=(q=(U=(T=a.productData)==null?void 0:T.riskDetailVOList)==null?void 0:U[0])==null?void 0:q.optionalRiderRiskVOList)==null?void 0:Y.length)?(k(),b(f,{key:0,activated:"",round:32,onClick:j=>F(v)},{default:p(()=>[pe]),_:2},1032,["onClick"])):K("",!0),d(f,{activated:"",round:32,onClick:j=>S(v)},{default:p(()=>[_e]),_:2},1032,["onClick"])])])])}),128)),e("div",me,[ve,e("span",fe,"\uFFE5"+D(V.value.totalPremium.toLocaleString()),1)])])}),128))])}}});var Ie=it(ke,[["__scopeId","data-v-2be45547"]]);const he=a=>(ut("data-v-0334e900"),a=a(),rt(),a),Pe={class:"container"},Le=he(()=>e("span",null,"\u8BA1\u5212\u4E66\u540D\u79F0",-1)),De={class:"operate-bar"},Fe=I("\u6DFB\u52A0\u4E3B\u9669"),Re={class:"footer-bar"},ge={class:"trial-result"},ye=I(" \u603B\u4FDD\u8D39 "),Ce={class:"result-num"},Ve={class:"trial-operate"},Ee=I("\u4FDD\u5B58\u5E76\u9884\u89C8"),Be=st({setup(a){const[i,u]=H(!1),[V,g]=H(),o=E({proposalHolder:{},proposalInsuredList:[{name:"",gender:"",birthday:"",proposalInsuredProductList:[]}],proposalName:"",totalPremium:0,relationUserType:2}),O=It(),S=ht(),F=Rt(),{id:n,type:h="add"}=S.query,r=E({productId:0,productCollection:{},productInfo:{},productPremium:{},riderRisk:{},type:"add",currentRisk:[]}),f=E();E({}),E([]);const l=(s,t,m)=>/^.{1,20}$/.test(t)?"":`${s}\u4E0D\u80FD\u8D85\u8FC720\u4E2A\u5B57\u7B26`,R=(s,t)=>{const m=t;Ft.confirm({message:"\u786E\u8BA4\u5220\u9664\u8BE5\u9669\u79CD\uFF1F"}).then(()=>{s.riskType===1?o.value.proposalInsuredList[0].proposalInsuredProductList=o.value.proposalInsuredList[0].proposalInsuredProductList.filter(C=>C.productId!==t.productId):m.proposalProductRiskList[0].riderRiskVOList=m.proposalProductRiskList[0].riderRiskVOList.filter(C=>C.riskId!==s.riskId)})},y=(s,t)=>{r.value.productId=t.productId,r.value.productInfo=t,r.value.type="edit",r.value.currentRisk=[s.riskId],g(!0)},x=s=>{r.value.productId=s.productId,r.value.productInfo=s,r.value.type="addRiderRisk",g(!0)},w=(s={})=>{Object.assign(r.value.productPremium,s),o.value.totalPremium=Object.values(r.value.productPremium).reduce((t,m)=>t+m,0)},v=()=>{Vt({id:n}).then(({code:s,data:t})=>{s==="10000"&&Object.assign(o.value,t)})},T=()=>{f.value.validate().then(()=>{Ct(o.value).then(({code:s,data:t})=>{s==="10000"&&(F.$reset(),O.push({path:"/compositionProposal",query:{id:t}}))})})},U=s=>{o.value.proposalInsuredList[0].proposalInsuredProductList=o.value.proposalInsuredList[0].proposalInsuredProductList.map(t=>{let m=t;return t.productId===s.proposalInsuredList[0].proposalInsuredProductList[0].productId&&(m=tt({},s.proposalInsuredList[0].proposalInsuredProductList[0])),m}),g(!1)},q=s=>{Et(s).then(({code:t,data:m})=>{t==="10000"&&(r.value.productCollection=m)}).finally(()=>{})},Y=()=>{F.setProposalInfo(o.value),F.setExcludeProduct(Object.keys(r.value.productCollection)),O.push({path:"/proposalList",query:{isCreateProposal:"1"}})},j=()=>{g(!1)};return Pt(()=>{const s=F.$state.trialData,t=F.$state.proposalInfo;n?v():!Object.keys(t).length&&s.length?Object.assign(o.value,s[0]):Object.keys(t).length&&s.length&&(t.proposalInsuredList[0].proposalInsuredProductList.push(...s[0].proposalInsuredList[0].proposalInsuredProductList),o.value=t)}),at(()=>{var s;return(s=o.value.proposalInsuredList[0].proposalInsuredProductList)==null?void 0:s.length},()=>{const s=o.value.proposalInsuredList[0].proposalInsuredProductList.map(t=>({productId:t.productId,source:2}));q({voList:s})}),(s,t)=>{const m=P("VanField"),C=P("ProCard"),nt=P("ProRadioButton"),dt=P("VanForm"),lt=P("ProCheckButton"),ct=P("VanButton"),pt=P("van-datetime-picker"),_t=P("van-popup"),mt=P("ProPageWrap");return k(),b(mt,{class:"page-create-wrapper"},{default:p(()=>{var Q;return[e("div",Pe,[d(dt,{ref_key:"formRef",ref:f,"input-align":"right","error-message-align":"right"},{default:p(()=>[d(C,null,{default:p(()=>[d(m,{modelValue:o.value.proposalName,"onUpdate:modelValue":t[0]||(t[0]=c=>o.value.proposalName=c),name:"proposalName",placeholder:"\u8BF7\u8F93\u5165\u8BA1\u5212\u4E66\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u8BA1\u5212\u4E66\u540D\u79F0"},{validator:(...c)=>l("\u8BA1\u5212\u4E66\u540D\u79F0",...c)}]},{label:p(()=>[Le]),_:1},8,["modelValue","rules"])]),_:1}),d(C,{title:"\u88AB\u4FDD\u4EBA\u4FE1\u606F"},{default:p(()=>{var c,A,N,G;return[d(m,{modelValue:o.value.proposalInsuredList[0].name,"onUpdate:modelValue":t[1]||(t[1]=L=>o.value.proposalInsuredList[0].name=L),name:"name",label:"\u59D3\u540D",rules:[{validator:(...L)=>l("\u59D3\u540D",...L)}],placeholder:"\u8BF7\u8F93\u5165\uFF08\u9009\u586B\uFF09"},null,8,["modelValue","rules"]),d(m,{modelValue:o.value.proposalInsuredList[0].birthday,"onUpdate:modelValue":t[2]||(t[2]=L=>o.value.proposalInsuredList[0].birthday=L),name:"birthday",label:"\u51FA\u751F\u65E5\u671F",formate:"YYYY-MM-DD","is-link":"",readonly:"","min-date":(A=(c=o.value.proposalInsuredList[0])==null?void 0:c.dateRange)==null?void 0:A.minAge,"max-date":(G=(N=o.value.proposalInsuredList[0])==null?void 0:N.dateRange)==null?void 0:G.maxAge,placeholder:"\u8BF7\u9009\u62E9",rules:[{required:!0,message:"\u8BF7\u9009\u62E9"}],onClick:t[3]||(t[3]=L=>_(u)(!0))},null,8,["modelValue","min-date","max-date"]),d(m,{modelValue:o.value.proposalInsuredList[0].gender,"onUpdate:modelValue":t[5]||(t[5]=L=>o.value.proposalInsuredList[0].gender=L),name:"gender",label:"\u6027\u522B",rules:[{required:!0,message:"\u8BF7\u9009\u62E9"}]},{input:p(()=>[d(nt,{modelValue:o.value.proposalInsuredList[0].gender,"onUpdate:modelValue":t[4]||(t[4]=L=>o.value.proposalInsuredList[0].gender=L),options:_(yt)},null,8,["modelValue","options"])]),_:1},8,["modelValue"])]}),_:1})]),_:1},512),(k(!0),B(W,null,X(o.value.proposalInsuredList[0].proposalInsuredProductList||[],c=>(k(),b(C,{key:c.productId},{default:p(()=>{var A,N;return[d(Ie,{"product-risk-list":c.proposalProductRiskList,"product-info":c,"product-num":((N=(A=o.value.proposalInsuredList[0])==null?void 0:A.proposalInsuredProductList)==null?void 0:N.length)-1,"product-data":r.value.productCollection[c.productId],"pick-product-premium":w,onAddRiderRisk:x,onUpdateRisk:y,onDeleteRisk:R},null,8,["product-risk-list","product-info","product-num","product-data"])]}),_:2},1024))),128)),e("div",De,[d(lt,{activated:"",round:34,onClick:Y},{default:p(()=>[Fe]),_:1})])]),e("div",Re,[e("span",ge,[ye,e("span",Ce,"\uFFE5"+D(o.value.totalPremium.toLocaleString()),1)]),e("div",Ve,[d(ct,{type:"primary",onClick:T},{default:p(()=>[Ee]),_:1})])]),d(_t,{show:_(i),"onUpdate:show":t[8]||(t[8]=c=>Dt(i)?i.value=c:null),position:"bottom"},{default:p(()=>[d(pt,{type:"date",onConfirm:t[6]||(t[6]=c=>{o.value.proposalInsuredList[0].birthday=_(Lt)(c).format("YYYY-MM-DD"),_(u)(!1)}),onCancel:t[7]||(t[7]=c=>_(u)(!1))})]),_:1},8,["show"]),_(V)?(k(),b(gt,{key:0,"is-show":_(V),type:r.value.type,"rider-risk":((Q=r.value.riderRisk)==null?void 0:Q[r.value.productId])||[],"product-data":r.value.productCollection[r.value.productId],"form-info":r.value.productInfo,holder:o.value.proposalHolder,insured:o.value.proposalInsuredList[0],"current-risk":r.value.currentRisk,onClose:j,onFinished:U},null,8,["is-show","type","rider-risk","product-data","form-info","holder","insured","current-risk"])):K("",!0)]}),_:1})}}});var qe=it(Be,[["__scopeId","data-v-0334e900"]]);export{qe as default};
