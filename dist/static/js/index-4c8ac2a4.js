var G=Object.defineProperty,z=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var R=(l,t,o)=>t in l?G(l,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[t]=o,O=(l,t)=>{for(var o in t||(t={}))W.call(t,o)&&R(l,o,t[o]);if(q)for(var o of q(t))Y.call(t,o)&&R(l,o,t[o]);return l},w=(l,t)=>z(l,J(t));import{g as P,E as g,M,_ as K,r as h,j as I,k as D,m as E,p as y,A as a,z as v,J as X,L as Q,T as k,O as Z,a9 as ee,h as te,n as ae,G as oe,F as ne,C as ue}from"./vendor-fba8f663.js";import{R as se}from"./infoCollection-b0426750.js";import{s as re,c as le}from"./phoneVerify-731a4568.js";import{v as H,a as $,b as ie}from"./validator-ebd71d12.js";import{F as S,g as ce}from"./utils-5991a446.js";import{G as me}from"./index-274c0709.js";import{g as de,m as fe,i as pe}from"./trial-be0f5d7a.js";import{p as ve}from"./product-7586effe.js";import{t as _e}from"./theme-eeb93d73.js";import"./trial-4c1aaa5e.js";const he=P({props:{userInfo:{type:Object,default:()=>{}}},emits:["on-verify"],setup(l,{emit:t}){var x;const o=l,u=g({}),s=g(!1),V=30,d=g(0),b=g("\u83B7\u53D6\u9A8C\u8BC1\u7801"),n=M({mobile:(x=o.userInfo)==null?void 0:x.mobile,smsCode:""}),C=c=>H(c)?!0:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7",F=c=>$(c)?!0:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u9A8C\u8BC1\u7801",e=()=>{if(d.value>0)return;d.value=V;const c=()=>{b.value=`${d.value}s`,d.value-=1};c();const f=setInterval(()=>{d.value===0?(b.value="\u83B7\u53D6\u9A8C\u8BC1\u7801",d.value=0,clearInterval(f)):c()},1e3)},B=async()=>{d.value>0||u==null||u.value.validate("mobile").then(async()=>{const c=await re(n.mobile),{code:f,data:r}=c;f==="10000"&&(s.value=!0,k({message:"\u77ED\u4FE1\u53D1\u9001\u6210\u529F\uFF0C\u8BF7\u67E5\u6536"}),e())})},_=async()=>{const c=await le(n.mobile,n.smsCode),{data:f}=c;f&&t("on-verify",n)},T=async()=>{u==null||u.value.validate().then(async()=>{_()})};return K(()=>n,()=>{H(n.mobile)&&$(n.smsCode)&&s.value&&_()},{deep:!0,immediate:!0}),(c,f)=>{const r=h("van-field"),i=h("van-cell-group"),p=h("VanForm");return I(),D(p,{ref_key:"formRef",ref:u,"label-width":"60"},{default:E(()=>[y(i,null,{default:E(()=>[y(r,{modelValue:a(n).mobile,"onUpdate:modelValue":f[0]||(f[0]=m=>a(n).mobile=m),name:"mobile",label:"\u624B\u673A\u53F7",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",maxlength:a(S).MOBILE,rules:[{validator:C}]},null,8,["modelValue","maxlength","rules"]),y(r,{modelValue:a(n).smsCode,"onUpdate:modelValue":f[1]||(f[1]=m=>a(n).smsCode=m),name:"smsCode",label:"\u9A8C\u8BC1\u7801",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",maxlength:a(S).SMS_CODE,rules:[{validator:F}]},{button:E(()=>[v("div",{class:Q(["sms-code",{"count-down":d.value>0}]),onClick:B},X(b.value),3)]),_:1},8,["modelValue","maxlength","rules"])]),_:1}),v("div",{class:"submit",onClick:T})]),_:1},512)}}}),be=P({props:{userInfo:{type:Object,default:()=>{}}},emits:["on-submit"],setup(l,{emit:t}){const o=l,u=g({}),s=M({name:o.userInfo.name,certNo:o.userInfo.certNo}),V=n=>me(s.certNo)?!0:"\u8BF7\u586B\u5199\u6B63\u786E\u7684\u8BC1\u4EF6\u53F7",d=n=>ie(n)?!0:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u59D3\u540D",b=()=>{u==null||u.value.validate().then(async n=>{t("on-submit",s)})};return(n,C)=>{const F=h("van-field"),e=h("van-cell-group"),B=h("VanForm");return I(),D(B,{ref_key:"formRef",ref:u,"label-width":"60"},{default:E(()=>[y(e,null,{default:E(()=>[y(F,{modelValue:a(s).name,"onUpdate:modelValue":C[0]||(C[0]=_=>a(s).name=_),name:"name",label:"\u59D3\u540D",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D",maxlength:a(S).NAME,rules:[{validator:d}]},null,8,["modelValue","maxlength","rules"]),y(F,{modelValue:a(s).certNo,"onUpdate:modelValue":C[1]||(C[1]=_=>a(s).certNo=_),name:"certNo",label:"\u8EAB\u4EFD\u8BC1",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u8EAB\u4EFD\u8BC1\u53F7",maxlength:a(S).ID_CARD,rules:[{validator:V}]},null,8,["modelValue","maxlength","rules"])]),_:1}),v("div",{class:"submit",onClick:b})]),_:1},512)}}});var Ce="/static/assets/title-step1.97cb9efa.png",ge="/static/assets/title-step2.258af5e9.png";const Fe={class:"page-activity-invite"},Be=["src"],Ie={class:"container"},ye={class:"main-form"},De={class:"title"},Ee=["src"],Ve={class:"agree"},Ne=ue(" \u6211\u5DF2\u9605\u8BFB\u5E76\u540C\u610F "),qe=P({setup(l){const t=Z(),o=ee(),{productCode:u="7X9",tenantId:s="",phoneNo:V,saleChannelId:d,agentCode:b,paymentMethod:n,from:C}=t.query,F=g(!0),e=M({title:Ce,attachmentList:[{attachmentName:"",attachmentUrl:""}],userInfo:{mobile:V,certNo:"",name:""},agree:!1}),B=g(),_=g(),T=async r=>{var A,N;if(C==="check"){if(!e.agree){k("\u8BF7\u52FE\u9009\u534F\u8BAE");return}o.push({path:"/chuangxin/baigebao/productDetail",query:w(O({},t.query),{tenantId:s,phoneNo:e.userInfo.mobile,productCode:"BWYL2021"})});return}e.userInfo.mobile=r.mobile;const i=await de({holderPhone:e.userInfo.mobile,productCode:u,tenantId:s}),{code:p,data:m}=i;p==="10000"&&(e.userInfo.name=(A=m.tenantOrderHolder)==null?void 0:A.name,e.userInfo.certNo=(N=m.tenantOrderHolder)==null?void 0:N.certNo),e.title=ge,F.value=!1},x=async r=>{if(!e.agree){k("\u8BF7\u52FE\u9009\u534F\u8BAE");return}try{k({message:"\u9886\u53D6\u4E2D...",forbidClick:!0,loadingType:"spinner"}),e.userInfo.certNo=r.certNo,e.userInfo.name=r.name;const i=ce({tenantId:s,detail:B.value,insureDetail:_.value,saleChannelId:d,saleUserId:b,holder:e.userInfo,insured:w(O({},e.userInfo),{relationToHolder:se.SELF}),paymentMethod:n,renewalDK:"",successJumpUrl:"",premium:0,orderStatus:"",orderTopStatus:"",tenantOrderRiskList:[]}),p=await fe(i),{code:m}=p;m==="10000"&&o.push({path:"/chuangxin/baigebao/productDetail",query:w(O({},t.query),{tenantId:s,phoneNo:e.userInfo.mobile,certNo:e.userInfo.certNo,name:e.userInfo.name,productCode:"BWYL2021",agentCode:b})})}catch(i){console.log(i),k.clear()}},c=()=>{let r=[];return _.value.productRiskVoList.forEach(i=>{i.riskDetailVOList.forEach(p=>{r=r.concat(p.riskAttachmentVOList)})}),r},f=async()=>{const r=ve({productCode:u,withInsureInfo:!0,tenantId:s}),i=pe({productCode:u});Promise.all([r,i]).then(([p,m])=>{p.code==="10000"&&(B.value=p.data),m.code==="10000"&&(_.value=m.data,e.attachmentList=c())})};return te(()=>{f()}),(r,i)=>{const p=h("van-checkbox"),m=h("ProPDFviewer"),A=h("van-config-provider");return I(),D(A,{"theme-vars":a(_e)},{default:E(()=>{var N,U;return[v("div",Fe,[v("img",{src:(U=(N=B.value)==null?void 0:N.tenantProductInsureVO)==null?void 0:U.banner[0],class:"banner"},null,8,Be),v("div",Ie,[v("div",ye,[v("div",De,[v("img",{src:a(e).title},null,8,Ee)]),F.value?(I(),D(he,{key:0,"user-info":a(e).userInfo,onOnVerify:T},null,8,["user-info"])):(I(),D(be,{key:1,"user-info":a(e).userInfo,onOnSubmit:x},null,8,["user-info"])),v("div",Ve,[y(p,{modelValue:a(e).agree,"onUpdate:modelValue":i[0]||(i[0]=L=>a(e).agree=L),name:"agree",shape:"square"},null,8,["modelValue"]),v("div",null,[Ne,(I(!0),ae(ne,null,oe(a(e).attachmentList||[],(L,j)=>(I(),D(m,{key:j,class:"file-name",title:`\u300A${L.attachmentName}\u300B`,content:L.attachmentUrl,type:"pdf"},null,8,["title","content"]))),128))])])])])])]}),_:1},8,["theme-vars"])}}});export{qe as default};
