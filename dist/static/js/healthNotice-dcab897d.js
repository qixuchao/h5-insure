import{d as e,i as t,h as a,j as o,k as n,aG as i,l as s,o as r,c as u,u as l,p as c,bL as d,w as p,a as v,v as f,f as m,b as y,c5 as h,dG as q,ah as g,T as b,ar as I,an as T,aQ as N,aN as j,c6 as w,dF as C,c4 as x}from"./index-a9c82976.js";import{l as O}from"./product-88889410.js";import{O as k,Q as L}from"./questionnaire-42dcb602.js";import{g as $}from"./utils-494e2f33.js";import{n as _}from"./nextStep-00f867a9.js";import{u as E}from"./useOrder-60fd5442.js";import{g as R}from"./trial-150a84c8.js";import{N as P,Q as A}from"./notice-33e6eedd.js";import{P as S}from"./constants-29516b3a.js";import{u as U}from"./useThread-637a02aa.js";import"./infoCollection-197bd326.js";import"./trial-63ecd902.js";import"./core-de55cff9.js";const V={class:"long-health-notice-wrap"},B={class:"footer-button"},D=e({__name:"healthNotice",setup(e){const D=t(),Q=a(),G=E(),{orderNo:J,tenantId:M,preview:z,agentCode:F,questionnaireId:H}=D.query,W=o({}),X=o(),Y=o(),K=o(),Z=o([]),ee=o({orderNo:J,tenantId:M,noticeType:Y}),te=o(),ae=o(),oe=o(!1),ne=o(),ie=o(!1),se=()=>{X.value?Q.push({path:`${S.questionNotice}/${X.value}`,query:{...D.query,questionnaireId:X.value}}):z?Q.push({path:S.infoPreview,query:D.query}):(G.value.extInfo.buttonCode=q.short.saveNoticeNextPage,G.value.extInfo.pageCode="healthNotice",_(G.value,((e,t,a)=>{t===N.JUMP_PAGE?Q.push({path:S.holderInfoPreview,query:D.query}):t===N.JUMP_ALERT&&"faceAuth"===e.alertType&&j.confirm({message:a,confirmButtonText:"去分享",cancelButtonText:"被保人确认"}).then((()=>{const e={...D.query,isShare:1,orderNo:J,agentCode:F,objectType:"insured",origin:"share"};te.value={title:"标题",desc:"描述",imageUrl:C,url:`${window.location.origin}${window.location.pathname}?${x.stringify(e)}`,link:`${window.location.origin}${window.location.pathname}?${x.stringify(e)}`},ae.value.handleShare(te.value),oe.value=!0,ne.value.run()})).catch((()=>{Q.push({path:S.faceVerify,query:{...D.query,objectType:"insured",origin:"confirm"}})}))})))},re=()=>{Y.value===P.INSURED?(G.value.extInfo.buttonCode=q.short.saveNotice,G.value.extInfo.pageCode="healthNotice",_(G.value,((e,t,a)=>{t===N.JUMP_ALERT&&""===e.alertType?j.alert({message:a,confirmButtonText:"确定"}):t===N.CONTINUE&&se()}))):se()},ue=o([]),le=n((()=>!(!ue.value.length||Y.value!==k.HOLDER)&&!!ue.value.find((e=>`${e.id}`===H)))),ce=()=>{const e=Z.value.find((e=>e.id===K.value));Object.assign(W.value,null==e?void 0:e.questionnaireDetailResponseVO)},de=async()=>{var e,t;const{code:a,data:o}=await R({orderNo:J,tenantId:M});if("10000"===a){ie.value=(null==(t=null==(e=o.insuredList)?void 0:e[0])?void 0:t.faceAuthFlag)===g.YES,ie.value&&(ne.value.isStart&&b("被保人认证完成"),ne.value.stop()),Object.assign(G.value,o,{extInfo:{...o.extInfo,pageCode:"healthNotice",buttonCode:q.short.saveNotice}});const a=o.insuredList[0].productList.map((e=>e.productCode));ee.value.objectId=o.insuredList[0].id,(async e=>{var t;const{code:a,data:o}=await w({orderNo:J,tenantId:M});"10000"===a&&(Z.value=o.productQuestionnaireVOList);const{code:n,data:i}=await O(e);if("10000"===n){const{productQuestionnaireVOList:e}=i||{},a=e.filter((e=>e.businessType===A.NEW_CONTRACT&&-1!==e.noticeObject));(null==a?void 0:a.length)||b("未匹配到健康告知问卷"),ue.value=a;let o=a[0]||{};if((null==a?void 0:a.length)>1)if(H){const e=a.findIndex((e=>`${e.id}`===H));a[e]&&(o=a[e]),a[e+1]&&(X.value=a[e+1].id)}else X.value=null==(t=a[1])?void 0:t.id;const{questionnaireDetailResponseVO:n,questionnaireId:s,questionnaireName:r,noticeObject:u}=o||{},{questions:l,basicInfo:c}=n||{},{questionnaireType:d}=c||{};if(Y.value=u,K.value=s,d===L.TEXT){const{content:e,textType:t}=(null==l?void 0:l[0])||{};W.value={content:e,contentType:$(`${t}`,e),questionnaireId:s,questionnaireName:r}}else{const e=(Z.value||[]).find((e=>e.questionnaireId===K.value&&e.noticeObject===Y.value));W.value={...n,questionnaireId:s,contentType:"question",...null==e?void 0:e.questionnaireDetailResponseVO}}}})({productCodeList:a})}};ne.value=U({start:()=>{de(),ie.value=!1},stop:()=>{ie.value=!0},time:1e4}),i((()=>{!z&&de()}));const pe=o();return s((()=>{setTimeout((async()=>{pe.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,t)=>{const a=I,o=T;return r(),u("div",V,[l(W)?(r(),c(h,{key:0,type:l(W).contentType,content:l(W),params:l(ee),"success-callback":re},d({_:2},["question"===l(W).contentType&&l(W).questionnaireId?{name:"footer",fn:p((()=>[v("div",B,[l(le)?(r(),c(a,{key:0,round:"",type:"primary",plain:"",onClick:ce},{default:p((()=>[f("同被保人")])),_:1})):m("",!0),y(a,{round:"",type:"primary",block:"","native-type":"submit"},{default:p((()=>[f(" 下一步 ")])),_:1})])])),key:"0"}:{name:"footer-btn",fn:p((()=>[v("div",{class:"footer-btn"},[y(a,{round:"",type:"primary",block:"",onClick:re},{default:p((()=>[f(" 下一步 ")])),_:1})])])),key:"1"}]),1032,["type","content","params"])):m("",!0),y(o,{ref_key:"shareRef",ref:ae},null,512)])}}});export{D as default};
