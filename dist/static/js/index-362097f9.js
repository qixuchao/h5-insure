var ve=Object.defineProperty;var J=Object.getOwnPropertySymbols;var ke=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var Z=(u,m,r)=>m in u?ve(u,m,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[m]=r,M=(u,m)=>{for(var r in m||(m={}))ke.call(m,r)&&Z(u,r,m[r]);if(J)for(var r of J(m))fe.call(m,r)&&Z(u,r,m[r]);return u};import{g as oe,a5 as K,C as V,x as O,X as H,r as I,h as P,m as U,F as se,E as re,y as d,n as k,I as C,z as c,j as B,k as f,s as q,B as D,a1 as ue,a2 as ae,af as Ie,Q as Le,o as Re,d as Pe,a6 as he,D as De}from"./vendor-d47732e4.js";import{u as Fe,P as ge}from"./index-67609f68.js";import{b as W,_ as ie,p as ee,o as ye}from"./index-e85125ef.js";import{a as Ve}from"./trial-5b2a1d63.js";import{u as te}from"./useDicData-8edb3038.js";import"./index-233013c9.js";import"./trial-a659e614.js";import"./useStorage-5463ebd0.js";const Ce=u=>W.post("/api/app/insure/proposal/addOrUpdateProposal",u),Be=(u={})=>W.get(`/api/app/insure/proposal/queryProposalDetail/${u.id}`,u),be=(u={})=>W.post("/api/app/insure/product/listInsureProductDetail",u);const X=u=>(ue("data-v-43bb0470"),u=u(),ae(),u),Ee={class:"com-product-list-wrapper"},$e={class:"risk-item-wrapper"},Oe={class:"content"},Ae={class:"risk-premium"},Ne=D(" \u4FDD\u8D39:"),Se={class:"premium"},we={class:"risk-factor"},xe={class:"factor"},Te={class:"factor-value"},Ue=X(()=>d("span",{class:"factor-name"}," \u4FDD\u989D(\u5143) ",-1)),qe={class:"factor"},Ye={class:"factor-value"},je=X(()=>d("span",{class:"factor-name"}," \u4FDD\u969C\u671F\u95F4 ",-1)),Me={class:"factor"},Ke={class:"factor-value"},He=X(()=>d("span",{class:"factor-name"}," \u7F34\u8D39\u671F\u95F4 ",-1)),We={class:"operate-bar"},Xe=D("\u5220\u9664"),ze=D("+ \u9644\u52A0\u9669"),Qe=D("\u4FEE\u6539"),Ge={class:"premium-total"},Je=D(" \u4FDD\u8D39: "),Ze={class:"premium"},et=oe({props:{productRiskList:{default:()=>[]},productInfo:{default:()=>({})},productData:{default:()=>({})},pickProductPremium:{type:Function,default:()=>{}},productNum:{default:0}},emits:["deleteRisk","updateRisk","addRiderRisk"],setup(u,{emit:m}){const r=u,[b,F]=K(),t=V({checkedList:[],disabledList:[],riderRiskList:[],mainRiskData:{},totalPremium:0,currentRiskRecord:{},productRiskList:[]}),A=te("RISK_PAYMENT_PERIOD"),N=te("RISK_INSURANCE_PERIOD"),h=O(()=>{var l,a;return((a=(l=r.productData)==null?void 0:l.productRiskVoList)==null?void 0:a[0].riskDetailVOList.filter(i=>i.collocationType===1))||[]}),S=O(()=>{var i,n;const l=r.productRiskList.map(s=>s.riskId),a=(((n=(i=r.productData)==null?void 0:i.productRiskVoList)==null?void 0:n[0].riskDetailVOList)||[]).filter(s=>l.includes(s.id)&&s.collocationType===1);return h.value.length-a.length}),z=O(()=>l=>{var n,s;const a=((s=(n=r.productData)==null?void 0:n.productRiskVoList)==null?void 0:s[0].riskDetailVOList.find(L=>L.id!==l))||{};let i=!1;return r.productNum||a.collocationType!==1?i=!0:i=!1,i}),p=O(()=>{var a,i;return((i=(a=r.productData)==null?void 0:a.productRiskVoList)==null?void 0:i[0].riskDetailVOList.find(n=>n.riskType===1))||{}}),w=O(()=>p.value.collocationVOList||[]),x=l=>{m("deleteRisk",l,r.productInfo)},T=l=>{m("updateRisk",l,r.productInfo)},Y=l=>{F(!0),t.value.currentRiskRecord=l},j=(l,a)=>{const i=l.map(n=>n.id).filter(n=>!t.value.disabledList.includes(n));m("addRiderRisk",i,r.productInfo)};return H(()=>r.productInfo,l=>{var n;let a=0;const i=s=>{s.forEach(L=>{var g;a+=L.premium,((g=L.riderRiskVOList)==null?void 0:g.length)&&i(L.riderRiskVOList)})};i(l.proposalProductRiskList||[]),(n=r.pickProductPremium)==null||n.call(r,{[`${l.productId}`]:a}),t.value.totalPremium=a},{deep:!0,immediate:!0}),H(()=>r.productRiskList,l=>{const a=[],i=[],n=[];(l||[]).forEach(s=>{s.riskType===1?a.unshift(s):(i.push(s.riskId),n.push(s.riskId),a.push(s))}),t.value.disabledList=i,t.value.checkedList=n,t.value.productRiskList=a},{deep:!0,immediate:!0}),(l,a)=>{const i=I("ProTitle"),n=I("ProCheckButton");return P(),U("div",Ee,[(P(!0),U(se,null,re(t.value.productRiskList,s=>{var L,g;return P(),U("div",{key:s.riskId},[d("div",$e,[k(i,{"risk-type":s.riskType,title:s.riskName},null,8,["risk-type","title"]),d("div",Oe,[d("div",Ae,[Ne,d("span",Se,"\uFFE5"+C((L=s.premium)==null?void 0:L.toLocaleString()),1)]),d("div",we,[d("div",xe,[d("span",Te,C((g=s.amount)==null?void 0:g.toLocaleString()),1),Ue]),d("div",qe,[d("span",Ye,C(c(ee)(c(N),s.coveragePeriod)),1),je]),d("div",Me,[d("span",Ke,C(c(ee)(c(A),s.chargePeriod)),1),He])]),d("div",We,[c(z)(s.riskId)?(P(),B(n,{key:0,round:32,class:"border",onClick:o=>x(s)},{default:f(()=>[Xe]),_:2},1032,["onClick"])):q("",!0),c(S)?(P(),B(n,{key:1,activated:"",round:32,onClick:o=>Y(s)},{default:f(()=>[ze]),_:2},1032,["onClick"])):q("",!0),k(n,{activated:"",round:32,onClick:o=>T(s)},{default:f(()=>[Qe]),_:2},1032,["onClick"])])])])])}),128)),d("div",Ge,[Je,d("span",Ze,"\uFFE5"+C(t.value.totalPremium.toLocaleString()),1)]),c(b)?(P(),B(Ve,{key:0,modelValue:t.value.checkedList,"onUpdate:modelValue":a[0]||(a[0]=s=>t.value.checkedList=s),show:c(b),disabled:t.value.disabledList,"risk-list":c(h),"collocation-list":c(w),onFinished:j,onClose:a[1]||(a[1]=s=>c(F)(!1))},null,8,["modelValue","show","disabled","risk-list","collocation-list"])):q("",!0)])}}});var tt=ie(et,[["__scopeId","data-v-43bb0470"]]);const ot=u=>(ue("data-v-544c1277"),u=u(),ae(),u),st={class:"container"},rt=ot(()=>d("span",null,"\u8BA1\u5212\u4E66\u540D\u79F0",-1)),ut={class:"operate-bar"},at=D("\u6DFB\u52A0\u4E3B\u9669"),it={class:"footer-bar"},dt={class:"trial-result"},lt=D(" \u603B\u4FDD\u8D39 "),nt={class:"result-num"},pt={class:"trial-operate"},ct=D("\u4FDD\u5B58\u5E76\u9884\u89C8"),mt=oe({setup(u){const[m,r]=K(),[b,F]=K(),t=V({proposalHolder:{},proposalInsuredList:[{name:"",gender:"",birthday:"",proposalInsuredProductList:[]}],proposalName:"",totalPremium:0,relationUserType:2}),A=Ie(),N=Le(),h=Fe(),{id:S,type:z="add"}=N.query,p=V({productId:0,productCollection:{},productInfo:{},productPremium:{},riderRisk:{},type:"add",currentRisk:[]}),w=V();V({}),V([]);const x=(o,e,_)=>/^.{1,20}$/.test(e)?"":`${o}\u4E0D\u80FD\u8D85\u8FC720\u4E2A\u5B57\u7B26`,T=(o={})=>{Object.assign(p.value.productPremium,o),t.value.totalPremium=Object.values(p.value.productPremium).reduce((e,_)=>e+_,0)},Y=(o,e)=>{const _=e;De.confirm({message:"\u786E\u8BA4\u5220\u9664\u8BE5\u9669\u79CD\uFF1F"}).then(()=>{o.riskType===1?(t.value.proposalInsuredList[0].proposalInsuredProductList=t.value.proposalInsuredList[0].proposalInsuredProductList.filter(y=>y.productId!==_.productId),T({[_.productId]:0})):_.proposalProductRiskList=_.proposalProductRiskList.filter(y=>y.riskId!==o.riskId)})},j=(o,e)=>{p.value.productId=e.productId,p.value.productInfo=e,p.value.type="edit",p.value.currentRisk=[o.riskId],F(!0)},l=(o,e)=>{p.value.productId=e.productId,p.value.productInfo=e,p.value.type="addRiderRisk",p.value.currentRisk=o,F(!0)},a=()=>{Be({id:S}).then(({code:o,data:e})=>{o==="10000"&&Object.assign(t.value,e)})},i=()=>{w.value.validate().then(()=>{Ce(t.value).then(({code:o,data:e})=>{o==="10000"&&(h.$reset(),A.push({path:"/compositionProposal",query:{id:e}}))})})},n=o=>{t.value.proposalInsuredList[0].proposalInsuredProductList=t.value.proposalInsuredList[0].proposalInsuredProductList.map(e=>{let _=e;return e.productId===o.proposalInsuredList[0].proposalInsuredProductList[0].productId&&(_=M({},o.proposalInsuredList[0].proposalInsuredProductList[0])),_}),F(!1)},s=o=>{be(o).then(({code:e,data:_})=>{e==="10000"&&(p.value.productCollection=_)}).finally(()=>{})},L=()=>{h.setProposalInfo(t.value),h.setExcludeProduct(Object.keys(p.value.productCollection)),A.push({path:"/proposalList",query:M({isCreateProposal:"1"},N.query)})},g=()=>{F(!1)};return Re(()=>{const o=h.$state.trialData,e=h.$state.proposalInfo;S?a():!Object.keys(e).length&&o.length?Object.assign(t.value,o[0]):Object.keys(e).length&&o.length&&(e.proposalInsuredList[0].proposalInsuredProductList.push(...o[0].proposalInsuredList[0].proposalInsuredProductList),t.value=e)}),H(()=>{var o;return(o=t.value.proposalInsuredList[0].proposalInsuredProductList)==null?void 0:o.length},()=>{const o=t.value.proposalInsuredList[0].proposalInsuredProductList.map(e=>({productId:e.productId,source:2}));s({voList:o})}),(o,e)=>{const _=I("VanField"),y=I("ProCard"),de=I("ProRadioButton"),le=I("VanForm"),ne=I("ProCheckButton"),pe=I("VanButton"),ce=I("van-datetime-picker"),me=I("van-popup"),_e=I("ProPageWrap");return P(),B(_e,{class:"page-create-wrapper"},{default:f(()=>{var Q;return[d("div",st,[k(le,{ref_key:"formRef",ref:w,"input-align":"right","error-message-align":"right"},{default:f(()=>[k(y,null,{default:f(()=>[k(_,{modelValue:t.value.proposalName,"onUpdate:modelValue":e[0]||(e[0]=v=>t.value.proposalName=v),name:"proposalName",placeholder:"\u8BF7\u8F93\u5165\u8BA1\u5212\u4E66\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u8BA1\u5212\u4E66\u540D\u79F0"},{validator:(...v)=>x("\u8BA1\u5212\u4E66\u540D\u79F0",...v)}]},{label:f(()=>[rt]),_:1},8,["modelValue","rules"])]),_:1}),k(y,{title:"\u88AB\u4FDD\u4EBA\u4FE1\u606F"},{default:f(()=>{var v,E,$,G;return[k(_,{modelValue:t.value.proposalInsuredList[0].name,"onUpdate:modelValue":e[1]||(e[1]=R=>t.value.proposalInsuredList[0].name=R),name:"name",label:"\u59D3\u540D",rules:[{validator:(...R)=>x("\u59D3\u540D",...R)}],placeholder:"\u8BF7\u8F93\u5165\uFF08\u9009\u586B\uFF09"},null,8,["modelValue","rules"]),k(_,{modelValue:t.value.proposalInsuredList[0].birthday,"onUpdate:modelValue":e[2]||(e[2]=R=>t.value.proposalInsuredList[0].birthday=R),name:"birthday",label:"\u51FA\u751F\u65E5\u671F",formate:"YYYY-MM-DD","is-link":"",readonly:"","min-date":(E=(v=t.value.proposalInsuredList[0])==null?void 0:v.dateRange)==null?void 0:E.minAge,"max-date":(G=($=t.value.proposalInsuredList[0])==null?void 0:$.dateRange)==null?void 0:G.maxAge,placeholder:"\u8BF7\u9009\u62E9",rules:[{required:!0,message:"\u8BF7\u9009\u62E9"}],onClick:e[3]||(e[3]=R=>c(r)(!0))},null,8,["modelValue","min-date","max-date"]),k(_,{modelValue:t.value.proposalInsuredList[0].gender,"onUpdate:modelValue":e[5]||(e[5]=R=>t.value.proposalInsuredList[0].gender=R),name:"gender",label:"\u6027\u522B",rules:[{required:!0,message:"\u8BF7\u9009\u62E9"}]},{input:f(()=>[k(de,{modelValue:t.value.proposalInsuredList[0].gender,"onUpdate:modelValue":e[4]||(e[4]=R=>t.value.proposalInsuredList[0].gender=R),options:c(ye)},null,8,["modelValue","options"])]),_:1},8,["modelValue"])]}),_:1})]),_:1},512),(P(!0),U(se,null,re(t.value.proposalInsuredList[0].proposalInsuredProductList||[],v=>(P(),B(y,{key:v.productId},{default:f(()=>{var E,$;return[k(tt,{"product-risk-list":v.proposalProductRiskList,"product-info":v,"product-num":(($=(E=t.value.proposalInsuredList[0])==null?void 0:E.proposalInsuredProductList)==null?void 0:$.length)-1,"product-data":p.value.productCollection[v.productId],"pick-product-premium":T,onAddRiderRisk:l,onUpdateRisk:j,onDeleteRisk:Y},null,8,["product-risk-list","product-info","product-num","product-data"])]}),_:2},1024))),128)),d("div",ut,[k(ne,{activated:"",round:34,onClick:L},{default:f(()=>[at]),_:1})])]),d("div",it,[d("span",dt,[lt,d("span",nt,"\uFFE5"+C(t.value.totalPremium.toLocaleString()),1)]),d("div",pt,[k(pe,{type:"primary",onClick:i},{default:f(()=>[ct]),_:1})])]),k(me,{show:c(m),"onUpdate:show":e[8]||(e[8]=v=>he(m)?m.value=v:null),position:"bottom"},{default:f(()=>[k(ce,{type:"date",onConfirm:e[6]||(e[6]=v=>{t.value.proposalInsuredList[0].birthday=c(Pe)(v).format("YYYY-MM-DD"),c(r)(!1)}),onCancel:e[7]||(e[7]=v=>c(r)(!1))})]),_:1},8,["show"]),c(b)?(P(),B(ge,{key:0,"is-show":c(b),type:p.value.type,"rider-risk":((Q=p.value.riderRisk)==null?void 0:Q[p.value.productId])||[],"product-data":p.value.productCollection[p.value.productId],"form-info":p.value.productInfo,holder:t.value.proposalHolder,insured:t.value.proposalInsuredList[0],"current-risk":p.value.currentRisk,onClose:g,onFinished:n},null,8,["is-show","type","rider-risk","product-data","form-info","holder","insured","current-risk"])):q("",!0)]}),_:1})}}});var Dt=ie(mt,[["__scopeId","data-v-544c1277"]]);export{Dt as default};
