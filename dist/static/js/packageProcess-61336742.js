var We=Object.defineProperty,je=Object.defineProperties;var ze=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var Je=Object.prototype.hasOwnProperty,Qe=Object.prototype.propertyIsEnumerable;var ue=(C,f,g)=>f in C?We(C,f,{enumerable:!0,configurable:!0,writable:!0,value:g}):C[f]=g,m=(C,f)=>{for(var g in f||(f={}))Je.call(f,g)&&ue(C,g,f[g]);if(se)for(var g of se(f))Qe.call(f,g)&&ue(C,g,f[g]);return C},p=(C,f)=>je(C,ze(f));import{g as Xe,a9 as Ze,O as ea,E,M as le,y as ie,_ as aa,l as ta,h as oa,r as ce,af as ra,j as V,n as de,p as N,m as z,H as na,t as J,z as S,A as y,J as Q,C as we,k as me,F as sa,D as ua,T as pe,X as la}from"./vendor-505c98f2.js";import{_ as ia,C as fe,$ as ca,G as da,a1 as he}from"./index-19eae3bb.js";import{a as b}from"./order-c0ced472.js";import{S as O,R as ve,f as De,I as ma}from"./infoCollection-192ba138.js";import{p as ye,i as pa,s as fa,g as ha,a as va,u as Da,b as ya}from"./trial-9ce1c80c.js";import{p as ga}from"./product-aa727095.js";import{g as ge,o as Fe,t as Fa,a as Ea}from"./utils-c1bd3df6.js";import{t as Ia}from"./theme-ea709837.js";import{d as Ee,B as _a,D as Ca,G as Na,S as wa,H as Aa,P as ba,U as Ta,_ as Pa,W as Oa,c as Y,f as Ie,o as _e,a as $,n as Ce,h as Ne}from"./auth-b41be44a.js";import{_ as ka}from"./index-c6042eae.js";import"./utils-b6782348.js";import"./trial-e1718f24.js";import"./index-99ca4ff4.js";import"./bankCard-0e4ce564.js";import"./phoneVerify-4fca9884.js";const Ba={key:0},Sa={class:"page-internet-product-detail"},Ua={class:"info"},La={class:"footer-button"},Ha={class:"price"},Ma=we(" \u603B\u4FDD\u8D39"),xa=Xe({setup(C){const f=Ze(),g=ea(),{productCode:U="BWYL2021",tenantId:I,orderNo:k,phoneNo:L,agentCode:q="",saleChannelId:Ae,paymentMethod:F,certNo:X,name:Z,pageCode:H,from:be}=g.query,K=E(),h=E(),M=E(),T=E(),B=H==="payBack",ee=E(!1),x=E(!1),P=E(!1),ae=E(0),G=E(!1),W=E(!1),R=E({show:!1,html:""});let j="";const o=le({holder:{certNo:X,certType:fe.CERT,mobile:L,name:Z,socialFlag:O.HAS},insured:{certNo:X,certType:fe.CERT,name:Z,socialFlag:O.HAS,relationToHolder:ve.SELF},paymentMethod:F,renewalDK:"Y",paymentFrequency:De.YEAR,packageProductList:[],mobileSmsCode:""}),w=E(Ee),_=E(Ee),u=le({showInsure:!B,canInsure:!1,canUpgrade:!1}),Te=ie(()=>{var a,t;return((t=(a=h.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(e=>e.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),Pe=ie(()=>{var a,t;return((t=(a=h.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(e=>e.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),Oe=()=>{const{holder:{certNo:a,mobile:t,name:e,socialFlag:s},insured:{certNo:r,name:n,socialFlag:l,relationToHolder:c},paymentMethod:v}=o;return!!(da(r)&&!!l)},te=()=>{f.push({path:"/internet/guaranteeUpgrade",query:p(m({},g.query),{tenantId:I,productCode:"BWYL2022",orderNo:k,agentCode:q})})},ke=()=>{W.value=!1},Be=()=>{_.value=w.value},Se=()=>{_.value=p(m({},_.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},Ue=async a=>{pe.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const t=await Da(a),{code:e}=t;if(e==="10000"){pe.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const s=await ya({orderNo:a.orderNo,tenantId:I}),{data:r}=s;s.code==="10000"&&(r.type===2?(R.value={show:!0,html:r.paymentUrl},console.log("data.paymentUrl",R.value),la(()=>{console.log("document.forms",document.forms);const n=document.getElementById("cashierSubmit");n==null||n.addEventListener("submit",l=>{l.preventDefault()}),n==null||n.submit()})):window.location.href=r.paymentUrl)}u.canInsure=!0}catch{u.canInsure=!0}},Le=a=>`${he}/internet/orderDetail?orderNo=${a}&productCode=${U}&tenantId=${I}`,He=a=>`${he}/internet/payFail?tenantId=${I}&orderNo=${a}&agentCode=${q}&pageCode=payBack&from=${be||"normal"}`,Me=async a=>{console.log("risk",a);const t=Ea({tenantId:I,saleUserId:q,saleChannelId:Ae,detail:h.value,insureDetail:M.value,paymentMethod:o.paymentMethod,renewalDK:o.renewalDK,iseeBizNo:j,successJumpUrl:"",premium:T.value,holder:o.holder,insured:o.insured,tenantOrderRiskList:a,orderStatus:"",orderTopStatus:""});try{const e=await fa(t),{code:s,data:r}=e;s==="10000"&&Ue(p(m({},t),{orderNo:r.data,extInfo:{extraInfo:{renewalDK:o.renewalDK,paymentMethod:o.paymentMethod,successJumpUrl:Le(r.data),failUrl:He(r.data)},iseeBizNo:j}}))}catch{u.canInsure=!0}},xe=async()=>{console.log("trialData",o);const{calcData:a,riskVOList:t}=ge({holder:o.holder,insured:o.insured,tenantId:I,productDetail:h.value,insureDetail:M.value,paymentFrequency:o.paymentFrequency,packageRiskIdList:Fe(o.packageProductList)}),e=await ye(a),{code:s,data:r}=e;return s==="10000"?(T.value=r.premium,{condition:t,data:r}):{}},Re=a=>{ae.value=a,P.value=!0},Ve=()=>new Promise((a,t)=>{var e,s;(s=(e=K.value)==null?void 0:e.validateForm)==null||s.call(e).then(async()=>{var d;if(!(((d=K.value)==null?void 0:d.isAgreeFile)||ee.value)){P.value=!0,Re(0);return}const{calcData:n,riskVOList:l}=ge({holder:o.holder,insured:o.insured,tenantId:I,productDetail:h.value,insureDetail:M.value,paymentFrequency:o.paymentFrequency,packageRiskIdList:Fe(o.packageProductList)}),c=await ye(n),{code:v,data:D}=c;v==="10000"?(T.value=D.premium,a({condition:l,data:D})):t(new Error)}).catch(()=>{u.canInsure=!0})}),oe=async()=>{var a;if(B){te();return}u.canInsure=!1;try{const{condition:t,data:e}=await Ve(),s={},r=(l=[])=>{(l||[]).forEach(c=>{var v;s[c.riskCode]=c,((v=c.riskPremiumDetailVOList)==null?void 0:v.length)&&r(c.riskPremiumDetailVOList)})};r(e.riskPremiumDetailVOList);const n=Fa({tenantId:I,riskList:t,riskPremium:s,productId:(a=h.value)==null?void 0:a.id});Me(n)}catch{u.canInsure=!0}},Ye=a=>{a==="allFalse"?(x.value=!1,oe(),u.canInsure=!0):ua.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"})},$e=()=>{ee.value=!0,P.value=!1,x.value=!0};aa([()=>o.insured.certNo,()=>o.insured.socialFlag,()=>o.packageProductList],ta.exports.debounce(()=>{o.insured.certNo&&o.insured.socialFlag&&Oe()&&xe()},500),{deep:!0,immediate:!0});const re=async()=>{var s,r,n,l,c,v,D,d;const a=await ha({orderNo:k,tenantId:I}),{code:t,data:e}=a;if(t==="10000"){const{tenantOrderHolder:i,tenantOrderInsuredList:A,extInfo:ne}=e;if(!B){Object.assign(o,{holder:{certNo:i.certNo,certType:i.certType,mobile:i.mobile,name:i.name,socialFlag:O.HAS},insured:{certNo:i.certNo,certType:i.certType,name:i.name,socialFlag:O.HAS,relationToHolder:ve.SELF},paymentMethod:F,renewalDK:"Y"}),u.canInsure=!0,_.value=Ce,w.value=Ce;return}Object.assign(o,{holder:{certNo:i.certNo,certType:i.certType,mobile:i.mobile,name:i.name,socialFlag:O.HAS},insured:{certNo:A==null?void 0:A[0].certNo,certType:(s=A[0])==null?void 0:s.certType,name:(r=A[0])==null?void 0:r.name,socialFlag:(l=(n=A[0])==null?void 0:n.extInfo)==null?void 0:l.hasSocialInsurance,relationToHolder:(c=A[0])==null?void 0:c.relationToHolder},paymentMethod:ne.extraInfo.paymentMethod,renewalDK:ne.extraInfo.renewalDK||"N"}),T.value=(d=(D=(v=A[0])==null?void 0:v.tenantOrderProductList)==null?void 0:D[0])==null?void 0:d.premium,(e.orderStatus===b.ACCEPT_POLICY||e.orderStatus===b.PAYMENT_SUCCESS)&&(u.canUpgrade=!0,G.value=!1,W.value=!0),e.orderStatus===b.PAYING&&(G.value=!0,setTimeout(()=>{re()},3*1e3))}},qe=async()=>{var s,r,n,l,c,v;console.log("\u77ED\u4FE1\u8FDB\u5165\uFF0C\u5E26\u4E86orderNo, mobile");const a=await va({holderPhone:L,orderStatus:[b.PAYING.toUpperCase(),b.TIMEOUT.toUpperCase(),"ACCEPT_POLICY"],productCode:U,tenantId:I}),{code:t,data:e}=a;if(e.orderStatus===b.ACCEPT_POLICY&&(console.log("\u5DF2\u627F\u4FDD\uFF0C\u88AB\u4FDD\u4EBA\u4FE1\u606F\u4E0D\u80FD\u4FEE\u6539"),_.value=p(m({},Ne),{paymentDisable:!!F}),w.value=p(m({},Ne),{paymentDisable:!!F})),(e.orderStatus===b.PAYING||e.orderStatus===b.TIMEOUT)&&(console.log("\u652F\u4ED8\u4E2D\uFF0C\u8D85\u65F6\u53EF\u4EE5\u4FEE\u6539\u6295\u4FDD\u4EBA\u4FE1\u606F"),_.value=p(m({},$),{paymentDisable:!!F}),w.value=p(m({},$),{paymentDisable:!!F})),t==="10000"&&((s=e==null?void 0:e.tenantOrderHolder)==null?void 0:s.certNo)){u.canInsure=!0;const{tenantOrderHolder:D,tenantOrderInsuredList:d,extInfo:i}=e;Object.assign(o,{holder:{certNo:D.certNo,certType:D.certType,mobile:D.mobile,name:D.name,socialFlag:O.HAS},insured:{certNo:d==null?void 0:d[0].certNo,certType:(r=d[0])==null?void 0:r.certType,name:(n=d[0])==null?void 0:n.name,socialFlag:(c=(l=d[0])==null?void 0:l.extInfo)==null?void 0:c.hasSocialInsurance,relationToHolder:(v=d[0])==null?void 0:v.relationToHolder},paymentMethod:F||i.extraInfo.paymentMethod,renewalDK:i.extraInfo.renewalDK})}else _.value=p(m({},Y),{paymentDisable:!!F}),w.value=p(m({},Y),{paymentDisable:!!F}),u.canInsure=!0},Ke=async()=>{const a=ga({productCode:U,withInsureInfo:!0,tenantId:I}),t=pa({productCode:U});await Promise.all([a,t]).then(([e,s])=>{var r,n;e.code==="10000"&&(h.value=e.data,document.title=((r=e.data)==null?void 0:r.productFullName)||""),s.code==="10000"&&(o.packageProductList=(((n=s.data)==null?void 0:n.packageProductVOList)||[]).map(l=>p(m({},l),{value:ma.UN_INSURE,disabled:!1})),M.value=s.data)}),k?re():L&&H==="productDetail"&&qe()},Ge=()=>{H==="free"?B?(_.value=p(m({},Ie),{paymentDisable:!!F}),w.value=p(m({},Ie),{paymentDisable:!!F}),u.canInsure=!0):(_.value=p(m({},Y),{paymentDisable:!!F}),w.value=p(m({},Y),{paymentDisable:!!F}),u.canInsure=!0):B?(_.value=_e,w.value=_e,console.log("\u652F\u4ED8\u5B8C\u6210\u8FDB\u5165")):L||k||(console.log("\u6295\u4FDD\u94FE\u63A5"),_.value=$,w.value=$,u.canInsure=!0)};return oa(()=>{Ge(),Ke(),setTimeout(async()=>{j=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(a,t)=>{const e=ce("van-button"),s=ce("van-config-provider"),r=ra("dompurify-html");return V(),de(sa,null,[N(s,{"theme-vars":y(Ia)},{default:z(()=>{var n,l,c,v,D,d,i;return[R.value.show?na((V(),de("div",Ba,null,512)),[[r,R.value.html]]):J("",!0),S("div",Sa,[S("div",Ua,[N(_a,{url:(l=(n=h.value)==null?void 0:n.tenantProductInsureVO)==null?void 0:l.banner[0]},null,8,["url"]),N(Ca,{"product-name":(c=h.value)==null?void 0:c.productFullName,"product-desc":(D=(v=h.value)==null?void 0:v.showConfigVO)==null?void 0:D.desc},null,8,["product-name","product-desc"])]),N(Na,{"show-service-config":"","guarantee-list":(i=(d=h.value)==null?void 0:d.tenantProductInsureVO)==null?void 0:i.titleAndDescVOS},null,8,["guarantee-list"]),N(wa,{detail:h.value},{form:z(()=>[N(Aa,{ref_key:"formRef",ref:K,"is-show-package":"",disable:!y(u).showInsure,"form-auth":_.value,"form-info":y(o),premium:T.value,"product-detail":h.value,onOnReset:Be,onOnUpdate:Se},null,8,["disable","form-auth","form-info","premium","product-detail"])]),_:1},8,["detail"]),S("div",La,[S("div",Ha,[Ma,S("span",null," \uFFE5"+Q(y(ca)(T.value))+" "+Q(y(o).paymentFrequency==y(De).YEAR?"\u5143":"\u5143/\u6708"),1)]),N(e,{type:"primary",class:"right",disabled:!(y(u).canInsure||y(u).canUpgrade),onClick:oe},{default:z(()=>[we(Q(y(u).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),y(H)!=="payBack"?(V(),me(ba,{key:1,"product-detail":h.value},null,8,["product-detail"])):J("",!0),N(Ta,{"order-no":y(k),"tenant-id":y(I),"is-show":W.value,onOnConfirm:te,onOnClose:ke},null,8,["order-no","tenant-id","is-show"])]}),_:1},8,["theme-vars"]),N(Pa,{show:x.value,"onUpdate:show":t[0]||(t[0]=n=>x.value=n),"content-list":y(Te),"active-index":0,onOnConfirmHealth:Ye},null,8,["show","content-list"]),P.value?(V(),me(ka,{key:0,show:P.value,"onUpdate:show":t[1]||(t[1]=n=>P.value=n),"content-list":y(Pe),"active-index":ae.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9","force-read-cound":2,onSubmit:$e},null,8,["show","content-list","active-index"])):J("",!0),N(Oa,{"is-show":G.value},null,8,["is-show"])],64)}}});var tt=ia(xa,[["__scopeId","data-v-76ff54bc"]]);export{tt as default};
