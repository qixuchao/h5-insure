import{_ as e,d as a,u as t,a as o,r as s,a0 as n,z as i,y as l,b as r,c as d,e as c,w as u,f as p,P as v,h as y,F as f,i as g,g as m,B as C,j as h,t as T,X as b,n as j,ai as k,p as D,a7 as I,a8 as q,T as x,C as N,N as _,D as L}from"./index-3898adba.js";import{l as A,g as E}from"./inform-c1b153a4.js";import{s as P}from"./useStorage-e5ca6bac.js";import{s as S}from"./verify-75eed699.js";import{d as B,A as M,e as Y}from"./notice-a5228c22.js";import"./pdfh5-008ca364.js";const w={class:"date"},G={class:"inform-file"},R={class:"tips"},U={class:"footer-button"};var V=e(a({__name:"index",setup(e){const a=t(),V=o(),{productCode:z="MMBBSF",agentCode:F="65434444",tenantId:O="9991000007",agencyCode:$="3311222",insurerCode:W="zhongan",productCategory:X=1,templateId:H=1,orderNo:J="2022080217103534947"}=V.query,K=s(null),Q=s(!1),Z=n().format("YYYY-MM-DD"),ee=s(""),ae=s(),te=()=>{var e;null==(e=K.value)||e.clear()},oe=i({noticeType:"",materialSource:"",noticeList:[],pageData:{}});l((()=>{D({orderNo:J,saleUserId:F,tenantId:O}).then((({code:e,data:a})=>{"10000"===e&&(Object.assign(oe.pageData,a),a.tenantOrderAttachmentList.forEach((e=>{e.category===I.ELECTRIC_SIGN&&e.objectType===q.AGENT&&K.value.setDataURL(e.fileBase64)})))})),A({insurerCode:W,orderNo:J,productCategory:X,tenantId:O,noticeType:M,objectType:Y}).then((({code:e,data:a})=>{"10000"===e&&(oe.noticeList=[...oe.noticeList,...a])}))}));const se=()=>{var e,t;if(!(oe.noticeList&&oe.noticeList.every((e=>1===e.isDone))))return void x("请完成所有告知进行下一步");if(null==(e=K.value)?void 0:e.isEmpty())return void x("请完成代理人签字进行下一步");if(!Q.value)return void x("请勾选同意签名");const o=null==(t=K.value)?void 0:t.save();S("AGENT",o,oe.pageData.id,O).then((e=>{e&&N({...oe.pageData,extInfo:{...oe.pageData.extInfo,templateId:H,pageCode:"salesNotice",buttonCode:_.salesNotice},venderCode:W}).then((({code:e,data:t})=>{"10000"===e&&"jumpToPage"===t.pageAction.pageAction&&a.push({path:L[t.pageAction.data.nextPageCode],query:{...V.query}})}))}))};return(e,t)=>{const o=r("van-cell"),s=r("ProSign"),n=r("van-checkbox"),i=r("van-button"),l=r("ProPageWrap");return d(),c(l,{class:"page-salesman-inform"},{default:u((()=>[p(v,{title:"营销员告知书"},{default:u((()=>[(d(!0),y(f,null,g(m(oe).noticeList,(e=>(d(),c(o,{key:e.id,class:C({"is-active":2===e.isDone}),title:`《${e.title}》`,"is-link":"",value:""+(1===e.isDone?"已完成":"去完成"),onClick:t=>{return o=e,P.set("questionData",o),void a.push({path:"/healthNotice",query:{questionnaireType:o.questionnaireType,...V.query}});var o}},null,8,["class","title","value","onClick"])))),128))])),_:1}),p(v,{title:"营销员签字","show-divider":!1,"show-line":!1},{extra:u((()=>[h("div",{class:"resign",onClick:te},"重签")])),default:u((()=>[p(s,{ref_key:"agentSignRef",ref:K,selector:"sign2"},null,512),h("div",w,"签名日期： "+T(m(Z)),1)])),_:1}),h("div",G,[p(n,{modelValue:m(Q),"onUpdate:modelValue":t[0]||(t[0]=e=>b(Q)?Q.value=e:null),shape:"square"},null,8,["modelValue"]),h("p",R,[j(" 您的签名将被用于"),(d(!0),y(f,null,g(m(oe).noticeList,((e,a)=>(d(),c(k,{key:a,class:"file",title:`《${e.title}》`,content:m(ae),type:m(ee),onClick:a=>(e=>{const{id:a,objectType:t}=e,o={1:"pdf",2:"richText",3:"link"};E({insurerCode:W,id:a,objectType:t,productCategory:X,orderNo:J,tenantId:O}).then((({code:e,data:a})=>{"10000"===e&&((null==a?void 0:a[0].questionType)===B?(ee.value="question",ae.value=a):(1===(null==a?void 0:a[0].textType)&&(null==a?void 0:a[0].content.includes("png"))?ee.value="picture":ee.value=o[null==a?void 0:a[0].textType],ae.value=null==a?void 0:a[0].content))}))})(e)},null,8,["title","content","type","onClick"])))),128)),j("文件 ")])]),h("div",U,[p(i,{type:"primary",block:"",onClick:se},{default:u((()=>[j("下一步")])),_:1})])])),_:1})}}}),[["__scopeId","data-v-1d1c7e90"]]);export{V as default};
