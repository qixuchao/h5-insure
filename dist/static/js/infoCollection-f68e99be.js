import{d as e,aV as a,aW as t,i as o,j as l,r as n,k as i,bc as s,l as r,ca as u,o as d,c,b as p,u as v,p as f,ak as m,w as I,f as h,q as y,v as g,bj as L,bb as C,T as k,ba as R,bi as O,bk as b,a_ as w,cb as j,bO as P,a$ as _,aX as x,aY as V}from"./index-a5faea38.js";import{P as D,a as E}from"./PolicyInfo-8fa7dfdf.js";import{g as F,m as q}from"./trial-816f3d7c.js";import{_ as N}from"./TrialButton-38f679fc.js";import{n as T}from"./nextStep-4b10fde1.js";import{u as U}from"./useAttachment-a36051ee.js";import"./infoCollection-605e8153.js";import{R as S}from"./trial-f71ec4e3.js";import{u as A}from"./useOrder-0e619710.js";import{t as B}from"./utils-bb34c7db.js";import M from"./index-ad67b890.js";import{p as $,a as H}from"./utils-28defc9e.js";import{f as J,a as G}from"./findLastIndex-a8e841fd.js";import{c as z}from"./cloneDeep-4e5b548c.js";import"./index-432d6078.js";import"./format-31cde443.js";import"./core-121e4cda.js";import"./utils-f6c3d7cc.js";import"./createProposal-94500060.js";import"./InsureInfos-9448b600.js";import"./index-f7cedf46.js";import"./index-9166ccbf.js";import"./questionnaire-42dcb602.js";import"./util-7a8615d9.js";import"./product-7bbf9c44.js";import"./constants-6ad2f07c.js";const K={class:"long-info-collection"},Y=e({name:"InfoCollection"}),W=e({...Y,setup(e){const Y=a((()=>t((()=>import("./index-8b43f876.js")),["static/js/index-8b43f876.js","static/css/index-fa4edf2a.css","static/js/index-a5faea38.js","static/css/index-59abbbb4.css","static/js/theme-94cf7d00.js","static/js/index-432d6078.js","static/css/index-bbfdd7ec.css","static/js/utils-f6c3d7cc.js","static/js/infoCollection-605e8153.js","static/js/trial-f71ec4e3.js"]))),W=a((()=>t((()=>import("./index-a4274b44.js")),["static/js/index-a4274b44.js","static/css/index-4822eb94.css","static/js/index-a5faea38.js","static/css/index-59abbbb4.css"]))),X=a((()=>t((()=>import("./SelectRiskList-d03edf3a.js")),["static/js/SelectRiskList-d03edf3a.js","static/css/SelectRiskList-e1e05c2e.css","static/js/index-a5faea38.js","static/css/index-59abbbb4.css","static/js/trial-816f3d7c.js","static/js/trial-f71ec4e3.js"]))),Q=o(),Z=A({}),ee=l(!0),{productCode:ae="",tenantId:te,agentCode:oe="",agencyCode:le,saleChannelId:ne,isShare:ie,orderNo:se,extraInfo:re,insurerCode:ue,preview:de}=Q.query;let ce={},pe=null;const ve=l(2);try{ce=JSON.parse(decodeURIComponent(re))}catch(da){}const fe={moduleType:7,subModuleType:null,code:"renewFlag",title:"保证续保型的一年期产品在保证续保期间是否申请续保",planCode:null,displayName:null,defaultValue:null,isHidden:null,isReadOnly:null,isMustInput:1,isExtend:null,regex:null,displayType:6,datasource:null,factorScript:null,isCalculationFactor:2,attributeValueList:[{code:"1",value:"是",defaultFlag:null,useFlag:null},{code:"2",value:"否",defaultFlag:null,useFlag:null}],position:null,remark:""},me=n({isView:!1,personalInfo:{},payInfo:{schema:[],config:[],formData:[]},policyInfo:{schema:[],config:[],formData:{}},defaultValue:null,isAutoChange:!1,defaultPlanCode:"",userData:{},solvency:""}),Ie=`${window.origin}/baseInsurance/long/phoneVerify${window.location.search}`,he=l({imgUrl:"",desc:"",title:"",link:Ie}),ye=l(),ge=l();l();const Le=l(),Ce=l({}),ke=l({}),Re=l([]),Oe=l(),be=l({}),we=l(!1),je=l(!1),Pe=l(0),_e=l(!0),{fileList:xe,mustReadFileCount:Ve,popupFileList:De}=U(be,Oe);l(!1);const Ee=l(!1),Fe=l(!1),qe=()=>{je.value=!1,_e.value=!0,Re.value.length<1||(we.value=!0)},Ne=()=>{we.value=!1,je.value=!1,_e.value=!0};l({}),l(!1),l([{}]);const Te=l(""),Ue=l({}),Se=l(!1);l();const Ae=l();l();const Be=l([]),Me=l(0);l({});const $e=l(),He=()=>{Te.value="试算中...",Ue.value=null,Se.value=!0},Je=(e,a)=>{Te.value="",Me.value=e.premium,Ue.value=e,$e.value=a,Se.value=!1},Ge=l(!1),ze=l(),Ke=l({}),Ye=l({productList:[]}),We=l({}),Xe=l(),Qe=(e,a)=>{var t;const o=[],l=a;return e.forEach((e=>{var a;const{insureProductRiskVOList:t}=(null==(a=e.productPlanInsureVOList)?void 0:a[0])||{};t.reduce(((e,a)=>{const{riskFixedRuleVO:{guaranteedRenewalFlag:t},riskCode:o}=(null==a?void 0:a.riskDetailResVO)||{};return t===V.YES&&e.push(o),e}),o)})),Object.assign(Z.value.extInfo,{renewRisk:o.join(",")}),(null==o?void 0:o.length)?(null==(t=l[7])?void 0:t.length)?l[7].push(fe):l[7]=[fe]:l[7]=(l[7]||[]).filter((e=>e.code!==fe.code)),l},Ze=i((()=>{const e=Xe.value[5]||[];return Boolean(e.find((e=>"solvency"===e.code)))})),ea=()=>{q(Ye.value).then((({code:e,data:a})=>{if("10000"===e){const{productDetailResList:e,productFactor:t}=a;Ye.value=H(e),Xe.value=Qe(e,t);const{other:o}=P(Xe.value);me.policyInfo=o;const l={};e.forEach((e=>{l[e.productCode]=e})),We.value=l}}))},aa=()=>{Ge.value=!1},ta=e=>{const a=Ye.value.productList.find((e=>e.productCode===ze.value)),t=e.map((e=>({riskCode:e,riskType:S.RIDER_RISK,mainRiskCode:Ke.value.riskCode}))),o=J(a.mergeRiskReqList,(e=>e.riskCode===Ke.value.riskCode)),l=G(a.mergeRiskReqList,(e=>e.mainRiskCode===Ke.value.riskCode));let n=o;-1!==l&&(n=l),a.mergeRiskReqList=[...a.mergeRiskReqList.slice(0,n+1),...t,...a.mergeRiskReqList.slice(n+1,a.mergeRiskReqList.length)],Le.value.getRiderRiskDefaultValue(ze.value,e,Ke.value.riskCode,a.mergeRiskReqList),ea(),Ge.value=!1},oa=(e,a,t)=>{Ge.value=!0,Be.value=t,Ke.value=a,ze.value=e},la=(e,a,t)=>{We.value[e],t?(We.value[e].productPlanInsureVOList[0].insureProductRiskVOList=We.value[e].productPlanInsureVOList[0].insureProductRiskVOList.filter((e=>e.riskCode!==a)),Ye.value.productList=Ye.value.productList.map((t=>(t.productCode===e&&(t.mergeRiskReqList=t.mergeRiskReqList.filter((e=>e.riskCode!==a))),t)))):(Ye.value.productList=Ye.value.productList.filter((a=>a.productCode!==e)),ea())},na=l(!1),ia=async()=>{var e,a,t;if(de)return void L(C.INFO_COLLECTION,Q.query);if(!Ue.value)return;const o=[];Le.value&&o.push(null==(e=Le.value)?void 0:e.validate(!1)),ye.value&&o.push(null==(a=ye.value)?void 0:a.validate(!1)),ge.value&&o.push(null==(t=ge.value)?void 0:t.validate(!1)),Promise.all(o).then((e=>{if(Ze.value&&!Ee.value)return void k("请阅读并勾选特别约定");Object.assign(Z.value,{extInfo:{...Z.value.extInfo,buttonCode:R.INFO_COLLECTION,pageCode:C.INFO_COLLECTION,specNoticeFlag:1}});const a=Le.value.dealMixData(),t=B({...a,productCode:ae,productName:ke.value.productName},Ue.value,Z.value);Q.query.productClass=`${ve.value}`,delete Q.query.canBack;const o=(()=>{var e,a;const{holder:t,insuredList:o}=me.userData,l=[],n=(e,a)=>{e.ocrData&&Object.keys(e.ocrData).find((a=>(e[a]||e.ocrData[a])&&e.ocrData[a]!==e[a]))&&l.push(`${a}信息影像识别与录入信息不一致，请确认`)};return n(t,"投保人"),n(null==o?void 0:o[0],"被保险人"),((null==(e=null==o?void 0:o[0])?void 0:e.beneficiaryList)||[]).forEach(((e,a)=>{n(e,`受益人${a+1}`)})),n(null==o?void 0:o[0].guardian,"监护人"),n(null==o?void 0:o[0].guardian,"监护人"),((null==(a=Z.value)?void 0:a.tenantOrderPayInfoList)||[]).forEach((e=>{n(null==o?void 0:o[0].guardian,"银行卡")})),l})();na.value=!0,(null==o?void 0:o.length)?O.confirm({message:null==o?void 0:o[0]}).then((()=>{clearInterval(pe),k.loading({duration:0,message:"自核中..."}),T(t,((e,a)=>{na.value=!1,k.clear(),a===b.JUMP_PAGE&&w(e.nextPageCode,Q.query)}),Q,!1)})):(clearInterval(pe),k.loading({duration:0,message:"自核中..."}),T(t,((e,a)=>{na.value=!1,k.clear(),a===b.JUMP_PAGE&&w(e.nextPageCode,Q.query)}),Q,!1))}),(e=>{j(".long-info-collection",".van-field--error")})).catch((e=>{console.log("e",e)}))},sa=e=>{const a=Z.value.tenantOrderPayInfoList[0];Z.value.tenantOrderPayInfoList.splice(0,1,{...a,...e})},ra=e=>{Object.assign(me.userData,e)},ua=l();return s((()=>{(async()=>{k.loading("加载中..."),se&&await F({orderNo:se,tenantId:te}).then((({code:e,data:a})=>{var t;if("10000"===e){if((null==(t=a.insuredList)?void 0:t.length)>0){const{planCode:e}=a.insuredList[0];me.defaultPlanCode=e}Object.assign(Z.value,a,{tenantOrderPayInfoList:a.tenantOrderPayInfoList||[],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0,withPayInfo:!0},productCode:ae}),ua.value=z(Z.value),me.defaultValue=Z.value,Ye.value=$(a.insuredList[0].productList),ve.value=a.insuredList[0].productList.length>1?1:2,Fe.value=!0}})),await q(Ye.value).then((({data:e,code:a})=>{if("10000"===a){const{productDetailResList:a,productFactor:t,solvency:o}=e;Xe.value=Qe(a,t);const l={};a.forEach((e=>{l[e.productCode]=e})),We.value=l;const{payInfo:n,other:i}=P(Xe.value);me.payInfo={...me.payInfo,...n},me.solvency=o,me.policyInfo={...me.policyInfo,...i},setTimeout((()=>{ee.value=!1}),500)}}))})()})),r((()=>{pe=setInterval((()=>{}),1e4),setTimeout((async()=>{Ae.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),u((()=>{clearInterval(pe)})),(e,a)=>{var t,o,l,n,i,s;const r=_,u=x;return d(),c("div",K,[p(r),v(Fe)||v(de)?(d(),f(M,{key:0,ref_key:"personalInfoRef",ref:Le,"product-info":{productCode:v(ae),productName:v(ke).productName,insurerCode:v(ue),tenantId:v(te),planList:[]},"tenant-product-detail":v(Ce),"hide-benefit":"","product-collection":v(We),"default-data":v(Z),"product-factor":v(Xe),"page-loading":v(ee),onTrialStart:He,onTrialEnd:Je,"onUpdate:userData":ra,onUpdateBank:sa,onAddRisk:oa,onDeleteRisk:la},m({_:2},[v(ee)?void 0:{name:"middleInfo",fn:I((()=>[v(me).payInfo.schema.length?(d(),f(v(D),{key:0,ref_key:"payInfoRef",ref:ye,modelValue:v(Z).tenantOrderPayInfoList,"onUpdate:modelValue":a[0]||(a[0]=e=>v(Z).tenantOrderPayInfoList=e),schema:v(me).payInfo.schema,"is-view":v(me).isView,"user-data":v(me).userData},null,8,["modelValue","schema","is-view","user-data"])):h("",!0),v(me).policyInfo.schema.length?(d(),f(v(E),{key:1,ref_key:"policyInfoRef",ref:ge,modelValue:v(Z).extInfo,"onUpdate:modelValue":a[1]||(a[1]=e=>v(Z).extInfo=e),schema:v(me).policyInfo.schema,"is-view":v(me).isView},null,8,["modelValue","schema","is-view"])):h("",!0)])),key:"0"}]),1032,["product-info","tenant-product-detail","product-collection","default-data","product-factor","page-loading"])):h("",!0),p(u,null,{default:I((()=>[!v(ee)&&v(Ze)?(d(),f(v(W),{key:0,modelValue:v(Ee),"onUpdate:modelValue":a[2]||(a[2]=e=>y(Ee)?Ee.value=e:null),class:"special-tips","has-bg-color":!1,"attachment-list":v(xe),"is-show-radio":"","pre-text":`本人已认真阅读下面的特别约定${v(me).solvency}`,onPreviewFile:a[3]||(a[3]=e=>(e=>{Pe.value=e,je.value=!0})(e))},null,8,["modelValue","attachment-list","pre-text"])):h("",!0)])),_:1}),v(je)?(d(),f(v(Y),{key:1,show:v(je),"onUpdate:show":a[4]||(a[4]=e=>y(je)?je.value=e:null),"content-list":v(_e)?v(xe):v(De),"is-only-view":v(_e),"active-index":v(Pe),text:v(_e)?"关闭":"我已逐页阅读并确认告知内容","force-read-count":v(_e)?0:v(Ve),onSubmit:qe,onOnCloseFilePreviewByMask:Ne},null,8,["show","content-list","is-only-view","active-index","text","force-read-count"])):h("",!0),p(N,{"is-share":v(he).isShare&&!v(ie),premium:null==(t=v(Ue))?void 0:t.initialPremium,"share-info":v(he),"loading-text":v(Te),"payment-frequency":(null==(s=null==(i=null==(n=null==(l=null==(o=v($e))?void 0:o.insuredList)?void 0:l[0].productList)?void 0:n[0].riskList)?void 0:i[0])?void 0:s.paymentFrequency)+"","tenant-product-detail":v(Ce),"handle-share":e=>(e=>{Le.value.validateHolder(["mobile"]).then((()=>{Object.assign(Z.value,{extInfo:{...Z.value.extInfo,buttonCode:R.INFO_COLLECTION,pageCode:C.INFO_COLLECTION}});const a=Le.value.getUserData(),t=B({...$e.value,holder:null==a?void 0:a.holder},Ue.value||{},Z.value);T(t,((a,t)=>{t===b.JUMP_PAGE&&(null==e||e())}),Q)})).catch((()=>{k("请录入投保人手机号后进行分享")}))})(e),disabled:!v(Ue)||v(na)||v(ee),onHandleClick:ia},{label:I((()=>[g(" 首年总保费 ")])),default:I((()=>[g("下一步 ")])),_:1},8,["is-share","premium","share-info","loading-text","payment-frequency","tenant-product-detail","handle-share","disabled"]),v(Ge)?(d(),f(v(X),{key:2,type:v(S).RIDER_RISK,"product-class":v(ve),show:v(Ge),"insured-list":v(Be),title:"添加附加险","current-product-code":v(ze),"main-risk-code":v(Ke).riskCode,"select-list":v(Ye).productList,onCancel:aa,onConfirm:ta},null,8,["type","product-class","show","insured-list","current-product-code","main-risk-code","select-list"])):h("",!0)])}}});export{W as default};
