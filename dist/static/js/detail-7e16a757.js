import{ref as e,onMounted as t}from"vue";import{aI as n,u as o,a,aS as r,aF as u,T as l,Y as i}from"./index-d66a20d8.js";/* empty css              */import{g as d,i as c}from"./trial-0ac61dce.js";import{_ as v}from"./index-bb9d1cea.js";import{_ as s,s as f}from"./verify-c7e58246.js";import{n as m}from"./nextStep-3971c3a9.js";import{p}from"./product-d1af8bd8.js";import{P as C}from"./index-88613e6f.js";import I from"./index-4bd92c7d.js";import{u as h}from"./useDicData-b539129e.js";import{I as N}from"./trial-b3f7bf73.js";import"./pdfh5-e588f83d.js";import"./infoCollection-e6a8a0ee.js";import"./PersonalInfo-4143a04f.js";import"./core-15eeb464.js";import"./constant-8927d485.js";import"./theme-65292714.js";import"./utils-57fec98c.js";const y={key:0,class:"net-sale-detail-wrap"},V={class:"sign-cell"},x=vue.createElementVNode("div",{class:"sign-label"},"签名",-1),O={class:"footer"},w={class:"footer"},b=vue.defineComponent({name:"netSaleDetail"}),j=vue.defineComponent({...b,setup(b){n();const j=o(),E=a(),{orderNo:k="2022113021181894998",tenantId:L="9991000001"}=j.query,P=e({}),B=e(!1),T=h("NATIONAL_REGION_CODE"),g=e({commencementTime:"",expiryDate:"",extInfo:{buttonCode:"EVENT_NETSALE_airSignature",pageCode:"infoCollection",templateId:3,iseeBizNo:""},orderCategory:1,tenantId:L,venderCode:"",tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}],tenantOrderProductList:[{}]}],tenantOrderSubjectList:[{extInfo:{subjectRelatedFirm:"",subjectRelatedUserId:""},subjectName:"",subjectObjectType:"HOLDER",subjectType:"GENERAL",subjectNo:"",tenantId:L}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}}),R=e(!1),S=e(),_=e(),H=e(),A=e(""),U=e(""),D=e(!1),F=e(!1),$=e(0),q=e([]),G=e(""),Y=e("");e("");const z=e([]),W=()=>{D.value=!1,F.value=!1},M=async()=>{D.value=!1,F.value=!0,await f("HOLDER",A.value,g.value.id,`${L}`),m(g.value)},Z=async()=>{const{data:e,code:t}=await p({productCode:Y.value,tenantId:L,withInsureInfo:!0});"10000"===t&&(H.value=e,(()=>{var e,t,n,o,a,r;let u={};if(u=U.value?(null==(n=((null==(t=null==(e=H.value)?void 0:e.tenantProductInsureVO)?void 0:t.planList)||[]).find((e=>e.planCode===U.value)))?void 0:n.attachmentVOList)||[]:(null==(r=null==(a=null==(o=H.value)?void 0:o.tenantProductInsureVO)?void 0:a.planInsureVO)?void 0:r.attachmentVOList)||[],!u)return void(q.value=[]);const l={2:"richText",3:"link"};q.value=Object.keys(u).map((e=>(u[e].forEach((e=>{if("1"===e.attachmentType){const t=e.attachmentUri.split("?"),n=t[0].substr(t[0].lastIndexOf(".")+1);e.attachmentType="pdf"===n?"pdf":"picture"}else e.attachmentType=l[e.attachmentType]})),{attachmentName:e,attachmentList:u[e]})))||[],z.value=q.value.map((e=>({attachmentName:e.attachmentName,attachmentList:e.attachmentList.filter((e=>e.mustReadFlag===i.YES))}))).filter((e=>e.attachmentList.length))})())},J=async()=>{var e;const{code:t,data:n}=await d({orderNo:k,tenantId:L});"10000"===t&&(n.extInfo.buttonCode="EVENT_NETSALE_airSignature",g.value=n,U.value=null==(e=n.tenantOrderInsuredList[0])?void 0:e.planCode,Y.value=n.tenantOrderInsuredList[0].tenantOrderProductList[0].productCode,B.value=!0,(e=>{const t=e.find((e=>1===e.riskType));var n,o;t&&(G.value=(n=t.insurancePeriodValue,-1!==(o=N[t.insurancePeriodType]).indexOf("$")?o.replace("$",`${n}`):`${n||""}${o}`))})(n.tenantOrderInsuredList[0].tenantOrderProductList[0].tenantOrderRiskList||[]),(async()=>{const{code:e,data:t}=await c({productCode:Y.value,tenantId:L});"10000"===e&&(_.value=t,P.value=t.productFactor)})(),Z(),n.orderStatus!==u.UNDER_WRITING_SUCCESS&&E.push({path:"/baseInsurance/orderDetail",query:{...j.query,productCode:Y.value,ISEE_BIZ:n.extInfo.iseeBizNo}}))},K=async()=>{A.value?(F.value=!1,z.value.length?D.value=!0:M()):l("请先签字")};return t((()=>{J()})),(e,t)=>{var n;const o=vue.resolveComponent("ProCell"),a=vue.resolveComponent("ProCard"),u=vue.resolveComponent("ProCascader"),l=vue.resolveComponent("van-cell"),i=vue.resolveComponent("ProPageWrap"),d=vue.resolveComponent("ProFilePreview"),c=vue.resolveComponent("ProPopup");return vue.openBlock(),vue.createElementBlock(vue.Fragment,null,[vue.createVNode(i,null,{default:vue.withCtx((()=>{var e;return[(null==(e=vue.unref(_))?void 0:e.productBasicInfoVO)?(vue.openBlock(),vue.createElementBlock("div",y,[vue.createVNode(a,null,{default:vue.withCtx((()=>{var e;return[vue.createVNode(o,{title:"产品名称",content:null==(e=vue.unref(_))?void 0:e.productBasicInfoVO.productFullName},null,8,["content"])]})),_:1}),vue.unref(g).id?(vue.openBlock(),vue.createBlock(a,{key:0,"show-line":!1,title:"投保信息"},{default:vue.withCtx((()=>{var e,n,a,l;return[vue.createVNode(o,{title:"保费",content:vue.unref(g).orderAmount+"元"},null,8,["content"]),vue.createVNode(o,{title:"保险期限",content:vue.unref(G)},null,8,["content"]),vue.createVNode(o,{title:"起保日期",content:vue.unref(g).commencementTime},null,8,["content"]),vue.createVNode(o,{title:"终保日期",content:vue.unref(g).expiryDate},null,8,["content"]),vue.createVNode(o,{title:"保单状态",content:vue.unref(r)[vue.unref(g).orderStatus]},null,8,["content"]),vue.createVNode(o,{title:"订单编号",content:vue.unref(g).orderNo},null,8,["content"]),vue.createVNode(u,{modelValue:vue.unref(g).tenantOrderHolder.extInfo.familyAreaCode,"onUpdate:modelValue":t[0]||(t[0]=e=>vue.unref(g).tenantOrderHolder.extInfo.familyAreaCode=e),field1:vue.unref(g).tenantOrderHolder.extInfo.familyProvinceCode,"onUpdate:field1":t[1]||(t[1]=e=>vue.unref(g).tenantOrderHolder.extInfo.familyProvinceCode=e),field2:vue.unref(g).tenantOrderHolder.extInfo.familyCityCode,"onUpdate:field2":t[2]||(t[2]=e=>vue.unref(g).tenantOrderHolder.extInfo.familyCityCode=e),field3:vue.unref(g).tenantOrderHolder.extInfo.familyAreaCode,"onUpdate:field3":t[3]||(t[3]=e=>vue.unref(g).tenantOrderHolder.extInfo.familyAreaCode=e),label:"房产所在地",name:"familyProvinceCode","is-link":"","is-view":"",class:"insured-info","data-source":vue.unref(T),mapping:{label:"name",value:"code",children:"children"}},null,8,["modelValue","field1","field2","field3","data-source"]),vue.createVNode(o,{title:"详细地址",content:null==(n=null==(e=vue.unref(g).tenantOrderHolder)?void 0:e.extInfo)?void 0:n.familyAddress},null,8,["content"]),vue.createVNode(o,{title:"燃气编号",content:null==(l=null==(a=vue.unref(g).tenantOrderSubjectList)?void 0:a[0])?void 0:l.subjectNo},null,8,["content"])]})),_:1})):vue.createCommentVNode("",!0),vue.unref(B)?(vue.openBlock(),vue.createBlock(v,{key:1,ref:"formRef","title-collection":{HOLDER:"投保人信息",INSURER:"被保人信息",BENEFICIARY:"受益人"},"is-view":!0,"form-info":vue.unref(g),"factor-object":vue.unref(P),"input-align":"right"},null,8,["form-info","factor-object"])):vue.createCommentVNode("",!0),vue.createVNode(a,{title:"阅读条款合同",class:"file-list-card"},{default:vue.withCtx((()=>[(vue.openBlock(!0),vue.createElementBlock(vue.Fragment,null,vue.renderList(vue.unref(q),((e,t)=>(vue.openBlock(),vue.createBlock(l,{key:t,title:e.attachmentName,"is-link":"",onClick:t=>{return n=e.attachmentName,o=e.attachmentList,R.value=!0,void(S.value={title:n,fileContent:null==o?void 0:o[0]});var n,o}},null,8,["title","onClick"])))),128))])),_:1}),vue.createVNode(a,{title:"客户签名"},{default:vue.withCtx((()=>[vue.createElementVNode("div",V,[x,vue.createVNode(s,{modelValue:vue.unref(A),"onUpdate:modelValue":t[4]||(t[4]=e=>vue.isRef(A)?A.value=e:null)},null,8,["modelValue"])])])),_:1}),vue.createElementVNode("div",O,[vue.createVNode(C,{shadow:!1,text:"提 交",onClick:K})])])):vue.createCommentVNode("",!0)]})),_:1}),vue.createVNode(c,{show:vue.unref(R),"onUpdate:show":t[6]||(t[6]=e=>vue.isRef(R)?R.value=e:null),class:"pre-notice-wrap",title:null==(n=vue.unref(S))?void 0:n.title,position:"bottom",style:{height:"600px"}},{default:vue.withCtx((()=>{var e,n,o,a;return[vue.createVNode(d,{content:null==(n=null==(e=vue.unref(S))?void 0:e.fileContent)?void 0:n.attachmentUri,type:null==(a=null==(o=vue.unref(S))?void 0:o.fileContent)?void 0:a.attachmentType},null,8,["content","type"]),vue.createElementVNode("div",w,[vue.createVNode(C,{shadow:!1,text:"关闭",onClick:t[5]||(t[5]=e=>R.value=!1)})])]})),_:1},8,["show","title"]),vue.unref(D)&&0!==vue.unref(z).length?(vue.openBlock(),vue.createBlock(I,{key:0,show:vue.unref(D),"onUpdate:show":t[7]||(t[7]=e=>vue.isRef(D)?D.value=e:null),"content-list":vue.unref(z),"is-only-view":vue.unref(F),"active-index":vue.unref($),text:vue.unref(F)?"关闭":"我已逐页阅读上述内容并同意","force-read-count":0,"on-close-file-preview":"",onSubmit:M,onOnCloseFilePreview:W,onOnCloseFilePreviewByMask:t[8]||(t[8]=e=>D.value=!1)},null,8,["show","content-list","is-only-view","active-index","text"])):vue.createCommentVNode("",!0)],64)}}});export{j as default};
