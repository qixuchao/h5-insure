import{h as e,r as t,x as a,k as l,l as n,y as o,z as r,A as i,s as u,Q as s,n as d,C as c,I as v,F as p,N as f,a8 as m,j as I,Z as y,m as b,E as h,T as C}from"./vendor-ec956704.js";import{u as w}from"./theme-bc16780d.js";import{g as j,a as g,i as x}from"./trial-25568b18.js";import{_,n as E}from"./nextStep-030e4a84.js";import{s as O}from"./verify-38c64999.js";import{p as L}from"./product-818cb71a.js";import{a as k}from"./order-07d40ae3.js";import{u as N,s as P}from"./core-ca8989c2.js";import{P as T}from"./index-3ea15649.js";import"./index-44e4fb78.js";import"./infoCollection-0c847252.js";import"./relativeTime-2d3aa0ec.js";import"./useDicData-865a8122.js";import"./index-1f943c9d.js";const R={class:"sign-wrap"},V=["src"],S={class:"popup-body"},A={class:"sign-container-wrap"},U={class:"operate-bar"},B=c(" 请投保人正楷签署您的签名:"),H={class:"btns"},D=c("返回"),F=c("重写"),z=c("确定签字"),G=e({props:{option:{default:{}},modelValue:{default:""}},emits:["update:modelValue"],setup(e,{emit:f}){const m=t(!1),I=t(),y=a((()=>{let e="";return I.value&&(e=I.value.save()),e})),b=()=>{m.value=!0},h=()=>{m.value=!1},C=()=>{var e,t;null==(t=null==(e=I.value)?void 0:e.clear)||t.call(e)},w=()=>{f("update:modelValue",y.value),m.value=!1};return(e,t)=>{const a=l("van-button"),f=l("ProSign"),j=l("van-icon"),g=l("van-popup");return n(),o(p,null,[r("div",R,[i(y)?(n(),o("img",{key:0,class:"previewSign",src:i(y),alt:""},null,8,V)):u("",!0),s(a,{type:"primary",round:"",size:"small",onClick:b},{default:d((()=>[c(v(i(y)?"重新签名":"点击签字"),1)])),_:1})]),s(g,{show:m.value,"onUpdate:show":t[0]||(t[0]=e=>m.value=e),position:"bottom",style:{height:"100%"}},{default:d((()=>[r("div",S,[r("div",A,[s(f,{ref_key:"signRef",ref:I,placeholder:"请在此处签名"},null,512),r("div",U,[r("span",null,[s(j,{name:"info",color:"#ffaf22"}),B]),r("div",H,[s(a,{type:"default",class:"btn",onClick:h},{default:d((()=>[D])),_:1}),s(a,{type:"default",class:"btn",onClick:C},{default:d((()=>[F])),_:1}),s(a,{type:"primary",class:"btn",disabled:!i(y),onClick:w},{default:d((()=>[z])),_:1},8,["disabled"])])])])])])),_:1},8,["show"])],64)}}});const Y={class:"net-sale-detail-wrap"},q={class:"sign-cell"},J=r("div",{class:"sign-label"},"签名",-1),Q={class:"footer-button"},W=c("提 交"),X={class:"footer"},Z=e({setup(e){const a=w(),c=f();m();const{orderNo:v="2022113021181894998",tenantId:R="9991000001",productCode:V="HTEJBX"}=c.query;t();const S=t({}),A=t({commencementTime:"",expiryDate:"",extInfo:{buttonCode:"EVENT_NETSALE_airSignature",pageCode:"infoCollection",templateId:3,iseeBizNo:""},orderCategory:1,tenantId:R,venderCode:"",tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},insuredBeneficiaryType:"1",tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}],tenantOrderProductList:[{}]}],tenantOrderSubjectList:[{extInfo:{subjectRelatedFirm:"",subjectRelatedUserId:""},subjectName:"",subjectObjectType:"HOLDER",subjectType:"GENERAL",tenantId:R}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}}),U=t(!1),B=t({}),H=t(),D=t(),F=t(""),z=t(""),Z=t({}),$=async()=>{F.value?(await O("HOLDER",F.value,A.value.id,`${R}`),E(A.value)):C("请先签字")};return N(),I((()=>{(async()=>{const{code:e,data:t}=await x({productCode:V,tenantId:R});"10000"===e&&(H.value=t,S.value=t.productFactor)})(),(async()=>{const{data:e,code:t}=await L({productCode:V,tenantId:R,withInsureInfo:!0});"10000"===t&&(D.value=e)})(),(async()=>{var e;const{code:t,data:a}=await j({orderNo:v,tenantId:R});if("10000"===t&&(a.extInfo.buttonCode="EVENT_NETSALE_airSignature",A.value=a,z.value=null==(e=a.tenantOrderInsuredList[0])?void 0:e.planCode,a.orderStatus===k.PAYING)){A.value.extInfo.redirectUrl="";const{code:e,data:t}=await g(A.value);"10000"===e&&P(t.paymentUrl)}})()})),y([()=>z.value,()=>D.value],(()=>{var e,t,a;z.value&&(Z.value=(null==(a=((null==(t=null==(e=D.value)?void 0:e.tenantProductInsureVO)?void 0:t.planList)||[]).find((e=>e.planCode===z.value)))?void 0:a.attachmentVOList)||[])}),{deep:!0,immediate:!0}),(e,t)=>{const c=l("ProCell"),v=l("ProCard"),f=l("van-cell"),m=l("VanButton"),I=l("ProPageWrap"),y=l("ProFilePreview"),C=l("ProPopup"),w=l("van-config-provider");return n(),b(w,{"theme-vars":i(a)},{default:d((()=>{var e;return[s(I,null,{default:d((()=>[r("div",Y,[s(v,null,{default:d((()=>{var e;return[s(c,{title:"产品名称",content:null==(e=H.value)?void 0:e.productBasicInfoVO.productFullName},null,8,["content"])]})),_:1}),A.value.id?(n(),b(v,{key:0,"show-line":!1,title:"投保信息"},{default:d((()=>{var e,t,a,l,n;return[s(c,{title:"保费",content:A.value.orderAmount},null,8,["content"]),s(c,{title:"保险期限",content:null==(e=A.value.tenantOrderInsuredList[0])?void 0:e.planName},null,8,["content"]),s(c,{title:"起保日期",content:A.value.commencementTime},null,8,["content"]),s(c,{title:"终保日期",content:A.value.expiryDate},null,8,["content"]),s(c,{title:"保单状态",content:A.value.orderStatus},null,8,["content"]),s(c,{title:"订单编号",content:A.value.orderNo},null,8,["content"]),s(c,{title:"房屋地址",content:null==(a=null==(t=A.value.tenantOrderHolder)?void 0:t.extInfo)?void 0:a.familyAddress},null,8,["content"]),s(c,{title:"燃气编号",content:null==(n=null==(l=A.value.tenantOrderInsuredList)?void 0:l[0])?void 0:n.extInfo.subjectRelatedUserId},null,8,["content"])]})),_:1})):u("",!0),s(v,null,{default:d((()=>[s(_,{ref:"formRef","title-collection":{HOLDER:"投保人信息",INSURER:"被保人信息",BENEFICIARY:"受益人"},"is-view":!0,"form-info":A.value,"factor-object":S.value,"input-align":"right"},null,8,["form-info","factor-object"])])),_:1}),s(v,{title:"阅读条款合同"},{default:d((()=>[(n(!0),o(p,null,h(Object.keys(Z.value),((e,t)=>(n(),b(f,{key:t,title:e,"is-link":"",onClick:t=>{return a=e,l=Z.value[e],U.value=!0,void(B.value={title:a,fileContent:null==l?void 0:l[0]});var a,l}},null,8,["title","onClick"])))),128))])),_:1}),s(v,{title:"客户签名"},{default:d((()=>[r("div",q,[J,s(G,{modelValue:F.value,"onUpdate:modelValue":t[0]||(t[0]=e=>F.value=e)},null,8,["modelValue"])])])),_:1}),r("div",Q,[s(m,{type:"primary",class:"shadow-btn",large:"",block:"",round:"",onClick:$},{default:d((()=>[W])),_:1})])])])),_:1}),s(C,{show:U.value,"onUpdate:show":t[2]||(t[2]=e=>U.value=e),class:"pre-notice-wrap",title:null==(e=B.value)?void 0:e.title,position:"bottom",style:{height:"600px"}},{default:d((()=>{var e,a;return[s(y,{content:null==(a=null==(e=B.value)?void 0:e.fileContent)?void 0:a.attachmentUri,type:"richText"},null,8,["content"]),r("div",X,[s(T,{shadow:!1,text:"关闭",onClick:t[1]||(t[1]=e=>U.value=!1)})])]})),_:1},8,["show","title"])]})),_:1},8,["theme-vars"])}}});export{Z as default};
