import{d as e,i as a,h as t,j as o,k as n,aG as i,l as s,c9 as r,o as u,c as l,u as d,p as c,bL as p,w as v,a as f,v as m,f as y,b as h,c7 as b,dH as q,ah as g,T as I,ar as T,an as N,aQ as j,aN as w,c8 as C,dE as x,c5 as O}from"./index-98f74434.js";import{l as k}from"./product-3d9a4aaf.js";import{O as L,Q as $}from"./questionnaire-42dcb602.js";import{g as _}from"./utils-d884df2a.js";import{n as E}from"./nextStep-938ecb0a.js";import{u as R}from"./useOrder-3cd9c5f5.js";import{g as P}from"./trial-cdad952b.js";import{N as V,Q as A}from"./notice-33e6eedd.js";import{P as S}from"./constants-6c7c253a.js";import{u as U}from"./useThread-637a02aa.js";import"./infoCollection-724d18a1.js";import"./trial-2819e647.js";import"./core-ec40d73f.js";const B={class:"long-health-notice-wrap"},D={class:"footer-button"},Q=e({__name:"healthNotice",setup(e){const Q=a(),J=t(),M=R({}),{orderNo:z,tenantId:G,preview:H,agentCode:F,questionnaireId:W}=Q.query,X=o({}),Y=o(),K=o(),Z=o(),ee=o([]),ae=o({orderNo:z,tenantId:G,noticeType:K}),te=o(),oe=o(),ne=o(!1),ie=o(),se=o(!1),re=()=>{Y.value?J.push({path:`${S.questionNotice}/${Y.value}`,query:{...Q.query,questionnaireId:Y.value}}):H?J.push({path:S.infoPreview,query:Q.query}):(M.value.extInfo.buttonCode=q.short.saveNoticeNextPage,M.value.extInfo.pageCode="healthNotice",E(M.value,((e,a,t)=>{a===j.JUMP_PAGE?J.push({path:S.holderInfoPreview,query:Q.query}):a===j.JUMP_ALERT&&"faceAuth"===e.alertType&&w.confirm({message:t,confirmButtonText:"去分享",cancelButtonText:"被保人确认"}).then((()=>{const e={...Q.query,isShare:1,orderNo:z,agentCode:F,objectType:"insured",origin:"share"};te.value={title:"标题",desc:"描述",imageUrl:x,url:`${window.location.origin}${S.faceVerify}?${O.stringify(e)}`,link:`${window.location.origin}${S.faceVerify}?${O.stringify(e)}`},oe.value.handleShare(te.value),ne.value=!0,ie.value.run()})).catch((()=>{J.push({path:S.faceVerify,query:{...Q.query,objectType:"insured",origin:"confirm"}})}))})))},ue=()=>{K.value===V.INSURED?(M.value.extInfo.buttonCode=q.short.saveNotice,M.value.extInfo.pageCode="healthNotice",E(M.value,((e,a,t)=>{a===j.JUMP_ALERT?w.alert({message:t,confirmButtonText:"确定"}):a===j.CONTINUE&&re()}))):re()},le=o([]),de=n((()=>!(!le.value.length||K.value!==L.HOLDER)&&!!le.value.find((e=>`${e.id}`===W)))),ce=()=>{const e=ee.value.find((e=>e.id===Z.value));Object.assign(X.value,null==e?void 0:e.questionnaireDetailResponseVO)},pe=async(e=!0)=>{var a,t;const{code:o,data:n}=await P({orderNo:z,tenantId:G},{loading:e});if("10000"===o){se.value=(null==(t=null==(a=n.insuredList)?void 0:a[0])?void 0:t.faceAuthFlag)===g.YES,se.value&&(ie.value.isStart&&I("被保人认证完成"),ie.value.stop()),Object.assign(M.value,n,{extInfo:{...n.extInfo,pageCode:"healthNotice",buttonCode:q.short.saveNotice}});const e=n.insuredList[0].productList.map((e=>e.productCode));ae.value.objectId=n.insuredList[0].id,(async e=>{var a;const{code:t,data:o}=await C({orderNo:z,tenantId:G});"10000"===t&&(ee.value=o.productQuestionnaireVOList);const{code:n,data:i}=await k(e);if("10000"===n){const{productQuestionnaireVOList:e}=i||{},t=e.filter((e=>e.businessType===A.NEW_CONTRACT&&-1!==e.noticeObject));(null==t?void 0:t.length)||I("未匹配到健康告知问卷"),le.value=t;let o=t[0]||{};if((null==t?void 0:t.length)>1)if(W){const e=t.findIndex((e=>`${e.id}`===W));t[e]&&(o=t[e]),t[e+1]&&(Y.value=t[e+1].id)}else Y.value=null==(a=t[1])?void 0:a.id;const{questionnaireDetailResponseVO:n,questionnaireId:s,questionnaireName:r,noticeObject:u}=o||{},{questions:l,basicInfo:d}=n||{},{questionnaireType:c}=d||{};if(K.value=u,Z.value=s,c===$.TEXT){const{content:e,textType:a}=(null==l?void 0:l[0])||{};X.value={content:e,contentType:_(`${a}`,e),questionnaireId:s,questionnaireName:r}}else{const e=(ee.value||[]).find((e=>e.questionnaireId===Z.value&&e.noticeObject===K.value));X.value={...n,questionnaireId:s,contentType:"question",...null==e?void 0:e.questionnaireDetailResponseVO}}}})({productCodeList:e})}};ie.value=U({start:()=>{pe(!1),se.value=!1},stop:()=>{se.value=!0},time:1e4,number:0}),i((()=>{!H&&pe()}));const ve=o();return s((()=>{setTimeout((async()=>{ve.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),r((()=>{ie.value.stop()})),(e,a)=>{const t=T,o=N;return u(),l("div",B,[d(X)?(u(),c(b,{key:0,type:d(X).contentType,content:d(X),params:d(ae),"is-view":d(ne),"mark-requested":!1,"success-callback":ue},p({_:2},["question"===d(X).contentType&&d(X).questionnaireId?{name:"footer",fn:v((()=>[f("div",D,[d(de)?(u(),c(t,{key:0,round:"",type:"primary",plain:"",onClick:ce},{default:v((()=>[m("同被保人")])),_:1})):y("",!0),h(t,{round:"",type:"primary",block:"","native-type":"submit",disabled:d(ne)&&!d(se)},{default:v((()=>[m(" 下一步 ")])),_:1},8,["disabled"])])])),key:"0"}:{name:"footer-btn",fn:v((()=>[f("div",{class:"footer-btn"},[h(t,{round:"",type:"primary",block:"",disabled:d(ne)&&!d(se),onClick:ue},{default:v((()=>[m(" 下一步 ")])),_:1},8,["disabled"])])])),key:"1"}]),1032,["type","content","params","is-view"])):y("",!0),h(o,{ref_key:"shareRef",ref:oe},null,512)])}}});export{Q as default};
