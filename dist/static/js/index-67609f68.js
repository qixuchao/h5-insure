var Y=Object.defineProperty,z=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var A=(a,c,s)=>c in a?Y(a,c,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[c]=s,m=(a,c)=>{for(var s in c||(c={}))X.call(c,s)&&A(a,s,c[s]);if(N)for(var s of N(c))G.call(c,s)&&A(a,s,c[s]);return a},v=(a,c)=>z(a,H(c));import{a as Q,g as W,C as k,L as Z,a3 as E,x as ee,X as _,o as te,r as P,h as V,m as L,n as f,k as C,y as D,z as d,j as se,s as R,a1 as oe,a2 as re,B as ae}from"./vendor-d47732e4.js";import{P as x,R as ie,i as ne,p as ue}from"./trial-5b2a1d63.js";import{g as ce}from"./index-233013c9.js";import{_ as le}from"./index-e85125ef.js";const Be=Q({id:"createProposal",state:()=>({proposalInfo:{},trialData:[],excludeProduct:[]}),actions:{setProposalInfo(a){this.$state.proposalInfo=a},setTrialData(a){this.$state.trialData=a},setExcludeProduct(a){this.$state.excludeProduct=a}}});const de=a=>(oe("data-v-738af2e4"),a=a(),re(),a),pe={class:"com-product-risk-wrapper"},fe={class:"popup-container"},me=de(()=>D("div",{class:"popup-title"},"\u8BF7\u9009\u62E9\u4FDD\u969C\u65B9\u6848",-1)),ke={class:"risk-trial-wrapper"},he={key:0,class:"part-card"},_e={key:1,class:"part-card"},ge={class:"risk-content"},ve={key:0,class:"risk"},Pe={class:"footer-bar"},Ve=ae("\u786E\u8BA4"),De=W({props:{isShow:{type:Boolean,default:!1},type:{default:"add"},productId:{default:0},riskType:{default:1},formInfo:{default:{}},productData:{default:()=>({})},holder:{default:()=>({})},insured:{default:()=>({})},riderRisk:{default:()=>[]},currentRisk:{default:()=>[]}},emits:["close","finished"],setup(a,{emit:c}){const s=a,O=k({personVO:m({},s.holder)}),B=k({insuredCode:"",personVO:m({},s.insured)}),g=k({}),F=k({}),h=k({}),b=k({}),S=k({}),e=Z({currentPlan:"0",isShow:s.isShow,riskBaseInfo:{},holderFactor:[],insuredFactor:[],riskData:[],riskPlanData:[],trialResult:{},canTrial:!0,retrialTip:!1,enumList:{},ageRange:[],collapseName:["1"],type:s.type});E("premium",S.value),E("source",{type:e.type,origin:"proposal",showRiskList:s.currentRisk});const T=ee(()=>{var o;let t="";if((o=e.riskData)==null?void 0:o[0]){const r=e.riskData[0],i=((r==null?void 0:r.requiredRiderRiskVOList)||[]).map(n=>n.riskName);i.length&&(t=`\u7279\u6B8A\u63D0\u793A: ${r.riskName}\u548C${i.join("\u3001")}\u5FC5\u987B\u540C\u65F6\u6295\u4FDD`)}return t}),j=(t,o)=>{var n,p,u;const r=(t.insuredVOList[0].productPlanVOList[0].riskVOList||[]).map(l=>v(m({},l),{premium:o[l.riskCode].premium,amount:o[l.riskCode].amount}));return{proposalHolder:v(m({},(n=t.holder)==null?void 0:n.personVO),{dateRange:(p=h==null?void 0:h.value)==null?void 0:p.ageRangeObj}),proposalInsuredList:[v(m({},t.insuredVOList[0].personVO),{dateRange:(u=h.value)==null?void 0:u.ageRangeObj,proposalInsuredProductList:[{productId:e.riskBaseInfo.id,productName:e.riskBaseInfo.productName,proposalProductRiskList:r}]})]}},$=()=>{const t=JSON.parse(JSON.stringify(g.value[e.currentPlan])),o=Object.values(t).find(n=>n.riskType===1),r=Object.values(t).map(n=>{const p=n;if(p.chargePeriod==="3"){const u=(o.chargePeriod||"").split("_");u[1]&&(u[1]-=1),p.chargePeriod=u.join("_")}return p.liabilityVOList=(p.liabilityVOList||[]).filter(u=>u.optionalFlag===1||u.liabilityAttributeValue&&u.liabilityAttributeValue!=="-1").map(u=>{const l=u;return l.liabilityAttributeValue==="0"&&(l.liabilityAttributeValue=""),l}),p}),i={holder:O.value,productCode:e.riskBaseInfo.productCode,insuredVOList:[v(m({},B.value),{productPlanVOList:[{planCode:e.currentPlan||"",riskVOList:r}]})]};ue(m({},i)).then(({code:n,data:p})=>{if(n==="10000"){e.retrialTip=!1,e.trialResult=p,e.canTrial=!1;const u={},l=(I=[])=>{(I||[]).forEach(y=>{var w;u[y.riskCode]=y,((w=y.riskPremiumDetailVOList)==null?void 0:w.length)&&l(y.riskPremiumDetailVOList)})};l(p.riskPremiumDetailVOList),Object.assign(S.value,u),c("finished",j(i,u))}else e.retrialTip=!0})},q=()=>{var t,o,r,i,n;Promise.all([(o=(t=F.value)==null?void 0:t.validateForm)==null?void 0:o.call(t),(i=(r=h.value)==null?void 0:r.validateForm)==null?void 0:i.call(r),(n=b.value)==null?void 0:n.validate()]).then(()=>{$()})},M=()=>{c("close")},J=()=>{ce({dictCodeList:["RISK_PAYMENT_PERIOD","RISK_INSURANCE_PERIOD"]}).then(({code:o,data:r})=>{if(o==="10000"){const i={};r.forEach(n=>{i[n.dictCode]=n.dictItemList}),e.enumList=i}})},K=()=>{ne({productId:s.productId,source:2}).then(({code:t,data:o})=>{t==="10000"&&(e.riskBaseInfo=o.productBasicInfoVO,(o.productRiskVoList[0].riskDetailVOList||[]).forEach((r,i)=>{i===0&&(e.currentPlan=r.planCode||"0"),Object.assign(g.value,{[r.planCode||i]:{}})}),e.riskData=o.productRiskVoList[0].riskDetailVOList||[],e.riskPlanData=o.productRelationPlanVOList||[])}).finally(()=>{})},U=t=>{e.holderFactor=t.holderFactorList,e.insuredFactor=t.insuredFactorList,e.ageRange=t.ageRange};return _([()=>g.value,()=>O.value,()=>B.value],t=>{t&&!e.canTrial&&(e.canTrial=!0,e.retrialTip=!0)},{deep:!0}),_(()=>s.isShow,t=>{e.isShow=t},{immediate:!0}),_(()=>s.productId,t=>{t&&K()},{immediate:!0}),_(()=>s.formInfo,(t={})=>{if(!(s.type==="add"||s.type==="repeatAdd")){const o={};t.proposalProductRiskList.forEach(r=>{o[r.riskId]=r}),Object.assign(g.value,{0:o})}},{deep:!0,immediate:!0}),_(()=>s.productData,t=>{var o;s.type==="add"||s.type==="repeatAdd"||(e.riskBaseInfo=t.productBasicInfoVO,e.riskData=((o=t.productRiskVoList)==null?void 0:o[0].riskDetailVOList)||[])},{deep:!0,immediate:!0}),_(()=>s.type,t=>{e.type=t}),te(()=>{J()}),(t,o)=>{const r=P("ProMessage"),i=P("ProTitle"),n=P("VanForm"),p=P("VanButton"),u=P("VanPopup");return V(),L("div",pe,[f(u,{show:d(e).isShow,"onUpdate:show":o[0]||(o[0]=l=>d(e).isShow=l),round:"",position:"bottom",closeable:"",style:{height:"80%"},onClose:M},{default:C(()=>{var l,I;return[D("div",fe,[me,d(T)?(V(),se(r,{key:0,content:d(T)},null,8,["content"])):R("",!0),D("div",ke,[d(e).holderFactor.length?(V(),L("div",he,[f(i,{title:"\u6295\u4FDD\u4EBA"}),f(x,{ref_key:"holderRef",ref:F,"insured-code":(l=d(e).riskBaseInfo)==null?void 0:l.insurerCode,"form-info":O.value.personVO,"factor-list":d(e).holderFactor,"age-range":d(e).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):R("",!0),d(e).insuredFactor.length?(V(),L("div",_e,[f(i,{title:"\u88AB\u4FDD\u4EBA"}),f(x,{ref_key:"insuredRef",ref:h,"insured-code":(I=d(e).riskBaseInfo)==null?void 0:I.insurerCode,"form-info":B.value.personVO,"factor-list":d(e).insuredFactor,"age-range":d(e).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):R("",!0),D("div",ge,[f(i,{title:"\u6295\u4FDD\u65B9\u6848"}),d(e).riskData.length?(V(),L("div",ve,[f(n,{ref_key:"riskFormRef",ref:b,"input-align":"right","error-message-align":"right"},{default:C(()=>[f(ie,{"risk-info":g.value[0],enums:d(e).enumList,"origin-data":d(e).riskData,"pick-factor":U},null,8,["risk-info","enums","origin-data"])]),_:1},512)])):R("",!0)])]),D("div",Pe,[f(p,{block:"",type:"primary",onClick:q},{default:C(()=>[Ve]),_:1})])])]}),_:1},8,["show"])])}}});var Ce=le(De,[["__scopeId","data-v-738af2e4"]]);export{Ce as P,Be as u};
