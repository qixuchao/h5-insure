import{aX as e,d as i,r as a,L as l,a_ as t,bf as n,V as o,aE as s,e as u,b2 as r,ba as d,a9 as c,bg as m,bh as p,bi as f,aY as v,bj as y,bk as b,W as V,bl as g,bm as h,bn as k,bo as L,b0 as O,A as C,Z as S,b as I,c as w,w as F,i as T,f as x,g as D,E as _,h as A,$ as N,G as j,az as B,b5 as P,b6 as U,k as M,ad as J,an as K,ao as $,a7 as E,j as R,D as H,ah as Y,T as z,ay as G,bp as W,bq as q,br as X,bs as Z,aS as Q,aT as ee,Y as ie}from"./index-9e40ea5e.js";import{a as ae,B as le}from"./infoCollection-ba2f9456.js";import{c as te}from"./cloneDeep-96676b66.js";import{d as ne,i as oe}from"./debounce-6981b306.js";import{m as se}from"./merge-c5599fa4.js";import{c as ue,g as re,r as de,P as ce,v as me,a as pe,i as fe,t as ve}from"./PayInfo-24a6e82e.js";import{a as ye,M as be}from"./keysIn-a287568b.js";import{S as Ve}from"./isObjectLike-a9798079.js";import{P as ge}from"./config-98e8d477.js";import{S as he}from"./index-f7fd7bd0.js";import{c as ke}from"./trial-8c7da25f.js";import{L as Le}from"./product-585b0e6f.js";const[Oe,Ce]=e("stepper"),Se=(e,i)=>String(e)===String(i);const Ie=O(i({name:Oe,props:{min:p(1),max:p(1/0),name:p(""),step:p(1),theme:String,integer:Boolean,disabled:Boolean,showPlus:f,showMinus:f,showInput:f,longPress:f,allowEmpty:Boolean,modelValue:v,inputWidth:v,buttonSize:v,placeholder:String,disablePlus:Boolean,disableMinus:Boolean,disableInput:Boolean,beforeChange:Function,defaultValue:p(1),decimalLength:v},emits:["plus","blur","minus","focus","change","overlimit","update:modelValue"],setup(e,{emit:i}){const p=i=>{const{min:a,max:l,allowEmpty:t,decimalLength:n}=e;return t&&""===i||(i=""===(i=y(String(i),!e.integer))?0:+i,i=Number.isNaN(i)?+a:i,i=Math.max(Math.min(+l,i),+a),b(n)&&(i=i.toFixed(+n))),i};let f;const v=a(),O=a((()=>{var a;const l=null!=(a=e.modelValue)?a:e.defaultValue,t=p(l);return Se(t,e.modelValue)||i("update:modelValue",t),t})()),C=l((()=>e.disabled||e.disableMinus||O.value<=+e.min)),S=l((()=>e.disabled||e.disablePlus||O.value>=+e.max)),I=l((()=>({width:t(e.inputWidth),height:t(e.buttonSize)}))),w=l((()=>n(e.buttonSize))),F=i=>{e.beforeChange?k(e.beforeChange,{args:[i],done(){O.value=i}}):O.value=i},T=()=>{if("plus"===f&&S.value||"minus"===f&&C.value)return void i("overlimit",f);const a="minus"===f?-e.step:+e.step,l=p(L(+O.value,a));F(l),i(f)},x=i=>{const a=i.target,{value:l}=a,{decimalLength:t}=e;let n=y(String(l),!e.integer);if(b(t)&&n.includes(".")){const e=n.split(".");n=`${e[0]}.${e[1].slice(0,+t)}`}e.beforeChange?a.value=String(O.value):Se(l,n)||(a.value=n);const o=n===String(+n);F(o?+n:n)},D=a=>{var l;e.disableInput?null==(l=v.value)||l.blur():i("focus",a)},_=e=>{const a=e.target,l=p(a.value);a.value=String(l),O.value=l,V((()=>{i("blur",e),g()}))};let A,N;const j=()=>{N=setTimeout((()=>{T(),j()}),200)},B=i=>{e.longPress&&(clearTimeout(N),A&&h(i))},P=i=>{e.disableInput&&h(i)},U=i=>({onClick:e=>{h(e),f=i,T()},onTouchstartPassive:()=>{f=i,e.longPress&&(A=!1,clearTimeout(N),N=setTimeout((()=>{A=!0,T(),j()}),600))},onTouchend:B,onTouchcancel:B});return o((()=>[e.max,e.min,e.integer,e.decimalLength]),(()=>{const e=p(O.value);Se(e,O.value)||(O.value=e)})),o((()=>e.modelValue),(e=>{Se(e,O.value)||(O.value=p(e))})),o(O,(a=>{i("update:modelValue",a),i("change",a,{name:e.name})})),s((()=>e.modelValue)),()=>u("div",{role:"group",class:Ce([e.theme])},[r(u("button",c({type:"button",style:w.value,class:[Ce("minus",{disabled:C.value}),{[m]:!C.value}],"aria-disabled":C.value||void 0},U("minus")),null),[[d,e.showMinus]]),r(u("input",{ref:v,type:e.integer?"tel":"text",role:"spinbutton",class:Ce("input"),value:O.value,style:I.value,disabled:e.disabled,readonly:e.disableInput,inputmode:e.integer?"numeric":"decimal",placeholder:e.placeholder,"aria-valuemax":e.max,"aria-valuemin":e.min,"aria-valuenow":O.value,onBlur:_,onInput:x,onFocus:D,onMousedown:P},null),[[d,e.showInput]]),r(u("button",c({type:"button",style:w.value,class:[Ce("plus",{disabled:S.value}),{[m]:!S.value}],"aria-disabled":S.value||void 0},U("plus")),null),[[d,e.showPlus]])])}}));const we={key:0},Fe={class:"custom-field"},Te={key:1,class:"flex-field"},xe={class:"pro-radio-wrap"},De={key:2},_e={class:"pro-radio-wrap"},Ae={class:"custom-field"},Ne={key:1},je={key:3},Be={class:"custom-field"},Pe={key:1},Ue={class:"custom-field"},Me={key:0},Je={key:1},Ke={key:4},$e=i({name:"BaoeBaofei"});var Ee=j(i({...$e,props:{originData:{default:()=>({})},modelValue:{default:()=>({})},defalutValue:{default:()=>({})},trialResult:{default:()=>({})}},emits:["update:modelValue","trialChange"],setup(e,{emit:i}){const t=e,n=C({hadSetDefault:!1}),s=a(t.originData),r=a(t.modelValue),d=a(0),c=()=>2===s.value.saleMethod?{label:"保费",key:"initialPremium"}:{label:"保额",key:"initialAmount"},m=()=>{switch(`${s.value.displayUnit}`){case ae.YUAN:return"元";case ae.MONTH_SALARY:return"倍月薪";case ae.MILLION:return"万元";case ae.COPY:return"份"}return""},p=l((()=>2===s.value.saleMethod?{label:"保费",key:"initialPremium"}:{label:"保额",key:"initialAmount"})),f=(...e)=>{if(1===d.value){const e=r.value[p.value.key],i=t.originData.minStepValue,a=t.originData.maxStepValue,l=t.originData.stepValue;if(+e>=+a)r.value[p.value.key]=a;else if(+e<=+i)r.value[p.value.key]=i;else{const a=+e-+i,t=Math.floor(a/+l);a%+l!=0&&(r.value[p.value.key]=+i+t*+l)}}return!0},v=()=>{const{displayType:e,requireCopies:i}=s.value,a=c().key,l=!r.value.riskCode;1===e?d.value=1:3===e&&2===i?(d.value=2,s.value.displayValues.length>=1&&l&&!r.value[a]&&(r.value[a]=s.value.displayValues[0].code||s.value.displayValues[0].value)):3===e&&1===i?(d.value=3,s.value.minCopiesValue===s.value.maxCopiesValue&&l&&!r.value.copy&&(r.value.copy=s.value.minCopiesValue),s.value.displayValues.length>=1&&l&&!r.value[a]&&(r.value[a]=s.value.displayValues[0].code||s.value.displayValues[0].value)):2===e&&(d.value=4,s.value.minCopiesValue===s.value.maxCopiesValue&&l&&!r.value.copy&&(r.value.copy=s.value.minCopiesValue),l&&!r.value.initialAmount&&(r.value.initialAmount=s.value.copiesAmount))},y=l((()=>{if(s.value.displayValues){const e=c().key;return 1!==s.value.displayValues.length||r.value.riskCode||(r.value[e]=s.value.displayValues[0].code),s.value.displayValues.map((e=>({label:e.value,value:e.code})))}return[]})),b=()=>{};return S((()=>{v(),i("update:modelValue",r.value)})),o((()=>s),(e=>{v()}),{deep:!0}),o((()=>t.defalutValue),(e=>{(null==e?void 0:e.riskCode)&&!n.hadSetDefault&&(n.hadSetDefault=!0,r.value={...r.value,initialAmount:e.initialAmount,initialPremium:e.initialPremium,copy:e.copy})}),{deep:!0,immediate:!0}),o((()=>r.value),(e=>{(()=>{if(1===d.value){const e=r.value[p.value.key],i=t.originData.minStepValue,a=t.originData.maxStepValue,l=t.originData.stepValue;if(+e>+a)return!1;if(+e<+i)return!1;if((+e-+i)%+l!=0)return!1}return!0})()&&(i("update:modelValue",e),i("trialChange",e))}),{deep:!0,immediate:!0}),(e,i)=>{const a=Ie,l=B,t=P,n=U;return I(),w(N,null,[1===d.value?(I(),w("div",we,[u(l,{label:`基本${x(p).label}`,name:x(p).key,class:"risk-select-field"},{input:F((()=>[T("div",Fe,[u(a,{modelValue:r.value[x(p).key],"onUpdate:modelValue":i[0]||(i[0]=e=>r.value[x(p).key]=e),"input-width":"80px","default-value":e.originData.minStepValue,min:e.originData.minStepValue,step:e.originData.stepValue,max:e.originData.maxStepValue,onBlur:f},null,8,["modelValue","default-value","min","step","max"])])])),_:1},8,["label","name"])])):2===d.value?(I(),w("div",Te,[u(n,{modelValue:r.value[x(p).key],"onUpdate:modelValue":i[2]||(i[2]=e=>r.value[x(p).key]=e),label:`基本${x(p).label}`,name:x(p).key,class:"risk-select-field"},{input:F((()=>[T("div",xe,[u(t,{modelValue:r.value[x(p).key],"onUpdate:modelValue":i[1]||(i[1]=e=>r.value[x(p).key]=e),options:x(y),onclick:b},null,8,["modelValue","options"])])])),_:1},8,["modelValue","label","name"])])):3===d.value?(I(),w("div",De,[u(n,{modelValue:r.value[x(p).key],"onUpdate:modelValue":i[4]||(i[4]=e=>r.value[x(p).key]=e),label:`基本${x(p).label}`,name:x(p).key,class:"risk-select-field"},{input:F((()=>[T("div",_e,[u(t,{modelValue:r.value[x(p).key],"onUpdate:modelValue":i[3]||(i[3]=e=>r.value[x(p).key]=e),options:x(y),onclick:b},null,8,["modelValue","options"])])])),_:1},8,["modelValue","label","name"]),T("div",null,[u(l,{modelValue:r.value.copy,"onUpdate:modelValue":i[6]||(i[6]=e=>r.value.copy=e),label:"份数",name:"copy",class:"risk-select-field"},{input:F((()=>[T("div",Ae,[e.originData.minCopiesValue!==e.originData.maxCopiesValue?(I(),D(a,{key:0,modelValue:r.value.copy,"onUpdate:modelValue":i[5]||(i[5]=e=>r.value.copy=e),"input-width":"80px","default-value":e.originData.minCopiesValue,min:e.originData.minCopiesValue||1,step:1,max:e.originData.maxCopiesValue},null,8,["modelValue","default-value","min","max"])):(I(),w("span",Ne,_(e.originData.minCopiesValue),1))])])),_:1},8,["modelValue"])])])):4===d.value?(I(),w("div",je,[u(l,{modelValue:r.value.copy,"onUpdate:modelValue":i[8]||(i[8]=e=>r.value.copy=e),label:"份数",name:"copy",class:"risk-select-field"},{input:F((()=>[T("div",Be,[e.originData.minCopiesValue!==e.originData.maxCopiesValue?(I(),D(a,{key:0,modelValue:r.value.copy,"onUpdate:modelValue":i[7]||(i[7]=e=>r.value.copy=e),"input-width":"64px","default-value":e.originData.minCopiesValue,min:e.originData.minCopiesValue||1,step:1,max:e.originData.maxCopiesValue},null,8,["modelValue","default-value","min","max"])):(I(),w("span",Pe,_(e.originData.minCopiesValue),1))])])),_:1},8,["modelValue"]),u(l,{label:x(p).label,name:"copyAmount",class:"risk-select-field"},{input:F((()=>[T("div",Ue,[e.originData.minCopiesValue!==e.originData.maxCopiesValue?(I(),w("span",Me,_(+e.originData.copiesAmount*+r.value.copy+m()),1)):(I(),w("span",Je,_(+e.originData.minCopiesValue*+e.originData.copiesAmount+m()),1))])])),_:1},8,["label"])])):A("",!0),2===s.value.saleMethod&&e.trialResult&&e.trialResult.initialAmount>0?(I(),w("div",Ke,[u(l,{label:"保额",class:"risk-select-field"},{input:F((()=>[T("span",null,_(e.trialResult.initialAmount),1)])),_:1})])):A("",!0)],64)}}}),[["__scopeId","data-v-7997a9f0"]]);const Re=i({name:"BeneficiaryItem"});var He=j(i({...Re,props:{modelValue:{default:()=>({})},schema:{default:()=>[]},config:{default:()=>({})},isView:{type:Boolean,default:!1},isTrial:{type:Boolean,default:!1},title:{default:"受益人"}},emits:["update:modelValue","trailChange"],setup(e,{expose:i,emit:l}){const t=e,n=a(null),s=C({validated:!1,schema:[],config:{},personVO:{}});return o((()=>t.config),(e=>{e&&Object.assign(s.config,e)}),{deep:!0,immediate:!0}),o((()=>t.schema),(e=>{e&&Object.assign(s.schema,te(t.schema))}),{deep:!0,immediate:!0}),o((()=>t.modelValue),((e,i)=>{JSON.stringify(e)!==JSON.stringify(i)&&(ue("受益人数据变动了"),Object.assign(s.personVO,e))}),{deep:!0,immediate:!0}),o((()=>s.personVO),(e=>{e&&l("update:modelValue",e)}),{deep:!0,immediate:!0}),o((()=>{var e;return null==(e=s.personVO)?void 0:e.relationToInsured}),((e,i)=>{if(e===i)return!1;ue("受益人与被保人关系变动了");const{certType:a}=s.personVO||{},[l,n]=re(s.schema,{certType:a,relationToHolder:e});return se(s.config,n),!t.isView&&e&&i&&Object.assign(s.personVO,{...de(s.personVO,(e=>!(l&&"certType"===e))),relationToInsured:e}),!1}),{immediate:!0}),i({validate:e=>pe(n,t.trialFactorCodes,e),validateTrialFields:()=>me({personVO:s.personVO,trialFactorCodes:t.trialFactorCodes})}),(e,i)=>(I(),D(x(ce),{ref_key:"formRef",ref:n,class:"personal-info-card",title:e.title,model:x(s).personVO,schema:x(s).schema,config:x(s).config,"is-view":e.isView,"extra-provision":{objectType:x(J).BENEFICIARY,objectId:x(s).personVO.id}},{cardTitleExtra:F((()=>[M(e.$slots,"default",{},void 0,!0)])),_:3},8,["title","model","schema","config","is-view","extra-provision"]))}}),[["__scopeId","data-v-34580ae7"]]);const Ye=["onClick"],ze=i({name:"InsuredItem"});var Ge=j(i({...ze,props:{modelValue:{default:()=>({})},title:{default:""},holderPersonVO:{},schema:{default:()=>[]},config:{default:()=>({})},isView:{type:Boolean,default:!1},isTrial:{type:Boolean,default:!1},trialFactorCodes:{default:()=>[]},multiBeneficiaryMaxNum:{default:null},beneficiaryList:{default:()=>[]},beneficiarySchema:{default:()=>[]}},emits:["update:modelValue","update:beneficiaryList"],setup(e,{expose:i,emit:t}){const n=e,s=a(null),r=a(null),d=a(null),c={schema:[],trialFactorCodes:[],config:{},personVO:{}},m=C({validated:!1,schema:[],config:{},personVO:{},beneficiaryTypeSchemaList:[],beneficiarySchemaList:[],beneficiaryList:[]}),p=()=>{m.beneficiaryList.push(te({...c,nanoid:$(),schema:n.beneficiarySchema}))},f=l((()=>!n.multiBeneficiaryMaxNum||m.beneficiaryList.length<n.multiBeneficiaryMaxNum)),v=l((()=>!m.schema.filter((e=>{var i;return!(e.hidden||(null==(i=m.config[e.name])?void 0:i.hidden))})).length)),y=l((()=>m.schema.filter((e=>e.isSelfInsuredNeed)).map((e=>e.name)))),b=l((()=>K(n.beneficiarySchema))),V=l((()=>{var e;return String(null==(e=m.personVO)?void 0:e.insuredBeneficiaryType)===le.SPECIFY}));return o((()=>n.holderPersonVO),(e=>{var i;ue("投保人信息变动了");const{id:a,...l}=e||{};if("1"===String(null==(i=m.personVO)?void 0:i.relationToHolder)){const e=K(y.value)?Object.keys(l).reduce(((e,i)=>([...y.value,"occupationClass"].includes(i)&&!["birthday","age","gender"].includes(i)||(e[i]=l[i]),e)),{}):l;Object.assign(m.personVO,e)}}),{deep:!0,immediate:!0}),o((()=>n.beneficiarySchema),(e=>{m.beneficiarySchemaList=K(e)?e.filter((e=>"insuredBeneficiaryType"!==e.name)):[],m.beneficiaryTypeSchemaList=K(e)?e.filter((e=>"insuredBeneficiaryType"===e.name)):[]}),{deep:!0,immediate:!0}),o(V,((e,i)=>{String(e)!==String(i)&&(ue("受益人类型关系变动了"),e?!K(m.beneficiaryList)&&p():m.beneficiaryList=[])}),{immediate:!0}),o((()=>m.beneficiaryList.map((e=>({personVO:e.personVO})))),((e,i)=>{JSON.stringify(e)!==JSON.stringify(i)&&t("update:beneficiaryList",e)}),{deep:!0}),o((()=>{var e;return null==(e=m.personVO)?void 0:e.relationToHolder}),((e,i)=>{if(!e)return;ue("与投保人关系变动了");const{personVO:a,schema:l=[],config:t}=m||{},{id:o,...s}=n.holderPersonVO||{},u="1"===String(a.relationToHolder),[r,d]=re(l,a);if(se(t,d),l.forEach((e=>{e.relationToHolder=a.relationToHolder,e.hidden=!e.isSelfInsuredNeed&&u})),!n.isView&&i&&String(e)!==String(i)){let e={...a,...s};u||(e={...de(a,(e=>!(r&&"certType"===e))),relationToHolder:a.relationToHolder}),Object.assign(m.personVO,e)}}),{deep:!0}),o((()=>{var e;return null==(e=m.personVO)?void 0:e.relationToMainInsured}),((e,i)=>{if(!e)return;ue("次被保人与主被保人关系变动了");const{personVO:a,schema:l=[],config:t}=m||{},{certType:o}=a||{},[s,u]=re(l,{certType:o,relationToHolder:e});se(t,u),!n.isView&&i&&String(e)!==String(i)&&Object.assign(m.personVO,{...de(a,(e=>!(s&&"certType"===e))),relationToMainInsured:a.relationToMainInsured})})),o((()=>n.config),(e=>{e&&Object.assign(m.config,e)}),{deep:!0,immediate:!0}),o((()=>n.schema),((e,i)=>{e&&JSON.stringify(e)!==JSON.stringify(i)&&Object.assign(m.schema,te(e))}),{deep:!0,immediate:!0}),o((()=>n.modelValue),((e,i)=>{if(JSON.stringify(e)!==JSON.stringify(i)){const{beneficiaryList:i,...a}=e;se(m.personVO,a)}}),{deep:!0,immediate:!0}),o((()=>n.beneficiaryList),((e,i)=>{JSON.stringify(e)!==JSON.stringify(i)&&(m.beneficiaryList=K(e)?e.map((e=>({...e,nanoid:e.nanoid||$()}))):[])}),{deep:!0,immediate:!0}),o((()=>m.personVO),(e=>{e&&t("update:modelValue",e)}),{deep:!0,immediate:!0}),i({validate:e=>{var i;return Promise.all([pe(s,n.trialFactorCodes,e),pe(r,[],e),...(null==(i=d.value)?void 0:i.map((i=>i.validate(e))))||[]])},validateTrialFields:()=>me({personVO:m.personVO,trialFactorCodes:n.trialFactorCodes})}),(e,i)=>{const a=Y;return I(),w(N,null,[u(x(ce),{ref_key:"insuredFormRef",ref:s,class:"personal-info-card",title:x(v)?"":e.title,model:x(m).personVO,schema:x(m).schema,config:x(m).config,"is-view":e.isView,"extra-provision":{objectType:x(J).INSURED,objectId:x(m).personVO.id}},{cardTitleExtra:F((()=>[M(e.$slots,"default",{},void 0,!0)])),_:3},8,["title","model","schema","config","is-view","extra-provision"]),x(b)?(I(),w(N,{key:0},[u(x(ce),{ref_key:"beneficiaryTypeFormRef",ref:r,class:"personal-info-card",title:"受益人",model:x(m).personVO,schema:x(m).beneficiaryTypeSchemaList,"is-view":e.isView},null,8,["model","schema","is-view"]),x(V)?(I(),w(N,{key:0},[(I(!0),w(N,null,E(x(m).beneficiaryList,((i,l)=>(I(),D(He,{ref_for:!0,ref_key:"beneficiaryFormRef",ref:d,key:`${i.nanoid}_${l}`,modelValue:i.personVO,"onUpdate:modelValue":e=>i.personVO=e,title:`受益人${l+1}`,schema:x(m).beneficiarySchemaList,config:i.config,"is-view":e.isView},{default:F((()=>[l>0&&!e.isView?(I(),w("span",{key:0,class:"delete-button",onClick:e=>(e=>{H.confirm({message:"确定要删除该受益人吗？"}).then((()=>{m.beneficiaryList.splice(e,1)}))})(l)},[u(a,{name:"delete-o"})],8,Ye)):A("",!0)])),_:2},1032,["modelValue","onUpdate:modelValue","title","schema","config","is-view"])))),128)),!e.isView&&x(f)?(I(),w("span",{key:0,class:"add-button",onClick:p},[u(a,{name:"plus"}),R("添加受益人")])):A("",!0)],64)):A("",!0)],64)):A("",!0)],64)}}}),[["__scopeId","data-v-30e30bb2"]]);const We=["onClick"],qe=i({name:"PersonalInfo"}),Xe=i({...qe,props:{productFactor:{default:()=>({})},modelValue:{default:()=>({})},isTrial:{type:Boolean,default:!1},isView:{type:Boolean,default:!1},isOnlyHolder:{type:Boolean,default:!1},multiInsuredConfig:{}},emits:["update:modelValue","trailChange","trailValidateFailed"],setup(e,{expose:i,emit:t}){const n=e,s=a(null),r=a(null),d=C({config:{},trialValidated:!1,holder:{personVO:{},schema:[],trialFactorCodes:[],config:{}},beneficiarySchema:[],initInsuredIList:[],insured:[]}),m=l((()=>!n.isTrial||n.isOnlyHolder)),p=()=>{var e;const i=!r.value||(null==(e=r.value)?void 0:e.every((e=>e.validateTrialFields())));return(!s.value||me(d.holder))&&i},f=e=>{var i;return Promise.all([...(null==(i=r.value)?void 0:i.map((i=>i.validate(e))))||[],pe(s,d.holder.trialFactorCodes,e)])},v=e=>{const{productList:i,config:a,schema:l,trialFactorCodes:t,beneficiaryList:n,personVO:o,nanoid:s,...u}=e||{};return u},y=()=>{const{length:e,[e-1]:i}=d.initInsuredIList;d.insured.push(te({...i,nanoid:$()}))},b=l((()=>{const{multiInsuredMaxNum:e,multiInsuredSupportFlag:i}=d.config;return i&&(!e||d.insured.length<e)})),V=l((()=>K(d.holder.schema))),g=l((()=>d.insured.some((e=>K(e.schema))))),h=(e,i)=>K(e)?e.reduce(((e,a)=>(e[a]=i[a],e)),{}):{},k=(e,i,a={})=>!!K(e)&&JSON.stringify(h(e,i))!==JSON.stringify(h(e,a));return o((()=>{var e;return null==(e=d.holder.personVO)?void 0:e.certType}),((e,i)=>{if(e===i)return!1;ue("投保人信息变动了");const[a,l]=re(d.holder.schema,{certType:e});return se(d.holder.config,l),!1})),o([()=>{var e;return{...null==(e=d.holder)?void 0:e.personVO}},()=>d.insured.map((e=>{const{beneficiaryList:i,personVO:a}=e||{};return{...a,beneficiaryList:K(i)?i.map((e=>({...e.personVO}))):[]}}))],ne(((e,i)=>{var a,l,o;const[s,u]=e,r=((e,i)=>{const a=k(d.holder.trialFactorCodes,e[0],i[0]),l=d.insured.some(((e,a)=>{var l;const{trialFactorCodes:t,personVO:n}=e;return k(t,n,null==(l=i[1])?void 0:l[a])}));return a||l})([s,u],i);ue(`投被保人信息变动了---${r}`);const{insuredList:c}=n.modelValue;console.log("insuredList",c,u);const m={holder:s,insuredList:u.map(((e,i)=>({...(null==c?void 0:c[i])||{},...e})))};if(d.config.isSpouseInsured){const[e,i]=u.map((e=>null==e?void 0:e.gender));if(e&&i&&String(e)===String(i))return z("被保人性别与投保要求不符")}if(JSON.stringify(null==(a=null==u?void 0:u[0])?void 0:a.personVO),v(null==(o=null==(l=n.modelValue)?void 0:l.insuredList)?void 0:o[0]),console.log("-------result = ",m),t("update:modelValue",m),!p())return d.trialValidated=!1,t("trailValidateFailed",m);f(!0).then((()=>{d.trialValidated=!0,r&&!n.isOnlyHolder&&t("trailChange",m)})).catch((()=>{d.trialValidated=!1,t("trailValidateFailed",m)}))}),500),{deep:!0}),o([()=>n.productFactor,()=>n.isTrial],((e,i)=>{if(fe(e,i)||!e[0])return!1;ue("投被保人要素变动了");const{insuredFactorCodes:a,holderFactorCodes:l}=G(W)||{},{holder:t,insured:o,beneficiary:s,config:u}=ve(e[0],{isTrial:e[1],...n.multiInsuredConfig,insuredFactorCodes:a,holderFactorCodes:l});return Object.assign(d.holder,t),console.log("-----------",t,o),d.config=u,K(o)&&(d.initInsuredIList=o.map((e=>({...e,beneficiaryList:[]})))),d.beneficiarySchema=te((null==s?void 0:s.schema)||[]),!1}),{deep:!0,immediate:!0}),o([()=>{const{holder:e,insuredList:i}=n.modelValue,a=K(i)?i.map((e=>({config:e.config,personVO:v(e),beneficiaryList:K(e.beneficiaryList)?e.beneficiaryList.map((({config:e,...i})=>({config:e,personVO:v(i)}))):[]}))):[];return[null==e?void 0:e.config,v(e),a]},()=>d.config,()=>d.initInsuredIList],(([[e,i,a]])=>{ue("投被保人数据变动了"),Object.assign(d.holder.config,e),Object.assign(d.holder.personVO,i);const{length:l}=a||[],{length:t}=d.insured,{length:o,0:s={},[o-1]:u}=d.initInsuredIList,{multiInsuredMaxNum:r,multiInsuredMinNum:c,multiInsuredSupportFlag:m}=d.config,p=n.isView||l>t?Math.min(l,r):t||c;console.log("-----change",d.config,p),d.insured=Array.from({length:p}).reduce(((e,i,l)=>{const{personVO:t,config:n={},beneficiaryList:o}=(null==a?void 0:a[l])||{},r=te(0===l?s:u);return e[l]?se(e[l],{...te(r),personVO:t,config:n,beneficiaryList:o}):e[l]={...r,personVO:t,config:n,beneficiaryList:o,nanoid:$()},e}),d.insured)}),{deep:!0,immediate:!0}),i({validate:f,validateTrialFields:p,validateHolder:(...e)=>{var i;return null==(i=s.value)?void 0:i.validate(...e)},canTrail:()=>d.trialValidated}),(e,i)=>{const a=Y,l=q;return I(),w(N,null,[x(V)&&x(m)?(I(),D(x(ce),{key:0,ref_key:"holderFormRef",ref:s,title:"投保人信息",class:"personal-info-card",model:x(d).holder.personVO,schema:x(d).holder.schema,config:x(d).holder.config,"is-view":e.isView,"extra-provision":{objectType:x(J).HOLDER,objectId:x(d).holder.personVO.id}},null,8,["model","schema","config","is-view","extra-provision"])):A("",!0),x(g)&&!e.isOnlyHolder?(I(),w(N,{key:1},[(I(!0),w(N,null,E(x(d).insured,((i,l)=>(I(),D(Ge,c({ref_for:!0,ref_key:"insuredFormRef",ref:r,key:`${i.nanoid}_${l}`,modelValue:i.personVO,"onUpdate:modelValue":e=>i.personVO=e,"beneficiary-list":i.beneficiaryList,"onUpdate:beneficiaryList":e=>i.beneficiaryList=e,title:""+(x(d).insured.length>1?`被保人${l+1}`:"被保人信息"),"holder-person-v-o":x(d).holder.personVO},i,{"beneficiary-schema":x(d).beneficiarySchema,"is-view":e.isView,"multi-beneficiary-num":x(d).config.multiBeneficiaryMaxNum}),{default:F((()=>[!e.isView&&l+1>x(d).config.multiInsuredMinNum?(I(),w("span",{key:0,class:"delete-button",onClick:e=>(e=>{H.confirm({message:"确定要删除该被保人吗？"}).then((()=>{d.insured.splice(e,1)}))})(l)},[u(a,{name:"delete-o"})],8,We)):A("",!0)])),_:2},1040,["modelValue","onUpdate:modelValue","beneficiary-list","onUpdate:beneficiaryList","title","holder-person-v-o","beneficiary-schema","is-view","multi-beneficiary-num"])))),128)),!e.isView&&x(b)?(I(),D(l,{key:0,class:"add-button-wrap"},{title:F((()=>[T("span",{class:"add-button",onClick:y},[u(a,{name:"plus"}),R("添加被保人")])])),_:1})):A("",!0)],64)):A("",!0)],64)}}});var Ze=j(Xe,[["__scopeId","data-v-76f8541c"]]),Qe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ei=/^\w*$/;function ii(e,i){if("function"!=typeof e||null!=i&&"function"!=typeof i)throw new TypeError("Expected a function");var a=function(){var l=arguments,t=i?i.apply(this,l):l[0],n=a.cache;if(n.has(t))return n.get(t);var o=e.apply(this,l);return a.cache=n.set(t,o)||n,o};return a.cache=new(ii.Cache||be),a}ii.Cache=be;var ai,li,ti,ni=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,oi=/\\(\\)?/g,si=(ai=function(e){var i=[];return 46===e.charCodeAt(0)&&i.push(""),e.replace(ni,(function(e,a,l,t){i.push(l?t.replace(oi,"$1"):a||e)})),i},li=ii(ai,(function(e){return 500===ti.size&&ti.clear(),e})),ti=li.cache,li),ui=si;var ri=Ve?Ve.prototype:void 0,di=ri?ri.toString:void 0;function ci(e){if("string"==typeof e)return e;if(ye(e))return function(e,i){for(var a=-1,l=null==e?0:e.length,t=Array(l);++a<l;)t[a]=i(e[a],a,e);return t}(e,ci)+"";if(oe(e))return di?di.call(e):"";var i=e+"";return"0"==i&&1/e==-Infinity?"-0":i}function mi(e,i){return ye(e)?e:function(e,i){if(ye(e))return!1;var a=typeof e;return!("number"!=a&&"symbol"!=a&&"boolean"!=a&&null!=e&&!oe(e))||ei.test(e)||!Qe.test(e)||null!=i&&e in Object(i)}(e,i)?[e]:ui(function(e){return null==e?"":ci(e)}(e))}function pi(e){if("string"==typeof e||oe(e))return e;var i=e+"";return"0"==i&&1/e==-Infinity?"-0":i}function fi(e,i,a){var l=null==e?void 0:function(e,i){for(var a=0,l=(i=mi(i,e)).length;null!=e&&a<l;)e=e[pi(i[a++])];return a&&a==l?e:void 0}(e,i);return void 0===l?a:l}const vi={class:"pro-radio-wrap"},yi=i({name:"ProductKeys"});var bi=j(i({...yi,props:{originData:{default:()=>({})},modelValue:{default:()=>({})},riskInfo:{default:()=>({})},defaultValue:{default:()=>({})},useData:{default:()=>({})}},emits:["trialChange","inputChange"],setup(e,{emit:i}){const l=e,t=a(l.originData),n=a(l.modelValue);a(1);const s=e=>{const i=fi(l.originData,e),a=fi(l.originData,e);return i.map((e=>{const i=a?a.find((i=>i.code===e.code)):null;return{label:e.value,value:e.code,disabled:!(!i||null===i.useFlag||void 0===i.useFlag)&&1!==i.useFlag}}))},r=()=>{ge.forEach((e=>{const i=fi(l.originData,e.configKey);"checkbox"===e.type&&i&&i.length>0&&!n.value.riskCode&&(n.value[e.valueKey]=i[0].code)}))};return S((()=>{r()})),o((()=>l.defaultValue),(e=>{(null==e?void 0:e.riskCode)&&(n.value=JSON.parse(JSON.stringify(e)))}),{deep:!0,immediate:!0}),o((()=>t.value),(e=>{r()}),{deep:!0,immediate:!0}),o((()=>JSON.stringify(n.value)),((e,a)=>{const t=e&&JSON.parse(e)||{};console.log("---v new = ",t);const n=a&&JSON.parse(a)||{};let o=null;ge.forEach((e=>{t[e.valueKey]&&n[e.valueKey]&&t[e.valueKey]!==n[e.valueKey]&&(o||(o={key:e.valueKey,oldValue:n[e.valueKey],newValue:t[e.valueKey],riskCode:l.riskInfo.riskCode}))})),e&&i("trialChange",JSON.parse(e),o)}),{deep:!0,immediate:!0}),(e,i)=>{const a=P,l=U;return I(!0),w(N,null,E(x(ge),(i=>(I(),w(N,null,[x(fi)(e.originData,i.configKey)&&(1===e.riskInfo.mainRiskFlag||i.ruleKey&&2===x(fi)(e.originData,i.ruleKey)||!i.ruleKey)?(I(),w("div",{key:e.riskInfo.riskCode+"_"+i.name},["checkbox"===i.type?(I(),D(l,{key:0,modelValue:n.value[i.valueKey],"onUpdate:modelValue":e=>n.value[i.valueKey]=e,label:i.name,name:i.valueKey,class:"risk-select-field"},{input:F((()=>[T("div",vi,[u(a,{modelValue:n.value[i.valueKey],"onUpdate:modelValue":[e=>n.value[i.valueKey]=e,e=>((e,i)=>{console.log("-------change",e,i)})(e,i.valueKey)],options:s(i.configKey)},null,8,["modelValue","onUpdate:modelValue","options"])])])),_:2},1032,["modelValue","onUpdate:modelValue","label","name"])):A("",!0)])):A("",!0)],64)))),256)}}}),[["__scopeId","data-v-15c494f0"]]);const Vi={class:"com-risk-liabilityinfo"},gi={class:"item-wrap"},hi={key:0},ki=(e=>(Q("data-v-6674cf80"),e=e(),ee(),e))((()=>T("div",{class:"cell-content"},null,-1))),Li=i({name:"riskLiabilityInfo"});var Oi=j(i({...Li,props:{dataSource:{default:()=>({})},modelValue:{default:()=>({})},dataSourceFolmulate:{default:()=>({})},params:{default:()=>({amountUnit:"",basicsAmount:"",basicsPremium:"",riskId:""})},defaultValue:{default:()=>({})}},emits:["trialChange"],setup(e,{emit:i}){const t=e,n=a({formInfo:t.dataSource,isCheckList:[],checkValueList:[],liabilityList:[],signLiabilityClick:[]}),s=(e,i)=>{console.log("---click ",e,i),n.value.signLiabilityClick.push({item:e,index:i})},r=(e,i)=>{const{riskLiabilityInfoVOList:a,riskLiabilityCollocationVOList:l}=t.dataSource,o=a[e].liabilityId,s=(l||[]).find((e=>e.relatedLiabilityId===o||e.collocationLiabilityId===o))||{};let u=null;s.collocationLiabilityId===o?(u=s.relatedLiabilityId,s.collocationType===Le.YI_LAI&&(u=s.collocationLiabilityId)):u=s.collocationLiabilityId;const r=a.findIndex((e=>e.liabilityId===u));((e,i,a)=>{n.value.isCheckList[e]===`${ie.YES}`?a===Le.BANG_DING||a===Le.YI_LAI?n.value.isCheckList[i]="1":n.value.isCheckList[i]="2":a===Le.BANG_DING?n.value.isCheckList[i]="2":a===Le.YI_LAI&&(n.value.isCheckList[i]=e!==i?"3":"2")})(e,r,s.collocationType),i(a[r],r,!0)},d=(e,i,a)=>{const l=n.value.liabilityList.map((e=>e.key)),t=0===(null==e?void 0:e.liabilityAttributeValueList.length)&&0===(null==e?void 0:e.formula.length),o=n.value.isCheckList[i];t&&-1===l.indexOf(i)&&o&&n.value.liabilityList.push({liabilityValue:e,key:i,isSwitchOn:n.value.isCheckList[i]}),"1"===o?s(e,i):n.value.signLiabilityClick.splice(i,1),-1!==l.indexOf(i)&&n.value.liabilityList.forEach((e=>{e.key===i&&(e.isSwitchOn=n.value.isCheckList[i])})),a||r(i,d)},c=(e,i)=>{const a=e.liabilityAttributeValueList.filter((e=>e.displayValue===n.value.checkValueList[i])),l=JSON.parse(JSON.stringify(a))[0]||e.liabilityAttributeValueList[0],t={...e,liabilityValue:l};n.value.liabilityList.length>0&&Object.keys(n.value.checkValueList).indexOf(i)&&(n.value.liabilityList=n.value.liabilityList.filter((e=>e.key!==i))),n.value.checkValueList[i]=l.displayValue,n.value.liabilityList.push({liabilityValue:t,key:i,isSwitchOn:"1"})},m=l((()=>te(t.dataSourceFolmulate))),p=(e,i,a)=>{1===a?n.value.liabilityList.push({liabilityValue:{...e,liabilityValue:null==e?void 0:e.liabilityAttributeValueList[0]},key:i,isSwitchOn:"1"}):n.value.liabilityList.push({liabilityValue:{...e,liabilityValue:null==e?void 0:e.liabilityAttributeValueList[0]},key:i,isSwitchOn:"2"})};o((()=>m.value),((e,i)=>{var a,l;const o=null==(a=t.dataSourceFolmulate)?void 0:a.initialAmount,s=null==(l=t.dataSourceFolmulate)?void 0:l.initialPremium,u={amountUnit:t.params.amountUnit,basicsAmount:o,basicsPremium:s,riskId:t.params.riskId};t.dataSource.riskLiabilityInfoVOList.map((async a=>{if(a.formula.length>0&&(o||s)&&((null==e?void 0:e.initialAmount)!==(null==i?void 0:i.initialAmount)||(null==e?void 0:e.initialPremium)!==(null==i?void 0:i.initialPremium))){const{code:e,data:i}=await ke({...u,riskLiabilities:[a]});if("10000"===e){if(a.liabilityAttributeValueList=i[0].formulaResult,n.value.signLiabilityClick.length>0){const e=n.value.signLiabilityClick.find((e=>e.item.liabilityCode===a.liabilityCode));e&&c(e.item,e.index)}return{...a,liabilityAttributeValueList:i[0]}}return a}}))}),{deep:!0,immediate:!0}),o((()=>n.value.liabilityList),(e=>{const a=n.value.liabilityList.filter((e=>"1"===e.isSwitchOn)).map((e=>({...e.liabilityValue})));i("trialChange",a)}),{deep:!0,immediate:!0}),S((()=>{console.log("----mounted"),t.dataSource.riskLiabilityInfoVOList.map(((e,i)=>{const a=e.liabilityAttributeValueList.length>0&&0===e.formula.length&&e.liabilityAttributeValueList[0].displayValue;return n.value.checkValueList[i]||(n.value.checkValueList[i]=a),1!=+e.showFlag&&n.value.liabilityList.push({liabilityValue:e,key:i,isSwitchOn:"1"}),1==+e.showFlag&&(1===e.attributeFlag&&2===e.insureFlag&&0===e.formula.length&&p(e,i,1),1===e.attributeFlag&&1===e.insureFlag&&0===e.formula.length&&p(e,i,2),2===e.attributeFlag&&1===(null==e?void 0:e.liabilityAttributeValueList.length)&&2===e.insureFlag&&p(e,i,1),2===e.attributeFlag&&1===(null==e?void 0:e.liabilityAttributeValueList.length)&&1===e.insureFlag&&p(e,i,2)),null}))}));const f=a([]);return o((()=>t.dataSource.riskLiabilityInfoVOList),(e=>{f.value=(e||[]).map((e=>{const i=(t.dataSource.riskLiabilityCollocationVOList||[]).find((i=>i.collocationLiabilityId===e.liabilityId));return{...e,relation:null==i?void 0:i.collocationType}}))}),{deep:!0,immediate:!0}),o((()=>t.defaultValue),(e=>{(null==e?void 0:e.riskCode)&&e.liabilityList&&(n.value.signLiabilityClick=[],t.dataSource.riskLiabilityInfoVOList.forEach(((i,a)=>{var l;const t=null==e?void 0:e.liabilityList.find((e=>e.liabilityCode===i.liabilityCode));console.log("--target lia = ",t),t&&(n.value.isCheckList[a]="1",n.value.checkValueList[a]=null==(l=null==t?void 0:t.liabilityValue)?void 0:l.displayValue,1==+i.showFlag&&2==+i.optionalFlag?d(i,a):s(i,a))})))}),{deep:!0,immediate:!0}),(e,i)=>{const a=he,l=U,t=X,o=Z;return I(),D(o,null,{default:F((()=>[T("div",Vi,[T("div",gi,[(I(!0),w(N,null,E(x(f),((e,i)=>(I(),w("div",{key:i},[1!=+e.showFlag||2===e.attributeFlag&&1===(null==e?void 0:e.liabilityAttributeValueList.length)&&2===e.insureFlag?A("",!0):(I(),w("div",hi,[(x(n).isCheckList[i]?"3"!==x(n).isCheckList[i]:e.relation!==x(Le).YI_LAI)?(I(),D(l,{key:0,label:`${e.liabilityName}`,"label-width":"40%",name:"insuredRelation",class:"riskliab-select-field"},{input:F((()=>[1==+e.insureFlag?(I(),D(a,{key:0,modelValue:x(n).isCheckList[i],"onUpdate:modelValue":e=>x(n).isCheckList[i]=e,"active-value":"1","inactive-value":"2",size:"0.74rem",onClick:a=>d(e,i)},null,8,["modelValue","onUpdate:modelValue","onClick"])):A("",!0)])),_:2},1032,["label"])):A("",!0),1==+x(n).isCheckList[i]&&1===e.attributeFlag||1===e.attributeFlag&&2===e.insureFlag?(I(),D(l,{key:1,label:e.liabilityAttributeTypeDesc,"label-width":"40%",name:"insuredRelation",class:"riskliab-select-field-children"},{input:F((()=>[u(P,{modelValue:x(n).checkValueList[i],"onUpdate:modelValue":e=>x(n).checkValueList[i]=e,prop:{label:"displayValue",value:"displayValue"},options:(e.formula.length,e.liabilityAttributeValueList),"is-simply":!0,onClick:a=>c(e,i)},null,8,["modelValue","onUpdate:modelValue","options","onClick"])])),_:2},1032,["label"])):A("",!0)]))])))),128))])]),ki,u(t)])),_:1})}}}),[["__scopeId","data-v-6674cf80"]]);export{Ee as B,Ze as P,Oi as R,Ie as S,bi as a};
