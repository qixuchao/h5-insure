var je=Object.defineProperty,ze=Object.defineProperties;var Je=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var Xe=Object.prototype.hasOwnProperty,Qe=Object.prototype.propertyIsEnumerable;var ue=(C,f,g)=>f in C?je(C,f,{enumerable:!0,configurable:!0,writable:!0,value:g}):C[f]=g,m=(C,f)=>{for(var g in f||(f={}))Xe.call(f,g)&&ue(C,g,f[g]);if(se)for(var g of se(f))Qe.call(f,g)&&ue(C,g,f[g]);return C},p=(C,f)=>ze(C,Je(f));import{g as Ze,a9 as ea,O as aa,E,M as le,y as ie,_ as ta,l as oa,h as ra,r as ce,af as na,j as V,n as de,p as N,m as z,H as sa,t as J,z as S,A as D,J as X,C as Ae,k as me,F as ua,D as la,T as pe,X as ia}from"./vendor-17026bfd.js";import{_ as ca,C as fe,$ as da,G as ma,a1 as he}from"./index-bf552ee9.js";import{a as T}from"./order-c0ced472.js";import{S as k,R as ve,f as ye,I as pa}from"./infoCollection-192ba138.js";import{p as De,i as fa,s as ha,g as va,a as ya,u as Da,b as ga}from"./trial-171a9822.js";import{p as Fa}from"./product-60afd889.js";import{g as ge,o as Fe,t as Ea,a as Ia,f as Ee}from"./utils-e184c7a2.js";import{t as _a}from"./theme-ea709837.js";import{d as Ie,B as Ca,D as Na,G as wa,S as Aa,H as Ta,P as ba,U as Pa,_ as ka,W as Oa,c as Y,f as _e,o as Ce,a as q,n as Ne,h as we}from"./auth-da0998e0.js";import{_ as Ba}from"./index-560e0eb2.js";import"./utils-b6782348.js";import"./trial-b84ce850.js";import"./index-3f00620a.js";import"./bankCard-0e4ce564.js";import"./phoneVerify-4aefc1b3.js";const Sa={key:0},Ua={class:"page-internet-product-detail"},La={class:"info"},Ha={class:"footer-button"},Ma={class:"price"},Ra=Ae(" \u603B\u4FDD\u8D39"),xa=Ze({setup(C){const f=ea(),g=aa(),{productCode:U="BWYL2021",tenantId:I,orderNo:O,phoneNo:L,agentCode:$="",saleChannelId:Te,paymentMethod:F,certNo:Q,name:Z,pageCode:H,from:be}=g.query,K=E(),h=E(),M=E(),b=E(),B=H==="payBack",ee=E(!1),R=E(!1),P=E(!1),ae=E(0),G=E(!1),W=E(!1),x=E({show:!1,html:""});let j="";const o=le({holder:{certNo:Q,certType:fe.CERT,mobile:L,name:Z,socialFlag:k.HAS},insured:{certNo:Q,certType:fe.CERT,name:Z,socialFlag:k.HAS,relationToHolder:ve.SELF},paymentMethod:F,renewalDK:"Y",paymentFrequency:ye.YEAR,packageProductList:[],mobileSmsCode:""}),w=E(Ie),_=E(Ie),u=le({showInsure:!B,canInsure:!1,canUpgrade:!1}),Pe=ie(()=>{var a,t;return((t=(a=h.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(e=>e.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),ke=ie(()=>{var a,t;return((t=(a=h.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(e=>e.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),Oe=()=>{const{holder:{certNo:a,mobile:t,name:e,socialFlag:s},insured:{certNo:r,name:n,socialFlag:l,relationToHolder:c},paymentMethod:v}=o;return!!(ma(r)&&!!l)},te=()=>{f.push({path:"/internet/guaranteeUpgrade",query:p(m({},g.query),{tenantId:I,productCode:"BWYL2022",orderNo:O,agentCode:$})})},Be=()=>{W.value=!1},Se=()=>{_.value=w.value},Ue=()=>{_.value=p(m({},_.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},Le=async a=>{pe.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const t=await Da(a),{code:e}=t;if(e==="10000"){pe.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const s=await ga({orderNo:a.orderNo,tenantId:I}),{data:r}=s;s.code==="10000"&&(r.type===2?(x.value={show:!0,html:r.paymentUrl},console.log("data.paymentUrl",x.value),ia(()=>{console.log("document.forms",document.forms);const n=document.getElementById("cashierSubmit");n==null||n.addEventListener("submit",l=>{l.preventDefault()}),n==null||n.submit()})):window.location.href=r.paymentUrl)}u.canInsure=!0}catch{u.canInsure=!0}},He=a=>`${he}/internet/orderDetail?orderNo=${a}&productCode=${U}&tenantId=${I}`,Me=a=>`${he}/internet/payFail?tenantId=${I}&orderNo=${a}&agentCode=${$}&pageCode=payBack&from=${be||"normal"}`,Re=async a=>{console.log("risk",a);const t=Ia({tenantId:I,saleUserId:$,saleChannelId:Te,detail:h.value,insureDetail:M.value,paymentMethod:o.paymentMethod,renewalDK:o.renewalDK,iseeBizNo:j,successJumpUrl:"",premium:b.value,holder:o.holder,insured:o.insured,tenantOrderRiskList:a,orderStatus:"",orderTopStatus:""});try{const e=await ha(t),{code:s,data:r}=e;s==="10000"&&Le(p(m({},t),{orderNo:r.data,extInfo:{extraInfo:{renewalDK:o.renewalDK,paymentMethod:o.paymentMethod,successJumpUrl:He(r.data),failUrl:Me(r.data)},iseeBizNo:j}}))}catch{u.canInsure=!0}},xe=async()=>{console.log("trialData",o);const{calcData:a,riskVOList:t}=ge({holder:o.holder,insured:o.insured,tenantId:I,productDetail:h.value,insureDetail:M.value,paymentFrequency:o.paymentFrequency,packageRiskIdList:Fe(o.packageProductList)},!1,Ee),e=await De(a),{code:s,data:r}=e;return s==="10000"?(b.value=r.premium,{condition:t,data:r}):{}},Ve=a=>{ae.value=a,P.value=!0},Ye=()=>new Promise((a,t)=>{var e,s;(s=(e=K.value)==null?void 0:e.validateForm)==null||s.call(e).then(async()=>{var d;if(!(((d=K.value)==null?void 0:d.isAgreeFile)||ee.value)){P.value=!0,Ve(0);return}const{calcData:n,riskVOList:l}=ge({holder:o.holder,insured:o.insured,tenantId:I,productDetail:h.value,insureDetail:M.value,paymentFrequency:o.paymentFrequency,packageRiskIdList:Fe(o.packageProductList)},!1,Ee),c=await De(n),{code:v,data:y}=c;v==="10000"?(b.value=y.premium,a({condition:l,data:y})):t(new Error)}).catch(()=>{u.canInsure=!0})}),oe=async()=>{var a;if(B){te();return}u.canInsure=!1;try{const{condition:t,data:e}=await Ye(),s={},r=(l=[])=>{(l||[]).forEach(c=>{var v;s[c.riskCode]=c,((v=c.riskPremiumDetailVOList)==null?void 0:v.length)&&r(c.riskPremiumDetailVOList)})};r(e.riskPremiumDetailVOList);const n=Ea({tenantId:I,riskList:t,riskPremium:s,productId:(a=h.value)==null?void 0:a.id});Re(n)}catch{u.canInsure=!0}},qe=a=>{a==="allFalse"?(R.value=!1,oe(),u.canInsure=!0):la.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"})},$e=()=>{ee.value=!0,P.value=!1,R.value=!0};ta([()=>o.insured.certNo,()=>o.insured.socialFlag,()=>o.packageProductList,()=>o.paymentFrequency],oa.exports.debounce(()=>{o.insured.certNo&&o.insured.socialFlag&&Oe()&&xe()},500),{deep:!0,immediate:!0});const re=async()=>{var s,r,n,l,c,v,y,d;const a=await va({orderNo:O,tenantId:I}),{code:t,data:e}=a;if(t==="10000"){const{tenantOrderHolder:i,tenantOrderInsuredList:A,extInfo:ne}=e;if(!B){Object.assign(o,{holder:{certNo:i.certNo,certType:i.certType,mobile:i.mobile,name:i.name,socialFlag:k.HAS},insured:{certNo:i.certNo,certType:i.certType,name:i.name,socialFlag:k.HAS,relationToHolder:ve.SELF},paymentMethod:F,renewalDK:"Y"}),u.canInsure=!0,_.value=Ne,w.value=Ne;return}Object.assign(o,{holder:{certNo:i.certNo,certType:i.certType,mobile:i.mobile,name:i.name,socialFlag:k.HAS},insured:{certNo:A==null?void 0:A[0].certNo,certType:(s=A[0])==null?void 0:s.certType,name:(r=A[0])==null?void 0:r.name,socialFlag:(l=(n=A[0])==null?void 0:n.extInfo)==null?void 0:l.hasSocialInsurance,relationToHolder:(c=A[0])==null?void 0:c.relationToHolder},paymentMethod:ne.extraInfo.paymentMethod,renewalDK:ne.extraInfo.renewalDK||"N"}),b.value=(d=(y=(v=A[0])==null?void 0:v.tenantOrderProductList)==null?void 0:y[0])==null?void 0:d.premium,(e.orderStatus===T.ACCEPT_POLICY||e.orderStatus===T.PAYMENT_SUCCESS)&&(u.canUpgrade=!0,G.value=!1,W.value=!0),e.orderStatus===T.PAYING&&(G.value=!0,setTimeout(()=>{re()},3*1e3))}},Ke=async()=>{var s,r,n,l,c,v;console.log("\u77ED\u4FE1\u8FDB\u5165\uFF0C\u5E26\u4E86orderNo, mobile");const a=await ya({holderPhone:L,orderStatus:[T.PAYING.toUpperCase(),T.TIMEOUT.toUpperCase(),"ACCEPT_POLICY"],productCode:U,tenantId:I}),{code:t,data:e}=a;if(e.orderStatus===T.ACCEPT_POLICY&&(console.log("\u5DF2\u627F\u4FDD\uFF0C\u88AB\u4FDD\u4EBA\u4FE1\u606F\u4E0D\u80FD\u4FEE\u6539"),_.value=p(m({},we),{paymentDisable:!!F}),w.value=p(m({},we),{paymentDisable:!!F})),(e.orderStatus===T.PAYING||e.orderStatus===T.TIMEOUT)&&(console.log("\u652F\u4ED8\u4E2D\uFF0C\u8D85\u65F6\u53EF\u4EE5\u4FEE\u6539\u6295\u4FDD\u4EBA\u4FE1\u606F"),_.value=p(m({},q),{paymentDisable:!!F}),w.value=p(m({},q),{paymentDisable:!!F})),t==="10000"&&((s=e==null?void 0:e.tenantOrderHolder)==null?void 0:s.certNo)){u.canInsure=!0;const{tenantOrderHolder:y,tenantOrderInsuredList:d,extInfo:i}=e;Object.assign(o,{holder:{certNo:y.certNo,certType:y.certType,mobile:y.mobile,name:y.name,socialFlag:k.HAS},insured:{certNo:d==null?void 0:d[0].certNo,certType:(r=d[0])==null?void 0:r.certType,name:(n=d[0])==null?void 0:n.name,socialFlag:(c=(l=d[0])==null?void 0:l.extInfo)==null?void 0:c.hasSocialInsurance,relationToHolder:(v=d[0])==null?void 0:v.relationToHolder},paymentMethod:F||i.extraInfo.paymentMethod,renewalDK:i.extraInfo.renewalDK})}else _.value=p(m({},Y),{paymentDisable:!!F}),w.value=p(m({},Y),{paymentDisable:!!F}),u.canInsure=!0},Ge=async()=>{const a=Fa({productCode:U,withInsureInfo:!0,tenantId:I}),t=fa({productCode:U});await Promise.all([a,t]).then(([e,s])=>{var r,n;e.code==="10000"&&(h.value=e.data,document.title=((r=e.data)==null?void 0:r.productFullName)||""),s.code==="10000"&&(o.packageProductList=(((n=s.data)==null?void 0:n.packageProductVOList)||[]).map(l=>p(m({},l),{value:pa.UN_INSURE,disabled:!1})),M.value=s.data)}),O?re():L&&H==="productDetail"&&Ke()},We=()=>{H==="free"?B?(_.value=p(m({},_e),{paymentDisable:!!F}),w.value=p(m({},_e),{paymentDisable:!!F}),u.canInsure=!0):(_.value=p(m({},Y),{paymentDisable:!!F}),w.value=p(m({},Y),{paymentDisable:!!F}),u.canInsure=!0):B?(_.value=Ce,w.value=Ce,console.log("\u652F\u4ED8\u5B8C\u6210\u8FDB\u5165")):L||O||(console.log("\u6295\u4FDD\u94FE\u63A5"),_.value=q,w.value=q,u.canInsure=!0)};return ra(()=>{We(),Ge(),setTimeout(async()=>{j=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(a,t)=>{const e=ce("van-button"),s=ce("van-config-provider"),r=na("dompurify-html");return V(),de(ua,null,[N(s,{"theme-vars":D(_a)},{default:z(()=>{var n,l,c,v,y,d,i;return[x.value.show?sa((V(),de("div",Sa,null,512)),[[r,x.value.html]]):J("",!0),S("div",Ua,[S("div",La,[N(Ca,{url:(l=(n=h.value)==null?void 0:n.tenantProductInsureVO)==null?void 0:l.banner[0]},null,8,["url"]),N(Na,{"product-name":(c=h.value)==null?void 0:c.productFullName,"product-desc":(y=(v=h.value)==null?void 0:v.showConfigVO)==null?void 0:y.desc},null,8,["product-name","product-desc"])]),N(wa,{"show-service-config":"","guarantee-list":(i=(d=h.value)==null?void 0:d.tenantProductInsureVO)==null?void 0:i.titleAndDescVOS},null,8,["guarantee-list"]),N(Aa,{detail:h.value},{form:z(()=>[N(Ta,{ref_key:"formRef",ref:K,"is-show-package":"",disable:!D(u).showInsure,"form-auth":_.value,"form-info":D(o),premium:b.value,"product-detail":h.value,onOnReset:Se,onOnUpdate:Ue},null,8,["disable","form-auth","form-info","premium","product-detail"])]),_:1},8,["detail"]),S("div",Ha,[S("div",Ma,[Ra,S("span",null," \uFFE5"+X(D(da)(b.value))+" "+X(D(o).paymentFrequency==D(ye).YEAR?"\u5143/\u5E74":"\u5143/\u6708"),1)]),N(e,{type:"primary",class:"right",disabled:!(D(u).canInsure||D(u).canUpgrade),onClick:oe},{default:z(()=>[Ae(X(D(u).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),D(H)!=="payBack"?(V(),me(ba,{key:1,"product-detail":h.value},null,8,["product-detail"])):J("",!0),N(Pa,{"order-no":D(O),"tenant-id":D(I),"is-show":W.value,onOnConfirm:te,onOnClose:Be},null,8,["order-no","tenant-id","is-show"])]}),_:1},8,["theme-vars"]),N(ka,{show:R.value,"onUpdate:show":t[0]||(t[0]=n=>R.value=n),"content-list":D(Pe),"active-index":0,onOnConfirmHealth:qe},null,8,["show","content-list"]),P.value?(V(),me(Ba,{key:0,show:P.value,"onUpdate:show":t[1]||(t[1]=n=>P.value=n),"content-list":D(ke),"active-index":ae.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9","force-read-cound":2,onSubmit:$e},null,8,["show","content-list","active-index"])):J("",!0),N(Oa,{"is-show":G.value},null,8,["is-show"])],64)}}});var ot=ca(xa,[["__scopeId","data-v-74822892"]]);export{ot as default};
