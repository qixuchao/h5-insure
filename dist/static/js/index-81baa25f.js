import{T as e,d as l,j as a,k as s,z as n,cL as u,cM as t,o as i,c as o,a as r,g as v,u as c,f as d,b as g,w as p,a8 as m,e as f,F as h,q as S,m as y,cN as w,p as _,_ as b,cO as k,aj as V,cf as C}from"./index-0aeac8ce.js";import{c as j}from"./cloneDeep-5f0edc08.js";var A=e;const T={class:"sign-wrap"},U=["src"],x={class:"popup-body"},N={class:"sign-container-wrap"},R={class:"operate-bar"},z=l({name:"sign"});var D=b(l({...z,props:{option:{default:{}},modelValue:{default:()=>[]},signString:{default:"房间卡贺卡和大伙副书记环境发好"},signAccount:{default:3}},emits:["update:modelValue","submitSign"],setup(e,{expose:l,emit:b}){const z=e,D=a(!1),E=a(),I=a([]),L=a([]),q=a(0),F=s((()=>{if(z.signString&&z.signString.length>=z.signAccount){const e=[];let l=0;for(let a=0;a<=z.signString.length;a++)!a||a%z.signAccount||(l+=1),z.signString[a]&&(e[l]?e[l]+=z.signString[a]:e[l]=z.signString[a]);return e}return[z.signString||""]})),M=s((()=>{var e;const l=I.value.filter((e=>e));return(null==(e=F.value)?void 0:e.length)>(null==l?void 0:l.length)})),O=a(!0),$=a(),B=()=>{0!==q.value&&$.value&&(q.value-=1,$.value.swipeTo(q.value))},G=e=>{D.value=!0,setTimeout((()=>{var l;E.value&&((E.value||[]).forEach(((l,a)=>{var s,n,u;e?null==(s=l.clear)||s.call(l):null==(u=l.setDataURL)||u.call(l,(null==(n=I.value)?void 0:n[a])||"")})),(null==(l=z.modelValue)?void 0:l.length)&&!e?O.value=!1:O.value=!0)}),200)},H=()=>{k({images:I.value,className:"customer-sign-preview"})},J=()=>{I.value=j(L.value),D.value=!1},K=()=>{if(q.value===F.value.length-1)return;q.value,z.signAccount;F.value[q.value].length,$.value&&(q.value+=1,$.value.swipeTo(q.value))},P=()=>{(E.value||[]).forEach(((e,l)=>{var a;l===q.value&&(null==(a=e.clear)||a.call(e))}))},Q=()=>{var e,l;(null==(e=I.value)?void 0:e.length)<(null==(l=F.value)?void 0:l.length)?A({message:"请完成签名",className:"toast-vertical"}):(b("update:modelValue",I.value),b("submitSign",I.value),D.value=!1)};return n([()=>z.modelValue,()=>F.value],(()=>{I.value=(z.modelValue||[]).slice(0,F.value.length),L.value=(z.modelValue||[]).slice(0,F.value.length)}),{immediate:!0,deep:!0}),l({rewrite:P,openSign:G}),(l,a)=>{var s,n;const b=V,k=u,j=t,A=C;return i(),o(h,null,[r("div",T,[v(l.$slots,"signImg",{data:(null==(s=c(L))?void 0:s[0])||(null==(n=c(I))?void 0:n[0])},(()=>{var l,a;return[c(I).length?(i(),o("img",{key:0,class:"preview-sign",src:(null==(l=c(L))?void 0:l[0])||(null==(a=c(I))?void 0:a[0]),alt:"",onClick:H},null,8,U)):d("",!0),g(b,{type:"primary",round:"",size:"small",onClick:G},{default:p((()=>[m(f(e.signString?"重新签名":"点击签字"),1)])),_:1})]}),!0)]),g(A,{show:c(D),"onUpdate:show":a[1]||(a[1]=e=>_(D)?D.value=e:null),position:"bottom",style:{height:"100%",overflow:"hidden"}},{default:p((()=>[r("div",x,[r("div",N,[g(j,{ref_key:"swipeRef",ref:$,vertical:"",loop:!1,"show-indicators":!1,touchable:!1},{default:p((()=>[(i(!0),o(h,null,S(c(F),((e,l)=>(i(),y(k,{key:l},{default:p((()=>[g(w,{ref_for:!0,ref_key:"signRef",ref:E,modelValue:c(I)[l],"onUpdate:modelValue":e=>c(I)[l]=e,placeholder:e,onStroke:a[0]||(a[0]=e=>O.value=!1),onSignSuccess:K},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1024)))),128))])),_:1},512),r("div",R,[g(b,{type:"primary",class:"btn",disabled:c(M),onClick:Q},{default:p((()=>[m("确定")])),_:1},8,["disabled"]),g(b,{type:"primary",plain:"",class:"btn",onClick:B},{default:p((()=>[m("上一页")])),_:1}),g(b,{type:"primary",plain:"",class:"btn",onClick:P},{default:p((()=>[m("重签")])),_:1}),g(b,{type:"default",class:"btn",onClick:J},{default:p((()=>[m("取消")])),_:1})])])])])),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-841501e8"]]);export{D as S};
