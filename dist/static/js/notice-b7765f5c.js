import{d as e,i as a,j as l,al as s,z as i,k as t,o as n,c as o,b as r,w as d,a as u,e as v,u as c,p as f,a6 as m,q as g,a8 as p,l as y,m as h,ah as w,ae as S,aE as k}from"./index-b7b909b3.js";import{u as b}from"./useAttachment-2805a913.js";import{S as E}from"./verify-9d4f0f48.js";const x={class:"com-sign-part"},C={class:"people"},V={class:"name"},Y={key:0,class:"verify-item"},I=u("div",{class:"label"},"证件号码",-1),N={class:"no"},P={class:"sign-status"},_=["src"],B={key:1,class:"sign-desc"},j={class:"sign-body"},D={class:"date"},R={class:"file"},T=e({name:"signPart"}),$=e({...T,props:{signString:{default:""},personalInfo:{default:()=>({})},fileList:null,title:{default:""},showSign:{type:Boolean,default:!1},showVerify:{type:Boolean,default:!1},showShareSign:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["handleVerify","handleSign"],setup(e,{expose:T,emit:$}){const A=e,F=a({}),L=a(""),M=a([]),U=a({});a(!0);const O=a(!1),q=a(0),{fileList:z}=b(U,M),G=e=>`${e}`===w.CERT,H=l((()=>s().format("YYYY-MM-DD"))),J=()=>{var e,a;$("handleVerify",null==(e=F.value)?void 0:e.name,null==(a=F.value)?void 0:a.certNo)},K=()=>{O.value=!1},Q=a(),W=()=>{Q.value&&(Q.value.rewrite(),Q.value.openSign())},X=()=>{A.disabled||Q.value&&Q.value.openSign()},Z=e=>{$("handleSign",e)};return T({validateSign:()=>new Promise(((e,a)=>{L.value?e(!0):a(new Error(`请${A.title}完成签名后，去支付`))})),validateVerify:()=>new Promise(((e,a)=>{var l;(null==(l=A.personalInfo)?void 0:l.isCert)!==m.YES?a(new Error(`请${A.title}完成认证后，去支付`)):e(!0)}))}),i((()=>A.signString),(()=>{L.value=A.signString}),{immediate:!0}),i((()=>A.personalInfo),(()=>{F.value=A.personalInfo}),{deep:!0,immediate:!0}),(a,l)=>{const s=S,i=k,w=t("AttachmentList"),b=t("FilePreview");return n(),o("div",x,[r(i,{title:e.title,class:"card"},{extra:d((()=>{var a,l,s,i;return[u("div",C,[u("div",V,v(null==(a=c(F))?void 0:a.name),1),e.showVerify&&G(null==(l=c(F))?void 0:l.certType)?(n(),o("div",{key:0,class:f(["status",{verified:(null==(s=c(F))?void 0:s.isCert)===c(m).YES}])},v((null==(i=c(F))?void 0:i.isCert)===c(m).YES?"已认证":"待认证"),3)):g("",!0)])]})),default:d((()=>{var a,l,i,t;return[e.showVerify&&(null==(a=c(F))?void 0:a.certNo)?(n(),o("div",Y,[I,u("div",N,v(null==(l=c(F))?void 0:l.certNo),1),(null==(i=c(F))?void 0:i.isCert)!==c(m).YES&&G(null==(t=c(F))?void 0:t.certType)?(n(),o("div",{key:0,class:"action",onClick:J},[p(" 去认证 "),r(s,{name:"right_arrow",class:"icon"})])):g("",!0)])):g("",!0)]})),_:1},8,["title"]),e.showSign?(n(),y(i,{key:0,title:`${e.title}签名`,"show-icon":!1,class:"sign-card","show-line":!1},{extra:d((()=>[u("div",P,[e.disabled?g("",!0):(n(),o("div",{key:0,class:"resign",onClick:W},"重签"))])])),default:d((()=>{var e;return[r(E,{ref_key:"signRef",ref:Q,modelValue:c(L),"onUpdate:modelValue":l[0]||(l[0]=e=>h(L)?L.value=e:null),class:"sign",onSubmitSign:Z},{signImg:d((({data:e})=>[u("div",{class:"sign-board",onClick:X},[e?(n(),o("img",{key:0,src:e,class:"sign-img",alt:""},null,8,_)):(n(),o("span",B,"请签名"))])])),_:1},8,["modelValue"]),u("div",j,[u("div",D,"签名日期： "+v(c(H)),1),u("div",R,[(null==(e=c(z))?void 0:e.length)?(n(),y(w,{key:0,"attachment-list":c(z),"pre-text":"签名将被用于以下文件：",onPreviewFile:l[1]||(l[1]=e=>(e=>{q.value=e,O.value=!0})(e))},null,8,["attachment-list"])):g("",!0)])])]})),_:1},8,["title"])):g("",!0),c(O)?(n(),y(b,{key:1,show:c(O),"onUpdate:show":l[2]||(l[2]=e=>h(O)?O.value=e:null),"content-list":c(z),"is-only-view":"","active-index":c(q),text:"关闭",onOnCloseFilePreviewByMask:K},null,8,["show","content-list","active-index"])):g("",!0)])}}}),A={HOlDER:1,INSURED:2,AGENT:3};export{A as N,$ as _};
