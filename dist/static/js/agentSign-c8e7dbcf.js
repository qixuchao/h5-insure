import{d as e,h as a,g as i,bx as s,bN as t,i as n,av as r,o,c as l,b as d,a as u,u as c,w as f,a8 as v,aB as p,T as g,aa as h,bK as m,am as y,a6 as b,b3 as j,aL as S,bO as I}from"./index-a3c15377.js";import{b as O}from"./product-596d65da.js";import{i as L,g as C}from"./trial-0f8ffd87.js";import{_ as E,N}from"./notice-6f7de747.js";import{u as T}from"./useOrder-c00b2635.js";import{M as D}from"./product-585b0e6f.js";import{s as _,a as V}from"./verify-c9f7aceb.js";import{t as R}from"./ProRenderFormWithCard.vue_vue_type_style_index_0_scoped_true_lang-42bf787b.js";/* empty css              */import"./useDicData-0f8b6ef2.js";import"./bankCard-7e0b096a.js";import{P as k,a as w}from"./constants-71331306.js";import"./useAttachment-ddb67dd7.js";import"./utils-68583e4a.js";import"./infoCollection-de566c01.js";import"./trial-ba75aeed.js";import"./merge-e7788e50.js";import"./keysIn-131bbce9.js";import"./isObjectLike-a9798079.js";import"./phoneVerify-0c603305.js";const x={class:"long-verify"},q={class:"header"},A={class:"verify-content"},G={class:"footer-button"},U=e({__name:"agentSign",setup(e){const U=a(),B=i(),{productCode:H="",tenantId:M,agentCode:P="",agencyCode:F,saleChannelId:z,saleUserId:$,orderNo:J,orderCode:K,extraInfo:W,isShare:Q,insurerCode:X,preview:Y}=U.query;let Z={};try{Z=JSON.parse(decodeURIComponent(W))}catch(fe){}const ee=T(),ae=`${window.origin}/baseInsurance/long/phoneVerify?${s.stringify({...U.query,orderNo:K||J})}`;new t({source:"localStorage"});const ie=n({}),se=n(),te=n(),ne=n(),re=n({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:""},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{}},agent:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:""}}),oe=n({}),le=n({}),de=n({sign:[],verify:[],scribing:""}),ue=()=>{if(Y)return void p(k.SIGN,U.query);const e=[];se.value&&de.value.sign.includes("1")&&e.push(se.value.validateSign()),te.value&&((Q?de.value.sign.includes("4"):de.value.sign.includes("2"))&&e.push(te.value.validateSign()),de.value.verify.includes("1")&&e.push(te.value.validateVerify())),ne.value&&((Q?de.value.sign.includes("5"):de.value.sign.includes("3"))&&e.push(...(ne.value||[]).map((e=>e.validateSign()))),de.value.verify.includes("2")&&e.push(...(ne.value||[]).map((e=>e.validateVerify())))),Promise.all(e).then((e=>{V({bizObjectId:[],bizObjectType:3,orderId:ee.value.id,tenantId:M}).then((({code:e,data:a})=>{"10000"===e&&a&&B.push({path:w.sign,query:U.query})}))})).catch((e=>{g(e.message)}))};n();n({imgUrl:"",desc:"",title:"",link:ae});const ce=()=>{O({productCode:H}).then((({code:e,data:a})=>{var i;if("10000"===e){const{productMaterialMap:e}=(null==(i=a.productInsureMaterialVOList)?void 0:i[0])||{};(Object.values(e||{})||[]).flat().filter((e=>e.materialType===D.SIGN)).forEach((e=>{e.noticeObject===N.AGENT?re.value.agent.fileList.push(e):e.noticeObject===N.HOlDER?re.value.holder.fileList.push(e):e.noticeObject===N.INSURED&&re.value.insured.fileList.push(e)}))}})),L({productCode:H,isTenant:!Y}).then((({data:e,code:a})=>{var i;if("10000"===a){ie.value=e;const{productFactor:a}=(null==(i=e.productPlanInsureVOList)?void 0:i[0])||{},{signInfo:s}=R(a);s.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((a=>{e.required&&de.value.sign.push(a.code),"1"===a.code?re.value.agent.isSign=!0:"2"===a.code?re.value.holder.isSign=!0:"3"===a.code?re.value.insured.isSign=!0:"4"===a.code?re.value.holder.isShareSign=!0:"5"===a.code&&(re.value.insured.isShareSign=!0)})),"riskNotificationCopy"===e.name&&(oe.value.text=e.remark,de.value.scribing=e.required,e.columns.forEach((e=>{"1"===e.code?oe.value.type="handle":oe.value.type="auto"}))),"customerFace"===e.name&&e.columns.forEach((a=>{e.required&&de.value.verify.push(a.code),"1"===a.code?re.value.holder.isVerify=!0:"2"===a.code&&(re.value.insured.isVerify=!0)}))}))}})),((e=!1)=>{J&&C({orderNo:K||J,tenantId:M}).then((({code:a,data:i})=>{var s,t,n,r,o;"10000"===a&&(e&&((null==(s=null==i?void 0:i.holder)?void 0:s.isCert)===b.NO||(null==i?void 0:i.insuredList.some((e=>e.isCert===b.NO)))?g("用户未完身份认证及签字"):(null==i?void 0:i.tenantOrderAttachmentList.find((e=>e.category===j.ELECTRIC_SIGN&&e.objectType===S.HOLDER)))&&(null==i?void 0:i.tenantOrderAttachmentList.find((e=>e.category===j.ELECTRIC_SIGN&&e.objectType===S.INSURED)))||g("用户未完身份认证及签字")),Object.assign(ee.value,i),re.value.holder.personalInfo=i.holder,re.value.insured.personalInfo=i.insuredList,Object.assign(le.value,{type:I[i.extInfo.transcriptionType],signInfo:null==(n=null==(t=i.riskTranscriptionList)?void 0:t[0])?void 0:n.uri,text:null==(o=null==(r=i.riskTranscriptionList)?void 0:r[0])?void 0:o.content,status:!!i.extInfo.transcriptionStatus}),i.tenantOrderAttachmentList.forEach((e=>{e.objectType===N.HOlDER?re.value.holder.signData=e.fileBase64:e.objectType===N.AGENT?re.value.agent.signData=e.fileBase64:e.objectType===N.INSURED&&(re.value.insured.signData[e.objectId]=e.fileBase64)})))}))})()};return r((()=>{ce()})),(e,a)=>{const i=h,s=m,t=y;return o(),l("div",x,[d(i),u("div",q,[d(s,{type:"warning",title:"尊敬的客户，本次投保需要进行身份认证",content:"本产品投保需要对投保人、被保人进行实名认证，您购买本产品的累计总保费已超过20万，按监管要求，需要提供投保人、被保人、指定受益人证件影像，本产品非本人投保且带身故责任、需对投保人、被保人（成人）的投保意愿进行签字确认。"})]),u("div",A,[d(E,{ref_key:"agentSignRef",ref:se,"order-detail":c(ee),"sign-string":c(re).agent.signData,"show-sign":c(re).agent.isSign,"show-verify":c(re).agent.isVerify,"file-list":c(re).agent.fileList,"personal-info":c(re).agent.personalInfo,disabled:!!c(Q),title:"代理人",onHandleSign:a[0]||(a[0]=e=>((e,a,i)=>{var s;_(e,a,null==(s=ee.value)?void 0:s.id,M,i)})("AGENT",e))},null,8,["order-detail","sign-string","show-sign","show-verify","file-list","personal-info","disabled"])]),u("div",G,[d(t,{type:"primary",onClick:ue},{default:f((()=>[v("确定")])),_:1})])])}}});export{U as default};
