import{t as $}from"./theme-3c294048.js";import{h as A,r as n,A as _,$ as x,k as u,m as d,n as i,p as f,t as I,x as L,B as h,C as s,G as k,L as R}from"./vendor-dfbc3b9e.js";const U={class:"item"},E={class:"footer"},O=A({props:{show:{type:Boolean,default:!1},contentList:{type:Array,default:()=>[]},activeIndex:{type:Number,default:0},text:{type:String,default:""},beforeReadOverText:{type:String,default:"\u540C\u610F\uFF0C\u4E0B\u4E00\u6761"},forceReadCound:{type:Number,default:0}},emits:["update:show","submit","onCloseFilePreview"],setup(p,{emit:m}){const t=p,c=n(t.show),l=n(t.contentList.map((e,o)=>({...e,disabled:!0,readDisabled:!0}))),a=n(t.activeIndex),v=n(0),b=n(null),w=_(()=>{var e,o;return(o=(e=l.value)==null?void 0:e[a.value])==null?void 0:o.attachmentUri}),C=_(()=>{var e;return(e=l.value[a.value])==null?void 0:e.readDisabled}),P=_(()=>a.value>=t.forceReadCound-1||v.value>=t.forceReadCound?!1:v.value<t.forceReadCound?a.value!==t.forceReadCound-1:!1),B=()=>{a.value+=1},F=()=>{m("update:show",!1),m("submit")};x(()=>t,()=>{c.value=t.show,a.value=t.activeIndex},{deep:!0,immediate:!0});const N=e=>{e&&Math.floor(e.target.scrollHeight-e.target.scrollTop)===e.target.clientHeight&&l.value[a.value].readDisabled&&(l.value[a.value].disabled=!1,l.value[a.value].readDisabled=!1,l.value[a.value+1].disabled=!1,v.value+=1)};return x(()=>a.value,()=>{t.show&&(v.value>=t.forceReadCound&&l.value.forEach(e=>{e.disabled=!1,e.readDisabled=!1}),b.value&&(b.value.scrollTop=0))},{immediate:!0}),(e,o)=>{const D=u("ProTab"),T=u("ProFilePreview"),y=u("VanButton"),V=u("van-config-provider"),S=u("ProPopup");return d(),i(S,{show:c.value,"onUpdate:show":o[1]||(o[1]=r=>c.value=r),class:"file-preview-popup-wrap",closeable:!1,onClose:o[2]||(o[2]=r=>m("onCloseFilePreview"))},{default:f(()=>[I(V,{"theme-vars":s($),class:"custom-provider"},{default:f(()=>[c.value?(d(),i(D,{key:0,active:a.value,"onUpdate:active":o[0]||(o[0]=r=>a.value=r),list:l.value.map((r,g)=>({title:r.attachmentName,disabled:g==a.value?!1:r.disabled||!1,slotName:`guarantee-${g}`})),class:"tab"},null,8,["active","list"])):L("",!0),h("div",{ref_key:"previewRef",ref:b,class:"list",onScroll:N},[h("div",U,[(d(),i(T,{key:s(w),content:s(w),type:"pdf","forbid-click":!0},null,8,["content"]))])],544),h("div",E,[s(P)?(d(),i(y,{key:0,disabled:s(C),type:"primary",block:"",round:"",onClick:B},{default:f(()=>[k(R(`${p.beforeReadOverText}(${a.value+1}/${p.forceReadCound})`),1)]),_:1},8,["disabled"])):(d(),i(y,{key:1,disabled:s(C),type:"primary",block:"",round:"",onClick:F},{default:f(()=>[k(R(t.text),1)]),_:1},8,["disabled"]))])]),_:1},8,["theme-vars"])]),_:1},8,["show"])}}});export{O as _};
