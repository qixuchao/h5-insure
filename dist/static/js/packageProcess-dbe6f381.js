var la=Object.defineProperty,ia=Object.defineProperties;var ca=Object.getOwnPropertyDescriptors;var Ee=Object.getOwnPropertySymbols;var da=Object.prototype.hasOwnProperty,ma=Object.prototype.propertyIsEnumerable;var ge=(D,d,v)=>d in D?la(D,d,{enumerable:!0,configurable:!0,writable:!0,value:v}):D[d]=v,b=(D,d)=>{for(var v in d||(d={}))da.call(d,v)&&ge(D,v,d[v]);if(Ee)for(var v of Ee(d))ma.call(d,v)&&ge(D,v,d[v]);return D},R=(D,d)=>ia(D,ca(d));import{g as fa,a9 as pa,O as va,E as c,M as De,y as Ce,_ as Ne,l as ha,h as ya,r as j,af as Fa,j as k,n as X,p as C,m as Q,H as Ea,t as Z,z as q,A as f,J as Y,k as ee,C as be,F as ga,T as p,D as Da,X as Ca}from"./vendor-17026bfd.js";import{_ as Na,C as Ie,a1 as Ia,I as _a,a4 as _e,J as Be}from"./index-726551f2.js";import{a as ae}from"./order-b6be14b9.js";import{S as $,R as I,f as we,I as te}from"./infoCollection-37ae7221.js";import{p as Ae,i as Ba,u as wa,a as Aa,s as ka,g as Ta}from"./trial-87c757e9.js";import{p as Pa}from"./product-9d96312e.js";import{a as ke,o as Te,t as Sa,v as re,g as Pe,b as Ua,j as Se}from"./utils-916c4264.js";import{t as Oa}from"./theme-ea709837.js";import{d as Ue,B as ba,D as Ra,G as La,S as Ha,H as xa,P as Ma,U as Va,_ as qa,W as Ya,a as Oe}from"./auth-e0f88df4.js";import{_ as $a}from"./index-25d55b40.js";import"./trial-911936f9.js";import"./index-480841ed.js";import"./bankCard-b6d32d98.js";import"./phoneVerify-83a5dcb9.js";const Ka={key:0},Wa={class:"page-internet-product-detail"},za={class:"info"},Ga={class:"footer-button"},Ja={class:"price"},ja=be(" \u603B\u4FDD\u8D39"),Xa={key:0},Qa=fa({setup(D){const d=pa(),v=va(),{productCode:oe="BWYL2021",tenantId:E,orderNo:_,phoneNo:Re,agentCode:L="",saleChannelId:Le,paymentMethod:He,certNo:ue,name:ne,pageCode:xe,from:Me}=v.query,se=c(),m=c(),H=c(),h=c(),K=xe==="payBack";c(!1);const B=c(!1),N=c(!1),le=c(0),W=c(!1),z=c(!1),x=c({show:!1,html:""}),T=c({}),ie=c(),G=c(!1);let J="";const e=De({holder:{certNo:ue,certType:Ie.CERT,mobile:Re,name:ne,socialFlag:$.HAS},insured:{certNo:ue,certType:Ie.CERT,name:ne,socialFlag:$.HAS,relationToHolder:I.SELF},paymentMethod:He,renewalDK:"Y",paymentFrequency:we.YEAR,packageProductList:[],mobileSmsCode:""}),ce=c(Ue),P=c(Ue),i=De({showInsure:!K,canInsure:!1,canUpgrade:!1}),Ve=Ce(()=>{var t,a;return((a=(t=m.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:a.attachmentVOList.filter(r=>r.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),qe=Ce(()=>{var t,a;return((a=(t=m.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:a.attachmentVOList.filter(r=>r.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),Ye=()=>{if(e.holder.certNo){const t=Be(e.holder.certNo);if(re(e.holder.certNo,18,"year"))return p("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E18\u5C81\uFF01"),!1;if(e.insured.certNo&&e.insured.relationToHolder===I.MATE){const a=Be(e.insured.certNo);if(t===a)return p("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(e.insured.certNo){if(e.insured.relationToHolder===I.CHILD&&re(e.insured.certNo,30,"day"))return p("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(e.insured.relationToHolder===I.PARENT&&!re(e.insured.certNo,71,"year"))return p("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E70\u5C81\uFF01"),!1}if([I.CHILD,I.PARENT].includes(e.insured.relationToHolder)){const t=Pe(e.holder.certNo,"year"),a=Pe(e.insured.certNo,"year");if(e.insured.relationToHolder===I.CHILD&&t-a<18)return p("\u6295\u4FDD\u4EBA\u548C\u5B50\u5973\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1;if(e.insured.relationToHolder===I.PARENT&&a-t<18)return p("\u6295\u4FDD\u4EBA\u548C\u7236\u6BCD\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1}return!0},$e=()=>{const{holder:{certNo:t,mobile:a,name:r,socialFlag:u},insured:{certNo:o,name:n,socialFlag:s,relationToHolder:y},paymentMethod:F}=e;return!!(_a(o)&&!!s)},de=()=>{d.push({path:"/internet/guaranteeUpgrade",query:R(b({},v.query),{tenantId:E,productCode:"BWYL2022",orderNo:_,agentCode:L})})},Ke=()=>{z.value=!1},We=()=>{P.value=ce.value},ze=()=>{P.value=R(b({},P.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},Ge=async t=>{p.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0,duration:0});try{const a=await wa(t),{code:r}=a;if(r==="10000"){const u=await Aa({orderNo:t.orderNo,tenantId:E}),{data:o}=u;u.code==="10000"&&(o.type===2?(x.value={show:!0,html:o.paymentUrl},console.log("data.paymentUrl",x.value),Ca(()=>{console.log("document.forms",document.forms);const n=document.getElementById("cashierSubmit");n==null||n.addEventListener("submit",s=>{s.preventDefault()}),n==null||n.submit()})):window.location.href=o.paymentUrl)}i.canInsure=!0}catch{i.canInsure=!0}finally{p.clear()}},Je=t=>`${_e}/pay?orderNo=${t}&saleUserId=${L}&tenantId=${E}`,je=t=>`${_e}/internet/payFail?tenantId=${E}&orderNo=${t}&agentCode=${L}&pageCode=payBack&from=${Me||"normal"}`,Xe=t=>{le.value=t,N.value=!0},Qe=async t=>{const a=Ua({tenantId:E,saleUserId:L,saleChannelId:Le,detail:m.value,insureDetail:H.value,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,renewalDK:e.renewalDK,iseeBizNo:J,successJumpUrl:"",premium:h.value,holder:e.holder,insured:e.insured,tenantOrderRiskList:t,orderStatus:"",orderTopStatus:"",orderNo:_,originOrderIds:ie.value});try{const r=await ka(a),{code:u,data:o}=r;N.value=!1,B.value=!1,u==="10000"&&(p.clear(),delete a.id,T.value={orderNo:o.data,order:a},N.value=!0,Xe(0))}catch{p.clear(),i.canInsure=!0}},Ze=async()=>{const{calcData:t,riskVOList:a}=ke({holder:e.holder,insured:e.insured,tenantId:E,productDetail:m.value,insureDetail:H.value,paymentFrequency:e.paymentFrequency,packageRiskIdList:Te(e.packageProductList)},!1,Se);if(!Array.isArray(a)||a.length<1)return p("\u88AB\u4FDD\u4EBA\u5E74\u9F84\u9700\u572830\u5929(\u542B) - 70\u5C81(\u542B)\u4E4B\u95F4\uFF01"),h.value=null,{};G.value=!0;const r=await Ae(t);G.value=!1;const{code:u,data:o}=r;return u==="10000"?e.insured.certNo?(h.value=o.premium,{condition:a,data:o}):(h.value=null,{condition:a,data:o}):(h.value=null,{})},ea=()=>new Promise((t,a)=>{var r,u;(u=(r=se.value)==null?void 0:r.validateForm)==null||u.call(r).then(async()=>{if(!Ye()){i.canInsure=!0;return}const{calcData:o,riskVOList:n}=ke({holder:e.holder,insured:e.insured,tenantId:E,productDetail:m.value,insureDetail:H.value,paymentFrequency:e.paymentFrequency,packageRiskIdList:Te(e.packageProductList)},!1,Se);(!Array.isArray(n)||n.length<1)&&(p("\u88AB\u4FDD\u4EBA\u5E74\u9F84\u9700\u572830\u5929(\u542B) - 70\u5C81(\u542B)\u4E4B\u95F4\uFF01"),h.value=null,a(new Error));const s=await Ae(o),{code:y,data:F}=s;y==="10000"?(h.value=F.premium,t({condition:n,data:F})):(h.value=null,a(new Error))}).catch(()=>{i.canInsure=!0})}),aa=async()=>{var t;if(K){de();return}try{p.loading({message:"\u8BA2\u5355\u751F\u6210\u4E2D...",forbidClick:!0,duration:0});const{condition:a,data:r}=await ea(),u={},o=(s=[])=>{(s||[]).forEach(y=>{var F;u[y.riskCode]=y,((F=y.riskPremiumDetailVOList)==null?void 0:F.length)&&o(y.riskPremiumDetailVOList)})};o(r.riskPremiumDetailVOList);const n=Sa({tenantId:E,riskList:a,riskPremium:u,productId:(t=m.value)==null?void 0:t.id});Qe(n)}catch{i.canInsure=!0}finally{p.clear()}},ta=t=>{t==="allFalse"?(B.value=!1,i.canInsure=!0,Ge(R(b({},T.value.order),{orderNo:T.value.orderNo,extInfo:{extraInfo:{renewalDK:e.renewalDK,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,successJumpUrl:Je(T.value.orderNo),failUrl:je(T.value.orderNo)},iseeBizNo:J}}))):Da.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"}).then(()=>{window.history.back()}).catch(()=>{i.canInsure=!0})},me=()=>{N.value=!1,B.value=!1,i.canInsure=!0},ra=()=>{N.value=!1,B.value=!0};Ne([()=>e.insured.certNo,()=>e.insured.socialFlag,()=>e.packageProductList,()=>e.paymentFrequency],ha.exports.debounce(()=>{e.insured.certNo&&e.insured.socialFlag&&$e()&&Ze()},500),{deep:!0,immediate:!0}),Ne(()=>e.insured.certNo,()=>{e.insured.certNo||(h.value=null)});const fe=async()=>{var u,o,n,s,y,F,w,S,U,O,pe,ve,he,ye,Fe;const t=await Ta({orderNo:_,tenantId:E}),{code:a,data:r}=t;if(a==="10000"){const{id:na,tenantOrderHolder:g,tenantOrderInsuredList:l,extInfo:A}=r;if(!K){ie.value={id:na,holderId:g==null?void 0:g.id,insuredId:l==null?void 0:l[0].id};const sa=(((o=(u=l[0])==null?void 0:u.tenantOrderProductList[0])==null?void 0:o.tenantOrderRiskList)||[]).map(M=>{var V;return((V=M.extInfo)==null?void 0:V.riskId)||""});e.packageProductList.forEach(M=>{M.value=M.productRiskVoList.filter(V=>sa.includes(V.id)).length>0?te.INSURE:te.UN_INSURE}),Object.assign(e,{holder:{certNo:g.certNo,certType:g.certType,mobile:g.mobile,name:g.name,socialFlag:$.HAS},insured:{certNo:l==null?void 0:l[0].certNo,certType:(n=l[0])==null?void 0:n.certType,name:(s=l[0])==null?void 0:s.name,socialFlag:(F=(y=l[0])==null?void 0:y.extInfo)==null?void 0:F.hasSocialInsurance,relationToHolder:(w=l[0])==null?void 0:w.relationToHolder},paymentMethod:A.extraInfo.paymentMethod,paymentFrequency:A.extraInfo.paymentFrequency,renewalDK:A.extraInfo.renewalDK||"N"}),i.canInsure=!0;return}Object.assign(e,{holder:{certNo:g.certNo,certType:g.certType,mobile:g.mobile,name:g.name,socialFlag:$.HAS},insured:{certNo:l==null?void 0:l[0].certNo,certType:(S=l[0])==null?void 0:S.certType,name:(U=l[0])==null?void 0:U.name,socialFlag:(pe=(O=l[0])==null?void 0:O.extInfo)==null?void 0:pe.hasSocialInsurance,relationToHolder:(ve=l[0])==null?void 0:ve.relationToHolder},paymentMethod:A.extraInfo.paymentMethod,paymentFrequency:A.extraInfo.paymentFrequency,renewalDK:A.extraInfo.renewalDK||"N"}),h.value=(Fe=(ye=(he=l[0])==null?void 0:he.tenantOrderProductList)==null?void 0:ye[0])==null?void 0:Fe.premium,(r.orderStatus===ae.ACCEPT_POLICY||r.orderStatus===ae.PAYMENT_SUCCESS)&&(i.canUpgrade=!0,W.value=!1,z.value=!0),r.orderStatus===ae.PAYING&&(W.value=!0,setTimeout(()=>{fe()},3*1e3))}},oa=async()=>{const t=Pa({productCode:oe,withInsureInfo:!0,tenantId:E}),a=Ba({productCode:oe});await Promise.all([t,a]).then(([r,u])=>{var o,n;r.code==="10000"&&(m.value=r.data,document.title=((o=r.data)==null?void 0:o.productFullName)||""),u.code==="10000"&&(e.packageProductList=(((n=u.data)==null?void 0:n.packageProductVOList)||[]).map(s=>R(b({},s),{value:te.UN_INSURE,disabled:!1})),H.value=u.data)}),_&&fe()},ua=()=>{console.log("\u6295\u4FDD\u94FE\u63A5"),P.value=Oe,ce.value=Oe,i.canInsure=!0};return ya(()=>{ua(),oa(),setTimeout(async()=>{J=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(t,a)=>{const r=j("van-loading"),u=j("van-button"),o=j("van-config-provider"),n=Fa("dompurify-html");return k(),X(ga,null,[C(o,{"theme-vars":f(Oa)},{default:Q(()=>{var s,y,F,w,S,U,O;return[x.value.show?Ea((k(),X("div",Ka,null,512)),[[n,x.value.html]]):Z("",!0),q("div",Wa,[q("div",za,[C(ba,{url:(y=(s=m.value)==null?void 0:s.tenantProductInsureVO)==null?void 0:y.banner[0]},null,8,["url"]),C(Ra,{"product-name":(F=m.value)==null?void 0:F.productFullName,"product-desc":(S=(w=m.value)==null?void 0:w.showConfigVO)==null?void 0:S.desc},null,8,["product-name","product-desc"])]),C(La,{"show-service-config":"","guarantee-list":(O=(U=m.value)==null?void 0:U.tenantProductInsureVO)==null?void 0:O.titleAndDescVOS},null,8,["guarantee-list"]),C(Ha,{detail:m.value},{form:Q(()=>[C(xa,{ref_key:"formRef",ref:se,"is-show-package":"",disable:!f(i).showInsure,"form-auth":P.value,"form-info":f(e),"product-detail":m.value,onOnReset:We,onOnUpdate:ze},null,8,["disable","form-auth","form-info","product-detail"])]),_:1},8,["detail"]),q("div",Ga,[q("div",Ja,[ja,G.value?(k(),ee(r,{key:1,class:"premium-loading",type:"spinner"})):(k(),X("span",Xa,Y(h.value?"\uFFE5":"")+Y(f(Ia)(h.value))+" "+Y(h.value?f(e).paymentFrequency==f(we).YEAR?"\u5143/\u5E74":"\u5143/\u6708":""),1))]),C(u,{type:"primary",class:"right",disabled:!(f(i).canInsure||f(i).canUpgrade),onClick:aa},{default:Q(()=>[be(Y(f(i).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),f(_)?Z("",!0):(k(),ee(Ma,{key:1,"product-detail":m.value},null,8,["product-detail"])),C(Va,{"order-no":f(_),"tenant-id":f(E),"is-show":z.value,onOnConfirm:de,onOnClose:Ke},null,8,["order-no","tenant-id","is-show"])]}),_:1},8,["theme-vars"]),C(qa,{show:B.value,"onUpdate:show":a[0]||(a[0]=s=>B.value=s),"content-list":f(Ve),"active-index":0,onOnConfirmHealth:ta,onOnCloseHealth:me},null,8,["show","content-list"]),N.value?(k(),ee($a,{key:0,show:N.value,"onUpdate:show":a[1]||(a[1]=s=>N.value=s),"content-list":f(qe),"active-index":le.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9","force-read-cound":2,"on-close-file-preview":"",onSubmit:ra,onOnCloseFilePreview:me},null,8,["show","content-list","active-index"])):Z("",!0),C(Ya,{"is-show":W.value},null,8,["is-show"])],64)}}});var pt=Na(Qa,[["__scopeId","data-v-7a87a4c2"]]);export{pt as default};
