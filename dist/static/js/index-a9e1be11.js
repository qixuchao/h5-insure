var he=Object.defineProperty,Te=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var ee=Object.getOwnPropertySymbols;var Ne=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable;var te=(c,r,B)=>r in c?he(c,r,{enumerable:!0,configurable:!0,writable:!0,value:B}):c[r]=B,F=(c,r)=>{for(var B in r||(r={}))Ne.call(r,B)&&te(c,B,r[B]);if(ee)for(var B of ee(r))Re.call(r,B)&&te(c,B,r[B]);return c},N=(c,r)=>Te(c,ge(r));import{g as Oe,O as Se,a9 as Ie,E as _,d as Le,y as ke,h as be,r as J,j as f,k as w,m as v,z as d,p as A,J as H,n as L,L as xe,t as U,A as k,G as ue,F as se,a4 as Pe,a5 as we,C as j,T as R,D as He}from"./vendor-af6fda0a.js";import{q as Ue}from"./index-a99815ab.js";import{_ as Me,S as je,L as $e,M as qe,q as oe,l as ae,Q as Ve,r as ne,H as Qe,n as Ye,P as Ge,R as z,T as M,B as Je}from"./index-11a17244.js";import{_ as ze}from"./index-aad4373c.js";import{f as We,s as re,g as ie,a as Ke}from"./verify-5e0c41ea.js";import{a as Xe}from"./order-35b0e3c5.js";import{l as le,g as Ze}from"./inform-ec8d9721.js";const ce=c=>(Pe("data-v-5fe4c6ba"),c=c(),we(),c),et={class:"page-verify"},tt={class:"people"},ut={class:"name"},st={class:"verify-item"},ot=ce(()=>d("div",{class:"label"},"\u8BC1\u4EF6\u53F7\u7801",-1)),at={class:"no"},nt=j(" \u53BB\u8BA4\u8BC1 "),rt={class:"sign-body"},it={class:"date"},lt={class:"file"},ct=j(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A "),dt={class:"footer-button footer"},Bt=ce(()=>d("div",{class:"text"},"\u5237\u65B0",-1)),Ct=j("\u5206\u4EAB"),Et=j("\u63D0\u4EA4"),ft=Oe({setup(c){const r={CERT:1,NO_CERT:2},B=Se(),de=Ie(),$=(()=>{const u=B.query;return u.orderCode&&(u.orderNo=u.orderCode,delete u.orderCode),u})(),{saleUserId:q="D1234567-1",tenantId:C="9991000007",templateId:Be=1,productCode:Ce="CQ75CQ76",insurerCode:V="ancheng",isShare:Q,orderCode:O,orderNo:y,productCategory:W}=$,Y=new je({source:"localStorage"}),Ee=_([]),K=_([]),fe=_([]),X=_([]),i=_(),T=_(),b=[],S=_(""),x=_(),De=Le().format("YYYY-MM-DD"),pe=()=>{var u;(u=T.value)==null||u.clear()},Z=(u,n)=>{let s=window.location.href;s=s.includes("orderCode")?s:s.replace("orderNo","orderCode"),Ke({callbackUrl:s,certiNo:u,faceAuthMode:"TENCENT",userName:n,tenantId:9991000007}).then(e=>{const{code:l,data:o}=e;if(l==="10000"){const{originalUrl:t,serialNo:a}=o;window.location.href=t,Y.set("verifyData",{serialNo:a,certNo:u,name:n})}})},Fe=u=>{const{id:n,objectType:s}=u;S.value="",x.value="";const e={1:"pdf",2:"richText",3:"link"};Ze({insurerCode:V,id:n,objectType:s,productCategory:W,orderNo:y,tenantId:C}).then(({code:l,data:o})=>{if(l==="10000"){const{textType:t,content:a,questionType:E}=(o==null?void 0:o[0])||{};E===2?(S.value="question",x.value=o):(t===1&&a.includes("png")?S.value="picture":S.value=e[t],x.value=a)}})},P=u=>`${u}`===qe.CERT,_e=u=>{var n,s,e,l;u===-1?Z((n=i.value.tenantOrderHolder)==null?void 0:n.certNo,(s=i.value.tenantOrderHolder)==null?void 0:s.name):Z((e=i.value.tenantOrderInsuredList[u])==null?void 0:e.certNo,(l=i.value.tenantOrderInsuredList[u])==null?void 0:l.name)},ve=()=>{var n,s,e,l,o;if((n=T.value)==null?void 0:n.isEmpty()){R.fail("\u8BF7\u6295\u4FDD\u4EBA\u7B7E\u540D");return}if(b.some(t=>t.isEmpty())){R.fail("\u8BF7\u88AB\u4FDD\u4EBA\u7B7E\u540D");return}if(((e=(s=i.value.tenantOrderHolder)==null?void 0:s.extInfo)==null?void 0:e.isCert)!==r.CERT&&P((l=i.value.tenantOrderHolder)==null?void 0:l.certType)){R.fail("\u8BF7\u6295\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}if((o=i.value.tenantOrderInsuredList)==null?void 0:o.some(t=>{var a;return((a=t.extInfo)==null?void 0:a.isCert)!==r.CERT&&P(t.certType)})){R.fail("\u8BF7\u88AB\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}ne({orderNo:O||y,saleUserId:q,tenantId:C}).then(t=>{const{code:a,data:E}=t;a==="10000"&&(E.orderStatus!==Xe.PENDING?Qe("paymentResult",$):He.confirm({title:"\u63D0\u793A",message:"\u8BF7\u786E\u8BA4\u4FE1\u606F\u586B\u5199\u65E0\u8BEF\u540E\uFF0C\u518D\u8FDB\u884C\u652F\u4ED8"}).then(()=>{var D,p;const m=(D=T.value)==null?void 0:D.save();Promise.all([re("HOLDER",m,(p=i.value)==null?void 0:p.id,`${C}`),...b.map(h=>{var g;return re("INSURED",h.save(),(g=i.value)==null?void 0:g.id,`${C}`)})]).then(()=>{Ye(N(F({},i.value),{pageCode:"sign",operateOption:{withSignInfo:!0},extInfo:N(F({},i.value.extInfo),{pageCode:"sign",templateId:Be,shareFlag:Q?"Y":"N"}),venderCode:V})).then(h=>{const{code:g,data:I}=h;a==="10000"&&I.success&&de.push({path:Ge[I.pageAction.data.nextPageCode],query:{orderNo:O||y,saleUserId:q,tenantId:C}})})})}))})},G=(u=!1)=>{ne({orderNo:O||y,saleUserId:q,tenantId:C}).then(n=>{var l,o;const{code:s,data:e}=n;s==="10000"&&(i.value=e,u&&(((o=(l=e==null?void 0:e.tenantOrderHolder)==null?void 0:l.extInfo)==null?void 0:o.isCert)===r.NO_CERT||(e==null?void 0:e.tenantOrderInsuredList.some(t=>{var a;return((a=t.extInfo)==null?void 0:a.isCert)===r.NO_CERT}))?R("\u7528\u6237\u672A\u5B8C\u8EAB\u4EFD\u8BA4\u8BC1\u53CA\u7B7E\u5B57"):(!(e==null?void 0:e.tenantOrderAttachmentList.find(t=>t.category===z.ELECTRIC_SIGN&&t.objectType===M.HOLDER))||!(e==null?void 0:e.tenantOrderAttachmentList.find(t=>t.category===z.ELECTRIC_SIGN&&t.objectType===M.INSURED)))&&R("\u7528\u6237\u672A\u5B8C\u8EAB\u4EFD\u8BA4\u8BC1\u53CA\u7B7E\u5B57")),setTimeout(()=>{let t=0;e.tenantOrderAttachmentList.forEach(a=>{a.category===z.ELECTRIC_SIGN&&(a.objectType===M.HOLDER?(T.value.clear(),T.value.setDataURL(a.fileBase64)):a.objectType===M.INSURED&&(b[t].clear(),b[t].setDataURL(a.fileBase64),t+=1))})}))})},Ae=()=>{G(!0)},ye=ke(()=>{const u=N(F({},$),{isShare:1,sharePageCode:"sign"});return`${window.location.origin}/phoneVerify?${Ue.stringify(u)}`}),me=()=>{const u={orderNo:O||y,productCode:Ce,tenantId:C,objectType:1},n={insurerCode:V,orderNo:y,productCategory:W,tenantId:C,noticeType:4,objectType:1};ie(F({},u)).then(({code:s,data:e})=>{s==="10000"&&(K.value=e||[])}),ie(N(F({},u),{objectType:2})).then(({code:s,data:e})=>{s==="10000"&&(Ee.value=e||[])}),le(F({},n)).then(({code:s,data:e})=>{s==="10000"&&(X.value=e||[])}),le(N(F({},n),{noticeType:5,objectType:2})).then(({code:s,data:e})=>{s==="10000"&&(fe.value=e||[])})};return be(()=>{G(),me();const u=Y.get("verifyData");if(u){const{serialNo:n,certNo:s,name:e}=u;We({certiNo:s,orderNo:O||y,serialNo:n,tenantId:C,userName:e}).then(l=>{const{code:o,data:t}=l;o==="10000"&&(Y.remove("verifyData"),G())})}}),(u,n)=>{const s=J("ProPDFviewer"),e=J("van-button"),l=J("ProPageWrap");return f(),w(l,null,{default:v(()=>[d("div",et,[A($e,{type:"warning",title:"\u5C0A\u656C\u7684\u5BA2\u6237\uFF0C\u672C\u6B21\u6295\u4FDD\u9700\u8981\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",content:"\u672C\u4EA7\u54C1\u6295\u4FDD\u9700\u8981\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u8FDB\u884C\u5B9E\u540D\u8BA4\u8BC1\uFF0C\u60A8\u8D2D\u4E70\u672C\u4EA7\u54C1\u7684\u7D2F\u8BA1\u603B\u4FDD\u8D39\u5DF2\u8D85\u8FC720\u4E07\uFF0C\u6309\u76D1\u7BA1\u8981\u6C42\uFF0C\u9700\u8981\u63D0\u4F9B\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u3001\u6307\u5B9A\u53D7\u76CA\u4EBA\u8BC1\u4EF6\u5F71\u50CF\uFF0C\u672C\u4EA7\u54C1\u975E\u672C\u4EBA\u6295\u4FDD\u4E14\u5E26\u8EAB\u6545\u8D23\u4EFB\u3001\u9700\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\uFF08\u6210\u4EBA\uFF09\u7684\u6295\u4FDD\u610F\u613F\u8FDB\u884C\u7B7E\u5B57\u786E\u8BA4\u3002"}),A(ae,{title:"\u6295\u4FDD\u4EBA",class:"card"},{extra:v(()=>{var o,t,a,E,m,D,p,h,g,I;return[d("div",tt,[d("div",ut,H((t=(o=i.value)==null?void 0:o.tenantOrderHolder)==null?void 0:t.name),1),P((E=(a=i.value)==null?void 0:a.tenantOrderHolder)==null?void 0:E.certType)?(f(),L("div",{key:0,class:xe(["status",{verified:((p=(D=(m=i.value)==null?void 0:m.tenantOrderHolder)==null?void 0:D.extInfo)==null?void 0:p.isCert)===r.CERT}])},H(((I=(g=(h=i.value)==null?void 0:h.tenantOrderHolder)==null?void 0:g.extInfo)==null?void 0:I.isCert)===r.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)):U("",!0)])]}),default:v(()=>{var o,t,a,E,m,D,p;return[d("div",st,[ot,d("div",at,H((t=(o=i.value)==null?void 0:o.tenantOrderHolder)==null?void 0:t.certNo),1),((m=(E=(a=i.value)==null?void 0:a.tenantOrderHolder)==null?void 0:E.extInfo)==null?void 0:m.isCert)!==r.CERT&&P((p=(D=i.value)==null?void 0:D.tenantOrderHolder)==null?void 0:p.certType)?(f(),L("div",{key:0,class:"action",onClick:n[0]||(n[0]=h=>_e(-1))},[nt,A(oe,{name:"right_arrow",class:"icon"})])):U("",!0)])]}),_:1}),A(ae,{title:"\u6295\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:v(()=>[d("div",{class:"resign",onClick:pe},"\u91CD\u7B7E")]),default:v(()=>[A(Ve,{ref_key:"holderSign",ref:T,class:"sign"},null,512),d("div",rt,[d("div",it,"\u7B7E\u540D\u65E5\u671F\uFF1A "+H(k(De)),1),d("div",lt,[ct,(f(!0),L(se,null,ue(K.value,(o,t)=>(f(),w(s,{key:`holderFileList-${t}`,class:"file",title:`\u300A${o.materialName}\u300B`,content:o.materialContent,type:k(Je)(o.materialContent,o.materialSource+""),onClick:n[1]||(n[1]=()=>"")},null,8,["title","content","type"]))),128)),(f(!0),L(se,null,ue(X.value,(o,t)=>(f(),w(s,{key:`holderQuestionList-${t}`,class:"file",title:`\u300A${o.title}\u300B`,content:x.value,type:S.value,onClick:()=>Fe(o)},null,8,["title","content","type","onClick"]))),128))])])]),_:1}),d("div",dt,[k(Q)?U("",!0):(f(),L("div",{key:0,class:"refresh-btn",onClick:Ae},[d("div",null,[A(oe,{name:"refresh"})]),Bt])),k(Q)?U("",!0):(f(),w(ze,{key:1,title:"\u9080\u8BF7\u60A8\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",desc:"\u9080\u8BF7\u60A8\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",link:k(ye)},{default:v(()=>[A(e,{plain:"",type:"primary",class:"share-btn"},{default:v(()=>[Ct]),_:1})]),_:1},8,["link"])),A(e,{type:"primary",class:"submit-btn",onClick:ve},{default:v(()=>[Et]),_:1})])])]),_:1})}}});var ht=Me(ft,[["__scopeId","data-v-5fe4c6ba"]]);export{ht as default};
