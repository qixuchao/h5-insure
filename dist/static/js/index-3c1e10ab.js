var Xe=Object.defineProperty,Ze=Object.defineProperties;var et=Object.getOwnPropertyDescriptors;var pe=Object.getOwnPropertySymbols;var tt=Object.prototype.hasOwnProperty,at=Object.prototype.propertyIsEnumerable;var he=(v,c,f)=>c in v?Xe(v,c,{enumerable:!0,configurable:!0,writable:!0,value:f}):v[c]=f,_=(v,c)=>{for(var f in c||(c={}))tt.call(c,f)&&he(v,f,c[f]);if(pe)for(var f of pe(c))at.call(c,f)&&he(v,f,c[f]);return v},A=(v,c)=>Ze(v,et(c));import{g as rt,a9 as ut,O as ot,E as h,M as Fe,y as R,T as E,_ as ye,l as nt,h as st,r as ve,af as lt,j as w,n as j,p as C,m as Q,H as it,t as k,z as q,k as X,A as p,J as De,C as Te,F as ct,D as dt,X as mt}from"./vendor-17026bfd.js";import{_ as ft,C as Ee,J as Ce,I as pt,a1 as ht,a4 as ge}from"./index-39a1c9eb.js";import{a as Z}from"./order-47a26e20.js";import{S as $,R as B,f as Ft}from"./infoCollection-0d7d7990.js";import{p as Be,i as yt,s as vt,g as Dt,u as Et,a as Ct}from"./trial-6ff2dba8.js";import{p as gt}from"./product-89ba0392.js";import{v as ee,g as Ne,a as Ie,t as Bt,b as Nt}from"./utils-9a24f9d8.js";import{f as It,a as _e}from"./utils-89cbea07.js";import{t as _t}from"./theme-ea709837.js";import{d as Ae,B as At,D as wt,G as Tt,S as Pt,H as Ot,P as bt,U as St,_ as Ht,W as kt,p as we,a as Y}from"./auth-cb7c4443.js";import{_ as xt}from"./index-06c18b86.js";import"./trial-5572265b.js";import"./index-c288abf5.js";import"./bankCard-4e0a0b08.js";import"./phoneVerify-7160ea27.js";const Ut={key:0},Vt={class:"page-internet-product-detail"},Lt={class:"info"},Mt={class:"footer-button"},Rt={class:"price"},qt=Te(" \u603B\u4FDD\u8D39"),$t={key:0},Yt=rt({setup(v){const c=ut(),f=ot(),{productCode:K="BWYL2021",tenantId:F,orderNo:N,phoneNo:te,agentCode:T="",saleChannelId:Pe,paymentMethod:Oe,certNo:ae,name:re,pageCode:W,upgradeCode:be,from:ue}=f.query;console.log(f.query,"route.query");const oe=h(),s=h(),P=h(),D=h(),x=W==="payBack",Se=h(!1),U=h(!1),V=h(!1),He=h(0),J=h(!1),z=h(!1),L=h({show:!1,html:""});let G="";const t=Fe({holder:{certNo:ae,certType:Ee.CERT,mobile:te,name:re,socialFlag:$.HAS},insured:{certNo:ae,certType:Ee.CERT,name:re,socialFlag:$.HAS,relationToHolder:B.SELF},paymentMethod:Oe,renewalDK:"Y",paymentFrequency:Ft.MONTH}),M=h(Ae),I=h(Ae),d=Fe({showInsure:!x,canInsure:!1,canUpgrade:!1}),ke=R(()=>{var a,e;return((e=(a=s.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:e.attachmentVOList.filter(r=>r.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),xe=R(()=>{var a,e,r,n,u,o,l,i;return[...((e=(a=s.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:e.titleAndDescVOS)||[],{desc:`\u51FA\u751F${It((n=(r=s.value)==null?void 0:r.tenantProductInsureVO)==null?void 0:n.holderAgeLimit)}`,title:"\u6295\u4FDD\u5E74\u9F84",noDetail:!0},{desc:_e((o=(u=s.value)==null?void 0:u.tenantProductInsureVO)==null?void 0:o.insurancePeriodValues),title:"\u4FDD\u969C\u671F\u9650",noDetail:!0},{desc:_e((i=(l=s.value)==null?void 0:l.tenantProductInsureVO)==null?void 0:i.waitPeriod)||"",title:"\u7B49\u5F85\u671F",noDetail:!0}]}),Ue=R(()=>{var a,e;return((e=(a=s.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:e.attachmentVOList.filter(r=>r.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),ne=R(()=>{if(t.holder.certNo){const a=Ce(t.holder.certNo);if(ee(t.holder.certNo,18,"year"))return E("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E18\u5C81\uFF01"),!1;if(t.insured.certNo&&t.insured.relationToHolder===B.MATE){const e=Ce(t.insured.certNo);if(a===e)return E("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(t.insured.certNo){if(t.insured.relationToHolder===B.CHILD&&ee(t.insured.certNo,30,"day"))return E("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(t.insured.relationToHolder===B.PARENT&&!ee(t.insured.certNo,70,"year"))return E("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E70\u5C81\uFF01"),!1}if([B.CHILD,B.PARENT].includes(t.insured.relationToHolder)){const a=Ne(t.holder.certNo,"year"),e=Ne(t.insured.certNo,"year");if(t.insured.relationToHolder===B.CHILD&&a-e<18)return E("\u6295\u4FDD\u4EBA\u548C\u5B50\u5973\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1;if(t.insured.relationToHolder===B.PARENT&&e-a<18)return E("\u6295\u4FDD\u4EBA\u548C\u7236\u6BCD\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1}return!0}),Ve=()=>{const{holder:{certNo:a,mobile:e,name:r,socialFlag:n},insured:{certNo:u,name:o,socialFlag:l,relationToHolder:i},paymentMethod:y}=t;return pt(u)&&!!l},se=()=>{c.push({path:"/internet/guaranteeUpgrade",query:A(_({},f.query),{tenantId:F,productCode:"BWYL2022",orderNo:N,agentCode:T})})},Le=()=>{z.value=!1,c.replace(`/pay?orderNo=${N}&saleUserId=${T}&tenantId=${F}`)},Me=()=>{I.value=M.value},Re=()=>{I.value=A(_({},I.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},qe=async a=>{E.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const e=await Et(a),{code:r}=e;if(r==="10000"){E.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const n=await Ct({orderNo:a.orderNo,tenantId:F}),{data:u}=n;n.code==="10000"&&(u.type===2?(L.value={show:!0,html:u.paymentUrl},console.log("data.paymentUrl",L.value),mt(()=>{console.log("document.forms",document.forms);const o=document.getElementById("cashierSubmit");o==null||o.addEventListener("submit",l=>{l.preventDefault()}),o==null||o.submit()})):window.location.href=u.paymentUrl)}d.canInsure=!0}catch{d.canInsure=!0}},$e=a=>{var u,o;const e=JSON.parse((o=(u=P.value)==null?void 0:u.productBasicInfoVO)==null?void 0:o.extInfo);let r="";return e.endorsementFlag===1&&(r=`&upgradeCode=${e.endorsementCode}`),`${ge}/internet/productDetail?tenantId=${F}&productCode=${K}&orderNo=${a}&agentCode=${T}&pageCode=payBack${r}&from=${ue||"normal"}`},Ye=a=>`${ge}/internet/payFail?tenantId=${F}&orderNo=${a}&agentCode=${T}&pageCode=payBack&from=${ue||"normal"}`,Ke=async a=>{const e=Nt({tenantId:F,saleUserId:T,saleChannelId:Pe,detail:s.value,insureDetail:P.value,paymentMethod:t.paymentMethod,renewalDK:t.renewalDK,iseeBizNo:G,successJumpUrl:"",premium:D.value,holder:t.holder,insured:t.insured,tenantOrderRiskList:a,orderStatus:"",orderTopStatus:""});try{const r=await vt(e),{code:n,data:u}=r;n==="10000"&&qe(A(_({},e),{orderNo:u.data,extInfo:{extraInfo:{renewalDK:t.renewalDK,paymentMethod:t.paymentMethod,paymentFrequency:t.paymentFrequency,successJumpUrl:$e(u.data),failUrl:Ye(u.data)},iseeBizNo:G}}))}catch{d.canInsure=!0}},We=async()=>{if(!ne.value)return{};const{calcData:a,riskVOList:e}=Ie({holder:t.holder,insured:t.insured,tenantId:F,paymentFrequency:t.paymentFrequency,productDetail:s.value,insureDetail:P.value},!0);if(!Array.isArray(e)||e.length<1)return E("\u88AB\u4FDD\u4EBA\u5E74\u9F84\u9700\u572830\u5929(\u542B) - 70\u5C81(\u542B)\u4E4B\u95F4\uFF01"),D.value=null,{};const r=await Be(a),{code:n,data:u}=r;return n==="10000"?t.insured.certNo?(D.value=u.premium,{condition:e,data:u}):(D.value=null,{condition:e,data:u}):{}},Je=()=>new Promise((a,e)=>{var r,n;(n=(r=oe.value)==null?void 0:r.validateForm)==null||n.call(r).then(async()=>{if(!ne.value)return;const{calcData:u,riskVOList:o}=Ie({holder:t.holder,insured:t.insured,tenantId:F,paymentFrequency:t.paymentFrequency,productDetail:s.value,insureDetail:P.value},!0),l=await Be(u),{code:i,data:y}=l;i==="10000"?(D.value=y.premium,a({condition:o,data:y})):e(new Error)}).catch(()=>{d.canInsure=!0})}),le=async()=>{var a;if(x){se();return}d.canInsure=!1;try{const{condition:e,data:r}=await Je(),n={},u=(l=[])=>{(l||[]).forEach(i=>{var y;n[i.riskCode]=i,((y=i.riskPremiumDetailVOList)==null?void 0:y.length)&&u(i.riskPremiumDetailVOList)})};u(r.riskPremiumDetailVOList);const o=Bt({tenantId:F,riskList:e,riskPremium:n,productId:(a=s.value)==null?void 0:a.id});Ke(o)}catch{d.canInsure=!0}},ze=a=>{a==="allFalse"?(U.value=!1,le(),d.canInsure=!0):dt.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"}).then(()=>{window.history.back()})},Ge=()=>{Se.value=!0,V.value=!1,U.value=!0};ye([()=>t.insured.certNo,()=>t.insured.socialFlag],nt.exports.debounce(()=>{t.insured.certNo&&t.insured.socialFlag&&W!=="payBack"&&Ve()&&We()},500),{deep:!0,immediate:!0}),ye(()=>t.insured.certNo,()=>{t.insured.certNo||(D.value=null)});const ie=async()=>{var n,u,o,l,i,y,O,b,S,ce,de,me,fe;const a=await Dt({orderNo:N,tenantId:F}),{code:e,data:r}=a;if(e==="10000"){const{tenantOrderHolder:g,tenantOrderInsuredList:m,extInfo:H}=r;if(!x){Object.assign(t,{holder:{certNo:g.certNo,certType:g.certType,mobile:g.mobile,name:g.name,socialFlag:$.HAS},insured:{certNo:m==null?void 0:m[0].certNo,certType:(n=m[0])==null?void 0:n.certType,name:(u=m[0])==null?void 0:u.name,socialFlag:(l=(o=m[0])==null?void 0:o.extInfo)==null?void 0:l.hasSocialInsurance,relationToHolder:(i=m[0])==null?void 0:i.relationToHolder},paymentMethod:H.extraInfo.paymentMethod,paymentFrequency:H.extraInfo.paymentFrequency,renewalDK:"Y"}),d.canInsure=!0;return}Object.assign(t,{holder:{certNo:g.certNo,certType:g.certType,mobile:g.mobile,name:g.name,socialFlag:$.HAS},insured:{certNo:m==null?void 0:m[0].certNo,certType:(y=m[0])==null?void 0:y.certType,name:(O=m[0])==null?void 0:O.name,socialFlag:(S=(b=m[0])==null?void 0:b.extInfo)==null?void 0:S.hasSocialInsurance,relationToHolder:(ce=m[0])==null?void 0:ce.relationToHolder},paymentMethod:H.extraInfo.paymentMethod,paymentFrequency:H.extraInfo.paymentFrequency,renewalDK:H.extraInfo.renewalDK||"N"}),D.value=(fe=(me=(de=m[0])==null?void 0:de.tenantOrderProductList)==null?void 0:me[0])==null?void 0:fe.premium,(r.orderStatus===Z.ACCEPT_POLICY||r.orderStatus===Z.PAYMENT_SUCCESS)&&(d.canUpgrade=!0,J.value=!1,z.value=!0),r.orderStatus===Z.PAYING&&(J.value=!0,setTimeout(()=>{ie()},3*1e3))}},je=async()=>{const a=gt({productCode:K,withInsureInfo:!0,tenantId:F}),e=yt({productCode:K});await Promise.all([a,e]).then(([r,n])=>{var u;r.code==="10000"&&(s.value=r.data,document.title=((u=r.data)==null?void 0:u.productFullName)||""),n.code==="10000"&&(P.value=n.data)}),N&&ie()},Qe=()=>{x?(I.value=we,M.value=we,console.log("\u652F\u4ED8\u5B8C\u6210\u8FDB\u5165")):N?(console.log("\u6295\u4FDD\u94FE\u63A5-\u6765\u4ED8\u94B1"),I.value=A(_({},Y),{paymentFrequencyDisable:!0}),M.value=Y,d.canInsure=!0):te||N||(console.log("\u6295\u4FDD\u94FE\u63A5"),I.value=A(_({},Y),{paymentFrequencyDisable:!0}),M.value=Y,d.canInsure=!0)};return st(()=>{Qe(),je(),setTimeout(async()=>{G=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(a,e)=>{const r=ve("van-button"),n=ve("van-config-provider"),u=lt("dompurify-html");return w(),j(ct,null,[C(n,{"theme-vars":p(_t)},{default:Q(()=>{var o,l,i,y,O,b,S;return[L.value.show?it((w(),j("div",Ut,null,512)),[[u,L.value.html]]):k("",!0),q("div",Vt,[q("div",Lt,[C(At,{url:(l=(o=s.value)==null?void 0:o.tenantProductInsureVO)==null?void 0:l.banner[0]},null,8,["url"]),C(wt,{"product-name":(i=s.value)==null?void 0:i.productFullName,"product-desc":(O=(y=s.value)==null?void 0:y.showConfigVO)==null?void 0:O.desc},null,8,["product-name","product-desc"])]),((S=(b=s.value)==null?void 0:b.tenantProductInsureVO)==null?void 0:S.titleAndDescVOS)?(w(),X(Tt,{key:0,"guarantee-list":p(xe)},null,8,["guarantee-list"])):k("",!0),C(Pt,{detail:s.value},{form:Q(()=>[C(Ot,{ref_key:"formRef",ref:oe,disable:!p(d).showInsure,"form-auth":I.value,"form-info":p(t),premium:D.value,"product-detail":s.value,payments:[1],"payment-method":[0],onOnReset:Me,onOnUpdate:Re},null,8,["disable","form-auth","form-info","premium","product-detail"])]),_:1},8,["detail"]),q("div",Mt,[q("div",Rt,[qt,D.value?(w(),j("span",$t,"\uFFE5"+De(p(ht)(D.value))+"/\u6708",1)):k("",!0)]),C(r,{type:"primary",class:"right",disabled:!(p(d).canInsure||p(d).canUpgrade),onClick:le},{default:Q(()=>[Te(De(p(d).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),p(W)!=="payBack"?(w(),X(bt,{key:1,"product-detail":s.value},null,8,["product-detail"])):k("",!0),C(St,{"order-no":p(N),"tenant-id":p(F),"upgrade-code":p(be),"is-show":z.value,onOnConfirm:se,onOnClose:Le},null,8,["order-no","tenant-id","upgrade-code","is-show"])]}),_:1},8,["theme-vars"]),C(Ht,{show:U.value,"onUpdate:show":e[0]||(e[0]=o=>U.value=o),"content-list":p(ke),"active-index":0,onOnConfirmHealth:ze},null,8,["show","content-list"]),V.value?(w(),X(xt,{key:0,show:V.value,"onUpdate:show":e[1]||(e[1]=o=>V.value=o),"content-list":p(Ue),"active-index":He.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9",onSubmit:Ge},null,8,["show","content-list","active-index"])):k("",!0),C(kt,{"is-show":J.value},null,8,["is-show"])],64)}}});var sa=ft(Yt,[["__scopeId","data-v-712e36fb"]]);export{sa as default};
