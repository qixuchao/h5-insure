import{T as e,d as a,i as l,j as s,z as t,cg as n,ch as i,o as u,c as o,a as r,f as d,u as c,q as v,b as p,w as g,a8 as m,e as f,F as h,n as y,l as _,ci as b,m as w,_ as k,cj as S,ck as V,ag as C,cl as U}from"./index-49d4fa1c.js";var j=e;const x={class:"sign-wrap"},A=["src"],R={class:"popup-body"},T={class:"sign-container-wrap"},z={class:"operate-bar"},I=a({name:"sign"});var N=k(a({...I,props:{option:{default:{}},modelValue:{default:""},signString:{default:"房间卡贺卡和大伙副书记环境发好"},signAccount:{default:3}},emits:["update:modelValue","submitSign"],setup(e,{expose:a,emit:k}){const I=e,N=l(!0),q=l(),D=l(""),E=l([]),F=l(0),L=s((()=>{if(I.signString&&I.signString.length>=I.signAccount){const e=[];let a=0;for(let l=0;l<=I.signString.length;l++)!l||l%I.signAccount||(a+=1),I.signString[l]&&(e[a]?e[a]+=I.signString[l]:e[a]=I.signString[l]);return e}return[""]})),P=l(!0),$=l(),B=()=>{0!==F.value&&$.value&&(F.value-=1,$.value.swipeTo(F.value))},G=()=>{var e;N.value=!0,null==(e=q.value)||e.clear(),setTimeout((()=>{var e;null==(e=q.value)||e.setDataURL(D.value),I.modelValue?P.value=!1:P.value=!0}))},H=()=>{S({images:[D.value],className:"customer-sign-preview"})},J=()=>{N.value=!1},K=()=>{var e,a;null==(a=null==(e=q.value)?void 0:e.clear)||a.call(e),D.value="",P.value=!0,k("update:modelValue","")},M=()=>{var e,a;if((null==(e=E.value)?void 0:e.length)!==(null==(a=L.value)?void 0:a.length))return void j({message:"请完成抄录",className:"toast-vertical"});const l=[];E.value.forEach((async(e,a)=>{l.push(V(e,270))})),Promise.all(l).then((e=>{const a=e.map(((e,a)=>({image:e})));k("update:modelValue",a),k("submitSign",a),N.value=!1}))};return t((()=>I.modelValue),(()=>{D.value=I.modelValue}),{immediate:!0}),a({rewrite:K,openSign:G}),(e,a)=>{const l=C,s=n,t=i,k=U;return u(),o(h,null,[r("div",x,[d(e.$slots,"signImg",{data:c(D)},(()=>[c(D)?(u(),o("img",{key:0,class:"preview-sign",src:c(D),alt:"",onClick:H},null,8,A)):v("",!0),p(l,{type:"primary",round:"",size:"small",onClick:G},{default:g((()=>[m(f(c(D)?"重新签名":"点击签字"),1)])),_:1})]),!0)]),p(k,{show:c(N),"onUpdate:show":a[1]||(a[1]=e=>w(N)?N.value=e:null),position:"bottom",style:{height:"100%",overflow:"hidden"}},{default:g((()=>[r("div",R,[r("div",T,[p(t,{ref_key:"swipeRef",ref:$,vertical:"",loop:!1,"show-indicators":!1,touchable:!1},{default:g((()=>[(u(!0),o(h,null,y(c(L),((e,l)=>(u(),_(s,{key:l},{default:g((()=>[p(b,{ref_for:!0,ref_key:"signRef",ref:q,modelValue:c(E)[l],"onUpdate:modelValue":e=>c(E)[l]=e,placeholder:e,onStroke:a[0]||(a[0]=e=>P.value=!1)},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1024)))),128))])),_:1},512),r("div",z,[p(l,{type:"primary",class:"btn",disabled:c(P),onClick:M},{default:g((()=>[m("确定")])),_:1},8,["disabled"]),p(l,{type:"primary",plain:"",class:"btn",onClick:B},{default:g((()=>[m("上一页")])),_:1}),p(l,{type:"primary",plain:"",class:"btn",onClick:K},{default:g((()=>[m("重签")])),_:1}),p(l,{type:"default",class:"btn",onClick:J},{default:g((()=>[m("取消")])),_:1})])])])])),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-43fe62d5"]]);export{N as S};
