import{d as e,r as a,z as t,R as l,c as n,A as i,f as s,i as o,E as r,e as d,g as c,k as u,ae as p,X as f,Y as v,cf as m,a as h,u as y,L as b,a1 as A,a0 as w,a6 as _,h as g,w as I,U as x,V as k,ap as C,a4 as D,af as O,T as P,P as F,y as L}from"./index-591873b8.js";import{a as V,q as R}from"./product-35abb169.js";import{i as j,t as T}from"./trial-140443dc.js";import{a as B,s as E,c as N}from"./phoneVerify-6e1feb50.js";import{n as S}from"./nextStep-01753b87.js";import{g as Y,v as M,f as H}from"./utils-06b02ec4.js";import{_ as J}from"./index-7656d306.js";import{P as U}from"./index-a096cbfa.js";import{_ as z}from"./index-407e10bb.js";import{P as G}from"./index-496054d5.js";import{u as W}from"./useAttachment-07369e17.js";import{u as Z}from"./useOrder-c14319e5.js";import"./pdfh5-008ca364.js";import"./core-65dc5c45.js";import"./constant-8927d485.js";import"./infoCollection-765a1e16.js";import"./trial-54c38a43.js";import"./useDicData-40ddb5ff.js";const X={class:"free-card"},Q={class:"container"},$={class:"title"},q=e({name:"freeHolderForm"}),K=e({...q,props:{detail:{default:()=>({})},isFirst:{type:Boolean,default:!0},insureDetail:{default:()=>({})},previewMode:{type:Boolean,default:!1}},setup(e,{expose:f}){const v=e,m=a(),h=t({factorObj:{1:[{attributeValues:null,code:"mobile",datasource:null,defaultValue:null,displayType:null,factorId:null,factorScript:null,hasDefaultValue:1,id:8249,isDisplay:1,isHidden:1,isMustInput:1,isReadOnly:null,moduleType:1,placeholder:null,planCode:null,position:null,productCode:"lin23323",productId:null,title:"手机号"},{attributeValues:null,code:"verificationCode",datasource:null,defaultValue:null,displayType:null,factorId:null,factorScript:null,hasDefaultValue:1,id:8249,isDisplay:1,isHidden:1,isMustInput:1,isReadOnly:null,moduleType:1,placeholder:null,planCode:null,position:null,productCode:"lin23323",productId:null,title:"验证码"}],2:[],3:[]},isFirst:!0}),y=async({mobile:e,type:a},t)=>{var l;if(m.value){if(v.previewMode)return void(null==t||t());null==(l=m.value)||l.validateForm(`${a}_mobile`).then((async()=>{const a=v.isFirst?B:E,l=await a(e),{code:n,data:i}=l;"10000"===n&&(null==t||t())}))}};return l((()=>v.isFirst),(()=>{var e;v.isFirst||(h.factorObj=null==(e=v.insureDetail)?void 0:e.productFactor)})),f({validateForm:()=>new Promise(((e,a)=>{m.value.validateForm().then((a=>{console.log(a),e(!0)})).catch((()=>{console.log("失败"),a()}))}))}),(a,t)=>{const l=p;return n(),i("div",X,[s("div",Q,[s("div",$,[o(l,{name:"free-arrow"}),s("span",null,r(e.isFirst?"凭手机号 免费领取":"最后一步 填写信息"),1),o(l,{name:"free-arrow"})]),(n(),d(z,{ref_key:"formRef",ref:m,key:e.isFirst?1:2,"send-sms-code":y,"need-desensitize":"","form-info":e.detail,"factor-object":c(h).factorObj},null,8,["form-info","factor-object"])),u(a.$slots,"default")])])}}});const ee={key:0},ae=[s("div",{class:"__skeleton_free_content__"},[s("div",{class:"van-config-provider router-view sk",style:{"--van-primary-color":"#0d6efe","--van-primary-color-light8":"#0d6efe80","--van-primary-color-light1":"#0d6efe10","--van-primary-color-light2":"#0d6efe20","--van-danger-color":"#FF3C10","--van-primary-background-color":"#0d6efe20","--van-button-primary-background-color":"#0d6efe","--van-button-primary-border-color":"#0d6efe","--van-checkbox-checked-bg-color":"#0d6efe10","--van-switch-on-background-color":"#0d6efe","--van-toast-default-padding":"14px","--van-linear-bg":"linear-gradient(to right, #0d6efe, rgba(13,150,254,1))","--van-popup-close-icon-margin":"20px","--van-popup-round-border-radius":"20px","--van-card-title":"#0d6efe","--van-card-cell-color":"#0d6efe80","--van-radio-checked-icon-color":"#0d6efe","--van-pro-check-radius":"40px","--6a485862-state_colors_1_":"#ddd"}},[s("div",{class:"page-free-product-detail"},[s("div",{class:"van-image banner",style:{width:"375px",height:"185px"},src:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"},[s("img",{class:"van-image__img","data-src":"https://za-obs-prod.obs.cn-north-4.myhuaweicloud.com:443/common/20221213/b38ae9c8c023488bb4fb4bdc2c67a211/wecom-temp-b44cd90cb804d1826e7824adc3b386e9(1).png?AccessKeyId=LLSTLZA8R9JY8AJRF7ZF&Policy=eyJleHBpcmF0aW9uIjoiMjAyMi0xMi0yM1QwNDowNTo1OS41NzhaIiwiY29uZGl0aW9ucyI6W1sic3RhcnRzLXdpdGgiLCIka2V5IiwiIl0sWyJlcSIsIiRidWNrZXQiLCJ6YS1vYnMtcHJvZCJdXX0=&Signature=gAgGPVirtYpSJtdYcnN1W3zpIbQ%3D",src:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",lazy:"loaded",style:{background:"rgb(238, 238, 238)"}})]),s("div",{class:"free-card",style:{"--0c47bddc-props_colors_0_":"#ddd","--0c47bddc-props_colors_1_":"#ddd"}},[s("div",{class:"container"},[s("div",{class:"title"},[s("svg",{class:"svg-icon icon-free-arrow"},[s("use",{"xlink:href":"#icon-free-arrow"})]),s("span",null,[s("span",{class:"sk-text",style:{"--fp":"0.00%","--sp":"100.00%","--lh":"16.0001px"}},"最后一步 填写信息")]),s("svg",{class:"svg-icon icon-free-arrow"},[s("use",{"xlink:href":"#icon-free-arrow"})])]),s("div",{class:"page-info-wrapper"},[s("div",{class:"com-form-wrapper","show-error":"","show-error-message":"false"},[s("form",{class:"van-form"},[s("div",{class:"com-card"},[s("div",{class:"com-card-wrap"},[s("div",{class:"header"}),s("div",{class:"body",style:{height:"auto"}},[s("div",{class:"com-personal-wrapper"},[s("div",{class:"van-cell van-field van-field--label-left com-pro-field"},[s("div",{class:"van-cell__title van-field__label van-field__label--left"},[s("label",{id:"van-field-1-label",for:"van-field-1-input"},[s("span",{class:"sk-text",style:{"--fp":"14.29%","--sp":"85.71%","--lh":"21px"}},"手机号")])]),s("div",{class:"van-cell__value van-field__value"},[s("div",{class:"van-field__body"},[s("input",{type:"text",id:"van-field-1-input",name:"holder_mobile",class:"van-field__control van-field__control--left sk-input",placeholder:"请输入手机号",autocomplete:"off","aria-labelledby":"van-field-1-label"}),s("div",{class:"van-field__right-icon"})])])]),s("div",{class:"van-cell van-field van-field--label-left com-pro-field"},[s("div",{class:"van-cell__title van-field__label van-field__label--left"},[s("label",{id:"van-field-2-label",for:"van-field-2-input"},[s("span",{class:"sk-text",style:{"--fp":"14.29%","--sp":"85.71%","--lh":"21px"}},"验证码")])]),s("div",{class:"van-cell__value van-field__value"},[s("div",{class:"van-field__body"},[s("input",{type:"tel",inputmode:"numeric",id:"van-field-2-input",name:"holder_verificationCode",class:"van-field__control van-field__control--left",placeholder:"请输入验证码",autocomplete:"off","aria-labelledby":"van-field-2-label"}),s("div",{class:"van-field__right-icon"})])]),s("div",{class:"button-extra"},[s("button",{type:"button",class:"van-button van-button--primary van-button--small van-button--plain sms-code sk-button"},[s("div",{class:"van-button__content"},[s("span",{class:"van-button__text"},[s("span",{class:"sk-text",style:{"--fp":"8.33%","--sp":"91.67%","--lh":"19.2002px"}},"验证码")])])])])])])])])])])])]),s("div",{class:"pro-shadow-button submit-btn"},[s("button",{type:"button",class:"van-button van-button--primary van-button--normal van-button--block van-button--round shadow-button shadow sk-button"},[s("div",{class:"van-button__content"},[s("span",{class:"van-button__text"},[s("span",{class:"sk-text",style:{"--fp":"8.33%","--sp":"91.67%","--lh":"19.2002px"}},"激活保障")])])])]),s("div",{class:"com-attachment-list"},[s("span",null,[s("span",{class:"sk-text",style:{"--fp":"16.67%","--sp":"83.33%","--lh":"18px"}},"请阅读")]),s("span",{class:"attachment-item"},[s("span",{class:"sk-text",style:{"--fp":"16.67%","--sp":"83.33%","--lh":"18px"}}," 《免责条款说明》 ")]),s("span",{class:"attachment-item"},[s("span",{class:"sk-text",style:{"--fp":"16.67%","--sp":"83.33%","--lh":"18px"}}," 《被保险人同意声明》 ")]),s("span",{class:"attachment-item"},[s("span",{class:"sk-text",style:{"--fp":"16.67%","--sp":"83.33%","--lh":"18px"}}," 《投保须知》 ")]),s("span",{class:"attachment-item"},[s("span",{class:"sk-text",style:{"--fp":"16.67%","--sp":"83.33%","--lh":"18px"}}," 《重要提示》 ")]),s("span",{class:"attachment-item"},[s("span",{class:"sk-text",style:{"--fp":"16.67%","--sp":"83.33%","--lh":"18px"}}," 《条款费率》 ")]),s("span",{class:"attachment-item"},[s("span",{class:"sk-text",style:{"--fp":"16.67%","--sp":"83.33%","--lh":"18px"}}," 《特别约定》 ")]),s("span",{class:"attachment-item"},[s("span",{class:"sk-text",style:{"--fp":"16.67%","--sp":"83.33%","--lh":"18px"}}," 《保险经纪委托合同》 ")]),s("span",{class:"attachment-item"},[s("span",{class:"sk-text",style:{"--fp":"16.67%","--sp":"83.33%","--lh":"18px"}}," 《客户告知书》 ")])])])]),s("div",{class:"product-desc"},[s("div",{class:"van-image",style:{width:"100%"}},[s("img",{class:"van-image__img","data-src":"https://za-obs-prod.obs.cn-north-4.myhuaweicloud.com:443/common/20221211/dff441c3bcf94b2d8f08e6ec3f4267ec/产品介绍.png?AccessKeyId=LLSTLZA8R9JY8AJRF7ZF&Policy=eyJleHBpcmF0aW9uIjoiMjAyMi0xMi0yM1QwNDowNTo1OS41NzlaIiwiY29uZGl0aW9ucyI6W1sic3RhcnRzLXdpdGgiLCIka2V5IiwiIl0sWyJlcSIsIiRidWNrZXQiLCJ6YS1vYnMtcHJvZCJdXX0=&Signature=%2B%2FGYArnGmx9sMDCEvOBvjfpiZsU%3D",src:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",lazy:"loaded",style:{background:"rgb(238, 238, 238)"}})])])])])],-1)],te={key:1,"data-skeleton-root":"FREE",class:"page-free-product-detail"},le={class:"product-desc"},ne={key:1,class:"page-free-footer"},ie=e({__name:"free",setup(e){const l=f((()=>v((()=>import("./index-edd00ca3.js")),["static/js/index-edd00ca3.js","static/css/index-eabeb59f.css","static/js/index-591873b8.js","static/css/index-56d1ba7e.css","static/js/pdfh5-008ca364.js"]))),r=f((()=>v((()=>import("./index-e06a2242.js")),["static/js/index-e06a2242.js","static/css/index-3329e46f.css","static/js/index-591873b8.js","static/css/index-56d1ba7e.css","static/js/pdfh5-008ca364.js"]))),u=f((()=>v((()=>import("./index-fce69369.js")),["static/js/index-fce69369.js","static/css/index-fa4edf2a.css","static/js/index-591873b8.js","static/css/index-56d1ba7e.css","static/js/pdfh5-008ca364.js","static/js/index-a096cbfa.js","static/css/index-827a8544.css","static/js/utils-06b02ec4.js","static/js/infoCollection-765a1e16.js","static/js/trial-54c38a43.js"])));m();const B=h(),E=y(),{productCode:z="",agencyCode:X="",tenantId:Q="",saleUserId:$="",saleChannelId:q="",extraInfo:ie,preview:se}=E.query;let oe={};try{oe=JSON.parse(decodeURIComponent(ie))}catch(Fe){console.log(Fe)}const{openId:re,indirectCode:de="",agentCode:ce}=oe;console.log("extInfo",oe);const ue=a(),pe=a(),fe=a(),ve=t({tenantProductDetail:{},insureProductDetail:{},currentPlanObj:{},planList:[],colors:["#fff"],detail:{},order:{tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},insuredBeneficiaryType:"1",tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}]}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}},banner:"",productDesc:[],newAuth:!0,isValidateCode:!1,insureDetail:{},loading:!0,isSelfInsure:!0,showBtn:!1,activeIndex:0,showFilePreview:!1,isOnlyView:!0});Z({extInfo:{}});const me=a([]),he=a(),{fileList:ye,mustReadFileCount:be,popupFileList:Ae}=W(ve.currentPlanObj,he);a();const we=a([]),_e=a({imgUrl:"",desc:"",title:"",link:window.location.href}),ge=b((()=>!!se)),Ie=()=>{var e,a,t;const l=ve.insureDetail.productRiskVoList||[];return 1===((null==(t=null==(a=null==(e=null==l?void 0:l[0])?void 0:e.riskDetailVOList)?void 0:a[0])?void 0:t.insuranceStartType)||1)?`${L(new Date).format("YYYY-MM-DD")} 00:00:00`:`${L(new Date).add(1,"day").format("YYYY-MM-DD")} 00:00:00`},xe=()=>{var e,a;const t=ve.insureDetail.productRiskVoList||[],{insuranceEndType:l,riskInsureLimitVO:n}=(null==(a=null==(e=null==t?void 0:t[0])?void 0:e.riskDetailVOList)?void 0:a[0])||{},{insurancePeriodValueList:i}=n||{},[s,o]=((null==i?void 0:i[0])||"").split("_");return 1===l?`${L(new Date).add(o||0,s).format("YYYY-MM-DD")} 23:59:59`:l?`${L(new Date).add(o,s).format("YYYY-MM-DD")} 00:00:00`:""},ke=async()=>{ve.loading=!0;const e=V({productCode:z,tenantId:Q}),a=j({productCode:z,isTenant:!se});await Promise.all([e,a]).then((([e,a])=>{var t,l,n;if("10000"===e.code){ve.tenantProductDetail=e.data,document.title=e.data.BASIC_INFO.title||"";const{title:a,desc:l,image:i}=(null==(t=e.data)?void 0:t.PRODUCT_LIST.wxShareConfig)||{},[s=""]=i||[];n={title:a,desc:l,image:s},_e.value={desc:n.desc||"你好，这里是描述",imgUrl:n.image,title:n.title,link:window.location.href},console.log("shareInfo",_e.value)}"10000"===a.code&&(ve.insureProductDetail=a.data,ve.currentPlanObj=null==(l=a.data.productPlanInsureVOList)?void 0:l[0],ve.planList=(a.data.productPlanInsureVOList||[]).filter((e=>e.planCode)).map((e=>({planName:e.planName,planCode:e.planCode})))),R({productCode:z}).then((({code:e,data:a})=>{var t,l,n,i;if("10000"===e){const{productMaterialPlanVOList:e,productQuestionnaireVOList:s}=a;he.value=e||[];const{basicInfo:{questionnaireType:o},questions:r,questionnaireName:d}=(null==(t=null==s?void 0:s[0])?void 0:t.questionnaireDetailResponseVO)||{basicInfo:{}};o&&(me.value=2===o?[{attachmentName:d,attachmentUri:r,attachmentType:"question"}]:[{attachmentName:d,attachmentUri:null==(l=null==r?void 0:r[0])?void 0:l.content,attachmentType:Y(String(null==(n=null==r?void 0:r[0])?void 0:n.textType),null==(i=null==r?void 0:r[0])?void 0:i.content)}])}})),ve.loading=!1}))},Ce=async()=>{let e={loginType:"2",openId:re,thirdUserType:"XINAO_WECHAT",indirectCode:de};try{if(ve.newAuth?(e.loginName=ve.order.tenantOrderHolder.mobile,e.password=ve.order.tenantOrderHolder.verificationCode):e=H({order:ve.order,tenantId:Q,extraInfo:oe,commencementTime:Ie(),expiryDate:xe(),detail:ve.detail,insureDetail:ve.insureDetail,iseeBizNo:ue.value,agentCode:ce,agencyCode:X,saleUserId:ce,templateId:null==oe?void 0:oe.templateId,saleChannelId:q,pageCode:"infoCollection",buttonCode:"EVENT_FREE_multiIssuePolicy"}),ve.newAuth)if(ge.value)ve.newAuth=!1;else{const{code:a,data:t}=await T(e);"10000"===a&&(ve.newAuth=!1)}else S(e,((e,a)=>{a===F.JUMP_PAGE&&e.orderNo&&B.push(`/baseInsurance/orderDetail?from=free&tenantId=${Q}&orderNo=${e.orderNo}`)}))}catch(a){console.log("e")}},De=async()=>await(async()=>{var e;if(ge.value)return!0;await fe.value.validateForm();const a=null==(e=ve.order.tenantOrderHolder)?void 0:e.verificationCode;if((ve.isValidateCode||ve.newAuth)&&(!a||!M(a)))return P({message:"请输入正确的验证码"}),!1;if(ve.newAuth||!ve.isValidateCode)return!0;const{code:t,data:l}=await N(ve.order.tenantOrderHolder.mobile,a);return!!l})()?(ve.newAuth||!we.value.length?Ce():(ve.isOnlyView=!1,ve.showFilePreview=!0),!1):null,Oe=()=>{ve.showFilePreview=!1,ve.isOnlyView=!0},Pe=()=>{ve.showFilePreview=!1,ve.isOnlyView=!0,Ce()};return A((()=>{ke(),setTimeout((async()=>{ue.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),w(pe,(([{isIntersecting:e}],a)=>{ve.showBtn=!e})),(e,a)=>{var t,f,v,m,h,y;const b=D,A=_,w=p,P=O;return n(),i(x,null,[c(ve).loading?(n(),i("div",ee,ae)):(n(),i("div",te,[1==(null==(f=null==(t=c(ve).tenantProductDetail)?void 0:t.BASIC_INFO)?void 0:f.bannerType)&&(null==(m=null==(v=c(ve).tenantProductDetail)?void 0:v.BASIC_INFO)?void 0:m.banner.length)?(n(),d(J,{key:0,"data-skeleton-type":"img","indicator-color":"#ddd",images:null==(h=c(ve).tenantProductDetail)?void 0:h.BASIC_INFO.banner},null,8,["images"])):g("",!0),o(K,{ref_key:"formRef",ref:fe,"is-first":c(ve).newAuth,"insure-detail":c(ve).insureDetail,detail:c(ve).order,colors:c(ve).colors,"preview-mode":c(ge)},{default:I((()=>[o(U,{ref_key:"root",ref:pe,class:"submit-btn",disabled:!c(ve).newAuth&&c(ge),"is-gradient":!1,text:c(ve).newAuth?"立即领取":"激活保障",onClick:De},null,8,["disabled","text"]),o(b,null,{default:I((()=>{var e;return[(null==(e=c(ye))?void 0:e.length)?(n(),d(c(r),{key:0,"attachment-list":c(ye),"has-bg-color":!1,"pre-text":"请阅读",onPreviewFile:a[0]||(a[0]=e=>(e=>{ve.isOnlyView=!0,ve.activeIndex=e,ve.showFilePreview=!0})(e))},null,8,["attachment-list"])):g("",!0)]})),_:1})])),_:1},8,["is-first","insure-detail","detail","colors","preview-mode"]),s("div",le,[(n(!0),i(x,null,k((null==(y=c(ve).tenantProductDetail.SPECIAL_FEATURE)?void 0:y.spec)||[],((e,a)=>(n(),d(C,{key:a},{fallback:I((()=>[o(w,{name:"img",style:{"font-size":"40px",margin:"10px auto",display:"block"}})])),default:I((()=>[(n(),d(A,{key:a,class:"detail-img",width:"100%",src:e},null,8,["src"]))])),_:2},1024)))),128))]),o(P),o(b,null,{default:I((()=>{var e,a,t;return[(null==(e=c(ve).tenantProductDetail.SIGNATURE)?void 0:e.inscribedContent)?(n(),d(c(l),{key:0,"inscribed-content":null==(t=null==(a=c(ve).tenantProductDetail)?void 0:a.SIGNATURE)?void 0:t.inscribedContent},null,8,["inscribed-content"])):g("",!0)]})),_:1}),c(ve).showBtn?(n(),i("footer",ne,[o(U,{disabled:!c(ve).newAuth&&c(ge),"is-gradient":!1,text:c(ve).newAuth?"立即领取":"激活保障",onClick:De},null,8,["disabled","text"])])):g("",!0)])),c(ve).showFilePreview?(n(),d(c(u),{key:2,show:c(ve).showFilePreview,"onUpdate:show":a[1]||(a[1]=e=>c(ve).showFilePreview=e),"content-list":c(ve).isOnlyView?c(ye):c(Ae),"is-only-view":c(ve).isOnlyView,"active-index":c(ve).activeIndex,text:c(ve).isOnlyView?"关闭":"我已逐页阅读上述内容并同意","force-read-count":c(ve).isOnlyView?0:c(be),onSubmit:Pe,onOnCloseFilePreviewByMask:Oe},null,8,["show","content-list","is-only-view","active-index","text","force-read-count"])):g("",!0),c(ve).loading?g("",!0):(n(),d(G,{key:3,"product-detail":c(ve).tenantProductDetail},null,8,["product-detail"]))],64)}}});export{ie as default};
