import{bd as e,ci as i,d as a,r as l,j as t,k as n,l as s,E as o,o as r,c as u,b as d,w as c,a as p,u as m,p as v,e as f,f as y,F as k,_ as g,bo as h,bp as V,bz as I,bA as b,aq as L,aK as C,g as O,bu as w,bv as T,bw as R,bx as P,aO as S,bC as D,s as x,v as A,aN as F,ao as N,aa as _,t as j,n as U,i as E,am as M,aI as B,T as K,bn as q,bs as $,bG as J,bH as H,a8 as G,bK as z,cj as Q,aB as Y,aC as X,aD as Z,bq as W,br as ee,ah as ie,aS as ae,aG as le,h as te,aJ as ne,M as se,aP as oe,aQ as re,aj as ue,aR as de,af as ce,ag as pe,q as me,ck as ve,ak as fe,al as ye}from"./index-71971dfc.js";import{_ as ke,P as ge}from"./PolicyInfo-2df753a9.js";import{h as he,f as Ve,u as Ie,c as be,j as Le,d as Ce,q as Oe,g as we,i as Te}from"./trial-de94b37f.js";import{_ as Re}from"./TrialButton-4acd1ace.js";import{n as Pe}from"./nextStep-6de10299.js";import{u as Se}from"./useAttachment-14698404.js";import{a as De,c as xe}from"./product-c51a8933.js";import{g as Ae}from"./utils-c7893755.js";import{u as Fe}from"./useOrder-d280dfa8.js";import{a as Ne,P as _e,B as je}from"./constants-6ad2f07c.js";import{t as Ue}from"./utils-6b5d6a6f.js";import{c as Ee}from"./cloneDeep-eda1aa7e.js";import{S as Me,g as Be,o as Ke}from"./index-47c96c87.js";import{a as qe,B as $e}from"./infoCollection-a3fc6546.js";import{S as Je,I as He,a as Ge}from"./index-35209315.js";import{f as ze,m as Qe,g as Ye}from"./gender-bdd67324.js";import{L as Xe}from"./product-7bbf9c44.js";import{B as Ze}from"./index-1b1a5c41.js";import{R as We}from"./trial-a511ee66.js";import"./index-01a1649c.js";import"./format-31cde443.js";import"./core-c27d18d9.js";import"./createProposal-743a9eca.js";import"./index-8ae04d5a.js";function ei(a){return function(a){return"number"==typeof a||e(a)&&"[object Number]"==i(a)}(a)&&a!=+a}const ii={key:0},ai={class:"custom-field"},li={key:1,class:"flex-field"},ti={class:"pro-radio-wrap"},ni={key:2},si={class:"pro-radio-wrap"},oi={class:"custom-field"},ri={key:1},ui={key:3},di={class:"custom-field"},ci={key:1},pi={class:"custom-field"},mi={key:0},vi={key:1},fi={key:4},yi=a({name:"BaoeBaofei"});var ki=g(a({...yi,props:{originData:{default:()=>({})},modelValue:{default:()=>({})},defalutValue:{default:()=>({})},trialResult:{default:()=>({})}},emits:["update:modelValue","trialChange"],setup(e,{emit:i}){const a=e,g=l({hadSetDefault:!1}),I=t(a.originData),b=t(a.modelValue),L=t(0),C=()=>2===I.value.saleMethod?{label:"保费",key:"initialPremium"}:{label:"保额",key:"initialAmount"},O=()=>{switch(`${I.value.displayUnit}`){case qe.YUAN:return"元";case qe.MONTH_SALARY:return"倍月薪";case qe.MILLION:return"万元";case qe.COPY:return"份"}return""},w=n((()=>2===I.value.saleMethod?{label:"保费",key:"initialPremium"}:{label:"保额",key:"initialAmount"})),T=(...e)=>{if(1===L.value){const e=b.value[w.value.key],i=a.originData.minStepValue,l=a.originData.maxStepValue,t=a.originData.stepValue;if(+e>=+l)b.value[w.value.key]=l;else if(+e<=+i)b.value[w.value.key]=i;else{const a=+e-+i,l=Math.floor(a/+t);a%+t!=0&&(b.value[w.value.key]=+i+l*+t)}}return!0},R=()=>{const{displayType:e,requireCopies:i}=I.value,a=C().key,l=!b.value.riskCode;1===e?L.value=1:3===e&&2===i?(L.value=2,I.value.displayValues.length>=1&&l&&!b.value[a]&&(b.value[a]=I.value.displayValues[0].code||I.value.displayValues[0].value)):3===e&&1===i?(L.value=3,I.value.minCopiesValue===I.value.maxCopiesValue&&l&&!b.value.copy&&(b.value.copy=I.value.minCopiesValue),I.value.displayValues.length>=1&&l&&!b.value[a]&&(b.value[a]=I.value.displayValues[0].code||I.value.displayValues[0].value)):2===e&&(L.value=4,I.value.minCopiesValue===I.value.maxCopiesValue&&l&&!b.value.copy&&(b.value.copy=I.value.minCopiesValue),l&&!b.value.initialAmount&&(b.value.initialAmount=I.value.copiesAmount))},P=n((()=>{if(I.value.displayValues){const e=C().key;return 1!==I.value.displayValues.length||b.value.riskCode||(b.value[e]=I.value.displayValues[0].code),I.value.displayValues.map((e=>({label:e.value,value:e.code})))}return[]})),S=()=>{};return s((()=>{R(),i("update:modelValue",b.value)})),o((()=>I),(e=>{R()}),{deep:!0}),o((()=>a.defalutValue),(e=>{(null==e?void 0:e.riskCode)&&!g.hadSetDefault&&(g.hadSetDefault=!0,b.value={...b.value,initialAmount:e.initialAmount,initialPremium:e.initialPremium,copy:e.copy})}),{deep:!0,immediate:!0}),o((()=>b.value),(e=>{(()=>{if(1===L.value){const e=b.value[w.value.key],i=a.originData.minStepValue,l=a.originData.maxStepValue,t=a.originData.stepValue;if(+e>+l)return!1;if(+e<+i)return!1;if((+e-+i)%+t!=0)return!1}return!0})()&&(i("update:modelValue",e),i("trialChange",e))}),{deep:!0,immediate:!0}),(e,i)=>{const a=Me,l=h,t=V;return r(),u(k,null,[1===L.value?(r(),u("div",ii,[d(l,{label:`基本${m(w).label}`,name:m(w).key,class:"risk-select-field"},{input:c((()=>[p("div",ai,[d(a,{modelValue:b.value[m(w).key],"onUpdate:modelValue":i[0]||(i[0]=e=>b.value[m(w).key]=e),"input-width":"80px","default-value":e.originData.minStepValue,min:e.originData.minStepValue,step:e.originData.stepValue,max:e.originData.maxStepValue,theme:"round",onBlur:T},null,8,["modelValue","default-value","min","step","max"])])])),_:1},8,["label","name"])])):2===L.value?(r(),u("div",li,[d(l,{modelValue:b.value[m(w).key],"onUpdate:modelValue":i[2]||(i[2]=e=>b.value[m(w).key]=e),label:`基本${m(w).label}`,name:m(w).key,class:"risk-select-field"},{input:c((()=>[p("div",ti,[d(t,{modelValue:b.value[m(w).key],"onUpdate:modelValue":i[1]||(i[1]=e=>b.value[m(w).key]=e),options:m(P),onclick:S},null,8,["modelValue","options"])])])),_:1},8,["modelValue","label","name"])])):3===L.value?(r(),u("div",ni,[d(l,{modelValue:b.value[m(w).key],"onUpdate:modelValue":i[4]||(i[4]=e=>b.value[m(w).key]=e),label:`基本${m(w).label}`,name:m(w).key,class:"risk-select-field"},{input:c((()=>[p("div",si,[d(t,{modelValue:b.value[m(w).key],"onUpdate:modelValue":i[3]||(i[3]=e=>b.value[m(w).key]=e),options:m(P),onclick:S},null,8,["modelValue","options"])])])),_:1},8,["modelValue","label","name"]),p("div",null,[d(l,{modelValue:b.value.copy,"onUpdate:modelValue":i[6]||(i[6]=e=>b.value.copy=e),label:"份数",name:"copy",class:"risk-select-field"},{input:c((()=>[p("div",oi,[e.originData.minCopiesValue!==e.originData.maxCopiesValue?(r(),v(a,{key:0,modelValue:b.value.copy,"onUpdate:modelValue":i[5]||(i[5]=e=>b.value.copy=e),"input-width":"80px","default-value":e.originData.minCopiesValue,min:e.originData.minCopiesValue||1,step:1,max:e.originData.maxCopiesValue,theme:"round"},null,8,["modelValue","default-value","min","max"])):(r(),u("span",ri,f(e.originData.minCopiesValue),1))])])),_:1},8,["modelValue"])])])):4===L.value?(r(),u("div",ui,[d(l,{modelValue:b.value.copy,"onUpdate:modelValue":i[8]||(i[8]=e=>b.value.copy=e),label:"份数",name:"copy",class:"risk-select-field"},{input:c((()=>[p("div",di,[e.originData.minCopiesValue!==e.originData.maxCopiesValue?(r(),v(a,{key:0,modelValue:b.value.copy,"onUpdate:modelValue":i[7]||(i[7]=e=>b.value.copy=e),"input-width":"64px","default-value":e.originData.minCopiesValue,min:e.originData.minCopiesValue||1,step:1,max:e.originData.maxCopiesValue,theme:"round"},null,8,["modelValue","default-value","min","max"])):(r(),u("span",ci,f(e.originData.minCopiesValue),1))])])),_:1},8,["modelValue"]),d(l,{label:m(w).label,name:"copyAmount",class:"risk-select-field"},{input:c((()=>[p("div",pi,[e.originData.minCopiesValue!==e.originData.maxCopiesValue?(r(),u("span",mi,f(+e.originData.copiesAmount*+b.value.copy+O()),1)):(r(),u("span",vi,f(+e.originData.minCopiesValue*+e.originData.copiesAmount+O()),1))])])),_:1},8,["label"])])):y("",!0),2===I.value.saleMethod&&e.trialResult&&e.trialResult.initialAmount>0?(r(),u("div",fi,[d(l,{label:"保额",class:"risk-select-field"},{input:c((()=>[p("span",null,f(e.trialResult.initialAmount),1)])),_:1})])):y("",!0)],64)}}}),[["__scopeId","data-v-3a02f6d0"]]);const gi=a({name:"BeneficiaryItem"});var hi=g(a({...gi,props:{modelValue:{default:()=>({})},schema:{default:()=>[]},config:{default:()=>({})},isView:{type:Boolean,default:!1},isTrial:{type:Boolean,default:!1},title:{default:"受益人"}},emits:["update:modelValue","trailChange"],setup(e,{expose:i,emit:a}){const n=e,s=t(null),u=l({validated:!1,schema:[],config:{},personVO:{}});return o((()=>n.config),(e=>{e&&Object.assign(u.config,e)}),{deep:!0,immediate:!0}),o((()=>n.schema),(e=>{e&&Object.assign(u.schema,Ee(n.schema))}),{deep:!0,immediate:!0}),o((()=>n.modelValue),((e,i)=>{JSON.stringify(e)!==JSON.stringify(i)&&(I("受益人数据变动了"),Object.assign(u.personVO,e))}),{deep:!0,immediate:!0}),o((()=>u.personVO),(e=>{e&&a("update:modelValue",e)}),{deep:!0,immediate:!0}),o((()=>{var e;return null==(e=u.personVO)?void 0:e.relationToInsured}),((e,i)=>{if(e===i)return!1;I("受益人与被保人关系变动了");const{certType:a}=u.personVO||{},[l,t]=b(u.schema,{certType:a,relationToHolder:e});return L(u.config,t),!n.isView&&e&&i&&Object.assign(u.personVO,{...C(u.personVO,(e=>!(l&&"certType"===e))),relationToInsured:e}),!1}),{immediate:!0}),i({validate:e=>P(s,n.trialFactorCodes,e),validateTrialFields:()=>R({personVO:u.personVO,trialFactorCodes:n.trialFactorCodes})}),(e,i)=>(r(),v(m(T),{ref_key:"formRef",ref:s,class:"personal-info-card",title:e.title,model:m(u).personVO,schema:m(u).schema,config:m(u).config,"is-view":e.isView,"extra-provision":{objectType:m(w).BENEFICIARY,objectId:m(u).personVO.id}},{cardTitleExtra:c((()=>[O(e.$slots,"default",{},void 0,!0)])),_:3},8,["title","model","schema","config","is-view","extra-provision"]))}}),[["__scopeId","data-v-eb39bf9e"]]);const Vi=["onClick"],Ii=a({name:"InsuredItem"});var bi=g(a({...Ii,props:{modelValue:{default:()=>({})},title:{default:""},holderPersonVO:{},schema:{default:()=>[]},config:{default:()=>({})},isView:{type:Boolean,default:!1},isTrial:{type:Boolean,default:!1},trialFactorCodes:{default:()=>[]},multiBeneficiaryMaxNum:{default:null},beneficiaryList:{default:()=>[]},beneficiarySchema:{default:()=>[]}},emits:["update:modelValue","update:beneficiaryList"],setup(e,{expose:i,emit:a}){const s=e,p=t(null),f=t(null),g=t(null),h={schema:[],trialFactorCodes:[],config:{},personVO:{}},V=l({validated:!1,schema:[],config:{},personVO:{},beneficiaryTypeSchemaList:[],beneficiarySchemaList:[],beneficiaryList:[]}),j=()=>{V.beneficiaryList.push(Ee({...h,nanoid:D(),schema:s.beneficiarySchema}))},U=n((()=>!s.multiBeneficiaryMaxNum||V.beneficiaryList.length<s.multiBeneficiaryMaxNum)),E=n((()=>!V.schema.filter((e=>{var i;return!(e.hidden||(null==(i=V.config[e.name])?void 0:i.hidden))})).length)),M=n((()=>V.schema.filter((e=>e.isSelfInsuredNeed)).map((e=>e.name)))),B=n((()=>S(s.beneficiarySchema))),K=n((()=>{var e;return String(null==(e=V.personVO)?void 0:e.insuredBeneficiaryType)===$e.SPECIFY}));return o((()=>s.holderPersonVO),(e=>{var i;I("------投保人信息变动了-----");const{id:a,...l}=e||{};if("1"===String(null==(i=V.personVO)?void 0:i.relationToHolder)){const e=S(M.value)?Object.keys(l).reduce(((e,i)=>([...M.value,"occupationClass"].includes(i)&&!["birthday","age","gender"].includes(i)||(e[i]=l[i]),e)),{}):l;Object.assign(V.personVO,e)}}),{deep:!0,immediate:!0}),o((()=>s.beneficiarySchema),(e=>{V.beneficiarySchemaList=S(e)?e.filter((e=>"insuredBeneficiaryType"!==e.name)):[],V.beneficiaryTypeSchemaList=S(e)?e.filter((e=>"insuredBeneficiaryType"===e.name)):[]}),{deep:!0,immediate:!0}),o(K,((e,i)=>{String(e)!==String(i)&&(I("受益人类型关系变动了"),e?!S(V.beneficiaryList)&&j():V.beneficiaryList=[])}),{immediate:!0}),o((()=>Ee(V.beneficiaryList).map((e=>({personVO:e.personVO,nanoid:e.nanoid})))),((e,i)=>{JSON.stringify(e)!==JSON.stringify(i)&&a("update:beneficiaryList",e)}),{deep:!0,immediate:!0}),o((()=>{var e;return null==(e=V.personVO)?void 0:e.relationToHolder}),((e,i)=>{if(!e)return;I("与投保人关系变动了");const{personVO:a,schema:l=[],config:t}=V||{},{id:n,...o}=s.holderPersonVO||{},r="1"===String(a.relationToHolder),[u,d]=b(l,a);if(L(t,d),l.forEach((e=>{e.relationToHolder=a.relationToHolder,e.hidden=!e.isSelfInsuredNeed&&r})),!s.isView&&i&&String(e)!==String(i)){let e={...a,...o};r||(e={...C(a,(e=>!(u&&"certType"===e))),relationToHolder:a.relationToHolder}),Object.assign(V.personVO,e)}}),{deep:!0}),o((()=>{var e;return null==(e=V.personVO)?void 0:e.relationToMainInsured}),((e,i)=>{if(!e)return;I("次被保人与主被保人关系变动了");const{personVO:a,schema:l=[],config:t}=V||{},{certType:n}=a||{},[o,r]=b(l,{certType:n,relationToHolder:e});L(t,r),!s.isView&&i&&String(e)!==String(i)&&Object.assign(V.personVO,{...C(a,(e=>!(o&&"certType"===e))),relationToMainInsured:a.relationToMainInsured})})),o((()=>s.config),(e=>{e&&Object.assign(V.config,e)}),{deep:!0,immediate:!0}),o((()=>s.schema),((e,i)=>{e&&JSON.stringify(e)!==JSON.stringify(i)&&Object.assign(V.schema,Ee(e))}),{deep:!0,immediate:!0}),o((()=>s.modelValue),((e,i)=>{if(JSON.stringify(e)!==JSON.stringify(i)){const{beneficiaryList:i,...a}=e;L(V.personVO,a)}}),{deep:!0,immediate:!0}),o((()=>Ee(s.beneficiaryList)),((e,i)=>{JSON.stringify(e)!==JSON.stringify(i)&&(V.beneficiaryList=S(e)?e.map((e=>({...e,nanoid:e.nanoid||D()}))):[])}),{deep:!0,immediate:!0}),o((()=>V.personVO),(e=>{e&&a("update:modelValue",e)}),{deep:!0,immediate:!0}),i({validate:e=>{var i;return Promise.all([P(p,s.trialFactorCodes,e),P(f,[],e),...(null==(i=g.value)?void 0:i.map((i=>i.validate(e))))||[]])},validateTrialFields:()=>R({personVO:V.personVO,trialFactorCodes:s.trialFactorCodes})}),(e,i)=>{const a=N,l=_;return r(),u(k,null,[d(m(T),{ref_key:"insuredFormRef",ref:p,class:"personal-info-card",title:m(E)?"":e.title,model:m(V).personVO,schema:m(V).schema,config:m(V).config,"is-view":e.isView,"extra-provision":{objectType:m(w).INSURED,objectId:m(V).personVO.id}},{cardTitleExtra:c((()=>[O(e.$slots,"default",{},void 0,!0)])),_:3},8,["title","model","schema","config","is-view","extra-provision"]),m(B)?(r(),u(k,{key:0},[d(m(T),{ref_key:"beneficiaryTypeFormRef",ref:f,class:"personal-info-card",title:"受益人",model:m(V).personVO,schema:m(V).beneficiaryTypeSchemaList,"is-view":e.isView},null,8,["model","schema","is-view"]),m(K)?(r(),u(k,{key:0},[(r(!0),u(k,null,x(m(V).beneficiaryList,((i,l)=>(r(),v(hi,{ref_for:!0,ref_key:"beneficiaryFormRef",ref:g,key:`${i.nanoid}_${l}`,modelValue:i.personVO,"onUpdate:modelValue":e=>i.personVO=e,title:`受益人${l+1}`,schema:m(V).beneficiarySchemaList,config:i.config,"is-view":e.isView},{default:c((()=>[O(e.$slots,"cardTitleExtraBenifit",{index:l},void 0,!0),l>0&&!e.isView?(r(),u("span",{key:0,class:"delete-button",onClick:e=>(e=>{F.confirm({message:"确定要删除该受益人吗？"}).then((()=>{V.beneficiaryList.splice(e,1)}))})(l)},[d(a,{name:"delete"})],8,Vi)):y("",!0)])),_:2},1032,["modelValue","onUpdate:modelValue","title","schema","config","is-view"])))),128)),!e.isView&&m(U)?(r(),u("span",{key:0,class:"add-button",onClick:j},[d(l,{name:"plus"}),A("添加受益人")])):y("",!0)],64)):y("",!0)],64)):y("",!0),O(e.$slots,"riskList",{},void 0,!0)],64)}}}),[["__scopeId","data-v-524344c0"]]);const Li={class:"customer-list-item"},Ci={class:"left"},Oi=["src"],wi={class:"left-item"},Ti={class:"name"},Ri={key:0,class:"cert-no"},Pi={class:"cert-type-name"},Si={key:1,class:"cert-no"},Di={class:"cert-type-name"},xi={key:0,class:"from-wx"},Ai=p("img",{class:"img-wx",alt:""},null,-1),Fi=a({__name:"item",props:{data:{type:Object,required:!1,default:()=>Object},disabled:{type:Boolean,required:!1,default:()=>!0}},emits:["on-delete","on-close"],setup(e,{emit:i}){const a=e,l=t(!1),{data:n,disabled:s}=j(a);return(e,a)=>{const t=Je;return r(),u("div",Li,[d(t,{disabled:m(s)},{default:c((()=>{var e,t,s,o,d,c,v,k;return[p("div",{class:U(["list-item",!0===l.value?"item-bg":""]),onClick:a[0]||(a[0]=e=>(e=>{l.value=!0,e.stopPropagation(),console.log("这里关闭弹窗",n.value),i("on-close",n.value)})(e))},[p("div",Ci,[p("div",null,[p("img",{src:m(n).gender?"1"===m(n).gender?m(ze):m(Qe):m(Ye),alt:"",class:"mf"},null,8,Oi)]),p("div",null,[p("div",wi,[p("div",Ti,f(m(n).name),1),(null==(t=null==(e=m(n))?void 0:e.certInfo[0])?void 0:t.certNo)&&1==+(null==(o=null==(s=m(n))?void 0:s.certInfo[0])?void 0:o.certType)?(r(),u("div",Ri,[A(f(m(n).certInfo[0].desensitizaCertNo)+" ",1),p("span",Pi,f(m(n).certInfo[0].certTypeName),1)])):y("",!0),(null==(c=null==(d=m(n))?void 0:d.certInfo[0])?void 0:c.certNo)&&1!=+(null==(k=null==(v=m(n))?void 0:v.certInfo[0])?void 0:k.certType)?(r(),u("div",Si,[A(f(m(n).certInfo[0].certNo)+" ",1),p("span",Di,f(m(n).certInfo[0].certTypeName),1)])):y("",!0)]),m(n).relative?(r(),u("div",xi,[Ai,A(" 微信客户 ")])):y("",!0)])])],2)]})),_:1},8,["disabled"])])}}});const Ni={class:"customer-list"},_i={key:0,class:"list-pr"},ji={key:1,class:"list-pr"};var Ui=g(a({__name:"index",props:{data:{type:Array,required:!0,default:()=>[]},type:{type:String,required:!0,default:()=>"firstLetter"},disabled:{type:Boolean,required:!1,default:()=>!0}},emits:["on-delete","on-close"],setup(e,{emit:i}){const a=e,{data:l,type:n,disabled:s}=j(a),p=t([]),f=t([]),y=e=>{i("on-delete",e)},g=e=>{i("on-close",e),console.log("这里关闭弹窗1111222----",e)};return o((()=>a.data),(()=>{l.value=a.data||[],console.log("data",l),p.value=l.value.filter((e=>!!(e.children&&Array.isArray(e.children)&&e.children.length>0))),f.value=p.value.map((e=>e.label))}),{immediate:!0,deep:!0}),(e,i)=>{const a=He,t=Ge;return r(),u("div",Ni,["firstLetter"===m(n)?(r(),u("div",_i,[d(t,{"highlight-color":"$zaui-brand","index-list":f.value,sticky:!1},{default:c((()=>[(r(!0),u(k,null,x(p.value,(e=>(r(),u(k,{key:e.label},[d(a,{index:`${e.label}`},null,8,["index"]),(r(!0),u(k,null,x(e.children,(e=>(r(),v(Fi,{key:e.agentCustomerId,data:e,disabled:m(s),onOnDelete:y,onOnClose:g},null,8,["data","disabled"])))),128))],64)))),128))])),_:1},8,["index-list"])])):(r(),u("div",ji,[(r(!0),u(k,null,x(m(l),(e=>(r(),v(Fi,{key:e.agentCustomerId,data:e,disabled:m(s),onOnDelete:y,onOnClose:g},null,8,["data","disabled"])))),128))]))])}}}),[["__scopeId","data-v-7f0e84c3"]]);const Ei=e=>(X("data-v-42d53b68"),e=e(),Z(),e),Mi=["onClick"],Bi=["onClick"],Ki=["onClick"],qi={class:"search-bar"},$i=["src"],Ji={key:1,class:"empth"},Hi=[Ei((()=>p("p",null,[p("img",{src:"/static/png/empth-d7935dd7.png",class:"ig"})],-1))),Ei((()=>p("p",{class:"p1"},"暂时还没有客户哦～",-1)))],Gi=a({name:"PersonalInfo"});var zi=g(a({...Gi,props:{productFactor:{default:()=>({})},modelValue:{default:()=>({})},isTrial:{type:Boolean,default:!1},isView:{type:Boolean,default:!1},isOnlyHolder:{type:Boolean,default:!1},multiInsuredConfig:{}},emits:["update:modelValue","trailChange","trailValidateFailed","closeCustomerPopoup"],setup(e,{expose:i,emit:a}){const s=e,f=E(),g=M(),{isShare:h,saleChannelId:V}=f.query,C=t(null),j=t(null),U=l({count:0,slotProps:{},uniqKey:"",currentIndex:0,currentBenifitIndex:0,currentType:"",keyword:void 0,show:!1,list:[],config:{},trialValidated:!1,holder:{personVO:{},schema:[],trialFactorCodes:[],config:{}},beneficiarySchema:[],initInsuredIList:[],insured:[]}),X=async e=>{var i,a;U.keyword;const l={pageNum:1,pageSize:999,queryBean:{keyword:U.keyword||""}},t=await he(l),n=[];Object.keys((null==(i=null==t?void 0:t.data)?void 0:i.customerMaps)||{}).forEach((e=>{var i;n.push({label:e,children:null==(i=null==t?void 0:t.data)?void 0:i.customerMaps[e]})})),U.list=n,U.count=null==(a=null==t?void 0:t.data)?void 0:a.count},Z=()=>{X(U.keyword)},W=()=>{X()},ee=n((()=>!s.isTrial||s.isOnlyHolder)),ie=(e,i,a)=>{U.currentType=e,"benifit"!==e?U.currentIndex=i:(U.currentIndex=i,U.currentBenifitIndex=a),U.uniqKey=D(),X(),U.show=!0},ae=()=>{setTimeout((()=>{U.show=!1}),300)},le=()=>"holder"===U.currentType?U.holder.schema.map((e=>e.name))||[]:"insured"===U.currentType?U.insured[U.currentIndex].schema.map((e=>e.name))||[]:"benifit"===U.currentType?U.beneficiarySchema.map((e=>e.name))||[]:void 0,te=n((()=>{var e,i;return null==(i=null==(e=null==U?void 0:U.holder)?void 0:e.personVO)?void 0:i.name})),ne=n((()=>{var e,i;return null==(i=null==(e=null==U?void 0:U.holder)?void 0:e.personVO)?void 0:i.gender})),se=n((()=>{var e,i;return null==(i=null==(e=null==U?void 0:U.holder)?void 0:e.personVO)?void 0:i.birthday})),oe=n((()=>{var e,i;return null==(i=null==(e=null==U?void 0:U.holder)?void 0:e.personVO)?void 0:i.certType})),re=n((()=>{var e,i;return null==(i=null==(e=null==U?void 0:U.holder)?void 0:e.personVO)?void 0:i.certNo})),ue=(e,i)=>{var a,l,t,n,s;console.log("convertCustomerData",e);const o=null==(a=null==e?void 0:e.contactInfo)?void 0:a.find((e=>"01"===e.contactType)),r=null==(l=null==e?void 0:e.contactInfo)?void 0:l.find((e=>"02"===e.contactType)),u=null==e?void 0:e.certInfo.filter((e=>"1"===e.certType)),d={name:null==e?void 0:e.name,gender:null==e?void 0:e.gender,birthday:null==e?void 0:e.birthday,mobile:(null==o?void 0:o.contactNo)||null,email:(null==r?void 0:r.contactNo)||null,certNo:(null==(t=u[0])?void 0:t.certNo)||null,certType:(null==(n=u[0])?void 0:n.certType)||null};console.log("insureKeys",le());const c=null==(s=le())?void 0:s.reduce(((e,i)=>d.hasOwnProperty(i)?{...e,[i]:d[i]}:e),{});return console.log("extractedObject===",c),console.log("state.holder.schema=====",U.holder.schema),c},de=e=>{var i,a,l,t,n,s,o,r,u,d,c;if(U.show=!1,"holder"===U.currentType&&Object.assign((null==(i=null==U?void 0:U.holder)?void 0:i.personVO)||{},ue(e)),"insured"===U.currentType){const i=null==(a=null==U?void 0:U.insured[U.currentIndex])?void 0:a.schema.some((e=>"relationToHolder"===e.name&&e.attributeValueList.some((e=>"1"===e.code)))),{name:n,gender:s,birthday:o,certType:r,certNo:u}=ue(e);if(te.value===n&&ne.value===s&&se.value===o&&oe.value===r&&re.value===u)return i?void Object.assign((null==(l=null==U?void 0:U.insured[U.currentIndex])?void 0:l.personVO)||{},{relationToHolder:"1"}):void K("与投保人关系未配置本人");Object.assign((null==(t=null==U?void 0:U.insured[U.currentIndex])?void 0:t.personVO)||{},ue(e))}if("benifit"===U.currentType){const{name:i,gender:a,birthday:l,certType:t,certNo:p}=ue(e);(null==(n=null==U?void 0:U.insured[U.currentIndex])?void 0:n.personVO.name)===i&&(null==(s=null==U?void 0:U.insured[U.currentIndex])?void 0:s.personVO.gender)===a&&(null==(o=null==U?void 0:U.insured[U.currentIndex])?void 0:o.personVO.birthday)===l&&(null==(r=null==U?void 0:U.insured[U.currentIndex])?void 0:r.personVO.certType)===t&&(null==(u=null==U?void 0:U.insured[U.currentIndex])?void 0:u.personVO.certNo)===p?K("指定受益人不可为被保人本人"):Object.assign((null==(c=null==(d=null==U?void 0:U.insured[U.currentIndex])?void 0:d.beneficiaryList[U.currentBenifitIndex])?void 0:c.personVO)||{},ue(e))}},ce=()=>{var e;const i=!j.value||(null==(e=j.value)?void 0:e.every((e=>e.validateTrialFields())));return(!C.value||R(U.holder))&&i},pe=e=>{var i;return Promise.all([...(null==(i=j.value)?void 0:i.map((i=>i.validate(e))))||[],P(C,U.holder.trialFactorCodes,e)])},me=e=>{const{productList:i,config:a,schema:l,trialFactorCodes:t,beneficiaryList:n,personVO:s,nanoid:o,...r}=e||{};return r},ve=()=>{const{length:e,[e-1]:i}=U.initInsuredIList;U.insured.push(Ee({...i,nanoid:D()}))},fe=n((()=>{const{multiInsuredMaxNum:e,multiInsuredSupportFlag:i}=U.config;return i&&(!e||U.insured.length<e)})),ye=n((()=>S(U.holder.schema))),ke=n((()=>U.insured.some((e=>S(e.schema))))),ge=(e,i)=>S(e)?e.reduce(((e,a)=>(e[a]=i[a],e)),{}):{},Ve=(e,i,a={})=>!!S(e)&&JSON.stringify(ge(e,i))!==JSON.stringify(ge(e,a));return o((()=>{var e;return null==(e=U.holder.personVO)?void 0:e.certType}),((e,i)=>{if(`${e}`==`${i}`)return!1;I("投保人信息变动了====");const[a,l]=b(U.holder.schema,{certType:e});return L(U.holder.config,l),!1})),o([()=>{var e;return{...null==(e=U.holder)?void 0:e.personVO}},()=>U.insured.map((e=>{const{beneficiaryList:i,personVO:a}=e||{};return{...a,beneficiaryList:S(i)?i.map((e=>({...e.personVO}))):[]}}))],B(((e,i)=>{var l,t,n;const[o,r]=e,u=((e,i)=>{const a=Ve(U.holder.trialFactorCodes,e[0],i[0]),l=U.insured.some(((e,a)=>{var l;const{trialFactorCodes:t,personVO:n}=e;return Ve(t,n,null==(l=i[1])?void 0:l[a])}));return a||l})([o,r],i);I(`投被保人信息变动了---${u}`);const{insuredList:d}=s.modelValue,c={holder:o,insuredList:r.map(((e,i)=>({...(null==d?void 0:d[i])||{},...e})))};if(U.config.isSpouseInsured){const[e,i]=r.map((e=>null==e?void 0:e.gender));if(e&&i&&String(e)===String(i))return K("被保人性别与投保要求不符")}if(JSON.stringify(null==(l=null==r?void 0:r[0])?void 0:l.personVO),me(null==(n=null==(t=s.modelValue)?void 0:t.insuredList)?void 0:n[0]),console.log("-------result = ",c),a("update:modelValue",c),!ce())return U.trialValidated=!1,a("trailValidateFailed",c);pe(!0).then((()=>{U.trialValidated=!0,u&&!s.isOnlyHolder&&a("trailChange",c)})).catch((()=>{U.trialValidated=!1,a("trailValidateFailed",c)}))}),500),{deep:!0}),o([()=>s.productFactor,()=>s.isTrial],((e,i)=>{if(q(e,i)||!e[0])return!1;I("投被保人要素变动了");const{insuredFactorCodes:a,holderFactorCodes:l}=$(J)||{},{holder:t,insured:n,beneficiary:o,config:r}=H(e[0],{isTrial:e[1],...s.multiInsuredConfig,insuredFactorCodes:a,holderFactorCodes:l});return Object.assign(U.holder,t),U.config=r,S(n)&&(U.initInsuredIList=n.map((e=>({...e,beneficiaryList:[]})))),U.beneficiarySchema=Ee((null==o?void 0:o.schema)||[]),!1}),{deep:!0,immediate:!0}),o((()=>{var e,i;return null==(i=null==(e=null==U?void 0:U.insured[U.currentIndex])?void 0:e.beneficiaryList[U.currentBenifitIndex])?void 0:i.personVO}),((e,i)=>{var a,l;(null==(l=null==(a=null==U?void 0:U.insured[U.currentIndex])?void 0:a.beneficiaryList[U.currentBenifitIndex])?void 0:l.personVO)&&(null==e?void 0:e.relationToInsured)!==(null==i?void 0:i.relationToInsured)&&(I("受益人关系变动了+++++"),U.insured[U.currentIndex].beneficiaryList[U.currentBenifitIndex].personVO={relationToInsured:null==e?void 0:e.relationToInsured})}),{deep:!0,immediate:!0}),o([()=>{const{holder:e,insuredList:i}=s.modelValue;console.log("表单数据",Ee(e));const a=S(i)?i.map((e=>({config:e.config,personVO:me(e),beneficiaryList:S(e.beneficiaryList)?e.beneficiaryList.map((({config:e,...i})=>({config:e,personVO:me(i)}))):[]}))):[];return[null==e?void 0:e.config,me(e),a]},()=>U.config,()=>U.initInsuredIList],(([[e,i,a]])=>{I("投被保人数据变动了"),Object.assign(U.holder.config,e),console.log("投保人数据===",Ee(U.holder.personVO),Ee(i)),console.log("投保人数据===",Ee(U.holder.personVO),Ee(i)),Object.assign(U.holder.personVO,i);const{length:l}=a||[],{length:t}=U.insured,{length:n,0:o={},[n-1]:r}=U.initInsuredIList,{multiInsuredMaxNum:u,multiInsuredMinNum:d,multiInsuredSupportFlag:c}=U.config,p=s.isView||l>t?Math.min(l,u):t||d;U.insured=Array.from({length:p}).reduce(((e,i,l)=>{const{personVO:t,config:n={},beneficiaryList:s}=(null==a?void 0:a[l])||{},u=Ee(0===l?o:r);return e[l]?L(e[l],{...Ee(u),personVO:t,config:n,beneficiaryList:s}):e[l]={...u,personVO:t,config:n,beneficiaryList:s,nanoid:D()},e}),U.insured)}),{deep:!0,immediate:!0}),o((()=>U.list),((e,i)=>{e&&(U.list=e)})),i({validate:pe,validateTrialFields:ce,validateHolder:(...e)=>{var i;return null==(i=C.value)?void 0:i.validate(...e)},canTrail:()=>U.trialValidated}),(e,i)=>{const a=N,l=_,t=z,n=Q,s=Y;return r(),u(k,null,[m(ye)&&m(ee)?(r(),v(m(T),{key:0,ref_key:"holderFormRef",ref:C,title:"投保人信息",class:"personal-info-card",model:m(U).holder.personVO,schema:m(U).holder.schema,config:m(U).holder.config,"is-view":e.isView,"extra-provision":{objectType:m(w).HOLDER,objectId:m(U).holder.personVO.id}},{cardTitleExtra:c((()=>[m(h)||e.isView||e.isTrial||!m(g)?y("",!0):(r(),u("div",{key:0,class:"choose-customer",onClick:i[0]||(i[0]=e=>ie("holder",1,0))},[d(a,{name:"customer",color:"#333"}),A(" 选择老用户 ")]))])),_:1},8,["model","schema","config","is-view","extra-provision"])):y("",!0),m(ke)&&!e.isOnlyHolder?(r(),u(k,{key:1},[(r(!0),u(k,null,x(m(U).insured,((i,l)=>(r(),v(bi,G({ref_for:!0,ref_key:"insuredFormRef",ref:j,key:`${i.nanoid}_${l}`,modelValue:i.personVO,"onUpdate:modelValue":e=>i.personVO=e,"beneficiary-list":i.beneficiaryList,"onUpdate:beneficiaryList":e=>i.beneficiaryList=e,title:""+(m(U).insured.length>1?`被保人${l+1}`:"被保人信息"),"holder-person-v-o":m(U).holder.personVO},i,{"beneficiary-schema":m(U).beneficiarySchema,"is-view":e.isView,"multi-beneficiary-num":m(U).config.multiBeneficiaryMaxNum}),{riskList:c((()=>[O(e.$slots,"riskInfo",{insuredIndex:l},void 0,!0)])),cardTitleExtraBenifit:c((i=>[m(h)||e.isView||e.isTrial||!m(g)?y("",!0):(r(),u("div",{key:0,class:"choose-customer",onClick:e=>ie("benifit",l,null==i?void 0:i.index)},[d(a,{name:"customer",color:"#333"}),A(" 选择老用户 ")],8,Bi))])),default:c((()=>[1==+i.personVO.relationToHolder||m(h)||e.isView||e.isTrial||!m(g)?y("",!0):(r(),u("div",{key:0,class:"choose-customer",onClick:e=>ie("insured",l,0)},[d(a,{name:"customer",color:"#333"}),A(" 选择老用户 ")],8,Mi)),!e.isView&&l+1>m(U).config.multiInsuredMinNum?(r(),u("span",{key:1,class:"delete-button",onClick:e=>(e=>{F.confirm({message:"确定要删除该被保人吗？"}).then((()=>{U.insured.splice(e,1)}))})(l)},[d(a,{name:"delete",color:"var(--van-primary-color)"})],8,Ki)):y("",!0)])),_:2},1040,["modelValue","onUpdate:modelValue","beneficiary-list","onUpdate:beneficiaryList","title","holder-person-v-o","beneficiary-schema","is-view","multi-beneficiary-num"])))),128)),!e.isView&&m(fe)?(r(),v(t,{key:0,class:"add-button-wrap"},{title:c((()=>[p("span",{class:"add-button",onClick:ve},[d(l,{name:"plus"}),A("添加被保人")])])),_:1})):y("",!0)],64)):y("",!0),m(U).show?(r(),v(s,{key:2,round:!1,show:m(U).show,closeable:!1,onClose:ae,onClosed:e.onClosePopupAfterAni},{default:c((()=>[p("div",qi,[d(n,{modelValue:m(U).keyword,"onUpdate:modelValue":i[1]||(i[1]=e=>m(U).keyword=e),placeholder:"客户 姓名/手机号",class:"icon-sercher",onSearch:Z,onCancel:W},{"left-icon":c((()=>[p("img",{src:m("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAAZlBMVEUAAAC0wNC1wdO/v/+zwNC0v9C0wM+0wNG2wdLCydm0wNC0wNC1wdCzwNC0wNC0wNC1wNC1v9G2wdS0wM+0wNC0wNCzwdG0wdCzwc+1wNK4wta6xtO1wdGzwNC0wc+1v9WzwdCzv89PygQeAAAAIXRSTlMA/DQE896qhEQLjvjX0cC5iUwk7Oamb2ZbKxkVf8d7GIfl18UPAAABK0lEQVRIx+1V25aDIAwkiEVUvNXe7G3z/z+5pKeHs2fJyqav7byIwwxJBKL64DUUi9ZL8V+1ti1gALRWqzwqjwBIoKevMvJ7j6SOAOzvq9nM8NQFPIezXkmngYewrA/jeKhLfLw2f6Y1GSB5p2PADokxE693LdB6x5/csSGudazhgrSa/lUVRcULpz8bMlRJXWQwZ8Yw0IxNeUvrDIyhDPzWMaVtAbFM+RMtZBUDS6FPCb3HAM3uJs3sE7oGRKNYGESoE3YXM2Wr2yVsHwxX3nANhl4cQVyD+CuJ90G407PwLOGX+LQK74MV3jjvRHcaYZJ0DcKmkPSldceSdL4yxsj2VpL7sdhER7Z7+5rKj47c/2FyNEoceUTHTckc0CmRA3BQEsetG5x6Z3wDxtkpoVPsMuQAAAAASUVORK5CYII="),alt:"",class:"search-icon-img",style:{width:"22px",height:"23px"}},null,8,$i)])),_:1},8,["modelValue"])]),m(U).count?(r(),v(Ui,{key:0,data:m(U).list,type:e.order,disabled:!1,onOnClose:de},null,8,["data","type"])):(r(),u("div",Ji,Hi))])),_:1},8,["show","onClosed"])):y("",!0)],64)}}}),[["__scopeId","data-v-42d53b68"]]);const Qi={class:"pro-radio-wrap"},Yi=a({name:"ProductKeys"});var Xi=g(a({...Yi,props:{originData:{default:()=>({})},modelValue:{default:()=>({})},riskInfo:{default:()=>({})},defaultValue:{default:()=>({})},useData:{default:()=>({})}},emits:["trialChange","inputChange"],setup(e,{emit:i}){const a=e,l=t(a.originData),n=t(a.modelValue);t(1);const f=e=>{const i=Be(a.originData,e),l=Be(a.originData,e);return i.map((e=>{const i=l?l.find((i=>i.code===e.code)):null;return{label:e.value,value:e.code,disabled:!(!i||null===i.useFlag||void 0===i.useFlag)&&1!==i.useFlag}}))},g=()=>{Ne.forEach((e=>{const i=Be(a.originData,e.configKey);"checkbox"===e.type&&i&&i.length>0&&!n.value.riskCode&&(n.value[e.valueKey]=i[0].code)}))};return s((()=>{g()})),o((()=>a.defaultValue),(e=>{(null==e?void 0:e.riskCode)&&(n.value=JSON.parse(JSON.stringify(e)))}),{deep:!0,immediate:!0}),o((()=>l.value),(e=>{g()}),{deep:!0,immediate:!0}),o((()=>JSON.stringify(n.value)),((e,l)=>{const t=e&&JSON.parse(e)||{};console.log("---v new = ",t);const n=l&&JSON.parse(l)||{};let s=null;Ne.forEach((e=>{t[e.valueKey]&&n[e.valueKey]&&t[e.valueKey]!==n[e.valueKey]&&(s||(s={key:e.valueKey,oldValue:n[e.valueKey],newValue:t[e.valueKey],riskCode:a.riskInfo.riskCode}))})),e&&i("trialChange",JSON.parse(e),s)}),{deep:!0,immediate:!0}),(e,i)=>{const a=V,l=h;return r(!0),u(k,null,x(m(Ne),(i=>(r(),u(k,null,[m(Be)(e.originData,i.configKey)&&(1===e.riskInfo.mainRiskFlag||i.ruleKey&&2===m(Be)(e.originData,i.ruleKey)||!i.ruleKey)?(r(),u("div",{key:e.riskInfo.riskCode+"_"+i.name},["checkbox"===i.type?(r(),v(l,{key:0,modelValue:n.value[i.valueKey],"onUpdate:modelValue":e=>n.value[i.valueKey]=e,label:i.name,name:i.valueKey,class:"risk-select-field"},{input:c((()=>[p("div",Qi,[d(a,{modelValue:n.value[i.valueKey],"onUpdate:modelValue":[e=>n.value[i.valueKey]=e,e=>((e,i)=>{console.log("-------change",e,i)})(e,i.valueKey)],options:f(i.configKey)},null,8,["modelValue","onUpdate:modelValue","options"])])])),_:2},1032,["modelValue","onUpdate:modelValue","label","name"])):y("",!0)])):y("",!0)],64)))),256)}}}),[["__scopeId","data-v-15c494f0"]]);const Zi={class:"com-risk-liabilityinfo"},Wi={class:"item-wrap"},ea={key:0},ia=(e=>(X("data-v-68f76c44"),e=e(),Z(),e))((()=>p("div",{class:"cell-content"},null,-1))),aa=a({name:"riskLiabilityInfo"});var la=g(a({...aa,props:{dataSource:{default:()=>({})},modelValue:{default:()=>({})},dataSourceFolmulate:{default:()=>({})},params:{default:()=>({amountUnit:"",basicsAmount:"",basicsPremium:"",riskId:""})},defaultValue:{default:()=>({})}},emits:["trialChange"],setup(e,{emit:i}){const a=e,l=t({formInfo:a.dataSource,isCheckList:[],checkValueList:[],liabilityList:[],signLiabilityClick:[]}),f=(e,i)=>{console.log("---click ",e,i),l.value.signLiabilityClick.push({item:e,index:i})},g=(e,i)=>{const{riskLiabilityInfoVOList:t,riskLiabilityCollocationVOList:n}=a.dataSource,s=t[e].liabilityId,o=(n||[]).find((e=>e.relatedLiabilityId===s||e.collocationLiabilityId===s))||{};let r=null;o.collocationLiabilityId===s?(r=o.relatedLiabilityId,o.collocationType===Xe.YI_LAI&&(r=o.collocationLiabilityId)):r=o.collocationLiabilityId;const u=t.findIndex((e=>e.liabilityId===r));((e,i,a)=>{l.value.isCheckList[e]===`${ie.YES}`?a===Xe.BANG_DING||a===Xe.YI_LAI?l.value.isCheckList[i]="1":l.value.isCheckList[i]="2":a===Xe.BANG_DING?l.value.isCheckList[i]="2":a===Xe.YI_LAI&&(l.value.isCheckList[i]=e!==i?"3":"2")})(e,u,o.collocationType),i(t[u],u,!0)},I=(e,i,a)=>{const t=l.value.liabilityList.map((e=>e.key)),n=0===(null==e?void 0:e.liabilityAttributeValueList.length)&&0===(null==e?void 0:e.formula.length),s=l.value.isCheckList[i];n&&-1===t.indexOf(i)&&s&&l.value.liabilityList.push({liabilityValue:e,key:i,isSwitchOn:l.value.isCheckList[i]}),"1"===s?f(e,i):l.value.signLiabilityClick.splice(i,1),-1!==t.indexOf(i)&&l.value.liabilityList.forEach((e=>{e.key===i&&(e.isSwitchOn=l.value.isCheckList[i])})),a||g(i,I)},b=(e,i)=>{const a=e.liabilityAttributeValueList.filter((e=>e.displayValue===l.value.checkValueList[i])),t=JSON.parse(JSON.stringify(a))[0]||e.liabilityAttributeValueList[0],n={...e,liabilityValue:t};l.value.liabilityList.length>0&&Object.keys(l.value.checkValueList).indexOf(i)&&(l.value.liabilityList=l.value.liabilityList.filter((e=>e.key!==i))),l.value.checkValueList[i]=t.displayValue,l.value.liabilityList.push({liabilityValue:n,key:i,isSwitchOn:"1"})},L=n((()=>Ee(a.dataSourceFolmulate))),C=(e,i,a)=>{1===a?l.value.liabilityList.push({liabilityValue:{...e,liabilityValue:null==e?void 0:e.liabilityAttributeValueList[0]},key:i,isSwitchOn:"1"}):l.value.liabilityList.push({liabilityValue:{...e,liabilityValue:null==e?void 0:e.liabilityAttributeValueList[0]},key:i,isSwitchOn:"2"})};o((()=>L.value),((e,i)=>{var t,n;const s=null==(t=a.dataSourceFolmulate)?void 0:t.initialAmount,o=null==(n=a.dataSourceFolmulate)?void 0:n.initialPremium,r={amountUnit:a.params.amountUnit,basicsAmount:s,basicsPremium:o,riskId:a.params.riskId};a.dataSource.riskLiabilityInfoVOList.map((async a=>{if(a.formula.length>0&&(s||o)&&((null==e?void 0:e.initialAmount)!==(null==i?void 0:i.initialAmount)||(null==e?void 0:e.initialPremium)!==(null==i?void 0:i.initialPremium))){const{code:e,data:i}=await Ve({...r,riskLiabilities:[a]});if("10000"===e){if(a.liabilityAttributeValueList=i[0].formulaResult,l.value.signLiabilityClick.length>0){const e=l.value.signLiabilityClick.find((e=>e.item.liabilityCode===a.liabilityCode));e&&b(e.item,e.index)}return{...a,liabilityAttributeValueList:i[0]}}return a}}))}),{deep:!0,immediate:!0}),o((()=>l.value.liabilityList),(e=>{const a=l.value.liabilityList.filter((e=>"1"===e.isSwitchOn)).map((e=>({...e.liabilityValue})));i("trialChange",a)}),{deep:!0,immediate:!0}),s((()=>{console.log("----mounted"),a.dataSource.riskLiabilityInfoVOList.map(((e,i)=>{const a=e.liabilityAttributeValueList.length>0&&0===e.formula.length&&e.liabilityAttributeValueList[0].displayValue;return l.value.checkValueList[i]||(l.value.checkValueList[i]=a),1!=+e.showFlag&&l.value.liabilityList.push({liabilityValue:e,key:i,isSwitchOn:"1"}),1==+e.showFlag&&(1===e.attributeFlag&&2===e.insureFlag&&0===e.formula.length&&C(e,i,1),1===e.attributeFlag&&1===e.insureFlag&&0===e.formula.length&&C(e,i,2),2===e.attributeFlag&&1===(null==e?void 0:e.liabilityAttributeValueList.length)&&2===e.insureFlag&&C(e,i,1),2===e.attributeFlag&&1===(null==e?void 0:e.liabilityAttributeValueList.length)&&1===e.insureFlag&&C(e,i,2)),null}))}));const O=t([]);return o((()=>a.dataSource.riskLiabilityInfoVOList),(e=>{O.value=(e||[]).map((e=>{const i=(a.dataSource.riskLiabilityCollocationVOList||[]).find((i=>i.collocationLiabilityId===e.liabilityId));return{...e,relation:null==i?void 0:i.collocationType}}))}),{deep:!0,immediate:!0}),o((()=>a.defaultValue),(e=>{(null==e?void 0:e.riskCode)&&e.liabilityList&&(l.value.signLiabilityClick=[],a.dataSource.riskLiabilityInfoVOList.forEach(((i,a)=>{var t;const n=null==e?void 0:e.liabilityList.find((e=>e.liabilityCode===i.liabilityCode));console.log("--target lia = ",n),n&&(l.value.isCheckList[a]="1",l.value.checkValueList[a]=null==(t=null==n?void 0:n.liabilityValue)?void 0:t.displayValue,1==+i.showFlag&&2==+i.optionalFlag?I(i,a):f(i,a))})))}),{deep:!0,immediate:!0}),(e,i)=>{const a=W,t=h,n=ee;return r(),v(n,null,{default:c((()=>[p("div",Zi,[p("div",Wi,[(r(!0),u(k,null,x(m(O),((e,i)=>(r(),u("div",{key:i},[1!=+e.showFlag||2===e.attributeFlag&&1===(null==e?void 0:e.liabilityAttributeValueList.length)&&2===e.insureFlag?y("",!0):(r(),u("div",ea,[(m(l).isCheckList[i]?"3"!==m(l).isCheckList[i]:e.relation!==m(Xe).YI_LAI)?(r(),v(t,{key:0,label:`${e.liabilityName}`,"label-width":"44%",name:"insuredRelation",class:"riskliab-select-field"},{input:c((()=>[1==+e.insureFlag?(r(),v(a,{key:0,modelValue:m(l).isCheckList[i],"onUpdate:modelValue":e=>m(l).isCheckList[i]=e,"active-value":"1","inactive-value":"2",size:"0.68rem",onClick:a=>I(e,i)},null,8,["modelValue","onUpdate:modelValue","onClick"])):y("",!0)])),_:2},1032,["label"])):y("",!0),1==+m(l).isCheckList[i]&&1===e.attributeFlag||1===e.attributeFlag&&2===e.insureFlag?(r(),v(t,{key:1,label:e.liabilityAttributeTypeDesc,"label-width":"44%",name:"insuredRelation",class:"riskliab-select-field-children"},{input:c((()=>[d(V,{modelValue:m(l).checkValueList[i],"onUpdate:modelValue":e=>m(l).checkValueList[i]=e,prop:{label:"displayValue",value:"displayValue"},options:(e.formula.length,e.liabilityAttributeValueList),"is-simply":!0,onClick:a=>b(e,i)},null,8,["modelValue","onUpdate:modelValue","options","onClick"])])),_:2},1032,["label"])):y("",!0)]))])))),128))])]),ia])),_:1})}}}),[["__scopeId","data-v-68f76c44"]]);const ta=a({name:"InsureInfos"}),na=a({...ta,props:{originData:{default:()=>({})},modelValue:{default:()=>({})},defaultValue:{default:()=>({})},trialResult:{default:()=>({})}},emits:["trialChange"],setup(e,{expose:i,emit:a}){const n=e,c=t(null),p=t({}),v=t({}),f=l({personalInfo:{},basicsAmount:"",basicsPremium:"",defaultValues:n.defaultValue,changeData:null,sValues:p.value});$("premium"),v.value=$("enumList")||{},s((()=>{}));const g=e=>{n.originData.mainRiskFlag,p.value.riskCategory=n.originData.riskCategory,p.value.riskCode=n.originData.riskCode,p.value.riskId=n.originData.riskId,p.value.riskType=n.originData.riskType,p.value.riskName=n.originData.riskName,p.value.riskType=n.originData.riskType,p.value.mainRiskCode=n.originData.mainRiskCode,p.value.mainRiskId=n.originData.mainRiskId,e?a("trialChange",p.value,e):a("trialChange",p.value)},h=(e,i)=>{i?p.value[i.key]=i.newValue:Ke(e).forEach((i=>{p.value[i]=e[i]})),g(i)},V=e=>{var i,a;1==+(null==(a=null==(i=n.originData)?void 0:i.productRiskInsureLimitVO)?void 0:a.amountPremiumConfigVO.saleMethod)?f.basicsAmount=null==e?void 0:e.initialAmount:f.basicsAmount=null==e?void 0:e.initialPremium,Ke(e).forEach((i=>{p.value[i]=e[i]})),g()},I=e=>{p.value.liabilityList=e,g()};return o((()=>n.defaultValue),(e=>{e&&(console.log("--default change ",e),f.defaultValues=Ee(e),p.value={...e})}),{deep:!0,immediate:!0}),o((()=>p.value),(e=>{f.sValues=e}),{deep:!0,immediate:!0}),i({validate:async()=>{var e;await(null==(e=c.value)?void 0:e.validate())}}),(e,i)=>{var a,l,t,n,s,o;const c=ae;return 1===(null==(a=e.originData)?void 0:a.factorDisPlayFlag)?(r(),u(k,{key:0},[d(c,{title:"保障计划",class:"insurePlan","show-divider":!1}),d(m(ki),{"v-model":m(f).sValues,"origin-data":null==(t=null==(l=e.originData)?void 0:l.productRiskInsureLimitVO)?void 0:t.amountPremiumConfigVO,"defalut-value":m(f).defaultValues,"trial-result":e.trialResult,onTrialChange:V},null,8,["v-model","origin-data","defalut-value","trial-result"]),d(m(Xi),{"v-model":m(f).sValues,"use-data":m(f).sValues,"origin-data":e.originData.productRiskInsureLimitVO,"risk-info":e.originData,"default-value":m(f).defaultValues,onTrialChange:h},null,8,["v-model","use-data","origin-data","risk-info","default-value"]),d(m(la),{"data-source-folmulate":m(p),"data-source":e.originData,params:{amountUnit:null==(s=null==(n=e.originData)?void 0:n.productRiskInsureLimitVO)?void 0:s.amountPremiumConfigVO.displayUnit,basicsAmount:m(f).basicsAmount,basicsPremium:m(f).basicsPremium,riskId:null==(o=e.originData)?void 0:o.riskId},"default-value":m(f).defaultValues,onTrialChange:I},null,8,["data-source-folmulate","data-source","params","default-value"])],64)):y("",!0)}}});const sa={key:0},oa={key:0,class:"risk2-field"},ra=a({name:"ProductRiskList"});var ua=g(a({...ra,props:{dataSource:{type:Array,default:()=>[]},productInfo:{type:Object,default:()=>({productCode:"",productName:""})},showMainRisk:{type:Boolean,default:()=>!0},defaultValue:{type:Object,default:()=>{}}},emits:["trialChange"],setup(e,{emit:i}){const a=e,t=l({loading:!1,show:!0,select:{},list:[],userData:{},riskIsInsure:{},submitData:{},disabledRiskInfo:[],risksDefaultValue:{}}),n=e=>{const i=[];return e.riskLiabilityInfoVOList.map((e=>(1!=+e.showFlag&&i.push({...e}),[]))),i},p=(e,l,n)=>{var s;t.riskIsInsure[l].data=e;const o=[...t.disabledRiskInfo];null==(s=a.dataSource.insureProductRiskVOList)||s.forEach((e=>{if(1!==e.mainRiskFlag){const i=t.riskIsInsure[e.riskId];i.data&&Object.keys(i.data).length>0&&"1"===i.selected&&o.push(i.data)}})),i("trialChange",o,n)},v=(e,i)=>{var l;null==(l=a.dataSource.productRiskRelationVOList)||l.forEach((a=>{1!==a.collocationType&&(i.riskId===a.riskId?(t.riskIsInsure[i.riskId]&&t.riskIsInsure[i.riskId].selected,2===a.collocationType&&t.riskIsInsure[a.collocationRiskId]&&(t.riskIsInsure[a.collocationRiskId].selected=e),3===a.collocationType&&t.riskIsInsure[a.collocationRiskId]&&"1"===e&&(t.riskIsInsure[a.collocationRiskId].selected="1"===e?"2":"1")):i.riskId===a.collocationRiskId&&(3===a.collocationType&&"1"===e&&t.riskIsInsure[a.riskId]&&(t.riskIsInsure[a.riskId].selected="1"===e?"2":"1"),2===a.collocationType&&t.riskIsInsure[a.riskId]&&(t.riskIsInsure[a.riskId].selected=e)))})),"2"===e?p({},i.riskId):(e=>{var i,a,l,t,s,o,r,u,d,c,m,v;if(1!==(null==e?void 0:e.factorDisPlayFlag)){const f=null==(i=null==e?void 0:e.productRiskInsureLimitVO)?void 0:i.amountPremiumConfigVO,y={riskCategory:e.riskCategory,riskCode:e.riskCode,riskName:e.riskName,riskId:e.riskId,riskType:e.riskType,mainRiskId:e.mainRiskId,mainRiskCode:e.mainRiskCode,liabilityList:n(e)};y.chargePeriod=(null==(l=null==(a=null==e?void 0:e.productRiskInsureLimitVO)?void 0:a.paymentPeriodValueList)?void 0:l.length)>0&&(null==(t=null==e?void 0:e.productRiskInsureLimitVO)?void 0:t.paymentPeriodValueList[0].code)||null,y.coveragePeriod=(null==(o=null==(s=null==e?void 0:e.productRiskInsureLimitVO)?void 0:s.insurancePeriodValueList)?void 0:o.length)>0&&(null==(r=null==e?void 0:e.productRiskInsureLimitVO)?void 0:r.insurancePeriodValueList[0].code)||null,y.paymentFrequency=(null==(d=null==(u=null==e?void 0:e.productRiskInsureLimitVO)?void 0:u.paymentFrequencyList)?void 0:d.length)>0&&(null==(c=null==e?void 0:e.productRiskInsureLimitVO)?void 0:c.paymentFrequencyList[0].code)||null;let k=0;1===f.displayType?k=(null==f?void 0:f.minStepValue)>0?null==f?void 0:f.minStepValue:0:3===f.displayType&&2===f.requireCopies?k=(null==(m=null==f?void 0:f.displayValues)?void 0:m.length)>0?null==f?void 0:f.displayValues[0].value:0:3===f.displayType&&1===f.requireCopies?(k=(null==(v=null==f?void 0:f.displayValues)?void 0:v.length)>0?null==f?void 0:f.displayValues[0].value:0,y.copy=f.minCopiesValue):2===f.displayType?y.copy=f.minCopiesValue:k=0,1===f.saleMethod?y.initialAmount=k:y.initialPremium=k,p(y,e.riskId)}})(i)};return le((()=>{(()=>{var e,i;t.disabledRiskInfo=[];let l=null;if(null==(e=a.dataSource.insureProductRiskVOList)||e.forEach((e=>{var i;const n=1!==e.mainRiskFlag?null==(i=a.dataSource.productRiskRelationVOList)?void 0:i.find((i=>i.collocationRiskId===e.riskId)):{};1===e.mainRiskFlag&&(l=e),t.riskIsInsure[e.riskId]?(t.riskIsInsure[e.riskId].data=null,t.riskIsInsure[e.riskId].relation=n,t.riskIsInsure[e.riskId].isMust=!1):t.riskIsInsure[e.riskId]={selected:"2",data:null,relation:n,isMust:!1}})),l){const e=null==(i=a.dataSource.productRiskRelationVOList)?void 0:i.filter((e=>e.riskId===l.riskId));if(!e)return;null==e||e.forEach((e=>{var i,l,s,o,r,u,d,c,m,v,f,y,k,g,h;if(2===e.collocationType){t.riskIsInsure[e.collocationRiskId].selected="1",t.riskIsInsure[e.collocationRiskId].isMust=!0;const V=null==(i=a.dataSource.insureProductRiskVOList)?void 0:i.find((i=>e.collocationRiskId===i.riskId));if(V&&1!==V.factorDisPlayFlag&&(null==(l=null==V?void 0:V.productRiskInsureLimitVO)?void 0:l.amountPremiumConfigVO)){const i=null==(s=V.riskLiabilityInfoVOList)?void 0:s.every((e=>1!==e.showFlag)),a=null==(o=null==V?void 0:V.productRiskInsureLimitVO)?void 0:o.amountPremiumConfigVO;if(i){t.riskIsInsure[e.collocationRiskId].isDisabled=!0;const i={riskCategory:V.riskCategory,riskCode:V.riskCode,riskName:V.riskName,riskId:V.riskId,riskType:V.riskType,mainRiskId:V.mainRiskId,mainRiskCode:V.mainRiskCode,liabilityList:n(V)};i.chargePeriod=(null==(u=null==(r=null==V?void 0:V.productRiskInsureLimitVO)?void 0:r.paymentPeriodValueList)?void 0:u.length)>0&&(null==(d=null==V?void 0:V.productRiskInsureLimitVO)?void 0:d.paymentPeriodValueList[0].code)||null,i.coveragePeriod=(null==(m=null==(c=null==V?void 0:V.productRiskInsureLimitVO)?void 0:c.insurancePeriodValueList)?void 0:m.length)>0&&(null==(v=null==V?void 0:V.productRiskInsureLimitVO)?void 0:v.insurancePeriodValueList[0].code)||null,i.paymentFrequency=(null==(y=null==(f=null==V?void 0:V.productRiskInsureLimitVO)?void 0:f.paymentFrequencyList)?void 0:y.length)>0&&(null==(k=null==V?void 0:V.productRiskInsureLimitVO)?void 0:k.paymentFrequencyList[0].code)||null;let l=0;1===a.displayType?l=(null==a?void 0:a.minStepValue)>0?null==a?void 0:a.minStepValue:0:3===a.displayType&&2===a.requireCopies?l=(null==(g=null==a?void 0:a.displayValues)?void 0:g.length)>0?null==a?void 0:a.displayValues[0].value:0:3===a.displayType&&1===a.requireCopies?(l=(null==(h=null==a?void 0:a.displayValues)?void 0:h.length)>0?null==a?void 0:a.displayValues[0].value:0,i.copy=a.minCopiesValue):2===a.displayType&&(i.copy=a.minCopiesValue),1===a.saleMethod?i.initialAmount=l:i.initialPremium=l,t.disabledRiskInfo.push(i),p(i,V.riskId)}}}3===e.collocationType&&(t.riskIsInsure[e.collocationRiskId].selected="2",t.riskIsInsure[e.collocationRiskId].isMust=!0)}))}})()})),s((()=>{t.loading=!0})),o((()=>t.riskIsInsure),(e=>{}),{deep:!0,immediate:!0}),o((()=>a.defaultValue),(e=>{(null==e?void 0:e.length)>0&&e.forEach((e=>{t.risksDefaultValue[e.riskCode]=e,t.riskIsInsure[e.riskId]?(t.riskIsInsure[e.riskId].selected="1",p(e,e.riskId)):t.riskIsInsure[e.riskId]={selected:"1",isMust:!1}}))}),{deep:!0,immediate:!0}),(i,a)=>{const l=W,n=h;return r(!0),u(k,null,x(e.dataSource.insureProductRiskVOList,(a=>{var s,o;return r(),u(k,{key:a.riskCode},[(!e.showMainRisk&&1!==a.mainRiskFlag||e.showMainRisk)&&(null==(o=null==(s=m(t).riskIsInsure)?void 0:s[a.riskId])?void 0:o.relation)?(r(),u("div",sa,[d(n,{modelValue:m(t).riskIsInsure[a.riskId].selected,"onUpdate:modelValue":e=>m(t).riskIsInsure[a.riskId].selected=e,label:a.riskName,name:"selected","label-width":"50%",border:!1,class:"risk-select-field risk-name"},{input:c((()=>[d(l,{modelValue:m(t).riskIsInsure[a.riskId].selected,"onUpdate:modelValue":e=>m(t).riskIsInsure[a.riskId].selected=e,"active-value":"1","inactive-value":"2",size:"0.68rem",disabled:m(t).riskIsInsure[a.riskId].isMust,style:{"margin-right":"8px"},onChange:e=>v(e,a)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])])),_:2},1032,["modelValue","onUpdate:modelValue","label"]),"1"===m(t).riskIsInsure[a.riskId].selected?(r(),u("div",oa,[d(na,{modelValue:m(t).riskIsInsure[a.riskId].data,"onUpdate:modelValue":e=>m(t).riskIsInsure[a.riskId].data=e,"origin-data":a,"product-factor":e.dataSource.productFactor,"default-value":m(t).risksDefaultValue[a.riskCode],onTrialChange:(e,i)=>p(e,a.riskId,i)},null,8,["modelValue","onUpdate:modelValue","origin-data","product-factor","default-value","onTrialChange"])])):y("",!0),1===a.exemptFlag&&"1"===m(t).riskIsInsure[a.riskId].selected?O(i.$slots,"holderForm",{key:1},void 0,!0):y("",!0)])):y("",!0)],64)})),128)}}}),[["__scopeId","data-v-58a61f59"]]);const da={class:"pro-radio-wrap"},ca=a({name:"PlanSelect"}),pa=a({...ca,props:{planList:{default:()=>[]},defaultPlan:{default:()=>{}}},emits:["planChange"],setup(e,{emit:i}){const a=e,l=t("");let n=!1;return s((()=>{a.defaultPlan&&(n=!0,l.value=a.defaultPlan.planCode)})),o((()=>l),(e=>{n||i("planChange",l.value),n&&(n=!1)}),{deep:!0,immediate:!0}),(e,i)=>{const t=V,n=h;return e.planList.length>0?(r(),v(n,{key:0,modelValue:l.value,"onUpdate:modelValue":i[1]||(i[1]=e=>l.value=e),label:"保障计划",name:"planCode",class:"risk-select-field"},{input:c((()=>[p("div",da,[d(t,{modelValue:l.value,"onUpdate:modelValue":i[0]||(i[0]=e=>l.value=e),options:a.planList.map((e=>({label:e.planName,value:e.planCode})))},null,8,["modelValue","options"])])])),_:1},8,["modelValue"])):y("",!0)}}}),ma=(e,i,a)=>{const l=e,{holder:t}=a,n=a.insuredList[0],s=(i||"").split("_");if(s.length<2)return i;if(ei(Number(s[1])))return i;if(s[1]-=1,1===l.exemptFlag){if("to"===s[0]){let e=0;1===l.exemptType?(null==t?void 0:t.birthday)&&(e=parseInt(""+((new Date).getTime()-new Date(t.birthday).getTime())/31536e6,10)):2===l.exemptType&&(null==n?void 0:n.birthday)&&(e=parseInt(""+(+(new Date).getTime()-new Date(n.birthday).getTime())/31536e6,10)),s[1]=+s[1]-e}s[0]="year"}return s.join("_")},va=(e,i)=>{const a=[],l={};return null==e||e.forEach((e=>{l[e.riskId]=e})),null==i||i.forEach((e=>{var i,t,n,s;const{collocationType:o,collocationRiskId:r,riskId:u}=e;switch(o){case 2:{const e=null==(i=l[u])?void 0:i.riskName,n=null==(t=l[r])?void 0:t.riskName;a.push(`${e} 和 ${n} 必须同时投保`);break}case 3:{const e=null==(n=l[u])?void 0:n.riskName,i=null==(s=l[r])?void 0:s.riskName;a.push(`${e} 和 ${i} 不能同时投保`);break}}})),a};const fa={class:"com-body"},ya={class:"trial-body"},ka={class:"container"},ga={class:"container"},ha={class:"container"},Va=(e=>(X("data-v-48af32c8"),e=e(),Z(),e))((()=>p("div",{class:"empty"},null,-1))),Ia=a({name:"TrialBody"});var ba=g(a({...Ia,props:{selfKey:{default:""},dataSource:{default:()=>[]},productInfo:{default:()=>({productCode:"",productName:"",insurerCode:"",tenantId:"",planList:[]})},tenantProductDetail:{default:()=>({})},hideBenefit:{type:Boolean,default:!1},hidePopupButton:{type:Boolean,default:!1},title:{default:"算一算保费"},defaultData:{default:null},isTrial:{type:Boolean,default:!1},defaultOrder:{default:()=>({})}},emits:["trialStart","trialEnd","update:userData","closeCustomerPopoup"],setup(e,{expose:i,emit:a}){const f=e,k=t(null),g=E();te();const{tenantId:h,templateId:V,preview:I}=g.query,b=t(),L=l({loading:!1,show:!1,select:{},list:[],userData:{},riskIsInsure:{},submitData:{},riskList:[{}],mainRiskVO:{},ifPersonalInfoSuccess:!1,trialMsg:"",trialResultPremium:0,trialResult:{initialPremium:0,initialAmount:0},isAniShow:!1,defaultValue:null,isAutoChange:!1,planIndex:0,isSkipFirstTrial:!1,hadSkipFirstTrial:!1,isQuerying:!1,currentPlanCode:""}),C=Fe();t();const w=t(),T=t(f.dataSource),R=t([]),P=e=>{const{holder:i,insuredList:a}=e||{};i&&(L.submitData.holder=i),a&&a.length>0&&a.forEach(((e,i)=>{var a;L.submitData.insuredList&&L.submitData.insuredList.length>i?L.submitData.insuredList[i]=e:((null==(a=L.submitData)?void 0:a.insuredList)||(L.submitData.insuredList=[]),L.submitData.insuredList.push(e))}))},D=n((()=>f.productInfo.planList&&f.productInfo.planList.length>2)),x=(e,i)=>{if(e){const a=["birthday","age","gender","id"];i.includes("occupationCodeList")&&a.push("occupationClass"),Object.keys(e).forEach((l=>{[...i,...a].includes(l)||(e[l]=null)}))}},A=e=>{console.log("我是客户数据",e),a("closeCustomerPopoup",e)},F=(e,i=(e=>!0))=>S(e)?e.filter(i).map((e=>e.code)):[],N=()=>{console.log("--current plan = ",T.value),console.log("---current submit = ",L.submitData);const e=Ee(L.submitData);if(!D.value)return e;const{1:i,2:a,3:l}=T.value.productFactor||{};if(e.holder&&x(e.holder,F(i)),e.insuredList){const i=["productList","beneficiaryList"],t=F(a,(e=>"2"!==String(e.subModuleType))),n=F(a,(e=>"2"===String(e.subModuleType))),s=S(n),o=F(l),r=S(o);e.insuredList.forEach(((e,a)=>{var l,u,d;x(e,[...a>=1&&s?n:t,...i,...r?["insuredBeneficiaryType"]:[]]),(null==(l=e.beneficiaryList)?void 0:l.length)>0&&(r?e.beneficiaryList.forEach((e=>x(e,o))):e.beneficiaryList.length=0),e.planCode=T.value.planCode;const c=(null==(d=null==(u=e.productList)?void 0:u[0])?void 0:d.riskList)||[],p=T.value.insureProductRiskVOList||[];if(c.length&&p){const i=c.filter((e=>null!==p.find((i=>i.riskCode===e.riskCode))));e.productList[0].riskList=i}}))}return e},_=t(),j=t({}),U=["annuityDrawDate","coveragePeriod","chargePeriod","paymentFrequency"],M=e=>{var i,a,l,t,n,s;if(null==(a=null==(i=null==e?void 0:e.data)?void 0:i[0])?void 0:a.productRiskDyInsureFactorVOList){const i=[];if(null==(l=T.value)||l.insureProductRiskVOList.forEach((a=>{var l,t;const n=null==(t=null==(l=null==e?void 0:e.data)?void 0:l[0])?void 0:t.productRiskDyInsureFactorVOList.find((e=>e.riskCode===a.riskCode));if(n){a.productRiskInsureLimitVO={...a.productRiskInsureLimitVO,...n};const e=L.riskList.find((e=>e.riskCode===a.riskCode));let l=!1;Ne.forEach((i=>{if(U.indexOf(i.valueKey)>=0){const t=a.productRiskInsureLimitVO[i.configKey];if(t&&e){const a=t.find((a=>a.code===e[i.valueKey]));if(a&&2===a.useFlag){const a=t.find((e=>1===e.defaultFlag));e[i.valueKey]=a.code,l=!0}}}})),l&&i.push({...e,...n,riskCode:a.riskCode})}})),i.length>0&&(null==(s=null==(n=null==(t=L.defaultValue)?void 0:t.insuredList)?void 0:n[0])?void 0:s.productList))return i.forEach((e=>{var i,a,l;L.defaultValue.insuredList[0].productList=null==(l=null==(a=null==(i=L.defaultValue)?void 0:i.insuredList)?void 0:a[0])?void 0:l.productList.map((i=>(i.riskList=null==i?void 0:i.riskList.map((i=>(i.riskCode===e.riskCode&&(i=e),i))),i)))})),!1}return!0},q=B((async(e,i=!0)=>{L.trialMsg="试算中...",L.trialResultPremium=0,L.loading=!0,a("trialStart");let l=!1;if(i){const{code:i}=await Ie(e);l="10000"===i}!l&&i||(L.isQuerying=!0,f.hideBenefit||be(e).then((e=>{e.data&&e.code===ne&&(j.value=e.data)})).finally((()=>{L.loading=!1})),Le(e).then((i=>{var l,t;if(i.data&&i.code===ne){(null==(l=null==i?void 0:i.data)?void 0:l.errorInfo)&&K(`${null==(t=null==i?void 0:i.data)?void 0:t.errorInfo}`),L.trialMsg="",L.trialResultPremium=i.data.initialPremium,L.trialResult=i.data;const n={};i.data.riskPremiumDetailVOList&&i.data.riskPremiumDetailVOList.length&&i.data.riskPremiumDetailVOList.forEach((e=>{n[e.riskCode]={initialAmount:e.initialAmount,initialPremium:e.initialPremium}})),_.value=n,a("trialEnd",i.data,e)}})).finally((()=>{L.loading=!1,L.isQuerying=!1})))}),500),$=B((async()=>{console.log(">>>>>调用试算<<<<<",L.ifPersonalInfoSuccess,b.value.canTrail());const{productCode:e,productName:i}=f.productInfo||{};if(L.ifPersonalInfoSuccess||b.value.canTrail()){L.submitData.productCode=e,L.submitData.productName=i,L.submitData.tenantId=f.productInfo.tenantId,L.riskList=L.riskList.map((e=>(e=>{var i,a,l,t;const n=null==(i=T.value.insureProductRiskVOList)?void 0:i.find((i=>e.riskId===i.riskId));if(n&&1!==n.mainRiskFlag){const i=null==(l=null==(a=T.value)?void 0:a.productRiskRelationVOList)?void 0:l.filter((e=>{var i;if(e.collocationRiskId===n.riskId&&3!==e.collocationType){const a=null==(i=T.value.insureProductRiskVOList)?void 0:i.find((i=>e.riskId===i.riskId));if(a&&a.riskType===We.MAIN_RISK)return!0}return!1})),s=i.length>0?i[0]:null;if(s){const i=null==(t=L.riskList)?void 0:t.find((e=>e.riskId===s.riskId));Ne.forEach((a=>{a.ruleKey&&n.productRiskInsureLimitVO&&i&&(1===n.productRiskInsureLimitVO[a.ruleKey]&&(e[a.valueKey]=i[a.valueKey]),3===n.productRiskInsureLimitVO[a.ruleKey]&&(1!==n.exemptFlag?e[a.valueKey]=ma(n,i[a.valueKey],L.submitData):e[a.valueKey]=ma(n,i[a.ruleValueKey],L.submitData)))}))}}return e})(e))),L.submitData.insuredList&&L.submitData.insuredList.forEach((a=>{a.productList=[{productCode:e,productName:i,riskList:L.riskList}]}));const a=N();console.log(">>>数据构建<<<",a),await q(a)}}),300),J=async e=>{console.log("人的信息更改了"),P(e),L.ifPersonalInfoSuccess=!0,console.log("处理第一被保人修改的dy变化"),$()};n((()=>{var e;return((null==(e=L.userData)?void 0:e.insuredList)||[]).map((e=>e.birthday)).join(",")})),o((()=>{var e;return((null==(e=L.userData)?void 0:e.insuredList)||[]).map((e=>e.birthday)).join(",")}),B((async e=>{var i;if(T.value.insureProductRiskVOList&&e){const e=L.userData.insuredList.filter((e=>e.birthday))||[];if(!e.length)return;const a=await Ce({calcProductFactorList:[{planCode:T.value.planCode,productCode:f.productInfo.productCode,riskEditVOList:[{insureProductRiskVO:null==(i=T.value.insureProductRiskVOList)?void 0:i[0]}]}],insuredVOList:e});M(a)}})),{});const H=async(e,i)=>{var a,l;if(i){const t=Ee(e);delete t.insurancePeriodValueList,delete t.paymentFrequencyList,delete t.paymentPeriodValueList;if(U.indexOf(i.key)>=0&&`${i.oldValue}`!=`${i.newValue}`){const n={};switch(i.key){case"annuityDrawDate":n.changeType=3;break;case"coveragePeriod":n.changeType=2;break;case"chargePeriod":n.changeType=1;break;case"paymentFrequency":n.changeType=4}const s=null==(l=null==(a=T.value)?void 0:a.insureProductRiskVOList)?void 0:l.find((i=>i.riskCode===e.riskCode));if(!L.isAutoChange){L.isQuerying=!0;const i=L.userData.insuredList.filter((e=>e.birthday))||[];if(!i.length)return!1;const a=await Ce({calcProductFactorList:[{planCode:T.value.planCode,productCode:f.productInfo.productCode,riskEditVOList:[{insureProductRiskVO:s,insureRiskEditReqVO:{riskId:e.riskId,riskCode:e.riskCode,...t,...n}}]}],insuredVOList:i});L.isQuerying=!1;const l=M(a);return l||(L.isAutoChange=!0),l}L.isAutoChange=!1}}return!0},G=async(e,i)=>{L.mainRiskVO=e;await H(e,i)&&(L.riskList.length>0&&(L.riskList[0]=e),console.log("标准险种的信息回传",e),$())},z=async(e,i)=>{if(L.riskList=[L.mainRiskVO,...e],console.log("附加险列表数据回传",e),i){const a=e.find((e=>e.riskCode===i.riskCode));if(!(await H(a,i)))return}$()},Q=e=>{var i,a,l,t;L.userData=e,L.defaultValue=e;const n=(null==(i=e.insuredList)?void 0:i[0].productList.findIndex((e=>e.planCode===T.value.planCode)))||0;L.planIndex=-1===n?0:n,L.riskList=(null==(t=null==(l=null==(a=null==e?void 0:e.insuredList)?void 0:a[0].productList)?void 0:l[L.planIndex])?void 0:t.riskList)||[],q(e,!0)},Y=async e=>{var i;if(f.defaultData){const e=f.defaultData.find((e=>e.productCode===f.productInfo.productCode))||f.defaultData[0];Q(e),P(null==(i=f.defaultData)?void 0:i[0])}else R.value.push(T.value.planCode),await(async()=>{var e;const i=await Oe({calcProductFactorList:[{planCode:T.value.planCode,productCode:f.productInfo.productCode}]});if(i.data){const a=i.data.find((e=>e.productCode===f.productInfo.productCode))||i.data[0];Q(a),P(null==(e=i.data)?void 0:e[0])}})()},X=async e=>{var i,a;const l=f.productInfo.planList.findIndex((i=>i.planCode===e)),t=(null==(a=null==(i=L.defaultValue)?void 0:i.insuredList)?void 0:a[0].productList.findIndex((i=>i.planCode===e)))||0,n=l>=0?f.productInfo.planList[l]:null;n&&(L.currentPlanCode=e,T.value=n,L.planIndex=t>=0?t:0,L.defaultValue.insuredList[0].productList[L.planIndex].riskList=L.riskList,R.value.findIndex((i=>i===e))<0&&R.value.push(e))};le((()=>{var e,i;L.select={},L.list=[],L.userData={},L.riskIsInsure={},L.submitData={},L.riskList=[{}],L.mainRiskVO={},L.ifPersonalInfoSuccess=!1,L.trialMsg="",L.trialResultPremium=0,L.riskIsInsure={},null==(i=null==(e=T.value)?void 0:e.insureProductRiskVOList)||i.forEach((e=>{var i;const a=null==(i=T.value.productRiskRelationVOList)?void 0:i.find((i=>i.collocationRiskId===e.riskId));a&&(L.riskIsInsure[e.riskCode]={selected:"2",data:null,relation:a})}))})),s((()=>{T.value=f.dataSource,L.loading=!0,L.show=!0,L.isAniShow=!0,L.isSkipFirstTrial=!0,L.hadSkipFirstTrial=!1,se((()=>{Y()}))}));return i({getTrialSuccessFlag:()=>L.trialResultPremium>0,validate:()=>b.value.validate(!1),validateTrialFields:()=>b.value.validateTrialFields(),validateHolder:e=>{var i;return null==(i=b.value)?void 0:i.validateHolder(e)},getUserData:()=>({...L.userData}),onShare:e=>{var i;L.trialResultPremium&&(null==(i=k.value)||i.validate().then((()=>{Object.assign(C.value,f.defaultOrder,{extInfo:{...C.value.extInfo,buttonCode:je.TRIAL_PREMIUM,pageCode:_e.TRIAL_PREMIUM,templateId:V}});const i=Ue(f.productInfo,_.value,C.value);Pe(i,((i,a)=>{a===re.JUMP_PAGE&&(w.value.link=`${window.location.href}&isShare=1&orderNo=${i.orderNo}`,e())})),console.log("---- validate success ----")})))},onNext:()=>{var e;const{productCode:i,productName:a}=f.productInfo;I?oe(_e.TRIAL_PREMIUM,g.query):L.trialResultPremium&&(null==(e=k.value)||e.validate().then((()=>{Object.assign(C.value,f.defaultOrder,{extInfo:{templateId:V,...C.value.extInfo,...f.defaultOrder.extInfo||{},buttonCode:je.TRIAL_PREMIUM,pageCode:_e.TRIAL_PREMIUM}}),console.log("dealMixData()",N());const e=Ue({...N(),productCode:i,productName:a},L.trialResult,C.value);Pe(e,((e,i)=>{i===re.JUMP_PAGE&&ue(e.nextPageCode,{...g.query,orderNo:e.orderNo})})),console.log("---- validate success ----")})),L.loading=!1,L.show=!0,L.isAniShow=!0)},dealMixData:N}),o((()=>L.riskIsInsure),(e=>{}),{deep:!0,immediate:!0}),o((()=>L.userData),(e=>{if(e){const{holder:i,insuredList:l}=e||{},t={holder:i,insuredList:l};Object.assign(L.submitData,t),a("update:userData",t)}}),{deep:!0}),o((()=>f.dataSource),(e=>{T.value=e}),{deep:!0,immediate:!0}),(e,i)=>{var a,l,t,n,s,o,f,g;const h=de;return r(),u("div",fa,[O(e.$slots,"trialHead",{},void 0,!0),p("div",ya,[d(ke,{labels:m(va)((null==(a=T.value)?void 0:a.insureProductRiskVOList)||[],T.value.productRiskRelationVOList)},null,8,["labels"]),p("div",ka,[!e.hideBenefit&&(null==(l=j.value)?void 0:l.benefitRiskResultVOList)?(r(),v(Ze,{key:0,class:"benefit-wrap","data-source":j.value,"product-info":T.value,"show-type-list":j.value.showTypList},null,8,["data-source","product-info","show-type-list"])):y("",!0),m(D)?(r(),v(pa,{key:1,"plan-list":e.productInfo.planList,"default-plan":T.value,onPlanChange:X},null,8,["plan-list","default-plan"])):y("",!0),T.value.productFactor?(r(),v(m(zi),{ref_key:"personalInfoRef",ref:b,key:T.value.planCode,modelValue:m(L).userData,"onUpdate:modelValue":i[0]||(i[0]=e=>m(L).userData=e),"is-trial":e.isTrial,"product-factor":T.value.productFactor,"multi-insured-config":null==(t=T.value)?void 0:t.multiInsuredConfigVO,onTrailChange:J,onCloseCustomerPopoup:A},null,8,["modelValue","is-trial","product-factor","multi-insured-config"])):y("",!0)]),d(h,{size:"large"}),p("div",ga,[(r(),v(na,{ref_key:"insureInfosRef",ref:k,key:T.value.planCode,"origin-data":null==(n=T.value.insureProductRiskVOList)?void 0:n[0],"product-factor":T.value.productFactor,"default-value":m(L).defaultValue?null==(o=null==(s=m(L).defaultValue)?void 0:s.insuredList[0].productList[m(L).planIndex])?void 0:o.riskList[0]:null,"trial-result":m(L).trialResult,onTrialChange:G},null,8,["origin-data","product-factor","default-value","trial-result"]))]),p("div",ha,[T.value.insureProductRiskVOList?(r(),v(ua,{key:T.value.planCode,"data-source":T.value,"show-main-risk":!1,"default-value":m(L).defaultValue?null==(g=null==(f=m(L).defaultValue)?void 0:f.insuredList[0].productList[m(L).planIndex])?void 0:g.riskList:[],onTrialChange:z},{holderForm:c((()=>{var a;return[e.isTrial&&e.dataSource.productFactor?(r(),v(m(zi),{key:0,ref_key:"personalInfoRef",ref:b,modelValue:m(L).userData,"onUpdate:modelValue":i[1]||(i[1]=e=>m(L).userData=e),"is-trial":e.isTrial,"is-only-holder":!0,"product-factor":e.dataSource.productFactor,"multi-insured-config":null==(a=e.dataSource)?void 0:a.multiInsuredConfigVO,onTrailChange:J},null,8,["modelValue","is-trial","product-factor","multi-insured-config"])):y("",!0)]})),_:1},8,["data-source","default-value"])):y("",!0)]),Va]),O(e.$slots,"trialBtn",{trialData:m(L).submitData,riskPremium:m(L).trialResult,loading:m(L).isQuerying,personalInfoRef:b.value},void 0,!0)])}}}),[["__scopeId","data-v-48af32c8"]]);const La={class:"long-info-collection"},Ca=a({__name:"infoCollection",setup(e){const i=ce((()=>pe((()=>import("./index-b42e8056.js")),["static/js/index-b42e8056.js","static/css/index-fa4edf2a.css","static/js/index-71971dfc.js","static/css/index-df050663.css","static/js/theme-94cf7d00.js","static/js/index-01a1649c.js","static/css/index-bbfdd7ec.css","static/js/utils-c7893755.js","static/js/infoCollection-a3fc6546.js","static/js/trial-a511ee66.js"]))),a=ce((()=>pe((()=>import("./index-8ab3a768.js")),["static/js/index-8ab3a768.js","static/css/index-793d1580.css","static/js/index-71971dfc.js","static/css/index-df050663.css"]))),s=E(),o=Fe(),{productCode:p="",tenantId:f,agentCode:k="",agencyCode:g,saleChannelId:h,isShare:V,orderNo:I,extraInfo:b,insurerCode:L,preview:C}=s.query;let O={};try{O=JSON.parse(decodeURIComponent(b))}catch(ke){}const w=l({isView:!1,personalInfo:{},payInfo:{schema:[],config:[],formData:[]},defaultValue:null,isAutoChange:!1,defaultPlanCode:"",userData:{}}),T=`${window.origin}/baseInsurance/long/phoneVerify${window.location.search}`,R=t({imgUrl:"",desc:"",title:"",link:T}),P=t();t();const S=t(),D=t({}),x=t({}),F=t([]),N=t(),_=t({}),j=t(!1),U=t(!1),M=t(0),B=t(!0),{fileList:q,mustReadFileCount:$,popupFileList:J}=Se(_,N),G=t(!1),z=t(!1),Q=()=>{U.value=!1,B.value=!0,F.value.length<1||(j.value=!0)},Y=()=>{j.value=!1,U.value=!1,B.value=!0};t({}),t(!1),t([{}]);const X=t(""),Z=t(0),W=t(!1);t(),t(),t(),n((()=>{var e,i;const{insureProductRiskVOList:a}=(null==(i=null==(e=x.value)?void 0:e.productPlanInsureVOList)?void 0:i[0])||{};return(a||[]).find((e=>e.mainRiskFlag===ie.YES))}));const ee=t(0);t({});const ae=t(),te=()=>{X.value="试算中...",Z.value=0,W.value=!0},ne=(e,i)=>{X.value="",ee.value=e.premium,Z.value=e,ae.value=i,W.value=!1},se=async()=>{var e,i;if(C)return void oe(_e.INFO_COLLECTION,s.query);if(!Z.value)return;const a=[];S.value&&a.push(null==(e=S.value)?void 0:e.validate(!1)),P.value&&a.push(null==(i=P.value)?void 0:i.validate(!1)),Promise.all(a).then((()=>{if(!G.value)return void K("请勾选投保人阅读并接受");Object.assign(o.value,{extInfo:{...o.value.extInfo,buttonCode:je.INFO_COLLECTION,pageCode:_e.INFO_COLLECTION}});const e=S.value.dealMixData(),i=Ue({...e,productCode:p,productName:x.value.productName},Z.value,o.value);Pe(i,((e,i)=>{i===re.JUMP_PAGE&&ue(e.nextPageCode,s.query)}))}))};l({tenantOrderPayInfoList:[]});const de=async()=>{De({productCode:p,tenantId:f}).then((({data:e,code:i})=>{if("10000"===i){D.value=e;const{wxShareConfig:i,showWXShare:a,title:l,desc:t,image:n}=(null==e?void 0:e.PRODUCT_LIST)||{};a?Object.assign(R.value,{...i,imgUrl:i.image,isShare:a}):Object.assign(R.value,{title:l,desc:t,imgUrl:n,isShare:a}),e.BASIC_INFO&&e.BASIC_INFO.themeType&&ve(e.BASIC_INFO.themeType)}})),I&&await we({orderNo:I,tenantId:f}).then((({code:e,data:i})=>{var a;if("10000"===e){if(Z.value=i.orderAmount,(null==(a=i.insuredList)?void 0:a.length)>0){const{planCode:e}=i.insuredList[0];w.defaultPlanCode=e}Object.assign(o.value,i,{tenantOrderPayInfoList:i.tenantOrderPayInfoList||[],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0,withPayInfo:!0},productCode:p}),w.defaultValue=o.value,z.value=!0}})),xe({productCode:p}).then((({code:e,data:i})=>{var a,l,t,n;if("10000"===e){const{productMaterialPlanVOList:e,productQuestionnaireVOList:s}=i;N.value=e||[];const{basicInfo:{questionnaireType:o},questions:r,questionnaireName:u}=(null==(a=null==s?void 0:s[0])?void 0:a.questionnaireDetailResponseVO)||{basicInfo:{}};o&&(F.value=2===o?[{attachmentName:u,attachmentUri:r,attachmentType:"question"}]:[{attachmentName:u,attachmentUri:null==(l=null==r?void 0:r[0])?void 0:l.content,attachmentType:Ae(String(null==(t=null==r?void 0:r[0])?void 0:t.textType),null==(n=null==r?void 0:r[0])?void 0:n.content)}])}})),await Te({productCode:p,isTenant:!C}).then((({data:e,code:i})=>{var a;if("10000"===i){x.value=e,_.value=e.productPlanInsureVOList.find((e=>!w.defaultPlanCode||e.planCode===w.defaultPlanCode))||{};const{payInfo:i}=H(null==(a=_.value)?void 0:a.productFactor);w.payInfo={...w.payInfo,...i}}}))};return le((()=>{de()})),(e,l)=>{var t,n,s,k,g,h;const I=fe,b=ye;return r(),u("div",La,[d(I),m(z)||m(C)?(r(),v(ba,{key:0,ref_key:"personalInfoRef",ref:S,"data-source":m(_),"product-info":{productCode:m(p),productName:m(x).productName,insurerCode:m(L),tenantId:m(f),planList:m(x).productPlanInsureVOList},"tenant-product-detail":m(D),"hide-benefit":"","default-data":[m(w).defaultValue],onTrialStart:te,onTrialEnd:ne,"onUpdate:userData":l[0]||(l[0]=e=>m(w).userData=e)},null,8,["data-source","product-info","tenant-product-detail","default-data"])):y("",!0),m(w).payInfo.schema.length?(r(),v(m(ge),{key:1,ref_key:"payInfoRef",ref:P,modelValue:m(o).tenantOrderPayInfoList,"onUpdate:modelValue":l[1]||(l[1]=e=>m(o).tenantOrderPayInfoList=e),schema:m(w).payInfo.schema,"is-view":m(w).isView,"user-data":m(w).userData},null,8,["modelValue","schema","is-view","user-data"])):y("",!0),d(b,null,{default:c((()=>{var e;return[(null==(e=m(q))?void 0:e.length)?(r(),v(m(a),{key:0,modelValue:m(G),"onUpdate:modelValue":l[2]||(l[2]=e=>me(G)?G.value=e:null),"has-bg-color":!1,"attachment-list":m(q),"is-show-radio":"","pre-text":"投保人阅读并接受",onPreviewFile:l[3]||(l[3]=e=>(e=>{M.value=e,U.value=!0})(e))},null,8,["modelValue","attachment-list"])):y("",!0)]})),_:1}),m(U)?(r(),v(m(i),{key:2,show:m(U),"onUpdate:show":l[4]||(l[4]=e=>me(U)?U.value=e:null),"content-list":m(B)?m(q):m(J),"is-only-view":m(B),"active-index":m(M),text:m(B)?"关闭":"我已逐页阅读并确认告知内容","force-read-count":m(B)?0:m($),onSubmit:Q,onOnCloseFilePreviewByMask:Y},null,8,["show","content-list","is-only-view","active-index","text","force-read-count"])):y("",!0),d(Re,{"is-share":m(R).isShare&&!m(V),premium:null==(t=m(Z))?void 0:t.initialPremium,"share-info":m(R),"loading-text":m(X),"payment-frequency":(null==(h=null==(g=null==(k=null==(s=null==(n=m(ae))?void 0:n.insuredList)?void 0:s[0].productList)?void 0:k[0].riskList)?void 0:g[0])?void 0:h.paymentFrequency)+"","tenant-product-detail":m(D),"handle-share":e=>(e=>{S.value.validateHolder(["mobile"]).then((()=>{Object.assign(o.value,{extInfo:{...o.value.extInfo,buttonCode:je.INFO_COLLECTION,pageCode:_e.INFO_COLLECTION}});const i=S.value.getUserData(),a=Ue({...ae.value,holder:null==i?void 0:i.holder},Z.value||{},o.value);Pe(a,((i,a)=>{a===re.JUMP_PAGE&&(null==e||e())}))})).catch((()=>{K("请录入投保人手机号后进行分享")}))})(e),disabled:!m(Z),onHandleClick:se},{default:c((()=>[A("下一步")])),_:1},8,["is-share","premium","share-info","loading-text","payment-frequency","tenant-product-detail","handle-share","disabled"])])}}});export{Ca as default};
