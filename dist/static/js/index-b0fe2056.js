var L=Object.defineProperty,U=Object.defineProperties;var M=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var N=(l,a,e)=>a in l?L(l,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[a]=e,D=(l,a)=>{for(var e in a||(a={}))O.call(a,e)&&N(l,e,a[e]);if(F)for(var e of F(a))z.call(a,e)&&N(l,e,a[e]);return l},V=(l,a)=>U(l,M(a));import{t as G}from"./theme-ea709837.js";import{h as Y,G as u,z as C,$ as H,Y as j,r as d,k as c,m as v,n as _,s as q,v as J,A as x,B as i,E as S,L as $}from"./vendor-b1b61443.js";const K={class:"item"},Q={class:"footer"},ee=Y({props:{show:{type:Boolean,default:!1},contentList:{type:Array,default:()=>[]},activeIndex:{type:Number,default:0},text:{type:String,default:""},beforeReadOverText:{type:String,default:"\u540C\u610F\uFF0C\u4E0B\u4E00\u6761"},forceReadCound:{type:Number,default:0}},emits:["update:show","submit","onCloseFilePreview"],setup(l,{emit:a}){const e=l,f=u(e.show),w=u(!0),r=u(e.contentList.map((t,s)=>V(D({},t),{disabled:!0,readDisabled:!0}))),o=u(e.activeIndex),p=u(0),k=u(null),R=C(()=>{var t,s;return(s=(t=r.value)==null?void 0:t[o.value])==null?void 0:s.attachmentUri}),P=C(()=>{var t;return(t=r.value[o.value])==null?void 0:t.readDisabled}),A=C(()=>o.value>=e.forceReadCound-1||p.value>=e.forceReadCound?!1:p.value<e.forceReadCound?o.value!==e.forceReadCound-1:!1),E=()=>{o.value+=1},I=()=>{a("update:show",!1),a("submit")};H(()=>e,()=>{f.value=e.show,o.value=e.activeIndex},{deep:!0,immediate:!0});const T=t=>{var s,m,b;if(t){const h=((s=t.target)==null?void 0:s.scrollHeight)||t.scrollHeight,g=((m=t.target)==null?void 0:m.scrollTop)||t.scrollTop,y=((b=t.target)==null?void 0:b.clientHeight)||t.clientHeight;Math.floor(h-g-15)<=y&&w.value&&r.value[o.value].readDisabled&&(r.value[o.value].disabled=!1,r.value[o.value].readDisabled=!1,r.value[o.value+1].disabled=!1,p.value+=1)}};return H(()=>o.value,()=>{w.value=!1,e.show&&(p.value>=e.forceReadCound&&r.value.forEach(t=>{t.disabled=!1,t.readDisabled=!1}),setTimeout(()=>{w.value=!0},800)),j(()=>{setTimeout(()=>{T(k.value)},2e3)})},{immediate:!0}),(t,s)=>{const m=d("ProTab"),b=d("ProFilePreview"),h=d("VanButton"),g=d("van-config-provider"),y=d("ProPopup");return c(),v(y,{show:f.value,"onUpdate:show":s[1]||(s[1]=n=>f.value=n),class:"file-preview-popup-wrap",closeable:!1,onClose:s[2]||(s[2]=n=>a("onCloseFilePreview"))},{default:_(()=>[q(g,{"theme-vars":i(G),class:"custom-provider"},{default:_(()=>[f.value?(c(),v(m,{key:0,active:o.value,"onUpdate:active":s[0]||(s[0]=n=>o.value=n),list:r.value.map((n,B)=>({title:n.attachmentName,disabled:B==o.value?!1:n.disabled||!1,slotName:`guarantee-${B}`})),class:"tab"},null,8,["active","list"])):J("",!0),x("div",{ref_key:"previewRef",ref:k,class:"list",onScroll:T},[x("div",K,[(c(),v(b,{key:i(R),content:i(R),type:"pdf","forbid-click":!0},null,8,["content"]))])],544),x("div",Q,[i(A)?(c(),v(h,{key:0,disabled:i(P),type:"primary",block:"",round:"",onClick:E},{default:_(()=>[S($(`${l.beforeReadOverText}(${o.value+1}/${l.forceReadCound})`),1)]),_:1},8,["disabled"])):(c(),v(h,{key:1,disabled:i(P),type:"primary",block:"",round:"",onClick:I},{default:_(()=>[S($(e.text),1)]),_:1},8,["disabled"]))])]),_:1},8,["theme-vars"])]),_:1},8,["show"])}}});export{ee as _};
