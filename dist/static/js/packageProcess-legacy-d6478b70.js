!function(){var e=document.createElement("style");e.innerHTML=".page-internet-product-detail[data-v-224d0f1e]{padding-bottom:2rem;background:#f1f5fc}.page-internet-product-detail .footer-button[data-v-224d0f1e]{justify-content:space-between}.page-internet-product-detail .price[data-v-224d0f1e]{color:#393d46;font-size:.45333rem;font-weight:400;display:flex;align-items:center}.page-internet-product-detail .price span[data-v-224d0f1e]{color:var(--van-primary-color);font-weight:700}.page-internet-product-detail .price .premium-loading[data-v-224d0f1e]{display:inline-block;line-height:.69333rem;margin-left:.4rem}.page-internet-product-detail .price .premium-loading[data-v-224d0f1e] .van-loading__spinner{width:.45333rem!important;height:.45333rem!important}.page-internet-product-detail .right[data-v-224d0f1e]{width:3.73333rem;background:var(--van-primary-color);border-color:var(--van-primary-color)}\n",document.head.appendChild(e),System.register(["./index-legacy-2bb89bec.js","./debounce-legacy-839a1984.js","./order-legacy-7ac9a2dd.js","./infoCollection-legacy-e0f598c4.js","./trial-legacy-915e3f6d.js","./product-legacy-84a2ca88.js","./utils-legacy-2e3a101f.js","./theme-legacy-a8152f06.js","./auth-legacy-c3d552ac.js","./close-legacy-0713ae5f.js","./pdfh5-legacy-9f98dc45.js","./isObjectLike-legacy-c9ae9091.js","./trial-legacy-18240edb.js","./index-legacy-e5afc766.js","./index-legacy-8558cf1c.js","./index-legacy-017bafb9.js","./index-legacy-1e7a5355.js","./bankCard-legacy-6504042d.js","./validator-legacy-5e43cc69.js","./phoneVerify-legacy-1690286e.js"],(function(e){"use strict";var a,n,t,r,o,l,i,d,u,c,s,v,m,p,y,f,h,g,I,N,w,b,k,T,C,F,L,O,P,D,j,S,H,x,E,U,A,q,R,V,_,B,M,K,Y,$,z,G,J,W,X,Q,Z,ee,ae,ne,te,re,oe,le,ie,de,ue,ce,se,ve,me,pe,ye,fe;return{setters:[function(e){a=e._,n=e.d,t=e.u,r=e.a,o=e.r,l=e.J,i=e.ah,d=e.E,u=e.an,c=e.G,s=e.aB,v=e.z,m=e.c,p=e.h,y=e.f,f=e.w,h=e.g,g=e.A,I=e.k,N=e.j,w=e.t,b=e.bB,k=e.e,T=e.n,C=e.a7,F=e.F,L=e.T,O=e.aj,P=e.B,D=e.bT,j=e.X,S=e.Y,H=e.aJ,x=e.b6,E=e.bG,U=e.aK},function(e){A=e.d},function(e){q=e.a},function(e){R=e.S,V=e.R,_=e.P,B=e.I},function(e){M=e.i,K=e.u,Y=e.a,$=e.s,z=e.p,G=e.g},function(e){J=e.p},function(e){W=e.t,X=e.g,Q=e.a,Z=e.o,ee=e.s,ae=e.v,ne=e.b,te=e.j},function(e){re=e.t},function(e){oe=e.d,le=e.B,ie=e.D,de=e.G,ue=e.S,ce=e.H,se=e.P,ve=e.U,me=e._,pe=e.W,ye=e.a},function(e){fe=e._},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){}],execute:function(){const he={key:0},ge={class:"page-internet-product-detail"},Ie={class:"info"},Ne={class:"footer-button"},we={class:"price"},be=(e=>(j("data-v-224d0f1e"),e=e(),S(),e))((()=>N("span",null,"总保费",-1))),ke={key:0};e("default",a(n({__name:"packageProcess",setup(e){const a=t(),n=r(),{productCode:j="BWYL2021",tenantId:S,orderNo:Te,phoneNo:Ce,agentCode:Fe="",saleChannelId:Le,paymentMethod:Oe,certNo:Pe,name:De,pageCode:je,from:Se}=n.query,He=o(),xe=o(),Ee=o(),Ue=o(),Ae="payBack"===je;o(!1);const qe=o(!1),Re=o(!1),Ve=o(0),_e=o(!1),Be=o(!1),Me=o({show:!1,html:""}),Ke=o({}),Ye=o(),$e=o(!1),ze=o("");let Ge="";const Je=l({holder:{certNo:Pe,certType:i.CERT,mobile:Ce,name:De,socialFlag:R.HAS},insured:{certNo:Pe,certType:i.CERT,name:De,socialFlag:R.HAS,relationToHolder:V.SELF},paymentMethod:Oe,renewalDK:"Y",paymentFrequency:_.YEAR,packageProductList:[],mobileSmsCode:""}),We=o(oe),Xe=o(oe),Qe=l({showInsure:!Ae,canInsure:!1,canUpgrade:!1}),Ze=d((()=>{var e,a;return(null===(e=xe.value)||void 0===e||null===(a=e.tenantProductInsureVO)||void 0===a?void 0:a.attachmentVOList.filter((e=>"健康告知"===e.attachmentName)))||[]})),ea=d((()=>{var e,a;return(null===(e=xe.value)||void 0===e||null===(a=e.tenantProductInsureVO)||void 0===a?void 0:a.attachmentVOList.filter((e=>"健康告知"!==e.attachmentName)))||[]})),aa=()=>{ze.value=Ue.value?Je.paymentFrequency==_.YEAR?"元/年":"元/月":""},na=()=>{a.push({path:"/internet/guaranteeUpgrade",query:{...n.query,tenantId:S,productCode:"BWYL2022",orderNo:Te,agentCode:Fe}})},ta=()=>{Be.value=!1},ra=()=>{Xe.value=We.value},oa=()=>{Xe.value={...Xe.value,relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1}},la=e=>`${E}/internet/payFail?tenantId=${S}&orderNo=${e}&agentCode=${Fe}&pageCode=payBack&from=${Se||"normal"}`,ia=async e=>{const a=X({tenantId:S,saleUserId:Fe,saleChannelId:Le,detail:xe.value,insureDetail:Ee.value,paymentMethod:Je.paymentMethod,paymentFrequency:Je.paymentFrequency,renewalDK:Je.renewalDK,iseeBizNo:Ge,successJumpUrl:"",premium:Ue.value,holder:Je.holder,insured:Je.insured,tenantOrderRiskList:e,orderStatus:"",orderTopStatus:"",orderNo:Te,originOrderIds:Ye.value});try{const e=await $(a),{code:t,data:r}=e;Re.value=!1,qe.value=!1,"10000"===t&&(L.clear(),delete a.id,Ke.value={orderNo:r.data,order:a},Re.value=!0,n=0,Ve.value=n,Re.value=!0)}catch(t){L.clear(),Qe.canInsure=!0}var n},da=()=>new Promise(((e,a)=>{var n,t;null===(n=He.value)||void 0===n||null===(t=n.validateForm)||void 0===t||t.call(n).then((async()=>{if(!(()=>{if(Je.holder.certNo){const e=U(Je.holder.certNo);if(ae(Je.holder.certNo,18,"year"))return L("投保人年龄必须大于等于18岁！"),!1;if(Je.insured.certNo&&Je.insured.relationToHolder===V.MATE&&e===U(Je.insured.certNo))return L("被保人为配偶时，性别不可相同！"),!1}if(Je.insured.certNo){if(Je.insured.relationToHolder===V.CHILD&&ae(Je.insured.certNo,30,"day"))return L("被保人为子女时，年龄必须大于等于30天！"),!1;if(Je.insured.relationToHolder===V.PARENT&&!ae(Je.insured.certNo,71,"year"))return L("被保人为父母时，年龄必须小于等于70岁！"),!1}if([V.CHILD,V.PARENT].includes(Je.insured.relationToHolder)){const e=ne(Je.holder.certNo,"year"),a=ne(Je.insured.certNo,"year");if(Je.insured.relationToHolder===V.CHILD&&e-a<18)return L("投保人和子女年龄必须相差18岁！"),!1;if(Je.insured.relationToHolder===V.PARENT&&a-e<18)return L("投保人和父母年龄必须相差18岁！"),!1}return!0})())return void(Qe.canInsure=!0);const{calcData:n,riskVOList:t}=Q({holder:Je.holder,insured:Je.insured,tenantId:S,productDetail:xe.value,insureDetail:Ee.value,paymentFrequency:Je.paymentFrequency,packageRiskIdList:Z(Je.packageProductList)},!1,te);(!Array.isArray(t)||t.length<1)&&(L("被保人年龄需在30天(含) - 70岁(含)之间！"),Ue.value=null,a(new Error));const r=await z(n),{code:o,data:l}=r;"10000"===o?(Ue.value=l.premium,e({condition:t,data:l})):(Ue.value=null,a(new Error))})).catch((e=>{Qe.canInsure=!0,ee(e)}))})),ua=async()=>{if(Ae)na();else try{var e;L.loading({message:"订单生成中...",forbidClick:!0,duration:0});const{condition:a,data:n}=await da(),t={},r=(e=[])=>{(e||[]).forEach((e=>{var a;t[e.riskCode]=e,null!==(a=e.riskPremiumDetailVOList)&&void 0!==a&&a.length&&r(e.riskPremiumDetailVOList)}))};r(n.riskPremiumDetailVOList);const o=W({tenantId:S,riskList:a,riskPremium:t,productId:null===(e=xe.value)||void 0===e?void 0:e.id});ia(o)}catch(a){Qe.canInsure=!0}finally{L.clear()}},ca=e=>{var a;"allFalse"===e?(qe.value=!1,Qe.canInsure=!0,(async e=>{L.loading({message:"核保中...",forbidClick:!0,duration:0});try{const a=await K(e),{code:n}=a;if("10000"===n){const a=await Y({orderNo:e.orderNo,tenantId:S}),{data:n}=a;"10000"===a.code&&(2===n.type?(Me.value={show:!0,html:n.paymentUrl},console.log("data.paymentUrl",Me.value),x((()=>{console.log("document.forms",document.forms);const e=document.getElementById("cashierSubmit");null==e||e.addEventListener("submit",(e=>{e.preventDefault()})),null==e||e.submit()}))):window.location.href=n.paymentUrl)}Qe.canInsure=!0}catch(a){Qe.canInsure=!0}finally{L.clear()}})({...Ke.value.order,orderNo:Ke.value.orderNo,extInfo:{extraInfo:{renewalDK:Je.renewalDK,paymentMethod:Je.paymentMethod,paymentFrequency:Je.paymentFrequency,successJumpUrl:(a=Ke.value.orderNo,`${E}/pay?orderNo=${a}&saleUserId=${Fe}&tenantId=${S}`),failUrl:la(Ke.value.orderNo)},iseeBizNo:Ge}})):O.confirm({message:"您当前的健康状况不符合该产品",confirmButtonText:"确定"}).then((()=>{window.history.back()})).catch((()=>{Qe.canInsure=!0}))},sa=()=>{Re.value=!1,qe.value=!1,Qe.canInsure=!0},va=()=>{Re.value=!1,qe.value=!0};u([()=>Je.insured.certNo,()=>Je.insured.socialFlag,()=>Je.packageProductList,()=>Je.paymentFrequency],A((()=>{Je.insured.certNo&&Je.insured.socialFlag&&(()=>{const{holder:{certNo:e,mobile:a,name:n,socialFlag:t},insured:{certNo:r,name:o,socialFlag:l,relationToHolder:i},paymentMethod:d}=Je;return!(!H(r)||!l)})()&&(async()=>{const{calcData:e,riskVOList:a}=Q({holder:Je.holder,insured:Je.insured,tenantId:S,productDetail:xe.value,insureDetail:Ee.value,paymentFrequency:Je.paymentFrequency,packageRiskIdList:Z(Je.packageProductList)},!1,te);if(!Array.isArray(a)||a.length<1)return L("被保人年龄需在30天(含) - 70岁(含)之间！"),Ue.value=null,{};$e.value=!0;const n=await z(e);$e.value=!1;const{code:t,data:r}=n;"10000"===t?Je.insured.certNo?(Ue.value=r.premium,aa()):(Ue.value=null,aa()):Ue.value=null})()}),500),{deep:!0,immediate:!0}),u((()=>Je.insured.certNo),(()=>{Je.insured.certNo||(Ue.value=null)}));const ma=async()=>{const e=await G({orderNo:Te,tenantId:S}),{code:a,data:n}=e;if("10000"===a){var t,r,o,l,i,d,u,c;const{id:e,tenantOrderHolder:a,tenantOrderInsuredList:g,extInfo:I}=n;if(!Ae){var s,v,m,p,y,f,h;Ye.value={id:e,holderId:null==a?void 0:a.id,insuredId:null==g?void 0:g[0].id};const n=((null===(s=g[0])||void 0===s||null===(v=s.tenantOrderProductList[0])||void 0===v?void 0:v.tenantOrderRiskList)||[]).map((e=>{var a;return(null===(a=e.extInfo)||void 0===a?void 0:a.riskId)||""}));return Je.packageProductList.forEach((e=>{e.value=e.productRiskVoList.filter((e=>n.includes(e.id))).length>0?B.INSURE:B.UN_INSURE})),Object.assign(Je,{holder:{certNo:a.certNo,certType:a.certType,mobile:a.mobile,name:a.name,socialFlag:R.HAS},insured:{certNo:null==g?void 0:g[0].certNo,certType:null===(m=g[0])||void 0===m?void 0:m.certType,name:null===(p=g[0])||void 0===p?void 0:p.name,socialFlag:null===(y=g[0])||void 0===y||null===(f=y.extInfo)||void 0===f?void 0:f.hasSocialInsurance,relationToHolder:null===(h=g[0])||void 0===h?void 0:h.relationToHolder},paymentMethod:I.extraInfo.paymentMethod,paymentFrequency:I.extraInfo.paymentFrequency,renewalDK:I.extraInfo.renewalDK||"N"}),void(Qe.canInsure=!0)}Object.assign(Je,{holder:{certNo:a.certNo,certType:a.certType,mobile:a.mobile,name:a.name,socialFlag:R.HAS},insured:{certNo:null==g?void 0:g[0].certNo,certType:null===(t=g[0])||void 0===t?void 0:t.certType,name:null===(r=g[0])||void 0===r?void 0:r.name,socialFlag:null===(o=g[0])||void 0===o||null===(l=o.extInfo)||void 0===l?void 0:l.hasSocialInsurance,relationToHolder:null===(i=g[0])||void 0===i?void 0:i.relationToHolder},paymentMethod:I.extraInfo.paymentMethod,paymentFrequency:I.extraInfo.paymentFrequency,renewalDK:I.extraInfo.renewalDK||"N"}),Ue.value=null===(d=g[0])||void 0===d||null===(u=d.tenantOrderProductList)||void 0===u||null===(c=u[0])||void 0===c?void 0:c.premium,n.orderStatus!==q.ACCEPT_POLICY&&n.orderStatus!==q.PAYMENT_SUCCESS||(Qe.canUpgrade=!0,_e.value=!1,Be.value=!0),n.orderStatus===q.PAYING&&(_e.value=!0,setTimeout((()=>{ma()}),3e3))}};return c((()=>{console.log("投保链接"),Xe.value=ye,We.value=ye,Qe.canInsure=!0,(async()=>{const e=await J({productCode:j,withInsureInfo:!0,tenantId:S});var a;"10000"===e.code&&(xe.value=e.data,document.title=(null===(a=e.data)||void 0===a?void 0:a.productFullName)||"");const n=await M({productCode:j});var t;"10000"===n.code&&(Je.packageProductList=((null===(t=n.data)||void 0===t?void 0:t.packageProductVOList)||[]).map((e=>({...e,value:B.UN_INSURE,disabled:!1}))),Ee.value=n.data),Te&&ma()})(),setTimeout((async()=>{Ge=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,a)=>{const n=s,t=P,r=D,o=v("dompurify-html");return m(),p(F,null,[y(r,{"theme-vars":h(re)},{default:f((()=>{var e,a,r,l,i,d,u;return[h(Me).show?g((m(),p("div",he,null,512)),[[o,h(Me).html]]):I("",!0),N("div",ge,[N("div",Ie,[y(le,{url:null===(e=h(xe))||void 0===e||null===(a=e.tenantProductInsureVO)||void 0===a?void 0:a.banner[0]},null,8,["url"]),y(ie,{"product-name":null===(r=h(xe))||void 0===r?void 0:r.productFullName,"product-desc":null===(l=h(xe))||void 0===l||null===(i=l.showConfigVO)||void 0===i?void 0:i.desc},null,8,["product-name","product-desc"])]),y(de,{"show-service-config":"","guarantee-list":null===(d=h(xe))||void 0===d||null===(u=d.tenantProductInsureVO)||void 0===u?void 0:u.titleAndDescVOS},null,8,["guarantee-list"]),y(ue,{detail:h(xe).tenantProductInsureVO},{form:f((()=>[y(ce,{ref_key:"formRef",ref:He,"is-show-package":"",disable:!h(Qe).showInsure,"form-auth":h(Xe),"form-info":h(Je),"product-detail":h(xe),onOnReset:ra,onOnUpdate:oa},null,8,["disable","form-auth","form-info","product-detail"])])),_:1},8,["detail"]),N("div",Ne,[N("div",we,[be,h($e)?(m(),k(n,{key:1,class:"premium-loading",type:"spinner"})):(m(),p("span",ke,w(h(Ue)?"￥":"")+w(h(b)(h(Ue)))+" "+w(h(ze)),1))]),y(t,{type:"primary",class:"right",disabled:!(h(Qe).canInsure||h(Qe).canUpgrade),onClick:ua},{default:f((()=>[T(w(h(Qe).showInsure?"立即投保":"升级保障"),1)])),_:1},8,["disabled"])])]),h(Te)?I("",!0):(m(),k(se,{key:1,"product-detail":h(xe)},null,8,["product-detail"])),y(ve,{"order-no":h(Te),"tenant-id":h(S),"is-show":h(Be),onOnConfirm:na,onOnClose:ta},null,8,["order-no","tenant-id","is-show"])]})),_:1},8,["theme-vars"]),y(me,{show:h(qe),"onUpdate:show":a[0]||(a[0]=e=>C(qe)?qe.value=e:null),"content-list":h(Ze),"active-index":0,onOnConfirmHealth:ca,onOnCloseHealth:sa},null,8,["show","content-list"]),h(Re)?(m(),k(fe,{key:0,show:h(Re),"onUpdate:show":a[1]||(a[1]=e=>C(Re)?Re.value=e:null),"content-list":h(ea),"active-index":h(Ve),text:"我已逐页阅读并确认告知内容","force-read-cound":2,"on-close-file-preview":"",onSubmit:va,onOnCloseFilePreview:sa},null,8,["show","content-list","active-index"])):I("",!0),y(pe,{"is-show":h(_e)},null,8,["is-show"])],64)}}}),[["__scopeId","data-v-224d0f1e"]]))}}}))}();
