var Ze=Object.defineProperty,ea=Object.defineProperties;var aa=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var ta=Object.prototype.hasOwnProperty,ra=Object.prototype.propertyIsEnumerable;var de=(E,c,p)=>c in E?Ze(E,c,{enumerable:!0,configurable:!0,writable:!0,value:p}):E[c]=p,b=(E,c)=>{for(var p in c||(c={}))ta.call(c,p)&&de(E,p,c[p]);if(ce)for(var p of ce(c))ra.call(c,p)&&de(E,p,c[p]);return E},O=(E,c)=>ea(E,aa(c));import{g as oa,a9 as ua,O as na,E as h,M as me,y as pe,_ as sa,l as la,h as ia,r as fe,af as ca,j as V,n as he,p as g,m as G,H as da,t as J,z as U,A as m,J as q,C as _e,k as ve,F as ma,T as D,D as pa,X as fa}from"./vendor-17026bfd.js";import{_ as ha,C as Fe,a0 as va,H as Fa,I as ye,a1 as Ee}from"./index-a9ec5a8c.js";import{a as j}from"./order-26db6dbf.js";import{S as Y,R as B,f as ge,I as ya}from"./infoCollection-192ba138.js";import{p as De,i as Ea,s as ga,g as Da,u as Ca,a as Ia}from"./trial-281181ce.js";import{p as Na}from"./product-bfb2dfef.js";import{a as Ce,o as Ie,t as Ba,g as L,b as wa,h as Ne}from"./utils-6fb97c15.js";import{t as _a}from"./theme-ea709837.js";import{d as Be,B as Aa,D as Pa,G as Ta,S as ka,H as Sa,P as Ha,U as ba,_ as Oa,W as Ua,a as we}from"./auth-1d9a41b3.js";import{_ as La}from"./index-374459c3.js";import"./utils-b6782348.js";import"./trial-2e16381f.js";import"./index-324693b1.js";import"./bankCard-0e4ce564.js";import"./phoneVerify-f7b2bb98.js";const xa={key:0},Ra={class:"page-internet-product-detail"},Ma={class:"info"},Va={class:"footer-button"},qa={class:"price"},Ya=_e(" \u603B\u4FDD\u8D39"),$a=oa({setup(E){const c=ua(),p=na(),{productCode:X="BWYL2021",tenantId:v,orderNo:A,phoneNo:Ae,agentCode:x="",saleChannelId:Pe,paymentMethod:Te,certNo:Q,name:Z,pageCode:ke,from:Se}=p.query,P=h(),d=h(),R=h(),F=h(),$=ke==="payBack",T=h(!1),k=h(!1),w=h(!1),ee=h(0),K=h(!1),W=h(!1),M=h({show:!1,html:""});let z="";const e=me({holder:{certNo:Q,certType:Fe.CERT,mobile:Ae,name:Z,socialFlag:Y.HAS},insured:{certNo:Q,certType:Fe.CERT,name:Z,socialFlag:Y.HAS,relationToHolder:B.SELF},paymentMethod:Te,renewalDK:"Y",paymentFrequency:ge.YEAR,packageProductList:[],mobileSmsCode:""}),ae=h(Be),S=h(Be),s=me({showInsure:!$,canInsure:!1,canUpgrade:!1}),He=pe(()=>{var a,t;return((t=(a=d.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(r=>r.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),be=pe(()=>{var a,t;return((t=(a=d.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(r=>r.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),Oe=()=>{if(e.holder.certNo){const a=L(e.holder.certNo,"year"),t=ye(e.holder.certNo);if(a<18)return D("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E18\u5C81\uFF01"),!1;if(e.insured.certNo&&e.insured.relationToHolder===B.MATE){const r=ye(e.insured.certNo);if(t===r)return D("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(e.insured.certNo){const a=L(e.insured.certNo,"day"),t=L(e.insured.certNo,"year");if(e.insured.relationToHolder===B.CHILD&&a<30)return D("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(e.insured.relationToHolder===B.PARENT&&t>=71)return D("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E70\u5C81\uFF01"),!1}if([B.CHILD,B.PARENT].includes(e.insured.relationToHolder)){const a=L(e.holder.certNo,"year"),t=L(e.insured.certNo,"year");if(e.insured.relationToHolder===B.CHILD&&a-t<18)return D("\u6295\u4FDD\u4EBA\u548C\u5B50\u5973\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1;if(e.insured.relationToHolder===B.PARENT&&t-a<18)return D("\u6295\u4FDD\u4EBA\u548C\u7236\u6BCD\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1}return!0},Ue=()=>{const{holder:{certNo:a,mobile:t,name:r,socialFlag:n},insured:{certNo:o,name:u,socialFlag:l,relationToHolder:f},paymentMethod:y}=e;return!!(Fa(o)&&!!l)},te=()=>{c.push({path:"/internet/guaranteeUpgrade",query:O(b({},p.query),{tenantId:v,productCode:"BWYL2022",orderNo:A,agentCode:x})})},Le=()=>{W.value=!1},xe=()=>{S.value=ae.value},Re=()=>{S.value=O(b({},S.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},Me=async a=>{D.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const t=await Ca(a),{code:r}=t;if(r==="10000"){D.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const n=await Ia({orderNo:a.orderNo,tenantId:v}),{data:o}=n;n.code==="10000"&&(o.type===2?(M.value={show:!0,html:o.paymentUrl},console.log("data.paymentUrl",M.value),fa(()=>{console.log("document.forms",document.forms);const u=document.getElementById("cashierSubmit");u==null||u.addEventListener("submit",l=>{l.preventDefault()}),u==null||u.submit()})):window.location.href=o.paymentUrl)}s.canInsure=!0}catch{s.canInsure=!0}},Ve=a=>`${Ee}/pay?orderNo=${a}&saleUserId=${x}&tenantId=${v}`,qe=a=>`${Ee}/internet/payFail?tenantId=${v}&orderNo=${a}&agentCode=${x}&pageCode=payBack&from=${Se||"normal"}`,Ye=async a=>{console.log("risk",a);const t=wa({tenantId:v,saleUserId:x,saleChannelId:Pe,detail:d.value,insureDetail:R.value,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,renewalDK:e.renewalDK,iseeBizNo:z,successJumpUrl:"",premium:F.value,holder:e.holder,insured:e.insured,tenantOrderRiskList:a,orderStatus:"",orderTopStatus:""});try{const r=await ga(t),{code:n,data:o}=r;n==="10000"&&Me(O(b({},t),{orderNo:o.data,extInfo:{extraInfo:{renewalDK:e.renewalDK,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,successJumpUrl:Ve(o.data),failUrl:qe(o.data)},iseeBizNo:z}}))}catch{s.canInsure=!0}},$e=async()=>{const{calcData:a,riskVOList:t}=Ce({holder:e.holder,insured:e.insured,tenantId:v,productDetail:d.value,insureDetail:R.value,paymentFrequency:e.paymentFrequency,packageRiskIdList:Ie(e.packageProductList)},!1,Ne);if(!Array.isArray(t)||t.length<1)return D("\u88AB\u4FDD\u4EBA\u5E74\u9F84\u9700\u572830\u5929(\u542B) - 70\u5C81(\u542B)\u4E4B\u95F4\uFF01"),F.value=null,{};const r=await De(a),{code:n,data:o}=r;return n==="10000"?(F.value=o.premium,{condition:t,data:o}):(F.value=null,{})},Ke=a=>{ee.value=a,w.value=!0},We=()=>new Promise((a,t)=>{var r,n;(n=(r=P.value)==null?void 0:r.validateForm)==null||n.call(r).then(async()=>{var I;if(!Oe()){s.canInsure=!0;return}if(!(((I=P.value)==null?void 0:I.isAgreeFile)||T.value)){T.value=!1,w.value=!0,Ke(0);return}const{calcData:u,riskVOList:l}=Ce({holder:e.holder,insured:e.insured,tenantId:v,productDetail:d.value,insureDetail:R.value,paymentFrequency:e.paymentFrequency,packageRiskIdList:Ie(e.packageProductList)},!1,Ne);(!Array.isArray(l)||l.length<1)&&(D("\u88AB\u4FDD\u4EBA\u5E74\u9F84\u9700\u572830\u5929(\u542B) - 70\u5C81(\u542B)\u4E4B\u95F4\uFF01"),F.value=null,t(new Error));const f=await De(u),{code:y,data:C}=f;y==="10000"?(F.value=C.premium,a({condition:l,data:C})):(F.value=null,t(new Error))}).catch(()=>{s.canInsure=!0})}),re=async()=>{var a;if($){te();return}s.canInsure=!1;try{const{condition:t,data:r}=await We(),n={},o=(l=[])=>{(l||[]).forEach(f=>{var y;n[f.riskCode]=f,((y=f.riskPremiumDetailVOList)==null?void 0:y.length)&&o(f.riskPremiumDetailVOList)})};o(r.riskPremiumDetailVOList);const u=Ba({tenantId:v,riskList:t,riskPremium:n,productId:(a=d.value)==null?void 0:a.id});Ye(u)}catch{s.canInsure=!0}},ze=a=>{a==="allFalse"?(k.value=!1,T.value=!0,re(),s.canInsure=!0):pa.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"}).then(()=>{window.history.back()}).catch(()=>{var t;(t=P.value)==null||t.reEditForm(),T.value=!1,s.canInsure=!0})},oe=()=>{var a;(a=P.value)==null||a.reEditForm(),T.value=!1,s.canInsure=!0},Ge=()=>{console.log("onCloseHealthPopup========"),k.value=!1,oe()},Je=()=>{console.log("onCloseFilePreview========"),w.value=!1,oe()},je=()=>{w.value=!1,k.value=!0};sa([()=>e.insured.certNo,()=>e.insured.socialFlag,()=>e.packageProductList,()=>e.paymentFrequency],la.exports.debounce(()=>{e.insured.certNo&&e.insured.socialFlag&&Ue()&&$e()},500),{deep:!0,immediate:!0});const ue=async()=>{var n,o,u,l,f,y,C,I,H,ne,se,le,ie;const a=await Da({orderNo:A,tenantId:v}),{code:t,data:r}=a;if(t==="10000"){const{tenantOrderHolder:N,tenantOrderInsuredList:i,extInfo:_}=r;if(!$){Object.assign(e,{holder:{certNo:N.certNo,certType:N.certType,mobile:N.mobile,name:N.name,socialFlag:Y.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(n=i[0])==null?void 0:n.certType,name:(o=i[0])==null?void 0:o.name,socialFlag:(l=(u=i[0])==null?void 0:u.extInfo)==null?void 0:l.hasSocialInsurance,relationToHolder:(f=i[0])==null?void 0:f.relationToHolder},paymentMethod:_.extraInfo.paymentMethod,paymentFrequency:_.extraInfo.paymentFrequency,renewalDK:_.extraInfo.renewalDK||"N"}),s.canInsure=!0;return}Object.assign(e,{holder:{certNo:N.certNo,certType:N.certType,mobile:N.mobile,name:N.name,socialFlag:Y.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(y=i[0])==null?void 0:y.certType,name:(C=i[0])==null?void 0:C.name,socialFlag:(H=(I=i[0])==null?void 0:I.extInfo)==null?void 0:H.hasSocialInsurance,relationToHolder:(ne=i[0])==null?void 0:ne.relationToHolder},paymentMethod:_.extraInfo.paymentMethod,paymentFrequency:_.extraInfo.paymentFrequency,renewalDK:_.extraInfo.renewalDK||"N"}),F.value=(ie=(le=(se=i[0])==null?void 0:se.tenantOrderProductList)==null?void 0:le[0])==null?void 0:ie.premium,(r.orderStatus===j.ACCEPT_POLICY||r.orderStatus===j.PAYMENT_SUCCESS)&&(s.canUpgrade=!0,K.value=!1,W.value=!0),r.orderStatus===j.PAYING&&(K.value=!0,setTimeout(()=>{ue()},3*1e3))}},Xe=async()=>{const a=Na({productCode:X,withInsureInfo:!0,tenantId:v}),t=Ea({productCode:X});await Promise.all([a,t]).then(([r,n])=>{var o,u;r.code==="10000"&&(d.value=r.data,document.title=((o=r.data)==null?void 0:o.productFullName)||""),n.code==="10000"&&(e.packageProductList=(((u=n.data)==null?void 0:u.packageProductVOList)||[]).map(l=>O(b({},l),{value:ya.UN_INSURE,disabled:!1})),R.value=n.data)}),A&&ue()},Qe=()=>{console.log("\u6295\u4FDD\u94FE\u63A5"),S.value=we,ae.value=we,s.canInsure=!0};return ia(()=>{Qe(),Xe(),setTimeout(async()=>{z=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(a,t)=>{const r=fe("van-button"),n=fe("van-config-provider"),o=ca("dompurify-html");return V(),he(ma,null,[g(n,{"theme-vars":m(_a)},{default:G(()=>{var u,l,f,y,C,I,H;return[M.value.show?da((V(),he("div",xa,null,512)),[[o,M.value.html]]):J("",!0),U("div",Ra,[U("div",Ma,[g(Aa,{url:(l=(u=d.value)==null?void 0:u.tenantProductInsureVO)==null?void 0:l.banner[0]},null,8,["url"]),g(Pa,{"product-name":(f=d.value)==null?void 0:f.productFullName,"product-desc":(C=(y=d.value)==null?void 0:y.showConfigVO)==null?void 0:C.desc},null,8,["product-name","product-desc"])]),g(Ta,{"show-service-config":"","guarantee-list":(H=(I=d.value)==null?void 0:I.tenantProductInsureVO)==null?void 0:H.titleAndDescVOS},null,8,["guarantee-list"]),g(ka,{detail:d.value},{form:G(()=>[g(Sa,{ref_key:"formRef",ref:P,"is-show-package":"",disable:!m(s).showInsure,"form-auth":S.value,"form-info":m(e),"product-detail":d.value,onOnReset:xe,onOnUpdate:Re},null,8,["disable","form-auth","form-info","product-detail"])]),_:1},8,["detail"]),U("div",Va,[U("div",qa,[Ya,U("span",null,q(F.value?"\uFFE5":"")+q(m(va)(F.value))+" "+q(F.value?m(e).paymentFrequency==m(ge).YEAR?"\u5143/\u5E74":"\u5143/\u6708":""),1)]),g(r,{type:"primary",class:"right",disabled:!(m(s).canInsure||m(s).canUpgrade),onClick:re},{default:G(()=>[_e(q(m(s).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),m(A)?J("",!0):(V(),ve(Ha,{key:1,"product-detail":d.value},null,8,["product-detail"])),g(ba,{"order-no":m(A),"tenant-id":m(v),"is-show":W.value,onOnConfirm:te,onOnClose:Le},null,8,["order-no","tenant-id","is-show"])]}),_:1},8,["theme-vars"]),g(Oa,{show:k.value,"onUpdate:show":t[0]||(t[0]=u=>k.value=u),"content-list":m(He),"active-index":0,onOnConfirmHealth:ze,onOnCloseHealth:Ge},null,8,["show","content-list"]),w.value?(V(),ve(La,{key:0,show:w.value,"onUpdate:show":t[1]||(t[1]=u=>w.value=u),"content-list":m(be),"active-index":ee.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9","force-read-cound":2,"on-close-file-preview":"",onSubmit:je,onOnCloseFilePreview:Je},null,8,["show","content-list","active-index"])):J("",!0),g(Ua,{"is-show":K.value},null,8,["is-show"])],64)}}});var st=ha($a,[["__scopeId","data-v-a7c54330"]]);export{st as default};
