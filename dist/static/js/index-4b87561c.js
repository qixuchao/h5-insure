var ce=Object.defineProperty;var z=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var G=(a,m,s)=>m in a?ce(a,m,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[m]=s,U=(a,m)=>{for(var s in m||(m={}))pe.call(m,s)&&G(a,s,m[s]);if(z)for(var s of z(m))me.call(m,s)&&G(a,s,m[s]);return a};import{g as Q,R as Z,E as y,y as g,$ as j,r as R,j as L,n as N,F as ee,G as te,z as d,p as I,J as C,A as v,k as V,m as f,t as T,C as h,a5 as oe,a6 as se,O as _e,P as ke,o as ve,D as Ie}from"./vendor-8ff1e78f.js";import{u as fe,P as Re}from"./index-56e32e20.js";import{b as M,_ as re,s as J,t as Le}from"./index-0d7c6943.js";import{a as Pe}from"./trial-2781b84c.js";import{u as X}from"./useDicData-31d7096f.js";import"./trial-0725e458.js";const he=a=>M.post("/api/app/insure/proposal/addOrUpdateProposal",a),De=(a={})=>M.get(`/api/app/insure/proposal/queryProposalDetail/${a.id}`,a),Fe=(a={})=>M.post("/api/app/insure/product/listInsureProductDetail",a);const K=a=>(oe("data-v-7995980e"),a=a(),se(),a),ye={class:"com-product-list-wrapper"},ge={class:"risk-item-wrapper"},Ce={class:"content"},Ve={class:"risk-premium"},Be=h(" \u4FDD\u8D39:"),Ee={class:"premium"},be={class:"risk-factor"},$e={class:"factor"},Oe={class:"factor-value"},Ne=K(()=>d("span",{class:"factor-name"}," \u4FDD\u989D(\u5143) ",-1)),Te={class:"factor"},Ae={class:"factor-value"},Se=K(()=>d("span",{class:"factor-name"}," \u4FDD\u969C\u671F\u95F4 ",-1)),xe={class:"factor"},we={class:"factor-value"},qe=K(()=>d("span",{class:"factor-name"}," \u7F34\u8D39\u671F\u95F4 ",-1)),Ue={class:"operate-bar"},je=h("\u5220\u9664"),Me=h("+ \u9644\u52A0\u9669"),Ke=h("\u4FEE\u6539"),He={class:"premium-total"},We=h(" \u4FDD\u8D39: "),Ye={class:"premium"},ze=Q({props:{productRiskList:{default:()=>[]},productInfo:{default:()=>({})},productData:{default:()=>({})},pickProductPremium:{type:Function,default:()=>{}},productNum:{default:0}},emits:["deleteRisk","updateRisk","addRiderRisk"],setup(a,{emit:m}){const s=a,[o,B]=Z(),k=y({checkedList:[],disabledList:[],riderRiskList:[],mainRiskData:{},totalPremium:0,currentRiskRecord:{},productRiskList:[]}),P=X("RISK_PAYMENT_PERIOD"),E=X("RISK_INSURANCE_PERIOD"),A=g(()=>{var l,u;return((u=(l=s.productData)==null?void 0:l.productRiskVoList)==null?void 0:u[0].riskDetailVOList.filter(i=>i.collocationType===1))||[]}),S=g(()=>{var i,c;const l=s.productRiskList.map(r=>r.riskId),u=(((c=(i=s.productData)==null?void 0:i.productRiskVoList)==null?void 0:c[0].riskDetailVOList)||[]).filter(r=>l.includes(r.id)&&r.collocationType===1);return A.value.length-u.length}),n=g(()=>l=>{var c,r;const u=((r=(c=s.productData)==null?void 0:c.productRiskVoList)==null?void 0:r[0].riskDetailVOList.find(F=>F.id!==l))||{};let i=!1;return s.productNum||u.riskType===2&&u.collocationType===1?i=!0:i=!1,i}),b=g(()=>{var u,i;return((i=(u=s.productData)==null?void 0:u.productRiskVoList)==null?void 0:i[0].riskDetailVOList.find(c=>c.riskType===1))||{}}),$=g(()=>b.value.collocationVOList||[]),O=l=>{m("deleteRisk",l,s.productInfo)},x=l=>{m("updateRisk",l,s.productInfo)},w=l=>{B(!0),k.value.currentRiskRecord=l},q=(l,u)=>{const i=l.map(c=>c.id).filter(c=>!k.value.disabledList.includes(c));m("addRiderRisk",i,s.productInfo)};return j(()=>s.productInfo,l=>{var i;let u=0;(l.proposalProductRiskList||[]).forEach(c=>{u+=c.premium}),(i=s.pickProductPremium)==null||i.call(s,{[`${l.productId}`]:u}),k.value.totalPremium=u},{deep:!0,immediate:!0}),j(()=>s.productRiskList,l=>{const u=[],i=[],c=[];(l||[]).forEach(r=>{r.riskType===1?u.unshift(r):(i.push(r.riskId),c.push(r.riskId),u.push(r))}),k.value.disabledList=i,k.value.checkedList=c,k.value.productRiskList=u},{deep:!0,immediate:!0}),(l,u)=>{const i=R("ProTitle"),c=R("ProCheckButton");return L(),N("div",ye,[(L(!0),N(ee,null,te(k.value.productRiskList,r=>{var F,t;return L(),N("div",{key:r.riskId},[d("div",ge,[I(i,{"risk-type":r.riskType,title:r.riskName},null,8,["risk-type","title"]),d("div",Ce,[d("div",Ve,[Be,d("span",Ee,"\uFFE5"+C((F=r.premium)==null?void 0:F.toLocaleString()),1)]),d("div",be,[d("div",$e,[d("span",Oe,C((t=r.amount)==null?void 0:t.toLocaleString()),1),Ne]),d("div",Te,[d("span",Ae,C(v(J)(v(E),r.coveragePeriod)),1),Se]),d("div",xe,[d("span",we,C(v(J)(v(P),r.chargePeriod)),1),qe])]),d("div",Ue,[v(n)(r.riskId)?(L(),V(c,{key:0,round:32,class:"border",onClick:e=>O(r)},{default:f(()=>[je]),_:2},1032,["onClick"])):T("",!0),v(S)?(L(),V(c,{key:1,activated:"",round:32,onClick:e=>w(r)},{default:f(()=>[Me]),_:2},1032,["onClick"])):T("",!0),I(c,{activated:"",round:32,onClick:e=>x(r)},{default:f(()=>[Ke]),_:2},1032,["onClick"])])])])])}),128)),d("div",He,[We,d("span",Ye,"\uFFE5"+C(k.value.totalPremium.toLocaleString()),1)]),v(o)?(L(),V(Pe,{key:0,modelValue:k.value.checkedList,"onUpdate:modelValue":u[0]||(u[0]=r=>k.value.checkedList=r),show:v(o),disabled:k.value.disabledList,"risk-list":v(A),"collocation-list":v($),onFinished:q,onClose:u[1]||(u[1]=r=>v(B)(!1))},null,8,["modelValue","show","disabled","risk-list","collocation-list"])):T("",!0)])}}});var Ge=re(ze,[["__scopeId","data-v-7995980e"]]);const Je=a=>(oe("data-v-3167791f"),a=a(),se(),a),Xe={class:"container"},Qe=Je(()=>d("span",null,"\u8BA1\u5212\u4E66\u540D\u79F0",-1)),Ze={class:"operate-bar"},et=h("\u6DFB\u52A0\u4E3B\u9669"),tt={class:"footer-bar"},ot={class:"trial-result"},st=h(" \u603B\u4FDD\u8D39 "),rt={class:"result-num"},ut={class:"trial-operate"},at=h("\u4FDD\u5B58\u5E76\u9884\u89C8"),it=Q({setup(a){const[m,s]=Z(),o=y({proposalHolder:{},proposalInsuredList:[{name:"",gender:"",birthday:"",proposalInsuredProductList:[]}],proposalName:"",totalPremium:0,relationUserType:2}),B=_e(),k=ke(),P=fe(),{id:E,type:A="add",isCreateProposal:S}=k.query,n=y({productId:0,productCollection:{},productInfo:{},productPremium:{},riderRisk:{},type:"add",currentRisk:[]}),b=y();y({}),y([]),g(()=>({min:"",max:""}));const $=(t,e,_)=>/^.{1,20}$/.test(e)?"":`${t}\u4E0D\u80FD\u8D85\u8FC720\u4E2A\u5B57\u7B26`,O=(t={})=>{Object.assign(n.value.productPremium,t),o.value.totalPremium=Object.values(n.value.productPremium).reduce((e,_)=>e+_,0)},x=(t,e)=>{const _=e;Ie.confirm({message:"\u786E\u8BA4\u5220\u9664\u8BE5\u9669\u79CD\uFF1F"}).then(()=>{t.riskType===1?(o.value.proposalInsuredList[0].proposalInsuredProductList=o.value.proposalInsuredList[0].proposalInsuredProductList.filter(D=>D.productId!==_.productId),O({[_.productId]:0})):_.proposalProductRiskList=_.proposalProductRiskList.filter(D=>D.riskId!==t.riskId)})},w=(t,e)=>{n.value.productId=e.productId,n.value.productInfo=e,n.value.type="edit",n.value.currentRisk=[t.riskId],s(!0)},q=(t,e)=>{n.value.productId=e.productId,n.value.productInfo=e,n.value.type="addRiderRisk",n.value.currentRisk=t,s(!0)},l=()=>{De({id:E}).then(({code:t,data:e})=>{t==="10000"&&Object.assign(o.value,e)})},u=()=>{b.value.validate().then(()=>{he(o.value).then(({code:t,data:e})=>{t==="10000"&&(P.$reset(),B.push({path:"/compositionProposal",query:{id:e}}))})})},i=t=>{o.value.proposalInsuredList[0].proposalInsuredProductList=o.value.proposalInsuredList[0].proposalInsuredProductList.map(e=>{let _=e;return e.productId===t.proposalInsuredList[0].proposalInsuredProductList[0].productId&&(_=U({},t.proposalInsuredList[0].proposalInsuredProductList[0])),_}),s(!1)},c=t=>{Fe(t).then(({code:e,data:_})=>{e==="10000"&&(n.value.productCollection=_)}).finally(()=>{})},r=()=>{P.setProposalInfo(o.value),P.setTrialData([]),P.setExcludeProduct(Object.keys(n.value.productCollection)),B.push({path:"/proposalList",query:U({isCreateProposal:"1"},k.query)})},F=()=>{s(!1)};return ve(()=>{const t=P.$state.trialData,e=P.$state.proposalInfo;E&&!S?l():!Object.keys(e).length&&t.length?Object.assign(o.value,t[0]):Object.keys(e).length&&t.length?(e.proposalInsuredList[0].proposalInsuredProductList.push(...t[0].proposalInsuredList[0].proposalInsuredProductList),o.value=e):Object.keys(e).length&&!t.length&&(o.value=e),P.setTrialData([])}),j(()=>{var t;return(t=o.value.proposalInsuredList[0].proposalInsuredProductList)==null?void 0:t.length},()=>{const t=o.value.proposalInsuredList[0].proposalInsuredProductList.map(e=>({productId:e.productId,source:2}));c({voList:t})}),(t,e)=>{const _=R("VanField"),D=R("ProCard"),ue=R("ProDatePicker"),ae=R("ProRadioButton"),ie=R("VanForm"),de=R("ProCheckButton"),le=R("VanButton"),ne=R("ProPageWrap");return L(),V(ne,{class:"page-create-wrapper"},{default:f(()=>{var H;return[d("div",Xe,[I(ie,{ref_key:"formRef",ref:b,"input-align":"right","error-message-align":"right"},{default:f(()=>[I(D,null,{default:f(()=>[I(_,{modelValue:o.value.proposalName,"onUpdate:modelValue":e[0]||(e[0]=p=>o.value.proposalName=p),name:"proposalName",placeholder:"\u8BF7\u8F93\u5165\u8BA1\u5212\u4E66\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u8BA1\u5212\u4E66\u540D\u79F0"},{validator:(...p)=>$("\u8BA1\u5212\u4E66\u540D\u79F0",...p)}]},{label:f(()=>[Qe]),_:1},8,["modelValue","rules"])]),_:1}),I(D,{title:"\u88AB\u4FDD\u4EBA\u4FE1\u606F"},{default:f(()=>[I(_,{modelValue:o.value.proposalInsuredList[0].name,"onUpdate:modelValue":e[1]||(e[1]=p=>o.value.proposalInsuredList[0].name=p),name:"name",label:"\u59D3\u540D",rules:[{validator:(...p)=>$("\u59D3\u540D",...p)}],placeholder:"\u8BF7\u8F93\u5165\uFF08\u9009\u586B\uFF09"},null,8,["modelValue","rules"]),I(ue,{modelValue:o.value.proposalInsuredList[0].birthday,"onUpdate:modelValue":e[2]||(e[2]=p=>o.value.proposalInsuredList[0].birthday=p),name:"birthday",label:"\u51FA\u751F\u65E5\u671F",type:"date","is-link":"",readonly:"",placeholder:"\u8BF7\u9009\u62E9",rules:[{required:!0,message:"\u8BF7\u9009\u62E9"}]},null,8,["modelValue"]),I(_,{modelValue:o.value.proposalInsuredList[0].gender,"onUpdate:modelValue":e[4]||(e[4]=p=>o.value.proposalInsuredList[0].gender=p),name:"gender",label:"\u6027\u522B",rules:[{required:!0,message:"\u8BF7\u9009\u62E9"}]},{input:f(()=>[I(ae,{modelValue:o.value.proposalInsuredList[0].gender,"onUpdate:modelValue":e[3]||(e[3]=p=>o.value.proposalInsuredList[0].gender=p),options:v(Le)},null,8,["modelValue","options"])]),_:1},8,["modelValue"])]),_:1})]),_:1},512),(L(!0),N(ee,null,te(o.value.proposalInsuredList[0].proposalInsuredProductList||[],p=>(L(),V(D,{key:p.productId},{default:f(()=>{var W,Y;return[I(Ge,{"product-risk-list":p.proposalProductRiskList,"product-info":p,"product-num":((Y=(W=o.value.proposalInsuredList[0])==null?void 0:W.proposalInsuredProductList)==null?void 0:Y.length)-1,"product-data":n.value.productCollection[p.productId],"pick-product-premium":O,onAddRiderRisk:q,onUpdateRisk:w,onDeleteRisk:x},null,8,["product-risk-list","product-info","product-num","product-data"])]}),_:2},1024))),128)),d("div",Ze,[I(de,{activated:"",round:34,onClick:r},{default:f(()=>[et]),_:1})])]),d("div",tt,[d("span",ot,[st,d("span",rt,"\uFFE5"+C(o.value.totalPremium.toLocaleString()),1)]),d("div",ut,[I(le,{type:"primary",onClick:u},{default:f(()=>[at]),_:1})])]),v(m)?(L(),V(Re,{key:0,"is-show":v(m),type:n.value.type,"rider-risk":((H=n.value.riderRisk)==null?void 0:H[n.value.productId])||[],"product-data":n.value.productCollection[n.value.productId],"form-info":n.value.productInfo,holder:o.value.proposalHolder,insured:o.value.proposalInsuredList[0],"current-risk":n.value.currentRisk,onClose:F,onFinished:i},null,8,["is-show","type","rider-risk","product-data","form-info","holder","insured","current-risk"])):T("",!0)]}),_:1})}}});var kt=re(it,[["__scopeId","data-v-3167791f"]]);export{kt as default};
