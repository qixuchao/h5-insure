import{d as e,h as i,g as a,bx as s,bN as t,i as n,av as r,o,c as l,b as d,a as u,u as c,w as f,a8 as p,aB as v,T as g,aa as m,bK as h,am as y,a6 as b,b8 as j,aL as S,bO as I}from"./index-8adcf781.js";import{b as O}from"./product-bf3a5d86.js";import{i as L,g as C}from"./trial-4664166c.js";import{_ as E,N}from"./notice-0b71066d.js";import{u as T}from"./useOrder-d39898d7.js";import{M as D}from"./product-585b0e6f.js";import{s as V,a as k}from"./verify-8b402e8e.js";import{t as w}from"./index-418b3936.js";import"./PayInfo-49e70372.js";import{P as x,a as R}from"./constants-71331306.js";import"./useAttachment-5d1acbba.js";import"./utils-4e05533a.js";import"./infoCollection-16cd423f.js";import"./trial-31da5ed8.js";import"./merge-e7788e50.js";import"./keysIn-131bbce9.js";import"./isObjectLike-a9798079.js";import"./_getTag-0507d0b1.js";import"./debounce-6981b306.js";import"./phoneVerify-d0716a19.js";import"./index-54fb4308.js";import"./useDicData-6e736c53.js";import"./bankCard-1d10c001.js";const q={class:"long-verify"},_={class:"header"},A={class:"verify-content"},G={class:"footer-button"},U=e({__name:"agentSign",setup(e){const U=i(),B=a(),{productCode:H="",tenantId:M,agentCode:P="",agencyCode:z,saleChannelId:F,saleUserId:$,orderNo:J,orderCode:K,extraInfo:Q,isShare:W,insurerCode:X,preview:Y}=U.query;let Z={};try{Z=JSON.parse(decodeURIComponent(Q))}catch(fe){}const ee=T(),ie=`${window.origin}/baseInsurance/long/phoneVerify?${s.stringify({...U.query,orderNo:K||J})}`;new t({source:"localStorage"});const ae=n({}),se=n(),te=n(),ne=n(),re=n({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:""},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{}},agent:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:""}}),oe=n({}),le=n({}),de=n({sign:[],verify:[],scribing:""}),ue=()=>{if(Y)return void v(x.SIGN,U.query);const e=[];se.value&&de.value.sign.includes("1")&&e.push(se.value.validateSign()),te.value&&((W?de.value.sign.includes("4"):de.value.sign.includes("2"))&&e.push(te.value.validateSign()),de.value.verify.includes("1")&&e.push(te.value.validateVerify())),ne.value&&((W?de.value.sign.includes("5"):de.value.sign.includes("3"))&&e.push(...(ne.value||[]).map((e=>e.validateSign()))),de.value.verify.includes("2")&&e.push(...(ne.value||[]).map((e=>e.validateVerify())))),Promise.all(e).then((e=>{k({bizObjectId:[],bizObjectType:3,orderId:ee.value.id,tenantId:M}).then((({code:e,data:i})=>{"10000"===e&&i&&B.push({path:R.sign,query:U.query})}))})).catch((e=>{g(e.message)}))};n();n({imgUrl:"",desc:"",title:"",link:ie});const ce=()=>{O({productCode:H}).then((({code:e,data:i})=>{var a;if("10000"===e){const{productMaterialMap:e}=(null==(a=i.productInsureMaterialVOList)?void 0:a[0])||{};(Object.values(e||{})||[]).flat().filter((e=>e.materialType===D.SIGN)).forEach((e=>{e.noticeObject===N.AGENT?re.value.agent.fileList.push(e):e.noticeObject===N.HOlDER?re.value.holder.fileList.push(e):e.noticeObject===N.INSURED&&re.value.insured.fileList.push(e)}))}})),L({productCode:H,isTenant:!Y}).then((({data:e,code:i})=>{var a;if("10000"===i){ae.value=e;const{productFactor:i}=(null==(a=e.productPlanInsureVOList)?void 0:a[0])||{},{signInfo:s}=w(i);s.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((i=>{e.required&&de.value.sign.push(i.code),"1"===i.code?re.value.agent.isSign=!0:"2"===i.code?re.value.holder.isSign=!0:"3"===i.code?re.value.insured.isSign=!0:"4"===i.code?re.value.holder.isShareSign=!0:"5"===i.code&&(re.value.insured.isShareSign=!0)})),"riskNotificationCopy"===e.name&&(oe.value.text=e.remark,de.value.scribing=e.required,e.columns.forEach((e=>{"1"===e.code?oe.value.type="handle":oe.value.type="auto"}))),"customerFace"===e.name&&e.columns.forEach((i=>{e.required&&de.value.verify.push(i.code),"1"===i.code?re.value.holder.isVerify=!0:"2"===i.code&&(re.value.insured.isVerify=!0)}))}))}})),((e=!1)=>{J&&C({orderNo:K||J,tenantId:M}).then((({code:i,data:a})=>{var s,t,n,r,o;"10000"===i&&(e&&((null==(s=null==a?void 0:a.holder)?void 0:s.isCert)===b.NO||(null==a?void 0:a.insuredList.some((e=>e.isCert===b.NO)))?g("用户未完身份认证及签字"):(null==a?void 0:a.tenantOrderAttachmentList.find((e=>e.category===j.ELECTRIC_SIGN&&e.objectType===S.HOLDER)))&&(null==a?void 0:a.tenantOrderAttachmentList.find((e=>e.category===j.ELECTRIC_SIGN&&e.objectType===S.INSURED)))||g("用户未完身份认证及签字")),Object.assign(ee.value,a),re.value.holder.personalInfo=a.holder,re.value.insured.personalInfo=a.insuredList,Object.assign(le.value,{type:I[a.extInfo.transcriptionType],signInfo:null==(n=null==(t=a.riskTranscriptionList)?void 0:t[0])?void 0:n.uri,text:null==(o=null==(r=a.riskTranscriptionList)?void 0:r[0])?void 0:o.content,status:!!a.extInfo.transcriptionStatus}),a.tenantOrderAttachmentList.forEach((e=>{e.objectType===N.HOlDER?re.value.holder.signData=e.fileBase64:e.objectType===N.AGENT?re.value.agent.signData=e.fileBase64:e.objectType===N.INSURED&&(re.value.insured.signData[e.objectId]=e.fileBase64)})))}))})()};return r((()=>{ce()})),(e,i)=>{const a=m,s=h,t=y;return o(),l("div",q,[d(a),u("div",_,[d(s,{type:"warning",title:"尊敬的客户，本次投保需要进行身份认证",content:"本产品投保需要对投保人、被保人进行实名认证，您购买本产品的累计总保费已超过20万，按监管要求，需要提供投保人、被保人、指定受益人证件影像，本产品非本人投保且带身故责任、需对投保人、被保人（成人）的投保意愿进行签字确认。"})]),u("div",A,[d(E,{ref_key:"agentSignRef",ref:se,"order-detail":c(ee),"sign-string":c(re).agent.signData,"show-sign":c(re).agent.isSign,"show-verify":c(re).agent.isVerify,"file-list":c(re).agent.fileList,"personal-info":c(re).agent.personalInfo,disabled:!!c(W),title:"代理人",onHandleSign:i[0]||(i[0]=e=>((e,i,a)=>{var s;V(e,i,null==(s=ee.value)?void 0:s.id,M,a)})("AGENT",e))},null,8,["order-detail","sign-string","show-sign","show-verify","file-list","personal-info","disabled"])]),u("div",G,[d(t,{type:"primary",onClick:ue},{default:f((()=>[p("确定")])),_:1})])])}}});export{U as default};
