import{ar as e,as as a,at as t,au as o,av as i,aw as r,ax as s,ay as l,az as u,aA as n,d,i as c,j as p,k as v,O as f,o as m,m as k,w as R,a as C,e as h,b as y,u as L,p as j,c as I,F as b,q as g,a8 as _,_ as w,T,aB as q,aC as P,aD as x,aE as S,aF as M,h as N,aG as V,f as A,s as O}from"./index-4705aaa0.js";import{T as D}from"./index-a9674dc9.js";import{a as K,b as E,g as B,s as F,i as U,m as $}from"./trial-1e93a22e.js";import{_ as H}from"./index-a5066b90.js";import{S as z}from"./index-479f1794.js";import{R as G}from"./trial-e598285a.js";import{_ as J}from"./TrialButton-62d38be7.js";import{u as Q}from"./useOrder-8955cec1.js";import{B as W,a as X}from"./constants-4b08cf92.js";import{p as Y,a as Z}from"./utils-7aa848fd.js";import{c as ee,t as ae,i as te,g as oe,b as ie}from"./index-4fbb693a.js";import{c as re}from"./cloneDeep-31e7c8a4.js";import"./InsureInfos-0024193a.js";import"./index-de590a0b.js";import"./infoCollection-602de8d1.js";import"./index-c0bb0311.js";import"./PolicyInfo-1f3ea1ab.js";import"./lodash-22bb0857.js";import"./questionnaire-42dcb602.js";import"./util-80d6b5ac.js";import"./product-7bbf9c44.js";import"./constants-5a85ece3.js";import"./config-98e8d477.js";import"./utils-86385b27.js";import"./createProposal-1cf5df1d.js";import"./nextStep-a5f7cbad.js";import"./core-af3d659b.js";import"./format-31cde443.js";import"./empty-ae586b6c.js";import"./index-e7ae0bb3.js";import"./utils-5fb2762f.js";function se(a){var t=function(a){return a?1/0===(a=e(a))||-1/0===a?17976931348623157e292*(a<0?-1:1):a==a?a:0:0===a?a:0}(a),o=t%1;return t==t?o?t-o:t:0}function le(e,a,t,o){for(var i=e.length,r=t+(o?1:-1);o?r--:++r<i;)if(a(e[r],r,e))return r;return-1}function ue(e){return e==e&&!o(e)}function ne(e,a){return function(t){return null!=t&&(t[e]===a&&(void 0!==a||e in Object(t)))}}function de(e){var o=function(e){for(var a=i(e),t=a.length;t--;){var o=a[t],r=e[o];a[t]=[o,r,ue(r)]}return a}(e);return 1==o.length&&o[0][2]?ne(o[0][0],o[0][1]):function(i){return i===e||function(e,o,i,r){var s=i.length,l=s,u=!r;if(null==e)return!l;for(e=Object(e);s--;){var n=i[s];if(u&&n[2]?n[1]!==e[n[0]]:!(n[0]in e))return!1}for(;++s<l;){var d=(n=i[s])[0],c=e[d],p=n[1];if(u&&n[2]){if(void 0===c&&!(d in e))return!1}else{var v=new a;if(r)var f=r(c,p,d,e,o,v);if(!(void 0===f?t(p,c,3,r,v):f))return!1}}return!0}(i,e,o)}}function ce(e,a){return null!=e&&a in Object(e)}function pe(e,a){return null!=e&&function(e,a,t){for(var o=-1,i=(a=ee(a,e)).length,n=!1;++o<i;){var d=ae(a[o]);if(!(n=null!=e&&t(e,d)))break;e=e[d]}return n||++o!=i?n:!!(i=null==e?0:e.length)&&r(i)&&s(d,i)&&(l(e)||u(e))}(e,a,ce)}function ve(e){return te(e)?(a=ae(e),function(e){return null==e?void 0:e[a]}):function(e){return function(a){return ie(a,e)}}(e);var a}function fe(e){return"function"==typeof e?e:null==e?n:"object"==typeof e?l(e)?(a=e[0],o=e[1],te(a)&&ue(o)?ne(ae(a),o):function(e){var i=oe(e,a);return void 0===i&&i===o?pe(e,a):t(o,i,3)}):de(e):ve(e);var a,o}var me=Math.max;var ke=Math.max,Re=Math.min;const Ce={class:"popup-container"},he={class:"popup-header"},ye={class:"title"},Le=(e=>(S("data-v-0a46ec37"),e=e(),M(),e))((()=>C("p",{class:"tip"},"已为您挑选出以下险种",-1))),je={class:"search"},Ie={key:0,class:"risk-list"},be=d({name:"riskSelect"});var ge=w(d({...be,props:{type:{default:2},show:{type:Boolean,default:!1},title:{},insuredList:{default:()=>[]},mainRiskCode:{default:""},selectList:{default:()=>[]},currentProductCode:{default:""}},emits:["cancel","confirm"],setup(e,{emit:a}){const t=e,o=c(),{insurerCode:i}=o.query,r=p([]),s=p([]),l=p([]),u=p(),n=v((()=>t.show)),d=()=>{a("cancel")},w=()=>{var e;if(!(null==(e=r.value)?void 0:e.length))return void T(`暂未添加任何${t.type===G.MAIN_RISK?"主":"附加"}险`);let o=[];o=t.type===G.RIDER_RISK?r.value:s.value.filter((e=>r.value.includes(e.productCode))).map((e=>({productCode:e.productCode,mergeRiskReqList:(e.mainRiskCollocationList||[]).map((e=>({riskCode:e.collocationRiskCode,riskType:e.mainRiskCode?2:1,mainRiskCode:e.mainRiskCode})))}))),a("confirm",o)},S=async()=>{var e;const a={insuredList:t.insuredList,mainRiskCode:t.mainRiskCode,insurerCode:i,productCategory:"",keyword:u.value,selectProductCodes:[],selectRiskCodes:[],filterFlag:(null==(e=t.selectList)?void 0:e.length)?1:2};if(a.selectProductCodes=t.selectList.map((e=>(e.productCode===t.currentProductCode&&a.selectRiskCodes.push(...e.mergeRiskReqList.map((e=>e.riskCode))),e.productCode))),t.type===G.MAIN_RISK){const{code:e,data:t}=await K(a);"10000"===e&&(s.value=t)}else{const{code:e,data:t}=await E(a);"10000"===e&&(s.value=t.riskInfoList,l.value=t.collocationInfoResList)}};return f((()=>{S()})),(e,a)=>{const o=z,i=q,c=P,p=H,v=x;return m(),k(v,{show:L(n),"onUpdate:show":a[2]||(a[2]=e=>j(n)?n.value=e:null),class:"popup-risk-select",closeable:!1},{default:R((()=>{var n;return[C("div",Ce,[C("div",he,[C("span",{class:"clear-all",onClick:d}," 取消 "),C("span",ye,h(e.title),1),C("span",{class:"close",onClick:w},"确认")]),Le,C("div",je,[y(o,{modelValue:L(u),"onUpdate:modelValue":a[0]||(a[0]=e=>j(u)?u.value=e:null),shape:"round",placeholder:"请输入产品名称进行搜索","clear-trigger":"always","show-action":"",clearable:"",onSearch:S},null,8,["modelValue"])]),(null==(n=L(s))?void 0:n.length)?(m(),I("div",Ie,[y(c,{modelValue:L(r),"onUpdate:modelValue":a[1]||(a[1]=e=>j(r)?r.value=e:null)},{default:R((()=>[(m(!0),I(b,null,g(L(s),(e=>(m(),k(i,{key:e.riskCode||e.productCode,name:e.riskCode||e.productCode,onClick:()=>{return a=e.riskCode,t.type===G.RIDER_RISK&&(l.value||[]).forEach((e=>{r.value.includes(a)?a===e.relatedRiskCode?(2===e.collocationType&&r.value.push(e.collocationRiskCode),3===e.collocationType&&(r.value.push(a),r.value=r.value.filter((a=>a!==e.collocationRiskCode)))):a===e.collocationRiskCode&&(2===e.collocationType&&r.value.push(e.relatedRiskCode),3===e.collocationType&&(r.value=r.value.filter((a=>a!==e.relatedRiskCode)))):a===e.relatedRiskCode?(2===e.collocationType&&(r.value=r.value.filter((a=>a!==e.collocationRiskCode))),3===e.collocationType&&(r.value.push(a),r.value=r.value.filter((a=>a!==e.collocationRiskCode)))):a===e.collocationRiskCode&&(2===e.collocationType&&(r.value=r.value.filter((a=>a!==e.relatedRiskCode))),3===e.collocationType&&(r.value=r.value.filter((a=>a!==e.relatedRiskCode))))})),void(r.value=[...new Set(r.value)]);var a}},{default:R((()=>[_(h(e.riskName||e.productName),1)])),_:2},1032,["name","onClick"])))),128))])),_:1},8,["modelValue"])])):(m(),k(p,{key:1,title:`暂无关联${e.type===L(G).MAIN_RISK?"主":"附加"}险、请选择其他险种`},null,8,["title"]))])]})),_:1},8,["show"])}}}),[["__scopeId","data-v-0a46ec37"]]);const _e={class:"page-trial-wrap"},we=d({name:"trial"}),Te=d({...we,setup(e){const a=c(),t=N(),{productCode:o,orderNo:i,tenantId:r}=a.query,s=p({}),l=p({productList:[]}),u=p([]),n=p({}),d=p(),f=p(),C=Q({extInfo:{templateId:201,buttonCode:W.TRIAL_PREMIUM,pageCode:X.TRIAL_PREMIUM}}),h=p(),j=p(),b=p(1),g=v((()=>b.value===G.MAIN_RISK?"添加主险":"添加附加险")),_=p(!1),w=()=>{$(l.value).then((({code:e,data:a})=>{if("10000"===e){const{productDetailResList:e,productFactor:t}=a;j.value=t,l.value=Z(e);const o={};e.forEach((e=>{o[e.productCode]=e})),s.value=o}}))},T=()=>{_.value=!1},q=e=>{if(b.value===G.MAIN_RISK){l.value.productList.push(...e),console.log("selectCodeList",e);const a=e.map((e=>e.productCode));d.value.getProductDefaultValue(a)}else{const a=l.value.productList.find((e=>e.productCode===f.value)),t=e.map((e=>({riskCode:e,riskType:G.RIDER_RISK,mainRiskCode:n.value.riskCode}))),o=function(e,a,t){var o=null==e?0:e.length;if(!o)return-1;var i=null==t?0:se(t);return i<0&&(i=me(o+i,0)),le(e,fe(a),i)}(a.mergeRiskReqList,(e=>e.riskCode===n.value.riskCode)),i=function(e,a,t){var o=null==e?0:e.length;if(!o)return-1;var i=o-1;return void 0!==t&&(i=se(t),i=t<0?ke(o+i,0):Re(i,o-1)),le(e,fe(a),i,!0)}(a.mergeRiskReqList,(e=>e.mainRiskCode===n.value.riskCode));let r=o;-1!==i&&(r=i),a.mergeRiskReqList=[...a.mergeRiskReqList.slice(0,r+1),...t,...a.mergeRiskReqList.slice(r+1,a.mergeRiskReqList.length)],d.value.getRiderRiskDefaultValue(f.value,e,n.value.riskCode)}w(),_.value=!1},P=(e,a,t)=>{_.value=!0,b.value=G.RIDER_RISK,u.value=t,n.value=a,f.value=e},x=e=>{_.value=!0,b.value=G.MAIN_RISK,u.value=e},S=(e,a,t)=>{s.value[e],t?(s.value[e].productPlanInsureVOList[0].insureProductRiskVOList=s.value[e].productPlanInsureVOList[0].insureProductRiskVOList.filter((e=>e.riskCode!==a)),l.value.productList=l.value.productList.map((t=>(t.productCode===e&&(t.mergeRiskReqList=t.mergeRiskReqList.filter((e=>e.riskCode!==a))),t)))):(l.value.productList=l.value.productList.filter((a=>a.productCode!==e)),w())},M=()=>{d.value.onNext((async e=>{var o;const r=re(e),s=["id","relationToHolder","beneficiaryList","guardian","insuredBeneficiaryType"];i||Object.keys(null==(o=r.insuredList)?void 0:o[0]).reduce(((e,a)=>{var t,o,i,l;return!s.includes(a)&&(null==(o=null==(t=r.insuredList)?void 0:t[0])?void 0:o[a])&&(e[a]=null==(l=null==(i=r.insuredList)?void 0:i[0])?void 0:l[a]),e}),r.holder);const{code:l,data:u}=await F(r);"10000"===l&&t.push({path:O.questionNotice,query:{...a.query,orderNo:u}})}))};return V((()=>{i?B({orderNo:i,tenantId:r}).then((({code:e,data:a})=>{"10000"===e&&(h.value=a,C.value=a,l.value=Y(a.insuredList[0].productList),w())})):U({productCode:o,isTenant:!1}).then((({data:e,code:a})=>{var t,i;"10000"===a&&(s.value[`${o}`]=e,j.value=null==(i=null==(t=null==e?void 0:e.productPlanInsureVOList)?void 0:t[0])?void 0:i.productFactor,l.value=Z([e]))}))})),(e,a)=>(m(),I("div",_e,[y(D,{ref_key:"trialRef",ref:d,"product-collection":L(s),"default-data":L(h),"product-factor":L(j),"product-risk-code-map":L(l),"is-trial":"","hide-benefit":"",onAddRisk:P,onAddMainRisk:x,onDeleteRisk:S},{trialBtn:R((({riskPremium:e})=>[y(J,{premium:null==e?void 0:e.initialPremium,onHandleClick:M},null,8,["premium"])])),_:1},8,["product-collection","default-data","product-factor","product-risk-code-map"]),L(_)?(m(),k(ge,{key:0,type:L(b),show:L(_),"insured-list":L(u),title:L(g),"current-product-code":L(f),"main-risk-code":L(n).riskCode,"select-list":L(l).productList,onCancel:T,onConfirm:q},null,8,["type","show","insured-list","title","current-product-code","main-risk-code","select-list"])):A("",!0)]))}});export{Te as default};
