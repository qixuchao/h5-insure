import{T as e,d as a,i as l,j as s,z as n,cm as t,cn as u,o as i,c as o,a as r,f as d,u as v,q as c,b as g,w as p,a8 as m,e as f,F as h,n as b,l as y,co as S,m as w,_,cp as k,ag as V,cq as C}from"./index-8067fbb0.js";var A=e;const T={class:"sign-wrap"},x=["src"],U={class:"popup-body"},j={class:"sign-container-wrap"},q={class:"operate-bar"},z=a({name:"sign"});var I=_(a({...z,props:{option:{default:{}},modelValue:{default:()=>[]},signString:{default:"房间卡贺卡和大伙副书记环境发好"},signAccount:{default:3}},emits:["update:modelValue","submitSign"],setup(e,{expose:a,emit:_}){const z=e,I=l(!1),N=l(),R=l([]),E=l(0),F=s((()=>{if(z.signString&&z.signString.length>=z.signAccount){const e=[];let a=0;for(let l=0;l<=z.signString.length;l++)!l||l%z.signAccount||(a+=1),z.signString[l]&&(e[a]?e[a]+=z.signString[l]:e[a]=z.signString[l]);return e}return[""]})),$=s((()=>{var e,a;return(null==(e=F.value)?void 0:e.length)!==(null==(a=R.value)?void 0:a.length)})),B=l(!0),D=l(),G=()=>{0!==E.value&&D.value&&(E.value-=1,D.value.swipeTo(E.value))},H=()=>{I.value=!0,setTimeout((()=>{var e;N.value&&((null==(e=z.modelValue)?void 0:e.length)?B.value=!1:B.value=!0)}),200)},J=()=>{k({images:R.value,className:"customer-sign-preview"})},K=()=>{I.value=!1},L=()=>{if(E.value===F.value.length-1)return;E.value,z.signAccount;F.value[E.value].length,D.value&&(E.value+=1,D.value.swipeTo(E.value))},M=()=>{(N.value||[]).forEach(((e,a)=>{var l;a===E.value&&(null==(l=e.clear)||l.call(e))}))},O=()=>{var e,a;(null==(e=R.value)?void 0:e.length)===(null==(a=F.value)?void 0:a.length)?(_("update:modelValue",R.value),_("submitSign",R.value),I.value=!1):A({message:"请完成签名",className:"toast-vertical"})};return n((()=>z.modelValue),(()=>{R.value=z.modelValue}),{immediate:!0,deep:!0}),a({rewrite:M,openSign:H}),(e,a)=>{var l;const s=V,n=t,_=u,k=C;return i(),o(h,null,[r("div",T,[d(e.$slots,"signImg",{data:null==(l=v(R))?void 0:l[0]},(()=>{var a;return[v(R).length?(i(),o("img",{key:0,class:"preview-sign",src:null==(a=v(R))?void 0:a[0],alt:"",onClick:J},null,8,x)):c("",!0),g(s,{type:"primary",round:"",size:"small",onClick:H},{default:p((()=>[m(f(e.signString?"重新签名":"点击签字"),1)])),_:1})]}),!0)]),g(k,{show:v(I),"onUpdate:show":a[1]||(a[1]=e=>w(I)?I.value=e:null),position:"bottom",style:{height:"100%",overflow:"hidden"}},{default:p((()=>[r("div",U,[r("div",j,[g(_,{ref_key:"swipeRef",ref:D,vertical:"",loop:!1,"show-indicators":!1,touchable:!1},{default:p((()=>[(i(!0),o(h,null,b(v(F),((e,l)=>(i(),y(n,{key:l},{default:p((()=>[g(S,{ref_for:!0,ref_key:"signRef",ref:N,modelValue:v(R)[l],"onUpdate:modelValue":e=>v(R)[l]=e,placeholder:e,onStroke:a[0]||(a[0]=e=>B.value=!1),onSignSuccess:L},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1024)))),128))])),_:1},512),r("div",q,[g(s,{type:"primary",class:"btn",disabled:v($),onClick:O},{default:p((()=>[m("确定")])),_:1},8,["disabled"]),g(s,{type:"primary",plain:"",class:"btn",onClick:G},{default:p((()=>[m("上一页")])),_:1}),g(s,{type:"primary",plain:"",class:"btn",onClick:M},{default:p((()=>[m("重签")])),_:1}),g(s,{type:"default",class:"btn",onClick:K},{default:p((()=>[m("取消")])),_:1})])])])])),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-7b7b39ec"]]);export{I as S};
