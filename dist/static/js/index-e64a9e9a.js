var Be=Object.defineProperty,De=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var ue=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var ie=(m,d,l)=>d in m?Be(m,d,{enumerable:!0,configurable:!0,writable:!0,value:l}):m[d]=l,y=(m,d)=>{for(var l in d||(d={}))he.call(d,l)&&ie(m,l,d[l]);if(ue)for(var l of ue(d))Pe.call(d,l)&&ie(m,l,d[l]);return m},P=(m,d)=>De(m,ge(d));import{g as pe,E as B,_ as oe,r as O,j as L,k as N,m as c,z as u,p as f,n as X,G as me,J as V,F as Ie,C as U,a9 as Te,O as Re,Q as be,M as xe,y as de,o as Fe,A as p,t as Q,d as le,T as Ne}from"./vendor-af6fda0a.js";import{_ as Ve,z as ke,w as He,r as Se,R as M,T as F,n as Ue,P as we}from"./index-8d721343.js";import{p as $e}from"./trial-ab6b7de8.js";import{f as ce,g as fe,h as je}from"./trial-7ac7d6f6.js";import{u as Me}from"./useDicData-b597c284.js";import{_ as re,R as Ye,B as qe,a as Ge,b as ze}from"./index-5e9f38c9.js";const Je={class:"com-select-container"},We={class:"radio-item-wrapper"},Ke={class:"name"},Qe={class:"hone"},Xe={class:"address"},Ze={class:"footer-button"},et=U("\u53D6\u6D88"),tt=U("\u786E\u8BA4"),nt=pe({props:{dataSource:{type:Array,default:()=>[]},show:{type:Boolean,default:!1},modelValue:{type:[String,Number],default:null}},emits:["update","update:modelValue","submit","close"],setup(m,{emit:d}){const l=m,T=B(l.modelValue),Y=B(l.show),Z=()=>{d("submit",T.value),Y.value=!1},ee=()=>{d("close")};return oe(()=>l.modelValue,w=>{console.log("newVal",w),T.value=w}),oe(()=>T.value,w=>{d("update:modelValue",w)}),(w,k)=>{const q=O("van-radio"),W=O("van-radio-group"),K=O("VanButton");return L(),N(ke,{show:Y.value,"onUpdate:show":k[1]||(k[1]=_=>Y.value=_),class:"com-select",title:"\u9009\u62E9\u4FDD\u5355\u901A\u8BAF\u4FE1\u606F",onClose:ee},{default:c(()=>[u("div",Je,[f(W,{modelValue:T.value,"onUpdate:modelValue":k[0]||(k[0]=_=>T.value=_)},{default:c(()=>[(L(!0),X(Ie,null,me(m.dataSource,(_,e)=>(L(),N(q,{key:e,name:e+1,class:"radio-item"},{default:c(()=>[u("div",We,[u("p",null,[u("span",Ke,V(_.contactName),1),u("span",Qe,V(_.contactPhoneNo),1)]),u("p",Xe,V(_.contactAddress),1)])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),u("div",Ze,[f(K,{plain:"",type:"primary"},{default:c(()=>[et]),_:1}),f(K,{type:"primary",onClick:Z},{default:c(()=>[tt]),_:1})])]),_:1},8,["show"])}}});var rt=Ve(nt,[["__scopeId","data-v-9c6de82e"]]);const ot={key:0,class:"beneficiary-part"},at={class:"part-title"},st={class:"title"},ut=U("\u5220\u9664"),it=U("+\u6DFB\u52A0\u53D7\u76CA\u4EBA"),dt=U("\u9009\u62E9\u4FDD\u5355\u901A\u8BAF\u4FE1\u606F"),lt={class:"radio-item-wrapper"},ct={class:"name"},ft={class:"hone"},pt={class:"address"},mt={class:"footer-button"},It={class:"left"},vt={class:"trial-result"},Ot=U(" \u9996\u671F"),_t={class:"result-num"},Et=u("div",{class:"result-desc"},"\u5B9E\u9645\u4FDD\u8D39\u4EE5\u540E\u7EED\u4E3A\u51C6",-1),Lt={class:"operate-btn"},yt=U("\u4E0B\u4E00\u6B65"),Tt=pe({setup(m){const d=Te(),l=Re(),{templateId:T=1,orderNo:Y="2022072710380711215",productCode:Z,tenantId:ee="9991000007",proposalId:w}=l.query,[k,q]=be(),W=l.path==="/infoPreview"?"infoPreview":"infoCollection",K=Me("NATIONAL_REGION_CODE"),_=B({}),e=B({extInfo:{pageCode:W},tenantOrderHolder:{extInfo:{occupationCodeList:[]},holderType:1},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},insuredBeneficiaryType:"1",tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}]}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}}),te=B(null),R=B([]),$=B([]),G=B([]),ne=B([]),ae=B([]),b=xe({beneficiaryId:0,nextPage:"",currentAddress:null,isLoading:!0}),se=de(()=>{var t,i,s,r,a,I,v,D,g,h;return[{contactAddress:(i=(t=e.value.tenantOrderHolder)==null?void 0:t.extInfo)==null?void 0:i.familyAddress,contactName:e.value.tenantOrderHolder.name,contactPhoneNo:e.value.tenantOrderHolder.mobile},{contactAddress:(r=(s=e.value.tenantOrderHolder)==null?void 0:s.extInfo)==null?void 0:r.workAddress,contactName:e.value.tenantOrderHolder.name,contactPhoneNo:e.value.tenantOrderHolder.mobile},{contactAddress:(I=(a=e.value.tenantOrderInsuredList[0])==null?void 0:a.extInfo)==null?void 0:I.familyAddress,contactName:(v=e.value.tenantOrderInsuredList[0])==null?void 0:v.name,contactPhoneNo:(D=e.value.tenantOrderInsuredList[0])==null?void 0:D.mobile},{contactAddress:(h=(g=e.value.tenantOrderInsuredList[0])==null?void 0:g.extInfo)==null?void 0:h.workAddress,contactName:e.value.tenantOrderInsuredList[0].name,contactPhoneNo:e.value.tenantOrderInsuredList[0].mobile}].filter(C=>C.contactAddress&&C.contactName&&C.contactPhoneNo)||[]}),z=de(()=>{var o,t;return b.currentAddress?se.value[b.currentAddress-1]||{}:((t=(o=e.value.extInfo)==null?void 0:o.contactInfo)==null?void 0:t[0])||{}}),ve=o=>{const t={};return o.map(i=>{const{initialAmount:s,annuityDrawFrequency:r,annuityDrawType:a,paymentFrequency:I,paymentPeriod:v,paymentPeriodType:D,insurancePeriodType:g,insurancePeriodValue:h,riskCode:C,riskType:H,initialPremium:j,liabilityDetails:S,extInfo:A}=i,{riskId:x,copy:n}=A,E={amount:s,annuityDrawDate:r,annuityDrawType:a,paymentFrequency:I,riskId:x,copy:n,chargePeriod:v?`${ce[D]}_${v}`:ce[D],coveragePeriod:h?`${fe[g]}_${h}`:fe[g],riskCode:C,riskType:H,premium:j,liabilityVOList:S};return H===je.mainRisk?(t.mainRiskCode=C,t.mainRiskId=x):Object.assign(E,t),E})},Oe=()=>{var t;const o=y({},e.value);o.extInfo=P(y({},o.extInfo),{contactInfo:[z.value]}),o.tenantOrderAttachmentList=[{category:M.OBVERSE_CERT,objectType:F.HOLDER,objectId:e.value.tenantOrderHolder.id,name:"\u6295\u4FDD\u4EBA\u8BC1\u4EF6\u6B63\u9762",uri:R.value[0],id:G.value[0]},{category:M.REVERSE_CERT,objectType:F.HOLDER,objectId:e.value.tenantOrderHolder.id,name:"\u6295\u4FDD\u4EBA\u8BC1\u4EF6\u80CC\u9762",uri:R.value[1],id:G.value[1]},{category:M.OBVERSE_CERT,objectType:F.INSURED,objectId:e.value.tenantOrderInsuredList[0].id,name:"\u88AB\u4FDD\u4EBA\u8BC1\u4EF6\u6B63\u9762",uri:$.value[0]||R.value[0],id:ne.value[1]},{category:M.REVERSE_CERT,objectType:F.INSURED,objectId:e.value.tenantOrderInsuredList[0].id,name:"\u88AB\u4FDD\u4EBA\u8BC1\u4EF6\u80CC\u9762",uri:$.value[1]||R.value[1],id:ne.value[1]}],(t=te.value)==null||t.validate().then(i=>{if(o.tenantOrderInsuredList[0].insuredBeneficiaryType===ze.SPECIFY){const s={};if(o.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.forEach(r=>{s[r.benefitOrder]?s[r.benefitOrder].sum+=Number(r.benefitRate):s[r.benefitOrder]={sum:Number(r.benefitRate)}}),Object.values(s).some(r=>r.sum!==100)){Ne.fail("\u540C\u4E00\u987A\u4F4D\u7684\u53D7\u76CA\u4EBA\u6BD4\u4F8B\u4E4B\u548C\u5FC5\u987B\u4E3A100");return}}Ue(o).then(({code:s,data:r})=>{s==="10000"&&r.pageAction.pageAction==="jumpToPage"&&d.push({path:we[r.pageAction.data.nextPageCode],query:l.query})})})},_e=()=>{var o;(o=te.value)==null||o.validate().then(()=>{const{birthday:t,gender:i,extInfo:s}=e.value.tenantOrderHolder,{hasSocialInsurance:r,occupationCodeList:a}=s,{birthday:I,gender:v,extInfo:D,tenantOrderProductList:g}=e.value.tenantOrderInsuredList[0],{hasSocialInsurance:h,occupationCodeList:C}=D,H={holder:{personVO:{birthday:le(t).format("YYYY-MM-DD"),gender:i,socialFlag:r,occupationCodeList:a}},productCode:Z,insuredVOList:[{insuredCode:"",personVO:{birthday:le(I).format("YYYY-MM-DD"),gender:v,socialFlag:h,occupationCodeList:C},productPlanVOList:[{insurerCode:"",planCode:"",riskVOList:ve(g[0].tenantOrderRiskList)}]}]};$e(y({},H)).then(({code:j,data:S})=>{if(j==="10000"){const A={},x=(n=[])=>{(n||[]).forEach(E=>{var J;A[E.riskCode]=E,((J=E.riskPremiumDetailVOList)==null?void 0:J.length)&&x(E.riskPremiumDetailVOList)})};x(S.riskPremiumDetailVOList),e.value.tenantOrderInsuredList[0].tenantOrderProductList[0]=P(y({},e.value.tenantOrderInsuredList[0].tenantOrderProductList[0]),{premium:S.premium,tenantOrderRiskList:e.value.tenantOrderInsuredList[0].tenantOrderProductList[0].tenantOrderRiskList.map(n=>P(y({},n),{initialAmount:A[n.riskCode].amount,initialPremium:A[n.riskCode].premium}))}),Oe()}})})},Ee=o=>{console.log("value",o)},Le=()=>{b.beneficiaryId+=1,e.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.push({id:b.beneficiaryId,extInfo:{}})},ye=o=>{e.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList=e.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.filter(t=>t.beneficiaryId!==o.beneficiaryId||o.id!==t.id)},Ce=()=>{Se({orderNo:Y,tenantId:ee}).then(({code:o,data:t})=>{var i,s;if(o==="10000"){const r=t;r.extInfo=P(y({},r.extInfo),{pageCode:W,templateId:T}),r.tenantOrderHolder=r.tenantOrderHolder||{holderType:1},r.tenantOrderHolder.extInfo=P(y({},r.tenantOrderHolder.extInfo),{occupationCodeList:((i=r.tenantOrderHolder.extInfo)==null?void 0:i.occupationCodeList)||[]}),r.tenantOrderInsuredList[0].extInfo=P(y({},r.tenantOrderInsuredList[0].extInfo),{occupationCodeList:((s=r.tenantOrderInsuredList[0].extInfo)==null?void 0:s.occupationCodeList)||[]}),r.tenantOrderInsuredList[0].tenantOrderBeneficiaryList=r.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.map(a=>{var v;const I=a;return I.extInfo=P(y({},I.extInfo),{occupationCodeList:((v=I.extInfo)==null?void 0:v.occupationCodeList)||[]}),I}),r.tenantOrderAttachmentList.forEach(a=>{a.category===M.OBVERSE_CERT?a.objectType===F.HOLDER?(R.value[0]=a.uri,G.value[0]=a.id):a.objectType===F.INSURED&&($.value[0]=a.uri,ne.value[0]=a.id):a.category===M.REVERSE_CERT&&(a.objectType===F.HOLDER?(R.value[1]=a.uri,G.value[1]=a.id):a.objectType===F.INSURED&&($.value[1]=a.uri,G.value[1]=a.id))}),Object.assign(e.value,r)}}).finally(()=>{b.isLoading=!1})},Ae=()=>{Object.assign(e.value.tenantOrderInsuredList[0],e.value.tenantOrderHolder,{id:e.value.tenantOrderInsuredList[0].id,extInfo:P(y({},e.value.tenantOrderHolder.extInfo),{insureProvinceCode:e.value.tenantOrderInsuredList[0].extInfo.insureProvinceCode,insureCityCode:e.value.tenantOrderInsuredList[0].extInfo.insureCityCode,insureAreaCode:e.value.tenantOrderInsuredList[0].extInfo.insureAreaCode})})};return Fe(()=>{Ce(),He({pageCode:"infoCollection",templateId:T}).then(({code:o,data:t})=>{if(o==="10000"){const i={BENEFICIARY:[],INSURER:[],HOLDER:[]};t.productInsureFactorList.forEach(s=>{(i[s.moduleType]=i[s.moduleType]||[]).push(s)}),_.value=i}})}),oe([()=>e.value.tenantOrderInsuredList[0].relationToHolder,()=>e.value.tenantOrderHolder],()=>{`${e.value.tenantOrderInsuredList[0].relationToHolder}`===Ge.SELF&&Ae()},{deep:!0,immediate:!0}),(o,t)=>{const i=O("ProCard"),s=O("ProRadioButton"),r=O("ProField"),a=O("ProCascader"),I=O("ProSvg"),v=O("VanButton"),D=O("ProCheckButton"),g=O("van-cell"),h=O("ProForm"),C=O("ProPageWrap");return L(),N(C,{class:"page-info-wrapper"},{default:c(()=>{var H,j,S,A,x;return[p(b).isLoading?Q("",!0):(L(),N(h,{key:0,ref_key:"formRef",ref:te},{default:c(()=>[f(i,{title:"\u6295\u4FDD\u4EBA"},{default:c(()=>[f(re,{images:R.value,"onUpdate:images":t[0]||(t[0]=n=>R.value=n),"form-info":e.value.tenantOrderHolder,"factor-list":_.value.HOLDER,prefix:"holder"},null,8,["images","form-info","factor-list"])]),_:1}),f(i,{title:"\u88AB\u4FDD\u4EBA"},{default:c(()=>[f(r,{modelValue:e.value.tenantOrderInsuredList[0].relationToHolder,"onUpdate:modelValue":t[2]||(t[2]=n=>e.value.tenantOrderInsuredList[0].relationToHolder=n),label:"\u4E3A\u8C01\u4FDD\u5355",name:"relationToHolder",placeholder:"\u8BF7\u9009\u62E9"},{input:c(()=>[f(s,{modelValue:e.value.tenantOrderInsuredList[0].relationToHolder,"onUpdate:modelValue":t[1]||(t[1]=n=>e.value.tenantOrderInsuredList[0].relationToHolder=n),options:p(Ye)},null,8,["modelValue","options"])]),_:1},8,["modelValue"]),+e.value.tenantOrderInsuredList[0].relationToHolder!=1?(L(),N(re,{key:0,images:$.value,"onUpdate:images":t[3]||(t[3]=n=>$.value=n),"form-info":e.value.tenantOrderInsuredList[0],"factor-list":_.value.INSURER||[],prefix:"insure"},null,8,["images","form-info","factor-list"])):Q("",!0),f(a,{modelValue:e.value.tenantOrderInsuredList[0].extInfo.insureAreaCode,"onUpdate:modelValue":t[4]||(t[4]=n=>e.value.tenantOrderInsuredList[0].extInfo.insureAreaCode=n),field1:e.value.tenantOrderInsuredList[0].extInfo.insureProvinceCode,"onUpdate:field1":t[5]||(t[5]=n=>e.value.tenantOrderInsuredList[0].extInfo.insureProvinceCode=n),field2:e.value.tenantOrderInsuredList[0].extInfo.insureCityCode,"onUpdate:field2":t[6]||(t[6]=n=>e.value.tenantOrderInsuredList[0].extInfo.insureCityCode=n),field3:e.value.tenantOrderInsuredList[0].extInfo.insureAreaCode,"onUpdate:field3":t[7]||(t[7]=n=>e.value.tenantOrderInsuredList[0].extInfo.insureAreaCode=n),label:"\u6295\u4FDD\u5730\u533A",name:"insureAreaCode",placeholder:"\u8BF7\u9009\u62E9","is-link":"",required:"","data-source":p(K),mapping:{label:"name",value:"code",children:"children"}},null,8,["modelValue","field1","field2","field3","data-source"])]),_:1}),f(i,{title:"\u53D7\u76CA\u4EBA"},{default:c(()=>[f(r,{modelValue:e.value.tenantOrderInsuredList[0].insuredBeneficiaryType,"onUpdate:modelValue":t[9]||(t[9]=n=>e.value.tenantOrderInsuredList[0].insuredBeneficiaryType=n),label:"\u53D7\u76CA\u4EBA\u7C7B\u578B",name:"insuredBeneficiaryType",placeholder:"\u8BF7\u9009\u62E9"},{input:c(()=>[f(s,{modelValue:e.value.tenantOrderInsuredList[0].insuredBeneficiaryType,"onUpdate:modelValue":t[8]||(t[8]=n=>e.value.tenantOrderInsuredList[0].insuredBeneficiaryType=n),options:p(qe)},null,8,["modelValue","options"])]),_:1},8,["modelValue"]),e.value.tenantOrderInsuredList[0].insuredBeneficiaryType==2?(L(),X("div",ot,[(L(!0),X(Ie,null,me(e.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList,(n,E)=>(L(),X("div",{key:n.beneficiaryId||n.id,class:"beneficiary-item"},[u("div",at,[u("span",st,V(`\u53D7\u76CA\u4EBA${E+1}`),1),f(I,{name:"delete",onClick:J=>ye(n)},{default:c(()=>[ut]),_:2},1032,["onClick"])]),f(re,{images:ae.value,"onUpdate:images":t[10]||(t[10]=J=>ae.value=J),"form-info":n,"factor-list":_.value.BENEFICIARY||[],prefix:`beneficiary-${E}`,"beneficiary-list":e.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList},null,8,["images","form-info","factor-list","prefix","beneficiary-list"])]))),128)),f(v,{onClick:Le},{default:c(()=>[it]),_:1})])):Q("",!0)]),_:1}),f(i,{title:"\u4FDD\u5355\u901A\u8BAF\u4FE1\u606F"},{default:c(()=>{var n;return[((n=Object.keys(p(z)))==null?void 0:n.length)?(L(),N(g,{key:1,title:"\u5355\u5143\u683C","is-link":"",onClick:t[12]||(t[12]=E=>p(q)(!0))},{title:c(()=>[u("div",lt,[u("p",null,[u("span",ct,V(p(z).contactName),1),u("span",ft,V(p(z).contactPhoneNo),1)]),u("p",pt,V(p(z).contactAddress),1)])]),_:1})):(L(),N(D,{key:0,activated:"",onClick:t[11]||(t[11]=E=>p(q)(!0))},{default:c(()=>[dt]),_:1}))]}),_:1})]),_:1},512)),u("div",mt,[u("div",It,[u("div",vt,[Ot,u("span",_t,"\uFFE5"+V((x=(A=(S=(j=(H=e.value.tenantOrderInsuredList)==null?void 0:H[0])==null?void 0:j.tenantOrderProductList)==null?void 0:S[0].premium)==null?void 0:A.toLocaleString)==null?void 0:x.call(A)),1)]),Et]),u("div",Lt,[f(v,{block:"",type:"primary",onClick:_e},{default:c(()=>[yt]),_:1})])]),p(k)?(L(),N(rt,{key:1,modelValue:p(b).currentAddress,"onUpdate:modelValue":t[13]||(t[13]=n=>p(b).currentAddress=n),show:p(k),"data-source":p(se),onSubmit:Ee,onClose:t[14]||(t[14]=n=>p(q)(!1))},null,8,["modelValue","show","data-source"])):Q("",!0)]}),_:1})}}});export{Tt as default};
