import{g as Ge,a9 as Je,O as je,E as p,M as ue,y as se,_ as Xe,l as Qe,h as Ze,r as le,af as ea,j as U,n as ie,p as y,m as Y,H as aa,t as $,z as k,A as d,J as L,C as Ce,k as ce,F as ta,D as ra,T as C,X as oa}from"./vendor-f5ae78f6.js";import{_ as na,C as de,a0 as ua,H as sa,I as me,a1 as pe}from"./index-ba1e5cac.js";import{a as K}from"./order-26db6dbf.js";import{S as x,R as D,f as fe,I as la}from"./infoCollection-192ba138.js";import{p as he,i as ia,s as ca,g as da,u as ma,a as pa}from"./trial-e7097d51.js";import{p as fa}from"./product-4a3d7197.js";import{a as ve,o as ye,t as ha,b as va,h as Fe,g as S}from"./utils-dca74bba.js";import{t as ya}from"./theme-ea709837.js";import{d as ge,B as Fa,D as ga,G as Ea,S as Ca,H as Da,P as Ia,U as Na,_ as wa,W as _a,a as Ee}from"./auth-3d6f032f.js";import{_ as Aa}from"./index-e361f723.js";import"./utils-b6782348.js";import"./trial-aaf4025a.js";import"./index-8710b338.js";import"./bankCard-0e4ce564.js";import"./phoneVerify-0326deac.js";const Ba={key:0},Pa={class:"page-internet-product-detail"},Ta={class:"info"},ka={class:"footer-button"},Sa={class:"price"},Ha=Ce(" \u603B\u4FDD\u8D39"),ba=Ge({setup(Oa){const De=Je(),W=je(),{productCode:z="BWYL2021",tenantId:f,orderNo:w,phoneNo:Ie,agentCode:H="",saleChannelId:Ne,paymentMethod:we,certNo:G,name:J,pageCode:_e,from:Ae}=W.query,_=p(),c=p(),b=p(),h=p(),R=_e==="payBack",A=p(!1),B=p(!1),I=p(!1),j=p(0),M=p(!1),V=p(!1),O=p({show:!1,html:""});let q="";const e=ue({holder:{certNo:G,certType:de.CERT,mobile:Ie,name:J,socialFlag:x.HAS},insured:{certNo:G,certType:de.CERT,name:J,socialFlag:x.HAS,relationToHolder:D.SELF},paymentMethod:we,renewalDK:"Y",paymentFrequency:fe.YEAR,packageProductList:[],mobileSmsCode:""}),X=p(ge),P=p(ge),s=ue({showInsure:!R,canInsure:!1,canUpgrade:!1}),Be=se(()=>{var a,t;return((t=(a=c.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(r=>r.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),Pe=se(()=>{var a,t;return((t=(a=c.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(r=>r.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),Te=()=>{if(e.holder.certNo){const a=S(e.holder.certNo,"year"),t=me(e.holder.certNo);if(a<18)return C("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E18\u5C81\uFF01"),!1;if(e.insured.certNo&&e.insured.relationToHolder===D.MATE){const r=me(e.insured.certNo);if(t===r)return C("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(e.insured.certNo){const a=S(e.insured.certNo,"day"),t=S(e.insured.certNo,"year");if(e.insured.relationToHolder===D.CHILD&&a<30)return C("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(e.insured.relationToHolder===D.PARENT&&t>=71)return C("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E70\u5C81\uFF01"),!1}if([D.CHILD,D.PARENT].includes(e.insured.relationToHolder)){const a=S(e.holder.certNo,"year"),t=S(e.insured.certNo,"year");if(e.insured.relationToHolder===D.CHILD&&a-t<18)return C("\u6295\u4FDD\u4EBA\u548C\u5B50\u5973\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1;if(e.insured.relationToHolder===D.PARENT&&t-a<18)return C("\u6295\u4FDD\u4EBA\u548C\u7236\u6BCD\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1}return!0},ke=()=>{const{holder:{certNo:a,mobile:t,name:r,socialFlag:u},insured:{certNo:o,name:n,socialFlag:l,relationToHolder:m},paymentMethod:v}=e;return!!(sa(o)&&!!l)},Q=()=>{De.push({path:"/internet/guaranteeUpgrade",query:{...W.query,tenantId:f,productCode:"BWYL2022",orderNo:w,agentCode:H}})},Se=()=>{V.value=!1},He=()=>{P.value=X.value},be=()=>{P.value={...P.value,relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1}},Oe=async a=>{C.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const t=await ma(a),{code:r}=t;if(r==="10000"){C.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const u=await pa({orderNo:a.orderNo,tenantId:f}),{data:o}=u;u.code==="10000"&&(o.type===2?(O.value={show:!0,html:o.paymentUrl},console.log("data.paymentUrl",O.value),oa(()=>{console.log("document.forms",document.forms);const n=document.getElementById("cashierSubmit");n==null||n.addEventListener("submit",l=>{l.preventDefault()}),n==null||n.submit()})):window.location.href=o.paymentUrl)}s.canInsure=!0}catch{s.canInsure=!0}},Ue=a=>`${pe}/pay?orderNo=${a}&saleUserId=${H}&tenantId=${f}`,Le=a=>`${pe}/internet/payFail?tenantId=${f}&orderNo=${a}&agentCode=${H}&pageCode=payBack&from=${Ae||"normal"}`,xe=async a=>{console.log("risk",a);const t=va({tenantId:f,saleUserId:H,saleChannelId:Ne,detail:c.value,insureDetail:b.value,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,renewalDK:e.renewalDK,iseeBizNo:q,successJumpUrl:"",premium:h.value,holder:e.holder,insured:e.insured,tenantOrderRiskList:a,orderStatus:"",orderTopStatus:""});try{const r=await ca(t),{code:u,data:o}=r;u==="10000"&&Oe({...t,orderNo:o.data,extInfo:{extraInfo:{renewalDK:e.renewalDK,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,successJumpUrl:Ue(o.data),failUrl:Le(o.data)},iseeBizNo:q}})}catch{s.canInsure=!0}},Re=async()=>{const{calcData:a,riskVOList:t}=ve({holder:e.holder,insured:e.insured,tenantId:f,productDetail:c.value,insureDetail:b.value,paymentFrequency:e.paymentFrequency,packageRiskIdList:ye(e.packageProductList)},!1,Fe);if(!Array.isArray(t)||t.length<1)return h.value=null,{};const r=await he(a),{code:u,data:o}=r;return u==="10000"?(h.value=o.premium,{condition:t,data:o}):(h.value=null,{})},Me=a=>{j.value=a,I.value=!0},Ve=()=>new Promise((a,t)=>{var r,u;(u=(r=_.value)==null?void 0:r.validateForm)==null||u.call(r).then(async()=>{var g;if(!Te()){s.canInsure=!0;return}if(!(((g=_.value)==null?void 0:g.isAgreeFile)||A.value)){A.value=!1,I.value=!0,Me(0);return}const{calcData:n,riskVOList:l}=ve({holder:e.holder,insured:e.insured,tenantId:f,productDetail:c.value,insureDetail:b.value,paymentFrequency:e.paymentFrequency,packageRiskIdList:ye(e.packageProductList)},!1,Fe);(!Array.isArray(l)||l.length<1)&&(h.value=null,t(new Error));const m=await he(n),{code:v,data:F}=m;v==="10000"?(h.value=F.premium,a({condition:l,data:F})):(h.value=null,t(new Error))}).catch(()=>{s.canInsure=!0})}),Z=async()=>{var a;if(R){Q();return}s.canInsure=!1;try{const{condition:t,data:r}=await Ve(),u={},o=(l=[])=>{(l||[]).forEach(m=>{var v;u[m.riskCode]=m,(v=m.riskPremiumDetailVOList)!=null&&v.length&&o(m.riskPremiumDetailVOList)})};o(r.riskPremiumDetailVOList);const n=ha({tenantId:f,riskList:t,riskPremium:u,productId:(a=c.value)==null?void 0:a.id});xe(n)}catch{s.canInsure=!0}},qe=a=>{a==="allFalse"?(B.value=!1,A.value=!0,Z(),s.canInsure=!0):ra.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"}).then(()=>{window.history.back()}).catch(()=>{var t;(t=_.value)==null||t.reEditForm(),A.value=!1,s.canInsure=!0})},ee=()=>{var a;(a=_.value)==null||a.reEditForm(),A.value=!1,s.canInsure=!0},Ye=()=>{console.log("onCloseHealthPopup========"),B.value=!1,ee()},$e=()=>{console.log("onCloseFilePreview========"),I.value=!1,ee()},Ke=()=>{I.value=!1,B.value=!0};Xe([()=>e.insured.certNo,()=>e.insured.socialFlag,()=>e.packageProductList,()=>e.paymentFrequency],Qe.exports.debounce(()=>{e.insured.certNo&&e.insured.socialFlag&&ke()&&Re()},500),{deep:!0,immediate:!0});const ae=async()=>{var u,o,n,l,m,v,F,g,T,te,re,oe,ne;const a=await da({orderNo:w,tenantId:f}),{code:t,data:r}=a;if(t==="10000"){const{tenantOrderHolder:E,tenantOrderInsuredList:i,extInfo:N}=r;if(!R){Object.assign(e,{holder:{certNo:E.certNo,certType:E.certType,mobile:E.mobile,name:E.name,socialFlag:x.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(u=i[0])==null?void 0:u.certType,name:(o=i[0])==null?void 0:o.name,socialFlag:(l=(n=i[0])==null?void 0:n.extInfo)==null?void 0:l.hasSocialInsurance,relationToHolder:(m=i[0])==null?void 0:m.relationToHolder},paymentMethod:N.extraInfo.paymentMethod,paymentFrequency:N.extraInfo.paymentFrequency,renewalDK:N.extraInfo.renewalDK||"N"}),s.canInsure=!0;return}Object.assign(e,{holder:{certNo:E.certNo,certType:E.certType,mobile:E.mobile,name:E.name,socialFlag:x.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(v=i[0])==null?void 0:v.certType,name:(F=i[0])==null?void 0:F.name,socialFlag:(T=(g=i[0])==null?void 0:g.extInfo)==null?void 0:T.hasSocialInsurance,relationToHolder:(te=i[0])==null?void 0:te.relationToHolder},paymentMethod:N.extraInfo.paymentMethod,paymentFrequency:N.extraInfo.paymentFrequency,renewalDK:N.extraInfo.renewalDK||"N"}),h.value=(ne=(oe=(re=i[0])==null?void 0:re.tenantOrderProductList)==null?void 0:oe[0])==null?void 0:ne.premium,(r.orderStatus===K.ACCEPT_POLICY||r.orderStatus===K.PAYMENT_SUCCESS)&&(s.canUpgrade=!0,M.value=!1,V.value=!0),r.orderStatus===K.PAYING&&(M.value=!0,setTimeout(()=>{ae()},3*1e3))}},We=async()=>{const a=fa({productCode:z,withInsureInfo:!0,tenantId:f}),t=ia({productCode:z});await Promise.all([a,t]).then(([r,u])=>{var o,n;r.code==="10000"&&(c.value=r.data,document.title=((o=r.data)==null?void 0:o.productFullName)||""),u.code==="10000"&&(e.packageProductList=(((n=u.data)==null?void 0:n.packageProductVOList)||[]).map(l=>({...l,value:la.UN_INSURE,disabled:!1})),b.value=u.data)}),w&&ae()},ze=()=>{console.log("\u6295\u4FDD\u94FE\u63A5"),P.value=Ee,X.value=Ee,s.canInsure=!0};return Ze(()=>{ze(),We(),setTimeout(async()=>{q=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(a,t)=>{const r=le("van-button"),u=le("van-config-provider"),o=ea("dompurify-html");return U(),ie(ta,null,[y(u,{"theme-vars":d(ya)},{default:Y(()=>{var n,l,m,v,F,g,T;return[O.value.show?aa((U(),ie("div",Ba,null,512)),[[o,O.value.html]]):$("",!0),k("div",Pa,[k("div",Ta,[y(Fa,{url:(l=(n=c.value)==null?void 0:n.tenantProductInsureVO)==null?void 0:l.banner[0]},null,8,["url"]),y(ga,{"product-name":(m=c.value)==null?void 0:m.productFullName,"product-desc":(F=(v=c.value)==null?void 0:v.showConfigVO)==null?void 0:F.desc},null,8,["product-name","product-desc"])]),y(Ea,{"show-service-config":"","guarantee-list":(T=(g=c.value)==null?void 0:g.tenantProductInsureVO)==null?void 0:T.titleAndDescVOS},null,8,["guarantee-list"]),y(Ca,{detail:c.value},{form:Y(()=>[y(Da,{ref_key:"formRef",ref:_,"is-show-package":"",disable:!d(s).showInsure,"form-auth":P.value,"form-info":d(e),"product-detail":c.value,onOnReset:He,onOnUpdate:be},null,8,["disable","form-auth","form-info","product-detail"])]),_:1},8,["detail"]),k("div",ka,[k("div",Sa,[Ha,k("span",null,L(h.value?"\uFFE5":"")+L(d(ua)(h.value))+" "+L(h.value?d(e).paymentFrequency==d(fe).YEAR?"\u5143/\u5E74":"\u5143/\u6708":""),1)]),y(r,{type:"primary",class:"right",disabled:!(d(s).canInsure||d(s).canUpgrade),onClick:Z},{default:Y(()=>[Ce(L(d(s).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),d(w)?$("",!0):(U(),ce(Ia,{key:1,"product-detail":c.value},null,8,["product-detail"])),y(Na,{"order-no":d(w),"tenant-id":d(f),"is-show":V.value,onOnConfirm:Q,onOnClose:Se},null,8,["order-no","tenant-id","is-show"])]}),_:1},8,["theme-vars"]),y(wa,{show:B.value,"onUpdate:show":t[0]||(t[0]=n=>B.value=n),"content-list":d(Be),"active-index":0,onOnConfirmHealth:qe,onOnCloseHealth:Ye},null,8,["show","content-list"]),I.value?(U(),ce(Aa,{key:0,show:I.value,"onUpdate:show":t[1]||(t[1]=n=>I.value=n),"content-list":d(Pe),"active-index":j.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9","force-read-cound":2,"on-close-file-preview":"",onSubmit:Ke,onOnCloseFilePreview:$e},null,8,["show","content-list","active-index"])):$("",!0),y(_a,{"is-show":M.value},null,8,["is-show"])],64)}}});var Xa=na(ba,[["__scopeId","data-v-f3c54730"]]);export{Xa as default};
