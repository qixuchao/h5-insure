import{d as e,k as l,j as a,z as s,o as i,m as o,w as u,a as n,e as r,u as d,b as t,V as v,W as c,ce as m,cf as f,cg as p,ch as h,aB as y,ao as b,i as g,h as S,a6 as V,aj as C,O as k,c as q,f as j,F as w,a8 as x,T as I,bs as M,aL as L,a9 as O,aa as _,bp as E,ag as N}from"./index-c36709f0.js";import{n as U}from"./nextStep-d8c6df9e.js";import{c as F}from"./format-b5e9d8b9.js";import{g as $,m as P}from"./trial-583c6f95.js";import{p as A}from"./utils-e6a7dd2b.js";import{u as R}from"./useOrder-0ce328cb.js";import{P as T,a as B,B as D}from"./constants-b6eb977d.js";import{d as G,q as Y}from"./verify-044436ce.js";import"./core-25d60c3d.js";import"./utils-0a0c64ed.js";import"./infoCollection-ffb79216.js";import"./trial-55a5979d.js";const z={class:"popup-container"},H={class:"popup-header"},J={class:"title"},W={class:"popup-body"},K=e({name:"checkCodePopup"}),Q=e({...K,props:{show:{type:Boolean,default:!1},type:{default:"agent"},data:{default:()=>({})}},emits:["cancel","confirm"],setup(e,{emit:b}){const g=e,S=l((()=>g.show)),V=a({mobile:"",verifyCode:""}),C=l((()=>g.type)),k=a({holder:{type:"投保人",name:"",mobile:"",desc:""},agent:{type:"代理人",name:"李三",mobile:"13262278989",desc:"色卡上会计核算看回放独守空房还是空巅峰计划收款方"},insured:{type:"被保人",name:"",mobile:"",desc:""}}),q=()=>{b("cancel")},j=()=>{b("confirm")};return s([()=>g.data,g.type],(([e,l])=>{var a,s,i;e&&(Object.assign(k.value.holder,e.holder),Object.assign(k.value.insured,null==(a=null==e?void 0:e.insuredList)?void 0:a[0]),V.value.mobile=null==(i=null==(s=k.value)?void 0:s[`${g.type}`])?void 0:i.mobile)}),{immediate:!0,deep:!0}),(e,l)=>{const a=f,s=p,b=h,g=y;return i(),o(g,{show:S.value,"onUpdate:show":l[2]||(l[2]=e=>S.value=e),class:"popup-check-mobile",closeable:!1,"close-on-click-overlay":!1},{default:u((()=>[n("div",z,[n("div",H,[n("span",{class:"clear-all",onClick:q}," 取消 "),n("span",J,r(`${k.value[C.value].type}手机号验证`),1),n("span",{class:"close",onClick:j},"确认")]),n("div",W,[n("h3",null,r(`尊敬的${k.value[C.value].type}:${k.value[C.value].name}`),1),n("p",null,r(k.value[C.value].desc),1),n("h3",null,r(`${k.value[C.value].type}手机号验证 ${d(F)(k.value[C.value].mobile||"")}`),1),t(b,{model:V.value},{default:u((()=>[v(t(a,{modelValue:V.value.mobile,"onUpdate:modelValue":l[0]||(l[0]=e=>V.value.mobile=e),label:"被保人手机号",name:"mobile",maxlength:"11",required:""},null,8,["modelValue"]),[[c,!1]]),t(s,{modelValue:V.value.verifyCode,"onUpdate:modelValue":l[1]||(l[1]=e=>V.value.verifyCode=e),"related-name":"mobile",label:" ",maxlength:"6","input-align":"left",placeholder:"请输入验证码",name:"verifyCode","send-s-m-s-code":d(m),rules:""},null,8,["modelValue","send-s-m-s-code"])])),_:1},8,["model"])])])])),_:1},8,["show"])}}}),X=b([{label:"签名完成",value:1},{label:"去签名",value:2},{label:"认证失败，请联系内勤人员",value:3}]),Z=2,ee=b([{label:"去双录",value:1},{label:"双录完成",value:Z},{label:"双录失败",value:3}]);const le={class:"page-verify-wrap"},ae={class:"sign-list"},se={class:"inner-cell"},ie={class:"inner-cell"},oe={class:"inner-cell"},ue={class:"inner-cell"},ne={class:"footer-button"},re=e({name:"verify"}),de=e({...re,setup(e){const r=g(),v=S(),{orderNo:c,tenantId:y}=r.query,b=a(!1),F=a(),z=a(),H=a({holderMobile:"",holderVerifyCode:"",insuredMobile:"",insuredVerifyCode:""}),J=R(),W=a(!1),K=a({sign:[],verify:[],scribing:""}),re=a({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{},verifyStatus:2},agent:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2}}),de=a("agent"),te=l((()=>e=>K.value.sign.includes(e)||K.value.verify.includes(e))),ve=l((()=>re.value.agent.verifyStatus!==V.YES)),ce=l((()=>{const{insuredList:e}=J.value||{},{age:l,relationToHolder:a}=e[0]||{};return!(l<18||`${a}`===C.CERT)})),me=l((()=>e=>re.value[e].isSign||re.value[e].isVerify)),fe=l((()=>e=>re.value[e].isShareSign)),pe=e=>{de.value=e,"agent"!==e?ve.value||(W.value=!0):v.push({path:T.agentSign,query:r.query})},he=()=>{ve.value||F.value===Z||G(J.value).then((({code:e,data:l})=>{"10000"===e&&l&&I("双录已完成")}))},ye=()=>{W.value=!1},be=()=>{let e="";e=("agent"===de.value||(de.value,re.value[de.value].isVerify),T.infoPreview),v.push({path:e,query:{...r.query,objectType:de.value}})},ge=()=>{const{holder:e,insuredList:l,extInfo:a}=J.value;if(b.value){if(a.agentAuthFlag!==V.YES)return void I("代理人签名未完成")}else{if(a.agentAuthFlag===V.NO)return void I("代理人签名未完成");if(e.isCert===V.NO)return void I("投保人签名未完成");if(l[0].isCert===V.NO)return void I("被保人签名未完成")}const s=Object.assign(J.value,{extInfo:{...J.value.extInfo,pageCode:B.SIGN,buttonCode:D.SIGN}});U(s,((e,l)=>{l===L.JUMP_PAGE&&O(e.nextPageCode,r.query)}),r)};return s((()=>H.value),(()=>{}),{deep:!0,immediate:!0}),k((()=>{(async()=>{let e={};Y({orderNo:c,tenantId:y}).then((({code:e,data:l})=>{if("10000"===e){const{doubleRecordFlag:e,doubleRecordStatus:a}=l;b.value=e===V.YES,F.value=a}})),await $({orderNo:c,tenantId:y}).then((({code:l,data:a})=>{var s,i,o;if("10000"===l){Object.assign(J.value,a);const{agentAuthFlag:l}=a.extInfo,{mobile:u}=a.holder,{mobile:n}=(null==(s=a.insuredList)?void 0:s[0])||{};Object.assign(H.value,{holderMobile:u,insuredMobile:n}),e=A(a.insuredList[0].productList),re.value.agent.verifyStatus=l,re.value.holder.verifyStatus=a.holder.isCert,re.value.insured.verifyStatus=null==(o=null==(i=a.insuredList)?void 0:i[0])?void 0:o.isCert}})),await P(e).then((({data:e,code:l})=>{if("10000"===l){const{signInfo:l}=M(e.productFactor);l.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((l=>{e.required&&K.value.sign.push(l.code),"1"===l.code?re.value.agent.isSign=!0:"2"===l.code?re.value.holder.isSign=!0:"3"===l.code?re.value.insured.isSign=!0:"4"===l.code?re.value.holder.isShareSign=!0:"5"===l.code&&(re.value.insured.isShareSign=!0)})),"customerFace"===e.name&&e.columns.forEach((l=>{e.required&&K.value.verify.push(l.code),"1"===l.code?re.value.holder.isVerify=!0:"2"===l.code&&(re.value.insured.isVerify=!0)}))}))}}))})()})),(e,l)=>{const a=_,s=E,r=N;return i(),q("div",le,[t(a),n("div",ae,[d(me)("agent")?(i(),o(s,{key:0,title:"代理人签名",required:d(te)("agent")},{value:u((()=>[n("div",se,[t(s,{"is-link":"",value:d(X)[d(re).agent.verifyStatus],onClick:l[0]||(l[0]=e=>pe("agent"))},null,8,["value"])])])),_:1},8,["required"])):j("",!0),d(b)?(i(),o(d(h),{key:2,ref_key:"formRef",ref:z,model:d(H)},{default:u((()=>[t(d(f),{modelValue:d(H).holderMobile,"onUpdate:modelValue":l[3]||(l[3]=e=>d(H).holderMobile=e),label:"投保人手机号",name:"holderMobile",maxlength:"11",required:"","is-view":""},null,8,["modelValue"]),t(d(p),{modelValue:d(H).holderVerifyCode,"onUpdate:modelValue":l[4]||(l[4]=e=>d(H).holderVerifyCode=e),"related-name":"holderMobile",label:"验证码",maxlength:"6",name:"holderVerifyCode","send-s-m-s-code":d(m),rules:"",required:""},null,8,["modelValue","send-s-m-s-code"]),d(ce)?(i(),q(w,{key:0},[t(d(f),{modelValue:d(H).insuredMobile,"onUpdate:modelValue":l[5]||(l[5]=e=>d(H).insuredMobile=e),label:"被保人手机号",name:"insuredMobile",maxlength:"11",required:"","is-view":""},null,8,["modelValue"]),t(d(p),{modelValue:d(H).insuredVerifyCode,"onUpdate:modelValue":l[6]||(l[6]=e=>d(H).insuredVerifyCode=e),label:"验证码",maxlength:"6",name:"insuredVerifyCode","related-name":"insuredMobile","send-s-m-s-code":d(m),required:""},null,8,["modelValue","send-s-m-s-code"])],64)):j("",!0)])),_:1},8,["model"])):(i(),q(w,{key:1},[d(me)("holder")?(i(),o(s,{key:0,title:"投保人签名",required:d(te)("holder")},{value:u((()=>[n("div",ie,[d(fe)("holder")?(i(),o(s,{key:0,"value-class":""+(d(ve)?"disable":""),"is-link":"",value:"分享空签邀约"},null,8,["value-class"])):j("",!0),t(s,{"is-link":"",value:d(X)[d(re).holder.verifyStatus],"value-class":""+(d(ve)?"disable":""),onClick:l[1]||(l[1]=e=>pe("holder"))},null,8,["value","value-class"])])])),_:1},8,["required"])):j("",!0),d(me)("insured")&&d(ce)?(i(),o(s,{key:1,title:"被保人签名",required:d(te)("insured")},{value:u((()=>[n("div",oe,[d(fe)("insured")?(i(),o(s,{key:0,"value-class":""+(d(ve)?"disable":""),"is-link":"",value:"分享空签邀约"},null,8,["value-class"])):j("",!0),t(s,{"is-link":"","value-class":""+(d(ve)?"disable":""),value:d(X)[d(re).insured.verifyStatus],onClick:l[2]||(l[2]=e=>pe("insured"))},null,8,["value-class","value"])])])),_:1},8,["required"])):j("",!0)],64)),d(b)?(i(),o(s,{key:3,title:"保单双录",required:""},{value:u((()=>[n("div",ue,[t(s,{"is-link":"","value-class":""+(d(ve)?"disable":""),value:d(ee)[d(F)],onClick:he},null,8,["value-class","value"])])])),_:1})):j("",!0)]),n("div",ne,[t(r,{type:"primary",onClick:ge},{default:u((()=>[x("下一步")])),_:1})]),t(Q,{type:d(de),show:d(W),data:d(J),onCancel:ye,onConfirm:be},null,8,["type","show","data"])])}}});export{de as default};
