import{d as e,h as i,g as a,bA as s,i as r,aE as n,o as t,c as o,b as d,a as l,u,F as c,n as f,l as g,q as m,w as p,a8 as v,aK as h,ck as S,s as y,T as b,bq as j,aa as I,cl as L,ag as N}from"./index-d0a5373e.js";import{b as w}from"./product-7065b9e5.js";import{g as D,m as E}from"./trial-a436dbf2.js";import{_ as O}from"./SignPart-f01a77fe.js";import{u as q}from"./useOrder-6538ed77.js";import{N as C}from"./notice-33e6eedd.js";import{e as V,a as k}from"./verify-32c13a0a.js";import"./PolicyInfo-2971c758.js";import{a as R}from"./constants-fe95ef6f.js";import{p as U}from"./utils-64227400.js";import{g as _}from"./utils-92342654.js";import"./index-cea463ec.js";import"./infoCollection-f242d1c0.js";import"./trial-b6c2cf7f.js";const x={class:"long-verify"},P={class:"header"},M={class:"verify-content"},T={class:"footer-button footer-bar"},$=e({__name:"insuredSign",setup(e){const $=i(),z=a(),{tenantId:A,orderNo:F,orderCode:H,extraInfo:B,isShare:G,insurerCode:J,preview:K}=$.query;let Q={};try{Q=JSON.parse(decodeURIComponent(B))}catch(ae){}const W=q(),X=`${window.origin}/baseInsurance/long/phoneVerify?${s.stringify({...$.query,orderNo:H||F})}`,Y=r(),Z=r({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:""},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{}},agent:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:""}}),ee=r({sign:[],verify:[],scribing:""}),ie=()=>{if(K)return void h(R.SIGN,$.query);const e=[];Y.value&&((G?ee.value.sign.includes("5"):ee.value.sign.includes("3"))&&e.push(...(Y.value||[]).map((e=>e.validateSign()))),ee.value.verify.includes("2")&&e.push(...(Y.value||[]).map((e=>e.validateVerify())))),Promise.all(e).then((e=>{k({bizObjectId:W.value.insuredList.map((e=>e.id)),bizObjectType:S.INSURED,orderId:W.value.id,tenantId:A}).then((({code:e,data:i})=>{"10000"===e&&i&&z.push({path:y.sign,query:$.query})}))})).catch((e=>{b(e.message)}))};r({imgUrl:"",desc:"",title:"",link:X});return n((()=>{(async()=>{let e={};const{code:i,data:a}=await D({orderNo:H||F,tenantId:A});"10000"===i&&(Object.assign(W.value,a),Z.value.insured.personalInfo=a.insuredList.map((e=>(e.isCert=1,e))),e=U(a.insuredList[0].productList),a.tenantOrderAttachmentList.forEach((e=>{e.objectType===C.INSURED&&21===e.category&&(Z.value.insured.signData[e.objectId]=e.fileBase64)}))),w(e).then((({code:e,data:i})=>{var a;if("10000"===e){const{signMaterialMap:e}=(null==(a=i.productMaterialPlanVOList)?void 0:a[1])||{};(Object.values(e).flat()||[]).forEach((e=>{e.noticeObject===C.INSURED&&Z.value.insured.fileList.push({attachmentName:e.materialName,attachmentList:[{...e,materialSource:_(`${null==e?void 0:e.materialSource}`,null==e?void 0:e.materialContent)}]})}))}})),E(e).then((({data:e,code:i})=>{if("10000"===i){const{signInfo:i}=j(e.productFactor);i.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((i=>{e.required&&ee.value.sign.push(i.code),"1"===i.code?Z.value.agent.isSign=!0:"2"===i.code?Z.value.holder.isSign=!0:"3"===i.code?Z.value.insured.isSign=!0:"4"===i.code?Z.value.holder.isShareSign=!0:"5"===i.code&&(Z.value.insured.isShareSign=!0)}))}))}}))})()})),(e,i)=>{const a=I,s=L,r=N;return t(),o("div",x,[d(a),l("div",P,[d(s,{type:"warning",title:"尊敬的客户，本次投保需要进行身份认证",content:"本产品投保需要对投保人、被保人进行实名认证，您购买本产品的累计总保费已超过20万，按监管要求，需要提供投保人、被保人、指定受益人证件影像，本产品非本人投保且带身故责任、需对投保人、被保人（成人）的投保意愿进行签字确认。"})]),l("div",M,[!u(G)||u(Z).insured.isShareSign?(t(!0),o(c,{key:0},f(u(Z).insured.personalInfo||[],(e=>(t(),g(O,{key:e.id,ref_for:!0,ref_key:"insuredSignRef",ref:Y,"data-source":[],"order-detail":u(W),"sign-string":u(Z).insured.signData[e.id],"show-sign":u(G)?u(Z).insured.isShareSign:u(Z).insured.isSign,"show-verify":u(Z).insured.isVerify,"file-list":u(Z).insured.fileList,"personal-info":e||{},title:"被保人",onHandleSign:i=>((e,i,a)=>{var s;V(e,i,null==(s=W.value)?void 0:s.id,A,a)})("INSURED",i,e.id)},null,8,["order-detail","sign-string","show-sign","show-verify","file-list","personal-info","onHandleSign"])))),128)):m("",!0)]),l("div",T,[d(r,{type:"primary",class:"submit-btn",onClick:ie},{default:p((()=>[v("确定")])),_:1})])])}}});export{$ as default};
