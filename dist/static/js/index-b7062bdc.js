import{l as e,a as i,P as a}from"./index-2da398d0.js";import{d as s,z as l,o as t,a1 as o,R as r,c as n,A as d,V as u,U as c,g as p,i as k,w as v,h as m,G as f,aM as I,L as y,r as h,e as g,ag as V,f as L,j as b,E as R,aA as C,aX as S,a2 as O,aa as x,B as P,aY as T,aZ as D,al as w,am as F,u as _,a as E,$ as j,k as N,au as M,T as q}from"./index-c7ab2009.js";import{I as B}from"./index-3a6c2a46.js";/* empty css              */import{S as K}from"./index-d90ce374.js";import{P as A}from"./index-8ad3c01a.js";import{S as U,_ as $}from"./box-title-0e5d3884.js";import{_ as W}from"./index-4056ae80.js";import{T as z}from"./Table-621efac9.js";import{u as H,b as G,p as X,q as Y,c as Z}from"./trial-d9bcc622.js";import{u as J}from"./useOrder-93252313.js";import"./trial-7297ed77.js";import"./infoCollection-ef5d795a.js";import"./core-a1585d24.js";const Q={key:0},ee={key:0,class:"risk2-field"},ie=s({name:"ProductRiskList"});var ae=f(s({...ie,props:{dataSource:{type:Array,default:()=>[]},productInfo:{type:Object,default:()=>({productCode:"",productName:""})},showMainRisk:{type:Boolean,default:()=>!0},defaultValue:{type:Object,default:()=>{}}},emits:["trialChange"],setup(e,{emit:i}){const a=e,s=l({loading:!1,show:!0,select:{},list:[],userData:{},riskIsInsure:{},submitData:{},disabledRiskInfo:[],risksDefaultValue:{}}),f=e=>{const i=[];return e.riskLiabilityInfoVOList.map((e=>(1!=+e.showFlag&&i.push({...e}),[]))),i},y=(e,l,t)=>{var o;s.riskIsInsure[l].data=e;const r=[...s.disabledRiskInfo];null==(o=a.dataSource.insureProductRiskVOList)||o.forEach((e=>{if(1!==e.mainRiskFlag){const i=s.riskIsInsure[e.riskId];i.data&&Object.keys(i.data).length>0&&!i.isDisabled&&r.push(i.data)}})),i("trialChange",r,t)},h=(e,i)=>{var l;null==(l=a.dataSource.productRiskRelationVOList)||l.forEach((a=>{1!==a.collocationType&&(i.riskId===a.riskId?(s.riskIsInsure[i.riskId]&&s.riskIsInsure[i.riskId].selected,2===a.collocationType&&s.riskIsInsure[a.collocationRiskId]&&(s.riskIsInsure[a.collocationRiskId].selected=e),3===a.collocationType&&s.riskIsInsure[a.collocationRiskId]&&(s.riskIsInsure[a.collocationRiskId].selected="1"===e?"2":"1")):i.riskId===a.collocationRiskId&&(3===a.collocationType&&s.riskIsInsure[a.riskId]&&(s.riskIsInsure[a.riskId].selected="1"===e?"2":"1"),2===a.collocationType&&s.riskIsInsure[a.riskId]&&(s.riskIsInsure[a.riskId].selected=e)))})),"2"===e?y({},i.riskId):(e=>{var i,a,s,l,t,o;if(1!==(null==e?void 0:e.factorDisPlayFlag)){const r=null==(i=null==e?void 0:e.productRiskInsureLimitVO)?void 0:i.amountPremiumConfigVO,n={riskCategory:e.riskCategory,riskCode:e.riskCode,riskName:e.riskName,riskId:e.riskId,riskType:e.riskType,mainRiskId:e.mainRiskId,mainRiskCode:e.mainRiskCode,liabilityVOList:f(e)};n.chargePeriod=(null==(a=null==e?void 0:e.paymentPeriodValueList)?void 0:a.length)>0&&(null==e?void 0:e.paymentPeriodValueList[0].code)||null,n.coveragePeriod=(null==(s=null==e?void 0:e.insurancePeriodValueList)?void 0:s.length)>0&&(null==e?void 0:e.insurancePeriodValueList[0].code)||null,n.paymentFrequency=(null==(l=null==e?void 0:e.paymentFrequencyList)?void 0:l.length)>0&&(null==e?void 0:e.paymentFrequencyList[0].code)||null;let d=0;1===r.displayType?d=(null==r?void 0:r.minStepValue)>0?null==r?void 0:r.minStepValue:0:3===r.displayType&&2===r.requireCopies?d=(null==(t=null==r?void 0:r.displayValues)?void 0:t.length)>0?null==r?void 0:r.displayValues[0].value:0:3===r.displayType&&1===r.requireCopies?(d=(null==(o=null==r?void 0:r.displayValues)?void 0:o.length)>0?null==r?void 0:r.displayValues[0].value:0,n.copy=r.minCopiesValue):2===r.displayType?n.copy=r.minCopiesValue:d=0,1===r.saleMethod?n.amount=d:n.premium=d,y(n,e.riskId)}})(i)};return t((()=>{(()=>{var e,i;s.riskIsInsure={},s.disabledRiskInfo=[];let l=null;if(null==(e=a.dataSource.insureProductRiskVOList)||e.forEach((e=>{var i;const t=1!==e.mainRiskFlag?null==(i=a.dataSource.productRiskRelationVOList)?void 0:i.find((i=>i.collocationRiskId===e.riskId)):{};1===e.mainRiskFlag&&(l=e),s.riskIsInsure[e.riskId]={selected:"2",data:null,relation:t,isMust:!1}})),l){const e=null==(i=a.dataSource.productRiskRelationVOList)?void 0:i.filter((e=>e.riskId===l.riskId));if(!e)return;null==e||e.forEach((e=>{var i,l,t,o,r,n,d,u,c;if(2===e.collocationType){s.riskIsInsure[e.collocationRiskId].selected="1",s.riskIsInsure[e.collocationRiskId].isMust=!0;const p=null==(i=a.dataSource.insureProductRiskVOList)?void 0:i.find((i=>e.collocationRiskId===i.riskId));if(p&&1!==p.factorDisPlayFlag&&(null==(l=null==p?void 0:p.productRiskInsureLimitVO)?void 0:l.amountPremiumConfigVO)){const i=null==(t=p.riskLiabilityInfoVOList)?void 0:t.every((e=>1!==e.showFlag)),a=null==(o=null==p?void 0:p.productRiskInsureLimitVO)?void 0:o.amountPremiumConfigVO;if(i){s.riskIsInsure[e.collocationRiskId].isDisabled=!0;const i={riskCategory:p.riskCategory,riskCode:p.riskCode,riskName:p.riskName,riskId:p.riskId,riskType:p.riskType,mainRiskId:p.mainRiskId,mainRiskCode:p.mainRiskCode,liabilityVOList:f(p)};i.chargePeriod=(null==(r=null==p?void 0:p.paymentPeriodValueList)?void 0:r.length)>0&&(null==p?void 0:p.paymentPeriodValueList[0].code)||null,i.coveragePeriod=(null==(n=null==p?void 0:p.insurancePeriodValueList)?void 0:n.length)>0&&(null==p?void 0:p.insurancePeriodValueList[0].code)||null,i.paymentFrequency=(null==(d=null==p?void 0:p.paymentFrequencyList)?void 0:d.length)>0&&(null==p?void 0:p.paymentFrequencyList[0].code)||null;let l=0;1===a.displayType?l=(null==a?void 0:a.minStepValue)>0?null==a?void 0:a.minStepValue:0:3===a.displayType&&2===a.requireCopies?l=(null==(u=null==a?void 0:a.displayValues)?void 0:u.length)>0?null==a?void 0:a.displayValues[0].value:0:3===a.displayType&&1===a.requireCopies?(l=(null==(c=null==a?void 0:a.displayValues)?void 0:c.length)>0?null==a?void 0:a.displayValues[0].value:0,i.copy=a.minCopiesValue):2===a.displayType&&(i.copy=a.minCopiesValue),1===a.saleMethod?i.amount=l:i.premium=l,s.disabledRiskInfo.push(i),y(i,p.riskId)}}}3===e.collocationType&&(s.riskIsInsure[e.collocationRiskId].selected="2",s.riskIsInsure[e.collocationRiskId].isMust=!0)}))}})()})),o((()=>{s.loading=!0})),r((()=>s.riskIsInsure),(e=>{}),{deep:!0,immediate:!0}),r((()=>a.defaultValue),(e=>{(null==e?void 0:e.length)>0&&e.forEach((e=>{s.risksDefaultValue[e.riskCode]=e,s.riskIsInsure[e.riskId]&&(s.riskIsInsure[e.riskId].selected="1",y(e,e.riskId))}))}),{deep:!0,immediate:!0}),(i,a)=>{const l=K,t=I;return n(!0),d(c,null,u(e.dataSource.insureProductRiskVOList,(i=>{var a,o;return n(),d(c,{key:i.riskCode},[(!e.showMainRisk&&1!==i.mainRiskFlag||e.showMainRisk)&&(null==(o=null==(a=p(s).riskIsInsure)?void 0:a[i.riskId])?void 0:o.relation)?(n(),d("div",Q,[k(t,{modelValue:p(s).riskIsInsure[i.riskId].selected,"onUpdate:modelValue":e=>p(s).riskIsInsure[i.riskId].selected=e,label:i.riskName,name:"selected","label-width":"50%",border:!1,class:"risk-select-field risk-name"},{input:v((()=>[k(l,{modelValue:p(s).riskIsInsure[i.riskId].selected,"onUpdate:modelValue":e=>p(s).riskIsInsure[i.riskId].selected=e,"active-value":"1","inactive-value":"2",size:"26px",disabled:p(s).riskIsInsure[i.riskId].isMust,style:{"margin-right":"8px"},onChange:e=>h(e,i)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])])),_:2},1032,["modelValue","onUpdate:modelValue","label"]),"1"===p(s).riskIsInsure[i.riskId].selected?(n(),d("div",ee,[k(B,{modelValue:p(s).riskIsInsure[i.riskId].data,"onUpdate:modelValue":e=>p(s).riskIsInsure[i.riskId].data=e,"origin-data":i,"product-factor":e.dataSource.productFactor,"default-value":p(s).risksDefaultValue[i.riskCode],onTrialChange:(e,a)=>y(e,i.riskId,a)},null,8,["modelValue","onUpdate:modelValue","origin-data","product-factor","default-value","onTrialChange"])])):m("",!0)])):m("",!0)],64)})),128)}}}),[["__scopeId","data-v-212a02af"]]);const se={class:"benefit-table"},le=s({name:"benefitTable"}),te=s({...le,props:{dataSource:null},setup(e){const i=e,a=y((()=>{const e=i.dataSource.headers.length,a=12*i.dataSource.headers.join("").length+20*i.dataSource.headers.length;return i.dataSource.headers.map(((i,s)=>{const l=a>320?12*i.length+20:Math.max(12*i.length+20,320/e);return console.log("totalWordWidth:",a,"titleWidth:",l,"word-width:",12*i.length+20),{title:i,key:`header_${s}`,fixed:s<2,minWidth:l}}))})),s=y((()=>i.dataSource.dataList.map((e=>{const i={};return e.forEach(((e,a)=>{i[`header_${a}`]=e})),i}))));return o((()=>{})),(e,i)=>(n(),d("div",se,[k(z,{"top-height":400,columns:p(a),data:p(s),"is-clone":!0},null,8,["columns","data"])]))}});const oe=e=>(w("data-v-d9a31ad8"),e=e(),F(),e),re={key:0,class:"benefit-container"},ne={key:0,class:"benefit"},de=oe((()=>L("div",{class:"line"},null,-1))),ue={class:"box-title box-title-chart"},ce=oe((()=>L("img",{class:"tl",src:$,alt:""},null,-1))),pe=oe((()=>L("img",{class:"transform-z180 tr",src:$,alt:""},null,-1))),ke={key:0},ve={class:"box"},me={class:"box-title"},fe=oe((()=>L("img",{class:"tl",src:$,alt:""},null,-1))),Ie=oe((()=>L("img",{class:"transform-z180 tr",src:$,alt:""},null,-1))),ye={class:"box-price"},he={class:"text1"},ge={class:"text2"},Ve={key:1},Le={key:2,style:{width:"100%, minWidth: 338px"}},be={class:"slider"},Re={style:{flex:"1",margin:"0px 5px"}},Ce={class:"custom-button"},Se=oe((()=>L("p",{class:"slider-dec"},"拖动按钮查看不同年龄保障",-1))),Oe={class:"btn-two"},xe={key:1,class:"benefit-container"},Pe={key:0},Te={class:"benefit"},De=oe((()=>L("div",{class:"line"},null,-1))),we=oe((()=>L("div",null,[L("div",{class:"box"},[L("p",{class:"box-title"},[L("img",{class:"tl",src:$,alt:""}),b(" 保单年度"),L("span",null,"-"),b("年度，被保人"),L("span",null,"-"),b("岁时 "),L("img",{class:"transform-z180 tr",src:$,alt:""})]),L("div",{class:"box-price"})])],-1))),Fe={class:"slider"},_e={class:"opt lf"},Ee={style:{flex:"1",margin:"0px 5px"}},je=oe((()=>L("div",{class:"custom-button"},"0 岁",-1))),Ne={class:"opt rg"},Me=oe((()=>L("p",{class:"slider-dec"},"拖动按钮查看不同年龄保障",-1))),qe={class:"btn-two"},Be={key:1,class:"empty-box"},Ke=s({name:"Benefit"});var Ae=f(s({...Ke,props:{dataSource:{default:()=>({showTypeList:["1"]})},productInfo:{default:()=>null}},setup(e){var i;const a=e,s="1",l="2",t="3",o=h(0),f=h(0),I=h(0),y=h(),w=h(0),F=h(null==(i=a.dataSource.showTypeList)?void 0:i[0]),_=h(),E=e=>{if(!(null==e?void 0:e.benefitRiskResultVOList))return;const i=null==e?void 0:e.benefitRiskResultVOList[o.value];f.value=i.ageBegin+1,w.value=i.ageBegin+1,I.value=i.ageEnd},j=()=>{var e,i,s,l,t,r;const n=null==(i=null==(e=a.dataSource)?void 0:e.benefitRiskResultVOList)?void 0:i[o.value];_.value=null==(t=null==(l=null==(s=a.dataSource)?void 0:s.benefitRiskResultVOList)?void 0:l[o.value].benefitRiskTableResultVOList)?void 0:t[0];const{a:d,year:u}=((e,i)=>{const a=[],s=[];for(let l=e,t=0;l<=i;l++,t++)a.push(l.toString()),s.push(t+1);return{a:a,year:s}})(f.value,I.value),c={index:d.indexOf(w.value.toString()),age:d,year:u,result:null==(r=null==n?void 0:n.benefitRiskItemResultVOList)?void 0:r[0]};y.value=c},N=()=>{w.value>I.value-1||(w.value+=1,j())},M=()=>{w.value>f.value&&(w.value-=1,j())},q=e=>{o.value=e.name,E(a.dataSource),j()};return r((()=>a.dataSource),(e=>{var i;e&&(E(e),j(),F.value=null==(i=e.showTypeList)?void 0:i[0])}),{deep:!0,immediate:!0}),r(w,(()=>{j()})),(i,r)=>{var h;const E=x,j=U,B=P,K=T,$=D,z=A;return(null==(h=e.dataSource)?void 0:h.benefitRiskResultVOList)?(n(),d("div",re,[k($,{active:p(o),onClickTab:q},{default:v((()=>{var e;return[(n(!0),d(c,null,u(null==(e=a.dataSource)?void 0:e.benefitRiskResultVOList,((e,i)=>(n(),g(K,{key:i,name:i,title:e.riskName},{default:v((()=>{var e,h,x,P,T,D,q,K,A,U,$,z,H,G,X,Y;return[i==p(o)?(n(),d("div",ne,[de,V(L("p",ue,[ce,b(" 保单年度"),L("span",null,R(null==(x=null==(e=p(y))?void 0:e.year)?void 0:x[null==(h=p(y))?void 0:h.index]),1),b("年度，被保人"),L("span",null,R(null==(D=null==(P=p(y))?void 0:P.age)?void 0:D[null==(T=p(y))?void 0:T.index]),1),b("岁时 "),pe],512),[[C,p(F)===l]]),p(F)===s?(n(),d("div",ke,[L("div",ve,[L("p",me,[fe,b(" 保单年度"),L("span",null,R(null==(A=null==(q=p(y))?void 0:q.year)?void 0:A[null==(K=p(y))?void 0:K.index]),1),b("年度，被保人"),L("span",null,R(null==(z=null==(U=p(y))?void 0:U.age)?void 0:z[null==($=p(y))?void 0:$.index]),1),b("岁时 "),Ie]),L("div",ye,[(n(!0),d(c,null,u(null==(G=null==(H=p(y))?void 0:H.result)?void 0:G.headers,((e,i)=>{var a,s,l,t,o,r,u,c,k,v;return n(),d("div",{key:i,style:{width:"33%"}},[L("p",he,R(("0"==(null==(o=null==(t=null==(s=null==(a=p(y))?void 0:a.result)?void 0:s.dataList)?void 0:t[null==(l=p(y))?void 0:l.index])?void 0:o[i])?"0":p(S)(Number(null==(v=null==(k=null==(u=null==(r=p(y))?void 0:r.result)?void 0:u.dataList)?void 0:k[null==(c=p(y))?void 0:c.index])?void 0:v[i])))||"0"),1),L("p",ge,R(e)+"(元）",1)])})),128))])])])):m("",!0),p(F)===t?(n(),d("div",Ve,[k(te,{"data-source":p(_)},null,8,["data-source"])])):m("",!0),p(F)==l?(n(),d("div",Le,[k(W,{min:p(f),max:p(I),current:p(w),data:null==(Y=null==(X=p(y))?void 0:X.result)?void 0:Y.benefitRiskItemList},null,8,["min","max","current","data"])])):m("",!0),p(F)!=t?(n(),d(c,{key:3},[L("div",be,[L("div",{class:"opt lf",onClick:M},[k(E,{name:"minus"})]),L("div",Re,[p(f)?(n(),g(j,{key:0,modelValue:p(w),"onUpdate:modelValue":r[0]||(r[0]=e=>O(w)?w.value=e:null),min:p(f),max:p(I),"bar-height":"8px"},{button:v((()=>[L("div",Ce,R(p(w))+" 岁",1)])),_:1},8,["modelValue","min","max"])):m("",!0)]),L("div",{class:"opt rg",onClick:N},[k(E,{name:"plus"})])]),Se],64)):m("",!0),L("div",Oe,[a.dataSource.showTypeList.includes(s)?(n(),g(B,{key:0,round:"",plain:p(F)!==s,type:"primary",class:"btn",onClick:r[1]||(r[1]=e=>F.value=s)},{default:v((()=>[b("图表展示")])),_:1},8,["plain"])):m("",!0),a.dataSource.showTypeList.includes(l)?(n(),g(B,{key:1,round:"",plain:p(F)!==l,type:"primary",class:"btn",onClick:r[2]||(r[2]=e=>F.value=l)},{default:v((()=>[b("趋势展示")])),_:1},8,["plain"])):m("",!0),a.dataSource.showTypeList.includes(t)?(n(),g(B,{key:2,round:"",plain:p(F)!==t,type:"primary",class:"btn",onClick:r[3]||(r[3]=e=>F.value=t)},{default:v((()=>[b("表格展示")])),_:1},8,["plain"])):m("",!0)])])):m("",!0)]})),_:2},1032,["name","title"])))),128))]})),_:1},8,["active"])])):(n(),d("div",xe,[a.productInfo?(n(),d("div",Pe,[k($,{active:p(o),onClickTab:q},{default:v((()=>[(n(),g(K,{key:1,name:1,title:e.productInfo.insureProductRiskVOList[0].riskName},{default:v((()=>[L("div",Te,[De,we,L("div",Fe,[L("div",_e,[k(E,{name:"minus"})]),L("div",Ee,[k(j,{modelValue:p(w),"onUpdate:modelValue":r[4]||(r[4]=e=>O(w)?w.value=e:null),min:0,max:80,"bar-height":"8px",disabled:""},{button:v((()=>[je])),_:1},8,["modelValue"])]),L("div",Ne,[k(E,{name:"plus"})])]),Me,L("div",qe,[k(B,{round:"",plain:!0,type:"primary",class:"btn",disabled:""},{default:v((()=>[b("图表展示")])),_:1}),k(B,{round:"",plain:!1,type:"primary",class:"btn",disabled:""},{default:v((()=>[b("趋势展示")])),_:1}),k(B,{round:"",plain:!1,type:"primary",class:"btn",disabled:""},{default:v((()=>[b("表格展示")])),_:1})])])])),_:1},8,["title"]))])),_:1},8,["active"])])):(n(),d("div",Be,[k(z,{title:"试算结果正在计算中...","empty-class":"empty-select"})]))]))}}}),[["__scopeId","data-v-d9a31ad8"]]);const Ue={key:0,class:"head-warning-wrap"},$e=L("div",{class:"warning-icon"},[L("span",null,"!")],-1),We={class:"warning-text"},ze=s({name:"HeadWaring"}),He=s({...ze,props:{labels:{default:()=>[]}},setup:e=>(i,a)=>e.labels.length>0?(n(),d("div",Ue,[$e,L("div",We,[(n(!0),d(c,null,u(e.labels,(e=>(n(),d("span",{key:e},R(e),1)))),128))])])):m("",!0)}),Ge=(i,a,s)=>{var l,t,o,r;const n=i,{holder:d}=s,u=s.insuredList[0],c=(a||"").split("_");if(c.length<2)return a;if(e.exports.isNaN(Number(c[1])))return a;if(c[1]-=1,1===n.exemptFlag){if("to"===c[0]){let e=0;1===n.exemptType?(null==(l=null==d?void 0:d.personVO)?void 0:l.birthday)&&(e=parseInt(""+((new Date).getTime()-new Date(null==(t=d.personVO)?void 0:t.birthday).getTime())/31536e6,10)):2===n.exemptType&&(null==(o=null==u?void 0:u.personVO)?void 0:o.birthday)&&(e=parseInt(""+(+(new Date).getTime()-new Date(null==(r=u.personVO)?void 0:r.birthday).getTime())/31536e6,10)),c[1]=+c[1]-e}c[0]="year"}return c.join("_")},Xe=(e,i)=>{const a=[],s={};return null==e||e.forEach((e=>{s[e.riskId]=e})),null==i||i.forEach((e=>{var i,l,t,o;const{collocationType:r,collocationRiskId:n,riskId:d}=e;switch(r){case 2:{const e=null==(i=s[d])?void 0:i.riskName,t=null==(l=s[n])?void 0:l.riskName;a.push(`${e} 和 ${t} 必须同时投保`);break}case 3:{const e=null==(t=s[d])?void 0:t.riskName,i=null==(o=s[n])?void 0:o.riskName;a.push(`${e} 和 ${i} 不能同时投保`);break}}})),a};const Ye={class:"com-body"},Ze={class:"trial-body"},Je={class:"container"},Qe=(e=>(w("data-v-5ff787cb"),e=e(),F(),e))((()=>L("div",{class:"empty"},null,-1))),ei=s({name:"TrialBody"});var ii=f(s({...ei,props:{dataSource:{default:()=>[]},productInfo:{default:()=>({productCode:"",productName:"",insurerCode:"",tenantId:""})},tenantProductDetail:{default:()=>({})},hideBenefit:{type:Boolean,default:!1},hidePopupButton:{type:Boolean,default:!1},title:{default:"算一算保费"},defaultData:{default:null},isTrial:{type:Boolean,default:!1}},emits:["trialStart","trialEnd"],setup(s,{expose:u,emit:c}){const v=s,f=h(null),I=_();E(),I.query;const y=l({loading:!1,show:!1,select:{},list:[],userData:{},riskIsInsure:{},submitData:{},riskList:[{}],mainRiskVO:{},ifPersonalInfoSuccess:!1,trialMsg:"",trialResultPremium:0,trialResult:{initialPremium:0,initialAmount:0},isAniShow:!1,defaultValue:null,isAutoChange:!1,planIndex:0,isSkipFirstTrial:!1,hadSkipFirstTrial:!1});J(),h(),h();const V=e=>{const{holder:i,insuredList:a}=e||{};i&&(y.submitData.holder=i),a&&a.length>0&&a.forEach(((e,i)=>{var a;y.submitData.insuredList&&y.submitData.insuredList.length>i?y.submitData.insuredList[i]=e:((null==(a=y.submitData)?void 0:a.insuredList)||(y.submitData.insuredList=[]),y.submitData.insuredList.push(e))}))},b=h(),R=h({}),C=["annuityDrawDate","coveragePeriod","chargePeriod"],S=e=>{var i,s,l,t,o,r;if(null==(s=null==(i=null==e?void 0:e.data)?void 0:i[0])?void 0:s.productRiskDyInsureFactorVOList){const i=[];if(null==(l=v.dataSource)||l.insureProductRiskVOList.forEach((s=>{var l,t;const o=null==(t=null==(l=null==e?void 0:e.data)?void 0:l[0])?void 0:t.productRiskDyInsureFactorVOList.find((e=>e.riskCode===s.riskCode));if(o){s.productRiskInsureLimitVO={...s.productRiskInsureLimitVO,...o};const e=y.riskList.find((e=>e.riskCode===s.riskCode));let l=!1;a.forEach((i=>{if(C.indexOf(i.valueKey)>=0){const a=s.productRiskInsureLimitVO[i.configKey];if(a&&e){const s=a.find((a=>a.code===e[i.valueKey]));if(s&&2===s.useFlag){const s=a.find((e=>1===e.defaultFlag));e[i.valueKey]=s.code,l=!0}}}})),l&&i.push({...e,...o,riskCode:s.riskCode})}})),i.length>0&&(null==(r=null==(o=null==(t=y.defaultValue)?void 0:t.insuredList)?void 0:o[0])?void 0:r.productList))return i.forEach((e=>{var i,a,s;y.defaultValue.insuredList[0].productList=null==(s=null==(a=null==(i=y.defaultValue)?void 0:i.insuredList)?void 0:a[0])?void 0:s.productList.map((i=>(i.riskList=null==i?void 0:i.riskList.map((i=>(i.riskCode===e.riskCode&&(i=e),i))),i)))})),!1}return!0},O=async(e,i=!0)=>{y.trialMsg="试算中...",y.trialResultPremium=0,y.loading=!0,c("trialStart");let a=!1;if(i){const{code:i}=await H(e);a="10000"===i}!a&&i||(v.hideBenefit||G(e).then((e=>{e.data&&e.code===M&&(R.value=e.data)})).finally((()=>{y.loading=!1})),X(e).then((e=>{var i,a;if(e.data&&e.code===M){(null==(i=null==e?void 0:e.data)?void 0:i.errorInfo)&&q(`${null==(a=null==e?void 0:e.data)?void 0:a.errorInfo}`),y.trialMsg="",y.trialResultPremium=e.data.initialPremium,y.trialResult=e.data;const s={};e.data.riskPremiumDetailVOList&&e.data.riskPremiumDetailVOList.length&&e.data.riskPremiumDetailVOList.forEach((e=>{s[e.riskCode]={initialAmount:e.initialAmount,initialPremium:e.initialPremium}})),b.value=s,c("trialEnd",e.data)}})).finally((()=>{y.loading=!1})))},x=e.exports.debounce((async()=>{if(console.log(">>>>>调用试算<<<<<"),y.ifPersonalInfoSuccess){if(y.submitData.productCode=v.productInfo.productCode,y.submitData.productName=v.productInfo.productName,y.submitData.tenantId=v.productInfo.tenantId,y.riskList=y.riskList.map((e=>(e=>{var i,s,l,t;const o=null==(i=v.dataSource.insureProductRiskVOList)?void 0:i.find((i=>e.riskId===i.riskId));if(o&&1!==o.mainRiskFlag){const i=null==(l=null==(s=v.dataSource)?void 0:s.productRiskRelationVOList)?void 0:l.find((e=>e.collocationRiskId===o.riskId));if(i){const s=null==(t=y.riskList)?void 0:t.find((e=>e.riskId===i.riskId));a.forEach((i=>{i.ruleKey&&o.productRiskInsureLimitVO&&s&&(1===o.productRiskInsureLimitVO[i.ruleKey]&&(e[i.valueKey]=s[i.valueKey]),3===o.productRiskInsureLimitVO[i.ruleKey]&&(1!==o.exemptFlag?e[i.valueKey]=Ge(o,s[i.valueKey],y.submitData):e[i.valueKey]=Ge(o,s[i.ruleValueKey],y.submitData)))}))}}return e})(e))),y.submitData.insuredList&&y.submitData.insuredList.forEach((e=>{e.productList=[{insurerCode:v.productInfo.insurerCode,planCode:v.dataSource.planCode,riskList:y.riskList}]})),y.isSkipFirstTrial&&!y.hadSkipFirstTrial)return void(y.hadSkipFirstTrial=!0);console.log(">>>数据构建<<<",y.submitData);const i=e.exports.cloneDeep(y.submitData);await O(i)}}),300),P=async e=>{var i;const{insuredList:a,isFirstInsuredChange:s}=e;if(V(e),y.ifPersonalInfoSuccess=!0,s){console.log("处理第一被保人修改的dy变化");const e=await Y({calcProductFactorList:[{planCode:v.dataSource.planCode,productCode:v.productInfo.productCode,riskEditVOList:[{insureProductRiskVO:null==(i=v.dataSource.insureProductRiskVOList)?void 0:i[0]}]}],...a[0]});if(!S(e))return}console.log("投被保人的信息回传 ",y.submitData,e),x()},T=async(i,a)=>{var s,l,t,o;if(a){const r=e.exports.cloneDeep(i);delete r.insurancePeriodValueList,delete r.paymentFrequencyList,delete r.paymentPeriodValueList;if(C.indexOf(a.key)>=0){const e={};switch(a.key){case"annuityDrawDate":e.changeType=3;break;case"coveragePeriod":e.changeType=2;break;case"chargePeriod":e.changeType=1}const n=null==(l=null==(s=y.submitData)?void 0:s.insuredList)?void 0:l[0],d=null==(o=null==(t=v.dataSource)?void 0:t.insureProductRiskVOList)?void 0:o.find((e=>e.riskCode===i.riskCode));if(!y.isAutoChange){const a=await Y({calcProductFactorList:[{planCode:v.dataSource.planCode,productCode:v.productInfo.productCode,riskEditVOList:[{insureProductRiskVO:d,insureRiskEditReqVO:{riskId:i.riskId,riskCode:i.riskCode,...r,...e}}]}],...n}),s=S(a);return s||(y.isAutoChange=!0),s}y.isAutoChange=!1}}return!0},D=async(e,i)=>{y.mainRiskVO=e;await T(e,i)&&(y.riskList.length>0&&(y.riskList[0]=e),console.log("标准险种的信息回传",e),x())},w=async(e,i)=>{if(y.riskList=[y.mainRiskVO,...e],console.log("附加险列表数据回传",e),i){const a=e.find((e=>e.riskCode===i.riskCode));if(!(await T(a,i)))return}x()},F=e=>{console.log("------default data = ",e),y.userData=e,y.defaultValue=e;const i=e.insuredList[0].productList.findIndex((e=>e.planCode===v.dataSource.planCode));y.planIndex=-1===i?0:i,O(e,!0)};return t((()=>{var e,i;y.select={},y.list=[],y.userData={},y.riskIsInsure={},y.submitData={},y.riskList=[{}],y.mainRiskVO={},y.ifPersonalInfoSuccess=!1,y.trialMsg="",y.trialResultPremium=0,y.riskIsInsure={},null==(i=null==(e=null==v?void 0:v.dataSource)?void 0:e.insureProductRiskVOList)||i.forEach((e=>{var i;const a=null==(i=v.dataSource.productRiskRelationVOList)?void 0:i.find((i=>i.collocationRiskId===e.riskId));a&&(y.riskIsInsure[e.riskCode]={selected:"2",data:null,relation:a})}))})),o((()=>{y.loading=!0,y.show=!0,y.isAniShow=!0,y.isSkipFirstTrial=!0,y.hadSkipFirstTrial=!1,j((()=>{(async e=>{var i;if(console.log("props.defaultData",v.defaultData),v.defaultData){const e=v.defaultData.find((e=>e.productCode===v.productInfo.productCode))||v.defaultData[0];F(e),V(null==(i=v.defaultData)?void 0:i[0])}else{const e=await Z({calcProductFactorList:[{planCode:v.dataSource.planCode,productCode:v.productInfo.productCode}]});if(e.data){const i=e.data.find((e=>e.productCode===v.productInfo.productCode))||e.data[0];console.log("targetProduct",i),F(i)}}})()}))})),u({getTrialSuccessFlag:()=>y.trialResultPremium>0}),r((()=>y.riskIsInsure),(e=>{}),{deep:!0,immediate:!0}),(e,a)=>{var l,t,o,r,u,c,v;return n(),d("div",Ye,[N(e.$slots,"trialHead",{},void 0,!0),L("div",Ze,[k(He,{labels:p(Xe)((null==(l=s.dataSource)?void 0:l.insureProductRiskVOList)||[],s.dataSource.productRiskRelationVOList)},null,8,["labels"]),L("div",Je,[s.hideBenefit?m("",!0):(n(),g(Ae,{key:0,class:"benefit-wrap","data-source":R.value,"product-info":s.dataSource,"show-type-list":R.value.showTypList},null,8,["data-source","product-info","show-type-list"])),s.dataSource.productFactor?(n(),g(p(i),{key:1,ref:"personalInfoRef",modelValue:p(y).userData,"onUpdate:modelValue":a[0]||(a[0]=e=>p(y).userData=e),"is-trial":s.isTrial,"product-factor":s.dataSource.productFactor,"multi-insured-config":null==(t=s.dataSource)?void 0:t.multiInsuredConfigVO,onTrailChange:P},null,8,["modelValue","is-trial","product-factor","multi-insured-config"])):m("",!0),k(B,{ref_key:"insureInfosRef",ref:f,"origin-data":null==(o=s.dataSource.insureProductRiskVOList)?void 0:o[0],"product-factor":s.dataSource.productFactor,"default-value":p(y).defaultValue?null==(u=null==(r=p(y).defaultValue)?void 0:r.insuredList[0].productList[p(y).planIndex])?void 0:u.riskList[0]:null,"trial-result":p(y).trialResult,onTrialChange:D},null,8,["origin-data","product-factor","default-value","trial-result"]),k(ae,{"data-source":s.dataSource,"show-main-risk":!1,"default-value":p(y).defaultValue?null==(v=null==(c=p(y).defaultValue)?void 0:c.insuredList[0].productList[p(y).planIndex])?void 0:v.riskList:[],onTrialChange:w},null,8,["data-source","default-value"]),Qe])]),N(e.$slots,"trialBtn",{trialData:p(y).submitData,riskPremium:p(y).trialResult},void 0,!0)])}}}),[["__scopeId","data-v-5ff787cb"]]);export{ii as T};
