var Fe=Object.defineProperty,Ae=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var ue=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var te=(d,a,c)=>a in d?Fe(d,a,{enumerable:!0,configurable:!0,writable:!0,value:c}):d[a]=c,L=(d,a)=>{for(var c in a||(a={}))he.call(a,c)&&te(d,c,a[c]);if(ue)for(var c of ue(a))pe.call(a,c)&&te(d,c,a[c]);return d},b=(d,a)=>Ae(d,ve(a));import{g as ye,O as me,ak as ge,E as q,d as Te,y as Ne,h as Re,r as Y,j as _,k as P,m as C,z as n,p as D,J as y,n as A,L as se,t as O,A as N,G,F as J,a4 as Ie,a5 as Oe,C as k,T as S,D as Se}from"./vendor-96e68f0e.js";import{q as ke}from"./index-fbbc79b7.js";import{_ as xe,S as Le,I as be,J as Pe,q as Q,l as w,K as ae,N as ne,r as re,L as we,n as Ue,P as He,M as z,Q as U}from"./index-d89e7f03.js";import{_ as Me}from"./index-751c1829.js";import{g as $e,f as Ve,s as oe,a as je}from"./verify-73bfb0ed.js";import{a as qe}from"./order-ad7bcd6c.js";const W=d=>(Ie("data-v-a091703e"),d=d(),Oe(),d),Ye={class:"page-verify"},Ge={class:"people"},Je={class:"name"},Qe={class:"verify-item"},ze=W(()=>n("div",{class:"label"},"\u8BC1\u4EF6\u53F7\u7801",-1)),We={class:"no"},Ke=k(" \u53BB\u8BA4\u8BC1 "),Xe={class:"sign-body"},Ze={class:"date"},eu={class:"file"},uu=k(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A "),tu={class:"people"},su={class:"name"},au={class:"verify-item"},nu=W(()=>n("div",{class:"label"},"\u8BC1\u4EF6\u53F7\u7801",-1)),ru={class:"no"},ou=["onClick"],iu=k(" \u53BB\u8BA4\u8BC1 "),lu=["onClick"],cu={class:"sign-body"},du={class:"date"},Eu={class:"file"},Bu=k(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A "),_u={class:"footer-button footer"},fu=W(()=>n("div",{class:"text"},"\u5237\u65B0",-1)),Cu=k("\u5206\u4EAB"),Du=k("\u63D0\u4EA4"),Fu=ye({setup(d){const a={CERT:1,NO_CERT:2},c=me(),ie=ge(),{saleUserId:H="D1234567-1",tenantId:m="9991000007",templateId:le=1,productCode:ce="CQ75CQ76",insurerCode:de="ancheng",isShare:M}=c.query;let{orderNo:v}=c.query;typeof v=="object"&&(v=(v||[])[0]);const $=new Le({source:"localStorage"}),V=q([]),r=q(),R=q(),g=[],K=Te().format("YYYY-MM-DD"),Ee=()=>{var t;(t=R.value)==null||t.clear()},Be=t=>{g[t].clear()},X=(t,o)=>{je({callbackUrl:window.location.href,certiNo:t,faceAuthMode:"TENCENT",userName:o,tenantId:9991000007}).then(l=>{const{code:u,data:E}=l;if(u==="10000"){const{originalUrl:f,serialNo:e}=E;window.location.href=f,$.set("verifyData",{serialNo:e,certNo:t,name:o})}})},I=t=>`${t}`===Pe.CERT,Z=t=>{var o,l,u,E;t===-1?X((o=r.value.tenantOrderHolder)==null?void 0:o.certNo,(l=r.value.tenantOrderHolder)==null?void 0:l.name):X((u=r.value.tenantOrderInsuredList[t])==null?void 0:u.certNo,(E=r.value.tenantOrderInsuredList[t])==null?void 0:E.name)},_e=t=>{t&&g.every(o=>o!==t)&&g.push(t)},fe=()=>{var o,l,u,E,f;if((o=R.value)==null?void 0:o.isEmpty()){S.fail("\u8BF7\u6295\u4FDD\u4EBA\u7B7E\u540D");return}if(g.some(e=>e.isEmpty())){S.fail("\u8BF7\u88AB\u4FDD\u4EBA\u7B7E\u540D");return}if(((u=(l=r.value.tenantOrderHolder)==null?void 0:l.extInfo)==null?void 0:u.isCert)!==a.CERT&&I((E=r.value.tenantOrderHolder)==null?void 0:E.certType)){S.fail("\u8BF7\u6295\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}if((f=r.value.tenantOrderInsuredList)==null?void 0:f.some(e=>{var s;return((s=e.extInfo)==null?void 0:s.isCert)!==a.CERT&&I(e.certType)})){S.fail("\u8BF7\u88AB\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}re({orderNo:v,saleUserId:H,tenantId:m}).then(e=>{const{code:s,data:i}=e;s==="10000"&&(i.orderStatus!==qe.PENDING?we("paymentResult",c.query):Se.confirm({title:"\u63D0\u793A",message:"\u8BF7\u786E\u8BA4\u4FE1\u606F\u586B\u5199\u65E0\u8BEF\u540E\uFF0C\u518D\u8FDB\u884C\u652F\u4ED8"}).then(()=>{var h,p;const B=(h=R.value)==null?void 0:h.save();Promise.all([oe("HOLDER",B,(p=r.value)==null?void 0:p.id,`${m}`),...g.map(F=>{var T;return oe("INSURED",F.save(),(T=r.value)==null?void 0:T.id,`${m}`)})]).then(()=>{Ue(b(L({},r.value),{pageCode:"sign",operateOption:{withSignInfo:!0},extInfo:b(L({},r.value.extInfo),{pageCode:"sign",templateId:le,shareFlag:M?"Y":"N"}),venderCode:de})).then(F=>{const{code:T,data:x}=F;s==="10000"&&x.success&&ie.push({path:He[x.pageAction.data.nextPageCode],query:{orderNo:v,saleUserId:H,tenantId:m}})})})}))})},j=(t=!1)=>{re({orderNo:v,saleUserId:H,tenantId:m}).then(o=>{var E,f;const{code:l,data:u}=o;l==="10000"&&(r.value=u,t&&(((f=(E=u==null?void 0:u.tenantOrderHolder)==null?void 0:E.extInfo)==null?void 0:f.isCert)===a.NO_CERT||(u==null?void 0:u.tenantOrderInsuredList.some(e=>{var s;return((s=e.extInfo)==null?void 0:s.isCert)===a.NO_CERT}))?S("\u7528\u6237\u672A\u5B8C\u8EAB\u4EFD\u8BA4\u8BC1\u53CA\u7B7E\u5B57"):(!(u==null?void 0:u.tenantOrderAttachmentList.find(e=>e.category===z.ELECTRIC_SIGN&&e.objectType===U.HOLDER))||!(u==null?void 0:u.tenantOrderAttachmentList.find(e=>e.category===z.ELECTRIC_SIGN&&e.objectType===U.INSURED)))&&S("\u7528\u6237\u672A\u5B8C\u8EAB\u4EFD\u8BA4\u8BC1\u53CA\u7B7E\u5B57")),setTimeout(()=>{let e=0;u.tenantOrderAttachmentList.forEach(s=>{s.category===z.ELECTRIC_SIGN&&(s.objectType===U.HOLDER?(R.value.clear(),R.value.setDataURL(s.fileBase64)):s.objectType===U.INSURED&&(g[e].clear(),g[e].setDataURL(s.fileBase64),e+=1))})}))})},Ce=()=>{j(!0)},De=Ne(()=>{const t=b(L({},c.query),{isShare:1,sharePageCode:"sign"});return`${window.location.origin}/phoneVerify?${ke.stringify(t)}`});return Re(()=>{j(),$e({orderNo:v,productCode:ce,tenantId:m}).then(o=>{const{code:l,data:u}=o;l==="10000"&&(V.value=u||[])});const t=$.get("verifyData");if(t){const{serialNo:o,certNo:l,name:u}=t;Ve({certiNo:l,orderNo:v,serialNo:o,tenantId:m,userName:u}).then(E=>{const{code:f,data:e}=E;f==="10000"&&($.remove("verifyData"),j())})}}),(t,o)=>{const l=Y("ProPDFviewer"),u=Y("van-button"),E=Y("ProPageWrap");return _(),P(E,null,{default:C(()=>{var f;return[n("div",Ye,[D(be,{type:"warning",title:"\u5C0A\u656C\u7684\u5BA2\u6237\uFF0C\u672C\u6B21\u6295\u4FDD\u9700\u8981\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",content:"\u672C\u4EA7\u54C1\u6295\u4FDD\u9700\u8981\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u8FDB\u884C\u5B9E\u540D\u8BA4\u8BC1\uFF0C\u60A8\u8D2D\u4E70\u672C\u4EA7\u54C1\u7684\u7D2F\u8BA1\u603B\u4FDD\u8D39\u5DF2\u8D85\u8FC720\u4E07\uFF0C\u6309\u76D1\u7BA1\u8981\u6C42\uFF0C\u9700\u8981\u63D0\u4F9B\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u3001\u6307\u5B9A\u53D7\u76CA\u4EBA\u8BC1\u4EF6\u5F71\u50CF\uFF0C\u672C\u4EA7\u54C1\u975E\u672C\u4EBA\u6295\u4FDD\u4E14\u5E26\u8EAB\u6545\u8D23\u4EFB\u3001\u9700\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\uFF08\u6210\u4EBA\uFF09\u7684\u6295\u4FDD\u610F\u613F\u8FDB\u884C\u7B7E\u5B57\u786E\u8BA4\u3002"}),D(w,{title:"\u6295\u4FDD\u4EBA",class:"card"},{extra:C(()=>{var e,s,i,B,h,p,F,T,x,ee;return[n("div",Ge,[n("div",Je,y((s=(e=r.value)==null?void 0:e.tenantOrderHolder)==null?void 0:s.name),1),I((B=(i=r.value)==null?void 0:i.tenantOrderHolder)==null?void 0:B.certType)?(_(),A("div",{key:0,class:se(["status",{verified:((F=(p=(h=r.value)==null?void 0:h.tenantOrderHolder)==null?void 0:p.extInfo)==null?void 0:F.isCert)===a.CERT}])},y(((ee=(x=(T=r.value)==null?void 0:T.tenantOrderHolder)==null?void 0:x.extInfo)==null?void 0:ee.isCert)===a.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)):O("",!0)])]}),default:C(()=>{var e,s,i,B,h,p,F;return[n("div",Qe,[ze,n("div",We,y((s=(e=r.value)==null?void 0:e.tenantOrderHolder)==null?void 0:s.certNo),1),((h=(B=(i=r.value)==null?void 0:i.tenantOrderHolder)==null?void 0:B.extInfo)==null?void 0:h.isCert)!==a.CERT&&I((F=(p=r.value)==null?void 0:p.tenantOrderHolder)==null?void 0:F.certType)?(_(),A("div",{key:0,class:"action",onClick:o[0]||(o[0]=T=>Z(-1))},[Ke,D(Q,{name:"right_arrow",class:"icon"})])):O("",!0)])]}),_:1}),D(w,{title:"\u6295\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:C(()=>[n("div",{class:"resign",onClick:Ee},"\u91CD\u7B7E")]),default:C(()=>[D(ae,{ref_key:"holderSign",ref:R,class:"sign"},null,512),n("div",Xe,[n("div",Ze,"\u7B7E\u540D\u65E5\u671F\uFF1A "+y(N(K)),1),n("div",eu,[uu,(_(!0),A(J,null,G(V.value.filter(e=>e.noticeObject===N(ne).HOLDER),(e,s)=>(_(),P(l,{key:s,class:"file",title:`\u300A${e.materialName}\u300B`,url:e.materialSource},null,8,["title","url"]))),128))])])]),_:1}),(_(!0),A(J,null,G((f=r.value)==null?void 0:f.tenantOrderInsuredList,(e,s)=>(_(),A("div",{key:s},[D(w,{title:"\u88AB\u4FDD\u4EBA",class:"card"},{extra:C(()=>{var i,B;return[n("div",tu,[n("div",su,y(e.name),1),I(e.certType)?(_(),A("div",{key:0,class:se(["status",{verified:((i=e.extInfo)==null?void 0:i.isCert)===a.CERT}])},y(((B=e.extInfo)==null?void 0:B.isCert)===a.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)):O("",!0)])]}),default:C(()=>{var i;return[n("div",au,[nu,n("div",ru,y(e.certNo),1),((i=e.extInfo)==null?void 0:i.isCert)!==a.CERT&&I(e.certType)?(_(),A("div",{key:0,class:"action",onClick:B=>Z(s)},[iu,D(Q,{name:"right_arrow",class:"icon"})],8,ou)):O("",!0)])]}),_:2},1024),D(w,{title:"\u88AB\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:C(()=>[n("div",{class:"resign",onClick:i=>Be(s)},"\u91CD\u7B7E",8,lu)]),default:C(()=>[D(ae,{ref_for:!0,ref:_e,class:"sign"}),n("div",cu,[n("div",du,"\u7B7E\u540D\u65E5\u671F\uFF1A "+y(N(K)),1),n("div",Eu,[Bu,(_(!0),A(J,null,G(V.value.filter(i=>i.noticeObject===N(ne).INSURED),(i,B)=>(_(),P(l,{key:B,class:"file",title:`\u300A${i.materialName}\u300B`,url:i.materialSource},null,8,["title","url"]))),128))])])]),_:2},1024)]))),128)),n("div",_u,[N(M)?O("",!0):(_(),A("div",{key:0,class:"refresh-btn",onClick:Ce},[n("div",null,[D(Q,{name:"refresh"})]),fu])),N(M)?O("",!0):(_(),P(Me,{key:1,title:"\u9080\u8BF7\u60A8\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",desc:"\u9080\u8BF7\u60A8\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",link:N(De)},{default:C(()=>[D(u,{plain:"",type:"primary",class:"share-btn"},{default:C(()=>[Cu]),_:1})]),_:1},8,["link"])),D(u,{type:"primary",class:"submit-btn",onClick:fe},{default:C(()=>[Du]),_:1})])])]}),_:1})}}});var Tu=xe(Fu,[["__scopeId","data-v-a091703e"]]);export{Tu as default};
