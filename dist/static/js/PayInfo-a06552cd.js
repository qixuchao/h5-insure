import{d as e,r as a,au as t,aV as n,x as i,bC as m,K as s,Q as r,at as o,c as d,y as l,U as y,e as c,g as u,R as p}from"./index-f446481e.js";import{B as E}from"./ProRenderFormWithCard.vue_vue_type_style_index_0_scoped_true_lang-e772fa6d.js";/* empty css              */import{P as f,B as h,a as T}from"./bankCard-fd8f6350.js";import{P as R}from"./index-1fbb93db.js";const v=e({__name:"PayInfo",props:{schema:{default:()=>[]},config:{default:()=>[]},modelValue:{default:()=>[]},isView:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{expose:v,emit:_}){const M=e,S={BANK_PAY:"1",ALI_PAY:"2",WECHAT_PAY:"3"},P=a(null);a();const I=[{title:"首期支付",schema:[],paymentType:f.FIRST_TERM,formData:{initialCardType:h.DEBIT},config:{initialCardType:{isView:!0}},nanoid:t(),paymentMethodKey:"initialPaymentMethod",hiddenKeyList:["initialCardType","initialBankCard","initialPaymentType"]},{title:"续期支付",schema:[],paymentType:f.RENEW_TERM,formData:{renewalPaymentGenre:String(T.FIRST_SAME),renewalCardType:h.DEBIT},config:{renewalCardType:{isView:!0}},nanoid:t(),hiddenKeyList:["renewalCardType","renewalBankCard","renewalPaymentType"],paymentGenreKey:"renewalPaymentGenre",paymentMethodKey:"renewalPaymentMethod"},{title:"年金领取银行卡",schema:[],paymentType:f.REPRISE,formData:{annuityPaymentGenre:String(T.FIRST_SAME)},config:{},nanoid:t(),paymentGenreKey:"annuityPaymentGenre",paymentMethodKey:"annuityPaymentMethod",hiddenKeyList:["annuityBankCard"]}],L=[["initialPaymentMethod","initialCardType","initialBankCard","initialPaymentType"],["renewalPaymentGenre","renewalPaymentMethod","renewalCardType","renewalBankCard","renewalPaymentType","premiumOverdue"],["annuityPaymentGenre","annuityBankCard"]];n();const D=i({schemaList:m(I)}),g=s((()=>["FIRST_TERM","RENEW_TERM","REPRISE"].reduce(((e,a)=>{var t;return e[a]=(t=a,D.schemaList.findIndex((e=>String(e.paymentType)===String(f[t])))),e}),{}))),w=(e,a)=>{var t,n;return e>-1&&(null==(n=null==(t=D.schemaList[e])?void 0:t.formData)?void 0:n.sameFirstIssue)===`${T[a]}`},A=(e,a)=>{const t=D.schemaList[e].paymentMethodKey,n=D.schemaList[a].paymentMethodKey;Object.assign(D.schemaList[e].formData,((e,a)=>{let t={};a&&(t=Object.keys(a).map((t=>({[t]:e[a[t]]}))));return E.reduce(((a,t)=>(a[t]=e[t],a)),t)})(D.schemaList[a].formData,{[t]:n}))};return r((()=>D.schemaList.map((e=>{var a;return null==(a=e.formData)?void 0:a[e.paymentMethodKey]}))),(()=>{D.schemaList.forEach(((e,a)=>{const{formData:n,schema:i,hiddenKeyList:m}=e||{},s=[S.ALI_PAY,S.WECHAT_PAY].includes(null==n?void 0:n[e.paymentMethodKey]);i.forEach((e=>{e.hidden=s&&m.includes(e.name)})),e.nanoid=t()}))}),{deep:!0,immediate:!0}),r((()=>{var e;return null==(e=D.schemaList[g.value.FIRST_TERM])?void 0:e.formData}),(e=>{const a=g.value.RENEW_TERM,t=g.value.REPRISE;w(a,"FIRST_SAME")&&A(a,g.value.FIRST_TERM),w(t,"FIRST_SAME")&&A(t,a)}),{deep:!0}),r((()=>{var e;return null==(e=D.schemaList[g.value.RENEW_TERM])?void 0:e.formData}),(e=>{const a=g.value.REPRISE;w(a,"RENEW_SAME")&&A(a,g.value.RENEW_TERM)}),{deep:!0}),r((()=>{var e,a;const{RENEW_TERM:t}=g.value;return null==(a=null==(e=D.schemaList[t])?void 0:e.formData)?void 0:a[I[t].paymentGenreKey]}),(e=>{const a=g.value.FIRST_TERM,t=g.value.RENEW_TERM;e===String(T.FIRST_SAME)?A(t,a):D.schemaList[t].formData={...I[t].formData,sameFirstIssue:e}}),{immediate:!0}),r((()=>{var e,a;const{REPRISE:t}=g.value;return null==(a=null==(e=D.schemaList[t])?void 0:e.formData)?void 0:a[I[t].paymentGenreKey]}),(e=>{const a=g.value.FIRST_TERM,t=g.value.RENEW_TERM,n=g.value.REPRISE;if([T.FIRST_SAME,T.RENEW_SAME].includes(Number(e))){const i=e===String(T.FIRST_SAME)?a:t;A(n,i)}else D.schemaList[n].formData={...I[n].formData,sameFirstIssue:e}}),{immediate:!0}),r([()=>M.schema,()=>M.config],(()=>{let e=[];o(M.schema)&&(D.schemaList=m(I)),D.schemaList=M.schema.reduce(((a,t)=>{const n=L.findIndex((e=>e.includes(t.name)));return"paymentDrawType"===t.name&&(e=t.columns.map((e=>e.code))),n>-1&&a[n].schema.push({...t,paymentType:I[n].paymentType}),a}),m(I)).map(((e,a)=>({...e,config:{...e.config,...M.config[a]||{}},nanoid:t()}))).filter((({schema:a,...t})=>!e.includes(`${t.paymentType}`)?t:{schema:a,...t}))}),{deep:!0,immediate:!0}),r((()=>M.modelValue),(e=>{o(e)&&D.schemaList.forEach(((a,t)=>{Object.assign(a.formData,e[t])}))}),{deep:!0,immediate:!0}),r((()=>{var e;return null==(e=D.schemaList)?void 0:e.map((e=>e.formData))}),(e=>{o(e)&&_("update:modelValue",e.map((e=>({...e,paymentType:e.paymentType}))))}),{deep:!0,immediate:!0}),v({validate:e=>{var a;return Promise.all(null==(a=P.value)?void 0:a.map((e=>e.validate())))}}),(a,t)=>(d(!0),l(p,null,y(u(D).schemaList,(a=>(d(),c(u(R),{ref_for:!0,ref_key:"payInfoFormRef",ref:P,key:a.nanoid,schema:a.schema,model:a.formData,config:a.config,title:a.title,"is-view":e.isView},null,8,["schema","model","config","title","is-view"])))),128))}});export{v as _};
