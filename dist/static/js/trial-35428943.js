import{ap as e,aq as t,ar as a,as as o,at as i,au as r,av as l,aw as s,ax as u,ay as n,d,i as c,j as p,k as v,O as f,o as m,m as k,w as R,a as C,e as h,b as y,u as L,p as I,c as j,F as g,q as b,a8 as _,_ as q,T as w,az as T,aA as P,aB as x,aC as S,aD as M,h as N,aE as V,f as A,s as O}from"./index-2a73a8fe.js";import{T as D}from"./index-b7d66eb3.js";import{a as K,b as E,g as B,s as U,i as F,m as $}from"./trial-8a95c20b.js";import{_ as H}from"./index-3fc33367.js";import{S as z}from"./index-426ba45d.js";import{R as G}from"./trial-1c7cb1eb.js";import{_ as J}from"./TrialButton-e7308396.js";import{u as Q}from"./useOrder-215f9b35.js";import{B as W,a as X}from"./constants-62d1c4af.js";import{a as Y}from"./utils-9968c35e.js";import{c as Z,t as ee,i as te,g as ae,b as oe}from"./index-954368c8.js";import{c as ie}from"./cloneDeep-b3178ea6.js";import"./InsureInfos-86ebd8aa.js";import"./index-de590a0b.js";import"./infoCollection-1249e976.js";import"./index-8e35a442.js";import"./PolicyInfo-892e4c95.js";import"./lodash-b5d01b6b.js";import"./questionnaire-62331097.js";import"./util-c9d50a84.js";import"./product-7bbf9c44.js";import"./constants-0610e9a4.js";import"./config-98e8d477.js";import"./utils-c89f94be.js";import"./createProposal-b9337375.js";import"./nextStep-26750ee1.js";import"./core-6281c81e.js";import"./empty-ae586b6c.js";import"./index-38569ab1.js";import"./utils-520685fd.js";function re(t){var a=function(t){return t?1/0===(t=e(t))||-1/0===t?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}(t),o=a%1;return a==a?o?a-o:a:0}function le(e,t,a,o){for(var i=e.length,r=a+(o?1:-1);o?r--:++r<i;)if(t(e[r],r,e))return r;return-1}function se(e){return e==e&&!o(e)}function ue(e,t){return function(a){return null!=a&&(a[e]===t&&(void 0!==t||e in Object(a)))}}function ne(e){var o=function(e){for(var t=i(e),a=t.length;a--;){var o=t[a],r=e[o];t[a]=[o,r,se(r)]}return t}(e);return 1==o.length&&o[0][2]?ue(o[0][0],o[0][1]):function(i){return i===e||function(e,o,i,r){var l=i.length,s=l,u=!r;if(null==e)return!s;for(e=Object(e);l--;){var n=i[l];if(u&&n[2]?n[1]!==e[n[0]]:!(n[0]in e))return!1}for(;++l<s;){var d=(n=i[l])[0],c=e[d],p=n[1];if(u&&n[2]){if(void 0===c&&!(d in e))return!1}else{var v=new t;if(r)var f=r(c,p,d,e,o,v);if(!(void 0===f?a(p,c,3,r,v):f))return!1}}return!0}(i,e,o)}}function de(e,t){return null!=e&&t in Object(e)}function ce(e,t){return null!=e&&function(e,t,a){for(var o=-1,i=(t=Z(t,e)).length,n=!1;++o<i;){var d=ee(t[o]);if(!(n=null!=e&&a(e,d)))break;e=e[d]}return n||++o!=i?n:!!(i=null==e?0:e.length)&&r(i)&&l(d,i)&&(s(e)||u(e))}(e,t,de)}function pe(e){return te(e)?(t=ee(e),function(e){return null==e?void 0:e[t]}):function(e){return function(t){return oe(t,e)}}(e);var t}function ve(e){return"function"==typeof e?e:null==e?n:"object"==typeof e?s(e)?(t=e[0],o=e[1],te(t)&&se(o)?ue(ee(t),o):function(e){var i=ae(e,t);return void 0===i&&i===o?ce(e,t):a(o,i,3)}):ne(e):pe(e);var t,o}var fe=Math.max;var me=Math.max,ke=Math.min;const Re={class:"popup-container"},Ce={class:"popup-header"},he={class:"title"},ye=(e=>(S("data-v-0a46ec37"),e=e(),M(),e))((()=>C("p",{class:"tip"},"已为您挑选出以下险种",-1))),Le={class:"search"},Ie={key:0,class:"risk-list"},je=d({name:"riskSelect"});var ge=q(d({...je,props:{type:{default:2},show:{type:Boolean,default:!1},title:{},insuredList:{default:()=>[]},mainRiskCode:{default:""},selectList:{default:()=>[]},currentProductCode:{default:""}},emits:["cancel","confirm"],setup(e,{emit:t}){const a=e,o=c(),{insurerCode:i}=o.query,r=p([]),l=p([]),s=p([]),u=p(),n=v((()=>a.show)),d=()=>{t("cancel")},q=()=>{var e;if(!(null==(e=r.value)?void 0:e.length))return void w(`暂未添加任何${a.type===G.MAIN_RISK?"主":"附加"}险`);let o=[];o=a.type===G.RIDER_RISK?r.value:l.value.filter((e=>r.value.includes(e.productCode))).map((e=>({productCode:e.productCode,mergeRiskReqList:(e.mainRiskCollocationList||[]).map((e=>({riskCode:e.collocationRiskCode,riskType:e.mainRiskCode?2:1,mainRiskCode:e.mainRiskCode})))}))),t("confirm",o)},S=async()=>{var e;const t={insuredList:a.insuredList,mainRiskCode:a.mainRiskCode,insurerCode:i,productCategory:"",keyword:u.value,selectProductCodes:[],selectRiskCodes:[],filterFlag:(null==(e=a.selectList)?void 0:e.length)?1:2};if(t.selectProductCodes=a.selectList.map((e=>(e.productCode===a.currentProductCode&&t.selectRiskCodes.push(...e.mergeRiskReqList.map((e=>e.riskCode))),e.productCode))),a.type===G.MAIN_RISK){const{code:e,data:a}=await K(t);"10000"===e&&(l.value=a)}else{const{code:e,data:a}=await E(t);"10000"===e&&(l.value=a.riskInfoList,s.value=a.collocationInfoResList)}};return f((()=>{S()})),(e,t)=>{const o=z,i=T,c=P,p=H,v=x;return m(),k(v,{show:L(n),"onUpdate:show":t[2]||(t[2]=e=>I(n)?n.value=e:null),class:"popup-risk-select",closeable:!1},{default:R((()=>{var n;return[C("div",Re,[C("div",Ce,[C("span",{class:"clear-all",onClick:d}," 取消 "),C("span",he,h(e.title),1),C("span",{class:"close",onClick:q},"确认")]),ye,C("div",Le,[y(o,{modelValue:L(u),"onUpdate:modelValue":t[0]||(t[0]=e=>I(u)?u.value=e:null),shape:"round",placeholder:"请输入产品名称进行搜索","clear-trigger":"always","show-action":"",clearable:"",onSearch:S},null,8,["modelValue"])]),(null==(n=L(l))?void 0:n.length)?(m(),j("div",Ie,[y(c,{modelValue:L(r),"onUpdate:modelValue":t[1]||(t[1]=e=>I(r)?r.value=e:null)},{default:R((()=>[(m(!0),j(g,null,b(L(l),(e=>(m(),k(i,{key:e.riskCode||e.productCode,name:e.riskCode||e.productCode,onClick:()=>{return t=e.riskCode,a.type===G.RIDER_RISK&&(s.value||[]).forEach((e=>{r.value.includes(t)?t===e.relatedRiskCode?(2===e.collocationType&&r.value.push(e.collocationRiskCode),3===e.collocationType&&(r.value.push(t),r.value=r.value.filter((t=>t!==e.collocationRiskCode)))):t===e.collocationRiskCode&&(2===e.collocationType&&r.value.push(e.relatedRiskCode),3===e.collocationType&&(r.value=r.value.filter((t=>t!==e.relatedRiskCode)))):t===e.relatedRiskCode?(2===e.collocationType&&(r.value=r.value.filter((t=>t!==e.collocationRiskCode))),3===e.collocationType&&(r.value.push(t),r.value=r.value.filter((t=>t!==e.collocationRiskCode)))):t===e.collocationRiskCode&&(2===e.collocationType&&(r.value=r.value.filter((t=>t!==e.relatedRiskCode))),3===e.collocationType&&(r.value=r.value.filter((t=>t!==e.relatedRiskCode))))})),void(r.value=[...new Set(r.value)]);var t}},{default:R((()=>[_(h(e.riskName||e.productName),1)])),_:2},1032,["name","onClick"])))),128))])),_:1},8,["modelValue"])])):(m(),k(p,{key:1,title:`暂无关联${e.type===L(G).MAIN_RISK?"主":"附加"}险、请选择其他险种`},null,8,["title"]))])]})),_:1},8,["show"])}}}),[["__scopeId","data-v-0a46ec37"]]);const be={class:"page-trial-wrap"},_e=d({name:"trial"}),qe=d({..._e,setup(e){const t=c(),a=N(),{productCode:o,orderNo:i,tenantId:r}=t.query,l=p({}),s=p({productList:[]}),u=p([]),n=p({}),d=p(),f=p(),C=Q({extInfo:{templateId:201,buttonCode:W.TRIAL_PREMIUM,pageCode:X.TRIAL_PREMIUM}}),h=p(),I=p(1),g=v((()=>I.value===G.MAIN_RISK?"添加主险":"添加附加险")),b=p(!1),_=()=>{b.value=!1},q=e=>{if(I.value===G.MAIN_RISK){s.value.productList.push(...e),console.log("selectCodeList",e);const t=e.map((e=>e.productCode));d.value.getProductDefaultValue(t)}else{const t=s.value.productList.find((e=>e.productCode===f.value)),a=e.map((e=>({riskCode:e,riskType:G.RIDER_RISK,mainRiskCode:n.value.riskCode}))),o=function(e,t,a){var o=null==e?0:e.length;if(!o)return-1;var i=null==a?0:re(a);return i<0&&(i=fe(o+i,0)),le(e,ve(t),i)}(t.mergeRiskReqList,(e=>e.riskCode===n.value.riskCode)),i=function(e,t,a){var o=null==e?0:e.length;if(!o)return-1;var i=o-1;return void 0!==a&&(i=re(a),i=a<0?me(o+i,0):ke(i,o-1)),le(e,ve(t),i,!0)}(t.mergeRiskReqList,(e=>e.mainRiskCode===n.value.riskCode));let r=o;-1!==i&&(r=i),t.mergeRiskReqList=[...t.mergeRiskReqList.slice(0,r+1),...a,...t.mergeRiskReqList.slice(r+1,t.mergeRiskReqList.length)],d.value.getRiderRiskDefaultValue(f.value,e,n.value.riskCode)}$(s.value).then((({code:e,data:t})=>{if("10000"===e){const{productDetailResList:e,productFactor:a}=t;h.value=a,s.value=Y(e);const o={};e.forEach((e=>{o[e.productCode]=e})),l.value=o}})),b.value=!1},w=(e,t,a)=>{b.value=!0,I.value=G.RIDER_RISK,u.value=a,n.value=t,f.value=e},T=e=>{b.value=!0,I.value=G.MAIN_RISK,u.value=e},P=(e,t,a)=>{l.value[e],a?(l.value[e].productPlanInsureVOList[0].insureProductRiskVOList=l.value[e].productPlanInsureVOList[0].insureProductRiskVOList.filter((e=>e.riskCode!==t)),s.value.productList=s.value.productList.map((a=>(a.productCode===e&&(a.mergeRiskReqList=a.mergeRiskReqList.filter((e=>e.riskCode!==t))),a)))):(delete l.value[e],s.value.productList=s.value.productList.filter((t=>t.productCode!==e)))},x=()=>{d.value.onNext((async e=>{var o;const i=ie(e),r=["id","relationToHolder","beneficiaryList","guardian","insuredBeneficiaryType"];Object.keys(null==(o=i.insuredList)?void 0:o[0]).reduce(((e,t)=>{var a,o,l,s;return!r.includes(t)&&(null==(o=null==(a=i.insuredList)?void 0:a[0])?void 0:o[t])&&(e[t]=null==(s=null==(l=i.insuredList)?void 0:l[0])?void 0:s[t]),e}),i.holder);const{code:l,data:s}=await U(i);"10000"===l&&a.push({path:O.questionNotice,query:{...t.query,orderNo:s}})}))};return V((()=>{F({productCode:o,isTenant:!1}).then((({data:e,code:t})=>{var a,i;"10000"===t&&(l.value[`${o}`]=e,h.value=null==(i=null==(a=null==e?void 0:e.productPlanInsureVOList)?void 0:a[0])?void 0:i.productFactor,s.value=Y([e]))})),i&&B({orderNo:i,tenantId:r}).then((({code:e,data:t})=>{"10000"===e&&(C.value=t)}))})),(e,t)=>(m(),j("div",be,[y(D,{ref_key:"trialRef",ref:d,"product-collection":L(l),"default-value":L(C),"product-factor":L(h),"product-risk-code-map":L(s),"is-trial":"","hide-benefit":"",onAddRisk:w,onAddMainRisk:T,onDeleteRisk:P},{trialBtn:R((({riskPremium:e})=>[y(J,{premium:e.initialPremium,onHandleClick:x},null,8,["premium"])])),_:1},8,["product-collection","default-value","product-factor","product-risk-code-map"]),L(b)?(m(),k(ge,{key:0,type:L(I),show:L(b),"insured-list":L(u),title:L(g),"current-product-code":L(f),"main-risk-code":L(n).riskCode,"select-list":L(s).productList,onCancel:_,onConfirm:q},null,8,["type","show","insured-list","title","current-product-code","main-risk-code","select-list"])):A("",!0)]))}});export{qe as default};
