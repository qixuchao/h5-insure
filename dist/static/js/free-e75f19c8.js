import{i as e,az as t,r as a,N as o,$ as i,m as n,s as l,B as r,C as s,t as d,Z as c,a5 as u,a6 as p,P as f,k as v,l as m,p as h,L as A,F as w,G as y,aa as I,aA as C,n as P,x as b,H as g,T as O}from"./vendor-6e9e6128.js";import{P as k}from"./index-d985c0db.js";import{B as x,A as F,_ as j}from"./index-daffe22e.js";import{_ as D,n as V}from"./nextStep-1f39a521.js";import{a as T,s as B,c as E}from"./phoneVerify-a0ce25be.js";import{_ as U,a8 as _}from"./index-6908eebb.js";import{q as N,p as H,g as R}from"./product-be79e022.js";import{i as L,t as S}from"./trial-cc10f456.js";import{v as z,f as Z}from"./utils-3db70029.js";import{u as G}from"./theme-467ed2f7.js";import"./infoCollection-a697cb4c.js";import"./relativeTime-63acc467.js";import"./useDicData-9df68c3c.js";import"./core-ef4459e8.js";import"./index-28eeef29.js";import"./useStorage-bdd48f22.js";import"./trial-41428ec1.js";var M="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFYAAAAeCAMAAACBgxnEAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAA8UExURUdwTPpkAPpkAPpkAPlkAPlkAP9fAPpkAP9jAPljAPljAPlkAPdhAP9VAPhlAPpjAPpiAPpkAPlhAPpkAKrbDd8AAAATdFJOUwCe3XX6YBgzC+yKwSIDTrE+0C9Hm6hZAAAAf0lEQVR42u2MSw6AIAxEi6CCf+j976ommvG3omxMOqv2vczQmZa3tPRMptdZndVZndXZf892/JGOxN68qUEr24/zk84jSvne93fae3Qk3scrjZeWzDcVaNUQIvRDOGkYQOU+hYMmsBJ+cTt1C0gZP7mNTvhL+Zq5xlfOW4tb6le9ZDBDk4RvXwAAAABJRU5ErkJggg==";const J={class:"free-crad"},q={class:"container"},Q={class:"title"},X=["src"],$=(e=>(u("data-v-f8c8f592"),e=e(),p(),e))((()=>r("span",null,"最后一步 填写信息",-1))),K=["src"];var Y=U(e({props:{colors:{type:Array,default:()=>["#CDDFFE","#F1F7FE"]},detail:{type:Object,default:()=>{}},isFirst:{type:Boolean,default:!0},insureDetail:{type:Object,default:()=>{}}},setup(e,{expose:u}){const p=e;t((e=>({b203cfd6:p.colors[0],b203cf98:p.colors[1]})));const f=a(),v=o({factorObj:{1:[{attributeValues:null,code:"mobile",datasource:null,defaultValue:null,displayType:null,factorId:null,factorScript:null,hasDefaultValue:1,id:8249,isDisplay:1,isHidden:1,isMustInput:2,isReadOnly:null,moduleType:1,placeholder:null,planCode:null,position:null,productCode:"lin23323",productId:null,title:"手机号"},{attributeValues:null,code:"verificationCode",datasource:null,defaultValue:null,displayType:null,factorId:null,factorScript:null,hasDefaultValue:1,id:8249,isDisplay:1,isHidden:1,isMustInput:2,isReadOnly:null,moduleType:1,placeholder:null,planCode:null,position:null,productCode:"lin23323",productId:null,title:"验证码"}],2:[],3:[]},isFirst:!0}),m=async(e,t)=>{const a=p.isFirst?T:B,o=await a(e),{code:i,data:n}=o;"10000"===i&&(null==t||t())};return i((()=>p.isFirst),(()=>{var e;p.isFirst||(v.factorObj=null==(e=p.insureDetail)?void 0:e.productFactor)})),u({validateForm:()=>new Promise(((e,t)=>{f.value.validateForm().then((t=>{e(!0)})).catch((()=>{t()}))}))}),(t,a)=>(n(),l("div",J,[r("div",q,[r("div",Q,[r("img",{src:s(M)},null,8,X),$,r("img",{src:s(M)},null,8,K)]),d(D,{ref_key:"formRef",ref:f,"send-sms-code":m,"form-info":e.detail,"factor-object":s(v).factorObj},null,8,["form-info","factor-object"]),c(t.$slots,"default",{},void 0,!0)])]))}}),[["__scopeId","data-v-f8c8f592"]]);const W={class:"pre-body"},ee={class:"header"},te=["src"],ae={class:"company-name"},oe={class:"content"},ie=y(" 为了更好地保护您的个人信息，请在使用前点击阅读、充分理解"),ne=y("相关内容，我们对您使用过程中可能出现的个人信息收集、使用、共享和保护等情况进行了详细说明。 您已进入投保流程，请仔细阅读"),le=y("、投保须知、保险条款等信息，为维护您的合法权益，您的操作轨迹将被记录。 "),re={class:"footer"};var se=U(e({props:{productDetail:{type:Object,default:()=>{}}},setup(e){const t=e,i=f(),{tenantId:c=""}=i.query,u=a(!0),p=a(!1),y=o({insureConfig:{insureName:"",tenantName:""}}),I=a({title:"",link:""}),C=(e,t)=>{var a;p.value=!p.value,I.value.link=null==(a=y.insureConfig)?void 0:a[t].link,I.value.title=e.target.innerText};return v((()=>{u.value=!1,(async()=>{const{code:e,data:a}=await N({insureCode:t.productDetail.insurerCode,tenantId:c});"10000"===e&&(y.insureConfig=a),u.value=!0})()})),(e,t)=>{var a;const o=m("ProPopup"),i=m("ProFilePreview");return n(),l(w,null,[d(o,{class:"pre-notice-wrap","close-on-click-overlay":!1,show:u.value,closeable:!1,height:"395px"},{default:h((()=>[r("div",W,[r("div",ee,[r("img",{src:s("/static/assets/logo.65e1895e.png")},null,8,te),r("div",ae," 由"+A(s(y).insureConfig.tenantName)+"提供保险经纪服务，"+A(s(y).insureConfig.insureName)+"承保 ",1)]),r("div",oe,[ie,r("span",{onClick:t[0]||(t[0]=e=>C(e,"privacyAgreement"))},"《用户隐私协议》"),ne,r("span",{onClick:t[1]||(t[1]=e=>C(e,"notification"))},"《客户告知书》"),le]),r("div",re,[d(k,{shadow:!1,text:"我知道了",onClick:t[2]||(t[2]=e=>u.value=!1)})])])])),_:1},8,["show"]),d(o,{show:p.value,"onUpdate:show":t[3]||(t[3]=e=>p.value=e),class:"pre-notice-wrap",title:null==(a=I.value)?void 0:a.title,position:"bottom",style:{height:"600px"}},{default:h((()=>{var e;return[d(i,{content:null==(e=I.value)?void 0:e.link,type:"link"},null,8,["content"])]})),_:1},8,["show","title"])],64)}}}),[["__scopeId","data-v-9aec5e06"]]);const de={class:"page-free-product-detail"},ce={class:"product-desc"},ue={key:0,class:"page-free-footer"};var pe=U(e({setup(e){t((e=>({"5b6eecb3":s(q).colors[1]})));const i=G(),c=I(),u=f(),{productCode:p="",openId:A="",tenantId:y="",indirectCode:D="123",saleUserId:T="",saleChannelId:B="",extraInfo:U}=u.query;let N="";const M=a(),J=a(),q=o({colors:["#fff"],detail:{},order:{tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},insuredBeneficiaryType:"1",tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}]}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}},banner:"",productDesc:[],newAuth:!0,isValidateCode:!1,insureDetail:{},loading:!0,showBtn:!1,activeIndex:0,showFilePreview:!1,isOnlyView:!0}),Q=a();let X={};try{X=JSON.parse(decodeURIComponent(U))}catch(ae){}const $=async()=>{q.loading=!0;const e=H({productCode:p,withInsureInfo:!0,tenantId:y}),t=L({productCode:p}),a=R({openId:A});await Promise.all([e,t,a]).then((([e,t,a])=>{var o,i,n;if("10000"===e.code){q.detail=e.data,q.banner=null==(o=q.detail.tenantProductInsureVO)?void 0:o.banner[0];const{colorEnd:t,colorStart:a}=(null==(i=q.detail.tenantProductInsureVO)?void 0:i.backgroundInsureVO)||{};q.colors=[a,t],q.productDesc=q.detail.tenantProductInsureVO.spec||[],document.title=q.detail.productFullName||""}"10000"===t.code&&(q.insureDetail=t.data,q.insureDetail.productFactor[1].forEach((e=>{"verificationCode"===e.code&&1===e.isDisplay&&(q.isValidateCode=!0)})),q.insureDetail.productFactor[2]=null==(n=q.insureDetail.productFactor)?void 0:n[2].map((e=>{var t,a;return"relationToHolder"===e.code&&1===e.isDisplay&&(e.title="被保人",q.order.tenantOrderInsuredList[0].relationToHolder=(null==(a=null==(t=e.attributeValueList)?void 0:t[0])?void 0:a.code)||""),e}))),"10000"===a.code&&(q.newAuth=!a.data),(()=>{let e={};if(e=q.detail.tenantProductInsureVO.planInsureVO.attachmentVOList||[],!e)return void(Q.value=[]);const t={2:"richText",3:"link"};Q.value=Object.keys(e).map((a=>(e[a].forEach((e=>{if("1"===e.attachmentType){const t=e.attachmentUri.split("?"),a=t[0].substr(t[0].lastIndexOf(".")+1);e.attachmentType="pdf"===a?"pdf":"picture"}else e.attachmentType=t[e.attachmentType]})),{attachmentName:a,attachmentList:e[a]})))})(),q.loading=!1}))},K=async()=>{let e={loginType:"2",openId:A,thirdUserType:"XINAO_WECHAT",indirectCode:D};try{if(q.newAuth?(e.loginName=q.order.tenantOrderHolder.mobile,e.password=q.order.tenantOrderHolder.verificationCode):e=Z({order:q.order,tenantId:y,extraInfo:X,detail:q.detail,insureDetail:q.insureDetail,iseeBizNo:N,saleUserId:T,saleChannelId:B,pageCode:"infoCollection",buttonCode:"EVENT_FREE_multiIssuePolicy"}),q.newAuth){const{code:t,data:a}=await S(e);"10000"===t&&(q.newAuth=!1)}else V(e,((e,t)=>{t===_.JUMP_PAGE&&e.orderNo&&c.push(`/baseInsurance/orderDetail?from=free&tenantId=${y}&orderNo=${e.orderNo}&productCode=${p}`)}))}catch(t){}},W=async()=>await(async()=>{var e;await J.value.validateForm();const t=null==(e=q.order.tenantOrderHolder)?void 0:e.verificationCode;if(q.isValidateCode&&(!t||!z(t)))return O({message:"请输入正确的验证码"}),!1;if(q.newAuth||!q.isValidateCode)return!0;const{code:a,data:o}=await E(q.order.tenantOrderHolder.mobile,t);return!!o})()?(q.newAuth?K():(q.isOnlyView=!1,q.showFilePreview=!0),!1):null,ee=()=>{q.showFilePreview=!1,q.isOnlyView=!1},te=()=>{q.showFilePreview=!1,q.isOnlyView=!0,K()};return v((()=>{$(),setTimeout((async()=>{N=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),C(M,(([{isIntersecting:e}],t)=>{q.showBtn=!e})),(e,t)=>{const a=m("van-image"),o=m("van-config-provider");return n(),P(o,{"theme-vars":s(i)},{default:h((()=>[r("div",de,[d(x,{url:s(q).banner},null,8,["url"]),d(Y,{ref_key:"formRef",ref:J,"is-first":s(q).newAuth,"insure-detail":s(q).insureDetail,detail:s(q).order,colors:s(q).colors},{default:h((()=>[d(k,{ref_key:"root",ref:M,class:"submit-btn","is-gradient":!1,text:s(q).newAuth?"立即领取":"激活保障",onClick:W},null,8,["text"]),Q.value&&Q.value.length>0?(n(),P(F,{key:0,"attachement-list":Q.value,"has-bg-color":!1,"pre-text":"请阅读",onPreviewFile:t[0]||(t[0]=e=>(e=>{q.activeIndex=e,q.showFilePreview=!0})(e))},null,8,["attachement-list"])):b("",!0)])),_:1},8,["is-first","insure-detail","detail","colors"]),r("div",ce,[(n(!0),l(w,null,g(s(q).productDesc,((e,t)=>(n(),P(a,{key:t,width:"100%","lazy-load":"",src:e,class:""},null,8,["src"])))),128))]),s(q).showBtn?(n(),l("footer",ue,[d(k,{"is-gradient":!1,text:s(q).newAuth?"立即领取":"激活保障",onClick:W},null,8,["text"])])):b("",!0)]),s(q).showFilePreview?(n(),P(j,{key:0,show:s(q).showFilePreview,"onUpdate:show":t[1]||(t[1]=e=>s(q).showFilePreview=e),"content-list":Q.value,"is-only-view":s(q).isOnlyView,"active-index":s(q).activeIndex,text:s(q).isOnlyView?"关闭":"我已逐页阅读上述内容并同意","force-read-cound":0,"on-close-file-preview":"",onSubmit:te,onOnCloseFilePreview:ee},null,8,["show","content-list","is-only-view","active-index","text"])):b("",!0),s(q).loading?b("",!0):(n(),P(se,{key:1,"product-detail":s(q).detail},null,8,["product-detail"]))])),_:1},8,["theme-vars"])}}}),[["__scopeId","data-v-e1fb64e0"]]);export{pe as default};
