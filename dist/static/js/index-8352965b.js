import{d as e,b0 as n,i as t,j as s,r as i,cX as a,k as o,l as r,cq as l,o as d,c,b as u,w as p,u as f,a as g,f as m,bg as w,p as v,v as b,e as k,q as h,F as y,_ as C,M as N,dM as S,T as P,b3 as J,au as I,c7 as R}from"./index-e6143c1d.js";import{d as T}from"./product-620fc8e2.js";import{u as _}from"./useThread-637a02aa.js";let j=!1;function x(e){const{fn:n,cbName:t="cbname",params:s={}}=e;return new Promise(((e,i)=>{new Promise(((e,n)=>{if(j)e("success");else{const t=setTimeout((()=>{window.AppJSInterface||window.webkit&&window.webkit.messageHandlers?(clearTimeout(t),e("success"),j=!0):(clearTimeout(t),n(new Error("JsBridge初始化失败：找不到window.AppJSInterface或者window.webkit.messageHandlers")))}),100)}})).then((()=>{window[t]=n=>{if(console.log("data>>>>>>>",n),n)if("string"==typeof n)try{e(JSON.parse(n))}catch(t){e(n)}else e(n);else e(n)},s.cbname=t,((e,n)=>{window.AppJSInterface?window.AppJSInterface[e](JSON.stringify(n)):window.webkit.messageHandlers&&window.webkit.messageHandlers[e].postMessage(JSON.stringify(n))})(n,s)})).catch((e=>{i(e)}))}))}const A={key:0,class:"header"},O=["src"],G={key:1,class:"statement up"},D={key:3,class:"statement"},E={class:"footer"},H={key:0},U={class:"review-pdf"},q=e({name:"preNotice"});var L=C(e({...q,props:{productDetail:{default:()=>({})}},emits:["close"],setup(e,{emit:C}){const j=e,q=n(),L=t(),{tenantId:M="",productCode:V,preview:F}=L.query,W=C,B=s(),X=i({insureConfig:{logoLocation:void 0,logoUrl:"",readingReminder:"",acceptReminder:"",readingSeconds:0,buttonTitle:"我知道了"}}),z=s(!1),K=s(!1),Q=s(!1),Y=new a({source:"sessionStorage"});let Z;const $=s({title:"",link:""}),ee=s(),ne=o((()=>{if($.value.link){const e=($.value.link||"").split("?"),n=e[0].lastIndexOf("."),t=(e[0]||"").substring(n+1);if("pdf"===t)return"pdf";if([".jpg",".JPG",".jpeg",".JPEG",".png",".PNG",".gif",".tif"].includes(t))return"picture"}return"link"})),te=e=>{Q.value=!0,K.value=!K.value,$.value.link=e.href,$.value.title=e.innerText},se=()=>{z.value=!1,W("close")},ie=async()=>{const{code:e,data:n}=await T({insureCode:j.productDetail.insurerCode,productCode:V,tenantId:M});"10000"===e&&(z.value=!0,X.insureConfig=n,ee.value=X.insureConfig.readingSeconds||0,Z=_({start:()=>{console.log("开始轮询"),ee.value-=1},stop:()=>{console.log("结束轮询"),ee.value=0,Y.set("PRENOTICE-isShow","1")},time:1e3,number:X.insureConfig.readingSeconds||0}),N((()=>{Z.run()}))),S(B,"click",(e=>{const n=e||window.event;n.preventDefault?n.preventDefault():n.returnValue=!1;const{target:t}=n;let s=t;var i,a;("SPAN"===t.tagName&&"A"===(null==t?void 0:t.parentNode.tagName)||"A"===t.tagName)&&("SPAN"===t.tagName&&"A"===(null==t?void 0:t.parentNode.tagName)&&(s=null==t?void 0:t.parentNode),console.dir(s),(e=>{if(!e)return!1;const[n]=(e||"").split("?"),t=n.lastIndexOf(".");if(-1===t)return!1;const s=n.substring(t);return[".jpg",".JPG",".jpeg",".JPEG",".png",".PNG",".gif",".tif",".pdf",".PDF"].includes(s)})(s.href)?te(s):"_blank"===s.target?0===s.href.indexOf("http://")||0===s.href.indexOf("https://")?q?(i=s.innerText,a=s.href,x({fn:"openWebView",cbName:"js_openWebView",params:{title:i,link:a,showProgress:!0}})):window.open(s.href):P("配置网页链接需要带协议http://或https://"):te(s))}))};return r((()=>{!F&&ie()})),(e,n)=>{var t;const s=J,i=I,a=R,o=l("dompurify-html");return d(),c(y,null,[u(i,{class:"pre-notice-wrap",show:f(z),"close-on-click-overlay":!1,closeable:!1,height:"auto",style:{"padding-bottom":"30px"}},{default:p((()=>[f(X).insureConfig.logoUrl?(d(),c("div",A,[g("img",{src:f(X).insureConfig.logoUrl},null,8,O)])):m("",!0),1===f(X).insureConfig.logoLocation&&f(X).insureConfig.acceptReminder?w((d(),c("div",G,null,512)),[[o,f(X).insureConfig.acceptReminder]]):m("",!0),f(X).insureConfig.readingReminder?(d(),c("div",{key:2,ref_key:"noticeRef",ref:B,class:"content"},[w(g("div",null,null,512),[[o,f(X).insureConfig.readingReminder]])],512)):m("",!0),2===f(X).insureConfig.logoLocation&&f(X).insureConfig.acceptReminder?w((d(),c("div",D,null,512)),[[o,f(X).insureConfig.acceptReminder]]):m("",!0),g("div",E,[f(Q)?(d(),v(s,{key:1,type:"primary",disabled:0!==f(ee),block:"",round:"",onClick:se},{default:p((()=>[b(k(f(X).insureConfig.buttonTitle)+" ",1),f(ee)?(d(),c("span",H,k(f(ee))+"s",1)):m("",!0)])),_:1},8,["disabled"])):(d(),v(s,{key:0,type:"primary",disabled:!f(Q),block:"",round:""},{default:p((()=>[b(" 请先阅读《隐私政策》文件 ")])),_:1},8,["disabled"]))])])),_:1},8,["show"]),u(i,{show:f(K),"onUpdate:show":n[0]||(n[0]=e=>h(K)?K.value=e:null),class:"pre-notice-wrap",title:null==(t=f($))?void 0:t.title,position:"bottom","close-on-click-overlay":!1,style:{overflow:"hidden"}},{default:p((()=>{var e;return[g("div",U,[u(a,{"is-iframe":!1,content:null==(e=f($))?void 0:e.link,type:f(ne)},null,8,["content","type"])])]})),_:1},8,["show","title"])],64)}}}),[["__scopeId","data-v-d60f152e"]]);export{L as default};
