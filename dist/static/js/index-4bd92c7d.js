import{q as e}from"./index-d66a20d8.js";import{defineAsyncComponent as t,ref as l,computed as a,watch as o,nextTick as u}from"vue";import{u as n}from"./theme-65292714.js";import{P as r}from"./index-88613e6f.js";import{o as i}from"./utils-57fec98c.js";import"./pdfh5-e588f83d.js";import"./infoCollection-e6a8a0ee.js";import"./trial-b3f7bf73.js";const v={key:0,class:"item"},s={key:1,class:"attachment-list"},c=["onClick"],d={class:"attachment-list-item-name"},m={class:"attachment-list-item-icon"},f={class:"footer"},p=vue.defineComponent({name:"filePreview"}),h=vue.defineComponent({...p,props:{show:{type:Boolean,default:!1},contentList:{default:()=>[]},activeIndex:{default:0},text:{default:""},beforeReadOverText:{default:"同意，下一条"},forceReadCount:{default:0},isOnlyView:{type:Boolean,default:!1}},emits:["update:show","submit","onCloseFilePreviewByMask"],setup(p,{emit:h}){const k=p,b=t((()=>e((()=>import("./index-d66a20d8.js").then((function(e){return e.bg}))),["static/js/index-d66a20d8.js","static/css/index-5064de6f.css","static/js/pdfh5-e588f83d.js"]))),C=n(),w=l(!0),B=l(k.show),y=l(k.contentList.map(((e,t)=>({...e,disabled:!0,readDisabled:!0})))),x=l(k.activeIndex),g=l(0),E=l(null),R=a((()=>{var e,t;return null==(t=null==(e=y.value)?void 0:e[x.value])?void 0:t.attachmentList})),N=a((()=>{var e;return null==(e=y.value[x.value])?void 0:e.readDisabled})),P=a((()=>!(x.value>=k.forceReadCount-1)&&(!(g.value>=k.forceReadCount)&&(g.value<k.forceReadCount&&x.value!==k.forceReadCount-1)))),T=()=>{x.value+=1},V=()=>{k.isOnlyView?h("update:show",!1):(h("update:show",!1),h("submit"))};o((()=>k),(()=>{B.value=k.show,x.value=k.activeIndex}),{deep:!0,immediate:!0});const j=e=>{var t,l,a;if(e){const o=(null==(t=e.target)?void 0:t.scrollHeight)||e.scrollHeight,u=(null==(l=e.target)?void 0:l.scrollTop)||e.scrollTop,n=(null==(a=e.target)?void 0:a.clientHeight)||e.clientHeight;Math.floor(o-u-15)<=n&&w.value&&y.value[x.value].readDisabled&&(y.value[x.value].disabled=!1,y.value[x.value].readDisabled=!1,y.value[x.value+1].disabled=!1,g.value+=1)}};return o((()=>x.value),(()=>{w.value=!1,k.show&&(g.value>=k.forceReadCount&&y.value.forEach((e=>{e.disabled=!1,e.readDisabled=!1})),setTimeout((()=>{w.value=!0}),800)),u((()=>{setTimeout((()=>{const e=document.querySelector(".viewerContainer")||document.querySelector(".com-file-preview .content");e&&(e.removeEventListener("scroll",j),j(e),e.addEventListener("scroll",j))}),2e3)}))}),{immediate:!0}),(e,t)=>{const l=vue.resolveComponent("ProTab"),a=vue.resolveComponent("ProSvg"),o=vue.resolveComponent("ProPopup");return vue.openBlock(),vue.createBlock(o,{show:vue.unref(B),"onUpdate:show":t[1]||(t[1]=e=>vue.isRef(B)?B.value=e:null),class:"file-preview-popup-wrap",closeable:!1,onClose:t[2]||(t[2]=e=>h("onCloseFilePreviewByMask"))},{default:vue.withCtx((()=>[vue.unref(B)?(vue.openBlock(),vue.createBlock(l,{key:0,active:vue.unref(x),"onUpdate:active":t[0]||(t[0]=e=>vue.isRef(x)?x.value=e:null),list:vue.unref(y).map(((e,t)=>({title:e.attachmentName,disabled:t!=vue.unref(x)&&(e.disabled||!1),slotName:`guarantee-${t}`}))),class:"tab"},null,8,["active","list"])):vue.createCommentVNode("",!0),vue.createElementVNode("div",{ref_key:"previewRef",ref:E,class:"list"},[1===vue.unref(R).length?(vue.openBlock(),vue.createElementBlock("div",v,[(vue.openBlock(),vue.createBlock(vue.unref(b),{key:vue.unref(R)[0].materialSourceDesc,content:vue.unref(R)[0].materialContent,type:vue.unref(R)[0].materialSource,"forbid-click":!0},null,8,["content","type"]))])):(vue.openBlock(),vue.createElementBlock("div",s,[(vue.openBlock(!0),vue.createElementBlock(vue.Fragment,null,vue.renderList(vue.unref(R),((e,t)=>(vue.openBlock(),vue.createElementBlock("div",{key:t,class:"attachment-list-item",onClick:t=>(e=>{const t={fileType:e.materialSource,fileUri:e.materialContent};i(t)})(e)},[vue.createElementVNode("div",d,vue.toDisplayString(e.materialName),1),vue.createElementVNode("div",m,[vue.createVNode(a,{name:"arrow-right"})])],8,c)))),128))]))],512),vue.createElementVNode("div",f,[vue.unref(P)?(vue.openBlock(),vue.createBlock(r,{key:0,shadow:!1,"theme-vars":vue.unref(C),disabled:vue.unref(N),class:"right",text:`${e.beforeReadOverText}(${vue.unref(x)+1}/${e.forceReadCount})`,onClick:T},null,8,["theme-vars","disabled","text"])):(vue.openBlock(),vue.createBlock(r,{key:1,disabled:vue.unref(N),shadow:!1,"theme-vars":vue.unref(C),text:k.text,onClick:V},null,8,["disabled","theme-vars","text"]))])])),_:1},8,["show"])}}});export{h as default};
