var j=Object.defineProperty,G=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var q=(l,a,u)=>a in l?j(l,a,{enumerable:!0,configurable:!0,writable:!0,value:u}):l[a]=u,w=(l,a)=>{for(var u in a||(a={}))J.call(a,u)&&q(l,u,a[u]);if(U)for(var u of U(a))K.call(a,u)&&q(l,u,a[u]);return l},S=(l,a)=>G(l,z(a));import{g as T,E as g,M as P,_ as W,r as _,j as I,k as y,m as V,p as D,A as o,z as p,J as X,L as Y,T as A,O as Q,a9 as Z,h as ee,n as te,G as ae,F as oe,C as ne}from"./vendor-894ab2f1.js";import{R as ue}from"./infoCollection-b0426750.js";import{s as se,c as re}from"./phoneVerify-15256b28.js";import{v as R,a as H,b as le}from"./validator-ebd71d12.js";import{F as L,g as ie}from"./utils-bef5abd0.js";import{G as ce}from"./index-51274998.js";import{g as me,m as de,i as fe}from"./trial-9bc4659d.js";import{p as pe}from"./product-3c1a6d11.js";import{t as ve}from"./theme-eeb93d73.js";import"./trial-04fa888a.js";const _e=T({props:{userInfo:{type:Object,default:()=>{}}},emits:["on-verify"],setup(l,{emit:a}){var k;const u=l,s=g({}),i=g(!1),E=30,m=g(0),h=g("\u83B7\u53D6\u9A8C\u8BC1\u7801"),n=P({mobile:(k=u.userInfo)==null?void 0:k.mobile,smsCode:""}),v=c=>R(c)?!0:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7",e=c=>H(c)?!0:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u9A8C\u8BC1\u7801",F=()=>{if(m.value>0)return;m.value=E;const c=()=>{h.value=`${m.value}s`,m.value-=1};c();const t=setInterval(()=>{m.value===0?(h.value="\u83B7\u53D6\u9A8C\u8BC1\u7801",m.value=0,clearInterval(t)):c()},1e3)},B=async()=>{m.value>0||s==null||s.value.validate("mobile").then(async()=>{const c=await se(n.mobile),{code:t,data:r}=c;t==="10000"&&(i.value=!0,A({message:"\u77ED\u4FE1\u53D1\u9001\u6210\u529F\uFF0C\u8BF7\u67E5\u6536"}),F())})},C=async()=>{const c=await re(n.mobile,n.smsCode),{data:t}=c;t&&a("on-verify",n)},O=async()=>{s==null||s.value.validate().then(async()=>{C()})};return W(()=>n,()=>{R(n.mobile)&&H(n.smsCode)&&i.value&&C()},{deep:!0,immediate:!0}),(c,t)=>{const r=_("van-field"),d=_("van-cell-group"),f=_("VanForm");return I(),y(f,{ref_key:"formRef",ref:s,"label-width":"60"},{default:V(()=>[D(d,null,{default:V(()=>[D(r,{modelValue:o(n).mobile,"onUpdate:modelValue":t[0]||(t[0]=b=>o(n).mobile=b),name:"mobile",label:"\u624B\u673A\u53F7",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",maxlength:o(L).MOBILE,rules:[{validator:v}]},null,8,["modelValue","maxlength","rules"]),D(r,{modelValue:o(n).smsCode,"onUpdate:modelValue":t[1]||(t[1]=b=>o(n).smsCode=b),name:"smsCode",label:"\u9A8C\u8BC1\u7801",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",maxlength:o(L).SMS_CODE,rules:[{validator:e}]},{button:V(()=>[p("div",{class:Y(["sms-code",{"count-down":m.value>0}]),onClick:B},X(h.value),3)]),_:1},8,["modelValue","maxlength","rules"])]),_:1}),p("div",{class:"submit",onClick:O})]),_:1},512)}}}),he=T({props:{userInfo:{type:Object,default:()=>{}}},emits:["on-submit"],setup(l,{emit:a}){const u=l,s=g({}),i=P({name:u.userInfo.name,certNo:u.userInfo.certNo}),E=n=>ce(i.certNo)?!0:"\u8BF7\u586B\u5199\u6B63\u786E\u7684\u8BC1\u4EF6\u53F7",m=n=>le(n)?!0:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u59D3\u540D",h=()=>{s==null||s.value.validate().then(async n=>{a("on-submit",i)})};return(n,v)=>{const e=_("van-field"),F=_("van-cell-group"),B=_("VanForm");return I(),y(B,{ref_key:"formRef",ref:s,"label-width":"60"},{default:V(()=>[D(F,null,{default:V(()=>[D(e,{modelValue:o(i).name,"onUpdate:modelValue":v[0]||(v[0]=C=>o(i).name=C),name:"name",label:"\u59D3\u540D",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D",maxlength:o(L).NAME,rules:[{validator:m}]},null,8,["modelValue","maxlength","rules"]),D(e,{modelValue:o(i).certNo,"onUpdate:modelValue":v[1]||(v[1]=C=>o(i).certNo=C),name:"certNo",label:"\u8EAB\u4EFD\u8BC1",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u8EAB\u4EFD\u8BC1\u53F7",maxlength:o(L).ID_CARD,rules:[{validator:E}]},null,8,["modelValue","maxlength","rules"])]),_:1}),p("div",{class:"submit",onClick:h})]),_:1},512)}}});var Ce="/static/assets/title-step1.97cb9efa.png",be="/static/assets/title-step2.258af5e9.png";const ge={class:"page-activity-invite"},Fe=["src"],Be={class:"container"},Ie={class:"main-form"},De={class:"title"},ye=["src"],Ve={class:"agree"},Ee=ne(" \u6211\u5DF2\u9605\u8BFB\u5E76\u540C\u610F "),Ue=T({setup(l){const a=Q(),u=Z(),{productCode:s="7X9",tenantId:i="",phoneNo:E,saleChannelId:m,agentCode:h,paymentMethod:n}=a.query,v=g(!0),e=P({title:Ce,attachmentList:[{attachmentName:"",attachmentUrl:""}],userInfo:{mobile:E,certNo:"",name:""},agree:!1}),F=g(),B=g(),C=async t=>{var b,N;e.userInfo.mobile=t.mobile;const r=await me({holderPhone:e.userInfo.mobile,productCode:s,tenantId:i}),{code:d,data:f}=r;d==="10000"&&(e.userInfo.name=(b=f.tenantOrderHolder)==null?void 0:b.name,e.userInfo.certNo=(N=f.tenantOrderHolder)==null?void 0:N.certNo),e.title=be,v.value=!1},O=async t=>{if(!e.agree){A("\u8BF7\u52FE\u9009\u534F\u8BAE");return}try{A({message:"\u9886\u53D6\u4E2D...",forbidClick:!0,loadingType:"spinner"}),e.userInfo.certNo=t.certNo,e.userInfo.name=t.name;const r=ie({tenantId:i,detail:F.value,insureDetail:B.value,saleChannelId:m,saleUserId:h,holder:e.userInfo,insured:S(w({},e.userInfo),{relationToHolder:ue.SELF}),paymentMethod:n,renewalDK:"",successJumpUrl:"",premium:0,orderStatus:"",orderTopStatus:"",tenantOrderRiskList:[]}),d=await de(r),{code:f}=d;f==="10000"&&u.push({path:"/chuangxin/baigebao/productDetail",query:S(w({},a.query),{tenantId:i,phoneNo:e.userInfo.mobile,certNo:e.userInfo.certNo,name:e.userInfo.name,productCode:"BWYL2021",agentCode:h})})}catch(r){console.log(r),A.clear()}},k=()=>{let t=[];return B.value.productRiskVoList.forEach(r=>{r.riskDetailVOList.forEach(d=>{t=t.concat(d.riskAttachmentVOList)})}),t},c=async()=>{const t=pe({productCode:s,withInsureInfo:!0,tenantId:i}),r=fe({productCode:s});Promise.all([t,r]).then(([d,f])=>{d.code==="10000"&&(F.value=d.data),f.code==="10000"&&(B.value=f.data,e.attachmentList=k())})};return ee(()=>{c()}),(t,r)=>{const d=_("van-checkbox"),f=_("ProPDFviewer"),b=_("van-config-provider");return I(),y(b,{"theme-vars":o(ve)},{default:V(()=>{var N,M;return[p("div",ge,[p("img",{src:(M=(N=F.value)==null?void 0:N.tenantProductInsureVO)==null?void 0:M.banner[0],class:"banner"},null,8,Fe),p("div",Be,[p("div",Ie,[p("div",De,[p("img",{src:o(e).title},null,8,ye)]),v.value?(I(),y(_e,{key:0,"user-info":o(e).userInfo,onOnVerify:C},null,8,["user-info"])):(I(),y(he,{key:1,"user-info":o(e).userInfo,onOnSubmit:O},null,8,["user-info"])),p("div",Ve,[D(d,{modelValue:o(e).agree,"onUpdate:modelValue":r[0]||(r[0]=x=>o(e).agree=x),name:"agree",shape:"square"},null,8,["modelValue"]),p("div",null,[Ee,(I(!0),te(oe,null,ae(o(e).attachmentList||[],(x,$)=>(I(),y(f,{key:$,class:"file-name",title:`\u300A${x.attachmentName}\u300B`,content:x.attachmentUrl,type:"pdf"},null,8,["title","content"]))),128))])])])])])]}),_:1},8,["theme-vars"])}}});export{Ue as default};
