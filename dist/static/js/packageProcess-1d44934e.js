import{_ as e,d as a,u as r,a as t,r as n,J as o,ag as l,E as s,am as i,G as d,aA as u,z as c,c as m,g as v,f as p,w as y,A as f,j as h,i as I,m as N,t as g,bB as w,e as b,n as k,F as T,T as C,ai as F,B as O,bT as L,X as D,Y as P,aI as j,b6 as S,bG as H,aJ as x}from"./index-8dcf7554.js";import{d as E}from"./debounce-2dbbea42.js";import{a as U}from"./order-42a2354a.js";import{S as A,R as q,P as R,I as V}from"./infoCollection-fc3860dd.js";import{i as B,u as M,a as _,s as K,p as Y,g as $}from"./trial-bc41e7be.js";import{p as z}from"./product-bc4385b3.js";import{t as G,g as J,a as W,o as X,s as Q,v as Z,b as ee,j as ae}from"./utils-e439144b.js";import{t as re}from"./theme-ea709837.js";import{d as te,B as ne,D as oe,G as le,S as se,H as ie,P as de,U as ue,_ as ce,W as me,a as ve}from"./auth-d192d93c.js";import{_ as pe}from"./close-d6aa4c3f.js";import"./pdfh5-008ca364.js";import"./isObjectLike-d00d103b.js";import"./trial-d7fb7924.js";import"./index-6fb2dbcc.js";import"./index-fd19efb2.js";import"./index-c00014f4.js";import"./index-9bb8e6e6.js";import"./bankCard-6c4a0316.js";import"./validator-5a13dc82.js";import"./phoneVerify-95149480.js";const ye={key:0},fe={class:"page-internet-product-detail"},he={class:"info"},Ie={class:"footer-button"},Ne={class:"price"},ge=(e=>(D("data-v-224d0f1e"),e=e(),P(),e))((()=>I("span",null,"总保费",-1))),we={key:0};var be=e(a({setup(e){const a=r(),D=t(),{productCode:P="BWYL2021",tenantId:be,orderNo:ke,phoneNo:Te,agentCode:Ce="",saleChannelId:Fe,paymentMethod:Oe,certNo:Le,name:De,pageCode:Pe,from:je}=D.query,Se=n(),He=n(),xe=n(),Ee=n(),Ue="payBack"===Pe;n(!1);const Ae=n(!1),qe=n(!1),Re=n(0),Ve=n(!1),Be=n(!1),Me=n({show:!1,html:""}),_e=n({}),Ke=n(),Ye=n(!1),$e=n("");let ze="";const Ge=o({holder:{certNo:Le,certType:l.CERT,mobile:Te,name:De,socialFlag:A.HAS},insured:{certNo:Le,certType:l.CERT,name:De,socialFlag:A.HAS,relationToHolder:q.SELF},paymentMethod:Oe,renewalDK:"Y",paymentFrequency:R.YEAR,packageProductList:[],mobileSmsCode:""}),Je=n(te),We=n(te),Xe=o({showInsure:!Ue,canInsure:!1,canUpgrade:!1}),Qe=s((()=>{var e,a;return(null==(a=null==(e=He.value)?void 0:e.tenantProductInsureVO)?void 0:a.attachmentVOList.filter((e=>"健康告知"===e.attachmentName)))||[]})),Ze=s((()=>{var e,a;return(null==(a=null==(e=He.value)?void 0:e.tenantProductInsureVO)?void 0:a.attachmentVOList.filter((e=>"健康告知"!==e.attachmentName)))||[]})),ea=()=>{$e.value=Ee.value?Ge.paymentFrequency==R.YEAR?"元/年":"元/月":""},aa=()=>{a.push({path:"/internet/guaranteeUpgrade",query:{...D.query,tenantId:be,productCode:"BWYL2022",orderNo:ke,agentCode:Ce}})},ra=()=>{Be.value=!1},ta=()=>{We.value=Je.value},na=()=>{We.value={...We.value,relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1}},oa=e=>`${H}/internet/payFail?tenantId=${be}&orderNo=${e}&agentCode=${Ce}&pageCode=payBack&from=${je||"normal"}`,la=async e=>{const a=J({tenantId:be,saleUserId:Ce,saleChannelId:Fe,detail:He.value,insureDetail:xe.value,paymentMethod:Ge.paymentMethod,paymentFrequency:Ge.paymentFrequency,renewalDK:Ge.renewalDK,iseeBizNo:ze,successJumpUrl:"",premium:Ee.value,holder:Ge.holder,insured:Ge.insured,tenantOrderRiskList:e,orderStatus:"",orderTopStatus:"",orderNo:ke,originOrderIds:Ke.value});try{const e=await K(a),{code:t,data:n}=e;qe.value=!1,Ae.value=!1,"10000"===t&&(C.clear(),delete a.id,_e.value={orderNo:n.data,order:a},qe.value=!0,r=0,Re.value=r,qe.value=!0)}catch(t){C.clear(),Xe.canInsure=!0}var r},sa=()=>new Promise(((e,a)=>{var r,t;null==(t=null==(r=Se.value)?void 0:r.validateForm)||t.call(r).then((async()=>{if(!(()=>{if(Ge.holder.certNo){const e=x(Ge.holder.certNo);if(Z(Ge.holder.certNo,18,"year"))return C("投保人年龄必须大于等于18岁！"),!1;if(Ge.insured.certNo&&Ge.insured.relationToHolder===q.MATE&&e===x(Ge.insured.certNo))return C("被保人为配偶时，性别不可相同！"),!1}if(Ge.insured.certNo){if(Ge.insured.relationToHolder===q.CHILD&&Z(Ge.insured.certNo,30,"day"))return C("被保人为子女时，年龄必须大于等于30天！"),!1;if(Ge.insured.relationToHolder===q.PARENT&&!Z(Ge.insured.certNo,71,"year"))return C("被保人为父母时，年龄必须小于等于70岁！"),!1}if([q.CHILD,q.PARENT].includes(Ge.insured.relationToHolder)){const e=ee(Ge.holder.certNo,"year"),a=ee(Ge.insured.certNo,"year");if(Ge.insured.relationToHolder===q.CHILD&&e-a<18)return C("投保人和子女年龄必须相差18岁！"),!1;if(Ge.insured.relationToHolder===q.PARENT&&a-e<18)return C("投保人和父母年龄必须相差18岁！"),!1}return!0})())return void(Xe.canInsure=!0);const{calcData:r,riskVOList:t}=W({holder:Ge.holder,insured:Ge.insured,tenantId:be,productDetail:He.value,insureDetail:xe.value,paymentFrequency:Ge.paymentFrequency,packageRiskIdList:X(Ge.packageProductList)},!1,ae);(!Array.isArray(t)||t.length<1)&&(C("被保人年龄需在30天(含) - 70岁(含)之间！"),Ee.value=null,a(new Error));const n=await Y(r),{code:o,data:l}=n;"10000"===o?(Ee.value=l.premium,e({condition:t,data:l})):(Ee.value=null,a(new Error))})).catch((e=>{Xe.canInsure=!0,Q(e)}))})),ia=async()=>{var e;if(Ue)aa();else try{C.loading({message:"订单生成中...",forbidClick:!0,duration:0});const{condition:a,data:r}=await sa(),t={},n=(e=[])=>{(e||[]).forEach((e=>{var a;t[e.riskCode]=e,(null==(a=e.riskPremiumDetailVOList)?void 0:a.length)&&n(e.riskPremiumDetailVOList)}))};n(r.riskPremiumDetailVOList);const o=G({tenantId:be,riskList:a,riskPremium:t,productId:null==(e=He.value)?void 0:e.id});la(o)}catch(a){Xe.canInsure=!0}finally{C.clear()}},da=e=>{var a;"allFalse"===e?(Ae.value=!1,Xe.canInsure=!0,(async e=>{C.loading({message:"核保中...",forbidClick:!0,duration:0});try{const a=await M(e),{code:r}=a;if("10000"===r){const a=await _({orderNo:e.orderNo,tenantId:be}),{data:r}=a;"10000"===a.code&&(2===r.type?(Me.value={show:!0,html:r.paymentUrl},console.log("data.paymentUrl",Me.value),S((()=>{console.log("document.forms",document.forms);const e=document.getElementById("cashierSubmit");null==e||e.addEventListener("submit",(e=>{e.preventDefault()})),null==e||e.submit()}))):window.location.href=r.paymentUrl)}Xe.canInsure=!0}catch(a){Xe.canInsure=!0}finally{C.clear()}})({..._e.value.order,orderNo:_e.value.orderNo,extInfo:{extraInfo:{renewalDK:Ge.renewalDK,paymentMethod:Ge.paymentMethod,paymentFrequency:Ge.paymentFrequency,successJumpUrl:(a=_e.value.orderNo,`${H}/pay?orderNo=${a}&saleUserId=${Ce}&tenantId=${be}`),failUrl:oa(_e.value.orderNo)},iseeBizNo:ze}})):F.confirm({message:"您当前的健康状况不符合该产品",confirmButtonText:"确定"}).then((()=>{window.history.back()})).catch((()=>{Xe.canInsure=!0}))},ua=()=>{qe.value=!1,Ae.value=!1,Xe.canInsure=!0},ca=()=>{qe.value=!1,Ae.value=!0};i([()=>Ge.insured.certNo,()=>Ge.insured.socialFlag,()=>Ge.packageProductList,()=>Ge.paymentFrequency],E((()=>{Ge.insured.certNo&&Ge.insured.socialFlag&&(()=>{const{holder:{certNo:e,mobile:a,name:r,socialFlag:t},insured:{certNo:n,name:o,socialFlag:l,relationToHolder:s},paymentMethod:i}=Ge;return!(!j(n)||!l)})()&&(async()=>{const{calcData:e,riskVOList:a}=W({holder:Ge.holder,insured:Ge.insured,tenantId:be,productDetail:He.value,insureDetail:xe.value,paymentFrequency:Ge.paymentFrequency,packageRiskIdList:X(Ge.packageProductList)},!1,ae);if(!Array.isArray(a)||a.length<1)return C("被保人年龄需在30天(含) - 70岁(含)之间！"),Ee.value=null,{};Ye.value=!0;const r=await Y(e);Ye.value=!1;const{code:t,data:n}=r;"10000"===t?Ge.insured.certNo?(Ee.value=n.premium,ea()):(Ee.value=null,ea()):Ee.value=null})()}),500),{deep:!0,immediate:!0}),i((()=>Ge.insured.certNo),(()=>{Ge.insured.certNo||(Ee.value=null)}));const ma=async()=>{var e,a,r,t,n,o,l,s,i,d,u,c,m,v,p;const y=await $({orderNo:ke,tenantId:be}),{code:f,data:h}=y;if("10000"===f){const{id:y,tenantOrderHolder:f,tenantOrderInsuredList:I,extInfo:N}=h;if(!Ue){Ke.value={id:y,holderId:null==f?void 0:f.id,insuredId:null==I?void 0:I[0].id};const s=((null==(a=null==(e=I[0])?void 0:e.tenantOrderProductList[0])?void 0:a.tenantOrderRiskList)||[]).map((e=>{var a;return(null==(a=e.extInfo)?void 0:a.riskId)||""}));return Ge.packageProductList.forEach((e=>{e.value=e.productRiskVoList.filter((e=>s.includes(e.id))).length>0?V.INSURE:V.UN_INSURE})),Object.assign(Ge,{holder:{certNo:f.certNo,certType:f.certType,mobile:f.mobile,name:f.name,socialFlag:A.HAS},insured:{certNo:null==I?void 0:I[0].certNo,certType:null==(r=I[0])?void 0:r.certType,name:null==(t=I[0])?void 0:t.name,socialFlag:null==(o=null==(n=I[0])?void 0:n.extInfo)?void 0:o.hasSocialInsurance,relationToHolder:null==(l=I[0])?void 0:l.relationToHolder},paymentMethod:N.extraInfo.paymentMethod,paymentFrequency:N.extraInfo.paymentFrequency,renewalDK:N.extraInfo.renewalDK||"N"}),void(Xe.canInsure=!0)}Object.assign(Ge,{holder:{certNo:f.certNo,certType:f.certType,mobile:f.mobile,name:f.name,socialFlag:A.HAS},insured:{certNo:null==I?void 0:I[0].certNo,certType:null==(s=I[0])?void 0:s.certType,name:null==(i=I[0])?void 0:i.name,socialFlag:null==(u=null==(d=I[0])?void 0:d.extInfo)?void 0:u.hasSocialInsurance,relationToHolder:null==(c=I[0])?void 0:c.relationToHolder},paymentMethod:N.extraInfo.paymentMethod,paymentFrequency:N.extraInfo.paymentFrequency,renewalDK:N.extraInfo.renewalDK||"N"}),Ee.value=null==(p=null==(v=null==(m=I[0])?void 0:m.tenantOrderProductList)?void 0:v[0])?void 0:p.premium,h.orderStatus!==U.ACCEPT_POLICY&&h.orderStatus!==U.PAYMENT_SUCCESS||(Xe.canUpgrade=!0,Ve.value=!1,Be.value=!0),h.orderStatus===U.PAYING&&(Ve.value=!0,setTimeout((()=>{ma()}),3e3))}};return d((()=>{console.log("投保链接"),We.value=ve,Je.value=ve,Xe.canInsure=!0,(async()=>{var e,a;const r=await z({productCode:P,withInsureInfo:!0,tenantId:be});"10000"===r.code&&(He.value=r.data,document.title=(null==(e=r.data)?void 0:e.productFullName)||"");const t=await B({productCode:P});"10000"===t.code&&(Ge.packageProductList=((null==(a=t.data)?void 0:a.packageProductVOList)||[]).map((e=>({...e,value:V.UN_INSURE,disabled:!1}))),xe.value=t.data),ke&&ma()})(),setTimeout((async()=>{ze=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,a)=>{const r=u,t=O,n=L,o=c("dompurify-html");return m(),v(T,null,[p(n,{"theme-vars":N(re)},{default:y((()=>{var e,a,n,l,s,i,d;return[Me.value.show?f((m(),v("div",ye,null,512)),[[o,Me.value.html]]):h("",!0),I("div",fe,[I("div",he,[p(ne,{url:null==(a=null==(e=He.value)?void 0:e.tenantProductInsureVO)?void 0:a.banner[0]},null,8,["url"]),p(oe,{"product-name":null==(n=He.value)?void 0:n.productFullName,"product-desc":null==(s=null==(l=He.value)?void 0:l.showConfigVO)?void 0:s.desc},null,8,["product-name","product-desc"])]),p(le,{"show-service-config":"","guarantee-list":null==(d=null==(i=He.value)?void 0:i.tenantProductInsureVO)?void 0:d.titleAndDescVOS},null,8,["guarantee-list"]),p(se,{detail:He.value.tenantProductInsureVO},{form:y((()=>[p(ie,{ref_key:"formRef",ref:Se,"is-show-package":"",disable:!N(Xe).showInsure,"form-auth":We.value,"form-info":N(Ge),"product-detail":He.value,onOnReset:ta,onOnUpdate:na},null,8,["disable","form-auth","form-info","product-detail"])])),_:1},8,["detail"]),I("div",Ie,[I("div",Ne,[ge,Ye.value?(m(),b(r,{key:1,class:"premium-loading",type:"spinner"})):(m(),v("span",we,g(Ee.value?"￥":"")+g(N(w)(Ee.value))+" "+g($e.value),1))]),p(t,{type:"primary",class:"right",disabled:!(N(Xe).canInsure||N(Xe).canUpgrade),onClick:ia},{default:y((()=>[k(g(N(Xe).showInsure?"立即投保":"升级保障"),1)])),_:1},8,["disabled"])])]),N(ke)?h("",!0):(m(),b(de,{key:1,"product-detail":He.value},null,8,["product-detail"])),p(ue,{"order-no":N(ke),"tenant-id":N(be),"is-show":Be.value,onOnConfirm:aa,onOnClose:ra},null,8,["order-no","tenant-id","is-show"])]})),_:1},8,["theme-vars"]),p(ce,{show:Ae.value,"onUpdate:show":a[0]||(a[0]=e=>Ae.value=e),"content-list":N(Qe),"active-index":0,onOnConfirmHealth:da,onOnCloseHealth:ua},null,8,["show","content-list"]),qe.value?(m(),b(pe,{key:0,show:qe.value,"onUpdate:show":a[1]||(a[1]=e=>qe.value=e),"content-list":N(Ze),"active-index":Re.value,text:"我已逐页阅读并确认告知内容","force-read-cound":2,"on-close-file-preview":"",onSubmit:ca,onOnCloseFilePreview:ua},null,8,["show","content-list","active-index"])):h("",!0),p(me,{"is-show":Ve.value},null,8,["is-show"])],64)}}}),[["__scopeId","data-v-224d0f1e"]]);export{be as default};
