import{_ as e,d as a,u as t,a as s,r as o,ad as n,J as i,G as l,C as r,v as d,b as c,c as u,e as p,w as v,f,P as y,h as g,F as m,i as C,g as h,L as T,j as k,t as j,a7 as D,n as I,aa as q,p as L,ak as N,al as _,H as b,T as x,M as A,N as E,O as M,af as P,B}from"./index-0af8f588.js";import{l as G,g as S}from"./inform-ff8a4e05.js";import{s as Y}from"./verify-17cfed2a.js";import{d as w,A as O,e as R}from"./notice-a5228c22.js";import"./pdfh5-008ca364.js";const U={class:"date"},V={class:"inform-file"},F={class:"tips"},$={class:"footer-button"};var z=e(a({__name:"index",setup(e){const a=t(),z=s(),{productCode:H="MMBBSF",agentCode:J="65434444",tenantId:W="9991000007",agencyCode:K="3311222",insurerCode:Q="zhongan",productCategory:X=1,templateId:Z=1,orderNo:ee="2022080217103534947"}=z.query,ae=o(null),te=o(!1),se=n().format("YYYY-MM-DD"),oe=o(""),ne=o(),ie=()=>{var e;null==(e=ae.value)||e.clear()},le=i({noticeType:"",materialSource:"",noticeList:[],pageData:{}});l((()=>{L({orderNo:ee,saleUserId:J,tenantId:W}).then((({code:e,data:a})=>{"10000"===e&&(Object.assign(le.pageData,a),a.tenantOrderAttachmentList.forEach((e=>{e.category===N.ELECTRIC_SIGN&&e.objectType===_.AGENT&&ae.value.setDataURL(e.fileBase64)})))})),G({insurerCode:Q,orderNo:ee,productCategory:X,tenantId:W,noticeType:O,objectType:R}).then((({code:e,data:a})=>{"10000"===e&&(le.noticeList=[...le.noticeList,...a])}))}));const re=()=>{var e,t;if(!(le.noticeList&&le.noticeList.every((e=>1===e.isDone))))return void x("请完成所有告知进行下一步");if(null==(e=ae.value)?void 0:e.isEmpty())return void x("请完成代理人签字进行下一步");if(!te.value)return void x("请勾选同意签名");const s=null==(t=ae.value)?void 0:t.save();Y("AGENT",s,le.pageData.id,W).then((e=>{e&&A({...le.pageData,extInfo:{...le.pageData.extInfo,templateId:Z,pageCode:"salesNotice",buttonCode:E.salesNotice},venderCode:Q}).then((({code:e,data:t})=>{"10000"===e&&"jumpToPage"===t.pageAction.pageAction&&a.push({path:M[t.pageAction.data.nextPageCode],query:{...z.query}})}))}))};return(e,t)=>{const s=r,o=P,n=d,i=B,l=c("ProPageWrap");return u(),p(l,{class:"page-salesman-inform"},{default:v((()=>[f(y,{title:"营销员告知书"},{default:v((()=>[(u(!0),g(m,null,C(h(le).noticeList,(e=>(u(),p(s,{key:e.id,class:T({"is-active":2===e.isDone}),title:`《${e.title}》`,"is-link":"",value:""+(1===e.isDone?"已完成":"去完成"),onClick:t=>{return s=e,b.set("questionData",s),void a.push({path:"/healthNotice",query:{questionnaireType:s.questionnaireType,...z.query}});var s}},null,8,["class","title","value","onClick"])))),128))])),_:1}),f(y,{title:"营销员签字","show-divider":!1,"show-line":!1},{extra:v((()=>[k("div",{class:"resign",onClick:ie},"重签")])),default:v((()=>[f(o,{ref_key:"agentSignRef",ref:ae,selector:"sign2"},null,512),k("div",U,"签名日期： "+j(h(se)),1)])),_:1}),k("div",V,[f(n,{modelValue:h(te),"onUpdate:modelValue":t[0]||(t[0]=e=>D(te)?te.value=e:null),shape:"square"},null,8,["modelValue"]),k("p",F,[I(" 您的签名将被用于"),(u(!0),g(m,null,C(h(le).noticeList,((e,a)=>(u(),p(q,{key:a,class:"file",title:`《${e.title}》`,content:h(ne),type:h(oe),onClick:a=>(e=>{const{id:a,objectType:t}=e,s={1:"pdf",2:"richText",3:"link"};S({insurerCode:Q,id:a,objectType:t,productCategory:X,orderNo:ee,tenantId:W}).then((({code:e,data:a})=>{"10000"===e&&((null==a?void 0:a[0].questionType)===w?(oe.value="question",ne.value=a):(1===(null==a?void 0:a[0].textType)&&(null==a?void 0:a[0].content.includes("png"))?oe.value="picture":oe.value=s[null==a?void 0:a[0].textType],ne.value=null==a?void 0:a[0].content))}))})(e)},null,8,["title","content","type","onClick"])))),128)),I("文件 ")])]),k("div",$,[f(i,{type:"primary",block:"",onClick:re},{default:v((()=>[I("下一步")])),_:1})])])),_:1})}}}),[["__scopeId","data-v-6f1bc28e"]]);export{z as default};
