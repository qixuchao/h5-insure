import{d as e,h as s,i as a,j as t,O as o,o as i,l as r,w as l,a as d,e as u,b as c,u as n,c as p,m,F as f,n as v,_ as k,T as C,ap as R,aq as j,ar as b,as as I,at as h,au as L,g as y,av as _,q as P,s as g}from"./index-a6b4898c.js";import{T as q}from"./index-0b4b0b75.js";import{q as x,a as N,g as w,s as M,i as S,m as V}from"./trial-29afeb0f.js";import{_ as A}from"./index-fb5899a4.js";import{C as K}from"./index-e48ed3d8.js";import{S as O}from"./index-a5219713.js";import{R as D}from"./trial-bddb85c7.js";import{_ as T}from"./TrialButton-5e93de80.js";import{u as E}from"./useOrder-a2431b32.js";import{B,P as U}from"./constants-5480429b.js";import{p as F}from"./utils-0af605ab.js";import"./cloneDeep-9f2c4892.js";import"./InsureInfos-c736c76d.js";import"./index-de590a0b.js";import"./get-55ca1cd5.js";import"./infoCollection-8df6e167.js";import"./index-ac58b159.js";import"./empth-c0adfdba.js";import"./PolicyInfo-5b6b0b1e.js";import"./lodash-fdfbeda5.js";import"./questionnaire-62331097.js";import"./index-f342ddd9.js";import"./search-7a4e156f.js";import"./product-585b0e6f.js";import"./constants-78af7c34.js";import"./utils-aebf20f5.js";import"./createProposal-7b852f28.js";import"./nextStep-5288ce8b.js";import"./core-bff09cea.js";import"./constant-8927d485.js";import"./empty-ae586b6c.js";import"./index-352406b0.js";const $={class:"popup-container"},H={class:"popup-header"},z={class:"title"},G=(e=>(h("data-v-124bec92"),e=e(),L(),e))((()=>d("p",{class:"tip"},"已为您挑选出以下险种",-1))),J={class:"search"},Q={key:0,class:"risk-list"},W=e({name:"riskSelect"});var X=k(e({...W,props:{type:{default:2},show:{type:Boolean,default:!1},title:{},insuredList:{default:()=>[]},mainRiskCode:{default:""},selectList:{default:()=>[]}},emits:["cancel","confirm"],setup(e,{emit:k}){const h=e,L=s(),{insurerCode:y}=L.query,_=a(),P=a([]),g=t((()=>h.show)),q=()=>{k("cancel")},w=()=>{_.value?k("confirm",_.value):C(`暂未添加任何${h.type===D.MAIN_RISK?"主":"附加"}险`)};return o((()=>{(async()=>{const e={insuredVO:h.insuredList,mainRiskCode:h.mainRiskCode,insurerCode:y,productCategory:"",selectProductCodes:[],selectRiskCodes:[]};if(e.selectProductCodes=h.selectList.map((s=>(e.selectRiskCodes.push(...s.mergeRiskReqList.map((e=>e.riskCode))),s.productCode))),h.type===D.MAIN_RISK){const{code:s,data:a}=await x(e);"10000"===s&&(P.value=a)}else{const{code:s,data:a}=await N(e);"10000"===s&&(P.value=a)}})()})),(e,s)=>{const a=O,t=R,o=j,k=K,C=b,h=A,L=I;return i(),r(L,{show:n(g),"onUpdate:show":s[1]||(s[1]=e=>m(g)?g.value=e:null),class:"popup-risk-select",closeable:!1},{default:l((()=>[d("div",$,[d("div",H,[d("span",{class:"clear-all",onClick:q}," 取消 "),d("span",z,u(e.title),1),d("span",{class:"close",onClick:w},"确认")]),G,d("div",J,[c(a,{shape:"round",placeholder:"请输入产品名称进行搜索"})]),n(P).length?(i(),p("div",Q,[c(C,{modelValue:n(_),"onUpdate:modelValue":s[0]||(s[0]=e=>m(_)?_.value=e:null)},{default:l((()=>[c(k,{inset:""},{default:l((()=>[(i(!0),p(f,null,v(n(P),(e=>(i(),r(o,{key:e.riskCode||e.productCode,title:e.riskName||e.productName,clickable:"",onClick:s=>_.value=e.riskCode||e.productCode},{icon:l((()=>[c(t,{name:e.riskCode||e.productCode},null,8,["name"])])),_:2},1032,["title","onClick"])))),128))])),_:1})])),_:1},8,["modelValue"])])):(i(),r(h,{key:1,title:`暂无关联${e.type===n(D).MAIN_RISK?"主":"附加"}险、请选择其他险种`},null,8,["title"]))])])),_:1},8,["show"])}}}),[["__scopeId","data-v-124bec92"]]);const Y={class:"page-trial-wrap"},Z=e({name:"trial"}),ee=e({...Z,setup(e){const o=s(),d=y(),{productCode:u,orderNo:m,tenantId:f}=o.query,v=a({}),k=a({productList:[]}),C=a([]),R=a({}),j=a(),b=a(),I=E({extInfo:{templateId:201,buttonCode:B.TRIAL_PREMIUM,pageCode:U.TRIAL_PREMIUM}}),h=a(),L=a(1),x=t((()=>L.value===D.MAIN_RISK?"添加主险":"添加附加险")),N=a(!1),A=()=>{N.value=!1},K=e=>{if(L.value===D.MAIN_RISK)k.value.productList.push({productCode:e,mergeRiskReqList:[]}),j.value.getProductDefaultValue(e);else{k.value.productList.find((e=>e.productCode===b.value)).mergeRiskReqList.push({riskCode:e,riskType:D.RIDER_RISK,mainRiskCode:R.value.riskCode}),j.value.getRiderRiskDefaultValue(b.value,e,R.value.riskCode)}V(k.value).then((({code:e,data:s})=>{if("10000"===e){const{productDetailResList:e,productFactor:a}=s;h.value=a,k.value=F(e);const t={};e.forEach((e=>{t[e.productCode]=e})),v.value=t}})),N.value=!1},O=(e,s,a)=>{N.value=!0,L.value=D.RIDER_RISK,C.value=a,R.value=s,b.value=e},$=e=>{N.value=!0,L.value=D.MAIN_RISK,C.value=e},H=(e,s,a)=>{v.value[e],a?(v.value[e].productPlanInsureVOList[0].insureProductRiskVOList=v.value[e].productPlanInsureVOList[0].insureProductRiskVOList.filter((e=>e.riskCode!==s)),k.value.productList=k.value.productList.map((a=>(a.productCode===e&&(a.mergeRiskReqList=a.mergeRiskReqList.filter((e=>e.riskCode!==s))),a)))):(delete v.value[e],k.value.productList=k.value.productList.filter((s=>s.productCode!==e)))},z=()=>{j.value.onNext((async e=>{const{code:s,data:a}=await M(e);"10000"===s&&d.push({path:g.questionNotice,query:{...o.query,orderNo:a}})}))};return _((()=>{S({productCode:u,isTenant:!1}).then((({data:e,code:s})=>{var a,t;"10000"===s&&(v.value[`${u}`]=e,h.value=null==(t=null==(a=null==e?void 0:e.productPlanInsureVOList)?void 0:a[0])?void 0:t.productFactor,k.value=F([e]))})),m&&w({orderNo:m,tenantId:f}).then((({code:e,data:s})=>{"10000"===e&&(I.value=s)}))})),(e,s)=>(i(),p("div",Y,[c(q,{ref_key:"trialRef",ref:j,"product-collection":n(v),"default-value":n(I),"product-factor":n(h),"is-trial":"","hide-benefit":"",onAddRisk:O,onAddMainRisk:$,onDeleteRisk:H},{trialBtn:l((({riskPremium:e})=>[c(T,{premium:e.initialPremium,onHandleClick:z},null,8,["premium"])])),_:1},8,["product-collection","default-value","product-factor"]),n(N)?(i(),r(X,{key:0,type:n(L),show:n(N),"insured-list":n(C),title:n(x),"main-risk-code":n(R).riskCode,"select-list":n(k).productList,onCancel:A,onConfirm:K},null,8,["type","show","insured-list","title","main-risk-code","select-list"])):P("",!0)]))}});export{ee as default};
