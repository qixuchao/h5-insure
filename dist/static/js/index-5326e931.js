import{g as le,E,_ as re,r as m,j as v,k as b,m as d,z as i,p as l,n as z,G as ce,J as R,F as fe,C as H,a9 as ye,O as Ce,Q as Ae,M as Be,y as se,o as De,A as c,t as W,d as ue,T as ge}from"./vendor-3ed1524d.js";import{_ as he,m as Te,h as Pe,g as be,A as w,s as P,N as Re,n as xe,b as Ne}from"./index-6896b2f1.js";import{p as Fe}from"./trial-4dbb4ebc.js";import{P as ie,I as de,R as Ve}from"./trial-418b528f.js";import{u as ke}from"./useDicData-bc91f3f0.js";import{R as He,a as Se,B as Ue,b as we}from"./infoCollection-192ba138.js";import{_ as ne}from"./index-fbe9f1e5.js";import"./utils-b6782348.js";const $e={class:"com-select-container"},je={class:"radio-item-wrapper"},Me={class:"name"},Ye={class:"hone"},qe={class:"address"},Ge={class:"footer-button"},Je=H("\u53D6\u6D88"),Ke=H("\u786E\u8BA4"),We=le({props:{dataSource:{type:Array,default:()=>[]},show:{type:Boolean,default:!1},modelValue:{type:[String,Number],default:null}},emits:["update","update:modelValue","submit","close"],setup(Q,{emit:$}){const x=Q,D=E(x.modelValue),j=E(x.show),X=()=>{$("submit",D.value),j.value=!1},Z=()=>{$("close")};return re(()=>x.modelValue,M=>{D.value=M}),re(()=>D.value,M=>{$("update:modelValue",M)}),(M,N)=>{const K=m("van-radio"),Y=m("van-radio-group"),q=m("VanButton");return v(),b(Te,{show:j.value,"onUpdate:show":N[1]||(N[1]=L=>j.value=L),class:"com-select",title:"\u9009\u62E9\u4FDD\u5355\u901A\u8BAF\u4FE1\u606F",onClose:Z},{default:d(()=>[i("div",$e,[l(Y,{modelValue:D.value,"onUpdate:modelValue":N[0]||(N[0]=L=>D.value=L)},{default:d(()=>[(v(!0),z(fe,null,ce(Q.dataSource,(L,F)=>(v(),b(K,{key:F,name:F+1,class:"radio-item"},{default:d(()=>[i("div",je,[i("p",null,[i("span",Me,R(L.contactName),1),i("span",Ye,R(L.contactPhoneNo),1)]),i("p",qe,R(L.contactAddress),1)])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),i("div",Ge,[l(q,{plain:"",type:"primary"},{default:d(()=>[Je]),_:1}),l(q,{type:"primary",onClick:X},{default:d(()=>[Ke]),_:1})])]),_:1},8,["show"])}}});var ze=he(We,[["__scopeId","data-v-a821acd4"]]);const Qe={key:0,class:"beneficiary-part"},Xe={class:"part-title"},Ze={class:"title"},et=H("\u5220\u9664"),tt=H("+\u6DFB\u52A0\u53D7\u76CA\u4EBA"),nt=H("\u9009\u62E9\u4FDD\u5355\u901A\u8BAF\u4FE1\u606F"),rt={class:"radio-item-wrapper"},ot={class:"name"},at={class:"hone"},st={class:"address"},ut={class:"footer-button","safe-area-inset-bottom":""},it={class:"left"},dt={class:"trial-result"},lt=H(" \u9996\u671F"),ct={class:"result-num"},ft=i("div",{class:"result-desc"},"\u5B9E\u9645\u4FDD\u8D39\u4EE5\u540E\u7EED\u4E3A\u51C6",-1),pt={class:"operate-btn"},mt=H("\u4E0B\u4E00\u6B65"),At=le({setup(Q){const $=ye(),x=Ce(),{templateId:D=1,orderNo:j="2022072710380711215",productCode:X,tenantId:Z="9991000007",proposalId:M,insurerCode:N="kunlunhealth"}=x.query,[K,Y]=Ae(),q=x.path==="/infoPreview"?"infoPreview":"infoCollection",L=ke("NATIONAL_REGION_CODE"),F=E({}),e=E({extInfo:{pageCode:q},tenantOrderHolder:{extInfo:{occupationCodeList:[]},holderType:1},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},insuredBeneficiaryType:"1",tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}]}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}}),ee=E(null),g=E([]),S=E([]),G=E([]),te=E([]),oe=E([]),h=Be({beneficiaryId:0,nextPage:"",currentAddress:null,isLoading:!0}),ae=se(()=>{var t,u,s,r,a,f,p,y,C,A;return[{contactAddress:(u=(t=e.value.tenantOrderHolder)==null?void 0:t.extInfo)==null?void 0:u.familyAddress,contactName:e.value.tenantOrderHolder.name,contactPhoneNo:e.value.tenantOrderHolder.mobile},{contactAddress:(r=(s=e.value.tenantOrderHolder)==null?void 0:s.extInfo)==null?void 0:r.workAddress,contactName:e.value.tenantOrderHolder.name,contactPhoneNo:e.value.tenantOrderHolder.mobile},{contactAddress:(f=(a=e.value.tenantOrderInsuredList[0])==null?void 0:a.extInfo)==null?void 0:f.familyAddress,contactName:(p=e.value.tenantOrderInsuredList[0])==null?void 0:p.name,contactPhoneNo:(y=e.value.tenantOrderInsuredList[0])==null?void 0:y.mobile},{contactAddress:(A=(C=e.value.tenantOrderInsuredList[0])==null?void 0:C.extInfo)==null?void 0:A.workAddress,contactName:e.value.tenantOrderInsuredList[0].name,contactPhoneNo:e.value.tenantOrderInsuredList[0].mobile}].filter(_=>_.contactAddress&&_.contactName&&_.contactPhoneNo)||[]}),J=se(()=>{var o,t;return h.currentAddress?ae.value[h.currentAddress-1]||{}:((t=(o=e.value.extInfo)==null?void 0:o.contactInfo)==null?void 0:t[0])||{}}),pe=o=>{const t={};return o.map(u=>{const{initialAmount:s,annuityDrawFrequency:r,annuityDrawType:a,paymentFrequency:f,paymentPeriod:p,paymentPeriodType:y,insurancePeriodType:C,insurancePeriodValue:A,riskCode:_,riskType:V,initialPremium:U,liabilityDetails:k,extInfo:O}=u,{riskId:T,copy:n}=O,I={amount:s,annuityDrawDate:r,annuityDrawType:a,paymentFrequency:f,riskId:T,copy:n,chargePeriod:p?`${ie[y]}_${p}`:ie[y],coveragePeriod:A?`${de[C]}_${A}`:de[C],riskCode:_,riskType:V,premium:U,liabilityVOList:k.map(B=>({...B,liabilityAttributeValue:B.refundMethod,liabilityAttributeCode:B.refundMethod&&1}))};return V===Ve.MAIN_RISK?(t.mainRiskCode=_,t.mainRiskId=T):Object.assign(I,t),I})},me=()=>{var t;const o={...e.value};o.extInfo={...o.extInfo,contactInfo:[J.value],buttonCode:Re.infoCollection},o.tenantOrderAttachmentList=[{category:w.OBVERSE_CERT,objectType:P.HOLDER,objectId:e.value.tenantOrderHolder.id,name:"\u6295\u4FDD\u4EBA\u8BC1\u4EF6\u6B63\u9762",uri:g.value[0],id:G.value[0]},{category:w.REVERSE_CERT,objectType:P.HOLDER,objectId:e.value.tenantOrderHolder.id,name:"\u6295\u4FDD\u4EBA\u8BC1\u4EF6\u80CC\u9762",uri:g.value[1],id:G.value[1]},{category:w.OBVERSE_CERT,objectType:P.INSURED,objectId:e.value.tenantOrderInsuredList[0].id,name:"\u88AB\u4FDD\u4EBA\u8BC1\u4EF6\u6B63\u9762",uri:S.value[0]||g.value[0],id:te.value[1]},{category:w.REVERSE_CERT,objectType:P.INSURED,objectId:e.value.tenantOrderInsuredList[0].id,name:"\u88AB\u4FDD\u4EBA\u8BC1\u4EF6\u80CC\u9762",uri:S.value[1]||g.value[1],id:te.value[1]}].filter(u=>u.uri),(t=ee.value)==null||t.validate().then(u=>{if(o.tenantOrderInsuredList[0].insuredBeneficiaryType===we.SPECIFY){const s={};if(o.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.forEach(r=>{s[r.benefitOrder]?s[r.benefitOrder].sum+=Number(r.benefitRate):s[r.benefitOrder]={sum:Number(r.benefitRate)}}),Object.values(s).some(r=>r.sum!==100)){ge.fail("\u540C\u4E00\u987A\u4F4D\u7684\u53D7\u76CA\u4EBA\u6BD4\u4F8B\u4E4B\u548C\u5FC5\u987B\u4E3A100");return}}xe(o).then(({code:s,data:r})=>{s==="10000"&&r.pageAction.pageAction==="jumpToPage"&&$.push({path:Ne[r.pageAction.data.nextPageCode],query:x.query})})})},Ie=()=>{var o;(o=ee.value)==null||o.validate().then(()=>{const{birthday:t,gender:u,extInfo:s}=e.value.tenantOrderHolder,{hasSocialInsurance:r,occupationCodeList:a}=s,{birthday:f,gender:p,extInfo:y,tenantOrderProductList:C}=e.value.tenantOrderInsuredList[0],{hasSocialInsurance:A,occupationCodeList:_}=y,V={holder:{personVO:{birthday:ue(t).format("YYYY-MM-DD"),gender:u,socialFlag:r,occupationCodeList:a}},productCode:X,insuredVOList:[{insurerCode:N,personVO:{birthday:ue(f).format("YYYY-MM-DD"),gender:p,socialFlag:A,occupationCodeList:_},productPlanVOList:[{insurerCode:N,planCode:"",riskVOList:pe(C[0].tenantOrderRiskList)}]}]};Fe({...V}).then(({code:U,data:k})=>{if(U==="10000"){const O={},T=(n=[])=>{(n||[]).forEach(I=>{var B;O[I.riskCode]=I,(B=I.riskPremiumDetailVOList)!=null&&B.length&&T(I.riskPremiumDetailVOList)})};T(k.riskPremiumDetailVOList),e.value.tenantOrderInsuredList[0].tenantOrderProductList[0]={...e.value.tenantOrderInsuredList[0].tenantOrderProductList[0],premium:k.premium,tenantOrderRiskList:e.value.tenantOrderInsuredList[0].tenantOrderProductList[0].tenantOrderRiskList.map(n=>({...n,initialAmount:O[n.riskCode].amount,initialPremium:O[n.riskCode].premium}))},me()}})})},ve=o=>{console.log("value",o)},_e=()=>{h.beneficiaryId+=1,e.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.push({id:h.beneficiaryId,extInfo:{}})},Oe=o=>{e.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList=e.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.filter(t=>t.beneficiaryId!==o.beneficiaryId||o.id!==t.id)},Ee=()=>{be({orderNo:j,tenantId:Z}).then(({code:o,data:t})=>{var u,s;if(o==="10000"){const r=t;r.extInfo={...r.extInfo,pageCode:q,templateId:D},r.tenantOrderHolder=r.tenantOrderHolder||{holderType:1},r.tenantOrderHolder.extInfo={...r.tenantOrderHolder.extInfo,occupationCodeList:((u=r.tenantOrderHolder.extInfo)==null?void 0:u.occupationCodeList)||[]},r.tenantOrderInsuredList[0].extInfo={...r.tenantOrderInsuredList[0].extInfo,occupationCodeList:((s=r.tenantOrderInsuredList[0].extInfo)==null?void 0:s.occupationCodeList)||[]},r.tenantOrderInsuredList[0].tenantOrderBeneficiaryList=r.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.map(a=>{var p;const f=a;return f.extInfo={...f.extInfo,occupationCodeList:((p=f.extInfo)==null?void 0:p.occupationCodeList)||[]},f}),r.tenantOrderAttachmentList.forEach(a=>{a.category===w.OBVERSE_CERT?a.objectType===P.HOLDER?(g.value[0]=a.uri,G.value[0]=a.id):a.objectType===P.INSURED&&(S.value[0]=a.uri,te.value[0]=a.id):a.category===w.REVERSE_CERT&&(a.objectType===P.HOLDER?(g.value[1]=a.uri,G.value[1]=a.id):a.objectType===P.INSURED&&(S.value[1]=a.uri,G.value[1]=a.id))}),Object.assign(e.value,r)}}).finally(()=>{h.isLoading=!1})},Le=()=>{Object.assign(e.value.tenantOrderInsuredList[0],e.value.tenantOrderHolder,{id:e.value.tenantOrderInsuredList[0].id,extInfo:{...e.value.tenantOrderHolder.extInfo,insureProvinceCode:e.value.tenantOrderInsuredList[0].extInfo.insureProvinceCode,insureCityCode:e.value.tenantOrderInsuredList[0].extInfo.insureCityCode,insureAreaCode:e.value.tenantOrderInsuredList[0].extInfo.insureAreaCode}})};return De(()=>{Ee(),Pe({pageCode:"infoCollection",templateId:D}).then(({code:o,data:t})=>{if(console.log("code",o),o==="10000"){const u={BENEFICIARY:[],INSURER:[],HOLDER:[]};t.productInsureFactorList.forEach(s=>{(u[s.moduleType]=u[s.moduleType]||[]).push(s)}),F.value=u}})}),re([()=>e.value.tenantOrderInsuredList[0].relationToHolder,()=>e.value.tenantOrderHolder],()=>{`${e.value.tenantOrderInsuredList[0].relationToHolder}`===He.SELF&&Le()},{deep:!0,immediate:!0}),(o,t)=>{const u=m("ProCard"),s=m("ProRadioButton"),r=m("ProField"),a=m("ProCascader"),f=m("ProSvg"),p=m("VanButton"),y=m("ProCheckButton"),C=m("van-cell"),A=m("ProForm"),_=m("ProPageWrap");return v(),b(_,{class:"page-info-wrapper"},{default:d(()=>{var V,U,k,O,T;return[c(h).isLoading?W("",!0):(v(),b(A,{key:0,ref_key:"formRef",ref:ee},{default:d(()=>[l(u,{title:"\u6295\u4FDD\u4EBA"},{default:d(()=>[l(ne,{images:g.value,"onUpdate:images":t[0]||(t[0]=n=>g.value=n),"form-info":e.value.tenantOrderHolder,"factor-list":F.value.HOLDER,prefix:"holder"},null,8,["images","form-info","factor-list"])]),_:1}),l(u,{title:"\u88AB\u4FDD\u4EBA"},{default:d(()=>[l(r,{modelValue:e.value.tenantOrderInsuredList[0].relationToHolder,"onUpdate:modelValue":t[2]||(t[2]=n=>e.value.tenantOrderInsuredList[0].relationToHolder=n),label:"\u4E3A\u8C01\u4FDD\u5355",name:"relationToHolder",placeholder:"\u8BF7\u9009\u62E9"},{input:d(()=>[l(s,{modelValue:e.value.tenantOrderInsuredList[0].relationToHolder,"onUpdate:modelValue":t[1]||(t[1]=n=>e.value.tenantOrderInsuredList[0].relationToHolder=n),options:c(Se)},null,8,["modelValue","options"])]),_:1},8,["modelValue"]),+e.value.tenantOrderInsuredList[0].relationToHolder!=1?(v(),b(ne,{key:0,images:S.value,"onUpdate:images":t[3]||(t[3]=n=>S.value=n),"form-info":e.value.tenantOrderInsuredList[0],"factor-list":F.value.INSURER||[],prefix:"insure"},null,8,["images","form-info","factor-list"])):W("",!0),l(a,{modelValue:e.value.tenantOrderInsuredList[0].extInfo.insureAreaCode,"onUpdate:modelValue":t[4]||(t[4]=n=>e.value.tenantOrderInsuredList[0].extInfo.insureAreaCode=n),field1:e.value.tenantOrderInsuredList[0].extInfo.insureProvinceCode,"onUpdate:field1":t[5]||(t[5]=n=>e.value.tenantOrderInsuredList[0].extInfo.insureProvinceCode=n),field2:e.value.tenantOrderInsuredList[0].extInfo.insureCityCode,"onUpdate:field2":t[6]||(t[6]=n=>e.value.tenantOrderInsuredList[0].extInfo.insureCityCode=n),field3:e.value.tenantOrderInsuredList[0].extInfo.insureAreaCode,"onUpdate:field3":t[7]||(t[7]=n=>e.value.tenantOrderInsuredList[0].extInfo.insureAreaCode=n),label:"\u6295\u4FDD\u5730\u533A",name:"insureAreaCode",placeholder:"\u8BF7\u9009\u62E9","is-link":"",required:"","data-source":c(L),mapping:{label:"name",value:"code",children:"children"}},null,8,["modelValue","field1","field2","field3","data-source"])]),_:1}),l(u,{title:"\u53D7\u76CA\u4EBA"},{default:d(()=>[l(r,{modelValue:e.value.tenantOrderInsuredList[0].insuredBeneficiaryType,"onUpdate:modelValue":t[9]||(t[9]=n=>e.value.tenantOrderInsuredList[0].insuredBeneficiaryType=n),label:"\u53D7\u76CA\u4EBA\u7C7B\u578B",name:"insuredBeneficiaryType",placeholder:"\u8BF7\u9009\u62E9"},{input:d(()=>[l(s,{modelValue:e.value.tenantOrderInsuredList[0].insuredBeneficiaryType,"onUpdate:modelValue":t[8]||(t[8]=n=>e.value.tenantOrderInsuredList[0].insuredBeneficiaryType=n),options:c(Ue)},null,8,["modelValue","options"])]),_:1},8,["modelValue"]),e.value.tenantOrderInsuredList[0].insuredBeneficiaryType==2?(v(),z("div",Qe,[(v(!0),z(fe,null,ce(e.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList,(n,I)=>(v(),z("div",{key:n.beneficiaryId||n.id,class:"beneficiary-item"},[i("div",Xe,[i("span",Ze,R(`\u53D7\u76CA\u4EBA${I+1}`),1),l(f,{name:"delete",onClick:B=>Oe(n)},{default:d(()=>[et]),_:2},1032,["onClick"])]),l(ne,{images:oe.value,"onUpdate:images":t[10]||(t[10]=B=>oe.value=B),"form-info":n,"factor-list":F.value.BENEFICIARY||[],prefix:`beneficiary-${I}`,"beneficiary-list":e.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList},null,8,["images","form-info","factor-list","prefix","beneficiary-list"])]))),128)),l(p,{onClick:_e},{default:d(()=>[tt]),_:1})])):W("",!0)]),_:1}),l(u,{title:"\u4FDD\u5355\u901A\u8BAF\u4FE1\u606F"},{default:d(()=>{var n;return[(n=Object.keys(c(J)))!=null&&n.length?(v(),b(C,{key:1,title:"\u5355\u5143\u683C","is-link":"",onClick:t[12]||(t[12]=I=>c(Y)(!0))},{title:d(()=>[i("div",rt,[i("p",null,[i("span",ot,R(c(J).contactName),1),i("span",at,R(c(J).contactPhoneNo),1)]),i("p",st,R(c(J).contactAddress),1)])]),_:1})):(v(),b(y,{key:0,activated:"",onClick:t[11]||(t[11]=I=>c(Y)(!0))},{default:d(()=>[nt]),_:1}))]}),_:1})]),_:1},512)),i("div",ut,[i("div",it,[i("div",dt,[lt,i("span",ct,"\uFFE5"+R((T=(O=(k=(U=(V=e.value.tenantOrderInsuredList)==null?void 0:V[0])==null?void 0:U.tenantOrderProductList)==null?void 0:k[0].premium)==null?void 0:O.toLocaleString)==null?void 0:T.call(O)),1)]),ft]),i("div",pt,[l(p,{block:"",type:"primary",onClick:Ie},{default:d(()=>[mt]),_:1})])]),c(K)?(v(),b(ze,{key:1,modelValue:c(h).currentAddress,"onUpdate:modelValue":t[13]||(t[13]=n=>c(h).currentAddress=n),show:c(K),"data-source":c(ae),onSubmit:ve,onClose:t[14]||(t[14]=n=>c(Y)(!1))},null,8,["modelValue","show","data-source"])):W("",!0)]}),_:1})}}});export{At as default};
