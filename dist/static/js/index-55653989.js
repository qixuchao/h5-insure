var fe=Object.defineProperty,_e=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var W=(u,d,l)=>d in u?fe(u,d,{enumerable:!0,configurable:!0,writable:!0,value:l}):u[d]=l,F=(u,d)=>{for(var l in d||(d={}))Q.call(d,l)&&W(u,l,d[l]);if(b)for(var l of b(d))X.call(d,l)&&W(u,l,d[l]);return u},A=(u,d)=>_e(u,ge(d));var Z=(u,d)=>{var l={};for(var g in u)Q.call(u,g)&&d.indexOf(g)<0&&(l[g]=u[g]);if(u!=null&&b)for(var g of b(u))d.indexOf(g)<0&&X.call(u,g)&&(l[g]=u[g]);return l};import{g as ke,a9 as ye,O as Pe,E as h,M as Ce,a6 as ve,_ as he,o as Ie,r as P,j as k,k as R,m as y,A as r,n as L,p as _,t as D,z as O,F as Ve,G as Le,J as De,C as E}from"./vendor-9d7eb2ed.js";import{P as $,a as ee}from"./index-2e038757.js";import{i as Oe,p as Re}from"./trial-b41ac9e0.js";import{c as Be}from"./createProposal-f1da47cc.js";import{_ as Te,n as Ne,b as be,E as Fe,e as Ee}from"./index-5c1c07a2.js";import{u as Ae}from"./useStorage-428bb0e9.js";import{b as xe,a as Se}from"./trial-8551dd94.js";import"./useDicData-941ad571.js";const qe={key:0,class:"part-card"},je={key:1,class:"part-card"},Me={class:"risk-content"},Ue={key:0,class:"risk"},we={key:1,class:"plan-risk"},Ye={class:"footer-bar van-safe-area-bottom"},Je={class:"trial-result"},ze=E("\u603B\u4FDD\u8D39"),Ge={class:"result-num"},He={class:"trial-operate"},Ke={key:0,class:"retrial-tip"},We=E(" \u6761\u4EF6\u66F4\u6539\u540E\uFF0C\u9700\u8981\u91CD\u65B0\u8BD5\u7B97 "),Qe=E("\u53BB\u8BD5\u7B97"),Xe=E("\u7ACB\u5373\u6295\u4FDD"),Ze=ke({setup(u){var Y,J;const d=ye(),l=Pe(),{agentCode:g="test",agencyCode:te="",tenantId:x=9991000007,insurerCode:ae="99",proposalId:C,saleChannelId:ie}=l.query;let{productCode:S="MMBBSF",templateId:q=1}=l.query;const B=h({personVO:{occupationCodeList:[]}}),T=h({insuredCode:"",personVO:{occupationCodeList:[]}}),v=h({}),j=h({}),M=h({}),I=h(null),U=h({}),e=Ce({currentPlan:"",riskBaseInfo:{},holderFactor:[],insuredFactor:[],riskData:[],riskPlanData:[],trialResult:{},canTrial:!0,retrialTip:!1,enumList:{},ageRange:[],collapseName:["1"],insuredRiskList:[],currentRiskList:[]});if(C)try{S=(J=JSON.parse(((Y=l.query)==null?void 0:Y.extInfo)||"{}"))==null?void 0:J.productCenterCode}catch(i){console.log(i)}ve("premium",U.value),Ae().get("userInfo");const oe="premiumTrial",re=()=>{e.retrialTip=!1},se=(i,a)=>{e.insuredRiskList=i.map(t=>{var s,n;return{initialAmount:(s=a[t.riskCode])==null?void 0:s.amount,amountUnit:1,annuityDrawFrequency:t.annuityDrawDate,annuityDrawType:t.annuityDrawType,paymentFrequency:t.paymentFrequency,paymentPeriod:t.chargePeriod.split("_")[1],paymentPeriodType:xe[t.chargePeriod.split("_")[0]],insurancePeriodType:Se[t.coveragePeriod==="to_life"?"to_life":t.coveragePeriod.split("_")[0]],insurancePeriodValue:Number.isNaN(+t.coveragePeriod.split("_")[1])?0:t.coveragePeriod.split("_")[1],riskCode:t.riskCode,riskType:t.riskType,riskName:t.riskName,extInfo:{riskId:t.riskId,copy:t.copy},initialPremium:(n=a[t.riskCode])==null?void 0:n.premium,liabilityDetails:t.liabilityVOList.map(o=>({liabilityCode:o.liabilityCode,liabilityName:o.liabilityName,refundMethod:o.liabilityAttributeValue})),productId:e.riskBaseInfo.id}})},ne=()=>{Ne({agencyId:te,saleUserId:g,saleChannelId:ie,tenantId:x,venderCode:e.riskBaseInfo.insurerCode,orderDataSource:1,proposalId:C,extInfo:{templateId:+(q||1),pageCode:oe,iseeBizNo:window.iseeBiz},tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{extInfo:{},tenantOrderProductList:[{productCode:e.riskBaseInfo.productCode||"",productName:e.riskBaseInfo.productName||"",premium:e.trialResult.premium||0,tenantOrderRiskList:e.insuredRiskList}]}]}).then(({code:i,data:a})=>{i==="10000"&&a.pageAction.pageAction==="jumpToPage"&&d.push({path:be[a.pageAction.data.nextPageCode],query:A(F({insurerCode:e.riskBaseInfo.insurerCode},l.query),{orderNo:a.pageAction.data.orderNo})})})},le=i=>{Ee({productCategory:i,venderCode:ae}).then(a=>{var t;a.code==="10000"&&(q=(t=a.data)==null?void 0:t.id)})},ue=()=>{const i=JSON.parse(JSON.stringify(v.value[e.currentPlan])),a=Object.values(i).find(s=>s.riskType===1),t=Object.values(i).map(s=>{const n=s;if(n.chargePeriod==="3"){const o=(a.chargePeriod||"").split("_");o[1]&&(o[1]-=1),n.chargePeriod=o.join("_")}return n.liabilityVOList=(n.liabilityVOList||[]).filter(o=>o.optionalFlag===1||o.liabilityAttributeValue&&o.liabilityAttributeValue!=="-1").map(o=>{const p=o;return p.liabilityAttributeValue==="0"&&(p.liabilityAttributeValue=""),p}),n}),c={holder:B.value,productCode:e.riskBaseInfo.productCode,insuredVOList:[A(F({},T.value),{productPlanVOList:[{planCode:e.currentPlan||"",insurerCode:e.riskBaseInfo.insurerCode,riskVOList:t}]})]};Re(F({},c)).then(({code:s,data:n})=>{if(s==="10000"){e.retrialTip=!1,e.trialResult=n,e.canTrial=!1;const o={},p=(V=[])=>{(V||[]).forEach(m=>{var N;o[m.riskCode]=m,((N=m.riskPremiumDetailVOList)==null?void 0:N.length)&&p(m.riskPremiumDetailVOList)})};p(n.riskPremiumDetailVOList),se(c.insuredVOList[0].productPlanVOList[0].riskVOList,o),Object.assign(U.value,o)}})},ce=()=>{var i,a,t,c,s;Promise.all([(a=(i=j.value)==null?void 0:i.validateForm)==null?void 0:a.call(i),(c=(t=M.value)==null?void 0:t.validateForm)==null?void 0:c.call(t),(s=I.value)==null?void 0:s.validate()]).then(()=>{ue()},n=>{var o;(n==null?void 0:n.length)&&((o=I==null?void 0:I.value)==null||o.scrollToField(n[0].name))})},de=()=>{Fe({dictCodeList:["RISK_PAYMENT_PERIOD","RISK_INSURANCE_PERIOD"]}).then(({code:a,data:t})=>{if(a==="10000"){const c={};t.forEach(s=>{c[s.dictCode]=s.dictItemList}),e.enumList=c}})},pe=i=>{Be({id:C,tenantId:x}).then(({code:a,data:t})=>{var c;if(a==="10000"){const s=((c=t.proposalInsuredList)==null?void 0:c[0])||{},{proposalInsuredProductList:n=[]}=s,o=Z(s,["proposalInsuredProductList"]);Object.assign(B.value.personVO,t.proposalHolder);const p=n.find(m=>m.productId===i);Object.assign(T.value.personVO,o,{occupationCodeList:(p==null?void 0:p.occupationCodeList)||[]});const V={};((p==null?void 0:p.proposalProductRiskList)||[]).forEach(m=>{V[m.riskId]=m}),Object.assign(v.value,{0:V})}})},me=()=>{Oe({productCode:S,source:C?2:1}).then(({code:i,data:a})=>{var t;i==="10000"&&(e.riskBaseInfo=a.productBasicInfoVO,(a.productRelationPlanVOList.length?a.productRelationPlanVOList:a.productRiskVoList[0].riskDetailVOList||[]).forEach((c,s)=>{s===0&&(e.currentPlan=c.planCode||"0"),C||Object.assign(v.value,{[c.planCode||s]:{}})}),C&&le(e.riskBaseInfo.productCategory),e.riskData=((t=a.productRiskVoList[0])==null?void 0:t.riskDetailVOList)||[],e.riskPlanData=a.productRelationPlanVOList||[],C&&pe(a.productBasicInfoVO.id))}).finally(()=>{})},w=i=>{e.holderFactor=i.holderFactorList,e.insuredFactor=i.insuredFactorList,e.ageRange=i.ageRange};return he([()=>v.value,()=>B.value,()=>T.value],i=>{i&&!e.canTrial&&(e.canTrial=!0,e.retrialTip=!0)},{deep:!0}),Ie(()=>{me(),de()}),(i,a)=>{const t=P("ProTitle"),c=P("VanForm"),s=P("ProTabButton"),n=P("VanTab"),o=P("VanTabs"),p=P("van-collapse-item"),V=P("van-collapse"),m=P("VanButton"),N=P("ProPageWrap");return k(),R(N,{class:"page-trial-wrapper"},{default:y(()=>{var z,G,H;return[r(e).holderFactor.length?(k(),L("div",qe,[_(t,{title:"\u6295\u4FDD\u4EBA"}),_($,{ref_key:"holderRef",ref:j,"insured-code":(z=r(e).riskBaseInfo)==null?void 0:z.insurerCode,"form-info":B.value.personVO,"factor-list":r(e).holderFactor,"age-range":r(e).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):D("",!0),r(e).insuredFactor.length?(k(),L("div",je,[_(t,{title:"\u88AB\u4FDD\u4EBA"}),_($,{ref_key:"insuredRef",ref:M,"insured-code":(G=r(e).riskBaseInfo)==null?void 0:G.insurerCode,"form-info":T.value.personVO,"factor-list":r(e).insuredFactor,"age-range":r(e).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):D("",!0),O("div",Me,[_(V,{modelValue:r(e).collapseName,"onUpdate:modelValue":a[1]||(a[1]=f=>r(e).collapseName=f)},{default:y(()=>[_(p,{name:"1"},{title:y(()=>[_(t,{title:"\u6295\u4FDD\u65B9\u6848"})]),default:y(()=>[r(e).riskData.length&&v.value[0]?(k(),L("div",Ue,[_(c,{ref_key:"riskFormRef",ref:I,"input-align":"right","error-message-align":"right"},{default:y(()=>[_(ee,{"risk-info":v.value[0],enums:r(e).enumList,"origin-data":r(e).riskData,"pick-factor":w},null,8,["risk-info","enums","origin-data"])]),_:1},512)])):D("",!0),r(e).riskPlanData.length?(k(),L("div",we,[_(c,{ref_key:"riskFormRef",ref:I,"input-align":"right","error-message-align":"right"},{default:y(()=>[_(o,{active:r(e).currentPlan,"onUpdate:active":a[0]||(a[0]=f=>r(e).currentPlan=f)},{default:y(()=>[(k(!0),L(Ve,null,Le(r(e).riskPlanData,f=>(k(),R(n,{key:f.planCode,name:f.planCode,title:f.planName},{title:y(()=>[_(s,{title:f.planName,active:r(e).currentPlan===f.planCode},null,8,["title","active"])]),default:y(()=>{var K;return[f.planCode===r(e).currentPlan?(k(),R(ee,{key:0,"risk-info":v.value[f.planCode],enums:r(e).enumList,"origin-data":(K=f.productRiskVoList)==null?void 0:K[0].riskDetailVOList,"pick-factor":w},null,8,["risk-info","enums","origin-data"])):D("",!0)]}),_:2},1032,["name","title"]))),128))]),_:1},8,["active"])]),_:1},512)])):D("",!0)]),_:1})]),_:1},8,["modelValue"])]),O("div",Ye,[O("span",Je,[ze,O("span",Ge,De((r(e).retrialTip?0:((H=r(e).trialResult)==null?void 0:H.premium)||0).toLocaleString("hanidec",{style:"currency",currency:"CNY"})),1)]),O("div",He,[r(e).retrialTip?(k(),L("div",Ke,[We,O("span",{class:"close-icon",onClick:re})])):D("",!0),r(e).canTrial?(k(),R(m,{key:1,type:"primary",onClick:ce},{default:y(()=>[Qe]),_:1})):(k(),R(m,{key:2,type:"primary",onClick:ne},{default:y(()=>[Xe]),_:1}))])])]}),_:1})}}});var lt=Te(Ze,[["__scopeId","data-v-4783d582"]]);export{lt as default};
