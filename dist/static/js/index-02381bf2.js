import{t as $}from"./theme-ea709837.js";import{h as A,G as r,z as C,$ as F,Y as E,r as u,k as i,m as d,n as b,s as I,v as L,A as x,B as n,E as N,L as D}from"./vendor-3a8faf02.js";const U={class:"item"},M={class:"footer"},G=A({props:{show:{type:Boolean,default:!1},contentList:{type:Array,default:()=>[]},activeIndex:{type:Number,default:0},text:{type:String,default:""},beforeReadOverText:{type:String,default:"\u540C\u610F\uFF0C\u4E0B\u4E00\u6761"},forceReadCound:{type:Number,default:0}},emits:["update:show","submit","onCloseFilePreview"],setup(h,{emit:_}){const a=h,c=r(a.show),w=r(!0),l=r(a.contentList.map((e,o)=>({...e,disabled:!0,readDisabled:!0}))),t=r(a.activeIndex),v=r(0),k=r(null),R=C(()=>{var e,o;return(o=(e=l.value)==null?void 0:e[t.value])==null?void 0:o.attachmentUri}),P=C(()=>{var e;return(e=l.value[t.value])==null?void 0:e.readDisabled}),V=C(()=>t.value>=a.forceReadCound-1||v.value>=a.forceReadCound?!1:v.value<a.forceReadCound?t.value!==a.forceReadCound-1:!1),H=()=>{t.value+=1},S=()=>{_("update:show",!1),_("submit")};F(()=>a,()=>{c.value=a.show,t.value=a.activeIndex},{deep:!0,immediate:!0});const T=e=>{var o,f,p;if(e){const m=((o=e.target)==null?void 0:o.scrollHeight)||e.scrollHeight,g=((f=e.target)==null?void 0:f.scrollTop)||e.scrollTop,y=((p=e.target)==null?void 0:p.clientHeight)||e.clientHeight;Math.floor(m-g-15)<=y&&w.value&&l.value[t.value].readDisabled&&(l.value[t.value].disabled=!1,l.value[t.value].readDisabled=!1,l.value[t.value+1].disabled=!1,v.value+=1)}};return F(()=>t.value,()=>{w.value=!1,a.show&&(v.value>=a.forceReadCound&&l.value.forEach(e=>{e.disabled=!1,e.readDisabled=!1}),setTimeout(()=>{w.value=!0},800)),E(()=>{setTimeout(()=>{T(k.value)},2e3)})},{immediate:!0}),(e,o)=>{const f=u("ProTab"),p=u("ProFilePreview"),m=u("VanButton"),g=u("van-config-provider"),y=u("ProPopup");return i(),d(y,{show:c.value,"onUpdate:show":o[1]||(o[1]=s=>c.value=s),class:"file-preview-popup-wrap",closeable:!1,onClose:o[2]||(o[2]=s=>_("onCloseFilePreview"))},{default:b(()=>[I(g,{"theme-vars":n($),class:"custom-provider"},{default:b(()=>[c.value?(i(),d(f,{key:0,active:t.value,"onUpdate:active":o[0]||(o[0]=s=>t.value=s),list:l.value.map((s,B)=>({title:s.attachmentName,disabled:B==t.value?!1:s.disabled||!1,slotName:`guarantee-${B}`})),class:"tab"},null,8,["active","list"])):L("",!0),x("div",{ref_key:"previewRef",ref:k,class:"list",onScroll:T},[x("div",U,[(i(),d(p,{key:n(R),content:n(R),type:"pdf","forbid-click":!0},null,8,["content"]))])],544),x("div",M,[n(V)?(i(),d(m,{key:0,disabled:n(P),type:"primary",block:"",round:"",onClick:H},{default:b(()=>[N(D(`${h.beforeReadOverText}(${t.value+1}/${h.forceReadCound})`),1)]),_:1},8,["disabled"])):(i(),d(m,{key:1,disabled:n(P),type:"primary",block:"",round:"",onClick:S},{default:b(()=>[N(D(a.text),1)]),_:1},8,["disabled"]))])]),_:1},8,["theme-vars"])]),_:1},8,["show"])}}});export{G as _};
