import{d as e,j as a,i as l,z as s,o as i,l as o,w as n,a as r,e as u,u as d,b as t,V as m,W as c,m as v,as as p,an as f,h,g as y,O as g,c as b,q as S,F as V,a8 as k,aa as j,bK as C,ap as q,am as x}from"./index-b7b909b3.js";import{a as _,b as L}from"./index-b19915a7.js";import{s as w,_ as I,R as U,t as F}from"./ProRenderFormWithCard.vue_vue_type_style_index_0_scoped_true_lang-6a9ab8dc.js";/* empty css              */import"./useDicData-93afb491.js";import{c as O}from"./format-b5e9d8b9.js";import{g as $,m as D}from"./trial-7c898340.js";import{p as E}from"./utils-6fc00a71.js";import{u as P}from"./useOrder-ae30aa2a.js";import{a as R}from"./constants-71331306.js";import"./keysIn-131bbce9.js";import"./isObjectLike-a9798079.js";import"./_getTag-0507d0b1.js";import"./debounce-6981b306.js";import"./index-b55a66af.js";import"./phoneVerify-6efdd32d.js";import"./merge-e7788e50.js";const N={class:"popup-container"},W={class:"popup-header"},z={class:"title"},A={class:"popup-body"},B=e({name:"checkCodePopup"}),K=e({...B,props:{show:{type:Boolean,default:!1},type:{default:"agent"},data:{default:()=>({})}},emits:["cancel","confirm"],setup(e,{emit:f}){const h=e,y=a((()=>h.show)),g=l({mobile:"",verifyCode:""}),b=a((()=>h.type)),S=l({holder:{type:"投保人",name:"",mobile:"",desc:""},agent:{type:"代理人",name:"李三",mobile:"13262278989",desc:"色卡上会计核算看回放独守空房还是空巅峰计划收款方"},insured:{type:"被保人",name:"",mobile:"",desc:""}}),V=()=>{f("cancel")},k=()=>{f("confirm")};return s([()=>h.data,h.type],(([e,a])=>{var l,s,i;e&&(Object.assign(S.value.holder,e.holder),Object.assign(S.value.insured,null==(l=null==e?void 0:e.insuredList)?void 0:l[0]),g.value.mobile=null==(i=null==(s=S.value)?void 0:s[`${h.type}`])?void 0:i.mobile)}),{immediate:!0,deep:!0}),(e,a)=>{const l=I,s=_,f=L,h=p;return i(),o(h,{show:d(y),"onUpdate:show":a[2]||(a[2]=e=>v(y)?y.value=e:null),class:"popup-check-mobile",closeable:!1,"close-on-click-overlay":!1},{default:n((()=>[r("div",N,[r("div",W,[r("span",{class:"clear-all",onClick:V}," 取消 "),r("span",z,u(`${S.value[d(b)].type}手机号验证`),1),r("span",{class:"close",onClick:k},"确认")]),r("div",A,[r("h3",null,u(`尊敬的${S.value[d(b)].type}:${S.value[d(b)].name}`),1),r("p",null,u(S.value[d(b)].desc),1),r("h3",null,u(`${S.value[d(b)].type}手机号验证 ${d(O)(S.value[d(b)].mobile||"")}`),1),t(f,{model:g.value},{default:n((()=>[m(t(l,{modelValue:g.value.mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>g.value.mobile=e),label:"被保人手机号",name:"mobile",maxlength:"11",required:""},null,8,["modelValue"]),[[c,!1]]),t(s,{modelValue:g.value.verifyCode,"onUpdate:modelValue":a[1]||(a[1]=e=>g.value.verifyCode=e),"related-name":"mobile",label:" ",maxlength:"6","input-align":"left",placeholder:"请输入验证码",name:"verifyCode","send-s-m-s-code":d(w),rules:""},null,8,["modelValue","send-s-m-s-code"])])),_:1},8,["model"])])])])),_:1},8,["show"])}}}),T=f([{label:"签名完成",value:1},{label:"去签名",value:2},{label:"认证失败，请联系内勤人员",value:3}]);const G={class:"page-verify-wrap"},H={key:0,class:"header"},J={class:"sign-list"},M={class:"inner-cell"},Q={class:"inner-cell"},X={class:"footer-button"},Y=e({name:"verify"}),Z=e({...Y,setup(e){const s=h(),u=y(),{orderNo:m,tenantId:c}=s.query,v=l(!1),p=l({holder:{},insuredList:[{}]}),f=P(),O=l(!1),N=l({sign:[],verify:[],scribing:""}),W=l({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{},verifyStatus:2},agent:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2}}),z=l("agent"),A=a((()=>e=>N.value.sign.includes(e)||N.value.verify.includes(e))),B=a((()=>e=>W.value[e].isSign||W.value[e].isVerify)),Y=a((()=>e=>W.value[e].isShareSign)),Z=e=>{z.value=e,O.value=!0},ee=()=>{O.value=!1},ae=()=>{let e="";e="agent"===z.value?R.agentSign:"holder"===z.value?(W.value[z.value].isVerify,R.holderSign):W.value[z.value].isVerify?R.checkFace:R.insuredSign,u.push({path:e,query:{...s.query,type:z.value}})};return g((()=>{(async()=>{let e={};await $({orderNo:m,tenantId:c}).then((({code:a,data:l})=>{var s;"10000"===a&&(Object.assign(f.value,l),p.value=l,e=E(l.insuredList[0].productList),W.value.agent.verifyStatus=l.extInfo.agentAuthFlag,W.value.holder.verifyStatus=l.holder.isCert,W.value.insured.verifyStatus=null==(s=l.extInfo.insured)?void 0:s[0].isCert)})),await D(e).then((({data:e,code:a})=>{if("10000"===a){const{signInfo:a}=F(e.productFactor);a.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((a=>{e.required&&N.value.sign.push(a.code),"1"===a.code?W.value.agent.isSign=!0:"2"===a.code?W.value.holder.isSign=!0:"3"===a.code?W.value.insured.isSign=!0:"4"===a.code?W.value.holder.isShareSign=!0:"5"===a.code&&(W.value.insured.isShareSign=!0)})),"customerFace"===e.name&&e.columns.forEach((a=>{e.required&&N.value.verify.push(a.code),"1"===a.code?W.value.holder.isVerify=!0:"2"===a.code&&(W.value.insured.isVerify=!0)}))}))}}))})()})),(e,a)=>{const l=j,s=C,u=q,m=x;return i(),b("div",G,[t(l),d(v)?(i(),b("div",H,[t(s,{type:"warning",content:"为保障您的合法权益，当前保单需要进行双录"})])):S("",!0),r("div",J,[d(B)("agent")?(i(),o(u,{key:0,title:"代理人签名",required:d(A)("agent"),"is-link":"",value:d(T)[d(W).agent.verifyStatus],onClick:a[0]||(a[0]=e=>Z("agent"))},null,8,["required","value"])):S("",!0),d(v)?(i(),o(d(L),{key:2,model:d(p)},{default:n((()=>[t(d(I),{modelValue:d(p).holder.mobile,"onUpdate:modelValue":a[3]||(a[3]=e=>d(p).holder.mobile=e),rules:[{pattern:new RegExp(d(U).isPhone)}],label:"投保人手机号",name:"holder.mobile",maxlength:"11",required:""},null,8,["modelValue","rules"]),t(d(_),{modelValue:d(p).holder.verifyCode,"onUpdate:modelValue":a[4]||(a[4]=e=>d(p).holder.verifyCode=e),"related-name":"holder.mobile",label:"验证码",maxlength:"6",name:"holder.verifyCode","send-s-m-s-code":d(w),rules:"",required:""},null,8,["modelValue","send-s-m-s-code"]),t(d(I),{modelValue:d(p).insuredList[0].mobile,"onUpdate:modelValue":a[5]||(a[5]=e=>d(p).insuredList[0].mobile=e),label:"被保人手机号",name:"insuredList.0.mobile",maxlength:"11",required:"",rules:[{pattern:new RegExp(d(U).isPhone)}]},null,8,["modelValue","rules"]),t(d(_),{modelValue:d(p).insuredList[0].verifyCode,"onUpdate:modelValue":a[6]||(a[6]=e=>d(p).insuredList[0].verifyCode=e),label:"验证码",maxlength:"6",name:"insuredList.0.verifyCode","related-name":"insuredList.0.mobile","send-s-m-s-code":d(w),required:""},null,8,["modelValue","send-s-m-s-code"])])),_:1},8,["model"])):(i(),b(V,{key:1},[d(B)("holder")?(i(),o(u,{key:0,title:"投保人签名",required:d(A)("holder")},{value:n((()=>[r("div",M,[d(Y)("holder")?(i(),o(u,{key:0,"is-link":"",value:"分享空签邀约"})):S("",!0),t(u,{"is-link":"",value:d(T)[d(W).holder.verifyStatus],onClick:a[1]||(a[1]=e=>Z("holder"))},null,8,["value"])])])),_:1},8,["required"])):S("",!0),d(B)("insured")?(i(),o(u,{key:1,title:"被保人签名",required:d(A)("insured")},{value:n((()=>[r("div",Q,[d(Y)("insured")?(i(),o(u,{key:0,"is-link":"",value:"分享空签邀约"})):S("",!0),t(u,{"is-link":"",value:d(T)[d(W).insured.verifyStatus],onClick:a[2]||(a[2]=e=>Z("insured"))},null,8,["value"])])])),_:1},8,["required"])):S("",!0)],64))]),r("div",X,[t(m,{type:"primary"},{default:n((()=>[k("下一步")])),_:1})]),t(K,{type:d(z),show:d(O),data:d(f),onCancel:ee,onConfirm:ae},null,8,["type","show","data"])])}}});export{Z as default};
