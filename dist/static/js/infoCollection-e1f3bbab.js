import{aI as e,cl as i,d as a,r as l,j as t,k as n,l as s,E as o,o as r,c as u,b as d,w as c,a as p,u as m,p as v,e as f,f as y,F as k,_ as g,bz as h,bA as V,am as I,bJ as b,ag as L,ap as C,g as O,ai as w,al as T,bF as R,bG as P,ao as S,aj as D,s as x,v as A,bi as F,b2 as N,aa as _,t as j,n as U,i as E,b0 as M,be as B,T as K,an as q,bD as $,bN as J,bO as H,a8 as G,bR as z,cm as Y,au as Q,bo as X,bp as Z,bB as W,bC as ee,aY as ie,ar as ae,bc as le,h as te,bf as ne,M as se,bj as oe,bk as re,a_ as ue,bl as de,aV as ce,aW as pe,q as me,cn as ve,a$ as fe,aX as ye}from"./index-0c89cc8e.js";import{_ as ke,P as ge}from"./PolicyInfo-1a24207d.js";import{h as he,f as Ve,u as Ie,b as be,j as Le,a as Ce,q as Oe,g as we,i as Te}from"./trial-49ea646a.js";import{_ as Re}from"./TrialButton-2836121d.js";import{n as Pe}from"./nextStep-3a619756.js";import{u as Se}from"./useAttachment-d0b36a1c.js";import{a as De,c as xe}from"./product-4a046682.js";import{g as Ae}from"./utils-3e3de049.js";import{u as Fe}from"./useOrder-bf5c3285.js";import{a as Ne,P as _e,B as je}from"./constants-6ad2f07c.js";import{t as Ue}from"./utils-7837bd2d.js";import{c as Ee}from"./cloneDeep-fa839c42.js";import{S as Me,g as Be,o as Ke}from"./index-6a6901fa.js";import{a as qe,B as $e}from"./infoCollection-5b1b1163.js";import{S as Je,I as He,a as Ge}from"./index-12a55afd.js";import{f as ze,m as Ye,g as Qe}from"./gender-bdd67324.js";import{L as Xe}from"./product-7bbf9c44.js";import{B as Ze}from"./index-a1729201.js";import{R as We}from"./trial-6a8af0f1.js";import"./index-e0b231a7.js";import"./format-31cde443.js";import"./core-f25b3948.js";import"./createProposal-ec6a5b08.js";import"./index-165cb9da.js";function ei(a){return function(a){return"number"==typeof a||e(a)&&"[object Number]"==i(a)}(a)&&a!=+a}const ii={key:0},ai={class:"custom-field"},li={key:1,class:"flex-field"},ti={class:"pro-radio-wrap"},ni={key:2},si={class:"pro-radio-wrap"},oi={class:"custom-field"},ri={key:1},ui={key:3},di={class:"custom-field"},ci={key:1},pi={class:"custom-field"},mi={key:0},vi={key:1},fi={key:4},yi=a({name:"BaoeBaofei"});var ki=g(a({...yi,props:{originData:{default:()=>({})},modelValue:{default:()=>({})},defalutValue:{default:()=>({})},trialResult:{default:()=>({})}},emits:["update:modelValue","trialChange"],setup(e,{emit:i}){const a=i,g=e,I=l({hadSetDefault:!1}),b=t(g.originData),L=t(g.modelValue),C=t(0),O=()=>2===b.value.saleMethod?{label:"保费",key:"initialPremium"}:{label:"保额",key:"initialAmount"},w=()=>{switch(`${b.value.displayUnit}`){case qe.YUAN:return"元";case qe.MONTH_SALARY:return"倍月薪";case qe.MILLION:return"万元";case qe.COPY:return"份"}return""},T=n((()=>2===b.value.saleMethod?{label:"保费",key:"initialPremium"}:{label:"保额",key:"initialAmount"})),R=(...e)=>{if(1===C.value){const e=L.value[T.value.key],i=g.originData.minStepValue,a=g.originData.maxStepValue,l=g.originData.stepValue;if(+e>=+a)L.value[T.value.key]=a;else if(+e<=+i)L.value[T.value.key]=i;else{const a=+e-+i,t=Math.floor(a/+l);a%+l!=0&&(L.value[T.value.key]=+i+t*+l)}}return!0},P=()=>{const{displayType:e,requireCopies:i}=b.value,a=O().key,l=!L.value.riskCode;1===e?C.value=1:3===e&&2===i?(C.value=2,b.value.displayValues.length>=1&&l&&!L.value[a]&&(L.value[a]=b.value.displayValues[0].code||b.value.displayValues[0].value)):3===e&&1===i?(C.value=3,b.value.minCopiesValue===b.value.maxCopiesValue&&l&&!L.value.copy&&(L.value.copy=b.value.minCopiesValue),b.value.displayValues.length>=1&&l&&!L.value[a]&&(L.value[a]=b.value.displayValues[0].code||b.value.displayValues[0].value)):2===e&&(C.value=4,b.value.minCopiesValue===b.value.maxCopiesValue&&l&&!L.value.copy&&(L.value.copy=b.value.minCopiesValue),l&&!L.value.initialAmount&&(L.value.initialAmount=b.value.copiesAmount))},S=n((()=>{if(b.value.displayValues){const e=O().key;return 1!==b.value.displayValues.length||L.value.riskCode||(L.value[e]=b.value.displayValues[0].code),b.value.displayValues.map((e=>({label:e.value,value:e.code})))}return[]})),D=()=>{};return s((()=>{P(),a("update:modelValue",L.value)})),o((()=>b),(e=>{P()}),{deep:!0}),o((()=>g.defalutValue),(e=>{(null==e?void 0:e.riskCode)&&!I.hadSetDefault&&(I.hadSetDefault=!0,L.value={...L.value,initialAmount:e.initialAmount,initialPremium:e.initialPremium,copy:e.copy})}),{deep:!0,immediate:!0}),o((()=>L.value),(e=>{(()=>{if(1===C.value){const e=L.value[T.value.key],i=g.originData.minStepValue,a=g.originData.maxStepValue,l=g.originData.stepValue;if(+e>+a)return!1;if(+e<+i)return!1;if((+e-+i)%+l!=0)return!1}return!0})()&&(a("update:modelValue",e),a("trialChange",e))}),{deep:!0,immediate:!0}),(e,i)=>{const a=Me,l=h,t=V;return r(),u(k,null,[1===C.value?(r(),u("div",ii,[d(l,{label:`基本${m(T).label}`,name:m(T).key,class:"risk-select-field"},{input:c((()=>[p("div",ai,[d(a,{modelValue:L.value[m(T).key],"onUpdate:modelValue":i[0]||(i[0]=e=>L.value[m(T).key]=e),"input-width":"80px","default-value":e.originData.minStepValue,min:e.originData.minStepValue,step:e.originData.stepValue,max:e.originData.maxStepValue,theme:"round",onBlur:R},null,8,["modelValue","default-value","min","step","max"])])])),_:1},8,["label","name"])])):2===C.value?(r(),u("div",li,[d(l,{modelValue:L.value[m(T).key],"onUpdate:modelValue":i[2]||(i[2]=e=>L.value[m(T).key]=e),label:`基本${m(T).label}`,name:m(T).key,class:"risk-select-field"},{input:c((()=>[p("div",ti,[d(t,{modelValue:L.value[m(T).key],"onUpdate:modelValue":i[1]||(i[1]=e=>L.value[m(T).key]=e),options:m(S),onclick:D},null,8,["modelValue","options"])])])),_:1},8,["modelValue","label","name"])])):3===C.value?(r(),u("div",ni,[d(l,{modelValue:L.value[m(T).key],"onUpdate:modelValue":i[4]||(i[4]=e=>L.value[m(T).key]=e),label:`基本${m(T).label}`,name:m(T).key,class:"risk-select-field"},{input:c((()=>[p("div",si,[d(t,{modelValue:L.value[m(T).key],"onUpdate:modelValue":i[3]||(i[3]=e=>L.value[m(T).key]=e),options:m(S),onclick:D},null,8,["modelValue","options"])])])),_:1},8,["modelValue","label","name"]),p("div",null,[d(l,{modelValue:L.value.copy,"onUpdate:modelValue":i[6]||(i[6]=e=>L.value.copy=e),label:"份数",name:"copy",class:"risk-select-field"},{input:c((()=>[p("div",oi,[e.originData.minCopiesValue!==e.originData.maxCopiesValue?(r(),v(a,{key:0,modelValue:L.value.copy,"onUpdate:modelValue":i[5]||(i[5]=e=>L.value.copy=e),"input-width":"80px","default-value":e.originData.minCopiesValue,min:e.originData.minCopiesValue||1,step:1,max:e.originData.maxCopiesValue,theme:"round"},null,8,["modelValue","default-value","min","max"])):(r(),u("span",ri,f(e.originData.minCopiesValue),1))])])),_:1},8,["modelValue"])])])):4===C.value?(r(),u("div",ui,[d(l,{modelValue:L.value.copy,"onUpdate:modelValue":i[8]||(i[8]=e=>L.value.copy=e),label:"份数",name:"copy",class:"risk-select-field"},{input:c((()=>[p("div",di,[e.originData.minCopiesValue!==e.originData.maxCopiesValue?(r(),v(a,{key:0,modelValue:L.value.copy,"onUpdate:modelValue":i[7]||(i[7]=e=>L.value.copy=e),"input-width":"64px","default-value":e.originData.minCopiesValue,min:e.originData.minCopiesValue||1,step:1,max:e.originData.maxCopiesValue,theme:"round"},null,8,["modelValue","default-value","min","max"])):(r(),u("span",ci,f(e.originData.minCopiesValue),1))])])),_:1},8,["modelValue"]),d(l,{label:m(T).label,name:"copyAmount",class:"risk-select-field"},{input:c((()=>[p("div",pi,[e.originData.minCopiesValue!==e.originData.maxCopiesValue?(r(),u("span",mi,f(+e.originData.copiesAmount*+L.value.copy+w()),1)):(r(),u("span",vi,f(+e.originData.minCopiesValue*+e.originData.copiesAmount+w()),1))])])),_:1},8,["label"])])):y("",!0),2===b.value.saleMethod&&e.trialResult&&e.trialResult.initialAmount>0?(r(),u("div",fi,[d(l,{label:"保额",class:"risk-select-field"},{input:c((()=>[p("span",null,f(e.trialResult.initialAmount),1)])),_:1})])):y("",!0)],64)}}}),[["__scopeId","data-v-3a02f6d0"]]);const gi=a({name:"BeneficiaryItem"});var hi=g(a({...gi,props:{modelValue:{default:()=>({})},schema:{default:()=>[]},config:{default:()=>({})},isView:{type:Boolean,default:!1},isTrial:{type:Boolean,default:!1},title:{default:"受益人"}},emits:["update:modelValue","trailChange"],setup(e,{expose:i,emit:a}){const n=a,s=t(null),u=e,d=l({validated:!1,schema:[],config:{},personVO:{}});return o((()=>u.config),(e=>{e&&Object.assign(d.config,e)}),{deep:!0,immediate:!0}),o((()=>u.schema),(e=>{e&&Object.assign(d.schema,Ee(u.schema))}),{deep:!0,immediate:!0}),o((()=>u.modelValue),((e,i)=>{JSON.stringify(e)!==JSON.stringify(i)&&(I("受益人数据变动了"),Object.assign(d.personVO,e))}),{deep:!0,immediate:!0}),o((()=>d.personVO),(e=>{e&&n("update:modelValue",e)}),{deep:!0,immediate:!0}),o((()=>{var e;return null==(e=d.personVO)?void 0:e.relationToInsured}),((e,i)=>{if(e===i)return!1;I("受益人与被保险人关系变动了");const{certType:a}=d.personVO||{},[l,t]=b(d.schema,{certType:a,relationToHolder:e});return L(d.config,t),!u.isView&&e&&i&&Object.assign(d.personVO,{...C(d.personVO,(e=>!(l&&"certType"===e))),relationToInsured:e}),!1}),{immediate:!0}),i({validate:e=>P(s,u.trialFactorCodes,e),validateTrialFields:()=>R({personVO:d.personVO,trialFactorCodes:u.trialFactorCodes})}),(e,i)=>(r(),v(m(T),{ref_key:"formRef",ref:s,class:"personal-info-card",title:e.title,model:m(d).personVO,schema:m(d).schema,config:m(d).config,"is-view":e.isView,"extra-provision":{objectType:m(w).BENEFICIARY,objectId:m(d).personVO.id}},{cardTitleExtra:c((()=>[O(e.$slots,"default",{},void 0,!0)])),_:3},8,["title","model","schema","config","is-view","extra-provision"]))}}),[["__scopeId","data-v-2aea9f62"]]);const Vi=["onClick"],Ii=a({name:"InsuredItem"});var bi=g(a({...Ii,props:{modelValue:{default:()=>({})},title:{default:""},holderPersonVO:{},schema:{default:()=>[]},config:{default:()=>({})},isView:{type:Boolean,default:!1},isTrial:{type:Boolean,default:!1},trialFactorCodes:{default:()=>[]},multiBeneficiaryMaxNum:{default:null},beneficiaryList:{default:()=>[]},beneficiarySchema:{default:()=>[]}},emits:["update:modelValue","update:beneficiaryList"],setup(e,{expose:i,emit:a}){const s=a,p=t(null),f=t(null),g=t(null),h={schema:[],trialFactorCodes:[],config:{},personVO:{}},V=e,j=l({validated:!1,schema:[],config:{},personVO:{},beneficiaryTypeSchemaList:[],beneficiarySchemaList:[],beneficiaryList:[]}),U=()=>{j.beneficiaryList.push(Ee({...h,nanoid:D(),schema:V.beneficiarySchema}))},E=n((()=>!V.multiBeneficiaryMaxNum||j.beneficiaryList.length<V.multiBeneficiaryMaxNum)),M=n((()=>!j.schema.filter((e=>{var i;return!(e.hidden||(null==(i=j.config[e.name])?void 0:i.hidden))})).length)),B=n((()=>j.schema.filter((e=>e.isSelfInsuredNeed)).map((e=>e.name)))),K=n((()=>S(V.beneficiarySchema))),q=n((()=>{var e;return String(null==(e=j.personVO)?void 0:e.insuredBeneficiaryType)===$e.SPECIFY}));return o((()=>V.holderPersonVO),(e=>{var i;I("------投保人信息变动了-----");const{id:a,...l}=e||{};if("1"===String(null==(i=j.personVO)?void 0:i.relationToHolder)){const e=S(B.value)?Object.keys(l).reduce(((e,i)=>([...B.value,"occupationClass"].includes(i)&&!["birthday","age","gender"].includes(i)||(e[i]=l[i]),e)),{}):l;Object.assign(j.personVO,e)}}),{deep:!0,immediate:!0}),o((()=>V.beneficiarySchema),(e=>{j.beneficiarySchemaList=S(e)?e.filter((e=>"insuredBeneficiaryType"!==e.name)):[],j.beneficiaryTypeSchemaList=S(e)?e.filter((e=>"insuredBeneficiaryType"===e.name)):[]}),{deep:!0,immediate:!0}),o(q,((e,i)=>{String(e)!==String(i)&&(I("受益人类型关系变动了"),e?!S(j.beneficiaryList)&&U():j.beneficiaryList=[])}),{immediate:!0}),o((()=>Ee(j.beneficiaryList).map((e=>({personVO:e.personVO,nanoid:e.nanoid})))),((e,i)=>{JSON.stringify(e)!==JSON.stringify(i)&&s("update:beneficiaryList",e)}),{deep:!0,immediate:!0}),o((()=>{var e;return null==(e=j.personVO)?void 0:e.relationToHolder}),((e,i)=>{if(!e)return;I("与投保人关系变动了");const{personVO:a,schema:l=[],config:t}=j||{},{id:n,...s}=V.holderPersonVO||{},o="1"===String(a.relationToHolder),[r,u]=b(l,a);if(L(t,u),l.forEach((e=>{e.relationToHolder=a.relationToHolder,e.hidden=!e.isSelfInsuredNeed&&o})),!V.isView&&i&&String(e)!==String(i)){let e={...a,...s};o||(e={...C(a,(e=>!(r&&"certType"===e))),relationToHolder:a.relationToHolder}),Object.assign(j.personVO,e)}}),{deep:!0}),o((()=>{var e;return null==(e=j.personVO)?void 0:e.relationToMainInsured}),((e,i)=>{if(!e)return;I("次被保险人与主被保险人关系变动了");const{personVO:a,schema:l=[],config:t}=j||{},{certType:n}=a||{},[s,o]=b(l,{certType:n,relationToHolder:e});L(t,o),!V.isView&&i&&String(e)!==String(i)&&Object.assign(j.personVO,{...C(a,(e=>!(s&&"certType"===e))),relationToMainInsured:a.relationToMainInsured})})),o((()=>V.config),(e=>{e&&Object.assign(j.config,e)}),{deep:!0,immediate:!0}),o((()=>V.schema),((e,i)=>{e&&JSON.stringify(e)!==JSON.stringify(i)&&Object.assign(j.schema,Ee(e))}),{deep:!0,immediate:!0}),o((()=>V.modelValue),((e,i)=>{if(JSON.stringify(e)!==JSON.stringify(i)){const{beneficiaryList:i,...a}=e;L(j.personVO,a)}}),{deep:!0,immediate:!0}),o((()=>Ee(V.beneficiaryList)),((e,i)=>{JSON.stringify(e)!==JSON.stringify(i)&&(j.beneficiaryList=S(e)?e.map((e=>({...e,nanoid:e.nanoid||D()}))):[])}),{deep:!0,immediate:!0}),o((()=>j.personVO),(e=>{e&&s("update:modelValue",e)}),{deep:!0,immediate:!0}),i({validate:e=>{var i;return Promise.all([P(p,V.trialFactorCodes,e),P(f,[],e),...(null==(i=g.value)?void 0:i.map((i=>i.validate(e))))||[]])},validateTrialFields:()=>R({personVO:j.personVO,trialFactorCodes:V.trialFactorCodes})}),(e,i)=>{const a=N,l=_;return r(),u(k,null,[d(m(T),{ref_key:"insuredFormRef",ref:p,class:"personal-info-card",title:m(M)?"":e.title,model:m(j).personVO,schema:m(j).schema,config:m(j).config,"is-view":e.isView,"extra-provision":{objectType:m(w).INSURED,objectId:m(j).personVO.id}},{cardTitleExtra:c((()=>[O(e.$slots,"default",{},void 0,!0)])),_:3},8,["title","model","schema","config","is-view","extra-provision"]),m(K)?(r(),u(k,{key:0},[d(m(T),{ref_key:"beneficiaryTypeFormRef",ref:f,class:"personal-info-card",title:"受益人",model:m(j).personVO,schema:m(j).beneficiaryTypeSchemaList,"is-view":e.isView},null,8,["model","schema","is-view"]),m(q)?(r(),u(k,{key:0},[(r(!0),u(k,null,x(m(j).beneficiaryList,((i,l)=>(r(),v(hi,{ref_for:!0,ref_key:"beneficiaryFormRef",ref:g,key:`${i.nanoid}_${l}`,modelValue:i.personVO,"onUpdate:modelValue":e=>i.personVO=e,title:`受益人${l+1}`,schema:m(j).beneficiarySchemaList,config:i.config,"is-view":e.isView},{default:c((()=>[O(e.$slots,"cardTitleExtraBenifit",{index:l},void 0,!0),l>0&&!e.isView?(r(),u("span",{key:0,class:"delete-button",onClick:e=>(e=>{F.confirm({message:"确定要删除该受益人吗？"}).then((()=>{j.beneficiaryList.splice(e,1)}))})(l)},[d(a,{name:"delete"})],8,Vi)):y("",!0)])),_:2},1032,["modelValue","onUpdate:modelValue","title","schema","config","is-view"])))),128)),!e.isView&&m(E)?(r(),u("span",{key:0,class:"add-button",onClick:U},[d(l,{name:"plus"}),A("添加受益人")])):y("",!0)],64)):y("",!0)],64)):y("",!0),O(e.$slots,"riskList",{},void 0,!0)],64)}}}),[["__scopeId","data-v-9d3bb960"]]);const Li={class:"customer-list-item"},Ci={class:"left"},Oi=["src"],wi={class:"left-item"},Ti={class:"name"},Ri={key:0,class:"cert-no"},Pi={class:"cert-type-name"},Si={key:1,class:"cert-no"},Di={class:"cert-type-name"},xi={key:0,class:"from-wx"},Ai=p("img",{class:"img-wx",alt:""},null,-1),Fi=a({__name:"item",props:{data:{type:Object,required:!1,default:()=>Object},disabled:{type:Boolean,required:!1,default:()=>!0}},emits:["on-delete","on-close"],setup(e,{emit:i}){const a=e,l=t(!1),n=i,{data:s,disabled:o}=j(a);return(e,i)=>{const a=Je;return r(),u("div",Li,[d(a,{disabled:m(o)},{default:c((()=>{var e,a,t,o,d,c,v,k;return[p("div",{class:U(["list-item",!0===l.value?"item-bg":""]),onClick:i[0]||(i[0]=e=>(e=>{l.value=!0,e.stopPropagation(),console.log("这里关闭弹窗",s.value),n("on-close",s.value)})(e))},[p("div",Ci,[p("div",null,[p("img",{src:m(s).gender?"1"===m(s).gender?m(ze):m(Ye):m(Qe),alt:"",class:"mf"},null,8,Oi)]),p("div",null,[p("div",wi,[p("div",Ti,f(m(s).name),1),(null==(a=null==(e=m(s))?void 0:e.certInfo[0])?void 0:a.certNo)&&1==+(null==(o=null==(t=m(s))?void 0:t.certInfo[0])?void 0:o.certType)?(r(),u("div",Ri,[A(f(m(s).certInfo[0].desensitizaCertNo)+" ",1),p("span",Pi,f(m(s).certInfo[0].certTypeName),1)])):y("",!0),(null==(c=null==(d=m(s))?void 0:d.certInfo[0])?void 0:c.certNo)&&1!=+(null==(k=null==(v=m(s))?void 0:v.certInfo[0])?void 0:k.certType)?(r(),u("div",Si,[A(f(m(s).certInfo[0].certNo)+" ",1),p("span",Di,f(m(s).certInfo[0].certTypeName),1)])):y("",!0)]),m(s).relative?(r(),u("div",xi,[Ai,A(" 微信客户 ")])):y("",!0)])])],2)]})),_:1},8,["disabled"])])}}});const Ni={class:"customer-list"},_i={key:0,class:"list-pr"},ji={key:1,class:"list-pr"};var Ui=g(a({__name:"index",props:{data:{type:Array,required:!0,default:()=>[]},type:{type:String,required:!0,default:()=>"firstLetter"},disabled:{type:Boolean,required:!1,default:()=>!0}},emits:["on-delete","on-close"],setup(e,{emit:i}){const a=e,l=i,{data:n,type:s,disabled:p}=j(a),f=t([]),y=t([]),g=e=>{l("on-delete",e)},h=e=>{l("on-close",e),console.log("这里关闭弹窗1111222----",e)};return o((()=>a.data),(()=>{n.value=a.data||[],console.log("data",n),f.value=n.value.filter((e=>!!(e.children&&Array.isArray(e.children)&&e.children.length>0))),y.value=f.value.map((e=>e.label))}),{immediate:!0,deep:!0}),(e,i)=>{const a=He,l=Ge;return r(),u("div",Ni,["firstLetter"===m(s)?(r(),u("div",_i,[d(l,{"highlight-color":"$zaui-brand","index-list":y.value,sticky:!1},{default:c((()=>[(r(!0),u(k,null,x(f.value,(e=>(r(),u(k,{key:e.label},[d(a,{index:`${e.label}`},null,8,["index"]),(r(!0),u(k,null,x(e.children,(e=>(r(),v(Fi,{key:e.agentCustomerId,data:e,disabled:m(p),onOnDelete:g,onOnClose:h},null,8,["data","disabled"])))),128))],64)))),128))])),_:1},8,["index-list"])])):(r(),u("div",ji,[(r(!0),u(k,null,x(m(n),(e=>(r(),v(Fi,{key:e.agentCustomerId,data:e,disabled:m(p),onOnDelete:g,onOnClose:h},null,8,["data","disabled"])))),128))]))])}}}),[["__scopeId","data-v-7f0e84c3"]]);const Ei=e=>(X("data-v-0eda3f00"),e=e(),Z(),e),Mi=["onClick"],Bi=["onClick"],Ki=["onClick"],qi={class:"search-bar"},$i=["src"],Ji={key:1,class:"empth"},Hi=[Ei((()=>p("p",null,[p("img",{src:"/static/png/empth-d7935dd7.png",class:"ig"})],-1))),Ei((()=>p("p",{class:"p1"},"暂时还没有客户哦～",-1)))],Gi=a({name:"PersonalInfo"});var zi=g(a({...Gi,props:{productFactor:{default:()=>({})},modelValue:{default:()=>({})},isTrial:{type:Boolean,default:!1},isView:{type:Boolean,default:!1},isOnlyHolder:{type:Boolean,default:!1},multiInsuredConfig:{}},emits:["update:modelValue","trailChange","trailValidateFailed","closeCustomerPopoup"],setup(e,{expose:i,emit:a}){const s=E(),f=M(),{isShare:g,saleChannelId:h}=s.query,V=a,C=t(null),j=t(null),U=e,X=l({count:0,slotProps:{},uniqKey:"",currentIndex:0,currentBenifitIndex:0,currentType:"",keyword:void 0,show:!1,list:[],config:{},trialValidated:!1,holder:{personVO:{},schema:[],trialFactorCodes:[],config:{}},beneficiarySchema:[],initInsuredIList:[],insured:[]}),Z=async e=>{var i,a;X.keyword;const l={pageNum:1,pageSize:999,queryBean:{keyword:X.keyword||""}},t=await he(l),n=[];Object.keys((null==(i=null==t?void 0:t.data)?void 0:i.customerMaps)||{}).forEach((e=>{var i;n.push({label:e,children:null==(i=null==t?void 0:t.data)?void 0:i.customerMaps[e]})})),X.list=n,X.count=null==(a=null==t?void 0:t.data)?void 0:a.count},W=()=>{Z(X.keyword)},ee=()=>{Z()},ie=n((()=>!U.isTrial||U.isOnlyHolder)),ae=(e,i,a)=>{X.currentType=e,"benifit"!==e?X.currentIndex=i:(X.currentIndex=i,X.currentBenifitIndex=a),X.uniqKey=D(),Z(),X.show=!0},le=()=>{setTimeout((()=>{X.show=!1}),300)},te=()=>"holder"===X.currentType?X.holder.schema.map((e=>e.name))||[]:"insured"===X.currentType?X.insured[X.currentIndex].schema.map((e=>e.name))||[]:"benifit"===X.currentType?X.beneficiarySchema.map((e=>e.name))||[]:void 0,ne=n((()=>{var e,i;return null==(i=null==(e=null==X?void 0:X.holder)?void 0:e.personVO)?void 0:i.name})),se=n((()=>{var e,i;return null==(i=null==(e=null==X?void 0:X.holder)?void 0:e.personVO)?void 0:i.gender})),oe=n((()=>{var e,i;return null==(i=null==(e=null==X?void 0:X.holder)?void 0:e.personVO)?void 0:i.birthday})),re=n((()=>{var e,i;return null==(i=null==(e=null==X?void 0:X.holder)?void 0:e.personVO)?void 0:i.certType})),ue=n((()=>{var e,i;return null==(i=null==(e=null==X?void 0:X.holder)?void 0:e.personVO)?void 0:i.certNo})),de=(e,i)=>{var a,l,t,n,s;console.log("convertCustomerData",e);const o=null==(a=null==e?void 0:e.contactInfo)?void 0:a.find((e=>"01"===e.contactType)),r=null==(l=null==e?void 0:e.contactInfo)?void 0:l.find((e=>"02"===e.contactType)),u=null==e?void 0:e.certInfo.filter((e=>"1"===e.certType)),d={name:null==e?void 0:e.name,gender:null==e?void 0:e.gender,birthday:null==e?void 0:e.birthday,mobile:(null==o?void 0:o.contactNo)||null,email:(null==r?void 0:r.contactNo)||null,certNo:(null==(t=u[0])?void 0:t.certNo)||null,certType:(null==(n=u[0])?void 0:n.certType)||null};console.log("insureKeys",te());const c=null==(s=te())?void 0:s.reduce(((e,i)=>d.hasOwnProperty(i)?{...e,[i]:d[i]}:e),{});return console.log("extractedObject===",c),console.log("state.holder.schema=====",X.holder.schema),c},ce=e=>{var i,a,l,t,n,s,o,r,u,d,c;if(X.show=!1,"holder"===X.currentType&&Object.assign((null==(i=null==X?void 0:X.holder)?void 0:i.personVO)||{},de(e)),"insured"===X.currentType){const i=null==(a=null==X?void 0:X.insured[X.currentIndex])?void 0:a.schema.some((e=>"relationToHolder"===e.name&&e.attributeValueList.some((e=>"1"===e.code)))),{name:n,gender:s,birthday:o,certType:r,certNo:u}=de(e);if(ne.value===n&&se.value===s&&oe.value===o&&re.value===r&&ue.value===u)return i?void Object.assign((null==(l=null==X?void 0:X.insured[X.currentIndex])?void 0:l.personVO)||{},{relationToHolder:"1"}):void K("与投保人关系未配置本人");Object.assign((null==(t=null==X?void 0:X.insured[X.currentIndex])?void 0:t.personVO)||{},de(e))}if("benifit"===X.currentType){const{name:i,gender:a,birthday:l,certType:t,certNo:p}=de(e);(null==(n=null==X?void 0:X.insured[X.currentIndex])?void 0:n.personVO.name)===i&&(null==(s=null==X?void 0:X.insured[X.currentIndex])?void 0:s.personVO.gender)===a&&(null==(o=null==X?void 0:X.insured[X.currentIndex])?void 0:o.personVO.birthday)===l&&(null==(r=null==X?void 0:X.insured[X.currentIndex])?void 0:r.personVO.certType)===t&&(null==(u=null==X?void 0:X.insured[X.currentIndex])?void 0:u.personVO.certNo)===p?K("指定受益人不可为被保险人本人"):Object.assign((null==(c=null==(d=null==X?void 0:X.insured[X.currentIndex])?void 0:d.beneficiaryList[X.currentBenifitIndex])?void 0:c.personVO)||{},de(e))}},pe=()=>{var e;const i=!j.value||(null==(e=j.value)?void 0:e.every((e=>e.validateTrialFields())));return(!C.value||R(X.holder))&&i},me=e=>{var i;return Promise.all([...(null==(i=j.value)?void 0:i.map((i=>i.validate(e))))||[],P(C,X.holder.trialFactorCodes,e)])},ve=e=>{const{productList:i,config:a,schema:l,trialFactorCodes:t,beneficiaryList:n,personVO:s,nanoid:o,...r}=e||{};return r},fe=()=>{const{length:e,[e-1]:i}=X.initInsuredIList;X.insured.push(Ee({...i,nanoid:D()}))},ye=n((()=>{const{multiInsuredMaxNum:e,multiInsuredSupportFlag:i}=X.config;return i&&(!e||X.insured.length<e)})),ke=n((()=>S(X.holder.schema))),ge=n((()=>X.insured.some((e=>S(e.schema))))),Ve=(e,i)=>S(e)?e.reduce(((e,a)=>(e[a]=i[a],e)),{}):{},Ie=(e,i,a={})=>!!S(e)&&JSON.stringify(Ve(e,i))!==JSON.stringify(Ve(e,a));return o((()=>{var e;return null==(e=X.holder.personVO)?void 0:e.certType}),((e,i)=>{if(`${e}`==`${i}`)return!1;I("投保人信息变动了====");const[a,l]=b(X.holder.schema,{certType:e});return L(X.holder.config,l),!1})),o([()=>{var e;return{...null==(e=X.holder)?void 0:e.personVO}},()=>X.insured.map((e=>{const{beneficiaryList:i,personVO:a}=e||{};return{...a,beneficiaryList:S(i)?i.map((e=>({...e.personVO}))):[]}}))],B(((e,i)=>{var a,l,t;const[n,s]=e,o=((e,i)=>{const a=Ie(X.holder.trialFactorCodes,e[0],i[0]),l=X.insured.some(((e,a)=>{var l;const{trialFactorCodes:t,personVO:n}=e;return Ie(t,n,null==(l=i[1])?void 0:l[a])}));return a||l})([n,s],i);I(`投被保险人信息变动了---${o}`);const{insuredList:r}=U.modelValue,u={holder:n,insuredList:s.map(((e,i)=>({...(null==r?void 0:r[i])||{},...e})))};if(X.config.isSpouseInsured){const[e,i]=s.map((e=>null==e?void 0:e.gender));if(e&&i&&String(e)===String(i))return K("被保险人性别与投保要求不符")}if(JSON.stringify(null==(a=null==s?void 0:s[0])?void 0:a.personVO),ve(null==(t=null==(l=U.modelValue)?void 0:l.insuredList)?void 0:t[0]),console.log("-------result = ",u),V("update:modelValue",u),!pe())return X.trialValidated=!1,V("trailValidateFailed",u);me(!0).then((()=>{X.trialValidated=!0,o&&!U.isOnlyHolder&&V("trailChange",u)})).catch((()=>{X.trialValidated=!1,V("trailValidateFailed",u)}))}),500),{deep:!0}),o([()=>U.productFactor,()=>U.isTrial],((e,i)=>{if(q(e,i)||!e[0])return!1;I("投被保险人要素变动了");const{insuredFactorCodes:a,holderFactorCodes:l}=$(J)||{},{holder:t,insured:n,beneficiary:s,config:o}=H(e[0],{isTrial:e[1],...U.multiInsuredConfig,insuredFactorCodes:a,holderFactorCodes:l});return Object.assign(X.holder,t),X.config=o,S(n)&&(X.initInsuredIList=n.map((e=>({...e,beneficiaryList:[]})))),X.beneficiarySchema=Ee((null==s?void 0:s.schema)||[]),!1}),{deep:!0,immediate:!0}),o((()=>{var e,i;return null==(i=null==(e=null==X?void 0:X.insured[X.currentIndex])?void 0:e.beneficiaryList[X.currentBenifitIndex])?void 0:i.personVO}),((e,i)=>{var a,l;(null==(l=null==(a=null==X?void 0:X.insured[X.currentIndex])?void 0:a.beneficiaryList[X.currentBenifitIndex])?void 0:l.personVO)&&(null==e?void 0:e.relationToInsured)!==(null==i?void 0:i.relationToInsured)&&(I("受益人关系变动了+++++"),X.insured[X.currentIndex].beneficiaryList[X.currentBenifitIndex].personVO={relationToInsured:null==e?void 0:e.relationToInsured})}),{deep:!0,immediate:!0}),o([()=>{const{holder:e,insuredList:i}=U.modelValue;console.log("表单数据",Ee(e));const a=S(i)?i.map((e=>({config:e.config,personVO:ve(e),beneficiaryList:S(e.beneficiaryList)?e.beneficiaryList.map((({config:e,...i})=>({config:e,personVO:ve(i)}))):[]}))):[];return[null==e?void 0:e.config,ve(e),a]},()=>X.config,()=>X.initInsuredIList],(([[e,i,a]])=>{I("投被保险人数据变动了"),Object.assign(X.holder.config,e),console.log("投保人数据===",Ee(X.holder.personVO),Ee(i)),console.log("投保人数据===",Ee(X.holder.personVO),Ee(i)),Object.assign(X.holder.personVO,i);const{length:l}=a||[],{length:t}=X.insured,{length:n,0:s={},[n-1]:o}=X.initInsuredIList,{multiInsuredMaxNum:r,multiInsuredMinNum:u,multiInsuredSupportFlag:d}=X.config,c=U.isView||l>t?Math.min(l,r):t||u;X.insured=Array.from({length:c}).reduce(((e,i,l)=>{const{personVO:t,config:n={},beneficiaryList:r}=(null==a?void 0:a[l])||{},u=Ee(0===l?s:o);return e[l]?L(e[l],{...Ee(u),personVO:t,config:n,beneficiaryList:r}):e[l]={...u,personVO:t,config:n,beneficiaryList:r,nanoid:D()},e}),X.insured)}),{deep:!0,immediate:!0}),o((()=>X.list),((e,i)=>{e&&(X.list=e)})),i({validate:me,validateTrialFields:pe,validateHolder:(...e)=>{var i;return null==(i=C.value)?void 0:i.validate(...e)},canTrail:()=>X.trialValidated}),(e,i)=>{const a=N,l=_,t=z,n=Y,s=Q;return r(),u(k,null,[m(ke)&&m(ie)?(r(),v(m(T),{key:0,ref_key:"holderFormRef",ref:C,title:"投保人信息",class:"personal-info-card",model:m(X).holder.personVO,schema:m(X).holder.schema,config:m(X).holder.config,"is-view":e.isView,"extra-provision":{objectType:m(w).HOLDER,objectId:m(X).holder.personVO.id}},{cardTitleExtra:c((()=>[m(g)||e.isView||e.isTrial||!m(f)?y("",!0):(r(),u("div",{key:0,class:"choose-customer",onClick:i[0]||(i[0]=e=>ae("holder",1,0))},[d(a,{name:"customer",color:"#333"}),A(" 选择老用户 ")]))])),_:1},8,["model","schema","config","is-view","extra-provision"])):y("",!0),m(ge)&&!e.isOnlyHolder?(r(),u(k,{key:1},[(r(!0),u(k,null,x(m(X).insured,((i,l)=>(r(),v(bi,G({ref_for:!0,ref_key:"insuredFormRef",ref:j,key:`${i.nanoid}_${l}`,modelValue:i.personVO,"onUpdate:modelValue":e=>i.personVO=e,"beneficiary-list":i.beneficiaryList,"onUpdate:beneficiaryList":e=>i.beneficiaryList=e,title:""+(m(X).insured.length>1?`被保险人${l+1}`:"被保险人信息"),"holder-person-v-o":m(X).holder.personVO},i,{"beneficiary-schema":m(X).beneficiarySchema,"is-view":e.isView,"multi-beneficiary-num":m(X).config.multiBeneficiaryMaxNum}),{riskList:c((()=>[O(e.$slots,"riskInfo",{insuredIndex:l},void 0,!0)])),cardTitleExtraBenifit:c((i=>[m(g)||e.isView||e.isTrial||!m(f)?y("",!0):(r(),u("div",{key:0,class:"choose-customer",onClick:e=>ae("benifit",l,null==i?void 0:i.index)},[d(a,{name:"customer",color:"#333"}),A(" 选择老用户 ")],8,Bi))])),default:c((()=>[1==+i.personVO.relationToHolder||m(g)||e.isView||e.isTrial||!m(f)?y("",!0):(r(),u("div",{key:0,class:"choose-customer",onClick:e=>ae("insured",l,0)},[d(a,{name:"customer",color:"#333"}),A(" 选择老用户 ")],8,Mi)),!e.isView&&l+1>m(X).config.multiInsuredMinNum?(r(),u("span",{key:1,class:"delete-button",onClick:e=>(e=>{F.confirm({message:"确定要删除该被保险人吗？"}).then((()=>{X.insured.splice(e,1)}))})(l)},[d(a,{name:"delete",color:"var(--van-primary-color)"})],8,Ki)):y("",!0)])),_:2},1040,["modelValue","onUpdate:modelValue","beneficiary-list","onUpdate:beneficiaryList","title","holder-person-v-o","beneficiary-schema","is-view","multi-beneficiary-num"])))),128)),!e.isView&&m(ye)?(r(),v(t,{key:0,class:"add-button-wrap"},{title:c((()=>[p("span",{class:"add-button",onClick:fe},[d(l,{name:"plus"}),A("添加被保险人")])])),_:1})):y("",!0)],64)):y("",!0),m(X).show?(r(),v(s,{key:2,round:!1,show:m(X).show,closeable:!1,onClose:le,onClosed:e.onClosePopupAfterAni},{default:c((()=>[p("div",qi,[d(n,{modelValue:m(X).keyword,"onUpdate:modelValue":i[1]||(i[1]=e=>m(X).keyword=e),placeholder:"客户 姓名/手机号",class:"icon-sercher",onSearch:W,onCancel:ee},{"left-icon":c((()=>[p("img",{src:m("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAAZlBMVEUAAAC0wNC1wdO/v/+zwNC0v9C0wM+0wNG2wdLCydm0wNC0wNC1wdCzwNC0wNC0wNC1wNC1v9G2wdS0wM+0wNC0wNCzwdG0wdCzwc+1wNK4wta6xtO1wdGzwNC0wc+1v9WzwdCzv89PygQeAAAAIXRSTlMA/DQE896qhEQLjvjX0cC5iUwk7Oamb2ZbKxkVf8d7GIfl18UPAAABK0lEQVRIx+1V25aDIAwkiEVUvNXe7G3z/z+5pKeHs2fJyqav7byIwwxJBKL64DUUi9ZL8V+1ti1gALRWqzwqjwBIoKevMvJ7j6SOAOzvq9nM8NQFPIezXkmngYewrA/jeKhLfLw2f6Y1GSB5p2PADokxE693LdB6x5/csSGudazhgrSa/lUVRcULpz8bMlRJXWQwZ8Yw0IxNeUvrDIyhDPzWMaVtAbFM+RMtZBUDS6FPCb3HAM3uJs3sE7oGRKNYGESoE3YXM2Wr2yVsHwxX3nANhl4cQVyD+CuJ90G407PwLOGX+LQK74MV3jjvRHcaYZJ0DcKmkPSldceSdL4yxsj2VpL7sdhER7Z7+5rKj47c/2FyNEoceUTHTckc0CmRA3BQEsetG5x6Z3wDxtkpoVPsMuQAAAAASUVORK5CYII="),alt:"",class:"search-icon-img",style:{width:"22px",height:"23px"}},null,8,$i)])),_:1},8,["modelValue"])]),m(X).count?(r(),v(Ui,{key:0,data:m(X).list,type:e.order,disabled:!1,onOnClose:ce},null,8,["data","type"])):(r(),u("div",Ji,Hi))])),_:1},8,["show","onClosed"])):y("",!0)],64)}}}),[["__scopeId","data-v-0eda3f00"]]);const Yi={class:"pro-radio-wrap"},Qi=a({name:"ProductKeys"});var Xi=g(a({...Qi,props:{originData:{default:()=>({})},modelValue:{default:()=>({})},riskInfo:{default:()=>({})},defaultValue:{default:()=>({})},useData:{default:()=>({})}},emits:["trialChange","inputChange"],setup(e,{emit:i}){const a=i,l=e,n=t(l.originData),f=t(l.modelValue);t(1);const g=e=>{const i=Be(l.originData,e),a=Be(l.originData,e);return i.map((e=>{const i=a?a.find((i=>i.code===e.code)):null;return{label:e.value,value:e.code,disabled:!(!i||null===i.useFlag||void 0===i.useFlag)&&1!==i.useFlag}}))},I=()=>{Ne.forEach((e=>{const i=Be(l.originData,e.configKey);"checkbox"===e.type&&i&&i.length>0&&!f.value.riskCode&&(f.value[e.valueKey]=i[0].code)}))};return s((()=>{I()})),o((()=>l.defaultValue),(e=>{(null==e?void 0:e.riskCode)&&(f.value=JSON.parse(JSON.stringify(e)))}),{deep:!0,immediate:!0}),o((()=>n.value),(e=>{I()}),{deep:!0,immediate:!0}),o((()=>JSON.stringify(f.value)),((e,i)=>{const t=e&&JSON.parse(e)||{};console.log("---v new = ",t);const n=i&&JSON.parse(i)||{};let s=null;Ne.forEach((e=>{t[e.valueKey]&&n[e.valueKey]&&t[e.valueKey]!==n[e.valueKey]&&(s||(s={key:e.valueKey,oldValue:n[e.valueKey],newValue:t[e.valueKey],riskCode:l.riskInfo.riskCode}))})),e&&a("trialChange",JSON.parse(e),s)}),{deep:!0,immediate:!0}),(e,i)=>{const a=V,l=h;return r(!0),u(k,null,x(m(Ne),(i=>(r(),u(k,null,[m(Be)(e.originData,i.configKey)&&(1===e.riskInfo.mainRiskFlag||i.ruleKey&&2===m(Be)(e.originData,i.ruleKey)||!i.ruleKey)?(r(),u("div",{key:e.riskInfo.riskCode+"_"+i.name},["checkbox"===i.type?(r(),v(l,{key:0,modelValue:f.value[i.valueKey],"onUpdate:modelValue":e=>f.value[i.valueKey]=e,label:i.name,name:i.valueKey,class:"risk-select-field"},{input:c((()=>[p("div",Yi,[d(a,{modelValue:f.value[i.valueKey],"onUpdate:modelValue":[e=>f.value[i.valueKey]=e,e=>((e,i)=>{console.log("-------change",e,i)})(e,i.valueKey)],options:g(i.configKey)},null,8,["modelValue","onUpdate:modelValue","options"])])])),_:2},1032,["modelValue","onUpdate:modelValue","label","name"])):y("",!0)])):y("",!0)],64)))),256)}}}),[["__scopeId","data-v-15c494f0"]]);const Zi={class:"com-risk-liabilityinfo"},Wi={class:"item-wrap"},ea={key:0},ia=(e=>(X("data-v-68f76c44"),e=e(),Z(),e))((()=>p("div",{class:"cell-content"},null,-1))),aa=a({name:"riskLiabilityInfo"});var la=g(a({...aa,props:{dataSource:{default:()=>({})},modelValue:{default:()=>({})},dataSourceFolmulate:{default:()=>({})},params:{default:()=>({amountUnit:"",basicsAmount:"",basicsPremium:"",riskId:""})},defaultValue:{default:()=>({})}},emits:["trialChange"],setup(e,{emit:i}){const a=i,l=e,f=t({formInfo:l.dataSource,isCheckList:[],checkValueList:[],liabilityList:[],signLiabilityClick:[]}),g=(e,i)=>{console.log("---click ",e,i),f.value.signLiabilityClick.push({item:e,index:i})},I=(e,i)=>{const{riskLiabilityInfoVOList:a,riskLiabilityCollocationVOList:t}=l.dataSource,n=a[e].liabilityId,s=(t||[]).find((e=>e.relatedLiabilityId===n||e.collocationLiabilityId===n))||{};let o=null;s.collocationLiabilityId===n?(o=s.relatedLiabilityId,s.collocationType===Xe.YI_LAI&&(o=s.collocationLiabilityId)):o=s.collocationLiabilityId;const r=a.findIndex((e=>e.liabilityId===o));((e,i,a)=>{f.value.isCheckList[e]===`${ie.YES}`?a===Xe.BANG_DING||a===Xe.YI_LAI?f.value.isCheckList[i]="1":f.value.isCheckList[i]="2":a===Xe.BANG_DING?f.value.isCheckList[i]="2":a===Xe.YI_LAI&&(f.value.isCheckList[i]=e!==i?"3":"2")})(e,r,s.collocationType),i(a[r],r,!0)},b=(e,i,a)=>{const l=f.value.liabilityList.map((e=>e.key)),t=0===(null==e?void 0:e.liabilityAttributeValueList.length)&&0===(null==e?void 0:e.formula.length),n=f.value.isCheckList[i];t&&-1===l.indexOf(i)&&n&&f.value.liabilityList.push({liabilityValue:e,key:i,isSwitchOn:f.value.isCheckList[i]}),"1"===n?g(e,i):f.value.signLiabilityClick.splice(i,1),-1!==l.indexOf(i)&&f.value.liabilityList.forEach((e=>{e.key===i&&(e.isSwitchOn=f.value.isCheckList[i])})),a||I(i,b)},L=(e,i)=>{const a=e.liabilityAttributeValueList.filter((e=>e.displayValue===f.value.checkValueList[i])),l=JSON.parse(JSON.stringify(a))[0]||e.liabilityAttributeValueList[0],t={...e,liabilityValue:l};f.value.liabilityList.length>0&&Object.keys(f.value.checkValueList).indexOf(i)&&(f.value.liabilityList=f.value.liabilityList.filter((e=>e.key!==i))),f.value.checkValueList[i]=l.displayValue,f.value.liabilityList.push({liabilityValue:t,key:i,isSwitchOn:"1"})},C=n((()=>Ee(l.dataSourceFolmulate))),O=(e,i,a)=>{1===a?f.value.liabilityList.push({liabilityValue:{...e,liabilityValue:null==e?void 0:e.liabilityAttributeValueList[0]},key:i,isSwitchOn:"1"}):f.value.liabilityList.push({liabilityValue:{...e,liabilityValue:null==e?void 0:e.liabilityAttributeValueList[0]},key:i,isSwitchOn:"2"})};o((()=>C.value),((e,i)=>{var a,t;const n=null==(a=l.dataSourceFolmulate)?void 0:a.initialAmount,s=null==(t=l.dataSourceFolmulate)?void 0:t.initialPremium,o={amountUnit:l.params.amountUnit,basicsAmount:n,basicsPremium:s,riskId:l.params.riskId};l.dataSource.riskLiabilityInfoVOList.map((async a=>{if(a.formula.length>0&&(n||s)&&((null==e?void 0:e.initialAmount)!==(null==i?void 0:i.initialAmount)||(null==e?void 0:e.initialPremium)!==(null==i?void 0:i.initialPremium))){const{code:e,data:i}=await Ve({...o,riskLiabilities:[a]});if("10000"===e){if(a.liabilityAttributeValueList=i[0].formulaResult,f.value.signLiabilityClick.length>0){const e=f.value.signLiabilityClick.find((e=>e.item.liabilityCode===a.liabilityCode));e&&L(e.item,e.index)}return{...a,liabilityAttributeValueList:i[0]}}return a}}))}),{deep:!0,immediate:!0}),o((()=>f.value.liabilityList),(e=>{const i=f.value.liabilityList.filter((e=>"1"===e.isSwitchOn)).map((e=>({...e.liabilityValue})));a("trialChange",i)}),{deep:!0,immediate:!0}),s((()=>{console.log("----mounted"),l.dataSource.riskLiabilityInfoVOList.map(((e,i)=>{const a=e.liabilityAttributeValueList.length>0&&0===e.formula.length&&e.liabilityAttributeValueList[0].displayValue;return f.value.checkValueList[i]||(f.value.checkValueList[i]=a),1!=+e.showFlag&&f.value.liabilityList.push({liabilityValue:e,key:i,isSwitchOn:"1"}),1==+e.showFlag&&(1===e.attributeFlag&&2===e.insureFlag&&0===e.formula.length&&O(e,i,1),1===e.attributeFlag&&1===e.insureFlag&&0===e.formula.length&&O(e,i,2),2===e.attributeFlag&&1===(null==e?void 0:e.liabilityAttributeValueList.length)&&2===e.insureFlag&&O(e,i,1),2===e.attributeFlag&&1===(null==e?void 0:e.liabilityAttributeValueList.length)&&1===e.insureFlag&&O(e,i,2)),null}))}));const w=t([]);return o((()=>l.dataSource.riskLiabilityInfoVOList),(e=>{w.value=(e||[]).map((e=>{const i=(l.dataSource.riskLiabilityCollocationVOList||[]).find((i=>i.collocationLiabilityId===e.liabilityId));return{...e,relation:null==i?void 0:i.collocationType}}))}),{deep:!0,immediate:!0}),o((()=>l.defaultValue),(e=>{(null==e?void 0:e.riskCode)&&e.liabilityList&&(f.value.signLiabilityClick=[],l.dataSource.riskLiabilityInfoVOList.forEach(((i,a)=>{var l;const t=null==e?void 0:e.liabilityList.find((e=>e.liabilityCode===i.liabilityCode));console.log("--target lia = ",t),t&&(f.value.isCheckList[a]="1",f.value.checkValueList[a]=null==(l=null==t?void 0:t.liabilityValue)?void 0:l.displayValue,1==+i.showFlag&&2==+i.optionalFlag?b(i,a):g(i,a))})))}),{deep:!0,immediate:!0}),(e,i)=>{const a=W,l=h,t=ee;return r(),v(t,null,{default:c((()=>[p("div",Zi,[p("div",Wi,[(r(!0),u(k,null,x(m(w),((e,i)=>(r(),u("div",{key:i},[1!=+e.showFlag||2===e.attributeFlag&&1===(null==e?void 0:e.liabilityAttributeValueList.length)&&2===e.insureFlag?y("",!0):(r(),u("div",ea,[(m(f).isCheckList[i]?"3"!==m(f).isCheckList[i]:e.relation!==m(Xe).YI_LAI)?(r(),v(l,{key:0,label:`${e.liabilityName}`,"label-width":"44%",name:"insuredRelation",class:"riskliab-select-field"},{input:c((()=>[1==+e.insureFlag?(r(),v(a,{key:0,modelValue:m(f).isCheckList[i],"onUpdate:modelValue":e=>m(f).isCheckList[i]=e,"active-value":"1","inactive-value":"2",size:"0.68rem",onClick:a=>b(e,i)},null,8,["modelValue","onUpdate:modelValue","onClick"])):y("",!0)])),_:2},1032,["label"])):y("",!0),1==+m(f).isCheckList[i]&&1===e.attributeFlag||1===e.attributeFlag&&2===e.insureFlag?(r(),v(l,{key:1,label:e.liabilityAttributeTypeDesc,"label-width":"44%",name:"insuredRelation",class:"riskliab-select-field-children"},{input:c((()=>[d(V,{modelValue:m(f).checkValueList[i],"onUpdate:modelValue":e=>m(f).checkValueList[i]=e,prop:{label:"displayValue",value:"displayValue"},options:(e.formula.length,e.liabilityAttributeValueList),"is-simply":!0,onClick:a=>L(e,i)},null,8,["modelValue","onUpdate:modelValue","options","onClick"])])),_:2},1032,["label"])):y("",!0)]))])))),128))])]),ia])),_:1})}}}),[["__scopeId","data-v-68f76c44"]]);const ta=a({name:"InsureInfos"}),na=a({...ta,props:{originData:{default:()=>({})},modelValue:{default:()=>({})},defaultValue:{default:()=>({})},trialResult:{default:()=>({})}},emits:["trialChange"],setup(e,{expose:i,emit:a}){const n=a,c=e,p=t(null),v=t({}),f=t({}),g=l({personalInfo:{},basicsAmount:"",basicsPremium:"",defaultValues:c.defaultValue,changeData:null,sValues:v.value});$("premium"),f.value=$("enumList")||{},s((()=>{}));const h=e=>{c.originData.mainRiskFlag,v.value.riskCategory=c.originData.riskCategory,v.value.riskCode=c.originData.riskCode,v.value.riskId=c.originData.riskId,v.value.riskType=c.originData.riskType,v.value.riskName=c.originData.riskName,v.value.riskType=c.originData.riskType,v.value.mainRiskCode=c.originData.mainRiskCode,v.value.mainRiskId=c.originData.mainRiskId,e?n("trialChange",v.value,e):n("trialChange",v.value)},V=(e,i)=>{i?v.value[i.key]=i.newValue:Ke(e).forEach((i=>{v.value[i]=e[i]})),h(i)},I=e=>{var i,a;1==+(null==(a=null==(i=c.originData)?void 0:i.productRiskInsureLimitVO)?void 0:a.amountPremiumConfigVO.saleMethod)?g.basicsAmount=null==e?void 0:e.initialAmount:g.basicsAmount=null==e?void 0:e.initialPremium,Ke(e).forEach((i=>{v.value[i]=e[i]})),h()},b=e=>{v.value.liabilityList=e,h()};return o((()=>c.defaultValue),(e=>{e&&(console.log("--default change ",e),g.defaultValues=Ee(e),v.value={...e})}),{deep:!0,immediate:!0}),o((()=>v.value),(e=>{g.sValues=e}),{deep:!0,immediate:!0}),i({validate:async()=>{var e;await(null==(e=p.value)?void 0:e.validate())}}),(e,i)=>{var a,l,t,n,s,o;const c=ae;return 1===(null==(a=e.originData)?void 0:a.factorDisPlayFlag)?(r(),u(k,{key:0},[d(c,{title:"保障计划",class:"insurePlan","show-divider":!1}),d(m(ki),{"v-model":m(g).sValues,"origin-data":null==(t=null==(l=e.originData)?void 0:l.productRiskInsureLimitVO)?void 0:t.amountPremiumConfigVO,"defalut-value":m(g).defaultValues,"trial-result":e.trialResult,onTrialChange:I},null,8,["v-model","origin-data","defalut-value","trial-result"]),d(m(Xi),{"v-model":m(g).sValues,"use-data":m(g).sValues,"origin-data":e.originData.productRiskInsureLimitVO,"risk-info":e.originData,"default-value":m(g).defaultValues,onTrialChange:V},null,8,["v-model","use-data","origin-data","risk-info","default-value"]),d(m(la),{"data-source-folmulate":m(v),"data-source":e.originData,params:{amountUnit:null==(s=null==(n=e.originData)?void 0:n.productRiskInsureLimitVO)?void 0:s.amountPremiumConfigVO.displayUnit,basicsAmount:m(g).basicsAmount,basicsPremium:m(g).basicsPremium,riskId:null==(o=e.originData)?void 0:o.riskId},"default-value":m(g).defaultValues,onTrialChange:b},null,8,["data-source-folmulate","data-source","params","default-value"])],64)):y("",!0)}}});const sa={key:0},oa={key:0,class:"risk2-field"},ra=a({name:"ProductRiskList"});var ua=g(a({...ra,props:{dataSource:{type:Array,default:()=>[]},productInfo:{type:Object,default:()=>({productCode:"",productName:""})},showMainRisk:{type:Boolean,default:()=>!0},defaultValue:{type:Object,default:()=>{}}},emits:["trialChange"],setup(e,{emit:i}){const a=i,t=e,n=l({loading:!1,show:!0,select:{},list:[],userData:{},riskIsInsure:{},submitData:{},disabledRiskInfo:[],risksDefaultValue:{}}),p=e=>{const i=[];return e.riskLiabilityInfoVOList.map((e=>(1!=+e.showFlag&&i.push({...e}),[]))),i},v=(e,i,l)=>{var s;n.riskIsInsure[i].data=e;const o=[...n.disabledRiskInfo];null==(s=t.dataSource.insureProductRiskVOList)||s.forEach((e=>{if(1!==e.mainRiskFlag){const i=n.riskIsInsure[e.riskId];i.data&&Object.keys(i.data).length>0&&"1"===i.selected&&o.push(i.data)}})),a("trialChange",o,l)},f=(e,i)=>{var a;null==(a=t.dataSource.productRiskRelationVOList)||a.forEach((a=>{1!==a.collocationType&&(i.riskId===a.riskId?(n.riskIsInsure[i.riskId]&&n.riskIsInsure[i.riskId].selected,2===a.collocationType&&n.riskIsInsure[a.collocationRiskId]&&(n.riskIsInsure[a.collocationRiskId].selected=e),3===a.collocationType&&n.riskIsInsure[a.collocationRiskId]&&"1"===e&&(n.riskIsInsure[a.collocationRiskId].selected="1"===e?"2":"1")):i.riskId===a.collocationRiskId&&(3===a.collocationType&&"1"===e&&n.riskIsInsure[a.riskId]&&(n.riskIsInsure[a.riskId].selected="1"===e?"2":"1"),2===a.collocationType&&n.riskIsInsure[a.riskId]&&(n.riskIsInsure[a.riskId].selected=e)))})),"2"===e?v({},i.riskId):(e=>{var i,a,l,t,n,s,o,r,u,d,c,m;if(1!==(null==e?void 0:e.factorDisPlayFlag)){const f=null==(i=null==e?void 0:e.productRiskInsureLimitVO)?void 0:i.amountPremiumConfigVO,y={riskCategory:e.riskCategory,riskCode:e.riskCode,riskName:e.riskName,riskId:e.riskId,riskType:e.riskType,mainRiskId:e.mainRiskId,mainRiskCode:e.mainRiskCode,liabilityList:p(e)};y.chargePeriod=(null==(l=null==(a=null==e?void 0:e.productRiskInsureLimitVO)?void 0:a.paymentPeriodValueList)?void 0:l.length)>0&&(null==(t=null==e?void 0:e.productRiskInsureLimitVO)?void 0:t.paymentPeriodValueList[0].code)||null,y.coveragePeriod=(null==(s=null==(n=null==e?void 0:e.productRiskInsureLimitVO)?void 0:n.insurancePeriodValueList)?void 0:s.length)>0&&(null==(o=null==e?void 0:e.productRiskInsureLimitVO)?void 0:o.insurancePeriodValueList[0].code)||null,y.paymentFrequency=(null==(u=null==(r=null==e?void 0:e.productRiskInsureLimitVO)?void 0:r.paymentFrequencyList)?void 0:u.length)>0&&(null==(d=null==e?void 0:e.productRiskInsureLimitVO)?void 0:d.paymentFrequencyList[0].code)||null;let k=0;1===f.displayType?k=(null==f?void 0:f.minStepValue)>0?null==f?void 0:f.minStepValue:0:3===f.displayType&&2===f.requireCopies?k=(null==(c=null==f?void 0:f.displayValues)?void 0:c.length)>0?null==f?void 0:f.displayValues[0].value:0:3===f.displayType&&1===f.requireCopies?(k=(null==(m=null==f?void 0:f.displayValues)?void 0:m.length)>0?null==f?void 0:f.displayValues[0].value:0,y.copy=f.minCopiesValue):2===f.displayType?y.copy=f.minCopiesValue:k=0,1===f.saleMethod?y.initialAmount=k:y.initialPremium=k,v(y,e.riskId)}})(i)};return le((()=>{(()=>{var e,i;n.disabledRiskInfo=[];let a=null;if(null==(e=t.dataSource.insureProductRiskVOList)||e.forEach((e=>{var i;const l=1!==e.mainRiskFlag?null==(i=t.dataSource.productRiskRelationVOList)?void 0:i.find((i=>i.collocationRiskId===e.riskId)):{};1===e.mainRiskFlag&&(a=e),n.riskIsInsure[e.riskId]?(n.riskIsInsure[e.riskId].data=null,n.riskIsInsure[e.riskId].relation=l,n.riskIsInsure[e.riskId].isMust=!1):n.riskIsInsure[e.riskId]={selected:"2",data:null,relation:l,isMust:!1}})),a){const e=null==(i=t.dataSource.productRiskRelationVOList)?void 0:i.filter((e=>e.riskId===a.riskId));if(!e)return;null==e||e.forEach((e=>{var i,a,l,s,o,r,u,d,c,m,f,y,k,g,h;if(2===e.collocationType){n.riskIsInsure[e.collocationRiskId].selected="1",n.riskIsInsure[e.collocationRiskId].isMust=!0;const V=null==(i=t.dataSource.insureProductRiskVOList)?void 0:i.find((i=>e.collocationRiskId===i.riskId));if(V&&1!==V.factorDisPlayFlag&&(null==(a=null==V?void 0:V.productRiskInsureLimitVO)?void 0:a.amountPremiumConfigVO)){const i=null==(l=V.riskLiabilityInfoVOList)?void 0:l.every((e=>1!==e.showFlag)),a=null==(s=null==V?void 0:V.productRiskInsureLimitVO)?void 0:s.amountPremiumConfigVO;if(i){n.riskIsInsure[e.collocationRiskId].isDisabled=!0;const i={riskCategory:V.riskCategory,riskCode:V.riskCode,riskName:V.riskName,riskId:V.riskId,riskType:V.riskType,mainRiskId:V.mainRiskId,mainRiskCode:V.mainRiskCode,liabilityList:p(V)};i.chargePeriod=(null==(r=null==(o=null==V?void 0:V.productRiskInsureLimitVO)?void 0:o.paymentPeriodValueList)?void 0:r.length)>0&&(null==(u=null==V?void 0:V.productRiskInsureLimitVO)?void 0:u.paymentPeriodValueList[0].code)||null,i.coveragePeriod=(null==(c=null==(d=null==V?void 0:V.productRiskInsureLimitVO)?void 0:d.insurancePeriodValueList)?void 0:c.length)>0&&(null==(m=null==V?void 0:V.productRiskInsureLimitVO)?void 0:m.insurancePeriodValueList[0].code)||null,i.paymentFrequency=(null==(y=null==(f=null==V?void 0:V.productRiskInsureLimitVO)?void 0:f.paymentFrequencyList)?void 0:y.length)>0&&(null==(k=null==V?void 0:V.productRiskInsureLimitVO)?void 0:k.paymentFrequencyList[0].code)||null;let l=0;1===a.displayType?l=(null==a?void 0:a.minStepValue)>0?null==a?void 0:a.minStepValue:0:3===a.displayType&&2===a.requireCopies?l=(null==(g=null==a?void 0:a.displayValues)?void 0:g.length)>0?null==a?void 0:a.displayValues[0].value:0:3===a.displayType&&1===a.requireCopies?(l=(null==(h=null==a?void 0:a.displayValues)?void 0:h.length)>0?null==a?void 0:a.displayValues[0].value:0,i.copy=a.minCopiesValue):2===a.displayType&&(i.copy=a.minCopiesValue),1===a.saleMethod?i.initialAmount=l:i.initialPremium=l,n.disabledRiskInfo.push(i),v(i,V.riskId)}}}3===e.collocationType&&(n.riskIsInsure[e.collocationRiskId].selected="2",n.riskIsInsure[e.collocationRiskId].isMust=!0)}))}})()})),s((()=>{n.loading=!0})),o((()=>n.riskIsInsure),(e=>{}),{deep:!0,immediate:!0}),o((()=>t.defaultValue),(e=>{(null==e?void 0:e.length)>0&&e.forEach((e=>{n.risksDefaultValue[e.riskCode]=e,n.riskIsInsure[e.riskId]?(n.riskIsInsure[e.riskId].selected="1",v(e,e.riskId)):n.riskIsInsure[e.riskId]={selected:"1",isMust:!1}}))}),{deep:!0,immediate:!0}),(i,a)=>{const l=W,t=h;return r(!0),u(k,null,x(e.dataSource.insureProductRiskVOList,(a=>{var s,o;return r(),u(k,{key:a.riskCode},[(!e.showMainRisk&&1!==a.mainRiskFlag||e.showMainRisk)&&(null==(o=null==(s=m(n).riskIsInsure)?void 0:s[a.riskId])?void 0:o.relation)?(r(),u("div",sa,[d(t,{modelValue:m(n).riskIsInsure[a.riskId].selected,"onUpdate:modelValue":e=>m(n).riskIsInsure[a.riskId].selected=e,label:a.riskName,name:"selected","label-width":"50%",border:!1,class:"risk-select-field risk-name"},{input:c((()=>[d(l,{modelValue:m(n).riskIsInsure[a.riskId].selected,"onUpdate:modelValue":e=>m(n).riskIsInsure[a.riskId].selected=e,"active-value":"1","inactive-value":"2",size:"0.68rem",disabled:m(n).riskIsInsure[a.riskId].isMust,style:{"margin-right":"8px"},onChange:e=>f(e,a)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])])),_:2},1032,["modelValue","onUpdate:modelValue","label"]),"1"===m(n).riskIsInsure[a.riskId].selected?(r(),u("div",oa,[d(na,{modelValue:m(n).riskIsInsure[a.riskId].data,"onUpdate:modelValue":e=>m(n).riskIsInsure[a.riskId].data=e,"origin-data":a,"product-factor":e.dataSource.productFactor,"default-value":m(n).risksDefaultValue[a.riskCode],onTrialChange:(e,i)=>v(e,a.riskId,i)},null,8,["modelValue","onUpdate:modelValue","origin-data","product-factor","default-value","onTrialChange"])])):y("",!0),1===a.exemptFlag&&"1"===m(n).riskIsInsure[a.riskId].selected?O(i.$slots,"holderForm",{key:1},void 0,!0):y("",!0)])):y("",!0)],64)})),128)}}}),[["__scopeId","data-v-58a61f59"]]);const da={class:"pro-radio-wrap"},ca=a({name:"PlanSelect"}),pa=a({...ca,props:{planList:{default:()=>[]},defaultPlan:{default:()=>{}}},emits:["planChange"],setup(e,{emit:i}){const a=i,l=e,n=t("");let u=!1;return s((()=>{l.defaultPlan&&(u=!0,n.value=l.defaultPlan.planCode)})),o((()=>n),(e=>{u||a("planChange",n.value),u&&(u=!1)}),{deep:!0,immediate:!0}),(e,i)=>{const a=V,t=h;return e.planList.length>0?(r(),v(t,{key:0,modelValue:n.value,"onUpdate:modelValue":i[1]||(i[1]=e=>n.value=e),label:"保障计划",name:"planCode",class:"risk-select-field"},{input:c((()=>[p("div",da,[d(a,{modelValue:n.value,"onUpdate:modelValue":i[0]||(i[0]=e=>n.value=e),options:l.planList.map((e=>({label:e.planName,value:e.planCode})))},null,8,["modelValue","options"])])])),_:1},8,["modelValue"])):y("",!0)}}}),ma=(e,i,a)=>{const l=e,{holder:t}=a,n=a.insuredList[0],s=(i||"").split("_");if(s.length<2)return i;if(ei(Number(s[1])))return i;if(s[1]-=1,1===l.exemptFlag){if("to"===s[0]){let e=0;1===l.exemptType?(null==t?void 0:t.birthday)&&(e=parseInt(""+((new Date).getTime()-new Date(t.birthday).getTime())/31536e6,10)):2===l.exemptType&&(null==n?void 0:n.birthday)&&(e=parseInt(""+(+(new Date).getTime()-new Date(n.birthday).getTime())/31536e6,10)),s[1]=+s[1]-e}s[0]="year"}return s.join("_")},va=(e,i)=>{const a=[],l={};return null==e||e.forEach((e=>{l[e.riskId]=e})),null==i||i.forEach((e=>{var i,t,n,s;const{collocationType:o,collocationRiskId:r,riskId:u}=e;switch(o){case 2:{const e=null==(i=l[u])?void 0:i.riskName,n=null==(t=l[r])?void 0:t.riskName;a.push(`${e} 和 ${n} 必须同时投保`);break}case 3:{const e=null==(n=l[u])?void 0:n.riskName,i=null==(s=l[r])?void 0:s.riskName;a.push(`${e} 和 ${i} 不能同时投保`);break}}})),a};const fa={class:"com-body"},ya={class:"trial-body"},ka={class:"container"},ga={class:"container"},ha={class:"container"},Va=(e=>(X("data-v-3c63782e"),e=e(),Z(),e))((()=>p("div",{class:"empty"},null,-1))),Ia=a({name:"TrialBody"});var ba=g(a({...Ia,props:{selfKey:{default:""},dataSource:{default:()=>[]},productInfo:{default:()=>({productCode:"",productName:"",insurerCode:"",tenantId:"",planList:[]})},tenantProductDetail:{default:()=>({})},hideBenefit:{type:Boolean,default:!1},hidePopupButton:{type:Boolean,default:!1},title:{default:"算一算保费"},defaultData:{default:null},isTrial:{type:Boolean,default:!1},defaultOrder:{default:()=>({})}},emits:["trialStart","trialEnd","update:userData","closeCustomerPopoup"],setup(e,{expose:i,emit:a}){const f=t(null),k=E();te();const g=a,{tenantId:h,templateId:V,preview:I}=k.query,b=t(),L=e,C=l({loading:!1,show:!1,select:{},list:[],userData:{},riskIsInsure:{},submitData:{},riskList:[{}],mainRiskVO:{},ifPersonalInfoSuccess:!1,trialMsg:"",trialResultPremium:0,trialResult:{initialPremium:0,initialAmount:0},isAniShow:!1,defaultValue:null,isAutoChange:!1,planIndex:0,isSkipFirstTrial:!1,hadSkipFirstTrial:!1,isQuerying:!1,currentPlanCode:""}),w=Fe();t();const T=t(),R=t(L.dataSource),P=t([]),D=e=>{const{holder:i,insuredList:a}=e||{};i&&(C.submitData.holder=i),a&&a.length>0&&a.forEach(((e,i)=>{var a;C.submitData.insuredList&&C.submitData.insuredList.length>i?C.submitData.insuredList[i]=e:((null==(a=C.submitData)?void 0:a.insuredList)||(C.submitData.insuredList=[]),C.submitData.insuredList.push(e))}))},x=n((()=>L.productInfo.planList&&L.productInfo.planList.length>2)),A=(e,i)=>{if(e){const a=["birthday","age","gender","id"];i.includes("occupationCodeList")&&a.push("occupationClass"),Object.keys(e).forEach((l=>{[...i,...a].includes(l)||(e[l]=null)}))}},F=e=>{console.log("我是客户数据",e),g("closeCustomerPopoup",e)},N=(e,i=(e=>!0))=>S(e)?e.filter(i).map((e=>e.code)):[],_=()=>{console.log("--current plan = ",R.value),console.log("---current submit = ",C.submitData);const e=Ee(C.submitData);if(!x.value)return e;const{1:i,2:a,3:l}=R.value.productFactor||{};if(e.holder&&A(e.holder,N(i)),e.insuredList){const i=["productList","beneficiaryList"],t=N(a,(e=>"2"!==String(e.subModuleType))),n=N(a,(e=>"2"===String(e.subModuleType))),s=S(n),o=N(l),r=S(o);e.insuredList.forEach(((e,a)=>{var l,u,d;A(e,[...a>=1&&s?n:t,...i,...r?["insuredBeneficiaryType"]:[]]),(null==(l=e.beneficiaryList)?void 0:l.length)>0&&(r?e.beneficiaryList.forEach((e=>A(e,o))):e.beneficiaryList.length=0),e.planCode=R.value.planCode;const c=(null==(d=null==(u=e.productList)?void 0:u[0])?void 0:d.riskList)||[],p=R.value.insureProductRiskVOList||[];if(c.length&&p){const i=c.filter((e=>null!==p.find((i=>i.riskCode===e.riskCode))));e.productList[0].riskList=i}}))}return e},j=t(),U=t({}),M=["annuityDrawDate","coveragePeriod","chargePeriod","paymentFrequency"],q=e=>{var i,a,l,t,n,s;if(null==(a=null==(i=null==e?void 0:e.data)?void 0:i[0])?void 0:a.productRiskDyInsureFactorVOList){const i=[];if(null==(l=R.value)||l.insureProductRiskVOList.forEach((a=>{var l,t;const n=null==(t=null==(l=null==e?void 0:e.data)?void 0:l[0])?void 0:t.productRiskDyInsureFactorVOList.find((e=>e.riskCode===a.riskCode));if(n){a.productRiskInsureLimitVO={...a.productRiskInsureLimitVO,...n};const e=C.riskList.find((e=>e.riskCode===a.riskCode));let l=!1;Ne.forEach((i=>{if(M.indexOf(i.valueKey)>=0){const t=a.productRiskInsureLimitVO[i.configKey];if(t&&e){const a=t.find((a=>a.code===e[i.valueKey]));if(a&&2===a.useFlag){const a=t.find((e=>1===e.defaultFlag));e[i.valueKey]=a.code,l=!0}}}})),l&&i.push({...e,...n,riskCode:a.riskCode})}})),i.length>0&&(null==(s=null==(n=null==(t=C.defaultValue)?void 0:t.insuredList)?void 0:n[0])?void 0:s.productList))return i.forEach((e=>{var i,a,l;C.defaultValue.insuredList[0].productList=null==(l=null==(a=null==(i=C.defaultValue)?void 0:i.insuredList)?void 0:a[0])?void 0:l.productList.map((i=>(i.riskList=null==i?void 0:i.riskList.map((i=>(i.riskCode===e.riskCode&&(i=e),i))),i)))})),!1}return!0},$=B((async(e,i=!0)=>{C.trialMsg="试算中...",C.trialResultPremium=0,C.loading=!0,g("trialStart");let a=!1;if(i){const{code:i}=await Ie(e);a="10000"===i}!a&&i||(C.isQuerying=!0,L.hideBenefit||be(e).then((e=>{e.data&&e.code===ne&&(U.value=e.data)})).finally((()=>{C.loading=!1})),Le(e).then((i=>{var a,l;if(i.data&&i.code===ne){(null==(a=null==i?void 0:i.data)?void 0:a.errorInfo)&&K(`${null==(l=null==i?void 0:i.data)?void 0:l.errorInfo}`),C.trialMsg="",C.trialResultPremium=i.data.initialPremium,C.trialResult=i.data;const t={};i.data.riskPremiumDetailVOList&&i.data.riskPremiumDetailVOList.length&&i.data.riskPremiumDetailVOList.forEach((e=>{t[e.riskCode]={initialAmount:e.initialAmount,initialPremium:e.initialPremium}})),j.value=t,g("trialEnd",i.data,e)}})).finally((()=>{C.loading=!1,C.isQuerying=!1})))}),500),J=B((async()=>{console.log(">>>>>调用试算<<<<<",C.ifPersonalInfoSuccess,b.value.canTrail());const{productCode:e,productName:i}=L.productInfo||{};if(C.ifPersonalInfoSuccess||b.value.canTrail()){C.submitData.productCode=e,C.submitData.productName=i,C.submitData.tenantId=L.productInfo.tenantId,C.riskList=C.riskList.map((e=>(e=>{var i,a,l,t;const n=null==(i=R.value.insureProductRiskVOList)?void 0:i.find((i=>e.riskId===i.riskId));if(n&&1!==n.mainRiskFlag){const i=null==(l=null==(a=R.value)?void 0:a.productRiskRelationVOList)?void 0:l.filter((e=>{var i;if(e.collocationRiskId===n.riskId&&3!==e.collocationType){const a=null==(i=R.value.insureProductRiskVOList)?void 0:i.find((i=>e.riskId===i.riskId));if(a&&a.riskType===We.MAIN_RISK)return!0}return!1})),s=i.length>0?i[0]:null;if(s){const i=null==(t=C.riskList)?void 0:t.find((e=>e.riskId===s.riskId));Ne.forEach((a=>{a.ruleKey&&n.productRiskInsureLimitVO&&i&&(1===n.productRiskInsureLimitVO[a.ruleKey]&&(e[a.valueKey]=i[a.valueKey]),3===n.productRiskInsureLimitVO[a.ruleKey]&&(1!==n.exemptFlag?e[a.valueKey]=ma(n,i[a.valueKey],C.submitData):e[a.valueKey]=ma(n,i[a.ruleValueKey],C.submitData)))}))}}return e})(e))),C.submitData.insuredList&&C.submitData.insuredList.forEach((a=>{a.productList=[{productCode:e,productName:i,riskList:C.riskList}]}));const a=_();console.log(">>>数据构建<<<",a),await $(a)}}),300),H=async e=>{console.log("人的信息更改了"),D(e),C.ifPersonalInfoSuccess=!0,console.log("处理第一被保险人修改的dy变化"),J()};n((()=>{var e;return((null==(e=C.userData)?void 0:e.insuredList)||[]).map((e=>e.birthday)).join(",")})),o((()=>{var e;return((null==(e=C.userData)?void 0:e.insuredList)||[]).map((e=>e.birthday)).join(",")}),B((async e=>{var i;if(R.value.insureProductRiskVOList&&e){const e=C.userData.insuredList.filter((e=>e.birthday))||[];if(!e.length)return;const a=await Ce({calcProductFactorList:[{planCode:R.value.planCode,productCode:L.productInfo.productCode,riskEditVOList:[{insureProductRiskVO:null==(i=R.value.insureProductRiskVOList)?void 0:i[0]}]}],insuredVOList:e});q(a)}})),{});const G=async(e,i)=>{var a,l;if(i){const t=Ee(e);delete t.insurancePeriodValueList,delete t.paymentFrequencyList,delete t.paymentPeriodValueList;if(M.indexOf(i.key)>=0&&`${i.oldValue}`!=`${i.newValue}`){const n={};switch(i.key){case"annuityDrawDate":n.changeType=3;break;case"coveragePeriod":n.changeType=2;break;case"chargePeriod":n.changeType=1;break;case"paymentFrequency":n.changeType=4}const s=null==(l=null==(a=R.value)?void 0:a.insureProductRiskVOList)?void 0:l.find((i=>i.riskCode===e.riskCode));if(!C.isAutoChange){C.isQuerying=!0;const i=C.userData.insuredList.filter((e=>e.birthday))||[];if(!i.length)return!1;const a=await Ce({calcProductFactorList:[{planCode:R.value.planCode,productCode:L.productInfo.productCode,riskEditVOList:[{insureProductRiskVO:s,insureRiskEditReqVO:{riskId:e.riskId,riskCode:e.riskCode,...t,...n}}]}],insuredVOList:i});C.isQuerying=!1;const l=q(a);return l||(C.isAutoChange=!0),l}C.isAutoChange=!1}}return!0},z=async(e,i)=>{C.mainRiskVO=e;await G(e,i)&&(C.riskList.length>0&&(C.riskList[0]=e),console.log("标准险种的信息回传",e),J())},Y=async(e,i)=>{if(C.riskList=[C.mainRiskVO,...e],console.log("附加险列表数据回传",e),i){const a=e.find((e=>e.riskCode===i.riskCode));if(!(await G(a,i)))return}J()},Q=e=>{var i,a,l,t;C.userData=e,C.defaultValue=e;const n=(null==(i=e.insuredList)?void 0:i[0].productList.findIndex((e=>e.planCode===R.value.planCode)))||0;C.planIndex=-1===n?0:n,C.riskList=(null==(t=null==(l=null==(a=null==e?void 0:e.insuredList)?void 0:a[0].productList)?void 0:l[C.planIndex])?void 0:t.riskList)||[],$(e,!0)},X=async e=>{var i;if(L.defaultData){const e=L.defaultData.find((e=>e.productCode===L.productInfo.productCode))||L.defaultData[0];Q(e),D(null==(i=L.defaultData)?void 0:i[0])}else P.value.push(R.value.planCode),await(async()=>{var e;const i=await Oe({calcProductFactorList:[{planCode:R.value.planCode,productCode:L.productInfo.productCode}]});if(i.data){const a=i.data.find((e=>e.productCode===L.productInfo.productCode))||i.data[0];Q(a),D(null==(e=i.data)?void 0:e[0])}})()},Z=async e=>{var i,a;const l=L.productInfo.planList.findIndex((i=>i.planCode===e)),t=(null==(a=null==(i=C.defaultValue)?void 0:i.insuredList)?void 0:a[0].productList.findIndex((i=>i.planCode===e)))||0,n=l>=0?L.productInfo.planList[l]:null;n&&(C.currentPlanCode=e,R.value=n,C.planIndex=t>=0?t:0,C.defaultValue.insuredList[0].productList[C.planIndex].riskList=C.riskList,P.value.findIndex((i=>i===e))<0&&P.value.push(e))};le((()=>{var e,i;C.select={},C.list=[],C.userData={},C.riskIsInsure={},C.submitData={},C.riskList=[{}],C.mainRiskVO={},C.ifPersonalInfoSuccess=!1,C.trialMsg="",C.trialResultPremium=0,C.riskIsInsure={},null==(i=null==(e=R.value)?void 0:e.insureProductRiskVOList)||i.forEach((e=>{var i;const a=null==(i=R.value.productRiskRelationVOList)?void 0:i.find((i=>i.collocationRiskId===e.riskId));a&&(C.riskIsInsure[e.riskCode]={selected:"2",data:null,relation:a})}))})),s((()=>{R.value=L.dataSource,C.loading=!0,C.show=!0,C.isAniShow=!0,C.isSkipFirstTrial=!0,C.hadSkipFirstTrial=!1,se((()=>{X()}))}));return i({getTrialSuccessFlag:()=>C.trialResultPremium>0,validate:()=>b.value.validate(!1),validateTrialFields:()=>b.value.validateTrialFields(),validateHolder:e=>{var i;return null==(i=b.value)?void 0:i.validateHolder(e)},getUserData:()=>({...C.userData}),onShare:e=>{var i;C.trialResultPremium&&(null==(i=f.value)||i.validate().then((()=>{Object.assign(w.value,L.defaultOrder,{extInfo:{...w.value.extInfo,buttonCode:je.TRIAL_PREMIUM,pageCode:_e.TRIAL_PREMIUM,templateId:V}});const i=Ue(L.productInfo,j.value,w.value);Pe(i,((i,a)=>{a===re.JUMP_PAGE&&(T.value.link=`${window.location.href}&isShare=1&orderNo=${i.orderNo}`,e())})),console.log("---- validate success ----")})))},onNext:()=>{var e;const{productCode:i,productName:a}=L.productInfo;I?oe(_e.TRIAL_PREMIUM,k.query):C.trialResultPremium&&(null==(e=f.value)||e.validate().then((()=>{Object.assign(w.value,L.defaultOrder,{extInfo:{templateId:V,...w.value.extInfo,...L.defaultOrder.extInfo||{},buttonCode:je.TRIAL_PREMIUM,pageCode:_e.TRIAL_PREMIUM}}),console.log("dealMixData()",_());const e=Ue({..._(),productCode:i,productName:a},C.trialResult,w.value);Pe(e,((e,i)=>{i===re.JUMP_PAGE&&ue(e.nextPageCode,{...k.query,orderNo:e.orderNo})})),console.log("---- validate success ----")})),C.loading=!1,C.show=!0,C.isAniShow=!0)},dealMixData:_}),o((()=>C.riskIsInsure),(e=>{}),{deep:!0,immediate:!0}),o((()=>C.userData),(e=>{if(e){const{holder:i,insuredList:a}=e||{},l={holder:i,insuredList:a};Object.assign(C.submitData,l),g("update:userData",l)}}),{deep:!0}),o((()=>L.dataSource),(e=>{R.value=e}),{deep:!0,immediate:!0}),(e,i)=>{var a,l,t,n,s,o,k,g;const h=de;return r(),u("div",fa,[O(e.$slots,"trialHead",{},void 0,!0),p("div",ya,[d(ke,{labels:m(va)((null==(a=R.value)?void 0:a.insureProductRiskVOList)||[],R.value.productRiskRelationVOList)},null,8,["labels"]),p("div",ka,[!e.hideBenefit&&(null==(l=U.value)?void 0:l.benefitRiskResultVOList)?(r(),v(Ze,{key:0,class:"benefit-wrap","data-source":U.value,"product-info":R.value,"show-type-list":U.value.showTypList},null,8,["data-source","product-info","show-type-list"])):y("",!0),m(x)?(r(),v(pa,{key:1,"plan-list":e.productInfo.planList,"default-plan":R.value,onPlanChange:Z},null,8,["plan-list","default-plan"])):y("",!0),R.value.productFactor?(r(),v(m(zi),{ref_key:"personalInfoRef",ref:b,key:R.value.planCode,modelValue:m(C).userData,"onUpdate:modelValue":i[0]||(i[0]=e=>m(C).userData=e),"is-trial":e.isTrial,"product-factor":R.value.productFactor,"multi-insured-config":null==(t=R.value)?void 0:t.multiInsuredConfigVO,onTrailChange:H,onCloseCustomerPopoup:F},null,8,["modelValue","is-trial","product-factor","multi-insured-config"])):y("",!0)]),d(h,{size:"large"}),p("div",ga,[(r(),v(na,{ref_key:"insureInfosRef",ref:f,key:R.value.planCode,"origin-data":null==(n=R.value.insureProductRiskVOList)?void 0:n[0],"product-factor":R.value.productFactor,"default-value":m(C).defaultValue?null==(o=null==(s=m(C).defaultValue)?void 0:s.insuredList[0].productList[m(C).planIndex])?void 0:o.riskList[0]:null,"trial-result":m(C).trialResult,onTrialChange:z},null,8,["origin-data","product-factor","default-value","trial-result"]))]),p("div",ha,[R.value.insureProductRiskVOList?(r(),v(ua,{key:R.value.planCode,"data-source":R.value,"show-main-risk":!1,"default-value":m(C).defaultValue?null==(g=null==(k=m(C).defaultValue)?void 0:k.insuredList[0].productList[m(C).planIndex])?void 0:g.riskList:[],onTrialChange:Y},{holderForm:c((()=>{var a;return[e.isTrial&&e.dataSource.productFactor?(r(),v(m(zi),{key:0,ref_key:"personalInfoRef",ref:b,modelValue:m(C).userData,"onUpdate:modelValue":i[1]||(i[1]=e=>m(C).userData=e),"is-trial":e.isTrial,"is-only-holder":!0,"product-factor":e.dataSource.productFactor,"multi-insured-config":null==(a=e.dataSource)?void 0:a.multiInsuredConfigVO,onTrailChange:H},null,8,["modelValue","is-trial","product-factor","multi-insured-config"])):y("",!0)]})),_:1},8,["data-source","default-value"])):y("",!0)]),Va]),O(e.$slots,"trialBtn",{trialData:m(C).submitData,riskPremium:m(C).trialResult,loading:m(C).isQuerying,personalInfoRef:b.value},void 0,!0)])}}}),[["__scopeId","data-v-3c63782e"]]);const La={class:"long-info-collection"},Ca=a({__name:"infoCollection",setup(e){const i=ce((()=>pe((()=>import("./index-fc59b4d8.js")),["static/js/index-fc59b4d8.js","static/css/index-fa4edf2a.css","static/js/index-0c89cc8e.js","static/css/index-4d8f96d1.css","static/js/theme-94cf7d00.js","static/js/index-e0b231a7.js","static/css/index-bbfdd7ec.css","static/js/utils-3e3de049.js","static/js/infoCollection-5b1b1163.js","static/js/trial-6a8af0f1.js"]))),a=ce((()=>pe((()=>import("./index-3c72f902.js")),["static/js/index-3c72f902.js","static/css/index-4822eb94.css","static/js/index-0c89cc8e.js","static/css/index-4d8f96d1.css"]))),s=E(),o=Fe(),{productCode:p="",tenantId:f,agentCode:k="",agencyCode:g,saleChannelId:h,isShare:V,orderNo:I,extraInfo:b,insurerCode:L,preview:C}=s.query;let O={};try{O=JSON.parse(decodeURIComponent(b))}catch(ke){}const w=l({isView:!1,personalInfo:{},payInfo:{schema:[],config:[],formData:[]},defaultValue:null,isAutoChange:!1,defaultPlanCode:"",userData:{}}),T=`${window.origin}/baseInsurance/long/phoneVerify${window.location.search}`,R=t({imgUrl:"",desc:"",title:"",link:T}),P=t();t();const S=t(),D=t({}),x=t({}),F=t([]),N=t(),_=t({}),j=t(!1),U=t(!1),M=t(0),B=t(!0),{fileList:q,mustReadFileCount:$,popupFileList:J}=Se(_,N),G=t(!1),z=t(!1),Y=()=>{U.value=!1,B.value=!0,F.value.length<1||(j.value=!0)},Q=()=>{j.value=!1,U.value=!1,B.value=!0};t({}),t(!1),t([{}]);const X=t(""),Z=t(0),W=t(!1);t(),t(),t(),n((()=>{var e,i;const{insureProductRiskVOList:a}=(null==(i=null==(e=x.value)?void 0:e.productPlanInsureVOList)?void 0:i[0])||{};return(a||[]).find((e=>e.mainRiskFlag===ie.YES))}));const ee=t(0);t({});const ae=t(),te=()=>{X.value="试算中...",Z.value=0,W.value=!0},ne=(e,i)=>{X.value="",ee.value=e.premium,Z.value=e,ae.value=i,W.value=!1},se=async()=>{var e,i;if(C)return void oe(_e.INFO_COLLECTION,s.query);if(!Z.value)return;const a=[];S.value&&a.push(null==(e=S.value)?void 0:e.validate(!1)),P.value&&a.push(null==(i=P.value)?void 0:i.validate(!1)),Promise.all(a).then((()=>{if(!G.value)return void K("请勾选投保人阅读并接受");Object.assign(o.value,{extInfo:{...o.value.extInfo,buttonCode:je.INFO_COLLECTION,pageCode:_e.INFO_COLLECTION}});const e=S.value.dealMixData(),i=Ue({...e,productCode:p,productName:x.value.productName},Z.value,o.value);Pe(i,((e,i)=>{i===re.JUMP_PAGE&&ue(e.nextPageCode,s.query)}))}))};l({tenantOrderPayInfoList:[]});const de=async()=>{De({productCode:p,tenantId:f}).then((({data:e,code:i})=>{if("10000"===i){D.value=e;const{wxShareConfig:i,showWXShare:a,title:l,desc:t,image:n}=(null==e?void 0:e.PRODUCT_LIST)||{};a?Object.assign(R.value,{...i,imgUrl:i.image,isShare:a}):Object.assign(R.value,{title:l,desc:t,imgUrl:n,isShare:a}),e.BASIC_INFO&&e.BASIC_INFO.themeType&&ve(e.BASIC_INFO.themeType)}})),I&&await we({orderNo:I,tenantId:f}).then((({code:e,data:i})=>{var a;if("10000"===e){if(Z.value=i.orderAmount,(null==(a=i.insuredList)?void 0:a.length)>0){const{planCode:e}=i.insuredList[0];w.defaultPlanCode=e}Object.assign(o.value,i,{tenantOrderPayInfoList:i.tenantOrderPayInfoList||[],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0,withPayInfo:!0},productCode:p}),w.defaultValue=o.value,z.value=!0}})),xe({productCode:p}).then((({code:e,data:i})=>{var a,l,t,n;if("10000"===e){const{productMaterialPlanVOList:e,productQuestionnaireVOList:s}=i;N.value=e||[];const{basicInfo:{questionnaireType:o},questions:r,questionnaireName:u}=(null==(a=null==s?void 0:s[0])?void 0:a.questionnaireDetailResponseVO)||{basicInfo:{}};o&&(F.value=2===o?[{attachmentName:u,attachmentUri:r,attachmentType:"question"}]:[{attachmentName:u,attachmentUri:null==(l=null==r?void 0:r[0])?void 0:l.content,attachmentType:Ae(String(null==(t=null==r?void 0:r[0])?void 0:t.textType),null==(n=null==r?void 0:r[0])?void 0:n.content)}])}})),await Te({productCode:p,isTenant:!C}).then((({data:e,code:i})=>{var a;if("10000"===i){x.value=e,_.value=e.productPlanInsureVOList.find((e=>!w.defaultPlanCode||e.planCode===w.defaultPlanCode))||{};const{payInfo:i}=H(null==(a=_.value)?void 0:a.productFactor);w.payInfo={...w.payInfo,...i}}}))};return le((()=>{de()})),(e,l)=>{var t,n,s,k,g,h;const I=fe,b=ye;return r(),u("div",La,[d(I),m(z)||m(C)?(r(),v(ba,{key:0,ref_key:"personalInfoRef",ref:S,"data-source":m(_),"product-info":{productCode:m(p),productName:m(x).productName,insurerCode:m(L),tenantId:m(f),planList:m(x).productPlanInsureVOList},"tenant-product-detail":m(D),"hide-benefit":"","default-data":[m(w).defaultValue],onTrialStart:te,onTrialEnd:ne,"onUpdate:userData":l[0]||(l[0]=e=>m(w).userData=e)},null,8,["data-source","product-info","tenant-product-detail","default-data"])):y("",!0),m(w).payInfo.schema.length?(r(),v(m(ge),{key:1,ref_key:"payInfoRef",ref:P,modelValue:m(o).tenantOrderPayInfoList,"onUpdate:modelValue":l[1]||(l[1]=e=>m(o).tenantOrderPayInfoList=e),schema:m(w).payInfo.schema,"is-view":m(w).isView,"user-data":m(w).userData},null,8,["modelValue","schema","is-view","user-data"])):y("",!0),d(b,null,{default:c((()=>{var e;return[(null==(e=m(q))?void 0:e.length)?(r(),v(m(a),{key:0,modelValue:m(G),"onUpdate:modelValue":l[2]||(l[2]=e=>me(G)?G.value=e:null),"has-bg-color":!1,"attachment-list":m(q),"is-show-radio":"","pre-text":"投保人阅读并接受",onPreviewFile:l[3]||(l[3]=e=>(e=>{M.value=e,U.value=!0})(e))},null,8,["modelValue","attachment-list"])):y("",!0)]})),_:1}),m(U)?(r(),v(m(i),{key:2,show:m(U),"onUpdate:show":l[4]||(l[4]=e=>me(U)?U.value=e:null),"content-list":m(B)?m(q):m(J),"is-only-view":m(B),"active-index":m(M),text:m(B)?"关闭":"我已逐页阅读并确认告知内容","force-read-count":m(B)?0:m($),onSubmit:Y,onOnCloseFilePreviewByMask:Q},null,8,["show","content-list","is-only-view","active-index","text","force-read-count"])):y("",!0),d(Re,{"is-share":m(R).isShare&&!m(V),premium:null==(t=m(Z))?void 0:t.initialPremium,"share-info":m(R),"loading-text":m(X),"payment-frequency":(null==(h=null==(g=null==(k=null==(s=null==(n=m(ae))?void 0:n.insuredList)?void 0:s[0].productList)?void 0:k[0].riskList)?void 0:g[0])?void 0:h.paymentFrequency)+"","tenant-product-detail":m(D),"handle-share":e=>(e=>{S.value.validateHolder(["mobile"]).then((()=>{Object.assign(o.value,{extInfo:{...o.value.extInfo,buttonCode:je.INFO_COLLECTION,pageCode:_e.INFO_COLLECTION}});const i=S.value.getUserData(),a=Ue({...ae.value,holder:null==i?void 0:i.holder},Z.value||{},o.value);Pe(a,((i,a)=>{a===re.JUMP_PAGE&&(null==e||e())}))})).catch((()=>{K("请录入投保人手机号后进行分享")}))})(e),disabled:!m(Z),onHandleClick:se},{default:c((()=>[A("下一步")])),_:1},8,["is-share","premium","share-info","loading-text","payment-frequency","tenant-product-detail","handle-share","disabled"])])}}});export{Ca as default};
