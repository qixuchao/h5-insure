import{m as e,ab as a,u as n,r as t,P as r,e as o,a0 as l,o as i,s,ah as u,t as d,C as c,U as v,x as m,L as p,z as f,E as h,v as y,F as I,N as g,H as w,I as b,D as N,T as C,Z as P}from"./vendor-fd650291.js";import{d as T}from"./debounce-d6fb1d89.js";import{_ as F,C as O,a1 as k,I as L,J as D,a4 as H}from"./index-823b7915.js";import{a as S}from"./order-4e224f40.js";import{S as V,R as x,g as A,I as E}from"./infoCollection-15d1d038.js";import{i as j,p as U,g as q,s as M,u as R,a as _}from"./trial-46e5d06e.js";import{p as B}from"./product-9ad33e98.js";import{g as K,o as $,t as Y,a as z,v as J,b as W}from"./utils-19038c4d.js";import{t as G}from"./theme-3c294048.js";import{d as Z,B as Q,D as X,G as ee,S as ae,H as ne,P as te,a as re,U as oe,_ as le,b as ie,W as se,c as ue}from"./auth-f5bd8edb.js";import"./trial-0f930d31.js";import"./check-detail-fc12290b.js";import"./index-2715c7bd.js";import"./bankCard-da82df23.js";import"./phoneVerify-7c2a1f6d.js";import"./index-8434b110.js";import"./loading-1c9c1d7b.js";import"./close-bad1ffb4.js";const de={key:0},ce={class:"page-internet-product-detail"},ve={class:"info"},me={class:"inscribedContent-content"},pe={class:"content"},fe={class:"footer-button"},he={class:"price"},ye=w(" 总保费");var Ie=F(e({setup(e){const F=a(),Ie=n(),{productCode:ge="BWYL2021",tenantId:we,orderNo:be,phoneNo:Ne,agentCode:Ce="",saleChannelId:Pe,paymentMethod:Te,certNo:Fe,name:Oe,pageCode:ke,from:Le}=Ie.query,De=t(),He=t(),Se=t(),Ve=t(),xe=t(),Ae="payBack"===ke,Ee=t(!1),je=t(!1),Ue=t(!1),qe=t(0),Me=t(!1),Re=t(!1),_e=t({show:!1,html:""});let Be="";t(0);const Ke=r({holder:{certNo:Fe,certType:O.CERT,mobile:Ne,name:Oe,socialFlag:V.HAS},insured:{certNo:Fe,certType:O.CERT,name:Oe,socialFlag:V.HAS,relationToHolder:x.SELF},paymentMethod:Te,renewalDK:"Y",paymentFrequency:A.YEAR,packageProductList:[],mobileSmsCode:"",activePlanCode:""}),$e=t(Z),Ye=t(Z),ze=r({showInsure:!Ae,canInsure:!1,canUpgrade:!1}),Je=o((()=>{var e,a,n,t,r,o;return!!Se.value&&!!((null==(a=null==(e=Se.value)?void 0:e.tenantProductInsureVO)?void 0:a.planList)&&Array.isArray(null==(t=null==(n=Se.value)?void 0:n.tenantProductInsureVO)?void 0:t.planList)&&(null==(o=null==(r=Se.value)?void 0:r.tenantProductInsureVO)?void 0:o.planList.length)>0)}));l((()=>Je.value),(()=>{var e,a;Je.value&&(Ke.activePlanCode=null==(a=null==(e=Se.value)?void 0:e.tenantProductInsureVO)?void 0:a.planList[0].planCode)}),{immediate:!0});const We=e=>{Ke.activePlanCode=e},Ge=o((()=>{var e,a;return((null==(a=null==(e=Se.value)?void 0:e.tenantProductInsureVO)?void 0:a.attachmentVOList)||[]).filter((e=>"健康告知"===e.attachmentName))||[]})),Ze=o((()=>{var e,a;return((null==(a=null==(e=Se.value)?void 0:e.tenantProductInsureVO)?void 0:a.attachmentVOList)||[]).filter((e=>"健康告知"!==e.attachmentName))||[]})),Qe=()=>{He.value.handleClickTab()("tab3")},Xe=()=>{F.push({path:"/internet/guaranteeUpgrade",query:{...Ie.query,tenantId:we,productCode:"BWYL2022",orderNo:be,agentCode:Ce}})},ea=()=>{Re.value=!1},aa=()=>{Ye.value=$e.value},na=()=>{Ye.value={...Ye.value,relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1}},ta=e=>`${H}/internet/payFail?tenantId=${we}&orderNo=${e}&agentCode=${Ce}&pageCode=payBack&from=${Le||"normal"}`,ra=async e=>{const a=z({tenantId:we,saleUserId:Ce,saleChannelId:Pe,detail:Se.value,insureDetail:Ve.value,paymentMethod:Ke.paymentMethod,paymentFrequency:Ke.paymentFrequency,renewalDK:Ke.renewalDK,iseeBizNo:Be,successJumpUrl:"",premium:xe.value,holder:Ke.holder,insured:Ke.insured,tenantOrderRiskList:e,orderStatus:"",orderTopStatus:""});try{const e=await M(a),{code:t,data:r}=e;"10000"===t&&(async e=>{C.loading({message:"核保中...",forbidClick:!0});try{const a=await R(e),{code:n}=a;if("10000"===n){C.loading({message:"核保中...",forbidClick:!0});const a=await _({orderNo:e.orderNo,tenantId:we}),{data:n}=a;"10000"===a.code&&(2===n.type?(_e.value={show:!0,html:n.paymentUrl},P((()=>{const e=document.getElementById("cashierSubmit");null==e||e.addEventListener("submit",(e=>{e.preventDefault()})),null==e||e.submit()}))):window.location.href=n.paymentUrl)}ze.canInsure=!0}catch(a){ze.canInsure=!0}})({...a,orderNo:r.data,extInfo:{extraInfo:{renewalDK:Ke.renewalDK,paymentMethod:Ke.paymentMethod,paymentFrequency:Ke.paymentFrequency,successJumpUrl:(n=r.data,`${H}/pay?orderNo=${n}&saleUserId=${Ce}&tenantId=${we}`),failUrl:ta(r.data)},iseeBizNo:Be}})}catch(t){ze.canInsure=!0}var n},oa=()=>new Promise(((e,a)=>{var n,t;null==(t=null==(n=De.value)?void 0:n.validateForm)||t.call(n).then((async()=>{var n;if(!(()=>{if(Ke.holder.certNo){const e=W(Ke.holder.certNo,"year"),a=D(Ke.holder.certNo);if(e<18)return C("投保人年龄必须大于18岁！"),!1;if(Ke.insured.certNo&&Ke.insured.relationToHolder===x.MATE&&a===D(Ke.insured.certNo))return C("被保人为配偶时，性别不可相同！"),!1}if(Ke.insured.certNo){const e=W(Ke.insured.certNo,"day"),a=W(Ke.insured.certNo,"year");if(Ke.insured.relationToHolder===x.CHILD&&e<30)return C("被保人为子女时，年龄必须大于等于30天！"),!1;if(Ke.insured.relationToHolder===x.PARENT&&a>=71)return C("被保人为父母时，年龄必须小于等于70岁！"),!1}if([x.CHILD,x.PARENT].includes(Ke.insured.relationToHolder)){const e=W(Ke.holder.certNo,"year"),a=W(Ke.insured.certNo,"year");if(Ke.insured.relationToHolder===x.CHILD&&e-a<18)return C("投保人和子女年龄必须相差18岁！"),!1;if(Ke.insured.relationToHolder===x.PARENT&&a-e<18)return C("投保人和父母年龄必须相差18岁！"),!1}return!0})())return void(ze.canInsure=!0);if(!((null==(n=De.value)?void 0:n.isAgreeFile)||Ee.value))return Ee.value=!1,Ue.value=!0,t=0,qe.value=t,void(Ue.value=!0);var t;const{calcData:r,riskVOList:o}=K({holder:Ke.holder,insured:Ke.insured,tenantId:we,productDetail:Se.value,insureDetail:Ve.value,paymentFrequency:Ke.paymentFrequency,packageRiskIdList:$(Ke.packageProductList)},!1,J);(!Array.isArray(o)||o.length<1)&&(xe.value=null,a(new Error));const l=await U(r),{code:i,data:s}=l;"10000"===i?(xe.value=s.premium,e({condition:o,data:s})):(xe.value=null,a(new Error))})).catch((()=>{ze.canInsure=!0}))})),la=e=>{"allFalse"===e?(je.value=!1,Ee.value=!0,(async()=>{var e;if(Ae)Xe();else{ze.canInsure=!1;try{const{condition:a,data:n}=await oa(),t={},r=(e=[])=>{(e||[]).forEach((e=>{var a;t[e.riskCode]=e,(null==(a=e.riskPremiumDetailVOList)?void 0:a.length)&&r(e.riskPremiumDetailVOList)}))};r(n.riskPremiumDetailVOList);const o=Y({tenantId:we,riskList:a,riskPremium:t,productId:null==(e=Se.value)?void 0:e.id});ra(o)}catch(a){ze.canInsure=!0}}})(),ze.canInsure=!0):N.confirm({message:"您当前的健康状况不符合该产品",confirmButtonText:"确定"}).then((()=>{window.history.back()})).catch((()=>{var e;null==(e=De.value)||e.reEditForm(),Ee.value=!1,ze.canInsure=!0}))},ia=()=>{var e;null==(e=De.value)||e.reEditForm(),Ee.value=!1,ze.canInsure=!0},sa=()=>{je.value=!1,ia()},ua=()=>{Ue.value=!1,ia()},da=()=>{Ue.value=!1,je.value=!0};l([()=>Ke.insured.certNo,()=>Ke.insured.socialFlag,()=>Ke.packageProductList,()=>Ke.paymentFrequency],T((()=>{Ke.insured.certNo&&Ke.insured.socialFlag&&(()=>{const{holder:{certNo:e,mobile:a,name:n,socialFlag:t},insured:{certNo:r,name:o,socialFlag:l,relationToHolder:i},paymentMethod:s}=Ke;return!(!L(r)||!l)})()&&(async()=>{const{calcData:e,riskVOList:a}=K({holder:Ke.holder,insured:Ke.insured,tenantId:we,productDetail:Se.value,insureDetail:Ve.value,paymentFrequency:Ke.paymentFrequency,packageRiskIdList:$(Ke.packageProductList)},!1,J);if(!Array.isArray(a)||a.length<1)return xe.value=null,{};const n=await U(e),{code:t,data:r}=n;"10000"===t?xe.value=r.premium:xe.value=null})()}),500),{deep:!0,immediate:!0});const ca=async()=>{var e,a,n,t,r,o,l,i,s,u,d,c,v;const m=await q({orderNo:be,tenantId:we}),{code:p,data:f}=m;if("10000"===p){const{tenantOrderHolder:m,tenantOrderInsuredList:p,extInfo:h}=f;if(!Ae)return Object.assign(Ke,{holder:{certNo:m.certNo,certType:m.certType,mobile:m.mobile,name:m.name,socialFlag:V.HAS},insured:{certNo:null==p?void 0:p[0].certNo,certType:null==(e=p[0])?void 0:e.certType,name:null==(a=p[0])?void 0:a.name,socialFlag:null==(t=null==(n=p[0])?void 0:n.extInfo)?void 0:t.hasSocialInsurance,relationToHolder:null==(r=p[0])?void 0:r.relationToHolder},paymentMethod:h.extraInfo.paymentMethod,paymentFrequency:h.extraInfo.paymentFrequency,renewalDK:h.extraInfo.renewalDK||"N"}),void(ze.canInsure=!0);Object.assign(Ke,{holder:{certNo:m.certNo,certType:m.certType,mobile:m.mobile,name:m.name,socialFlag:V.HAS},insured:{certNo:null==p?void 0:p[0].certNo,certType:null==(o=p[0])?void 0:o.certType,name:null==(l=p[0])?void 0:l.name,socialFlag:null==(s=null==(i=p[0])?void 0:i.extInfo)?void 0:s.hasSocialInsurance,relationToHolder:null==(u=p[0])?void 0:u.relationToHolder},paymentMethod:h.extraInfo.paymentMethod,paymentFrequency:h.extraInfo.paymentFrequency,renewalDK:h.extraInfo.renewalDK||"N"}),xe.value=null==(v=null==(c=null==(d=p[0])?void 0:d.tenantOrderProductList)?void 0:c[0])?void 0:v.premium,f.orderStatus!==S.ACCEPT_POLICY&&f.orderStatus!==S.PAYMENT_SUCCESS||(ze.canUpgrade=!0,Me.value=!1,Re.value=!0),f.orderStatus===S.PAYING&&(Me.value=!0,setTimeout((()=>{ca()}),3e3))}};return i((()=>{Ye.value=ue,$e.value=ue,ze.canInsure=!0,(async()=>{const e=B({productCode:ge,withInsureInfo:!0,tenantId:we}),a=j({productCode:ge});await Promise.all([e,a]).then((([e,a])=>{var n,t;"10000"===e.code&&(Se.value={...e.data},document.title=(null==(n=e.data)?void 0:n.productFullName)||""),"10000"===a.code&&(Ke.packageProductList=((null==(t=a.data)?void 0:t.packageProductVOList)||[]).map((e=>({...e,value:E.UN_INSURE,disabled:!1}))),Ve.value=a.data)})),be&&ca()})(),setTimeout((async()=>{Be=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,a)=>{const n=s("van-button"),t=s("van-config-provider"),r=u("dompurify-html");return d(),c(b,null,[v(t,{"theme-vars":I(G)},{default:m((()=>{var e,a,t,o,l,i,s,u,b,N,C;return[_e.value.show?p((d(),c("div",de,null,512)),[[r,_e.value.html]]):f("",!0),h("div",ce,[h("div",ve,[v(Q,{url:null==(a=null==(e=Se.value)?void 0:e.tenantProductInsureVO)?void 0:a.banner[0]},null,8,["url"]),(null==(o=null==(t=Se.value)?void 0:t.tenantProductInsureVO)?void 0:o.bannerMove)?(d(),y(Q,{key:0,url:null==(i=null==(l=Se.value)?void 0:l.tenantProductInsureVO)?void 0:i.bannerMove[0],onClick:Qe},null,8,["url"])):f("",!0),v(X,{"product-name":null==(s=Se.value)?void 0:s.productFullName,"product-desc":null==(b=null==(u=Se.value)?void 0:u.showConfigVO)?void 0:b.desc},null,8,["product-name","product-desc"])]),v(ee,{"show-service-config":"","data-source":null==(N=Se.value)?void 0:N.tenantProductInsureVO,"show-config":null==(C=Se.value)?void 0:C.showConfigVO,"is-multiple-plan":I(Je),"active-plan-code":I(Ke).activePlanCode,onUpdateActivePlan:We},null,8,["data-source","show-config","is-multiple-plan","active-plan-code"]),v(ae,{ref_key:"detailScrollRef",ref:He,detail:Se.value},{form:m((()=>{var e,a;return[v(ne,{ref_key:"formRef",ref:De,"is-show-package":"",disable:!I(ze).showInsure,"form-auth":Ye.value,"form-info":I(Ke),"product-detail":Se.value,onOnReset:aa,onOnUpdate:na},null,8,["disable","form-auth","form-info","product-detail"]),v(te,{"form-info":I(Ke),"product-detail":Se.value,"show-config":null==(e=Se.value)?void 0:e.showConfigVO},null,8,["form-info","product-detail","show-config"]),h("div",me,[p(h("div",pe,null,512),[[r,null==(a=Se.value)?void 0:a.tenantProductInsureVO.inscribedContent]])])]})),_:1},8,["detail"]),h("div",fe,[h("div",he,[ye,h("span",null,g(xe.value?"￥":"")+g(I(k)(xe.value))+" "+g(xe.value?I(Ke).paymentFrequency==I(A).YEAR?"元/年":"元/月":""),1)]),v(n,{type:"primary",class:"right",disabled:!(I(ze).canInsure||I(ze).canUpgrade)},{default:m((()=>[w(g(I(ze).showInsure?"立即投保":"升级保障"),1)])),_:1},8,["disabled"])])]),I(be)?f("",!0):(d(),y(re,{key:1,"product-detail":Se.value},null,8,["product-detail"])),v(oe,{"order-no":I(be),"tenant-id":I(we),"is-show":Re.value,onOnConfirm:Xe,onOnClose:ea},null,8,["order-no","tenant-id","is-show"])]})),_:1},8,["theme-vars"]),v(le,{show:je.value,"onUpdate:show":a[0]||(a[0]=e=>je.value=e),"content-list":I(Ge),"active-index":0,onOnConfirmHealth:la,onOnCloseHealth:sa},null,8,["show","content-list"]),Ue.value?(d(),y(ie,{key:0,show:Ue.value,"onUpdate:show":a[1]||(a[1]=e=>Ue.value=e),"content-list":I(Ze),"active-index":qe.value,text:"我已逐页阅读并确认告知内容","force-read-cound":0,"on-close-file-preview":"",onSubmit:da,onOnCloseFilePreview:ua},null,8,["show","content-list","active-index"])):f("",!0),v(se,{"is-show":Me.value},null,8,["is-show"])],64)}}}),[["__scopeId","data-v-0bc03bc3"]]);export{Ie as default};
