import{n as e,o as n,m as a,p as t}from"./infoCollection-a2cc3706.js";import{$ as l,_ as i,d as o,r,z as u,a7 as s,x as c,G as m,a2 as d,aq as f,as as p,b as v,c as y,g as I,f as D,w as g,i as P,l as V,j as k,t as C,ay as O,F as E,n as b,K as S,L as Y,e as h,h as L,B as N,T as F}from"./index-6a34609b.js";import{u as q}from"./useDicData-c8a3ea4e.js";import{k as x}from"./trial-1f83dd78.js";import{o as T}from"./utils-a24353e4.js";import"./pdfdist-5d72820d.js";import"./useStorage-da385c53.js";const M=(e,n="YYYY-MM-DD")=>l(e).format(n),_=(e,n=0,a="day",t="YYYY-MM-DD")=>l(e).add(n,a).format(t),R=(e,n=0,a="day",t="YYYY-MM-DD")=>l(e).subtract(n,a).format(t);const w=e=>(S("data-v-986cd31c"),e=e(),Y(),e),U={class:"com-period-cell"},$={key:0,class:"period-custom-cell period-check-btn-cell"},j=w((()=>P("div",{class:"period-cell-label"},"保障期间",-1))),A={class:"period-cell-content"},B=w((()=>P("div",{class:"period-cell-label"},"生效日期",-1))),G={class:"period-cell-content period-custom-cell-content"},H={key:2,class:"period-custom-cell period-common-cell"},K=w((()=>P("div",{class:"period-cell-label"},"保障期限",-1))),X={class:"period-cell-content"},z=w((()=>P("div",{class:"picker-custom-title"},"保险开始生效日期",-1))),J=b("确 定");var Q=i(o({props:{formInfo:{type:Object,default:()=>{}},insureDetail:{type:Object,default:()=>{}}},emits:["onReset","onUpdate","onVerify"],setup(a,{expose:t,emit:l}){const i=a;r({});const o=(e,n)=>"year"===e?`${n}年`:"month"===e?`${n}月`:"day"===e?`${n}日`:n,b=r(new Date),S=q("RISK_INSURANCE_PERIOD"),Y=u({formInfo:i.formInfo});s((()=>Y.formInfo.insuranceStartDate),(e=>{e&&"string"==typeof e&&(b.value=new Date(e))}));const h=r(),L=r([]);s([()=>i.insureDetail,()=>Y.formInfo.activePlanCode],(()=>{var e;if(Y.formInfo.insuranceStartDate="",Y.formInfo.insuranceEndDate="",Y.formInfo.commencementTime="",i.insureDetail)if(i.insureDetail.productRelationPlanVOList&&i.insureDetail.productRelationPlanVOList.length>0){let n=0;const a=i.insureDetail.productRelationPlanVOList.findIndex((e=>e.planCode===Y.formInfo.activePlanCode));a>-1&&(n=a);const t=((null==(e=i.insureDetail.productRelationPlanVOList[n])?void 0:e.productRiskVoList[0].riskDetailVOList)||[]).find((e=>1===e.riskType));t&&(h.value=t)}else{const e=(i.insureDetail.productRiskVoList[0].riskDetailVOList||[]).find((e=>1===e.riskType));e&&(h.value=e)}}),{deep:!0,immediate:!0}),s([()=>h.value,()=>S.value],(()=>{L.value=[],Array.isArray(S.value)&&S.value.length>1&&h.value&&(L.value=(h.value.riskInsureLimitVO.insurancePeriodValueList||[]).map((e=>{const n=S.value.find((n=>n.value===e));return n?{label:n.name,value:n.value}:null})).filter((e=>!!e))),L.value.length>0?L.value.findIndex((e=>e.value===Y.formInfo.insurancePeriodValue))<0&&(Y.formInfo.insurancePeriodValue=L.value[0].value):Y.formInfo.insurancePeriodValue=x.YEAR_1}),{deep:!0,immediate:!0});const N=c((()=>{var n,a;return(null==(n=h.value)?void 0:n.insuranceStartType)?String(null==(a=h.value)?void 0:a.insuranceStartType):e.CURRENT_DAY})),F=c((()=>{var e,a;return(null==(e=h.value)?void 0:e.insuranceEndType)?String(null==(a=h.value)?void 0:a.insuranceEndType):n.CURRENT_DAY})),[T,w]=m(!1),Q=()=>{w(!0)},W=new Date(_(new Date,1,"day")),Z=c((()=>{var n;if(N.value===e.CUSTOM_DAY){const e=null==(n=h.value)?void 0:n.riskInsureLimitVO.maxInsuranceDay;if(!e)return new Date;const a=_(new Date,Number(e),"day");return new Date(a)}return new Date})),ee=e=>{Y.formInfo.insuranceStartDate=`${M(e)} 00:00:00`,w(!1)},ne=()=>{w(!1)};return s([()=>N.value,()=>Y.formInfo.insurancePeriodValue,()=>Y.formInfo.insuranceStartDate,()=>h.value],(()=>{if(i.insureDetail){const{productBasicInfoVO:e}=i.insureDetail;if(e&&"CX48"===e.productCode){Y.formInfo.insuranceStartDate=`${_(new Date,7,"day")} 00:00:00`;const e=`${R(Y.formInfo.insuranceStartDate,1,"day")} 00:00:00`;return void(Y.formInfo.insuranceEndDate=`${_(e,1,"year")} 23:59:59`)}}if(!Y.formInfo.insurancePeriodValue)return;const[a,t]=Y.formInfo.insurancePeriodValue.split("_");if(Y.formInfo.insuranceStartDate||(N.value===e.CUSTOM_DAY||N.value===e.NEXT_DAY?Y.formInfo.insuranceStartDate=`${_(new Date,1,"day")} 00:00:00`:Y.formInfo.insuranceStartDate=`${M(new Date)} 00:00:00`),"to"!==a){const e=`${R(Y.formInfo.insuranceStartDate,1,"day")} 00:00:00`;F.value===n.CURRENT_DAY?Y.formInfo.insuranceEndDate=`${_(e,Number(t),a)} 23:59:59`:Y.formInfo.insuranceEndDate=`${_(Y.formInfo.insuranceStartDate,Number(t),a)} 00:00:00`}else{let e=Y.formInfo.tenantOrderInsuredList[0].birthday;Y.formInfo.tenantOrderInsuredList[0].certType===d.CERT&&Y.formInfo.tenantOrderInsuredList[0].certNo&&f(Y.formInfo.tenantOrderInsuredList[0].certNo)&&(e=p(Y.formInfo.tenantOrderInsuredList[0].certNo));const l=`${R(e,1,"day")} 00:00:00`;"single"===t&&(Y.formInfo.insuranceEndDate="9999-99-99 23:59:59"),F.value===n.CURRENT_DAY?Y.formInfo.insuranceEndDate=`${_(l,Number(t),a)} 23:59:59`:Y.formInfo.insuranceEndDate=`${_(e,Number(t),a)} 00:00:00`}}),{immediate:!0}),t({}),(n,a)=>{const t=v("ProRadioButton"),l=v("ProSvg"),i=v("van-config-provider"),r=v("VanButton"),u=v("van-datetime-picker"),s=v("ProPopup");return y(),I(E,null,[D(i,null,{default:g((()=>[P("div",U,[L.value.length>1?(y(),I("div",$,[j,P("div",A,[D(t,{modelValue:V(Y).formInfo.insurancePeriodValue,"onUpdate:modelValue":a[0]||(a[0]=e=>V(Y).formInfo.insurancePeriodValue=e),options:L.value},null,8,["modelValue","options"])])])):k("",!0),V(N)===V(e).CUSTOM_DAY?(y(),I("div",{key:1,class:"period-custom-cell period-common-cell",onClick:Q},[B,P("div",G,[P("span",null,C(V(Y).formInfo.insuranceStartDate?V(M)(V(Y).formInfo.insuranceStartDate,"YYYY.MM.DD HH:mm:ss"):""),1),D(l,{class:"custom--arrow-right",name:"arrow-right"})])])):k("",!0),V(N)!==V(e).CUSTOM_DAY?(y(),I("div",H,[K,P("div",X,C(V(Y).formInfo.insuranceStartDate?V(M)(V(Y).formInfo.insuranceStartDate,"YYYY.MM.DD"):"")+"-"+C(V(Y).formInfo.insuranceEndDate?V(M)(V(Y).formInfo.insuranceEndDate,"YYYY.MM.DD"):""),1)])):k("",!0)])])),_:1}),D(s,{show:V(T),"onUpdate:show":a[3]||(a[3]=e=>O(T)?T.value=e:null),height:"340",closeable:!0},{default:g((()=>[D(u,{modelValue:b.value,"onUpdate:modelValue":a[2]||(a[2]=e=>b.value=e),type:"date",title:"保险开始生效日期","min-date":V(W),"max-date":V(Z),formatter:o,"visible-item-count":5,class:"custom-date-picker",onConfirm:ee,onCancel:ne},{cancel:g((()=>[])),title:g((()=>[z])),confirm:g((()=>[D(r,{type:"primary",round:"",block:"",class:"linear-btn custom-picker-btn",onClick:a[1]||(a[1]=e=>T.value=!1)},{default:g((()=>[J])),_:1})])),_:1},8,["modelValue","min-date","max-date"])])),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-986cd31c"]]);const W=e=>(S("data-v-679123b1"),e=e(),Y(),e),Z={class:"com-payment-type"},ee={class:"title"},ne={key:0,class:"picture-payment-content"},ae=["onClick"],te=["src"],le=["src"],ie={key:1,class:"custom-cell check-btn-cell"},oe=W((()=>P("div",{class:"cell-label"},"保障方案",-1))),re={class:"cell-content"},ue={key:0,class:"picture-payment-content"},se=["onClick"],ce=["src"],me=["src"],de={key:1,class:"default-payment-content"},fe=[W((()=>P("div",{class:"pay-method"},[P("span",{class:"method"},C("按月交费")),P("span",{class:"acount"},C("共12期"))],-1)))],pe=[W((()=>P("div",null,[P("div",{class:"tip"},[P("span",null,C("比按月支付最高省16%"))]),P("div",{class:"triangle"}),P("div",{class:"pay-method"},[P("span",{class:"method"},C("一次交清")),P("span",{class:"acount"},C("比月交保费省最高2014元"))])],-1)))],ve={key:2,class:"custom-cell check-btn-cell"},ye=W((()=>P("div",{class:"cell-label"},"交费方式",-1))),Ie={class:"cell-content"},De={class:"custom-cell common-cell"},ge=W((()=>P("div",{class:"cell-label"},"实付保费",-1))),Pe={key:0,class:"cell-content actual-premium"},Ve={class:"cell-content actual-premium"},ke={key:0,class:"actual-premium actual-premium-month-tip"},Ce={key:0,class:"feerate-explain"},Oe={class:"content"},Ee=W((()=>P("div",{class:"triangle-top"},null,-1)));var be=i(o({props:{formInfo:{type:Object,default:()=>{}},insureDetail:{type:Object,default:()=>{}},configDetail:{type:Object,default:()=>{}},isMultiplePlan:{type:Boolean,default:!1},premiumInfo:{type:Object,default:()=>{}}},emits:["update-active-plan"],setup(e,{expose:n,emit:l}){const i=e;r({});const o=u({formInfo:i.formInfo}),m=r([]),d=r(),f=r(),p=c((()=>{var e;return"1"===String(null==(e=d.value)?void 0:e.paymentFrequencyFlag)}));c((()=>{var e;return null==(e=f.value)?void 0:e.productPremiumVOList.find((e=>e.paymentFrequency===o.formInfo.paymentFrequency))}));const O=c((()=>i.premiumInfo.premiumLoadingText?i.premiumInfo.premiumLoadingText:i.premiumInfo.premium?`${i.premiumInfo.premium||""}${i.premiumInfo.actualUnit||"元"}`:`${i.premiumInfo.minPremiun||""}${i.premiumInfo.unit||""}`)),b=c((()=>{if(f){const{premiumExplain:e,premiumExplainViewName:n,premiumExplainUri:a}=f.value||{};return{premiumExplain:e,premiumExplainUri:a,premiumExplainViewName:n}}return null})),S=c((()=>b.value&&b.value.premiumExplain&&b.value.premiumExplainViewName));s((()=>i.configDetail),(()=>{var e;i.isMultiplePlan&&i.configDetail&&(m.value=null==(e=i.configDetail.tenantProductInsureVO)?void 0:e.planList)}),{immediate:!0,deep:!0}),s([()=>i.configDetail,()=>i.isMultiplePlan,()=>o.formInfo.activePlanCode],(()=>{if(i.configDetail)if(i.isMultiplePlan){let e=0;const n=i.configDetail.tenantProductInsureVO.planList.findIndex((e=>e.planCode===o.formInfo.activePlanCode));n>-1&&(e=n),d.value=i.configDetail.tenantProductInsureVO.planList[e].productPlanInsureConditionVO,f.value=i.configDetail.tenantProductInsureVO.planList[e]}else d.value=i.configDetail.tenantProductInsureVO.planInsureVO.productPlanInsureConditionVO,f.value=i.configDetail.tenantProductInsureVO.planInsureVO}),{deep:!0,immediate:!0});const Y=c((()=>{var e;if(d.value&&d.value.paymentFrequency){return((null==(e=d.value.paymentFrequency)?void 0:e.split(","))||[]).length>1}return!1})),q=r(!1);s((()=>d.value),(()=>{var e;if(d.value){const n=(null==(e=d.value.paymentFrequency)?void 0:e.split(","))||[];if(1===n.length)return o.formInfo.paymentFrequency=d.value.paymentFrequency,void(q.value=!1);if(2===n.length&&n.filter((e=>![a.SINGLE,a.MONTH].includes(e))).length<1)return q.value=!0,void(o.formInfo.paymentFrequency||(o.formInfo.paymentFrequency=a.SINGLE));n.length>1&&!o.formInfo.paymentFrequency&&(o.formInfo.paymentFrequency=null==n?void 0:n[0]),q.value=!1}}),{immediate:!0,deep:!0});const x=c((()=>{var e;return d.value?null==(e=d.value.paymentFrequencyList||[])?void 0:e.map((e=>({...e,paymentFrequency:e.skinValue}))):[]})),M=c((()=>x.value.length>0)),_=c((()=>i.isMultiplePlan?i.configDetail.tenantProductInsureVO.planList.map((e=>e.planPicList?{...e.planPicList,planCode:e.planCode,planName:e.planName}:null)).filter((e=>!!e)):[])),R=c((()=>{var e,n;if(d.value){const a=(null==(e=d.value.paymentFrequency)?void 0:e.split(","))||[];return 1===a.length&&(o.formInfo.paymentFrequency=a[0]),null==(n=a||[])?void 0:n.map((e=>({label:t[e],value:e})))}return[]})),w=e=>{o.formInfo.paymentFrequency=e},U=e=>{o.formInfo.activePlanCode=e},$=()=>{var e,n;(null==(e=b.value)?void 0:e.premiumExplainUri)?T({fileType:"pdf",fileUri:null==(n=b.value)?void 0:n.premiumExplainUri}):F("无费率文件！")};return n({}),(n,t)=>{const l=v("ProRadioButton"),r=v("templat"),u=v("ProDivider"),s=v("van-config-provider");return y(),h(s,null,{default:g((()=>[P("div",Z,[P("div",ee,C(V(Y)?"交费方式":"保障计划"),1),e.isMultiplePlan?(y(),I(E,{key:0},[V(_).length>0?(y(),I("div",ne,[(y(!0),I(E,null,L(V(_),(e=>(y(),I("div",{key:e.planCode,class:N("picture-payment-item"),onClick:n=>U(e.planCode)},[V(o).formInfo.activePlanCode==e.planCode?(y(),I("img",{key:0,src:e.selectedPic},null,8,te)):(y(),I("img",{key:1,src:e.unSelectedPic},null,8,le))],8,ae)))),128))])):(y(),I("div",ie,[oe,P("div",re,[D(l,{modelValue:V(o).formInfo.activePlanCode,"onUpdate:modelValue":t[0]||(t[0]=e=>V(o).formInfo.activePlanCode=e),options:m.value,prop:{value:"planCode",label:"planName"},onChange:U},null,8,["modelValue","options"])])]))],64)):k("",!0),V(p)?(y(),h(r,{key:1},{default:g((()=>[V(M)&&V(x).length>1?(y(),I("div",ue,[(y(!0),I(E,null,L(V(x),(e=>(y(),I("div",{key:e.paymentFrequency,class:N("picture-payment-item"),onClick:n=>w(e.paymentFrequency)},[V(o).formInfo.paymentFrequency==e.paymentFrequency?(y(),I("img",{key:0,src:e.selectedPic},null,8,ce)):(y(),I("img",{key:1,src:e.unSelectedPic},null,8,me))],8,se)))),128))])):q.value?(y(),I("div",de,[P("div",{class:N("com-payment-type-item "+(V(o).formInfo.paymentFrequency==V(a).MONTH?"active":"")),onClick:t[1]||(t[1]=e=>w(V(a).MONTH))},fe,2),P("div",{class:N("com-payment-type-item "+(V(o).formInfo.paymentFrequency==V(a).SINGLE?"active":"")),onClick:t[2]||(t[2]=e=>w(V(a).SINGLE))},pe,2)])):V(R).length>1?(y(),I("div",ve,[ye,P("div",Ie,[D(l,{modelValue:V(o).formInfo.paymentFrequency,"onUpdate:modelValue":t[3]||(t[3]=e=>V(o).formInfo.paymentFrequency=e),options:V(R)},null,8,["modelValue","options"])])])):k("",!0)])),_:1})):k("",!0),D(Q,{"form-info":V(o).formInfo,"insure-detail":e.insureDetail,"config-detail":e.configDetail},null,8,["form-info","insure-detail","config-detail"]),V(O)&&V(S)?(y(),I(E,{key:2},[P("div",De,[ge,i.premiumInfo.premiumLoadingText?(y(),I("div",Pe,C(V(O)),1)):(y(),I(E,{key:1},[P("div",Ve,C(V(O)),1),"5"===V(o).formInfo.paymentFrequency?(y(),I("div",ke," 共12期 ")):k("",!0)],64))]),V(S)?(y(),I("div",Ce,[P("div",Oe,[Ee,P("div",null,[P("span",null,C(V(b).premiumExplain||""),1),P("span",{class:"file-name",onClick:$},"《"+C(V(b).premiumExplainViewName||"")+"》",1)])])])):k("",!0)],64)):k("",!0)]),D(u)])),_:1})}}}),[["__scopeId","data-v-679123b1"]]);export{be as default};
