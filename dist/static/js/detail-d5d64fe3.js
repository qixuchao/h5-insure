import{d as e,r as t,c as a,g as l,i as n,j as o,f as i,w as r,n as u,t as s,ae as d,F as c,ck as v,B as f,b0 as m,a$ as p,bZ as h,a as y,u as I,G as C,C as O,b,e as w,m as x,h as j,T as L,a3 as N,P as g,aE as k,aP as E,a7 as T,bT as _,a8 as V}from"./index-5239afda.js";import{g as P,i as S}from"./trial-f5b40a6d.js";import R from"./index-51fa9b60.js";import{s as H}from"./verify-a2744578.js";import{n as U}from"./nextStep-eea0eacf.js";import{p as A}from"./product-079656a3.js";import{O as B,a as D}from"./order-305ca51f.js";import F from"./index-04cde60b.js";import $ from"./index-7a1a03f4.js";import{u as G}from"./useDicData-2fe3e43e.js";import{a as q}from"./trial-04861e1a.js";import"./pdfh5-008ca364.js";import"./infoCollection-2434be00.js";import"./relativeTime-fde2a46e.js";import"./validator-5a13dc82.js";import"./core-19e81f25.js";import"./constant-c3f28a3b.js";import"./theme-65292714.js";import"./utils-40e09760.js";const z={class:"sign-wrap"},W=["src"],Y={class:"popup-body"},Z={class:"sign-container-wrap"},M={class:"operate-bar"},J=u(" 请投保人正楷签署您的签名:"),K={class:"btns"},Q=u("返回"),X=u("重写"),ee=u("确定签字"),te=e({props:{option:{default:{}},modelValue:{default:""}},emits:["update:modelValue"],setup(e,{emit:h}){const y=t(!1),I=t(),C=t(""),O=t(!0),b=()=>{var e;y.value=!0,null==(e=I.value)||e.clear()},w=()=>{v({images:[C.value],className:"customer-sign-preview"})},x=()=>{y.value=!1},j=()=>{var e,t;null==(t=null==(e=I.value)?void 0:e.clear)||t.call(e)},L=()=>{var e;C.value=null==(e=I.value)?void 0:e.save(),h("update:modelValue",C.value),y.value=!1};return(e,t)=>{const v=f,h=m,N=p;return a(),l(c,null,[n("div",z,[C.value?(a(),l("img",{key:0,class:"preview-sign",src:C.value,alt:"",onClick:w},null,8,W)):o("",!0),i(v,{type:"primary",round:"",size:"small",onClick:b},{default:r((()=>[u(s(C.value?"重新签名":"点击签字"),1)])),_:1})]),i(N,{show:y.value,"onUpdate:show":t[1]||(t[1]=e=>y.value=e),position:"bottom",style:{height:"100%",overflow:"hidden"}},{default:r((()=>[n("div",Y,[n("div",Z,[i(d,{ref_key:"signRef",ref:I,placeholder:"请在此处签名",onStroke:t[0]||(t[0]=e=>O.value=!1)},null,512),n("div",M,[n("span",null,[i(h,{name:"info",color:"#ffaf22"}),J]),n("div",K,[i(v,{type:"default",class:"btn",onClick:x},{default:r((()=>[Q])),_:1}),i(v,{type:"default",class:"btn",onClick:j},{default:r((()=>[X])),_:1}),i(v,{type:"primary",class:"btn",disabled:O.value,onClick:L},{default:r((()=>[ee])),_:1},8,["disabled"])])])])])])),_:1},8,["show"])],64)}}});const ae={key:0,class:"net-sale-detail-wrap"},le={class:"sign-cell"},ne=n("div",{class:"sign-label"},"签名",-1),oe={class:"footer"},ie={class:"footer"},re=e({setup(e){const u=h(),s=y(),d=I(),{orderNo:v="2022113021181894998",tenantId:f="9991000001"}=s.query,m=t({}),p=t(!1),z=G("NATIONAL_REGION_CODE"),W=t({commencementTime:"",expiryDate:"",extInfo:{buttonCode:"EVENT_NETSALE_airSignature",pageCode:"infoCollection",templateId:3,iseeBizNo:""},orderCategory:1,tenantId:f,venderCode:"",tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}],tenantOrderProductList:[{}]}],tenantOrderSubjectList:[{extInfo:{subjectRelatedFirm:"",subjectRelatedUserId:""},subjectName:"",subjectObjectType:"HOLDER",subjectType:"GENERAL",subjectNo:"",tenantId:f}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}}),Y=t(!1),Z=t(),M=t(),J=t(),K=t(""),Q=t(""),X=t(!1),ee=t(!1),re=t(0),ue=t([]),se=t(""),de=t("");t("");const ce=t([]),ve=()=>{X.value=!1,ee.value=!1},fe=async()=>{X.value=!1,ee.value=!0,await H("HOLDER",K.value,W.value.id,`${f}`),U(W.value)},me=async()=>{const{data:e,code:t}=await A({productCode:de.value,tenantId:f,withInsureInfo:!0});"10000"===t&&(J.value=e,(()=>{var e,t,a,l,n,o;let i={};if(i=Q.value?(null==(a=((null==(t=null==(e=J.value)?void 0:e.tenantProductInsureVO)?void 0:t.planList)||[]).find((e=>e.planCode===Q.value)))?void 0:a.attachmentVOList)||[]:(null==(o=null==(n=null==(l=J.value)?void 0:l.tenantProductInsureVO)?void 0:n.planInsureVO)?void 0:o.attachmentVOList)||[],!i)return void(ue.value=[]);const r={2:"richText",3:"link"};ue.value=Object.keys(i).map((e=>(i[e].forEach((e=>{if("1"===e.attachmentType){const t=e.attachmentUri.split("?"),a=t[0].substr(t[0].lastIndexOf(".")+1);e.attachmentType="pdf"===a?"pdf":"picture"}else e.attachmentType=r[e.attachmentType]})),{attachmentName:e,attachmentList:i[e]})))||[],ce.value=ue.value.map((e=>({attachmentName:e.attachmentName,attachmentList:e.attachmentList.filter((e=>e.mustReadFlag===V.YES))}))).filter((e=>e.attachmentList.length))})())},pe=async()=>{var e;const{code:t,data:a}=await P({orderNo:v,tenantId:f});"10000"===t&&(a.extInfo.buttonCode="EVENT_NETSALE_airSignature",W.value=a,Q.value=null==(e=a.tenantOrderInsuredList[0])?void 0:e.planCode,de.value=a.tenantOrderInsuredList[0].tenantOrderProductList[0].productCode,p.value=!0,(e=>{const t=e.find((e=>1===e.riskType));var a,l;t&&(se.value=(a=t.insurancePeriodValue,-1!==(l=q[t.insurancePeriodType]).indexOf("$")?l.replace("$",`${a}`):`${a||""}${l}`))})(a.tenantOrderInsuredList[0].tenantOrderProductList[0].tenantOrderRiskList||[]),(async()=>{const{code:e,data:t}=await S({productCode:de.value,tenantId:f});"10000"===e&&(M.value=t,m.value=t.productFactor)})(),me(),a.orderStatus!==D.UNDER_WRITING_SUCCESS&&d.push({path:"/baseInsurance/orderDetail",query:{...s.query,productCode:de.value,ISEE_BIZ:a.extInfo.iseeBizNo}}))},he=async()=>{K.value?(ee.value=!1,ce.value.length?X.value=!0:fe()):L("请先签字")};return C((()=>{pe()})),(e,t)=>{const s=N,d=g,v=k,f=O,h=b("ProPageWrap"),y=E,I=T,C=_;return a(),w(C,{"theme-vars":x(u)},{default:r((()=>{var e;return[i(h,null,{default:r((()=>{var e;return[(null==(e=M.value)?void 0:e.productBasicInfoVO)?(a(),l("div",ae,[i(d,null,{default:r((()=>{var e;return[i(s,{title:"产品名称",content:null==(e=M.value)?void 0:e.productBasicInfoVO.productFullName},null,8,["content"])]})),_:1}),W.value.id?(a(),w(d,{key:0,"show-line":!1,title:"投保信息"},{default:r((()=>{var e,a,l,n;return[i(s,{title:"保费",content:W.value.orderAmount+"元"},null,8,["content"]),i(s,{title:"保险期限",content:se.value},null,8,["content"]),i(s,{title:"起保日期",content:W.value.commencementTime},null,8,["content"]),i(s,{title:"终保日期",content:W.value.expiryDate},null,8,["content"]),i(s,{title:"保单状态",content:x(B)[W.value.orderStatus]},null,8,["content"]),i(s,{title:"订单编号",content:W.value.orderNo},null,8,["content"]),i(v,{modelValue:W.value.tenantOrderHolder.extInfo.familyAreaCode,"onUpdate:modelValue":t[0]||(t[0]=e=>W.value.tenantOrderHolder.extInfo.familyAreaCode=e),field1:W.value.tenantOrderHolder.extInfo.familyProvinceCode,"onUpdate:field1":t[1]||(t[1]=e=>W.value.tenantOrderHolder.extInfo.familyProvinceCode=e),field2:W.value.tenantOrderHolder.extInfo.familyCityCode,"onUpdate:field2":t[2]||(t[2]=e=>W.value.tenantOrderHolder.extInfo.familyCityCode=e),field3:W.value.tenantOrderHolder.extInfo.familyAreaCode,"onUpdate:field3":t[3]||(t[3]=e=>W.value.tenantOrderHolder.extInfo.familyAreaCode=e),label:"房产所在地",name:"familyProvinceCode","is-link":"","is-view":"",class:"insured-info","data-source":x(z),mapping:{label:"name",value:"code",children:"children"}},null,8,["modelValue","field1","field2","field3","data-source"]),i(s,{title:"详细地址",content:null==(a=null==(e=W.value.tenantOrderHolder)?void 0:e.extInfo)?void 0:a.familyAddress},null,8,["content"]),i(s,{title:"燃气编号",content:null==(n=null==(l=W.value.tenantOrderSubjectList)?void 0:l[0])?void 0:n.subjectNo},null,8,["content"])]})),_:1})):o("",!0),p.value?(a(),w(R,{key:1,ref:"formRef","title-collection":{HOLDER:"投保人信息",INSURER:"被保人信息",BENEFICIARY:"受益人"},"is-view":!0,"form-info":W.value,"factor-object":m.value,"input-align":"right"},null,8,["form-info","factor-object"])):o("",!0),i(d,{title:"阅读条款合同",class:"file-list-card"},{default:r((()=>[(a(!0),l(c,null,j(ue.value,((e,t)=>(a(),w(f,{key:t,title:e.attachmentName,"is-link":"",onClick:t=>{return a=e.attachmentName,l=e.attachmentList,Y.value=!0,void(Z.value={title:a,fileContent:null==l?void 0:l[0]});var a,l}},null,8,["title","onClick"])))),128))])),_:1}),i(d,{title:"客户签名"},{default:r((()=>[n("div",le,[ne,i(te,{modelValue:K.value,"onUpdate:modelValue":t[4]||(t[4]=e=>K.value=e)},null,8,["modelValue"])])])),_:1}),n("div",oe,[i(F,{shadow:!1,text:"提 交",onClick:he})])])):o("",!0)]})),_:1}),i(I,{show:Y.value,"onUpdate:show":t[6]||(t[6]=e=>Y.value=e),class:"pre-notice-wrap",title:null==(e=Z.value)?void 0:e.title,position:"bottom",style:{height:"600px"}},{default:r((()=>{var e,a,l,o;return[i(y,{content:null==(a=null==(e=Z.value)?void 0:e.fileContent)?void 0:a.attachmentUri,type:null==(o=null==(l=Z.value)?void 0:l.fileContent)?void 0:o.attachmentType},null,8,["content","type"]),n("div",ie,[i(F,{shadow:!1,text:"关闭",onClick:t[5]||(t[5]=e=>Y.value=!1)})])]})),_:1},8,["show","title"]),X.value&&0!==ce.value.length?(a(),w($,{key:0,show:X.value,"onUpdate:show":t[7]||(t[7]=e=>X.value=e),"content-list":ce.value,"is-only-view":ee.value,"active-index":re.value,text:ee.value?"关闭":"我已逐页阅读上述内容并同意","force-read-cound":0,"on-close-file-preview":"",onSubmit:fe,onOnCloseFilePreview:ve,onOnCloseFilePreviewByMask:t[8]||(t[8]=e=>X.value=!1)},null,8,["show","content-list","is-only-view","active-index","text"])):o("",!0)]})),_:1},8,["theme-vars"])}}});export{re as default};
