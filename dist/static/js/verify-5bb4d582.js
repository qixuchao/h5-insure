import{d as e,k as a,j as l,z as s,o as i,m as o,w as u,a as n,e as r,u as d,b as t,V as v,W as c,ce as m,cf as f,cg as p,ch as h,aB as y,ao as b,i as g,h as S,a6 as V,aj as C,O as k,c as q,f as j,F as w,a8 as x,T as I,bs as M,aL as L,a9 as O,aa as _,bp as E,ag as N}from"./index-aea98641.js";import{n as U}from"./nextStep-e4496626.js";import{c as F}from"./format-b5e9d8b9.js";import{g as $,m as P}from"./trial-7909ca3c.js";import{p as A}from"./utils-0b09ed16.js";import{u as R}from"./useOrder-4b63fa03.js";import{P as T,a as B,B as D}from"./constants-fe95ef6f.js";import{d as G,q as Y}from"./verify-bca90c9f.js";import"./core-aa66889b.js";import"./utils-92f60a57.js";import"./infoCollection-01d7caab.js";import"./trial-066f046d.js";const z={class:"popup-container"},H={class:"popup-header"},J={class:"title"},W={class:"popup-body"},K=e({name:"checkCodePopup"}),Q=e({...K,props:{show:{type:Boolean,default:!1},type:{default:"agent"},data:{default:()=>({})}},emits:["cancel","confirm"],setup(e,{emit:b}){const g=e,S=a((()=>g.show)),V=l({mobile:"",verifyCode:""}),C=a((()=>g.type)),k=l({holder:{type:"投保人",name:"",mobile:"",desc:""},agent:{type:"代理人",name:"李三",mobile:"13262278989",desc:"色卡上会计核算看回放独守空房还是空巅峰计划收款方"},insured:{type:"被保人",name:"",mobile:"",desc:""}}),q=()=>{b("cancel")},j=()=>{b("confirm")};return s([()=>g.data,g.type],(([e,a])=>{var l,s,i;e&&(Object.assign(k.value.holder,e.holder),Object.assign(k.value.insured,null==(l=null==e?void 0:e.insuredList)?void 0:l[0]),V.value.mobile=null==(i=null==(s=k.value)?void 0:s[`${g.type}`])?void 0:i.mobile)}),{immediate:!0,deep:!0}),(e,a)=>{const l=f,s=p,b=h,g=y;return i(),o(g,{show:S.value,"onUpdate:show":a[2]||(a[2]=e=>S.value=e),class:"popup-check-mobile",closeable:!1,"close-on-click-overlay":!1},{default:u((()=>[n("div",z,[n("div",H,[n("span",{class:"clear-all",onClick:q}," 取消 "),n("span",J,r(`${k.value[C.value].type}手机号验证`),1),n("span",{class:"close",onClick:j},"确认")]),n("div",W,[n("h3",null,r(`尊敬的${k.value[C.value].type}:${k.value[C.value].name}`),1),n("p",null,r(k.value[C.value].desc),1),n("h3",null,r(`${k.value[C.value].type}手机号验证 ${d(F)(k.value[C.value].mobile||"")}`),1),t(b,{model:V.value},{default:u((()=>[v(t(l,{modelValue:V.value.mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>V.value.mobile=e),label:"被保人手机号",name:"mobile",maxlength:"11",required:""},null,8,["modelValue"]),[[c,!1]]),t(s,{modelValue:V.value.verifyCode,"onUpdate:modelValue":a[1]||(a[1]=e=>V.value.verifyCode=e),"related-name":"mobile",label:" ",maxlength:"6","input-align":"left",placeholder:"请输入验证码",name:"verifyCode","send-s-m-s-code":d(m),rules:""},null,8,["modelValue","send-s-m-s-code"])])),_:1},8,["model"])])])])),_:1},8,["show"])}}}),X=b([{label:"签名完成",value:1},{label:"去签名",value:2},{label:"认证失败，请联系内勤人员",value:3}]),Z=2,ee=b([{label:"去双录",value:1},{label:"双录完成",value:Z},{label:"双录失败",value:3}]);const ae={class:"page-verify-wrap"},le={class:"sign-list"},se={class:"inner-cell"},ie={class:"inner-cell"},oe={class:"inner-cell"},ue={class:"inner-cell"},ne={class:"footer-button"},re=e({name:"verify"}),de=e({...re,setup(e){const r=g(),v=S(),{orderNo:c,tenantId:y}=r.query,b=l(!1),F=l(),z=l(),H=l({holderMobile:"",holderVerifyCode:"",insuredMobile:"",insuredVerifyCode:""}),J=R(),W=l(!1),K=l({sign:[],verify:[],scribing:""}),re=l({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{},verifyStatus:2},agent:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2}}),de=l("agent"),te=a((()=>e=>K.value.sign.includes(e)||K.value.verify.includes(e))),ve=a((()=>re.value.agent.verifyStatus!==V.YES)),ce=a((()=>{const{insuredList:e}=J.value||{},{age:a,relationToHolder:l}=e[0]||{};return!(a<18||`${l}`===C.CERT)})),me=a((()=>e=>re.value[e].isSign||re.value[e].isVerify)),fe=a((()=>e=>re.value[e].isShareSign)),pe=e=>{de.value=e,"agent"!==e?ve.value||(W.value=!0):v.push({path:T.agentSign,query:r.query})},he=()=>{ve.value||F.value===Z||G(J.value).then((({code:e,data:a})=>{"10000"===e&&a&&I("双录已完成")}))},ye=()=>{W.value=!1},be=()=>{let e="";e=("agent"===de.value||(de.value,re.value[de.value].isVerify),T.infoPreview),v.push({path:e,query:{...r.query,objectType:de.value}})},ge=()=>{const{holder:e,insuredList:a,extInfo:l}=J.value;if(b.value){if(l.agentAuthFlag!==V.YES)return void I("代理人签名未完成")}else{if(l.agentAuthFlag===V.NO)return void I("代理人签名未完成");if(e.isCert===V.NO)return void I("投保人签名未完成");if(a[0].isCert===V.NO)return void I("被保人签名未完成")}const s=Object.assign(J.value,{extInfo:{...J.value.extInfo,pageCode:B.SIGN,buttonCode:D.SIGN}});U(s,((e,a)=>{a===L.JUMP_PAGE&&O(e.nextPageCode,r.query)}),r)};return s((()=>H.value),(()=>{}),{deep:!0,immediate:!0}),k((()=>{(async()=>{let e={};Y({orderNo:c,tenantId:y}).then((({code:e,data:a})=>{if("10000"===e){const{doubleRecordFlag:e,doubleRecordStatus:l}=a;b.value=e===V.YES,F.value=l}})),await $({orderNo:c,tenantId:y}).then((({code:a,data:l})=>{var s,i,o;if("10000"===a){Object.assign(J.value,l);const{agentAuthFlag:a}=l.extInfo,{mobile:u}=l.holder,{mobile:n}=(null==(s=l.insuredList)?void 0:s[0])||{};Object.assign(H.value,{holderMobile:u,insuredMobile:n}),e=A(l.insuredList[0].productList),re.value.agent.verifyStatus=a,re.value.holder.verifyStatus=l.holder.isCert,re.value.insured.verifyStatus=null==(o=null==(i=l.insuredList)?void 0:i[0])?void 0:o.isCert}})),await P(e).then((({data:e,code:a})=>{if("10000"===a){const{signInfo:a}=M(e.productFactor);a.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((a=>{e.required&&K.value.sign.push(a.code),"1"===a.code?re.value.agent.isSign=!0:"2"===a.code?re.value.holder.isSign=!0:"3"===a.code?re.value.insured.isSign=!0:"4"===a.code?re.value.holder.isShareSign=!0:"5"===a.code&&(re.value.insured.isShareSign=!0)})),"customerFace"===e.name&&e.columns.forEach((a=>{e.required&&K.value.verify.push(a.code),"1"===a.code?re.value.holder.isVerify=!0:"2"===a.code&&(re.value.insured.isVerify=!0)}))}))}}))})()})),(e,a)=>{const l=_,s=E,r=N;return i(),q("div",ae,[t(l),n("div",le,[d(me)("agent")?(i(),o(s,{key:0,title:"代理人签名",required:d(te)("agent")},{value:u((()=>[n("div",se,[t(s,{"is-link":"",value:d(X)[d(re).agent.verifyStatus],onClick:a[0]||(a[0]=e=>pe("agent"))},null,8,["value"])])])),_:1},8,["required"])):j("",!0),d(b)?(i(),o(d(h),{key:2,ref_key:"formRef",ref:z,model:d(H)},{default:u((()=>[t(d(f),{modelValue:d(H).holderMobile,"onUpdate:modelValue":a[3]||(a[3]=e=>d(H).holderMobile=e),label:"投保人手机号",name:"holderMobile",maxlength:"11",required:"","is-view":""},null,8,["modelValue"]),t(d(p),{modelValue:d(H).holderVerifyCode,"onUpdate:modelValue":a[4]||(a[4]=e=>d(H).holderVerifyCode=e),"related-name":"holderMobile",label:"验证码",maxlength:"6",name:"holderVerifyCode","send-s-m-s-code":d(m),rules:"",required:""},null,8,["modelValue","send-s-m-s-code"]),d(ce)?(i(),q(w,{key:0},[t(d(f),{modelValue:d(H).insuredMobile,"onUpdate:modelValue":a[5]||(a[5]=e=>d(H).insuredMobile=e),label:"被保人手机号",name:"insuredMobile",maxlength:"11",required:"","is-view":""},null,8,["modelValue"]),t(d(p),{modelValue:d(H).insuredVerifyCode,"onUpdate:modelValue":a[6]||(a[6]=e=>d(H).insuredVerifyCode=e),label:"验证码",maxlength:"6",name:"insuredVerifyCode","related-name":"insuredMobile","send-s-m-s-code":d(m),required:""},null,8,["modelValue","send-s-m-s-code"])],64)):j("",!0)])),_:1},8,["model"])):(i(),q(w,{key:1},[d(me)("holder")?(i(),o(s,{key:0,title:"投保人签名",required:d(te)("holder")},{value:u((()=>[n("div",ie,[d(fe)("holder")?(i(),o(s,{key:0,"value-class":""+(d(ve)?"disable":""),"is-link":"",value:"分享空签邀约"},null,8,["value-class"])):j("",!0),t(s,{"is-link":"",value:d(X)[d(re).holder.verifyStatus],"value-class":""+(d(ve)?"disable":""),onClick:a[1]||(a[1]=e=>pe("holder"))},null,8,["value","value-class"])])])),_:1},8,["required"])):j("",!0),d(me)("insured")&&d(ce)?(i(),o(s,{key:1,title:"被保人签名",required:d(te)("insured")},{value:u((()=>[n("div",oe,[d(fe)("insured")?(i(),o(s,{key:0,"value-class":""+(d(ve)?"disable":""),"is-link":"",value:"分享空签邀约"},null,8,["value-class"])):j("",!0),t(s,{"is-link":"","value-class":""+(d(ve)?"disable":""),value:d(X)[d(re).insured.verifyStatus],onClick:a[2]||(a[2]=e=>pe("insured"))},null,8,["value-class","value"])])])),_:1},8,["required"])):j("",!0)],64)),d(b)?(i(),o(s,{key:3,title:"保单双录",required:""},{value:u((()=>[n("div",ue,[t(s,{"is-link":"","value-class":""+(d(ve)?"disable":""),value:d(ee)[d(F)],onClick:he},null,8,["value-class","value"])])])),_:1})):j("",!0)]),n("div",ne,[t(r,{type:"primary",onClick:ge},{default:u((()=>[x("下一步")])),_:1})]),t(Q,{type:d(de),show:d(W),data:d(J),onCancel:ye,onConfirm:be},null,8,["type","show","data"])])}}});export{de as default};
