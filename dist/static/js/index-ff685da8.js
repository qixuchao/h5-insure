import{h as me,P as Ne,aa as Re,r as F,d as ke,A as Se,j as Oe,k as G,m as C,n as R,p as B,B as r,t as _,L as A,s as f,M as le,x as k,C as h,H as x,F as w,G as S,T as U,D as Ie,a5 as Le,a6 as be}from"./vendor-e88cb016.js";import{q as xe}from"./index-e32de49e.js";import{_ as we,S as Pe,p as Ue,e as W,a as H,q as ce,l as de,C as He,g as Ce,s as Me,n as $e,N as je,b as Qe,A as J,t as M}from"./index-47352d37.js";import{_ as qe}from"./index-b507f42d.js";import{f as Ve,s as Ye,g as Ee,a as Ge}from"./verify-7af7d57e.js";import{a as z}from"./order-a29dd959.js";import{g as We,l as Be}from"./inform-c817fbf3.js";const X=P=>(Le("data-v-a9d21be4"),P=P(),be(),P),Je={class:"page-verify"},ze={class:"people"},Xe={class:"name"},Ke={class:"verify-item"},Ze=X(()=>r("div",{class:"label"},"\u8BC1\u4EF6\u53F7\u7801",-1)),et={class:"no"},tt=S(" \u53BB\u8BA4\u8BC1 "),ut={class:"sign-body"},st={class:"date"},ot={class:"file"},at=S(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A "),nt={class:"people"},rt={class:"name"},it={class:"verify-item"},lt=X(()=>r("div",{class:"label"},"\u8BC1\u4EF6\u53F7\u7801",-1)),ct={class:"no"},dt=["onClick"],Ct=S(" \u53BB\u8BA4\u8BC1 "),Et=["onClick"],Bt={class:"sign-body"},_t={class:"date"},ft={class:"file"},Dt=S(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A "),pt={class:"footer-button footer"},vt=X(()=>r("div",{class:"text"},"\u5237\u65B0",-1)),Ft=S("\u5206\u4EAB"),At=S("\u63D0\u4EA4"),yt=me({setup(P){const p={CERT:1,NO_CERT:2},_e=Ne(),fe=Re(),$=(()=>{const t=_e.query;return t.orderCode&&(t.orderNo=t.orderCode,delete t.orderCode),t})(),{saleUserId:j="D1234567-1",tenantId:v="9991000007",templateId:De=1,productCode:pe="CQ75CQ76",insurerCode:Q="ancheng",isShare:q,orderCode:O,orderNo:y,productCategory:K}=$,V=new Pe({source:"localStorage"}),Z=F([]),ee=F([]),te=F([]),ue=F([]),l=F(),T=F(),I=[],g=F(""),L=F(),se=ke().format("YYYY-MM-DD"),ve=()=>{var t,u;(u=(t=T.value)==null?void 0:t.clear)==null||u.call(t)},Fe=t=>{var u,n;(n=(u=I[t])==null?void 0:u.clear)==null||n.call(u)},oe=(t,u)=>{let n=window.location.href;n=n.includes("orderCode")?n:n.replace("orderNo","orderCode"),Ge({callbackUrl:n,certiNo:t,faceAuthMode:"TENCENT",userName:u,tenantId:9991000007}).then(s=>{const{code:c,data:d}=s;if(c==="10000"){const{originalUrl:e,serialNo:o}=d;window.location.href=e,V.set("verifyData",{serialNo:o,certNo:t,name:u})}})},ae=t=>{const{id:u,objectType:n}=t;g.value="",L.value="";const s={1:"pdf",2:"richText",3:"link"};We({insurerCode:Q,id:u,objectType:n,productCategory:K,orderNo:y,tenantId:v}).then(({code:c,data:d})=>{if(c==="10000"){const{textType:e,content:o,questionType:a}=(d==null?void 0:d[0])||{};a===2?(g.value="question",L.value=d):(e===1&&o.includes("png")?g.value="picture":g.value=s[e],L.value=o)}})},b=t=>`${t}`===He.CERT,ne=t=>{var u,n,s,c;t===-1?oe((u=l.value.tenantOrderHolder)==null?void 0:u.certNo,(n=l.value.tenantOrderHolder)==null?void 0:n.name):oe((s=l.value.tenantOrderInsuredList[t])==null?void 0:s.certNo,(c=l.value.tenantOrderInsuredList[t])==null?void 0:c.name)},Ae=t=>{t&&I.every(u=>u!==t)&&I.push(t)},ye=()=>{var u,n,s,c;if((u=T.value)==null?void 0:u.isEmpty()){U.fail("\u8BF7\u6295\u4FDD\u4EBA\u7B7E\u540D");return}if(((s=(n=l.value.tenantOrderHolder)==null?void 0:n.extInfo)==null?void 0:s.isCert)!==p.CERT&&b((c=l.value.tenantOrderHolder)==null?void 0:c.certType)){U.fail("\u8BF7\u6295\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}Ce({orderNo:O||y,saleUserId:j,tenantId:v}).then(d=>{const{code:e,data:o}=d;e==="10000"&&([z.PENDING,z.PAYMENT_FAILED,z.UNDER_WRITING_SUCCESS].includes(o.orderStatus)?Ie.confirm({title:"\u63D0\u793A",message:"\u8BF7\u786E\u8BA4\u4FE1\u606F\u586B\u5199\u65E0\u8BEF\u540E\uFF0C\u518D\u8FDB\u884C\u652F\u4ED8"}).then(()=>{var i,E;const a=(i=T.value)==null?void 0:i.save();Promise.all([Ye("HOLDER",a,(E=l.value)==null?void 0:E.id,`${v}`)]).then(()=>{$e({...l.value,pageCode:"sign",operateOption:{withSignInfo:!0},extInfo:{...l.value.extInfo,pageCode:"sign",templateId:De,shareFlag:q?"Y":"N",buttonCode:je.sign},venderCode:Q}).then(D=>{const{code:m,data:N}=D;e==="10000"&&N.success&&fe.push({path:Qe[N.pageAction.data.nextPageCode],query:{orderNo:O||y,saleUserId:j,tenantId:v}})})})}):Me("paymentResult",$))})},Y=(t=!1)=>{Ce({orderNo:O||y,saleUserId:j,tenantId:v}).then(u=>{var c,d;const{code:n,data:s}=u;n==="10000"&&(l.value=s,t&&(((d=(c=s==null?void 0:s.tenantOrderHolder)==null?void 0:c.extInfo)==null?void 0:d.isCert)===p.NO_CERT||(s==null?void 0:s.tenantOrderInsuredList.some(e=>{var o;return((o=e.extInfo)==null?void 0:o.isCert)===p.NO_CERT}))?U("\u7528\u6237\u672A\u5B8C\u8EAB\u4EFD\u8BA4\u8BC1\u53CA\u7B7E\u5B57"):(!(s!=null&&s.tenantOrderAttachmentList.find(e=>e.category===J.ELECTRIC_SIGN&&e.objectType===M.HOLDER))||!(s!=null&&s.tenantOrderAttachmentList.find(e=>e.category===J.ELECTRIC_SIGN&&e.objectType===M.INSURED)))&&U("\u7528\u6237\u672A\u5B8C\u8EAB\u4EFD\u8BA4\u8BC1\u53CA\u7B7E\u5B57")),setTimeout(()=>{let e=0;s.tenantOrderAttachmentList.forEach(o=>{var a,i,E,D;o.category===J.ELECTRIC_SIGN&&(o.objectType===M.HOLDER?((i=(a=T.value)==null?void 0:a.clear)==null||i.call(a),T.value.setDataURL(o.fileBase64)):o.objectType===M.INSURED&&((D=(E=I[e])==null?void 0:E.clear)==null||D.call(E),I[e].setDataURL(o.fileBase64),e+=1))})}))})},he=()=>{Y(!0)},Te=Se(()=>{const t={...$,isShare:1,sharePageCode:"sign"};return`${window.location.origin}/phoneVerify?${xe.stringify(t)}`}),ge=async()=>{const t={orderNo:O||y,productCode:pe,tenantId:v,objectType:1},u={insurerCode:Q,orderNo:y,productCategory:K,tenantId:v,noticeType:4,objectType:1},{code:n,data:s}=await Ee(t),{code:c,data:d}=await Ee({...t,objectType:2}),{code:e,data:o}=await Be(u),{code:a,data:i}=await Be({...u,noticeType:5,objectType:2});n==="10000"&&(ee.value=s||[]),c==="10000"&&(Z.value=d||[]),e==="10000"&&(ue.value=o||[]),a==="10000"&&(te.value=i||[])};return Oe(()=>{Y(),ge();const t=V.get("verifyData");if(t){const{serialNo:u,certNo:n,name:s}=t;Ve({certiNo:n,orderNo:O||y,serialNo:u,tenantId:v,userName:s}).then(c=>{const{code:d,data:e}=c;d==="10000"&&(V.remove("verifyData"),Y())})}}),(t,u)=>{const n=G("ProPDFviewer"),s=G("van-button"),c=G("ProPageWrap");return C(),R(c,null,{default:B(()=>{var d;return[r("div",Je,[_(Ue,{type:"warning",title:"\u5C0A\u656C\u7684\u5BA2\u6237\uFF0C\u672C\u6B21\u6295\u4FDD\u9700\u8981\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",content:"\u672C\u4EA7\u54C1\u6295\u4FDD\u9700\u8981\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u8FDB\u884C\u5B9E\u540D\u8BA4\u8BC1\uFF0C\u60A8\u8D2D\u4E70\u672C\u4EA7\u54C1\u7684\u7D2F\u8BA1\u603B\u4FDD\u8D39\u5DF2\u8D85\u8FC720\u4E07\uFF0C\u6309\u76D1\u7BA1\u8981\u6C42\uFF0C\u9700\u8981\u63D0\u4F9B\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u3001\u6307\u5B9A\u53D7\u76CA\u4EBA\u8BC1\u4EF6\u5F71\u50CF\uFF0C\u672C\u4EA7\u54C1\u975E\u672C\u4EBA\u6295\u4FDD\u4E14\u5E26\u8EAB\u6545\u8D23\u4EFB\u3001\u9700\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\uFF08\u6210\u4EBA\uFF09\u7684\u6295\u4FDD\u610F\u613F\u8FDB\u884C\u7B7E\u5B57\u786E\u8BA4\u3002"}),_(H,{title:"\u6295\u4FDD\u4EBA",class:"card"},{extra:B(()=>{var e,o,a,i,E,D,m,N,re,ie;return[r("div",ze,[r("div",Xe,A((o=(e=l.value)==null?void 0:e.tenantOrderHolder)==null?void 0:o.name),1),b((i=(a=l.value)==null?void 0:a.tenantOrderHolder)==null?void 0:i.certType)?(C(),f("div",{key:0,class:le(["status",{verified:((m=(D=(E=l.value)==null?void 0:E.tenantOrderHolder)==null?void 0:D.extInfo)==null?void 0:m.isCert)===p.CERT}])},A(((ie=(re=(N=l.value)==null?void 0:N.tenantOrderHolder)==null?void 0:re.extInfo)==null?void 0:ie.isCert)===p.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)):k("",!0)])]}),default:B(()=>{var e,o,a,i,E,D,m;return[r("div",Ke,[Ze,r("div",et,A((o=(e=l.value)==null?void 0:e.tenantOrderHolder)==null?void 0:o.certNo),1),((E=(i=(a=l.value)==null?void 0:a.tenantOrderHolder)==null?void 0:i.extInfo)==null?void 0:E.isCert)!==p.CERT&&b((m=(D=l.value)==null?void 0:D.tenantOrderHolder)==null?void 0:m.certType)?(C(),f("div",{key:0,class:"action",onClick:u[0]||(u[0]=N=>ne(-1))},[tt,_(W,{name:"right_arrow",class:"icon"})])):k("",!0)])]}),_:1}),_(H,{key:"-1",title:"\u6295\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:B(()=>[r("div",{class:"resign",onClick:ve},"\u91CD\u7B7E")]),default:B(()=>[_(ce,{ref_key:"holderSign",ref:T,class:"sign"},null,512),r("div",ut,[r("div",st,"\u7B7E\u540D\u65E5\u671F\uFF1A "+A(h(se)),1),r("div",ot,[at,r("span",null,[(C(!0),f(w,null,x(ee.value,(e,o)=>(C(),R(n,{key:`holderFileList-${o}`,class:"file",title:`\u300A${e.materialName}\u300B`,content:e.materialContent,type:h(de)(e.materialContent,e.materialSource+""),onClick:u[1]||(u[1]=()=>"")},null,8,["title","content","type"]))),128))]),(C(!0),f(w,null,x(ue.value,(e,o)=>(C(),R(n,{key:`holderQuestionList-${o}`,class:"file",title:`\u300A${e.title}\u300B`,content:L.value,type:g.value,onClick:()=>ae(e)},null,8,["title","content","type","onClick"]))),128))])])]),_:1}),(C(!0),f(w,null,x((d=l.value)==null?void 0:d.tenantOrderInsuredList,(e,o)=>(C(),f("div",{key:o},[_(H,{title:"\u88AB\u4FDD\u4EBA",class:"card"},{extra:B(()=>{var a,i;return[r("div",nt,[r("div",rt,A(e.name),1),b(e.certType)?(C(),f("div",{key:0,class:le(["status",{verified:((a=e.extInfo)==null?void 0:a.isCert)===p.CERT}])},A(((i=e.extInfo)==null?void 0:i.isCert)===p.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)):k("",!0)])]}),default:B(()=>{var a;return[r("div",it,[lt,r("div",ct,A(e.certNo),1),((a=e.extInfo)==null?void 0:a.isCert)!==p.CERT&&b(e.certType)?(C(),f("div",{key:0,class:"action",onClick:i=>ne(o)},[Ct,_(W,{name:"right_arrow",class:"icon"})],8,dt)):k("",!0)])]}),_:2},1024),_(H,{title:"\u88AB\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:B(()=>[r("div",{class:"resign",onClick:a=>Fe(o)},"\u91CD\u7B7E",8,Et)]),default:B(()=>[_(ce,{ref_for:!0,ref:Ae,class:"sign"}),r("div",Bt,[r("div",_t,"\u7B7E\u540D\u65E5\u671F\uFF1A "+A(h(se)),1),r("div",ft,[Dt,(C(!0),f(w,null,x(Z.value,(a,i)=>(C(),R(n,{key:`insuredFileList-${i}`,class:"file",title:`\u300A${a.materialName}\u300B`,content:a.materialContent,type:h(de)(a.materialContent,a.materialSource+""),onClick:u[2]||(u[2]=()=>"")},null,8,["title","content","type"]))),128)),(C(!0),f(w,null,x(te.value,(a,i)=>(C(),R(n,{key:`insuredQuestionList-${i}`,class:"file",title:`\u300A${a.title}\u300B`,content:L.value,type:g.value,onClick:()=>ae(a)},null,8,["title","content","type","onClick"]))),128))])])]),_:2},1024)]))),128)),r("div",pt,[h(q)?k("",!0):(C(),f("div",{key:0,class:"refresh-btn",onClick:he},[r("div",null,[_(W,{name:"refresh"})]),vt])),h(q)?k("",!0):(C(),R(qe,{key:1,title:"\u9080\u8BF7\u60A8\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",desc:"\u9080\u8BF7\u60A8\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",link:h(Te)},{default:B(()=>[_(s,{plain:"",type:"primary",class:"share-btn"},{default:B(()=>[Ft]),_:1})]),_:1},8,["link"])),_(s,{type:"primary",class:"submit-btn",onClick:ye},{default:B(()=>[At]),_:1})])])]}),_:1})}}});var St=we(yt,[["__scopeId","data-v-a9d21be4"]]);export{St as default};
