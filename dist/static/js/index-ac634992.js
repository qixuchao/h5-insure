var Ge=Object.defineProperty,Je=Object.defineProperties;var je=Object.getOwnPropertyDescriptors;var pe=Object.getOwnPropertySymbols;var Qe=Object.prototype.hasOwnProperty,Xe=Object.prototype.propertyIsEnumerable;var fe=(F,i,c)=>i in F?Ge(F,i,{enumerable:!0,configurable:!0,writable:!0,value:c}):F[i]=c,N=(F,i)=>{for(var c in i||(i={}))Qe.call(i,c)&&fe(F,c,i[c]);if(pe)for(var c of pe(i))Xe.call(i,c)&&fe(F,c,i[c]);return F},I=(F,i)=>Je(F,je(i));import{g as Ze,a9 as et,O as tt,E as f,M as he,y as J,T as w,_ as at,l as ot,h as rt,r as ye,af as nt,j as S,n as j,p as D,m as Q,H as ut,t as R,z as q,A as h,J as ve,C as we,k as Fe,F as st,D as lt,X as it}from"./vendor-9d7eb2ed.js";import{_ as ct,C as De,I as ge,H as dt,a0 as mt,a2 as Ce}from"./index-a65406ce.js";import{a as X}from"./order-26db6dbf.js";import{S as V,R as L,f as pt}from"./infoCollection-192ba138.js";import{p as Ee,i as ft,s as ht,g as yt,u as vt,a as Ft}from"./trial-5423b89a.js";import{p as Dt}from"./product-bcd5d98e.js";import{g as Z,a as _e,t as gt,b as Ct}from"./utils-724a2d37.js";import{t as Et}from"./theme-ea709837.js";import{d as Ne,B as _t,D as Nt,G as It,S as wt,H as Bt,P as At,U as Tt,_ as bt,W as Ot,o as Ie,a as $}from"./auth-6903939b.js";import{_ as St}from"./index-f75f7bf2.js";import"./utils-b6782348.js";import"./trial-d23eb864.js";import"./index-0ce751fa.js";import"./bankCard-0e4ce564.js";import"./phoneVerify-439c841e.js";const Pt={key:0},xt={class:"page-internet-product-detail"},kt={class:"info"},Ut={class:"footer-button"},Ht={class:"price"},Mt=we(" \u603B\u4FDD\u8D39"),Rt={key:0},qt=Ze({setup(F){const i=et(),c=tt(),{productCode:Y="BWYL2021",tenantId:v,orderNo:_,phoneNo:ee,agentCode:P="",saleChannelId:Be,paymentMethod:Ae,certNo:te,name:ae,pageCode:K,upgradeCode:Te,from:oe}=c.query;console.log(c.query,"route.query");const re=f(),d=f(),B=f(),C=f(),x=K==="payBack",be=f(!1),k=f(!1),U=f(!1),Oe=f(0),W=f(!1),z=f(!1),H=f({show:!1,html:""});let G="";const o=he({holder:{certNo:te,certType:De.CERT,mobile:ee,name:ae,socialFlag:V.HAS},insured:{certNo:te,certType:De.CERT,name:ae,socialFlag:V.HAS,relationToHolder:L.SELF},paymentMethod:Ae,renewalDK:"Y",paymentFrequency:pt.MONTH}),M=f(Ne),E=f(Ne),s=he({showInsure:!x,canInsure:!1,canUpgrade:!1}),Se=J(()=>{var a,e;return((e=(a=d.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:e.attachmentVOList.filter(t=>t.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),Pe=J(()=>{var a,e;return((e=(a=d.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:e.attachmentVOList.filter(t=>t.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),ne=J(()=>{if(o.holder.certNo){const a=Z(o.holder.certNo,"year"),e=ge(o.holder.certNo);if(a<18)return w("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E18\u5C81\uFF01"),!1;if(o.insured.certNo&&o.insured.relationToHolder===L.MATE){const t=ge(o.insured.certNo);if(e===t)return w("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(o.insured.certNo){const a=Z(o.holder.certNo,"day"),e=Z(o.holder.certNo,"year");if(o.insured.relationToHolder===L.CHILD&&a<30)return w("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(o.insured.relationToHolder===L.PARENT&&e>=71)return w("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E70\u5C81\uFF01"),!1}return!0}),xe=()=>{const{holder:{certNo:a,mobile:e,name:t,socialFlag:u},insured:{certNo:r,name:n,socialFlag:m,relationToHolder:p},paymentMethod:y}=o;return dt(r)&&!!m},ue=()=>{i.push({path:"/internet/guaranteeUpgrade",query:I(N({},c.query),{tenantId:v,productCode:"BWYL2022",orderNo:_,agentCode:P})})},ke=()=>{z.value=!1},Ue=()=>{E.value=M.value},He=()=>{E.value=I(N({},E.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},Me=async a=>{w.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const e=await vt(a),{code:t}=e;if(t==="10000"){w.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const u=await Ft({orderNo:a.orderNo,tenantId:v}),{data:r}=u;u.code==="10000"&&(r.type===2?(H.value={show:!0,html:r.paymentUrl},console.log("data.paymentUrl",H.value),it(()=>{console.log("document.forms",document.forms);const n=document.getElementById("cashierSubmit");n==null||n.addEventListener("submit",m=>{m.preventDefault()}),n==null||n.submit()})):window.location.href=r.paymentUrl)}s.canInsure=!0}catch{s.canInsure=!0}},Re=a=>{var r,n;const e=JSON.parse((n=(r=B.value)==null?void 0:r.productBasicInfoVO)==null?void 0:n.extInfo);let t="";return e.endorsementFlag===1&&(t=`&upgradeCode=${e.endorsementCode}`),`${Ce}/internet/productDetail?tenantId=${v}&productCode=${Y}&orderNo=${a}&agentCode=${P}&pageCode=payBack${t}&from=${oe||"normal"}`},qe=a=>`${Ce}/internet/payFail?tenantId=${v}&orderNo=${a}&agentCode=${P}&pageCode=payBack&from=${oe||"normal"}`,Ve=async a=>{const e=Ct({tenantId:v,saleUserId:P,saleChannelId:Be,detail:d.value,insureDetail:B.value,paymentMethod:o.paymentMethod,renewalDK:o.renewalDK,iseeBizNo:G,successJumpUrl:"",premium:C.value,holder:o.holder,insured:o.insured,tenantOrderRiskList:a,orderStatus:"",orderTopStatus:""});try{const t=await ht(e),{code:u,data:r}=t;u==="10000"&&Me(I(N({},e),{orderNo:r.data,extInfo:{extraInfo:{renewalDK:o.renewalDK,paymentMethod:o.paymentMethod,paymentFrequency:o.paymentFrequency,successJumpUrl:Re(r.data),failUrl:qe(r.data)},iseeBizNo:G}}))}catch{s.canInsure=!0}},Le=async()=>{if(!ne.value)return{};const{calcData:a,riskVOList:e}=_e({holder:o.holder,insured:o.insured,tenantId:v,paymentFrequency:o.paymentFrequency,productDetail:d.value,insureDetail:B.value},!0),t=await Ee(a),{code:u,data:r}=t;return u==="10000"?(C.value=r.premium,{condition:e,data:r}):{}},$e=()=>new Promise((a,e)=>{var t,u;(u=(t=re.value)==null?void 0:t.validateForm)==null||u.call(t).then(async()=>{if(!ne.value)return;const{calcData:r,riskVOList:n}=_e({holder:o.holder,insured:o.insured,tenantId:v,paymentFrequency:o.paymentFrequency,productDetail:d.value,insureDetail:B.value},!0),m=await Ee(r),{code:p,data:y}=m;p==="10000"?(C.value=y.premium,a({condition:n,data:y})):e(new Error)}).catch(()=>{s.canInsure=!0})}),se=async()=>{var a;if(x){ue();return}s.canInsure=!1;try{const{condition:e,data:t}=await $e(),u={},r=(m=[])=>{(m||[]).forEach(p=>{var y;u[p.riskCode]=p,((y=p.riskPremiumDetailVOList)==null?void 0:y.length)&&r(p.riskPremiumDetailVOList)})};r(t.riskPremiumDetailVOList);const n=gt({tenantId:v,riskList:e,riskPremium:u,productId:(a=d.value)==null?void 0:a.id});Ve(n)}catch{s.canInsure=!0}},Ye=a=>{a==="allFalse"?(k.value=!1,se(),s.canInsure=!0):lt.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"}).then(()=>{window.history.back()})},Ke=()=>{be.value=!0,U.value=!1,k.value=!0};at([()=>o.insured.certNo,()=>o.insured.socialFlag],ot.exports.debounce(()=>{o.insured.certNo&&o.insured.socialFlag&&K!=="payBack"&&xe()&&Le()},500),{deep:!0,immediate:!0});const le=async()=>{var u,r,n,m,p,y,A,T,b,ie,ce,de,me;const a=await yt({orderNo:_,tenantId:v}),{code:e,data:t}=a;if(e==="10000"){const{tenantOrderHolder:g,tenantOrderInsuredList:l,extInfo:O}=t;if(!x){Object.assign(o,{holder:{certNo:g.certNo,certType:g.certType,mobile:g.mobile,name:g.name,socialFlag:V.HAS},insured:{certNo:l==null?void 0:l[0].certNo,certType:(u=l[0])==null?void 0:u.certType,name:(r=l[0])==null?void 0:r.name,socialFlag:(m=(n=l[0])==null?void 0:n.extInfo)==null?void 0:m.hasSocialInsurance,relationToHolder:(p=l[0])==null?void 0:p.relationToHolder},paymentMethod:O.extraInfo.paymentMethod,paymentFrequency:O.extraInfo.paymentFrequency,renewalDK:"Y"}),s.canInsure=!0;return}Object.assign(o,{holder:{certNo:g.certNo,certType:g.certType,mobile:g.mobile,name:g.name,socialFlag:V.HAS},insured:{certNo:l==null?void 0:l[0].certNo,certType:(y=l[0])==null?void 0:y.certType,name:(A=l[0])==null?void 0:A.name,socialFlag:(b=(T=l[0])==null?void 0:T.extInfo)==null?void 0:b.hasSocialInsurance,relationToHolder:(ie=l[0])==null?void 0:ie.relationToHolder},paymentMethod:O.extraInfo.paymentMethod,paymentFrequency:O.extraInfo.paymentFrequency,renewalDK:O.extraInfo.renewalDK||"N"}),C.value=(me=(de=(ce=l[0])==null?void 0:ce.tenantOrderProductList)==null?void 0:de[0])==null?void 0:me.premium,(t.orderStatus===X.ACCEPT_POLICY||t.orderStatus===X.PAYMENT_SUCCESS)&&(s.canUpgrade=!0,W.value=!1,z.value=!0),t.orderStatus===X.PAYING&&(W.value=!0,setTimeout(()=>{le()},3*1e3))}},We=async()=>{const a=Dt({productCode:Y,withInsureInfo:!0,tenantId:v}),e=ft({productCode:Y});await Promise.all([a,e]).then(([t,u])=>{var r;t.code==="10000"&&(d.value=t.data,document.title=((r=t.data)==null?void 0:r.productFullName)||""),u.code==="10000"&&(B.value=u.data)}),_&&le()},ze=()=>{x?(E.value=Ie,M.value=Ie,console.log("\u652F\u4ED8\u5B8C\u6210\u8FDB\u5165")):_?(console.log("\u6295\u4FDD\u94FE\u63A5-\u6765\u4ED8\u94B1"),E.value=I(N({},$),{paymentFrequencyDisable:!0}),M.value=$,s.canInsure=!0):ee||_||(console.log("\u6295\u4FDD\u94FE\u63A5"),E.value=I(N({},$),{paymentFrequencyDisable:!0}),M.value=$,s.canInsure=!0)};return rt(()=>{ze(),We(),setTimeout(async()=>{G=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(a,e)=>{const t=ye("van-button"),u=ye("van-config-provider"),r=nt("dompurify-html");return S(),j(st,null,[D(u,{"theme-vars":h(Et)},{default:Q(()=>{var n,m,p,y,A,T,b;return[H.value.show?ut((S(),j("div",Pt,null,512)),[[r,H.value.html]]):R("",!0),q("div",xt,[q("div",kt,[D(_t,{url:(m=(n=d.value)==null?void 0:n.tenantProductInsureVO)==null?void 0:m.banner[0]},null,8,["url"]),D(Nt,{"product-name":(p=d.value)==null?void 0:p.productFullName,"product-desc":(A=(y=d.value)==null?void 0:y.showConfigVO)==null?void 0:A.desc},null,8,["product-name","product-desc"])]),D(It,{"guarantee-list":(b=(T=d.value)==null?void 0:T.tenantProductInsureVO)==null?void 0:b.titleAndDescVOS},null,8,["guarantee-list"]),D(wt,{detail:d.value},{form:Q(()=>[D(Bt,{ref_key:"formRef",ref:re,disable:!h(s).showInsure,"form-auth":E.value,"form-info":h(o),premium:C.value,"product-detail":d.value,payments:[1],"payment-method":[0],onOnReset:Ue,onOnUpdate:He},null,8,["disable","form-auth","form-info","premium","product-detail"])]),_:1},8,["detail"]),q("div",Ut,[q("div",Ht,[Mt,C.value?(S(),j("span",Rt,"\uFFE5"+ve(h(mt)(C.value))+"/\u6708",1)):R("",!0)]),D(t,{type:"primary",class:"right",disabled:!(h(s).canInsure||h(s).canUpgrade),onClick:se},{default:Q(()=>[we(ve(h(s).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),h(K)!=="payBack"?(S(),Fe(At,{key:1,"product-detail":d.value},null,8,["product-detail"])):R("",!0),D(Tt,{"order-no":h(_),"tenant-id":h(v),"upgrade-code":h(Te),"is-show":z.value,onOnConfirm:ue,onOnClose:ke},null,8,["order-no","tenant-id","upgrade-code","is-show"])]}),_:1},8,["theme-vars"]),D(bt,{show:k.value,"onUpdate:show":e[0]||(e[0]=n=>k.value=n),"content-list":h(Se),"active-index":0,onOnConfirmHealth:Ye},null,8,["show","content-list"]),U.value?(S(),Fe(St,{key:0,show:U.value,"onUpdate:show":e[1]||(e[1]=n=>U.value=n),"content-list":h(Pe),"active-index":Oe.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9",onSubmit:Ke},null,8,["show","content-list","active-index"])):R("",!0),D(Ot,{"is-show":W.value},null,8,["is-show"])],64)}}});var oa=ct(qt,[["__scopeId","data-v-9b08c608"]]);export{oa as default};
