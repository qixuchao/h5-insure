import{d as e,h as s,i as t,j as a,O as o,o as i,l,w as r,a as d,e as u,b as c,u as n,c as p,m,F as v,n as f,_ as k,T as C,ap as R,aq as j,ar as I,as as L,at as h,au as y,g as b,av as _,q as g,s as P}from"./index-404eec03.js";import{T as q}from"./index-00b8fdcc.js";import{a as N,b as w,g as x,s as M,i as S,m as A}from"./trial-37239397.js";import{_ as V}from"./index-d0359ef1.js";import{C as K}from"./index-32e12681.js";import{S as D}from"./index-8f86058d.js";import{R as O}from"./trial-6f236b5b.js";import{_ as T}from"./TrialButton-15acb742.js";import{u as E}from"./useOrder-2c41679e.js";import{B,a as F}from"./constants-fe95ef6f.js";import{a as U}from"./utils-a1833ec1.js";import"./cloneDeep-ee1499a7.js";import"./InsureInfos-d2bf8d8d.js";import"./index-de590a0b.js";import"./get-a0b6b731.js";import"./infoCollection-8d0c5911.js";import"./index-276e1396.js";import"./PolicyInfo-a070148c.js";import"./lodash-dc4d2401.js";import"./questionnaire-62331097.js";import"./util-f7c56da2.js";import"./product-585b0e6f.js";import"./constants-6b186800.js";import"./utils-7f5f1ead.js";import"./createProposal-09c1b67b.js";import"./nextStep-4be7c141.js";import"./core-9d9a23d5.js";import"./empty-ae586b6c.js";import"./index-4920c9d6.js";import"./utils-0bfccf41.js";const $={class:"popup-container"},H={class:"popup-header"},z={class:"title"},G=(e=>(h("data-v-d7048a66"),e=e(),y(),e))((()=>d("p",{class:"tip"},"已为您挑选出以下险种",-1))),J={class:"search"},Q={key:0,class:"risk-list"},W=e({name:"riskSelect"});var X=k(e({...W,props:{type:{default:2},show:{type:Boolean,default:!1},title:{},insuredList:{default:()=>[]},mainRiskCode:{default:""},selectList:{default:()=>[]}},emits:["cancel","confirm"],setup(e,{emit:k}){const h=e,y=s(),{insurerCode:b}=y.query,_=t(),g=t([]),P=a((()=>h.show)),q=()=>{k("cancel")},x=()=>{_.value?k("confirm",_.value):C(`暂未添加任何${h.type===O.MAIN_RISK?"主":"附加"}险`)};return o((()=>{(async()=>{var e;const s={insuredList:h.insuredList,mainRiskCode:h.mainRiskCode,insurerCode:b,productCategory:"",selectProductCodes:[],selectRiskCodes:[],filterFlag:(null==(e=h.selectList)?void 0:e.length)?1:2};if(s.selectProductCodes=h.selectList.map((e=>(s.selectRiskCodes.push(...e.mergeRiskReqList.map((e=>e.riskCode))),e.productCode))),h.type===O.MAIN_RISK){const{code:e,data:t}=await N(s);"10000"===e&&(g.value=t)}else{const{code:e,data:t}=await w(s);"10000"===e&&(g.value=t)}})()})),(e,s)=>{const t=D,a=R,o=j,k=K,C=I,h=V,y=L;return i(),l(y,{show:n(P),"onUpdate:show":s[1]||(s[1]=e=>m(P)?P.value=e:null),class:"popup-risk-select",closeable:!1},{default:r((()=>[d("div",$,[d("div",H,[d("span",{class:"clear-all",onClick:q}," 取消 "),d("span",z,u(e.title),1),d("span",{class:"close",onClick:x},"确认")]),G,d("div",J,[c(t,{shape:"round",placeholder:"请输入产品名称进行搜索"})]),n(g).length?(i(),p("div",Q,[c(C,{modelValue:n(_),"onUpdate:modelValue":s[0]||(s[0]=e=>m(_)?_.value=e:null)},{default:r((()=>[c(k,{inset:""},{default:r((()=>[(i(!0),p(v,null,f(n(g),(e=>(i(),l(o,{key:e.riskCode||e.productCode,title:e.riskName||e.productName,clickable:"",onClick:s=>_.value=e.riskCode||e.productCode},{icon:r((()=>[c(a,{name:e.riskCode||e.productCode},null,8,["name"])])),_:2},1032,["title","onClick"])))),128))])),_:1})])),_:1},8,["modelValue"])])):(i(),l(h,{key:1,title:`暂无关联${e.type===n(O).MAIN_RISK?"主":"附加"}险、请选择其他险种`},null,8,["title"]))])])),_:1},8,["show"])}}}),[["__scopeId","data-v-d7048a66"]]);const Y={class:"page-trial-wrap"},Z=e({name:"trial"}),ee=e({...Z,setup(e){const o=s(),d=b(),{productCode:u,orderNo:m,tenantId:v}=o.query,f=t({}),k=t({productList:[]}),C=t([]),R=t({}),j=t(),I=t(),L=E({extInfo:{templateId:201,buttonCode:B.TRIAL_PREMIUM,pageCode:F.TRIAL_PREMIUM}}),h=t(),y=t(1),N=a((()=>y.value===O.MAIN_RISK?"添加主险":"添加附加险")),w=t(!1),V=()=>{w.value=!1},K=e=>{if(y.value===O.MAIN_RISK)k.value.productList.push({productCode:e,mergeRiskReqList:[]}),j.value.getProductDefaultValue(e);else{k.value.productList.find((e=>e.productCode===I.value)).mergeRiskReqList.push({riskCode:e,riskType:O.RIDER_RISK,mainRiskCode:R.value.riskCode}),j.value.getRiderRiskDefaultValue(I.value,e,R.value.riskCode)}A(k.value).then((({code:e,data:s})=>{if("10000"===e){const{productDetailResList:e,productFactor:t}=s;h.value=t,k.value=U(e);const a={};e.forEach((e=>{a[e.productCode]=e})),f.value=a}})),w.value=!1},D=(e,s,t)=>{w.value=!0,y.value=O.RIDER_RISK,C.value=t,R.value=s,I.value=e},$=e=>{w.value=!0,y.value=O.MAIN_RISK,C.value=e},H=(e,s,t)=>{f.value[e],t?(f.value[e].productPlanInsureVOList[0].insureProductRiskVOList=f.value[e].productPlanInsureVOList[0].insureProductRiskVOList.filter((e=>e.riskCode!==s)),k.value.productList=k.value.productList.map((t=>(t.productCode===e&&(t.mergeRiskReqList=t.mergeRiskReqList.filter((e=>e.riskCode!==s))),t)))):(delete f.value[e],k.value.productList=k.value.productList.filter((s=>s.productCode!==e)))},z=()=>{j.value.onNext((async e=>{const{code:s,data:t}=await M(e);"10000"===s&&d.push({path:P.questionNotice,query:{...o.query,orderNo:t}})}))};return _((()=>{S({productCode:u,isTenant:!1}).then((({data:e,code:s})=>{var t,a;"10000"===s&&(f.value[`${u}`]=e,h.value=null==(a=null==(t=null==e?void 0:e.productPlanInsureVOList)?void 0:t[0])?void 0:a.productFactor,k.value=U([e]))})),m&&x({orderNo:m,tenantId:v}).then((({code:e,data:s})=>{"10000"===e&&(L.value=s)}))})),(e,s)=>(i(),p("div",Y,[c(q,{ref_key:"trialRef",ref:j,"product-collection":n(f),"default-value":n(L),"product-factor":n(h),"product-risk-code-map":n(k),"is-trial":"","hide-benefit":"",onAddRisk:D,onAddMainRisk:$,onDeleteRisk:H},{trialBtn:r((({riskPremium:e})=>[c(T,{premium:e.initialPremium,onHandleClick:z},null,8,["premium"])])),_:1},8,["product-collection","default-value","product-factor","product-risk-code-map"]),n(w)?(i(),l(X,{key:0,type:n(y),show:n(w),"insured-list":n(C),title:n(N),"main-risk-code":n(R).riskCode,"select-list":n(k).productList,onCancel:V,onConfirm:K},null,8,["type","show","insured-list","title","main-risk-code","select-list"])):g("",!0)]))}});export{ee as default};
