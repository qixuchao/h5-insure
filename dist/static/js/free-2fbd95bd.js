import{m as e,ay as t,r as a,P as r,a0 as o,t as i,C as n,E as l,F as s,U as d,_ as c,a6 as u,a7 as p,ab as f,u as m,o as v,az as A,s as h,v as w,x as I,z as y,J as O,I as C,T as P}from"./vendor-533c215b.js";import{_ as b,a8 as g,a9 as x}from"./index-3ce9a118.js";import{P as F}from"./index-f7774a4b.js";import{B as j,A as V,_ as D,P as k}from"./index-c3d8f084.js";import{_ as T,n as E}from"./nextStep-702f95d9.js";import{a as N,s as B,c as U}from"./phoneVerify-10392991.js";import{p as H,g as L,q as _}from"./product-fcef95a2.js";import{i as R,t as S}from"./trial-0df34b01.js";import{j as z}from"./trial-618f0ef0.js";import{v as Z,f as J}from"./utils-7945c91c.js";import{u as M}from"./theme-467ed2f7.js";import"./infoCollection-cd4a13b9.js";import"./relativeTime-67dc04d9.js";import"./useDicData-406d33ce.js";import"./useStorage-56fd4f97.js";var G="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFYAAAAeCAMAAACBgxnEAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAA8UExURUdwTPpkAPpkAPpkAPlkAPlkAP9fAPpkAP9jAPljAPljAPlkAPdhAP9VAPhlAPpjAPpiAPpkAPlhAPpkAKrbDd8AAAATdFJOUwCe3XX6YBgzC+yKwSIDTrE+0C9Hm6hZAAAAf0lEQVR42u2MSw6AIAxEi6CCf+j976ommvG3omxMOqv2vczQmZa3tPRMptdZndVZndXZf892/JGOxN68qUEr24/zk84jSvne93fae3Qk3scrjZeWzDcVaNUQIvRDOGkYQOU+hYMmsBJ+cTt1C0gZP7mNTvhL+Zq5xlfOW4tb6le9ZDBDk4RvXwAAAABJRU5ErkJggg==";const Q={class:"free-crad"},q={class:"container"},X={class:"title"},K=["src"],Y=(e=>(u("data-v-a8331544"),e=e(),p(),e))((()=>l("span",null,"最后一步 填写信息",-1))),$=["src"];var W=b(e({props:{colors:{type:Array,default:()=>["#CDDFFE","#F1F7FE"]},detail:{type:Object,default:()=>{}},isFirst:{type:Boolean,default:!0},insureDetail:{type:Object,default:()=>{}}},setup(e,{expose:u}){const p=e;t((e=>({"2689eaee":p.colors[0],"2689eab0":p.colors[1]})));const f=a(),m=r({factorObj:{1:[{attributeValues:null,code:"mobile",datasource:null,defaultValue:null,displayType:null,factorId:null,factorScript:null,hasDefaultValue:1,id:8249,isDisplay:1,isHidden:1,isMustInput:2,isReadOnly:null,moduleType:1,placeholder:null,planCode:null,position:null,productCode:"lin23323",productId:null,title:"手机号"},{attributeValues:null,code:"verificationCode",datasource:null,defaultValue:null,displayType:null,factorId:null,factorScript:null,hasDefaultValue:1,id:8249,isDisplay:1,isHidden:1,isMustInput:2,isReadOnly:null,moduleType:1,placeholder:null,planCode:null,position:null,productCode:"lin23323",productId:null,title:"验证码"}],2:[],3:[]},isFirst:!0}),v=async(e,t)=>{const a=p.isFirst?N:B,r=await a(e),{code:o,data:i}=r;"10000"===o&&(null==t||t())};return o((()=>p.isFirst),(()=>{var e;p.isFirst||(m.factorObj=null==(e=p.insureDetail)?void 0:e.productFactor)})),u({validateForm:()=>new Promise(((e,t)=>{f.value.validateForm().then((t=>{e(!0)})).catch((()=>{t()}))}))}),(t,a)=>(i(),n("div",Q,[l("div",q,[l("div",X,[l("img",{src:s(G)},null,8,K),Y,l("img",{src:s(G)},null,8,$)]),d(T,{ref_key:"formRef",ref:f,"send-sms-code":v,"form-info":e.detail,"factor-object":s(m).factorObj},null,8,["form-info","factor-object"]),c(t.$slots,"default",{},void 0,!0)])]))}}),[["__scopeId","data-v-a8331544"]]);const ee={class:"page-free-product-detail"},te={class:"product-desc"},ae={key:0,class:"page-free-footer"};var re=b(e({setup(e){t((e=>({"21bcac0e":s(re).colors[1]})));const c=M(),u=f(),p=m(),{productCode:b="",tenantId:T="",extraInfo:N}=p.query;let B={};try{B=JSON.parse(decodeURIComponent(N))}catch(ce){}const{openId:G,indirectCode:Q="123",saleUserId:q="",saleChannelId:X=""}=B;let K="";const Y=a(),$=a(),re=r({colors:["#fff"],detail:{},order:{tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},insuredBeneficiaryType:"1",tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}]}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}},relationList:{},banner:"",productDesc:[],newAuth:!0,isValidateCode:!1,insureDetail:{},loading:!0,showBtn:!1,activeIndex:0,showFilePreview:!1,isOnlyView:!0}),oe=a(),ie=async()=>{re.loading=!0;const e=H({productCode:b,withInsureInfo:!0,tenantId:T}),t=R({productCode:b}),a=L({openId:G}),r=_({openId:G});await Promise.all([e,t,a,r]).then((([e,t,a,r])=>{var o,i,n;if("10000"===e.code){re.detail=e.data,re.banner=null==(o=re.detail.tenantProductInsureVO)?void 0:o.banner[0];const{colorEnd:t,colorStart:a}=(null==(i=re.detail.tenantProductInsureVO)?void 0:i.backgroundInsureVO)||{};re.colors=[a,t],re.productDesc=re.detail.tenantProductInsureVO.spec||[],document.title=re.detail.productFullName||""}if("10000"===t.code&&(re.insureDetail=t.data,re.insureDetail.productFactor[1].forEach((e=>{"verificationCode"===e.code&&1===e.isDisplay&&(re.isValidateCode=!0)})),re.insureDetail.productFactor[2]=null==(n=re.insureDetail.productFactor)?void 0:n[2].map((e=>{var t,a;return"relationToHolder"===e.code&&1===e.isDisplay&&(e.title="被保人",re.order.tenantOrderInsuredList[0].relationToHolder=(null==(a=null==(t=e.attributeValueList)?void 0:t[0])?void 0:a.code)||""),e}))),"10000"===a.code&&(re.newAuth=!a.data,a.data)){const e=a.data;re.order.tenantOrderHolder={certNo:null==e?void 0:e.certiNo,extInfo:{},mobile:null==e?void 0:e.mobile,name:null==e?void 0:e.name}}if("10000"===r.code){const e={};r.data.forEach((t=>{e[t.relationCode]||(e[t.relationCode]=[]),e[t.relationCode].push(t)})),re.relationList=e}(()=>{let e={};if(e=re.detail.tenantProductInsureVO.planInsureVO.attachmentVOList||[],!e)return void(oe.value=[]);const t={2:"richText",3:"link"};oe.value=Object.keys(e).map((a=>(e[a].forEach((e=>{if("1"===e.attachmentType){const t=e.attachmentUri.split("?"),a=t[0].substr(t[0].lastIndexOf(".")+1);e.attachmentType="pdf"===a?"pdf":"picture"}else e.attachmentType=t[e.attachmentType]})),{attachmentName:a,attachmentList:e[a]})))||[]})(),re.loading=!1}))},ne=async()=>{let e={loginType:"2",openId:G,thirdUserType:"XINAO_WECHAT",indirectCode:Q};try{if(re.newAuth?(e.loginName=re.order.tenantOrderHolder.mobile,e.password=re.order.tenantOrderHolder.verificationCode):e=J({order:re.order,tenantId:T,extraInfo:B,detail:re.detail,insureDetail:re.insureDetail,iseeBizNo:K,saleUserId:q,templateId:null==B?void 0:B.templateId,saleChannelId:X,pageCode:"infoCollection",buttonCode:"EVENT_FREE_multiIssuePolicy"}),re.newAuth){const{code:t,data:a}=await S(e);"10000"===t&&(re.newAuth=!1)}else E(e,((e,t)=>{t===x.JUMP_PAGE&&e.orderNo&&u.push(`/baseInsurance/orderDetail?from=free&tenantId=${T}&orderNo=${e.orderNo}&productCode=${b}`)}))}catch(t){}},le=async()=>await(async()=>{var e;await $.value.validateForm();const t=null==(e=re.order.tenantOrderHolder)?void 0:e.verificationCode;if(re.isValidateCode&&(!t||!Z(t)))return P({message:"请输入正确的验证码"}),!1;if(re.newAuth||!re.isValidateCode)return!0;const{code:a,data:r}=await U(re.order.tenantOrderHolder.mobile,t);return!!r})()?(re.newAuth||0===oe.value.length?ne():(re.isOnlyView=!1,re.showFilePreview=!0),!1):null,se=()=>{re.showFilePreview=!1,re.isOnlyView=!1},de=()=>{re.showFilePreview=!1,re.isOnlyView=!0,ne()};return v((()=>{ie(),setTimeout((async()=>{K=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),o((()=>re.order.tenantOrderInsuredList[0]),(e=>{if(g(re.relationList))return null;const t=re.relationList[e.relationToHolder]||[];return 1===t.length&&(z.SELF!==e.relationToHolder?(re.order.tenantOrderInsuredList[0].certNo=t[0].cert[0].certNo,re.order.tenantOrderInsuredList[0].name=t[0].cert[0].certName):(re.order.tenantOrderHolder.certNo=t[0].cert[0].certNo,re.order.tenantOrderHolder.name=t[0].cert[0].certName)),!1}),{immediate:!0,deep:!0}),A(Y,(([{isIntersecting:e}],t)=>{re.showBtn=!e})),(e,t)=>{const a=h("van-image"),r=h("van-config-provider");return i(),w(r,{"theme-vars":s(c)},{default:I((()=>[l("div",ee,[d(j,{url:s(re).banner},null,8,["url"]),d(W,{ref_key:"formRef",ref:$,"is-first":s(re).newAuth,"insure-detail":s(re).insureDetail,detail:s(re).order,colors:s(re).colors},{default:I((()=>[d(F,{ref_key:"root",ref:Y,class:"submit-btn","is-gradient":!1,text:s(re).newAuth?"立即领取":"激活保障",onClick:le},null,8,["text"]),oe.value&&oe.value.length>0?(i(),w(V,{key:0,"attachement-list":oe.value,"has-bg-color":!1,"pre-text":"请阅读",onPreviewFile:t[0]||(t[0]=e=>(e=>{re.activeIndex=e,re.showFilePreview=!0})(e))},null,8,["attachement-list"])):y("",!0)])),_:1},8,["is-first","insure-detail","detail","colors"]),l("div",te,[(i(!0),n(C,null,O(s(re).productDesc,((e,t)=>(i(),w(a,{key:t,width:"100%","lazy-load":"",src:e,class:""},null,8,["src"])))),128))]),s(re).showBtn?(i(),n("footer",ae,[d(F,{"is-gradient":!1,text:s(re).newAuth?"立即领取":"激活保障",onClick:le},null,8,["text"])])):y("",!0)]),s(re).showFilePreview&&0!==oe.value.length?(i(),w(D,{key:0,show:s(re).showFilePreview,"onUpdate:show":t[1]||(t[1]=e=>s(re).showFilePreview=e),"content-list":oe.value,"is-only-view":s(re).isOnlyView,"active-index":s(re).activeIndex,text:s(re).isOnlyView?"关闭":"我已逐页阅读上述内容并同意","force-read-cound":0,"on-close-file-preview":"",onSubmit:de,onOnCloseFilePreview:se},null,8,["show","content-list","is-only-view","active-index","text"])):y("",!0),s(re).loading?y("",!0):(i(),w(k,{key:1,"product-detail":s(re).detail},null,8,["product-detail"]))])),_:1},8,["theme-vars"])}}}),[["__scopeId","data-v-71139e7e"]]);export{re as default};
