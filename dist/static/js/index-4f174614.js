import{G as a,d as e,bI as s,A as r,r as t,aA as o,a as l,L as i,a3 as n,b as d,g as u,w as p,e as c,f as m,a0 as v,i as f,c as h,$ as g,a7 as y,E as b,j as L,bb as P,c2 as x,z as k,h as I,D as _,T as V,B as j,bs as $,S as C}from"./index-cbe3b4e4.js";import{L as O}from"./index-10d3cc89.js";import{S as E}from"./index-5e29c41a.js";import{P as N}from"./index-9befa038.js";import{_ as T}from"./empty-ae586b6c.js";import{P as w}from"./index-7cb2a6bd.js";import{d as S,h as A}from"./proposalList-e9f5c8c0.js";import{a as H,b as U,t as q}from"./format-b5e9d8b9.js";import{R as z}from"./product-585b0e6f.js";const B={class:"proposal-content"},D={class:"title"},G={class:"premium"},M={class:"insure-info"},R={class:"operate-btn"};var W=a(e({__name:"index",setup(a){const e=s(),W=[{title:"险种名称",dataIndex:"riskName",width:180},{title:"保障期间",dataIndex:"coveragePeriod",render:a=>H(null==a?void 0:a.coveragePeriod)},{title:"交费期间",dataIndex:"chargePeriod",width:110,render:a=>U(null==a?void 0:a.chargePeriod)},{title:"保费",dataIndex:"premium",width:120,render:a=>q(null==a?void 0:a.initialPremium)}],F=r({historyList:[],searchValue:""}),J=t(!1),K=t(!1),Q=t(1),{historyList:X,searchValue:Y}=o(F),Z=l(),aa=a=>{const e=z.find((e=>+e.value==+a));return e&&e.label||"本人"},ea=()=>{A({name:Y.value,pageNum:Q.value,pageSize:20,relationUserType:2}).then((a=>{const{code:e,data:s}=a;"10000"===e&&(1===Q.value?X.value=s.datas||[]:X.value=X.value.concat(s.datas),J.value=!1,Q.value+=1,K.value=X.value.length>=s.total)}))},sa=a=>a===+C.MALE,ra=a=>{if(a.proposalName)return a.proposalName;if(a.proposalInsuredVOList.length>1){const e=a.proposalInsuredVOList.find((a=>1===a.relationToHolder||null===a.relationToHolder));if(e){const{name:a,gender:s}=e;return sa(s)?`${a}先生的计划书`:`${a}女士的计划书`}}if(1===a.proposalInsuredVOList.length){const{name:e}=a.proposalInsuredVOList[0],{gender:s}=a.proposalInsuredVOList[0];return sa(s)?`${e}先生的计划书`:`${e}女士的计划书`}return"计划书"},ta=a=>{let e=[];return a.forEach((a=>{e=e.concat(a.riskList)})),e},oa=a=>{let e=0;return a.forEach((a=>{a.riskList.forEach((a=>{null!==a.initialPremium&&(e+=+a.initialPremium)}))})),e},la=()=>{ea()},ia=i((()=>X.value.length>0)),na=a=>{Y.value=a,Q.value=1,ea()};return(a,s)=>{const r=E,t=j,o=O,l=n("ProPageWrap"),i=$;return d(),u(i,{"theme-vars":m(e)},{default:p((()=>[c(l,{class:"page-history-proposal"},{default:p((()=>[c(r,{modelValue:m(Y),"onUpdate:modelValue":s[0]||(s[0]=a=>v(Y)?Y.value=a:null),placeholder:"请输入被保人姓名/计划书名称",shape:"round",class:"search",onSearch:na},null,8,["modelValue"]),f("div",B,[c(o,{loading:m(J),"onUpdate:loading":s[1]||(s[1]=a=>v(J)?J.value=a:null),finished:m(K),"finished-text":m(ia)?"- 没有更多了 -":"",onLoad:la},{default:p((()=>[(d(!0),h(g,null,y(m(X),(a=>(d(),h("div",{key:a.id,class:"proposal-item"},[f("div",D,b(a.proposalName||ra(a)),1),f("p",G,[L(" 总保费："),f("span",null,"¥"+b(m(P)(a.totalPremium)),1)]),(d(!0),h(g,null,y(a.proposalInsuredVOList,((a,e)=>(d(),h("div",{key:`proposal_${e}`},[f("p",M,b(a.name)+" / "+b(aa(a.relationToHolder))+" / "+b(m(x)[null==a?void 0:a.gender])+" / "+b(m(k)().diff(null==a?void 0:a.birthday,"y")+"岁")+" / "+b(`首年保费 ${m(P)(oa(a.productList))}元`),1),c(w,{columns:W,class:"table","data-source":ta(a.productList)},null,8,["data-source"])])))),128)),f("div",R,[c(t,{plain:"",round:"",type:"primary",class:"del-btn",onClick:e=>{return s=a.id,void _.confirm({message:"是否确定删除计划书？"}).then((()=>{S(s).then((a=>{const{code:e}=a;"10000"===e&&(V.success("删除成功"),Q.value=1,ea())}))})).catch((()=>{}));var s}},{default:p((()=>[L("删除")])),_:2},1032,["onClick"]),c(t,{plain:"",round:"",type:"primary",onClick:e=>{return s=a.id,void Z.push({path:"/proposal/createProposal",query:{id:s}});var s}},{default:p((()=>[L("编辑")])),_:2},1032,["onClick"]),c(t,{plain:"",round:"",type:"primary",onClick:e=>{return s=a.id,void Z.push({path:"compositionProposal",query:{id:s}});var s}},{default:p((()=>[L("预览")])),_:2},1032,["onClick"])])])))),128))])),_:1},8,["loading","finished","finished-text"])]),m(ia)||m(J)?I("",!0):(d(),u(N,{key:0,"empty-img":m(T),title:"暂无历史计划书","empty-class":"empty-select"},null,8,["empty-img"]))])),_:1})])),_:1},8,["theme-vars"])}}}),[["__scopeId","data-v-6c79aa9e"]]);export{W as default};
