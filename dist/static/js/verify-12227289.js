import{d as e,j as a,k as l,E as s,o as i,p as o,w as n,a as r,e as u,u as t,b as d,bg as c,bh as v,cA as m,cB as f,bL as h,cC as p,cD as g,au as y,ae as b,cE as S,i as C,h as k,ce as V,bi as I,aY as q,ah as w,bc as _,l as L,c as j,f as U,F,q as D,v as x,y as N,cF as $,cg as A,cG as E,cH as M,c5 as O,cI as P,T,cJ as R,cK as B,cL as H,af as Y,b4 as G,bO as z,cM as Q,bb as J,ba as K,bk as W,a_ as Z,a$ as X,bR as ee,b3 as ae,ch as le,ci as se,ck as ie,cj as oe}from"./index-95a350f1.js";import{P as ne}from"./index-33f34987.js";import{n as re}from"./nextStep-a319a228.js";import{c as ue}from"./format-31cde443.js";import{g as te,m as de}from"./trial-9cae0763.js";import{p as ce}from"./utils-0c18e647.js";import{u as ve}from"./useOrder-449a7b5d.js";import{c as me}from"./order-cdfe5faf.js";import{_ as fe}from"./MessagePopup-ed0836eb.js";import"./core-df64eccf.js";import"./utils-4e96fd74.js";import"./infoCollection-53154635.js";import"./trial-e55382d3.js";import"./utils-30bea1ba.js";import"./createProposal-b24d9f69.js";import"./PolicyInfo-7c696e84.js";import"./cloneDeep-8c43540d.js";const he={class:"popup-container"},pe={class:"popup-header"},ge={class:"title"},ye={class:"popup-body"},be=e({name:"checkCodePopup"}),Se=e({...be,props:{show:{type:Boolean,default:!1},type:{default:"agent"},data:{default:()=>({})}},emits:["cancel","confirm"],setup(e,{emit:b}){const S=e,C=b,k=a(),V=l((()=>S.show)),I=a({mobile:"",verifyCode:""}),q=l((()=>S.type)),w=a({holder:{type:"投保人",name:"",mobile:"",desc:""},agent:{type:"销售人员",name:"",mobile:"",desc:"色卡上会计核算看回放独守空房还是空巅峰计划收款方"},insured:{type:"被保险人",name:"",mobile:"",desc:""}}),_=()=>{C("cancel")},L=()=>{k.value.validate().then((()=>{C("confirm")}))};return s([()=>S.data,S.type],(([e,a])=>{var l,s,i;e&&(Object.assign(w.value.holder,e.holder),Object.assign(w.value.insured,null==(l=null==e?void 0:e.insuredList)?void 0:l[0]),I.value.mobile=null==(i=null==(s=w.value)?void 0:s[S.type])?void 0:i.mobile)}),{immediate:!0,deep:!0}),(e,a)=>{const l=h,s=p,b=g,S=y;return i(),o(S,{show:V.value,"onUpdate:show":a[2]||(a[2]=e=>V.value=e),class:"popup-check-mobile",closeable:!1,"close-on-click-overlay":!1},{default:n((()=>[r("div",he,[r("div",pe,[r("span",{class:"clear-all",onClick:_}," 取消 "),r("span",ge,u(`${w.value[q.value].type}手机号验证`),1),r("span",{class:"close",onClick:L},"确认")]),r("div",ye,[r("h3",null,u(`尊敬的${w.value[q.value].type}:${w.value[q.value].name}`),1),r("p",null,u(w.value[q.value].desc),1),r("h3",null,u(`${w.value[q.value].type}手机号验证 ${t(ue)(w.value[q.value].mobile||"")}`),1),d(b,{ref_key:"formRef",ref:k,"validate-method":"toast",model:I.value},{default:n((()=>[c(d(l,{modelValue:I.value.mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>I.value.mobile=e),label:"被保险人手机号",name:"mobile",maxlength:"11",rules:[{required:!0,message:"请输入手机号"}]},null,8,["modelValue"]),[[v,!1]]),d(s,{modelValue:I.value.verifyCode,"onUpdate:modelValue":a[1]||(a[1]=e=>I.value.verifyCode=e),"related-name":"mobile",label:" ",maxlength:"6","input-align":"left",placeholder:"请输入验证码",name:"verifyCode",rules:[{required:!0,message:"请输入验证码"}],"send-s-m-s-code":t(m),"check-s-m-s-code":t(f)},null,8,["modelValue","send-s-m-s-code","check-s-m-s-code"])])),_:1},8,["model"])])])])),_:1},8,["show"])}}}),Ce=b([{label:"签名完成",value:1},{label:"本地签名",value:2},{label:"认证失败，请联系内勤人员",value:3}]),ke={DUAL:1,DUALING:2,DUAL_FINISH:3,DUAL_FAILED:4},Ve=b([{label:"去双录",value:ke.DUAL},{label:"双录中",value:ke.DUALING},{label:"双录完成",value:ke.DUAL_FINISH},{label:"双录失败",value:ke.DUAL_FAILED}]);const Ie={class:"page-verify-wrap"},qe={key:0,class:"sign-list"},we={class:"inner-cell"},_e={class:"inner-cell"},Le={class:"inner-cell"},je={class:"inner-cell"},Ue={class:"footer-button"},Fe={class:"dialog-content"},De={class:"verify-content-inner"},xe=["src"],Ne=["src"],$e=["src"],Ae=e({name:"verify"}),Ee=e({...Ae,setup(e){const s=S(),u=C(),c=k(),[v,y]=V(!1),{orderNo:b,tenantId:ue}=u.query,he=I.Component,[pe,ge]=V(!1),ye=a(!1),be=a(),Ae=a(!1),Ee=a(!1),Me=a(!1),Oe=a(""),Pe=a(""),Te=a(),Re=a({holderMobile:"",holderVerifyCode:"",insuredMobile:"",insuredVerifyCode:""}),Be=ve(),He=a(!1),Ye=a({sign:[],verify:[],scribing:""}),Ge=a(),ze=a(""),Qe=l((()=>{const{showReturnButton:e}=Be.value;return e===q.YES})),Je=a({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2,shareFlag:2},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{},verifyStatus:2,shareFlag:2},agent:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2}}),Ke=a("agent"),We=l((()=>e=>Ye.value.sign.includes(e)||Ye.value.verify.includes(e))),Ze=l((()=>Je.value.agent.verifyStatus!==q.YES)),Xe=a(!1),ea=l((()=>{const{insuredList:e}=Be.value||{},{age:a,relationToHolder:l}=e[0]||{};return!(a<18||`${l}`===w.CERT)})),aa=l((()=>e=>Je.value[e].isSign||Je.value[e].isVerify)),la=l((()=>e=>Je.value[e].isShareSign)),sa=e=>{var a,l;const{holder:s,insuredList:i}=Be.value;let o={name:s.name,gender:`${$[s.gender]}`};"insured"===e&&(o={name:null==i?void 0:i[0].name,gender:`${$[null==(a=null==i?void 0:i[0])?void 0:a.gender]}`}),A({messageType:ie.HOLDER,orderNo:b,tenantId:ue});const n={...u.query,objectType:e,nextPageCode:"infoPreview"},r={shareType:0,title:`${E[e.toLocaleUpperCase()]}${M.sign.title}`,desc:M.sign.desc.replace("{name}",`${o.name||""}${o.gender||""}`),url:`${null==(l=window.location.href.split("?"))?void 0:l[0]}?${O.stringify(n)}`.replace("/verify","/phoneVerify"),imageUrl:"https://zatech-aquarius-v2-private-test.oss-cn-hangzhou.aliyuncs.com/lian_logo.png?OSSAccessKeyId=LTAI5t9uBW78vZ4sm5i3oQ5C&Expires=1697288114&Signature=S87PMeDRxltLovmmHVTeiHoew1c%3D"};P(r)},ia=(e,a,l)=>{Ke.value=e;const s=()=>{"agent"!==e?Ze.value||l||(He.value=!0):c.push({path:N.agentSign,query:u.query})};`${a}`!=`${q.YES}`||l?s():I.confirm({message:"本次签名已完成，您是否需要重新签名?",confirmButtonText:"是",cancelButtonText:"否"}).then((()=>{s()}))},oa=()=>{var e;Ze.value||[ke.DUAL_FINISH].includes(be.value)||null==(e=Te.value)||e.validate().then((()=>{const e=T.loading({message:"加载中...",duration:0});R(Be.value).then((({code:a,data:l})=>{var s;if("10000"===a){if(l&&ze.value){const a=null==(s=ze.value.match(/(.*)\.app:\/\//))?void 0:s[1];B({packageName:a,scheme:ze.value}).then((e=>{e.isInstall===`${q.YES}`?(Xe.value=!1,H(ze.value)):(Xe.value=!0,ge(!0))})).finally((()=>{e.clear()}))}}else e.clear()})).catch((()=>{e.clear()}))}))},na=()=>{me({orderNo:b,tenantId:ue}).then((({code:e,data:a})=>{"10000"===e&&(delete u.query.orderNo,c.push({path:N.productList,query:u.query}))}))},ra=()=>{var e;e=()=>{y(!1),delete u.query.questionnaireId,c.push({path:Ge.value,query:{...u.query,canBack:Ge.value===N.infoCollection?1:2}})},oe({orderNo:b,tenantId:ue}).then((({code:a})=>{"10000"===a&&(null==e||e())}))},ua=()=>{He.value=!1},ta=()=>{let e="";e="agent"===Ke.value?N.infoPreview:(Ke.value,Je.value[Ke.value].isVerify?N.verifyFace:N.infoPreview),s.set(`${Y}_orderDetail`,Be.value),c.push({path:e,query:{...u.query,objectType:Ke.value,isFirst:1}})},da=async()=>{let e={};const a=G.get(`${Y}_deviceInfo`);await te({orderNo:b,tenantId:ue}).then((({code:a,data:l})=>{var s;if("10000"===a){Object.assign(Be.value,l);const{agentAuthFlag:a}=l.extInfo,{mobile:i,isCert:o,shareFlag:n}=l.holder,{mobile:r,isCert:u,shareFlag:t}=(null==(s=l.insuredList)?void 0:s[0])||{};Object.assign(Re.value,{holderMobile:i,insuredMobile:r}),e=ce(l.insuredList[0].productList),Je.value.agent.verifyStatus=a,Object.assign(Je.value.holder,{verifyStatus:o,shareFlag:n===q.YES}),Object.assign(Je.value.insured,{verifyStatus:u,shareFlag:t===q.YES})}})),await de(e).then((({data:e,code:a})=>{if("10000"===a){const{signInfo:a}=z(e.productFactor);a.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((a=>{e.required&&Ye.value.sign.push(a.code),"1"===a.code?Je.value.agent.isSign=!0:"2"===a.code?Je.value.holder.isSign=!0:"3"===a.code?Je.value.insured.isSign=!0:"4"===a.code?Je.value.holder.isShareSign=!0:"5"===a.code&&(Je.value.insured.isShareSign=!0)})),"customerFace"===e.name&&e.columns.forEach((a=>{e.required&&Ye.value.verify.push(a.code),"1"===a.code?Je.value.holder.isVerify=!0:"2"===a.code&&(Je.value.insured.isVerify=!0)}))}))}})),await Q({orderNo:b,tenantId:ue}).then((({code:e,data:l})=>{if("10000"===e){const{doubleRecordFlag:e,doubleRecordStatus:s}=l;ye.value=e===q.YES,be.value=s,Ee.value=!0,Oe.value=null==l?void 0:l.iosDownUrl,Pe.value=null==l?void 0:l.andDownUrl,a&&(ze.value=l.andUrl||"","iOS"===a.platform&&(ze.value=l.iosUrl||""))}})),Ae.value=!1},ca=async()=>{var e;const{holder:a,insuredList:l,extInfo:s}=Be.value;if(ye.value){if(s.agentAuthFlag!==q.YES)return void T("销售人员签名未完成");if(await(null==(e=Te.value)?void 0:e.validate()),ke.DUAL_FINISH!==be.value)return void T("请先完成双录")}else{if(s.agentAuthFlag===q.NO)return void T("销售人员签名未完成");if(a.isCert===q.NO)return void T("投保人签名未完成");if(l[0].isCert===q.NO)return void T("被保险人签名未完成")}Me.value=!0;const i=Object.assign(Be.value,{extInfo:{...Be.value.extInfo,pageCode:J.SIGN,buttonCode:K.SIGN}});re(i,((e,a)=>{a===W.JUMP_PAGE&&Z(e.nextPageCode,u.query)}),u).finally((()=>{Me.value=!1}))};_((()=>{da()}));const va=a();return L((()=>{setTimeout((async()=>{va.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,a)=>{const l=X,s=ee,u=ne,c=ae,b=le,S=se;return i(),j(F,null,[r("div",Ie,[d(l),d(u,{modelValue:t(Ae),"onUpdate:modelValue":a[9]||(a[9]=e=>D(Ae)?Ae.value=e:null),onRefresh:da},{default:n((()=>[t(Ee)?(i(),j("div",qe,[t(aa)("agent")?(i(),o(s,{key:0,title:"销售人员签名",required:t(We)("agent")},{value:n((()=>[r("div",we,[d(s,{"is-link":"",value:t(Ce)[t(Je).agent.verifyStatus],onClick:a[0]||(a[0]=e=>ia("agent",t(Je).agent.verifyStatus))},null,8,["value"])])])),_:1},8,["required"])):U("",!0),t(ye)?(i(),o(t(g),{key:2,ref_key:"formRef",ref:Te,model:t(Re)},{default:n((()=>[d(t(h),{modelValue:t(Re).holderMobile,"onUpdate:modelValue":a[5]||(a[5]=e=>t(Re).holderMobile=e),label:"投保人手机号",name:"holderMobile",maxlength:"11",required:"","is-view":""},null,8,["modelValue"]),d(t(p),{modelValue:t(Re).holderVerifyCode,"onUpdate:modelValue":a[6]||(a[6]=e=>t(Re).holderVerifyCode=e),"related-name":"holderMobile",label:"验证码",maxlength:"6",name:"holderVerifyCode","send-s-m-s-code":t(m),"check-s-m-s-code":t(f),required:""},null,8,["modelValue","send-s-m-s-code","check-s-m-s-code"]),t(ea)?(i(),j(F,{key:0},[d(t(h),{modelValue:t(Re).insuredMobile,"onUpdate:modelValue":a[7]||(a[7]=e=>t(Re).insuredMobile=e),label:"被保险人手机号",name:"insuredMobile",maxlength:"11",required:"","is-view":""},null,8,["modelValue"]),d(t(p),{modelValue:t(Re).insuredVerifyCode,"onUpdate:modelValue":a[8]||(a[8]=e=>t(Re).insuredVerifyCode=e),label:"验证码",maxlength:"6",name:"insuredVerifyCode","related-name":"insuredMobile","send-s-m-s-code":t(m),"check-s-m-s-code":t(f),rules:[{required:!0,message:"请输入验证码"}]},null,8,["modelValue","send-s-m-s-code","check-s-m-s-code"])],64)):U("",!0)])),_:1},8,["model"])):(i(),j(F,{key:1},[t(aa)("holder")?(i(),o(s,{key:0,title:"投保人签名",required:t(We)("holder")},{value:n((()=>[r("div",_e,[t(la)("holder")?(i(),o(s,{key:0,"value-class":""+(t(Ze)?"disable":""),"is-link":"",value:"分享签名",onClick:a[1]||(a[1]=e=>!t(Ze)&&sa("holder"))},null,8,["value-class"])):U("",!0),d(s,{"is-link":"",value:t(Ce)[t(Je).holder.verifyStatus],"value-class":""+(t(Ze)||t(Je).holder.shareFlag?"disable":""),onClick:a[2]||(a[2]=e=>ia("holder",t(Je).holder.verifyStatus,t(Je).holder.shareFlag))},null,8,["value","value-class"])])])),_:1},8,["required"])):U("",!0),t(aa)("insured")&&t(ea)?(i(),o(s,{key:1,title:"被保险人签名",required:t(We)("insured")},{value:n((()=>[r("div",Le,[t(la)("insured")?(i(),o(s,{key:0,"value-class":""+(t(Ze)?"disable":""),"is-link":"",value:"分享签名",onClick:a[3]||(a[3]=e=>!t(Ze)&&sa("insured"))},null,8,["value-class"])):U("",!0),d(s,{"is-link":"","value-class":""+(t(Ze)||t(Je).insured.shareFlag?"disable":""),value:t(Ce)[t(Je).insured.verifyStatus],onClick:a[4]||(a[4]=e=>ia("insured",t(Je).insured.verifyStatus,t(Je).insured.shareFlag))},null,8,["value-class","value"])])])),_:1},8,["required"])):U("",!0)],64)),t(ye)?(i(),o(s,{key:3,title:"保单双录",required:""},{value:n((()=>[r("div",je,[d(s,{"is-link":"","value-class":{disable:t(Ze),errorColor:t(Xe)},value:t(Ve)[t(be)],onClick:oa},null,8,["value-class","value"])])])),_:1})):U("",!0)])):U("",!0)])),_:1},8,["modelValue"]),r("div",Ue,[t(Qe)?(i(),o(c,{key:0,type:"primary",plain:"",onClick:a[10]||(a[10]=()=>t(y)(!0))},{default:n((()=>[x("返回修改")])),_:1})):U("",!0),d(c,{type:"primary",disabled:t(Me),onClick:ca},{default:n((()=>[x("下一步")])),_:1},8,["disabled"])]),t(He)?(i(),o(Se,{key:0,type:t(Ke),show:t(He),data:t(Be),onCancel:ua,onConfirm:ta},null,8,["type","show","data"])):U("",!0),t(v)?(i(),o(t(he),{key:1,show:t(v),"onUpdate:show":a[12]||(a[12]=e=>D(v)?v.value=e:null),"show-cancel-button":"","confirm-button-text":"确定","confirm-button-disabled":!t(Ge),"cancel-button-text":"放弃投保","close-on-click-overlay":"",title:"请选择需要修改的页面",onConfirm:ra,onCancel:na},{default:n((()=>[r("div",Fe,[d(S,{modelValue:t(Ge),"onUpdate:modelValue":a[11]||(a[11]=e=>D(Ge)?Ge.value=e:null)},{default:n((()=>[d(b,{name:t(N).premiumTrial},{default:n((()=>[x("保费试算页")])),_:1},8,["name"]),d(b,{name:t(N).questionNotice},{default:n((()=>[x("健康告知页")])),_:1},8,["name"]),d(b,{name:t(N).infoCollection},{default:n((()=>[x("信息采集页")])),_:1},8,["name"])])),_:1},8,["modelValue"])])])),_:1},8,["show","confirm-button-disabled"])):U("",!0)]),d(fe,{modelValue:t(pe),"onUpdate:modelValue":a[13]||(a[13]=e=>D(pe)?pe.value=e:null),onClose:a[14]||(a[14]=e=>t(ge)(!1))},{default:n((()=>[r("div",De,[r("img",{class:"ios-qr-code",src:t(Oe),alt:"QR Code"},null,8,xe),r("img",{class:"android-qr-code",src:t(Pe),alt:"QR Code"},null,8,Ne),r("img",{src:t("/static/png/verify-bg-24ea22cd.png"),alt:"",class:"header-img"},null,8,$e)])])),_:1},8,["modelValue"])],64)}}});export{Ee as default};
