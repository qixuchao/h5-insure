var Le=Object.defineProperty,Ce=Object.defineProperties;var Ae=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var Be=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var ue=(p,d,i)=>d in p?Le(p,d,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[d]=i,G=(p,d)=>{for(var i in d||(d={}))Be.call(d,i)&&ue(p,i,d[i]);if(se)for(var i of se(d))ge.call(d,i)&&ue(p,i,d[i]);return p},ne=(p,d)=>Ce(p,Ae(d));import{g as ce,E,_ as K,r as m,j as _,k as b,m as l,z as u,p as c,n as W,G as fe,J as F,F as pe,C as N,ak as De,O as he,Q as Te,M as Re,y as be,o as Fe,A as f,t as Q,d as de,T as Pe}from"./vendor-e057bbeb.js";import{_ as xe,z as Ne,w as ke,r as Se,Q as U,R,n as He,P as Ve}from"./index-a38d2223.js";import{p as Ue}from"./trial-1a0b2a61.js";import{f as ie,g as le,h as je}from"./trial-453f4439.js";import{u as $e}from"./useDicData-90a18e30.js";import{_ as re,R as Ye,B as Me,a as we}from"./index-3416d237.js";const qe={class:"com-select-container"},Ge={class:"radio-item-wrapper"},ze={class:"name"},Je={class:"hone"},Qe={class:"address"},We={class:"footer-button"},Ke=N("\u53D6\u6D88"),Xe=N("\u786E\u8BA4"),Ze=ce({props:{dataSource:{type:Array,default:()=>[]},show:{type:Boolean,default:!1},modelValue:{type:[String,Number],default:null}},emits:["update","update:modelValue","submit","close"],setup(p,{emit:d}){const i=p,B=E(i.modelValue),j=E(i.show),X=()=>{d("submit",B.value),j.value=!1},Z=()=>{d("close")};return K(()=>i.modelValue,k=>{console.log("newVal",k),B.value=k}),K(()=>B.value,k=>{d("update:modelValue",k)}),(k,P)=>{const $=m("van-radio"),z=m("van-radio-group"),J=m("VanButton");return _(),b(Ne,{show:j.value,"onUpdate:show":P[1]||(P[1]=I=>j.value=I),class:"com-select",title:"\u9009\u62E9\u4FDD\u5355\u901A\u8BAF\u4FE1\u606F",onClose:Z},{default:l(()=>[u("div",qe,[c(z,{modelValue:B.value,"onUpdate:modelValue":P[0]||(P[0]=I=>B.value=I)},{default:l(()=>[(_(!0),W(pe,null,fe(p.dataSource,(I,t)=>(_(),b($,{key:t,name:t+1,class:"radio-item"},{default:l(()=>[u("div",Ge,[u("p",null,[u("span",ze,F(I.contactName),1),u("span",Je,F(I.contactPhoneNo),1)]),u("p",Qe,F(I.contactAddress),1)])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),u("div",We,[c(J,{plain:"",type:"primary"},{default:l(()=>[Ke]),_:1}),c(J,{type:"primary",onClick:X},{default:l(()=>[Xe]),_:1})])]),_:1},8,["show"])}}});var et=xe(Ze,[["__scopeId","data-v-9c6de82e"]]);const tt={key:0,class:"beneficiary-part"},nt={class:"part-title"},rt={class:"title"},ot=N("\u5220\u9664"),at=N("+\u6DFB\u52A0\u53D7\u76CA\u4EBA"),st=N("\u9009\u62E9\u4FDD\u5355\u901A\u8BAF\u4FE1\u606F"),ut={class:"radio-item-wrapper"},dt={class:"name"},it={class:"hone"},lt={class:"address"},ct={class:"footer-button"},ft={class:"left"},pt={class:"trial-result"},mt=N(" \u9996\u671F"),It={class:"result-num"},_t=u("div",{class:"result-desc"},"\u5B9E\u9645\u4FDD\u8D39\u4EE5\u540E\u7EED\u4E3A\u51C6",-1),vt={class:"operate-btn"},Ot=N("\u4E0B\u4E00\u6B65"),Dt=ce({setup(p){const d=De(),i=he(),{templateId:B=1,orderNo:j="2022072710380711215",productCode:X,tenantId:Z="9991000007",proposalId:k}=i.query,[P,$]=Te(),z=i.path==="/infoPreview"?"infoPreview":"infoCollection",J=$e("NATIONAL_REGION_CODE"),I=E({}),t=E({extInfo:{pageCode:z},tenantOrderHolder:{extInfo:{occupationCodeList:[]},holderType:1},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},insuredBeneficiaryType:"1",tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}]}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0}}),ee=E(null),g=E([]),S=E([]),Y=E([]),te=E([]),oe=E([]),v=Re({beneficiaryId:0,addressList:[],nextPage:"",currentAddress:null,isLoading:!0}),M=be(()=>{var n,e;return v.currentAddress?v.addressList[v.currentAddress-1]||{}:((e=(n=t.value.extInfo)==null?void 0:n.contactInfo)==null?void 0:e[0])||{}}),me=n=>{const e={};return n.map(a=>{const{initialAmount:r,annuityDrawFrequency:s,annuityDrawType:D,paymentFrequency:h,paymentPeriod:y,paymentPeriodType:L,insurancePeriodType:C,insurancePeriodValue:A,riskCode:T,riskType:O,initialPremium:H,liabilityDetails:w,extInfo:V}=a,{riskId:q,copy:o}=V,x={amount:r,annuityDrawDate:s,annuityDrawType:D,paymentFrequency:h,riskId:q,copy:o,chargePeriod:y?`${ie[L]}_${y}`:ie[L],coveragePeriod:A?`${le[C]}_${A}`:le[C],riskCode:T,riskType:O,premium:H,liabilityVOList:w};return O===je.mainRisk?(e.mainRiskCode=T,e.mainRiskId=q):Object.assign(x,e),x})},Ie=()=>{var e;const n=G({},t.value);n.extInfo=ne(G({},n.extInfo),{contactInfo:[M.value]}),n.tenantOrderAttachmentList=[{category:U.OBVERSE_CERT,objectType:R.HOLDER,objectId:t.value.tenantOrderHolder.id,name:"\u6295\u4FDD\u4EBA\u8BC1\u4EF6\u6B63\u9762",uri:g.value[0],id:Y.value[0]},{category:U.REVERSE_CERT,objectType:R.HOLDER,objectId:t.value.tenantOrderHolder.id,name:"\u6295\u4FDD\u4EBA\u8BC1\u4EF6\u80CC\u9762",uri:g.value[1],id:Y.value[1]},{category:U.OBVERSE_CERT,objectType:R.INSURED,objectId:t.value.tenantOrderInsuredList[0].id,name:"\u88AB\u4FDD\u4EBA\u8BC1\u4EF6\u6B63\u9762",uri:S.value[0]||g.value[0],id:te.value[1]},{category:U.REVERSE_CERT,objectType:R.INSURED,objectId:t.value.tenantOrderInsuredList[0].id,name:"\u88AB\u4FDD\u4EBA\u8BC1\u4EF6\u80CC\u9762",uri:S.value[1]||g.value[1],id:te.value[1]}],(e=ee.value)==null||e.validate().then(a=>{if(n.tenantOrderInsuredList[0].insuredBeneficiaryType===we.SPECIFY){const r={};if(n.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.forEach(s=>{r[s.benefitOrder]?r[s.benefitOrder].sum+=Number(s.benefitRate):r[s.benefitOrder]={sum:Number(s.benefitRate)}}),Object.values(r).some(s=>s.sum!==100)){Pe.fail("\u540C\u4E00\u987A\u4F4D\u7684\u53D7\u76CA\u4EBA\u6BD4\u4F8B\u4E4B\u548C\u5FC5\u987B\u4E3A100");return}}He(n).then(({code:r,data:s})=>{r==="10000"&&s.pageAction.pageAction==="jumpToPage"&&d.push({path:Ve[s.pageAction.data.nextPageCode],query:i.query})})})},_e=()=>{var n;(n=ee.value)==null||n.validate().then(()=>{const{birthday:e,gender:a,extInfo:r}=t.value.tenantOrderHolder,{hasSocialInsurance:s,occupationCodeList:D}=r,{birthday:h,gender:y,extInfo:L,tenantOrderProductList:C}=t.value.tenantOrderInsuredList[0],{hasSocialInsurance:A,occupationCodeList:T}=L,O={holder:{personVO:{birthday:de(e).format("YYYY-MM-DD"),gender:a,socialFlag:s,occupationCodeList:D}},productCode:X,insuredVOList:[{insuredCode:"",personVO:{birthday:de(h).format("YYYY-MM-DD"),gender:y,socialFlag:A,occupationCodeList:T},productPlanVOList:[{insurerCode:"",planCode:"",riskVOList:me(C[0].tenantOrderRiskList)}]}]};Ue(G({},O)).then(({code:H,data:w})=>{H==="10000"&&Ie()})})},ve=n=>{console.log("value",n)},Oe=()=>{v.beneficiaryId+=1,t.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.push({id:v.beneficiaryId,extInfo:{}})},ye=n=>{t.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList=t.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.filter(e=>e.beneficiaryId!==n.beneficiaryId||n.id!==e.id)},Ee=()=>{Se({orderNo:j,tenantId:Z}).then(({code:n,data:e})=>{if(n==="10000"){const a=e;a.extInfo=ne(G({},a.extInfo),{pageCode:z,templateId:B}),a.tenantOrderHolder=a.tenantOrderHolder||{holderType:1},a.tenantOrderHolder.extInfo=a.tenantOrderHolder.extInfo||{occupationCodeList:[]},a.tenantOrderInsuredList[0].extInfo=a.tenantOrderInsuredList[0].extInfo||{occupationCodeList:[]},a.tenantOrderInsuredList[0].tenantOrderBeneficiaryList=a.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.map(r=>{const s=r;return s.extInfo=s.extInfo||{occupationCodeList:[]},s}),a.tenantOrderAttachmentList.forEach(r=>{r.category===U.OBVERSE_CERT?r.objectType===R.HOLDER?(g.value[0]=r.uri,Y.value[0]=r.id):r.objectType===R.INSURED&&(S.value[0]=r.uri,te.value[0]=r.id):r.category===U.REVERSE_CERT&&(r.objectType===R.HOLDER?(g.value[1]=r.uri,Y.value[1]=r.id):r.objectType===R.INSURED&&(S.value[1]=r.uri,Y.value[1]=r.id))}),Object.assign(t.value,a)}}).finally(()=>{v.isLoading=!1})};return Fe(()=>{Ee(),ke({pageCode:"infoCollection",templateId:B}).then(({code:n,data:e})=>{if(n==="10000"){const a={BENEFICIARY:[],INSURER:[],HOLDER:[]};e.productInsureFactorList.forEach(r=>{(a[r.moduleType]=a[r.moduleType]||[]).push(r)}),I.value=a}})}),K(()=>t.value,n=>{var e,a,r,s,D,h,y,L,C,A;if(n){const T=[{contactAddress:(a=(e=n.tenantOrderHolder)==null?void 0:e.extInfo)==null?void 0:a.familyAddress,contactName:n.tenantOrderHolder.name,contactPhoneNo:n.tenantOrderHolder.mobile},{contactAddress:(s=(r=n.tenantOrderHolder)==null?void 0:r.extInfo)==null?void 0:s.workAddress,contactName:n.tenantOrderHolder.name,contactPhoneNo:n.tenantOrderHolder.mobile},{contactAddress:(h=(D=n.tenantOrderInsuredList[0])==null?void 0:D.extInfo)==null?void 0:h.familyAddress,contactName:(y=n.tenantOrderInsuredList[0])==null?void 0:y.name,contactPhoneNo:(L=n.tenantOrderInsuredList[0])==null?void 0:L.mobile},{contactAddress:(A=(C=n.tenantOrderInsuredList[0])==null?void 0:C.extInfo)==null?void 0:A.workAddress,contactName:n.tenantOrderInsuredList[0].name,contactPhoneNo:n.tenantOrderInsuredList[0].mobile}];v.addressList=T.filter(O=>O.contactAddress&&O.contactName&&O.contactPhoneNo)}},{deep:!0,immediate:!0}),K(()=>t.value.tenantOrderInsuredList[0].relationToHolder,n=>{+n==1&&Object.assign(t.value.tenantOrderInsuredList[0],t.value.tenantOrderHolder,{id:t.value.tenantOrderInsuredList[0].id})},{deep:!0,immediate:!0}),(n,e)=>{const a=m("ProCard"),r=m("ProRadioButton"),s=m("ProField"),D=m("ProCascader"),h=m("ProSvg"),y=m("VanButton"),L=m("ProCheckButton"),C=m("van-cell"),A=m("ProForm"),T=m("ProPageWrap");return _(),b(T,{class:"page-info-wrapper"},{default:l(()=>{var O,H,w,V,q;return[f(v).isLoading?Q("",!0):(_(),b(A,{key:0,ref_key:"formRef",ref:ee},{default:l(()=>[c(a,{title:"\u6295\u4FDD\u4EBA"},{default:l(()=>[c(re,{images:g.value,"onUpdate:images":e[0]||(e[0]=o=>g.value=o),"form-info":t.value.tenantOrderHolder,"factor-list":I.value.HOLDER,prefix:"holder"},null,8,["images","form-info","factor-list"])]),_:1}),c(a,{title:"\u88AB\u4FDD\u4EBA"},{default:l(()=>[c(s,{modelValue:t.value.tenantOrderInsuredList[0].relationToHolder,"onUpdate:modelValue":e[2]||(e[2]=o=>t.value.tenantOrderInsuredList[0].relationToHolder=o),label:"\u4E3A\u8C01\u4FDD\u5355",name:"relationToHolder",placeholder:"\u8BF7\u9009\u62E9"},{input:l(()=>[c(r,{modelValue:t.value.tenantOrderInsuredList[0].relationToHolder,"onUpdate:modelValue":e[1]||(e[1]=o=>t.value.tenantOrderInsuredList[0].relationToHolder=o),options:f(Ye)},null,8,["modelValue","options"])]),_:1},8,["modelValue"]),+t.value.tenantOrderInsuredList[0].relationToHolder!=1?(_(),b(re,{key:0,images:S.value,"onUpdate:images":e[3]||(e[3]=o=>S.value=o),"form-info":t.value.tenantOrderInsuredList[0],"factor-list":I.value.INSURER||[],prefix:"insure"},null,8,["images","form-info","factor-list"])):Q("",!0),c(D,{modelValue:t.value.tenantOrderInsuredList[0].extInfo.insureAreaCode,"onUpdate:modelValue":e[4]||(e[4]=o=>t.value.tenantOrderInsuredList[0].extInfo.insureAreaCode=o),field1:t.value.tenantOrderInsuredList[0].extInfo.insureProvinceCode,"onUpdate:field1":e[5]||(e[5]=o=>t.value.tenantOrderInsuredList[0].extInfo.insureProvinceCode=o),field2:t.value.tenantOrderInsuredList[0].extInfo.insureCityCode,"onUpdate:field2":e[6]||(e[6]=o=>t.value.tenantOrderInsuredList[0].extInfo.insureCityCode=o),field3:t.value.tenantOrderInsuredList[0].extInfo.insureAreaCode,"onUpdate:field3":e[7]||(e[7]=o=>t.value.tenantOrderInsuredList[0].extInfo.insureAreaCode=o),label:"\u6295\u4FDD\u5730\u533A",name:"insureAreaCode",placeholder:"\u8BF7\u9009\u62E9","is-link":"",required:"","data-source":f(J),mapping:{label:"name",value:"code",children:"children"}},null,8,["modelValue","field1","field2","field3","data-source"])]),_:1}),c(a,{title:"\u53D7\u76CA\u4EBA"},{default:l(()=>[c(s,{modelValue:t.value.tenantOrderInsuredList[0].insuredBeneficiaryType,"onUpdate:modelValue":e[9]||(e[9]=o=>t.value.tenantOrderInsuredList[0].insuredBeneficiaryType=o),label:"\u53D7\u76CA\u4EBA\u7C7B\u578B",name:"insuredBeneficiaryType",placeholder:"\u8BF7\u9009\u62E9"},{input:l(()=>[c(r,{modelValue:t.value.tenantOrderInsuredList[0].insuredBeneficiaryType,"onUpdate:modelValue":e[8]||(e[8]=o=>t.value.tenantOrderInsuredList[0].insuredBeneficiaryType=o),options:f(Me)},null,8,["modelValue","options"])]),_:1},8,["modelValue"]),t.value.tenantOrderInsuredList[0].insuredBeneficiaryType==2?(_(),W("div",tt,[(_(!0),W(pe,null,fe(t.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList,(o,x)=>(_(),W("div",{key:o.beneficiaryId||o.id,class:"beneficiary-item"},[u("div",nt,[u("span",rt,F(`\u53D7\u76CA\u4EBA${x+1}`),1),c(h,{name:"delete",onClick:ae=>ye(o)},{default:l(()=>[ot]),_:2},1032,["onClick"])]),c(re,{images:oe.value,"onUpdate:images":e[10]||(e[10]=ae=>oe.value=ae),"form-info":o,"factor-list":I.value.BENEFICIARY||[],prefix:`beneficiary-${x}`,"beneficiary-list":t.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList},null,8,["images","form-info","factor-list","prefix","beneficiary-list"])]))),128)),c(y,{onClick:Oe},{default:l(()=>[at]),_:1})])):Q("",!0)]),_:1}),c(a,{title:"\u4FDD\u5355\u901A\u8BAF\u4FE1\u606F"},{default:l(()=>{var o;return[((o=Object.keys(f(M)))==null?void 0:o.length)?(_(),b(C,{key:1,title:"\u5355\u5143\u683C","is-link":"",onClick:e[12]||(e[12]=x=>f($)(!0))},{title:l(()=>[u("div",ut,[u("p",null,[u("span",dt,F(f(M).contactName),1),u("span",it,F(f(M).contactPhoneNo),1)]),u("p",lt,F(f(M).contactAddress),1)])]),_:1})):(_(),b(L,{key:0,activated:"",onClick:e[11]||(e[11]=x=>f($)(!0))},{default:l(()=>[st]),_:1}))]}),_:1})]),_:1},512)),u("div",ct,[u("div",ft,[u("div",pt,[mt,u("span",It,"\uFFE5"+F((q=(V=(w=(H=(O=t.value.tenantOrderInsuredList)==null?void 0:O[0])==null?void 0:H.tenantOrderProductList)==null?void 0:w[0].premium)==null?void 0:V.toLocaleString)==null?void 0:q.call(V)),1)]),_t]),u("div",vt,[c(y,{block:"",type:"primary",onClick:_e},{default:l(()=>[Ot]),_:1})])]),f(P)?(_(),b(et,{key:1,modelValue:f(v).currentAddress,"onUpdate:modelValue":e[13]||(e[13]=o=>f(v).currentAddress=o),show:f(P),"data-source":f(v).addressList,onSubmit:ve,onClose:e[14]||(e[14]=o=>f($)(!1))},null,8,["modelValue","show","data-source"])):Q("",!0)]}),_:1})}}});export{Dt as default};
