import{aw as s,aU as e,aV as a,aW as t,aX as o,aY as r,aZ as l,d as i,f as d,a_ as n,a$ as u,b0 as c,b1 as p,b2 as m,aB as k,b3 as v,aC as I,_ as f,S as L,r as h,E as b,an as y,c as P,h as R,F as g,i as V,j as _,n as C,t as O,g as j,b4 as D,e as w,w as T,k as x,b5 as S,aG as U,X as N,Y as E,u as $,a as q,aE as A,b as B,aM as F,a7 as Y,aj as H,y as K,P as M,aP as W,m as X,b6 as G,B as Z}from"./index-c6f4364a.js";import{u as z,P as J}from"./index-8a7f79b2.js";import{q as Q,a as ss,b as es}from"./createProposal-4de272a3.js";import{R as as}from"./index-18af124b.js";import{u as ts}from"./useDicData-49291a13.js";import"./pdfh5-008ca364.js";import"./trial-03636d29.js";import"./trial-81a73a58.js";const[os,rs]=s("action-sheet"),ls=e({},a,{title:String,round:t,actions:o(),closeIcon:r("cross"),closeable:t,cancelText:String,description:String,closeOnPopstate:t,closeOnClickAction:Boolean,safeAreaInsetBottom:t}),is=[...l,"round","closeOnPopstate","safeAreaInsetBottom"];const ds=I(i({name:os,props:ls,emits:["select","cancel","update:show"],setup(s,{slots:e,emit:a}){const t=s=>a("update:show",s),o=()=>{t(!1),a("cancel")},r=()=>{if(s.title)return d("div",{class:rs("header")},[s.title,s.closeable&&d(p,{name:s.closeIcon,class:[rs("close"),m],onClick:o},null)])},l=()=>{if(e.cancel||s.cancelText)return[d("div",{class:rs("gap")},null),d("button",{type:"button",class:rs("cancel"),onClick:o},[e.cancel?e.cancel():s.cancelText])]},i=(s,a)=>s.loading?d(k,{class:rs("loading-icon")},null):e.action?e.action({action:s,index:a}):[d("span",{class:rs("name")},[s.name]),s.subname&&d("div",{class:rs("subname")},[s.subname])],I=(e,o)=>{const{color:r,loading:l,callback:n,disabled:u,className:c}=e;return d("button",{type:"button",style:{color:r},class:[rs("item",{loading:l,disabled:u}),c],onClick:()=>{u||l||(n&&n(e),s.closeOnClickAction&&t(!1),v((()=>a("select",e,o))))}},[i(e,o)])},f=()=>{if(s.description||e.description){const a=e.description?e.description():s.description;return d("div",{class:rs("description")},[a])}};return()=>d(c,n({class:rs(),position:"bottom","onUpdate:show":t},u(s,is)),{default:()=>{var a;return[r(),f(),d("div",{class:rs("content")},[s.actions.map(I),null==(a=e.default)?void 0:a.call(e)]),l()]}})}}));const ns=s=>(N("data-v-cd47605e"),s=s(),E(),s),us={class:"com-product-list-wrapper"},cs={class:"risk-item-wrapper"},ps={class:"content"},ms={class:"risk-premium"},ks={class:"premium"},vs={class:"risk-factor"},Is={class:"factor"},fs={class:"factor-value"},Ls=ns((()=>_("span",{class:"factor-name"}," 保额(元) ",-1))),hs={class:"factor"},bs={class:"factor-value"},ys=ns((()=>_("span",{class:"factor-name"}," 保障期间 ",-1))),Ps={class:"factor"},Rs={class:"factor-value"},gs=ns((()=>_("span",{class:"factor-name"}," 缴费期间 ",-1))),Vs={class:"operate-bar"},_s=ns((()=>_("span",{class:"btn-plus"},"+",-1))),Cs={key:0,class:"premium-total"},Os={class:"premium"};var js=f(i({__name:"index",props:{productRiskList:{default:()=>[]},productInfo:{default:()=>({})},productData:{default:()=>({})},pickProductPremium:{type:Function,default:()=>{}},productNum:{default:0}},emits:["deleteRisk","updateRisk","addRiderRisk"],setup(s,{emit:e}){const a=s,[t,o]=L(),r=h({checkedList:[],disabledList:[],riderRiskList:[],mainRiskData:{},totalPremium:0,currentRiskRecord:{},productRiskList:[]}),l=ts("RISK_PAYMENT_PERIOD"),i=ts("RISK_INSURANCE_PERIOD"),n=b((()=>{var s,e;return(null==(e=null==(s=a.productData)?void 0:s.productRiskVoList)?void 0:e[0].riskDetailVOList.filter((s=>1===s.collocationType)))||[]})),u=b((()=>{var s,e;const t=a.productRiskList.map((s=>s.riskId)),o=((null==(e=null==(s=a.productData)?void 0:s.productRiskVoList)?void 0:e[0].riskDetailVOList)||[]).filter((s=>t.includes(s.id)&&1===s.collocationType));return n.value.length-o.length})),c=b((()=>s=>{var e,t;const o=(null==(t=null==(e=a.productData)?void 0:e.productRiskVoList)?void 0:t[0].riskDetailVOList.find((e=>e.id!==s)))||{};let r=!1;return r=!!a.productNum||2===o.riskType&&1===o.collocationType,r})),p=b((()=>{var s,e;return(null==(e=null==(s=a.productData)?void 0:s.productRiskVoList)?void 0:e[0].riskDetailVOList.find((s=>1===s.riskType)))||{}})),m=b((()=>p.value.collocationVOList||[])),k=(s,t)=>{const o=s.map((s=>s.id)).filter((s=>!r.value.disabledList.includes(s)));e("addRiderRisk",o,a.productInfo)};return y((()=>a.productInfo),(s=>{var e;let t=0;(s.proposalProductRiskList||[]).forEach((s=>{t+=s.premium})),null==(e=a.pickProductPremium)||e.call(a,{[`${s.productId}`]:t}),r.value.totalPremium=t}),{deep:!0,immediate:!0}),y((()=>a.productRiskList),(s=>{const e=[],a=[],t=[];(s||[]).forEach((s=>{1===s.riskType?e.unshift(s):(a.push(s.riskId),t.push(s.riskId),e.push(s))})),r.value.disabledList=a,r.value.checkedList=t,r.value.productRiskList=e}),{deep:!0,immediate:!0}),(s,p)=>{const v=S,I=U;return P(),R("div",us,[(P(!0),R(g,null,V(j(r).productRiskList,(s=>{var t,n;return P(),R("div",{key:s.riskId},[_("div",cs,[d(v,{"risk-type":s.riskType,title:s.riskName,class:"no-border"},null,8,["risk-type","title"]),_("div",ps,[_("div",ms,[C(" 保费:"),_("span",ks,"￥"+O(null==(t=s.premium)?void 0:t.toLocaleString()),1)]),_("div",vs,[_("div",Is,[_("span",fs,O(null==(n=s.amount)?void 0:n.toLocaleString()),1),Ls]),_("div",hs,[_("span",bs,O(j(D)(j(i),s.coveragePeriod)),1),ys]),_("div",Ps,[_("span",Rs,O(j(D)(j(l),s.chargePeriod)),1),gs])]),_("div",Vs,[j(c)(s.riskId)?(P(),w(I,{key:0,round:32,class:"border",onClick:t=>{e("deleteRisk",s,a.productInfo)}},{default:T((()=>[C("删除")])),_:2},1032,["onClick"])):x("",!0),j(u)?(P(),w(I,{key:1,activated:"",round:32,class:"btn-rider-risk",onClick:e=>{return a=s,o(!0),void(r.value.currentRiskRecord=a);var a}},{default:T((()=>[_s,C(" 附加险")])),_:2},1032,["onClick"])):x("",!0),d(I,{activated:"",round:32,onClick:t=>{e("updateRisk",s,a.productInfo)}},{default:T((()=>[C("修改")])),_:2},1032,["onClick"])])])])])})),128)),j(r).productRiskList.length>1?(P(),R("div",Cs,[C(" 保费: "),_("span",Os,"￥"+O(j(r).totalPremium.toLocaleString()),1)])):x("",!0),j(t)?(P(),w(as,{key:1,modelValue:j(r).checkedList,"onUpdate:modelValue":p[0]||(p[0]=s=>j(r).checkedList=s),show:j(t),disabled:j(r).disabledList,"risk-list":j(n),"collocation-list":j(m),onFinished:k,onClose:p[1]||(p[1]=s=>j(o)(!1))},null,8,["modelValue","show","disabled","risk-list","collocation-list"])):x("",!0)])}}}),[["__scopeId","data-v-cd47605e"]]);const Ds={class:"container"},ws=(s=>(N("data-v-4f24fb6d"),s=s(),E(),s))((()=>_("span",{class:"plan-name"},"计划书名称",-1))),Ts={class:"operate-bar"},xs={class:"footer-bar"},Ss={class:"trial-result"},Us={class:"result-num"},Ns={class:"trial-operate"};var Es=f(i({__name:"index",setup(s){const e=[{name:"保存修改"},{name:"另存为新计划书"}],[a,t]=L(),[o,r]=L(),l=h({proposalHolder:{},proposalInsuredList:[{name:"",gender:"",birthday:"",proposalInsuredProductList:[]}],proposalName:"",totalPremium:0,relationUserType:2}),i=$(),n=q(),u=z(),{id:c,type:p="add",isCreateProposal:m}=n.query,k=h({productId:0,productCollection:{},productInfo:{},productPremium:{},riderRisk:{},type:"add",currentRisk:[]}),v=h();h({}),h([]),b((()=>({min:"",max:""})));const I=()=>{v.value.validate().then((()=>{es(l.value).then((({code:s,data:e})=>{"10000"===s&&(u.$reset(),u.proposalId=e,i.push({path:"/compositionProposal",query:{id:e}}))}))}))},f=()=>{!c&&u.proposalId?r(!0):I()},D=(s,e)=>{e&&(l.value.id=null),I()},S=(s,e,a)=>e?/^.{1,20}$/.test(e)?"":`${s}不能超过20个字符`:"",N=(s={})=>{Object.assign(k.value.productPremium,s),l.value.totalPremium=Object.values(k.value.productPremium).reduce(((s,e)=>s+e),0)},E=(s,e)=>{const a=e;H.confirm({message:"确认删除该险种？"}).then((()=>{1===s.riskType?(l.value.proposalInsuredList[0].proposalInsuredProductList=l.value.proposalInsuredList[0].proposalInsuredProductList.filter((s=>s.productId!==a.productId)),N({[a.productId]:0})):a.proposalProductRiskList=a.proposalProductRiskList.filter((e=>e.riskId!==s.riskId))}))},as=(s,e)=>{k.value.productId=e.productId,k.value.productInfo=e,k.value.type="edit",k.value.currentRisk=[s.riskId],t(!0)},ts=(s,e)=>{k.value.productId=e.productId,k.value.productInfo=e,k.value.type="addRiderRisk",k.value.currentRisk=s,t(!0)},os=s=>{l.value.proposalInsuredList[0].proposalInsuredProductList=l.value.proposalInsuredList[0].proposalInsuredProductList.map((e=>{let a=e;return e.productId===s.proposalInsuredList[0].proposalInsuredProductList[0].productId&&(a={...s.proposalInsuredList[0].proposalInsuredProductList[0]}),a})),t(!1)},rs=()=>{u.setProposalInfo(l.value),u.setTrialData([]),u.setExcludeProduct(Object.keys(k.value.productCollection)),i.push({path:"/proposalList",query:{isCreateProposal:"1",...n.query}})},ls=()=>{t(!1)};return A((()=>{const s=u.$state.trialData,e=u.$state.proposalInfo,a=u.$state.proposalId;c&&!m||a?(((s={})=>{Q(s).then((({code:s,data:e})=>{"10000"===s&&Object.assign(l.value,e)}))})({id:c||a}),u.$reset()):!Object.keys(e).length&&s.length?Object.assign(l.value,s[0]):Object.keys(e).length&&s.length?(e.proposalInsuredList[0].proposalInsuredProductList.push(...s[0].proposalInsuredList[0].proposalInsuredProductList),l.value=e):Object.keys(e).length&&!s.length&&(l.value=e),u.setTrialData([])})),y((()=>{var s;return null==(s=l.value.proposalInsuredList[0].proposalInsuredProductList)?void 0:s.length}),(()=>{const s=l.value.proposalInsuredList[0].proposalInsuredProductList.map((s=>({productId:s.productId,source:2})));ss({voList:s}).then((({code:s,data:e})=>{"10000"===s&&(k.value.productCollection=e)})).finally((()=>{}))})),(s,t)=>{const i=K,n=M,u=W,c=X,p=G,m=U,I=Z,L=ds,h=B("ProPageWrap");return P(),w(h,{class:"page-create-wrapper"},{default:T((()=>{var s;return[_("div",Ds,[d(p,{ref_key:"formRef",ref:v,"input-align":"right","error-message-align":"right"},{default:T((()=>[d(n,{"show-line":!1},{default:T((()=>[d(i,{modelValue:j(l).proposalName,"onUpdate:modelValue":t[0]||(t[0]=s=>j(l).proposalName=s),class:"border-radius",name:"proposalName",placeholder:"请输入计划书名称",rules:[{validator:(...s)=>S("计划书名称",...s)}]},{label:T((()=>[ws])),_:1},8,["modelValue","rules"])])),_:1}),d(n,{title:"被保人信息"},{default:T((()=>[d(i,{modelValue:j(l).proposalInsuredList[0].name,"onUpdate:modelValue":t[1]||(t[1]=s=>j(l).proposalInsuredList[0].name=s),name:"name",label:"姓名",rules:[{validator:(...s)=>S("姓名",...s)}],placeholder:"请输入（选填）"},null,8,["modelValue","rules"]),d(u,{modelValue:j(l).proposalInsuredList[0].birthday,"onUpdate:modelValue":t[2]||(t[2]=s=>j(l).proposalInsuredList[0].birthday=s),name:"birthday",label:"出生日期",type:"date","is-link":"",readonly:"",placeholder:"请选择",rules:[{required:!0,message:"请选择"}]},null,8,["modelValue"]),d(i,{modelValue:j(l).proposalInsuredList[0].gender,"onUpdate:modelValue":t[4]||(t[4]=s=>j(l).proposalInsuredList[0].gender=s),name:"gender",label:"性别",class:"border-radius",rules:[{required:!0,message:"请选择"}]},{input:T((()=>[d(c,{modelValue:j(l).proposalInsuredList[0].gender,"onUpdate:modelValue":t[3]||(t[3]=s=>j(l).proposalInsuredList[0].gender=s),options:j(F)},null,8,["modelValue","options"])])),_:1},8,["modelValue"])])),_:1})])),_:1},512),(P(!0),R(g,null,V(j(l).proposalInsuredList[0].proposalInsuredProductList||[],(s=>(P(),w(n,{key:s.productId,"show-line":!1},{default:T((()=>{var e,a;return[d(js,{"product-risk-list":s.proposalProductRiskList,"product-info":s,"product-num":(null==(a=null==(e=j(l).proposalInsuredList[0])?void 0:e.proposalInsuredProductList)?void 0:a.length)-1,"product-data":j(k).productCollection[s.productId],"pick-product-premium":N,onAddRiderRisk:ts,onUpdateRisk:as,onDeleteRisk:E},null,8,["product-risk-list","product-info","product-num","product-data"])]})),_:2},1024)))),128)),_("div",Ts,[d(m,{activated:"",round:34,onClick:rs},{default:T((()=>[C("添加主险")])),_:1})])]),_("div",xs,[_("span",Ss,[C("总保费"),_("span",Us,"￥"+O(j(l).totalPremium.toLocaleString()),1)]),_("div",Ns,[d(I,{type:"primary",onClick:f},{default:T((()=>[C("保存并预览")])),_:1})])]),j(a)?(P(),w(J,{key:0,"is-show":j(a),type:j(k).type,"rider-risk":(null==(s=j(k).riderRisk)?void 0:s[j(k).productId])||[],"product-data":j(k).productCollection[j(k).productId],"form-info":j(k).productInfo,holder:j(l).proposalHolder,insured:j(l).proposalInsuredList[0],"current-risk":j(k).currentRisk,onClose:ls,onFinished:os},null,8,["is-show","type","rider-risk","product-data","form-info","holder","insured","current-risk"])):x("",!0),d(L,{show:j(o),"onUpdate:show":t[5]||(t[5]=s=>Y(o)?o.value=s:null),actions:e,"cancel-text":"取消","close-on-click-action":"",onCancel:t[6]||(t[6]=s=>j(r)(!1)),onSelect:D},null,8,["show"])]})),_:1})}}}),[["__scopeId","data-v-4f24fb6d"]]);export{Es as default};
