import{d as e,i as o,j as t,k as a,O as s,o as i,m as l,w as r,a as d,e as u,b as c,u as n,p,c as v,F as m,q as k,a8 as R,_ as f,T as C,as as L,at as I,au as y,av as h,aw as j,h as g,ax as _,ay as q,az as b,f as w,s as T}from"./index-4c3d4456.js";import P from"./index-8c66b979.js";import{a as S,b as x,g as N,s as V,i as M,m as A}from"./trial-8544042c.js";import{_ as K}from"./index-d3e130b9.js";import{S as D}from"./index-1323a96b.js";import{R as O}from"./trial-597c5eee.js";import{_ as E}from"./TrialButton-fca70efc.js";import{u as F}from"./useOrder-7c6d7042.js";import{p as U,a as B}from"./utils-c163632c.js";import{q as $}from"./createProposal-159d4f5f.js";import{f as H,a as z}from"./findLastIndex-09a88640.js";import{c as G}from"./cloneDeep-2788d88e.js";import"./InsureInfos-83302749.js";import"./index-de590a0b.js";import"./index-387a03c0.js";import"./infoCollection-fe27ce86.js";import"./index-10336801.js";import"./PolicyInfo-7fb621d0.js";import"./questionnaire-42dcb602.js";import"./util-78299a9f.js";import"./product-7bbf9c44.js";import"./constants-94172543.js";import"./utils-85e67800.js";import"./nextStep-8834256f.js";import"./core-4dd3cf93.js";import"./format-31cde443.js";import"./empty-ae586b6c.js";import"./index-36730899.js";import"./utils-8d88475e.js";const J={class:"popup-container"},Q={class:"popup-header"},W={class:"title"},X=(e=>(h("data-v-0a46ec37"),e=e(),j(),e))((()=>d("p",{class:"tip"},"已为您挑选出以下险种",-1))),Y={class:"search"},Z={key:0,class:"risk-list"},ee=e({name:"riskSelect"});var oe=f(e({...ee,props:{type:{default:2},show:{type:Boolean,default:!1},title:{},insuredList:{default:()=>[]},mainRiskCode:{default:""},selectList:{default:()=>[]},currentProductCode:{default:""}},emits:["cancel","confirm"],setup(e,{emit:f}){const h=e,j=o(),{insurerCode:g}=j.query,_=t([]),q=t([]),b=t([]),w=t(),T=a((()=>h.show)),P=()=>{f("cancel")},N=()=>{var e;if(!(null==(e=_.value)?void 0:e.length))return void C(`暂未添加任何${h.type===O.MAIN_RISK?"主":"附加"}险`);let o=[];o=h.type===O.RIDER_RISK?_.value:q.value.filter((e=>_.value.includes(e.productCode))).map((e=>({productCode:e.productCode,mergeRiskReqList:(e.mainRiskCollocationList||[]).map((e=>({riskCode:e.collocationRiskCode,riskType:e.mainRiskCode?2:1,mainRiskCode:e.mainRiskCode})))}))),f("confirm",o)},V=async()=>{var e;const o={insuredList:h.insuredList,mainRiskCode:h.mainRiskCode,insurerCode:g,productCategory:"",keyword:w.value,selectProductCodes:[],selectRiskCodes:[],filterFlag:(null==(e=h.selectList)?void 0:e.length)?1:2};if(o.selectProductCodes=h.selectList.map((e=>(e.productCode===h.currentProductCode&&o.selectRiskCodes.push(...e.mergeRiskReqList.map((e=>e.riskCode))),e.productCode))),h.type===O.MAIN_RISK){const{code:e,data:t}=await S(o);"10000"===e&&(q.value=t)}else{const{code:e,data:t}=await x(o);"10000"===e&&(q.value=t.riskInfoList,b.value=t.collocationInfoResList)}};return s((()=>{V()})),(e,o)=>{const t=D,a=L,s=I,f=K,C=y;return i(),l(C,{show:n(T),"onUpdate:show":o[2]||(o[2]=e=>p(T)?T.value=e:null),class:"popup-risk-select",closeable:!1},{default:r((()=>{var C;return[d("div",J,[d("div",Q,[d("span",{class:"clear-all",onClick:P}," 取消 "),d("span",W,u(e.title),1),d("span",{class:"close",onClick:N},"确认")]),X,d("div",Y,[c(t,{modelValue:n(w),"onUpdate:modelValue":o[0]||(o[0]=e=>p(w)?w.value=e:null),shape:"round",placeholder:"请输入产品名称进行搜索","clear-trigger":"always","show-action":"",clearable:"",onSearch:V},null,8,["modelValue"])]),(null==(C=n(q))?void 0:C.length)?(i(),v("div",Z,[c(s,{modelValue:n(_),"onUpdate:modelValue":o[1]||(o[1]=e=>p(_)?_.value=e:null)},{default:r((()=>[(i(!0),v(m,null,k(n(q),(e=>(i(),l(a,{key:e.riskCode||e.productCode,name:e.riskCode||e.productCode,onClick:()=>{return o=e.riskCode,h.type===O.RIDER_RISK&&(b.value||[]).forEach((e=>{_.value.includes(o)?o===e.relatedRiskCode?(2===e.collocationType&&_.value.push(e.collocationRiskCode),3===e.collocationType&&(_.value.push(o),_.value=_.value.filter((o=>o!==e.collocationRiskCode)))):o===e.collocationRiskCode&&(2===e.collocationType&&_.value.push(e.relatedRiskCode),3===e.collocationType&&(_.value=_.value.filter((o=>o!==e.relatedRiskCode)))):o===e.relatedRiskCode?(2===e.collocationType&&(_.value=_.value.filter((o=>o!==e.collocationRiskCode))),3===e.collocationType&&(_.value.push(o),_.value=_.value.filter((o=>o!==e.collocationRiskCode)))):o===e.collocationRiskCode&&(2===e.collocationType&&(_.value=_.value.filter((o=>o!==e.relatedRiskCode))),3===e.collocationType&&(_.value=_.value.filter((o=>o!==e.relatedRiskCode))))})),void(_.value=[...new Set(_.value)]);var o}},{default:r((()=>[R(u(e.riskName||e.productName),1)])),_:2},1032,["name","onClick"])))),128))])),_:1},8,["modelValue"])])):(i(),l(f,{key:1,title:`暂无关联${e.type===n(O).MAIN_RISK?"主":"附加"}险、请选择其他险种`},null,8,["title"]))])]})),_:1},8,["show"])}}}),[["__scopeId","data-v-0a46ec37"]]);const te={class:"page-trial-wrap"},ae=e({name:"trial"}),se=e({...ae,setup(e){const s=o(),d=g(),{productCode:u,orderNo:p,tenantId:m,proposalId:k,proposalInsuredId:R}=s.query,f=t({}),C=t({productList:[]}),L=t([]),I=t({}),y=t(),h=t(),j=F({extInfo:{templateId:201,buttonCode:_.TRIAL_PREMIUM,pageCode:q.TRIAL_PREMIUM}}),S=t(),x=t(),K=t(1),D=a((()=>K.value===O.MAIN_RISK?"添加主险":"添加附加险")),J=t(!1),Q=()=>{A(C.value).then((({code:e,data:o})=>{if("10000"===e){const{productDetailResList:e,productFactor:t}=o;x.value=t,C.value=B(e);const a={};e.forEach((e=>{a[e.productCode]=e})),f.value=a}}))},W=()=>{J.value=!1},X=e=>{if(K.value===O.MAIN_RISK){C.value.productList.push(...e);const o=e.map((e=>e.productCode));y.value.getProductDefaultValue(o)}else{const o=C.value.productList.find((e=>e.productCode===h.value)),t=e.map((e=>({riskCode:e,riskType:O.RIDER_RISK,mainRiskCode:I.value.riskCode}))),a=H(o.mergeRiskReqList,(e=>e.riskCode===I.value.riskCode)),s=z(o.mergeRiskReqList,(e=>e.mainRiskCode===I.value.riskCode));let i=a;-1!==s&&(i=s),o.mergeRiskReqList=[...o.mergeRiskReqList.slice(0,i+1),...t,...o.mergeRiskReqList.slice(i+1,o.mergeRiskReqList.length)],y.value.getRiderRiskDefaultValue(h.value,e,I.value.riskCode,o.mergeRiskReqList)}Q(),J.value=!1},Y=(e,o,t)=>{J.value=!0,K.value=O.RIDER_RISK,L.value=t,I.value=o,h.value=e},Z=e=>{J.value=!0,K.value=O.MAIN_RISK,L.value=e},ee=(e,o,t)=>{f.value[e],t?(f.value[e].productPlanInsureVOList[0].insureProductRiskVOList=f.value[e].productPlanInsureVOList[0].insureProductRiskVOList.filter((e=>e.riskCode!==o)),C.value.productList=C.value.productList.map((t=>(t.productCode===e&&(t.mergeRiskReqList=t.mergeRiskReqList.filter((e=>e.riskCode!==o))),t)))):(C.value.productList=C.value.productList.filter((o=>o.productCode!==e)),Q())},ae=()=>{y.value.onNext((async e=>{var o;const t=G(e),a=["id","relationToHolder","beneficiaryList","guardian","insuredBeneficiaryType"];p||Object.keys(null==(o=t.insuredList)?void 0:o[0]).reduce(((e,o)=>{var s,i,l,r;return!a.includes(o)&&(null==(i=null==(s=t.insuredList)?void 0:s[0])?void 0:i[o])&&(e[o]=null==(r=null==(l=t.insuredList)?void 0:l[0])?void 0:r[o]),e}),t.holder);const{code:i,data:l}=await V(t);"10000"===i&&d.push({path:T.questionNotice,query:{...s.query,orderNo:l}})}))};return b((()=>{p?N({orderNo:p,tenantId:m}).then((({code:e,data:o})=>{"10000"===e&&(S.value=o,j.value=o,C.value=U(o.insuredList[0].productList),Q())})):k?$({id:k,tenantId:m}).then((({code:e,data:o})=>{if("10000"===e){const{holder:e,insuredList:t}=o,a=(u||"").split(",");let s=[];const i=(t||[]).filter((e=>e.id===+R)).map((e=>({...e,productList:e.productList.filter((e=>!!a.includes(e.productCode)&&(s=e.occupationCodeList,!0)))})));i[0].occupationCodeList=s,Object.assign(j.value,{renewFlag:"",holder:e,tenantId:m,proposalId:k,insuredList:i}),S.value=j.value,C.value=U(j.value.insuredList[0].productList),Q()}})):M({productCode:u,isTenant:!1}).then((({data:e,code:o})=>{var t,a;"10000"===o&&(f.value[`${u}`]=e,x.value=null==(a=null==(t=null==e?void 0:e.productPlanInsureVOList)?void 0:t[0])?void 0:a.productFactor,C.value=B([e]))}))})),(e,o)=>(i(),v("div",te,[c(P,{ref_key:"trialRef",ref:y,"product-collection":n(f),"default-data":n(S),"product-factor":n(x),"product-risk-code-map":n(C),"is-trial":"","hide-benefit":"",onAddRisk:Y,onAddMainRisk:Z,onDeleteRisk:ee},{trialBtn:r((({riskPremium:e})=>[c(E,{premium:null==e?void 0:e.initialPremium,onHandleClick:ae},null,8,["premium"])])),_:1},8,["product-collection","default-data","product-factor","product-risk-code-map"]),n(J)?(i(),l(oe,{key:0,type:n(K),show:n(J),"insured-list":n(L),title:n(D),"current-product-code":n(h),"main-risk-code":n(I).riskCode,"select-list":n(C).productList,onCancel:W,onConfirm:X},null,8,["type","show","insured-list","title","current-product-code","main-risk-code","select-list"])):w("",!0)]))}});export{se as default};
