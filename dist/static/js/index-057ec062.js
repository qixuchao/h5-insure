import{ay as e,d as a,r as i,L as l,az as t,aA as n,R as o,aB as s,e as u,ag as r,aC as d,a8 as c,aD as m,aE as p,aF as f,aG as y,aH as v,aI as g,$ as V,aJ as b,aK as h,aL as k,aM as L,aN as O,A as C,a1 as S,b as w,c as I,w as F,i as x,f as T,g as D,E as A,h as _,U as N,G as P,aO as K,aP as j,aQ as U,k as B,aR as M,aS as R,aT as J,V as $,j as E,D as H,av as z,T as q,aU as Y,aV as W,aW as G,af as Q,aX as X,al as Z,am as ee}from"./index-160c1272.js";import{a as ae,B as ie}from"./infoCollection-d69547b2.js";import{c as le}from"./cloneDeep-6abacc69.js";import{d as te,i as ne}from"./debounce-6981b306.js";import{m as oe}from"./merge-e7788e50.js";import{c as se,g as ue,r as re,P as de,v as ce,a as me,i as pe,t as fe}from"./PayInfo-d76728ad.js";import{a as ye,M as ve}from"./keysIn-131bbce9.js";import{S as ge}from"./isObjectLike-a9798079.js";import{S as Ve}from"./index-c842afeb.js";import{a as be}from"./trial-c1533e0d.js";const[he,ke]=e("stepper"),Le=(e,a)=>String(e)===String(a);const Oe=O(a({name:he,props:{min:p(1),max:p(1/0),name:p(""),step:p(1),theme:String,integer:Boolean,disabled:Boolean,showPlus:f,showMinus:f,showInput:f,longPress:f,allowEmpty:Boolean,modelValue:y,inputWidth:y,buttonSize:y,placeholder:String,disablePlus:Boolean,disableMinus:Boolean,disableInput:Boolean,beforeChange:Function,defaultValue:p(1),decimalLength:y},emits:["plus","blur","minus","focus","change","overlimit","update:modelValue"],setup(e,{emit:a}){const p=a=>{const{min:i,max:l,allowEmpty:t,decimalLength:n}=e;return t&&""===a||(a=""===(a=v(String(a),!e.integer))?0:+a,a=Number.isNaN(a)?+i:a,a=Math.max(Math.min(+l,a),+i),g(n)&&(a=a.toFixed(+n))),a};let f;const y=i(),O=i((()=>{var i;const l=null!=(i=e.modelValue)?i:e.defaultValue,t=p(l);return Le(t,e.modelValue)||a("update:modelValue",t),t})()),C=l((()=>e.disabled||e.disableMinus||O.value<=+e.min)),S=l((()=>e.disabled||e.disablePlus||O.value>=+e.max)),w=l((()=>({width:t(e.inputWidth),height:t(e.buttonSize)}))),I=l((()=>n(e.buttonSize))),F=a=>{e.beforeChange?k(e.beforeChange,{args:[a],done(){O.value=a}}):O.value=a},x=()=>{if("plus"===f&&S.value||"minus"===f&&C.value)return void a("overlimit",f);const i="minus"===f?-e.step:+e.step,l=p(L(+O.value,i));F(l),a(f)},T=a=>{const i=a.target,{value:l}=i,{decimalLength:t}=e;let n=v(String(l),!e.integer);if(g(t)&&n.includes(".")){const e=n.split(".");n=`${e[0]}.${e[1].slice(0,+t)}`}e.beforeChange?i.value=String(O.value):Le(l,n)||(i.value=n);const o=n===String(+n);F(o?+n:n)},D=i=>{var l;e.disableInput?null==(l=y.value)||l.blur():a("focus",i)},A=e=>{const i=e.target,l=p(i.value);i.value=String(l),O.value=l,V((()=>{a("blur",e),b()}))};let _,N;const P=()=>{N=setTimeout((()=>{x(),P()}),200)},K=a=>{e.longPress&&(clearTimeout(N),_&&h(a))},j=a=>{e.disableInput&&h(a)},U=a=>({onClick:e=>{h(e),f=a,x()},onTouchstartPassive:()=>{f=a,e.longPress&&(_=!1,clearTimeout(N),N=setTimeout((()=>{_=!0,x(),P()}),600))},onTouchend:K,onTouchcancel:K});return o((()=>[e.max,e.min,e.integer,e.decimalLength]),(()=>{const e=p(O.value);Le(e,O.value)||(O.value=e)})),o((()=>e.modelValue),(e=>{Le(e,O.value)||(O.value=p(e))})),o(O,(i=>{a("update:modelValue",i),a("change",i,{name:e.name})})),s((()=>e.modelValue)),()=>u("div",{role:"group",class:ke([e.theme])},[r(u("button",c({type:"button",style:I.value,class:[ke("minus",{disabled:C.value}),{[m]:!C.value}],"aria-disabled":C.value||void 0},U("minus")),null),[[d,e.showMinus]]),r(u("input",{ref:y,type:e.integer?"tel":"text",role:"spinbutton",class:ke("input"),value:O.value,style:w.value,disabled:e.disabled,readonly:e.disableInput,inputmode:e.integer?"numeric":"decimal",placeholder:e.placeholder,"aria-valuemax":e.max,"aria-valuemin":e.min,"aria-valuenow":O.value,onBlur:A,onInput:T,onFocus:D,onMousedown:j},null),[[d,e.showInput]]),r(u("button",c({type:"button",style:I.value,class:[ke("plus",{disabled:S.value}),{[m]:!S.value}],"aria-disabled":S.value||void 0},U("plus")),null),[[d,e.showPlus]])])}})),Ce=[{name:"年金领取期间",type:"checkbox",configKey:["annuityDrawValueList"],valueKey:"annuityDrawDate"},{name:"领取频率",type:"checkbox",configKey:["annuityDrawFrequencyList"],valueKey:"annuityDrawFrequency"},{name:"交费方式",type:"checkbox",configKey:["paymentFrequencyList"],valueKey:"paymentFrequency",ruleKey:"paymentTypeRule"},{name:"交费期间",type:"checkbox",configKey:["paymentPeriodValueList"],valueKey:"chargePeriod",ruleKey:"paymentPeriodRule",ruleValueKey:"chargePeriod"},{name:"保障期间",type:"checkbox",configKey:["insurancePeriodValueList"],valueKey:"coveragePeriod",ruleKey:"insurancePeriodRule",ruleValueKey:"chargePeriod"}];const Se={key:0},we={class:"custom-field"},Ie={key:1,class:"flex-field"},Fe={class:"pro-radio-wrap"},xe={key:2},Te={class:"pro-radio-wrap"},De={class:"custom-field"},Ae={key:1},_e={key:3},Ne={class:"custom-field"},Pe={key:1},Ke={class:"custom-field"},je={key:0},Ue={key:1},Be={key:4},Me=a({name:"BaoeBaofei"});var Re=P(a({...Me,props:{originData:{default:()=>({})},modelValue:{default:()=>({})},defalutValue:{default:()=>({})},trialResult:{default:()=>({})}},emits:["update:modelValue","trialChange"],setup(e,{emit:a}){const t=e,n=C({hadSetDefault:!1}),s=i(t.originData),r=i(t.modelValue),d=i(0),c=()=>2===s.value.saleMethod?{label:"保费",key:"initialPremium"}:{label:"保额",key:"initialAmount"},m=()=>{switch(`${s.value.displayUnit}`){case ae.YUAN:return"元";case ae.MONTH_SALARY:return"倍月薪";case ae.MILLION:return"万元";case ae.COPY:return"份"}return""},p=l((()=>2===s.value.saleMethod?{label:"保费",key:"initialPremium"}:{label:"保额",key:"initialAmount"})),f=(...e)=>{if(1===d.value){const e=r.value[p.value.key],a=t.originData.minStepValue,i=t.originData.maxStepValue,l=t.originData.stepValue;if(+e>=+i)r.value[p.value.key]=i;else if(+e<=+a)r.value[p.value.key]=a;else{const i=+e-+a,t=Math.floor(i/+l);i%+l!=0&&(r.value[p.value.key]=+a+t*+l)}}return!0},y=()=>{const{displayType:e,requireCopies:a}=s.value,i=c().key,l=!r.value.riskCode;1===e?d.value=1:3===e&&2===a?(d.value=2,s.value.displayValues.length>=1&&l&&!r.value[i]&&(r.value[i]=s.value.displayValues[0].code||s.value.displayValues[0].value)):3===e&&1===a?(d.value=3,s.value.minCopiesValue===s.value.maxCopiesValue&&l&&!r.value.copy&&(r.value.copy=s.value.minCopiesValue),s.value.displayValues.length>=1&&l&&!r.value[i]&&(r.value[i]=s.value.displayValues[0].code||s.value.displayValues[0].value)):2===e&&(d.value=4,s.value.minCopiesValue===s.value.maxCopiesValue&&l&&!r.value.copy&&(r.value.copy=s.value.minCopiesValue),l&&!r.value.initialAmount&&(r.value.initialAmount=s.value.copiesAmount))},v=l((()=>{if(s.value.displayValues){const e=c().key;return 1!==s.value.displayValues.length||r.value.riskCode||(r.value[e]=s.value.displayValues[0].code),s.value.displayValues.map((e=>({label:e.value,value:e.code})))}return[]})),g=()=>{};return S((()=>{y(),a("update:modelValue",r.value)})),o((()=>s),(e=>{y()}),{deep:!0}),o((()=>t.defalutValue),(e=>{(null==e?void 0:e.riskCode)&&!n.hadSetDefault&&(n.hadSetDefault=!0,r.value={...r.value,initialAmount:e.initialAmount,initialPremium:e.initialPremium,copy:e.copy})}),{deep:!0,immediate:!0}),o((()=>r.value),(e=>{(()=>{if(1===d.value){const e=r.value[p.value.key],a=t.originData.minStepValue,i=t.originData.maxStepValue,l=t.originData.stepValue;if(+e>+i)return!1;if(+e<+a)return!1;if((+e-+a)%+l!=0)return!1}return!0})()&&(a("update:modelValue",e),a("trialChange",e))}),{deep:!0,immediate:!0}),(e,a)=>{const i=Oe,l=K,t=j,n=U;return w(),I(N,null,[1===d.value?(w(),I("div",Se,[u(l,{label:`基本${T(p).label}`,name:T(p).key,class:"risk-select-field"},{input:F((()=>[x("div",we,[u(i,{modelValue:r.value[T(p).key],"onUpdate:modelValue":a[0]||(a[0]=e=>r.value[T(p).key]=e),"input-width":"80px","default-value":e.originData.minStepValue,min:e.originData.minStepValue,step:e.originData.stepValue,max:e.originData.maxStepValue,onBlur:f},null,8,["modelValue","default-value","min","step","max"])])])),_:1},8,["label","name"])])):2===d.value?(w(),I("div",Ie,[u(n,{modelValue:r.value[T(p).key],"onUpdate:modelValue":a[2]||(a[2]=e=>r.value[T(p).key]=e),label:`基本${T(p).label}`,name:T(p).key,class:"risk-select-field"},{input:F((()=>[x("div",Fe,[u(t,{modelValue:r.value[T(p).key],"onUpdate:modelValue":a[1]||(a[1]=e=>r.value[T(p).key]=e),options:T(v),onclick:g},null,8,["modelValue","options"])])])),_:1},8,["modelValue","label","name"])])):3===d.value?(w(),I("div",xe,[u(n,{modelValue:r.value[T(p).key],"onUpdate:modelValue":a[4]||(a[4]=e=>r.value[T(p).key]=e),label:`基本${T(p).label}`,name:T(p).key,class:"risk-select-field"},{input:F((()=>[x("div",Te,[u(t,{modelValue:r.value[T(p).key],"onUpdate:modelValue":a[3]||(a[3]=e=>r.value[T(p).key]=e),options:T(v),onclick:g},null,8,["modelValue","options"])])])),_:1},8,["modelValue","label","name"]),x("div",null,[u(l,{modelValue:r.value.copy,"onUpdate:modelValue":a[6]||(a[6]=e=>r.value.copy=e),label:"份数",name:"copy",class:"risk-select-field"},{input:F((()=>[x("div",De,[e.originData.minCopiesValue!==e.originData.maxCopiesValue?(w(),D(i,{key:0,modelValue:r.value.copy,"onUpdate:modelValue":a[5]||(a[5]=e=>r.value.copy=e),"input-width":"80px","default-value":e.originData.minCopiesValue,min:e.originData.minCopiesValue||1,step:1,max:e.originData.maxCopiesValue},null,8,["modelValue","default-value","min","max"])):(w(),I("span",Ae,A(e.originData.minCopiesValue),1))])])),_:1},8,["modelValue"])])])):4===d.value?(w(),I("div",_e,[u(l,{modelValue:r.value.copy,"onUpdate:modelValue":a[8]||(a[8]=e=>r.value.copy=e),label:"份数",name:"copy",class:"risk-select-field"},{input:F((()=>[x("div",Ne,[e.originData.minCopiesValue!==e.originData.maxCopiesValue?(w(),D(i,{key:0,modelValue:r.value.copy,"onUpdate:modelValue":a[7]||(a[7]=e=>r.value.copy=e),"input-width":"64px","default-value":e.originData.minCopiesValue,min:e.originData.minCopiesValue||1,step:1,max:e.originData.maxCopiesValue},null,8,["modelValue","default-value","min","max"])):(w(),I("span",Pe,A(e.originData.minCopiesValue),1))])])),_:1},8,["modelValue"]),u(l,{label:T(p).label,name:"copyAmount",class:"risk-select-field"},{input:F((()=>[x("div",Ke,[e.originData.minCopiesValue!==e.originData.maxCopiesValue?(w(),I("span",je,A(+e.originData.copiesAmount*+r.value.copy+m()),1)):(w(),I("span",Ue,A(+e.originData.minCopiesValue*+e.originData.copiesAmount+m()),1))])])),_:1},8,["label"])])):_("",!0),2===s.value.saleMethod&&e.trialResult&&e.trialResult.initialAmount>0?(w(),I("div",Be,[u(l,{label:"保额",class:"risk-select-field"},{input:F((()=>[x("span",null,A(e.trialResult.initialAmount),1)])),_:1})])):_("",!0)],64)}}}),[["__scopeId","data-v-7997a9f0"]]);const Je=a({name:"BeneficiaryItem"});var $e=P(a({...Je,props:{modelValue:{default:()=>({})},schema:{default:()=>[]},config:{default:()=>({})},isView:{type:Boolean,default:!1},isTrial:{type:Boolean,default:!1},title:{default:"受益人"}},emits:["update:modelValue","trailChange"],setup(e,{expose:a,emit:l}){const t=e,n=i(null),s=C({validated:!1,schema:[],config:{},personVO:{}});return o((()=>t.config),(e=>{e&&Object.assign(s.config,e)}),{deep:!0,immediate:!0}),o((()=>t.schema),(e=>{e&&Object.assign(s.schema,le(t.schema))}),{deep:!0,immediate:!0}),o((()=>t.modelValue),((e,a)=>{JSON.stringify(e)!==JSON.stringify(a)&&(se("受益人数据变动了"),Object.assign(s.personVO,e))}),{deep:!0,immediate:!0}),o((()=>s.personVO),(e=>{e&&l("update:modelValue",e)}),{deep:!0,immediate:!0}),o((()=>{var e;return null==(e=s.personVO)?void 0:e.relationToInsured}),((e,a)=>{if(e===a)return!1;se("受益人与被保人关系变动了");const{certType:i}=s.personVO||{},[l,n]=ue(s.schema,{certType:i,relationToHolder:e});return oe(s.config,n),!t.isView&&e&&a&&Object.assign(s.personVO,{...re(s.personVO,(e=>!(l&&"certType"===e))),relationToInsured:e}),!1}),{immediate:!0}),a({validate:e=>me(n,t.trialFactorCodes,e),validateTrialFields:()=>ce({personVO:s.personVO,trialFactorCodes:t.trialFactorCodes})}),(e,a)=>(w(),D(T(de),{ref_key:"formRef",ref:n,class:"personal-info-card",title:e.title,model:T(s).personVO,schema:T(s).schema,config:T(s).config,"is-view":e.isView,"extra-provision":{objectType:T(M).BENEFICIARY,objectId:T(s).personVO.id}},{cardTitleExtra:F((()=>[B(e.$slots,"default",{},void 0,!0)])),_:3},8,["title","model","schema","config","is-view","extra-provision"]))}}),[["__scopeId","data-v-34580ae7"]]);const Ee=["onClick"],He=a({name:"InsuredItem"});var ze=P(a({...He,props:{modelValue:{default:()=>({})},title:{default:""},holderPersonVO:{},schema:{default:()=>[]},config:{default:()=>({})},isView:{type:Boolean,default:!1},isTrial:{type:Boolean,default:!1},trialFactorCodes:{default:()=>[]},multiBeneficiaryMaxNum:{default:null},beneficiaryList:{default:()=>[]},beneficiarySchema:{default:()=>[]}},emits:["update:modelValue","update:beneficiaryList"],setup(e,{expose:a,emit:t}){const n=e,s=i(null),r=i(null),d=i(null),c={schema:[],trialFactorCodes:[],config:{},personVO:{}},m=C({validated:!1,schema:[],config:{},personVO:{},beneficiaryTypeSchemaList:[],beneficiarySchemaList:[],beneficiaryList:[]}),p=()=>{m.beneficiaryList.push(le({...c,nanoid:J(),schema:n.beneficiarySchema}))},f=l((()=>!n.multiBeneficiaryMaxNum||m.beneficiaryList.length<n.multiBeneficiaryMaxNum)),y=l((()=>!m.schema.filter((e=>{var a;return!(e.hidden||(null==(a=m.config[e.name])?void 0:a.hidden))})).length)),v=l((()=>m.schema.filter((e=>e.isSelfInsuredNeed)).map((e=>e.name)))),g=l((()=>R(n.beneficiarySchema))),V=l((()=>{var e;return String(null==(e=m.personVO)?void 0:e.insuredBeneficiaryType)===ie.SPECIFY}));return o((()=>n.holderPersonVO),(e=>{var a;se("投保人信息变动了");const{id:i,...l}=e||{};if("1"===String(null==(a=m.personVO)?void 0:a.relationToHolder)){const e=R(v.value)?Object.keys(l).reduce(((e,a)=>([...v.value,"occupationClass"].includes(a)&&!["birthday","age","gender"].includes(a)||(e[a]=l[a]),e)),{}):l;Object.assign(m.personVO,e)}}),{deep:!0,immediate:!0}),o((()=>n.beneficiarySchema),(e=>{m.beneficiarySchemaList=R(e)?e.filter((e=>"insuredBeneficiaryType"!==e.name)):[],m.beneficiaryTypeSchemaList=R(e)?e.filter((e=>"insuredBeneficiaryType"===e.name)):[]}),{deep:!0,immediate:!0}),o(V,((e,a)=>{String(e)!==String(a)&&(se("受益人类型关系变动了"),e?!R(m.beneficiaryList)&&p():m.beneficiaryList=[])}),{immediate:!0}),o((()=>m.beneficiaryList.map((e=>({personVO:e.personVO})))),((e,a)=>{JSON.stringify(e)!==JSON.stringify(a)&&t("update:beneficiaryList",e)}),{deep:!0}),o((()=>{var e;return null==(e=m.personVO)?void 0:e.relationToHolder}),((e,a)=>{if(!e)return;se("与投保人关系变动了");const{personVO:i,schema:l=[],config:t}=m||{},{id:o,...s}=n.holderPersonVO||{},u="1"===String(i.relationToHolder),[r,d]=ue(l,i);if(oe(t,d),l.forEach((e=>{e.relationToHolder=i.relationToHolder,e.hidden=!e.isSelfInsuredNeed&&u})),!n.isView&&a&&String(e)!==String(a)){let e={...i,...s};u||(e={...re(i,(e=>!(r&&"certType"===e))),relationToHolder:i.relationToHolder}),Object.assign(m.personVO,e)}}),{deep:!0}),o((()=>{var e;return null==(e=m.personVO)?void 0:e.relationToMainInsured}),((e,a)=>{if(!e)return;se("次被保人与主被保人关系变动了");const{personVO:i,schema:l=[],config:t}=m||{},{certType:o}=i||{},[s,u]=ue(l,{certType:o,relationToHolder:e});oe(t,u),!n.isView&&a&&String(e)!==String(a)&&Object.assign(m.personVO,{...re(i,(e=>!(s&&"certType"===e))),relationToMainInsured:i.relationToMainInsured})})),o((()=>n.config),(e=>{e&&Object.assign(m.config,e)}),{deep:!0,immediate:!0}),o((()=>n.schema),(e=>{e&&Object.assign(m.schema,le(e))}),{deep:!0,immediate:!0}),o((()=>n.modelValue),((e,a)=>{if(JSON.stringify(e)!==JSON.stringify(a)){const{beneficiaryList:a,...i}=e;oe(m.personVO,i)}}),{deep:!0,immediate:!0}),o((()=>n.beneficiaryList),((e,a)=>{JSON.stringify(e)!==JSON.stringify(a)&&(m.beneficiaryList=R(e)?e.map((e=>({...e,nanoid:e.nanoid||J()}))):[])}),{deep:!0,immediate:!0}),o((()=>m.personVO),(e=>{e&&t("update:modelValue",e)}),{deep:!0,immediate:!0}),a({validate:e=>{var a;return Promise.all([me(s,n.trialFactorCodes,e),me(r,[],e),...(null==(a=d.value)?void 0:a.map((a=>a.validate(e))))||[]])},validateTrialFields:()=>ce({personVO:m.personVO,trialFactorCodes:n.trialFactorCodes})}),(e,a)=>{const i=z;return w(),I(N,null,[u(T(de),{ref_key:"insuredFormRef",ref:s,class:"personal-info-card",title:T(y)?"":e.title,model:T(m).personVO,schema:T(m).schema,config:T(m).config,"is-view":e.isView,"extra-provision":{objectType:T(M).INSURED,objectId:T(m).personVO.id}},{cardTitleExtra:F((()=>[B(e.$slots,"default",{},void 0,!0)])),_:3},8,["title","model","schema","config","is-view","extra-provision"]),T(g)?(w(),I(N,{key:0},[u(T(de),{ref_key:"beneficiaryTypeFormRef",ref:r,class:"personal-info-card",title:"受益人",model:T(m).personVO,schema:T(m).beneficiaryTypeSchemaList,"is-view":e.isView},null,8,["model","schema","is-view"]),T(V)?(w(),I(N,{key:0},[(w(!0),I(N,null,$(T(m).beneficiaryList,((a,l)=>(w(),D($e,{ref_for:!0,ref_key:"beneficiaryFormRef",ref:d,key:`${a.nanoid}_${l}`,modelValue:a.personVO,"onUpdate:modelValue":e=>a.personVO=e,title:`受益人${l+1}`,schema:T(m).beneficiarySchemaList,config:a.config,"is-view":e.isView},{default:F((()=>[l>0&&!e.isView?(w(),I("span",{key:0,class:"delete-button",onClick:e=>(e=>{H.confirm({message:"确定要删除该受益人吗？"}).then((()=>{m.beneficiaryList.splice(e,1)}))})(l)},[u(i,{name:"delete-o"})],8,Ee)):_("",!0)])),_:2},1032,["modelValue","onUpdate:modelValue","title","schema","config","is-view"])))),128)),!e.isView&&T(f)?(w(),I("span",{key:0,class:"add-button",onClick:p},[u(i,{name:"plus"}),E("添加受益人")])):_("",!0)],64)):_("",!0)],64)):_("",!0)],64)}}}),[["__scopeId","data-v-ac71bbac"]]);const qe=["onClick"],Ye=a({name:"PersonalInfo"}),We=a({...Ye,props:{productFactor:{default:()=>({})},modelValue:{default:()=>({})},isTrial:{type:Boolean,default:!1},isView:{type:Boolean,default:!1},isOnlyHolder:{type:Boolean,default:!1},multiInsuredConfig:{}},emits:["update:modelValue","trailChange","trailValidateFailed"],setup(e,{expose:a,emit:t}){const n=e,s=i(null),r=i(null),d=C({config:{},trialValidated:!1,holder:{personVO:{},schema:[],trialFactorCodes:[],config:{}},beneficiarySchema:[],initInsuredIList:[],insured:[]}),m=l((()=>!n.isTrial||n.isOnlyHolder)),p=()=>{var e;const a=!r.value||(null==(e=r.value)?void 0:e.every((e=>e.validateTrialFields())));return(!s.value||ce(d.holder))&&a},f=e=>{var a;return Promise.all([...(null==(a=r.value)?void 0:a.map((a=>a.validate(e))))||[],me(s,d.holder.trialFactorCodes,e)])},y=e=>{const{productList:a,config:i,schema:l,trialFactorCodes:t,beneficiaryList:n,personVO:o,nanoid:s,...u}=e||{};return u},v=()=>{const{length:e,[e-1]:a}=d.initInsuredIList;d.insured.push(le({...a,nanoid:J()}))},g=l((()=>{const{multiInsuredMaxNum:e,multiInsuredSupportFlag:a}=d.config;return a&&(!e||d.insured.length<e)})),V=l((()=>R(d.holder.schema))),b=l((()=>d.insured.some((e=>R(e.schema))))),h=(e,a)=>R(e)?e.reduce(((e,i)=>(e[i]=a[i],e)),{}):{},k=(e,a,i={})=>!!R(e)&&JSON.stringify(h(e,a))!==JSON.stringify(h(e,i));return o((()=>{var e;return null==(e=d.holder.personVO)?void 0:e.certType}),((e,a)=>{if(e===a)return!1;se("投保人信息变动了");const[i,l]=ue(d.holder.schema,{certType:e});return oe(d.holder.config,l),!1})),o([()=>{var e;return{...null==(e=d.holder)?void 0:e.personVO}},()=>d.insured.map((e=>{const{beneficiaryList:a,personVO:i}=e||{};return{...i,beneficiaryList:R(a)?a.map((e=>({...e.personVO}))):[]}}))],te(((e,a)=>{var i,l,o;const[s,u]=e,r=((e,a)=>{const i=k(d.holder.trialFactorCodes,e[0],a[0]),l=d.insured.some(((e,i)=>{var l;const{trialFactorCodes:t,personVO:n}=e;return k(t,n,null==(l=a[1])?void 0:l[i])}));return i||l})([s,u],a);se(`投被保人信息变动了---${r}`);const{insuredList:c}=n.modelValue;console.log("insuredList",c,u);const m={holder:s,insuredList:u.map(((e,a)=>({...(null==c?void 0:c[a])||{},...e})))};if(d.config.isSpouseInsured){const[e,a]=u.map((e=>null==e?void 0:e.gender));if(e&&a&&String(e)===String(a))return q("被保人性别与投保要求不符")}if(JSON.stringify(null==(i=null==u?void 0:u[0])?void 0:i.personVO),y(null==(o=null==(l=n.modelValue)?void 0:l.insuredList)?void 0:o[0]),console.log("-------result = ",m),t("update:modelValue",m),!p())return d.trialValidated=!1,t("trailValidateFailed",m);f(!0).then((()=>{d.trialValidated=!0,r&&!n.isOnlyHolder&&t("trailChange",m)})).catch((()=>{d.trialValidated=!1,t("trailValidateFailed",m)}))}),500),{deep:!0}),o([()=>n.productFactor,()=>n.isTrial],((e,a)=>{if(pe(e,a)||!e[0])return!1;se("投被保人要素变动了");const{insuredFactorCodes:i,holderFactorCodes:l}=Y(W)||{},{holder:t,insured:o,beneficiary:s,config:u}=fe(e[0],{isTrial:e[1],...n.multiInsuredConfig,insuredFactorCodes:i,holderFactorCodes:l});return Object.assign(d.holder,t),console.log("-----------",t,o),d.config=u,R(o)&&(d.initInsuredIList=o.map((e=>({...e,beneficiaryList:[]})))),d.beneficiarySchema=le((null==s?void 0:s.schema)||[]),!1}),{deep:!0,immediate:!0}),o([()=>{const{holder:e,insuredList:a}=n.modelValue,i=R(a)?a.map((e=>({config:e.config,personVO:y(e),beneficiaryList:R(e.beneficiaryList)?e.beneficiaryList.map((({config:e,...a})=>({config:e,personVO:y(a)}))):[]}))):[];return[null==e?void 0:e.config,y(e),i]},()=>d.config],(([[e,a,i]])=>{Object.assign(d.holder.config,e),Object.assign(d.holder.personVO,a);const{length:l}=i||[],{length:t}=d.insured,{length:o,0:s={},[o-1]:u}=d.initInsuredIList,{multiInsuredMaxNum:r,multiInsuredMinNum:c,multiInsuredSupportFlag:m}=d.config,p=n.isView||l>t?Math.min(l,r):t||c;console.log("-----change",d.config,p),d.insured=Array.from({length:p}).reduce(((e,a,l)=>{const{personVO:t,config:n={},beneficiaryList:o}=(null==i?void 0:i[l])||{},r=le(0===l?s:u);return e[l]?oe(e[l],{personVO:t,config:n,beneficiaryList:o}):e[l]={...r,personVO:t,config:n,beneficiaryList:o,nanoid:J()},e}),d.insured)}),{deep:!0,immediate:!0}),a({validate:f,validateTrialFields:p,validateHolder:(...e)=>{var a;return null==(a=s.value)?void 0:a.validate(...e)},canTrail:()=>d.trialValidated}),(e,a)=>{const i=z,l=G;return w(),I(N,null,[T(V)&&T(m)?(w(),D(T(de),{key:0,ref_key:"holderFormRef",ref:s,title:"投保人信息",class:"personal-info-card",model:T(d).holder.personVO,schema:T(d).holder.schema,config:T(d).holder.config,"is-view":e.isView,"extra-provision":{objectType:T(M).HOLDER,objectId:T(d).holder.personVO.id}},null,8,["model","schema","config","is-view","extra-provision"])):_("",!0),T(b)&&!e.isOnlyHolder?(w(),I(N,{key:1},[(w(!0),I(N,null,$(T(d).insured,((a,l)=>(w(),D(ze,c({ref_for:!0,ref_key:"insuredFormRef",ref:r,key:`${a.nanoid}_${l}`,modelValue:a.personVO,"onUpdate:modelValue":e=>a.personVO=e,"beneficiary-list":a.beneficiaryList,"onUpdate:beneficiaryList":e=>a.beneficiaryList=e,title:""+(T(d).insured.length>1?`被保人${l+1}`:"被保人信息"),"holder-person-v-o":T(d).holder.personVO},a,{"beneficiary-schema":T(d).beneficiarySchema,"is-view":e.isView,"multi-beneficiary-num":T(d).config.multiBeneficiaryMaxNum}),{default:F((()=>[!e.isView&&l+1>T(d).config.multiInsuredMinNum?(w(),I("span",{key:0,class:"delete-button",onClick:e=>(e=>{H.confirm({message:"确定要删除该被保人吗？"}).then((()=>{d.insured.splice(e,1)}))})(l)},[u(i,{name:"delete-o"})],8,qe)):_("",!0)])),_:2},1040,["modelValue","onUpdate:modelValue","beneficiary-list","onUpdate:beneficiaryList","title","holder-person-v-o","beneficiary-schema","is-view","multi-beneficiary-num"])))),128)),!e.isView&&T(g)?(w(),D(l,{key:0,class:"add-button-wrap"},{title:F((()=>[x("span",{class:"add-button",onClick:v},[u(i,{name:"plus"}),E("添加被保人")])])),_:1})):_("",!0)],64)):_("",!0)],64)}}});var Ge=P(We,[["__scopeId","data-v-6a1e3d74"]]),Qe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Xe=/^\w*$/;function Ze(e,a){if("function"!=typeof e||null!=a&&"function"!=typeof a)throw new TypeError("Expected a function");var i=function(){var l=arguments,t=a?a.apply(this,l):l[0],n=i.cache;if(n.has(t))return n.get(t);var o=e.apply(this,l);return i.cache=n.set(t,o)||n,o};return i.cache=new(Ze.Cache||ve),i}Ze.Cache=ve;var ea,aa,ia,la=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ta=/\\(\\)?/g,na=(ea=function(e){var a=[];return 46===e.charCodeAt(0)&&a.push(""),e.replace(la,(function(e,i,l,t){a.push(l?t.replace(ta,"$1"):i||e)})),a},aa=Ze(ea,(function(e){return 500===ia.size&&ia.clear(),e})),ia=aa.cache,aa),oa=na;var sa=ge?ge.prototype:void 0,ua=sa?sa.toString:void 0;function ra(e){if("string"==typeof e)return e;if(ye(e))return function(e,a){for(var i=-1,l=null==e?0:e.length,t=Array(l);++i<l;)t[i]=a(e[i],i,e);return t}(e,ra)+"";if(ne(e))return ua?ua.call(e):"";var a=e+"";return"0"==a&&1/e==-Infinity?"-0":a}function da(e,a){return ye(e)?e:function(e,a){if(ye(e))return!1;var i=typeof e;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=e&&!ne(e))||Xe.test(e)||!Qe.test(e)||null!=a&&e in Object(a)}(e,a)?[e]:oa(function(e){return null==e?"":ra(e)}(e))}function ca(e){if("string"==typeof e||ne(e))return e;var a=e+"";return"0"==a&&1/e==-Infinity?"-0":a}function ma(e,a,i){var l=null==e?void 0:function(e,a){for(var i=0,l=(a=da(a,e)).length;null!=e&&i<l;)e=e[ca(a[i++])];return i&&i==l?e:void 0}(e,a);return void 0===l?i:l}const pa={class:"pro-radio-wrap"},fa=a({name:"ProductKeys"});var ya=P(a({...fa,props:{originData:{default:()=>({})},modelValue:{default:()=>({})},riskInfo:{default:()=>({})},defaultValue:{default:()=>({})},useData:{default:()=>({})}},emits:["trialChange","inputChange"],setup(e,{emit:a}){const l=e,t=i(l.originData),n=i(l.modelValue);i(1);const s=e=>{const a=ma(l.originData,e),i=ma(l.originData,e);return a.map((e=>{const a=i?i.find((a=>a.code===e.code)):null;return{label:e.value,value:e.code,disabled:!(!a||null===a.useFlag||void 0===a.useFlag)&&1!==a.useFlag}}))},r=()=>{Ce.forEach((e=>{const a=ma(l.originData,e.configKey);"checkbox"===e.type&&a&&a.length>0&&!n.value.riskCode&&(n.value[e.valueKey]=a[0].code)}))};return S((()=>{r()})),o((()=>l.defaultValue),(e=>{(null==e?void 0:e.riskCode)&&(n.value=JSON.parse(JSON.stringify(e)))}),{deep:!0,immediate:!0}),o((()=>t.value),(e=>{r()}),{deep:!0,immediate:!0}),o((()=>JSON.stringify(n.value)),((e,i)=>{const t=e&&JSON.parse(e)||{};console.log("---v new = ",t);const n=i&&JSON.parse(i)||{};let o=null;Ce.forEach((e=>{t[e.valueKey]&&n[e.valueKey]&&t[e.valueKey]!==n[e.valueKey]&&(o||(o={key:e.valueKey,oldValue:n[e.valueKey],newValue:t[e.valueKey],riskCode:l.riskInfo.riskCode}))})),e&&a("trialChange",JSON.parse(e),o)}),{deep:!0,immediate:!0}),(e,a)=>{const i=j,l=U;return w(!0),I(N,null,$(T(Ce),(a=>(w(),I(N,null,[T(ma)(e.originData,a.configKey)&&(1===e.riskInfo.mainRiskFlag||a.ruleKey&&2===T(ma)(e.originData,a.ruleKey)||!a.ruleKey)?(w(),I("div",{key:e.riskInfo.riskCode+"_"+a.name},["checkbox"===a.type?(w(),D(l,{key:0,modelValue:n.value[a.valueKey],"onUpdate:modelValue":e=>n.value[a.valueKey]=e,label:a.name,name:a.valueKey,class:"risk-select-field"},{input:F((()=>[x("div",pa,[u(i,{modelValue:n.value[a.valueKey],"onUpdate:modelValue":[e=>n.value[a.valueKey]=e,e=>((e,a)=>{console.log("-------change",e,a)})(e,a.valueKey)],options:s(a.configKey)},null,8,["modelValue","onUpdate:modelValue","options"])])])),_:2},1032,["modelValue","onUpdate:modelValue","label","name"])):_("",!0)])):_("",!0)],64)))),256)}}}),[["__scopeId","data-v-15c494f0"]]);const va={class:"com-risk-liabilityinfo"},ga={class:"item-wrap"},Va={key:0},ba=(e=>(Z("data-v-50053b39"),e=e(),ee(),e))((()=>x("div",{class:"cell-content"},null,-1))),ha=a({name:"riskLiabilityInfo"});var ka=P(a({...ha,props:{dataSource:{default:()=>({})},modelValue:{default:()=>({})},dataSourceFolmulate:{default:()=>({})},params:{default:()=>({amountUnit:"",basicsAmount:"",basicsPremium:"",riskId:""})},defaultValue:{default:()=>({})}},emits:["trialChange"],setup(e,{emit:a}){const t=e,n=i({formInfo:t.dataSource,isCheckList:[],checkValueList:[],liabilityList:[],signLiabilityClick:[]}),s=(e,a)=>{console.log("---click ",e,a),n.value.signLiabilityClick.push({item:e,index:a})},r=(e,a)=>{const i=n.value.liabilityList.map((e=>e.key)),l=0===e.liabilityAttributeValueList.length&&0===e.formula.length,t=n.value.isCheckList[a];l&&-1===i.indexOf(a)&&t&&n.value.liabilityList.push({liabilityValue:e,key:a,isSwitchOn:n.value.isCheckList[a]}),"1"===t?s(e,a):n.value.signLiabilityClick.splice(a,1),-1!==i.indexOf(a)&&n.value.liabilityList.forEach((e=>{e.key===a&&(e.isSwitchOn=n.value.isCheckList[a])}))},d=(e,a)=>{const i=e.liabilityAttributeValueList.filter((e=>e.displayValue===n.value.checkValueList[a])),l=JSON.parse(JSON.stringify(i))[0]||e.liabilityAttributeValueList[0],t={...e,liabilityValue:l};n.value.liabilityList.length>0&&Object.keys(n.value.checkValueList).indexOf(a)&&(n.value.liabilityList=n.value.liabilityList.filter((e=>e.key!==a))),n.value.checkValueList[a]=l.displayValue,n.value.liabilityList.push({liabilityValue:t,key:a,isSwitchOn:"1"})},c=l((()=>le(t.dataSourceFolmulate))),m=(e,a,i)=>{1===i?n.value.liabilityList.push({liabilityValue:{...e,liabilityValue:null==e?void 0:e.liabilityAttributeValueList[0]},key:a,isSwitchOn:"1"}):n.value.liabilityList.push({liabilityValue:{...e,liabilityValue:null==e?void 0:e.liabilityAttributeValueList[0]},key:a,isSwitchOn:"2"})};return o((()=>c.value),((e,a)=>{var i,l;const o=null==(i=t.dataSourceFolmulate)?void 0:i.initialAmount,s=null==(l=t.dataSourceFolmulate)?void 0:l.initialPremium,u={amountUnit:t.params.amountUnit,basicsAmount:o,basicsPremium:s,riskId:t.params.riskId},r=t.dataSource.riskLiabilityInfoVOList.map((async i=>{if(i.formula.length>0&&(o||s)&&((null==e?void 0:e.initialAmount)!==(null==a?void 0:a.initialAmount)||(null==e?void 0:e.initialPremium)!==(null==a?void 0:a.initialPremium))){const{code:e,data:a}=await be({...u,riskLiabilities:[i]});if("10000"===e){if(i.liabilityAttributeValueList=a[0].formulaResult,n.value.signLiabilityClick.length>0){const e=n.value.signLiabilityClick.find((e=>e.item.liabilityCode===i.liabilityCode));e&&d(e.item,e.index)}return{...i,liabilityAttributeValueList:a[0]}}return i}}));console.log("liabilityItem>>>>>>",r),console.log("riskLiabilityInfoVOList>>>>>>",t.dataSource.riskLiabilityInfoVOList)}),{deep:!0,immediate:!0}),o((()=>n.value.liabilityList),(e=>{const i=n.value.liabilityList.filter((e=>"1"===e.isSwitchOn)).map((e=>({...e.liabilityValue})));a("trialChange",i)}),{deep:!0,immediate:!0}),S((()=>{console.log("----mounted"),t.dataSource.riskLiabilityInfoVOList.map(((e,a)=>{const i=e.liabilityAttributeValueList.length>0&&0===e.formula.length&&e.liabilityAttributeValueList[0].displayValue;return n.value.checkValueList[a]||(n.value.checkValueList[a]=i),1!=+e.showFlag&&n.value.liabilityList.push({liabilityValue:e,key:a,isSwitchOn:"1"}),1==+e.showFlag&&(1===e.attributeFlag&&2===e.insureFlag&&0===e.formula.length&&m(e,a,1),1===e.attributeFlag&&1===e.insureFlag&&0===e.formula.length&&m(e,a,2),2===e.attributeFlag&&1===(null==e?void 0:e.liabilityAttributeValueList.length)&&2===e.insureFlag&&m(e,a,1),2===e.attributeFlag&&1===(null==e?void 0:e.liabilityAttributeValueList.length)&&1===e.insureFlag&&m(e,a,2)),null}))})),o((()=>t.defaultValue),(e=>{(null==e?void 0:e.riskCode)&&e.liabilityList&&(n.value.signLiabilityClick=[],t.dataSource.riskLiabilityInfoVOList.forEach(((a,i)=>{var l;const t=null==e?void 0:e.liabilityList.find((e=>e.liabilityCode===a.liabilityCode));console.log("--target lia = ",t),n.value.isCheckList[i]="2",t&&(n.value.isCheckList[i]="1",n.value.checkValueList[i]=null==(l=null==t?void 0:t.liabilityValue)?void 0:l.displayValue,1==+a.showFlag&&2==+a.optionalFlag?r(a,i):s(a,i))})))}),{deep:!0,immediate:!0}),(e,a)=>{const i=Ve,l=U,t=Q,o=X;return w(),D(o,null,{default:F((()=>[x("div",va,[x("div",ga,[(w(!0),I(N,null,$(e.dataSource.riskLiabilityInfoVOList,((e,a)=>(w(),I("div",{key:a},[1!=+e.showFlag||2===e.attributeFlag&&1===(null==e?void 0:e.liabilityAttributeValueList.length)&&2===e.insureFlag?_("",!0):(w(),I("div",Va,[u(l,{label:`${e.liabilityName}`,"label-width":"40%",name:"insuredRelation",class:"riskliab-select-field"},{input:F((()=>[1==+e.insureFlag?(w(),D(i,{key:0,modelValue:T(n).isCheckList[a],"onUpdate:modelValue":e=>T(n).isCheckList[a]=e,"active-value":"1","inactive-value":"2",size:"0.74rem",onClick:i=>r(e,a)},null,8,["modelValue","onUpdate:modelValue","onClick"])):_("",!0)])),_:2},1032,["label"]),1==+T(n).isCheckList[a]&&1===e.attributeFlag||1===e.attributeFlag&&2===e.insureFlag?(w(),D(l,{key:0,label:e.liabilityAttributeTypeDesc,"label-width":"40%",name:"insuredRelation",class:"riskliab-select-field-children"},{input:F((()=>[u(j,{modelValue:T(n).checkValueList[a],"onUpdate:modelValue":e=>T(n).checkValueList[a]=e,prop:{label:"displayValue",value:"displayValue"},options:(e.formula.length,e.liabilityAttributeValueList),"is-simply":!0,onClick:i=>d(e,a)},null,8,["modelValue","onUpdate:modelValue","options","onClick"])])),_:2},1032,["label"])):_("",!0)]))])))),128))])]),ba,u(t)])),_:1})}}}),[["__scopeId","data-v-50053b39"]]);export{Re as B,Ce as P,ka as R,Oe as S,Ge as a,ya as b};
