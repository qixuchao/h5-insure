import{E as e,d as o,r as t,c as r,e as s,w as a,f as i,i as d,j as l,B as u,x as c,bH as n,Q as p,y as m,g as v,a1 as f,R as k,U as C,bu as h,z as b,bI as P,az as L,bJ as I,bK as R,bA as y,ak as j,al as _,aa as V,K as g,bL as O,h as x,bM as D,b6 as w,a as T,u as N,o as E,ax as q,bp as S,b as U,bN as H,D as F,Z as A,bh as K,av as B,T as $}from"./index-f6fa5ecc.js";import{A as z}from"./index-1575db0a.js";import{P as J,a as M,b as W,c as Q}from"./index-cc11bf88.js";import{d as Y}from"./debounce-eed12388.js";import{u as Z}from"./createProposal-68c53821.js";import{_ as G}from"./ProRenderFormWithCard.vue_vue_type_style_index_0_scoped_true_lang-03393721.js";/* empty css              */import"./bankCard-3b323770.js";import{q as X,a as ee}from"./createProposal-b6064126.js";import{a as oe,p as te}from"./trial-d6f8cdcc.js";import{T as re}from"./index-c2c545cf.js";import{u as se}from"./useDicData-325a8f60.js";import"./pdfh5-008ca364.js";import"./index-f0d42bad.js";import"./isObjectLike-a9798079.js";import"./_initCloneObject-0663309f.js";import"./phoneVerify-687c21c7.js";import"./index-cfa18f3f.js";import"./cloneDeep-1de8e9b0.js";import"./infoCollection-3913f4d9.js";import"./index-9edaa6b6.js";import"./utils-a2961050.js";import"./index-48c2c33d.js";import"./trial-dfc2b426.js";import"./utils-5d5a2bb8.js";import"./index-4ea5171c.js";import"./empty-c926d8ec.js";import"./box-title-0b8f2d68.js";import"./index-31dde3c9.js";import"./echarts-5af64754.js";import"./Table-80a7d64b.js";import"./useOrder-d313bd64.js";import"./utils-1c898dbb.js";import"./constants-7afb7c3d.js";import"./nextStep-3094424c.js";import"./core-c86456b5.js";import"./constant-8927d485.js";import"./pageJump-1ad97747.js";const ae={class:"trial-button"};var ie=e(o({__name:"TrialPopup",props:{productCode:{default:""},productName:{default:""}},emits:["finish"],setup(e,{expose:o,emit:c}){const n=e,p=t(null),m=(e,o)=>{var t;console.log("trialData",e);const{holder:r,insuredVOList:s}=e||{},{personVO:a,productPlanVOList:i}=(null==s?void 0:s[0])||{},d=((null==(t=null==i?void 0:i[0])?void 0:t.riskVOList)||[]).map((e=>{var t,r;return{...e,premium:null==(t=o[e.riskCode])?void 0:t.premium,amount:null==(r=o[e.riskCode])?void 0:r.amount}}));return{productCode:n.productCode,proposalHolder:null==r?void 0:r.personVO,insuredPersonVO:a,insuredProductInfo:{productCode:n.productCode,productName:n.productName,occupationCodeList:a.occupationCodeList,proposalProductRiskList:d}}};return o({...["open","close"].reduce(((e,o)=>(e[o]=(...e)=>{var t;null==(t=p.value)||t[o](...e)},e)),{}),formatData:m}),(o,t)=>{const n=u;return r(),s(re,{ref_key:"trialRef",ref:p,"hide-benefit":"","hide-popup-button":"",title:"选择保障方案",class:"proposal-trial","product-info":{productCode:e.productCode},"tenant-product-detail":{}},{default:a((({trialData:e,riskPremium:o})=>[i("div",ae,[d(n,{type:"primary",onClick:t=>((...e)=>{c("finish",m(e[0],e[1]))})(e,o)},{default:a((()=>[l("确定")])),_:2},1032,["onClick"])])])),_:1},8,["product-info"])}}}),[["__scopeId","data-v-c80f0794"]]);const de={class:"com-risk-list-wrapper"},le=(e=>(j("data-v-7d3c3028"),e=e(),_(),e))((()=>i("div",{class:"popup-title"},"选择附加险",-1))),ue={class:"risk-list"},ce={class:"cell-title"},ne={class:"title"},pe={class:"footer-button"};var me=e(o({__name:"index",props:{riskList:{default:()=>[]},show:{type:Boolean,default:!1},collocationList:{default:()=>[]},disabled:{default:()=>[]},modelValue:{default:()=>[]}},emits:["finished","close","update:modelValue"],setup(e,{emit:o}){const j=e,_=t([]),V=t([]),g=t([...j.disabled]),O=c({show:j.show,currentChecked:[...j.modelValue]}),x=e=>{var o,t,r;if(g.value.includes(e))return;((e,o)=>{if(!j.collocationList.length)return o?void(O.currentChecked=[]):void O.currentChecked.push(e);let t=O.currentChecked,r=g.value;o?(j.collocationList.forEach((o=>{e===o.riskId&&(2===o.collocationType?t=t.filter((t=>t!==o.collocationRiskId||t!==e)):3===o.collocationType?(t=t.filter((o=>o!==e)),r=r.filter((e=>e!==o.collocationRiskId))):t=t.filter((o=>o!==e)))})),O.currentChecked=t,g.value=r):(j.collocationList.forEach((s=>{e===s.riskId&&(o||(2===s.collocationType?t.push(s.collocationRiskId):3===s.collocationType&&r.push(s.collocationRiskId),t.push(e)))})),O.currentChecked.push(...t),g.value=r)})(e,O.currentChecked.includes(e)),null==(r=null==(t=null==(o=null==_?void 0:_.value)?void 0:o[e])?void 0:t.toggle)||r.call(t)},D=()=>{o("close")},w=()=>{const e=j.riskList.filter((e=>O.currentChecked.includes(e.id)));o("update:modelValue",[...new Set(V.value)]),o("finished",e,g.value),o("close")};return n((()=>{_.value=[]})),p((()=>O.currentChecked),(e=>{V.value=e}),{deep:!0,immediate:!0}),p((()=>j.modelValue),(e=>{V.value=e||[],g.value.push(...e||[])}),{deep:!0,immediate:!0}),(o,t)=>{const c=P,n=L,p=I,j=R,T=u,N=y;return r(),m("div",de,[d(N,{show:v(O).show,"onUpdate:show":t[1]||(t[1]=e=>v(O).show=e),title:"选择附加险","show-footer":"",round:"",position:"bottom",closeable:"",onClose:D},{default:a((()=>[le,i("div",ue,[d(j,{modelValue:v(V),"onUpdate:modelValue":t[0]||(t[0]=e=>f(V)?V.value=e:null)},{default:a((()=>[d(p,{inset:""},{default:a((()=>[(r(!0),m(k,null,C(e.riskList,(e=>(r(),s(n,{key:e.id,title:e.riskName,disabled:v(g).includes(e.id),onClick:o=>x(e.id)},{"right-icon":a((()=>[d(c,{ref_for:!0,ref:o=>v(_)[e.id]=o,shape:"square",disabled:v(g).includes(e.id),name:e.id,onClick:h((o=>x(e.id)),["stop"])},null,8,["disabled","name","onClick"])])),title:a((()=>[i("div",ce,[i("div",ne,b(e.riskName),1)])])),_:2},1032,["title","disabled","onClick"])))),128))])),_:1})])),_:1},8,["modelValue"])]),i("div",pe,[d(T,{type:"primary",disabled:!v(O).currentChecked.length,block:"",onClick:w},{default:a((()=>[l("确认")])),_:1},8,["disabled"])])])),_:1},8,["show"])])}}}),[["__scopeId","data-v-7d3c3028"]]);const ve=e=>(j("data-v-1ac35b39"),e=e(),_(),e),fe={class:"com-product-list-wrapper"},ke={class:"risk-item-wrapper"},Ce={class:"content"},he={class:"risk-premium"},be={class:"premium"},Pe={class:"risk-factor"},Le={class:"factor"},Ie={class:"factor-value"},Re=ve((()=>i("span",{class:"factor-name"}," 保额(元) ",-1))),ye={class:"factor"},je={class:"factor-value"},_e=ve((()=>i("span",{class:"factor-name"}," 保障期间 ",-1))),Ve={class:"factor"},ge={class:"factor-value"},Oe=ve((()=>i("span",{class:"factor-name"}," 缴费期间 ",-1))),xe={class:"operate-bar"},De=ve((()=>i("span",{class:"btn-plus"},"+",-1))),we={key:0,class:"premium-total"},Te={class:"premium"},Ne=o({name:"ProductList"});var Ee=e(o({...Ne,props:{productRiskList:{default:()=>[]},productInfo:{default:()=>({})},productData:{default:()=>({})},pickProductPremium:{type:Function,default:()=>{}},productNum:{default:0}},emits:["deleteRisk","updateRisk","addRiderRisk"],setup(e,{emit:o}){const u=e,[c,n]=V(),f=t({checkedList:[],disabledList:[],riderRiskList:[],mainRiskData:{},totalPremium:0,currentRiskRecord:{},productRiskList:[]}),h=se("RISK_PAYMENT_PERIOD"),P=se("RISK_INSURANCE_PERIOD"),L=g((()=>{var e,o;return(null==(o=null==(e=u.productData)?void 0:e.productRiskVoList)?void 0:o[0].riskDetailVOList.filter((e=>1===e.collocationType)))||[]})),I=g((()=>{var e,o;const t=u.productRiskList.map((e=>e.riskId)),r=((null==(o=null==(e=u.productData)?void 0:e.productRiskVoList)?void 0:o[0].riskDetailVOList)||[]).filter((e=>t.includes(e.id)&&1===e.collocationType));return L.value.length-r.length})),R=g((()=>e=>{var o,t;const r=(null==(t=null==(o=u.productData)?void 0:o.productRiskVoList)?void 0:t[0].riskDetailVOList.find((o=>o.id!==e)))||{};let s=!1;return s=!!u.productNum||2===r.riskType&&1===r.collocationType,s})),y=g((()=>{var e,o;return(null==(o=null==(e=u.productData)?void 0:e.productRiskVoList)?void 0:o[0].riskDetailVOList.find((e=>1===e.riskType)))||{}})),j=g((()=>y.value.collocationVOList||[])),_=(e,t)=>{const r=e.map((e=>e.id)).filter((e=>!f.value.disabledList.includes(e)));o("addRiderRisk",r,u.productInfo)};return p((()=>u.productInfo),(e=>{var o;let t=0;(e.proposalProductRiskList||[]).forEach((e=>{t+=e.premium})),null==(o=u.pickProductPremium)||o.call(u,{[`${e.productId}`]:t}),f.value.totalPremium=t}),{deep:!0,immediate:!0}),p((()=>u.productRiskList),(e=>{const o=[],t=[],r=[];(e||[]).forEach((e=>{1===e.riskType?o.unshift(e):(t.push(e.riskId),r.push(e.riskId),o.push(e))})),f.value.disabledList=t,f.value.checkedList=r,f.value.productRiskList=o}),{deep:!0,immediate:!0}),(e,t)=>{var p,y;const V=D,g=w;return r(),m("div",fe,[(r(!0),m(k,null,C(v(f).productRiskList,(e=>{var t,c;return r(),m("div",{key:e.riskId},[i("div",ke,[d(V,{"risk-type":e.riskType,title:e.riskName,class:"no-border"},null,8,["risk-type","title"]),i("div",Ce,[i("div",he,[l(" 保费:"),i("span",be,"￥"+b(null==(t=e.premium)?void 0:t.toLocaleString()),1)]),i("div",Pe,[i("div",Le,[i("span",Ie,b(null==(c=e.amount)?void 0:c.toLocaleString()),1),Re]),i("div",ye,[i("span",je,b(v(O)(v(P),e.coveragePeriod)),1),_e]),i("div",Ve,[i("span",ge,b(v(O)(v(h),e.chargePeriod)),1),Oe])]),i("div",xe,[v(R)(e.riskId)?(r(),s(g,{key:0,round:32,class:"border",onClick:t=>{o("deleteRisk",e,u.productInfo)}},{default:a((()=>[l("删除")])),_:2},1032,["onClick"])):x("",!0),v(I)?(r(),s(g,{key:1,activated:"",round:32,class:"btn-rider-risk",onClick:o=>{return t=e,n(!0),void(f.value.currentRiskRecord=t);var t}},{default:a((()=>[De,l(" 附加险")])),_:2},1032,["onClick"])):x("",!0),d(g,{activated:"",round:32,onClick:t=>{o("updateRisk",e,u.productInfo)}},{default:a((()=>[l("修改")])),_:2},1032,["onClick"])])])])])})),128)),v(f).productRiskList.length>1?(r(),m("div",we,[l(" 保费: "),i("span",Te,"￥"+b(null==(y=null==(p=v(f))?void 0:p.totalPremium)?void 0:y.toLocaleString()),1)])):x("",!0),v(c)?(r(),s(me,{key:1,modelValue:v(f).checkedList,"onUpdate:modelValue":t[0]||(t[0]=e=>v(f).checkedList=e),show:v(c),disabled:v(f).disabledList,"risk-list":v(L),"collocation-list":v(j),onFinished:_,onClose:t[1]||(t[1]=e=>v(n)(!1))},null,8,["modelValue","show","disabled","risk-list","collocation-list"])):x("",!0)])}}}),[["__scopeId","data-v-1ac35b39"]]);const qe={class:"container"},Se={class:"operate-bar"},Ue={class:"footer-bar"},He={class:"trial-result"},Fe={class:"result-num"},Ae={class:"trial-operate"},Ke=o({name:"CreateProposal"});var Be=e(o({...Ke,setup(e){const o=[{name:"保存修改"},{name:"另存为新计划书"}],[n,h]=V(),[P,L]=V(),I=t({proposalHolder:{},proposalInsuredList:[{name:"",gender:"",birthday:"",proposalInsuredProductList:[]}],proposalName:"",totalPremium:0,relationUserType:2}),R=T(),y=N(),j=Z(),{id:_,productCode:O,type:x="add",isCreateProposal:D}=y.query,re=t(null),se=t({productCode:0,productCollection:{},productInfo:{},productPremium:{},riderRisk:{},type:"add",currentRisk:[]}),ae=c({selectedProductCodeList:[],insuredPersonVO:{},proposalName:"",currentProductCode:"",proposalHolder:{},proposalInsuredProductList:[],productCollection:{}}),de=t(null),le=t(null),ue=g((()=>ae.proposalInsuredProductList.map((e=>e.productCode)).filter((e=>Boolean(e))))),ce=()=>{var e,o;Promise.all([null==(e=de.value)?void 0:e.validate(),null==(o=le.value)?void 0:o.validate()]).then((()=>{const{proposalHolder:e}=ae;ee({proposalHolder:e,proposalInsuredList:[{...ae.insuredPersonVO,proposalInsuredProductList:ae.proposalInsuredProductList}],proposalName:ae.proposalName,totalPremium:0,relationUserType:2}).then((e=>{const{code:o,data:t}=e||{};"10000"===o&&(j.$reset(),j.proposalId=t,R.push({path:"/compositionProposal",query:{id:t}}))}))}))},ne=()=>{ce()},pe=(e,o)=>{o&&(I.value.id=null),ce()},me=g((()=>{var e;return(null==(e=ae.productCollection)?void 0:e[ae.currentProductCode])||{}})),ve=g((()=>{var e,o;return(null==(o=null==(e=me.value)?void 0:e.productPlanInsureVOList)?void 0:o[0])||{}})),fe=(e={})=>{Object.assign(se.value.productPremium,e),I.value.totalPremium=Object.values(se.value.productPremium).reduce(((e,o)=>e+o),0)},ke=(e,o)=>{const t=o;F.confirm({message:"确认删除该险种？"}).then((()=>{1===e.riskType?(ae.proposalInsuredProductList=ae.proposalInsuredProductList.filter((e=>e.productCode!==t.productCode)),fe({[t.productCode]:0})):t.proposalProductRiskList=t.proposalProductRiskList.filter((o=>o.riskId!==e.riskId))}))},Ce=(e,o)=>{se.value.productCode=o.productCode,se.value.productInfo=o,se.value.type="edit",se.value.currentRisk=[e.riskId],ae.currentProductCode=o.productCode,A((()=>{var e;null==(e=re.value)||e.open()}))},he=(e,o)=>{se.value.productCode=o.productCode,se.value.productInfo=o,se.value.type="addRiderRisk",se.value.currentRisk=e,h(!0)},be=e=>{var o;const t=ae.proposalInsuredProductList.findIndex((o=>o.productCode===e.productCode));ae.proposalInsuredProductList[t]=e.insuredProductInfo,null==(o=re.value)||o.close()},Pe=()=>{j.setProposalInfo(I.value),j.setTrialData([]),se.value.productCollection.length&&j.setExcludeProduct(se.value.productCollection.map((e=>e.productCode)));const{gender:e,birthday:o}=ae.insuredPersonVO;R.push({path:"/proposalList",query:{isCreateProposal:"1",productCode:O,productCodeList:ue.value,gender:e,birthday:o}})},Le=async(e,o=!1)=>{if(!q(e))return;const{code:t,data:r}=await oe({calcProductFactorList:e.map((e=>({productCode:e}))),...o?{}:ae.insuredPersonVO});"10000"===t&&r&&q(r)&&r.forEach((e=>{const{holder:t,insuredVOList:r,productCode:s}=e,{personVO:a,productPlanVOList:i}=(r||[])[0]||{},d={productCode:s,proposalProductRiskList:i};if(o)Object.assign(ae.insuredPersonVO,a),Object.assign(ae.proposalHolder,t),ae.proposalInsuredProductList=[d],te(l=e).then((({code:e,data:o})=>{var t;if(e===B&&o){(null==o?void 0:o.errorInfo)&&$(`${null==o?void 0:o.errorInfo}`);const e={};q(o.riskPremiumDetailVOList)&&(o.riskPremiumDetailVOList.forEach((o=>{e[o.riskCode]={premium:o.premium,amount:o.amount}})),be(null==(t=re.value)?void 0:t.formatData(l,e)))}}));else{const e=ue.value.findIndex((e=>e===s));ae.proposalInsuredProductList[e]=d}var l}))};E((()=>{O&&Le([O],!0)}));return p((()=>ae.selectedProductCodeList),Y((e=>{if(console.log("选择的产品变动了",e),q(e)){const o=e.map((e=>({productCode:e,proposalProductRiskList:[]})));ae.proposalInsuredProductList.push(...o),Le(e)}})),{deep:!0}),p((()=>ae.selectedProductCodeList),(()=>{var e,o;if(q(ue.value)){const t=Object.keys(ae.productCollection),r=null==(e=ue.value)?void 0:e.filter((e=>!t.includes(e)));q(r)&&(o=null==r?void 0:r.map((e=>({productCode:e}))),X(o).then((({code:e,data:o})=>{"10000"===e&&q(o)&&Object.assign(ae.productCollection,o.reduce(((e,o)=>(e[o.productCode]=o,e)),{}))})).finally((()=>{})))}}),{deep:!0,immediate:!0}),S((()=>{const{query:{selectProduct:e}}=N();ae.selectedProductCodeList=q(e)?e:"string"==typeof e&&e?[e]:[]})),(e,t)=>{const c=Q,n=K,p=w,h=u,R=z,y=U("ProPageWrap");return r(),s(y,{class:"page-create-wrapper"},{default:a((()=>{var e,u;return[i("div",qe,[d(c,{ref_key:"formRef",ref:de,class:"mb20",model:v(ae)},{default:a((()=>[d(v(G),{label:"计划书名称",name:"proposalName",maxlength:20,required:""})])),_:1},8,["model"]),d(v(J),{ref_key:"insuredFormRef",ref:le,title:"被保人信息",model:v(ae).insuredPersonVO},{default:a((()=>[d(v(G),{label:"姓名",name:"name",maxlength:20,required:""}),d(v(M),{label:"出生日期",name:"birthday",required:""}),d(v(W),{label:"性别",name:"gender",columns:v(H),required:""},null,8,["columns"])])),_:1},8,["model"]),(r(!0),m(k,null,C(v(ae).proposalInsuredProductList,(e=>(r(),s(n,{key:e.productCode,"show-line":!1},{default:a((()=>{var o;return[d(Ee,{"product-risk-list":e.proposalProductRiskList,"product-info":e,"product-num":(null==(o=v(ae).proposalInsuredProductList)?void 0:o.length)-1,"product-data":v(se).productCollection[e.productCode],"pick-product-premium":fe,onAddRiderRisk:he,onUpdateRisk:Ce,onDeleteRisk:ke},null,8,["product-risk-list","product-info","product-num","product-data"])]})),_:2},1024)))),128)),i("div",Se,[d(p,{activated:"",round:34,onClick:Pe},{default:a((()=>[l("添加主险")])),_:1})])]),i("div",Ue,[i("span",He,[l("总保费"),i("span",Fe,"￥"+b(null==(u=null==(e=v(I))?void 0:e.totalPremium)?void 0:u.toLocaleString()),1)]),i("div",Ae,[d(h,{type:"primary",onClick:ne},{default:a((()=>[l("保存并预览")])),_:1})])]),d(R,{show:v(P),"onUpdate:show":t[0]||(t[0]=e=>f(P)?P.value=e:null),actions:o,"cancel-text":"取消","close-on-click-action":"",onCancel:t[1]||(t[1]=e=>v(L)(!1)),onSelect:pe},null,8,["show"]),d(ie,{ref_key:"trialPopupRef",ref:re,"data-source":v(ve),"product-code":v(ae).currentProductCode,onFinish:be},null,8,["data-source","product-code"])]})),_:1})}}}),[["__scopeId","data-v-7e39fba1"]]);export{Be as default};
