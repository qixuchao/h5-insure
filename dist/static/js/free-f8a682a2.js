import{_ as e,d as t,aY as r,r as n,z as a,a7 as o,c as i,g as l,i as d,l as s,t as c,e as u,a8 as p,aZ as f,u as m,a as v,x as A,y as w,a_ as h,a$ as I,b as O,w as y,f as b,j as D,h as P,F as C,b0 as V,T as g,b1 as x,$ as j}from"./index-6a34609b.js";import{p as k,g as F}from"./product-5a7197ac.js";import{i as L,t as T}from"./trial-2be178ef.js";import{a as _,s as E,c as N}from"./phoneVerify-122b2dd5.js";import{u as H,B,P as Y}from"./index-c93fb87a.js";import{n as U}from"./nextStep-6ca1c012.js";import{j as M}from"./trial-1f83dd78.js";import{v as R,f as S}from"./utils-a24353e4.js";import{u as z}from"./theme-40e4e415.js";import $ from"./index-527e43f8.js";import Z from"./index-fb11bc79.js";import"./pdfdist-5d72820d.js";import"./core-9c1e25e6.js";import"./index-1e43e8a7.js";import"./useStorage-da385c53.js";import"./infoCollection-a2cc3706.js";import"./relativeTime-db269b7c.js";import"./validator-5a13dc82.js";import"./useDicData-c8a3ea4e.js";var G="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFYAAAAeCAMAAACBgxnEAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAA8UExURUdwTPpkAPpkAPpkAPlkAPlkAP9fAPpkAP9jAPljAPljAPlkAPdhAP9VAPhlAPpjAPpiAPpkAPlhAPpkAKrbDd8AAAATdFJOUwCe3XX6YBgzC+yKwSIDTrE+0C9Hm6hZAAAAf0lEQVR42u2MSw6AIAxEi6CCf+j976ommvG3omxMOqv2vczQmZa3tPRMptdZndVZndXZf892/JGOxN68qUEr24/zk84jSvne93fae3Qk3scrjZeWzDcVaNUQIvRDOGkYQOU+hYMmsBJ+cTt1C0gZP7mNTvhL+Zq5xlfOW4tb6le9ZDBDk4RvXwAAAABJRU5ErkJggg==";const J={class:"free-crad"},Q={class:"container"},X={class:"title"},q=["src"],K=["src"];var W=e(t({props:{colors:{type:Array,default:()=>["#CDDFFE","#F1F7FE"]},detail:{type:Object,default:()=>{}},isFirst:{type:Boolean,default:!0},insureDetail:{type:Object,default:()=>{}},previewMode:{type:Boolean,default:!1}},setup(e,{expose:t}){const f=e;r((e=>({"7c399bd7":f.colors[0],"7c399bf6":f.colors[1]})));const m=n(),v=a({factorObj:{1:[{attributeValues:null,code:"mobile",datasource:null,defaultValue:null,displayType:null,factorId:null,factorScript:null,hasDefaultValue:1,id:8249,isDisplay:1,isHidden:1,isMustInput:1,isReadOnly:null,moduleType:1,placeholder:null,planCode:null,position:null,productCode:"lin23323",productId:null,title:"手机号"},{attributeValues:null,code:"verificationCode",datasource:null,defaultValue:null,displayType:null,factorId:null,factorScript:null,hasDefaultValue:1,id:8249,isDisplay:1,isHidden:1,isMustInput:1,isReadOnly:null,moduleType:1,placeholder:null,planCode:null,position:null,productCode:"lin23323",productId:null,title:"验证码"}],2:[],3:[]},isFirst:!0}),A=async({mobile:e,type:t},r)=>{var n;if(m.value){if(f.previewMode)return void(null==r||r());null==(n=m.value)||n.validateForm(`${t}_mobile`).then((async()=>{const t=f.isFirst?_:E,n=await t(e),{code:a,data:o}=n;"10000"===a&&(null==r||r())}))}};return o((()=>f.isFirst),(()=>{var e;f.isFirst||(v.factorObj=null==(e=f.insureDetail)?void 0:e.productFactor)})),t({validateForm:()=>new Promise(((e,t)=>{m.value.validateForm().then((t=>{e(!0)})).catch((()=>{t()}))}))}),(t,r)=>(i(),l("div",J,[d("div",Q,[d("div",X,[d("img",{src:s(G)},null,8,q),d("span",null,c(e.isFirst?"凭手机号 免费领取":"最后一步 填写信息"),1),d("img",{src:s(G)},null,8,K)]),(i(),u(Z,{ref_key:"formRef",ref:m,key:e.isFirst?1:2,"send-sms-code":A,"need-desensitize":"","form-info":e.detail,"factor-object":s(v).factorObj},null,8,["form-info","factor-object"])),p(t.$slots,"default",{},void 0,!0)])]))}}),[["__scopeId","data-v-6cc132c6"]]);const ee={class:"page-free-product-detail"},te={class:"product-desc"},re={key:1,class:"page-free-footer"};var ne=e(t({setup(e){r((e=>({"349b61b4":s(ue).colors[1]})));const t=f((()=>V((()=>import("./index-aee6af64.js")),["static/js/index-aee6af64.js","static/css/index-607986ff.css","static/js/index-6a34609b.js","static/css/index-76f73643.css","static/js/pdfdist-5d72820d.js"]))),c=f((()=>V((()=>import("./index-914dfe20.js")),["static/js/index-914dfe20.js","static/css/index-b9ba3011.css","static/js/index-6a34609b.js","static/css/index-76f73643.css","static/js/pdfdist-5d72820d.js"]))),p=f((()=>V((()=>import("./index-dcdf8e1c.js")),["static/js/index-dcdf8e1c.js","static/css/index-ea588f10.css","static/js/index-6a34609b.js","static/css/index-76f73643.css","static/js/pdfdist-5d72820d.js","static/js/theme-40e4e415.js","static/js/index-527e43f8.js","static/css/index-2dbcd337.css","static/js/utils-a24353e4.js","static/js/infoCollection-a2cc3706.js","static/js/useStorage-da385c53.js","static/js/trial-1f83dd78.js"]))),_=z(),E=m(),Z=v(),{productCode:G="",agencyCode:J="",tenantId:Q="",saleUserId:X="",saleChannelId:q="",extraInfo:K,preview:ne}=Z.query;let ae={};try{ae=JSON.parse(decodeURIComponent(K))}catch(ye){}const{openId:oe,indirectCode:ie="",agentCode:le}=ae,de=n(),se=n(),ce=n(),ue=a({colors:["#fff"],detail:{},order:{tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},insuredBeneficiaryType:"1",tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}]}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}},relationList:{},banner:"",productDesc:[],newAuth:!0,isValidateCode:!1,insureDetail:{},loading:!0,isSelfInsure:!0,showBtn:!1,activeIndex:0,showFilePreview:!1,isOnlyView:!0}),pe=n();oe&&H({openId:oe},(e=>{ue.relationList=e}));const fe=A((()=>!!ne)),me=()=>{var e,t,r;const n=ue.insureDetail.productRiskVoList||[];return 1===((null==(r=null==(t=null==(e=null==n?void 0:n[0])?void 0:e.riskDetailVOList)?void 0:t[0])?void 0:r.insuranceStartType)||1)?`${j(new Date).format("YYYY-MM-DD")} 00:00:00`:`${j(new Date).add(1,"day").format("YYYY-MM-DD")} 00:00:00`},ve=()=>{var e,t;const r=ue.insureDetail.productRiskVoList||[],{insuranceEndType:n,riskInsureLimitVO:a}=(null==(t=null==(e=null==r?void 0:r[0])?void 0:e.riskDetailVOList)?void 0:t[0])||{},{insurancePeriodValueList:o}=a||{},[i,l]=((null==o?void 0:o[0])||"").split("_");return 1===n?`${j(new Date).add(l||0,i).format("YYYY-MM-DD")} 23:59:59`:n?`${j(new Date).add(l,i).format("YYYY-MM-DD")} 00:00:00`:""},Ae=async()=>{ue.loading=!0;const e=k({productCode:G,withInsureInfo:!0,tenantId:Q}),t=L({productCode:G}),r=F({openId:oe});await Promise.all([e,t,r]).then((([e,t,r])=>{var n,a,o,i,l;if("10000"===e.code){ue.detail=e.data,ue.banner=null==(n=ue.detail.tenantProductInsureVO)?void 0:n.banner[0];const{colorEnd:t,colorStart:r}=(null==(a=ue.detail.tenantProductInsureVO)?void 0:a.backgroundInsureVO)||{};ue.colors=[r,t],ue.productDesc=ue.detail.tenantProductInsureVO.spec||[],document.title=(null==(i=null==(o=ue.detail)?void 0:o.tenantProductInsureVO)?void 0:i.productName)||""}if("10000"===t.code&&(ue.insureDetail=t.data,ue.insureDetail.productFactor[1].forEach((e=>{"verificationCode"===e.code&&1===e.isDisplay&&(ue.isValidateCode=!0)})),ue.insureDetail.productFactor[2]=null==(l=ue.insureDetail.productFactor)?void 0:l[2].map((e=>{var t,r;return"relationToHolder"===e.code&&1===e.isDisplay&&(e.title="被保人",ue.order.tenantOrderInsuredList[0].relationToHolder=(null==(r=null==(t=e.attributeValueList)?void 0:t[0])?void 0:r.code)||""),e}))),"10000"===r.code&&(ue.newAuth=!r.data,ue.isSelfInsure=!!r.data,r.data)){const e=r.data;ue.order.tenantOrderHolder={certNo:null==e?void 0:e.certiNo,extInfo:{},mobile:null==e?void 0:e.mobile,name:null==e?void 0:e.name}}(()=>{var e;let t={};if(t=(null==(e=ue.detail.tenantProductInsureVO.planInsureVO)?void 0:e.attachmentVOList)||[],!t)return void(pe.value=[]);const r={2:"richText",3:"link"};pe.value=Object.keys(t).map((e=>(t[e].forEach((e=>{if("1"===e.attachmentType){const t=e.attachmentUri.split("?"),r=t[0].substr(t[0].lastIndexOf(".")+1);e.attachmentType="pdf"===r?"pdf":"picture"}else e.attachmentType=r[e.attachmentType]})),{attachmentName:e,attachmentList:t[e]})))||[]})(),ue.loading=!1}))},we=async()=>{let e={loginType:"2",openId:oe,thirdUserType:"XINAO_WECHAT",indirectCode:ie};try{if(ue.newAuth?(e.loginName=ue.order.tenantOrderHolder.mobile,e.password=ue.order.tenantOrderHolder.verificationCode):e=S({order:ue.order,tenantId:Q,extraInfo:ae,commencementTime:me(),expiryDate:ve(),detail:ue.detail,insureDetail:ue.insureDetail,iseeBizNo:de.value,agentCode:le,agencyCode:J,saleUserId:X,templateId:null==ae?void 0:ae.templateId,saleChannelId:q,pageCode:"infoCollection",buttonCode:"EVENT_FREE_multiIssuePolicy"}),ue.newAuth)if(fe.value)ue.newAuth=!1;else{const{code:t,data:r}=await T(e);"10000"===t&&(ue.newAuth=!1)}else U(e,((e,t)=>{t===x.JUMP_PAGE&&e.orderNo&&E.push(`/baseInsurance/orderDetail?from=free&tenantId=${Q}&orderNo=${e.orderNo}&productCode=${G}`)}))}catch(t){}},he=async()=>await(async()=>{var e;if(fe.value)return!0;await ce.value.validateForm();const t=null==(e=ue.order.tenantOrderHolder)?void 0:e.verificationCode;if((ue.isValidateCode||ue.newAuth)&&(!t||!R(t)))return g({message:"请输入正确的验证码"}),!1;if(ue.newAuth||!ue.isValidateCode)return!0;const{code:r,data:n}=await N(ue.order.tenantOrderHolder.mobile,t);return!!n})()?(ue.newAuth||0===pe.value.length?we():(ue.isOnlyView=!1,ue.showFilePreview=!0),!1):null,Ie=()=>{ue.showFilePreview=!1,ue.isOnlyView=!0},Oe=()=>{ue.showFilePreview=!1,ue.isOnlyView=!0,we()};return w((()=>{Ae(),setTimeout((async()=>{de.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),o((()=>ue.order.tenantOrderInsuredList[0]),(e=>{if(h(ue.relationList)||ue.newAuth)return null;const t=ue.relationList[e.relationToHolder]||[];return 1===t.length&&(M.SELF!==e.relationToHolder?(ue.order.tenantOrderInsuredList[0].certNo=ue.order.tenantOrderInsuredList[0].certNo?ue.order.tenantOrderInsuredList[0].certNo:t[0].cert[0].certNo,ue.order.tenantOrderInsuredList[0].name=ue.order.tenantOrderInsuredList[0].name?ue.order.tenantOrderInsuredList[0].name:t[0].cert[0].certName,ue.order.tenantOrderInsuredList[0].mobile=ue.order.tenantOrderInsuredList[0].mobile?ue.order.tenantOrderInsuredList[0].mobile:t[0].contact[0].contactNo):ue.isSelfInsure&&(ue.isSelfInsure=!1,ue.order.tenantOrderHolder.certNo=ue.order.tenantOrderHolder.certNo?ue.order.tenantOrderHolder.certNo:t[0].cert[0].certNo,ue.order.tenantOrderHolder.name=ue.order.tenantOrderHolder.name?ue.order.tenantOrderHolder.name:t[0].cert[0].certName,ue.order.tenantOrderHolder.mobile=ue.order.tenantOrderHolder.mobile?ue.order.tenantOrderHolder.mobile:t[0].contact[0].contactNo)),!1}),{immediate:!0,deep:!0}),I(se,(([{isIntersecting:e}],t)=>{ue.showBtn=!e})),(e,r)=>{const n=O("van-image"),a=O("van-config-provider");return i(),u(a,{"theme-vars":s(_)},{default:y((()=>{var e,a,o,f;return[d("div",ee,[b(B,{url:s(ue).banner},null,8,["url"]),b(W,{ref_key:"formRef",ref:ce,"is-first":s(ue).newAuth,"insure-detail":s(ue).insureDetail,detail:s(ue).order,colors:s(ue).colors,"preview-mode":s(fe)},{default:y((()=>[b($,{ref_key:"root",ref:se,class:"submit-btn",disabled:!s(ue).newAuth&&s(fe),"is-gradient":!1,text:s(ue).newAuth?"立即领取":"激活保障",onClick:he},null,8,["disabled","text"]),!s(ue).newAuth&&pe.value&&pe.value.length>0?(i(),u(s(c),{key:0,"attachement-list":pe.value,"has-bg-color":!1,"pre-text":"请阅读",onPreviewFile:r[0]||(r[0]=e=>(e=>{ue.isOnlyView=!0,ue.activeIndex=e,ue.showFilePreview=!0})(e))},null,8,["attachement-list"])):D("",!0)])),_:1},8,["is-first","insure-detail","detail","colors","preview-mode"]),d("div",te,[(i(!0),l(C,null,P(s(ue).productDesc,((e,t)=>(i(),u(n,{key:t,width:"100%","lazy-load":"",src:e,class:""},null,8,["src"])))),128))]),(null==(a=null==(e=s(ue).detail)?void 0:e.tenantProductInsureVO)?void 0:a.inscribedContent)?(i(),u(s(t),{key:0,"inscribed-content":null==(f=null==(o=s(ue).detail)?void 0:o.tenantProductInsureVO)?void 0:f.inscribedContent},null,8,["inscribed-content"])):D("",!0),s(ue).showBtn?(i(),l("footer",re,[b($,{disabled:!s(ue).newAuth&&s(fe),"is-gradient":!1,text:s(ue).newAuth?"立即领取":"激活保障",onClick:he},null,8,["disabled","text"])])):D("",!0)]),s(ue).showFilePreview&&0!==pe.value.length?(i(),u(s(p),{key:0,show:s(ue).showFilePreview,"onUpdate:show":r[1]||(r[1]=e=>s(ue).showFilePreview=e),"content-list":pe.value,"is-only-view":s(ue).isOnlyView,"active-index":s(ue).activeIndex,text:s(ue).isOnlyView?"关闭":"我已逐页阅读上述内容并同意","force-read-cound":0,"on-close-file-preview":"",onSubmit:Oe,onOnCloseFilePreview:Ie},null,8,["show","content-list","is-only-view","active-index","text"])):D("",!0),s(ue).loading?D("",!0):(i(),u(Y,{key:1,"product-detail":s(ue).detail},null,8,["product-detail"]))]})),_:1},8,["theme-vars"])}}}),[["__scopeId","data-v-76f49958"]]);export{ne as default};
