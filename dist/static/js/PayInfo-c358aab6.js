import{d as e,r as a,az as n,z as t,bH as i,L as r,R as m,ay as s,c as o,A as l,V as d,e as c,g as p,U as u}from"./index-f3eddd66.js";import{d as f}from"./debounce-eed12388.js";import{c as y,l as E}from"./ProRenderFormWithCard.vue_vue_type_style_index_0_scoped_true_lang-95547acf.js";/* empty css              */import{P as T,B as R,a as h}from"./bankCard-a10900e4.js";import{P as v}from"./index-94700b75.js";const _=e({__name:"PayInfo",props:{schema:{default:()=>[]},config:{default:()=>[]},modelValue:{default:()=>[]},isView:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{expose:_,emit:S}){const I=e,M={BANK_PAY:"1",ALI_PAY:"2",WECHAT_PAY:"3"},g=a(null);a();const L=["cardType","bankCard","paymentType"],D=[{title:"首期支付",schema:[],payInfoType:T.FIRST_TERM,formData:{paymentType:"1",paymentMethod:"1",cardType:R.DEBIT},config:{cardType:{isView:!0}}},{title:"续期支付",schema:[],payInfoType:T.RENEW_TERM,formData:{paymentType:"1",paymentMethod:"1",paymentGenre:String(h.FIRST_SAME),cardType:R.DEBIT},config:{cardType:{isView:!0}}},{title:"年金领取银行卡",schema:[],payInfoType:T.REPRISE,formData:{paymentGenre:String(h.FIRST_SAME)},config:{}}].map((e=>({...e,nanoid:n()}))),P=[["initialPaymentMethod","initialCardType","initialBankCard","initialPaymentType"],["renewalPaymentGenre","renewalPaymentMethod","renewalCardType","renewalBankCard","renewalPaymentType","premiumOverdue"],["annuityPaymentGenre","annuityBankCard"]],A=t({schemaList:i(D)}),F=r((()=>["FIRST_TERM","RENEW_TERM","REPRISE"].reduce(((e,a)=>{const n=(t=a,A.schemaList.findIndex((e=>String(e.payInfoType)===String(T[t]))));var t;return n>-1&&(e[a]=n),e}),{}))),w=(e,a)=>{var n,t;return e>-1&&(null==(t=null==(n=A.schemaList[e])?void 0:n.formData)?void 0:t.paymentGenre)===`${h[a]}`},W=e=>{if("string"!=typeof e||!e)return"";const[a,n]=e.match(/^(?:initial|renewal|annuity)(.*)$/)||[];return n?E(n):e},N=(e,a)=>{var n;const{formData:t}=A.schemaList[a]||{};Object.assign(null==(n=A.schemaList[e])?void 0:n.formData,t)},b=e=>e&&L.includes(e);return m((()=>A.schemaList.map((e=>{var a;return null==(a=null==e?void 0:e.formData)?void 0:a.paymentMethod}))),(()=>{y("支付方式变动"),A.schemaList.forEach(((e,a)=>{const{formData:t,schema:i}=e||{},r=[M.ALI_PAY,M.WECHAT_PAY].includes(String(null==t?void 0:t.paymentMethod)),m=(null==t?void 0:t.paymentGenre)===String(h.FIRST_SAME);i.forEach((e=>{e.hidden=(m||r)&&b(e.name)})),e.nanoid=n()}))}),{deep:!0,immediate:!0}),m((()=>{var e;return null==(e=A.schemaList[F.value.FIRST_TERM])?void 0:e.formData}),f((e=>{const{REPRISE:a,RENEW_TERM:n}=F.value;y("首期数据变动"),w(n,"FIRST_SAME")&&N(n,F.value.FIRST_TERM),w(a,"FIRST_SAME")&&N(a,n)}),500),{deep:!0}),m((()=>{var e;return null==(e=A.schemaList[F.value.RENEW_TERM])?void 0:e.formData}),f((e=>{y("续期数据变动");const{REPRISE:a,RENEW_TERM:n}=F.value;w(a,"RENEW_SAME")&&N(a,n)}),500),{deep:!0}),m((()=>{var e,a;return null==(a=null==(e=A.schemaList[F.value.RENEW_TERM])?void 0:e.formData)?void 0:a.paymentGenre}),(e=>{y("续期支付类型变动");const{FIRST_TERM:a,RENEW_TERM:n}=F.value,t=e===String(h.FIRST_SAME),{schema:i}=A.schemaList[n]||{};t?N(n,a):A.schemaList[n].formData={...D[n].formData,paymentGenre:e},s(i)&&i.forEach((e=>{e.hidden=b(e.name)}))})),m((()=>{var e,a;return null==(a=null==(e=A.schemaList[F.value.REPRISE])?void 0:e.formData)?void 0:a.paymentGenre}),(e=>{const{FIRST_TERM:a,RENEW_TERM:n,REPRISE:t}=F.value;if(y("年金支付类型变动"),[h.FIRST_SAME,h.RENEW_SAME].includes(Number(e))){const i=e===String(h.FIRST_SAME)?a:n;N(t,i)}else A.schemaList[t]&&(A.schemaList[t].formData={...D[t].formData,paymentGenre:e})}),{immediate:!0}),m([()=>I.schema,()=>I.config],(()=>{let e=[];A.schemaList=I.schema.reduce(((a,n)=>{const t=P.findIndex((e=>e.includes(n.name)));return"paymentDrawType"===n.name&&(e=n.columns.map((e=>e.code))),t>-1&&a[t].schema.push({...n,name:W(n.name),payInfoType:D[t].payInfoType}),a}),i(D)).map(((e,a)=>({...e,config:{...e.config,...I.config[a]||{}},nanoid:n()}))).filter((({schema:a,...n})=>e.includes(`${n.payInfoType}`)))}),{deep:!0,immediate:!0}),m((()=>I.modelValue),(e=>{s(e)&&A.schemaList.forEach(((a,n)=>{Object.assign(a.formData,e[n])}))}),{deep:!0,immediate:!0}),m((()=>{var e;return null==(e=A.schemaList)?void 0:e.map((e=>e.formData))}),(e=>{s(e)&&S("update:modelValue",e.map(((e,a)=>{const{payInfoType:n}=A.schemaList[a];return{...e,payInfoType:n}})))}),{deep:!0,immediate:!0}),_({validate:e=>{var a;return Promise.all(null==(a=g.value)?void 0:a.map((e=>e.validate())))}}),(a,n)=>(o(!0),l(u,null,d(p(A).schemaList,(a=>(o(),c(p(v),{ref_for:!0,ref_key:"payInfoFormRef",ref:g,key:a.nanoid,schema:a.schema,model:a.formData,config:a.config,title:a.title,"is-view":e.isView},null,8,["schema","model","config","title","is-view"])))),128))}});export{_};
