var aa=Object.defineProperty,ta=Object.defineProperties;var ra=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var oa=Object.prototype.hasOwnProperty,ua=Object.prototype.propertyIsEnumerable;var de=(E,c,f)=>c in E?aa(E,c,{enumerable:!0,configurable:!0,writable:!0,value:f}):E[c]=f,b=(E,c)=>{for(var f in c||(c={}))oa.call(c,f)&&de(E,f,c[f]);if(ce)for(var f of ce(c))ua.call(c,f)&&de(E,f,c[f]);return E},H=(E,c)=>ta(E,ra(c));import{g as na,a9 as sa,O as la,E as h,M as me,y as fe,_ as pe,l as ia,h as ca,r as he,af as da,j as M,n as ve,p as D,m as z,H as ma,t as G,z as O,A as m,J as V,C as Pe,k as Fe,F as fa,T as g,D as pa,X as ha}from"./vendor-ec22d003.js";import{_ as va,C as ye,a1 as Fa,I as ya,J as Ee,a4 as De}from"./index-4afe2047.js";import{a as J}from"./order-358926ec.js";import{S as q,R as I,f as ge,I as Ea}from"./infoCollection-a800960d.js";import{p as Ce,i as Da,s as ga,g as Ca,u as Na,a as Ia}from"./trial-52c8c779.js";import{p as Ba}from"./product-1b6fe993.js";import{a as Ne,o as Ie,t as wa,v as j,g as Be,b as _a,j as we}from"./utils-932482f9.js";import{t as Aa}from"./theme-ea709837.js";import{d as _e,B as Pa,D as Ta,G as ka,S as Sa,H as ba,P as Ha,U as Oa,_ as Ua,W as La,a as Ae}from"./auth-a38e7b5f.js";import{_ as xa}from"./index-b8ae6995.js";import"./trial-b41d4678.js";import"./index-d95fbb55.js";import"./bankCard-549417d9.js";import"./phoneVerify-da541fbf.js";const Ra={key:0},Ma={class:"page-internet-product-detail"},Va={class:"info"},qa={class:"footer-button"},Ya={class:"price"},$a=Pe(" \u603B\u4FDD\u8D39"),Ka=na({setup(E){const c=sa(),f=la(),{productCode:X="BWYL2021",tenantId:F,orderNo:_,phoneNo:Te,agentCode:U="",saleChannelId:ke,paymentMethod:Se,certNo:Q,name:Z,pageCode:be,from:He}=f.query,L=h(),d=h(),x=h(),v=h(),Y=be==="payBack",A=h(!1),P=h(!1),B=h(!1),ee=h(0),$=h(!1),K=h(!1),R=h({show:!1,html:""});let W="";const e=me({holder:{certNo:Q,certType:ye.CERT,mobile:Te,name:Z,socialFlag:q.HAS},insured:{certNo:Q,certType:ye.CERT,name:Z,socialFlag:q.HAS,relationToHolder:I.SELF},paymentMethod:Se,renewalDK:"Y",paymentFrequency:ge.YEAR,packageProductList:[],mobileSmsCode:""}),ae=h(_e),T=h(_e),s=me({showInsure:!Y,canInsure:!1,canUpgrade:!1}),Oe=fe(()=>{var a,t;return((t=(a=d.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(r=>r.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),Ue=fe(()=>{var a,t;return((t=(a=d.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(r=>r.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),Le=()=>{if(e.holder.certNo){const a=Ee(e.holder.certNo);if(j(e.holder.certNo,18,"year"))return g("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E18\u5C81\uFF01"),!1;if(e.insured.certNo&&e.insured.relationToHolder===I.MATE){const t=Ee(e.insured.certNo);if(a===t)return g("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(e.insured.certNo){if(e.insured.relationToHolder===I.CHILD&&j(e.insured.certNo,30,"day"))return g("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(e.insured.relationToHolder===I.PARENT&&!j(e.insured.certNo,70,"year"))return g("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E70\u5C81\uFF01"),!1}if([I.CHILD,I.PARENT].includes(e.insured.relationToHolder)){const a=Be(e.holder.certNo,"year"),t=Be(e.insured.certNo,"year");if(e.insured.relationToHolder===I.CHILD&&a-t<18)return g("\u6295\u4FDD\u4EBA\u548C\u5B50\u5973\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1;if(e.insured.relationToHolder===I.PARENT&&t-a<18)return g("\u6295\u4FDD\u4EBA\u548C\u7236\u6BCD\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1}return!0},xe=()=>{const{holder:{certNo:a,mobile:t,name:r,socialFlag:n},insured:{certNo:o,name:u,socialFlag:l,relationToHolder:p},paymentMethod:y}=e;return!!(ya(o)&&!!l)},te=()=>{c.push({path:"/internet/guaranteeUpgrade",query:H(b({},f.query),{tenantId:F,productCode:"BWYL2022",orderNo:_,agentCode:U})})},Re=()=>{K.value=!1},Me=()=>{T.value=ae.value},Ve=()=>{T.value=H(b({},T.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},qe=async a=>{g.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const t=await Na(a),{code:r}=t;if(r==="10000"){g.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const n=await Ia({orderNo:a.orderNo,tenantId:F}),{data:o}=n;n.code==="10000"&&(o.type===2?(R.value={show:!0,html:o.paymentUrl},console.log("data.paymentUrl",R.value),ha(()=>{console.log("document.forms",document.forms);const u=document.getElementById("cashierSubmit");u==null||u.addEventListener("submit",l=>{l.preventDefault()}),u==null||u.submit()})):window.location.href=o.paymentUrl)}s.canInsure=!0}catch{s.canInsure=!0}},Ye=a=>`${De}/pay?orderNo=${a}&saleUserId=${U}&tenantId=${F}`,$e=a=>`${De}/internet/payFail?tenantId=${F}&orderNo=${a}&agentCode=${U}&pageCode=payBack&from=${He||"normal"}`,Ke=async a=>{console.log("risk",a);const t=_a({tenantId:F,saleUserId:U,saleChannelId:ke,detail:d.value,insureDetail:x.value,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,renewalDK:e.renewalDK,iseeBizNo:W,successJumpUrl:"",premium:v.value,holder:e.holder,insured:e.insured,tenantOrderRiskList:a,orderStatus:"",orderTopStatus:""});try{const r=await ga(t),{code:n,data:o}=r;n==="10000"&&qe(H(b({},t),{orderNo:o.data,extInfo:{extraInfo:{renewalDK:e.renewalDK,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,successJumpUrl:Ye(o.data),failUrl:$e(o.data)},iseeBizNo:W}}))}catch{s.canInsure=!0}},We=async()=>{const{calcData:a,riskVOList:t}=Ne({holder:e.holder,insured:e.insured,tenantId:F,productDetail:d.value,insureDetail:x.value,paymentFrequency:e.paymentFrequency,packageRiskIdList:Ie(e.packageProductList)},!1,we);if(!Array.isArray(t)||t.length<1)return g("\u88AB\u4FDD\u4EBA\u5E74\u9F84\u9700\u572830\u5929(\u542B) - 70\u5C81(\u542B)\u4E4B\u95F4\uFF01"),v.value=null,{};const r=await Ce(a),{code:n,data:o}=r;return n==="10000"?(v.value=o.premium,{condition:t,data:o}):(v.value=null,{})},ze=a=>{ee.value=a,B.value=!0},Ge=()=>new Promise((a,t)=>{var r,n;(n=(r=L.value)==null?void 0:r.validateForm)==null||n.call(r).then(async()=>{if(!Le()){s.canInsure=!0;return}if(!A.value){A.value=!1,B.value=!0,ze(0);return}const{calcData:u,riskVOList:l}=Ne({holder:e.holder,insured:e.insured,tenantId:F,productDetail:d.value,insureDetail:x.value,paymentFrequency:e.paymentFrequency,packageRiskIdList:Ie(e.packageProductList)},!1,we);(!Array.isArray(l)||l.length<1)&&(g("\u88AB\u4FDD\u4EBA\u5E74\u9F84\u9700\u572830\u5929(\u542B) - 70\u5C81(\u542B)\u4E4B\u95F4\uFF01"),v.value=null,t(new Error));const p=await Ce(u),{code:y,data:C}=p;y==="10000"?(v.value=C.premium,a({condition:l,data:C})):(v.value=null,t(new Error))}).catch(()=>{s.canInsure=!0})}),re=async()=>{var a;if(Y){te();return}s.canInsure=!1;try{const{condition:t,data:r}=await Ge(),n={},o=(l=[])=>{(l||[]).forEach(p=>{var y;n[p.riskCode]=p,((y=p.riskPremiumDetailVOList)==null?void 0:y.length)&&o(p.riskPremiumDetailVOList)})};o(r.riskPremiumDetailVOList);const u=wa({tenantId:F,riskList:t,riskPremium:n,productId:(a=d.value)==null?void 0:a.id});Ke(u)}catch{s.canInsure=!0}},Je=a=>{a==="allFalse"?(P.value=!1,A.value=!0,re(),s.canInsure=!0):pa.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"}).then(()=>{window.history.back()}).catch(()=>{var t;(t=L.value)==null||t.reEditForm(),A.value=!1,s.canInsure=!0})},oe=()=>{var a;(a=L.value)==null||a.reEditForm(),A.value=!1,s.canInsure=!0},je=()=>{console.log("onCloseHealthPopup========"),P.value=!1,oe()},Xe=()=>{console.log("onCloseFilePreview========"),B.value=!1,oe()},Qe=()=>{B.value=!1,P.value=!0};pe([()=>e.insured.certNo,()=>e.insured.socialFlag,()=>e.packageProductList,()=>e.paymentFrequency],ia.exports.debounce(()=>{e.insured.certNo&&e.insured.socialFlag&&xe()&&We()},500),{deep:!0,immediate:!0}),pe(()=>e.insured.certNo,()=>{e.insured.certNo||(v.value=null)});const ue=async()=>{var n,o,u,l,p,y,C,k,S,ne,se,le,ie;const a=await Ca({orderNo:_,tenantId:F}),{code:t,data:r}=a;if(t==="10000"){const{tenantOrderHolder:N,tenantOrderInsuredList:i,extInfo:w}=r;if(!Y){Object.assign(e,{holder:{certNo:N.certNo,certType:N.certType,mobile:N.mobile,name:N.name,socialFlag:q.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(n=i[0])==null?void 0:n.certType,name:(o=i[0])==null?void 0:o.name,socialFlag:(l=(u=i[0])==null?void 0:u.extInfo)==null?void 0:l.hasSocialInsurance,relationToHolder:(p=i[0])==null?void 0:p.relationToHolder},paymentMethod:w.extraInfo.paymentMethod,paymentFrequency:w.extraInfo.paymentFrequency,renewalDK:w.extraInfo.renewalDK||"N"}),s.canInsure=!0;return}Object.assign(e,{holder:{certNo:N.certNo,certType:N.certType,mobile:N.mobile,name:N.name,socialFlag:q.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(y=i[0])==null?void 0:y.certType,name:(C=i[0])==null?void 0:C.name,socialFlag:(S=(k=i[0])==null?void 0:k.extInfo)==null?void 0:S.hasSocialInsurance,relationToHolder:(ne=i[0])==null?void 0:ne.relationToHolder},paymentMethod:w.extraInfo.paymentMethod,paymentFrequency:w.extraInfo.paymentFrequency,renewalDK:w.extraInfo.renewalDK||"N"}),v.value=(ie=(le=(se=i[0])==null?void 0:se.tenantOrderProductList)==null?void 0:le[0])==null?void 0:ie.premium,(r.orderStatus===J.ACCEPT_POLICY||r.orderStatus===J.PAYMENT_SUCCESS)&&(s.canUpgrade=!0,$.value=!1,K.value=!0),r.orderStatus===J.PAYING&&($.value=!0,setTimeout(()=>{ue()},3*1e3))}},Ze=async()=>{const a=Ba({productCode:X,withInsureInfo:!0,tenantId:F}),t=Da({productCode:X});await Promise.all([a,t]).then(([r,n])=>{var o,u;r.code==="10000"&&(d.value=r.data,document.title=((o=r.data)==null?void 0:o.productFullName)||""),n.code==="10000"&&(e.packageProductList=(((u=n.data)==null?void 0:u.packageProductVOList)||[]).map(l=>H(b({},l),{value:Ea.UN_INSURE,disabled:!1})),x.value=n.data)}),_&&ue()},ea=()=>{console.log("\u6295\u4FDD\u94FE\u63A5"),T.value=Ae,ae.value=Ae,s.canInsure=!0};return ca(()=>{ea(),Ze(),setTimeout(async()=>{W=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(a,t)=>{const r=he("van-button"),n=he("van-config-provider"),o=da("dompurify-html");return M(),ve(fa,null,[D(n,{"theme-vars":m(Aa)},{default:z(()=>{var u,l,p,y,C,k,S;return[R.value.show?ma((M(),ve("div",Ra,null,512)),[[o,R.value.html]]):G("",!0),O("div",Ma,[O("div",Va,[D(Pa,{url:(l=(u=d.value)==null?void 0:u.tenantProductInsureVO)==null?void 0:l.banner[0]},null,8,["url"]),D(Ta,{"product-name":(p=d.value)==null?void 0:p.productFullName,"product-desc":(C=(y=d.value)==null?void 0:y.showConfigVO)==null?void 0:C.desc},null,8,["product-name","product-desc"])]),D(ka,{"show-service-config":"","guarantee-list":(S=(k=d.value)==null?void 0:k.tenantProductInsureVO)==null?void 0:S.titleAndDescVOS},null,8,["guarantee-list"]),D(Sa,{detail:d.value},{form:z(()=>[D(ba,{ref_key:"formRef",ref:L,"is-show-package":"",disable:!m(s).showInsure,"form-auth":T.value,"form-info":m(e),"product-detail":d.value,onOnReset:Me,onOnUpdate:Ve},null,8,["disable","form-auth","form-info","product-detail"])]),_:1},8,["detail"]),O("div",qa,[O("div",Ya,[$a,O("span",null,V(v.value?"\uFFE5":"")+V(m(Fa)(v.value))+" "+V(v.value?m(e).paymentFrequency==m(ge).YEAR?"\u5143/\u5E74":"\u5143/\u6708":""),1)]),D(r,{type:"primary",class:"right",disabled:!(m(s).canInsure||m(s).canUpgrade),onClick:re},{default:z(()=>[Pe(V(m(s).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),m(_)?G("",!0):(M(),Fe(Ha,{key:1,"product-detail":d.value},null,8,["product-detail"])),D(Oa,{"order-no":m(_),"tenant-id":m(F),"is-show":K.value,onOnConfirm:te,onOnClose:Re},null,8,["order-no","tenant-id","is-show"])]}),_:1},8,["theme-vars"]),D(Ua,{show:P.value,"onUpdate:show":t[0]||(t[0]=u=>P.value=u),"content-list":m(Oe),"active-index":0,onOnConfirmHealth:Je,onOnCloseHealth:je},null,8,["show","content-list"]),B.value?(M(),Fe(xa,{key:0,show:B.value,"onUpdate:show":t[1]||(t[1]=u=>B.value=u),"content-list":m(Ue),"active-index":ee.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9","force-read-cound":2,"on-close-file-preview":"",onSubmit:Qe,onOnCloseFilePreview:Xe},null,8,["show","content-list","active-index"])):G("",!0),D(La,{"is-show":$.value},null,8,["is-show"])],64)}}});var st=va(Ka,[["__scopeId","data-v-6dcfd742"]]);export{st as default};
