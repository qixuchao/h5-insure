import{j as e,d as o,t,r as s,o as a,c as l,a as r,b as d,u as c,e as i,F as n,s as u,g as p,_ as v,I as m,k as f,a8 as h,l as g,dv as C,aG as y,n as k,f as P,p as L,w as b,dw as I,q as _,v as w,cp as x,aO as S,ar as V,cs as j,aC as M,aD as N,E as O,d3 as T,az as U,bK as $,aA as q,h as F,i as R,de as A,cb as z,m as B,A as D,x as E,bL as G,T as J,z as K,br as W}from"./index-225c5e66.js";import{P as H}from"./index-1f56d95a.js";import{L as Q}from"./index-bafbbe19.js";import{T as X,a as Y}from"./index-33e468a7.js";import{P as Z,u as ee}from"./ProductTips-b1ed8dca.js";import{q as oe,a as te}from"./proposalList-bafeb950.js";import{P as se}from"./index-887f345f.js";import{C as ae}from"./index-ec0c4c8e.js";import{q as le}from"./trial-771df848.js";import{g as re}from"./third-4763114c.js";import{s as de}from"./util-b5542ffb.js";const ce={class:"com-product-item"},ie={class:"content-wrap"},ne={class:"product-image"},ue={class:"product-info"},pe={class:"title"},ve={class:"description"},me={class:"tags"};var fe=v(o({__name:"productItem",props:{productInfo:{default:()=>({})},errorMsg:{default:""}},setup(e){const o=e,{productInfo:v}=t(o),f=s({checked:!1});return t(f),(e,o)=>{var t,s,f,h,g;const C=m;return a(),l("div",ce,[r("div",ie,[r("div",ne,[d(C,{src:(null==(t=c(v).showConfig)?void 0:t.fileThumbnailUrl)||(null==(s=c(v).showConfig)?void 0:s.fileUrl)},null,8,["src"])]),r("div",ue,[r("p",pe,i(null==(f=c(v).showConfig)?void 0:f.title),1),r("p",ve,i(null==(h=c(v).showConfig)?void 0:h.text),1),r("p",me,[(a(!0),l(n,null,u(null==(g=c(v).showConfig)?void 0:g.tags,((e,o)=>(a(),l("span",{key:o,class:"tag"},i(e),1)))),128))])]),p(e.$slots,"checkedProduct",{},void 0,!0)]),d(Z,{"error-msg":e.errorMsg},null,8,["error-msg"])])}}}),[["__scopeId","data-v-002f53ee"]]);const he=["xlink:href"],ge=o({__name:"index",props:{name:{type:String,required:!0},color:{type:String,default:""}},setup(e){const o=e,t=f((()=>`#icon-${o.name}`)),s=f((()=>o.name?`svg-icon icon-${o.name}`:"svg-icon"));return(o,d)=>(a(),l("svg",h({class:c(s)},o.$attrs,{style:{color:e.color}}),[r("use",{"xlink:href":c(t)},null,8,he)],16))}});const Ce=e=>(M("data-v-88e3365a"),e=e(),N(),e),ye={class:"com-tab-filter"},ke={class:"article-mid"},Pe={class:"article-tag"},Le=["onClick"],be=Ce((()=>r("span",null,null,-1))),Ie={class:"popup-inner"},_e=Ce((()=>r("div",{class:"popup-title"},"保险公司",-1))),we={class:"footer-button"};var xe=v(o({__name:"insureFilter",props:{tagList:{type:Array,default:()=>[]},filter:{type:Boolean,default:!1},popupStyle:{type:Object,default:()=>{}}},emits:["onSelectInsure"],setup(o,{emit:p}){const v=o,{isPopShow:m,openPop:f,closePop:h}=function(o=!1){const t=e(o);return{isPopShow:t,openPop:e=>{e instanceof Function&&e(),t.value=!0},closePop:e=>{t.value=!1,e instanceof Function&&e()}}}(!1),M=s({insureList:[],checkedInsure:[],productCategoryList:[]}),{insureList:N,checkedInsure:O}=t(M),T=e(""),U=()=>{O.value=[]},$=()=>{var e;const{productCategoryId:o}=(null==(e=M.productCategoryList)?void 0:e[T.value])||{};p("onSelectInsure",{selectInsureCode:O.value,selectCategory:o}),h()};g((()=>{v.filter&&C().then((e=>{const{code:o,data:t}=e;"10000"===o&&(N.value=null==t?void 0:t.map((e=>({label:e.abbreviation,value:e.insurerCode}))))}))})),y((()=>{oe().then((e=>{const{code:o,data:t}=e||{};"10000"===o&&S(t)&&(M.productCategoryList=[{productCategoryName:"全部",productCategoryId:""},...t])}))}));const q=e();return g((()=>{q.value=document.querySelector(".page-proposal")})),(e,t)=>{const s=V,v=j;return a(),l("div",ye,[r("div",ke,[r("div",Pe,[(a(!0),l(n,null,u(c(M).productCategoryList,((e,o)=>(a(),l("div",{key:o,class:k(["tag-item",{checked:c(T)==o}]),onClick:t=>((e,o)=>{var t;T.value=o;const{productCategoryId:s}=(null==(t=M.productCategoryList)?void 0:t[T.value])||{};p("onSelectInsure",{selectInsureCode:O.value,selectCategory:s})})(null==e||e.productCategoryId,o)},[r("div",{class:k(["tag-out",{checked:c(T)==o}])},[r("div",{class:k(["tag-item-text",{checked:c(T)==o}])},i(e.productCategoryName),3)],2)],10,Le)))),128))]),o.filter?(a(),l("div",{key:0,class:"filter",onClick:t[0]||(t[0]=(...e)=>c(f)&&c(f)(...e))},[be,r("div",{class:k(["text",{"has-select-condition":c(O).length>0}])},"筛选",2),d(ge,{name:"filter"})])):P("",!0),c(q)?(a(),L(v,{key:1,show:c(m),position:"right","close-on-click-overlay":"",class:"proposal-list-filter-popup-wrap",style:x(o.popupStyle),onClickOverlay:c(h)},{default:b((()=>[r("div",Ie,[_e,d(I,{modelValue:c(O),"onUpdate:modelValue":t[1]||(t[1]=e=>_(O)?O.value=e:null),options:c(N)},null,8,["modelValue","options"])]),r("div",we,[d(s,{plain:"",type:"primary",onClick:U},{default:b((()=>[w("重置")])),_:1}),d(s,{type:"primary",onClick:$},{default:b((()=>[w("确定")])),_:1})])])),_:1},8,["show","style","onClickOverlay"])):P("",!0)])])}}}),[["__scopeId","data-v-88e3365a"]]);const Se={class:"com-trial-product-wrapper"},Ve={class:"container"},je=(e=>(M("data-v-49f70a68"),e=e(),N(),e))((()=>r("span",{class:"title"}," 已选产品 ",-1))),Me={class:"popup-body"},Ne={class:"cell-title"},Oe={class:"title"},Te=o({name:"TrialProductPopup"});var Ue=v(o({...Te,props:{isShow:{type:Boolean,default:!1},proposalList:{default:()=>[]},modalValue:{default:()=>[]}},emits:["close","update:modalValue","checked"],setup(o,{emit:t}){const s=o,p=e([]),v=e([]),m=e({isShow:s.isShow}),f=()=>{t("close")},h=()=>{v.value=[],t("checked",[])},g=e=>{var o,s,a;null==(a=null==(s=null==(o=null==p?void 0:p.value)?void 0:o[e])?void 0:s.toggle)||a.call(s),t("checked",v.value)};return O((()=>s.isShow),(e=>{m.value.isShow=e})),O(v,((e=[])=>{t("update:modalValue",e)}),{deep:!0,immediate:!0}),O((()=>s.modalValue),((e=[])=>{v.value=e}),{deep:!0,immediate:!0}),(e,o)=>{const t=U,s=$,C=ae,y=q,k=j;return a(),l("div",Se,[d(k,{show:c(m).isShow,"onUpdate:show":o[1]||(o[1]=e=>c(m).isShow=e),position:"bottom",onClose:f},{default:b((()=>[r("div",Ve,[r("div",{class:"popup-header"},[r("span",{class:"clear-all",onClick:h}," 清空选项 "),je,r("span",{class:"close",onClick:f})]),r("div",Me,[d(y,{modelValue:c(v),"onUpdate:modelValue":o[0]||(o[0]=e=>_(v)?v.value=e:null)},{default:b((()=>[d(C,{inset:""},{default:b((()=>[(a(!0),l(n,null,u(e.proposalList,(e=>(a(),L(s,{key:e.productCode,title:e.productName,onClick:o=>g(e.productCode)},{"right-icon":b((()=>{var o;return[d(t,{ref_for:!0,ref:o=>c(p)[e.productCode]=o,shape:"square","model-value":null==(o=c(v))?void 0:o.includes(e.productCode),name:e.productCode,onClick:T((o=>g(e.productCode)),["stop"])},null,8,["model-value","name","onClick"])]})),title:b((()=>[r("div",Ne,[r("div",Oe,i(e.productName),1)])])),_:2},1032,["title","onClick"])))),128))])),_:1})])),_:1},8,["modelValue"])])])])),_:1},8,["show"])])}}}),[["__scopeId","data-v-49f70a68"]]);const $e={class:"page-proposal-list"},qe={class:"check-button"},Fe={key:1,class:"van-sticky"},Re={class:"add-plan"},Ae={class:"has-select-product"},ze=(e=>(M("data-v-788fdbd0"),e=e(),N(),e))((()=>r("span",{class:"icon"},null,-1))),Be=o({name:"ProposalList"});var De=v(o({...Be,props:{isCreateProposal:{type:Boolean,default:!0}},setup(o){const p=ee(),v=F(),m=R(),{isCreateProposal:h,productClass:C,customer:k}=m.query,I=A(),x=s({searchValue:"",tagLists:[],isOpen:!0,loading:!1,finished:!1,refreshing:!1,productList:[],selectProduct:[],insurerCodeList:[],showCategory:"",productTotal:0,checked:"",productCode:void 0,proposalList:[],showFooter:!0,productName:"",productCodeList:[],errorMsgMap:{},excludeProductCodeList:[],isCreateProposal:!1,selectedProductList:[],excludeMainRiskCode:[],firstLoading:!0,insuredList:[]}),{searchValue:S,tagLists:j,isOpen:M,loading:N,finished:O,refreshing:T,productList:$,selectProduct:q,insurerCodeList:Z,showCategory:oe,productTotal:ae,showFooter:ce}=t(x);z();const[ie,ne]=z(),ue=e(+(C||1));let pe=null;try{const e=JSON.parse(decodeURIComponent(k)),{idNo:o,idType:t,sex:s,name:a,...l}=e;pe={...l,certNo:o,certType:t,customerName:a,customerType:1,gender:s,source:2}}catch(_e){console.log(_e)}const ve=f((()=>{var e;if(k&&(null==(e=x.insuredList)?void 0:e.length))return x.insuredList;const o=p.$state.insuredPersonVO||{};return Object.keys(o).length?[o]:[]})),me=()=>{var e;if(k&&!(null==(e=x.insuredList)?void 0:e.length))return;const{excludeProductCodeList:o}=x;x.firstLoading&&J.loading("加载中..."),te({productName:S.value,insurerCodeList:Z.value,productClass:ue.value,showCategory:oe.value,selectProductCodes:Array.isArray(o)?o:[],selectRiskCodes:x.excludeMainRiskCode||[],insuredList:ve.value,holder:p.$state.holder,pageNum:1,pageSize:999}).then((e=>{const{code:o,data:t,total:s}=e;"10000"===o&&($.value=t,ae.value=s)})).finally((()=>{J.clear(),x.firstLoading=!1}))},he=e=>{me()},ge=e=>{const{selectInsureCode:o,selectCategory:t}=e;Z.value=o,oe.value=t,me()},Ce=()=>{T.value&&($.value=[],T.value=!1),me(),N.value=!1,ae.value===$.value.length&&(O.value=!0)},ye=()=>{v.push({path:"historyProposalList"})};f((()=>{var e;const{birthday:o,gender:t}=(null==(e=p.$state.proposalInfo.proposalInsuredList)?void 0:e[0])||{};return{birthday:o,gender:t}}));const ke=f((()=>$.value.length>0)),Pe=({productCode:e})=>h?(x.productCode=e,x.selectProduct.includes(e)?(x.selectProduct=x.selectProduct.filter((o=>o!==e)),!1):void(async(e,o)=>{const{code:t,data:s,message:a}=await le({...p.$state.insuredPersonVO,calcProductFactorList:[{productCode:e}]},{isCustomError:!0});"10000"===t?(x.errorMsgMap[e]="","function"==typeof o&&o(!0)):x.errorMsgMap[e]=a})(e,(()=>{x.selectProduct.push(e)}))):(v.push({path:"/proposal/createProposal",query:{productCode:e}}),!1),Le=e=>{x.selectProduct=e,x.selectedProductList=x.selectedProductList.filter((o=>e.includes(o.productCode)))},be=()=>{const e=x.proposalList.filter((e=>x.selectProduct.includes(e.proposalInsuredList[0].proposalInsuredProductList[0].productCode)));p.setTrialData(e),p.setSelectedProduct(x.selectProduct),p.setSelectedProductList(x.selectedProductList),v.back()},Ie=()=>{O.value=!0,N.value=!0,Ce()};return y((()=>{x.excludeProductCodeList=p.$state.excludeProduct,x.excludeMainRiskCode=p.$state.excludeMainRiskCode})),g((()=>{pe&&(()=>{const e=e=>(null==e?void 0:e.length)?e[0]:{};re(pe).then((o=>{const{code:t,data:s}=o;if("10000"===t&&s){const{bankCardInfo:o=[],addressInfo:t=[],contactInfo:a=[],certInfo:l=[],...r}=s||{},d=s;d.addressInfo=e(t),d.bankCardInfo=e(o),d.contactInfo=e(a),d.certInfo=e(l),x.insuredList=[d],de(d),me()}}))})()})),(e,o)=>{const t=X,s=Y,p=K,v=U,m=Q,f=H,g=V,y=B("ProPageWrap"),k=W;return a(),L(k,{"theme-vars":c(I)},{default:b((()=>[d(y,{class:"page-proposal"},{default:b((()=>[d(p,{modelValue:c(S),"onUpdate:modelValue":o[1]||(o[1]=e=>_(S)?S.value=e:null),placeholder:"请输入计划书名称",onSearch:he},{default:b((()=>[d(xe,{"filter-class":"filter-area",onOnSelectInsure:ge}),d(s,{modelValue:c(ue),"onUpdate:modelValue":o[0]||(o[0]=e=>_(ue)?ue.value=e:null),disabled:"","active-color":"var(--van-primary-color)","inactive-color":"black",fixed:!1,"before-change":()=>!c(C),onChange:me},{default:b((()=>[d(t,{name:1},{default:b((()=>[w("非组合计划书")])),_:1}),d(t,{name:4},{default:b((()=>[w("组合计划书")])),_:1})])),_:1},8,["modelValue","before-change"])])),_:1},8,["modelValue"]),c(ke)||c(x).firstLoading?P("",!0):(a(),L(D,{key:0,"empty-img":c(E),title:"没有找到相关内容~","empty-class":"empty-select"},null,8,["empty-img"])),r("div",$e,[d(f,{modelValue:c(T),"onUpdate:modelValue":o[3]||(o[3]=e=>_(T)?T.value=e:null),onRefresh:Ie},{default:b((()=>[d(m,{loading:c(N),"onUpdate:loading":o[2]||(o[2]=e=>_(N)?N.value=e:null),finished:c(O),"finished-text":c(ke)?"- 已经到底了哦 -":"",onLoad:Ce},{default:b((()=>[(a(!0),l(n,null,u(c($),(e=>(a(),L(fe,{key:e.id,"product-info":e,"error-msg":c(x).errorMsgMap[e.productCode],onClick:o=>Pe(e)},G({_:2},[c(h)?{name:"checkedProduct",fn:b((()=>[r("div",qe,[(a(),L(v,{key:e.id,name:e.productCode,"model-value":c(x).selectProduct.includes(e.productCode),shape:"square",onChange:o=>((e,o)=>{e?x.selectedProductList.push(o):x.selectedProductList=x.selectedProductList.filter((e=>e.productCode!==o.productCode))})(o,e)},null,8,["name","model-value","onChange"]))])])),key:"0"}:void 0]),1032,["product-info","error-msg","onClick"])))),128))])),_:1},8,["loading","finished","finished-text"])])),_:1},8,["modelValue"])]),c(h)&&c(ce)?(a(),l("div",Fe,[r("div",Re,[r("p",{class:"has-select",onClick:o[4]||(o[4]=e=>c(ne)(!c(ie)))},[w(" 已选"),r("span",Ae,i(c(x).selectProduct.length),1),w("款产品 "),ze]),d(g,{type:"primary",disabled:!c(x).selectProduct.length,onClick:be},{default:b((()=>[w("添加到计划书")])),_:1},8,["disabled"])])])):P("",!0),d(Ue,{"modal-value":c(x).selectProduct,"proposal-list":c(x).selectedProductList,"is-show":c(ie),onClose:o[5]||(o[5]=e=>c(ne)(!1)),onChecked:Le},null,8,["modal-value","proposal-list","is-show"])])),_:1}),c(h)?P("",!0):(a(),L(se,{key:0,"button-image":c("/static/png/lishijihuashu-b6958e78.png"),onClick:ye},null,8,["button-image"]))])),_:1},8,["theme-vars"])}}}),[["__scopeId","data-v-788fdbd0"]]);export{De as default};
