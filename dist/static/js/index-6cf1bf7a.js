import{n as e,o as n,m as a,p as t}from"./infoCollection-4bad8932.js";import{a0 as l,_ as i,d as r,r as o,z as u,ac as s,x as c,G as m,a4 as d,aq as f,as as p,b as v,c as y,h as I,f as D,w as V,j as g,g as P,k,t as O,e as C,X as b,n as Y,F as x,K as L,L as S,i as E,B as h,T as w}from"./index-e3df8bbc.js";import{l as _}from"./trial-8d531ce5.js";import{h as F,o as N}from"./utils-f00d4627.js";import"./pdfh5-008ca364.js";import"./useStorage-7696a628.js";const q=(e,n="YYYY-MM-DD")=>l(e).format(n),T=(e,n=0,a="day",t="YYYY-MM-DD")=>l(e).add(n,a).format(t),M=(e,n=0,a="day",t="YYYY-MM-DD")=>l(e).subtract(n,a).format(t);const U=e=>(L("data-v-49331618"),e=e(),S(),e),R={class:"com-period-cell"},$={key:0,class:"period-custom-cell period-check-btn-cell"},j=U((()=>g("div",{class:"period-cell-label"},"保障期间",-1))),A={class:"period-cell-content"},B=U((()=>g("div",{class:"period-cell-label"},"生效日期",-1))),G={class:"period-cell-content period-custom-cell-content"},H={key:2,class:"period-custom-cell period-common-cell"},X=U((()=>g("div",{class:"period-cell-label"},"保障期限",-1))),z={class:"period-cell-content"},K=U((()=>g("div",{class:"picker-custom-title"},"保险开始生效日期",-1)));var J=i(r({__name:"index",props:{formInfo:{type:Object,default:()=>{}},insureDetail:{type:Object,default:()=>{}}},emits:["onReset","onUpdate","onVerify"],setup(a,{expose:t,emit:l}){const i=a;o({});const r=(e,n)=>"year"===e?`${n}年`:"month"===e?`${n}月`:"day"===e?`${n}日`:n,L=o(new Date),S=u({formInfo:i.formInfo}),E=o(!0);s((()=>S.formInfo.insuranceStartDate),(e=>{e&&"string"==typeof e&&(L.value=new Date(e))}));const h=o(),w=o([]);s([()=>i.insureDetail,()=>S.formInfo.activePlanCode],(()=>{var e;if(S.formInfo.insuranceStartDate="",S.formInfo.insuranceEndDate="",S.formInfo.commencementTime="",i.insureDetail)if(i.insureDetail.productRelationPlanVOList&&i.insureDetail.productRelationPlanVOList.length>0){let n=0;const a=i.insureDetail.productRelationPlanVOList.findIndex((e=>e.planCode===S.formInfo.activePlanCode));a>-1&&(n=a);const t=((null==(e=i.insureDetail.productRelationPlanVOList[n])?void 0:e.productRiskVoList[0].riskDetailVOList)||[]).find((e=>1===e.riskType));t&&(h.value=t)}else{const e=(i.insureDetail.productRiskVoList[0].riskDetailVOList||[]).find((e=>1===e.riskType));e&&(h.value=e)}}),{deep:!0,immediate:!0}),s((()=>h.value),(()=>{var e,n;w.value=[],w.value=F((null==(n=null==(e=h.value)?void 0:e.riskInsureLimitVO)?void 0:n.insurancePeriodValueList)||[]),w.value.length>0?w.value.findIndex((e=>e.value===S.formInfo.insurancePeriodValue))<0&&(S.formInfo.insurancePeriodValue=w.value[0].value):S.formInfo.insurancePeriodValue=_.YEAR_1}),{deep:!0,immediate:!0});const N=c((()=>{var n,a;return(null==(n=h.value)?void 0:n.insuranceStartType)?String(null==(a=h.value)?void 0:a.insuranceStartType):e.CURRENT_DAY})),U=c((()=>{var e,a;return(null==(e=h.value)?void 0:e.insuranceEndType)?String(null==(a=h.value)?void 0:a.insuranceEndType):n.CURRENT_DAY})),[J,Q]=m(!1),W=()=>{E.value&&Q(!0)},Z=c((()=>{var n;if(N.value===e.CUSTOM_DAY){const e=null==(n=h.value)?void 0:n.riskInsureLimitVO.maxInsuranceDay;if(e&&e.indexOf(",")){const[n,a]=e.split(",");return new Date(T(new Date,Number(n),"day"))}}return new Date(T(new Date,1,"day"))})),ee=c((()=>{var n;if(N.value===e.CUSTOM_DAY){const e=null==(n=h.value)?void 0:n.riskInsureLimitVO.maxInsuranceDay;if(!e)return new Date;if(e.indexOf(",")){const[n,a]=e.split(",");return new Date(T(new Date,Number(a),"day"))}const a=T(new Date,Number(e),"day");return new Date(a)}return new Date})),ne=e=>{S.formInfo.insuranceStartDate=`${q(e)} 00:00:00`,Q(!1)},ae=()=>{Q(!1)};return s([()=>N.value,()=>S.formInfo.insurancePeriodValue,()=>S.formInfo.insuranceStartDate,()=>h.value],(()=>{var a;if(!S.formInfo.insurancePeriodValue)return;const[t,l]=S.formInfo.insurancePeriodValue.split("_");if(!S.formInfo.insuranceStartDate)if(N.value===e.CUSTOM_DAY){const e=null==(a=h.value)?void 0:a.riskInsureLimitVO.maxInsuranceDay;if(e)if(e.indexOf(",")){const[n,a]=e.split(",");S.formInfo.insuranceStartDate=`${T(new Date,Number(n),"day")} 00:00:00`,E.value=n!==a}else S.formInfo.insuranceStartDate=`${T(new Date,e,"day")} 00:00:00`;else S.formInfo.insuranceStartDate=`${T(new Date,1,"day")} 00:00:00`}else N.value===e.NEXT_DAY?S.formInfo.insuranceStartDate=`${T(new Date,1,"day")} 00:00:00`:S.formInfo.insuranceStartDate=`${q(new Date)} 00:00:00`;if("to"!==t){const e=`${M(S.formInfo.insuranceStartDate,1,"day")} 00:00:00`;U.value===n.CURRENT_DAY?S.formInfo.insuranceEndDate=`${T(e,Number(l),t)} 23:59:59`:S.formInfo.insuranceEndDate=`${T(S.formInfo.insuranceStartDate,Number(l),t)} 00:00:00`}else{let e=S.formInfo.tenantOrderInsuredList[0].birthday;S.formInfo.tenantOrderInsuredList[0].certType===d.CERT&&S.formInfo.tenantOrderInsuredList[0].certNo&&f(S.formInfo.tenantOrderInsuredList[0].certNo)&&(e=p(S.formInfo.tenantOrderInsuredList[0].certNo));const a=`${M(e,1,"day")} 00:00:00`;"single"===l&&(S.formInfo.insuranceEndDate="9999-99-99 23:59:59"),U.value===n.CURRENT_DAY?S.formInfo.insuranceEndDate=`${T(a,Number(l),t)} 23:59:59`:S.formInfo.insuranceEndDate=`${T(e,Number(l),t)} 00:00:00`}}),{immediate:!0}),t({}),(n,a)=>{const t=v("ProRadioButton"),l=v("ProSvg"),i=v("van-config-provider"),o=v("VanButton"),u=v("van-datetime-picker"),s=v("ProPopup");return y(),I(x,null,[D(i,null,{default:V((()=>[g("div",R,[P(w).length>1?(y(),I("div",$,[j,g("div",A,[D(t,{modelValue:P(S).formInfo.insurancePeriodValue,"onUpdate:modelValue":a[0]||(a[0]=e=>P(S).formInfo.insurancePeriodValue=e),options:P(w)},null,8,["modelValue","options"])])])):k("",!0),P(N)===P(e).CUSTOM_DAY?(y(),I("div",{key:1,class:"period-custom-cell period-common-cell",onClick:W},[B,g("div",G,[g("span",null,O(P(S).formInfo.insuranceStartDate?P(q)(P(S).formInfo.insuranceStartDate,"YYYY.MM.DD HH:mm:ss"):""),1),P(E)?(y(),C(l,{key:0,class:"custom--arrow-right",name:"arrow-right"})):k("",!0)])])):k("",!0),P(N)!==P(e).CUSTOM_DAY?(y(),I("div",H,[X,g("div",z,O(P(S).formInfo.insuranceStartDate?P(q)(P(S).formInfo.insuranceStartDate,"YYYY.MM.DD"):"")+"-"+O(P(S).formInfo.insuranceEndDate?P(q)(P(S).formInfo.insuranceEndDate,"YYYY.MM.DD"):""),1)])):k("",!0)])])),_:1}),D(s,{show:P(J),"onUpdate:show":a[3]||(a[3]=e=>b(J)?J.value=e:null),height:"340",closeable:!0},{default:V((()=>[D(u,{modelValue:P(L),"onUpdate:modelValue":a[2]||(a[2]=e=>b(L)?L.value=e:null),type:"date",title:"保险开始生效日期","min-date":P(Z),"max-date":P(ee),formatter:r,"visible-item-count":5,class:"custom-date-picker",onConfirm:ne,onCancel:ae},{cancel:V((()=>[])),title:V((()=>[K])),confirm:V((()=>[D(o,{type:"primary",round:"",block:"",class:"linear-btn custom-picker-btn",onClick:a[1]||(a[1]=e=>J.value=!1)},{default:V((()=>[Y("确 定")])),_:1})])),_:1},8,["modelValue","min-date","max-date"])])),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-49331618"]]);const Q=e=>(L("data-v-1defc39e"),e=e(),S(),e),W={class:"com-payment-type"},Z={class:"title"},ee={key:0,class:"picture-payment-content"},ne=["onClick"],ae=["src"],te=["src"],le={key:1,class:"custom-cell check-btn-cell"},ie=Q((()=>g("div",{class:"cell-label"},"保障方案",-1))),re={class:"cell-content"},oe={key:0,class:"picture-payment-content"},ue=["onClick"],se=["src"],ce=["src"],me={key:1,class:"custom-cell check-btn-cell"},de=Q((()=>g("div",{class:"cell-label"},"交费方式",-1))),fe={class:"cell-content"},pe={class:"custom-cell common-cell"},ve=Q((()=>g("div",{class:"cell-label"},"实付保费",-1))),ye={key:0,class:"cell-content actual-premium"},Ie={class:"cell-content actual-premium"},De={key:0,class:"actual-premium actual-premium-month-tip"},Ve={key:0,class:"feerate-explain"},ge={class:"content"},Pe=Q((()=>g("div",{class:"triangle-top"},null,-1)));var ke=i(r({__name:"index",props:{formInfo:{type:Object,default:()=>{}},insureDetail:{type:Object,default:()=>{}},configDetail:{type:Object,default:()=>{}},isMultiplePlan:{type:Boolean,default:!1},premiumInfo:{type:Object,default:()=>{}}},emits:["update-active-plan"],setup(e,{expose:n,emit:l}){const i=e;o({});const r=u({formInfo:i.formInfo}),m=o([]),d=o(),f=o(),p=c((()=>{var e;return"1"===String(null==(e=d.value)?void 0:e.paymentFrequencyFlag)}));c((()=>{var e;return null==(e=f.value)?void 0:e.productPremiumVOList.find((e=>e.paymentFrequency===r.formInfo.paymentFrequency))}));const b=c((()=>i.premiumInfo.premiumLoadingText?i.premiumInfo.premiumLoadingText:i.premiumInfo.premium?`${i.premiumInfo.premium||""}${i.premiumInfo.actualUnit||"元"}`:`${i.premiumInfo.minPremiun||""}${i.premiumInfo.unit||""}`)),Y=c((()=>{if(f){const{premiumExplain:e,premiumExplainViewName:n,premiumExplainUri:a}=f.value||{};return{premiumExplain:e,premiumExplainUri:a,premiumExplainViewName:n}}return null})),L=c((()=>Y.value&&Y.value.premiumExplain&&Y.value.premiumExplainViewName));s((()=>i.configDetail),(()=>{var e;i.isMultiplePlan&&i.configDetail&&(m.value=null==(e=i.configDetail.tenantProductInsureVO)?void 0:e.planList)}),{immediate:!0,deep:!0}),s([()=>i.configDetail,()=>i.isMultiplePlan,()=>r.formInfo.activePlanCode],(()=>{if(i.configDetail)if(i.isMultiplePlan){let e=0;const n=i.configDetail.tenantProductInsureVO.planList.findIndex((e=>e.planCode===r.formInfo.activePlanCode));n>-1&&(e=n),d.value=i.configDetail.tenantProductInsureVO.planList[e].productPlanInsureConditionVO,f.value=i.configDetail.tenantProductInsureVO.planList[e]}else d.value=i.configDetail.tenantProductInsureVO.planInsureVO.productPlanInsureConditionVO,f.value=i.configDetail.tenantProductInsureVO.planInsureVO}),{deep:!0,immediate:!0});const S=c((()=>{var e;if(d.value&&d.value.paymentFrequency){return((null==(e=d.value.paymentFrequency)?void 0:e.split(","))||[]).length>1}return!1}));s((()=>d.value),(()=>{var e;if(d.value){const n=(null==(e=d.value.paymentFrequency)?void 0:e.split(","))||[];if(1===n.length)return void(r.formInfo.paymentFrequency=d.value.paymentFrequency);if(2===n.length&&n.filter((e=>![a.SINGLE,a.MONTH].includes(e))).length<1)return void(r.formInfo.paymentFrequency||(r.formInfo.paymentFrequency=a.SINGLE));n.length>1&&!r.formInfo.paymentFrequency&&(r.formInfo.paymentFrequency=null==n?void 0:n[0])}}),{immediate:!0,deep:!0});const _=c((()=>{var e;return d.value?null==(e=d.value.paymentFrequencyList||[])?void 0:e.map((e=>({...e,paymentFrequency:e.skinValue}))):[]})),F=c((()=>_.value.length>0)),q=c((()=>i.isMultiplePlan?i.configDetail.tenantProductInsureVO.planList.map((e=>e.planPicList?{...e.planPicList,planCode:e.planCode,planName:e.planName}:null)).filter((e=>!!e)):[])),T=c((()=>{var e,n;if(d.value){const a=(null==(e=d.value.paymentFrequency)?void 0:e.split(","))||[];return 1===a.length&&(r.formInfo.paymentFrequency=a[0]),null==(n=a||[])?void 0:n.map((e=>({label:t[e],value:e})))}return[]})),M=e=>{r.formInfo.activePlanCode=e},U=()=>{var e,n;(null==(e=Y.value)?void 0:e.premiumExplainUri)?N({fileType:"pdf",fileUri:null==(n=Y.value)?void 0:n.premiumExplainUri}):w("无费率文件！")};return n({}),(n,a)=>{const t=v("ProRadioButton"),l=v("templat"),o=v("ProDivider"),u=v("van-config-provider");return y(),C(u,null,{default:V((()=>[g("div",W,[g("div",Z,O(P(S)?"交费方式":"保障计划"),1),e.isMultiplePlan?(y(),I(x,{key:0},[P(q).length>0?(y(),I("div",ee,[(y(!0),I(x,null,E(P(q),(e=>(y(),I("div",{key:e.planCode,class:h("picture-payment-item"),onClick:n=>M(e.planCode)},[P(r).formInfo.activePlanCode==e.planCode?(y(),I("img",{key:0,src:e.selectedPic},null,8,ae)):(y(),I("img",{key:1,src:e.unSelectedPic},null,8,te))],8,ne)))),128))])):(y(),I("div",le,[ie,g("div",re,[D(t,{modelValue:P(r).formInfo.activePlanCode,"onUpdate:modelValue":a[0]||(a[0]=e=>P(r).formInfo.activePlanCode=e),options:P(m),prop:{value:"planCode",label:"planName"},onChange:M},null,8,["modelValue","options"])])]))],64)):k("",!0),P(p)?(y(),C(l,{key:1},{default:V((()=>[P(F)&&P(_).length>1?(y(),I("div",oe,[(y(!0),I(x,null,E(P(_),(e=>(y(),I("div",{key:e.paymentFrequency,class:h("picture-payment-item"),onClick:n=>{return a=e.paymentFrequency,void(r.formInfo.paymentFrequency=a);var a}},[P(r).formInfo.paymentFrequency==e.paymentFrequency?(y(),I("img",{key:0,src:e.selectedPic},null,8,se)):(y(),I("img",{key:1,src:e.unSelectedPic},null,8,ce))],8,ue)))),128))])):P(T).length>1?(y(),I("div",me,[de,g("div",fe,[D(t,{modelValue:P(r).formInfo.paymentFrequency,"onUpdate:modelValue":a[1]||(a[1]=e=>P(r).formInfo.paymentFrequency=e),options:P(T)},null,8,["modelValue","options"])])])):k("",!0)])),_:1})):k("",!0),D(J,{"form-info":P(r).formInfo,"insure-detail":e.insureDetail,"config-detail":e.configDetail},null,8,["form-info","insure-detail","config-detail"]),P(b)&&P(L)?(y(),I(x,{key:2},[g("div",pe,[ve,i.premiumInfo.premiumLoadingText?(y(),I("div",ye,O(P(b)),1)):(y(),I(x,{key:1},[g("div",Ie,O(P(b)),1),"5"===P(r).formInfo.paymentFrequency?(y(),I("div",De," 共12期 ")):k("",!0)],64))]),P(L)?(y(),I("div",Ve,[g("div",ge,[Pe,g("div",null,[g("span",null,O(P(Y).premiumExplain||""),1),g("span",{class:"file-name",onClick:U},"《"+O(P(Y).premiumExplainViewName||"")+"》",1)])])])):k("",!0)],64)):k("",!0)]),D(o)])),_:1})}}}),[["__scopeId","data-v-1defc39e"]]);export{ke as default};
