var pe=Object.defineProperty,me=Object.defineProperties;var fe=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var K=(l,d,n)=>d in l?pe(l,d,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[d]=n,b=(l,d)=>{for(var n in d||(d={}))W.call(d,n)&&K(l,n,d[n]);if(F)for(var n of F(d))Q.call(d,n)&&K(l,n,d[n]);return l},A=(l,d)=>me(l,fe(d));var X=(l,d)=>{var n={};for(var g in l)W.call(l,g)&&d.indexOf(g)<0&&(n[g]=l[g]);if(l!=null&&F)for(var g of F(l))d.indexOf(g)<0&&Q.call(l,g)&&(n[g]=l[g]);return n};import{g as _e,a9 as ge,O as ke,E as v,M as ye,a6 as Pe,_ as Ce,o as ve,r as P,j as k,k as R,m as y,A as o,n as I,p as _,t as L,z as D,F as he,G as Ve,J as Ie,C as E}from"./vendor-06835924.js";import{P as Z,a as $}from"./index-96ef55ef.js";import{i as Le,p as De}from"./trial-103906b8.js";import{c as Oe}from"./createProposal-17f1dea0.js";import{_ as Re,n as Be,c as Te,E as Ne}from"./index-5a5c1a5a.js";import{u as Fe}from"./useStorage-a046844a.js";import{b as be,a as Ee}from"./trial-96964029.js";import"./useDicData-679f85ec.js";const Ae={key:0,class:"part-card"},xe={key:1,class:"part-card"},Se={class:"risk-content"},qe={key:0,class:"risk"},je={key:1,class:"plan-risk"},Me={class:"footer-bar van-safe-area-bottom"},Ue={class:"trial-result"},we=E("\u603B\u4FDD\u8D39"),Ye={class:"result-num"},Je={class:"trial-operate"},ze={key:0,class:"retrial-tip"},Ge=E(" \u6761\u4EF6\u66F4\u6539\u540E\uFF0C\u9700\u8981\u91CD\u65B0\u8BD5\u7B97 "),He=E("\u53BB\u8BD5\u7B97"),Ke=E("\u7ACB\u5373\u6295\u4FDD"),We=_e({setup(l){var w,Y;const d=ge(),n=ke(),{templateId:g=1,agentCode:ee="test",agencyCode:te="",tenantId:x=9991000007,insurerCode:Qe="99",proposalId:O,saleChannelId:ae}=n.query;let{productCode:S="MMBBSF"}=n.query;const B=v({personVO:{occupationCodeList:[]}}),T=v({insuredCode:"",personVO:{occupationCodeList:[]}}),C=v({}),q=v({}),j=v({}),h=v(null),M=v({}),e=ye({currentPlan:"",riskBaseInfo:{},holderFactor:[],insuredFactor:[],riskData:[],riskPlanData:[],trialResult:{},canTrial:!0,retrialTip:!1,enumList:{},ageRange:[],collapseName:["1"],insuredRiskList:[],currentRiskList:[]});if(O)try{S=(Y=JSON.parse(((w=n.query)==null?void 0:w.extInfo)||"{}"))==null?void 0:Y.productCenterCode}catch(i){console.log(i)}Pe("premium",M.value),Fe().get("userInfo");const ie="premiumTrial",re=()=>{e.retrialTip=!1},oe=(i,a)=>{e.insuredRiskList=i.map(t=>{var s,c;return{initialAmount:(s=a[t.riskCode])==null?void 0:s.amount,amountUnit:1,annuityDrawFrequency:t.annuityDrawDate,annuityDrawType:t.annuityDrawType,paymentFrequency:t.paymentFrequency,paymentPeriod:t.chargePeriod.split("_")[1],paymentPeriodType:be[t.chargePeriod.split("_")[0]],insurancePeriodType:Ee[t.coveragePeriod==="to_life"?"to_life":t.coveragePeriod.split("_")[0]],insurancePeriodValue:Number.isNaN(+t.coveragePeriod.split("_")[1])?0:t.coveragePeriod.split("_")[1],riskCode:t.riskCode,riskType:t.riskType,riskName:t.riskName,extInfo:{riskId:t.riskId,copy:t.copy},initialPremium:(c=a[t.riskCode])==null?void 0:c.premium,liabilityDetails:t.liabilityVOList.map(r=>({liabilityCode:r.liabilityCode,liabilityName:r.liabilityName,refundMethod:r.liabilityAttributeValue})),productId:e.riskBaseInfo.id}})},se=()=>{Be({agencyId:te,saleUserId:ee,saleChannelId:ae,tenantId:x,venderCode:e.riskBaseInfo.insurerCode,orderDataSource:1,proposalId:O,extInfo:{templateId:+(g||1),pageCode:ie,iseeBizNo:window.iseeBiz},tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{extInfo:{},tenantOrderProductList:[{productCode:e.riskBaseInfo.productCode||"",productName:e.riskBaseInfo.productName||"",premium:e.trialResult.premium||0,tenantOrderRiskList:e.insuredRiskList}]}]}).then(({code:i,data:a})=>{i==="10000"&&a.pageAction.pageAction==="jumpToPage"&&d.push({path:Te[a.pageAction.data.nextPageCode],query:A(b({insurerCode:e.riskBaseInfo.insurerCode},n.query),{orderNo:a.pageAction.data.orderNo})})})},ne=()=>{const i=JSON.parse(JSON.stringify(C.value[e.currentPlan])),a=Object.values(i).find(s=>s.riskType===1),t=Object.values(i).map(s=>{const c=s;if(c.chargePeriod==="3"){const r=(a.chargePeriod||"").split("_");r[1]&&(r[1]-=1),c.chargePeriod=r.join("_")}return c.liabilityVOList=(c.liabilityVOList||[]).filter(r=>r.optionalFlag===1||r.liabilityAttributeValue&&r.liabilityAttributeValue!=="-1").map(r=>{const p=r;return p.liabilityAttributeValue==="0"&&(p.liabilityAttributeValue=""),p}),c}),u={holder:B.value,productCode:e.riskBaseInfo.productCode,insuredVOList:[A(b({},T.value),{productPlanVOList:[{planCode:e.currentPlan||"",insurerCode:e.riskBaseInfo.insurerCode,riskVOList:t}]})]};De(b({},u)).then(({code:s,data:c})=>{if(s==="10000"){e.retrialTip=!1,e.trialResult=c,e.canTrial=!1;const r={},p=(V=[])=>{(V||[]).forEach(m=>{var N;r[m.riskCode]=m,((N=m.riskPremiumDetailVOList)==null?void 0:N.length)&&p(m.riskPremiumDetailVOList)})};p(c.riskPremiumDetailVOList),oe(u.insuredVOList[0].productPlanVOList[0].riskVOList,r),Object.assign(M.value,r)}})},le=()=>{var i,a,t,u,s;Promise.all([(a=(i=q.value)==null?void 0:i.validateForm)==null?void 0:a.call(i),(u=(t=j.value)==null?void 0:t.validateForm)==null?void 0:u.call(t),(s=h.value)==null?void 0:s.validate()]).then(()=>{ne()},c=>{var r;c.length&&((r=h==null?void 0:h.value)==null||r.scrollToField(c[0].name))})},ue=()=>{Ne({dictCodeList:["RISK_PAYMENT_PERIOD","RISK_INSURANCE_PERIOD"]}).then(({code:a,data:t})=>{if(a==="10000"){const u={};t.forEach(s=>{u[s.dictCode]=s.dictItemList}),e.enumList=u}})},ce=i=>{Oe({id:O,tenantId:x}).then(({code:a,data:t})=>{var u;if(a==="10000"){const s=((u=t.proposalInsuredList)==null?void 0:u[0])||{},{proposalInsuredProductList:c=[]}=s,r=X(s,["proposalInsuredProductList"]);Object.assign(B.value.personVO,t.proposalHolder);const p=c.find(m=>m.productId===i);Object.assign(T.value.personVO,r,{occupationCodeList:(p==null?void 0:p.occupationCodeList)||[]});const V={};((p==null?void 0:p.proposalProductRiskList)||[]).forEach(m=>{V[m.riskId]=m}),Object.assign(C.value,{0:V})}})},de=()=>{Le({productCode:S,source:1}).then(({code:i,data:a})=>{var t;i==="10000"&&(e.riskBaseInfo=a.productBasicInfoVO,(a.productRelationPlanVOList.length?a.productRelationPlanVOList:a.productRiskVoList[0].riskDetailVOList||[]).forEach((u,s)=>{s===0&&(e.currentPlan=u.planCode||"0"),O||Object.assign(C.value,{[u.planCode||s]:{}})}),e.riskData=((t=a.productRiskVoList[0])==null?void 0:t.riskDetailVOList)||[],e.riskPlanData=a.productRelationPlanVOList||[],O&&ce(a.productBasicInfoVO.id))}).finally(()=>{})},U=i=>{e.holderFactor=i.holderFactorList,e.insuredFactor=i.insuredFactorList,e.ageRange=i.ageRange};return Ce([()=>C.value,()=>B.value,()=>T.value],i=>{i&&!e.canTrial&&(e.canTrial=!0,e.retrialTip=!0)},{deep:!0}),ve(()=>{de(),ue()}),(i,a)=>{const t=P("ProTitle"),u=P("VanForm"),s=P("ProTabButton"),c=P("VanTab"),r=P("VanTabs"),p=P("van-collapse-item"),V=P("van-collapse"),m=P("VanButton"),N=P("ProPageWrap");return k(),R(N,{class:"page-trial-wrapper"},{default:y(()=>{var J,z,G;return[o(e).holderFactor.length?(k(),I("div",Ae,[_(t,{title:"\u6295\u4FDD\u4EBA"}),_(Z,{ref_key:"holderRef",ref:q,"insured-code":(J=o(e).riskBaseInfo)==null?void 0:J.insurerCode,"form-info":B.value.personVO,"factor-list":o(e).holderFactor,"age-range":o(e).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):L("",!0),o(e).insuredFactor.length?(k(),I("div",xe,[_(t,{title:"\u88AB\u4FDD\u4EBA"}),_(Z,{ref_key:"insuredRef",ref:j,"insured-code":(z=o(e).riskBaseInfo)==null?void 0:z.insurerCode,"form-info":T.value.personVO,"factor-list":o(e).insuredFactor,"age-range":o(e).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):L("",!0),D("div",Se,[_(V,{modelValue:o(e).collapseName,"onUpdate:modelValue":a[1]||(a[1]=f=>o(e).collapseName=f)},{default:y(()=>[_(p,{name:"1"},{title:y(()=>[_(t,{title:"\u6295\u4FDD\u65B9\u6848"})]),default:y(()=>[o(e).riskData.length&&C.value[0]?(k(),I("div",qe,[_(u,{ref_key:"riskFormRef",ref:h,"input-align":"right","error-message-align":"right"},{default:y(()=>[_($,{"risk-info":C.value[0],enums:o(e).enumList,"origin-data":o(e).riskData,"pick-factor":U},null,8,["risk-info","enums","origin-data"])]),_:1},512)])):L("",!0),o(e).riskPlanData.length?(k(),I("div",je,[_(u,{ref_key:"riskFormRef",ref:h,"input-align":"right","error-message-align":"right"},{default:y(()=>[_(r,{active:o(e).currentPlan,"onUpdate:active":a[0]||(a[0]=f=>o(e).currentPlan=f)},{default:y(()=>[(k(!0),I(he,null,Ve(o(e).riskPlanData,f=>(k(),R(c,{key:f.planCode,name:f.planCode,title:f.planName},{title:y(()=>[_(s,{title:f.planName,active:o(e).currentPlan===f.planCode},null,8,["title","active"])]),default:y(()=>{var H;return[f.planCode===o(e).currentPlan?(k(),R($,{key:0,"risk-info":C.value[f.planCode],enums:o(e).enumList,"origin-data":(H=f.productRiskVoList)==null?void 0:H[0].riskDetailVOList,"pick-factor":U},null,8,["risk-info","enums","origin-data"])):L("",!0)]}),_:2},1032,["name","title"]))),128))]),_:1},8,["active"])]),_:1},512)])):L("",!0)]),_:1})]),_:1},8,["modelValue"])]),D("div",Me,[D("span",Ue,[we,D("span",Ye,Ie((o(e).retrialTip?0:((G=o(e).trialResult)==null?void 0:G.premium)||0).toLocaleString("hanidec",{style:"currency",currency:"CNY"})),1)]),D("div",Je,[o(e).retrialTip?(k(),I("div",ze,[Ge,D("span",{class:"close-icon",onClick:re})])):L("",!0),o(e).canTrial?(k(),R(m,{key:1,type:"primary",onClick:le},{default:y(()=>[He]),_:1})):(k(),R(m,{key:2,type:"primary",onClick:se},{default:y(()=>[Ke]),_:1}))])])]}),_:1})}}});var st=Re(We,[["__scopeId","data-v-4d90553c"]]);export{st as default};
