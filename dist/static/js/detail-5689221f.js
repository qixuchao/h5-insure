import{h as e,r as t,k as a,l,y as n,z as o,s as i,Q as u,n as r,C as s,I as d,F as c,aA as v,N as p,a8 as f,j as m,Z as h,m as y,A as b,E as I,T as w}from"./vendor-d6fdc679.js";import{u as C}from"./theme-bc16780d.js";import{g as j,a as x,i as O}from"./trial-a2000d96.js";import{_ as g,n as L}from"./nextStep-0b1ebb5d.js";import{q as k}from"./index-60277a18.js";import{s as N}from"./verify-456bd2b5.js";import{p as _}from"./product-d4af34db.js";import{O as E,a as T}from"./order-41d0799a.js";import{u as P,s as S}from"./core-446922ec.js";import{P as V}from"./index-84f1c0c7.js";import{_ as R}from"./index-aa55486b.js";import"./infoCollection-467b6f5a.js";import"./relativeTime-388a6394.js";import"./useDicData-2ccea59e.js";import"./index-51d99e89.js";import"./utils-02eb1fe6.js";import"./useStorage-16c827e8.js";import"./trial-51097f61.js";const U={class:"sign-wrap"},A=["src"],D={class:"popup-body"},F={class:"sign-container-wrap"},H={class:"operate-bar"},B=s(" 请投保人正楷签署您的签名:"),z={class:"btns"},q=s("返回"),G=s("重写"),Y=s("确定签字"),Q=e({props:{option:{default:{}},modelValue:{default:""}},emits:["update:modelValue"],setup(e,{emit:p}){const f=t(!1),m=t(),h=t(""),y=t(!0),b=()=>{var e;f.value=!0,null==(e=m.value)||e.clear()},I=()=>{v({images:[h.value],className:"customer-sign-preview"})},w=()=>{f.value=!1},C=()=>{var e,t;null==(t=null==(e=m.value)?void 0:e.clear)||t.call(e)},j=()=>{var e;h.value=null==(e=m.value)?void 0:e.save(),p("update:modelValue",h.value),f.value=!1};return(e,t)=>{const v=a("van-button"),p=a("van-icon"),x=a("van-popup");return l(),n(c,null,[o("div",U,[h.value?(l(),n("img",{key:0,class:"preview-sign",src:h.value,alt:"",onClick:I},null,8,A)):i("",!0),u(v,{type:"primary",round:"",size:"small",onClick:b},{default:r((()=>[s(d(h.value?"重新签名":"点击签字"),1)])),_:1})]),u(x,{show:f.value,"onUpdate:show":t[1]||(t[1]=e=>f.value=e),position:"bottom",style:{height:"100%",overflow:"hidden"}},{default:r((()=>[o("div",D,[o("div",F,[u(k,{ref_key:"signRef",ref:m,placeholder:"请在此处签名",onStroke:t[0]||(t[0]=e=>y.value=!1)},null,512),o("div",H,[o("span",null,[u(p,{name:"info",color:"#ffaf22"}),B]),o("div",z,[u(v,{type:"default",class:"btn",onClick:w},{default:r((()=>[q])),_:1}),u(v,{type:"default",class:"btn",onClick:C},{default:r((()=>[G])),_:1}),u(v,{type:"primary",class:"btn",disabled:y.value,onClick:j},{default:r((()=>[Y])),_:1},8,["disabled"])])])])])])),_:1},8,["show"])],64)}}});const W={class:"net-sale-detail-wrap"},Z={class:"sign-cell"},$=o("div",{class:"sign-label"},"签名",-1),J={class:"footer"},K={class:"footer"},M=e({setup(e){const s=C(),d=p();f();const{orderNo:v="2022113021181894998",tenantId:k="9991000001"}=d.query;t();const U=t({}),A=t(!1),D=t({commencementTime:"",expiryDate:"",extInfo:{buttonCode:"EVENT_NETSALE_airSignature",pageCode:"infoCollection",templateId:3,iseeBizNo:""},orderCategory:1,tenantId:k,venderCode:"",tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},insuredBeneficiaryType:"1",tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}],tenantOrderProductList:[{}]}],tenantOrderSubjectList:[{extInfo:{subjectRelatedFirm:"",subjectRelatedUserId:""},subjectName:"",subjectObjectType:"HOLDER",subjectType:"GENERAL",tenantId:k}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}}),F=t(!1),H=t({}),B=t(),z=t(),q=t(""),G=t(""),Y=t(!1),M=t(!1),X=t(0),ee=t([]),te=t(""),ae=t(""),le=t({}),ne=()=>{Y.value=!1,M.value=!1},oe=async()=>{Y.value=!1,M.value=!0,await N("HOLDER",q.value,D.value.id,`${k}`),L(D.value)},ie=async()=>{const{data:e,code:t}=await _({productCode:ae.value,tenantId:k,withInsureInfo:!0});"10000"===t&&(z.value=e,(()=>{var e,t,a;let l={};if(l=(null==(a=((null==(t=null==(e=z.value)?void 0:e.tenantProductInsureVO)?void 0:t.planList)||[]).find((e=>e.planCode===G.value)))?void 0:a.attachmentVOList)||[],!l)return void(ee.value=[]);const n={2:"richText",3:"link"};ee.value=Object.keys(l).map((e=>(l[e].forEach((e=>{if("1"===e.attachmentType){const t=e.attachmentUri.split("?"),a=t[0].substr(t[0].lastIndexOf(".")+1);e.attachmentType="pdf"===a?"pdf":"picture"}else e.attachmentType=n[e.attachmentType]})),{attachmentName:e,attachmentList:l[e]})))||[]})())},ue=async()=>{var e;const{code:t,data:a}=await j({orderNo:v,tenantId:k});if("10000"===t&&(a.extInfo.buttonCode="EVENT_NETSALE_airSignature",D.value=a,G.value=null==(e=a.tenantOrderInsuredList[0])?void 0:e.planCode,ae.value=a.tenantOrderInsuredList[0].tenantOrderProductList[0].productCode,A.value=!0,(async()=>{const{code:e,data:t}=await O({productCode:ae.value,tenantId:k});"10000"===e&&(B.value=t,U.value=t.productFactor)})(),ie(),a.orderStatus===T.PAYING)){D.value.extInfo.redirectUrl="";const{code:e,data:t}=await x(D.value);"10000"===e&&S(t.paymentUrl)}},re=async()=>{q.value?(M.value=!1,Y.value=!0):w("请先签字")};return P(),m((()=>{ue()})),h([()=>G.value,()=>z.value],(()=>{var e,t,a;G.value&&(le.value=(null==(a=((null==(t=null==(e=z.value)?void 0:e.tenantProductInsureVO)?void 0:t.planList)||[]).find((e=>(e.planCode===G.value&&(te.value=e.planName),e.planCode===G.value))))?void 0:a.attachmentVOList)||[])}),{deep:!0,immediate:!0}),(e,t)=>{const d=a("ProCell"),v=a("ProCard"),p=a("van-cell"),f=a("ProPageWrap"),m=a("ProFilePreview"),h=a("ProPopup"),w=a("van-config-provider");return l(),y(w,{"theme-vars":b(s)},{default:r((()=>{var e;return[u(f,null,{default:r((()=>[o("div",W,[u(v,null,{default:r((()=>{var e;return[u(d,{title:"产品名称",content:null==(e=B.value)?void 0:e.productBasicInfoVO.productFullName},null,8,["content"])]})),_:1}),D.value.id?(l(),y(v,{key:0,"show-line":!1,title:"投保信息"},{default:r((()=>{var e,t,a,l,n;return[u(d,{title:"保费",content:D.value.orderAmount+"元"},null,8,["content"]),u(d,{title:"保险期限",content:te.value},null,8,["content"]),u(d,{title:"起保日期",content:D.value.commencementTime},null,8,["content"]),u(d,{title:"终保日期",content:D.value.expiryDate},null,8,["content"]),u(d,{title:"保单状态",content:b(E)[D.value.orderStatus]},null,8,["content"]),u(d,{title:"订单编号",content:D.value.orderNo},null,8,["content"]),u(d,{title:"房屋地址",content:null==(t=null==(e=D.value.tenantOrderHolder)?void 0:e.extInfo)?void 0:t.familyAddress},null,8,["content"]),u(d,{title:"燃气编号",content:null==(n=null==(l=null==(a=D.value.tenantOrderSubjectList)?void 0:a[0])?void 0:l.extInfo)?void 0:n.subjectRelatedUserId},null,8,["content"])]})),_:1})):i("",!0),A.value?(l(),y(g,{key:1,ref:"formRef","title-collection":{HOLDER:"投保人信息",INSURER:"被保人信息",BENEFICIARY:"受益人"},"is-view":!0,"form-info":D.value,"factor-object":U.value,"input-align":"right"},null,8,["form-info","factor-object"])):i("",!0),u(v,{title:"阅读条款合同",class:"file-list-card"},{default:r((()=>[(l(!0),n(c,null,I(ee.value,((e,t)=>(l(),y(p,{key:t,title:e.attachmentName,"is-link":"",onClick:t=>{return a=e.attachmentName,l=e.attachmentList,F.value=!0,void(H.value={title:a,fileContent:null==l?void 0:l[0]});var a,l}},null,8,["title","onClick"])))),128))])),_:1}),u(v,{title:"客户签名"},{default:r((()=>[o("div",Z,[$,u(Q,{modelValue:q.value,"onUpdate:modelValue":t[0]||(t[0]=e=>q.value=e)},null,8,["modelValue"])])])),_:1}),o("div",J,[u(V,{shadow:!1,text:"提 交",onClick:re})])])])),_:1}),u(h,{show:F.value,"onUpdate:show":t[2]||(t[2]=e=>F.value=e),class:"pre-notice-wrap",title:null==(e=H.value)?void 0:e.title,position:"bottom",style:{height:"600px"}},{default:r((()=>{var e,a,l,n;return[u(m,{content:null==(a=null==(e=H.value)?void 0:e.fileContent)?void 0:a.attachmentUri,type:null==(n=null==(l=H.value)?void 0:l.fileContent)?void 0:n.attachmentType},null,8,["content","type"]),o("div",K,[u(V,{shadow:!1,text:"关闭",onClick:t[1]||(t[1]=e=>F.value=!1)})])]})),_:1},8,["show","title"]),Y.value&&0!==ee.value.length?(l(),y(R,{key:0,show:Y.value,"onUpdate:show":t[3]||(t[3]=e=>Y.value=e),"content-list":ee.value,"is-only-view":M.value,"active-index":X.value,text:M.value?"关闭":"我已逐页阅读上述内容并同意","force-read-cound":0,"on-close-file-preview":"",onSubmit:oe,onOnCloseFilePreview:ne},null,8,["show","content-list","is-only-view","active-index","text"])):i("",!0)]})),_:1},8,["theme-vars"])}}});export{M as default};
