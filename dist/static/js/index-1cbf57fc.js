var _e=Object.defineProperty,fe=Object.defineProperties;var Ee=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var De=Object.prototype.hasOwnProperty,Fe=Object.prototype.propertyIsEnumerable;var Z=(B,s,_)=>s in B?_e(B,s,{enumerable:!0,configurable:!0,writable:!0,value:_}):B[s]=_,R=(B,s)=>{for(var _ in s||(s={}))De.call(s,_)&&Z(B,_,s[_]);if(X)for(var _ of X(s))Fe.call(s,_)&&Z(B,_,s[_]);return B},S=(B,s)=>fe(B,Ee(s));import{g as Ce,O as ve,ak as Ae,E as L,d as he,y as pe,h as ye,r as U,j as D,k as $,m as E,z as t,p as f,J as A,n as h,L as ee,t as k,A as O,G as V,F as M,a4 as ge,a5 as me,C as N,T as x,D as Te}from"./vendor-96e68f0e.js";import{q as Ne}from"./index-fbbc79b7.js";import{_ as Ie,S as Oe,I as Re,J as Se,q,l as w,K as ue,N as te,n as ke,P as xe,r as we}from"./index-87df9c0d.js";import{_ as be}from"./index-2667678f.js";import{g as Pe,f as He,s as se,a as Le}from"./verify-df2a1cda.js";const j=B=>(ge("data-v-cc4e4f02"),B=B(),me(),B),Ue={class:"page-verify"},$e={class:"people"},Ve={class:"name"},Me={class:"verify-item"},qe=j(()=>t("div",{class:"label"},"\u8BC1\u4EF6\u53F7\u7801",-1)),je={class:"no"},Ye=N(" \u53BB\u8BA4\u8BC1 "),ze={class:"sign-body"},Ge={class:"date"},Je={class:"file"},Qe=N(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A "),We={class:"people"},Ke={class:"name"},Xe={class:"verify-item"},Ze=j(()=>t("div",{class:"label"},"\u8BC1\u4EF6\u53F7\u7801",-1)),eu={class:"no"},uu=["onClick"],tu=N(" \u53BB\u8BA4\u8BC1 "),su=["onClick"],au={class:"sign-body"},ou={class:"date"},nu={class:"file"},ru=N(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A "),iu={class:"footer-button footer"},lu={class:"refresh-btn"},cu=j(()=>t("div",{class:"text"},"\u5237\u65B0",-1)),du=N("\u5206\u4EAB"),Bu=N("\u63D0\u4EA4"),_u=Ce({setup(B){const s={CERT:1,NO_CERT:2},_=ve(),ae=Ae(),{saleUserId:Y="D1234567-1",tenantId:g="9991000007",templateId:oe=1,productCode:ne="CQ75CQ76",insurerCode:re="ancheng"}=_.query;let{orderNo:p}=_.query;typeof p=="object"&&(p=(p||[])[0]);const b=new Oe({source:"localStorage"}),P=L([]),a=L(),m=L(),y=[],z=he().format("YYYY-MM-DD"),ie=()=>{var u;(u=m.value)==null||u.clear()},le=u=>{y[u].clear()},G=(u,n)=>{Le({callbackUrl:window.location.href,certiNo:u,faceAuthMode:"TENCENT",userName:n,tenantId:9991000007}).then(i=>{const{code:r,data:l}=i;if(r==="10000"){const{originalUrl:C,serialNo:e}=l;window.location.href=C,b.set("verifyData",{serialNo:e,certNo:u,name:n})}})},T=u=>`${u}`===Se.CERT,J=u=>{var n,i,r,l;u===-1?G((n=a.value.tenantOrderHolder)==null?void 0:n.certNo,(i=a.value.tenantOrderHolder)==null?void 0:i.name):G((r=a.value.tenantOrderInsuredList[u])==null?void 0:r.certNo,(l=a.value.tenantOrderInsuredList[u])==null?void 0:l.name)},ce=u=>{u&&y.every(n=>n!==u)&&y.push(u)},de=()=>{var n,i,r,l,C;if((n=m.value)==null?void 0:n.isEmpty()){x.fail("\u8BF7\u6295\u4FDD\u4EBA\u7B7E\u540D");return}if(y.some(e=>e.isEmpty())){x.fail("\u8BF7\u88AB\u4FDD\u4EBA\u7B7E\u540D");return}if(((r=(i=a.value.tenantOrderHolder)==null?void 0:i.extInfo)==null?void 0:r.isCert)!==s.CERT&&T((l=a.value.tenantOrderHolder)==null?void 0:l.certType)){x.fail("\u8BF7\u6295\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}if((C=a.value.tenantOrderInsuredList)==null?void 0:C.some(e=>{var c;return((c=e.extInfo)==null?void 0:c.isCert)!==s.CERT&&T(e.certType)})){x.fail("\u8BF7\u88AB\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}Te.confirm({title:"\u63D0\u793A",message:"\u8BF7\u786E\u8BA4\u4FE1\u606F\u586B\u5199\u65E0\u8BEF\u540E\uFF0C\u518D\u8FDB\u884C\u652F\u4ED8"}).then(()=>{var c,o;const e=(c=m.value)==null?void 0:c.save();Promise.all([se("HOLDER",e,(o=a.value)==null?void 0:o.id,`${g}`),...y.map(d=>{var F;return se("INSURED",d.save(),(F=a.value)==null?void 0:F.id,`${g}`)})]).then(()=>{ke(S(R({},a.value),{pageCode:"sign",operateOption:{withSignInfo:!0},extInfo:S(R({},a.value.extInfo),{pageCode:"sign",templateId:oe}),venderCode:re})).then(d=>{const{code:F,data:v}=d;F==="10000"&&v.success&&ae.push({path:xe[v.pageAction.data.nextPageCode],query:{orderNo:p,saleUserId:Y,tenantId:g}})})})})},Q=()=>{we({orderNo:p,saleUserId:Y,tenantId:g}).then(u=>{const{code:n,data:i}=u;n==="10000"&&(a.value=i,setTimeout(()=>{let r=0;i.tenantOrderAttachmentList.forEach(l=>{l.category===21&&(l.objectType===2?(m.value.clear(),m.value.setDataURL(l.fileBase64)):l.objectType===1&&(y[r].clear(),y[r].setDataURL(l.fileBase64),r+=1))})}))})},Be=pe(()=>{const u=S(R({},_.query),{isShare:1,sharePageCode:"sign"});return`${window.location.origin}/phoneVerify?${Ne.stringify(u)}`});return ye(()=>{Q(),Pe({orderNo:p,productCode:ne,tenantId:g}).then(n=>{const{code:i,data:r}=n;i==="10000"&&(P.value=r||[])});const u=b.get("verifyData");if(u){const{serialNo:n,certNo:i,name:r}=u;He({certiNo:i,orderNo:p,serialNo:n,tenantId:g,userName:r}).then(l=>{const{code:C,data:e}=l;C==="10000"&&(b.remove("verifyData"),Q())})}}),(u,n)=>{const i=U("ProPDFviewer"),r=U("van-button"),l=U("ProPageWrap");return D(),$(l,null,{default:E(()=>{var C;return[t("div",Ue,[f(Re,{type:"warning",title:"\u5C0A\u656C\u7684\u5BA2\u6237\uFF0C\u672C\u6B21\u6295\u4FDD\u9700\u8981\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",content:"\u672C\u4EA7\u54C1\u6295\u4FDD\u9700\u8981\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u8FDB\u884C\u5B9E\u540D\u8BA4\u8BC1\uFF0C\u60A8\u8D2D\u4E70\u672C\u4EA7\u54C1\u7684\u7D2F\u8BA1\u603B\u4FDD\u8D39\u5DF2\u8D85\u8FC720\u4E07\uFF0C\u6309\u76D1\u7BA1\u8981\u6C42\uFF0C\u9700\u8981\u63D0\u4F9B\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u3001\u6307\u5B9A\u53D7\u76CA\u4EBA\u8BC1\u4EF6\u5F71\u50CF\uFF0C\u672C\u4EA7\u54C1\u975E\u672C\u4EBA\u6295\u4FDD\u4E14\u5E26\u8EAB\u6545\u8D23\u4EFB\u3001\u9700\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\uFF08\u6210\u4EBA\uFF09\u7684\u6295\u4FDD\u610F\u613F\u8FDB\u884C\u7B7E\u5B57\u786E\u8BA4\u3002"}),f(w,{title:"\u6295\u4FDD\u4EBA",class:"card"},{extra:E(()=>{var e,c,o,d,F,v,I,H,W,K;return[t("div",$e,[t("div",Ve,A((c=(e=a.value)==null?void 0:e.tenantOrderHolder)==null?void 0:c.name),1),T((d=(o=a.value)==null?void 0:o.tenantOrderHolder)==null?void 0:d.certType)?(D(),h("div",{key:0,class:ee(["status",{verified:((I=(v=(F=a.value)==null?void 0:F.tenantOrderHolder)==null?void 0:v.extInfo)==null?void 0:I.isCert)===s.CERT}])},A(((K=(W=(H=a.value)==null?void 0:H.tenantOrderHolder)==null?void 0:W.extInfo)==null?void 0:K.isCert)===s.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)):k("",!0)])]}),default:E(()=>{var e,c,o,d,F,v,I;return[t("div",Me,[qe,t("div",je,A((c=(e=a.value)==null?void 0:e.tenantOrderHolder)==null?void 0:c.certNo),1),((F=(d=(o=a.value)==null?void 0:o.tenantOrderHolder)==null?void 0:d.extInfo)==null?void 0:F.isCert)!==s.CERT&&T((I=(v=a.value)==null?void 0:v.tenantOrderHolder)==null?void 0:I.certType)?(D(),h("div",{key:0,class:"action",onClick:n[0]||(n[0]=H=>J(-1))},[Ye,f(q,{name:"right_arrow",class:"icon"})])):k("",!0)])]}),_:1}),f(w,{title:"\u6295\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:E(()=>[t("div",{class:"resign",onClick:ie},"\u91CD\u7B7E")]),default:E(()=>[f(ue,{ref_key:"holderSign",ref:m,class:"sign"},null,512),t("div",ze,[t("div",Ge,"\u7B7E\u540D\u65E5\u671F\uFF1A "+A(O(z)),1),t("div",Je,[Qe,(D(!0),h(M,null,V(P.value.filter(e=>e.noticeObject===O(te).HOLDER),(e,c)=>(D(),$(i,{key:c,class:"file",title:`\u300A${e.materialName}\u300B`,url:e.materialSource},null,8,["title","url"]))),128))])])]),_:1}),(D(!0),h(M,null,V((C=a.value)==null?void 0:C.tenantOrderInsuredList,(e,c)=>(D(),h("div",{key:c},[f(w,{title:"\u88AB\u4FDD\u4EBA",class:"card"},{extra:E(()=>{var o,d;return[t("div",We,[t("div",Ke,A(e.name),1),T(e.certType)?(D(),h("div",{key:0,class:ee(["status",{verified:((o=e.extInfo)==null?void 0:o.isCert)===s.CERT}])},A(((d=e.extInfo)==null?void 0:d.isCert)===s.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)):k("",!0)])]}),default:E(()=>{var o;return[t("div",Xe,[Ze,t("div",eu,A(e.certNo),1),((o=e.extInfo)==null?void 0:o.isCert)!==s.CERT&&T(e.certType)?(D(),h("div",{key:0,class:"action",onClick:d=>J(c)},[tu,f(q,{name:"right_arrow",class:"icon"})],8,uu)):k("",!0)])]}),_:2},1024),f(w,{title:"\u88AB\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:E(()=>[t("div",{class:"resign",onClick:o=>le(c)},"\u91CD\u7B7E",8,su)]),default:E(()=>[f(ue,{ref_for:!0,ref:ce,class:"sign"}),t("div",au,[t("div",ou,"\u7B7E\u540D\u65E5\u671F\uFF1A "+A(O(z)),1),t("div",nu,[ru,(D(!0),h(M,null,V(P.value.filter(o=>o.noticeObject===O(te).INSURED),(o,d)=>(D(),$(i,{key:d,class:"file",title:`\u300A${o.materialName}\u300B`,url:o.materialSource},null,8,["title","url"]))),128))])])]),_:2},1024)]))),128)),t("div",iu,[t("div",lu,[t("div",null,[f(q,{name:"refresh"})]),cu]),f(be,{title:"\u9080\u8BF7\u60A8\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",desc:"\u9080\u8BF7\u60A8\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",link:O(Be)},{default:E(()=>[f(r,{plain:"",type:"primary",class:"share-btn"},{default:E(()=>[du]),_:1})]),_:1},8,["link"]),f(r,{type:"primary",class:"submit-btn",onClick:de},{default:E(()=>[Bu]),_:1})])])]}),_:1})}}});var Au=Ie(_u,[["__scopeId","data-v-cc4e4f02"]]);export{Au as default};
