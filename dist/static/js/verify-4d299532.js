import{d as e,j as a,i as l,z as s,o as i,l as u,w as o,a as n,e as r,u as t,b as d,V as v,W as c,c5 as m,c6 as f,c7 as p,c8 as y,as as h,ao as g,h as b,g as S,a6 as C,aj as k,O as V,c as q,q as j,F as L,a8 as x,T as I,bk as w,aC as _,a9 as U,aa as E,aq as F,ag as O}from"./index-404eec03.js";import{n as $}from"./nextStep-4be7c141.js";import{c as N}from"./format-b5e9d8b9.js";import{g as P,m as A}from"./trial-37239397.js";import{p as R}from"./utils-a1833ec1.js";import{u as T}from"./useOrder-2c41679e.js";import{P as D,a as G,B}from"./constants-fe95ef6f.js";import{d as Y,q as z}from"./verify-3795ddc4.js";import"./core-9d9a23d5.js";import"./utils-0bfccf41.js";import"./infoCollection-8d0c5911.js";import"./trial-6f236b5b.js";const H={class:"popup-container"},J={class:"popup-header"},M={class:"title"},W={class:"popup-body"},K=e({name:"checkCodePopup"}),Q=e({...K,props:{show:{type:Boolean,default:!1},type:{default:"agent"},data:{default:()=>({})}},emits:["cancel","confirm"],setup(e,{emit:g}){const b=e,S=a((()=>b.show)),C=l({mobile:"",verifyCode:""}),k=a((()=>b.type)),V=l({holder:{type:"投保人",name:"",mobile:"",desc:""},agent:{type:"代理人",name:"李三",mobile:"13262278989",desc:"色卡上会计核算看回放独守空房还是空巅峰计划收款方"},insured:{type:"被保人",name:"",mobile:"",desc:""}}),q=()=>{g("cancel")},j=()=>{g("confirm")};return s([()=>b.data,b.type],(([e,a])=>{var l,s,i;e&&(Object.assign(V.value.holder,e.holder),Object.assign(V.value.insured,null==(l=null==e?void 0:e.insuredList)?void 0:l[0]),C.value.mobile=null==(i=null==(s=V.value)?void 0:s[`${b.type}`])?void 0:i.mobile)}),{immediate:!0,deep:!0}),(e,a)=>{const l=f,s=p,g=y,b=h;return i(),u(b,{show:S.value,"onUpdate:show":a[2]||(a[2]=e=>S.value=e),class:"popup-check-mobile",closeable:!1,"close-on-click-overlay":!1},{default:o((()=>[n("div",H,[n("div",J,[n("span",{class:"clear-all",onClick:q}," 取消 "),n("span",M,r(`${V.value[k.value].type}手机号验证`),1),n("span",{class:"close",onClick:j},"确认")]),n("div",W,[n("h3",null,r(`尊敬的${V.value[k.value].type}:${V.value[k.value].name}`),1),n("p",null,r(V.value[k.value].desc),1),n("h3",null,r(`${V.value[k.value].type}手机号验证 ${t(N)(V.value[k.value].mobile||"")}`),1),d(g,{model:C.value},{default:o((()=>[v(d(l,{modelValue:C.value.mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>C.value.mobile=e),label:"被保人手机号",name:"mobile",maxlength:"11",required:""},null,8,["modelValue"]),[[c,!1]]),d(s,{modelValue:C.value.verifyCode,"onUpdate:modelValue":a[1]||(a[1]=e=>C.value.verifyCode=e),"related-name":"mobile",label:" ",maxlength:"6","input-align":"left",placeholder:"请输入验证码",name:"verifyCode","send-s-m-s-code":t(m),rules:""},null,8,["modelValue","send-s-m-s-code"])])),_:1},8,["model"])])])])),_:1},8,["show"])}}}),X=g([{label:"签名完成",value:1},{label:"去签名",value:2},{label:"认证失败，请联系内勤人员",value:3}]),Z=2,ee=g([{label:"去双录",value:1},{label:"双录完成",value:Z},{label:"双录失败",value:3}]);const ae={class:"page-verify-wrap"},le={class:"sign-list"},se={class:"inner-cell"},ie={class:"inner-cell"},ue={class:"inner-cell"},oe={class:"inner-cell"},ne={class:"footer-button"},re=e({name:"verify"}),te=e({...re,setup(e){const r=b(),v=S(),{orderNo:c,tenantId:h}=r.query,g=l(!1),N=l(),H=l(),J=l({holder:{},insuredList:[{}]}),M=T(),W=l(!1),K=l({sign:[],verify:[],scribing:""}),re=l({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{},verifyStatus:2},agent:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:"",verifyStatus:2}}),te=l("agent"),de=a((()=>e=>K.value.sign.includes(e)||K.value.verify.includes(e))),ve=a((()=>re.value.agent.verifyStatus!==C.YES)),ce=a((()=>{const{insuredList:e}=M.value||{},{age:a,relationToHolder:l}=e[0]||{};return!(a<18||`${l}`===k.CERT)})),me=a((()=>e=>re.value[e].isSign||re.value[e].isVerify)),fe=a((()=>e=>re.value[e].isShareSign)),pe=e=>{ve.value||(te.value=e,"agent"!==e?W.value=!0:v.push({path:D.agentSign,query:r.query}))},ye=()=>{ve.value||N.value===Z||Y(M.value).then((({code:e,data:a})=>{"10000"===e&&a&&I("双录已完成")}))},he=()=>{W.value=!1},ge=()=>{let e="";e=("agent"===te.value||(te.value,re.value[te.value].isVerify),D.infoPreview),v.push({path:e,query:{...r.query,objectType:te.value}})},be=()=>{const{holder:e,insuredList:a,extInfo:l}=M.value;if(g.value){if(!l.agentAuthFlag)return void I("请先完成代理人签名")}else if([l.agentAuthFlag,e.isCert,a[0].isCert].includes(C.NO))return void I("请先完成签名");const s=Object.assign(M.value,{extInfo:{...M.value.extInfo,pageCode:G.SIGN,buttonCode:B.SIGN}});$(s,((e,a)=>{a===_.JUMP_PAGE&&U(e.nextPageCode,r.query)}),r)};return s((()=>J.value),(()=>{}),{deep:!0,immediate:!0}),V((()=>{(async()=>{let e={};z({orderNo:c,tenantId:h}).then((({code:e,data:a})=>{if("10000"===e){const{doubleRecordFlag:e,doubleRecordStatus:l}=a;g.value=e===C.YES,N.value=l}})),await P({orderNo:c,tenantId:h}).then((({code:a,data:l})=>{var s,i;if("10000"===a){Object.assign(M.value,l);const{agentAuthFlag:a}=l.extInfo;J.value=l,e=R(l.insuredList[0].productList),re.value.agent.verifyStatus=a,re.value.holder.verifyStatus=l.holder.isCert,re.value.insured.verifyStatus=null==(i=null==(s=l.insuredList)?void 0:s[0])?void 0:i.isCert}})),await A(e).then((({data:e,code:a})=>{if("10000"===a){const{signInfo:a}=w(e.productFactor);a.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((a=>{e.required&&K.value.sign.push(a.code),"1"===a.code?re.value.agent.isSign=!0:"2"===a.code?re.value.holder.isSign=!0:"3"===a.code?re.value.insured.isSign=!0:"4"===a.code?re.value.holder.isShareSign=!0:"5"===a.code&&(re.value.insured.isShareSign=!0)})),"customerFace"===e.name&&e.columns.forEach((a=>{e.required&&K.value.verify.push(a.code),"1"===a.code?re.value.holder.isVerify=!0:"2"===a.code&&(re.value.insured.isVerify=!0)}))}))}}))})()})),(e,a)=>{const l=E,s=F,r=O;return i(),q("div",ae,[d(l),n("div",le,[t(me)("agent")?(i(),u(s,{key:0,title:"代理人签名",required:t(de)("agent")},{value:o((()=>[n("div",se,[d(s,{"is-link":"",value:t(X)[t(re).agent.verifyStatus],onClick:a[0]||(a[0]=e=>pe("agent"))},null,8,["value"])])])),_:1},8,["required"])):j("",!0),t(g)?(i(),u(t(y),{key:2,ref_key:"formRef",ref:H,model:t(J)},{default:o((()=>[d(t(f),{modelValue:t(J).holder.mobile,"onUpdate:modelValue":a[3]||(a[3]=e=>t(J).holder.mobile=e),label:"投保人手机号",name:"holder.mobile",maxlength:"11",required:""},null,8,["modelValue"]),d(t(p),{modelValue:t(J).holder.verifyCode,"onUpdate:modelValue":a[4]||(a[4]=e=>t(J).holder.verifyCode=e),"related-name":"holder.mobile",label:"验证码",maxlength:"6",name:"holder.verifyCode","send-s-m-s-code":t(m),rules:"",required:""},null,8,["modelValue","send-s-m-s-code"]),t(ce)?(i(),q(L,{key:0},[d(t(f),{modelValue:t(J).insuredList[0].mobile,"onUpdate:modelValue":a[5]||(a[5]=e=>t(J).insuredList[0].mobile=e),label:"被保人手机号",name:"insuredList.0.mobile",maxlength:"11",required:""},null,8,["modelValue"]),d(t(p),{modelValue:t(J).insuredList[0].verifyCode,"onUpdate:modelValue":a[6]||(a[6]=e=>t(J).insuredList[0].verifyCode=e),label:"验证码",maxlength:"6",name:"insuredList.0.verifyCode","related-name":"insuredList.0.mobile","send-s-m-s-code":t(m),required:""},null,8,["modelValue","send-s-m-s-code"])],64)):j("",!0)])),_:1},8,["model"])):(i(),q(L,{key:1},[t(me)("holder")?(i(),u(s,{key:0,title:"投保人签名",required:t(de)("holder")},{value:o((()=>[n("div",ie,[t(fe)("holder")?(i(),u(s,{key:0,"value-class":""+(t(ve)?"disable":""),"is-link":"",value:"分享空签邀约"},null,8,["value-class"])):j("",!0),d(s,{"is-link":"",value:t(X)[t(re).holder.verifyStatus],"value-class":""+(t(ve)?"disable":""),onClick:a[1]||(a[1]=e=>pe("holder"))},null,8,["value","value-class"])])])),_:1},8,["required"])):j("",!0),t(me)("insured")&&t(ce)?(i(),u(s,{key:1,title:"被保人签名",required:t(de)("insured")},{value:o((()=>[n("div",ue,[t(fe)("insured")?(i(),u(s,{key:0,"value-class":""+(t(ve)?"disable":""),"is-link":"",value:"分享空签邀约"},null,8,["value-class"])):j("",!0),d(s,{"is-link":"","value-class":""+(t(ve)?"disable":""),value:t(X)[t(re).insured.verifyStatus],onClick:a[2]||(a[2]=e=>pe("insured"))},null,8,["value-class","value"])])])),_:1},8,["required"])):j("",!0)],64)),t(g)?(i(),u(s,{key:3,title:"保单双录",required:""},{value:o((()=>[n("div",oe,[d(s,{"is-link":"","value-class":""+(t(ve)?"disable":""),value:t(ee)[t(N)],onClick:ye},null,8,["value-class","value"])])])),_:1})):j("",!0)]),n("div",ne,[d(r,{type:"primary",onClick:be},{default:o((()=>[x("下一步")])),_:1})]),d(Q,{type:t(te),show:t(W),data:t(M),onCancel:he,onConfirm:ge},null,8,["type","show","data"])])}}});export{te as default};
