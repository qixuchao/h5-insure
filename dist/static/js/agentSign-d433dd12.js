import{d as e,a4 as a,a5 as i,h as s,g as t,bA as n,i as r,aE as o,o as l,c as d,b as c,a as f,u,w as g,a8 as p,aK as m,ck as h,T as v,bq as y,aa as S,cl as b,ag as j}from"./index-d0a5373e.js";import{b as I}from"./product-7065b9e5.js";import{g as E,m as N}from"./trial-a436dbf2.js";import{_}from"./SignPart-f01a77fe.js";import{u as T}from"./useOrder-6538ed77.js";import{N as O}from"./notice-33e6eedd.js";import{s as D,a as L,b as w}from"./verify-32c13a0a.js";import"./PolicyInfo-2971c758.js";import{a as C,P as V}from"./constants-fe95ef6f.js";import{p as A}from"./utils-64227400.js";import{g as q}from"./utils-92342654.js";import"./index-cea463ec.js";import"./infoCollection-f242d1c0.js";import"./trial-b6c2cf7f.js";const P={class:"long-verify"},G={class:"header"},x={class:"verify-content"},R={class:"footer-button"},k=e({__name:"agentSign",setup(e){a((()=>i((()=>import("./index-72976a4c.js")),["static/js/index-72976a4c.js","static/css/index-bf024e9b.css","static/js/index-d0a5373e.js","static/css/index-3d26afdd.css"]))),a((()=>i((()=>import("./index-107e86d7.js")),["static/js/index-107e86d7.js","static/css/index-fa4edf2a.css","static/js/index-d0a5373e.js","static/css/index-3d26afdd.css","static/js/theme-94cf7d00.js","static/js/index-ffa88f0d.js","static/css/index-bbfdd7ec.css","static/js/utils-92342654.js","static/js/infoCollection-f242d1c0.js","static/js/trial-b6c2cf7f.js"])));const k=s(),B=t(),{productCode:M="",tenantId:U,agentCode:z="",agencyCode:$,saleChannelId:F,saleUserId:H,orderNo:J,orderCode:K,extraInfo:Q,isShare:W,insurerCode:X,preview:Y}=k.query;let Z={};try{Z=JSON.parse(decodeURIComponent(Q))}catch(re){}const ee=T(),ae=`${window.origin}/baseInsurance/long/phoneVerify?${n.stringify({...k.query,orderNo:K||J})}`,ie=r(),se=r({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:""},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{}},agent:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:[]}}),te=r({sign:[],verify:[],scribing:""});r(!1),r(0);const ne=()=>{if(Y)return void m(C.SIGN,k.query);const e=[];ie.value&&te.value.sign.includes("1")&&e.push(ie.value.validateSign()),Promise.all(e).then((e=>{L({bizObjectId:[],bizObjectType:h.AGENT,orderId:ee.value.id,tenantId:U}).then((({code:e,data:a})=>{"10000"===e&&a&&B.push({path:V.sign,query:k.query})}))})).catch((e=>{v(e.message)}))};r(),r({imgUrl:"",desc:"",title:"",link:ae});return o((()=>{(async()=>{w({orderNo:J,tenantId:U,bizObjectType:"AGENT",category:"SIGN_TEMP"}).then((({code:e,data:a})=>{"10000"===e&&(se.value.agent.signData=a.map((e=>e.fileBase64)))}));let e={};const{code:a,data:i}=await E({orderNo:J,tenantId:U});"10000"===a&&(Object.assign(ee.value,i),e=A(i.insuredList[0].productList),i.tenantOrderAttachmentList.forEach((e=>{e.objectType===O.HOlDER?se.value.holder.signData=e.fileBase64:e.objectType===O.AGENT?se.value.agent.signData=e.fileBase64:e.objectType===O.INSURED&&(se.value.insured.signData[e.objectId]=e.fileBase64)}))),I(e).then((({code:e,data:a})=>{var i;if("10000"===e){const{signMaterialMap:e}=(null==(i=a.productMaterialPlanVOList)?void 0:i[1])||{};(Object.values(e||{}).flat()||[]).forEach((e=>{e.noticeObject===O.AGENT&&se.value.agent.fileList.push({attachmentName:e.materialName,attachmentList:[{...e,materialSource:q(`${null==e?void 0:e.materialSource}`,null==e?void 0:e.materialContent)}]})}))}})),N(e).then((({data:e,code:a})=>{if("10000"===a){const{signInfo:a}=y(e.productFactor);a.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((a=>{e.required&&te.value.sign.push(a.code),"1"===a.code?se.value.agent.isSign=!0:"2"===a.code?se.value.holder.isSign=!0:"3"===a.code?se.value.insured.isSign=!0:"4"===a.code?se.value.holder.isShareSign=!0:"5"===a.code&&(se.value.insured.isShareSign=!0)})),"customerFace"===e.name&&e.columns.forEach((a=>{e.required&&te.value.verify.push(a.code),"1"===a.code?se.value.holder.isVerify=!0:"2"===a.code&&(se.value.insured.isVerify=!0)}))}))}}))})()})),(e,a)=>{const i=S,s=b,t=j;return l(),d("div",P,[c(i),f("div",G,[c(s,{type:"warning",title:"尊敬的客户，本次投保需要进行身份认证",content:"本产品投保需要对投保人、被保人进行实名认证，您购买本产品的累计总保费已超过20万，按监管要求，需要提供投保人、被保人、指定受益人证件影像，本产品非本人投保且带身故责任、需对投保人、被保人（成人）的投保意愿进行签字确认。"})]),f("div",x,[c(_,{ref_key:"agentSignRef",ref:ie,"order-detail":u(ee),"sign-string":u(se).agent.signData,"show-sign":u(se).agent.isSign,"show-verify":u(se).agent.isVerify,"file-list":u(se).agent.fileList,"personal-info":u(se).agent.personalInfo,disabled:!!u(W),title:"代理人",onHandleSign:a[0]||(a[0]=e=>((e,a,i)=>{var s;D(e,a,null==(s=ee.value)?void 0:s.id,U,i)})("AGENT",e))},null,8,["order-detail","sign-string","show-sign","show-verify","file-list","personal-info","disabled"])]),f("div",R,[c(t,{type:"primary",onClick:ne},{default:g((()=>[p("确定")])),_:1})])])}}});export{k as default};
