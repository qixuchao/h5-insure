import{d as e,i as t,h as i,j as o,aP as s,aQ as r,k as a,aR as d,l as u,o as l,c as n,b as c,w as p,v as m,u as f,p as v,f as R,aS as L}from"./index-6a9cf46c.js";import I from"./index-475507b2.js";import{g as k,s as j,i as C,m as h}from"./trial-41b6fd53.js";import g from"./SelectRiskList-32c731f4.js";import{_ as b}from"./TrialButton-2ee2e941.js";import{R as w}from"./trial-d6373768.js";import{u as y}from"./useOrder-d313309a.js";import{p as q,a as P}from"./utils-91ecdfd9.js";import{q as x}from"./createProposal-e1f6da83.js";import{g as _}from"./util-d26fb81f.js";import{f as N,a as O}from"./findLastIndex-b7f0dff6.js";import{c as T}from"./cloneDeep-793b0cc9.js";import"./InsureInfos-84cc911a.js";import"./index-d68eb918.js";import"./infoCollection-974452d5.js";import"./index-e4b4e23c.js";import"./PolicyInfo-6c553e35.js";import"./questionnaire-42dcb602.js";import"./product-7bbf9c44.js";import"./constants-6ad2f07c.js";import"./utils-e3b5b413.js";import"./nextStep-5fc4dcce.js";import"./core-90944064.js";import"./format-31cde443.js";import"./index-ced963d8.js";import"./utils-64e52959.js";const A={class:"page-trial-wrap"},M=e({name:"trial"}),S=e({...M,setup(e){const M=t(),S=i(),{productCode:B,orderNo:D,tenantId:V,proposalId:E,proposalInsuredId:K,productClass:H}=M.query,z=o({}),F=o({productList:[]}),U=o([]),Q=o({}),$=o(),G=o(),J=o(),W=y({extInfo:{buttonCode:s.TRIAL_PREMIUM,pageCode:r.TRIAL_PREMIUM}});_();const X=o(),Y=o(),Z=o(1),ee=a((()=>Z.value===w.MAIN_RISK?"添加主险":"添加附加险")),te=o(!1),ie=()=>{h(F.value).then((({code:e,data:t})=>{if("10000"===e){const{productDetailResList:e,productFactor:i}=t;Y.value=i,F.value=P(e);const o={};e.forEach((e=>{o[e.productCode]=e})),z.value=o}}))},oe=()=>{te.value=!1},se=e=>{if(Z.value===w.MAIN_RISK){F.value.productList.push(...e);const t=e.map((e=>e.productCode));$.value.getProductDefaultValue(t)}else{const t=F.value.productList.find((e=>e.productCode===G.value)),i=e.map((e=>({riskCode:e,riskType:w.RIDER_RISK,mainRiskCode:Q.value.riskCode}))),o=N(t.mergeRiskReqList,(e=>e.riskCode===Q.value.riskCode)),s=O(t.mergeRiskReqList,(e=>e.mainRiskCode===Q.value.riskCode));let r=o;-1!==s&&(r=s),t.mergeRiskReqList=[...t.mergeRiskReqList.slice(0,r+1),...i,...t.mergeRiskReqList.slice(r+1,t.mergeRiskReqList.length)],$.value.getRiderRiskDefaultValue(G.value,e,Q.value.riskCode,t.mergeRiskReqList)}ie(),te.value=!1},re=(e,t,i)=>{te.value=!0,Z.value=w.RIDER_RISK,U.value=i,Q.value=t,G.value=e},ae=e=>{te.value=!0,Z.value=w.MAIN_RISK,U.value=e},de=(e,t,i)=>{z.value[e],i?(z.value[e].productPlanInsureVOList[0].insureProductRiskVOList=z.value[e].productPlanInsureVOList[0].insureProductRiskVOList.filter((e=>e.riskCode!==t)),F.value.productList=F.value.productList.map((i=>(i.productCode===e&&(i.mergeRiskReqList=i.mergeRiskReqList.filter((e=>e.riskCode!==t))),i)))):(F.value.productList=F.value.productList.filter((t=>t.productCode!==e)),ie())},ue=()=>{$.value.onNext((async e=>{var t;const i=T(e),o=["id","relationToHolder","beneficiaryList","guardian","insuredBeneficiaryType"];D||Object.keys(null==(t=i.insuredList)?void 0:t[0]).reduce(((e,t)=>{var s,r,a,d;return!o.includes(t)&&(null==(r=null==(s=i.insuredList)?void 0:s[0])?void 0:r[t])&&(e[t]=null==(d=null==(a=i.insuredList)?void 0:a[0])?void 0:d[t]),e}),i.holder),i.extInfo&&(i.extInfo.iseeBizNo=J.value),i.operateOption={withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0};const{code:s,data:r}=await j(i);"10000"===s&&S.push({path:L.questionNotice,query:{...M.query,orderNo:r}})}))};return d((()=>{D?k({orderNo:D,tenantId:V}).then((({code:e,data:t})=>{"10000"===e&&(X.value=t,W.value=t,F.value=q(t.insuredList[0].productList),ie())})):E?x({id:E,tenantId:V}).then((({code:e,data:t})=>{if("10000"===e){const{holder:e,insuredList:i}=t,o=(B||"").split(",");let s=[];const r=(i||[]).filter((e=>e.id===+K)).map((e=>({...e,relationToHolder:null,productList:e.productList.filter((e=>!!o.includes(e.productCode)&&(s=e.occupationCodeList,!0)))})));r[0].occupationCodeList=s,Object.assign(W.value,{renewFlag:"",holder:e,tenantId:V,proposalId:E,insuredList:r}),X.value=W.value,F.value=q(W.value.insuredList[0].productList),ie()}})):C({productCode:B,isTenant:!1}).then((({data:e,code:t})=>{var i,o;"10000"===t&&(z.value[`${B}`]=e,Y.value=null==(o=null==(i=null==e?void 0:e.productPlanInsureVOList)?void 0:i[0])?void 0:o.productFactor,F.value=P([e]))}))})),u((()=>{setTimeout((async()=>{J.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,t)=>(l(),n("div",A,[c(I,{ref_key:"trialRef",ref:$,"product-collection":f(z),"default-data":f(X),"product-factor":f(Y),"product-risk-code-map":f(F),"is-trial":"","hide-benefit":"",onAddRisk:re,onAddMainRisk:ae,onDeleteRisk:de},{trialBtn:p((({riskPremium:e})=>[c(b,{premium:null==e?void 0:e.initialPremium,onHandleClick:ue},{label:p((()=>[m(" 首年总保费 ")])),_:2},1032,["premium"])])),_:1},8,["product-collection","default-data","product-factor","product-risk-code-map"]),f(te)?(l(),v(g,{key:0,type:f(Z),"product-class":f(H),show:f(te),"insured-list":f(U),title:f(ee),"current-product-code":f(G),"main-risk-code":f(Q).riskCode,"select-list":f(F).productList,onCancel:oe,onConfirm:se},null,8,["type","product-class","show","insured-list","title","current-product-code","main-risk-code","select-list"])):R("",!0)]))}});export{S as default};
