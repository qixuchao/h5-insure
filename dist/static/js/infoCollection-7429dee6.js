import{d as e,X as a,Y as t,u as o,z as n,r,L as i,Z as s,o as l,b as d,c as u,e as c,w as p,f as m,g as f,h as v,i as h,a2 as I,j as C,n as O,T as y,P as j,p as b,a3 as _,a4 as L,C as x}from"./index-99483157.js";import{t as g}from"./ProRenderFormWithCard.vue_vue_type_style_index_0_scoped_true_lang-5abc36b5.js";/* empty css              */import"./bankCard-409da555.js";import{_ as P}from"./PayInfo-5e7b81d8.js";import{g as w,i as T}from"./trial-b1228b50.js";import{_ as V}from"./TrialButton-d9ff3a27.js";import{n as N}from"./nextStep-1ba4b9f9.js";import{u as k}from"./useAttachment-8b9207dd.js";import{a as E,q as S}from"./product-1c29f091.js";import{t as F,g as R}from"./utils-32f387b4.js";import{u as q}from"./useOrder-5dbc0311.js";import{P as A,B as U}from"./constants-7afb7c3d.js";import{f as D}from"./utils-77be69dd.js";import{T as B}from"./index-99a8cd28.js";import"./pdfh5-008ca364.js";import"./phoneVerify-ee80639e.js";import"./_initCloneObject-0663309f.js";import"./isObjectLike-a9798079.js";import"./debounce-eed12388.js";import"./index-eeafee36.js";import"./index-85d79b7e.js";import"./index-6020ef38.js";import"./core-9936527f.js";import"./constant-8927d485.js";import"./infoCollection-fdacac20.js";import"./trial-70467aac.js";import"./createProposal-f1fa8066.js";import"./index-bc98977d.js";import"./cloneDeep-1de8e9b0.js";import"./index-735da028.js";import"./index-756f8a12.js";import"./empty-c926d8ec.js";import"./box-title-ec71b0a9.js";import"./index-ec6d4bf5.js";import"./echarts-ac920fed.js";import"./Table-bd6b5e68.js";const H={class:"long-info-collection"},M=e({__name:"infoCollection",setup(e){const M=a((()=>t((()=>import("./index-1a46dc56.js")),["static/js/index-1a46dc56.js","static/css/index-fa4edf2a.css","static/js/index-99483157.js","static/css/index-491aafee.css","static/js/pdfh5-008ca364.js","static/js/index-6020ef38.js","static/css/index-827a8544.css","static/js/utils-32f387b4.js","static/js/infoCollection-fdacac20.js","static/js/trial-70467aac.js"]))),J=a((()=>t((()=>import("./index-9c30d3bd.js")),["static/js/index-9c30d3bd.js","static/css/index-3329e46f.css","static/js/index-99483157.js","static/css/index-491aafee.css","static/js/pdfh5-008ca364.js"]))),W=o(),z=q(),{productCode:G="",tenantId:X,agentCode:Y="",agencyCode:$,saleChannelId:Q,isShare:Z,orderNo:K,extraInfo:ee,insurerCode:ae,preview:te}=W.query;let oe={};try{oe=JSON.parse(decodeURIComponent(ee))}catch(Ae){}const ne=n({isView:!1,personalInfo:{},payInfo:{schema:[],config:[],formData:[]},defaultValue:null,isAutoChange:!1}),re=`${window.origin}/baseInsurance/long/phoneVerify${window.location.search}`,ie=r({imgUrl:"",desc:"",title:"",link:re}),se=r(),le=r(),de=r({}),ue=r({}),ce=r([]),pe=r(),me=r({}),fe=r(!1),ve=r(!1),he=r(0),Ie=r(!0),{fileList:Ce,mustReadFileCount:Oe,popupFileList:ye}=k(me,pe),je=r(!1),be=r(!1),_e=()=>{ve.value=!1,Ie.value=!0,ce.value.length<1||(fe.value=!0)},Le=()=>{fe.value=!1,ve.value=!1,Ie.value=!0};r({}),r(!1);const xe=r([{}]),ge=r(""),Pe=r(0),we=r(!1);r();const Te=r();r(),i((()=>{var e,a;const{insureProductRiskVOList:t}=(null==(a=null==(e=ue.value)?void 0:e.productPlanInsureVOList)?void 0:a[0])||{};return(t||[]).find((e=>e.mainRiskFlag===s.YES))}));const Ve=r(0),Ne=r({}),ke=()=>{ge.value="试算中...",Pe.value=0,we.value=!0},Ee=e=>{ge.value="",Ve.value=e.premium,Pe.value=e,we.value=!1},Se=(e={},a={},t={})=>{var o;const n={...t},{tenantOrderHolder:r,tenantOrderInsuredList:i}=D({holder:null==(o=ne.personalInfo.holder)?void 0:o.personVO,insuredList:(ne.personalInfo.insuredVOList||[]).map((e=>e.personVO))}),s={tenantId:X,riskList:xe.value||[],riskPremium:a,productId:e.id};return n.extInfo.iseeBizNo=Te.value,n.productCode=e.productCode,n.commencementTime=n.insuranceStartDate,n.expiryDate=n.insuranceEndDate,n.premium=Ve.value,n.orderAmount=Ve.value,n.orderRealAmount=Ve.value,n.tenantOrderHolder=r,n.tenantOrderInsuredList=i.map((a=>({...a,certType:a.certType||x.CERT,certNo:(a.certNo||"").toLocaleUpperCase(),planCode:me.value.planCode,tenantOrderProductList:[{premium:Ve.value,productCode:e.productCode,productName:e.productName,planCode:me.value.planCode,tenantOrderRiskList:F(s)}]}))),n},Fe=async()=>{var e,a,t;te?O(A.INFO_COLLECTION,W.query):je.value?Promise.all([null==(e=le.value)?void 0:e.validate(!1),null==(t=null==(a=se.value)?void 0:a.validate)?void 0:t.call(a)]).then((()=>{Object.assign(z.value,{extInfo:{...z.value.extInfo,buttonCode:U.INFO_COLLECTION,pageCode:A.INFO_COLLECTION}});const e=Se(ue.value,Ne.value,z.value);N(e,((e,a)=>{a===j.JUMP_PAGE&&(console.log("12313"),b(e.nextPageCode,W.query))}))})):y("请勾选投保人阅读并接受")},Re=e=>{le.value.validateHolder("mobile").then((()=>{Object.assign(z.value,{extInfo:{...z.value.extInfo,buttonCode:U.INFO_COLLECTION,pageCode:A.INFO_COLLECTION}});const a=Se(ue.value,Ne.value,z.value);N(a,((a,t)=>{t===j.JUMP_PAGE&&(null==e||e())}))})).catch((()=>{y("请录入投保人手机号后进行分享")}))};n({tenantOrderPayInfoList:[]});const qe=async()=>{E({productCode:G,tenantId:X}).then((({data:e,code:a})=>{if("10000"===a){de.value=e;const{wxShareConfig:a,showWXShare:t,title:o,desc:n,image:r}=(null==e?void 0:e.PRODUCT_LIST)||{};t?Object.assign(ie.value,{...a,isShare:t}):Object.assign(ie.value,{title:o,desc:n,image:r,isShare:t}),_(e.BASIC_INFO.themeType)}})),K&&w({orderNo:K,tenantId:X}).then((({code:e,data:a})=>{"10000"===e&&(Pe.value=a.orderAmount,Object.assign(z.value,a,{tenantOrderPayInfoList:a.tenantOrderPayInfoList||[],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0,withPayInfo:!0},productCode:G}),ne.defaultValue=z.value,be.value=!0)})),S({productCode:G}).then((({code:e,data:a})=>{var t,o,n,r;if("10000"===e){const{productMaterialPlanVOList:e,productQuestionnaireVOList:i}=a;pe.value=e||[];const{basicInfo:{questionnaireType:s},questions:l,questionnaireName:d}=(null==(t=null==i?void 0:i[0])?void 0:t.questionnaireDetailResponseVO)||{basicInfo:{}};s&&(ce.value=2===s?[{attachmentName:d,attachmentUri:l,attachmentType:"question"}]:[{attachmentName:d,attachmentUri:null==(o=null==l?void 0:l[0])?void 0:o.content,attachmentType:R(String(null==(n=null==l?void 0:l[0])?void 0:n.textType),null==(r=null==l?void 0:l[0])?void 0:r.content)}])}})),await T({productCode:G,isTenant:!te}).then((({data:e,code:a})=>{var t,o;if("10000"===a){ue.value=e,me.value=(null==(t=e.productPlanInsureVOList)?void 0:t[0])||{};const{payInfo:a}=g(null==(o=me.value)?void 0:o.productFactor);ne.payInfo={...ne.payInfo,...a}}}))};return l((()=>{qe()})),(e,a)=>{const t=L,o=d("ProPageWrap");return u(),c(o,null,{default:p((()=>{var e,o;return[m("div",H,[f(ne).defaultValue?(u(),c(B,{key:0,"data-source":f(me),"product-info":{productCode:f(G),productName:f(ue).productName,insurerCode:f(ae),tenantId:f(X)},"tenant-product-detail":f(de),"hide-benefit":"","default-data":[f(ne).defaultValue],onTrialStart:ke,onTrialEnd:Ee},null,8,["data-source","product-info","tenant-product-detail","default-data"])):v("",!0),f(ne).payInfo.schema.length?(u(),c(f(P),{key:1,ref_key:"payInfoRef",ref:se,modelValue:f(z).tenantOrderPayInfoList,"onUpdate:modelValue":a[0]||(a[0]=e=>f(z).tenantOrderPayInfoList=e),schema:f(ne).payInfo.schema,"is-view":f(ne).isView},null,8,["modelValue","schema","is-view"])):v("",!0),h(t,null,{default:p((()=>{var e;return[(null==(e=f(Ce))?void 0:e.length)?(u(),c(f(J),{key:0,modelValue:f(je),"onUpdate:modelValue":a[1]||(a[1]=e=>I(je)?je.value=e:null),"attachment-list":f(Ce),"is-show-radio":"","pre-text":"投保人阅读并接受",onPreviewFile:a[2]||(a[2]=e=>(e=>{he.value=e,ve.value=!0})(e))},null,8,["modelValue","attachment-list"])):v("",!0)]})),_:1}),h(V,{"is-share":f(ie).isShare&&!f(Z),premium:f(Pe),"share-info":f(ie),"loading-text":f(ge),"payment-frequency":null==(o=null==(e=f(xe))?void 0:e[0])?void 0:o.paymentFrequency,"tenant-product-detail":f(de),"handle-share":Re,onHandleClick:Fe},{default:p((()=>[C("下一步")])),_:1},8,["is-share","premium","share-info","loading-text","payment-frequency","tenant-product-detail"]),f(ve)?(u(),c(f(M),{key:2,show:f(ve),"onUpdate:show":a[3]||(a[3]=e=>I(ve)?ve.value=e:null),"content-list":f(Ie)?f(Ce):f(ye),"is-only-view":f(Ie),"active-index":f(he),text:f(Ie)?"关闭":"我已逐页阅读并确认告知内容","force-read-count":f(Ie)?0:f(Oe),onSubmit:_e,onOnCloseFilePreviewByMask:Le},null,8,["show","content-list","is-only-view","active-index","text","force-read-count"])):v("",!0)])]})),_:1})}}});export{M as default};
