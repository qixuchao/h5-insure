import{d as e,X as t,Y as a,u as n,z as o,r,L as i,Z as s,o as l,b as d,c as u,e as c,w as p,f as m,i as f,g as v,h as I,a2 as h,j as O,n as y,T as C,P as j,p as L,a3 as _,a4 as b,C as x}from"./index-b419c4de.js";import{t as g}from"./ProRenderFormWithCard.vue_vue_type_style_index_0_scoped_true_lang-25d81bce.js";/* empty css              */import"./bankCard-303af999.js";import{_ as P}from"./PayInfo-fbf8a05e.js";import{g as w,i as V}from"./trial-92a4c937.js";import{_ as T}from"./TrialButton-3370bf79.js";import{n as N}from"./nextStep-1ae186ea.js";import{u as E}from"./useAttachment-27257175.js";import{a as S,q as k}from"./product-6a371fd1.js";import{t as F,g as R}from"./utils-f99858fa.js";import{u as q}from"./useOrder-7e4863e8.js";import{P as A,B as U}from"./constants-7afb7c3d.js";import{o as D,f as B}from"./utils-314965b3.js";import{T as H}from"./index-ba41fd7f.js";import"./pdfh5-008ca364.js";import"./phoneVerify-1df44e15.js";import"./_initCloneObject-0663309f.js";import"./isObjectLike-a9798079.js";import"./debounce-eed12388.js";import"./index-3cdf0efd.js";import"./index-1a5ae392.js";import"./index-4e2599d4.js";import"./core-2cd43e87.js";import"./constant-8927d485.js";import"./infoCollection-2ed3ceeb.js";import"./trial-d4f76514.js";import"./createProposal-c6a8f5f9.js";import"./index-4a2f5da3.js";import"./cloneDeep-1de8e9b0.js";import"./index-27de7c4f.js";import"./index-fe8e50e7.js";import"./empty-c926d8ec.js";import"./box-title-562d4bff.js";import"./index-c479978a.js";import"./echarts-ac920fed.js";import"./Table-fd6956c3.js";const M={class:"long-info-collection"},J=e({__name:"infoCollection",setup(e){const J=t((()=>a((()=>import("./index-e397fab3.js")),["static/js/index-e397fab3.js","static/css/index-fa4edf2a.css","static/js/index-b419c4de.js","static/css/index-491aafee.css","static/js/pdfh5-008ca364.js","static/js/index-4e2599d4.js","static/css/index-827a8544.css","static/js/utils-f99858fa.js","static/js/infoCollection-2ed3ceeb.js","static/js/trial-d4f76514.js"]))),W=t((()=>a((()=>import("./index-879cfdd0.js")),["static/js/index-879cfdd0.js","static/css/index-3329e46f.css","static/js/index-b419c4de.js","static/css/index-491aafee.css","static/js/pdfh5-008ca364.js"]))),z=n(),G=q(),{productCode:X="",tenantId:Y,agentCode:$="",agencyCode:Q,saleChannelId:Z,isShare:K,orderNo:ee,extraInfo:te,insurerCode:ae,preview:ne}=z.query;let oe={};try{oe=JSON.parse(decodeURIComponent(te))}catch(Ue){}const re=o({isView:!1,personalInfo:{},payInfo:{schema:[],config:[],formData:[]},defaultValue:{},isAutoChange:!1}),ie=`${window.origin}/baseInsurance/long/phoneVerify${window.location.search}`,se=r({imgUrl:"",desc:"",title:"",link:ie}),le=r(),de=r(),ue=r({}),ce=r({}),pe=r([]),me=r(),fe=r({}),ve=r(!1),Ie=r(!1),he=r(0),Oe=r(!0),{fileList:ye,mustReadFileCount:Ce,popupFileList:je}=E(fe,me),Le=r(!1),_e=r(!1),be=()=>{Ie.value=!1,Oe.value=!0,pe.value.length<1||(ve.value=!0)},xe=()=>{ve.value=!1,Ie.value=!1,Oe.value=!0};r({}),r(!1);const ge=r([{}]),Pe=r(""),we=r(0),Ve=r(!1);r();const Te=r();r(),i((()=>{var e,t;const{insureProductRiskVOList:a}=(null==(t=null==(e=ce.value)?void 0:e.productPlanInsureVOList)?void 0:t[0])||{};return(a||[]).find((e=>e.mainRiskFlag===s.YES))}));const Ne=r(0),Ee=r({}),Se=()=>{Pe.value="试算中...",we.value=0,Ve.value=!0},ke=e=>{Pe.value="",Ne.value=e.premium,we.value=e,Ve.value=!1},Fe=(e={},t={},a={})=>{var n;const o={...a},{tenantOrderHolder:r,tenantOrderInsuredList:i}=B({holder:null==(n=re.personalInfo.holder)?void 0:n.personVO,insuredList:(re.personalInfo.insuredVOList||[]).map((e=>e.personVO))}),s={tenantId:Y,riskList:ge.value||[],riskPremium:t,productId:e.id};return o.extInfo.iseeBizNo=Te.value,o.productCode=e.productCode,o.commencementTime=o.insuranceStartDate,o.expiryDate=o.insuranceEndDate,o.premium=Ne.value,o.orderAmount=Ne.value,o.orderRealAmount=Ne.value,o.tenantOrderHolder=r,o.tenantOrderInsuredList=i.map((t=>({...t,certType:t.certType||x.CERT,certNo:(t.certNo||"").toLocaleUpperCase(),planCode:fe.value.planCode,tenantOrderProductList:[{premium:Ne.value,productCode:e.productCode,productName:e.productName,planCode:fe.value.planCode,tenantOrderRiskList:F(s)}]}))),o},Re=async()=>{var e,t,a;ne?y(A.INFO_COLLECTION,z.query):Le.value?Promise.all([null==(e=de.value)?void 0:e.validate(!1),null==(a=null==(t=le.value)?void 0:t.validate)?void 0:a.call(t)]).then((()=>{Object.assign(G.value,{extInfo:{...G.value.extInfo,buttonCode:U.INFO_COLLECTION,pageCode:A.INFO_COLLECTION}});const e=Fe(ce.value,Ee.value,G.value);N(e,((e,t)=>{t===j.JUMP_PAGE&&(console.log("12313"),L(e.nextPageCode,z.query))}))})):C("请勾选投保人阅读并接受")},qe=e=>{de.value.validateHolder("mobile").then((()=>{Object.assign(G.value,{extInfo:{...G.value.extInfo,buttonCode:U.INFO_COLLECTION,pageCode:A.INFO_COLLECTION}});const t=Fe(ce.value,Ee.value,G.value);N(t,((t,a)=>{a===j.JUMP_PAGE&&(null==e||e())}))})).catch((()=>{C("请录入投保人手机号后进行分享")}))};o({tenantOrderPayInfoList:[]});const Ae=async()=>{S({productCode:X,tenantId:Y}).then((({data:e,code:t})=>{if("10000"===t){ue.value=e;const{wxShareConfig:t,showWXShare:a,title:n,desc:o,image:r}=(null==e?void 0:e.PRODUCT_LIST)||{};a?Object.assign(se.value,{...t,isShare:a}):Object.assign(se.value,{title:n,desc:o,image:r,isShare:a}),_(e.BASIC_INFO.themeType)}})),ee&&w({orderNo:ee,tenantId:Y}).then((({code:e,data:t})=>{if("10000"===e){we.value=t.orderAmount,Object.assign(G.value,t,{tenantOrderPayInfoList:t.tenantOrderPayInfoList||[],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0,withPayInfo:!0}}),(()=>{const e={},{tenantOrderHolder:t,tenantOrderInsuredList:a}=G.value;e.holder={personVO:{...t,...t.extInfo}},e.insuredVOList=(a||[]).map((e=>({personVO:{...e,...e.extInfo,beneficiaryList:e.tenantOrderBeneficiaryList.map((e=>({personVO:e})))}}))),Object.assign(re.personalInfo,e)})();const e=D(t,ce.value,"");re.defaultValue=e,_e.value=!0}})),k({productCode:X}).then((({code:e,data:t})=>{var a,n,o,r;if("10000"===e){const{productMaterialPlanVOList:e,productQuestionnaireVOList:i}=t;me.value=e||[];const{basicInfo:{questionnaireType:s},questions:l,questionnaireName:d}=(null==(a=null==i?void 0:i[0])?void 0:a.questionnaireDetailResponseVO)||{basicInfo:{}};s&&(pe.value=2===s?[{attachmentName:d,attachmentUri:l,attachmentType:"question"}]:[{attachmentName:d,attachmentUri:null==(n=null==l?void 0:l[0])?void 0:n.content,attachmentType:R(String(null==(o=null==l?void 0:l[0])?void 0:o.textType),null==(r=null==l?void 0:l[0])?void 0:r.content)}])}})),await V({productCode:X,isTenant:!ne}).then((({data:e,code:t})=>{var a,n;if("10000"===t){ce.value=e,fe.value=(null==(a=e.productPlanInsureVOList)?void 0:a[0])||{};const{payInfo:t}=g(null==(n=fe.value)?void 0:n.productFactor);re.payInfo={...re.payInfo,...t}}}))};return l((()=>{Ae()})),(e,t)=>{const a=b,n=d("ProPageWrap");return u(),c(n,null,{default:p((()=>{var e,n;return[m("div",M,[f(H,{"data-source":v(fe),"product-info":{productCode:v(X),productName:v(ce).productName,insurerCode:v(ae),tenantId:v(Y)},"tenant-product-detail":v(ue),"hide-benefit":"","default-data":v(re).personalInfo,onTrialStart:Se,onTrialEnd:ke},null,8,["data-source","product-info","tenant-product-detail","default-data"]),v(re).payInfo.schema.length?(u(),c(v(P),{key:0,ref_key:"payInfoRef",ref:le,modelValue:v(G).tenantOrderPayInfoList,"onUpdate:modelValue":t[0]||(t[0]=e=>v(G).tenantOrderPayInfoList=e),schema:v(re).payInfo.schema,"is-view":v(re).isView},null,8,["modelValue","schema","is-view"])):I("",!0),f(a,null,{default:p((()=>{var e;return[(null==(e=v(ye))?void 0:e.length)?(u(),c(v(W),{key:0,modelValue:v(Le),"onUpdate:modelValue":t[1]||(t[1]=e=>h(Le)?Le.value=e:null),"attachment-list":v(ye),"is-show-radio":"","pre-text":"投保人阅读并接受",onPreviewFile:t[2]||(t[2]=e=>(e=>{he.value=e,Ie.value=!0})(e))},null,8,["modelValue","attachment-list"])):I("",!0)]})),_:1}),f(T,{"is-share":v(se).isShare&&!v(K),premium:v(we),"share-info":v(se),"loading-text":v(Pe),"payment-frequency":null==(n=null==(e=v(ge))?void 0:e[0])?void 0:n.paymentFrequency,"tenant-product-detail":v(ue),"handle-share":qe,onHandleClick:Re},{default:p((()=>[O("下一步")])),_:1},8,["is-share","premium","share-info","loading-text","payment-frequency","tenant-product-detail"]),v(Ie)?(u(),c(v(J),{key:1,show:v(Ie),"onUpdate:show":t[3]||(t[3]=e=>h(Ie)?Ie.value=e:null),"content-list":v(Oe)?v(ye):v(je),"is-only-view":v(Oe),"active-index":v(he),text:v(Oe)?"关闭":"我已逐页阅读并确认告知内容","force-read-count":v(Oe)?0:v(Ce),onSubmit:be,onOnCloseFilePreviewByMask:xe},null,8,["show","content-list","is-only-view","active-index","text","force-read-count"])):I("",!0)])]})),_:1})}}});export{J as default};
