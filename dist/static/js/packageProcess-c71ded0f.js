var Xe=Object.defineProperty,Qe=Object.defineProperties;var Ze=Object.getOwnPropertyDescriptors;var de=Object.getOwnPropertySymbols;var ea=Object.prototype.hasOwnProperty,aa=Object.prototype.propertyIsEnumerable;var me=(N,f,y)=>f in N?Xe(N,f,{enumerable:!0,configurable:!0,writable:!0,value:y}):N[f]=y,m=(N,f)=>{for(var y in f||(f={}))ea.call(f,y)&&me(N,y,f[y]);if(de)for(var y of de(f))aa.call(f,y)&&me(N,y,f[y]);return N},p=(N,f)=>Qe(N,Ze(f));import{g as ta,a9 as ra,O as oa,E as g,M as pe,y as ee,T as P,_ as ua,l as na,h as sa,r as fe,af as la,j as $,n as he,p as _,m as ae,H as ia,t as te,z as U,A as D,J as K,C as be,k as ve,F as ca,D as da,X as ma}from"./vendor-17026bfd.js";import{_ as pa,C as Fe,I as De,a0 as fa,H as ha,a2 as ye}from"./index-6c5e1be0.js";import{a as T}from"./order-26db6dbf.js";import{S as k,R as H,f as Ee,I as va}from"./infoCollection-192ba138.js";import{p as ge,i as Fa,s as Da,g as ya,a as Ea,u as ga,b as Ca}from"./trial-47f3f6a0.js";import{p as Ia}from"./product-68ed653b.js";import{g as re,a as Ce,o as Ie,t as Na,b as _a,h as Ne}from"./utils-a61723a1.js";import{t as Aa}from"./theme-ea709837.js";import{d as _e,B as wa,D as Ba,G as Ta,S as ba,H as Pa,P as ka,U as Sa,_ as Oa,W as Ua,c as W,f as Ae,o as we,a as G,n as Be,h as Te}from"./auth-3923102c.js";import{_ as Ha}from"./index-560e0eb2.js";import"./utils-b6782348.js";import"./trial-cd62ceda.js";import"./index-0a4540a4.js";import"./bankCard-0e4ce564.js";import"./phoneVerify-665002fc.js";const La={key:0},Ra={class:"page-internet-product-detail"},xa={class:"info"},Ma={class:"footer-button"},Va={class:"price"},Ya=be(" \u603B\u4FDD\u8D39"),qa=ta({setup(N){const f=ra(),y=oa(),{productCode:j="BWYL2021",tenantId:C,orderNo:S,phoneNo:L,agentCode:R="",saleChannelId:Pe,paymentMethod:E,certNo:oe,name:ue,pageCode:x,from:ke}=y.query,M=g(),h=g(),V=g(),w=g(),O=x==="payBack",z=g(!1),Y=g(!1),b=g(!1),ne=g(0),J=g(!1),X=g(!1),q=g({show:!1,html:""});let Q="";const a=pe({holder:{certNo:oe,certType:Fe.CERT,mobile:L,name:ue,socialFlag:k.HAS},insured:{certNo:oe,certType:Fe.CERT,name:ue,socialFlag:k.HAS,relationToHolder:H.SELF},paymentMethod:E,renewalDK:"Y",paymentFrequency:Ee.YEAR,packageProductList:[],mobileSmsCode:""}),A=g(_e),I=g(_e),s=pe({showInsure:!O,canInsure:!1,canUpgrade:!1}),Se=ee(()=>{var t,r;return((r=(t=h.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:r.attachmentVOList.filter(e=>e.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),Oe=ee(()=>{var t,r;return((r=(t=h.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:r.attachmentVOList.filter(e=>e.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),Z=ee(()=>{if(a.holder.certNo){const t=re(a.holder.certNo,"year"),r=De(a.holder.certNo);if(t<18)return P("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E18\u5C81\uFF01"),!1;if(a.insured.certNo&&a.insured.relationToHolder===H.MATE){const e=De(a.insured.certNo);if(r===e)return P("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(a.insured.certNo){const t=re(a.holder.certNo,"day"),r=re(a.holder.certNo,"year");if(a.insured.relationToHolder===H.CHILD&&t<30)return P("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(a.insured.relationToHolder===H.PARENT&&r>=71)return P("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E70\u5C81\uFF01"),!1}return!0}),Ue=()=>{const{holder:{certNo:t,mobile:r,name:e,socialFlag:n},insured:{certNo:o,name:u,socialFlag:l,relationToHolder:c},paymentMethod:v}=a;return!!(ha(o)&&!!l)},se=()=>{f.push({path:"/internet/guaranteeUpgrade",query:p(m({},y.query),{tenantId:C,productCode:"BWYL2022",orderNo:S,agentCode:R})})},He=()=>{X.value=!1},Le=()=>{I.value=A.value},Re=()=>{I.value=p(m({},I.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},xe=async t=>{P.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const r=await ga(t),{code:e}=r;if(e==="10000"){P.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const n=await Ca({orderNo:t.orderNo,tenantId:C}),{data:o}=n;n.code==="10000"&&(o.type===2?(q.value={show:!0,html:o.paymentUrl},console.log("data.paymentUrl",q.value),ma(()=>{console.log("document.forms",document.forms);const u=document.getElementById("cashierSubmit");u==null||u.addEventListener("submit",l=>{l.preventDefault()}),u==null||u.submit()})):window.location.href=o.paymentUrl)}s.canInsure=!0}catch{s.canInsure=!0}},Me=t=>`${ye}/pay?orderNo=${t}&saleUserId=${R}&tenantId=${C}`,Ve=t=>`${ye}/internet/payFail?tenantId=${C}&orderNo=${t}&agentCode=${R}&pageCode=payBack&from=${ke||"normal"}`,Ye=async t=>{console.log("risk",t);const r=_a({tenantId:C,saleUserId:R,saleChannelId:Pe,detail:h.value,insureDetail:V.value,paymentMethod:a.paymentMethod,renewalDK:a.renewalDK,iseeBizNo:Q,successJumpUrl:"",premium:w.value,holder:a.holder,insured:a.insured,tenantOrderRiskList:t,orderStatus:"",orderTopStatus:""});try{const e=await Da(r),{code:n,data:o}=e;n==="10000"&&xe(p(m({},r),{orderNo:o.data,extInfo:{extraInfo:{renewalDK:a.renewalDK,paymentMethod:a.paymentMethod,successJumpUrl:Me(o.data),failUrl:Ve(o.data)},iseeBizNo:Q}}))}catch{s.canInsure=!0}},qe=async()=>{if(!Z.value)return{};const{calcData:t,riskVOList:r}=Ce({holder:a.holder,insured:a.insured,tenantId:C,productDetail:h.value,insureDetail:V.value,paymentFrequency:a.paymentFrequency,packageRiskIdList:Ie(a.packageProductList)},!1,Ne),e=await ge(t),{code:n,data:o}=e;return n==="10000"?(w.value=o.premium,{condition:r,data:o}):{}},$e=t=>{ne.value=t,b.value=!0},Ke=()=>new Promise((t,r)=>{var e,n;(n=(e=M.value)==null?void 0:e.validateForm)==null||n.call(e).then(async()=>{var d;if(console.log("checkCustomerResult.value",Z.value),!Z.value)return;if(!(((d=M.value)==null?void 0:d.isAgreeFile)||z.value)){b.value=!0,$e(0);return}const{calcData:u,riskVOList:l}=Ce({holder:a.holder,insured:a.insured,tenantId:C,productDetail:h.value,insureDetail:V.value,paymentFrequency:a.paymentFrequency,packageRiskIdList:Ie(a.packageProductList)},!1,Ne),c=await ge(u),{code:v,data:F}=c;v==="10000"?(w.value=F.premium,t({condition:l,data:F})):r(new Error)}).catch(()=>{s.canInsure=!0})}),le=async()=>{var t;if(O){se();return}s.canInsure=!1;try{const{condition:r,data:e}=await Ke(),n={},o=(l=[])=>{(l||[]).forEach(c=>{var v;n[c.riskCode]=c,((v=c.riskPremiumDetailVOList)==null?void 0:v.length)&&o(c.riskPremiumDetailVOList)})};o(e.riskPremiumDetailVOList);const u=Na({tenantId:C,riskList:r,riskPremium:n,productId:(t=h.value)==null?void 0:t.id});Ye(u)}catch{s.canInsure=!0}},We=t=>{t==="allFalse"?(Y.value=!1,le(),s.canInsure=!0):da.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"}).then(()=>{window.history.back()}).catch(()=>{var r;(r=M.value)==null||r.reEditForm(),z.value=!1,s.canInsure=!0})},Ge=()=>{z.value=!0,b.value=!1,Y.value=!0};ua([()=>a.insured.certNo,()=>a.insured.socialFlag,()=>a.packageProductList,()=>a.paymentFrequency],na.exports.debounce(()=>{a.insured.certNo&&a.insured.socialFlag&&Ue()&&qe()},500),{deep:!0,immediate:!0});const ie=async()=>{var n,o,u,l,c,v,F,d;const t=await ya({orderNo:S,tenantId:C}),{code:r,data:e}=t;if(r==="10000"){const{tenantOrderHolder:i,tenantOrderInsuredList:B,extInfo:ce}=e;if(!O){Object.assign(a,{holder:{certNo:i.certNo,certType:i.certType,mobile:i.mobile,name:i.name,socialFlag:k.HAS},insured:{certNo:i.certNo,certType:i.certType,name:i.name,socialFlag:k.HAS,relationToHolder:H.SELF},paymentMethod:E,renewalDK:"Y"}),s.canInsure=!0,I.value=Be,A.value=Be;return}Object.assign(a,{holder:{certNo:i.certNo,certType:i.certType,mobile:i.mobile,name:i.name,socialFlag:k.HAS},insured:{certNo:B==null?void 0:B[0].certNo,certType:(n=B[0])==null?void 0:n.certType,name:(o=B[0])==null?void 0:o.name,socialFlag:(l=(u=B[0])==null?void 0:u.extInfo)==null?void 0:l.hasSocialInsurance,relationToHolder:(c=B[0])==null?void 0:c.relationToHolder},paymentMethod:ce.extraInfo.paymentMethod,renewalDK:ce.extraInfo.renewalDK||"N"}),w.value=(d=(F=(v=B[0])==null?void 0:v.tenantOrderProductList)==null?void 0:F[0])==null?void 0:d.premium,(e.orderStatus===T.ACCEPT_POLICY||e.orderStatus===T.PAYMENT_SUCCESS)&&(s.canUpgrade=!0,J.value=!1,X.value=!0),e.orderStatus===T.PAYING&&(J.value=!0,setTimeout(()=>{ie()},3*1e3))}},je=async()=>{var n,o,u,l,c,v;console.log("\u77ED\u4FE1\u8FDB\u5165\uFF0C\u5E26\u4E86orderNo, mobile");const t=await Ea({holderPhone:L,orderStatus:[T.PAYING.toUpperCase(),T.TIMEOUT.toUpperCase(),"ACCEPT_POLICY"],productCode:j,tenantId:C}),{code:r,data:e}=t;if(e.orderStatus===T.ACCEPT_POLICY&&(console.log("\u5DF2\u627F\u4FDD\uFF0C\u88AB\u4FDD\u4EBA\u4FE1\u606F\u4E0D\u80FD\u4FEE\u6539"),I.value=p(m({},Te),{paymentDisable:!!E}),A.value=p(m({},Te),{paymentDisable:!!E})),(e.orderStatus===T.PAYING||e.orderStatus===T.TIMEOUT)&&(console.log("\u652F\u4ED8\u4E2D\uFF0C\u8D85\u65F6\u53EF\u4EE5\u4FEE\u6539\u6295\u4FDD\u4EBA\u4FE1\u606F"),I.value=p(m({},G),{paymentDisable:!!E}),A.value=p(m({},G),{paymentDisable:!!E})),r==="10000"&&((n=e==null?void 0:e.tenantOrderHolder)==null?void 0:n.certNo)){s.canInsure=!0;const{tenantOrderHolder:F,tenantOrderInsuredList:d,extInfo:i}=e;Object.assign(a,{holder:{certNo:F.certNo,certType:F.certType,mobile:F.mobile,name:F.name,socialFlag:k.HAS},insured:{certNo:d==null?void 0:d[0].certNo,certType:(o=d[0])==null?void 0:o.certType,name:(u=d[0])==null?void 0:u.name,socialFlag:(c=(l=d[0])==null?void 0:l.extInfo)==null?void 0:c.hasSocialInsurance,relationToHolder:(v=d[0])==null?void 0:v.relationToHolder},paymentMethod:E||i.extraInfo.paymentMethod,renewalDK:i.extraInfo.renewalDK})}else I.value=p(m({},W),{paymentDisable:!!E}),A.value=p(m({},W),{paymentDisable:!!E}),s.canInsure=!0},ze=async()=>{const t=Ia({productCode:j,withInsureInfo:!0,tenantId:C}),r=Fa({productCode:j});await Promise.all([t,r]).then(([e,n])=>{var o,u;e.code==="10000"&&(h.value=e.data,document.title=((o=e.data)==null?void 0:o.productFullName)||""),n.code==="10000"&&(a.packageProductList=(((u=n.data)==null?void 0:u.packageProductVOList)||[]).map(l=>p(m({},l),{value:va.UN_INSURE,disabled:!1})),V.value=n.data)}),S?ie():L&&x==="productDetail"&&je()},Je=()=>{x==="free"?O?(I.value=p(m({},Ae),{paymentDisable:!!E}),A.value=p(m({},Ae),{paymentDisable:!!E}),s.canInsure=!0):(I.value=p(m({},W),{paymentDisable:!!E}),A.value=p(m({},W),{paymentDisable:!!E}),s.canInsure=!0):O?(I.value=we,A.value=we,console.log("\u652F\u4ED8\u5B8C\u6210\u8FDB\u5165")):L||S||(console.log("\u6295\u4FDD\u94FE\u63A5"),I.value=G,A.value=G,s.canInsure=!0)};return sa(()=>{Je(),ze(),setTimeout(async()=>{Q=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(t,r)=>{const e=fe("van-button"),n=fe("van-config-provider"),o=la("dompurify-html");return $(),he(ca,null,[_(n,{"theme-vars":D(Aa)},{default:ae(()=>{var u,l,c,v,F,d,i;return[q.value.show?ia(($(),he("div",La,null,512)),[[o,q.value.html]]):te("",!0),U("div",Ra,[U("div",xa,[_(wa,{url:(l=(u=h.value)==null?void 0:u.tenantProductInsureVO)==null?void 0:l.banner[0]},null,8,["url"]),_(Ba,{"product-name":(c=h.value)==null?void 0:c.productFullName,"product-desc":(F=(v=h.value)==null?void 0:v.showConfigVO)==null?void 0:F.desc},null,8,["product-name","product-desc"])]),_(Ta,{"show-service-config":"","guarantee-list":(i=(d=h.value)==null?void 0:d.tenantProductInsureVO)==null?void 0:i.titleAndDescVOS},null,8,["guarantee-list"]),_(ba,{detail:h.value},{form:ae(()=>[_(Pa,{ref_key:"formRef",ref:M,"is-show-package":"",disable:!D(s).showInsure,"form-auth":I.value,"form-info":D(a),premium:w.value,"product-detail":h.value,onOnReset:Le,onOnUpdate:Re},null,8,["disable","form-auth","form-info","premium","product-detail"])]),_:1},8,["detail"]),U("div",Ma,[U("div",Va,[Ya,U("span",null,K(w.value?"\uFFE5":"")+K(D(fa)(w.value))+" "+K(w.value?D(a).paymentFrequency==D(Ee).YEAR?"\u5143/\u5E74":"\u5143/\u6708":""),1)]),_(e,{type:"primary",class:"right",disabled:!(D(s).canInsure||D(s).canUpgrade),onClick:le},{default:ae(()=>[be(K(D(s).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),D(x)!=="payBack"?($(),ve(ka,{key:1,"product-detail":h.value},null,8,["product-detail"])):te("",!0),_(Sa,{"order-no":D(S),"tenant-id":D(C),"is-show":X.value,onOnConfirm:se,onOnClose:He},null,8,["order-no","tenant-id","is-show"])]}),_:1},8,["theme-vars"]),_(Oa,{show:Y.value,"onUpdate:show":r[0]||(r[0]=u=>Y.value=u),"content-list":D(Se),"active-index":0,onOnConfirmHealth:We},null,8,["show","content-list"]),b.value?($(),ve(Ha,{key:0,show:b.value,"onUpdate:show":r[1]||(r[1]=u=>b.value=u),"content-list":D(Oe),"active-index":ne.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9","force-read-cound":2,onSubmit:Ge},null,8,["show","content-list","active-index"])):te("",!0),_(Ua,{"is-show":J.value},null,8,["is-show"])],64)}}});var nt=pa(qa,[["__scopeId","data-v-1fd1a7f2"]]);export{nt as default};
