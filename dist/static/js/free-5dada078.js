import{_ as e,d as t,aY as r,r as n,z as a,a7 as o,b as i,c as l,g as d,i as s,f as u,t as c,e as f,l as p,a8 as m,aZ as v,u as w,a as I,x as h,y,a_ as O,a$ as b,w as D,j as V,h as C,F as j,b0 as x,T as F,b1 as g,$ as L}from"./index-ede405b0.js";import{p as _,g as P}from"./product-f1c02f14.js";import{i as T,t as A}from"./trial-549f7489.js";import{a as H,s as N,c as k}from"./phoneVerify-86d7e26a.js";import{u as E,B as Y,P as S}from"./index-913013a6.js";import{n as M}from"./nextStep-34f9fce1.js";import{j as B}from"./trial-cbc5c145.js";import{v as R,f as $}from"./utils-2bab55e2.js";import{u as U}from"./theme-65292714.js";import z from"./index-4261ddf2.js";import J from"./index-f4a2fc0a.js";import"./pdfdist-66c75904.js";import"./logo-e4245f5a.js";import"./core-d078ab35.js";import"./index-c1807f2c.js";import"./useStorage-ffa94fcc.js";import"./infoCollection-97fe2557.js";import"./relativeTime-12fe38c5.js";import"./validator-5a13dc82.js";import"./useDicData-7ab2952f.js";const q={class:"free-card"},G={class:"container"},W={class:"title"};var X=e(t({props:{colors:{type:Array,default:()=>["#CDDFFE","#F1F7FE"]},detail:{type:Object,default:()=>{}},isFirst:{type:Boolean,default:!0},insureDetail:{type:Object,default:()=>{}},previewMode:{type:Boolean,default:!1}},setup(e,{expose:t}){const v=e;r((e=>({"4f872ea8":v.colors[0],"4f872e6a":v.colors[1]})));const w=n(),I=a({factorObj:{1:[{attributeValues:null,code:"mobile",datasource:null,defaultValue:null,displayType:null,factorId:null,factorScript:null,hasDefaultValue:1,id:8249,isDisplay:1,isHidden:1,isMustInput:1,isReadOnly:null,moduleType:1,placeholder:null,planCode:null,position:null,productCode:"lin23323",productId:null,title:"手机号"},{attributeValues:null,code:"verificationCode",datasource:null,defaultValue:null,displayType:null,factorId:null,factorScript:null,hasDefaultValue:1,id:8249,isDisplay:1,isHidden:1,isMustInput:1,isReadOnly:null,moduleType:1,placeholder:null,planCode:null,position:null,productCode:"lin23323",productId:null,title:"验证码"}],2:[],3:[]},isFirst:!0}),h=async({mobile:e,type:t},r)=>{var n;if(w.value){if(v.previewMode)return void(null==r||r());null==(n=w.value)||n.validateForm(`${t}_mobile`).then((async()=>{const t=v.isFirst?H:N,n=await t(e),{code:a,data:o}=n;"10000"===a&&(null==r||r())}))}};return o((()=>v.isFirst),(()=>{var e;v.isFirst||(I.factorObj=null==(e=v.insureDetail)?void 0:e.productFactor)})),t({validateForm:()=>new Promise(((e,t)=>{w.value.validateForm().then((t=>{e(!0)})).catch((()=>{t()}))}))}),(t,r)=>{const n=i("ProSvg");return l(),d("div",q,[s("div",G,[s("div",W,[u(n,{name:"free-arrow"}),s("span",null,c(e.isFirst?"凭手机号 免费领取":"最后一步 填写信息"),1),u(n,{name:"free-arrow"})]),(l(),f(J,{ref_key:"formRef",ref:w,key:e.isFirst?1:2,"send-sms-code":h,"need-desensitize":"","form-info":e.detail,"factor-object":p(I).factorObj},null,8,["form-info","factor-object"])),m(t.$slots,"default",{},void 0,!0)])])}}}),[["__scopeId","data-v-be87b6ce"]]);const Z={class:"page-free-product-detail"},K={class:"product-desc"},Q={key:1,class:"page-free-footer"};var ee=e(t({setup(e){r((e=>({"2daeff74":p(ce).colors[1]})));const t=v((()=>x((()=>import("./index-4c942bf4.js")),["static/js/index-4c942bf4.js","static/css/index-607986ff.css","static/js/index-ede405b0.js","static/css/index-76f73643.css","static/js/pdfdist-66c75904.js"]))),c=v((()=>x((()=>import("./index-f6efc7b2.js")),["static/js/index-f6efc7b2.js","static/css/index-b9ba3011.css","static/js/index-ede405b0.js","static/css/index-76f73643.css","static/js/pdfdist-66c75904.js"]))),m=v((()=>x((()=>import("./index-a9056373.js")),["static/js/index-a9056373.js","static/css/index-ea588f10.css","static/js/index-ede405b0.js","static/css/index-76f73643.css","static/js/pdfdist-66c75904.js","static/js/theme-65292714.js","static/js/index-4261ddf2.js","static/css/index-2dbcd337.css","static/js/utils-2bab55e2.js","static/js/infoCollection-97fe2557.js","static/js/useStorage-ffa94fcc.js","static/js/trial-cbc5c145.js"]))),H=U(),N=w(),J=I(),{productCode:q="",agencyCode:G="",tenantId:W="",saleUserId:ee="",saleChannelId:te="",extraInfo:re,preview:ne}=J.query;let ae={};try{ae=JSON.parse(decodeURIComponent(re))}catch(be){}const{openId:oe,indirectCode:ie="",agentCode:le}=ae,de=n(),se=n(),ue=n(),ce=a({colors:["#fff"],detail:{},order:{tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},insuredBeneficiaryType:"1",tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}]}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}},relationList:{},banner:"",productDesc:[],newAuth:!0,isValidateCode:!1,insureDetail:{},loading:!0,isSelfInsure:!0,showBtn:!1,activeIndex:0,showFilePreview:!1,isOnlyView:!0}),fe=n();oe&&E({openId:oe},(e=>{ce.relationList=e}));const pe=h((()=>!!ne)),me=()=>{var e,t,r;const n=ce.insureDetail.productRiskVoList||[];return 1===((null==(r=null==(t=null==(e=null==n?void 0:n[0])?void 0:e.riskDetailVOList)?void 0:t[0])?void 0:r.insuranceStartType)||1)?`${L(new Date).format("YYYY-MM-DD")} 00:00:00`:`${L(new Date).add(1,"day").format("YYYY-MM-DD")} 00:00:00`},ve=()=>{var e,t;const r=ce.insureDetail.productRiskVoList||[],{insuranceEndType:n,riskInsureLimitVO:a}=(null==(t=null==(e=null==r?void 0:r[0])?void 0:e.riskDetailVOList)?void 0:t[0])||{},{insurancePeriodValueList:o}=a||{},[i,l]=((null==o?void 0:o[0])||"").split("_");return 1===n?`${L(new Date).add(l||0,i).format("YYYY-MM-DD")} 23:59:59`:n?`${L(new Date).add(l,i).format("YYYY-MM-DD")} 00:00:00`:""},we=async()=>{ce.loading=!0;const e=_({productCode:q,withInsureInfo:!0,tenantId:W}),t=T({productCode:q}),r=P({openId:oe});await Promise.all([e,t,r]).then((([e,t,r])=>{var n,a,o,i,l;if("10000"===e.code){ce.detail=e.data,ce.banner=null==(n=ce.detail.tenantProductInsureVO)?void 0:n.banner[0];const{colorEnd:t,colorStart:r}=(null==(a=ce.detail.tenantProductInsureVO)?void 0:a.backgroundInsureVO)||{};ce.colors=[r,t],ce.productDesc=ce.detail.tenantProductInsureVO.spec||[],document.title=(null==(i=null==(o=ce.detail)?void 0:o.tenantProductInsureVO)?void 0:i.productName)||""}if("10000"===t.code&&(ce.insureDetail=t.data,ce.insureDetail.productFactor[1].forEach((e=>{"verificationCode"===e.code&&1===e.isDisplay&&(ce.isValidateCode=!0)})),ce.insureDetail.productFactor[2]=null==(l=ce.insureDetail.productFactor)?void 0:l[2].map((e=>{var t,r;return"relationToHolder"===e.code&&1===e.isDisplay&&(e.title="被保人",ce.order.tenantOrderInsuredList[0].relationToHolder=(null==(r=null==(t=e.attributeValueList)?void 0:t[0])?void 0:r.code)||""),e}))),"10000"===r.code&&(ce.newAuth=!r.data,ce.isSelfInsure=!!r.data,r.data)){const e=r.data;ce.order.tenantOrderHolder={certNo:null==e?void 0:e.certiNo,extInfo:{},mobile:null==e?void 0:e.mobile,name:null==e?void 0:e.name}}(()=>{var e;let t={};if(t=(null==(e=ce.detail.tenantProductInsureVO.planInsureVO)?void 0:e.attachmentVOList)||[],!t)return void(fe.value=[]);const r={2:"richText",3:"link"};fe.value=Object.keys(t).map((e=>(t[e].forEach((e=>{if("1"===e.attachmentType){const t=e.attachmentUri.split("?"),r=t[0].substr(t[0].lastIndexOf(".")+1);e.attachmentType="pdf"===r?"pdf":"picture"}else e.attachmentType=r[e.attachmentType]})),{attachmentName:e,attachmentList:t[e]})))||[]})(),ce.loading=!1}))},Ie=async()=>{let e={loginType:"2",openId:oe,thirdUserType:"XINAO_WECHAT",indirectCode:ie};try{if(ce.newAuth?(e.loginName=ce.order.tenantOrderHolder.mobile,e.password=ce.order.tenantOrderHolder.verificationCode):e=$({order:ce.order,tenantId:W,extraInfo:ae,commencementTime:me(),expiryDate:ve(),detail:ce.detail,insureDetail:ce.insureDetail,iseeBizNo:de.value,agentCode:le,agencyCode:G,saleUserId:ee,templateId:null==ae?void 0:ae.templateId,saleChannelId:te,pageCode:"infoCollection",buttonCode:"EVENT_FREE_multiIssuePolicy"}),ce.newAuth)if(pe.value)ce.newAuth=!1;else{const{code:t,data:r}=await A(e);"10000"===t&&(ce.newAuth=!1)}else M(e,((e,t)=>{t===g.JUMP_PAGE&&e.orderNo&&N.push(`/baseInsurance/orderDetail?from=free&tenantId=${W}&orderNo=${e.orderNo}`)}))}catch(t){}},he=async()=>await(async()=>{var e;if(pe.value)return!0;await ue.value.validateForm();const t=null==(e=ce.order.tenantOrderHolder)?void 0:e.verificationCode;if((ce.isValidateCode||ce.newAuth)&&(!t||!R(t)))return F({message:"请输入正确的验证码"}),!1;if(ce.newAuth||!ce.isValidateCode)return!0;const{code:r,data:n}=await k(ce.order.tenantOrderHolder.mobile,t);return!!n})()?(ce.newAuth||0===fe.value.length?Ie():(ce.isOnlyView=!1,ce.showFilePreview=!0),!1):null,ye=()=>{ce.showFilePreview=!1,ce.isOnlyView=!0},Oe=()=>{ce.showFilePreview=!1,ce.isOnlyView=!0,Ie()};return y((()=>{we(),setTimeout((async()=>{de.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),o((()=>ce.order.tenantOrderInsuredList[0]),(e=>{if(O(ce.relationList)||ce.newAuth)return null;const t=ce.relationList[e.relationToHolder]||[];return 1===t.length&&(B.SELF!==e.relationToHolder?(ce.order.tenantOrderInsuredList[0].certNo=ce.order.tenantOrderInsuredList[0].certNo?ce.order.tenantOrderInsuredList[0].certNo:t[0].cert[0].certNo,ce.order.tenantOrderInsuredList[0].name=ce.order.tenantOrderInsuredList[0].name?ce.order.tenantOrderInsuredList[0].name:t[0].cert[0].certName,ce.order.tenantOrderInsuredList[0].mobile=ce.order.tenantOrderInsuredList[0].mobile?ce.order.tenantOrderInsuredList[0].mobile:t[0].contact[0].contactNo):ce.isSelfInsure&&(ce.isSelfInsure=!1,ce.order.tenantOrderHolder.certNo=ce.order.tenantOrderHolder.certNo?ce.order.tenantOrderHolder.certNo:t[0].cert[0].certNo,ce.order.tenantOrderHolder.name=ce.order.tenantOrderHolder.name?ce.order.tenantOrderHolder.name:t[0].cert[0].certName,ce.order.tenantOrderHolder.mobile=ce.order.tenantOrderHolder.mobile?ce.order.tenantOrderHolder.mobile:t[0].contact[0].contactNo)),!1}),{immediate:!0,deep:!0}),b(se,(([{isIntersecting:e}],t)=>{ce.showBtn=!e})),(e,r)=>{const n=i("van-image"),a=i("van-config-provider");return l(),f(a,{"theme-vars":p(H)},{default:D((()=>{var e,a,o,i;return[s("div",Z,[u(Y,{url:p(ce).banner},null,8,["url"]),u(X,{ref_key:"formRef",ref:ue,"is-first":p(ce).newAuth,"insure-detail":p(ce).insureDetail,detail:p(ce).order,colors:p(ce).colors,"preview-mode":p(pe)},{default:D((()=>[u(z,{ref_key:"root",ref:se,class:"submit-btn",disabled:!p(ce).newAuth&&p(pe),"is-gradient":!1,text:p(ce).newAuth?"立即领取":"激活保障",onClick:he},null,8,["disabled","text"]),!p(ce).newAuth&&fe.value&&fe.value.length>0?(l(),f(p(c),{key:0,"attachement-list":fe.value,"has-bg-color":!1,"pre-text":"请阅读",onPreviewFile:r[0]||(r[0]=e=>(e=>{ce.isOnlyView=!0,ce.activeIndex=e,ce.showFilePreview=!0})(e))},null,8,["attachement-list"])):V("",!0)])),_:1},8,["is-first","insure-detail","detail","colors","preview-mode"]),s("div",K,[(l(!0),d(j,null,C(p(ce).productDesc,((e,t)=>(l(),f(n,{key:t,width:"100%","lazy-load":"",src:e,class:""},null,8,["src"])))),128))]),(null==(a=null==(e=p(ce).detail)?void 0:e.tenantProductInsureVO)?void 0:a.inscribedContent)?(l(),f(p(t),{key:0,"inscribed-content":null==(i=null==(o=p(ce).detail)?void 0:o.tenantProductInsureVO)?void 0:i.inscribedContent},null,8,["inscribed-content"])):V("",!0),p(ce).showBtn?(l(),d("footer",Q,[u(z,{disabled:!p(ce).newAuth&&p(pe),"is-gradient":!1,text:p(ce).newAuth?"立即领取":"激活保障",onClick:he},null,8,["disabled","text"])])):V("",!0)]),p(ce).showFilePreview&&0!==fe.value.length?(l(),f(p(m),{key:0,show:p(ce).showFilePreview,"onUpdate:show":r[1]||(r[1]=e=>p(ce).showFilePreview=e),"content-list":fe.value,"is-only-view":p(ce).isOnlyView,"active-index":p(ce).activeIndex,text:p(ce).isOnlyView?"关闭":"我已逐页阅读上述内容并同意","force-read-cound":0,"on-close-file-preview":"",onSubmit:Oe,onOnCloseFilePreview:ye},null,8,["show","content-list","is-only-view","active-index","text"])):V("",!0),p(ce).loading?V("",!0):(l(),f(S,{key:1,"product-detail":p(ce).detail},null,8,["product-detail"]))]})),_:1},8,["theme-vars"])}}}),[["__scopeId","data-v-5f88411a"]]);export{ee as default};
