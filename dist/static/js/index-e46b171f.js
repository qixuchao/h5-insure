var de=Object.defineProperty,Be=Object.defineProperties;var Ee=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var _e=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var Q=(B,t,E)=>t in B?de(B,t,{enumerable:!0,configurable:!0,writable:!0,value:E}):B[t]=E,W=(B,t)=>{for(var E in t||(t={}))_e.call(t,E)&&Q(B,E,t[E]);if(J)for(var E of J(t))fe.call(t,E)&&Q(B,E,t[E]);return B},K=(B,t)=>Be(B,Ee(t));import{g as De,P as Ce,O as Fe,E as b,d as ve,h as Ae,r as H,j as _,k as U,m as D,z as a,p as C,J as A,n as p,L as X,t as O,A as R,G as L,F as M,a5 as pe,a6 as he,C as I,T as S,D as ge}from"./vendor-8ff1e78f.js";import{_ as ye,S as me,I as Te,J as Ne,q as Z,l as k,K as ee,N as ue,n as Ie,P as Oe,r as Re}from"./index-0d7c6943.js";import{g as Se,f as ke,s as te,a as xe}from"./verify-cc7bd378.js";const se=B=>(pe("data-v-0a987828"),B=B(),he(),B),Pe={class:"page-verify"},we={class:"people"},be={class:"name"},He={class:"verify-item"},Ue=se(()=>a("div",{class:"label"},"\u8BC1\u4EF6\u53F7\u7801",-1)),Le={class:"no"},Me=I(" \u53BB\u8BA4\u8BC1 "),Ve={class:"sign-body"},$e={class:"date"},je={class:"file"},Ye=I(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A "),qe={class:"people"},ze={class:"name"},Ge={class:"verify-item"},Je=se(()=>a("div",{class:"label"},"\u8BC1\u4EF6\u53F7\u7801",-1)),Qe={class:"no"},We=["onClick"],Ke=I(" \u53BB\u8BA4\u8BC1 "),Xe=["onClick"],Ze={class:"sign-body"},eu={class:"date"},uu={class:"file"},tu=I(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A "),su={class:"footer-button footer"},au=I("\u63D0\u4EA4"),ou=De({setup(B){const t={CERT:1,NO_CERT:2},E=Ce(),ae=Fe(),{saleUserId:V="D1234567-1",tenantId:y="9991000007",templateId:oe=1,productCode:ne="CQ75CQ76",insurerCode:nu="ancheng"}=E.query;let{orderNo:h}=E.query;typeof h=="object"&&(h=(h||[])[0]);const x=new me({source:"localStorage"}),P=b([]),o=b(),m=b(),g=[],$=ve().format("YYYY-MM-DD"),re=()=>{var u;(u=m.value)==null||u.clear()},ie=u=>{g[u].clear()},j=(u,n)=>{xe({callbackUrl:window.location.href,certiNo:u,faceAuthMode:"TENCENT",userName:n,tenantId:9991000007}).then(r=>{const{code:i,data:l}=r;if(i==="10000"){const{originalUrl:F,serialNo:e}=l;window.location.href=F,x.set("verifyData",{serialNo:e,certNo:u,name:n})}})},T=u=>u===Ne.CERT,Y=u=>{var n,r,i,l;u===-1?j((n=o.value.tenantOrderHolder)==null?void 0:n.certNo,(r=o.value.tenantOrderHolder)==null?void 0:r.name):j((i=o.value.tenantOrderInsuredList[u])==null?void 0:i.certNo,(l=o.value.tenantOrderInsuredList[u])==null?void 0:l.name)},le=u=>{u&&g.every(n=>n!==u)&&g.push(u)},ce=()=>{var n,r,i,l,F;if((n=m.value)==null?void 0:n.isEmpty()){S.fail("\u8BF7\u6295\u4FDD\u4EBA\u7B7E\u540D");return}if(g.some(e=>e.isEmpty())){S.fail("\u8BF7\u88AB\u4FDD\u4EBA\u7B7E\u540D");return}if(((i=(r=o.value.tenantOrderHolder)==null?void 0:r.extInfo)==null?void 0:i.isCert)!==t.CERT&&T((l=o.value.tenantOrderHolder)==null?void 0:l.certType)){S.fail("\u8BF7\u6295\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}if((F=o.value.tenantOrderInsuredList)==null?void 0:F.some(e=>{var c;return((c=e.extInfo)==null?void 0:c.isCert)!==t.CERT&&T(e.certType)})){S.fail("\u8BF7\u88AB\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}ge.confirm({title:"\u63D0\u793A",message:"\u8BF7\u786E\u8BA4\u4FE1\u606F\u586B\u5199\u65E0\u8BEF\u540E\uFF0C\u518D\u8FDB\u884C\u652F\u4ED8"}).then(()=>{var c,s;const e=(c=m.value)==null?void 0:c.save();Promise.all([te("HOLDER",e,(s=o.value)==null?void 0:s.id,`${y}`),...g.map(d=>{var f;return te("INSURED",d.save(),(f=o.value)==null?void 0:f.id,`${y}`)})]).then(()=>{Ie(K(W({},o.value),{pageCode:"sign",operateOption:{withSignInfo:!0},extInfo:{pageCode:"sign",templateId:oe},venderCode:"ancheng"})).then(d=>{const{code:f,data:v}=d;f==="10000"&&v.success&&ae.push({path:Oe[v.pageAction.data.nextPageCode],query:{orderNo:h,saleUserId:V,tenantId:y}})})})})},q=()=>{Re({orderNo:h,saleUserId:V,tenantId:y}).then(u=>{const{code:n,data:r}=u;n==="10000"&&(o.value=r,setTimeout(()=>{let i=0;r.tenantOrderAttachmentList.forEach(l=>{l.category===21&&(l.objectType===2?(m.value.clear(),m.value.setDataURL(l.fileBase64)):l.objectType===1&&(g[i].clear(),g[i].setDataURL(l.fileBase64),i+=1))})}))})};return Ae(()=>{q(),Se({orderNo:h,productCode:ne,tenantId:y}).then(n=>{const{code:r,data:i}=n;r==="10000"&&(P.value=i||[])});const u=x.get("verifyData");if(u){const{serialNo:n,certNo:r,name:i}=u;ke({certiNo:r,orderNo:h,serialNo:n,tenantId:y,userName:i}).then(l=>{const{code:F,data:e}=l;F==="10000"&&(x.remove("verifyData"),q())})}}),(u,n)=>{const r=H("ProPDFviewer"),i=H("van-button"),l=H("ProPageWrap");return _(),U(l,null,{default:D(()=>{var F;return[a("div",Pe,[C(Te,{type:"warning",title:"\u5C0A\u656C\u7684\u5BA2\u6237\uFF0C\u672C\u6B21\u6295\u4FDD\u9700\u8981\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",content:"\u672C\u4EA7\u54C1\u6295\u4FDD\u9700\u8981\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u8FDB\u884C\u5B9E\u540D\u8BA4\u8BC1\uFF0C\u60A8\u8D2D\u4E70\u672C\u4EA7\u54C1\u7684\u7D2F\u8BA1\u603B\u4FDD\u8D39\u5DF2\u8D85\u8FC720\u4E07\uFF0C\u6309\u76D1\u7BA1\u8981\u6C42\uFF0C\u9700\u8981\u63D0\u4F9B\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u3001\u6307\u5B9A\u53D7\u76CA\u4EBA\u8BC1\u4EF6\u5F71\u50CF\uFF0C\u672C\u4EA7\u54C1\u975E\u672C\u4EBA\u6295\u4FDD\u4E14\u5E26\u8EAB\u6545\u8D23\u4EFB\u3001\u9700\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\uFF08\u6210\u4EBA\uFF09\u7684\u6295\u4FDD\u610F\u613F\u8FDB\u884C\u7B7E\u5B57\u786E\u8BA4\u3002"}),C(k,{title:"\u6295\u4FDD\u4EBA",class:"card"},{extra:D(()=>{var e,c,s,d,f,v,N,w,z,G;return[a("div",we,[a("div",be,A((c=(e=o.value)==null?void 0:e.tenantOrderHolder)==null?void 0:c.name),1),T((d=(s=o.value)==null?void 0:s.tenantOrderHolder)==null?void 0:d.certType)?(_(),p("div",{key:0,class:X(["status",{verified:((N=(v=(f=o.value)==null?void 0:f.tenantOrderHolder)==null?void 0:v.extInfo)==null?void 0:N.isCert)===t.CERT}])},A(((G=(z=(w=o.value)==null?void 0:w.tenantOrderHolder)==null?void 0:z.extInfo)==null?void 0:G.isCert)===t.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)):O("",!0)])]}),default:D(()=>{var e,c,s,d,f,v,N;return[a("div",He,[Ue,a("div",Le,A((c=(e=o.value)==null?void 0:e.tenantOrderHolder)==null?void 0:c.certNo),1),((f=(d=(s=o.value)==null?void 0:s.tenantOrderHolder)==null?void 0:d.extInfo)==null?void 0:f.isCert)!==t.CERT&&T((N=(v=o.value)==null?void 0:v.tenantOrderHolder)==null?void 0:N.certType)?(_(),p("div",{key:0,class:"action",onClick:n[0]||(n[0]=w=>Y(-1))},[Me,C(Z,{name:"right_arrow",class:"icon"})])):O("",!0)])]}),_:1}),C(k,{title:"\u6295\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:D(()=>[a("div",{class:"resign",onClick:re},"\u91CD\u7B7E")]),default:D(()=>[C(ee,{ref_key:"holderSign",ref:m,class:"sign"},null,512),a("div",Ve,[a("div",$e,"\u7B7E\u540D\u65E5\u671F\uFF1A "+A(R($)),1),a("div",je,[Ye,(_(!0),p(M,null,L(P.value.filter(e=>e.noticeObject===R(ue).HOLDER),(e,c)=>(_(),U(r,{key:c,class:"file",title:`\u300A${e.materialName}\u300B`,url:e.materialSource},null,8,["title","url"]))),128))])])]),_:1}),(_(!0),p(M,null,L((F=o.value)==null?void 0:F.tenantOrderInsuredList,(e,c)=>(_(),p("div",{key:c},[C(k,{title:"\u88AB\u4FDD\u4EBA",class:"card"},{extra:D(()=>{var s,d;return[a("div",qe,[a("div",ze,A(e.name),1),T(e.certType)?(_(),p("div",{key:0,class:X(["status",{verified:((s=e.extInfo)==null?void 0:s.isCert)===t.CERT}])},A(((d=e.extInfo)==null?void 0:d.isCert)===t.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)):O("",!0)])]}),default:D(()=>{var s;return[a("div",Ge,[Je,a("div",Qe,A(e.certNo),1),((s=e.extInfo)==null?void 0:s.isCert)!==t.CERT&&T(e.certType)?(_(),p("div",{key:0,class:"action",onClick:d=>Y(c)},[Ke,C(Z,{name:"right_arrow",class:"icon"})],8,We)):O("",!0)])]}),_:2},1024),C(k,{title:"\u88AB\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:D(()=>[a("div",{class:"resign",onClick:s=>ie(c)},"\u91CD\u7B7E",8,Xe)]),default:D(()=>[C(ee,{ref_for:!0,ref:le,class:"sign"}),a("div",Ze,[a("div",eu,"\u7B7E\u540D\u65E5\u671F\uFF1A "+A(R($)),1),a("div",uu,[tu,(_(!0),p(M,null,L(P.value.filter(s=>s.noticeObject===R(ue).INSURED),(s,d)=>(_(),U(r,{key:d,class:"file",title:`\u300A${s.materialName}\u300B`,url:s.materialSource},null,8,["title","url"]))),128))])])]),_:2},1024)]))),128)),a("div",su,[C(i,{type:"primary",class:"submit-btn",onClick:ce},{default:D(()=>[au]),_:1})])])]}),_:1})}}});var du=ye(ou,[["__scopeId","data-v-0a987828"]]);export{du as default};
