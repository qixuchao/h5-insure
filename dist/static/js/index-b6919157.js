var ve=Object.defineProperty;var J=Object.getOwnPropertySymbols;var fe=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var Z=(a,i,u)=>i in a?ve(a,i,{enumerable:!0,configurable:!0,writable:!0,value:u}):a[i]=u,ee=(a,i)=>{for(var u in i||(i={}))fe.call(i,u)&&Z(a,u,i[u]);if(J)for(var u of J(i))ke.call(i,u)&&Z(a,u,i[u]);return a};import{g as se,a5 as H,C as g,x as te,X as ae,r as P,h as v,m as b,F as W,E as X,y as t,n as d,I as L,z as k,j as E,k as c,s as S,B as I,a1 as ue,a2 as re,ae as Ie,Q as he,o as Pe,d as Le,a6 as De,D as Fe}from"./vendor-89e50ef2.js";import{u as Re,P as ge}from"./index-18850f3e.js";import{b as z,_ as ne,p as K,n as ye}from"./index-1de39856.js";import{u as oe}from"./useDicData-5360c195.js";import"./trial-0a82b83a.js";import"./index-28499fdd.js";import"./useStorage-228c1c9a.js";const Ce=a=>z.post("/api/app/insure/proposal/AddOrUpdateProposal",a),Ve=(a={})=>z.get(`/api/app/insure/proposal/queryProposalDetail/${a.id}`,a),Ee=(a={})=>z.post("/api/app/insure/product/listInsureProductDetail",a);const O=a=>(ue("data-v-5e13dc9a"),a=a(),re(),a),Be={class:"com-product-list-wrapper"},be={class:"risk-item-wrapper"},Oe={class:"content"},$e={class:"risk-premium"},Ae=I(" \u4FDD\u8D39:"),Ne={class:"premium"},Se={class:"risk-factor"},xe={class:"factor"},we={class:"factor-value"},Te=O(()=>t("span",{class:"factor-name"}," \u4FDD\u989D(\u5143) ",-1)),Ue={class:"factor"},qe={class:"factor-value"},Ye=O(()=>t("span",{class:"factor-name"}," \u4FDD\u969C\u671F\u95F4 ",-1)),je={class:"factor"},Me={class:"factor-value"},Ke=O(()=>t("span",{class:"factor-name"}," \u7F34\u8D39\u671F\u95F4 ",-1)),He={class:"operate-bar"},We=I("\u5220\u9664"),Xe=I("+ \u9644\u52A0\u9669"),ze=I("\u4FEE\u6539"),Qe={class:"content"},Ge={class:"risk-premium"},Je=I(" \u4FDD\u8D39:"),Ze={class:"premium"},et={class:"risk-factor"},tt={class:"factor"},ot={class:"factor-value"},st=O(()=>t("span",{class:"factor-name"}," \u4FDD\u989D(\u5143) ",-1)),at={class:"factor"},ut={class:"factor-value"},rt=O(()=>t("span",{class:"factor-name"}," \u4FDD\u969C\u671F\u95F4 ",-1)),nt={class:"factor"},it={class:"factor-value"},dt=O(()=>t("span",{class:"factor-name"}," \u7F34\u8D39\u671F\u95F4 ",-1)),lt={class:"operate-bar"},ct=I("\u5220\u9664"),pt=I("+ \u9644\u52A0\u9669"),_t=I("\u4FEE\u6539"),mt={class:"premium-total"},vt=I(" \u4FDD\u8D39: "),ft={class:"premium"},kt=se({props:{productRiskList:{default:()=>[]},productInfo:{default:()=>({})},productData:{default:()=>({})},pickProductPremium:{type:Function,default:()=>{}},productNum:{default:0}},emits:["deleteRisk","updateRisk","addRiderRisk"],setup(a,{emit:i}){const u=a;H();const B=g({checkedList:[],disabledList:[],riderRiskList:[],mainRiskData:{},totalPremium:0,currentRiskRecord:{}}),D=g([]);oe("RISK_PAYMENT_PERIOD").then(n=>{D.value=n.value});const o=g([]);oe("RISK_INSURANCE_PERIOD").then(n=>{o.value=n.value}),te(()=>{var n,h;return((h=(n=u.productData)==null?void 0:n.riskDetailVOList)==null?void 0:h[0].optionalRiderRiskVOList)||[]}),te(()=>{var n,h;return((h=(n=u.productData)==null?void 0:n.riskDetailVOList)==null?void 0:h[0].collocationVOList)||[]});const $=n=>{i("deleteRisk",n,u.productInfo)},x=n=>{i("updateRisk",n,u.productInfo)},y=n=>{B.value.currentRiskRecord=n,i("addRiderRisk",u.productInfo)};return ae(()=>u.productInfo,n=>{var f;let h=0;const r=l=>{l.forEach(F=>{var C;h+=F.premium,((C=F.riderRiskVOList)==null?void 0:C.length)&&r(F.riderRiskVOList)})};r(n.proposalProductRiskList||[]),(f=u==null?void 0:u.pickProductPremium)==null||f.call(u,{[`${n.productId}`]:h}),B.value.totalPremium=h},{deep:!0,immediate:!0}),(n,h)=>{const r=P("ProTitle"),f=P("ProCheckButton");return v(),b("div",Be,[(v(!0),b(W,null,X(a.productRiskList,l=>{var F,C,w,T;return v(),b("div",{key:l.riskId},[t("div",be,[d(r,{"risk-type":l.riskType,title:l.riskName},null,8,["risk-type","title"]),t("div",Oe,[t("div",$e,[Ae,t("span",Ne,"\uFFE5"+L(l.premium.toLocaleString()),1)]),t("div",Se,[t("div",xe,[t("span",we,L(l.amount.toLocaleString()),1),Te]),t("div",Ue,[t("span",qe,L(k(K)(o.value,l.coveragePeriod)),1),Ye]),t("div",je,[t("span",Me,L(k(K)(D.value,l.chargePeriod)),1),Ke])]),t("div",He,[a.productNum?(v(),E(f,{key:0,round:32,class:"border",onClick:p=>$(l)},{default:c(()=>[We]),_:2},1032,["onClick"])):S("",!0),((T=(w=(C=(F=a.productData)==null?void 0:F.riskDetailVOList)==null?void 0:C[0])==null?void 0:w.optionalRiderRiskVOList)==null?void 0:T.length)?(v(),E(f,{key:1,activated:"",round:32,onClick:p=>y(l)},{default:c(()=>[Xe]),_:2},1032,["onClick"])):S("",!0),d(f,{activated:"",round:32,onClick:p=>x(l)},{default:c(()=>[ze]),_:2},1032,["onClick"])])])]),(v(!0),b(W,null,X(l.riderRiskVOList,p=>{var U,q,Y,j;return v(),b("div",{key:p.riskCode,class:"risk-item-wrapper"},[d(r,{"risk-type":p.riskType,title:p.riskName},null,8,["risk-type","title"]),t("div",Qe,[t("div",Ge,[Je,t("span",Ze,"\uFFE5"+L(p.premium.toLocaleString()),1)]),t("div",et,[t("div",tt,[t("span",ot,L(l.amount.toLocaleString()),1),st]),t("div",at,[t("span",ut,L(k(K)(o.value,p.coveragePeriod)),1),rt]),t("div",nt,[t("span",it,L(k(K)(D.value,p.chargePeriod)),1),dt])]),t("div",lt,[a.productNum?(v(),E(f,{key:0,round:32,class:"border",onClick:M=>$(p)},{default:c(()=>[ct]),_:2},1032,["onClick"])):S("",!0),((j=(Y=(q=(U=a.productData)==null?void 0:U.riskDetailVOList)==null?void 0:q[0])==null?void 0:Y.optionalRiderRiskVOList)==null?void 0:j.length)?(v(),E(f,{key:1,activated:"",round:32,onClick:M=>y(p)},{default:c(()=>[pt]),_:2},1032,["onClick"])):S("",!0),d(f,{activated:"",round:32,onClick:M=>x(p)},{default:c(()=>[_t]),_:2},1032,["onClick"])])])])}),128)),t("div",mt,[vt,t("span",ft,"\uFFE5"+L(B.value.totalPremium.toLocaleString()),1)])])}),128))])}}});var It=ne(kt,[["__scopeId","data-v-5e13dc9a"]]);const ht=a=>(ue("data-v-127f735c"),a=a(),re(),a),Pt={class:"container"},Lt=ht(()=>t("span",null,"\u8BA1\u5212\u4E66\u540D\u79F0",-1)),Dt={class:"operate-bar"},Ft=I("\u6DFB\u52A0\u4E3B\u9669"),Rt={class:"footer-bar"},gt={class:"trial-result"},yt=I(" \u603B\u4FDD\u8D39 "),Ct={class:"result-num"},Vt={class:"trial-operate"},Et=I("\u4FDD\u5B58\u5E76\u9884\u89C8"),Bt=se({setup(a){const[i,u]=H(!1),[B,D]=H(),o=g({proposalHolder:{},proposalInsuredList:[{name:"",gender:"",birthday:"",proposalInsuredProductList:[]}],proposalName:"",totalPremium:0,relationUserType:2}),$=Ie(),x=he(),y=Re(),{id:n,type:h="add"}=x.query,r=g({productId:0,productCollection:{},productInfo:{},productPremium:{},riderRisk:{},type:"add",currentRisk:[]}),f=g();g({}),g([]);const l=(s,e)=>/^.{1,20}$/.test(s)?(console.log("value",s,e),""):"\u8BA1\u5212\u4E66\u540D\u79F0\u4E0D\u80FD\u8D85\u8FC720\u4E2A\u5B57\u7B26",F=(s,e)=>{const _=e;Fe.confirm({message:"\u786E\u8BA4\u5220\u9664\u8BE5\u9669\u79CD\uFF1F"}).then(()=>{s.riskType===1?o.value.proposalInsuredList[0].proposalInsuredProductList=o.value.proposalInsuredList[0].proposalInsuredProductList.filter(V=>V.productId!==e.productId):_.proposalProductRiskList[0].riderRiskVOList=_.proposalProductRiskList[0].riderRiskVOList.filter(V=>V.riskId!==s.riskId)})},C=(s,e)=>{r.value.productId=e.productId,r.value.productInfo=e,r.value.type="edit",r.value.currentRisk=[s.riskId],D(!0)},w=s=>{r.value.productId=s.productId,r.value.productInfo=s,r.value.type="addRiderRisk",D(!0)},T=(s={})=>{Object.assign(r.value.productPremium,s),o.value.totalPremium=Object.values(r.value.productPremium).reduce((e,_)=>e+_,0)},p=()=>{Ve({id:n}).then(({code:s,data:e})=>{s==="10000"&&Object.assign(o.value,e)})},U=()=>{f.value.validate().then(()=>{Ce(o.value).then(({code:s,data:e})=>{s==="10000"&&$.push({path:"/compositionProposal",query:{id:e}})})})},q=s=>{o.value.proposalInsuredList[0].proposalInsuredProductList=o.value.proposalInsuredList[0].proposalInsuredProductList.map(e=>{let _=e;return e.productId===s.proposalInsuredList[0].proposalInsuredProductList[0].productId&&(_=ee({},s.proposalInsuredList[0].proposalInsuredProductList[0])),_}),D(!1)},Y=s=>{Ee(s).then(({code:e,data:_})=>{e==="10000"&&(r.value.productCollection=_)}).finally(()=>{})},j=()=>{y.setProposalInfo(o.value),y.setExcludeProduct(Object.keys(r.value.productCollection)),$.push({path:"/proposalList",query:{isCreateProposal:"1"}})},M=()=>{D(!1)};return Pe(()=>{const s=y.$state.trialData,e=y.$state.proposalInfo;console.log("proposalInfo.proposalInsuredList[0]?.dateRange?.minAge",s),n?p():!Object.keys(e).length&&s.length?Object.assign(o.value,s[0]):Object.keys(e).length&&s.length&&(e.proposalInsuredList[0].proposalInsuredProductList.push(...s[0].proposalInsuredList[0].proposalInsuredProductList),o.value=e)}),ae(()=>{var s;return(s=o.value.proposalInsuredList[0].proposalInsuredProductList)==null?void 0:s.length},()=>{const s=o.value.proposalInsuredList[0].proposalInsuredProductList.map(e=>({productId:e.productId,source:2}));Y({voList:s})}),(s,e)=>{const _=P("VanField"),V=P("ProCard"),ie=P("ProRadioButton"),de=P("VanForm"),le=P("ProCheckButton"),ce=P("VanButton"),pe=P("van-datetime-picker"),_e=P("van-popup"),me=P("ProPageWrap");return v(),E(me,{class:"page-create-wrapper"},{default:c(()=>{var Q;return[t("div",Pt,[d(de,{ref_key:"formRef",ref:f,"input-align":"right","error-message-align":"right"},{default:c(()=>[d(V,null,{default:c(()=>[d(_,{modelValue:o.value.proposalName,"onUpdate:modelValue":e[0]||(e[0]=m=>o.value.proposalName=m),name:"proposalName",placeholder:"\u8BF7\u8F93\u5165\u8BA1\u5212\u4E66\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u8BA1\u5212\u4E66\u540D\u79F0"},{validator:l}]},{label:c(()=>[Lt]),_:1},8,["modelValue","rules"])]),_:1}),d(V,{title:"\u88AB\u4FDD\u4EBA\u4FE1\u606F"},{default:c(()=>{var m,A,N,G;return[d(_,{modelValue:o.value.proposalInsuredList[0].name,"onUpdate:modelValue":e[1]||(e[1]=R=>o.value.proposalInsuredList[0].name=R),name:"name",label:"\u59D3\u540D",placeholder:"\u8BF7\u8F93\u5165\uFF08\u9009\u586B\uFF09"},null,8,["modelValue"]),d(_,{modelValue:o.value.proposalInsuredList[0].birthday,"onUpdate:modelValue":e[2]||(e[2]=R=>o.value.proposalInsuredList[0].birthday=R),name:"birthday",label:"\u51FA\u751F\u65E5\u671F",formate:"YYYY-MM-DD","is-link":"",readonly:"","min-date":(A=(m=o.value.proposalInsuredList[0])==null?void 0:m.dateRange)==null?void 0:A.minAge,"max-date":(G=(N=o.value.proposalInsuredList[0])==null?void 0:N.dateRange)==null?void 0:G.maxAge,placeholder:"\u8BF7\u9009\u62E9",rules:[{required:!0,message:"\u8BF7\u9009\u62E9"}],onClick:e[3]||(e[3]=R=>k(u)(!0))},null,8,["modelValue","min-date","max-date"]),d(_,{modelValue:o.value.proposalInsuredList[0].gender,"onUpdate:modelValue":e[5]||(e[5]=R=>o.value.proposalInsuredList[0].gender=R),name:"gender",label:"\u6027\u522B",rules:[{required:!0,message:"\u8BF7\u9009\u62E9"}]},{input:c(()=>[d(ie,{modelValue:o.value.proposalInsuredList[0].gender,"onUpdate:modelValue":e[4]||(e[4]=R=>o.value.proposalInsuredList[0].gender=R),options:k(ye)},null,8,["modelValue","options"])]),_:1},8,["modelValue"])]}),_:1})]),_:1},512),(v(!0),b(W,null,X(o.value.proposalInsuredList[0].proposalInsuredProductList||[],m=>(v(),E(V,{key:m.productId},{default:c(()=>{var A,N;return[d(It,{"product-risk-list":m.proposalProductRiskList,"product-info":m,"product-num":((N=(A=o.value.proposalInsuredList[0])==null?void 0:A.proposalInsuredProductList)==null?void 0:N.length)-1,"product-data":r.value.productCollection[m.productId],"pick-product-premium":T,onAddRiderRisk:w,onUpdateRisk:C,onDeleteRisk:F},null,8,["product-risk-list","product-info","product-num","product-data"])]}),_:2},1024))),128)),t("div",Dt,[d(le,{activated:"",round:34,onClick:j},{default:c(()=>[Ft]),_:1})])]),t("div",Rt,[t("span",gt,[yt,t("span",Ct,"\uFFE5"+L(o.value.totalPremium.toLocaleString()),1)]),t("div",Vt,[d(ce,{type:"primary",onClick:U},{default:c(()=>[Et]),_:1})])]),d(_e,{show:k(i),"onUpdate:show":e[8]||(e[8]=m=>De(i)?i.value=m:null),position:"bottom"},{default:c(()=>[d(pe,{type:"date",onConfirm:e[6]||(e[6]=m=>{o.value.proposalInsuredList[0].birthday=k(Le)(m).format("YYYY-MM-DD"),k(u)(!1)}),onCancel:e[7]||(e[7]=m=>k(u)(!1))})]),_:1},8,["show"]),k(B)?(v(),E(ge,{key:0,"is-show":k(B),type:r.value.type,"rider-risk":((Q=r.value.riderRisk)==null?void 0:Q[r.value.productId])||[],"product-data":r.value.productCollection[r.value.productId],"form-info":r.value.productInfo,holder:o.value.proposalHolder,insured:o.value.proposalInsuredList[0],"current-risk":r.value.currentRisk,onClose:M,onFinished:q},null,8,["is-show","type","rider-risk","product-data","form-info","holder","insured","current-risk"])):S("",!0)]}),_:1})}}});var Tt=ne(Bt,[["__scopeId","data-v-127f735c"]]);export{Tt as default};
