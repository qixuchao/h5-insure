var ea=Object.defineProperty,aa=Object.defineProperties;var ta=Object.getOwnPropertyDescriptors;var le=Object.getOwnPropertySymbols;var ra=Object.prototype.hasOwnProperty,oa=Object.prototype.propertyIsEnumerable;var ie=(D,c,h)=>c in D?ea(D,c,{enumerable:!0,configurable:!0,writable:!0,value:h}):D[c]=h,b=(D,c)=>{for(var h in c||(c={}))ra.call(c,h)&&ie(D,h,c[h]);if(le)for(var h of le(c))oa.call(c,h)&&ie(D,h,c[h]);return D},S=(D,c)=>aa(D,ta(c));import{g as ua,a9 as na,O as sa,E as m,M as ce,y as de,_ as me,l as la,h as ia,r as pe,af as ca,j as R,n as fe,p as g,m as W,H as da,t as z,z as O,A as p,J as M,C as we,k as he,F as ma,T as f,D as pa,X as fa}from"./vendor-ec22d003.js";import{_ as ha,C as ve,a1 as va,I as Fa,a4 as Fe,J as ye}from"./index-ffb14d8d.js";import{a as G}from"./order-b959e57d.js";import{S as V,R as N,f as Ee,I as ya}from"./infoCollection-136e5a76.js";import{p as De,i as Ea,u as Da,a as ga,s as Ca,g as Na}from"./trial-b88b397a.js";import{p as Ia}from"./product-8aa13bb7.js";import{a as ge,o as Ce,t as Ba,v as J,g as Ne,b as _a,j as Ie}from"./utils-734fc114.js";import{t as wa}from"./theme-ea709837.js";import{d as Be,B as Aa,D as Ta,G as Pa,S as ka,H as ba,P as Sa,U as Oa,_ as Ua,W as Ha,a as _e}from"./auth-4b3e636b.js";import{_ as La}from"./index-d31d946c.js";import"./trial-45c228cc.js";import"./index-df83cdcd.js";import"./bankCard-5b6ed885.js";import"./phoneVerify-87822f62.js";const xa={key:0},Ra={class:"page-internet-product-detail"},Ma={class:"info"},Va={class:"footer-button"},qa={class:"price"},Ya=we(" \u603B\u4FDD\u8D39"),$a=ua({setup(D){const c=na(),h=sa(),{productCode:j="BWYL2021",tenantId:E,orderNo:w,phoneNo:Ae,agentCode:U="",saleChannelId:Te,paymentMethod:Pe,certNo:X,name:Q,pageCode:ke,from:be}=h.query,Z=m(),d=m(),H=m(),v=m(),q=ke==="payBack";m(!1);const L=m(!1),I=m(!1),ee=m(0),Y=m(!1),$=m(!1),x=m({show:!1,html:""}),A=m({});let K="";const e=ce({holder:{certNo:X,certType:ve.CERT,mobile:Ae,name:Q,socialFlag:V.HAS},insured:{certNo:X,certType:ve.CERT,name:Q,socialFlag:V.HAS,relationToHolder:N.SELF},paymentMethod:Pe,renewalDK:"Y",paymentFrequency:Ee.YEAR,packageProductList:[],mobileSmsCode:""}),ae=m(Be),T=m(Be),s=ce({showInsure:!q,canInsure:!1,canUpgrade:!1}),Se=de(()=>{var t,a;return((a=(t=d.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:a.attachmentVOList.filter(r=>r.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),Oe=de(()=>{var t,a;return((a=(t=d.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:a.attachmentVOList.filter(r=>r.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),Ue=()=>{if(e.holder.certNo){const t=ye(e.holder.certNo);if(J(e.holder.certNo,18,"year"))return f("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E18\u5C81\uFF01"),!1;if(e.insured.certNo&&e.insured.relationToHolder===N.MATE){const a=ye(e.insured.certNo);if(t===a)return f("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(e.insured.certNo){if(e.insured.relationToHolder===N.CHILD&&J(e.insured.certNo,30,"day"))return f("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(e.insured.relationToHolder===N.PARENT&&!J(e.insured.certNo,71,"year"))return f("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E70\u5C81\uFF01"),!1}if([N.CHILD,N.PARENT].includes(e.insured.relationToHolder)){const t=Ne(e.holder.certNo,"year"),a=Ne(e.insured.certNo,"year");if(e.insured.relationToHolder===N.CHILD&&t-a<18)return f("\u6295\u4FDD\u4EBA\u548C\u5B50\u5973\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1;if(e.insured.relationToHolder===N.PARENT&&a-t<18)return f("\u6295\u4FDD\u4EBA\u548C\u7236\u6BCD\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1}return!0},He=()=>{const{holder:{certNo:t,mobile:a,name:r,socialFlag:n},insured:{certNo:u,name:o,socialFlag:l,relationToHolder:F},paymentMethod:y}=e;return!!(Fa(u)&&!!l)},te=()=>{c.push({path:"/internet/guaranteeUpgrade",query:S(b({},h.query),{tenantId:E,productCode:"BWYL2022",orderNo:w,agentCode:U})})},Le=()=>{$.value=!1},xe=()=>{T.value=ae.value},Re=()=>{T.value=S(b({},T.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},Me=async t=>{f.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const a=await Da(t),{code:r}=a;if(r==="10000"){f.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const n=await ga({orderNo:t.orderNo,tenantId:E}),{data:u}=n;n.code==="10000"&&(u.type===2?(x.value={show:!0,html:u.paymentUrl},console.log("data.paymentUrl",x.value),fa(()=>{console.log("document.forms",document.forms);const o=document.getElementById("cashierSubmit");o==null||o.addEventListener("submit",l=>{l.preventDefault()}),o==null||o.submit()})):window.location.href=u.paymentUrl)}s.canInsure=!0}catch{s.canInsure=!0}},Ve=t=>`${Fe}/pay?orderNo=${t}&saleUserId=${U}&tenantId=${E}`,qe=t=>`${Fe}/internet/payFail?tenantId=${E}&orderNo=${t}&agentCode=${U}&pageCode=payBack&from=${be||"normal"}`,Ye=t=>{ee.value=t,I.value=!0},$e=async t=>{console.log("risk",t);const a=_a({tenantId:E,saleUserId:U,saleChannelId:Te,detail:d.value,insureDetail:H.value,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,renewalDK:e.renewalDK,iseeBizNo:K,successJumpUrl:"",premium:v.value,holder:e.holder,insured:e.insured,tenantOrderRiskList:t,orderStatus:"",orderTopStatus:""});try{const r=await Ca(a),{code:n,data:u}=r;n==="10000"&&(f.clear(),A.value={orderNo:u.data,order:a},I.value=!0,Ye(0))}catch{f.clear(),s.canInsure=!0}},Ke=async()=>{const{calcData:t,riskVOList:a}=ge({holder:e.holder,insured:e.insured,tenantId:E,productDetail:d.value,insureDetail:H.value,paymentFrequency:e.paymentFrequency,packageRiskIdList:Ce(e.packageProductList)},!1,Ie);if(!Array.isArray(a)||a.length<1)return f("\u88AB\u4FDD\u4EBA\u5E74\u9F84\u9700\u572830\u5929(\u542B) - 70\u5C81(\u542B)\u4E4B\u95F4\uFF01"),v.value=null,{};const r=await De(t),{code:n,data:u}=r;return n==="10000"?e.insured.certNo?(v.value=u.premium,{condition:a,data:u}):(v.value=null,{condition:a,data:u}):(v.value=null,{})},We=()=>new Promise((t,a)=>{var r,n;(n=(r=Z.value)==null?void 0:r.validateForm)==null||n.call(r).then(async()=>{if(!Ue()){s.canInsure=!0;return}const{calcData:u,riskVOList:o}=ge({holder:e.holder,insured:e.insured,tenantId:E,productDetail:d.value,insureDetail:H.value,paymentFrequency:e.paymentFrequency,packageRiskIdList:Ce(e.packageProductList)},!1,Ie);(!Array.isArray(o)||o.length<1)&&(f("\u88AB\u4FDD\u4EBA\u5E74\u9F84\u9700\u572830\u5929(\u542B) - 70\u5C81(\u542B)\u4E4B\u95F4\uFF01"),v.value=null,a(new Error));const l=await De(u),{code:F,data:y}=l;F==="10000"?(v.value=y.premium,t({condition:o,data:y})):(v.value=null,a(new Error))}).catch(()=>{s.canInsure=!0})}),ze=async()=>{var t;if(q){te();return}s.canInsure=!1;try{f.loading({message:"\u8BA2\u5355\u751F\u6210\u4E2D...",forbidClick:!0});const{condition:a,data:r}=await We(),n={},u=(l=[])=>{(l||[]).forEach(F=>{var y;n[F.riskCode]=F,((y=F.riskPremiumDetailVOList)==null?void 0:y.length)&&u(F.riskPremiumDetailVOList)})};u(r.riskPremiumDetailVOList);const o=Ba({tenantId:E,riskList:a,riskPremium:n,productId:(t=d.value)==null?void 0:t.id});$e(o)}catch{f.clear(),s.canInsure=!0}},Ge=t=>{t==="allFalse"?(L.value=!1,s.canInsure=!0,Me(S(b({},A.value.order),{orderNo:A.value.orderNo,extInfo:{extraInfo:{renewalDK:e.renewalDK,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,successJumpUrl:Ve(A.value.orderNo),failUrl:qe(A.value.orderNo)},iseeBizNo:K}}))):pa.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"}).then(()=>{window.history.back()}).catch(()=>{s.canInsure=!0})},Je=()=>{s.canInsure=!0},je=()=>{s.canInsure=!0},Xe=()=>{I.value=!1,L.value=!0};me([()=>e.insured.certNo,()=>e.insured.socialFlag,()=>e.packageProductList,()=>e.paymentFrequency],la.exports.debounce(()=>{e.insured.certNo&&e.insured.socialFlag&&He()&&Ke()},500),{deep:!0,immediate:!0}),me(()=>e.insured.certNo,()=>{e.insured.certNo||(v.value=null)});const re=async()=>{var n,u,o,l,F,y,B,P,k,oe,ue,ne,se;const t=await Na({orderNo:w,tenantId:E}),{code:a,data:r}=t;if(a==="10000"){const{tenantOrderHolder:C,tenantOrderInsuredList:i,extInfo:_}=r;if(!q){Object.assign(e,{holder:{certNo:C.certNo,certType:C.certType,mobile:C.mobile,name:C.name,socialFlag:V.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(n=i[0])==null?void 0:n.certType,name:(u=i[0])==null?void 0:u.name,socialFlag:(l=(o=i[0])==null?void 0:o.extInfo)==null?void 0:l.hasSocialInsurance,relationToHolder:(F=i[0])==null?void 0:F.relationToHolder},paymentMethod:_.extraInfo.paymentMethod,paymentFrequency:_.extraInfo.paymentFrequency,renewalDK:_.extraInfo.renewalDK||"N"}),s.canInsure=!0;return}Object.assign(e,{holder:{certNo:C.certNo,certType:C.certType,mobile:C.mobile,name:C.name,socialFlag:V.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(y=i[0])==null?void 0:y.certType,name:(B=i[0])==null?void 0:B.name,socialFlag:(k=(P=i[0])==null?void 0:P.extInfo)==null?void 0:k.hasSocialInsurance,relationToHolder:(oe=i[0])==null?void 0:oe.relationToHolder},paymentMethod:_.extraInfo.paymentMethod,paymentFrequency:_.extraInfo.paymentFrequency,renewalDK:_.extraInfo.renewalDK||"N"}),v.value=(se=(ne=(ue=i[0])==null?void 0:ue.tenantOrderProductList)==null?void 0:ne[0])==null?void 0:se.premium,(r.orderStatus===G.ACCEPT_POLICY||r.orderStatus===G.PAYMENT_SUCCESS)&&(s.canUpgrade=!0,Y.value=!1,$.value=!0),r.orderStatus===G.PAYING&&(Y.value=!0,setTimeout(()=>{re()},3*1e3))}},Qe=async()=>{const t=Ia({productCode:j,withInsureInfo:!0,tenantId:E}),a=Ea({productCode:j});await Promise.all([t,a]).then(([r,n])=>{var u,o;r.code==="10000"&&(d.value=r.data,document.title=((u=r.data)==null?void 0:u.productFullName)||""),n.code==="10000"&&(e.packageProductList=(((o=n.data)==null?void 0:o.packageProductVOList)||[]).map(l=>S(b({},l),{value:ya.UN_INSURE,disabled:!1})),H.value=n.data)}),w&&re()},Ze=()=>{console.log("\u6295\u4FDD\u94FE\u63A5"),T.value=_e,ae.value=_e,s.canInsure=!0};return ia(()=>{Ze(),Qe(),setTimeout(async()=>{K=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(t,a)=>{const r=pe("van-button"),n=pe("van-config-provider"),u=ca("dompurify-html");return R(),fe(ma,null,[g(n,{"theme-vars":p(wa)},{default:W(()=>{var o,l,F,y,B,P,k;return[x.value.show?da((R(),fe("div",xa,null,512)),[[u,x.value.html]]):z("",!0),O("div",Ra,[O("div",Ma,[g(Aa,{url:(l=(o=d.value)==null?void 0:o.tenantProductInsureVO)==null?void 0:l.banner[0]},null,8,["url"]),g(Ta,{"product-name":(F=d.value)==null?void 0:F.productFullName,"product-desc":(B=(y=d.value)==null?void 0:y.showConfigVO)==null?void 0:B.desc},null,8,["product-name","product-desc"])]),g(Pa,{"show-service-config":"","guarantee-list":(k=(P=d.value)==null?void 0:P.tenantProductInsureVO)==null?void 0:k.titleAndDescVOS},null,8,["guarantee-list"]),g(ka,{detail:d.value},{form:W(()=>[g(ba,{ref_key:"formRef",ref:Z,"is-show-package":"",disable:!p(s).showInsure,"form-auth":T.value,"form-info":p(e),"product-detail":d.value,onOnReset:xe,onOnUpdate:Re},null,8,["disable","form-auth","form-info","product-detail"])]),_:1},8,["detail"]),O("div",Va,[O("div",qa,[Ya,O("span",null,M(v.value?"\uFFE5":"")+M(p(va)(v.value))+" "+M(v.value?p(e).paymentFrequency==p(Ee).YEAR?"\u5143/\u5E74":"\u5143/\u6708":""),1)]),g(r,{type:"primary",class:"right",disabled:!(p(s).canInsure||p(s).canUpgrade),onClick:ze},{default:W(()=>[we(M(p(s).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),p(w)?z("",!0):(R(),he(Sa,{key:1,"product-detail":d.value},null,8,["product-detail"])),g(Oa,{"order-no":p(w),"tenant-id":p(E),"is-show":$.value,onOnConfirm:te,onOnClose:Le},null,8,["order-no","tenant-id","is-show"])]}),_:1},8,["theme-vars"]),g(Ua,{show:L.value,"onUpdate:show":a[0]||(a[0]=o=>L.value=o),"content-list":p(Se),"active-index":0,onOnConfirmHealth:Ge,onOnCloseHealth:Je},null,8,["show","content-list"]),I.value?(R(),he(La,{key:0,show:I.value,"onUpdate:show":a[1]||(a[1]=o=>I.value=o),"content-list":p(Oe),"active-index":ee.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9","force-read-cound":2,"on-close-file-preview":"",onSubmit:Xe,onOnCloseFilePreview:je},null,8,["show","content-list","active-index"])):z("",!0),g(Ha,{"is-show":Y.value},null,8,["is-show"])],64)}}});var nt=ha($a,[["__scopeId","data-v-23c7bf06"]]);export{nt as default};
