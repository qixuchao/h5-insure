import{d as e,i as o,j as a,k as t,l as s,o as i,p as l,w as r,a as d,e as u,b as c,u as n,q as p,c as v,F as m,s as f,a8 as k,_ as R,T as C,as as L,at as I,au as y,av as h,aw as j,h as g,ax as b,ay as w,az as _,f as q,v as T}from"./index-0b6bfadc.js";import x from"./index-111997ff.js";import{a as P,b as S,g as N,s as V,i as M,m as A}from"./trial-cef143a6.js";import{_ as K}from"./index-56e236d5.js";import{S as D}from"./index-9ab68968.js";import{R as E}from"./trial-ebe446ca.js";import{_ as O}from"./TrialButton-f22c102f.js";import{u as B}from"./useOrder-16f32cdc.js";import{p as F,a as U}from"./utils-ef6c215d.js";import{q as z}from"./createProposal-12f39f74.js";import{f as $,a as H}from"./findLastIndex-d3fefdc1.js";import{c as G}from"./cloneDeep-1f872afb.js";import"./InsureInfos-3ddb0e35.js";import"./index-85b786dc.js";import"./index-71f6d8e9.js";import"./infoCollection-8466281b.js";import"./index-4d08ab07.js";import"./PolicyInfo-c6372fb1.js";import"./questionnaire-42dcb602.js";import"./util-633dd65a.js";import"./product-7bbf9c44.js";import"./constants-461c6bb9.js";import"./utils-bc35a5f7.js";import"./nextStep-2fcda554.js";import"./core-6e54b8ca.js";import"./format-31cde443.js";import"./empty-ae586b6c.js";import"./index-db464328.js";import"./utils-37855734.js";const J={class:"popup-container"},Q={class:"popup-header"},W={class:"title"},X=(e=>(h("data-v-0a46ec37"),e=e(),j(),e))((()=>d("p",{class:"tip"},"已为您挑选出以下险种",-1))),Y={class:"search"},Z={key:0,class:"risk-list"},ee=e({name:"riskSelect"});var oe=R(e({...ee,props:{type:{default:2},show:{type:Boolean,default:!1},title:null,insuredList:{default:()=>[]},mainRiskCode:{default:""},selectList:{default:()=>[]},currentProductCode:{default:""}},emits:["cancel","confirm"],setup(e,{emit:R}){const h=e,j=o(),{insurerCode:g}=j.query,b=a([]),w=a([]),_=a([]),q=a(),T=t((()=>h.show)),x=()=>{R("cancel")},N=()=>{var e;if(!(null==(e=b.value)?void 0:e.length))return void C(`暂未添加任何${h.type===E.MAIN_RISK?"主":"附加"}险`);let o=[];o=h.type===E.RIDER_RISK?b.value:w.value.filter((e=>b.value.includes(e.productCode))).map((e=>({productCode:e.productCode,mergeRiskReqList:(e.mainRiskCollocationList||[]).map((e=>({riskCode:e.collocationRiskCode,riskType:e.mainRiskCode?2:1,mainRiskCode:e.mainRiskCode})))}))),R("confirm",o)},V=async()=>{var e;const o={insuredList:h.insuredList,mainRiskCode:h.mainRiskCode,insurerCode:g,productCategory:"",keyword:q.value,selectProductCodes:[],selectRiskCodes:[],filterFlag:(null==(e=h.selectList)?void 0:e.length)?1:2};if(o.selectProductCodes=h.selectList.map((e=>(e.productCode===h.currentProductCode&&o.selectRiskCodes.push(...e.mergeRiskReqList.map((e=>e.riskCode))),e.productCode))),h.type===E.MAIN_RISK){const{code:e,data:a}=await P(o);"10000"===e&&(w.value=a)}else{const{code:e,data:a}=await S(o);"10000"===e&&(w.value=a.riskInfoList,_.value=a.collocationInfoResList)}};return s((()=>{V()})),(o,a)=>{const t=D,s=L,R=I,C=K,j=y;return i(),l(j,{show:n(T),"onUpdate:show":a[2]||(a[2]=e=>p(T)?T.value=e:null),class:"popup-risk-select",closeable:!1},{default:r((()=>{var o;return[d("div",J,[d("div",Q,[d("span",{class:"clear-all",onClick:x}," 取消 "),d("span",W,u(e.title),1),d("span",{class:"close",onClick:N},"确认")]),X,d("div",Y,[c(t,{modelValue:n(q),"onUpdate:modelValue":a[0]||(a[0]=e=>p(q)?q.value=e:null),shape:"round",placeholder:"请输入产品名称进行搜索","clear-trigger":"always","show-action":"",clearable:"",onSearch:V},null,8,["modelValue"])]),(null==(o=n(w))?void 0:o.length)?(i(),v("div",Z,[c(R,{modelValue:n(b),"onUpdate:modelValue":a[1]||(a[1]=e=>p(b)?b.value=e:null)},{default:r((()=>[(i(!0),v(m,null,f(n(w),(e=>(i(),l(s,{key:e.riskCode||e.productCode,name:e.riskCode||e.productCode,onClick:()=>{return o=e.riskCode,h.type===E.RIDER_RISK&&(_.value||[]).forEach((e=>{b.value.includes(o)?o===e.relatedRiskCode?(2===e.collocationType&&b.value.push(e.collocationRiskCode),3===e.collocationType&&(b.value.push(o),b.value=b.value.filter((o=>o!==e.collocationRiskCode)))):o===e.collocationRiskCode&&(2===e.collocationType&&b.value.push(e.relatedRiskCode),3===e.collocationType&&(b.value=b.value.filter((o=>o!==e.relatedRiskCode)))):o===e.relatedRiskCode?(2===e.collocationType&&(b.value=b.value.filter((o=>o!==e.collocationRiskCode))),3===e.collocationType&&(b.value.push(o),b.value=b.value.filter((o=>o!==e.collocationRiskCode)))):o===e.collocationRiskCode&&(2===e.collocationType&&(b.value=b.value.filter((o=>o!==e.relatedRiskCode))),3===e.collocationType&&(b.value=b.value.filter((o=>o!==e.relatedRiskCode))))})),void(b.value=[...new Set(b.value)]);var o}},{default:r((()=>[k(u(e.riskName||e.productName),1)])),_:2},1032,["name","onClick"])))),128))])),_:1},8,["modelValue"])])):(i(),l(C,{key:1,title:`暂无关联${e.type===n(E).MAIN_RISK?"主":"附加"}险、请选择其他险种`},null,8,["title"]))])]})),_:1},8,["show"])}}}),[["__scopeId","data-v-0a46ec37"]]);const ae={class:"page-trial-wrap"},te=e({name:"trial"}),se=e({...te,setup(e){const d=o(),u=g(),{productCode:p,orderNo:m,tenantId:f,proposalId:k,proposalInsuredId:R}=d.query,C=a({}),L=a({productList:[]}),I=a([]),y=a({}),h=a(),j=a(),P=a(),S=B({extInfo:{templateId:201,buttonCode:b.TRIAL_PREMIUM,pageCode:w.TRIAL_PREMIUM}}),K=a(),D=a(),J=a(1),Q=t((()=>J.value===E.MAIN_RISK?"添加主险":"添加附加险")),W=a(!1),X=()=>{A(L.value).then((({code:e,data:o})=>{if("10000"===e){const{productDetailResList:e,productFactor:a}=o;D.value=a,L.value=U(e);const t={};e.forEach((e=>{t[e.productCode]=e})),C.value=t}}))},Y=()=>{W.value=!1},Z=e=>{if(J.value===E.MAIN_RISK){L.value.productList.push(...e);const o=e.map((e=>e.productCode));h.value.getProductDefaultValue(o)}else{const o=L.value.productList.find((e=>e.productCode===j.value)),a=e.map((e=>({riskCode:e,riskType:E.RIDER_RISK,mainRiskCode:y.value.riskCode}))),t=$(o.mergeRiskReqList,(e=>e.riskCode===y.value.riskCode)),s=H(o.mergeRiskReqList,(e=>e.mainRiskCode===y.value.riskCode));let i=t;-1!==s&&(i=s),o.mergeRiskReqList=[...o.mergeRiskReqList.slice(0,i+1),...a,...o.mergeRiskReqList.slice(i+1,o.mergeRiskReqList.length)],h.value.getRiderRiskDefaultValue(j.value,e,y.value.riskCode,o.mergeRiskReqList)}X(),W.value=!1},ee=(e,o,a)=>{W.value=!0,J.value=E.RIDER_RISK,I.value=a,y.value=o,j.value=e},te=e=>{W.value=!0,J.value=E.MAIN_RISK,I.value=e},se=(e,o,a)=>{C.value[e],a?(C.value[e].productPlanInsureVOList[0].insureProductRiskVOList=C.value[e].productPlanInsureVOList[0].insureProductRiskVOList.filter((e=>e.riskCode!==o)),L.value.productList=L.value.productList.map((a=>(a.productCode===e&&(a.mergeRiskReqList=a.mergeRiskReqList.filter((e=>e.riskCode!==o))),a)))):(L.value.productList=L.value.productList.filter((o=>o.productCode!==e)),X())},ie=()=>{h.value.onNext((async e=>{var o;const a=G(e),t=["id","relationToHolder","beneficiaryList","guardian","insuredBeneficiaryType"];m||Object.keys(null==(o=a.insuredList)?void 0:o[0]).reduce(((e,o)=>{var s,i,l,r;return!t.includes(o)&&(null==(i=null==(s=a.insuredList)?void 0:s[0])?void 0:i[o])&&(e[o]=null==(r=null==(l=a.insuredList)?void 0:l[0])?void 0:r[o]),e}),a.holder),a.extInfo&&(a.extInfo.iseeBizNo=P.value);const{code:s,data:i}=await V(a);"10000"===s&&u.push({path:T.questionNotice,query:{...d.query,orderNo:i}})}))};return _((()=>{m?N({orderNo:m,tenantId:f}).then((({code:e,data:o})=>{"10000"===e&&(K.value=o,S.value=o,L.value=F(o.insuredList[0].productList),X())})):k?z({id:k,tenantId:f}).then((({code:e,data:o})=>{if("10000"===e){const{holder:e,insuredList:a}=o,t=(p||"").split(",");let s=[];const i=(a||[]).filter((e=>e.id===+R)).map((e=>({...e,productList:e.productList.filter((e=>!!t.includes(e.productCode)&&(s=e.occupationCodeList,!0)))})));i[0].occupationCodeList=s,Object.assign(S.value,{renewFlag:"",holder:e,tenantId:f,proposalId:k,insuredList:i}),K.value=S.value,L.value=F(S.value.insuredList[0].productList),X()}})):M({productCode:p,isTenant:!1}).then((({data:e,code:o})=>{var a,t;"10000"===o&&(C.value[`${p}`]=e,D.value=null==(t=null==(a=null==e?void 0:e.productPlanInsureVOList)?void 0:a[0])?void 0:t.productFactor,L.value=U([e]))}))})),s((()=>{setTimeout((async()=>{P.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,o)=>(i(),v("div",ae,[c(x,{ref_key:"trialRef",ref:h,"product-collection":n(C),"default-data":n(K),"product-factor":n(D),"product-risk-code-map":n(L),"is-trial":"","hide-benefit":"",onAddRisk:ee,onAddMainRisk:te,onDeleteRisk:se},{trialBtn:r((({riskPremium:e})=>[c(O,{premium:null==e?void 0:e.initialPremium,onHandleClick:ie},null,8,["premium"])])),_:1},8,["product-collection","default-data","product-factor","product-risk-code-map"]),n(W)?(i(),l(oe,{key:0,type:n(J),show:n(W),"insured-list":n(I),title:n(Q),"current-product-code":n(j),"main-risk-code":n(y).riskCode,"select-list":n(L).productList,onCancel:Y,onConfirm:Z},null,8,["type","show","insured-list","title","current-product-code","main-risk-code","select-list"])):q("",!0)]))}});export{se as default};
