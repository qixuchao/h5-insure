import{T as e,d as a,i as l,j as s,z as n,cm as t,cn as u,o,c as i,a as r,f as c,u as v,q as d,b as g,w as p,a8 as m,e as f,F as h,n as y,l as w,co as S,m as _,_ as b,cp as k,cq as V,ag as C,cr as A}from"./index-d0a5373e.js";var T=e;const U={class:"sign-wrap"},x=["src"],R={class:"popup-body"},j={class:"sign-container-wrap"},q={class:"operate-bar"},z=a({name:"sign"});var I=b(a({...z,props:{option:{default:{}},modelValue:{default:""},signString:{default:"房间卡贺卡和大伙副书记环境发好"},signAccount:{default:3}},emits:["update:modelValue","submitSign"],setup(e,{expose:a,emit:b}){const z=e,I=l(!1),N=l(),D=l(""),E=l([]),F=l(0),L=s((()=>{if(z.signString&&z.signString.length>=z.signAccount){const e=[];let a=0;for(let l=0;l<=z.signString.length;l++)!l||l%z.signAccount||(a+=1),z.signString[l]&&(e[a]?e[a]+=z.signString[l]:e[a]=z.signString[l]);return e}return[""]}));s((()=>{var e,a;return(null==(e=L.value)?void 0:e.length)!==(null==(a=E.value)?void 0:a.length)}));const P=l(!0),$=l(),B=()=>{0!==F.value&&$.value&&(F.value-=1,$.value.swipeTo(F.value))},G=()=>{var e;I.value=!0,null==(e=N.value)||e.clear(),setTimeout((()=>{var e;null==(e=N.value)||e.setDataURL(D.value),z.modelValue?P.value=!1:P.value=!0}))},H=()=>{k({images:[D.value],className:"customer-sign-preview"})},J=()=>{I.value=!1},K=()=>{if(F.value===L.value.length-1)return;F.value,z.signAccount;L.value[F.value].length,$.value&&(F.value+=1,$.value.swipeTo(F.value))},M=()=>{var e,a;E.value=[],null==(a=null==(e=N.value)?void 0:e.clear)||a.call(e),D.value="",P.value=!0,b("update:modelValue","")},O=()=>{var e,a;if(console.log("222222"),(null==(e=E.value)?void 0:e.length)!==(null==(a=L.value)?void 0:a.length))return void T({message:"请完成抄录",className:"toast-vertical"});const l=[];E.value.forEach((async(e,a)=>{l.push(V(e,270))})),Promise.all(l).then((e=>{const a=e.map(((e,a)=>e));console.log("222222"),b("update:modelValue",a),b("submitSign",a),I.value=!1}))};return n((()=>z.modelValue),(()=>{D.value=z.modelValue}),{immediate:!0}),a({rewrite:M,openSign:G}),(e,a)=>{const l=C,s=t,n=u,b=A;return o(),i(h,null,[r("div",U,[c(e.$slots,"signImg",{data:v(D)},(()=>[v(D)?(o(),i("img",{key:0,class:"preview-sign",src:v(D),alt:"",onClick:H},null,8,x)):d("",!0),g(l,{type:"primary",round:"",size:"small",onClick:G},{default:p((()=>[m(f(v(D)?"重新签名":"点击签字"),1)])),_:1})]),!0)]),g(b,{show:v(I),"onUpdate:show":a[1]||(a[1]=e=>_(I)?I.value=e:null),position:"bottom",style:{height:"100%",overflow:"hidden"}},{default:p((()=>[r("div",R,[r("div",j,[g(n,{ref_key:"swipeRef",ref:$,vertical:"",loop:!1,"show-indicators":!1,touchable:!1},{default:p((()=>[(o(!0),i(h,null,y(v(L),((e,l)=>(o(),w(s,{key:l},{default:p((()=>[g(S,{ref_for:!0,ref_key:"signRef",ref:N,modelValue:v(E)[l],"onUpdate:modelValue":e=>v(E)[l]=e,placeholder:e,onStroke:a[0]||(a[0]=e=>P.value=!1),onSignSuccess:K},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1024)))),128))])),_:1},512),r("div",q,[g(l,{type:"primary",class:"btn",onClick:O},{default:p((()=>[m("确定")])),_:1}),g(l,{type:"primary",plain:"",class:"btn",onClick:B},{default:p((()=>[m("上一页")])),_:1}),g(l,{type:"primary",plain:"",class:"btn",onClick:M},{default:p((()=>[m("重签")])),_:1}),g(l,{type:"default",class:"btn",onClick:J},{default:p((()=>[m("取消")])),_:1})])])])])),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-ccaadcf2"]]);export{I as S};
