import{T as e,d as l,j as a,k as s,E as n,cT as u,cU as t,o as i,c as o,a as r,g as v,u as d,f as c,b as g,w as p,v as m,e as f,F as h,s as b,p as S,cV as y,q as w,_,cW as k,b3 as V,cs as C}from"./index-616b3e40.js";import{c as T}from"./cloneDeep-34a4a9cb.js";var U=e;const A={class:"sign-wrap"},j=["src"],x={class:"popup-body"},E={class:"sign-container-wrap"},R={class:"operate-bar"},D=l({name:"sign"});var I=_(l({...D,props:{option:{default:{}},modelValue:{default:()=>[]},signString:{default:"房间卡贺卡和大伙副书记环境发好"},signAccount:{default:3}},emits:["update:modelValue","submitSign"],setup(e,{expose:l,emit:_}){const D=e,I=a(!1),N=a(),q=_,z=a([]),F=a([]),L=a(0),W=s((()=>{if(D.signString&&D.signString.length>=D.signAccount){const e=[];let l=0;for(let a=0;a<=D.signString.length;a++)!a||a%D.signAccount||(l+=1),D.signString[a]&&(e[l]?e[l]+=D.signString[a]:e[l]=D.signString[a]);return e}return[D.signString||""]})),$=s((()=>{var e;const l=z.value.filter((e=>e));return(null==(e=W.value)?void 0:e.length)>(null==l?void 0:l.length)})),B=a(!0),G=a(),H=()=>{0!==L.value&&G.value&&(L.value-=1,G.value.swipeTo(L.value))},J=e=>{I.value=!0,setTimeout((()=>{var l;N.value&&((N.value||[]).forEach(((l,a)=>{var s,n,u;e?null==(s=l.clear)||s.call(l):null==(u=l.setDataURL)||u.call(l,(null==(n=z.value)?void 0:n[a])||"")})),(null==(l=D.modelValue)?void 0:l.length)&&!e?B.value=!1:B.value=!0)}),200)},K=()=>{k({images:z.value,className:"customer-sign-preview"})},M=()=>{z.value=T(F.value),I.value=!1},O=()=>{if(L.value===W.value.length-1)return;L.value,D.signAccount;W.value[L.value].length,G.value&&(L.value+=1,G.value.swipeTo(L.value))},P=()=>{(N.value||[]).forEach(((e,l)=>{var a;l===L.value&&(null==(a=e.clear)||a.call(e))}))},Q=()=>{var e,l;(null==(e=z.value)?void 0:e.length)<(null==(l=W.value)?void 0:l.length)?U({message:"请完成签名",className:"toast-vertical"}):(q("update:modelValue",z.value),q("submitSign",z.value),I.value=!1)};return n([()=>D.modelValue,()=>W.value],(()=>{z.value=(D.modelValue||[]).slice(0,W.value.length),F.value=(D.modelValue||[]).slice(0,W.value.length)}),{immediate:!0,deep:!0}),l({rewrite:P,openSign:J}),(e,l)=>{var a,s;const n=V,_=u,k=t,T=C;return i(),o(h,null,[r("div",A,[v(e.$slots,"signImg",{data:(null==(a=d(F))?void 0:a[0])||(null==(s=d(z))?void 0:s[0])},(()=>{var l,a;return[d(z).length?(i(),o("img",{key:0,class:"preview-sign",src:(null==(l=d(F))?void 0:l[0])||(null==(a=d(z))?void 0:a[0]),alt:"",onClick:K},null,8,j)):c("",!0),g(n,{type:"primary",round:"",size:"small",onClick:J},{default:p((()=>[m(f(e.signString?"重新签名":"点击签名"),1)])),_:1})]}),!0)]),g(T,{show:d(I),"onUpdate:show":l[1]||(l[1]=e=>w(I)?I.value=e:null),position:"bottom",style:{height:"100%",overflow:"hidden"}},{default:p((()=>[r("div",x,[r("div",E,[g(k,{ref_key:"swipeRef",ref:G,vertical:"",loop:!1,"show-indicators":!1,touchable:!1},{default:p((()=>[(i(!0),o(h,null,b(d(W),((e,a)=>(i(),S(_,{key:a},{default:p((()=>[g(y,{ref_for:!0,ref_key:"signRef",ref:N,modelValue:d(z)[a],"onUpdate:modelValue":e=>d(z)[a]=e,placeholder:e,onStroke:l[0]||(l[0]=e=>B.value=!1),onSignSuccess:O},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1024)))),128))])),_:1},512),r("div",R,[g(n,{type:"primary",class:"btn",disabled:d($),onClick:Q},{default:p((()=>[m("确定")])),_:1},8,["disabled"]),g(n,{type:"primary",plain:"",class:"btn",onClick:H},{default:p((()=>[m("上一页")])),_:1}),g(n,{type:"primary",plain:"",class:"btn",onClick:P},{default:p((()=>[m("重签")])),_:1}),g(n,{type:"default",class:"btn",onClick:M},{default:p((()=>[m("取消")])),_:1})])])])])),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-1df57696"]]);export{I as S};
