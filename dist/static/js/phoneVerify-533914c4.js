import{E as a,d as e,r as s,u as r,a0 as t,b as l,c as o,e as d,w as n,f as u,z as i,g as c,ab as p,a1 as v,bA as f,A as I,i as m,j as b,m as N,T as C,B as E,ag as _,ah as T}from"./index-ba4bbbcf.js";import{s as h,c as y}from"./phoneVerify-bf6e4d88.js";import{c as O}from"./format-12461bbc.js";import{O as j}from"./order-dfb2f2a0.js";import{p as A}from"./pageJump-54c0fb5f.js";import{u as S}from"./useOrder-ad292b64.js";import"./pdfh5-008ca364.js";const g={class:"page-phone-verify"},P=(a=>(_("data-v-31cacf2d"),a=a(),T(),a))((()=>u("div",{class:"title"},"通过投保人手机号验证后，可进行投保信息填写",-1))),D={class:"phone"},q={class:"input-wrapper"};var F=a(e({__name:"phoneVerify",setup(a){const e=S(),_=s(""),T=s(""),F=s(0);let R;const U=r(),{agentCode:w,tenantId:G,templateId:V,productCode:W,insurerCode:k,orderNo:x}=U.query,H=()=>{h(_.value).then((({code:a})=>{"10000"===a&&(F.value=60,R=setInterval((()=>{F.value-=1,F.value<=0&&clearInterval(R)}),1e3))}))},L=()=>{y(_.value,T.value).then((({code:a,data:s})=>{"10000"===a&&s?(C.success("验证成功"),e.value.orderStatus===j.PROCESSING?A("infoCollection",U.query):[j.WAIT_IDENTIFICATION,j.IDENTIFICATION_COMPLETE,j.IN_IDENTIFICATION].includes(e.value.orderStatus)&&A("infoPreview",U.query)):C.fail("验证失败")}))};return t((()=>{N({orderNo:x,saleUserId:w,tenantId:G}).then((({code:a,data:s})=>{var r,t;Object.assign(e.value,s),_.value=null==(r=null==s?void 0:s.tenantOrderHolder)?void 0:r.mobile,"10000"===a&&([j.PENDING,j.PAYMENT_FAILED,j.UNDER_WRITING_SUCCESS].includes(s.orderStatus)?_.value=null==(t=null==s?void 0:s.tenantOrderHolder)?void 0:t.mobile:A("paymentResult",U.query))}))})),(a,e)=>{const s=E,r=l("ProPageWrap");return o(),d(r,null,{default:n((()=>[u("div",g,[P,u("div",D,i(c(O)(c(_)||"")),1),u("div",q,[p(u("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>v(T)?T.value=a:null),placeholder:"请输入验证码",class:"input"},null,512),[[f,c(T)]]),u("div",{class:I(["btn",{second:c(F)}]),onClick:H},i(c(F)?`${c(F)}s`:"发送验证码"),3)]),m(s,{type:"primary",class:"submit-btn",onClick:L},{default:n((()=>[b("下一步")])),_:1})])])),_:1})}}}),[["__scopeId","data-v-31cacf2d"]]);export{F as default};
