var fe=Object.defineProperty,De=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var Fe=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable;var ee=(B,s,_)=>s in B?fe(B,s,{enumerable:!0,configurable:!0,writable:!0,value:_}):B[s]=_,O=(B,s)=>{for(var _ in s||(s={}))Fe.call(s,_)&&ee(B,_,s[_]);if(Z)for(var _ of Z(s))ve.call(s,_)&&ee(B,_,s[_]);return B},S=(B,s)=>De(B,Ce(s));import{g as Ae,O as he,ak as pe,E as $,d as ye,y as ge,h as me,r as V,j as E,k as x,m as f,z as t,p as D,J as h,n as v,L as ue,t as k,A as g,G as M,F as q,a4 as Te,a5 as Ne,C as I,T as w,D as ke}from"./vendor-df2d8bed.js";import{q as Ie}from"./index-15376f4b.js";import{_ as Re,S as Oe,I as Se,J as xe,q as j,l as b,K as te,N as se,n as we,P as be,r as Pe}from"./index-5323229f.js";import{_ as He}from"./index-9d14ced5.js";import{g as Le,f as Ue,s as ae,a as $e}from"./verify-be167691.js";const Y=B=>(Te("data-v-736dc3a2"),B=B(),Ne(),B),Ve={class:"page-verify"},Me={class:"people"},qe={class:"name"},je={class:"verify-item"},Ye=Y(()=>t("div",{class:"label"},"\u8BC1\u4EF6\u53F7\u7801",-1)),ze={class:"no"},Ge=I(" \u53BB\u8BA4\u8BC1 "),Je={class:"sign-body"},Qe={class:"date"},We={class:"file"},Ke=I(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A "),Xe={class:"people"},Ze={class:"name"},eu={class:"verify-item"},uu=Y(()=>t("div",{class:"label"},"\u8BC1\u4EF6\u53F7\u7801",-1)),tu={class:"no"},su=["onClick"],au=I(" \u53BB\u8BA4\u8BC1 "),ou=["onClick"],nu={class:"sign-body"},ru={class:"date"},iu={class:"file"},lu=I(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A "),cu={class:"footer-button footer"},du=Y(()=>t("div",{class:"text"},"\u5237\u65B0",-1)),Bu=I("\u5206\u4EAB"),_u=I("\u63D0\u4EA4"),Eu=Ae({setup(B){const s={CERT:1,NO_CERT:2},_=he(),oe=pe(),{saleUserId:z="D1234567-1",tenantId:m="9991000007",templateId:ne=1,productCode:re="CQ75CQ76",insurerCode:ie="ancheng",isShare:G}=_.query;let{orderNo:p}=_.query;typeof p=="object"&&(p=(p||[])[0]);const P=new Oe({source:"localStorage"}),H=$([]),a=$(),T=$(),y=[],J=ye().format("YYYY-MM-DD"),le=()=>{var u;(u=T.value)==null||u.clear()},ce=u=>{y[u].clear()},Q=(u,n)=>{$e({callbackUrl:window.location.href,certiNo:u,faceAuthMode:"TENCENT",userName:n,tenantId:9991000007}).then(i=>{const{code:r,data:l}=i;if(r==="10000"){const{originalUrl:F,serialNo:e}=l;window.location.href=F,P.set("verifyData",{serialNo:e,certNo:u,name:n})}})},N=u=>`${u}`===xe.CERT,W=u=>{var n,i,r,l;u===-1?Q((n=a.value.tenantOrderHolder)==null?void 0:n.certNo,(i=a.value.tenantOrderHolder)==null?void 0:i.name):Q((r=a.value.tenantOrderInsuredList[u])==null?void 0:r.certNo,(l=a.value.tenantOrderInsuredList[u])==null?void 0:l.name)},de=u=>{u&&y.every(n=>n!==u)&&y.push(u)},Be=()=>{var n,i,r,l,F;if((n=T.value)==null?void 0:n.isEmpty()){w.fail("\u8BF7\u6295\u4FDD\u4EBA\u7B7E\u540D");return}if(y.some(e=>e.isEmpty())){w.fail("\u8BF7\u88AB\u4FDD\u4EBA\u7B7E\u540D");return}if(((r=(i=a.value.tenantOrderHolder)==null?void 0:i.extInfo)==null?void 0:r.isCert)!==s.CERT&&N((l=a.value.tenantOrderHolder)==null?void 0:l.certType)){w.fail("\u8BF7\u6295\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}if((F=a.value.tenantOrderInsuredList)==null?void 0:F.some(e=>{var c;return((c=e.extInfo)==null?void 0:c.isCert)!==s.CERT&&N(e.certType)})){w.fail("\u8BF7\u88AB\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}ke.confirm({title:"\u63D0\u793A",message:"\u8BF7\u786E\u8BA4\u4FE1\u606F\u586B\u5199\u65E0\u8BEF\u540E\uFF0C\u518D\u8FDB\u884C\u652F\u4ED8"}).then(()=>{var c,o;const e=(c=T.value)==null?void 0:c.save();Promise.all([ae("HOLDER",e,(o=a.value)==null?void 0:o.id,`${m}`),...y.map(d=>{var C;return ae("INSURED",d.save(),(C=a.value)==null?void 0:C.id,`${m}`)})]).then(()=>{we(S(O({},a.value),{pageCode:"sign",operateOption:{withSignInfo:!0},extInfo:S(O({},a.value.extInfo),{pageCode:"sign",templateId:ne}),venderCode:ie})).then(d=>{const{code:C,data:A}=d;C==="10000"&&A.success&&oe.push({path:be[A.pageAction.data.nextPageCode],query:{orderNo:p,saleUserId:z,tenantId:m}})})})})},L=()=>{Pe({orderNo:p,saleUserId:z,tenantId:m}).then(u=>{const{code:n,data:i}=u;n==="10000"&&(a.value=i,setTimeout(()=>{let r=0;i.tenantOrderAttachmentList.forEach(l=>{l.category===21&&(l.objectType===2?(T.value.clear(),T.value.setDataURL(l.fileBase64)):l.objectType===1&&(y[r].clear(),y[r].setDataURL(l.fileBase64),r+=1))})}))})},_e=()=>{L()},Ee=ge(()=>{const u=S(O({},_.query),{isShare:1,sharePageCode:"sign"});return`${window.location.origin}/phoneVerify?${Ie.stringify(u)}`});return me(()=>{L(),Le({orderNo:p,productCode:re,tenantId:m}).then(n=>{const{code:i,data:r}=n;i==="10000"&&(H.value=r||[])});const u=P.get("verifyData");if(u){const{serialNo:n,certNo:i,name:r}=u;Ue({certiNo:i,orderNo:p,serialNo:n,tenantId:m,userName:r}).then(l=>{const{code:F,data:e}=l;F==="10000"&&(P.remove("verifyData"),L())})}}),(u,n)=>{const i=V("ProPDFviewer"),r=V("van-button"),l=V("ProPageWrap");return E(),x(l,null,{default:f(()=>{var F;return[t("div",Ve,[D(Se,{type:"warning",title:"\u5C0A\u656C\u7684\u5BA2\u6237\uFF0C\u672C\u6B21\u6295\u4FDD\u9700\u8981\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",content:"\u672C\u4EA7\u54C1\u6295\u4FDD\u9700\u8981\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u8FDB\u884C\u5B9E\u540D\u8BA4\u8BC1\uFF0C\u60A8\u8D2D\u4E70\u672C\u4EA7\u54C1\u7684\u7D2F\u8BA1\u603B\u4FDD\u8D39\u5DF2\u8D85\u8FC720\u4E07\uFF0C\u6309\u76D1\u7BA1\u8981\u6C42\uFF0C\u9700\u8981\u63D0\u4F9B\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u3001\u6307\u5B9A\u53D7\u76CA\u4EBA\u8BC1\u4EF6\u5F71\u50CF\uFF0C\u672C\u4EA7\u54C1\u975E\u672C\u4EBA\u6295\u4FDD\u4E14\u5E26\u8EAB\u6545\u8D23\u4EFB\u3001\u9700\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\uFF08\u6210\u4EBA\uFF09\u7684\u6295\u4FDD\u610F\u613F\u8FDB\u884C\u7B7E\u5B57\u786E\u8BA4\u3002"}),D(b,{title:"\u6295\u4FDD\u4EBA",class:"card"},{extra:f(()=>{var e,c,o,d,C,A,R,U,K,X;return[t("div",Me,[t("div",qe,h((c=(e=a.value)==null?void 0:e.tenantOrderHolder)==null?void 0:c.name),1),N((d=(o=a.value)==null?void 0:o.tenantOrderHolder)==null?void 0:d.certType)?(E(),v("div",{key:0,class:ue(["status",{verified:((R=(A=(C=a.value)==null?void 0:C.tenantOrderHolder)==null?void 0:A.extInfo)==null?void 0:R.isCert)===s.CERT}])},h(((X=(K=(U=a.value)==null?void 0:U.tenantOrderHolder)==null?void 0:K.extInfo)==null?void 0:X.isCert)===s.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)):k("",!0)])]}),default:f(()=>{var e,c,o,d,C,A,R;return[t("div",je,[Ye,t("div",ze,h((c=(e=a.value)==null?void 0:e.tenantOrderHolder)==null?void 0:c.certNo),1),((C=(d=(o=a.value)==null?void 0:o.tenantOrderHolder)==null?void 0:d.extInfo)==null?void 0:C.isCert)!==s.CERT&&N((R=(A=a.value)==null?void 0:A.tenantOrderHolder)==null?void 0:R.certType)?(E(),v("div",{key:0,class:"action",onClick:n[0]||(n[0]=U=>W(-1))},[Ge,D(j,{name:"right_arrow",class:"icon"})])):k("",!0)])]}),_:1}),D(b,{title:"\u6295\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:f(()=>[t("div",{class:"resign",onClick:le},"\u91CD\u7B7E")]),default:f(()=>[D(te,{ref_key:"holderSign",ref:T,class:"sign"},null,512),t("div",Je,[t("div",Qe,"\u7B7E\u540D\u65E5\u671F\uFF1A "+h(g(J)),1),t("div",We,[Ke,(E(!0),v(q,null,M(H.value.filter(e=>e.noticeObject===g(se).HOLDER),(e,c)=>(E(),x(i,{key:c,class:"file",title:`\u300A${e.materialName}\u300B`,url:e.materialSource},null,8,["title","url"]))),128))])])]),_:1}),(E(!0),v(q,null,M((F=a.value)==null?void 0:F.tenantOrderInsuredList,(e,c)=>(E(),v("div",{key:c},[D(b,{title:"\u88AB\u4FDD\u4EBA",class:"card"},{extra:f(()=>{var o,d;return[t("div",Xe,[t("div",Ze,h(e.name),1),N(e.certType)?(E(),v("div",{key:0,class:ue(["status",{verified:((o=e.extInfo)==null?void 0:o.isCert)===s.CERT}])},h(((d=e.extInfo)==null?void 0:d.isCert)===s.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)):k("",!0)])]}),default:f(()=>{var o;return[t("div",eu,[uu,t("div",tu,h(e.certNo),1),((o=e.extInfo)==null?void 0:o.isCert)!==s.CERT&&N(e.certType)?(E(),v("div",{key:0,class:"action",onClick:d=>W(c)},[au,D(j,{name:"right_arrow",class:"icon"})],8,su)):k("",!0)])]}),_:2},1024),D(b,{title:"\u88AB\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:f(()=>[t("div",{class:"resign",onClick:o=>ce(c)},"\u91CD\u7B7E",8,ou)]),default:f(()=>[D(te,{ref_for:!0,ref:de,class:"sign"}),t("div",nu,[t("div",ru,"\u7B7E\u540D\u65E5\u671F\uFF1A "+h(g(J)),1),t("div",iu,[lu,(E(!0),v(q,null,M(H.value.filter(o=>o.noticeObject===g(se).INSURED),(o,d)=>(E(),x(i,{key:d,class:"file",title:`\u300A${o.materialName}\u300B`,url:o.materialSource},null,8,["title","url"]))),128))])])]),_:2},1024)]))),128)),t("div",cu,[g(G)?k("",!0):(E(),v("div",{key:0,class:"refresh-btn",onClick:_e},[t("div",null,[D(j,{name:"refresh"})]),du])),g(G)?k("",!0):(E(),x(He,{key:1,title:"\u9080\u8BF7\u60A8\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",desc:"\u9080\u8BF7\u60A8\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",link:g(Ee)},{default:f(()=>[D(r,{plain:"",type:"primary",class:"share-btn"},{default:f(()=>[Bu]),_:1})]),_:1},8,["link"])),D(r,{type:"primary",class:"submit-btn",onClick:Be},{default:f(()=>[_u]),_:1})])])]}),_:1})}}});var hu=Re(Eu,[["__scopeId","data-v-736dc3a2"]]);export{hu as default};
