import{d as e,i,r as n,z as r,o as a,l as o,w as l,f as s,u as t,b9 as d,ba as u,_ as c,bb as m,bc as p,bd as f,be as v,am as y,bf as g,j as h,aB as V,bg as b,bh as O,c as I,b as T,q as S,F as x,n as w,a8 as L,aA as C,ae as k,h as N,ac as j,ax as F,aq as _,a0 as B,a as J,T as H,bi as $,b8 as M,bj as P,bk as R,as as U,at as E,au as q}from"./index-f532db20.js";import{S as A}from"./index-97b93ce9.js";import{_ as D,a as K}from"./empth-c0adfdba.js";import{c as z}from"./cloneDeep-7be160ee.js";import"./PolicyInfo-b798c202.js";import{h as Y}from"./trial-90f2cd38.js";import{l as G}from"./lodash-eed54c2d.js";import{B as Q}from"./infoCollection-07eb5a4d.js";import{O as W}from"./questionnaire-62331097.js";import{L as X}from"./index-e36b0cf2.js";import{S as Z}from"./search-71699e0a.js";const ee=e({name:"BeneficiaryItem"});var ie=c(e({...ee,props:{modelValue:{default:()=>({})},schema:{default:()=>[]},config:{default:()=>({})},isView:{type:Boolean,default:!1},isTrial:{type:Boolean,default:!1},title:{default:"受益人"}},emits:["update:modelValue","trailChange"],setup(e,{expose:c,emit:h}){const V=e,b=i(null),O=n({validated:!1,schema:[],config:{},personVO:{}});return r((()=>V.config),(e=>{e&&Object.assign(O.config,e)}),{deep:!0,immediate:!0}),r((()=>V.schema),(e=>{e&&Object.assign(O.schema,z(V.schema))}),{deep:!0,immediate:!0}),r((()=>V.modelValue),((e,i)=>{JSON.stringify(e)!==JSON.stringify(i)&&(f("受益人数据变动了"),Object.assign(O.personVO,e))}),{deep:!0,immediate:!0}),r((()=>O.personVO),(e=>{e&&h("update:modelValue",e)}),{deep:!0,immediate:!0}),r((()=>{var e;return null==(e=O.personVO)?void 0:e.relationToInsured}),((e,i)=>{if(e===i)return!1;f("受益人与被保人关系变动了");const{certType:n}=O.personVO||{},[r,a]=v(O.schema,{certType:n,relationToHolder:e});return y(O.config,a),!V.isView&&e&&i&&Object.assign(O.personVO,{...g(O.personVO,(e=>!(r&&"certType"===e))),relationToInsured:e}),!1}),{immediate:!0}),c({validate:e=>p(b,V.trialFactorCodes,e),validateTrialFields:()=>m({personVO:O.personVO,trialFactorCodes:V.trialFactorCodes})}),(e,i)=>(a(),o(t(u),{ref_key:"formRef",ref:b,class:"personal-info-card",title:e.title,model:t(O).personVO,schema:t(O).schema,config:t(O).config,"is-view":e.isView,"extra-provision":{objectType:t(d).BENEFICIARY,objectId:t(O).personVO.id}},{cardTitleExtra:l((()=>[s(e.$slots,"default",{},void 0,!0)])),customer:l((()=>[s(e.$slots,"customer",{},void 0,!0)])),_:3},8,["title","model","schema","config","is-view","extra-provision"]))}}),[["__scopeId","data-v-844ffeca"]]);const ne=["onClick"],re=e({name:"InsuredItem"});var ae=c(e({...re,props:{modelValue:{default:()=>({})},title:{default:""},holderPersonVO:{},schema:{default:()=>[]},config:{default:()=>({})},isView:{type:Boolean,default:!1},isTrial:{type:Boolean,default:!1},trialFactorCodes:{default:()=>[]},multiBeneficiaryMaxNum:{default:null},beneficiaryList:{default:()=>[]},beneficiarySchema:{default:()=>[]},guardian:{default:()=>({})},guardianSchema:{default:()=>[]}},emits:["update:modelValue","update:beneficiaryList","update:guardian"],setup(e,{expose:c,emit:N}){const j=e,F=i(null),_=i(null),B=i(null),J={schema:[],trialFactorCodes:[],config:{},personVO:{}},H=n({validated:!1,schema:[],config:{},personVO:{},beneficiaryTypeSchemaList:[],beneficiarySchemaList:[],beneficiaryList:[],guardianSchema:[],guardian:{}}),$=h((()=>{const{age:e,relationToHolder:i}=H.personVO;return!["4","5"].includes(i)&&+e<18||(H.guardian={},!1)})),M=()=>{H.beneficiaryList.push(z({...J,nanoid:b(),schema:j.beneficiarySchema}))},P=h((()=>!j.multiBeneficiaryMaxNum||H.beneficiaryList.length<j.multiBeneficiaryMaxNum)),R=h((()=>!H.schema.filter((e=>{var i;return!(e.hidden||(null==(i=H.config[e.name])?void 0:i.hidden))})).length)),U=h((()=>H.schema.filter((e=>e.isSelfInsuredNeed)).map((e=>e.name)))),E=h((()=>V(j.beneficiarySchema))),q=h((()=>{var e;return String(null==(e=H.personVO)?void 0:e.insuredBeneficiaryType)===Q.SPECIFY}));return r((()=>j.holderPersonVO),G.exports.debounce((e=>{var i;f("------投保人信息变动了-----");const{id:n,...r}=e||{};if("1"===String(null==(i=H.personVO)?void 0:i.relationToHolder)){const e=V(U.value)?Object.keys(r).reduce(((e,i)=>([...U.value,"occupationClass"].includes(i)&&!["birthday","age","gender"].includes(i)||(e[i]=r[i]),e)),{}):r,i=r.certImage.map((e=>({...e,objectId:H.personVO.id,objectType:W.INSURED})));Object.assign(H.personVO,e,{certImage:i})}}),300),{deep:!0,immediate:!0}),r((()=>j.beneficiarySchema),(e=>{H.beneficiarySchemaList=V(e)?e.filter((e=>"insuredBeneficiaryType"!==e.name)):[],H.beneficiaryTypeSchemaList=V(e)?e.filter((e=>"insuredBeneficiaryType"===e.name)):[]}),{deep:!0,immediate:!0}),r((()=>j.guardianSchema),(e=>{H.guardianSchema=e}),{deep:!0,immediate:!0}),r(q,((e,i)=>{String(e)!==String(i)&&(f("受益人类型关系变动了"),e?!V(H.beneficiaryList)&&M():H.beneficiaryList=[])}),{immediate:!0}),r((()=>z(H.beneficiaryList).map((e=>({personVO:e.personVO,nanoid:e.nanoid})))),((e,i)=>{JSON.stringify(e)!==JSON.stringify(i)&&N("update:beneficiaryList",e)}),{deep:!0,immediate:!0}),r((()=>{var e;return null==(e=H.personVO)?void 0:e.relationToHolder}),((e,i)=>{if(!e)return;f("与投保人关系变动了");const{personVO:n,schema:r=[],config:a}=H||{},{id:o,...l}=j.holderPersonVO||{},s="1"===String(n.relationToHolder),[t,d]=v(r,n);if(y(a,d),r.forEach((e=>{e.relationToHolder=n.relationToHolder,e.hidden=!e.isSelfInsuredNeed&&s})),!j.isView&&i&&String(e)!==String(i)){let e={...n,...l};s||(e={...g(n,(e=>!(t&&"certType"===e))),relationToHolder:n.relationToHolder}),Object.assign(H.personVO,e)}}),{deep:!0}),r((()=>{var e;return null==(e=H.personVO)?void 0:e.relationToMainInsured}),((e,i)=>{if(!e)return;f("次被保人与主被保人关系变动了");const{personVO:n,schema:r=[],config:a}=H||{},{certType:o}=n||{},[l,s]=v(r,{certType:o,relationToHolder:e});y(a,s),!j.isView&&i&&String(e)!==String(i)&&Object.assign(H.personVO,{...g(n,(e=>!(l&&"certType"===e))),relationToMainInsured:n.relationToMainInsured})})),r((()=>j.config),(e=>{e&&Object.assign(H.config,e)}),{deep:!0,immediate:!0}),r((()=>j.schema),((e,i)=>{e&&JSON.stringify(e)!==JSON.stringify(i)&&Object.assign(H.schema,z(e))}),{deep:!0,immediate:!0}),r((()=>j.modelValue),((e,i)=>{if(JSON.stringify(e)!==JSON.stringify(i)){const{beneficiaryList:i,...n}=e;y(H.personVO,n)}}),{deep:!0,immediate:!0}),r((()=>z(j.beneficiaryList)),G.exports.debounce(((e,i)=>{JSON.stringify(e)!==JSON.stringify(i)&&(H.beneficiaryList=V(e)?e.map((e=>({...e,nanoid:e.nanoid||b()}))):[])}),500),{deep:!0,immediate:!0}),r((()=>j.guardian),G.exports.debounce(((e,i)=>{JSON.stringify(e)!==JSON.stringify(i)&&(H.guardian=e)}),300),{deep:!0,immediate:!0}),r((()=>H.guardian),(e=>{}),{deep:!0,immediate:!0}),r((()=>H.personVO),(e=>{e&&N("update:modelValue",e)}),{deep:!0,immediate:!0}),c({validate:e=>{var i;return Promise.all([p(F,j.trialFactorCodes,e),p(_,[],e),...(null==(i=B.value)?void 0:i.map((i=>i.validate(e))))||[]])},validateTrialFields:()=>m({personVO:H.personVO,trialFactorCodes:j.trialFactorCodes})}),(e,i)=>{var n,r;const c=k,m=O;return a(),I(x,null,[T(t(u),{ref_key:"insuredFormRef",ref:F,class:"personal-info-card",title:t(R)?"":e.title,model:t(H).personVO,schema:t(H).schema,config:t(H).config,"is-view":e.isView,"extra-provision":{objectType:t(d).INSURED,objectId:t(H).personVO.id}},{cardTitleExtra:l((()=>[s(e.$slots,"default",{},void 0,!0)])),customer:l((()=>[s(e.$slots,"customer",{},void 0,!0)])),_:3},8,["title","model","schema","config","is-view","extra-provision"]),t($)?(a(),o(t(u),{key:0,ref:"guardianFormRef",class:"personal-info-card",title:"监护人",model:t(H).guardian.personVO,schema:t(H).guardianSchema,config:t(H).config,"is-view":e.isView,"extra-provision":{objectType:t(d).GUARDIAN,objectId:null==(r=null==(n=t(H).guardian)?void 0:n.personVO)?void 0:r.id}},{cardTitleExtra:l((()=>[s(e.$slots,"default",{},void 0,!0)])),customer:l((()=>[s(e.$slots,"customer",{},void 0,!0)])),_:3},8,["model","schema","config","is-view","extra-provision"])):S("",!0),t(E)?(a(),I(x,{key:1},[T(t(u),{ref_key:"beneficiaryTypeFormRef",ref:_,class:"personal-info-card",title:"受益人",model:t(H).personVO,schema:t(H).beneficiaryTypeSchemaList,"is-view":e.isView},null,8,["model","schema","is-view"]),t(q)?(a(),I(x,{key:0},[(a(!0),I(x,null,w(t(H).beneficiaryList,((i,n)=>(a(),o(ie,{ref_for:!0,ref_key:"beneficiaryFormRef",ref:B,key:`${i.nanoid}_${n}`,modelValue:i.personVO,"onUpdate:modelValue":e=>i.personVO=e,title:`受益人${n+1}`,schema:t(H).beneficiarySchemaList,config:i.config,"is-view":e.isView},{customer:l((()=>[s(e.$slots,"benefitCustomer",{index:n},void 0,!0)])),default:l((()=>[n>0&&!e.isView?(a(),I("span",{key:0,class:"delete-button",onClick:e=>(e=>{C.confirm({message:"确定要删除该受益人吗？"}).then((()=>{H.beneficiaryList.splice(e,1)}))})(n)},[T(c,{name:"delete"})],8,ne)):S("",!0)])),_:2},1032,["modelValue","onUpdate:modelValue","title","schema","config","is-view"])))),128)),!e.isView&&t(P)?(a(),I("span",{key:0,class:"add-button",onClick:M},[T(m,{name:"plus"}),L("添加受益人")])):S("",!0)],64)):S("",!0)],64)):S("",!0),s(e.$slots,"riskList",{},void 0,!0)],64)}}}),[["__scopeId","data-v-d0d86720"]]);const oe=e=>(E("data-v-8f8ac486"),e=e(),q(),e),le=[oe((()=>J("img",{src:D},null,-1)))],se=["onClick"],te=[oe((()=>J("img",{src:D},null,-1)))],de=["onClick"],ue=[oe((()=>J("img",{src:D},null,-1)))],ce=["onClick"],me={class:"search-bar"},pe=["src"],fe={key:1,class:"empth"},ve=[oe((()=>J("p",null,[J("img",{src:K,class:"ig"})],-1))),oe((()=>J("p",{class:"p1"},"暂时还没有客户哦～",-1)))],ye=e({name:"PersonalInfo"});var ge=c(e({...ye,props:{productFactor:{default:()=>({})},modelValue:{default:()=>({})},isTrial:{type:Boolean,default:!1},isView:{type:Boolean,default:!1},isOnlyHolder:{type:Boolean,default:!1},multiInsuredConfig:{}},emits:["update:modelValue","trailChange","trailValidateFailed","closeCustomerPopoup"],setup(e,{expose:c,emit:g}){const E=e,q=N(),D=j(),{isShare:K,saleChannelId:G}=q.query,Q=i(null),W=i(null),ee=n({count:0,slotProps:{},uniqKey:"",currentIndex:0,currentBenifitIndex:0,currentType:"",keyword:void 0,show:!1,list:[],config:{},trialValidated:!1,holder:{personVO:{},schema:[],trialFactorCodes:[],config:{}},beneficiarySchema:[],initInsuredIList:[],insured:[]}),ie=async e=>{var i,n;ee.keyword;const r={pageNum:1,pageSize:999,queryBean:{keyword:ee.keyword||""}},a=await Y(r),o=[];Object.keys((null==(i=null==a?void 0:a.data)?void 0:i.customerMaps)||{}).forEach((e=>{var i;o.push({label:e,children:null==(i=null==a?void 0:a.data)?void 0:i.customerMaps[e]})})),ee.list=o,ee.count=null==(n=null==a?void 0:a.data)?void 0:n.count},ne=()=>{ie(ee.keyword)},re=()=>{ie()},oe=h((()=>!E.isTrial||E.isOnlyHolder)),ye=(e,i,n)=>{ee.currentType=e,"benifit"!==e?ee.currentIndex=i:(ee.currentIndex=i,ee.currentBenifitIndex=n),ee.uniqKey=b(),ie(),ee.show=!0},ge=()=>{setTimeout((()=>{ee.show=!1}),300)},he=()=>"holder"===ee.currentType?ee.holder.schema.map((e=>e.name))||[]:"insured"===ee.currentType?ee.insured[ee.currentIndex].schema.map((e=>e.name))||[]:"benifit"===ee.currentType?ee.beneficiarySchema.map((e=>e.name))||[]:void 0,Ve=h((()=>{var e,i;return null==(i=null==(e=null==ee?void 0:ee.holder)?void 0:e.personVO)?void 0:i.name})),be=h((()=>{var e,i;return null==(i=null==(e=null==ee?void 0:ee.holder)?void 0:e.personVO)?void 0:i.gender})),Oe=h((()=>{var e,i;return null==(i=null==(e=null==ee?void 0:ee.holder)?void 0:e.personVO)?void 0:i.birthday})),Ie=h((()=>{var e,i;return null==(i=null==(e=null==ee?void 0:ee.holder)?void 0:e.personVO)?void 0:i.certType})),Te=h((()=>{var e,i;return null==(i=null==(e=null==ee?void 0:ee.holder)?void 0:e.personVO)?void 0:i.certNo})),Se=(e,i)=>{var n,r,a,o,l;console.log("convertCustomerData",e);const s=null==(n=null==e?void 0:e.contactInfo)?void 0:n.find((e=>"01"===e.contactType)),t=null==(r=null==e?void 0:e.contactInfo)?void 0:r.find((e=>"02"===e.contactType)),d=null==e?void 0:e.certInfo.filter((e=>"1"===e.certType)),u={name:null==e?void 0:e.name,gender:null==e?void 0:e.gender,birthday:null==e?void 0:e.birthday,mobile:(null==s?void 0:s.contactNo)||null,email:(null==t?void 0:t.contactNo)||null,certNo:(null==(a=null==d?void 0:d[0])?void 0:a.certNo)||null,certType:(null==(o=null==d?void 0:d[0])?void 0:o.certType)||null};console.log("insureKeys",he());const c=null==(l=he())?void 0:l.reduce(((e,i)=>u.hasOwnProperty(i)?{...e,[i]:u[i]}:e),{});return console.log("extractedObject===",c),console.log("state.holder.schema=====",ee.holder.schema),c},xe=e=>{var i,n,r,a,o,l,s,t,d,u,c;if(ee.show=!1,"holder"===ee.currentType&&Object.assign((null==(i=null==ee?void 0:ee.holder)?void 0:i.personVO)||{},Se(e)),"insured"===ee.currentType){const i=null==(n=null==ee?void 0:ee.insured[ee.currentIndex])?void 0:n.schema.some((e=>"relationToHolder"===e.name&&e.attributeValueList.some((e=>"1"===e.code)))),{name:o,gender:l,birthday:s,certType:t,certNo:d}=Se(e);if(Ve.value===o&&be.value===l&&Oe.value===s&&Ie.value===t&&Te.value===d)return i?void Object.assign((null==(r=null==ee?void 0:ee.insured[ee.currentIndex])?void 0:r.personVO)||{},{relationToHolder:"1"}):void H("与投保人关系未配置本人");Object.assign((null==(a=null==ee?void 0:ee.insured[ee.currentIndex])?void 0:a.personVO)||{},Se(e))}if("benifit"===ee.currentType){const{name:i,gender:n,birthday:r,certType:a,certNo:m}=Se(e);(null==(o=null==ee?void 0:ee.insured[ee.currentIndex])?void 0:o.personVO.name)===i&&(null==(l=null==ee?void 0:ee.insured[ee.currentIndex])?void 0:l.personVO.gender)===n&&(null==(s=null==ee?void 0:ee.insured[ee.currentIndex])?void 0:s.personVO.birthday)===r&&(null==(t=null==ee?void 0:ee.insured[ee.currentIndex])?void 0:t.personVO.certType)===a&&(null==(d=null==ee?void 0:ee.insured[ee.currentIndex])?void 0:d.personVO.certNo)===m?H("指定受益人不可为被保人本人"):Object.assign((null==(c=null==(u=null==ee?void 0:ee.insured[ee.currentIndex])?void 0:u.beneficiaryList[ee.currentBenifitIndex])?void 0:c.personVO)||{},Se(e))}},we=()=>{var e;const i=!W.value||(null==(e=W.value)?void 0:e.every((e=>e.validateTrialFields())));return(!Q.value||m(ee.holder))&&i},Le=e=>{var i;return Promise.all([...(null==(i=W.value)?void 0:i.map((i=>i.validate(e))))||[],p(Q,ee.holder.trialFactorCodes,e)])},Ce=e=>{const{productList:i,config:n,schema:r,trialFactorCodes:a,beneficiaryList:o,guardian:l,personVO:s,nanoid:t,...d}=e||{};return d},ke=()=>{const{length:e,[e-1]:i}=ee.initInsuredIList;ee.insured.push(z({...i,nanoid:b()}))},Ne=h((()=>{const{multiInsuredMaxNum:e,multiInsuredSupportFlag:i}=ee.config;return i&&(!e||ee.insured.length<e)})),je=h((()=>V(ee.holder.schema))),Fe=h((()=>ee.insured.some((e=>V(e.schema))))),_e=(e,i)=>V(e)?e.reduce(((e,n)=>(e[n]=i[n],e)),{}):{},Be=(e,i,n={})=>!!V(e)&&JSON.stringify(_e(e,i))!==JSON.stringify(_e(e,n));r((()=>{var e;return null==(e=ee.holder.personVO)?void 0:e.certType}),F(((e,i)=>{if(`${e}`==`${i}`)return!1;f("投保人信息变动了====");const[n,r]=v(ee.holder.schema,{certType:e});return y(ee.holder.config,r),!1}),300)),r([()=>{var e;return{...null==(e=ee.holder)?void 0:e.personVO}},()=>ee.insured.map((e=>{const{beneficiaryList:i,guardian:n,personVO:r}=e||{},a=V(i)?i.map((e=>({...e.personVO}))):[];return{...r,guardian:n.personVO||{},beneficiaryList:a}}))],F(((e,i)=>{var n,r,a,o;if(JSON.stringify(e)===JSON.stringify(i))return!1;const[l,s]=e,t=((e,i)=>{const n=Be(ee.holder.trialFactorCodes,null==e?void 0:e[0],null==i?void 0:i[0]),r=ee.insured.some(((e,n)=>{var r;const{trialFactorCodes:a,personVO:o}=e;return Be(a,o,null==(r=i[1])?void 0:r[n])}));return n||r})([l,s],i);f(`投被保人信息变动了---${t}`);const{insuredList:d}=E.modelValue,u={holder:l,insuredList:s.map(((e,i)=>({...(null==d?void 0:d[i])||{},...e})))};if(null==(n=ee.config)?void 0:n.isSpouseInsured){const[e,i]=s.map((e=>null==e?void 0:e.gender));if(e&&i&&String(e)===String(i))return H("被保人性别与投保要求不符")}if(JSON.stringify(null==(r=null==s?void 0:s[0])?void 0:r.personVO),Ce(null==(o=null==(a=E.modelValue)?void 0:a.insuredList)?void 0:o[0]),console.log("-------result = ",u),g("update:modelValue",u),!we())return ee.trialValidated=!1,g("trailValidateFailed",u);Le(!0).then((()=>{ee.trialValidated=!0,t&&!E.isOnlyHolder&&g("trailChange",u)})).catch((()=>{ee.trialValidated=!1,g("trailValidateFailed",u)}))}),500),{deep:!0}),r([()=>E.productFactor,()=>E.isTrial],F(((e,i)=>{if($(e,i)||!(null==e?void 0:e[0]))return!1;f("投被保人要素变动了");const{insuredFactorCodes:n,holderFactorCodes:r}=M(P)||{},{holder:a,insured:o,beneficiary:l,guardian:s,config:t}=R(e[0],{isTrial:e[1],...E.multiInsuredConfig,insuredFactorCodes:n,holderFactorCodes:r});return Object.assign(ee.holder,a),ee.config=t,V(o)&&(ee.initInsuredIList=o.map((e=>({...e,guardian:{},beneficiaryList:[]})))),ee.beneficiarySchema=z((null==l?void 0:l.schema)||[]),ee.guardianSchema=z((null==s?void 0:s.schema)||[]),!1}),300),{deep:!0,immediate:!0}),r((()=>{var e,i,n,r;return null==(r=null==(n=null==(i=null==(e=null==ee?void 0:ee.insured)?void 0:e[ee.currentIndex])?void 0:i.beneficiaryList)?void 0:n[ee.currentBenifitIndex])?void 0:r.personVO}),((e,i)=>{var n,r,a,o;(null==(o=null==(a=null==(r=null==(n=null==ee?void 0:ee.insured)?void 0:n[ee.currentIndex])?void 0:r.beneficiaryList)?void 0:a[ee.currentBenifitIndex])?void 0:o.personVO)&&(null==e?void 0:e.relationToInsured)!==(null==i?void 0:i.relationToInsured)&&(f("受益人关系变动了+++++"),ee.insured[ee.currentIndex].beneficiaryList[ee.currentBenifitIndex].personVO={relationToInsured:null==e?void 0:e.relationToInsured})}),{deep:!0,immediate:!0}),r((()=>{var e,i,n,r;return null==(r=null==(n=null==(i=null==(e=null==ee?void 0:ee.insured)?void 0:e[ee.currentIndex])?void 0:i.guardian)?void 0:n.personVO)?void 0:r.relationToInsured}),((e,i)=>{e!==i&&(f("监护人关系变动了+++++"),ee.insured[ee.currentIndex].guardian.personVO={relationToInsured:null==e?void 0:e.relationToInsured})}),{deep:!0,immediate:!0});const Je=i(!1);return r([()=>{const{holder:e,insuredList:i=[]}=E.modelValue,n=V(i)?i.map((e=>({config:e.config,personVO:Ce(e),guardian:{personVO:e.guardian||{}},beneficiaryList:V(e.beneficiaryList)?e.beneficiaryList.map((({config:e,...i})=>({config:e,personVO:Ce(i)}))):[]}))):[];return[null==e?void 0:e.config,Ce(e),n]},()=>ee.config,()=>ee.initInsuredIList],F((([[e,i,n]],[[r,a,o]])=>{if(JSON.stringify(e)===JSON.stringify(r)&&JSON.stringify(i)===JSON.stringify(a)&&JSON.stringify(n)===JSON.stringify(o)&&Je.value)return;Je.value=!0,Object.assign(ee.holder.config,e),console.log("投保人数据===",z(ee.holder.personVO),z(i)),console.log("投保人数据===",z(ee.holder.personVO),z(i)),Object.assign(ee.holder.personVO,i);const{length:l}=n||[],{length:s}=ee.insured,{length:t,0:d={},[t-1]:u}=ee.initInsuredIList,{multiInsuredMaxNum:c=1,multiInsuredMinNum:m=1,multiInsuredSupportFlag:p}=(null==ee?void 0:ee.config)||{},f=E.isView||l>s?Math.min(l,c):s||m;ee.insured=Array.from({length:f}).reduce(((e,i,r)=>{const{personVO:a,config:o={},guardian:l,beneficiaryList:s}=(null==n?void 0:n[r])||{},t=z(0===r?d:u);return e[r]?y(e[r],{...z(t),personVO:a,config:o,guardian:l,beneficiaryList:s}):e[r]={...t,personVO:a,config:o,guardian:l,beneficiaryList:s,nanoid:b()},e}),ee.insured)}),300),{deep:!0,immediate:!0}),r((()=>ee.list),((e,i)=>{e&&(ee.list=e)})),c({validate:Le,validateTrialFields:we,validateHolder:(...e)=>{var i;return null==(i=Q.value)?void 0:i.validate(...e)},canTrail:()=>ee.trialValidated}),(e,i)=>{var n,r;const c=k,m=O,p=_,f=A,v=U;return a(),I(x,null,[t(je)&&t(oe)?(a(),o(t(u),{key:0,ref_key:"holderFormRef",ref:Q,title:"投保人信息",class:"personal-info-card",model:t(ee).holder.personVO,schema:t(ee).holder.schema,config:t(ee).holder.config,"is-view":e.isView,"extra-provision":{objectType:t(d).HOLDER,objectId:null==(r=null==(n=t(ee).holder)?void 0:n.personVO)?void 0:r.id}},{customer:l((()=>[(a(),I("div",{key:0,class:"choose-customer",onClick:i[0]||(i[0]=e=>ye("holder",1,0))},le))])),_:1},8,["model","schema","config","is-view","extra-provision"])):S("",!0),t(Fe)&&!e.isOnlyHolder?(a(),I(x,{key:1},[(a(!0),I(x,null,w(t(ee).insured,((i,n)=>{var r;return a(),o(ae,B({ref_for:!0,ref_key:"insuredFormRef",ref:W,key:`${i.nanoid}_${n}`,modelValue:i.personVO,"onUpdate:modelValue":e=>i.personVO=e,"beneficiary-list":i.beneficiaryList,"onUpdate:beneficiaryList":e=>i.beneficiaryList=e,guardian:i.guardian,"onUpdate:guardian":e=>i.guardian=e,title:""+(t(ee).insured.length>1?`被保人${n+1}`:"被保人信息"),"holder-person-v-o":t(ee).holder.personVO},i,{"beneficiary-schema":t(ee).beneficiarySchema,"guardian-schema":t(ee).guardianSchema,"is-view":e.isView,"multi-beneficiary-num":null==(r=t(ee).config)?void 0:r.multiBeneficiaryMaxNum}),{riskList:l((()=>[s(e.$slots,"riskInfo",{insuredIndex:n},void 0,!0)])),customer:l((()=>[1==+i.personVO.relationToHolder||t(K)||e.isView||e.isTrial||t(D)?S("",!0):(a(),I("div",{key:0,class:"choose-customer",onClick:e=>ye("insured",n,0)},te,8,se))])),benefitCustomer:l((i=>[t(K)||e.isView||e.isTrial||t(D)?S("",!0):(a(),I("div",{key:0,class:"choose-customer",onClick:e=>ye("benifit",n,null==i?void 0:i.index)},ue,8,de))])),default:l((()=>[!e.isView&&n+1>t(ee).config.multiInsuredMinNum?(a(),I("span",{key:0,class:"delete-button",onClick:e=>(e=>{C.confirm({message:"确定要删除该被保人吗？"}).then((()=>{ee.insured.splice(e,1)}))})(n)},[T(c,{name:"delete",color:"var(--van-primary-color)"})],8,ce)):S("",!0)])),_:2},1040,["modelValue","onUpdate:modelValue","beneficiary-list","onUpdate:beneficiaryList","guardian","onUpdate:guardian","title","holder-person-v-o","beneficiary-schema","guardian-schema","is-view","multi-beneficiary-num"])})),128)),!e.isView&&t(Ne)?(a(),o(p,{key:0,class:"add-button-wrap"},{title:l((()=>[J("span",{class:"add-button",onClick:ke},[T(m,{name:"plus"}),L("添加被保人")])])),_:1})):S("",!0)],64)):S("",!0),t(ee).show?(a(),o(v,{key:2,round:!1,show:t(ee).show,closeable:!1,onClose:ge,onClosed:e.onClosePopupAfterAni},{default:l((()=>[J("div",me,[T(f,{modelValue:t(ee).keyword,"onUpdate:modelValue":i[1]||(i[1]=e=>t(ee).keyword=e),placeholder:"客户 姓名/手机号",class:"icon-sercher",onSearch:ne,onCancel:re},{"left-icon":l((()=>[J("img",{src:t(Z),alt:"",class:"search-icon-img",style:{width:"22px",height:"23px"}},null,8,pe)])),_:1},8,["modelValue"])]),t(ee).count?(a(),o(X,{key:0,data:t(ee).list,type:e.order,disabled:!1,onOnClose:xe},null,8,["data","type"])):(a(),I("div",fe,ve))])),_:1},8,["show","onClosed"])):S("",!0)],64)}}}),[["__scopeId","data-v-8f8ac486"]]);export{ge as P};
