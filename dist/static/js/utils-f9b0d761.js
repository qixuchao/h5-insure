import{d as O}from"./vendor-902054a7.js";import{l as B}from"./useStorage-fc2bd838.js";import{I as K,R as S,g as M}from"./infoCollection-06729193.js";import{b as x,a as U,R as _,i as F}from"./trial-1f149b67.js";import{a6 as b,K as p,C as E,J as g,a3 as $}from"./index-84e52064.js";const te=e=>{const{tenantId:t,riskList:n,riskPremium:i,productId:a}=e;return n.map(r=>{var s,d;return{tenantId:t,amountUnit:1,annuityDrawFrequency:r.annuityDrawDate,annuityDrawType:r.annuityDrawType,paymentFrequency:r.paymentFrequency,paymentPeriod:r.chargePeriod.split("_")[1],paymentPeriodType:x[r.chargePeriod.split("_")[0]],insurancePeriodType:U[r.coveragePeriod==="to_life"?"to_life":r.coveragePeriod.split("_")[0]],insurancePeriodValue:Number.isNaN(+r.coveragePeriod.split("_")[1])?0:r.coveragePeriod.split("_")[1],riskCode:r.riskCode,riskType:r.riskType,riskName:r.riskName,extInfo:{riskId:r.riskId,copy:r.copy},initialPremium:(s=i[r.riskCode])==null?void 0:s.premium,liabilityDetails:((d=r.liabilityVOList)==null?void 0:d.map(o=>({liabilityCode:o.liabilityCode,liabilityName:o.liabilityName,refundMethod:o.liabilityAttributeValue})))||[],productId:a,currentAmount:r.amount,initialAmount:r.amount}})},ie=e=>b(e).map(t=>(t.riskDetailVOList.find(i=>i.riskType===_.MAIN_RISK),(i=>i.map(a=>{const{riskCategory:r,riskCode:l,riskType:s,id:d,riskInsureLimitVO:o,riskCalcMethodInfoVO:m}=a,{annuityDrawFrequencyList:u,annuityDrawValueList:c,insurancePeriodValueList:y,paymentFrequencyList:I,paymentPeriodValueList:f}=o,{minCopy:P,maxCopy:A,fixedAmount:N,singeAmount:C}=m;return{amount:N||C,annuityDrawDate:c==null?void 0:c[0],annuityDrawFrequency:u==null?void 0:u[0],chargePeriod:f==null?void 0:f[0],copy:P||A||0,coveragePeriod:y==null?void 0:y[0],liabilityVOList:a.riskLiabilityInfoVOList,paymentFrequency:I==null?void 0:I[0],riderRisk:!0,riderRiskVOList:[],riskCategory:r,riskCode:l,riskId:d,riskType:s}}))(t.riskDetailVOList||[]))).flat(),h=(e,t,n=[],i=M.YEAR,a=!1)=>{const r=e.filter(s=>{try{return s.extraInfo?JSON.parse(s.extraInfo).packageCode?!!n.includes(s.id):!0:!1}catch{return!1}});console.log("lastRiskList",r);const l=r.find(s=>s.riskType===_.MAIN_RISK);return r.map(s=>{const{riskInsureLimitVO:d,riskCategory:o,id:m,riskType:u,riskName:c,riskCode:y,extraInfo:I,riskLiabilityInfoVOList:f,riskCalcMethodInfoVO:P}=s,{insurancePeriodType:A,insurancePeriodValueList:N,paymentFrequencyList:C,paymentPeriodValueList:k,paymentPeriodType:j,annuityDrawFrequencyList:L,annuityDrawValueList:R,insurancePeriodRule:w,paymentPeriodRule:H}=d,{fixedAmount:q,minCopy:v}=P,T={amount:q,riskCode:y,riskId:m,riskName:c,paymentFrequency:(C==null?void 0:C[0])||M.YEAR,extraInfo:I,chargePeriod:k==null?void 0:k[0],annuityDrawDate:R==null?void 0:R[0],riskType:u,annuityDrawFrequency:L==null?void 0:L[0],copy:v,coveragePeriod:N==null?void 0:N[0],insuredCode:t==null?void 0:t.insurerCode,liabilityVOList:f,riskCategory:o};return u===_.MAIN_RISK?T:(w===F.ONE_YEAR&&(T.coveragePeriod="year_1"),H===F.ONE_YEAR&&(T.chargePeriod="year_1"),{...T,mainRiskId:l==null?void 0:l.id,mainRiskCode:l==null?void 0:l.riskCode})})},ne=e=>{var n,i,a;return{orderAmount:e.premium,tenantId:e.tenantId,venderCode:(n=e.detail)==null?void 0:n.insurerCode,applicationNo:e.applicationNo,policyNo:e.policyNo,orderDataSource:"1",saleUserId:e.saleUserId,saleChannelId:e.saleChannelId,orderCategory:e.orderCategory,orderStatus:e.orderStatus,orderTopStatus:e.orderTopStatus,tenantOrderHolder:{tenantId:e.tenantId,name:e.holder.name,certNo:e.holder.certNo,certType:E.CERT,mobile:e.holder.mobile,birthday:p(e.holder.certNo),gender:g(e.holder.certNo),extInfo:{hasSocialInsurance:e.holder.socialFlag}},extInfo:{extraInfo:{renewalDK:e.renewalDK,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,successJumpUrl:e.successJumpUrl},iseeBizNo:e.iseeBizNo},tenantOrderInsuredList:[{tenantId:e.tenantId,relationToHolder:e.insured.relationToHolder,certNo:e.insured.certNo,certType:E.CERT,name:e.insured.name,mobile:e.insured.relationToHolder===S.SELF?e.holder.mobile:"",birthday:p(e.insured.certNo),gender:g(e.insured.certNo),extInfo:{hasSocialInsurance:e.insured.socialFlag},tenantOrderProductList:[{tenantId:e.tenantId,productCode:(i=e.detail)==null?void 0:i.productCode,productName:(a=e.detail)==null?void 0:a.productName,premium:e.premium,tenantOrderRiskList:e.tenantOrderRiskList}]}]}},V=(e,t)=>{if(!e)return"";const[n,i]=e.split("_"),a=parseInt(i,10);return n==="day"?O(t).add(a,"day").format("YYYY-MM-DD"):O(t).add(a,"year").format("YYYY-MM-DD")},D=(e,t=O().format("YYYY-MM-DD"))=>O(e).diff(t,"day"),J=(e,t,n)=>{const i=V(e,n),a=V(t,n);return D(i)<=1&&D(a)>=0},ae=e=>{const{riskCode:t,liabilityCode:n,birth:i,sex:a}=e,r=V("max_18",i);return console.log("lastDate",r),console.log("diffDate(lastDate)",D(r)),!(t==="7Y7"&&n==="FXG086"&&!(a===$.FEMALE&&D(r)<=0))},Y=(e,t,n=i=>!0)=>{const i=p(t),a=g(t),r=[];return e.forEach(l=>{const{riskDetailVOList:s}=l,d=s.map(o=>{const{maxHolderAge:m,minHolderAge:u}=o.riskInsureLimitVO;return J(u,m,i)?(o.riskLiabilityInfoVOList=o.riskLiabilityInfoVOList.filter(c=>n({riskCode:o.riskCode,liabilityCode:c.liabilityCode,birth:i,sex:a})),o):null});r.push({riskDetailVOList:d.filter(o=>!!(o&&o.riskLiabilityInfoVOList.length>0))})}),r},oe=(e,t=!1,n=i=>!0)=>{var r,l,s;let i=[];if(t)i=h((l=(r=Y(b(e.insureDetail.productRiskVoList),e.insured.certNo,n))==null?void 0:r[0])==null?void 0:l.riskDetailVOList,e.productDetail,[],e.paymentFrequency,t);else{const d=Y(b(e.insureDetail.productRiskVoList),e.insured.certNo,n);console.log("===result",[...d]),i=d.map(o=>h(o.riskDetailVOList,e.productDetail,e.packageRiskIdList,e.paymentFrequency,t))}return{calcData:{holder:{personVO:{birthday:p(e.holder.certNo),certType:E.CERT,certNo:e.holder.certNo,gender:Number(g(e.holder.certNo)),mobile:e.holder.mobile,name:e.holder.name,socialFlag:e.holder.socialFlag}},insuredVOList:[{insuredCode:(s=e.productDetail)==null?void 0:s.insurerCode,relationToHolder:e.insured.relationToHolder,personVO:{birthday:p(e.insured.certNo),certType:E.CERT,certNo:e.insured.certNo,gender:Number(g(e.insured.certNo)),name:e.insured.name,socialFlag:e.insured.socialFlag},productPlanVOList:[{riskVOList:i.flat()}]}],productCode:e.productDetail.productCode,tenantId:e.tenantId},riskVOList:i.flat()}},se=e=>e&&e.length?e.filter(n=>n.value===K.INSURE).map(n=>n.productRiskVoList.map(i=>i.id)).flat():[],de=(e,t="year")=>O().diff(p(e),t,!0),z=e=>!e||Number.isNaN(+e.split("_")[1])?0:e==null?void 0:e.split("_")[1],X=e=>{const{tenantId:t,riskList:n,riskPremium:i,productId:a}=e;return n.map(r=>{var s,d,o,m,u;return{tenantId:t,amountUnit:1,annuityDrawFrequency:r.annuityDrawDate,annuityDrawType:r.annuityDrawType,paymentFrequency:r.paymentFrequency,paymentPeriod:0,paymentPeriodType:(s=x)==null?void 0:s[r.chargePeriod],insurancePeriodType:U[r.coveragePeriod==="to_life"?"to_life":(o=(d=r.coveragePeriod)==null?void 0:d.split("_"))==null?void 0:o[0]],insurancePeriodValue:z(r.coveragePeriod),riskCode:r.riskCode,riskType:r.riskType,riskName:r.riskName,extInfo:{riskId:r.riskId,copy:r.copy},initialPremium:(m=i[r.riskCode])==null?void 0:m.premium,liabilityDetails:(u=r.liabilityVOList)==null?void 0:u.map(c=>({liabilityCode:c.liabilityCode,liabilityName:c.liabilityName,refundMethod:c.liabilityAttributeValue})),productId:a,currentAmount:r.amount,initialAmount:r.amount}})},le=e=>{var n,i,a,r;return console.log(e,"freeTransform"),{orderAmount:0,tenantId:e.tenantId,venderCode:e.insureDetail.productBasicInfoVO.insurerCode,orderDataSource:"1",saleUserId:e.saleUserId,saleChannelId:e.saleChannelId,orderCategory:"1",tenantOrderHolder:{tenantId:e.tenantId,certType:e.order.tenantOrderHolder.certEndType,...e.order.tenantOrderHolder},extInfo:{...e.extInfo,templateId:2,buttonCode:e.buttonCode,pageCode:e.pageCode,iseeBizNo:e.iseeBizNo},tenantOrderInsuredList:[{...e.order.tenantOrderInsuredList[0],tenantId:e.tenantId,certType:e.order.tenantOrderInsuredList[0].certEndType,mobile:e.order.tenantOrderInsuredList[0].relationToHolder===S.SELF?e.order.tenantOrderHolder.mobile:"",tenantOrderProductList:[{tenantId:e.tenantId,productCode:(n=e.insureDetail)==null?void 0:n.productBasicInfoVO.productCode,productName:(i=e.insureDetail)==null?void 0:i.productBasicInfoVO.productName,premium:0,tenantOrderRiskList:X({tenantId:e.tenantId,riskList:h(e.insureDetail.productRiskVoList[0].riskDetailVOList,e.detail),riskPremium:{},productId:(a=e.detail)==null?void 0:a.id})}]}],operateOption:(r=e.order)==null?void 0:r.operateOption}},ue=(e,t)=>t.indexOf("$")!==-1?t.replace("$",`${e}`):`${e||""}${t}`,W="PREVIEW_FILE_INFO",ce=e=>{const{origin:t}=window.location;B.set(W,JSON.stringify(e));const n=`${t}/template/filePreview`;console.log("url",n),window.open(n)};export{W as P,se as a,ne as b,de as c,ue as d,le as f,oe as g,ce as o,ie as r,te as t,ae as v};
