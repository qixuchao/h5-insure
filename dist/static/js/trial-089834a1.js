import{d as e,h as s,i as a,j as t,O as o,o as i,l,w as r,a as d,e as u,b as c,u as n,c as p,m,F as f,n as v,_ as k,T as C,ap as R,aq as j,ar as I,as as h,at as L,au as y,g as _,av as b,aw as g,q as P,s as w}from"./index-27d17939.js";import{T as x}from"./index-efc59eee.js";import{q,a as N,g as M,s as S,i as V,m as A}from"./trial-33862f0a.js";import{_ as K}from"./index-5d45c9bb.js";import{C as O}from"./index-c77fac58.js";import{S as D}from"./index-07427167.js";import{R as T}from"./trial-39924c45.js";import{_ as E}from"./TrialButton-fc5b5c5f.js";import{u as B}from"./useOrder-15f2b746.js";import{B as U,P as F}from"./constants-71331306.js";import{p as $}from"./utils-6fc00a71.js";import"./cloneDeep-32504d95.js";import"./InsureInfos-13e9cd9e.js";import"./index-85b786dc.js";import"./get-67b41aee.js";import"./infoCollection-548eee14.js";import"./index-354e8004.js";import"./empth-c0adfdba.js";import"./bankCard-9edf596d.js";import"./lodash-5ea0f38f.js";import"./index-6a4678db.js";import"./search-f8fe897c.js";import"./product-585b0e6f.js";import"./constants-0a4df8b6.js";import"./utils-fadec324.js";import"./createProposal-de30c9ad.js";import"./nextStep-91527a31.js";import"./core-ee2c989a.js";import"./constant-8927d485.js";import"./empty-ae586b6c.js";import"./index-24ad038f.js";const z={class:"popup-container"},G={class:"popup-header"},H={class:"title"},J=(e=>(L("data-v-124bec92"),e=e(),y(),e))((()=>d("p",{class:"tip"},"已为您挑选出以下险种",-1))),Q={class:"search"},W={key:0,class:"risk-list"},X=e({name:"riskSelect"});var Y=k(e({...X,props:{type:{default:2},show:{type:Boolean,default:!1},title:null,insuredList:{default:()=>[]},mainRiskCode:{default:""},selectList:{default:()=>[]}},emits:["cancel","confirm"],setup(e,{emit:k}){const L=e,y=s(),{insurerCode:_}=y.query,b=a(),g=a([]),P=t((()=>L.show)),w=()=>{k("cancel")},x=()=>{b.value?k("confirm",b.value):C(`暂未添加任何${L.type===T.MAIN_RISK?"主":"附加"}险`)};return o((()=>{(async()=>{const e={insuredVO:L.insuredList,mainRiskCode:L.mainRiskCode,insurerCode:_,productCategory:"",selectProductCodes:[],selectRiskCodes:[]};if(e.selectProductCodes=L.selectList.map((s=>(e.selectRiskCodes.push(...s.mergeRiskReqList.map((e=>e.riskCode))),s.productCode))),L.type===T.MAIN_RISK){const{code:s,data:a}=await q(e);"10000"===s&&(g.value=a)}else{const{code:s,data:a}=await N(e);"10000"===s&&(g.value=a)}})()})),(s,a)=>{const t=D,o=R,k=j,C=O,L=I,y=K,_=h;return i(),l(_,{show:n(P),"onUpdate:show":a[1]||(a[1]=e=>m(P)?P.value=e:null),class:"popup-risk-select",closeable:!1},{default:r((()=>[d("div",z,[d("div",G,[d("span",{class:"clear-all",onClick:w}," 取消 "),d("span",H,u(e.title),1),d("span",{class:"close",onClick:x},"确认")]),J,d("div",Q,[c(t,{shape:"round",placeholder:"请输入产品名称进行搜索"})]),n(g).length?(i(),p("div",W,[c(L,{modelValue:n(b),"onUpdate:modelValue":a[0]||(a[0]=e=>m(b)?b.value=e:null)},{default:r((()=>[c(C,{inset:""},{default:r((()=>[(i(!0),p(f,null,v(n(g),(e=>(i(),l(k,{key:e.riskCode||e.productCode,title:e.riskName||e.productName,clickable:"",onClick:s=>b.value=e.riskCode||e.productCode},{icon:r((()=>[c(o,{name:e.riskCode||e.productCode},null,8,["name"])])),_:2},1032,["title","onClick"])))),128))])),_:1})])),_:1},8,["modelValue"])])):(i(),l(y,{key:1,title:`暂无关联${e.type===n(T).MAIN_RISK?"主":"附加"}险、请选择其他险种`},null,8,["title"]))])])),_:1},8,["show"])}}}),[["__scopeId","data-v-124bec92"]]);const Z={class:"page-trial-wrap"},ee=e({name:"trial"}),se=e({...ee,setup(e){const o=s(),d=_(),{productCode:u,orderNo:m,tenantId:f}=o.query,v=a({}),k=a({productList:[]}),C=a([]),R=a({}),j=a(),I=a(),h=B({extInfo:{templateId:201,buttonCode:U.TRIAL_PREMIUM,pageCode:F.TRIAL_PREMIUM}}),L=a(),y=a(1),q=t((()=>y.value===T.MAIN_RISK?"添加主险":"添加附加险")),N=a(!1),K=()=>{N.value=!1},O=e=>{if(y.value===T.MAIN_RISK)k.value.productList.push({productCode:e,mergeRiskReqList:[]}),j.value.getProductDefaultValue(e);else{k.value.productList.find((e=>e.productCode===I.value)).mergeRiskReqList.push({riskCode:e,riskType:T.RIDER_RISK,mainRiskCode:R.value.riskCode}),j.value.getRiderRiskDefaultValue(I.value,e,R.value.riskCode)}A(k.value).then((({code:e,data:s})=>{if("10000"===e){const{productDetailResList:e,productFactor:a}=s;L.value=a,k.value=$(e);const t={};e.forEach((e=>{t[e.productCode]=e})),v.value=t}})),N.value=!1},D=(e,s,a)=>{N.value=!0,y.value=T.RIDER_RISK,C.value=a,R.value=s,I.value=e},z=e=>{N.value=!0,y.value=T.MAIN_RISK,C.value=e},G=(e,s,a)=>{v.value[e],a?(v.value[e].productPlanInsureVOList[0].insureProductRiskVOList=v.value[e].productPlanInsureVOList[0].insureProductRiskVOList.filter((e=>e.riskCode!==s)),k.value.productList=k.value.productList.map((a=>(a.productCode===e&&(a.mergeRiskReqList=a.mergeRiskReqList.filter((e=>e.riskCode!==s))),a)))):(delete v.value[e],k.value.productList=k.value.productList.filter((s=>s.productCode!==e)))},H=()=>{j.value.onNext((async e=>{const{code:s,data:a}=await S(e);"10000"===s&&d.push({path:w.infoCollection,query:{...o.query,orderNo:a}})}))};return b((()=>{V({productCode:u,isTenant:!1}).then((({data:e,code:s})=>{var a,t;"10000"===s&&(v.value[`${u}`]=e,L.value=null==(t=null==(a=null==e?void 0:e.productPlanInsureVOList)?void 0:a[0])?void 0:t.productFactor,k.value=$([e]))})),m&&M({orderNo:m,tenantId:f}).then((({code:e,data:s})=>{"10000"===e&&(h.value=s)}))})),(e,s)=>(i(),p("div",Z,[c(x,{ref_key:"trialRef",ref:j,"product-collection":n(v),"default-value":n(h),"product-factor":n(L),"is-trial":"","hide-benefit":"",onAddRisk:D,onAddMainRisk:z,onDeleteRisk:G},{trialBtn:r((({riskPremium:e})=>[c(E,{premium:e.initialPremium,onClick:g(H,["stop"])},null,8,["premium","onClick"])])),_:1},8,["product-collection","default-value","product-factor"]),n(N)?(i(),l(Y,{key:0,type:n(y),show:n(N),"insured-list":n(C),title:n(q),"main-risk-code":n(R).riskCode,"select-list":n(k).productList,onCancel:K,onConfirm:O},null,8,["type","show","insured-list","title","main-risk-code","select-list"])):P("",!0)]))}});export{se as default};
