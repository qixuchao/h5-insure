import{d as g}from"./vendor-d350434b.js";import{I as K,R as F,g as Y}from"./infoCollection-c7622b0a.js";import{b as U,a as H,R as L,i as S}from"./trial-c1f5bc31.js";import{a6 as _,K as p,C as E,J as T,a3 as z}from"./index-124ac2ce.js";const $=e=>{const{tenantId:i,riskList:t,riskPremium:n,productId:a}=e;return t.map(r=>{var o;return{tenantId:i,amountUnit:1,annuityDrawFrequency:r.annuityDrawDate,annuityDrawType:r.annuityDrawType,paymentFrequency:r.paymentFrequency,paymentPeriod:r.chargePeriod.split("_")[1],paymentPeriodType:U[r.chargePeriod.split("_")[0]],insurancePeriodType:H[r.coveragePeriod==="to_life"?"to_life":r.coveragePeriod.split("_")[0]],insurancePeriodValue:Number.isNaN(+r.coveragePeriod.split("_")[1])?0:r.coveragePeriod.split("_")[1],riskCode:r.riskCode,riskType:r.riskType,riskName:r.riskName,extInfo:{riskId:r.riskId,copy:r.copy},initialPremium:(o=n[r.riskCode])==null?void 0:o.premium,liabilityDetails:r.liabilityVOList.map(l=>({liabilityCode:l.liabilityCode,liabilityName:l.liabilityName,refundMethod:l.liabilityAttributeValue})),productId:a,currentAmount:r.amount,initialAmount:r.amount}})},ee=e=>_(e).map(i=>{const t=i.riskDetailVOList.find(r=>r.riskType===L.MAIN_RISK),n=i.riskDetailVOList.filter(r=>r.riskType===L.RIDER_RISK),a=r=>r.map(s=>{const{riskCategory:o,riskCode:l,riskType:d,id:m,riskInsureLimitVO:u,riskCalcMethodInfoVO:c}=s,{annuityDrawFrequencyList:y,annuityDrawValueList:I,insurancePeriodValueList:f,paymentFrequencyList:C,paymentPeriodValueList:R}=u,{minCopy:N,maxCopy:k,fixedAmount:O,singeAmount:M}=c;return{amount:O||M,annuityDrawDate:I==null?void 0:I[0],annuityDrawFrequency:y==null?void 0:y[0],chargePeriod:R==null?void 0:R[0],copy:N||k||0,coveragePeriod:f==null?void 0:f[0],liabilityVOList:s.riskLiabilityInfoVOList,mainRisk:s.riskCode===t.riskCode,mainRiskCode:s.riskCode===t.riskCode?t.riskCode:void 0,mainRiskId:s.riskCode===t.riskCode?t.riskId:void 0,paymentFrequency:C==null?void 0:C[0],riderRisk:!0,riderRiskVOList:d===1?a(n):[],riskCategory:o,riskCode:l,riskId:m,riskType:d}});return a([t])}).flat(),V=(e,i,t=[],n=Y.YEAR,a=!1)=>{const r=e.filter(o=>{try{return o.extraInfo?JSON.parse(o.extraInfo).packageCode?!!t.includes(o.id):!0:!1}catch{return!1}});console.log("lastRiskList",r);const s=r.find(o=>o.riskType===L.MAIN_RISK);return r.map(o=>{const{riskInsureLimitVO:l,riskCategory:d,id:m,riskType:u,riskName:c,riskCode:y,extraInfo:I,riskLiabilityInfoVOList:f,riskCalcMethodInfoVO:C}=o,{insurancePeriodType:R,insurancePeriodValueList:N,paymentFrequencyList:k,paymentPeriodValueList:O,paymentPeriodType:M,annuityDrawFrequencyList:P,annuityDrawValueList:h,insurancePeriodRule:q,paymentPeriodRule:v}=l,{fixedAmount:w,minCopy:B}=C,D={amount:w,riskCode:y,riskId:m,riskName:c,paymentFrequency:(k==null?void 0:k[0])||Y.YEAR,extraInfo:I,chargePeriod:O==null?void 0:O[0],annuityDrawDate:h==null?void 0:h[0],riskType:u,annuityDrawFrequency:P==null?void 0:P[0],copy:B,coveragePeriod:N==null?void 0:N[0],insuredCode:i==null?void 0:i.insurerCode,liabilityVOList:f,riskCategory:d};return u===L.MAIN_RISK?D:(q===S.ONE_YEAR&&(D.coveragePeriod="year_1"),v===S.ONE_YEAR&&(D.chargePeriod="year_1"),{...D,mainRiskId:s==null?void 0:s.id,mainRiskCode:s==null?void 0:s.riskCode})})},re=e=>{var t,n,a;return{orderAmount:e.premium,tenantId:e.tenantId,venderCode:(t=e.detail)==null?void 0:t.insurerCode,applicationNo:e.applicationNo,policyNo:e.policyNo,orderDataSource:"1",saleUserId:e.saleUserId,saleChannelId:e.saleChannelId,orderCategory:e.orderCategory,orderStatus:e.orderStatus,orderTopStatus:e.orderTopStatus,tenantOrderHolder:{tenantId:e.tenantId,name:e.holder.name,certNo:e.holder.certNo,certType:E.CERT,mobile:e.holder.mobile,birthday:p(e.holder.certNo),gender:T(e.holder.certNo),extInfo:{hasSocialInsurance:e.holder.socialFlag}},extInfo:{extraInfo:{renewalDK:e.renewalDK,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,successJumpUrl:e.successJumpUrl},iseeBizNo:e.iseeBizNo},tenantOrderInsuredList:[{tenantId:e.tenantId,relationToHolder:e.insured.relationToHolder,certNo:e.insured.certNo,certType:E.CERT,name:e.insured.name,mobile:e.insured.relationToHolder===F.SELF?e.holder.mobile:"",birthday:p(e.insured.certNo),gender:T(e.insured.certNo),extInfo:{hasSocialInsurance:e.insured.socialFlag},tenantOrderProductList:[{tenantId:e.tenantId,productCode:(n=e.detail)==null?void 0:n.productCode,productName:(a=e.detail)==null?void 0:a.productName,premium:e.premium,tenantOrderRiskList:e.tenantOrderRiskList}]}]}},A=(e,i)=>{if(!e)return"";const[t,n]=e.split("_"),a=parseInt(n,10);return t==="day"?g(i).add(a,"day").format("YYYY-MM-DD"):g(i).add(a,"year").format("YYYY-MM-DD")},b=(e,i=g().format("YYYY-MM-DD"))=>g(e).diff(i,"day"),J=(e,i,t)=>{const n=A(e,t),a=A(i,t);return b(n)<=1&&b(a)>=0},te=e=>{const{riskCode:i,liabilityCode:t,birth:n,sex:a}=e,r=A("max_18",n);return console.log("lastDate",r),console.log("diffDate(lastDate)",b(r)),!(i==="7Y7"&&t==="FXG086"&&!(a===z.FEMALE&&b(r)<=0))},x=(e,i,t=n=>!0)=>{const n=p(i),a=T(i),r=[];return e.forEach(s=>{const{riskDetailVOList:o}=s,l=o.map(d=>{const{maxHolderAge:m,minHolderAge:u}=d.riskInsureLimitVO;return J(u,m,n)?(d.riskLiabilityInfoVOList=d.riskLiabilityInfoVOList.filter(c=>t({riskCode:d.riskCode,liabilityCode:c.liabilityCode,birth:n,sex:a})),d):null});r.push({riskDetailVOList:l.filter(d=>!!(d&&d.riskLiabilityInfoVOList.length>0))})}),r},ie=(e,i=!1,t=n=>!0)=>{var r,s,o;let n=[];if(i)n=V((s=(r=x(_(e.insureDetail.productRiskVoList),e.insured.certNo,t))==null?void 0:r[0])==null?void 0:s.riskDetailVOList,e.productDetail,[],e.paymentFrequency,i);else{const l=x(_(e.insureDetail.productRiskVoList),e.insured.certNo,t);console.log("===result",[...l]),n=l.map(d=>V(d.riskDetailVOList,e.productDetail,e.packageRiskIdList,e.paymentFrequency,i))}return{calcData:{holder:{personVO:{birthday:p(e.holder.certNo),certType:E.CERT,certNo:e.holder.certNo,gender:Number(T(e.holder.certNo)),mobile:e.holder.mobile,name:e.holder.name,socialFlag:e.holder.socialFlag}},insuredVOList:[{insuredCode:(o=e.productDetail)==null?void 0:o.insurerCode,relationToHolder:e.insured.relationToHolder,personVO:{birthday:p(e.insured.certNo),certType:E.CERT,certNo:e.insured.certNo,gender:Number(T(e.insured.certNo)),name:e.insured.name,socialFlag:e.insured.socialFlag},productPlanVOList:[{riskVOList:n.flat()}]}],productCode:e.productDetail.productCode,tenantId:e.tenantId},riskVOList:n.flat()}},ne=e=>e&&e.length?e.filter(t=>t.value===K.INSURE).map(t=>t.productRiskVoList.map(n=>n.id)).flat():[],ae=(e,i="year")=>g().diff(p(e),i,!0),X=e=>!e||Number.isNaN(+e.split("_")[1])?0:e==null?void 0:e.split("_")[1],j=e=>{const{tenantId:i,riskList:t,riskPremium:n,productId:a}=e;return t.map(r=>{var o,l,d,m,u;return{tenantId:i,amountUnit:1,annuityDrawFrequency:r.annuityDrawDate,annuityDrawType:r.annuityDrawType,paymentFrequency:r.paymentFrequency,paymentPeriod:0,paymentPeriodType:(o=U)==null?void 0:o[r.chargePeriod],insurancePeriodType:H[r.coveragePeriod==="to_life"?"to_life":(d=(l=r.coveragePeriod)==null?void 0:l.split("_"))==null?void 0:d[0]],insurancePeriodValue:X(r.coveragePeriod),riskCode:r.riskCode,riskType:r.riskType,riskName:r.riskName,extInfo:{riskId:r.riskId,copy:r.copy},initialPremium:(m=n[r.riskCode])==null?void 0:m.premium,liabilityDetails:(u=r.liabilityVOList)==null?void 0:u.map(c=>({liabilityCode:c.liabilityCode,liabilityName:c.liabilityName,refundMethod:c.liabilityAttributeValue})),productId:a,currentAmount:r.amount,initialAmount:r.amount}})},oe=e=>{var t,n,a,r;return console.log(e,"freeTransform"),{orderAmount:0,tenantId:e.tenantId,venderCode:e.insureDetail.productBasicInfoVO.insurerCode,orderDataSource:"1",saleUserId:e.saleUserId,saleChannelId:e.saleChannelId,orderCategory:"1",tenantOrderHolder:{tenantId:e.tenantId,certType:e.order.tenantOrderHolder.certEndType,...e.order.tenantOrderHolder},extInfo:{...e.extInfo,templateId:2,buttonCode:e.buttonCode,pageCode:e.pageCode,iseeBizNo:e.iseeBizNo},tenantOrderInsuredList:[{...e.order.tenantOrderInsuredList[0],tenantId:e.tenantId,certType:e.order.tenantOrderInsuredList[0].certEndType,mobile:e.order.tenantOrderInsuredList[0].relationToHolder===F.SELF?e.order.tenantOrderHolder.mobile:"",tenantOrderProductList:[{tenantId:e.tenantId,productCode:(t=e.insureDetail)==null?void 0:t.productBasicInfoVO.productCode,productName:(n=e.insureDetail)==null?void 0:n.productBasicInfoVO.productName,premium:0,tenantOrderRiskList:j({tenantId:e.tenantId,riskList:V(e.insureDetail.productRiskVoList[0].riskDetailVOList,e.detail),riskPremium:{},productId:(a=e.detail)==null?void 0:a.id})}]}],operateOption:(r=e.order)==null?void 0:r.operateOption}};export{re as a,ae as b,oe as f,ie as g,ne as o,ee as r,$ as t,te as v};
