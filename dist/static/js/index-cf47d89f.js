import{l as i,a as e,P as a}from"./index-7b3bf99d.js";import{d as s,z as l,o as t,a1 as r,R as n,c as o,A as d,V as u,U as c,g as p,i as k,w as v,h as m,G as f,aM as I,L as y,r as g,e as h,ag as L,f as b,j as V,E as R,aA as C,aY as S,a2 as P,aa as x,B as O,aZ as T,a_ as D,al as w,am as F,u as _,a as E,$ as j,k as N,au as M,T as q}from"./index-0871b571.js";import{I as A}from"./index-f7db6fd2.js";/* empty css              */import{S as B}from"./index-b0d52ed7.js";import{P as K}from"./index-db371648.js";import{S as U,_ as $}from"./box-title-856f7585.js";import{_ as Q}from"./index-2422d362.js";import{T as W}from"./Table-2ed6c534.js";import{u as z,b as H,p as G,q as Y,c as Z}from"./trial-6805e8f6.js";import{u as J}from"./useOrder-7d2d5beb.js";import"./trial-b9c3b738.js";import"./infoCollection-8f2738b3.js";import"./core-894893f4.js";const X={key:0},ii={key:0,class:"risk2-field"},ei=s({name:"ProductRiskList"});var ai=f(s({...ei,props:{dataSource:{type:Array,default:()=>[]},productInfo:{type:Object,default:()=>({productCode:"",productName:""})},showMainRisk:{type:Boolean,default:()=>!0},defaultValue:{type:Object,default:()=>{}}},emits:["trialChange"],setup(i,{emit:e}){const a=i,s=l({loading:!1,show:!0,select:{},list:[],userData:{},riskIsInsure:{},submitData:{},disabledRiskInfo:[],risksDefaultValue:{}}),f=i=>{const e=[];return i.riskLiabilityInfoVOList.map((i=>(1!=+i.showFlag&&e.push({...i}),[]))),e},y=(i,l,t)=>{var r;s.riskIsInsure[l].data=i;const n=[...s.disabledRiskInfo];null==(r=a.dataSource.insureProductRiskVOList)||r.forEach((i=>{if(1!==i.mainRiskFlag){const e=s.riskIsInsure[i.riskId];e.data&&Object.keys(e.data).length>0&&!e.isDisabled&&n.push(e.data)}})),e("trialChange",n,t)},g=(i,e)=>{var l;null==(l=a.dataSource.productRiskRelationVOList)||l.forEach((a=>{1!==a.collocationType&&(e.riskId===a.riskId?(s.riskIsInsure[e.riskId]&&s.riskIsInsure[e.riskId].selected,2===a.collocationType&&s.riskIsInsure[a.collocationRiskId]&&(s.riskIsInsure[a.collocationRiskId].selected=i),3===a.collocationType&&s.riskIsInsure[a.collocationRiskId]&&(s.riskIsInsure[a.collocationRiskId].selected="1"===i?"2":"1")):e.riskId===a.collocationRiskId&&(3===a.collocationType&&s.riskIsInsure[a.riskId]&&(s.riskIsInsure[a.riskId].selected="1"===i?"2":"1"),2===a.collocationType&&s.riskIsInsure[a.riskId]&&(s.riskIsInsure[a.riskId].selected=i)))})),"2"===i?y({},e.riskId):(i=>{var e,a,s,l,t,r;if(1!==(null==i?void 0:i.factorDisPlayFlag)){const n=null==(e=null==i?void 0:i.productRiskInsureLimitVO)?void 0:e.amountPremiumConfigVO,o={riskCategory:i.riskCategory,riskCode:i.riskCode,riskName:i.riskName,riskId:i.riskId,riskType:i.riskType,mainRiskId:i.mainRiskId,mainRiskCode:i.mainRiskCode,liabilityList:f(i)};o.chargePeriod=(null==(a=null==i?void 0:i.paymentPeriodValueList)?void 0:a.length)>0&&(null==i?void 0:i.paymentPeriodValueList[0].code)||null,o.coveragePeriod=(null==(s=null==i?void 0:i.insurancePeriodValueList)?void 0:s.length)>0&&(null==i?void 0:i.insurancePeriodValueList[0].code)||null,o.paymentFrequency=(null==(l=null==i?void 0:i.paymentFrequencyList)?void 0:l.length)>0&&(null==i?void 0:i.paymentFrequencyList[0].code)||null;let d=0;1===n.displayType?d=(null==n?void 0:n.minStepValue)>0?null==n?void 0:n.minStepValue:0:3===n.displayType&&2===n.requireCopies?d=(null==(t=null==n?void 0:n.displayValues)?void 0:t.length)>0?null==n?void 0:n.displayValues[0].value:0:3===n.displayType&&1===n.requireCopies?(d=(null==(r=null==n?void 0:n.displayValues)?void 0:r.length)>0?null==n?void 0:n.displayValues[0].value:0,o.copy=n.minCopiesValue):2===n.displayType?o.copy=n.minCopiesValue:d=0,1===n.saleMethod?o.initialAmount=d:o.initialPremium=d,y(o,i.riskId)}})(e)};return t((()=>{(()=>{var i,e;s.disabledRiskInfo=[];let l=null;if(null==(i=a.dataSource.insureProductRiskVOList)||i.forEach((i=>{var e;const t=1!==i.mainRiskFlag?null==(e=a.dataSource.productRiskRelationVOList)?void 0:e.find((e=>e.collocationRiskId===i.riskId)):{};1===i.mainRiskFlag&&(l=i),s.riskIsInsure[i.riskId]?(s.riskIsInsure[i.riskId].data=null,s.riskIsInsure[i.riskId].relation=t,s.riskIsInsure[i.riskId].isMust=!1):s.riskIsInsure[i.riskId]={selected:"2",data:null,relation:t,isMust:!1}})),l){const i=null==(e=a.dataSource.productRiskRelationVOList)?void 0:e.filter((i=>i.riskId===l.riskId));if(!i)return;null==i||i.forEach((i=>{var e,l,t,r,n,o,d,u,c;if(2===i.collocationType){s.riskIsInsure[i.collocationRiskId].selected="1",s.riskIsInsure[i.collocationRiskId].isMust=!0;const p=null==(e=a.dataSource.insureProductRiskVOList)?void 0:e.find((e=>i.collocationRiskId===e.riskId));if(p&&1!==p.factorDisPlayFlag&&(null==(l=null==p?void 0:p.productRiskInsureLimitVO)?void 0:l.amountPremiumConfigVO)){const e=null==(t=p.riskLiabilityInfoVOList)?void 0:t.every((i=>1!==i.showFlag)),a=null==(r=null==p?void 0:p.productRiskInsureLimitVO)?void 0:r.amountPremiumConfigVO;if(e){s.riskIsInsure[i.collocationRiskId].isDisabled=!0;const e={riskCategory:p.riskCategory,riskCode:p.riskCode,riskName:p.riskName,riskId:p.riskId,riskType:p.riskType,mainRiskId:p.mainRiskId,mainRiskCode:p.mainRiskCode,liabilityList:f(p)};e.chargePeriod=(null==(n=null==p?void 0:p.paymentPeriodValueList)?void 0:n.length)>0&&(null==p?void 0:p.paymentPeriodValueList[0].code)||null,e.coveragePeriod=(null==(o=null==p?void 0:p.insurancePeriodValueList)?void 0:o.length)>0&&(null==p?void 0:p.insurancePeriodValueList[0].code)||null,e.paymentFrequency=(null==(d=null==p?void 0:p.paymentFrequencyList)?void 0:d.length)>0&&(null==p?void 0:p.paymentFrequencyList[0].code)||null;let l=0;1===a.displayType?l=(null==a?void 0:a.minStepValue)>0?null==a?void 0:a.minStepValue:0:3===a.displayType&&2===a.requireCopies?l=(null==(u=null==a?void 0:a.displayValues)?void 0:u.length)>0?null==a?void 0:a.displayValues[0].value:0:3===a.displayType&&1===a.requireCopies?(l=(null==(c=null==a?void 0:a.displayValues)?void 0:c.length)>0?null==a?void 0:a.displayValues[0].value:0,e.copy=a.minCopiesValue):2===a.displayType&&(e.copy=a.minCopiesValue),1===a.saleMethod?e.initialAmount=l:e.initialPremium=l,s.disabledRiskInfo.push(e),y(e,p.riskId)}}}3===i.collocationType&&(s.riskIsInsure[i.collocationRiskId].selected="2",s.riskIsInsure[i.collocationRiskId].isMust=!0)}))}})()})),r((()=>{s.loading=!0})),n((()=>s.riskIsInsure),(i=>{}),{deep:!0,immediate:!0}),n((()=>a.defaultValue),(i=>{(null==i?void 0:i.length)>0&&i.forEach((i=>{s.risksDefaultValue[i.riskCode]=i,s.riskIsInsure[i.riskId]?(s.riskIsInsure[i.riskId].selected="1",y(i,i.riskId)):s.riskIsInsure[i.riskId]={selected:"1",isMust:!1}}))}),{deep:!0,immediate:!0}),(e,a)=>{const l=B,t=I;return o(!0),d(c,null,u(i.dataSource.insureProductRiskVOList,(e=>{var a,r;return o(),d(c,{key:e.riskCode},[(!i.showMainRisk&&1!==e.mainRiskFlag||i.showMainRisk)&&(null==(r=null==(a=p(s).riskIsInsure)?void 0:a[e.riskId])?void 0:r.relation)?(o(),d("div",X,[k(t,{modelValue:p(s).riskIsInsure[e.riskId].selected,"onUpdate:modelValue":i=>p(s).riskIsInsure[e.riskId].selected=i,label:e.riskName,name:"selected","label-width":"50%",border:!1,class:"risk-select-field risk-name"},{input:v((()=>[k(l,{modelValue:p(s).riskIsInsure[e.riskId].selected,"onUpdate:modelValue":i=>p(s).riskIsInsure[e.riskId].selected=i,"active-value":"1","inactive-value":"2",size:"26px",disabled:p(s).riskIsInsure[e.riskId].isMust,style:{"margin-right":"8px"},onChange:i=>g(i,e)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])])),_:2},1032,["modelValue","onUpdate:modelValue","label"]),"1"===p(s).riskIsInsure[e.riskId].selected?(o(),d("div",ii,[k(A,{modelValue:p(s).riskIsInsure[e.riskId].data,"onUpdate:modelValue":i=>p(s).riskIsInsure[e.riskId].data=i,"origin-data":e,"product-factor":i.dataSource.productFactor,"default-value":p(s).risksDefaultValue[e.riskCode],onTrialChange:(i,a)=>y(i,e.riskId,a)},null,8,["modelValue","onUpdate:modelValue","origin-data","product-factor","default-value","onTrialChange"])])):m("",!0)])):m("",!0)],64)})),128)}}}),[["__scopeId","data-v-75d0d5d0"]]);const si={class:"benefit-table"},li=s({name:"benefitTable"}),ti=s({...li,props:{dataSource:null},setup(i){const e=i,a=y((()=>{const i=e.dataSource.headers.length,a=12*e.dataSource.headers.join("").length+20*e.dataSource.headers.length;return e.dataSource.headers.map(((e,s)=>{const l=a>320?12*e.length+20:Math.max(12*e.length+20,320/i);return console.log("totalWordWidth:",a,"titleWidth:",l,"word-width:",12*e.length+20),{title:e,key:`header_${s}`,fixed:s<2,minWidth:l}}))})),s=y((()=>e.dataSource.dataList.map((i=>{const e={};return i.forEach(((i,a)=>{e[`header_${a}`]=i})),e}))));return r((()=>{})),(i,e)=>(o(),d("div",si,[k(W,{"top-height":400,columns:p(a),data:p(s),"is-clone":!0},null,8,["columns","data"])]))}});const ri=i=>(w("data-v-d9a31ad8"),i=i(),F(),i),ni={key:0,class:"benefit-container"},oi={key:0,class:"benefit"},di=ri((()=>b("div",{class:"line"},null,-1))),ui={class:"box-title box-title-chart"},ci=ri((()=>b("img",{class:"tl",src:$,alt:""},null,-1))),pi=ri((()=>b("img",{class:"transform-z180 tr",src:$,alt:""},null,-1))),ki={key:0},vi={class:"box"},mi={class:"box-title"},fi=ri((()=>b("img",{class:"tl",src:$,alt:""},null,-1))),Ii=ri((()=>b("img",{class:"transform-z180 tr",src:$,alt:""},null,-1))),yi={class:"box-price"},gi={class:"text1"},hi={class:"text2"},Li={key:1},bi={key:2,style:{width:"100%, minWidth: 338px"}},Vi={class:"slider"},Ri={style:{flex:"1",margin:"0px 5px"}},Ci={class:"custom-button"},Si=ri((()=>b("p",{class:"slider-dec"},"拖动按钮查看不同年龄保障",-1))),Pi={class:"btn-two"},xi={key:1,class:"benefit-container"},Oi={key:0},Ti={class:"benefit"},Di=ri((()=>b("div",{class:"line"},null,-1))),wi=ri((()=>b("div",null,[b("div",{class:"box"},[b("p",{class:"box-title"},[b("img",{class:"tl",src:$,alt:""}),V(" 保单年度"),b("span",null,"-"),V("年度，被保人"),b("span",null,"-"),V("岁时 "),b("img",{class:"transform-z180 tr",src:$,alt:""})]),b("div",{class:"box-price"})])],-1))),Fi={class:"slider"},_i={class:"opt lf"},Ei={style:{flex:"1",margin:"0px 5px"}},ji=ri((()=>b("div",{class:"custom-button"},"0 岁",-1))),Ni={class:"opt rg"},Mi=ri((()=>b("p",{class:"slider-dec"},"拖动按钮查看不同年龄保障",-1))),qi={class:"btn-two"},Ai={key:1,class:"empty-box"},Bi=s({name:"Benefit"});var Ki=f(s({...Bi,props:{dataSource:{default:()=>({showTypeList:["1"]})},productInfo:{default:()=>null}},setup(i){var e;const a=i,s="1",l="2",t="3",r=g(0),f=g(0),I=g(0),y=g(),w=g(0),F=g(null==(e=a.dataSource.showTypeList)?void 0:e[0]),_=g(),E=i=>{if(!(null==i?void 0:i.benefitRiskResultVOList))return;const e=null==i?void 0:i.benefitRiskResultVOList[r.value];f.value=e.ageBegin+1,w.value=e.ageBegin+1,I.value=e.ageEnd},j=()=>{var i,e,s,l,t,n;const o=null==(e=null==(i=a.dataSource)?void 0:i.benefitRiskResultVOList)?void 0:e[r.value];_.value=null==(t=null==(l=null==(s=a.dataSource)?void 0:s.benefitRiskResultVOList)?void 0:l[r.value].benefitRiskTableResultVOList)?void 0:t[0];const{a:d,year:u}=((i,e)=>{const a=[],s=[];for(let l=i,t=0;l<=e;l++,t++)a.push(l.toString()),s.push(t+1);return{a:a,year:s}})(f.value,I.value),c={index:d.indexOf(w.value.toString()),age:d,year:u,result:null==(n=null==o?void 0:o.benefitRiskItemResultVOList)?void 0:n[0]};y.value=c},N=()=>{w.value>I.value-1||(w.value+=1,j())},M=()=>{w.value>f.value&&(w.value-=1,j())},q=i=>{r.value=i.name,E(a.dataSource),j()};return n((()=>a.dataSource),(i=>{var e;i&&(E(i),j(),F.value=null==(e=i.showTypeList)?void 0:e[0])}),{deep:!0,immediate:!0}),n(w,(()=>{j()})),(e,n)=>{var g;const E=x,j=U,A=O,B=T,$=D,W=K;return(null==(g=i.dataSource)?void 0:g.benefitRiskResultVOList)?(o(),d("div",ni,[k($,{active:p(r),onClickTab:q},{default:v((()=>{var i;return[(o(!0),d(c,null,u(null==(i=a.dataSource)?void 0:i.benefitRiskResultVOList,((i,e)=>(o(),h(B,{key:e,name:e,title:i.riskName},{default:v((()=>{var i,g,x,O,T,D,q,B,K,U,$,W,z,H,G,Y;return[e==p(r)?(o(),d("div",oi,[di,L(b("p",ui,[ci,V(" 保单年度"),b("span",null,R(null==(x=null==(i=p(y))?void 0:i.year)?void 0:x[null==(g=p(y))?void 0:g.index]),1),V("年度，被保人"),b("span",null,R(null==(D=null==(O=p(y))?void 0:O.age)?void 0:D[null==(T=p(y))?void 0:T.index]),1),V("岁时 "),pi],512),[[C,p(F)===l]]),p(F)===s?(o(),d("div",ki,[b("div",vi,[b("p",mi,[fi,V(" 保单年度"),b("span",null,R(null==(K=null==(q=p(y))?void 0:q.year)?void 0:K[null==(B=p(y))?void 0:B.index]),1),V("年度，被保人"),b("span",null,R(null==(W=null==(U=p(y))?void 0:U.age)?void 0:W[null==($=p(y))?void 0:$.index]),1),V("岁时 "),Ii]),b("div",yi,[(o(!0),d(c,null,u(null==(H=null==(z=p(y))?void 0:z.result)?void 0:H.headers,((i,e)=>{var a,s,l,t,r,n,u,c,k,v;return o(),d("div",{key:e,style:{width:"33%"}},[b("p",gi,R(("0"==(null==(r=null==(t=null==(s=null==(a=p(y))?void 0:a.result)?void 0:s.dataList)?void 0:t[null==(l=p(y))?void 0:l.index])?void 0:r[e])?"0":p(S)(Number(null==(v=null==(k=null==(u=null==(n=p(y))?void 0:n.result)?void 0:u.dataList)?void 0:k[null==(c=p(y))?void 0:c.index])?void 0:v[e])))||"0"),1),b("p",hi,R(i)+"(元）",1)])})),128))])])])):m("",!0),p(F)===t?(o(),d("div",Li,[k(ti,{"data-source":p(_)},null,8,["data-source"])])):m("",!0),p(F)==l?(o(),d("div",bi,[k(Q,{min:p(f),max:p(I),current:p(w),data:null==(Y=null==(G=p(y))?void 0:G.result)?void 0:Y.benefitRiskItemList},null,8,["min","max","current","data"])])):m("",!0),p(F)!=t?(o(),d(c,{key:3},[b("div",Vi,[b("div",{class:"opt lf",onClick:M},[k(E,{name:"minus"})]),b("div",Ri,[p(f)?(o(),h(j,{key:0,modelValue:p(w),"onUpdate:modelValue":n[0]||(n[0]=i=>P(w)?w.value=i:null),min:p(f),max:p(I),"bar-height":"8px"},{button:v((()=>[b("div",Ci,R(p(w))+" 岁",1)])),_:1},8,["modelValue","min","max"])):m("",!0)]),b("div",{class:"opt rg",onClick:N},[k(E,{name:"plus"})])]),Si],64)):m("",!0),b("div",Pi,[a.dataSource.showTypeList.includes(s)?(o(),h(A,{key:0,round:"",plain:p(F)!==s,type:"primary",class:"btn",onClick:n[1]||(n[1]=i=>F.value=s)},{default:v((()=>[V("图表展示")])),_:1},8,["plain"])):m("",!0),a.dataSource.showTypeList.includes(l)?(o(),h(A,{key:1,round:"",plain:p(F)!==l,type:"primary",class:"btn",onClick:n[2]||(n[2]=i=>F.value=l)},{default:v((()=>[V("趋势展示")])),_:1},8,["plain"])):m("",!0),a.dataSource.showTypeList.includes(t)?(o(),h(A,{key:2,round:"",plain:p(F)!==t,type:"primary",class:"btn",onClick:n[3]||(n[3]=i=>F.value=t)},{default:v((()=>[V("表格展示")])),_:1},8,["plain"])):m("",!0)])])):m("",!0)]})),_:2},1032,["name","title"])))),128))]})),_:1},8,["active"])])):(o(),d("div",xi,[a.productInfo?(o(),d("div",Oi,[k($,{active:p(r),onClickTab:q},{default:v((()=>[(o(),h(B,{key:1,name:1,title:i.productInfo.insureProductRiskVOList[0].riskName},{default:v((()=>[b("div",Ti,[Di,wi,b("div",Fi,[b("div",_i,[k(E,{name:"minus"})]),b("div",Ei,[k(j,{modelValue:p(w),"onUpdate:modelValue":n[4]||(n[4]=i=>P(w)?w.value=i:null),min:0,max:80,"bar-height":"8px",disabled:""},{button:v((()=>[ji])),_:1},8,["modelValue"])]),b("div",Ni,[k(E,{name:"plus"})])]),Mi,b("div",qi,[k(A,{round:"",plain:!0,type:"primary",class:"btn",disabled:""},{default:v((()=>[V("图表展示")])),_:1}),k(A,{round:"",plain:!1,type:"primary",class:"btn",disabled:""},{default:v((()=>[V("趋势展示")])),_:1}),k(A,{round:"",plain:!1,type:"primary",class:"btn",disabled:""},{default:v((()=>[V("表格展示")])),_:1})])])])),_:1},8,["title"]))])),_:1},8,["active"])])):(o(),d("div",Ai,[k(W,{title:"试算结果正在计算中...","empty-class":"empty-select"})]))]))}}}),[["__scopeId","data-v-d9a31ad8"]]);const Ui={key:0,class:"head-warning-wrap"},$i=b("div",{class:"warning-icon"},[b("span",null,"!")],-1),Qi={class:"warning-text"},Wi=s({name:"HeadWaring"}),zi=s({...Wi,props:{labels:{default:()=>[]}},setup:i=>(e,a)=>i.labels.length>0?(o(),d("div",Ui,[$i,b("div",Qi,[(o(!0),d(c,null,u(i.labels,(i=>(o(),d("span",{key:i},R(i),1)))),128))])])):m("",!0)}),Hi=(e,a,s)=>{const l=e,{holder:t}=s,r=s.insuredList[0],n=(a||"").split("_");if(n.length<2)return a;if(i.exports.isNaN(Number(n[1])))return a;if(n[1]-=1,1===l.exemptFlag){if("to"===n[0]){let i=0;1===l.exemptType?(null==t?void 0:t.birthday)&&(i=parseInt(""+((new Date).getTime()-new Date(t.birthday).getTime())/31536e6,10)):2===l.exemptType&&(null==r?void 0:r.birthday)&&(i=parseInt(""+(+(new Date).getTime()-new Date(r.birthday).getTime())/31536e6,10)),n[1]=+n[1]-i}n[0]="year"}return n.join("_")},Gi=(i,e)=>{const a=[],s={};return null==i||i.forEach((i=>{s[i.riskId]=i})),null==e||e.forEach((i=>{var e,l,t,r;const{collocationType:n,collocationRiskId:o,riskId:d}=i;switch(n){case 2:{const i=null==(e=s[d])?void 0:e.riskName,t=null==(l=s[o])?void 0:l.riskName;a.push(`${i} 和 ${t} 必须同时投保`);break}case 3:{const i=null==(t=s[d])?void 0:t.riskName,e=null==(r=s[o])?void 0:r.riskName;a.push(`${i} 和 ${e} 不能同时投保`);break}}})),a};const Yi={class:"com-body"},Zi={class:"trial-body"},Ji={class:"container"},Xi=(i=>(w("data-v-3c30c4ca"),i=i(),F(),i))((()=>b("div",{class:"empty"},null,-1))),ie=s({name:"TrialBody"});var ee=f(s({...ie,props:{dataSource:{default:()=>[]},productInfo:{default:()=>({productCode:"",productName:"",insurerCode:"",tenantId:""})},tenantProductDetail:{default:()=>({})},hideBenefit:{type:Boolean,default:!1},hidePopupButton:{type:Boolean,default:!1},title:{default:"算一算保费"},defaultData:{default:null},isTrial:{type:Boolean,default:!1}},emits:["trialStart","trialEnd"],setup(s,{expose:u,emit:c}){const v=s,f=g(null),I=_();E(),I.query;const y=l({loading:!1,show:!1,select:{},list:[],userData:{},riskIsInsure:{},submitData:{},riskList:[{}],mainRiskVO:{},ifPersonalInfoSuccess:!1,trialMsg:"",trialResultPremium:0,trialResult:{initialPremium:0,initialAmount:0},isAniShow:!1,defaultValue:null,isAutoChange:!1,planIndex:0,isSkipFirstTrial:!1,hadSkipFirstTrial:!1,isQuerying:!1});J(),g(),g();const L=i=>{const{holder:e,insuredList:a}=i||{};e&&(y.submitData.holder=e),a&&a.length>0&&a.forEach(((i,e)=>{var a;y.submitData.insuredList&&y.submitData.insuredList.length>e?y.submitData.insuredList[e]=i:((null==(a=y.submitData)?void 0:a.insuredList)||(y.submitData.insuredList=[]),y.submitData.insuredList.push(i))}))},V=g(),R=g({}),C=["annuityDrawDate","coveragePeriod","chargePeriod"],S=i=>{var e,s,l,t,r,n;if(null==(s=null==(e=null==i?void 0:i.data)?void 0:e[0])?void 0:s.productRiskDyInsureFactorVOList){const e=[];if(null==(l=v.dataSource)||l.insureProductRiskVOList.forEach((s=>{var l,t;const r=null==(t=null==(l=null==i?void 0:i.data)?void 0:l[0])?void 0:t.productRiskDyInsureFactorVOList.find((i=>i.riskCode===s.riskCode));if(r){s.productRiskInsureLimitVO={...s.productRiskInsureLimitVO,...r};const i=y.riskList.find((i=>i.riskCode===s.riskCode));let l=!1;a.forEach((e=>{if(C.indexOf(e.valueKey)>=0){const a=s.productRiskInsureLimitVO[e.configKey];if(a&&i){const s=a.find((a=>a.code===i[e.valueKey]));if(s&&2===s.useFlag){const s=a.find((i=>1===i.defaultFlag));i[e.valueKey]=s.code,l=!0}}}})),l&&e.push({...i,...r,riskCode:s.riskCode})}})),e.length>0&&(null==(n=null==(r=null==(t=y.defaultValue)?void 0:t.insuredList)?void 0:r[0])?void 0:n.productList))return e.forEach((i=>{var e,a,s;y.defaultValue.insuredList[0].productList=null==(s=null==(a=null==(e=y.defaultValue)?void 0:e.insuredList)?void 0:a[0])?void 0:s.productList.map((e=>(e.riskList=null==e?void 0:e.riskList.map((e=>(e.riskCode===i.riskCode&&(e=i),e))),e)))})),!1}return!0},P=async(i,e=!0)=>{y.trialMsg="试算中...",y.trialResultPremium=0,y.loading=!0,c("trialStart");let a=!1;if(e){const{code:e}=await z(i);a="10000"===e}!a&&e||(y.isQuerying=!0,v.hideBenefit||H(i).then((i=>{i.data&&i.code===M&&(R.value=i.data)})).finally((()=>{y.loading=!1})),G(i).then((i=>{var e,a;if(i.data&&i.code===M){(null==(e=null==i?void 0:i.data)?void 0:e.errorInfo)&&q(`${null==(a=null==i?void 0:i.data)?void 0:a.errorInfo}`),y.trialMsg="",y.trialResultPremium=i.data.initialPremium,y.trialResult=i.data;const s={};i.data.riskPremiumDetailVOList&&i.data.riskPremiumDetailVOList.length&&i.data.riskPremiumDetailVOList.forEach((i=>{s[i.riskCode]={initialAmount:i.initialAmount,initialPremium:i.initialPremium}})),V.value=s,c("trialEnd",i.data)}})).finally((()=>{y.loading=!1,y.isQuerying=!1})))},x=i.exports.debounce((async()=>{if(console.log(">>>>>调用试算<<<<<"),y.ifPersonalInfoSuccess){if(y.submitData.productCode=v.productInfo.productCode,y.submitData.productName=v.productInfo.productName,y.submitData.tenantId=v.productInfo.tenantId,y.riskList=y.riskList.map((i=>(i=>{var e,s,l,t;const r=null==(e=v.dataSource.insureProductRiskVOList)?void 0:e.find((e=>i.riskId===e.riskId));if(r&&1!==r.mainRiskFlag){const e=null==(l=null==(s=v.dataSource)?void 0:s.productRiskRelationVOList)?void 0:l.find((i=>i.collocationRiskId===r.riskId));if(e){const s=null==(t=y.riskList)?void 0:t.find((i=>i.riskId===e.riskId));a.forEach((e=>{e.ruleKey&&r.productRiskInsureLimitVO&&s&&(1===r.productRiskInsureLimitVO[e.ruleKey]&&(i[e.valueKey]=s[e.valueKey]),3===r.productRiskInsureLimitVO[e.ruleKey]&&(1!==r.exemptFlag?i[e.valueKey]=Hi(r,s[e.valueKey],y.submitData):i[e.valueKey]=Hi(r,s[e.ruleValueKey],y.submitData)))}))}}return i})(i))),y.submitData.insuredList&&y.submitData.insuredList.forEach((i=>{i.productList=[{insurerCode:v.productInfo.insurerCode,planCode:v.dataSource.planCode,riskList:y.riskList}]})),y.isSkipFirstTrial&&!y.hadSkipFirstTrial)return void(y.hadSkipFirstTrial=!0);console.log(">>>数据构建<<<",y.submitData);const e=i.exports.cloneDeep(y.submitData);await P(e)}}),300),O=async i=>{var e;const{insuredList:a,isFirstInsuredChange:s}=i;if(L(i),y.ifPersonalInfoSuccess=!0,s){console.log("处理第一被保人修改的dy变化"),y.isQuerying=!0;const i=await Y({calcProductFactorList:[{planCode:v.dataSource.planCode,productCode:v.productInfo.productCode,riskEditVOList:[{insureProductRiskVO:null==(e=v.dataSource.insureProductRiskVOList)?void 0:e[0]}]}],...a[0]});if(y.isQuerying=!1,!S(i))return}console.log("投被保人的信息回传 ",y.submitData,i),x()},T=async(e,a)=>{var s,l,t,r;if(a){const n=i.exports.cloneDeep(e);delete n.insurancePeriodValueList,delete n.paymentFrequencyList,delete n.paymentPeriodValueList;if(C.indexOf(a.key)>=0){const i={};switch(a.key){case"annuityDrawDate":i.changeType=3;break;case"coveragePeriod":i.changeType=2;break;case"chargePeriod":i.changeType=1}const o=null==(l=null==(s=y.submitData)?void 0:s.insuredList)?void 0:l[0],d=null==(r=null==(t=v.dataSource)?void 0:t.insureProductRiskVOList)?void 0:r.find((i=>i.riskCode===e.riskCode));if(!y.isAutoChange){y.isQuerying=!0;const a=await Y({calcProductFactorList:[{planCode:v.dataSource.planCode,productCode:v.productInfo.productCode,riskEditVOList:[{insureProductRiskVO:d,insureRiskEditReqVO:{riskId:e.riskId,riskCode:e.riskCode,...n,...i}}]}],...o});y.isQuerying=!1;const s=S(a);return s||(y.isAutoChange=!0),s}y.isAutoChange=!1}}return!0},D=async(i,e)=>{y.mainRiskVO=i;await T(i,e)&&(y.riskList.length>0&&(y.riskList[0]=i),console.log("标准险种的信息回传",i),x())},w=async(i,e)=>{if(y.riskList=[y.mainRiskVO,...i],console.log("附加险列表数据回传",i),e){const a=i.find((i=>i.riskCode===e.riskCode));if(!(await T(a,e)))return}x()},F=i=>{var e,a,s,l;y.userData=i,y.defaultValue=i;const t=(null==(e=i.insuredList)?void 0:e[0].productList.findIndex((i=>i.planCode===v.dataSource.planCode)))||0;y.planIndex=-1===t?0:t,y.riskList=(null==(l=null==(s=null==(a=null==i?void 0:i.insuredList)?void 0:a[0].productList)?void 0:s[y.planIndex])?void 0:l.riskList)||[],P(i,!0)};t((()=>{var i,e;y.select={},y.list=[],y.userData={},y.riskIsInsure={},y.submitData={},y.riskList=[{}],y.mainRiskVO={},y.ifPersonalInfoSuccess=!1,y.trialMsg="",y.trialResultPremium=0,y.riskIsInsure={},null==(e=null==(i=null==v?void 0:v.dataSource)?void 0:i.insureProductRiskVOList)||e.forEach((i=>{var e;const a=null==(e=v.dataSource.productRiskRelationVOList)?void 0:e.find((e=>e.collocationRiskId===i.riskId));a&&(y.riskIsInsure[i.riskCode]={selected:"2",data:null,relation:a})}))})),r((()=>{y.loading=!0,y.show=!0,y.isAniShow=!0,y.isSkipFirstTrial=!0,y.hadSkipFirstTrial=!1,j((()=>{(async i=>{var e;if(console.log("props.defaultData",v.defaultData),v.defaultData){const i=v.defaultData.find((i=>i.productCode===v.productInfo.productCode))||v.defaultData[0];F(i),L(null==(e=v.defaultData)?void 0:e[0])}else{const i=await Z({calcProductFactorList:[{planCode:v.dataSource.planCode,productCode:v.productInfo.productCode}]});if(i.data){const e=i.data.find((i=>i.productCode===v.productInfo.productCode))||i.data[0];console.log("targetProduct",e),F(e)}}})()}))}));const B=g();return u({getTrialSuccessFlag:()=>y.trialResultPremium>0,validate:()=>B.value.validate(!1),validateTrialFields:()=>B.value.validateTrialFields(),validateHolder:i=>{var e;return null==(e=B.value)?void 0:e.validateHolder(i)},getUserData:()=>({...y.userData})}),n((()=>y.riskIsInsure),(i=>{}),{deep:!0,immediate:!0}),(i,a)=>{var l,t,r,n,u,c,v;return o(),d("div",Yi,[N(i.$slots,"trialHead",{},void 0,!0),b("div",Zi,[k(zi,{labels:p(Gi)((null==(l=s.dataSource)?void 0:l.insureProductRiskVOList)||[],s.dataSource.productRiskRelationVOList)},null,8,["labels"]),b("div",Ji,[s.hideBenefit?m("",!0):(o(),h(Ki,{key:0,class:"benefit-wrap","data-source":R.value,"product-info":s.dataSource,"show-type-list":R.value.showTypList},null,8,["data-source","product-info","show-type-list"])),s.dataSource.productFactor?(o(),h(p(e),{key:1,ref_key:"personalInfoRef",ref:B,modelValue:p(y).userData,"onUpdate:modelValue":a[0]||(a[0]=i=>p(y).userData=i),"is-trial":s.isTrial,"product-factor":s.dataSource.productFactor,"multi-insured-config":null==(t=s.dataSource)?void 0:t.multiInsuredConfigVO,onTrailChange:O},null,8,["modelValue","is-trial","product-factor","multi-insured-config"])):m("",!0),k(A,{ref_key:"insureInfosRef",ref:f,"origin-data":null==(r=s.dataSource.insureProductRiskVOList)?void 0:r[0],"product-factor":s.dataSource.productFactor,"default-value":p(y).defaultValue?null==(u=null==(n=p(y).defaultValue)?void 0:n.insuredList[0].productList[p(y).planIndex])?void 0:u.riskList[0]:null,"trial-result":p(y).trialResult,onTrialChange:D},null,8,["origin-data","product-factor","default-value","trial-result"]),s.dataSource.insureProductRiskVOList?(o(),h(ai,{key:2,"data-source":s.dataSource,"show-main-risk":!1,"default-value":p(y).defaultValue?null==(v=null==(c=p(y).defaultValue)?void 0:c.insuredList[0].productList[p(y).planIndex])?void 0:v.riskList:[],onTrialChange:w},null,8,["data-source","default-value"])):m("",!0),Xi])]),N(i.$slots,"trialBtn",{trialData:p(y).submitData,riskPremium:p(y).trialResult,loading:p(y).isQuerying},void 0,!0)])}}}),[["__scopeId","data-v-3c30c4ca"]]);export{ee as T};
