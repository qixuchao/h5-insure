var ne=Object.defineProperty,re=Object.defineProperties;var ie=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var Y=(B,o,E)=>o in B?ne(B,o,{enumerable:!0,configurable:!0,writable:!0,value:E}):B[o]=E,q=(B,o)=>{for(var E in o||(o={}))ce.call(o,E)&&Y(B,E,o[E]);if($)for(var E of $(o))le.call(o,E)&&Y(B,E,o[E]);return B},Q=(B,o)=>re(B,ie(o));import{g as de,Q as Be,aj as Ee,C as b,d as _e,M as fe,r as z,h as f,j as De,k as D,y as t,n as F,I as C,J as W,m as v,s as O,z as I,E as x,F as w,a1 as Fe,a2 as Ce,B as p,T as R,D as ve}from"./vendor-fc34688e.js";import{_ as Ae,S as he,D as pe,o as G,k as S,E as J,N as T,P as ge}from"./index-e14693df.js";import{g as me,f as ye,s as K,a as Ie}from"./verify-fe5ef7da.js";import{n as Ne,a as Oe}from"./index-0522cf58.js";const X=B=>(Fe("data-v-730704c8"),B=B(),Ce(),B),Re={class:"page-verify"},Se={class:"people"},Te={class:"name"},ke={class:"verify-item"},be=X(()=>t("div",{class:"label"},"\u8EAB\u4EFD\u8BC1\u53F7\u7801",-1)),xe={class:"no"},we=p(" \u53BB\u8BA4\u8BC1 "),Ue={class:"sign-body"},Le={class:"date"},Pe={class:"file"},He=p(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A"),je={key:0,class:"dun-hao"},Me={class:"people"},Ve={class:"name"},$e={class:"verify-item"},Ye=X(()=>t("div",{class:"label"},"\u8EAB\u4EFD\u8BC1\u53F7\u7801",-1)),qe={class:"no"},Qe=["onClick"],ze=p(" \u53BB\u8BA4\u8BC1 "),We=["onClick"],Ge={class:"sign-body"},Je={class:"date"},Ke={class:"file"},Xe=p(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A"),Ze={key:0,class:"dun-hao"},eu={class:"footer-button footer"},uu=p("\u63D0\u4EA4"),tu=de({setup(B){const o={CERT:1,NO_CERT:2},E=Be(),Z=Ee(),{saleUserId:U="D1234567-1",tenantId:g="9991000007",templateId:ee=1,productCode:ue="CQ75CQ76",insurerCode:su="ancheng"}=E.query;let{orderNo:A}=E.query;typeof A=="object"&&(A=(A||[])[0]);const k=new he({source:"localStorage"}),N=b([]),c=b(),m=b(),h=[],L=_e().format("YYYY-MM-DD"),te=()=>{var u;(u=m.value)==null||u.clear()},se=u=>{h[u].clear()},P=(u,n)=>{Ie({callbackUrl:window.location.href,certiNo:u,faceAuthMode:"TENCENT",userName:n,tenantId:9991000007}).then(l=>{const{code:i,data:r}=l;if(i==="10000"){const{originalUrl:e,serialNo:s}=r;window.location.href=e,k.set("verifyData",{serialNo:s,certNo:u,name:n})}})},H=u=>{var n,l,i,r;u===-1?P((n=c.value.tenantOrderHolder)==null?void 0:n.certNo,(l=c.value.tenantOrderHolder)==null?void 0:l.name):P((i=c.value.tenantOrderInsuredList[u])==null?void 0:i.certNo,(r=c.value.tenantOrderInsuredList[u])==null?void 0:r.name)},ae=u=>{u&&h.every(n=>n!==u)&&h.push(u)},oe=()=>{var n,l,i,r;if((n=m.value)==null?void 0:n.isEmpty()){R.fail("\u8BF7\u6295\u4FDD\u4EBA\u7B7E\u540D");return}if(h.some(e=>e.isEmpty())){R.fail("\u8BF7\u88AB\u4FDD\u4EBA\u7B7E\u540D");return}if(((i=(l=c.value.tenantOrderHolder)==null?void 0:l.extInfo)==null?void 0:i.isCert)!==o.CERT){R.fail("\u8BF7\u6295\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}if((r=c.value.tenantOrderInsuredList)==null?void 0:r.some(e=>{var s;return((s=e.extInfo)==null?void 0:s.isCert)!==o.CERT})){R.fail("\u8BF7\u88AB\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}ve.confirm({title:"\u63D0\u793A",message:"\u8BF7\u786E\u8BA4\u4FE1\u606F\u586B\u5199\u65E0\u8BEF\u540E\uFF0C\u518D\u8FDB\u884C\u652F\u4ED8"}).then(()=>{var s,a;const e=(s=m.value)==null?void 0:s.save();Promise.all([K("HOLDER",e,(a=c.value)==null?void 0:a.id,`${g}`),...h.map(d=>{var _;return K("INSURED",d.save(),(_=c.value)==null?void 0:_.id,`${g}`)})]).then(()=>{Ne(Q(q({},c.value),{pageCode:"sign",operateOption:{withSignInfo:!0},extInfo:{pageCode:"sign",templateId:ee},venderCode:"ancheng"})).then(d=>{const{code:_,data:y}=d;_==="10000"&&y.success&&Z.push({path:ge[y.pageAction.data.nextPageCode],query:{orderNo:A,saleUserId:U,tenantId:g}})})})})},j=()=>{Oe({orderNo:A,saleUserId:U,tenantId:g}).then(u=>{const{code:n,data:l}=u;n==="10000"&&(c.value=l,setTimeout(()=>{let i=0;l.tenantOrderAttachmentList.forEach(r=>{r.category===21&&(r.objectType===2?(m.value.clear(),m.value.setDataURL(r.fileBase64)):r.objectType===1&&(h[i].clear(),h[i].setDataURL(r.fileBase64),i+=1))})}))})};return fe(()=>{j(),me({orderNo:A,productCode:ue,tenantId:g}).then(n=>{const{code:l,data:i}=n;l==="10000"&&(N.value=i||[])});const u=k.get("verifyData");if(u){const{serialNo:n,certNo:l,name:i}=u;ye({certiNo:l,orderNo:A,serialNo:n,tenantId:g,userName:i}).then(r=>{const{code:e,data:s}=r;e==="10000"&&(k.remove("verifyData"),j())})}}),(u,n)=>{const l=z("van-button"),i=z("ProPageWrap");return f(),De(i,null,{default:D(()=>{var r;return[t("div",Re,[F(pe,{type:"warning",title:"\u5C0A\u656C\u7684\u5BA2\u6237\uFF0C\u672C\u6B21\u6295\u4FDD\u9700\u8981\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",content:"\u672C\u4EA7\u54C1\u6295\u4FDD\u9700\u8981\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u8FDB\u884C\u5B9E\u540D\u8BA4\u8BC1\uFF0C\u60A8\u8D2D\u4E70\u672C\u4EA7\u54C1\u7684\u7D2F\u8BA1\u603B\u4FDD\u8D39\u5DF2\u8D85\u8FC720\u4E07\uFF0C\u6309\u76D1\u7BA1\u8981\u6C42\uFF0C\u9700\u8981\u63D0\u4F9B\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u3001\u6307\u5B9A\u53D7\u76CA\u4EBA\u8BC1\u4EF6\u5F71\u50CF\uFF0C\u672C\u4EA7\u54C1\u975E\u672C\u4EBA\u6295\u4FDD\u4E14\u5E26\u8EAB\u6545\u8D23\u4EFB\u3001\u9700\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\uFF08\u6210\u4EBA\uFF09\u7684\u6295\u4FDD\u610F\u613F\u8FDB\u884C\u7B7E\u5B57\u786E\u8BA4\u3002"}),F(S,{title:"\u6295\u4FDD\u4EBA",class:"card"},{extra:D(()=>{var e,s,a,d,_,y,M,V;return[t("div",Se,[t("div",Te,C((s=(e=c.value)==null?void 0:e.tenantOrderHolder)==null?void 0:s.name),1),t("div",{class:W(["status",{verified:((_=(d=(a=c.value)==null?void 0:a.tenantOrderHolder)==null?void 0:d.extInfo)==null?void 0:_.isCert)===o.CERT}])},C(((V=(M=(y=c.value)==null?void 0:y.tenantOrderHolder)==null?void 0:M.extInfo)==null?void 0:V.isCert)===o.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)])]}),default:D(()=>{var e,s,a,d,_;return[t("div",ke,[be,t("div",xe,C((s=(e=c.value)==null?void 0:e.tenantOrderHolder)==null?void 0:s.certNo),1),((_=(d=(a=c.value)==null?void 0:a.tenantOrderHolder)==null?void 0:d.extInfo)==null?void 0:_.isCert)?O("",!0):(f(),v("div",{key:0,class:"action",onClick:n[0]||(n[0]=y=>H(-1))},[we,F(G,{name:"right_arrow",class:"icon"})]))])]}),_:1}),F(S,{title:"\u6295\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:D(()=>[t("div",{class:"resign",onClick:te},"\u91CD\u7B7E")]),default:D(()=>[F(J,{ref_key:"holderSign",ref:m,class:"sign"},null,512),t("div",Ue,[t("div",Le,"\u7B7E\u540D\u65E5\u671F\uFF1A "+C(I(L)),1),t("div",Pe,[He,(f(!0),v(w,null,x(N.value.filter(e=>e.noticeObject===I(T).HOLDER),(e,s)=>(f(),v("span",{key:s,class:"file-name"},[p(C(`\u300A${e.materialName}\u300B`),1),s!==N.value.filter(a=>a.noticeObject===I(T).HOLDER).length-1?(f(),v("span",je,"\u3001")):O("",!0)]))),128))])])]),_:1}),(f(!0),v(w,null,x((r=c.value)==null?void 0:r.tenantOrderInsuredList,(e,s)=>(f(),v("div",{key:s},[F(S,{title:"\u88AB\u4FDD\u4EBA",class:"card"},{extra:D(()=>{var a,d;return[t("div",Me,[t("div",Ve,C(e.name),1),t("div",{class:W(["status",{verified:((a=e.extInfo)==null?void 0:a.isCert)===o.CERT}])},C(((d=e.extInfo)==null?void 0:d.isCert)===o.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)])]}),default:D(()=>{var a;return[t("div",$e,[Ye,t("div",qe,C(e.certNo),1),((a=e.extInfo)==null?void 0:a.isCert)?O("",!0):(f(),v("div",{key:0,class:"action",onClick:d=>H(s)},[ze,F(G,{name:"right_arrow",class:"icon"})],8,Qe))])]}),_:2},1024),F(S,{title:"\u88AB\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:D(()=>[t("div",{class:"resign",onClick:a=>se(s)},"\u91CD\u7B7E",8,We)]),default:D(()=>[F(J,{ref_for:!0,ref:ae,class:"sign"}),t("div",Ge,[t("div",Je,"\u7B7E\u540D\u65E5\u671F\uFF1A "+C(I(L)),1),t("div",Ke,[Xe,(f(!0),v(w,null,x(N.value.filter(a=>a.noticeObject===I(T).INSURED),(a,d)=>(f(),v("span",{key:d,class:"file-name"},[p(C(`\u300A${a.materialName}\u300B`),1),d!==N.value.filter(_=>_.noticeObject===I(T).INSURED).length-1?(f(),v("span",Ze,"\u3001")):O("",!0)]))),128))])])]),_:2},1024)]))),128)),t("div",eu,[F(l,{type:"primary",class:"submit-btn",onClick:oe},{default:D(()=>[uu]),_:1})])])]}),_:1})}}});var cu=Ae(tu,[["__scopeId","data-v-730704c8"]]);export{cu as default};
