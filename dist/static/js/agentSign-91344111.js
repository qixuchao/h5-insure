import{d as e,h as a,g as i,bx as s,i as t,av as r,o as n,c as o,b as d,a as l,u as c,w as f,a8 as u,aB as g,bN as p,T as m,aa as h,bK as v,am as b}from"./index-a701edf7.js";import{c as j}from"./product-ad97da6e.js";import{g as y,m as S}from"./trial-be4721b4.js";import{_ as I,N as D}from"./notice-85ad535c.js";import{u as E}from"./useOrder-0f74fb68.js";import{M as N}from"./product-585b0e6f.js";import{s as O,a as T}from"./verify-b8d06411.js";import{t as L}from"./index-873f5512.js";import"./PayInfo-01655823.js";import{P as w,a as C}from"./constants-71331306.js";import{a as V}from"./utils-0af605ab.js";import"./useAttachment-35fb6d62.js";import"./utils-e08fe015.js";import"./infoCollection-c01830c2.js";import"./trial-d97dbb4f.js";import"./index-a521a3ec.js";import"./merge-e7788e50.js";import"./keysIn-131bbce9.js";import"./isObjectLike-a9798079.js";import"./_getTag-0507d0b1.js";import"./debounce-6981b306.js";import"./phoneVerify-307a6997.js";import"./index-f8d021e2.js";import"./useDicData-c5252af3.js";import"./bankCard-3afe4cad.js";const A={class:"long-verify"},R={class:"header"},q={class:"verify-content"},x={class:"footer-button"},B=e({__name:"agentSign",setup(e){const B=a(),G=i(),{productCode:k="",tenantId:U,agentCode:_="",agencyCode:H,saleChannelId:M,saleUserId:P,orderNo:z,orderCode:F,extraInfo:$,isShare:J,insurerCode:K,preview:Q}=B.query;let W={};try{W=JSON.parse(decodeURIComponent($))}catch(te){}const X=E(),Y=`${window.origin}/baseInsurance/long/phoneVerify?${s.stringify({...B.query,orderNo:F||z})}`,Z=t(),ee=t({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:""},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{}},agent:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:""}}),ae=t({sign:[],verify:[],scribing:""}),ie=()=>{if(Q)return void g(w.SIGN,B.query);const e=[];Z.value&&ae.value.sign.includes("1")&&e.push(Z.value.validateSign()),Promise.all(e).then((e=>{T({bizObjectId:[],bizObjectType:p.AGENT,orderId:X.value.id,tenantId:U}).then((({code:e,data:a})=>{"10000"===e&&a&&G.push({path:C.sign,query:B.query})}))})).catch((e=>{m(e.message)}))};t();t({imgUrl:"",desc:"",title:"",link:Y});const se=async()=>{let e={};const{code:a,data:i}=await y({orderNo:z,tenantId:U});"10000"===a&&(e=V(i.insuredList[0].productList),i.tenantOrderAttachmentList.forEach((e=>{e.objectType===D.HOlDER?ee.value.holder.signData=e.fileBase64:e.objectType===D.AGENT?ee.value.agent.signData=e.fileBase64:e.objectType===D.INSURED&&(ee.value.insured.signData[e.objectId]=e.fileBase64)}))),j(e).then((({code:e,data:a})=>{var i;if("10000"===e){const{productMaterialMap:e}=(null==(i=a.productMaterialPlanVOList)?void 0:i[0])||{};(Object.values(e||{})||[]).flat().filter((e=>e.materialType===N.SIGN)).forEach((e=>{e.noticeObject===D.AGENT?ee.value.agent.fileList.push(e):e.noticeObject===D.HOlDER?ee.value.holder.fileList.push(e):e.noticeObject===D.INSURED&&ee.value.insured.fileList.push(e)}))}})),S(e).then((({data:e,code:a})=>{if("10000"===a){const{signInfo:a}=L(e.productFactor);a.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((a=>{e.required&&ae.value.sign.push(a.code),"1"===a.code?ee.value.agent.isSign=!0:"2"===a.code?ee.value.holder.isSign=!0:"3"===a.code?ee.value.insured.isSign=!0:"4"===a.code?ee.value.holder.isShareSign=!0:"5"===a.code&&(ee.value.insured.isShareSign=!0)})),"customerFace"===e.name&&e.columns.forEach((a=>{e.required&&ae.value.verify.push(a.code),"1"===a.code?ee.value.holder.isVerify=!0:"2"===a.code&&(ee.value.insured.isVerify=!0)}))}))}})),z&&y({orderNo:F||z,tenantId:U}).then((({code:e,data:a})=>{"10000"===e&&a.tenantOrderAttachmentList.forEach((e=>{e.objectType===D.HOlDER?ee.value.holder.signData=e.fileBase64:e.objectType===D.AGENT?ee.value.agent.signData=e.fileBase64:e.objectType===D.INSURED&&(ee.value.insured.signData[e.objectId]=e.fileBase64)}))}))};return r((()=>{se()})),(e,a)=>{const i=h,s=v,t=b;return n(),o("div",A,[d(i),l("div",R,[d(s,{type:"warning",title:"尊敬的客户，本次投保需要进行身份认证",content:"本产品投保需要对投保人、被保人进行实名认证，您购买本产品的累计总保费已超过20万，按监管要求，需要提供投保人、被保人、指定受益人证件影像，本产品非本人投保且带身故责任、需对投保人、被保人（成人）的投保意愿进行签字确认。"})]),l("div",q,[d(I,{ref_key:"agentSignRef",ref:Z,"order-detail":c(X),"sign-string":c(ee).agent.signData,"show-sign":c(ee).agent.isSign,"show-verify":c(ee).agent.isVerify,"file-list":c(ee).agent.fileList,"personal-info":c(ee).agent.personalInfo,disabled:!!c(J),title:"代理人",onHandleSign:a[0]||(a[0]=e=>((e,a,i)=>{var s;O(e,a,null==(s=X.value)?void 0:s.id,U,i)})("AGENT",e))},null,8,["order-detail","sign-string","show-sign","show-verify","file-list","personal-info","disabled"])]),l("div",x,[d(t,{type:"primary",onClick:ie},{default:f((()=>[u("确定")])),_:1})])])}}});export{B as default};
