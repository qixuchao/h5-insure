import{ref as e,watch as o}from"vue";import{a8 as a,a9 as t,aa as s,ab as n,ac as i,ad as l,ae as r,af as u,ag as c,ah as d,ai as m,aj as v,ak as V,al as p,am as g,an as h,ao as f,ap as w,aq as N,ar as C,as as y,at as x,au as b,av as S,aw as I,ax as P,ay as z,az as T,aA as k,aB as R,aC as $,aD as B,r as E,aE as X}from"./index-deb4ddfb.js";const[Z,Y]=a("image"),D={src:String,alt:String,fit:String,position:String,round:Boolean,block:Boolean,width:i,height:i,radius:i,lazyLoad:Boolean,iconSize:i,showError:l,errorIcon:r("photo-fail"),iconPrefix:String,showLoading:l,loadingIcon:r("photo")};const H=c(Vue.defineComponent({name:Z,props:D,emits:["load","error"],setup(e,{emit:o,slots:a}){const i=Vue.ref(!1),l=Vue.ref(!0),r=Vue.ref(),{$Lazyload:c}=Vue.getCurrentInstance().proxy,d=Vue.computed((()=>{const o={width:t(e.width),height:t(e.height)};return s(e.radius)&&(o.overflow="hidden",o.borderRadius=t(e.radius)),o}));Vue.watch((()=>e.src),(()=>{i.value=!1,l.value=!0}));const m=e=>{l.value=!1,o("load",e)},v=e=>{i.value=!0,l.value=!1,o("error",e)},V=(o,a,t)=>t?t():Vue.createVNode(u,{name:o,size:e.iconSize,class:a,classPrefix:e.iconPrefix},null),p=()=>{if(i.value||!e.src)return;const o={alt:e.alt,class:Y("img"),style:{objectFit:e.fit,objectPosition:e.position}};return e.lazyLoad?Vue.withDirectives(Vue.createVNode("img",Vue.mergeProps({ref:r},o),null),[[Vue.resolveDirective("lazy"),e.src]]):Vue.createVNode("img",Vue.mergeProps({src:e.src,onLoad:m,onError:v},o),null)},g=({el:e})=>{const o=()=>{e===r.value&&l.value&&m()};r.value?o():Vue.nextTick(o)},h=({el:e})=>{e!==r.value||i.value||v()};return c&&n&&(c.$on("loaded",g),c.$on("error",h),Vue.onBeforeUnmount((()=>{c.$off("loaded",g),c.$off("error",h)}))),()=>{var o;return Vue.createVNode("div",{class:Y({round:e.round,block:e.block}),style:d.value},[p(),l.value&&e.showLoading?Vue.createVNode("div",{class:Y("loading")},[V(e.loadingIcon,Y("loading-icon"),a.loading)]):i.value&&e.showError?Vue.createVNode("div",{class:Y("error")},[V(e.errorIcon,Y("error-icon"),a.error)]):void 0,null==(o=a.default)?void 0:o.call(a)])}}})),W=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),L=a("image-preview")[1];var O=Vue.defineComponent({props:{src:String,show:Boolean,active:Number,minZoom:d(i),maxZoom:d(i),rootWidth:d(Number),rootHeight:d(Number)},emits:["scale","close"],setup(e,{emit:o,slots:a}){const t=Vue.reactive({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),s=m(),n=Vue.ref(),i=Vue.computed((()=>{const{rootWidth:o,rootHeight:a}=e,s=a/o;return t.imageRatio>s})),l=Vue.computed((()=>{const{scale:e,moveX:o,moveY:a,moving:s,zooming:n}=t,i={transitionDuration:n||s?"0s":".3s"};if(1!==e){const t=o/e,s=a/e;i.transform=`scale(${e}, ${e}) translate(${t}px, ${s}px)`}return i})),r=Vue.computed((()=>{if(t.imageRatio){const{rootWidth:o,rootHeight:a}=e,s=i.value?a/t.imageRatio:o;return Math.max(0,(t.scale*s-o)/2)}return 0})),u=Vue.computed((()=>{if(t.imageRatio){const{rootWidth:o,rootHeight:a}=e,s=i.value?a:o*t.imageRatio;return Math.max(0,(t.scale*s-a)/2)}return 0})),c=a=>{(a=g(a,+e.minZoom,+e.maxZoom+1))!==t.scale&&(t.scale=a,o("scale",{scale:a,index:e.active}))},d=()=>{c(1),t.moveX=0,t.moveY=0};let f,w,N,C,y,x,b;const S=e=>{const{touches:o}=e,{offsetX:a}=s;s.start(e),f=o.length,w=t.moveX,N=t.moveY,b=Date.now(),t.moving=1===f&&1!==t.scale,t.zooming=2===f&&!a.value,t.zooming&&(C=t.scale,y=W(e.touches))},I=()=>{if(f>1)return;const{offsetX:e,offsetY:a}=s,n=Date.now()-b;e.value<5&&a.value<5&&n<250&&(x?(clearTimeout(x),x=null,(()=>{const e=t.scale>1?1:2;c(e),t.moveX=0,t.moveY=0})()):x=setTimeout((()=>{o("close"),x=null}),250))},P=o=>{let a=!1;(t.moving||t.zooming)&&(a=!0,t.moving&&w===t.moveX&&N===t.moveY&&(a=!1),o.touches.length||(t.zooming&&(t.moveX=g(t.moveX,-r.value,r.value),t.moveY=g(t.moveY,-u.value,u.value),t.zooming=!1),t.moving=!1,w=0,N=0,C=1,t.scale<1&&d(),t.scale>e.maxZoom&&(t.scale=+e.maxZoom))),p(o,a),I(),s.reset()},z=e=>{const{naturalWidth:o,naturalHeight:a}=e.target;t.imageRatio=a/o};return Vue.watch((()=>e.active),d),Vue.watch((()=>e.show),(e=>{e||d()})),v("touchmove",(e=>{const{touches:o}=e;if(s.move(e),(t.moving||t.zooming)&&p(e,!0),t.moving){const{deltaX:e,deltaY:o}=s,a=e.value+w,n=o.value+N;t.moveX=g(a,-r.value,r.value),t.moveY=g(n,-u.value,u.value)}if(t.zooming&&2===o.length){const e=W(o);c(C*e/y)}}),{target:Vue.computed((()=>{var e;return null==(e=n.value)?void 0:e.$el}))}),()=>{const o={loading:()=>Vue.createVNode(h,{type:"spinner"},null)};return Vue.createVNode(V,{ref:n,class:L("swipe-item"),onTouchstartPassive:S,onTouchend:P,onTouchcancel:P},{default:()=>[a.image?Vue.createVNode("div",{class:L("image-wrap")},[a.image({src:e.src})]):Vue.createVNode(H,{src:e.src,fit:"contain",class:L("image",{vertical:i.value}),style:l.value,onLoad:z},o)]})}}});const[_,j]=a("image-preview"),F=["show","transition","overlayStyle","closeOnPopstate"],U={show:Boolean,loop:l,images:x(),minZoom:b(1/3),maxZoom:b(3),overlay:l,closeable:Boolean,showIndex:l,className:S,closeIcon:r("clear"),transition:String,beforeClose:Function,overlayClass:S,overlayStyle:Object,swipeDuration:b(300),startPosition:b(0),showIndicators:Boolean,closeOnPopstate:l,closeIconPosition:r("top-right")};var M=Vue.defineComponent({name:_,props:U,emits:["scale","close","closed","change","update:show"],setup(e,{emit:o,slots:a}){const t=Vue.ref(),s=Vue.reactive({active:0,rootWidth:0,rootHeight:0}),n=()=>{if(t.value){const e=I(t.value.$el);s.rootWidth=e.width,s.rootHeight=e.height,t.value.resize()}},i=e=>o("scale",e),l=e=>o("update:show",e),r=()=>{T(e.beforeClose,{args:[s.active],done:()=>l(!1)})},c=e=>{e!==s.active&&(s.active=e,o("change",e))},d=()=>{if(e.showIndex)return Vue.createVNode("div",{class:j("index")},[a.index?a.index({index:s.active}):`${s.active+1} / ${e.images.length}`])},m=()=>{if(a.cover)return Vue.createVNode("div",{class:j("cover")},[a.cover()])},v=()=>{if(e.closeable)return Vue.createVNode(u,{role:"button",name:e.closeIcon,class:[j("close-icon",e.closeIconPosition),z],onClick:r},null)},V=()=>o("closed"),p=(e,o)=>{var a;return null==(a=t.value)?void 0:a.swipeTo(e,o)};return f({swipeTo:p}),Vue.onMounted(n),Vue.watch([w,N],n),Vue.watch((()=>e.startPosition),(e=>c(+e))),Vue.watch((()=>e.show),(a=>{const{images:t,startPosition:i}=e;a?(c(+i),Vue.nextTick((()=>{n(),p(+i,{immediate:!0})}))):o("close",{index:s.active,url:t[s.active]})})),()=>Vue.createVNode(C,Vue.mergeProps({class:[j(),e.className],overlayClass:[j("overlay"),e.overlayClass],onClosed:V,"onUpdate:show":l},y(e,F)),{default:()=>[v(),Vue.createVNode(P,{ref:t,lazyRender:!0,loop:e.loop,class:j("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:c},{default:()=>[e.images.map((o=>Vue.createVNode(O,{src:o,show:e.show,active:s.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:s.rootWidth,rootHeight:s.rootHeight,onScale:i,onClose:r},{image:a.image})))]}),d(),m()]})}});let A;const q={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};const G=(e,o=0)=>{if(n)return A||({instance:A}=R({setup(){const{state:e,toggle:o}=$(),a=()=>{e.images=[]};return()=>Vue.createVNode(M,Vue.mergeProps(e,{onClosed:a,"onUpdate:show":o}),null)}})),e=Array.isArray(e)?{images:e,startPosition:o}:e,A.open(k({},q,e)),A};G.Component=c(M),G.install=e=>{e.use(G.Component)};const J={class:"sign-wrap"},K=["src"],Q={class:"popup-body"},ee={class:"sign-container-wrap"},oe={class:"operate-bar"},ae={class:"btns"},te=Vue.defineComponent({name:"sign"}),se=Vue.defineComponent({...te,props:{option:{default:{}},modelValue:{default:""}},emits:["update:modelValue","submitSign"],setup(a,{expose:t,emit:s}){const n=a,i=e(!1),l=e(),r=e(""),u=e(!0),c=()=>{var e;i.value=!0,null==(e=l.value)||e.clear(),setTimeout((()=>{var e;null==(e=l.value)||e.setDataURL(r.value),n.modelValue?u.value=!1:u.value=!0}))},d=()=>{G({images:[r.value],className:"customer-sign-preview"})},m=()=>{i.value=!1},v=()=>{var e,o;null==(o=null==(e=l.value)?void 0:e.clear)||o.call(e),r.value="",u.value=!0,s("update:modelValue","")},V=()=>{var e;r.value=null==(e=l.value)?void 0:e.save(),s("update:modelValue",r.value),s("submitSign",r.value),i.value=!1};return o((()=>n.modelValue),(()=>{r.value=n.modelValue}),{immediate:!0}),t({rewrite:v,openSign:c}),(e,o)=>{const a=Vue.resolveComponent("van-button"),t=Vue.resolveComponent("van-icon"),s=Vue.resolveComponent("van-popup");return Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,[Vue.createElementVNode("div",J,[Vue.renderSlot(e.$slots,"signImg",{data:Vue.unref(r)},(()=>[Vue.unref(r)?(Vue.openBlock(),Vue.createElementBlock("img",{key:0,class:"preview-sign",src:Vue.unref(r),alt:"",onClick:d},null,8,K)):Vue.createCommentVNode("",!0),Vue.createVNode(a,{type:"primary",round:"",size:"small",onClick:c},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(r)?"重新签名":"点击签字"),1)])),_:1})]))]),Vue.createVNode(s,{show:Vue.unref(i),"onUpdate:show":o[1]||(o[1]=e=>Vue.isRef(i)?i.value=e:null),position:"bottom",style:{height:"100%",overflow:"hidden"}},{default:Vue.withCtx((()=>[Vue.createElementVNode("div",Q,[Vue.createElementVNode("div",ee,[Vue.createVNode(B,{ref_key:"signRef",ref:l,placeholder:"请在此处签名",onStroke:o[0]||(o[0]=e=>u.value=!1)},null,512),Vue.createElementVNode("div",oe,[Vue.createElementVNode("span",null,[Vue.createVNode(t,{name:"info",color:"#ffaf22"}),Vue.createTextVNode(" 请投保人正楷签署您的签名:")]),Vue.createElementVNode("div",ae,[Vue.createVNode(a,{type:"default",class:"btn",onClick:m},{default:Vue.withCtx((()=>[Vue.createTextVNode("返回")])),_:1}),Vue.createVNode(a,{type:"default",class:"btn",onClick:v},{default:Vue.withCtx((()=>[Vue.createTextVNode("重写")])),_:1}),Vue.createVNode(a,{type:"primary",class:"btn",disabled:Vue.unref(u),onClick:V},{default:Vue.withCtx((()=>[Vue.createTextVNode("确定签字")])),_:1},8,["disabled"])])])])])])),_:1},8,["show"])],64)}}}),ne=e=>E({url:"/api/app/insure/insurance/customerFace",method:"POST",data:e}),ie=e=>E({url:"/api/app/insure/insurance/saveCustomerFaceResult",method:"POST",data:e}),le=(e,o,a,t,s)=>{const n={bizObjectType:e,bizObjectId:s,docCategory:"ELECTRIC_SIGN",docType:"png",fileBase64:o,docName:`${X[e]}电子签名`,orderId:a,tenantId:t};return E({url:"/api/app/insure/insurance/saveCustomerSignResult",method:"POST",data:n})};export{se as _,ne as a,ie as f,le as s};
