import{k as e,r as t,$ as a,p as n,s as r,t as i,v as o,C as d,S as l,B as s,I as u,M as c,H as f,G as v,aa as m,u as p,R as I,O,b as y,m as L,E as C,y as b,d as h,T as g}from"./vendor-e12fffd5.js";import{_ as x,m as E,h as P,g as R,A as T,t as V,N as k,n as A,b as H}from"./index-cd45743c.js";import{p as _}from"./trial-ae0290d2.js";import{P as N,I as B,R as j}from"./trial-c4f9cc97.js";import{u as D}from"./useDicData-bfb413b2.js";import{R as S,a as w,B as U,b as F}from"./infoCollection-0aec72cf.js";import{_ as Y}from"./index-799d8a43.js";import"./relativeTime-2dd52670.js";const M={class:"com-select-container"},$={class:"radio-item-wrapper"},q={class:"name"},G={class:"hone"},K={class:"address"},W={class:"footer-button"},z=v("取消"),J=v("确认");var Q=x(e({props:{dataSource:{type:Array,default:()=>[]},show:{type:Boolean,default:!1},modelValue:{type:[String,Number],default:null}},emits:["update","update:modelValue","submit","close"],setup(e,{emit:v}){const m=e,p=t(m.modelValue),I=t(m.show),O=()=>{v("submit",p.value),I.value=!1},y=()=>{v("close")};return a((()=>m.modelValue),(e=>{p.value=e})),a((()=>p.value),(e=>{v("update:modelValue",e)})),(t,a)=>{const v=n("van-radio"),m=n("van-radio-group"),L=n("VanButton");return r(),i(E,{show:I.value,"onUpdate:show":a[1]||(a[1]=e=>I.value=e),class:"com-select",title:"选择保单通讯信息",onClose:y},{default:o((()=>[d("div",M,[l(m,{modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=e=>p.value=e)},{default:o((()=>[(r(!0),s(f,null,u(e.dataSource,((e,t)=>(r(),i(v,{key:t,name:t+1,class:"radio-item"},{default:o((()=>[d("div",$,[d("p",null,[d("span",q,c(e.contactName),1),d("span",G,c(e.contactPhoneNo),1)]),d("p",K,c(e.contactAddress),1)])])),_:2},1032,["name"])))),128))])),_:1},8,["modelValue"])]),d("div",W,[l(L,{plain:"",type:"primary"},{default:o((()=>[z])),_:1}),l(L,{type:"primary",onClick:O},{default:o((()=>[J])),_:1})])])),_:1},8,["show"])}}}),[["__scopeId","data-v-a821acd4"]]);const X={key:0,class:"beneficiary-part"},Z={class:"part-title"},ee={class:"title"},te=v("删除"),ae=v("+添加受益人"),ne=v("选择保单通讯信息"),re={class:"radio-item-wrapper"},ie={class:"name"},oe={class:"hone"},de={class:"address"},le={class:"footer-button","safe-area-inset-bottom":""},se={class:"left"},ue={class:"trial-result"},ce=v(" 首期"),fe={class:"result-num"},ve=d("div",{class:"result-desc"},"实际保费以后续为准",-1),me={class:"operate-btn"},pe=v("下一步"),Ie=e({setup(e){const v=m(),x=p(),{templateId:E=1,orderNo:M="2022072710380711215",productCode:$,tenantId:q="9991000007",proposalId:G,insurerCode:K="kunlunhealth"}=x.query,[W,z]=I(),J="/infoPreview"===x.path?"infoPreview":"infoCollection",Ie=D("NATIONAL_REGION_CODE"),Oe=t({}),ye=t({extInfo:{pageCode:J},tenantOrderHolder:{extInfo:{occupationCodeList:[]},holderType:1},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},insuredBeneficiaryType:"1",tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}]}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}}),Le=t(null),Ce=t([]),be=t([]),he=t([]),ge=t([]),xe=t([]),Ee=O({beneficiaryId:0,nextPage:"",currentAddress:null,isLoading:!0}),Pe=y((()=>{var e,t,a,n,r,i,o,d,l,s;return[{contactAddress:null==(t=null==(e=ye.value.tenantOrderHolder)?void 0:e.extInfo)?void 0:t.familyAddress,contactName:ye.value.tenantOrderHolder.name,contactPhoneNo:ye.value.tenantOrderHolder.mobile},{contactAddress:null==(n=null==(a=ye.value.tenantOrderHolder)?void 0:a.extInfo)?void 0:n.workAddress,contactName:ye.value.tenantOrderHolder.name,contactPhoneNo:ye.value.tenantOrderHolder.mobile},{contactAddress:null==(i=null==(r=ye.value.tenantOrderInsuredList[0])?void 0:r.extInfo)?void 0:i.familyAddress,contactName:null==(o=ye.value.tenantOrderInsuredList[0])?void 0:o.name,contactPhoneNo:null==(d=ye.value.tenantOrderInsuredList[0])?void 0:d.mobile},{contactAddress:null==(s=null==(l=ye.value.tenantOrderInsuredList[0])?void 0:l.extInfo)?void 0:s.workAddress,contactName:ye.value.tenantOrderInsuredList[0].name,contactPhoneNo:ye.value.tenantOrderInsuredList[0].mobile}].filter((e=>e.contactAddress&&e.contactName&&e.contactPhoneNo))||[]})),Re=y((()=>{var e,t;return Ee.currentAddress?Pe.value[Ee.currentAddress-1]||{}:(null==(t=null==(e=ye.value.extInfo)?void 0:e.contactInfo)?void 0:t[0])||{}})),Te=e=>{const t={};return e.map((e=>{const{initialAmount:a,annuityDrawFrequency:n,annuityDrawType:r,paymentFrequency:i,paymentPeriod:o,paymentPeriodType:d,insurancePeriodType:l,insurancePeriodValue:s,riskCode:u,riskType:c,initialPremium:f,liabilityDetails:v,extInfo:m}=e,{riskId:p,copy:I}=m,O={amount:a,annuityDrawDate:n,annuityDrawType:r,paymentFrequency:i,riskId:p,copy:I,chargePeriod:o?`${N[d]}_${o}`:N[d],coveragePeriod:s?`${B[l]}_${s}`:B[l],riskCode:u,riskType:c,premium:f,liabilityVOList:v.map((e=>({...e,liabilityAttributeValue:e.refundMethod,liabilityAttributeCode:e.refundMethod&&1})))};return c===j.MAIN_RISK?(t.mainRiskCode=u,t.mainRiskId=p):Object.assign(O,t),O}))},Ve=()=>{var e;null==(e=Le.value)||e.validate().then((()=>{const{birthday:e,gender:t,extInfo:a}=ye.value.tenantOrderHolder,{hasSocialInsurance:n,occupationCodeList:r}=a,{birthday:i,gender:o,extInfo:d,tenantOrderProductList:l}=ye.value.tenantOrderInsuredList[0],{hasSocialInsurance:s,occupationCodeList:u}=d,c={holder:{personVO:{birthday:h(e).format("YYYY-MM-DD"),gender:t,socialFlag:n,occupationCodeList:r}},productCode:$,insuredVOList:[{insurerCode:K,personVO:{birthday:h(i).format("YYYY-MM-DD"),gender:o,socialFlag:s,occupationCodeList:u},productPlanVOList:[{insurerCode:K,planCode:"",riskVOList:Te(l[0].tenantOrderRiskList)}]}]};_({...c}).then((({code:e,data:t})=>{if("10000"===e){const e={},a=(t=[])=>{(t||[]).forEach((t=>{var n;e[t.riskCode]=t,(null==(n=t.riskPremiumDetailVOList)?void 0:n.length)&&a(t.riskPremiumDetailVOList)}))};a(t.riskPremiumDetailVOList),ye.value.tenantOrderInsuredList[0].tenantOrderProductList[0]={...ye.value.tenantOrderInsuredList[0].tenantOrderProductList[0],premium:t.premium,tenantOrderRiskList:ye.value.tenantOrderInsuredList[0].tenantOrderProductList[0].tenantOrderRiskList.map((t=>({...t,initialAmount:e[t.riskCode].amount,initialPremium:e[t.riskCode].premium})))},(()=>{var e;const t={...ye.value};t.extInfo={...t.extInfo,contactInfo:[Re.value],buttonCode:k.infoCollection},t.tenantOrderAttachmentList=[{category:T.OBVERSE_CERT,objectType:V.HOLDER,objectId:ye.value.tenantOrderHolder.id,name:"投保人证件正面",uri:Ce.value[0],id:he.value[0]},{category:T.REVERSE_CERT,objectType:V.HOLDER,objectId:ye.value.tenantOrderHolder.id,name:"投保人证件背面",uri:Ce.value[1],id:he.value[1]},{category:T.OBVERSE_CERT,objectType:V.INSURED,objectId:ye.value.tenantOrderInsuredList[0].id,name:"被保人证件正面",uri:be.value[0]||Ce.value[0],id:ge.value[1]},{category:T.REVERSE_CERT,objectType:V.INSURED,objectId:ye.value.tenantOrderInsuredList[0].id,name:"被保人证件背面",uri:be.value[1]||Ce.value[1],id:ge.value[1]}].filter((e=>e.uri)),null==(e=Le.value)||e.validate().then((e=>{if(t.tenantOrderInsuredList[0].insuredBeneficiaryType===F.SPECIFY){const e={};if(t.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.forEach((t=>{e[t.benefitOrder]?e[t.benefitOrder].sum+=Number(t.benefitRate):e[t.benefitOrder]={sum:Number(t.benefitRate)}})),Object.values(e).some((e=>100!==e.sum)))return void g.fail("同一顺位的受益人比例之和必须为100")}A(t).then((({code:e,data:t})=>{"10000"===e&&"jumpToPage"===t.pageAction.pageAction&&v.push({path:H[t.pageAction.data.nextPageCode],query:x.query})}))}))})()}}))}))},ke=e=>{},Ae=()=>{Ee.beneficiaryId+=1,ye.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.push({id:Ee.beneficiaryId,extInfo:{}})};return L((()=>{R({orderNo:M,tenantId:q}).then((({code:e,data:t})=>{var a,n;if("10000"===e){const e=t;e.extInfo={...e.extInfo,pageCode:J,templateId:E},e.tenantOrderHolder=e.tenantOrderHolder||{holderType:1},e.tenantOrderHolder.extInfo={...e.tenantOrderHolder.extInfo,occupationCodeList:(null==(a=e.tenantOrderHolder.extInfo)?void 0:a.occupationCodeList)||[]},e.tenantOrderInsuredList[0].extInfo={...e.tenantOrderInsuredList[0].extInfo,occupationCodeList:(null==(n=e.tenantOrderInsuredList[0].extInfo)?void 0:n.occupationCodeList)||[]},e.tenantOrderInsuredList[0].tenantOrderBeneficiaryList=e.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.map((e=>{var t;const a=e;return a.extInfo={...a.extInfo,occupationCodeList:(null==(t=a.extInfo)?void 0:t.occupationCodeList)||[]},a})),e.tenantOrderAttachmentList.forEach((e=>{e.category===T.OBVERSE_CERT?e.objectType===V.HOLDER?(Ce.value[0]=e.uri,he.value[0]=e.id):e.objectType===V.INSURED&&(be.value[0]=e.uri,ge.value[0]=e.id):e.category===T.REVERSE_CERT&&(e.objectType===V.HOLDER?(Ce.value[1]=e.uri,he.value[1]=e.id):e.objectType===V.INSURED&&(be.value[1]=e.uri,he.value[1]=e.id))})),Object.assign(ye.value,e)}})).finally((()=>{Ee.isLoading=!1})),P({pageCode:"infoCollection",templateId:E}).then((({code:e,data:t})=>{if("10000"===e){const e={BENEFICIARY:[],INSURER:[],HOLDER:[]};t.productInsureFactorList.forEach((t=>{(e[t.moduleType]=e[t.moduleType]||[]).push(t)})),Oe.value=e}}))})),a([()=>ye.value.tenantOrderInsuredList[0].relationToHolder,()=>ye.value.tenantOrderHolder],(()=>{`${ye.value.tenantOrderInsuredList[0].relationToHolder}`===S.SELF&&Object.assign(ye.value.tenantOrderInsuredList[0],ye.value.tenantOrderHolder,{id:ye.value.tenantOrderInsuredList[0].id,extInfo:{...ye.value.tenantOrderHolder.extInfo,insureProvinceCode:ye.value.tenantOrderInsuredList[0].extInfo.insureProvinceCode,insureCityCode:ye.value.tenantOrderInsuredList[0].extInfo.insureCityCode,insureAreaCode:ye.value.tenantOrderInsuredList[0].extInfo.insureAreaCode}})}),{deep:!0,immediate:!0}),(e,t)=>{const a=n("ProCard"),v=n("ProRadioButton"),m=n("ProField"),p=n("ProCascader"),I=n("ProSvg"),O=n("VanButton"),y=n("ProCheckButton"),L=n("van-cell"),h=n("ProForm"),g=n("ProPageWrap");return r(),i(g,{class:"page-info-wrapper"},{default:o((()=>{var e,n,g,x,E;return[C(Ee).isLoading?b("",!0):(r(),i(h,{key:0,ref_key:"formRef",ref:Le},{default:o((()=>[l(a,{title:"投保人"},{default:o((()=>[l(Y,{images:Ce.value,"onUpdate:images":t[0]||(t[0]=e=>Ce.value=e),"form-info":ye.value.tenantOrderHolder,"factor-list":Oe.value.HOLDER,prefix:"holder"},null,8,["images","form-info","factor-list"])])),_:1}),l(a,{title:"被保人"},{default:o((()=>[l(m,{modelValue:ye.value.tenantOrderInsuredList[0].relationToHolder,"onUpdate:modelValue":t[2]||(t[2]=e=>ye.value.tenantOrderInsuredList[0].relationToHolder=e),label:"为谁保单",name:"relationToHolder",placeholder:"请选择"},{input:o((()=>[l(v,{modelValue:ye.value.tenantOrderInsuredList[0].relationToHolder,"onUpdate:modelValue":t[1]||(t[1]=e=>ye.value.tenantOrderInsuredList[0].relationToHolder=e),options:C(w)},null,8,["modelValue","options"])])),_:1},8,["modelValue"]),1!=+ye.value.tenantOrderInsuredList[0].relationToHolder?(r(),i(Y,{key:0,images:be.value,"onUpdate:images":t[3]||(t[3]=e=>be.value=e),"form-info":ye.value.tenantOrderInsuredList[0],"factor-list":Oe.value.INSURER||[],prefix:"insure"},null,8,["images","form-info","factor-list"])):b("",!0),l(p,{modelValue:ye.value.tenantOrderInsuredList[0].extInfo.insureAreaCode,"onUpdate:modelValue":t[4]||(t[4]=e=>ye.value.tenantOrderInsuredList[0].extInfo.insureAreaCode=e),field1:ye.value.tenantOrderInsuredList[0].extInfo.insureProvinceCode,"onUpdate:field1":t[5]||(t[5]=e=>ye.value.tenantOrderInsuredList[0].extInfo.insureProvinceCode=e),field2:ye.value.tenantOrderInsuredList[0].extInfo.insureCityCode,"onUpdate:field2":t[6]||(t[6]=e=>ye.value.tenantOrderInsuredList[0].extInfo.insureCityCode=e),field3:ye.value.tenantOrderInsuredList[0].extInfo.insureAreaCode,"onUpdate:field3":t[7]||(t[7]=e=>ye.value.tenantOrderInsuredList[0].extInfo.insureAreaCode=e),label:"投保地区",name:"insureAreaCode",placeholder:"请选择","is-link":"",required:"","data-source":C(Ie),mapping:{label:"name",value:"code",children:"children"}},null,8,["modelValue","field1","field2","field3","data-source"])])),_:1}),l(a,{title:"受益人"},{default:o((()=>[l(m,{modelValue:ye.value.tenantOrderInsuredList[0].insuredBeneficiaryType,"onUpdate:modelValue":t[9]||(t[9]=e=>ye.value.tenantOrderInsuredList[0].insuredBeneficiaryType=e),label:"受益人类型",name:"insuredBeneficiaryType",placeholder:"请选择"},{input:o((()=>[l(v,{modelValue:ye.value.tenantOrderInsuredList[0].insuredBeneficiaryType,"onUpdate:modelValue":t[8]||(t[8]=e=>ye.value.tenantOrderInsuredList[0].insuredBeneficiaryType=e),options:C(U)},null,8,["modelValue","options"])])),_:1},8,["modelValue"]),2==ye.value.tenantOrderInsuredList[0].insuredBeneficiaryType?(r(),s("div",X,[(r(!0),s(f,null,u(ye.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList,((e,a)=>(r(),s("div",{key:e.beneficiaryId||e.id,class:"beneficiary-item"},[d("div",Z,[d("span",ee,c(`受益人${a+1}`),1),l(I,{name:"delete",onClick:t=>{return a=e,void(ye.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList=ye.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.filter((e=>e.beneficiaryId!==a.beneficiaryId||a.id!==e.id)));var a}},{default:o((()=>[te])),_:2},1032,["onClick"])]),l(Y,{images:xe.value,"onUpdate:images":t[10]||(t[10]=e=>xe.value=e),"form-info":e,"factor-list":Oe.value.BENEFICIARY||[],prefix:`beneficiary-${a}`,"beneficiary-list":ye.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList},null,8,["images","form-info","factor-list","prefix","beneficiary-list"])])))),128)),l(O,{onClick:Ae},{default:o((()=>[ae])),_:1})])):b("",!0)])),_:1}),l(a,{title:"保单通讯信息"},{default:o((()=>{var e;return[(null==(e=Object.keys(C(Re)))?void 0:e.length)?(r(),i(L,{key:1,title:"单元格","is-link":"",onClick:t[12]||(t[12]=e=>C(z)(!0))},{title:o((()=>[d("div",re,[d("p",null,[d("span",ie,c(C(Re).contactName),1),d("span",oe,c(C(Re).contactPhoneNo),1)]),d("p",de,c(C(Re).contactAddress),1)])])),_:1})):(r(),i(y,{key:0,activated:"",onClick:t[11]||(t[11]=e=>C(z)(!0))},{default:o((()=>[ne])),_:1}))]})),_:1})])),_:1},512)),d("div",le,[d("div",se,[d("div",ue,[ce,d("span",fe,"￥"+c(null==(E=null==(x=null==(g=null==(n=null==(e=ye.value.tenantOrderInsuredList)?void 0:e[0])?void 0:n.tenantOrderProductList)?void 0:g[0].premium)?void 0:x.toLocaleString)?void 0:E.call(x)),1)]),ve]),d("div",me,[l(O,{block:"",type:"primary",onClick:Ve},{default:o((()=>[pe])),_:1})])]),C(W)?(r(),i(Q,{key:1,modelValue:C(Ee).currentAddress,"onUpdate:modelValue":t[13]||(t[13]=e=>C(Ee).currentAddress=e),show:C(W),"data-source":C(Pe),onSubmit:ke,onClose:t[14]||(t[14]=e=>C(z)(!1))},null,8,["modelValue","show","data-source"])):b("",!0)]})),_:1})}}});export{Ie as default};
