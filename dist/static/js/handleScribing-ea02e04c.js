import{d as e,i as a,j as l,o as t,c as s,a as n,F as i,n as r,p as c,e as o,b as u,w as d,u as p,l as v,a0 as m,a8 as g,T as f,cf as h,c5 as b,cg as x,ch as y,an as k,g as w,h as _}from"./index-27d17939.js";import{S as C}from"./index-15e5c2fc.js";import{s as S}from"./scribing-81a2b9a0.js";const A={class:"com-handle-scribing"},V={class:"sign-container-wrap"},j={class:"scribing-text"},N={class:"sign-wrap"},T={class:"sign-list"},q={class:"operate-bar"},E={class:"btns"},P=e({name:"handleScribing"}),I=e({...P,props:{text:{default:""},modelValue:{default:()=>[]},signAccount:{default:2}},emits:["onSubmit","onCancel"],setup(e,{emit:w}){const _=e,S=a(0),P=a(),I=l((()=>{if(_.text&&_.text.length>=_.signAccount){const e=[];let a=0;for(let l=0;l<=_.text.length;l++)!l||l%_.signAccount||(a+=1),_.text[l]&&(e[a]?e[a]+=_.text[l]:e[a]=_.text[l]);return e}return[""]})),O=a([]);a("");const R=()=>{if(S.value===I.value.length-1)return;S.value,_.signAccount;I.value[S.value].length;let e="";I.value.forEach(((a,l)=>{l===S.value&&a.split("").forEach(((a,t)=>{O.value[l+t+l]||(e="请抄录当前页面文字")}))})),e?f({message:e,className:"toast-vertical"}):P.value&&(S.value+=1,P.value.swipeTo(S.value))},U=()=>{0!==S.value&&P.value&&(S.value-=1,P.value.swipeTo(S.value))},$=()=>{w("onCancel")},F=()=>{var e;if((null==(e=O.value)?void 0:e.length)!==_.text.length)return void f({message:"请完成抄录",className:"toast-vertical"});const a=[];O.value.forEach((async(e,l)=>{a.push(h(e,270))})),Promise.all(a).then((e=>{const a=e.map(((e,a)=>({position:a+1,content:_.text[a],image:e})));console.log("params",a),w("onSubmit",a)}))};return(a,l)=>{const f=b,h=x,w=y,_=k,L=C;return t(),s("div",A,[n("div",V,[n("p",j,[(t(!0),s(i,null,r(e.text,((a,l)=>(t(),s("span",{key:l,class:c(`text-item ${S.value*e.signAccount>l?"activity":""} `)},o(a),3)))),128))]),n("div",N,[u(w,{ref_key:"swipeRef",ref:P,loop:!1,"initial-swipe":0,"show-indicators":!1,vertical:"",touchable:!1},{default:d((()=>[(t(!0),s(i,null,r(p(I),((e,l)=>(t(),v(h,{key:l},{default:d((()=>[n("div",T,[(t(!0),s(i,null,r(e,((e,n)=>(t(),s("div",{key:n+l+l,class:"sign-item"},[(t(),v(f,m({ref_for:!0,ref:"signRef",key:l+l+n,modelValue:O.value[l+l+n],"onUpdate:modelValue":e=>O.value[l+l+n]=e,placeholder:e},a.$attrs),null,16,["modelValue","onUpdate:modelValue","placeholder"]))])))),128))])])),_:2},1024)))),128))])),_:1},512)]),n("div",q,[n("div",E,[u(L,null,{default:d((()=>[u(_,{plain:"",hairline:"",type:"primary",disabled:0===S.value,class:"btn",onClick:U},{default:d((()=>[g("上一页")])),_:1},8,["disabled"]),u(_,{plain:"",hairline:"",type:"primary",disabled:S.value===p(I).length-1,class:"btn",onClick:R},{default:d((()=>[g("下一页")])),_:1},8,["disabled"]),u(_,{plain:"",hairline:"",type:"primary",class:"btn",onClick:$},{default:d((()=>[g("取消")])),_:1}),u(_,{type:"primary",class:"btn",onClick:F},{default:d((()=>[g("保存")])),_:1})])),_:1})])])])])}}}),O={class:"handle-scribing-wrap"},R=e({name:"handleScribingPage"}),U=e({...R,setup(e){const a=w(),l=_(),{orderNo:n,text:i,tenantId:r}=l.query,c=()=>{a.back()},o=e=>{S({orderNo:n,tenantId:r,riskTranscriptionList:e}).then((({code:e,data:t})=>{"10000"===e&&a.replace({path:"scribingPreview",query:l.query})}))};return(e,a)=>(t(),s("div",O,[u(I,{text:p(i),closeable:"","has-bg":"",onOnCancel:c,onOnSubmit:o},null,8,["text"])]))}});export{U as default};
