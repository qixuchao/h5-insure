import{k as e,ax as t,r,O as a,$ as o,s as n,B as i,C as l,E as s,S as d,Z as c,a5 as u,a6 as p,m as f,aa as m,u as A,o as h,ay as v,p as w,t as I,v as y,y as O,I as C,H as P,T as b}from"./vendor-9bab628e.js";import{_ as g,a8 as x,a9 as F}from"./index-e8321a04.js";import{P as j}from"./index-c9ce648b.js";import{B as V,A as k,_ as D,P as T}from"./index-ca306fad.js";import{_ as N,n as H}from"./nextStep-5ffe675b.js";import{a as E,s as L,c as B}from"./phoneVerify-5acdb728.js";import{q as U,p as _,g as R}from"./product-32b413c6.js";import{i as S,t as Z}from"./trial-7b87e75c.js";import{j as z}from"./trial-7d56ee72.js";import{v as M,f as G}from"./utils-d1f1072f.js";import{u as J}from"./theme-467ed2f7.js";import"./infoCollection-0441555b.js";import"./relativeTime-043d4e7b.js";import"./useDicData-56383341.js";import"./useStorage-1238b604.js";var Q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFYAAAAeCAMAAACBgxnEAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAA8UExURUdwTPpkAPpkAPpkAPlkAPlkAP9fAPpkAP9jAPljAPljAPlkAPdhAP9VAPhlAPpjAPpiAPpkAPlhAPpkAKrbDd8AAAATdFJOUwCe3XX6YBgzC+yKwSIDTrE+0C9Hm6hZAAAAf0lEQVR42u2MSw6AIAxEi6CCf+j976ommvG3omxMOqv2vczQmZa3tPRMptdZndVZndXZf892/JGOxN68qUEr24/zk84jSvne93fae3Qk3scrjZeWzDcVaNUQIvRDOGkYQOU+hYMmsBJ+cTt1C0gZP7mNTvhL+Zq5xlfOW4tb6le9ZDBDk4RvXwAAAABJRU5ErkJggg==";const q={class:"free-crad"},X={class:"container"},$={class:"title"},K=["src"],Y=(e=>(u("data-v-a8331544"),e=e(),p(),e))((()=>l("span",null,"最后一步 填写信息",-1))),W=["src"];var ee=g(e({props:{colors:{type:Array,default:()=>["#CDDFFE","#F1F7FE"]},detail:{type:Object,default:()=>{}},isFirst:{type:Boolean,default:!0},insureDetail:{type:Object,default:()=>{}}},setup(e,{expose:u}){const p=e;t((e=>({"2689eaee":p.colors[0],"2689eab0":p.colors[1]})));const f=r(),m=a({factorObj:{1:[{attributeValues:null,code:"mobile",datasource:null,defaultValue:null,displayType:null,factorId:null,factorScript:null,hasDefaultValue:1,id:8249,isDisplay:1,isHidden:1,isMustInput:2,isReadOnly:null,moduleType:1,placeholder:null,planCode:null,position:null,productCode:"lin23323",productId:null,title:"手机号"},{attributeValues:null,code:"verificationCode",datasource:null,defaultValue:null,displayType:null,factorId:null,factorScript:null,hasDefaultValue:1,id:8249,isDisplay:1,isHidden:1,isMustInput:2,isReadOnly:null,moduleType:1,placeholder:null,planCode:null,position:null,productCode:"lin23323",productId:null,title:"验证码"}],2:[],3:[]},isFirst:!0}),A=async(e,t)=>{const r=p.isFirst?E:L,a=await r(e),{code:o,data:n}=a;"10000"===o&&(null==t||t())};return o((()=>p.isFirst),(()=>{var e;p.isFirst||(m.factorObj=null==(e=p.insureDetail)?void 0:e.productFactor)})),u({validateForm:()=>new Promise(((e,t)=>{f.value.validateForm().then((t=>{e(!0)})).catch((()=>{t()}))}))}),(t,r)=>(n(),i("div",q,[l("div",X,[l("div",$,[l("img",{src:s(Q)},null,8,K),Y,l("img",{src:s(Q)},null,8,W)]),d(N,{ref_key:"formRef",ref:f,"send-sms-code":A,"form-info":e.detail,"factor-object":s(m).factorObj},null,8,["form-info","factor-object"]),c(t.$slots,"default",{},void 0,!0)])]))}}),[["__scopeId","data-v-a8331544"]]);const te=(e,t,r)=>{f((()=>{(async()=>{try{const{code:r,data:a}=await U(e);if("10000"===r){const e={};a.forEach((t=>{e[t.relationCode]||(e[t.relationCode]=[]),e[t.relationCode].push(t)})),null==t||t(e)}}catch(a){null==r||r(!1)}})()}))};const re={class:"page-free-product-detail"},ae={class:"product-desc"},oe={key:0,class:"page-free-footer"};var ne=g(e({setup(e){t((e=>({"7d17c51f":s(Y).colors[1]})));const c=J(),u=m(),p=A(),{productCode:f="",tenantId:g="",extraInfo:N}=p.query;let E={};try{E=JSON.parse(decodeURIComponent(N))}catch(ce){}const{openId:L,indirectCode:U="123",saleUserId:Q="",saleChannelId:q=""}=E;let X="";const $=r(),K=r(),Y=a({colors:["#fff"],detail:{},order:{tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},insuredBeneficiaryType:"1",tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}]}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}},relationList:{},banner:"",productDesc:[],newAuth:!0,isValidateCode:!1,insureDetail:{},loading:!0,showBtn:!1,activeIndex:0,showFilePreview:!1,isOnlyView:!0}),W=r();te({openId:L},(e=>{Y.relationList=e}));const ne=async()=>{Y.loading=!0;const e=_({productCode:f,withInsureInfo:!0,tenantId:g}),t=S({productCode:f}),r=R({openId:L});await Promise.all([e,t,r]).then((([e,t,r])=>{var a,o,n;if("10000"===e.code){Y.detail=e.data,Y.banner=null==(a=Y.detail.tenantProductInsureVO)?void 0:a.banner[0];const{colorEnd:t,colorStart:r}=(null==(o=Y.detail.tenantProductInsureVO)?void 0:o.backgroundInsureVO)||{};Y.colors=[r,t],Y.productDesc=Y.detail.tenantProductInsureVO.spec||[],document.title=Y.detail.productFullName||""}if("10000"===t.code&&(Y.insureDetail=t.data,Y.insureDetail.productFactor[1].forEach((e=>{"verificationCode"===e.code&&1===e.isDisplay&&(Y.isValidateCode=!0)})),Y.insureDetail.productFactor[2]=null==(n=Y.insureDetail.productFactor)?void 0:n[2].map((e=>{var t,r;return"relationToHolder"===e.code&&1===e.isDisplay&&(e.title="被保人",Y.order.tenantOrderInsuredList[0].relationToHolder=(null==(r=null==(t=e.attributeValueList)?void 0:t[0])?void 0:r.code)||""),e}))),"10000"===r.code&&(Y.newAuth=!r.data,r.data)){const e=r.data;Y.order.tenantOrderHolder={certNo:null==e?void 0:e.certiNo,extInfo:{},mobile:null==e?void 0:e.mobile,name:null==e?void 0:e.name}}(()=>{let e={};if(e=Y.detail.tenantProductInsureVO.planInsureVO.attachmentVOList||[],!e)return void(W.value=[]);const t={2:"richText",3:"link"};W.value=Object.keys(e).map((r=>(e[r].forEach((e=>{if("1"===e.attachmentType){const t=e.attachmentUri.split("?"),r=t[0].substr(t[0].lastIndexOf(".")+1);e.attachmentType="pdf"===r?"pdf":"picture"}else e.attachmentType=t[e.attachmentType]})),{attachmentName:r,attachmentList:e[r]})))||[]})(),Y.loading=!1}))},ie=async()=>{let e={loginType:"2",openId:L,thirdUserType:"XINAO_WECHAT",indirectCode:U};try{if(Y.newAuth?(e.loginName=Y.order.tenantOrderHolder.mobile,e.password=Y.order.tenantOrderHolder.verificationCode):e=G({order:Y.order,tenantId:g,extraInfo:E,detail:Y.detail,insureDetail:Y.insureDetail,iseeBizNo:X,saleUserId:Q,templateId:null==E?void 0:E.templateId,saleChannelId:q,pageCode:"infoCollection",buttonCode:"EVENT_FREE_multiIssuePolicy"}),Y.newAuth){const{code:t,data:r}=await Z(e);"10000"===t&&(Y.newAuth=!1)}else H(e,((e,t)=>{t===F.JUMP_PAGE&&e.orderNo&&u.push(`/baseInsurance/orderDetail?from=free&tenantId=${g}&orderNo=${e.orderNo}&productCode=${f}`)}))}catch(t){}},le=async()=>await(async()=>{var e;await K.value.validateForm();const t=null==(e=Y.order.tenantOrderHolder)?void 0:e.verificationCode;if(Y.isValidateCode&&(!t||!M(t)))return b({message:"请输入正确的验证码"}),!1;if(Y.newAuth||!Y.isValidateCode)return!0;const{code:r,data:a}=await B(Y.order.tenantOrderHolder.mobile,t);return!!a})()?(Y.newAuth||0===W.value.length?ie():(Y.isOnlyView=!1,Y.showFilePreview=!0),!1):null,se=()=>{Y.showFilePreview=!1,Y.isOnlyView=!1},de=()=>{Y.showFilePreview=!1,Y.isOnlyView=!0,ie()};return h((()=>{ne(),setTimeout((async()=>{X=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),o((()=>Y.order.tenantOrderInsuredList[0]),(e=>{if(x(Y.relationList)||Y.newAuth)return null;const t=Y.relationList[e.relationToHolder]||[];return 1===t.length&&(z.SELF!==e.relationToHolder?(Y.order.tenantOrderInsuredList[0].certNo=Y.order.tenantOrderInsuredList[0].certNo?Y.order.tenantOrderInsuredList[0].certNo:t[0].cert[0].certNo,Y.order.tenantOrderInsuredList[0].name=Y.order.tenantOrderInsuredList[0].name?Y.order.tenantOrderInsuredList[0].name:t[0].cert[0].certName):(Y.order.tenantOrderHolder.certNo=Y.order.tenantOrderHolder.certNo?Y.order.tenantOrderHolder.certNo:t[0].cert[0].certNo,Y.order.tenantOrderHolder.name=Y.order.tenantOrderHolder.name?Y.order.tenantOrderHolder.name:t[0].cert[0].certName)),!1}),{immediate:!0,deep:!0}),v($,(([{isIntersecting:e}],t)=>{Y.showBtn=!e})),(e,t)=>{const r=w("van-image"),a=w("van-config-provider");return n(),I(a,{"theme-vars":s(c)},{default:y((()=>[l("div",re,[d(V,{url:s(Y).banner},null,8,["url"]),d(ee,{ref_key:"formRef",ref:K,"is-first":s(Y).newAuth,"insure-detail":s(Y).insureDetail,detail:s(Y).order,colors:s(Y).colors},{default:y((()=>[d(j,{ref_key:"root",ref:$,class:"submit-btn","is-gradient":!1,text:s(Y).newAuth?"立即领取":"激活保障",onClick:le},null,8,["text"]),W.value&&W.value.length>0?(n(),I(k,{key:0,"attachement-list":W.value,"has-bg-color":!1,"pre-text":"请阅读",onPreviewFile:t[0]||(t[0]=e=>(e=>{Y.activeIndex=e,Y.showFilePreview=!0})(e))},null,8,["attachement-list"])):O("",!0)])),_:1},8,["is-first","insure-detail","detail","colors"]),l("div",ae,[(n(!0),i(P,null,C(s(Y).productDesc,((e,t)=>(n(),I(r,{key:t,width:"100%","lazy-load":"",src:e,class:""},null,8,["src"])))),128))]),s(Y).showBtn?(n(),i("footer",oe,[d(j,{"is-gradient":!1,text:s(Y).newAuth?"立即领取":"激活保障",onClick:le},null,8,["text"])])):O("",!0)]),s(Y).showFilePreview&&0!==W.value.length?(n(),I(D,{key:0,show:s(Y).showFilePreview,"onUpdate:show":t[1]||(t[1]=e=>s(Y).showFilePreview=e),"content-list":W.value,"is-only-view":s(Y).isOnlyView,"active-index":s(Y).activeIndex,text:s(Y).isOnlyView?"关闭":"我已逐页阅读上述内容并同意","force-read-cound":0,"on-close-file-preview":"",onSubmit:de,onOnCloseFilePreview:se},null,8,["show","content-list","is-only-view","active-index","text"])):O("",!0),s(Y).loading?O("",!0):(n(),I(T,{key:1,"product-detail":s(Y).detail},null,8,["product-detail"]))])),_:1},8,["theme-vars"])}}}),[["__scopeId","data-v-000dd3ac"]]);export{ne as default};
