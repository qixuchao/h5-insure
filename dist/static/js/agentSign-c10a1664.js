import{d as e,h as a,g as i,bG as s,i as t,av as n,o as r,c as o,b as l,a as d,u as c,w as u,a8 as f,aC as g,c3 as p,T as h,bk as v,aa as m,bZ as y,an as b}from"./index-f43edcf2.js";import{c as j}from"./product-3b58023a.js";import{g as S,m as I}from"./trial-a994f093.js";import{_ as D}from"./SignPart-672dd1e3.js";import{u as E}from"./useOrder-da2038c3.js";import{M as N}from"./product-585b0e6f.js";import{N as O}from"./notice-33e6eedd.js";import{s as T,a as L}from"./verify-efce1e77.js";import"./PayInfo-26f9739d.js";import{P as C,a as w}from"./constants-6162d78d.js";import{a as A}from"./utils-0af605ab.js";import"./useAttachment-e0727447.js";import"./utils-64d9915e.js";import"./infoCollection-2a0b5fb4.js";import"./trial-6d2cf6a4.js";import"./index-09c951e8.js";import"./bankCard-38e47b2d.js";const G={class:"long-verify"},R={class:"header"},V={class:"verify-content"},q={class:"footer-button"},B=e({__name:"agentSign",setup(e){const B=a(),U=i(),{productCode:k="",tenantId:P,agentCode:_="",agencyCode:x,saleChannelId:H,saleUserId:M,orderNo:z,orderCode:F,extraInfo:$,isShare:J,insurerCode:Z,preview:K}=B.query;let Q={};try{Q=JSON.parse(decodeURIComponent($))}catch(te){}const W=E(),X=`${window.origin}/baseInsurance/long/phoneVerify?${s.stringify({...B.query,orderNo:F||z})}`,Y=t(),ee=t({holder:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:""},insured:{fileList:[],personalInfo:[],isSign:!1,isVerify:!1,isShareSign:!1,signData:{}},agent:{fileList:[],personalInfo:{},isSign:!1,isVerify:!1,isShareSign:!1,signData:""}}),ae=t({sign:[],verify:[],scribing:""}),ie=()=>{if(K)return void g(C.SIGN,B.query);const e=[];Y.value&&ae.value.sign.includes("1")&&e.push(Y.value.validateSign()),Promise.all(e).then((e=>{L({bizObjectId:[],bizObjectType:p.AGENT,orderId:W.value.id,tenantId:P}).then((({code:e,data:a})=>{"10000"===e&&a&&U.push({path:w.sign,query:B.query})}))})).catch((e=>{h(e.message)}))};t();t({imgUrl:"",desc:"",title:"",link:X});const se=async()=>{let e={};const{code:a,data:i}=await S({orderNo:z,tenantId:P});"10000"===a&&(e=A(i.insuredList[0].productList),i.tenantOrderAttachmentList.forEach((e=>{e.objectType===O.HOlDER?ee.value.holder.signData=e.fileBase64:e.objectType===O.AGENT?ee.value.agent.signData=e.fileBase64:e.objectType===O.INSURED&&(ee.value.insured.signData[e.objectId]=e.fileBase64)}))),j(e).then((({code:e,data:a})=>{var i;if("10000"===e){const{productMaterialMap:e}=(null==(i=a.productMaterialPlanVOList)?void 0:i[0])||{};(Object.values(e||{})||[]).flat().filter((e=>e.materialType===N.SIGN)).forEach((e=>{e.noticeObject===O.AGENT?ee.value.agent.fileList.push(e):e.noticeObject===O.HOlDER?ee.value.holder.fileList.push(e):e.noticeObject===O.INSURED&&ee.value.insured.fileList.push(e)}))}})),I(e).then((({data:e,code:a})=>{if("10000"===a){const{signInfo:a}=v(e.productFactor);a.schema.forEach((e=>{"eleSign"===e.name&&e.columns.forEach((a=>{e.required&&ae.value.sign.push(a.code),"1"===a.code?ee.value.agent.isSign=!0:"2"===a.code?ee.value.holder.isSign=!0:"3"===a.code?ee.value.insured.isSign=!0:"4"===a.code?ee.value.holder.isShareSign=!0:"5"===a.code&&(ee.value.insured.isShareSign=!0)})),"customerFace"===e.name&&e.columns.forEach((a=>{e.required&&ae.value.verify.push(a.code),"1"===a.code?ee.value.holder.isVerify=!0:"2"===a.code&&(ee.value.insured.isVerify=!0)}))}))}})),z&&S({orderNo:F||z,tenantId:P}).then((({code:e,data:a})=>{"10000"===e&&(Object.assign(W.value,a),a.tenantOrderAttachmentList.forEach((e=>{e.objectType===O.HOlDER?ee.value.holder.signData=e.fileBase64:e.objectType===O.AGENT?ee.value.agent.signData=e.fileBase64:e.objectType===O.INSURED&&(ee.value.insured.signData[e.objectId]=e.fileBase64)})))}))};return n((()=>{se()})),(e,a)=>{const i=m,s=y,t=b;return r(),o("div",G,[l(i),d("div",R,[l(s,{type:"warning",title:"尊敬的客户，本次投保需要进行身份认证",content:"本产品投保需要对投保人、被保人进行实名认证，您购买本产品的累计总保费已超过20万，按监管要求，需要提供投保人、被保人、指定受益人证件影像，本产品非本人投保且带身故责任、需对投保人、被保人（成人）的投保意愿进行签字确认。"})]),d("div",V,[l(D,{ref_key:"agentSignRef",ref:Y,"order-detail":c(W),"sign-string":c(ee).agent.signData,"show-sign":c(ee).agent.isSign,"show-verify":c(ee).agent.isVerify,"file-list":c(ee).agent.fileList,"personal-info":c(ee).agent.personalInfo,disabled:!!c(J),title:"代理人",onHandleSign:a[0]||(a[0]=e=>((e,a,i)=>{var s;console.log("orderDetail.value",W.value),T(e,a,null==(s=W.value)?void 0:s.id,P,i)})("AGENT",e))},null,8,["order-detail","sign-string","show-sign","show-verify","file-list","personal-info","disabled"])]),d("div",q,[l(t,{type:"primary",onClick:ie},{default:u((()=>[f("确定")])),_:1})])])}}});export{B as default};
