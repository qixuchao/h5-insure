import{b9 as e,d as i,r as a,L as l,ba as t,bb as n,V as s,au as o,e as u,aA as r,aM as d,a9 as c,bc as m,bd as p,be as f,bf as v,bg as y,bh as b,W as g,bi as V,bj as h,bk as k,bl as L,bm as O,A as C,Z as S,b as I,c as w,w as F,i as x,f as T,g as D,E as _,h as A,$ as j,G as N,at as P,aG as U,aH as B,k as M,ad as K,al as R,am as $,a7 as J,j as E,D as H,ah as z,ap as Y,bn as W,bo as q,T as G,bp as Z,bq as Q,aD as X,aE as ee}from"./index-c003035a.js";import{a as ie,B as ae}from"./infoCollection-d620164e.js";import{c as le}from"./cloneDeep-127900a4.js";import{d as te,i as ne}from"./debounce-6981b306.js";import{m as se}from"./merge-84cb998c.js";import{P as oe,i as ue}from"./index-4021b384.js";import{c as re,k as de,r as ce,v as me,m as pe,t as fe}from"./ProRenderFormWithCard.vue_vue_type_style_index_0_scoped_true_lang-f09f8c65.js";/* empty css              */import"./useDicData-e374a5a1.js";import"./bankCard-4428c3eb.js";import{a as ve,M as ye}from"./keysIn-b1e7a5ec.js";import{S as be}from"./isObjectLike-a9798079.js";import{P as ge}from"./config-98e8d477.js";import{c as Ve}from"./trial-aad1c55b.js";import{S as he}from"./index-50d9ca4b.js";const[ke,Le]=e("stepper"),Oe=(e,i)=>String(e)===String(i);const Ce=O(i({name:ke,props:{min:p(1),max:p(1/0),name:p(""),step:p(1),theme:String,integer:Boolean,disabled:Boolean,showPlus:f,showMinus:f,showInput:f,longPress:f,allowEmpty:Boolean,modelValue:v,inputWidth:v,buttonSize:v,placeholder:String,disablePlus:Boolean,disableMinus:Boolean,disableInput:Boolean,beforeChange:Function,defaultValue:p(1),decimalLength:v},emits:["plus","blur","minus","focus","change","overlimit","update:modelValue"],setup(e,{emit:i}){const p=i=>{const{min:a,max:l,allowEmpty:t,decimalLength:n}=e;return t&&""===i||(i=""===(i=y(String(i),!e.integer))?0:+i,i=Number.isNaN(i)?+a:i,i=Math.max(Math.min(+l,i),+a),b(n)&&(i=i.toFixed(+n))),i};let f;const v=a(),O=a((()=>{var a;const l=null!=(a=e.modelValue)?a:e.defaultValue,t=p(l);return Oe(t,e.modelValue)||i("update:modelValue",t),t})()),C=l((()=>e.disabled||e.disableMinus||O.value<=+e.min)),S=l((()=>e.disabled||e.disablePlus||O.value>=+e.max)),I=l((()=>({width:t(e.inputWidth),height:t(e.buttonSize)}))),w=l((()=>n(e.buttonSize))),F=i=>{e.beforeChange?k(e.beforeChange,{args:[i],done(){O.value=i}}):O.value=i},x=()=>{if("plus"===f&&S.value||"minus"===f&&C.value)return void i("overlimit",f);const a="minus"===f?-e.step:+e.step,l=p(L(+O.value,a));F(l),i(f)},T=i=>{const a=i.target,{value:l}=a,{decimalLength:t}=e;let n=y(String(l),!e.integer);if(b(t)&&n.includes(".")){const e=n.split(".");n=`${e[0]}.${e[1].slice(0,+t)}`}e.beforeChange?a.value=String(O.value):Oe(l,n)||(a.value=n);const s=n===String(+n);F(s?+n:n)},D=a=>{var l;e.disableInput?null==(l=v.value)||l.blur():i("focus",a)},_=e=>{const a=e.target,l=p(a.value);a.value=String(l),O.value=l,g((()=>{i("blur",e),V()}))};let A,j;const N=()=>{j=setTimeout((()=>{x(),N()}),200)},P=i=>{e.longPress&&(clearTimeout(j),A&&h(i))},U=i=>{e.disableInput&&h(i)},B=i=>({onClick:e=>{h(e),f=i,x()},onTouchstartPassive:()=>{f=i,e.longPress&&(A=!1,clearTimeout(j),j=setTimeout((()=>{A=!0,x(),N()}),600))},onTouchend:P,onTouchcancel:P});return s((()=>[e.max,e.min,e.integer,e.decimalLength]),(()=>{const e=p(O.value);Oe(e,O.value)||(O.value=e)})),s((()=>e.modelValue),(e=>{Oe(e,O.value)||(O.value=p(e))})),s(O,(a=>{i("update:modelValue",a),i("change",a,{name:e.name})})),o((()=>e.modelValue)),()=>u("div",{role:"group",class:Le([e.theme])},[r(u("button",c({type:"button",style:w.value,class:[Le("minus",{disabled:C.value}),{[m]:!C.value}],"aria-disabled":C.value||void 0},B("minus")),null),[[d,e.showMinus]]),r(u("input",{ref:v,type:e.integer?"tel":"text",role:"spinbutton",class:Le("input"),value:O.value,style:I.value,disabled:e.disabled,readonly:e.disableInput,inputmode:e.integer?"numeric":"decimal",placeholder:e.placeholder,"aria-valuemax":e.max,"aria-valuemin":e.min,"aria-valuenow":O.value,onBlur:_,onInput:T,onFocus:D,onMousedown:U},null),[[d,e.showInput]]),r(u("button",c({type:"button",style:w.value,class:[Le("plus",{disabled:S.value}),{[m]:!S.value}],"aria-disabled":S.value||void 0},B("plus")),null),[[d,e.showPlus]])])}}));const Se={key:0},Ie={class:"custom-field"},we={key:1,class:"flex-field"},Fe={class:"pro-radio-wrap"},xe={key:2},Te={class:"pro-radio-wrap"},De={class:"custom-field"},_e={key:1},Ae={key:3},je={class:"custom-field"},Ne={key:1},Pe={class:"custom-field"},Ue={key:0},Be={key:1},Me={key:4},Ke=i({name:"BaoeBaofei"});var Re=N(i({...Ke,props:{originData:{default:()=>({})},modelValue:{default:()=>({})},defalutValue:{default:()=>({})},trialResult:{default:()=>({})}},emits:["update:modelValue","trialChange"],setup(e,{emit:i}){const t=e,n=C({hadSetDefault:!1}),o=a(t.originData),r=a(t.modelValue),d=a(0),c=()=>2===o.value.saleMethod?{label:"保费",key:"initialPremium"}:{label:"保额",key:"initialAmount"},m=()=>{switch(`${o.value.displayUnit}`){case ie.YUAN:return"元";case ie.MONTH_SALARY:return"倍月薪";case ie.MILLION:return"万元";case ie.COPY:return"份"}return""},p=l((()=>2===o.value.saleMethod?{label:"保费",key:"initialPremium"}:{label:"保额",key:"initialAmount"})),f=(...e)=>{if(1===d.value){const e=r.value[p.value.key],i=t.originData.minStepValue,a=t.originData.maxStepValue,l=t.originData.stepValue;if(+e>=+a)r.value[p.value.key]=a;else if(+e<=+i)r.value[p.value.key]=i;else{const a=+e-+i,t=Math.floor(a/+l);a%+l!=0&&(r.value[p.value.key]=+i+t*+l)}}return!0},v=()=>{const{displayType:e,requireCopies:i}=o.value,a=c().key,l=!r.value.riskCode;1===e?d.value=1:3===e&&2===i?(d.value=2,o.value.displayValues.length>=1&&l&&!r.value[a]&&(r.value[a]=o.value.displayValues[0].code||o.value.displayValues[0].value)):3===e&&1===i?(d.value=3,o.value.minCopiesValue===o.value.maxCopiesValue&&l&&!r.value.copy&&(r.value.copy=o.value.minCopiesValue),o.value.displayValues.length>=1&&l&&!r.value[a]&&(r.value[a]=o.value.displayValues[0].code||o.value.displayValues[0].value)):2===e&&(d.value=4,o.value.minCopiesValue===o.value.maxCopiesValue&&l&&!r.value.copy&&(r.value.copy=o.value.minCopiesValue),l&&!r.value.initialAmount&&(r.value.initialAmount=o.value.copiesAmount))},y=l((()=>{if(o.value.displayValues){const e=c().key;return 1!==o.value.displayValues.length||r.value.riskCode||(r.value[e]=o.value.displayValues[0].code),o.value.displayValues.map((e=>({label:e.value,value:e.code})))}return[]})),b=()=>{};return S((()=>{v(),i("update:modelValue",r.value)})),s((()=>o),(e=>{v()}),{deep:!0}),s((()=>t.defalutValue),(e=>{(null==e?void 0:e.riskCode)&&!n.hadSetDefault&&(n.hadSetDefault=!0,r.value={...r.value,initialAmount:e.initialAmount,initialPremium:e.initialPremium,copy:e.copy})}),{deep:!0,immediate:!0}),s((()=>r.value),(e=>{(()=>{if(1===d.value){const e=r.value[p.value.key],i=t.originData.minStepValue,a=t.originData.maxStepValue,l=t.originData.stepValue;if(+e>+a)return!1;if(+e<+i)return!1;if((+e-+i)%+l!=0)return!1}return!0})()&&(i("update:modelValue",e),i("trialChange",e))}),{deep:!0,immediate:!0}),(i,a)=>{const l=Ce,t=P,n=U,s=B;return I(),w(j,null,[1===d.value?(I(),w("div",Se,[u(t,{label:`基本${T(p).label}`,name:T(p).key,class:"risk-select-field"},{input:F((()=>[x("div",Ie,[u(l,{modelValue:r.value[T(p).key],"onUpdate:modelValue":a[0]||(a[0]=e=>r.value[T(p).key]=e),"input-width":"80px","default-value":e.originData.minStepValue,min:e.originData.minStepValue,step:e.originData.stepValue,max:e.originData.maxStepValue,onBlur:f},null,8,["modelValue","default-value","min","step","max"])])])),_:1},8,["label","name"])])):2===d.value?(I(),w("div",we,[u(s,{modelValue:r.value[T(p).key],"onUpdate:modelValue":a[2]||(a[2]=e=>r.value[T(p).key]=e),label:`基本${T(p).label}`,name:T(p).key,class:"risk-select-field"},{input:F((()=>[x("div",Fe,[u(n,{modelValue:r.value[T(p).key],"onUpdate:modelValue":a[1]||(a[1]=e=>r.value[T(p).key]=e),options:T(y),onclick:b},null,8,["modelValue","options"])])])),_:1},8,["modelValue","label","name"])])):3===d.value?(I(),w("div",xe,[u(s,{modelValue:r.value[T(p).key],"onUpdate:modelValue":a[4]||(a[4]=e=>r.value[T(p).key]=e),label:`基本${T(p).label}`,name:T(p).key,class:"risk-select-field"},{input:F((()=>[x("div",Te,[u(n,{modelValue:r.value[T(p).key],"onUpdate:modelValue":a[3]||(a[3]=e=>r.value[T(p).key]=e),options:T(y),onclick:b},null,8,["modelValue","options"])])])),_:1},8,["modelValue","label","name"]),x("div",null,[u(t,{modelValue:r.value.copy,"onUpdate:modelValue":a[6]||(a[6]=e=>r.value.copy=e),label:"份数",name:"copy",class:"risk-select-field"},{input:F((()=>[x("div",De,[e.originData.minCopiesValue!==e.originData.maxCopiesValue?(I(),D(l,{key:0,modelValue:r.value.copy,"onUpdate:modelValue":a[5]||(a[5]=e=>r.value.copy=e),"input-width":"80px","default-value":e.originData.minCopiesValue,min:e.originData.minCopiesValue||1,step:1,max:e.originData.maxCopiesValue},null,8,["modelValue","default-value","min","max"])):(I(),w("span",_e,_(e.originData.minCopiesValue),1))])])),_:1},8,["modelValue"])])])):4===d.value?(I(),w("div",Ae,[u(t,{modelValue:r.value.copy,"onUpdate:modelValue":a[8]||(a[8]=e=>r.value.copy=e),label:"份数",name:"copy",class:"risk-select-field"},{input:F((()=>[x("div",je,[e.originData.minCopiesValue!==e.originData.maxCopiesValue?(I(),D(l,{key:0,modelValue:r.value.copy,"onUpdate:modelValue":a[7]||(a[7]=e=>r.value.copy=e),"input-width":"64px","default-value":e.originData.minCopiesValue,min:e.originData.minCopiesValue||1,step:1,max:e.originData.maxCopiesValue},null,8,["modelValue","default-value","min","max"])):(I(),w("span",Ne,_(e.originData.minCopiesValue),1))])])),_:1},8,["modelValue"]),u(t,{label:T(p).label,name:"copyAmount",class:"risk-select-field"},{input:F((()=>[x("div",Pe,[e.originData.minCopiesValue!==e.originData.maxCopiesValue?(I(),w("span",Ue,_(+e.originData.copiesAmount*+r.value.copy+m()),1)):(I(),w("span",Be,_(+e.originData.minCopiesValue*+e.originData.copiesAmount+m()),1))])])),_:1},8,["label"])])):A("",!0),2===o.value.saleMethod&&e.trialResult&&e.trialResult.initialAmount>0?(I(),w("div",Me,[u(t,{label:"保额",class:"risk-select-field"},{input:F((()=>[x("span",null,_(e.trialResult.initialAmount),1)])),_:1})])):A("",!0)],64)}}}),[["__scopeId","data-v-7997a9f0"]]);const $e=i({name:"BeneficiaryItem"});var Je=N(i({...$e,props:{modelValue:{default:()=>({})},schema:{default:()=>[]},config:{default:()=>({})},isView:{type:Boolean,default:!1},isTrial:{type:Boolean,default:!1},title:{default:"受益人"}},emits:["update:modelValue","trailChange"],setup(e,{expose:i,emit:l}){const t=e,n=a(null),o=C({validated:!1,schema:[],config:{},personVO:{}});return s((()=>t.config),(e=>{e&&Object.assign(o.config,e)}),{deep:!0,immediate:!0}),s((()=>t.schema),(e=>{e&&Object.assign(o.schema,le(t.schema))}),{deep:!0,immediate:!0}),s((()=>t.modelValue),((e,i)=>{JSON.stringify(e)!==JSON.stringify(i)&&(re("受益人数据变动了"),Object.assign(o.personVO,e))}),{deep:!0,immediate:!0}),s((()=>o.personVO),(e=>{e&&l("update:modelValue",e)}),{deep:!0,immediate:!0}),s((()=>{var e;return null==(e=o.personVO)?void 0:e.relationToInsured}),((e,i)=>{if(e===i)return!1;re("受益人与被保人关系变动了");const{certType:a}=o.personVO||{},[l,n]=de(o.schema,{certType:a,relationToHolder:e});return se(o.config,n),!t.isView&&e&&i&&Object.assign(o.personVO,{...ce(o.personVO,(e=>!(l&&"certType"===e))),relationToInsured:e}),!1}),{immediate:!0}),i({validate:e=>pe(n,t.trialFactorCodes,e),validateTrialFields:()=>me({personVO:o.personVO,trialFactorCodes:t.trialFactorCodes})}),(i,a)=>(I(),D(T(oe),{ref_key:"formRef",ref:n,class:"personal-info-card",title:e.title,model:T(o).personVO,schema:T(o).schema,config:T(o).config,"is-view":e.isView,"extra-provision":{objectType:T(K).BENEFICIARY,objectId:T(o).personVO.id}},{cardTitleExtra:F((()=>[M(i.$slots,"default",{},void 0,!0)])),_:3},8,["title","model","schema","config","is-view","extra-provision"]))}}),[["__scopeId","data-v-34580ae7"]]);const Ee=["onClick"],He=i({name:"InsuredItem"});var ze=N(i({...He,props:{modelValue:{default:()=>({})},title:{default:""},holderPersonVO:null,schema:{default:()=>[]},config:{default:()=>({})},isView:{type:Boolean,default:!1},isTrial:{type:Boolean,default:!1},trialFactorCodes:{default:()=>[]},multiBeneficiaryMaxNum:{default:null},beneficiaryList:{default:()=>[]},beneficiarySchema:{default:()=>[]}},emits:["update:modelValue","update:beneficiaryList"],setup(e,{expose:i,emit:t}){const n=e,o=a(null),r=a(null),d=a(null),c={schema:[],trialFactorCodes:[],config:{},personVO:{}},m=C({validated:!1,schema:[],config:{},personVO:{},beneficiaryTypeSchemaList:[],beneficiarySchemaList:[],beneficiaryList:[]}),p=()=>{m.beneficiaryList.push(le({...c,nanoid:$(),schema:n.beneficiarySchema}))},f=l((()=>!n.multiBeneficiaryMaxNum||m.beneficiaryList.length<n.multiBeneficiaryMaxNum)),v=l((()=>!m.schema.filter((e=>{var i;return!(e.hidden||(null==(i=m.config[e.name])?void 0:i.hidden))})).length)),y=l((()=>m.schema.filter((e=>e.isSelfInsuredNeed)).map((e=>e.name)))),b=l((()=>R(n.beneficiarySchema))),g=l((()=>{var e;return String(null==(e=m.personVO)?void 0:e.insuredBeneficiaryType)===ae.SPECIFY}));return s((()=>n.holderPersonVO),(e=>{var i;re("投保人信息变动了");const{id:a,...l}=e||{};if("1"===String(null==(i=m.personVO)?void 0:i.relationToHolder)){const e=R(y.value)?Object.keys(l).reduce(((e,i)=>([...y.value,"occupationClass"].includes(i)&&!["birthday","age","gender"].includes(i)||(e[i]=l[i]),e)),{}):l;Object.assign(m.personVO,e)}}),{deep:!0,immediate:!0}),s((()=>n.beneficiarySchema),(e=>{m.beneficiarySchemaList=R(e)?e.filter((e=>"insuredBeneficiaryType"!==e.name)):[],m.beneficiaryTypeSchemaList=R(e)?e.filter((e=>"insuredBeneficiaryType"===e.name)):[]}),{deep:!0,immediate:!0}),s(g,((e,i)=>{String(e)!==String(i)&&(re("受益人类型关系变动了"),e?!R(m.beneficiaryList)&&p():m.beneficiaryList=[])}),{immediate:!0}),s((()=>m.beneficiaryList.map((e=>({personVO:e.personVO})))),((e,i)=>{JSON.stringify(e)!==JSON.stringify(i)&&t("update:beneficiaryList",e)}),{deep:!0}),s((()=>{var e;return null==(e=m.personVO)?void 0:e.relationToHolder}),((e,i)=>{if(!e)return;re("与投保人关系变动了");const{personVO:a,schema:l=[],config:t}=m||{},{id:s,...o}=n.holderPersonVO||{},u="1"===String(a.relationToHolder),[r,d]=de(l,a);if(se(t,d),l.forEach((e=>{e.relationToHolder=a.relationToHolder,e.hidden=!e.isSelfInsuredNeed&&u})),!n.isView&&i&&String(e)!==String(i)){let e={...a,...o};u||(e={...ce(a,(e=>!(r&&"certType"===e))),relationToHolder:a.relationToHolder}),Object.assign(m.personVO,e)}}),{deep:!0}),s((()=>{var e;return null==(e=m.personVO)?void 0:e.relationToMainInsured}),((e,i)=>{if(!e)return;re("次被保人与主被保人关系变动了");const{personVO:a,schema:l=[],config:t}=m||{},{certType:s}=a||{},[o,u]=de(l,{certType:s,relationToHolder:e});se(t,u),!n.isView&&i&&String(e)!==String(i)&&Object.assign(m.personVO,{...ce(a,(e=>!(o&&"certType"===e))),relationToMainInsured:a.relationToMainInsured})})),s((()=>n.config),(e=>{e&&Object.assign(m.config,e)}),{deep:!0,immediate:!0}),s((()=>n.schema),(e=>{e&&Object.assign(m.schema,le(e))}),{deep:!0,immediate:!0}),s((()=>n.modelValue),((e,i)=>{if(JSON.stringify(e)!==JSON.stringify(i)){const{beneficiaryList:i,...a}=e;se(m.personVO,a)}}),{deep:!0,immediate:!0}),s((()=>n.beneficiaryList),((e,i)=>{JSON.stringify(e)!==JSON.stringify(i)&&(m.beneficiaryList=R(e)?e.map((e=>({...e,nanoid:e.nanoid||$()}))):[])}),{deep:!0,immediate:!0}),s((()=>m.personVO),(e=>{e&&t("update:modelValue",e)}),{deep:!0,immediate:!0}),i({validate:e=>{var i;return Promise.all([pe(o,n.trialFactorCodes,e),pe(r,[],e),...(null==(i=d.value)?void 0:i.map((i=>i.validate(e))))||[]])},validateTrialFields:()=>me({personVO:m.personVO,trialFactorCodes:n.trialFactorCodes})}),(i,a)=>{const l=z;return I(),w(j,null,[u(T(oe),{ref_key:"insuredFormRef",ref:o,class:"personal-info-card",title:T(v)?"":e.title,model:T(m).personVO,schema:T(m).schema,config:T(m).config,"is-view":e.isView,"extra-provision":{objectType:T(K).INSURED,objectId:T(m).personVO.id}},{cardTitleExtra:F((()=>[M(i.$slots,"default",{},void 0,!0)])),_:3},8,["title","model","schema","config","is-view","extra-provision"]),T(b)?(I(),w(j,{key:0},[u(T(oe),{ref_key:"beneficiaryTypeFormRef",ref:r,class:"personal-info-card",title:"受益人",model:T(m).personVO,schema:T(m).beneficiaryTypeSchemaList,"is-view":e.isView},null,8,["model","schema","is-view"]),T(g)?(I(),w(j,{key:0},[(I(!0),w(j,null,J(T(m).beneficiaryList,((i,a)=>(I(),D(Je,{ref_for:!0,ref_key:"beneficiaryFormRef",ref:d,key:`${i.nanoid}_${a}`,modelValue:i.personVO,"onUpdate:modelValue":e=>i.personVO=e,title:`受益人${a+1}`,schema:T(m).beneficiarySchemaList,config:i.config,"is-view":e.isView},{default:F((()=>[a>0&&!e.isView?(I(),w("span",{key:0,class:"delete-button",onClick:e=>(e=>{H.confirm({message:"确定要删除该受益人吗？"}).then((()=>{m.beneficiaryList.splice(e,1)}))})(a)},[u(l,{name:"delete-o"})],8,Ee)):A("",!0)])),_:2},1032,["modelValue","onUpdate:modelValue","title","schema","config","is-view"])))),128)),!e.isView&&T(f)?(I(),w("span",{key:0,class:"add-button",onClick:p},[u(l,{name:"plus"}),E("添加受益人")])):A("",!0)],64)):A("",!0)],64)):A("",!0)],64)}}}),[["__scopeId","data-v-caede112"]]);const Ye=["onClick"],We=i({name:"PersonalInfo"}),qe=i({...We,props:{productFactor:{default:()=>({})},modelValue:{default:()=>({})},isTrial:{type:Boolean,default:!1},isView:{type:Boolean,default:!1},isOnlyHolder:{type:Boolean,default:!1},multiInsuredConfig:null},emits:["update:modelValue","trailChange","trailValidateFailed"],setup(e,{expose:i,emit:t}){const n=e,o=a(null),r=a(null),d=C({config:{},trialValidated:!1,holder:{personVO:{},schema:[],trialFactorCodes:[],config:{}},beneficiarySchema:[],initInsuredIList:[],insured:[]}),m=l((()=>!n.isTrial||n.isOnlyHolder)),p=()=>{var e;const i=!r.value||(null==(e=r.value)?void 0:e.every((e=>e.validateTrialFields())));return(!o.value||me(d.holder))&&i},f=e=>{var i;return Promise.all([...(null==(i=r.value)?void 0:i.map((i=>i.validate(e))))||[],pe(o,d.holder.trialFactorCodes,e)])},v=e=>{const{productList:i,config:a,schema:l,trialFactorCodes:t,beneficiaryList:n,personVO:s,nanoid:o,...u}=e||{};return u},y=()=>{const{length:e,[e-1]:i}=d.initInsuredIList;d.insured.push(le({...i,nanoid:$()}))},b=l((()=>{const{multiInsuredMaxNum:e,multiInsuredSupportFlag:i}=d.config;return i&&(!e||d.insured.length<e)})),g=l((()=>R(d.holder.schema))),V=l((()=>d.insured.some((e=>R(e.schema))))),h=(e,i)=>R(e)?e.reduce(((e,a)=>(e[a]=i[a],e)),{}):{},k=(e,i,a={})=>!!R(e)&&JSON.stringify(h(e,i))!==JSON.stringify(h(e,a));return s((()=>{var e;return null==(e=d.holder.personVO)?void 0:e.certType}),((e,i)=>{if(e===i)return!1;re("投保人信息变动了");const[a,l]=de(d.holder.schema,{certType:e});return se(d.holder.config,l),!1})),s([()=>{var e;return{...null==(e=d.holder)?void 0:e.personVO}},()=>d.insured.map((e=>{const{beneficiaryList:i,personVO:a}=e||{};return{...a,beneficiaryList:R(i)?i.map((e=>({...e.personVO}))):[]}}))],te(((e,i)=>{var a,l,s;const[o,u]=e,r=((e,i)=>{const a=k(d.holder.trialFactorCodes,e[0],i[0]),l=d.insured.some(((e,a)=>{var l;const{trialFactorCodes:t,personVO:n}=e;return k(t,n,null==(l=i[1])?void 0:l[a])}));return a||l})([o,u],i);re(`投被保人信息变动了---${r}`);const{insuredList:c}=n.modelValue;console.log("insuredList",c,u);const m={holder:o,insuredList:u.map(((e,i)=>({...(null==c?void 0:c[i])||{},...e})))};if(d.config.isSpouseInsured){const[e,i]=u.map((e=>null==e?void 0:e.gender));if(e&&i&&String(e)===String(i))return G("被保人性别与投保要求不符")}if(JSON.stringify(null==(a=null==u?void 0:u[0])?void 0:a.personVO),v(null==(s=null==(l=n.modelValue)?void 0:l.insuredList)?void 0:s[0]),console.log("-------result = ",m),t("update:modelValue",m),!p())return d.trialValidated=!1,t("trailValidateFailed",m);f(!0).then((()=>{d.trialValidated=!0,r&&!n.isOnlyHolder&&t("trailChange",m)})).catch((()=>{d.trialValidated=!1,t("trailValidateFailed",m)}))}),500),{deep:!0}),s([()=>n.productFactor,()=>n.isTrial],((e,i)=>{if(ue(e,i)||!e[0])return!1;re("投被保人要素变动了");const{insuredFactorCodes:a,holderFactorCodes:l}=Y(W)||{},{holder:t,insured:s,beneficiary:o,config:u}=fe(e[0],{isTrial:e[1],...n.multiInsuredConfig,insuredFactorCodes:a,holderFactorCodes:l});return Object.assign(d.holder,t),console.log("-----------",t,s),d.config=u,R(s)&&(d.initInsuredIList=s.map((e=>({...e,beneficiaryList:[]})))),d.beneficiarySchema=le((null==o?void 0:o.schema)||[]),!1}),{deep:!0,immediate:!0}),s([()=>{const{holder:e,insuredList:i}=n.modelValue,a=R(i)?i.map((e=>({config:e.config,personVO:v(e),beneficiaryList:R(e.beneficiaryList)?e.beneficiaryList.map((({config:e,...i})=>({config:e,personVO:v(i)}))):[]}))):[];return[null==e?void 0:e.config,v(e),a]},()=>d.config,()=>d.initInsuredIList],(([[e,i,a]])=>{re("投被保人数据变动了"),Object.assign(d.holder.config,e),Object.assign(d.holder.personVO,i);const{length:l}=a||[],{length:t}=d.insured,{length:s,0:o={},[s-1]:u}=d.initInsuredIList,{multiInsuredMaxNum:r,multiInsuredMinNum:c,multiInsuredSupportFlag:m}=d.config,p=n.isView||l>t?Math.min(l,r):t||c;console.log("-----change",d.config,p),d.insured=Array.from({length:p}).reduce(((e,i,l)=>{const{personVO:t,config:n={},beneficiaryList:s}=(null==a?void 0:a[l])||{},r=le(0===l?o:u);return e[l]?se(e[l],{...r,personVO:t,config:n,beneficiaryList:s}):e[l]={...r,personVO:t,config:n,beneficiaryList:s,nanoid:$()},e}),d.insured)}),{deep:!0,immediate:!0}),i({validate:f,validateTrialFields:p,validateHolder:(...e)=>{var i;return null==(i=o.value)?void 0:i.validate(...e)},canTrail:()=>d.trialValidated}),(i,a)=>{const l=z,t=q;return I(),w(j,null,[T(g)&&T(m)?(I(),D(T(oe),{key:0,ref_key:"holderFormRef",ref:o,title:"投保人信息",class:"personal-info-card",model:T(d).holder.personVO,schema:T(d).holder.schema,config:T(d).holder.config,"is-view":e.isView,"extra-provision":{objectType:T(K).HOLDER,objectId:T(d).holder.personVO.id}},null,8,["model","schema","config","is-view","extra-provision"])):A("",!0),T(V)&&!e.isOnlyHolder?(I(),w(j,{key:1},[(I(!0),w(j,null,J(T(d).insured,((i,a)=>(I(),D(ze,c({ref_for:!0,ref_key:"insuredFormRef",ref:r,key:`${i.nanoid}_${a}`,modelValue:i.personVO,"onUpdate:modelValue":e=>i.personVO=e,"beneficiary-list":i.beneficiaryList,"onUpdate:beneficiaryList":e=>i.beneficiaryList=e,title:""+(T(d).insured.length>1?`被保人${a+1}`:"被保人信息"),"holder-person-v-o":T(d).holder.personVO},i,{"beneficiary-schema":T(d).beneficiarySchema,"is-view":e.isView,"multi-beneficiary-num":T(d).config.multiBeneficiaryMaxNum}),{default:F((()=>[!e.isView&&a+1>T(d).config.multiInsuredMinNum?(I(),w("span",{key:0,class:"delete-button",onClick:e=>(e=>{H.confirm({message:"确定要删除该被保人吗？"}).then((()=>{d.insured.splice(e,1)}))})(a)},[u(l,{name:"delete-o"})],8,Ye)):A("",!0)])),_:2},1040,["modelValue","onUpdate:modelValue","beneficiary-list","onUpdate:beneficiaryList","title","holder-person-v-o","beneficiary-schema","is-view","multi-beneficiary-num"])))),128)),!e.isView&&T(b)?(I(),D(t,{key:0,class:"add-button-wrap"},{title:F((()=>[x("span",{class:"add-button",onClick:y},[u(l,{name:"plus"}),E("添加被保人")])])),_:1})):A("",!0)],64)):A("",!0)],64)}}});var Ge=N(qe,[["__scopeId","data-v-80546b1c"]]),Ze=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Qe=/^\w*$/;function Xe(e,i){if("function"!=typeof e||null!=i&&"function"!=typeof i)throw new TypeError("Expected a function");var a=function(){var l=arguments,t=i?i.apply(this,l):l[0],n=a.cache;if(n.has(t))return n.get(t);var s=e.apply(this,l);return a.cache=n.set(t,s)||n,s};return a.cache=new(Xe.Cache||ye),a}Xe.Cache=ye;var ei,ii,ai,li=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ti=/\\(\\)?/g,ni=(ei=function(e){var i=[];return 46===e.charCodeAt(0)&&i.push(""),e.replace(li,(function(e,a,l,t){i.push(l?t.replace(ti,"$1"):a||e)})),i},ii=Xe(ei,(function(e){return 500===ai.size&&ai.clear(),e})),ai=ii.cache,ii),si=ni;var oi=be?be.prototype:void 0,ui=oi?oi.toString:void 0;function ri(e){if("string"==typeof e)return e;if(ve(e))return function(e,i){for(var a=-1,l=null==e?0:e.length,t=Array(l);++a<l;)t[a]=i(e[a],a,e);return t}(e,ri)+"";if(ne(e))return ui?ui.call(e):"";var i=e+"";return"0"==i&&1/e==-Infinity?"-0":i}function di(e,i){return ve(e)?e:function(e,i){if(ve(e))return!1;var a=typeof e;return!("number"!=a&&"symbol"!=a&&"boolean"!=a&&null!=e&&!ne(e))||Qe.test(e)||!Ze.test(e)||null!=i&&e in Object(i)}(e,i)?[e]:si(function(e){return null==e?"":ri(e)}(e))}function ci(e){if("string"==typeof e||ne(e))return e;var i=e+"";return"0"==i&&1/e==-Infinity?"-0":i}function mi(e,i,a){var l=null==e?void 0:function(e,i){for(var a=0,l=(i=di(i,e)).length;null!=e&&a<l;)e=e[ci(i[a++])];return a&&a==l?e:void 0}(e,i);return void 0===l?a:l}const pi={class:"pro-radio-wrap"},fi=i({name:"ProductKeys"});var vi=N(i({...fi,props:{originData:{default:()=>({})},modelValue:{default:()=>({})},riskInfo:{default:()=>({})},defaultValue:{default:()=>({})},useData:{default:()=>({})}},emits:["trialChange","inputChange"],setup(e,{emit:i}){const l=e,t=a(l.originData),n=a(l.modelValue);a(1);const o=e=>{const i=mi(l.originData,e),a=mi(l.originData,e);return i.map((e=>{const i=a?a.find((i=>i.code===e.code)):null;return{label:e.value,value:e.code,disabled:!(!i||null===i.useFlag||void 0===i.useFlag)&&1!==i.useFlag}}))},r=()=>{ge.forEach((e=>{const i=mi(l.originData,e.configKey);"checkbox"===e.type&&i&&i.length>0&&!n.value.riskCode&&(n.value[e.valueKey]=i[0].code)}))};return S((()=>{r()})),s((()=>l.defaultValue),(e=>{(null==e?void 0:e.riskCode)&&(n.value=JSON.parse(JSON.stringify(e)))}),{deep:!0,immediate:!0}),s((()=>t.value),(e=>{r()}),{deep:!0,immediate:!0}),s((()=>JSON.stringify(n.value)),((e,a)=>{const t=e&&JSON.parse(e)||{};console.log("---v new = ",t);const n=a&&JSON.parse(a)||{};let s=null;ge.forEach((e=>{t[e.valueKey]&&n[e.valueKey]&&t[e.valueKey]!==n[e.valueKey]&&(s||(s={key:e.valueKey,oldValue:n[e.valueKey],newValue:t[e.valueKey],riskCode:l.riskInfo.riskCode}))})),e&&i("trialChange",JSON.parse(e),s)}),{deep:!0,immediate:!0}),(i,a)=>{const l=U,t=B;return I(!0),w(j,null,J(T(ge),(i=>(I(),w(j,null,[T(mi)(e.originData,i.configKey)&&(1===e.riskInfo.mainRiskFlag||i.ruleKey&&2===T(mi)(e.originData,i.ruleKey)||!i.ruleKey)?(I(),w("div",{key:e.riskInfo.riskCode+"_"+i.name},["checkbox"===i.type?(I(),D(t,{key:0,modelValue:n.value[i.valueKey],"onUpdate:modelValue":e=>n.value[i.valueKey]=e,label:i.name,name:i.valueKey,class:"risk-select-field"},{input:F((()=>[x("div",pi,[u(l,{modelValue:n.value[i.valueKey],"onUpdate:modelValue":[e=>n.value[i.valueKey]=e,e=>((e,i)=>{console.log("-------change",e,i)})(e,i.valueKey)],options:o(i.configKey)},null,8,["modelValue","onUpdate:modelValue","options"])])])),_:2},1032,["modelValue","onUpdate:modelValue","label","name"])):A("",!0)])):A("",!0)],64)))),256)}}}),[["__scopeId","data-v-15c494f0"]]);const yi={class:"com-risk-liabilityinfo"},bi={class:"item-wrap"},gi={key:0},Vi=(e=>(X("data-v-50053b39"),e=e(),ee(),e))((()=>x("div",{class:"cell-content"},null,-1))),hi=i({name:"riskLiabilityInfo"});var ki=N(i({...hi,props:{dataSource:{default:()=>({})},modelValue:{default:()=>({})},dataSourceFolmulate:{default:()=>({})},params:{default:()=>({amountUnit:"",basicsAmount:"",basicsPremium:"",riskId:""})},defaultValue:{default:()=>({})}},emits:["trialChange"],setup(e,{emit:i}){const t=e,n=a({formInfo:t.dataSource,isCheckList:[],checkValueList:[],liabilityList:[],signLiabilityClick:[]}),o=(e,i)=>{console.log("---click ",e,i),n.value.signLiabilityClick.push({item:e,index:i})},r=(e,i)=>{const a=n.value.liabilityList.map((e=>e.key)),l=0===e.liabilityAttributeValueList.length&&0===e.formula.length,t=n.value.isCheckList[i];l&&-1===a.indexOf(i)&&t&&n.value.liabilityList.push({liabilityValue:e,key:i,isSwitchOn:n.value.isCheckList[i]}),"1"===t?o(e,i):n.value.signLiabilityClick.splice(i,1),-1!==a.indexOf(i)&&n.value.liabilityList.forEach((e=>{e.key===i&&(e.isSwitchOn=n.value.isCheckList[i])}))},d=(e,i)=>{const a=e.liabilityAttributeValueList.filter((e=>e.displayValue===n.value.checkValueList[i])),l=JSON.parse(JSON.stringify(a))[0]||e.liabilityAttributeValueList[0],t={...e,liabilityValue:l};n.value.liabilityList.length>0&&Object.keys(n.value.checkValueList).indexOf(i)&&(n.value.liabilityList=n.value.liabilityList.filter((e=>e.key!==i))),n.value.checkValueList[i]=l.displayValue,n.value.liabilityList.push({liabilityValue:t,key:i,isSwitchOn:"1"})},c=l((()=>le(t.dataSourceFolmulate))),m=(e,i,a)=>{1===a?n.value.liabilityList.push({liabilityValue:{...e,liabilityValue:null==e?void 0:e.liabilityAttributeValueList[0]},key:i,isSwitchOn:"1"}):n.value.liabilityList.push({liabilityValue:{...e,liabilityValue:null==e?void 0:e.liabilityAttributeValueList[0]},key:i,isSwitchOn:"2"})};return s((()=>c.value),((e,i)=>{var a,l;const s=null==(a=t.dataSourceFolmulate)?void 0:a.initialAmount,o=null==(l=t.dataSourceFolmulate)?void 0:l.initialPremium,u={amountUnit:t.params.amountUnit,basicsAmount:s,basicsPremium:o,riskId:t.params.riskId},r=t.dataSource.riskLiabilityInfoVOList.map((async a=>{if(a.formula.length>0&&(s||o)&&((null==e?void 0:e.initialAmount)!==(null==i?void 0:i.initialAmount)||(null==e?void 0:e.initialPremium)!==(null==i?void 0:i.initialPremium))){const{code:e,data:i}=await Ve({...u,riskLiabilities:[a]});if("10000"===e){if(a.liabilityAttributeValueList=i[0].formulaResult,n.value.signLiabilityClick.length>0){const e=n.value.signLiabilityClick.find((e=>e.item.liabilityCode===a.liabilityCode));e&&d(e.item,e.index)}return{...a,liabilityAttributeValueList:i[0]}}return a}}));console.log("liabilityItem>>>>>>",r),console.log("riskLiabilityInfoVOList>>>>>>",t.dataSource.riskLiabilityInfoVOList)}),{deep:!0,immediate:!0}),s((()=>n.value.liabilityList),(e=>{const a=n.value.liabilityList.filter((e=>"1"===e.isSwitchOn)).map((e=>({...e.liabilityValue})));i("trialChange",a)}),{deep:!0,immediate:!0}),S((()=>{console.log("----mounted"),t.dataSource.riskLiabilityInfoVOList.map(((e,i)=>{const a=e.liabilityAttributeValueList.length>0&&0===e.formula.length&&e.liabilityAttributeValueList[0].displayValue;return n.value.checkValueList[i]||(n.value.checkValueList[i]=a),1!=+e.showFlag&&n.value.liabilityList.push({liabilityValue:e,key:i,isSwitchOn:"1"}),1==+e.showFlag&&(1===e.attributeFlag&&2===e.insureFlag&&0===e.formula.length&&m(e,i,1),1===e.attributeFlag&&1===e.insureFlag&&0===e.formula.length&&m(e,i,2),2===e.attributeFlag&&1===(null==e?void 0:e.liabilityAttributeValueList.length)&&2===e.insureFlag&&m(e,i,1),2===e.attributeFlag&&1===(null==e?void 0:e.liabilityAttributeValueList.length)&&1===e.insureFlag&&m(e,i,2)),null}))})),s((()=>t.defaultValue),(e=>{(null==e?void 0:e.riskCode)&&e.liabilityList&&(n.value.signLiabilityClick=[],t.dataSource.riskLiabilityInfoVOList.forEach(((i,a)=>{var l;const t=null==e?void 0:e.liabilityList.find((e=>e.liabilityCode===i.liabilityCode));console.log("--target lia = ",t),n.value.isCheckList[a]="2",t&&(n.value.isCheckList[a]="1",n.value.checkValueList[a]=null==(l=null==t?void 0:t.liabilityValue)?void 0:l.displayValue,1==+i.showFlag&&2==+i.optionalFlag?r(i,a):o(i,a))})))}),{deep:!0,immediate:!0}),(i,a)=>{const l=he,t=B,s=Z,o=Q;return I(),D(o,null,{default:F((()=>[x("div",yi,[x("div",bi,[(I(!0),w(j,null,J(e.dataSource.riskLiabilityInfoVOList,((e,i)=>(I(),w("div",{key:i},[1!=+e.showFlag||2===e.attributeFlag&&1===(null==e?void 0:e.liabilityAttributeValueList.length)&&2===e.insureFlag?A("",!0):(I(),w("div",gi,[u(t,{label:`${e.liabilityName}`,"label-width":"40%",name:"insuredRelation",class:"riskliab-select-field"},{input:F((()=>[1==+e.insureFlag?(I(),D(l,{key:0,modelValue:T(n).isCheckList[i],"onUpdate:modelValue":e=>T(n).isCheckList[i]=e,"active-value":"1","inactive-value":"2",size:"0.74rem",onClick:a=>r(e,i)},null,8,["modelValue","onUpdate:modelValue","onClick"])):A("",!0)])),_:2},1032,["label"]),1==+T(n).isCheckList[i]&&1===e.attributeFlag||1===e.attributeFlag&&2===e.insureFlag?(I(),D(t,{key:0,label:e.liabilityAttributeTypeDesc,"label-width":"40%",name:"insuredRelation",class:"riskliab-select-field-children"},{input:F((()=>[u(U,{modelValue:T(n).checkValueList[i],"onUpdate:modelValue":e=>T(n).checkValueList[i]=e,prop:{label:"displayValue",value:"displayValue"},options:(e.formula.length,e.liabilityAttributeValueList),"is-simply":!0,onClick:a=>d(e,i)},null,8,["modelValue","onUpdate:modelValue","options","onClick"])])),_:2},1032,["label"])):A("",!0)]))])))),128))])]),Vi,u(s)])),_:1})}}}),[["__scopeId","data-v-50053b39"]]);export{Re as B,Ge as P,ki as R,Ce as S,vi as a};
