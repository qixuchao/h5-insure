import{d as k}from"./vendor-902054a7.js";import{l as K}from"./useStorage-9696cc10.js";import{I as $,R as x,g as F}from"./infoCollection-0841e133.js";import{b as U,a as w,R as D,i as S}from"./trial-40f2c4e1.js";import{a6 as h,K as p,C as L,J as T,a3 as J}from"./index-3a9ce3bd.js";const te=e=>{const{tenantId:t,riskList:i,riskPremium:n,productId:a}=e;return i.map(r=>{var o;return{tenantId:t,amountUnit:1,annuityDrawFrequency:r.annuityDrawDate,annuityDrawType:r.annuityDrawType,paymentFrequency:r.paymentFrequency,paymentPeriod:r.chargePeriod.split("_")[1],paymentPeriodType:U[r.chargePeriod.split("_")[0]],insurancePeriodType:w[r.coveragePeriod==="to_life"?"to_life":r.coveragePeriod.split("_")[0]],insurancePeriodValue:Number.isNaN(+r.coveragePeriod.split("_")[1])?0:r.coveragePeriod.split("_")[1],riskCode:r.riskCode,riskType:r.riskType,riskName:r.riskName,extInfo:{riskId:r.riskId,copy:r.copy},initialPremium:(o=n[r.riskCode])==null?void 0:o.premium,liabilityDetails:r.liabilityVOList.map(l=>({liabilityCode:l.liabilityCode,liabilityName:l.liabilityName,refundMethod:l.liabilityAttributeValue})),productId:a,currentAmount:r.amount,initialAmount:r.amount}})},ie=e=>h(e).map(t=>{const i=t.riskDetailVOList.find(r=>r.riskType===D.MAIN_RISK),n=t.riskDetailVOList.filter(r=>r.riskType===D.RIDER_RISK),a=r=>r.map(s=>{const{riskCategory:o,riskCode:l,riskType:d,id:m,riskInsureLimitVO:u,riskCalcMethodInfoVO:c}=s,{annuityDrawFrequencyList:y,annuityDrawValueList:I,insurancePeriodValueList:f,paymentFrequencyList:N,paymentPeriodValueList:R}=u,{minCopy:C,maxCopy:O,fixedAmount:g,singeAmount:M}=c;return{amount:g||M,annuityDrawDate:I==null?void 0:I[0],annuityDrawFrequency:y==null?void 0:y[0],chargePeriod:R==null?void 0:R[0],copy:C||O||0,coveragePeriod:f==null?void 0:f[0],liabilityVOList:s.riskLiabilityInfoVOList,mainRisk:s.riskCode===i.riskCode,mainRiskCode:s.riskCode===i.riskCode?i.riskCode:void 0,mainRiskId:s.riskCode===i.riskCode?i.riskId:void 0,paymentFrequency:N==null?void 0:N[0],riderRisk:!0,riderRiskVOList:d===1?a(n):[],riskCategory:o,riskCode:l,riskId:m,riskType:d}});return a([i])}).flat(),V=(e,t,i=[],n=F.YEAR,a=!1)=>{const r=e.filter(o=>{try{return o.extraInfo?JSON.parse(o.extraInfo).packageCode?!!i.includes(o.id):!0:!1}catch{return!1}});console.log("lastRiskList",r);const s=r.find(o=>o.riskType===D.MAIN_RISK);return r.map(o=>{const{riskInsureLimitVO:l,riskCategory:d,id:m,riskType:u,riskName:c,riskCode:y,extraInfo:I,riskLiabilityInfoVOList:f,riskCalcMethodInfoVO:N}=o,{insurancePeriodType:R,insurancePeriodValueList:C,paymentFrequencyList:O,paymentPeriodValueList:g,paymentPeriodType:M,annuityDrawFrequencyList:_,annuityDrawValueList:b,insurancePeriodRule:H,paymentPeriodRule:v}=l,{fixedAmount:q,minCopy:B}=N,E={amount:q,riskCode:y,riskId:m,riskName:c,paymentFrequency:(O==null?void 0:O[0])||F.YEAR,extraInfo:I,chargePeriod:g==null?void 0:g[0],annuityDrawDate:b==null?void 0:b[0],riskType:u,annuityDrawFrequency:_==null?void 0:_[0],copy:B,coveragePeriod:C==null?void 0:C[0],insuredCode:t==null?void 0:t.insurerCode,liabilityVOList:f,riskCategory:d};return u===D.MAIN_RISK?E:(H===S.ONE_YEAR&&(E.coveragePeriod="year_1"),v===S.ONE_YEAR&&(E.chargePeriod="year_1"),{...E,mainRiskId:s==null?void 0:s.id,mainRiskCode:s==null?void 0:s.riskCode})})},ne=e=>{var i,n,a;return{orderAmount:e.premium,tenantId:e.tenantId,venderCode:(i=e.detail)==null?void 0:i.insurerCode,applicationNo:e.applicationNo,policyNo:e.policyNo,orderDataSource:"1",saleUserId:e.saleUserId,saleChannelId:e.saleChannelId,orderCategory:e.orderCategory,orderStatus:e.orderStatus,orderTopStatus:e.orderTopStatus,tenantOrderHolder:{tenantId:e.tenantId,name:e.holder.name,certNo:e.holder.certNo,certType:L.CERT,mobile:e.holder.mobile,birthday:p(e.holder.certNo),gender:T(e.holder.certNo),extInfo:{hasSocialInsurance:e.holder.socialFlag}},extInfo:{extraInfo:{renewalDK:e.renewalDK,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,successJumpUrl:e.successJumpUrl},iseeBizNo:e.iseeBizNo},tenantOrderInsuredList:[{tenantId:e.tenantId,relationToHolder:e.insured.relationToHolder,certNo:e.insured.certNo,certType:L.CERT,name:e.insured.name,mobile:e.insured.relationToHolder===x.SELF?e.holder.mobile:"",birthday:p(e.insured.certNo),gender:T(e.insured.certNo),extInfo:{hasSocialInsurance:e.insured.socialFlag},tenantOrderProductList:[{tenantId:e.tenantId,productCode:(n=e.detail)==null?void 0:n.productCode,productName:(a=e.detail)==null?void 0:a.productName,premium:e.premium,tenantOrderRiskList:e.tenantOrderRiskList}]}]}},A=(e,t)=>{if(!e)return"";const[i,n]=e.split("_"),a=parseInt(n,10);return i==="day"?k(t).add(a,"day").format("YYYY-MM-DD"):k(t).add(a,"year").format("YYYY-MM-DD")},P=(e,t=k().format("YYYY-MM-DD"))=>k(e).diff(t,"day"),z=(e,t,i)=>{const n=A(e,i),a=A(t,i);return P(n)<=1&&P(a)>=0},ae=e=>{const{riskCode:t,liabilityCode:i,birth:n,sex:a}=e,r=A("max_18",n);return console.log("lastDate",r),console.log("diffDate(lastDate)",P(r)),!(t==="7Y7"&&i==="FXG086"&&!(a===J.FEMALE&&P(r)<=0))},Y=(e,t,i=n=>!0)=>{const n=p(t),a=T(t),r=[];return e.forEach(s=>{const{riskDetailVOList:o}=s,l=o.map(d=>{const{maxHolderAge:m,minHolderAge:u}=d.riskInsureLimitVO;return z(u,m,n)?(d.riskLiabilityInfoVOList=d.riskLiabilityInfoVOList.filter(c=>i({riskCode:d.riskCode,liabilityCode:c.liabilityCode,birth:n,sex:a})),d):null});r.push({riskDetailVOList:l.filter(d=>!!(d&&d.riskLiabilityInfoVOList.length>0))})}),r},oe=(e,t=!1,i=n=>!0)=>{var r,s,o;let n=[];if(t)n=V((s=(r=Y(h(e.insureDetail.productRiskVoList),e.insured.certNo,i))==null?void 0:r[0])==null?void 0:s.riskDetailVOList,e.productDetail,[],e.paymentFrequency,t);else{const l=Y(h(e.insureDetail.productRiskVoList),e.insured.certNo,i);console.log("===result",[...l]),n=l.map(d=>V(d.riskDetailVOList,e.productDetail,e.packageRiskIdList,e.paymentFrequency,t))}return{calcData:{holder:{personVO:{birthday:p(e.holder.certNo),certType:L.CERT,certNo:e.holder.certNo,gender:Number(T(e.holder.certNo)),mobile:e.holder.mobile,name:e.holder.name,socialFlag:e.holder.socialFlag}},insuredVOList:[{insuredCode:(o=e.productDetail)==null?void 0:o.insurerCode,relationToHolder:e.insured.relationToHolder,personVO:{birthday:p(e.insured.certNo),certType:L.CERT,certNo:e.insured.certNo,gender:Number(T(e.insured.certNo)),name:e.insured.name,socialFlag:e.insured.socialFlag},productPlanVOList:[{riskVOList:n.flat()}]}],productCode:e.productDetail.productCode,tenantId:e.tenantId},riskVOList:n.flat()}},se=e=>e&&e.length?e.filter(i=>i.value===$.INSURE).map(i=>i.productRiskVoList.map(n=>n.id)).flat():[],de=(e,t="year")=>k().diff(p(e),t,!0),X=e=>!e||Number.isNaN(+e.split("_")[1])?0:e==null?void 0:e.split("_")[1],W=e=>{const{tenantId:t,riskList:i,riskPremium:n,productId:a}=e;return i.map(r=>{var o,l,d,m,u;return{tenantId:t,amountUnit:1,annuityDrawFrequency:r.annuityDrawDate,annuityDrawType:r.annuityDrawType,paymentFrequency:r.paymentFrequency,paymentPeriod:0,paymentPeriodType:(o=U)==null?void 0:o[r.chargePeriod],insurancePeriodType:w[r.coveragePeriod==="to_life"?"to_life":(d=(l=r.coveragePeriod)==null?void 0:l.split("_"))==null?void 0:d[0]],insurancePeriodValue:X(r.coveragePeriod),riskCode:r.riskCode,riskType:r.riskType,riskName:r.riskName,extInfo:{riskId:r.riskId,copy:r.copy},initialPremium:(m=n[r.riskCode])==null?void 0:m.premium,liabilityDetails:(u=r.liabilityVOList)==null?void 0:u.map(c=>({liabilityCode:c.liabilityCode,liabilityName:c.liabilityName,refundMethod:c.liabilityAttributeValue})),productId:a,currentAmount:r.amount,initialAmount:r.amount}})},le=e=>{var i,n,a,r;return console.log(e,"freeTransform"),{orderAmount:0,tenantId:e.tenantId,venderCode:e.insureDetail.productBasicInfoVO.insurerCode,orderDataSource:"1",saleUserId:e.saleUserId,saleChannelId:e.saleChannelId,orderCategory:"1",tenantOrderHolder:{tenantId:e.tenantId,certType:e.order.tenantOrderHolder.certEndType,...e.order.tenantOrderHolder},extInfo:{...e.extInfo,templateId:2,buttonCode:e.buttonCode,pageCode:e.pageCode,iseeBizNo:e.iseeBizNo},tenantOrderInsuredList:[{...e.order.tenantOrderInsuredList[0],tenantId:e.tenantId,certType:e.order.tenantOrderInsuredList[0].certEndType,mobile:e.order.tenantOrderInsuredList[0].relationToHolder===x.SELF?e.order.tenantOrderHolder.mobile:"",tenantOrderProductList:[{tenantId:e.tenantId,productCode:(i=e.insureDetail)==null?void 0:i.productBasicInfoVO.productCode,productName:(n=e.insureDetail)==null?void 0:n.productBasicInfoVO.productName,premium:0,tenantOrderRiskList:W({tenantId:e.tenantId,riskList:V(e.insureDetail.productRiskVoList[0].riskDetailVOList,e.detail),riskPremium:{},productId:(a=e.detail)==null?void 0:a.id})}]}],operateOption:(r=e.order)==null?void 0:r.operateOption}},ue=(e,t)=>t.indexOf("$")!==-1?t.replace("$",`${e}`):`${e||""}${t}`,j="PREVIEW_FILE_INFO",ce=e=>{const{origin:t}=window.location;K.set(j,JSON.stringify(e));const i=`${t}/template/filePreview`;console.log("url",i),window.open(i)};export{j as P,se as a,ne as b,de as c,ue as d,le as f,oe as g,ce as o,ie as r,te as t,ae as v};
