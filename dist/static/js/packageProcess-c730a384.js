var ea=Object.defineProperty,aa=Object.defineProperties;var ta=Object.getOwnPropertyDescriptors;var fe=Object.getOwnPropertySymbols;var ra=Object.prototype.hasOwnProperty,oa=Object.prototype.propertyIsEnumerable;var pe=(g,d,v)=>d in g?ea(g,d,{enumerable:!0,configurable:!0,writable:!0,value:v}):g[d]=v,U=(g,d)=>{for(var v in d||(d={}))ra.call(d,v)&&pe(g,v,d[v]);if(fe)for(var v of fe(d))oa.call(d,v)&&pe(g,v,d[v]);return g},H=(g,d)=>aa(g,ta(d));import{g as ua,a9 as na,O as sa,E as c,M as ve,y as he,_ as ye,l as la,h as ia,r as G,af as ca,j as A,n as J,p as D,m as j,H as da,t as X,z as M,A as f,J as V,k as Q,C as Te,F as ma,T as p,D as fa,X as pa}from"./vendor-17026bfd.js";import{_ as va,C as Fe,a1 as ha,I as ya,a4 as Ee,J as ge}from"./index-4214a2e6.js";import{a as Z}from"./order-77e086f2.js";import{S as q,R as _,f as De,I as Fa}from"./infoCollection-b5e96df6.js";import{p as Ce,i as Ea,u as ga,a as Da,s as Ca,g as Na}from"./trial-fc9bdf2b.js";import{p as _a}from"./product-42afcb95.js";import{a as Ne,o as _e,t as Ba,v as ee,g as Be,b as Ia,j as Ie}from"./utils-2cdbe916.js";import{t as wa}from"./theme-ea709837.js";import{d as we,B as Aa,D as Ta,G as Pa,S as ka,H as Sa,P as Oa,U as ba,_ as Ua,W as Ha,a as Ae}from"./auth-0128e859.js";import{_ as La}from"./index-06c18b86.js";import"./trial-467d2694.js";import"./index-e3fda762.js";import"./bankCard-c310db28.js";import"./phoneVerify-c03c298d.js";const xa={key:0},Ra={class:"page-internet-product-detail"},Ma={class:"info"},Va={class:"footer-button"},qa={class:"price"},Ya=Te(" \u603B\u4FDD\u8D39"),$a={key:0},Ka=ua({setup(g){const d=na(),v=sa(),{productCode:ae="BWYL2021",tenantId:E,orderNo:T,phoneNo:Pe,agentCode:L="",saleChannelId:ke,paymentMethod:Se,certNo:te,name:re,pageCode:Oe,from:be}=v.query,oe=c(),m=c(),x=c(),h=c(),Y=Oe==="payBack";c(!1);const B=c(!1),C=c(!1),ue=c(0),$=c(!1),K=c(!1),R=c({show:!1,html:""}),P=c({}),W=c(!1);let z="";const e=ve({holder:{certNo:te,certType:Fe.CERT,mobile:Pe,name:re,socialFlag:q.HAS},insured:{certNo:te,certType:Fe.CERT,name:re,socialFlag:q.HAS,relationToHolder:_.SELF},paymentMethod:Se,renewalDK:"Y",paymentFrequency:De.YEAR,packageProductList:[],mobileSmsCode:""}),ne=c(we),k=c(we),l=ve({showInsure:!Y,canInsure:!1,canUpgrade:!1}),Ue=he(()=>{var t,a;return((a=(t=m.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:a.attachmentVOList.filter(r=>r.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),He=he(()=>{var t,a;return((a=(t=m.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:a.attachmentVOList.filter(r=>r.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),Le=()=>{if(e.holder.certNo){const t=ge(e.holder.certNo);if(ee(e.holder.certNo,18,"year"))return p("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E18\u5C81\uFF01"),!1;if(e.insured.certNo&&e.insured.relationToHolder===_.MATE){const a=ge(e.insured.certNo);if(t===a)return p("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(e.insured.certNo){if(e.insured.relationToHolder===_.CHILD&&ee(e.insured.certNo,30,"day"))return p("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(e.insured.relationToHolder===_.PARENT&&!ee(e.insured.certNo,71,"year"))return p("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E70\u5C81\uFF01"),!1}if([_.CHILD,_.PARENT].includes(e.insured.relationToHolder)){const t=Be(e.holder.certNo,"year"),a=Be(e.insured.certNo,"year");if(e.insured.relationToHolder===_.CHILD&&t-a<18)return p("\u6295\u4FDD\u4EBA\u548C\u5B50\u5973\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1;if(e.insured.relationToHolder===_.PARENT&&a-t<18)return p("\u6295\u4FDD\u4EBA\u548C\u7236\u6BCD\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1}return!0},xe=()=>{const{holder:{certNo:t,mobile:a,name:r,socialFlag:u},insured:{certNo:o,name:n,socialFlag:s,relationToHolder:y},paymentMethod:F}=e;return!!(ya(o)&&!!s)},se=()=>{d.push({path:"/internet/guaranteeUpgrade",query:H(U({},v.query),{tenantId:E,productCode:"BWYL2022",orderNo:T,agentCode:L})})},Re=()=>{K.value=!1},Me=()=>{k.value=ne.value},Ve=()=>{k.value=H(U({},k.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},qe=async t=>{p.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0,duration:0});try{const a=await ga(t),{code:r}=a;if(r==="10000"){const u=await Da({orderNo:t.orderNo,tenantId:E}),{data:o}=u;u.code==="10000"&&(o.type===2?(R.value={show:!0,html:o.paymentUrl},console.log("data.paymentUrl",R.value),pa(()=>{console.log("document.forms",document.forms);const n=document.getElementById("cashierSubmit");n==null||n.addEventListener("submit",s=>{s.preventDefault()}),n==null||n.submit()})):window.location.href=o.paymentUrl)}l.canInsure=!0}catch{l.canInsure=!0}finally{p.clear()}},Ye=t=>`${Ee}/pay?orderNo=${t}&saleUserId=${L}&tenantId=${E}`,$e=t=>`${Ee}/internet/payFail?tenantId=${E}&orderNo=${t}&agentCode=${L}&pageCode=payBack&from=${be||"normal"}`,Ke=t=>{ue.value=t,C.value=!0},We=async t=>{console.log("risk",t);const a=Ia({tenantId:E,saleUserId:L,saleChannelId:ke,detail:m.value,insureDetail:x.value,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,renewalDK:e.renewalDK,iseeBizNo:z,successJumpUrl:"",premium:h.value,holder:e.holder,insured:e.insured,tenantOrderRiskList:t,orderStatus:"",orderTopStatus:""});try{const r=await Ca(a),{code:u,data:o}=r;C.value=!1,B.value=!1,u==="10000"&&(p.clear(),P.value={orderNo:o.data,order:a},console.log("11111"),C.value=!0,Ke(0))}catch{p.clear(),l.canInsure=!0}},ze=async()=>{const{calcData:t,riskVOList:a}=Ne({holder:e.holder,insured:e.insured,tenantId:E,productDetail:m.value,insureDetail:x.value,paymentFrequency:e.paymentFrequency,packageRiskIdList:_e(e.packageProductList)},!1,Ie);if(!Array.isArray(a)||a.length<1)return p("\u88AB\u4FDD\u4EBA\u5E74\u9F84\u9700\u572830\u5929(\u542B) - 70\u5C81(\u542B)\u4E4B\u95F4\uFF01"),h.value=null,{};W.value=!0;const r=await Ce(t);W.value=!1;const{code:u,data:o}=r;return u==="10000"?e.insured.certNo?(h.value=o.premium,{condition:a,data:o}):(h.value=null,{condition:a,data:o}):(h.value=null,{})},Ge=()=>new Promise((t,a)=>{var r,u;(u=(r=oe.value)==null?void 0:r.validateForm)==null||u.call(r).then(async()=>{if(!Le()){l.canInsure=!0;return}const{calcData:o,riskVOList:n}=Ne({holder:e.holder,insured:e.insured,tenantId:E,productDetail:m.value,insureDetail:x.value,paymentFrequency:e.paymentFrequency,packageRiskIdList:_e(e.packageProductList)},!1,Ie);(!Array.isArray(n)||n.length<1)&&(p("\u88AB\u4FDD\u4EBA\u5E74\u9F84\u9700\u572830\u5929(\u542B) - 70\u5C81(\u542B)\u4E4B\u95F4\uFF01"),h.value=null,a(new Error));const s=await Ce(o),{code:y,data:F}=s;y==="10000"?(h.value=F.premium,t({condition:n,data:F})):(h.value=null,a(new Error))}).catch(()=>{l.canInsure=!0})}),Je=async()=>{var t;if(Y){se();return}try{p.loading({message:"\u8BA2\u5355\u751F\u6210\u4E2D...",forbidClick:!0,duration:0});const{condition:a,data:r}=await Ge(),u={},o=(s=[])=>{(s||[]).forEach(y=>{var F;u[y.riskCode]=y,((F=y.riskPremiumDetailVOList)==null?void 0:F.length)&&o(y.riskPremiumDetailVOList)})};o(r.riskPremiumDetailVOList);const n=Ba({tenantId:E,riskList:a,riskPremium:u,productId:(t=m.value)==null?void 0:t.id});We(n)}catch{l.canInsure=!0}finally{p.clear()}},je=t=>{t==="allFalse"?(B.value=!1,l.canInsure=!0,qe(H(U({},P.value.order),{orderNo:P.value.orderNo,extInfo:{extraInfo:{renewalDK:e.renewalDK,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,successJumpUrl:Ye(P.value.orderNo),failUrl:$e(P.value.orderNo)},iseeBizNo:z}}))):fa.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"}).then(()=>{window.history.back()}).catch(()=>{l.canInsure=!0})},le=()=>{C.value=!1,B.value=!1,l.canInsure=!0},Xe=()=>{C.value=!1,B.value=!0};ye([()=>e.insured.certNo,()=>e.insured.socialFlag,()=>e.packageProductList,()=>e.paymentFrequency],la.exports.debounce(()=>{e.insured.certNo&&e.insured.socialFlag&&xe()&&ze()},500),{deep:!0,immediate:!0}),ye(()=>e.insured.certNo,()=>{e.insured.certNo||(h.value=null)});const ie=async()=>{var u,o,n,s,y,F,I,S,O,b,ce,de,me;const t=await Na({orderNo:T,tenantId:E}),{code:a,data:r}=t;if(a==="10000"){const{tenantOrderHolder:N,tenantOrderInsuredList:i,extInfo:w}=r;if(!Y){Object.assign(e,{holder:{certNo:N.certNo,certType:N.certType,mobile:N.mobile,name:N.name,socialFlag:q.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(u=i[0])==null?void 0:u.certType,name:(o=i[0])==null?void 0:o.name,socialFlag:(s=(n=i[0])==null?void 0:n.extInfo)==null?void 0:s.hasSocialInsurance,relationToHolder:(y=i[0])==null?void 0:y.relationToHolder},paymentMethod:w.extraInfo.paymentMethod,paymentFrequency:w.extraInfo.paymentFrequency,renewalDK:w.extraInfo.renewalDK||"N"}),l.canInsure=!0;return}Object.assign(e,{holder:{certNo:N.certNo,certType:N.certType,mobile:N.mobile,name:N.name,socialFlag:q.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(F=i[0])==null?void 0:F.certType,name:(I=i[0])==null?void 0:I.name,socialFlag:(O=(S=i[0])==null?void 0:S.extInfo)==null?void 0:O.hasSocialInsurance,relationToHolder:(b=i[0])==null?void 0:b.relationToHolder},paymentMethod:w.extraInfo.paymentMethod,paymentFrequency:w.extraInfo.paymentFrequency,renewalDK:w.extraInfo.renewalDK||"N"}),h.value=(me=(de=(ce=i[0])==null?void 0:ce.tenantOrderProductList)==null?void 0:de[0])==null?void 0:me.premium,(r.orderStatus===Z.ACCEPT_POLICY||r.orderStatus===Z.PAYMENT_SUCCESS)&&(l.canUpgrade=!0,$.value=!1,K.value=!0),r.orderStatus===Z.PAYING&&($.value=!0,setTimeout(()=>{ie()},3*1e3))}},Qe=async()=>{const t=_a({productCode:ae,withInsureInfo:!0,tenantId:E}),a=Ea({productCode:ae});await Promise.all([t,a]).then(([r,u])=>{var o,n;r.code==="10000"&&(m.value=r.data,document.title=((o=r.data)==null?void 0:o.productFullName)||""),u.code==="10000"&&(e.packageProductList=(((n=u.data)==null?void 0:n.packageProductVOList)||[]).map(s=>H(U({},s),{value:Fa.UN_INSURE,disabled:!1})),x.value=u.data)}),T&&ie()},Ze=()=>{console.log("\u6295\u4FDD\u94FE\u63A5"),k.value=Ae,ne.value=Ae,l.canInsure=!0};return ia(()=>{Ze(),Qe(),setTimeout(async()=>{z=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(t,a)=>{const r=G("van-loading"),u=G("van-button"),o=G("van-config-provider"),n=ca("dompurify-html");return A(),J(ma,null,[D(o,{"theme-vars":f(wa)},{default:j(()=>{var s,y,F,I,S,O,b;return[R.value.show?da((A(),J("div",xa,null,512)),[[n,R.value.html]]):X("",!0),M("div",Ra,[M("div",Ma,[D(Aa,{url:(y=(s=m.value)==null?void 0:s.tenantProductInsureVO)==null?void 0:y.banner[0]},null,8,["url"]),D(Ta,{"product-name":(F=m.value)==null?void 0:F.productFullName,"product-desc":(S=(I=m.value)==null?void 0:I.showConfigVO)==null?void 0:S.desc},null,8,["product-name","product-desc"])]),D(Pa,{"show-service-config":"","guarantee-list":(b=(O=m.value)==null?void 0:O.tenantProductInsureVO)==null?void 0:b.titleAndDescVOS},null,8,["guarantee-list"]),D(ka,{detail:m.value},{form:j(()=>[D(Sa,{ref_key:"formRef",ref:oe,"is-show-package":"",disable:!f(l).showInsure,"form-auth":k.value,"form-info":f(e),"product-detail":m.value,onOnReset:Me,onOnUpdate:Ve},null,8,["disable","form-auth","form-info","product-detail"])]),_:1},8,["detail"]),M("div",Va,[M("div",qa,[Ya,W.value?(A(),Q(r,{key:1,class:"premium-loading",type:"spinner"})):(A(),J("span",$a,V(h.value?"\uFFE5":"")+V(f(ha)(h.value))+" "+V(h.value?f(e).paymentFrequency==f(De).YEAR?"\u5143/\u5E74":"\u5143/\u6708":""),1))]),D(u,{type:"primary",class:"right",disabled:!(f(l).canInsure||f(l).canUpgrade),onClick:Je},{default:j(()=>[Te(V(f(l).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),f(T)?X("",!0):(A(),Q(Oa,{key:1,"product-detail":m.value},null,8,["product-detail"])),D(ba,{"order-no":f(T),"tenant-id":f(E),"is-show":K.value,onOnConfirm:se,onOnClose:Re},null,8,["order-no","tenant-id","is-show"])]}),_:1},8,["theme-vars"]),D(Ua,{show:B.value,"onUpdate:show":a[0]||(a[0]=s=>B.value=s),"content-list":f(Ue),"active-index":0,onOnConfirmHealth:je,onOnCloseHealth:le},null,8,["show","content-list"]),C.value?(A(),Q(La,{key:0,show:C.value,"onUpdate:show":a[1]||(a[1]=s=>C.value=s),"content-list":f(He),"active-index":ue.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9","force-read-cound":2,"on-close-file-preview":"",onSubmit:Xe,onOnCloseFilePreview:le},null,8,["show","content-list","active-index"])):X("",!0),D(Ha,{"is-show":$.value},null,8,["is-show"])],64)}}});var st=va(Ka,[["__scopeId","data-v-3487c482"]]);export{st as default};
