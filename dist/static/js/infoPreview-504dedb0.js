import{d as e,af as a,ag as t,i as o,h as n,cb as s,r as i,j as r,aG as l,l as u,o as d,c,b as f,w as p,u as m,p as y,q as I,f as v,F as h,s as w,a as b,g,v as j,e as C,dH as x,ah as q,bH as V,ak as P,d4 as T,bK as k,aS as L,dN as _,aQ as E,aN as N,c4 as O,T as R,c8 as U}from"./index-b9c83637.js";import{P as A,a as S}from"./PolicyInfo-807b8637.js";import{g as D,m as F}from"./trial-5ccb6258.js";import{n as M}from"./nextStep-97381ad5.js";import{b as Q,l as B}from"./product-67329384.js";import{u as J}from"./useOrder-44d0c8c0.js";import{P as $}from"./constants-6c7c253a.js";import{P as G}from"./index-d39aa868.js";import{P as W}from"./index-7d2f5840.js";import{_ as z}from"./InsureInfo-e22166dd.js";import{p as H,d as K}from"./utils-074abb64.js";import{Q as X}from"./notice-33e6eedd.js";import{g as Y}from"./utils-835719b9.js";import{Q as Z}from"./questionnaire-42dcb602.js";import{P as ee}from"./constants-b39aa53b.js";import{T as ae}from"./infoCollection-e1fbeede.js";import{i as te}from"./core-0c8f6d3b.js";import"./cloneDeep-158e5eb3.js";import"./util-7eee3073.js";import"./trial-24156292.js";const oe={class:"long-info-preview"},ne={class:"footer-button"},se=e({__name:"infoPreview",setup(e){const se=a((()=>t((()=>import("./index-7f447d45.js")),["static/js/index-7f447d45.js","static/css/index-fa4edf2a.css","static/js/index-b9c83637.js","static/css/index-0a143403.css","static/js/theme-94cf7d00.js","static/js/index-7d2f5840.js","static/css/index-bbfdd7ec.css","static/js/utils-835719b9.js","static/js/infoCollection-e1fbeede.js","static/js/trial-24156292.js"]))),ie=o(),re=n(),le=J({}),{productCode:ue="",tenantId:de,agentCode:ce="",agencyCode:fe,saleChannelId:pe,isShare:me,orderNo:ye,extraInfo:Ie,insurerCode:ve,objectType:he="1",templateId:we,preview:be,origin:ge,pageType:je}=ie.query;let Ce={};try{Ce=JSON.parse(decodeURIComponent(Ie))}catch(Be){}const[xe,qe]=s(!1),Ve=i({isView:!1,personalInfo:{},policyInfo:{schema:[],config:[],formData:{}},payInfo:{schema:[],config:[],formData:[]},customerQuestions:[]}),Pe=`${window.origin}/baseInsurance/long/phoneVerify${window.location.search}`;r({imgUrl:"",desc:"",title:"",link:Pe});const Te=r(),ke=r(),Le=r(!1),_e=r(!1),Ee=r(0),Ne=r(!1),Oe=()=>{_e.value=!1},Re=()=>{Le.value=!0,le.value.extInfo.buttonCode=x.short.underWrite,le.value.extInfo.pageCode="infoPreview",M(le.value,((e,a,t)=>{E.JUMP_ALERT===a&&N.confirm({title:"核保失败",message:t,cancelButtonText:"修改信息",confirmButtonText:"放弃投保"}).then((()=>{te?O.closeWindow():window.close()})).catch((()=>{re.push({path:$.productInfo,query:ie.query})}))}))},Ue=()=>{we===ae.FREE?(le.value.extInfo.buttonCode=x.free.faceVerify,le.value.extInfo.pageCode="faceAuth",M(le.value,((e,a)=>{a===E.JUMP_PAGE&&R("被保人已完成认证")}))):"true"===je?(delete ie.query.pageType,re.push({path:$.holderInfoPreview,query:ie.query})):(le.value.extInfo.buttonCode=x.short.faceVerify,le.value.extInfo.pageCode="faceAuth",M(le.value,((e,a)=>{a===E.JUMP_PAGE&&R("被保人已完成认证")})))},Ae=async()=>{if(we===ae.FREE){le.value.extInfo.buttonCode=x.free.faceVerify,le.value.extInfo.pageCode="faceAuth",await M(le.value);const{code:e,data:a}=await D({orderNo:ye,tenantId:de});"10000"===e&&(Object.assign(le.value,a),le.value.extInfo.buttonCode=x.free.underWriteAndIssue,le.value.extInfo.pageCode="productInfo",M(le.value,((e,a)=>{a===E.JUMP_PAGE&&(delete ie.query.pageType,re.push({path:ee[e.nextPageCode],query:ie.query}))})))}else{if(Le.value)return void Re();qe(!0)}},Se=r(),De=r(),Fe=r([]),Me=async()=>{var e;let a={};const{code:t,data:o}=await D({orderNo:ye,tenantId:de});"10000"===t&&(Object.assign(le.value,o),a=H(o.insuredList[0].productList),Se.value=o,Ne.value=!0);const{planCode:n}=(null==(e=o.insuredList)?void 0:e[0])||{};(async e=>{let a=[];const{code:t,data:o}=await U({orderNo:ye,tenantId:de});"10000"===t&&(a=o.productQuestionnaireVOList);const{code:n,data:s}=await B(e);if("10000"===n){const{productQuestionnaireVOList:e}=s||{},t=e.filter((e=>e.businessType!==X.VISIT));Ve.customerQuestions=t.map((e=>{const{questionnaireDetailResponseVO:t,questionnaireId:o,questionnaireName:n}=e||{},{questions:s,basicInfo:i}=t||{},{objectType:r,questionnaireType:l}=i||{};if(l===Z.TEXT){const{content:e,textType:a}=(null==s?void 0:s[0])||{};return{content:e,contentType:Y(`${a}`,e),questionnaireId:o,questionnaireName:n}}const u=(a||[]).find((e=>e.questionnaireId===o));return{...t,contentType:"question",...null==u?void 0:u.questionnaireDetailResponseVO,questionnaireId:o,questionnaireName:n}}))}})({productCodeList:a.productList.map((e=>e.productCode))}),Q(a).then((({code:e,data:a})=>{if("10000"===e){const{productMaterialList:e,riskMaterialList:t}=K(a,n);Ve.fileList=e.map((e=>({tabName:e.attachmentName,isExpand:!0,files:e.attachmentList.map((e=>({name:e.materialName,file:e.materialContent,type:e.materialSource,mustRead:e.mustReadFlag===q.YES})))}))),Fe.value=e.concat(t)}})),F(a).then((({data:e,code:a})=>{if("10000"===a){const{productDetailResList:a,productFactor:t}=e;De.value=t;const{payInfo:o,other:n}=V(t);Ve.payInfo={...Ve.payInfo,...o},Ve.policyInfo={...Ve.policyInfo,...n}}}))};l((()=>{Me()}));const Qe=r();return u((()=>{setTimeout((async()=>{Qe.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,a)=>{var t,o,n;const s=P,i=T,r=k,l=L,u=_;return d(),c("div",oe,[f(s),f(z,{"product-data":null==(o=null==(t=m(le).insuredList)?void 0:t[0])?void 0:o.productList},{default:p((()=>[f(i,{title:"生效时间",content:m(le).commencementTime},null,8,["content"])])),_:1},8,["product-data"]),(null==(n=Object.keys(m(De)||{}))?void 0:n.length)?(d(),y(G,{key:0,ref_key:"personalInfoRef",ref:ke,modelValue:m(Se),"onUpdate:modelValue":a[0]||(a[0]=e=>I(Se)?Se.value=e:null),"product-factor":m(De),"is-view":""},null,8,["modelValue","product-factor"])):v("",!0),m(Ve).payInfo.schema.length?(d(),y(m(A),{key:1,ref_key:"payInfoRef",ref:Te,modelValue:m(le).tenantOrderPayInfoList,"onUpdate:modelValue":a[1]||(a[1]=e=>m(le).tenantOrderPayInfoList=e),schema:m(Ve).payInfo.schema,"is-view":""},null,8,["modelValue","schema"])):v("",!0),m(Ve).policyInfo.schema.length?(d(),y(m(S),{key:2,modelValue:m(le).extInfo,"onUpdate:modelValue":a[2]||(a[2]=e=>m(le).extInfo=e),schema:m(Ve).policyInfo.schema,"is-view":""},null,8,["modelValue","schema"])):v("",!0),f(l,{title:"产品资料","show-line":!1,"show-icon":!1},{default:p((()=>[(d(!0),c(h,null,w(m(Fe),((e,a)=>(d(),y(r,{key:a,"is-link":"",title:e.attachmentName,onClick:e=>(e=>{Ee.value=e,_e.value=!0})(a)},null,8,["title","onClick"])))),128))])),_:1}),b("div",ne,["share"===m(ge)||m(je)?(d(),y(W,{key:0,shadow:!1,onClick:Ue},{default:p((()=>[g(e.$slots,"default",{},(()=>[j("确认")]))])),_:3})):(d(),y(W,{key:1,shadow:!1,onClick:Ae},{default:p((()=>[g(e.$slots,"default",{},(()=>[j(C(m(we)===m(ae).FREE?"领取保障并激活":"确认支付"),1)]))])),_:3}))]),m(_e)?(d(),y(m(se),{key:3,show:m(_e),"onUpdate:show":a[3]||(a[3]=e=>I(_e)?_e.value=e:null),"content-list":[m(Fe)[m(Ee)]],"is-only-view":"","active-index":0,text:"关闭","force-read-cound":0,onOnCloseFilePreviewByMask:Oe},null,8,["show","content-list"])):v("",!0),m(xe)?(d(),y(u,{key:4,modelValue:m(xe),"onUpdate:modelValue":a[4]||(a[4]=e=>I(xe)?xe.value=e:null),closeable:!1,"data-source":m(Ve).fileList,onSubmit:Re},null,8,["modelValue","data-source"])):v("",!0)])}}});export{se as default};
