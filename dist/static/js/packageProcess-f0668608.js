var ea=Object.defineProperty,aa=Object.defineProperties;var ta=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var ra=Object.prototype.hasOwnProperty,oa=Object.prototype.propertyIsEnumerable;var de=(E,c,f)=>c in E?ea(E,c,{enumerable:!0,configurable:!0,writable:!0,value:f}):E[c]=f,b=(E,c)=>{for(var f in c||(c={}))ra.call(c,f)&&de(E,f,c[f]);if(ce)for(var f of ce(c))oa.call(c,f)&&de(E,f,c[f]);return E},H=(E,c)=>aa(E,ta(c));import{g as ua,a9 as na,O as sa,E as h,M as me,y as fe,_ as pe,l as la,h as ia,r as he,af as ca,j as V,n as ve,p as g,m as G,H as da,t as J,z as O,A as m,J as q,C as Ae,k as Fe,F as ma,T as D,D as fa,X as pa}from"./vendor-9d7eb2ed.js";import{_ as ha,C as ye,a1 as va,I as Fa,J as Ee,a4 as ge}from"./index-eaa3a53d.js";import{a as j}from"./order-4d6b5c85.js";import{S as Y,R as I,f as De,I as ya}from"./infoCollection-407f49da.js";import{p as Ce,i as Ea,s as ga,g as Da,u as Ca,a as Na}from"./trial-c32bdede.js";import{p as Ia}from"./product-a0cc1993.js";import{a as Ne,o as Ie,t as Ba,g as U,b as wa,h as Be}from"./utils-fc57417e.js";import{t as _a}from"./theme-ea709837.js";import{d as we,B as Aa,D as Pa,G as Ta,S as ka,H as Sa,P as ba,U as Ha,_ as Oa,W as Ua,a as _e}from"./auth-49e1cd7d.js";import{_ as La}from"./index-f6e89199.js";import"./trial-9304695c.js";import"./index-194968bc.js";import"./bankCard-eef57130.js";import"./phoneVerify-f04a588a.js";const xa={key:0},Ra={class:"page-internet-product-detail"},Ma={class:"info"},Va={class:"footer-button"},qa={class:"price"},Ya=Ae(" \u603B\u4FDD\u8D39"),$a=ua({setup(E){const c=na(),f=sa(),{productCode:X="BWYL2021",tenantId:F,orderNo:_,phoneNo:Pe,agentCode:L="",saleChannelId:Te,paymentMethod:ke,certNo:Q,name:Z,pageCode:Se,from:be}=f.query,x=h(),d=h(),R=h(),v=h(),$=Se==="payBack",A=h(!1),P=h(!1),B=h(!1),ee=h(0),K=h(!1),W=h(!1),M=h({show:!1,html:""});let z="";const e=me({holder:{certNo:Q,certType:ye.CERT,mobile:Pe,name:Z,socialFlag:Y.HAS},insured:{certNo:Q,certType:ye.CERT,name:Z,socialFlag:Y.HAS,relationToHolder:I.SELF},paymentMethod:ke,renewalDK:"Y",paymentFrequency:De.YEAR,packageProductList:[],mobileSmsCode:""}),ae=h(we),T=h(we),s=me({showInsure:!$,canInsure:!1,canUpgrade:!1}),He=fe(()=>{var a,t;return((t=(a=d.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(r=>r.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),Oe=fe(()=>{var a,t;return((t=(a=d.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(r=>r.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),Ue=()=>{if(e.holder.certNo){const a=U(e.holder.certNo,"year"),t=Ee(e.holder.certNo);if(a<18)return D("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E18\u5C81\uFF01"),!1;if(e.insured.certNo&&e.insured.relationToHolder===I.MATE){const r=Ee(e.insured.certNo);if(t===r)return D("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(e.insured.certNo){const a=U(e.insured.certNo,"day"),t=U(e.insured.certNo,"year");if(e.insured.relationToHolder===I.CHILD&&a<30)return D("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(e.insured.relationToHolder===I.PARENT&&t>=71)return D("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E70\u5C81\uFF01"),!1}if([I.CHILD,I.PARENT].includes(e.insured.relationToHolder)){const a=U(e.holder.certNo,"year"),t=U(e.insured.certNo,"year");if(e.insured.relationToHolder===I.CHILD&&a-t<18)return D("\u6295\u4FDD\u4EBA\u548C\u5B50\u5973\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1;if(e.insured.relationToHolder===I.PARENT&&t-a<18)return D("\u6295\u4FDD\u4EBA\u548C\u7236\u6BCD\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1}return!0},Le=()=>{const{holder:{certNo:a,mobile:t,name:r,socialFlag:n},insured:{certNo:o,name:u,socialFlag:l,relationToHolder:p},paymentMethod:y}=e;return!!(Fa(o)&&!!l)},te=()=>{c.push({path:"/internet/guaranteeUpgrade",query:H(b({},f.query),{tenantId:F,productCode:"BWYL2022",orderNo:_,agentCode:L})})},xe=()=>{W.value=!1},Re=()=>{T.value=ae.value},Me=()=>{T.value=H(b({},T.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},Ve=async a=>{D.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const t=await Ca(a),{code:r}=t;if(r==="10000"){D.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const n=await Na({orderNo:a.orderNo,tenantId:F}),{data:o}=n;n.code==="10000"&&(o.type===2?(M.value={show:!0,html:o.paymentUrl},console.log("data.paymentUrl",M.value),pa(()=>{console.log("document.forms",document.forms);const u=document.getElementById("cashierSubmit");u==null||u.addEventListener("submit",l=>{l.preventDefault()}),u==null||u.submit()})):window.location.href=o.paymentUrl)}s.canInsure=!0}catch{s.canInsure=!0}},qe=a=>`${ge}/pay?orderNo=${a}&saleUserId=${L}&tenantId=${F}`,Ye=a=>`${ge}/internet/payFail?tenantId=${F}&orderNo=${a}&agentCode=${L}&pageCode=payBack&from=${be||"normal"}`,$e=async a=>{console.log("risk",a);const t=wa({tenantId:F,saleUserId:L,saleChannelId:Te,detail:d.value,insureDetail:R.value,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,renewalDK:e.renewalDK,iseeBizNo:z,successJumpUrl:"",premium:v.value,holder:e.holder,insured:e.insured,tenantOrderRiskList:a,orderStatus:"",orderTopStatus:""});try{const r=await ga(t),{code:n,data:o}=r;n==="10000"&&Ve(H(b({},t),{orderNo:o.data,extInfo:{extraInfo:{renewalDK:e.renewalDK,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,successJumpUrl:qe(o.data),failUrl:Ye(o.data)},iseeBizNo:z}}))}catch{s.canInsure=!0}},Ke=async()=>{const{calcData:a,riskVOList:t}=Ne({holder:e.holder,insured:e.insured,tenantId:F,productDetail:d.value,insureDetail:R.value,paymentFrequency:e.paymentFrequency,packageRiskIdList:Ie(e.packageProductList)},!1,Be);if(!Array.isArray(t)||t.length<1)return D("\u88AB\u4FDD\u4EBA\u5E74\u9F84\u9700\u572830\u5929(\u542B) - 70\u5C81(\u542B)\u4E4B\u95F4\uFF01"),v.value=null,{};const r=await Ce(a),{code:n,data:o}=r;return n==="10000"?(v.value=o.premium,{condition:t,data:o}):(v.value=null,{})},We=a=>{ee.value=a,B.value=!0},ze=()=>new Promise((a,t)=>{var r,n;(n=(r=x.value)==null?void 0:r.validateForm)==null||n.call(r).then(async()=>{if(!Ue()){s.canInsure=!0;return}if(!A.value){A.value=!1,B.value=!0,We(0);return}const{calcData:u,riskVOList:l}=Ne({holder:e.holder,insured:e.insured,tenantId:F,productDetail:d.value,insureDetail:R.value,paymentFrequency:e.paymentFrequency,packageRiskIdList:Ie(e.packageProductList)},!1,Be);(!Array.isArray(l)||l.length<1)&&(D("\u88AB\u4FDD\u4EBA\u5E74\u9F84\u9700\u572830\u5929(\u542B) - 70\u5C81(\u542B)\u4E4B\u95F4\uFF01"),v.value=null,t(new Error));const p=await Ce(u),{code:y,data:C}=p;y==="10000"?(v.value=C.premium,a({condition:l,data:C})):(v.value=null,t(new Error))}).catch(()=>{s.canInsure=!0})}),re=async()=>{var a;if($){te();return}s.canInsure=!1;try{const{condition:t,data:r}=await ze(),n={},o=(l=[])=>{(l||[]).forEach(p=>{var y;n[p.riskCode]=p,((y=p.riskPremiumDetailVOList)==null?void 0:y.length)&&o(p.riskPremiumDetailVOList)})};o(r.riskPremiumDetailVOList);const u=Ba({tenantId:F,riskList:t,riskPremium:n,productId:(a=d.value)==null?void 0:a.id});$e(u)}catch{s.canInsure=!0}},Ge=a=>{a==="allFalse"?(P.value=!1,A.value=!0,re(),s.canInsure=!0):fa.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"}).then(()=>{window.history.back()}).catch(()=>{var t;(t=x.value)==null||t.reEditForm(),A.value=!1,s.canInsure=!0})},oe=()=>{var a;(a=x.value)==null||a.reEditForm(),A.value=!1,s.canInsure=!0},Je=()=>{console.log("onCloseHealthPopup========"),P.value=!1,oe()},je=()=>{console.log("onCloseFilePreview========"),B.value=!1,oe()},Xe=()=>{B.value=!1,P.value=!0};pe([()=>e.insured.certNo,()=>e.insured.socialFlag,()=>e.packageProductList,()=>e.paymentFrequency],la.exports.debounce(()=>{e.insured.certNo&&e.insured.socialFlag&&Le()&&Ke()},500),{deep:!0,immediate:!0}),pe(()=>e.insured.certNo,()=>{e.insured.certNo||(v.value=null)});const ue=async()=>{var n,o,u,l,p,y,C,k,S,ne,se,le,ie;const a=await Da({orderNo:_,tenantId:F}),{code:t,data:r}=a;if(t==="10000"){const{tenantOrderHolder:N,tenantOrderInsuredList:i,extInfo:w}=r;if(!$){Object.assign(e,{holder:{certNo:N.certNo,certType:N.certType,mobile:N.mobile,name:N.name,socialFlag:Y.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(n=i[0])==null?void 0:n.certType,name:(o=i[0])==null?void 0:o.name,socialFlag:(l=(u=i[0])==null?void 0:u.extInfo)==null?void 0:l.hasSocialInsurance,relationToHolder:(p=i[0])==null?void 0:p.relationToHolder},paymentMethod:w.extraInfo.paymentMethod,paymentFrequency:w.extraInfo.paymentFrequency,renewalDK:w.extraInfo.renewalDK||"N"}),s.canInsure=!0;return}Object.assign(e,{holder:{certNo:N.certNo,certType:N.certType,mobile:N.mobile,name:N.name,socialFlag:Y.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(y=i[0])==null?void 0:y.certType,name:(C=i[0])==null?void 0:C.name,socialFlag:(S=(k=i[0])==null?void 0:k.extInfo)==null?void 0:S.hasSocialInsurance,relationToHolder:(ne=i[0])==null?void 0:ne.relationToHolder},paymentMethod:w.extraInfo.paymentMethod,paymentFrequency:w.extraInfo.paymentFrequency,renewalDK:w.extraInfo.renewalDK||"N"}),v.value=(ie=(le=(se=i[0])==null?void 0:se.tenantOrderProductList)==null?void 0:le[0])==null?void 0:ie.premium,(r.orderStatus===j.ACCEPT_POLICY||r.orderStatus===j.PAYMENT_SUCCESS)&&(s.canUpgrade=!0,K.value=!1,W.value=!0),r.orderStatus===j.PAYING&&(K.value=!0,setTimeout(()=>{ue()},3*1e3))}},Qe=async()=>{const a=Ia({productCode:X,withInsureInfo:!0,tenantId:F}),t=Ea({productCode:X});await Promise.all([a,t]).then(([r,n])=>{var o,u;r.code==="10000"&&(d.value=r.data,document.title=((o=r.data)==null?void 0:o.productFullName)||""),n.code==="10000"&&(e.packageProductList=(((u=n.data)==null?void 0:u.packageProductVOList)||[]).map(l=>H(b({},l),{value:ya.UN_INSURE,disabled:!1})),R.value=n.data)}),_&&ue()},Ze=()=>{console.log("\u6295\u4FDD\u94FE\u63A5"),T.value=_e,ae.value=_e,s.canInsure=!0};return ia(()=>{Ze(),Qe(),setTimeout(async()=>{z=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(a,t)=>{const r=he("van-button"),n=he("van-config-provider"),o=ca("dompurify-html");return V(),ve(ma,null,[g(n,{"theme-vars":m(_a)},{default:G(()=>{var u,l,p,y,C,k,S;return[M.value.show?da((V(),ve("div",xa,null,512)),[[o,M.value.html]]):J("",!0),O("div",Ra,[O("div",Ma,[g(Aa,{url:(l=(u=d.value)==null?void 0:u.tenantProductInsureVO)==null?void 0:l.banner[0]},null,8,["url"]),g(Pa,{"product-name":(p=d.value)==null?void 0:p.productFullName,"product-desc":(C=(y=d.value)==null?void 0:y.showConfigVO)==null?void 0:C.desc},null,8,["product-name","product-desc"])]),g(Ta,{"show-service-config":"","guarantee-list":(S=(k=d.value)==null?void 0:k.tenantProductInsureVO)==null?void 0:S.titleAndDescVOS},null,8,["guarantee-list"]),g(ka,{detail:d.value},{form:G(()=>[g(Sa,{ref_key:"formRef",ref:x,"is-show-package":"",disable:!m(s).showInsure,"form-auth":T.value,"form-info":m(e),"product-detail":d.value,onOnReset:Re,onOnUpdate:Me},null,8,["disable","form-auth","form-info","product-detail"])]),_:1},8,["detail"]),O("div",Va,[O("div",qa,[Ya,O("span",null,q(v.value?"\uFFE5":"")+q(m(va)(v.value))+" "+q(v.value?m(e).paymentFrequency==m(De).YEAR?"\u5143/\u5E74":"\u5143/\u6708":""),1)]),g(r,{type:"primary",class:"right",disabled:!(m(s).canInsure||m(s).canUpgrade),onClick:re},{default:G(()=>[Ae(q(m(s).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),m(_)?J("",!0):(V(),Fe(ba,{key:1,"product-detail":d.value},null,8,["product-detail"])),g(Ha,{"order-no":m(_),"tenant-id":m(F),"is-show":W.value,onOnConfirm:te,onOnClose:xe},null,8,["order-no","tenant-id","is-show"])]}),_:1},8,["theme-vars"]),g(Oa,{show:P.value,"onUpdate:show":t[0]||(t[0]=u=>P.value=u),"content-list":m(He),"active-index":0,onOnConfirmHealth:Ge,onOnCloseHealth:Je},null,8,["show","content-list"]),B.value?(V(),Fe(La,{key:0,show:B.value,"onUpdate:show":t[1]||(t[1]=u=>B.value=u),"content-list":m(Oe),"active-index":ee.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9","force-read-cound":2,"on-close-file-preview":"",onSubmit:Xe,onOnCloseFilePreview:je},null,8,["show","content-list","active-index"])):J("",!0),g(Ua,{"is-show":K.value},null,8,["is-show"])],64)}}});var nt=ha($a,[["__scopeId","data-v-9a6525d4"]]);export{nt as default};
