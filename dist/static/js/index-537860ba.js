var ve=Object.defineProperty,pe=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var ae=(c,n,f)=>n in c?ve(c,n,{enumerable:!0,configurable:!0,writable:!0,value:f}):c[n]=f,b=(c,n)=>{for(var f in n||(n={}))ye.call(n,f)&&ae(c,f,n[f]);if(se)for(var f of se(n))me.call(n,f)&&ae(c,f,n[f]);return c},P=(c,n)=>pe(c,he(n));import{g as ge,O as Te,ak as Ne,E as j,d as Re,y as ne,h as Ie,r as G,j as E,k as w,m as C,z as o,p as D,J as y,n as A,L as oe,t as O,A as N,G as J,F as z,a4 as Oe,a5 as Se,C as k,T as S,D as ke}from"./vendor-25e691d5.js";import{_ as xe,q as Le}from"./index-536a68c0.js";import{_ as be,S as Pe,H as we,I as He,q as Q,l as H,J as re,r as ie,K as Ue,n as Me,P as $e,L as W,M as U}from"./index-55f1d619.js";import{g as Ve,f as qe,s as le,a as Ye}from"./verify-3d00c71b.js";import{a as je}from"./order-35b0e3c5.js";const K=c=>(Oe("data-v-4d98f0b6"),c=c(),Se(),c),Ge={class:"page-verify"},Je={class:"people"},ze={class:"name"},Qe={class:"verify-item"},We=K(()=>o("div",{class:"label"},"\u8BC1\u4EF6\u53F7\u7801",-1)),Ke={class:"no"},Xe=k(" \u53BB\u8BA4\u8BC1 "),Ze={class:"sign-body"},eu={class:"date"},uu={class:"file"},tu=k(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A "),su={class:"people"},au={class:"name"},nu={class:"verify-item"},ou=K(()=>o("div",{class:"label"},"\u8BC1\u4EF6\u53F7\u7801",-1)),ru={class:"no"},iu=["onClick"],lu=k(" \u53BB\u8BA4\u8BC1 "),cu=["onClick"],du={class:"sign-body"},Bu={class:"date"},Eu={class:"file"},fu=k(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A "),_u={class:"footer-button footer"},Cu=K(()=>o("div",{class:"text"},"\u5237\u65B0",-1)),Du=k("\u5206\u4EAB"),Fu=k("\u63D0\u4EA4"),Au=ge({setup(c){const n={CERT:1,NO_CERT:2},f={1:"pdf",4:"picture",2:"richText",3:"link"},L=Te(),ce=Ne(),{saleUserId:M="D1234567-1",tenantId:m="9991000007",templateId:de=1,productCode:Be="CQ75CQ76",insurerCode:Ee="ancheng",isShare:$}=L.query;let{orderNo:v}=L.query;typeof v=="object"&&(v=(v||[])[0]);const V=new Pe({source:"localStorage"}),q=j([]),r=j(),R=j(),g=[],X=Re().format("YYYY-MM-DD"),Z=ne(()=>u=>{let a=1;return u.materialSource===1?u.materialContent.indexOf(".pdf")!==-1?a=1:a=4:a=u.materialSource,f[a]}),fe=()=>{var u;(u=R.value)==null||u.clear()},_e=u=>{g[u].clear()},ee=(u,a)=>{Ye({callbackUrl:window.location.href,certiNo:u,faceAuthMode:"TENCENT",userName:a,tenantId:9991000007}).then(l=>{const{code:t,data:d}=l;if(t==="10000"){const{originalUrl:_,serialNo:e}=d;window.location.href=_,V.set("verifyData",{serialNo:e,certNo:u,name:a})}})},I=u=>`${u}`===He.CERT,ue=u=>{var a,l,t,d;u===-1?ee((a=r.value.tenantOrderHolder)==null?void 0:a.certNo,(l=r.value.tenantOrderHolder)==null?void 0:l.name):ee((t=r.value.tenantOrderInsuredList[u])==null?void 0:t.certNo,(d=r.value.tenantOrderInsuredList[u])==null?void 0:d.name)},Ce=u=>{u&&g.every(a=>a!==u)&&g.push(u)},De=()=>{var a,l,t,d,_;if((a=R.value)==null?void 0:a.isEmpty()){S.fail("\u8BF7\u6295\u4FDD\u4EBA\u7B7E\u540D");return}if(g.some(e=>e.isEmpty())){S.fail("\u8BF7\u88AB\u4FDD\u4EBA\u7B7E\u540D");return}if(((t=(l=r.value.tenantOrderHolder)==null?void 0:l.extInfo)==null?void 0:t.isCert)!==n.CERT&&I((d=r.value.tenantOrderHolder)==null?void 0:d.certType)){S.fail("\u8BF7\u6295\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}if((_=r.value.tenantOrderInsuredList)==null?void 0:_.some(e=>{var s;return((s=e.extInfo)==null?void 0:s.isCert)!==n.CERT&&I(e.certType)})){S.fail("\u8BF7\u88AB\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}ie({orderNo:v,saleUserId:M,tenantId:m}).then(e=>{const{code:s,data:i}=e;s==="10000"&&(i.orderStatus!==je.PENDING?Ue("paymentResult",L.query):ke.confirm({title:"\u63D0\u793A",message:"\u8BF7\u786E\u8BA4\u4FE1\u606F\u586B\u5199\u65E0\u8BEF\u540E\uFF0C\u518D\u8FDB\u884C\u652F\u4ED8"}).then(()=>{var p,h;const B=(p=R.value)==null?void 0:p.save();Promise.all([le("HOLDER",B,(h=r.value)==null?void 0:h.id,`${m}`),...g.map(F=>{var T;return le("INSURED",F.save(),(T=r.value)==null?void 0:T.id,`${m}`)})]).then(()=>{Me(P(b({},r.value),{pageCode:"sign",operateOption:{withSignInfo:!0},extInfo:P(b({},r.value.extInfo),{pageCode:"sign",templateId:de,shareFlag:$?"Y":"N"}),venderCode:Ee})).then(F=>{const{code:T,data:x}=F;s==="10000"&&x.success&&ce.push({path:$e[x.pageAction.data.nextPageCode],query:{orderNo:v,saleUserId:M,tenantId:m}})})})}))})},Y=(u=!1)=>{ie({orderNo:v,saleUserId:M,tenantId:m}).then(a=>{var d,_;const{code:l,data:t}=a;l==="10000"&&(r.value=t,u&&(((_=(d=t==null?void 0:t.tenantOrderHolder)==null?void 0:d.extInfo)==null?void 0:_.isCert)===n.NO_CERT||(t==null?void 0:t.tenantOrderInsuredList.some(e=>{var s;return((s=e.extInfo)==null?void 0:s.isCert)===n.NO_CERT}))?S("\u7528\u6237\u672A\u5B8C\u8EAB\u4EFD\u8BA4\u8BC1\u53CA\u7B7E\u5B57"):(!(t==null?void 0:t.tenantOrderAttachmentList.find(e=>e.category===W.ELECTRIC_SIGN&&e.objectType===U.HOLDER))||!(t==null?void 0:t.tenantOrderAttachmentList.find(e=>e.category===W.ELECTRIC_SIGN&&e.objectType===U.INSURED)))&&S("\u7528\u6237\u672A\u5B8C\u8EAB\u4EFD\u8BA4\u8BC1\u53CA\u7B7E\u5B57")),setTimeout(()=>{let e=0;t.tenantOrderAttachmentList.forEach(s=>{s.category===W.ELECTRIC_SIGN&&(s.objectType===U.HOLDER?(R.value.clear(),R.value.setDataURL(s.fileBase64)):s.objectType===U.INSURED&&(g[e].clear(),g[e].setDataURL(s.fileBase64),e+=1))})}))})},Fe=()=>{Y(!0)},Ae=ne(()=>{const u=P(b({},L.query),{isShare:1,sharePageCode:"sign"});return`${window.location.origin}/phoneVerify?${Le.stringify(u)}`});return Ie(()=>{Y(),Ve({orderNo:v,productCode:Be,tenantId:m}).then(a=>{const{code:l,data:t}=a;l==="10000"&&(q.value=t||[])});const u=V.get("verifyData");if(u){const{serialNo:a,certNo:l,name:t}=u;qe({certiNo:l,orderNo:v,serialNo:a,tenantId:m,userName:t}).then(d=>{const{code:_,data:e}=d;_==="10000"&&(V.remove("verifyData"),Y())})}}),(u,a)=>{const l=G("ProPDFviewer"),t=G("van-button"),d=G("ProPageWrap");return E(),w(d,null,{default:C(()=>{var _;return[o("div",Ge,[D(we,{type:"warning",title:"\u5C0A\u656C\u7684\u5BA2\u6237\uFF0C\u672C\u6B21\u6295\u4FDD\u9700\u8981\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",content:"\u672C\u4EA7\u54C1\u6295\u4FDD\u9700\u8981\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u8FDB\u884C\u5B9E\u540D\u8BA4\u8BC1\uFF0C\u60A8\u8D2D\u4E70\u672C\u4EA7\u54C1\u7684\u7D2F\u8BA1\u603B\u4FDD\u8D39\u5DF2\u8D85\u8FC720\u4E07\uFF0C\u6309\u76D1\u7BA1\u8981\u6C42\uFF0C\u9700\u8981\u63D0\u4F9B\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u3001\u6307\u5B9A\u53D7\u76CA\u4EBA\u8BC1\u4EF6\u5F71\u50CF\uFF0C\u672C\u4EA7\u54C1\u975E\u672C\u4EBA\u6295\u4FDD\u4E14\u5E26\u8EAB\u6545\u8D23\u4EFB\u3001\u9700\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\uFF08\u6210\u4EBA\uFF09\u7684\u6295\u4FDD\u610F\u613F\u8FDB\u884C\u7B7E\u5B57\u786E\u8BA4\u3002"}),D(H,{title:"\u6295\u4FDD\u4EBA",class:"card"},{extra:C(()=>{var e,s,i,B,p,h,F,T,x,te;return[o("div",Je,[o("div",ze,y((s=(e=r.value)==null?void 0:e.tenantOrderHolder)==null?void 0:s.name),1),I((B=(i=r.value)==null?void 0:i.tenantOrderHolder)==null?void 0:B.certType)?(E(),A("div",{key:0,class:oe(["status",{verified:((F=(h=(p=r.value)==null?void 0:p.tenantOrderHolder)==null?void 0:h.extInfo)==null?void 0:F.isCert)===n.CERT}])},y(((te=(x=(T=r.value)==null?void 0:T.tenantOrderHolder)==null?void 0:x.extInfo)==null?void 0:te.isCert)===n.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)):O("",!0)])]}),default:C(()=>{var e,s,i,B,p,h,F;return[o("div",Qe,[We,o("div",Ke,y((s=(e=r.value)==null?void 0:e.tenantOrderHolder)==null?void 0:s.certNo),1),((p=(B=(i=r.value)==null?void 0:i.tenantOrderHolder)==null?void 0:B.extInfo)==null?void 0:p.isCert)!==n.CERT&&I((F=(h=r.value)==null?void 0:h.tenantOrderHolder)==null?void 0:F.certType)?(E(),A("div",{key:0,class:"action",onClick:a[0]||(a[0]=T=>ue(-1))},[Xe,D(Q,{name:"right_arrow",class:"icon"})])):O("",!0)])]}),_:1}),D(H,{title:"\u6295\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:C(()=>[o("div",{class:"resign",onClick:fe},"\u91CD\u7B7E")]),default:C(()=>[D(re,{ref_key:"holderSign",ref:R,class:"sign"},null,512),o("div",Ze,[o("div",eu,"\u7B7E\u540D\u65E5\u671F\uFF1A "+y(N(X)),1),o("div",uu,[tu,(E(!0),A(z,null,J(q.value,(e,s)=>(E(),w(l,{key:s,class:"file",title:`\u300A${e.materialName}\u300B`,content:e.materialContent,type:N(Z)(e)},null,8,["title","content","type"]))),128))])])]),_:1}),(E(!0),A(z,null,J((_=r.value)==null?void 0:_.tenantOrderInsuredList,(e,s)=>(E(),A("div",{key:s},[D(H,{title:"\u88AB\u4FDD\u4EBA",class:"card"},{extra:C(()=>{var i,B;return[o("div",su,[o("div",au,y(e.name),1),I(e.certType)?(E(),A("div",{key:0,class:oe(["status",{verified:((i=e.extInfo)==null?void 0:i.isCert)===n.CERT}])},y(((B=e.extInfo)==null?void 0:B.isCert)===n.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)):O("",!0)])]}),default:C(()=>{var i;return[o("div",nu,[ou,o("div",ru,y(e.certNo),1),((i=e.extInfo)==null?void 0:i.isCert)!==n.CERT&&I(e.certType)?(E(),A("div",{key:0,class:"action",onClick:B=>ue(s)},[lu,D(Q,{name:"right_arrow",class:"icon"})],8,iu)):O("",!0)])]}),_:2},1024),D(H,{title:"\u88AB\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:C(()=>[o("div",{class:"resign",onClick:i=>_e(s)},"\u91CD\u7B7E",8,cu)]),default:C(()=>[D(re,{ref_for:!0,ref:Ce,class:"sign"}),o("div",du,[o("div",Bu,"\u7B7E\u540D\u65E5\u671F\uFF1A "+y(N(X)),1),o("div",Eu,[fu,(E(!0),A(z,null,J(q.value,(i,B)=>(E(),w(l,{key:B,class:"file",title:`\u300A${i.materialName}\u300B`,content:i.materialContent,type:N(Z)(i)},null,8,["title","content","type"]))),128))])])]),_:2},1024)]))),128)),o("div",_u,[N($)?O("",!0):(E(),A("div",{key:0,class:"refresh-btn",onClick:Fe},[o("div",null,[D(Q,{name:"refresh"})]),Cu])),N($)?O("",!0):(E(),w(xe,{key:1,title:"\u9080\u8BF7\u60A8\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",desc:"\u9080\u8BF7\u60A8\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",link:N(Ae)},{default:C(()=>[D(t,{plain:"",type:"primary",class:"share-btn"},{default:C(()=>[Du]),_:1})]),_:1},8,["link"])),D(t,{type:"primary",class:"submit-btn",onClick:De},{default:C(()=>[Fu]),_:1})])])]}),_:1})}}});var Tu=be(Au,[["__scopeId","data-v-4d98f0b6"]]);export{Tu as default};
