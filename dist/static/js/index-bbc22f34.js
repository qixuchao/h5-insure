var Be=Object.defineProperty,De=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var ue=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var ie=(m,i,d)=>i in m?Be(m,i,{enumerable:!0,configurable:!0,writable:!0,value:d}):m[i]=d,b=(m,i)=>{for(var d in i||(i={}))he.call(i,d)&&ie(m,d,i[d]);if(ue)for(var d of ue(i))Pe.call(i,d)&&ie(m,d,i[d]);return m},j=(m,i)=>De(m,ge(i));import{g as me,E as L,_ as oe,r as p,j as _,k as F,m as l,z as u,p as c,n as X,G as pe,J as N,F as Ie,C as S,ak as Re,O as Te,Q as be,M as xe,y as de,o as Fe,A as f,t as K,d as le,T as Ne}from"./vendor-e057bbeb.js";import{_ as Ve,z as ke,w as He,r as Se,Q as M,R as x,n as Ue,P as we}from"./index-cc2b2aa0.js";import{p as $e}from"./trial-a3c893ed.js";import{f as ce,g as fe,h as je}from"./trial-46575f56.js";import{u as Me}from"./useDicData-3a37a62a.js";import{_ as re,R as Ye,B as qe,a as Ge,b as ze}from"./index-1a4ab4da.js";const Je={class:"com-select-container"},Qe={class:"radio-item-wrapper"},We={class:"name"},Ke={class:"hone"},Xe={class:"address"},Ze={class:"footer-button"},et=S("\u53D6\u6D88"),tt=S("\u786E\u8BA4"),nt=me({props:{dataSource:{type:Array,default:()=>[]},show:{type:Boolean,default:!1},modelValue:{type:[String,Number],default:null}},emits:["update","update:modelValue","submit","close"],setup(m,{emit:i}){const d=m,D=L(d.modelValue),Y=L(d.show),Z=()=>{i("submit",D.value),Y.value=!1},ee=()=>{i("close")};return oe(()=>d.modelValue,U=>{console.log("newVal",U),D.value=U}),oe(()=>D.value,U=>{i("update:modelValue",U)}),(U,V)=>{const q=p("van-radio"),Q=p("van-radio-group"),W=p("VanButton");return _(),F(ke,{show:Y.value,"onUpdate:show":V[1]||(V[1]=I=>Y.value=I),class:"com-select",title:"\u9009\u62E9\u4FDD\u5355\u901A\u8BAF\u4FE1\u606F",onClose:ee},{default:l(()=>[u("div",Je,[c(Q,{modelValue:D.value,"onUpdate:modelValue":V[0]||(V[0]=I=>D.value=I)},{default:l(()=>[(_(!0),X(Ie,null,pe(m.dataSource,(I,e)=>(_(),F(q,{key:e,name:e+1,class:"radio-item"},{default:l(()=>[u("div",Qe,[u("p",null,[u("span",We,N(I.contactName),1),u("span",Ke,N(I.contactPhoneNo),1)]),u("p",Xe,N(I.contactAddress),1)])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),u("div",Ze,[c(W,{plain:"",type:"primary"},{default:l(()=>[et]),_:1}),c(W,{type:"primary",onClick:Z},{default:l(()=>[tt]),_:1})])]),_:1},8,["show"])}}});var rt=Ve(nt,[["__scopeId","data-v-9c6de82e"]]);const ot={key:0,class:"beneficiary-part"},at={class:"part-title"},st={class:"title"},ut=S("\u5220\u9664"),it=S("+\u6DFB\u52A0\u53D7\u76CA\u4EBA"),dt=S("\u9009\u62E9\u4FDD\u5355\u901A\u8BAF\u4FE1\u606F"),lt={class:"radio-item-wrapper"},ct={class:"name"},ft={class:"hone"},mt={class:"address"},pt={class:"footer-button"},It={class:"left"},vt={class:"trial-result"},_t=S(" \u9996\u671F"),Ot={class:"result-num"},Et=u("div",{class:"result-desc"},"\u5B9E\u9645\u4FDD\u8D39\u4EE5\u540E\u7EED\u4E3A\u51C6",-1),yt={class:"operate-btn"},Lt=S("\u4E0B\u4E00\u6B65"),Rt=me({setup(m){const i=Re(),d=Te(),{templateId:D=1,orderNo:Y="2022072710380711215",productCode:Z,tenantId:ee="9991000007",proposalId:U}=d.query,[V,q]=be(),Q=d.path==="/infoPreview"?"infoPreview":"infoCollection",W=Me("NATIONAL_REGION_CODE"),I=L({}),e=L({extInfo:{pageCode:Q},tenantOrderHolder:{extInfo:{occupationCodeList:[]},holderType:1},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},insuredBeneficiaryType:"1",tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}]}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}}),te=L(null),g=L([]),w=L([]),G=L([]),ne=L([]),ae=L([]),h=xe({beneficiaryId:0,nextPage:"",currentAddress:null,isLoading:!0}),se=de(()=>{var t,o,r,s,P,R,O,C,A,B;return[{contactAddress:(o=(t=e.value.tenantOrderHolder)==null?void 0:t.extInfo)==null?void 0:o.familyAddress,contactName:e.value.tenantOrderHolder.name,contactPhoneNo:e.value.tenantOrderHolder.mobile},{contactAddress:(s=(r=e.value.tenantOrderHolder)==null?void 0:r.extInfo)==null?void 0:s.workAddress,contactName:e.value.tenantOrderHolder.name,contactPhoneNo:e.value.tenantOrderHolder.mobile},{contactAddress:(R=(P=e.value.tenantOrderInsuredList[0])==null?void 0:P.extInfo)==null?void 0:R.familyAddress,contactName:(O=e.value.tenantOrderInsuredList[0])==null?void 0:O.name,contactPhoneNo:(C=e.value.tenantOrderInsuredList[0])==null?void 0:C.mobile},{contactAddress:(B=(A=e.value.tenantOrderInsuredList[0])==null?void 0:A.extInfo)==null?void 0:B.workAddress,contactName:e.value.tenantOrderInsuredList[0].name,contactPhoneNo:e.value.tenantOrderInsuredList[0].mobile}].filter(E=>E.contactAddress&&E.contactName&&E.contactPhoneNo)||[]}),z=de(()=>{var a,t;return h.currentAddress?se.value[h.currentAddress-1]||{}:((t=(a=e.value.extInfo)==null?void 0:a.contactInfo)==null?void 0:t[0])||{}}),ve=a=>{const t={};return a.map(o=>{const{initialAmount:r,annuityDrawFrequency:s,annuityDrawType:P,paymentFrequency:R,paymentPeriod:O,paymentPeriodType:C,insurancePeriodType:A,insurancePeriodValue:B,riskCode:E,riskType:k,initialPremium:$,liabilityDetails:H,extInfo:y}=o,{riskId:T,copy:n}=y,v={amount:r,annuityDrawDate:s,annuityDrawType:P,paymentFrequency:R,riskId:T,copy:n,chargePeriod:O?`${ce[C]}_${O}`:ce[C],coveragePeriod:B?`${fe[A]}_${B}`:fe[A],riskCode:E,riskType:k,premium:$,liabilityVOList:H};return k===je.mainRisk?(t.mainRiskCode=E,t.mainRiskId=T):Object.assign(v,t),v})},_e=()=>{var t;const a=b({},e.value);a.extInfo=j(b({},a.extInfo),{contactInfo:[z.value]}),a.tenantOrderAttachmentList=[{category:M.OBVERSE_CERT,objectType:x.HOLDER,objectId:e.value.tenantOrderHolder.id,name:"\u6295\u4FDD\u4EBA\u8BC1\u4EF6\u6B63\u9762",uri:g.value[0],id:G.value[0]},{category:M.REVERSE_CERT,objectType:x.HOLDER,objectId:e.value.tenantOrderHolder.id,name:"\u6295\u4FDD\u4EBA\u8BC1\u4EF6\u80CC\u9762",uri:g.value[1],id:G.value[1]},{category:M.OBVERSE_CERT,objectType:x.INSURED,objectId:e.value.tenantOrderInsuredList[0].id,name:"\u88AB\u4FDD\u4EBA\u8BC1\u4EF6\u6B63\u9762",uri:w.value[0]||g.value[0],id:ne.value[1]},{category:M.REVERSE_CERT,objectType:x.INSURED,objectId:e.value.tenantOrderInsuredList[0].id,name:"\u88AB\u4FDD\u4EBA\u8BC1\u4EF6\u80CC\u9762",uri:w.value[1]||g.value[1],id:ne.value[1]}],(t=te.value)==null||t.validate().then(o=>{if(a.tenantOrderInsuredList[0].insuredBeneficiaryType===ze.SPECIFY){const r={};if(a.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.forEach(s=>{r[s.benefitOrder]?r[s.benefitOrder].sum+=Number(s.benefitRate):r[s.benefitOrder]={sum:Number(s.benefitRate)}}),Object.values(r).some(s=>s.sum!==100)){Ne.fail("\u540C\u4E00\u987A\u4F4D\u7684\u53D7\u76CA\u4EBA\u6BD4\u4F8B\u4E4B\u548C\u5FC5\u987B\u4E3A100");return}}Ue(a).then(({code:r,data:s})=>{r==="10000"&&s.pageAction.pageAction==="jumpToPage"&&i.push({path:we[s.pageAction.data.nextPageCode],query:d.query})})})},Oe=()=>{var a;(a=te.value)==null||a.validate().then(()=>{const{birthday:t,gender:o,extInfo:r}=e.value.tenantOrderHolder,{hasSocialInsurance:s,occupationCodeList:P}=r,{birthday:R,gender:O,extInfo:C,tenantOrderProductList:A}=e.value.tenantOrderInsuredList[0],{hasSocialInsurance:B,occupationCodeList:E}=C,k={holder:{personVO:{birthday:le(t).format("YYYY-MM-DD"),gender:o,socialFlag:s,occupationCodeList:P}},productCode:Z,insuredVOList:[{insuredCode:"",personVO:{birthday:le(R).format("YYYY-MM-DD"),gender:O,socialFlag:B,occupationCodeList:E},productPlanVOList:[{insurerCode:"",planCode:"",riskVOList:ve(A[0].tenantOrderRiskList)}]}]};$e(b({},k)).then(({code:$,data:H})=>{if($==="10000"){const y={},T=(n=[])=>{(n||[]).forEach(v=>{var J;y[v.riskCode]=v,((J=v.riskPremiumDetailVOList)==null?void 0:J.length)&&T(v.riskPremiumDetailVOList)})};T(H.riskPremiumDetailVOList),e.value.tenantOrderInsuredList[0].tenantOrderProductList[0]=j(b({},e.value.tenantOrderInsuredList[0].tenantOrderProductList[0]),{premium:H.premium,tenantOrderRiskList:e.value.tenantOrderInsuredList[0].tenantOrderProductList[0].tenantOrderRiskList.map(n=>j(b({},n),{initialAmount:y[n.riskCode].amount,initialPremium:y[n.riskCode].premium}))}),_e()}})})},Ee=a=>{console.log("value",a)},ye=()=>{h.beneficiaryId+=1,e.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.push({id:h.beneficiaryId,extInfo:{}})},Le=a=>{e.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList=e.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.filter(t=>t.beneficiaryId!==a.beneficiaryId||a.id!==t.id)},Ce=()=>{Se({orderNo:Y,tenantId:ee}).then(({code:a,data:t})=>{if(a==="10000"){const o=t;o.extInfo=j(b({},o.extInfo),{pageCode:Q,templateId:D}),o.tenantOrderHolder=o.tenantOrderHolder||{holderType:1},o.tenantOrderHolder.extInfo=o.tenantOrderHolder.extInfo||{occupationCodeList:[]},o.tenantOrderInsuredList[0].extInfo=o.tenantOrderInsuredList[0].extInfo||{occupationCodeList:[]},o.tenantOrderInsuredList[0].tenantOrderBeneficiaryList=o.tenantOrderInsuredList[0].tenantOrderBeneficiaryList.map(r=>{const s=r;return s.extInfo=s.extInfo||{occupationCodeList:[]},s}),o.tenantOrderAttachmentList.forEach(r=>{r.category===M.OBVERSE_CERT?r.objectType===x.HOLDER?(g.value[0]=r.uri,G.value[0]=r.id):r.objectType===x.INSURED&&(w.value[0]=r.uri,ne.value[0]=r.id):r.category===M.REVERSE_CERT&&(r.objectType===x.HOLDER?(g.value[1]=r.uri,G.value[1]=r.id):r.objectType===x.INSURED&&(w.value[1]=r.uri,G.value[1]=r.id))}),Object.assign(e.value,o)}}).finally(()=>{h.isLoading=!1})},Ae=()=>{Object.assign(e.value.tenantOrderInsuredList[0],e.value.tenantOrderHolder,{id:e.value.tenantOrderInsuredList[0].id,extInfo:j(b({},e.value.tenantOrderHolder.extInfo),{insureProvinceCode:e.value.tenantOrderInsuredList[0].extInfo.insureProvinceCode,insureCityCode:e.value.tenantOrderInsuredList[0].extInfo.insureCityCode,insureAreaCode:e.value.tenantOrderInsuredList[0].extInfo.insureAreaCode})})};return Fe(()=>{Ce(),He({pageCode:"infoCollection",templateId:D}).then(({code:a,data:t})=>{if(a==="10000"){const o={BENEFICIARY:[],INSURER:[],HOLDER:[]};t.productInsureFactorList.forEach(r=>{(o[r.moduleType]=o[r.moduleType]||[]).push(r)}),I.value=o}})}),oe([()=>e.value.tenantOrderInsuredList[0].relationToHolder,()=>e.value.tenantOrderHolder],()=>{`${e.value.tenantOrderInsuredList[0].relationToHolder}`===Ge.SELF&&Ae()},{deep:!0,immediate:!0}),(a,t)=>{const o=p("ProCard"),r=p("ProRadioButton"),s=p("ProField"),P=p("ProCascader"),R=p("ProSvg"),O=p("VanButton"),C=p("ProCheckButton"),A=p("van-cell"),B=p("ProForm"),E=p("ProPageWrap");return _(),F(E,{class:"page-info-wrapper"},{default:l(()=>{var k,$,H,y,T;return[f(h).isLoading?K("",!0):(_(),F(B,{key:0,ref_key:"formRef",ref:te},{default:l(()=>[c(o,{title:"\u6295\u4FDD\u4EBA"},{default:l(()=>[c(re,{images:g.value,"onUpdate:images":t[0]||(t[0]=n=>g.value=n),"form-info":e.value.tenantOrderHolder,"factor-list":I.value.HOLDER,prefix:"holder"},null,8,["images","form-info","factor-list"])]),_:1}),c(o,{title:"\u88AB\u4FDD\u4EBA"},{default:l(()=>[c(s,{modelValue:e.value.tenantOrderInsuredList[0].relationToHolder,"onUpdate:modelValue":t[2]||(t[2]=n=>e.value.tenantOrderInsuredList[0].relationToHolder=n),label:"\u4E3A\u8C01\u4FDD\u5355",name:"relationToHolder",placeholder:"\u8BF7\u9009\u62E9"},{input:l(()=>[c(r,{modelValue:e.value.tenantOrderInsuredList[0].relationToHolder,"onUpdate:modelValue":t[1]||(t[1]=n=>e.value.tenantOrderInsuredList[0].relationToHolder=n),options:f(Ye)},null,8,["modelValue","options"])]),_:1},8,["modelValue"]),+e.value.tenantOrderInsuredList[0].relationToHolder!=1?(_(),F(re,{key:0,images:w.value,"onUpdate:images":t[3]||(t[3]=n=>w.value=n),"form-info":e.value.tenantOrderInsuredList[0],"factor-list":I.value.INSURER||[],prefix:"insure"},null,8,["images","form-info","factor-list"])):K("",!0),c(P,{modelValue:e.value.tenantOrderInsuredList[0].extInfo.insureAreaCode,"onUpdate:modelValue":t[4]||(t[4]=n=>e.value.tenantOrderInsuredList[0].extInfo.insureAreaCode=n),field1:e.value.tenantOrderInsuredList[0].extInfo.insureProvinceCode,"onUpdate:field1":t[5]||(t[5]=n=>e.value.tenantOrderInsuredList[0].extInfo.insureProvinceCode=n),field2:e.value.tenantOrderInsuredList[0].extInfo.insureCityCode,"onUpdate:field2":t[6]||(t[6]=n=>e.value.tenantOrderInsuredList[0].extInfo.insureCityCode=n),field3:e.value.tenantOrderInsuredList[0].extInfo.insureAreaCode,"onUpdate:field3":t[7]||(t[7]=n=>e.value.tenantOrderInsuredList[0].extInfo.insureAreaCode=n),label:"\u6295\u4FDD\u5730\u533A",name:"insureAreaCode",placeholder:"\u8BF7\u9009\u62E9","is-link":"",required:"","data-source":f(W),mapping:{label:"name",value:"code",children:"children"}},null,8,["modelValue","field1","field2","field3","data-source"])]),_:1}),c(o,{title:"\u53D7\u76CA\u4EBA"},{default:l(()=>[c(s,{modelValue:e.value.tenantOrderInsuredList[0].insuredBeneficiaryType,"onUpdate:modelValue":t[9]||(t[9]=n=>e.value.tenantOrderInsuredList[0].insuredBeneficiaryType=n),label:"\u53D7\u76CA\u4EBA\u7C7B\u578B",name:"insuredBeneficiaryType",placeholder:"\u8BF7\u9009\u62E9"},{input:l(()=>[c(r,{modelValue:e.value.tenantOrderInsuredList[0].insuredBeneficiaryType,"onUpdate:modelValue":t[8]||(t[8]=n=>e.value.tenantOrderInsuredList[0].insuredBeneficiaryType=n),options:f(qe)},null,8,["modelValue","options"])]),_:1},8,["modelValue"]),e.value.tenantOrderInsuredList[0].insuredBeneficiaryType==2?(_(),X("div",ot,[(_(!0),X(Ie,null,pe(e.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList,(n,v)=>(_(),X("div",{key:n.beneficiaryId||n.id,class:"beneficiary-item"},[u("div",at,[u("span",st,N(`\u53D7\u76CA\u4EBA${v+1}`),1),c(R,{name:"delete",onClick:J=>Le(n)},{default:l(()=>[ut]),_:2},1032,["onClick"])]),c(re,{images:ae.value,"onUpdate:images":t[10]||(t[10]=J=>ae.value=J),"form-info":n,"factor-list":I.value.BENEFICIARY||[],prefix:`beneficiary-${v}`,"beneficiary-list":e.value.tenantOrderInsuredList[0].tenantOrderBeneficiaryList},null,8,["images","form-info","factor-list","prefix","beneficiary-list"])]))),128)),c(O,{onClick:ye},{default:l(()=>[it]),_:1})])):K("",!0)]),_:1}),c(o,{title:"\u4FDD\u5355\u901A\u8BAF\u4FE1\u606F"},{default:l(()=>{var n;return[((n=Object.keys(f(z)))==null?void 0:n.length)?(_(),F(A,{key:1,title:"\u5355\u5143\u683C","is-link":"",onClick:t[12]||(t[12]=v=>f(q)(!0))},{title:l(()=>[u("div",lt,[u("p",null,[u("span",ct,N(f(z).contactName),1),u("span",ft,N(f(z).contactPhoneNo),1)]),u("p",mt,N(f(z).contactAddress),1)])]),_:1})):(_(),F(C,{key:0,activated:"",onClick:t[11]||(t[11]=v=>f(q)(!0))},{default:l(()=>[dt]),_:1}))]}),_:1})]),_:1},512)),u("div",pt,[u("div",It,[u("div",vt,[_t,u("span",Ot,"\uFFE5"+N((T=(y=(H=($=(k=e.value.tenantOrderInsuredList)==null?void 0:k[0])==null?void 0:$.tenantOrderProductList)==null?void 0:H[0].premium)==null?void 0:y.toLocaleString)==null?void 0:T.call(y)),1)]),Et]),u("div",yt,[c(O,{block:"",type:"primary",onClick:Oe},{default:l(()=>[Lt]),_:1})])]),f(V)?(_(),F(rt,{key:1,modelValue:f(h).currentAddress,"onUpdate:modelValue":t[13]||(t[13]=n=>f(h).currentAddress=n),show:f(V),"data-source":f(se),onSubmit:Ee,onClose:t[14]||(t[14]=n=>f(q)(!1))},null,8,["modelValue","show","data-source"])):K("",!0)]}),_:1})}}});export{Rt as default};
