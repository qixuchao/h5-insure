import{_ as e,d as a,c as l,g as t,i as o,t as s,m as n,j as r,X as d,Y as i,u,a as c,r as v,G as p,e as m,w as f,f as I,T as h,l as w,ao as y,bT as g,bG as C}from"./index-3e642916.js";import{i as b}from"./infoCollection-8fba7a60.js";import{c as N,_ as U}from"./close-fd240348.js";import{a as O}from"./order-89525222.js";import{d as $,i as S,g as k,s as x,e as j,E as D}from"./trial-5342cd34.js";import{t as L}from"./theme-ea709837.js";import{n as _,i as V,m as P,e as R,g as B,t as q,k as z,l as T,f as F,h as G}from"./utils-bf7c5aec.js";import{p as H}from"./product-0f161a9e.js";import"./pdfh5-008ca364.js";import"./trial-1c5cf823.js";const J={class:"com-field-info"},E={class:"title"},K={class:"desc"};var M=e(a({props:{title:{type:String,default:""},desc:{type:String,default:""}},setup:e=>(a,n)=>(l(),t("div",J,[o("div",E,s(e.title),1),o("div",K,s(e.desc),1)]))}),[["__scopeId","data-v-2ff3e068"]]);const Y=e=>(d("data-v-ed9081ee"),e=e(),i(),e),W={key:0,class:"pro-modal"},X=Y((()=>o("div",{class:"pro-overlay"},null,-1))),A={class:"pro-modal-wrapper"},Q=Y((()=>o("div",{class:"pro-modal-content"},[o("p",null,"恭喜您"),o("p",null,"保障升级成功")],-1))),Z=["src"];var ee=e(a({props:{bg:{type:String,default:""},btn:{type:String,default:""},isShow:{type:Boolean,default:()=>{}}},emits:["on-confirm","on-close"],setup(e,{emit:a}){const s=e,d=()=>{a("on-close")},i=()=>{a("on-confirm")};return(e,a)=>s.isShow?(l(),t("div",W,[X,o("div",A,[o("div",{class:"pro-modal-body"},[Q,o("div",{class:"pro-modal-btn",onClick:i},"我知道了")]),o("div",{class:"pro-modal-close",onClick:d},[o("img",{src:n(N)},null,8,Z)])])])):r("",!0)}}),[["__scopeId","data-v-ed9081ee"]]);const ae={class:"page-activity-upgrade"},le=["src"],te={class:"container"},oe={class:"main-form"};var se=e(a({setup(e){const a=u(),t=c(),{productCode:s="BWYL2022",tenantId:r,orderNo:d,agentCode:i="",from:N}=t.query;console.log("upload--route.query",t.query);const J=v(),E=v(),K=v(),Y=v(),W=v(),X=v(),A=v(!1),Q="check"===N,Z=v(!1),se=v(0),ne=v("");let re="";const de=()=>{A.value=!1},ie=e=>`${C}/pay?orderNo=${e}&saleUserId=${i}&tenantId=${r}`,ue=()=>{a.replace(`/pay?orderNo=${ne.value}&saleUserId=${i}&tenantId=${r}`)},ce=async e=>{try{h.loading({forbidClick:!0,message:"升级中",duration:15e3});const e=await(async()=>{var e,a,l,t,o;const s=B({tenantId:r,applicationNo:K.value.applicationNo,policyNo:K.value.policyNo,saleUserId:i,saleChannelId:K.value.saleChannelId,orderStatus:O.UP_PROCESSING,orderTopStatus:"-1",orderCategory:2,detail:J.value,insureDetail:E.value,paymentMethod:null==(a=null==(e=K.value.extInfo)?void 0:e.extraInfo)?void 0:a.paymentMethod,renewalDK:null==(t=null==(l=K.value.extInfo)?void 0:l.extraInfo)?void 0:t.renewalDK,iseeBizNo:re,successJumpUrl:"",premium:Y.value,holder:{...K.value.tenantOrderHolder,socialFlag:K.value.tenantOrderHolder.extInfo.hasSocialInsurance},insured:{...K.value.tenantOrderInsuredList[0],socialFlag:K.value.tenantOrderInsuredList[0].extInfo.hasSocialInsurance},tenantOrderRiskList:q({tenantId:r,riskList:z(T(E.value.productRiskVoList[0].riskDetailVOList),J.value),riskPremium:{},productId:null==(o=J.value)?void 0:o.id})}),n=await x(s),{code:d,data:u}=n;return"10000"===d?u.data:""})();await $({tenantId:r,applicationNo:K.value.applicationNo});if(ne.value=e,console.log(ne.value,"orderNoUp.value===",e),X.value){if(Q){const a=encodeURIComponent(encodeURIComponent(ie(e))),l=`${X.value}&successUrl=${a}`;window.location.href=l}else{const e=encodeURIComponent(encodeURIComponent(window.location.href)),a=`${X.value}&failUrl=${e}`;window.location.href=a}h.clear()}else(async e=>{const l=F({tenantId:r,premium:Y.value,orderDetail:K.value,productDetail:J.value,insureDetail:E.value,successJumpUrl:ie(e),iseeBizNo:re}),t=await D({orderNo:e,...l}),{code:o,data:n}=t;"10000"===o&&(Q?a.replace(`/internet/orderDetail?orderNo=${e}&productCode=${s}&tenantId=${r}`):(h.clear(),ue()))})(e)}catch(l){console.log(l),h.clear()}},ve=async e=>{Q?Z.value=!0:ce()},pe=()=>{h.loading({forbidClick:!0,duration:2e4,message:"试算中"});const e=H({productCode:s,withInsureInfo:!0,tenantId:r}),a=S({productCode:s}),l=k({orderNo:d,tenantId:r});Promise.all([e,a,l]).then((([e,a,l])=>{var t;"10000"===e.code&&(J.value=e.data,document.title=(null==(t=e.data)?void 0:t.productFullName)||""),"10000"===a.code&&(E.value=a.data),"10000"===l.code&&(K.value=l.data,W.value=l.data.tenantOrderInsuredList[0].extInfo.hasSocialInsurance),(async()=>{try{const e=F({tenantId:r,premium:Y.value,orderDetail:K.value,productDetail:J.value,insureDetail:E.value,successJumpUrl:""},G),a=await j(e),{code:l,data:t}=a;"10000"===l&&(Y.value=t.installmentPremium,X.value=t.signUrl)}catch(e){console.log(e)}finally{h.clear()}})()}))};return p((()=>{pe(),setTimeout((async()=>{re=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,a)=>{const t=w,s=y,r=g;return l(),m(r,{"theme-vars":n(L)},{default:f((()=>{var e,l,r,d,i,u,c,v,p,m;return[o("div",ae,[o("img",{src:null==(l=null==(e=J.value)?void 0:e.tenantProductInsureVO)?void 0:l.banner[0],class:"banner"},null,8,le),o("div",te,[o("div",oe,[I(M,{title:"姓名",desc:n(_)(null==(d=null==(r=K.value)?void 0:r.tenantOrderInsuredList)?void 0:d[0].name)},null,8,["desc"]),I(M,{title:"证件号码",desc:n(V)(null==(u=null==(i=K.value)?void 0:i.tenantOrderInsuredList)?void 0:u[0].certNo)},null,8,["desc"]),I(M,{title:"手机号码",desc:n(P)(null==(v=null==(c=K.value)?void 0:c.tenantOrderHolder)?void 0:v.mobile)},null,8,["desc"]),I(M,{title:"每月保费",desc:`${n(R)(Y.value||0)}元 / 每月`},null,8,["desc"]),I(s,{label:"有无社保",name:"name",required:"",placeholder:"请选择"},{input:f((()=>[I(t,{modelValue:W.value,"onUpdate:modelValue":a[0]||(a[0]=e=>W.value=e),disabled:!0,options:n(b)},null,8,["modelValue","options"])])),_:1}),o("div",{class:"submit",onClick:ve})])]),I(ee,{"is-show":A.value,onOnConfirm:ue,onOnClose:de},null,8,["is-show"])]),I(U,{show:Z.value,"onUpdate:show":a[1]||(a[1]=e=>Z.value=e),"content-list":null==(m=null==(p=J.value)?void 0:p.tenantProductInsureVO)?void 0:m.attachmentVOList,"active-index":se.value,text:"我已逐页阅读并确认告知内容",onSubmit:ce},null,8,["show","content-list","active-index"])]})),_:1},8,["theme-vars"])}}}),[["__scopeId","data-v-942be77c"]]);export{se as default};
