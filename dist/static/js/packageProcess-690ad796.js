var Je=Object.defineProperty,Xe=Object.defineProperties;var Qe=Object.getOwnPropertyDescriptors;var ie=Object.getOwnPropertySymbols;var Ze=Object.prototype.hasOwnProperty,et=Object.prototype.propertyIsEnumerable;var ce=(F,c,p)=>c in F?Je(F,c,{enumerable:!0,configurable:!0,writable:!0,value:p}):F[c]=p,k=(F,c)=>{for(var p in c||(c={}))Ze.call(c,p)&&ce(F,p,c[p]);if(ie)for(var p of ie(c))et.call(c,p)&&ce(F,p,c[p]);return F},P=(F,c)=>Xe(F,Qe(c));import{g as tt,a9 as at,O as rt,E as h,M as de,y as me,_ as ot,l as nt,h as st,r as pe,af as ut,j as H,n as fe,p as g,m as z,H as lt,t as G,z as S,A as m,J as R,C as we,k as he,F as it,D as ct,T as w,X as dt}from"./vendor-ec22d003.js";import{_ as mt,C as ve,a0 as pt,H as ft,I as ye,a2 as Fe}from"./index-83689ef1.js";import{a as j}from"./order-26db6dbf.js";import{S as M,R as V,f as ge,I as ht}from"./infoCollection-192ba138.js";import{p as Ee,i as vt,s as yt,g as Ft,u as gt,a as Et}from"./trial-16e3e852.js";import{p as Dt}from"./product-403cb4ed.js";import{a as De,o as Ce,t as Ct,g as J,b as _t,h as _e}from"./utils-b794692e.js";import{t as Nt}from"./theme-ea709837.js";import{d as Ne,B as It,D as wt,G as At,S as Bt,H as Tt,P as kt,U as Pt,_ as St,W as bt,a as Ie}from"./auth-fb6063f5.js";import{_ as Ut}from"./index-91f95db1.js";import"./utils-b6782348.js";import"./trial-5ee3d2c0.js";import"./index-da204cdf.js";import"./bankCard-0e4ce564.js";import"./phoneVerify-da6ddeb1.js";const Ot={key:0},xt={class:"page-internet-product-detail"},Lt={class:"info"},Ht={class:"footer-button"},Rt={class:"price"},Mt=we(" \u603B\u4FDD\u8D39"),Vt=tt({setup(F){const c=at(),p=rt(),{productCode:X="BWYL2021",tenantId:v,orderNo:A,phoneNo:Ae,agentCode:b="",saleChannelId:Be,paymentMethod:Te,certNo:Q,name:Z,pageCode:ke,from:Pe}=p.query,U=h(),d=h(),O=h(),D=h(),q=ke==="payBack",Y=h(!1),x=h(!1),N=h(!1),ee=h(0),$=h(!1),K=h(!1),L=h({show:!1,html:""});let W="";const e=de({holder:{certNo:Q,certType:ve.CERT,mobile:Ae,name:Z,socialFlag:M.HAS},insured:{certNo:Q,certType:ve.CERT,name:Z,socialFlag:M.HAS,relationToHolder:V.SELF},paymentMethod:Te,renewalDK:"Y",paymentFrequency:ge.YEAR,packageProductList:[],mobileSmsCode:""}),te=h(Ne),B=h(Ne),u=de({showInsure:!q,canInsure:!1,canUpgrade:!1}),Se=me(()=>{var t,a;return((a=(t=d.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:a.attachmentVOList.filter(r=>r.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),be=me(()=>{var t,a;return((a=(t=d.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:a.attachmentVOList.filter(r=>r.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),Ue=()=>{if(e.holder.certNo){const t=J(e.holder.certNo,"year"),a=ye(e.holder.certNo);if(t<18)return w("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E18\u5C81\uFF01"),!1;if(e.insured.certNo&&e.insured.relationToHolder===V.MATE){const r=ye(e.insured.certNo);if(a===r)return w("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(e.insured.certNo){const t=J(e.holder.certNo,"day"),a=J(e.holder.certNo,"year");if(e.insured.relationToHolder===V.CHILD&&t<30)return w("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(e.insured.relationToHolder===V.PARENT&&a>=71)return w("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E70\u5C81\uFF01"),!1}return!0},Oe=()=>{const{holder:{certNo:t,mobile:a,name:r,socialFlag:s},insured:{certNo:o,name:n,socialFlag:l,relationToHolder:f},paymentMethod:y}=e;return!!(ft(o)&&!!l)},ae=()=>{c.push({path:"/internet/guaranteeUpgrade",query:P(k({},p.query),{tenantId:v,productCode:"BWYL2022",orderNo:A,agentCode:b})})},xe=()=>{K.value=!1},Le=()=>{B.value=te.value},He=()=>{B.value=P(k({},B.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},Re=async t=>{w.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const a=await gt(t),{code:r}=a;if(r==="10000"){w.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const s=await Et({orderNo:t.orderNo,tenantId:v}),{data:o}=s;s.code==="10000"&&(o.type===2?(L.value={show:!0,html:o.paymentUrl},console.log("data.paymentUrl",L.value),dt(()=>{console.log("document.forms",document.forms);const n=document.getElementById("cashierSubmit");n==null||n.addEventListener("submit",l=>{l.preventDefault()}),n==null||n.submit()})):window.location.href=o.paymentUrl)}u.canInsure=!0}catch{u.canInsure=!0}},Me=t=>`${Fe}/pay?orderNo=${t}&saleUserId=${b}&tenantId=${v}`,Ve=t=>`${Fe}/internet/payFail?tenantId=${v}&orderNo=${t}&agentCode=${b}&pageCode=payBack&from=${Pe||"normal"}`,qe=async t=>{console.log("risk",t);const a=_t({tenantId:v,saleUserId:b,saleChannelId:Be,detail:d.value,insureDetail:O.value,paymentMethod:e.paymentMethod,renewalDK:e.renewalDK,iseeBizNo:W,successJumpUrl:"",premium:D.value,holder:e.holder,insured:e.insured,tenantOrderRiskList:t,orderStatus:"",orderTopStatus:""});try{const r=await yt(a),{code:s,data:o}=r;s==="10000"&&Re(P(k({},a),{orderNo:o.data,extInfo:{extraInfo:{renewalDK:e.renewalDK,paymentMethod:e.paymentMethod,paymentFrequency:e.paymentFrequency,successJumpUrl:Me(o.data),failUrl:Ve(o.data)},iseeBizNo:W}}))}catch{u.canInsure=!0}},Ye=async()=>{const{calcData:t,riskVOList:a}=De({holder:e.holder,insured:e.insured,tenantId:v,productDetail:d.value,insureDetail:O.value,paymentFrequency:e.paymentFrequency,packageRiskIdList:Ce(e.packageProductList)},!1,_e),r=await Ee(t),{code:s,data:o}=r;return s==="10000"?(D.value=o.premium,{condition:a,data:o}):{}},$e=t=>{ee.value=t,N.value=!0},Ke=()=>new Promise((t,a)=>{var r,s;(s=(r=U.value)==null?void 0:r.validateForm)==null||s.call(r).then(async()=>{var C;if(!Ue()){u.canInsure=!0;return}if(!(((C=U.value)==null?void 0:C.isAgreeFile)||Y.value)){N.value=!0,$e(0);return}const{calcData:n,riskVOList:l}=De({holder:e.holder,insured:e.insured,tenantId:v,productDetail:d.value,insureDetail:O.value,paymentFrequency:e.paymentFrequency,packageRiskIdList:Ce(e.packageProductList)},!1,_e),f=await Ee(n),{code:y,data:E}=f;y==="10000"?(D.value=E.premium,t({condition:l,data:E})):a(new Error)}).catch(()=>{u.canInsure=!0})}),re=async()=>{var t;if(q){ae();return}try{const{condition:a,data:r}=await Ke(),s={},o=(l=[])=>{(l||[]).forEach(f=>{var y;s[f.riskCode]=f,((y=f.riskPremiumDetailVOList)==null?void 0:y.length)&&o(f.riskPremiumDetailVOList)})};o(r.riskPremiumDetailVOList);const n=Ct({tenantId:v,riskList:a,riskPremium:s,productId:(t=d.value)==null?void 0:t.id});qe(n)}catch{u.canInsure=!0}},We=t=>{t==="allFalse"?(x.value=!1,re(),u.canInsure=!0):ct.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"}).then(()=>{window.history.back()}).catch(()=>{var a;(a=U.value)==null||a.reEditForm(),Y.value=!1,u.canInsure=!0})},ze=()=>{Y.value=!0,N.value=!1,x.value=!0};ot([()=>e.insured.certNo,()=>e.insured.socialFlag,()=>e.packageProductList,()=>e.paymentFrequency],nt.exports.debounce(()=>{e.insured.certNo&&e.insured.socialFlag&&Oe()&&Ye()},500),{deep:!0,immediate:!0});const oe=async()=>{var s,o,n,l,f,y,E,C,T,ne,se,ue,le;const t=await Ft({orderNo:A,tenantId:v}),{code:a,data:r}=t;if(a==="10000"){const{tenantOrderHolder:_,tenantOrderInsuredList:i,extInfo:I}=r;if(!q){Object.assign(e,{holder:{certNo:_.certNo,certType:_.certType,mobile:_.mobile,name:_.name,socialFlag:M.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(s=i[0])==null?void 0:s.certType,name:(o=i[0])==null?void 0:o.name,socialFlag:(l=(n=i[0])==null?void 0:n.extInfo)==null?void 0:l.hasSocialInsurance,relationToHolder:(f=i[0])==null?void 0:f.relationToHolder},paymentMethod:I.extraInfo.paymentMethod,paymentFrequency:I.extraInfo.paymentFrequency,renewalDK:I.extraInfo.renewalDK||"N"}),u.canInsure=!0;return}Object.assign(e,{holder:{certNo:_.certNo,certType:_.certType,mobile:_.mobile,name:_.name,socialFlag:M.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(y=i[0])==null?void 0:y.certType,name:(E=i[0])==null?void 0:E.name,socialFlag:(T=(C=i[0])==null?void 0:C.extInfo)==null?void 0:T.hasSocialInsurance,relationToHolder:(ne=i[0])==null?void 0:ne.relationToHolder},paymentMethod:I.extraInfo.paymentMethod,paymentFrequency:I.extraInfo.paymentFrequency,renewalDK:I.extraInfo.renewalDK||"N"}),D.value=(le=(ue=(se=i[0])==null?void 0:se.tenantOrderProductList)==null?void 0:ue[0])==null?void 0:le.premium,(r.orderStatus===j.ACCEPT_POLICY||r.orderStatus===j.PAYMENT_SUCCESS)&&(u.canUpgrade=!0,$.value=!1,K.value=!0),r.orderStatus===j.PAYING&&($.value=!0,setTimeout(()=>{oe()},3*1e3))}},Ge=async()=>{const t=Dt({productCode:X,withInsureInfo:!0,tenantId:v}),a=vt({productCode:X});await Promise.all([t,a]).then(([r,s])=>{var o,n;r.code==="10000"&&(d.value=r.data,document.title=((o=r.data)==null?void 0:o.productFullName)||""),s.code==="10000"&&(e.packageProductList=(((n=s.data)==null?void 0:n.packageProductVOList)||[]).map(l=>P(k({},l),{value:ht.UN_INSURE,disabled:!1})),O.value=s.data)}),A&&oe()},je=()=>{console.log("\u6295\u4FDD\u94FE\u63A5"),B.value=Ie,te.value=Ie,u.canInsure=!0};return st(()=>{je(),Ge(),setTimeout(async()=>{W=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(t,a)=>{const r=pe("van-button"),s=pe("van-config-provider"),o=ut("dompurify-html");return H(),fe(it,null,[g(s,{"theme-vars":m(Nt)},{default:z(()=>{var n,l,f,y,E,C,T;return[L.value.show?lt((H(),fe("div",Ot,null,512)),[[o,L.value.html]]):G("",!0),S("div",xt,[S("div",Lt,[g(It,{url:(l=(n=d.value)==null?void 0:n.tenantProductInsureVO)==null?void 0:l.banner[0]},null,8,["url"]),g(wt,{"product-name":(f=d.value)==null?void 0:f.productFullName,"product-desc":(E=(y=d.value)==null?void 0:y.showConfigVO)==null?void 0:E.desc},null,8,["product-name","product-desc"])]),g(At,{"show-service-config":"","guarantee-list":(T=(C=d.value)==null?void 0:C.tenantProductInsureVO)==null?void 0:T.titleAndDescVOS},null,8,["guarantee-list"]),g(Bt,{detail:d.value},{form:z(()=>[g(Tt,{ref_key:"formRef",ref:U,"is-show-package":"",disable:!m(u).showInsure,"form-auth":B.value,"form-info":m(e),premium:D.value,"product-detail":d.value,onOnReset:Le,onOnUpdate:He},null,8,["disable","form-auth","form-info","premium","product-detail"])]),_:1},8,["detail"]),S("div",Ht,[S("div",Rt,[Mt,S("span",null,R(D.value?"\uFFE5":"")+R(m(pt)(D.value))+" "+R(D.value?m(e).paymentFrequency==m(ge).YEAR?"\u5143/\u5E74":"\u5143/\u6708":""),1)]),g(r,{type:"primary",class:"right",disabled:!(m(u).canInsure||m(u).canUpgrade),onClick:re},{default:z(()=>[we(R(m(u).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),m(A)?G("",!0):(H(),he(kt,{key:1,"product-detail":d.value},null,8,["product-detail"])),g(Pt,{"order-no":m(A),"tenant-id":m(v),"is-show":K.value,onOnConfirm:ae,onOnClose:xe},null,8,["order-no","tenant-id","is-show"])]}),_:1},8,["theme-vars"]),g(St,{show:x.value,"onUpdate:show":a[0]||(a[0]=n=>x.value=n),"content-list":m(Se),"active-index":0,onOnConfirmHealth:We},null,8,["show","content-list"]),N.value?(H(),he(Ut,{key:0,show:N.value,"onUpdate:show":a[1]||(a[1]=n=>N.value=n),"content-list":m(be),"active-index":ee.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9","force-read-cound":2,onSubmit:ze},null,8,["show","content-list","active-index"])):G("",!0),g(bt,{"is-show":$.value},null,8,["is-show"])],64)}}});var oa=mt(Vt,[["__scopeId","data-v-12685349"]]);export{oa as default};
