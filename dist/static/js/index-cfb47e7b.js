import{_ as e,d as a,u as i,a as r,r as t,J as o,b8 as s,cu as n,am as l,aD as d,b6 as u,bG as c,bH as p,B as m,c as f,e as v,w as k,m as g,g as y,f as C,j as I,i as P,F as h,h as O,t as L,n as b,M as V,N as D,O as R,aC as _,b4 as T,b as N,Z as B}from"./index-5239afda.js";import{C as F}from"./index-25e306aa.js";import{P as j,a as x}from"./index-2038fd60.js";import{i as w,p as A}from"./trial-f5b40a6d.js";import{c as q}from"./createProposal-05765e43.js";import{b as E,a as S}from"./trial-04861e1a.js";import{C as M}from"./index-587d164f.js";import"./pdfh5-008ca364.js";import"./useDicData-2fe3e43e.js";const U={key:0,class:"part-card"},H={key:1,class:"part-card"},J={class:"risk-content"},z={key:0,class:"risk"},K={key:1,class:"plan-risk"},Y={class:"footer-bar van-safe-area-bottom"},G={class:"trial-result"},W=b("总保费"),Z={class:"result-num"},Q={class:"trial-operate"},X={key:0,class:"retrial-tip"},$=b(" 条件更改后，需要重新试算 "),ee=b("去试算"),ae=b("立即投保");var ie=e(a({setup(e){var a;const b=i(),ie=r(),{agentCode:re="test",agencyCode:te="",tenantId:oe=9991000007,insurerCode:se="99",proposalId:ne,saleChannelId:le}=ie.query;let{productCode:de="MMBBSF",templateId:ue=1}=ie.query;const ce=t({personVO:{occupationCodeList:[]}}),pe=t({insuredCode:"",personVO:{occupationCodeList:[]}}),me=t({}),fe=t({}),ve=t({}),ke=t(null),ge=t({}),ye=o({currentPlan:"",riskBaseInfo:{},holderFactor:[],insuredFactor:[],riskData:[],riskPlanData:[],trialResult:{},canTrial:!0,retrialTip:!1,enumList:{},ageRange:[],collapseName:["1"],insuredRiskList:[],currentRiskList:[]});ne&&(de=null==(a=ie.query||{})?void 0:a.productCenterCode),s("premium",ge.value),n().get("userInfo");const Ce=()=>{ye.retrialTip=!1},Ie=()=>{V({agencyId:te,saleUserId:re,saleChannelId:le,tenantId:oe,venderCode:ye.riskBaseInfo.insurerCode,orderDataSource:1,proposalId:ne,extInfo:{templateId:+(ue||1),pageCode:"premiumTrial",iseeBizNo:window.iseeBiz,buttonCode:D.premiumTrial},tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{extInfo:{},tenantOrderProductList:[{productCode:ye.riskBaseInfo.productCode||"",productName:ye.riskBaseInfo.productName||"",premium:ye.trialResult.premium||0,tenantOrderRiskList:ye.insuredRiskList}]}]}).then((({code:e,data:a})=>{"10000"===e&&"jumpToPage"===a.pageAction.pageAction&&b.push({path:R[a.pageAction.data.nextPageCode],query:{insurerCode:ye.riskBaseInfo.insurerCode,templateId:ue,...ie.query,productCategory:ye.riskBaseInfo.productCategory,orderNo:a.pageAction.data.orderNo}})}))},Pe=()=>{const e=JSON.parse(JSON.stringify(me.value[ye.currentPlan])),a=Object.values(e).find((e=>1===e.riskType)),i=Object.values(e).map((e=>{const i=e;return((e,a)=>{var i,r,t,o;const s=e;if("3"===s.chargePeriod){const e=(a.chargePeriod||"").split("_");if(e[1]-=1,1===s.exemptFlag){if("to"===e[0]){let a=0;1===s.exemptType?(null==(i=ce.value.personVO)?void 0:i.birthday)&&(a=parseInt(""+(+new Date-new Date(null==(r=ce.value.personVO)?void 0:r.birthday))/31536e6,10)):2===s.exemptType&&(null==(t=pe.value.personVO)?void 0:t.birthday)&&(a=parseInt(""+(+new Date-new Date(null==(o=pe.value.personVO)?void 0:o.birthday))/31536e6,10)),e[1]=e[1]-a}e[0]="year",s.coveragePeriod=e.join("_")}s.chargePeriod=e.join("_")}})(i,a),i.liabilityVOList=(i.liabilityVOList||[]).filter((e=>1===e.optionalFlag||e.liabilityAttributeValue&&"-1"!==e.liabilityAttributeValue)).map((e=>{const a=e;return"0"===a.liabilityAttributeValue&&(a.liabilityAttributeValue=""),a})),i})),r={holder:ce.value,productCode:ye.riskBaseInfo.productCode,insuredVOList:[{...pe.value,productPlanVOList:[{planCode:ye.currentPlan||"",insurerCode:ye.riskBaseInfo.insurerCode,riskVOList:i}]}]};A({...r}).then((({code:e,data:a})=>{if("10000"===e){ye.retrialTip=!1,ye.trialResult=a,ye.canTrial=!1;const e={},i=(a=[])=>{(a||[]).forEach((a=>{var r;e[a.riskCode]=a,(null==(r=a.riskPremiumDetailVOList)?void 0:r.length)&&i(a.riskPremiumDetailVOList)}))};i(a.riskPremiumDetailVOList),((e,a)=>{ye.insuredRiskList=e.map((e=>{var i,r;return{initialAmount:null==(i=a[e.riskCode])?void 0:i.amount,amountUnit:1,annuityDrawFrequency:e.annuityDrawDate,annuityDrawType:e.annuityDrawType,paymentFrequency:e.paymentFrequency,paymentPeriod:e.chargePeriod.split("_")[1],paymentPeriodType:E[e.chargePeriod.split("_")[0]],insurancePeriodType:S["to_life"===e.coveragePeriod?"to_life":e.coveragePeriod.split("_")[0]],insurancePeriodValue:Number.isNaN(+e.coveragePeriod.split("_")[1])?0:e.coveragePeriod.split("_")[1],riskCode:e.riskCode,riskType:e.riskType,riskName:e.riskName,extInfo:{riskId:e.riskId,copy:e.copy},initialPremium:null==(r=a[e.riskCode])?void 0:r.premium,liabilityDetails:e.liabilityVOList.map((e=>({liabilityCode:e.liabilityCode,liabilityName:e.liabilityName,refundMethod:e.liabilityAttributeValue}))),productId:ye.riskBaseInfo.id}}))})(r.insuredVOList[0].productPlanVOList[0].riskVOList,e),Object.assign(ge.value,e)}}))},he=()=>{var e,a,i,r,t;Promise.all([null==(a=null==(e=fe.value)?void 0:e.validateForm)?void 0:a.call(e),null==(r=null==(i=ve.value)?void 0:i.validateForm)?void 0:r.call(i),null==(t=ke.value)?void 0:t.validate()]).then((()=>{Pe()}),(e=>{var a;(null==e?void 0:e.length)&&(null==(a=null==ke?void 0:ke.value)||a.scrollToField(e[0].name))}))},Oe=()=>{w({productCode:de,source:ne?2:1}).then((({code:e,data:a})=>{var i,r,t,o;"10000"===e&&(ye.riskBaseInfo=a.productBasicInfoVO,(a.productRelationPlanVOList.length?a.productRelationPlanVOList:a.productRiskVoList[0].riskDetailVOList||[]).forEach(((e,a)=>{0===a&&(ye.currentPlan=e.planCode||"0"),ne||Object.assign(me.value,{[e.planCode||a]:{}})})),ne&&(t=ye.riskBaseInfo.productCategory,o=ye.riskBaseInfo.insurerCode,B({productCategory:t,venderCode:o}).then((e=>{var a;"10000"===e.code&&(ue=null==(a=e.data)?void 0:a.id)}))),ye.riskData=(null==(i=a.productRiskVoList[0])?void 0:i.riskDetailVOList)||[],ye.riskPlanData=a.productRelationPlanVOList||[],ne&&(r=a.productBasicInfoVO.id,q({id:ne,tenantId:oe}).then((({code:e,data:a})=>{var i;if("10000"===e){const{proposalInsuredProductList:e=[],...t}=(null==(i=a.proposalInsuredList)?void 0:i[0])||{};Object.assign(ce.value.personVO,a.proposalHolder);const o=e.find((e=>e.productId===r));Object.assign(pe.value.personVO,t,{occupationCodeList:(null==o?void 0:o.occupationCodeList)||[]});const s={};((null==o?void 0:o.proposalProductRiskList)||[]).forEach((e=>{s[e.riskId]=e})),Object.assign(me.value,{0:s})}}))))})).finally((()=>{}))},Le=e=>{ye.holderFactor=e.holderFactorList,ye.insuredFactor=e.insuredFactorList,ye.ageRange=e.ageRange};return l([()=>me.value,()=>ce.value,()=>pe.value],(e=>{e&&!ye.canTrial&&(ye.canTrial=!0,ye.retrialTip=!0)}),{deep:!0}),d((()=>{Oe(),_({dictCodeList:["RISK_PAYMENT_PERIOD","RISK_INSURANCE_PERIOD"]}).then((({code:e,data:a})=>{if("10000"===e){const e={};a.forEach((a=>{e[a.dictCode]=a.dictItemList})),ye.enumList=e}}))})),(e,a)=>{const i=T,r=u,t=N("ProTabButton"),o=c,s=p,n=F,l=M,d=m,b=N("ProPageWrap");return f(),v(b,{class:"page-trial-wrapper"},{default:k((()=>{var e,u,c;return[g(ye).holderFactor.length?(f(),y("div",U,[C(i,{title:"投保人"}),C(j,{ref_key:"holderRef",ref:fe,"insured-code":null==(e=g(ye).riskBaseInfo)?void 0:e.insurerCode,"form-info":ce.value.personVO,"factor-list":g(ye).holderFactor,"age-range":g(ye).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):I("",!0),g(ye).insuredFactor.length?(f(),y("div",H,[C(i,{title:"被保人"}),C(j,{ref_key:"insuredRef",ref:ve,"insured-code":null==(u=g(ye).riskBaseInfo)?void 0:u.insurerCode,"form-info":pe.value.personVO,"factor-list":g(ye).insuredFactor,"age-range":g(ye).ageRange},null,8,["insured-code","form-info","factor-list","age-range"])])):I("",!0),P("div",J,[C(l,{modelValue:g(ye).collapseName,"onUpdate:modelValue":a[1]||(a[1]=e=>g(ye).collapseName=e)},{default:k((()=>[C(n,{name:"1"},{title:k((()=>[C(i,{title:"投保方案"})])),default:k((()=>[g(ye).riskData.length&&me.value[0]?(f(),y("div",z,[C(r,{ref_key:"riskFormRef",ref:ke,"input-align":"right","error-message-align":"right"},{default:k((()=>[C(x,{"risk-info":me.value[0],enums:g(ye).enumList,"origin-data":g(ye).riskData,"pick-factor":Le},null,8,["risk-info","enums","origin-data"])])),_:1},512)])):I("",!0),g(ye).riskPlanData.length?(f(),y("div",K,[C(r,{ref_key:"riskFormRef",ref:ke,"input-align":"right","error-message-align":"right"},{default:k((()=>[C(s,{active:g(ye).currentPlan,"onUpdate:active":a[0]||(a[0]=e=>g(ye).currentPlan=e)},{default:k((()=>[(f(!0),y(h,null,O(g(ye).riskPlanData,(e=>(f(),v(o,{key:e.planCode,name:e.planCode,title:e.planName},{title:k((()=>[C(t,{title:e.planName,active:g(ye).currentPlan===e.planCode},null,8,["title","active"])])),default:k((()=>{var a;return[e.planCode===g(ye).currentPlan?(f(),v(x,{key:0,"risk-info":me.value[e.planCode],enums:g(ye).enumList,"origin-data":null==(a=e.productRiskVoList)?void 0:a[0].riskDetailVOList,"pick-factor":Le},null,8,["risk-info","enums","origin-data"])):I("",!0)]})),_:2},1032,["name","title"])))),128))])),_:1},8,["active"])])),_:1},512)])):I("",!0)])),_:1})])),_:1},8,["modelValue"])]),P("div",Y,[P("span",G,[W,P("span",Z,L((g(ye).retrialTip?0:(null==(c=g(ye).trialResult)?void 0:c.premium)||0).toLocaleString("hanidec",{style:"currency",currency:"CNY"})),1)]),P("div",Q,[g(ye).retrialTip?(f(),y("div",X,[$,P("span",{class:"close-icon",onClick:Ce})])):I("",!0),g(ye).canTrial?(f(),v(d,{key:1,type:"primary",onClick:he},{default:k((()=>[ee])),_:1})):(f(),v(d,{key:2,type:"primary",onClick:Ie},{default:k((()=>[ae])),_:1}))])])]})),_:1})}}}),[["__scopeId","data-v-67d6b9f9"]]);export{ie as default};
