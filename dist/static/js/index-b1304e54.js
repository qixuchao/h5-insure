import{aw as e,aU as s,aV as a,aW as t,aX as o,aY as r,aZ as l,d as i,f as d,a_ as n,a$ as u,b0 as c,b1 as p,b2 as m,aB as k,b3 as v,aC as I,_ as f,S as L,r as h,E as b,an as y,c as P,h as R,F as g,i as V,j as _,n as C,t as O,g as j,b4 as D,e as w,w as T,k as x,b5 as S,aG as U,X as N,Y as E,u as $,a as q,aE as A,b as B,aM as F,a7 as Y,aj as H,y as K,P as M,aP as W,m as X,b6 as G,B as Z}from"./index-f03140d4.js";import{u as z,P as J}from"./index-9e79c9a4.js";import{q as Q,a as ee,b as se}from"./createProposal-69ce55ff.js";import{R as ae}from"./index-cbf676f6.js";import{u as te}from"./useDicData-488e69ee.js";import"./pdfh5-008ca364.js";import"./trial-4c132c87.js";import"./trial-58dc58d8.js";const[oe,re]=e("action-sheet"),le=s({},a,{title:String,round:t,actions:o(),closeIcon:r("cross"),closeable:t,cancelText:String,description:String,closeOnPopstate:t,closeOnClickAction:Boolean,safeAreaInsetBottom:t}),ie=[...l,"round","closeOnPopstate","safeAreaInsetBottom"];const de=I(i({name:oe,props:le,emits:["select","cancel","update:show"],setup(e,{slots:s,emit:a}){const t=e=>a("update:show",e),o=()=>{t(!1),a("cancel")},r=()=>{if(e.title)return d("div",{class:re("header")},[e.title,e.closeable&&d(p,{name:e.closeIcon,class:[re("close"),m],onClick:o},null)])},l=()=>{if(s.cancel||e.cancelText)return[d("div",{class:re("gap")},null),d("button",{type:"button",class:re("cancel"),onClick:o},[s.cancel?s.cancel():e.cancelText])]},i=(e,a)=>e.loading?d(k,{class:re("loading-icon")},null):s.action?s.action({action:e,index:a}):[d("span",{class:re("name")},[e.name]),e.subname&&d("div",{class:re("subname")},[e.subname])],I=(s,o)=>{const{color:r,loading:l,callback:n,disabled:u,className:c}=s;return d("button",{type:"button",style:{color:r},class:[re("item",{loading:l,disabled:u}),c],onClick:()=>{u||l||(n&&n(s),e.closeOnClickAction&&t(!1),v((()=>a("select",s,o))))}},[i(s,o)])},f=()=>{if(e.description||s.description){const a=s.description?s.description():e.description;return d("div",{class:re("description")},[a])}};return()=>d(c,n({class:re(),position:"bottom","onUpdate:show":t},u(e,ie)),{default:()=>{var a;return[r(),f(),d("div",{class:re("content")},[e.actions.map(I),null==(a=s.default)?void 0:a.call(s)]),l()]}})}}));const ne=e=>(N("data-v-cd47605e"),e=e(),E(),e),ue={class:"com-product-list-wrapper"},ce={class:"risk-item-wrapper"},pe={class:"content"},me={class:"risk-premium"},ke={class:"premium"},ve={class:"risk-factor"},Ie={class:"factor"},fe={class:"factor-value"},Le=ne((()=>_("span",{class:"factor-name"}," 保额(元) ",-1))),he={class:"factor"},be={class:"factor-value"},ye=ne((()=>_("span",{class:"factor-name"}," 保障期间 ",-1))),Pe={class:"factor"},Re={class:"factor-value"},ge=ne((()=>_("span",{class:"factor-name"}," 缴费期间 ",-1))),Ve={class:"operate-bar"},_e=ne((()=>_("span",{class:"btn-plus"},"+",-1))),Ce={key:0,class:"premium-total"},Oe={class:"premium"};var je=f(i({__name:"index",props:{productRiskList:{default:()=>[]},productInfo:{default:()=>({})},productData:{default:()=>({})},pickProductPremium:{type:Function,default:()=>{}},productNum:{default:0}},emits:["deleteRisk","updateRisk","addRiderRisk"],setup(e,{emit:s}){const a=e,[t,o]=L(),r=h({checkedList:[],disabledList:[],riderRiskList:[],mainRiskData:{},totalPremium:0,currentRiskRecord:{},productRiskList:[]}),l=te("RISK_PAYMENT_PERIOD"),i=te("RISK_INSURANCE_PERIOD"),n=b((()=>{var e,s;return(null==(s=null==(e=a.productData)?void 0:e.productRiskVoList)?void 0:s[0].riskDetailVOList.filter((e=>1===e.collocationType)))||[]})),u=b((()=>{var e,s;const t=a.productRiskList.map((e=>e.riskId)),o=((null==(s=null==(e=a.productData)?void 0:e.productRiskVoList)?void 0:s[0].riskDetailVOList)||[]).filter((e=>t.includes(e.id)&&1===e.collocationType));return n.value.length-o.length})),c=b((()=>e=>{var s,t;const o=(null==(t=null==(s=a.productData)?void 0:s.productRiskVoList)?void 0:t[0].riskDetailVOList.find((s=>s.id!==e)))||{};let r=!1;return r=!!a.productNum||2===o.riskType&&1===o.collocationType,r})),p=b((()=>{var e,s;return(null==(s=null==(e=a.productData)?void 0:e.productRiskVoList)?void 0:s[0].riskDetailVOList.find((e=>1===e.riskType)))||{}})),m=b((()=>p.value.collocationVOList||[])),k=(e,t)=>{const o=e.map((e=>e.id)).filter((e=>!r.value.disabledList.includes(e)));s("addRiderRisk",o,a.productInfo)};return y((()=>a.productInfo),(e=>{var s;let t=0;(e.proposalProductRiskList||[]).forEach((e=>{t+=e.premium})),null==(s=a.pickProductPremium)||s.call(a,{[`${e.productId}`]:t}),r.value.totalPremium=t}),{deep:!0,immediate:!0}),y((()=>a.productRiskList),(e=>{const s=[],a=[],t=[];(e||[]).forEach((e=>{1===e.riskType?s.unshift(e):(a.push(e.riskId),t.push(e.riskId),s.push(e))})),r.value.disabledList=a,r.value.checkedList=t,r.value.productRiskList=s}),{deep:!0,immediate:!0}),(e,p)=>{const v=S,I=U;return P(),R("div",ue,[(P(!0),R(g,null,V(j(r).productRiskList,(e=>{var t,n;return P(),R("div",{key:e.riskId},[_("div",ce,[d(v,{"risk-type":e.riskType,title:e.riskName,class:"no-border"},null,8,["risk-type","title"]),_("div",pe,[_("div",me,[C(" 保费:"),_("span",ke,"￥"+O(null==(t=e.premium)?void 0:t.toLocaleString()),1)]),_("div",ve,[_("div",Ie,[_("span",fe,O(null==(n=e.amount)?void 0:n.toLocaleString()),1),Le]),_("div",he,[_("span",be,O(j(D)(j(i),e.coveragePeriod)),1),ye]),_("div",Pe,[_("span",Re,O(j(D)(j(l),e.chargePeriod)),1),ge])]),_("div",Ve,[j(c)(e.riskId)?(P(),w(I,{key:0,round:32,class:"border",onClick:t=>{s("deleteRisk",e,a.productInfo)}},{default:T((()=>[C("删除")])),_:2},1032,["onClick"])):x("",!0),j(u)?(P(),w(I,{key:1,activated:"",round:32,class:"btn-rider-risk",onClick:s=>{return a=e,o(!0),void(r.value.currentRiskRecord=a);var a}},{default:T((()=>[_e,C(" 附加险")])),_:2},1032,["onClick"])):x("",!0),d(I,{activated:"",round:32,onClick:t=>{s("updateRisk",e,a.productInfo)}},{default:T((()=>[C("修改")])),_:2},1032,["onClick"])])])])])})),128)),j(r).productRiskList.length>1?(P(),R("div",Ce,[C(" 保费: "),_("span",Oe,"￥"+O(j(r).totalPremium.toLocaleString()),1)])):x("",!0),j(t)?(P(),w(ae,{key:1,modelValue:j(r).checkedList,"onUpdate:modelValue":p[0]||(p[0]=e=>j(r).checkedList=e),show:j(t),disabled:j(r).disabledList,"risk-list":j(n),"collocation-list":j(m),onFinished:k,onClose:p[1]||(p[1]=e=>j(o)(!1))},null,8,["modelValue","show","disabled","risk-list","collocation-list"])):x("",!0)])}}}),[["__scopeId","data-v-cd47605e"]]);const De={class:"container"},we=(e=>(N("data-v-4f24fb6d"),e=e(),E(),e))((()=>_("span",{class:"plan-name"},"计划书名称",-1))),Te={class:"operate-bar"},xe={class:"footer-bar"},Se={class:"trial-result"},Ue={class:"result-num"},Ne={class:"trial-operate"};var Ee=f(i({__name:"index",setup(e){const s=[{name:"保存修改"},{name:"另存为新计划书"}],[a,t]=L(),[o,r]=L(),l=h({proposalHolder:{},proposalInsuredList:[{name:"",gender:"",birthday:"",proposalInsuredProductList:[]}],proposalName:"",totalPremium:0,relationUserType:2}),i=$(),n=q(),u=z(),{id:c,type:p="add",isCreateProposal:m}=n.query,k=h({productId:0,productCollection:{},productInfo:{},productPremium:{},riderRisk:{},type:"add",currentRisk:[]}),v=h();h({}),h([]),b((()=>({min:"",max:""})));const I=()=>{v.value.validate().then((()=>{se(l.value).then((({code:e,data:s})=>{"10000"===e&&(u.$reset(),u.proposalId=s,i.push({path:"/compositionProposal",query:{id:s}}))}))}))},f=()=>{!c&&u.proposalId?r(!0):I()},D=(e,s)=>{s&&(l.value.id=null),I()},S=(e,s,a)=>s?/^.{1,20}$/.test(s)?"":`${e}不能超过20个字符`:"",N=(e={})=>{Object.assign(k.value.productPremium,e),l.value.totalPremium=Object.values(k.value.productPremium).reduce(((e,s)=>e+s),0)},E=(e,s)=>{const a=s;H.confirm({message:"确认删除该险种？"}).then((()=>{1===e.riskType?(l.value.proposalInsuredList[0].proposalInsuredProductList=l.value.proposalInsuredList[0].proposalInsuredProductList.filter((e=>e.productId!==a.productId)),N({[a.productId]:0})):a.proposalProductRiskList=a.proposalProductRiskList.filter((s=>s.riskId!==e.riskId))}))},ae=(e,s)=>{k.value.productId=s.productId,k.value.productInfo=s,k.value.type="edit",k.value.currentRisk=[e.riskId],t(!0)},te=(e,s)=>{k.value.productId=s.productId,k.value.productInfo=s,k.value.type="addRiderRisk",k.value.currentRisk=e,t(!0)},oe=e=>{l.value.proposalInsuredList[0].proposalInsuredProductList=l.value.proposalInsuredList[0].proposalInsuredProductList.map((s=>{let a=s;return s.productId===e.proposalInsuredList[0].proposalInsuredProductList[0].productId&&(a={...e.proposalInsuredList[0].proposalInsuredProductList[0]}),a})),t(!1)},re=()=>{u.setProposalInfo(l.value),u.setTrialData([]),u.setExcludeProduct(Object.keys(k.value.productCollection)),i.push({path:"/proposalList",query:{isCreateProposal:"1",...n.query}})},le=()=>{t(!1)};return A((()=>{const e=u.$state.trialData,s=u.$state.proposalInfo,a=u.$state.proposalId;c&&!m||a?(((e={})=>{Q(e).then((({code:e,data:s})=>{"10000"===e&&Object.assign(l.value,s)}))})({id:c||a}),u.$reset()):!Object.keys(s).length&&e.length?Object.assign(l.value,e[0]):Object.keys(s).length&&e.length?(s.proposalInsuredList[0].proposalInsuredProductList.push(...e[0].proposalInsuredList[0].proposalInsuredProductList),l.value=s):Object.keys(s).length&&!e.length&&(l.value=s),u.setTrialData([])})),y((()=>{var e;return null==(e=l.value.proposalInsuredList[0].proposalInsuredProductList)?void 0:e.length}),(()=>{const e=l.value.proposalInsuredList[0].proposalInsuredProductList.map((e=>({productId:e.productId,source:2})));ee({voList:e}).then((({code:e,data:s})=>{"10000"===e&&(k.value.productCollection=s)})).finally((()=>{}))})),(e,t)=>{const i=K,n=M,u=W,c=X,p=G,m=U,I=Z,L=de,h=B("ProPageWrap");return P(),w(h,{class:"page-create-wrapper"},{default:T((()=>{var e;return[_("div",De,[d(p,{ref_key:"formRef",ref:v,"input-align":"right","error-message-align":"right"},{default:T((()=>[d(n,{"show-line":!1},{default:T((()=>[d(i,{modelValue:j(l).proposalName,"onUpdate:modelValue":t[0]||(t[0]=e=>j(l).proposalName=e),class:"border-radius",name:"proposalName",placeholder:"请输入计划书名称",rules:[{validator:(...e)=>S("计划书名称",...e)}]},{label:T((()=>[we])),_:1},8,["modelValue","rules"])])),_:1}),d(n,{title:"被保人信息"},{default:T((()=>[d(i,{modelValue:j(l).proposalInsuredList[0].name,"onUpdate:modelValue":t[1]||(t[1]=e=>j(l).proposalInsuredList[0].name=e),name:"name",label:"姓名",rules:[{validator:(...e)=>S("姓名",...e)}],placeholder:"请输入（选填）"},null,8,["modelValue","rules"]),d(u,{modelValue:j(l).proposalInsuredList[0].birthday,"onUpdate:modelValue":t[2]||(t[2]=e=>j(l).proposalInsuredList[0].birthday=e),name:"birthday",label:"出生日期",type:"date","is-link":"",readonly:"",placeholder:"请选择",rules:[{required:!0,message:"请选择"}]},null,8,["modelValue"]),d(i,{modelValue:j(l).proposalInsuredList[0].gender,"onUpdate:modelValue":t[4]||(t[4]=e=>j(l).proposalInsuredList[0].gender=e),name:"gender",label:"性别",class:"border-radius",rules:[{required:!0,message:"请选择"}]},{input:T((()=>[d(c,{modelValue:j(l).proposalInsuredList[0].gender,"onUpdate:modelValue":t[3]||(t[3]=e=>j(l).proposalInsuredList[0].gender=e),options:j(F)},null,8,["modelValue","options"])])),_:1},8,["modelValue"])])),_:1})])),_:1},512),(P(!0),R(g,null,V(j(l).proposalInsuredList[0].proposalInsuredProductList||[],(e=>(P(),w(n,{key:e.productId,"show-line":!1},{default:T((()=>{var s,a;return[d(je,{"product-risk-list":e.proposalProductRiskList,"product-info":e,"product-num":(null==(a=null==(s=j(l).proposalInsuredList[0])?void 0:s.proposalInsuredProductList)?void 0:a.length)-1,"product-data":j(k).productCollection[e.productId],"pick-product-premium":N,onAddRiderRisk:te,onUpdateRisk:ae,onDeleteRisk:E},null,8,["product-risk-list","product-info","product-num","product-data"])]})),_:2},1024)))),128)),_("div",Te,[d(m,{activated:"",round:34,onClick:re},{default:T((()=>[C("添加主险")])),_:1})])]),_("div",xe,[_("span",Se,[C("总保费"),_("span",Ue,"￥"+O(j(l).totalPremium.toLocaleString()),1)]),_("div",Ne,[d(I,{type:"primary",onClick:f},{default:T((()=>[C("保存并预览")])),_:1})])]),j(a)?(P(),w(J,{key:0,"is-show":j(a),type:j(k).type,"rider-risk":(null==(e=j(k).riderRisk)?void 0:e[j(k).productId])||[],"product-data":j(k).productCollection[j(k).productId],"form-info":j(k).productInfo,holder:j(l).proposalHolder,insured:j(l).proposalInsuredList[0],"current-risk":j(k).currentRisk,onClose:le,onFinished:oe},null,8,["is-show","type","rider-risk","product-data","form-info","holder","insured","current-risk"])):x("",!0),d(L,{show:j(o),"onUpdate:show":t[5]||(t[5]=e=>Y(o)?o.value=e:null),actions:s,"cancel-text":"取消","close-on-click-action":"",onCancel:t[6]||(t[6]=e=>j(r)(!1)),onSelect:D},null,8,["show"])]})),_:1})}}}),[["__scopeId","data-v-4f24fb6d"]]);export{Ee as default};
