var et=Object.defineProperty,tt=Object.defineProperties;var at=Object.getOwnPropertyDescriptors;var De=Object.getOwnPropertySymbols;var ut=Object.prototype.hasOwnProperty,rt=Object.prototype.propertyIsEnumerable;var Ee=(E,m,F)=>m in E?et(E,m,{enumerable:!0,configurable:!0,writable:!0,value:F}):E[m]=F,w=(E,m)=>{for(var F in m||(m={}))ut.call(m,F)&&Ee(E,F,m[F]);if(De)for(var F of De(m))rt.call(m,F)&&Ee(E,F,m[F]);return E},T=(E,m)=>tt(E,at(m));import{h as ot,aa as nt,P as st,G as p,N as Ce,z as Z,$ as ge,l as lt,j as it,r as ee,ag as ct,k as B,p as te,s as I,n as ae,I as dt,v as H,A as q,m as U,B as f,L as Y,E as Pe,F as mt,T as C,D as pt,Y as ft}from"./vendor-a1c35ffc.js";import{_ as Ft,C as Be,I as ht,a1 as vt,J as Ie,a4 as ue}from"./index-f6aa927b.js";import{a as re}from"./order-75f10202.js";import{f as K,R as N,g as yt}from"./infoCollection-4373f9e7.js";import{p as Ne,i as Dt,s as Et,a as Ct,u as gt,b as Bt}from"./trial-37d4377a.js";import{p as It}from"./product-e4eb60e4.js";import{g as _e,s as Nt,t as _t,v as oe,a as Ae,b as At}from"./utils-3d732ab6.js";import{f as wt,a as Tt}from"./utils-b77f2acb.js";import{t as Pt}from"./theme-ea709837.js";import{d as we,B as Ot,D as bt,G as St,S as kt,H as xt,P as Ht,U as Ut,_ as Vt,W as Rt,a as W,p as Te}from"./auth-24fa5b35.js";import{_ as $t}from"./index-48fa44d2.js";import"./trial-69fa7313.js";import"./check-detail-227d5d47.js";import"./index-6cbb0854.js";import"./bankCard-c1cdddcf.js";import"./validator-c3672f03.js";import"./phoneVerify-ec7f22fd.js";import"./close-df102554.js";const Lt={key:0},Mt={class:"page-internet-product-detail"},qt={class:"info"},Yt={class:"footer-button"},Kt={class:"price"},Wt=Pe(" \u603B\u4FDD\u8D39"),Gt={key:0},zt=ot({setup(E){const m=nt(),F=st(),{productCode:G="BWYL2021",tenantId:h,orderNo:g,phoneNo:Oe,agentCode:A="",saleChannelId:be,paymentMethod:Se,certNo:ne,name:se,pageCode:le,upgradeCode:V="",from:ie}=F.query,ce=p(),l=p(),P=p(),y=p(),R=le==="payBack",ke=p(!1),$=p(!1),L=p(!1),xe=p(0),z=p(!1),J=p(!1),j=p({show:!1,html:""}),Q=p(!1),de=p();let X="";const t=Ce({holder:{certNo:ne,certType:Be.CERT,mobile:Oe,name:se,socialFlag:K.HAS},insured:{certNo:ne,certType:Be.CERT,name:se,socialFlag:K.HAS,relationToHolder:N.SELF},paymentMethod:Se,renewalDK:"Y",paymentFrequency:yt.MONTH}),M=p(we),_=p(we),c=Ce({showInsure:!R,canInsure:!1,canUpgrade:!1}),He=Z(()=>{var a,e;return((e=(a=l.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:e.attachmentVOList.filter(u=>u.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),Ue=Z(()=>{var a,e,u,o,r,n,s,d;return[...((e=(a=l.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:e.titleAndDescVOS)||[],{desc:`\u51FA\u751F${wt((o=(u=l.value)==null?void 0:u.tenantProductInsureVO)==null?void 0:o.holderAgeLimit)}`,title:"\u6295\u4FDD\u5E74\u9F84",noDetail:!0},{desc:Tt((n=(r=l.value)==null?void 0:r.tenantProductInsureVO)==null?void 0:n.insurancePeriodValues),title:"\u4FDD\u969C\u671F\u9650",noDetail:!0},{desc:`${(d=(s=l.value)==null?void 0:s.tenantProductInsureVO)==null?void 0:d.waitPeriod}\u5929\uFF0C\u4E0A\u4E00\u5F20\u4FDD\u5355\u671F\u6EE1\u540E\u6307\u5B9A\u671F\u9650\u5185\u91CD\u65B0\u6295\u4FDD\u3001\u56E0\u906D\u53D7\u610F\u5916\u4F24\u5BB3\u5BFC\u81F4\u7684\u533B\u7597\u65E0\u7B49\u5F85\u671F`,title:"\u7B49\u5F85\u671F",noDetail:!0}]}),Ve=Z(()=>{var a,e;return((e=(a=l.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:e.attachmentVOList.filter(u=>u.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),me=()=>{if(t.holder.certNo){const a=Ie(t.holder.certNo);if(oe(t.holder.certNo,18,"year"))return C("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E18\u5C81\uFF01"),!1;if(t.insured.certNo&&t.insured.relationToHolder===N.MATE){const e=Ie(t.insured.certNo);if(a===e)return C("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(t.insured.certNo){if(t.insured.relationToHolder===N.CHILD&&oe(t.insured.certNo,30,"day"))return C("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(t.insured.relationToHolder===N.PARENT&&!oe(t.insured.certNo,71,"year"))return C("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E70\u5C81\uFF01"),!1}if([N.CHILD,N.PARENT].includes(t.insured.relationToHolder)){const a=Ae(t.holder.certNo,"year"),e=Ae(t.insured.certNo,"year");if(t.insured.relationToHolder===N.CHILD&&a-e<18)return C("\u6295\u4FDD\u4EBA\u548C\u5B50\u5973\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1;if(t.insured.relationToHolder===N.PARENT&&e-a<18)return C("\u6295\u4FDD\u4EBA\u548C\u7236\u6BCD\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1}return!0},Re=()=>{const{holder:{certNo:a,mobile:e,name:u,socialFlag:o},insured:{certNo:r,name:n,socialFlag:s,relationToHolder:d},paymentMethod:v}=t;return ht(r)&&!!s},pe=()=>{m.push({path:"/internet/guaranteeUpgrade",query:T(w({},F.query),{tenantId:h,productCode:"BWYL2022",orderNo:g,agentCode:A})})},$e=()=>{J.value=!1,m.replace(`/pay?orderNo=${g}&saleUserId=${A}&tenantId=${h}`)},Le=()=>{_.value=M.value},Me=()=>{_.value=T(w({},_.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},qe=async a=>{C.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0,duration:0});try{const e=await gt(a),{code:u}=e;if(u==="10000"){const o=await Bt({orderNo:a.orderNo,tenantId:h}),{data:r}=o;o.code==="10000"&&(r.type===2?(j.value={show:!0,html:r.paymentUrl},ft(()=>{const n=document.getElementById("cashierSubmit");n==null||n.addEventListener("submit",s=>{s.preventDefault()}),n==null||n.submit()})):window.location.href=r.paymentUrl)}c.canInsure=!0}catch{c.canInsure=!0}finally{C.clear()}},Ye=a=>{var r,n;const e=JSON.parse((n=(r=P.value)==null?void 0:r.productBasicInfoVO)==null?void 0:n.extInfo);let u="";if(e.endorsementFlag===1&&e.endorsementCode)u=`&upgradeCode=${e.endorsementCode}`;else return`${ue}/pay?orderNo=${a}&saleUserId=${A}&tenantId=${h}`;return`${ue}/internet/productDetail?tenantId=${h}&productCode=${G}&orderNo=${a}&agentCode=${A}&pageCode=payBack${u}&from=${ie||"normal"}`},Ke=a=>`${ue}/internet/payFail?tenantId=${h}&orderNo=${a}&agentCode=${A}&pageCode=payBack&from=${ie||"normal"}`,We=async a=>{const e=At({tenantId:h,saleUserId:A,saleChannelId:be,detail:l.value,insureDetail:P.value,paymentMethod:t.paymentMethod,renewalDK:t.renewalDK,iseeBizNo:X,successJumpUrl:"",premium:y.value,holder:t.holder,insured:t.insured,tenantOrderRiskList:a,orderStatus:"",orderTopStatus:"",orderNo:g,originOrderIds:de.value});try{const u=await Et(e),{code:o,data:r}=u;o==="10000"&&qe(T(w({},e),{orderNo:r.data,extInfo:{extraInfo:{renewalDK:t.renewalDK,paymentMethod:t.paymentMethod,paymentFrequency:t.paymentFrequency,successJumpUrl:Ye(r.data),failUrl:Ke(r.data)},iseeBizNo:X}}))}catch{c.canInsure=!0}},Ge=async()=>{if(c.canInsure=!0,!me())return{};const{calcData:a,riskVOList:e}=_e({holder:t.holder,insured:t.insured,tenantId:h,paymentFrequency:t.paymentFrequency,productDetail:l.value,insureDetail:P.value},!0);if(!Array.isArray(e)||e.length<1)return C("\u88AB\u4FDD\u4EBA\u5E74\u9F84\u9700\u572830\u5929(\u542B) - 70\u5C81(\u542B)\u4E4B\u95F4\uFF01"),y.value=null,{};Q.value=!0;const u=await Ne(a);Q.value=!1;const{code:o,data:r}=u;return o==="10000"?t.insured.certNo?(y.value=r.premium,{condition:e,data:r}):(y.value=null,{condition:e,data:r}):{}},ze=()=>new Promise((a,e)=>{var u,o;(o=(u=ce.value)==null?void 0:u.validateForm)==null||o.call(u).then(async()=>{if(!me()){e(new Error);return}const{calcData:r,riskVOList:n}=_e({holder:t.holder,insured:t.insured,tenantId:h,paymentFrequency:t.paymentFrequency,productDetail:l.value,insureDetail:P.value},!0),s=await Ne(r),{code:d,data:v}=s;d==="10000"?(y.value=v.premium,a({condition:n,data:v})):e(new Error)}).catch(r=>{c.canInsure=!0,Nt(r)})}),fe=async()=>{var a;if(R){pe();return}c.canInsure=!1;try{const{condition:e,data:u}=await ze(),o={},r=(s=[])=>{(s||[]).forEach(d=>{var v;o[d.riskCode]=d,((v=d.riskPremiumDetailVOList)==null?void 0:v.length)&&r(d.riskPremiumDetailVOList)})};r(u.riskPremiumDetailVOList);const n=_t({tenantId:h,riskList:e,riskPremium:o,productId:(a=l.value)==null?void 0:a.id});We(n)}catch{c.canInsure=!0}},Je=a=>{a==="allFalse"?($.value=!1,fe(),c.canInsure=!0):pt.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"}).then(()=>{window.history.back()})},je=()=>{ke.value=!0,L.value=!1,$.value=!0};ge([()=>t.insured.certNo,()=>t.insured.socialFlag],lt.exports.debounce(()=>{t.insured.certNo&&t.insured.socialFlag&&le!=="payBack"&&Re()&&Ge()},500),{deep:!0,immediate:!0}),ge(()=>t.insured.certNo,()=>{t.insured.certNo||(y.value=null)});const Fe=async()=>{var o,r,n,s,d,v,O,b,S,k,he,ve,ye;const a=await Ct({orderNo:g,tenantId:h}),{code:e,data:u}=a;if(e==="10000"){const{id:Ze,tenantOrderHolder:D,tenantOrderInsuredList:i,extInfo:x}=u;if(!R){de.value={id:Ze,holderId:D==null?void 0:D.id,insuredId:i==null?void 0:i[0].id},Object.assign(t,{holder:{certNo:D.certNo,certType:D.certType,mobile:D.mobile,name:D.name,socialFlag:K.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(o=i[0])==null?void 0:o.certType,name:(r=i[0])==null?void 0:r.name,socialFlag:(s=(n=i[0])==null?void 0:n.extInfo)==null?void 0:s.hasSocialInsurance,relationToHolder:(d=i[0])==null?void 0:d.relationToHolder},paymentMethod:x.extraInfo.paymentMethod,paymentFrequency:x.extraInfo.paymentFrequency,renewalDK:"Y"}),c.canInsure=!0;return}Object.assign(t,{holder:{certNo:D.certNo,certType:D.certType,mobile:D.mobile,name:D.name,socialFlag:K.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(v=i[0])==null?void 0:v.certType,name:(O=i[0])==null?void 0:O.name,socialFlag:(S=(b=i[0])==null?void 0:b.extInfo)==null?void 0:S.hasSocialInsurance,relationToHolder:(k=i[0])==null?void 0:k.relationToHolder},paymentMethod:x.extraInfo.paymentMethod,paymentFrequency:x.extraInfo.paymentFrequency,renewalDK:x.extraInfo.renewalDK||"N"}),y.value=(ye=(ve=(he=i[0])==null?void 0:he.tenantOrderProductList)==null?void 0:ve[0])==null?void 0:ye.premium,(u.orderStatus===re.ACCEPT_POLICY||u.orderStatus===re.PAYMENT_SUCCESS)&&(c.canUpgrade=!0,z.value=!1,J.value=!0),u.orderStatus===re.PAYING&&(z.value=!0,setTimeout(()=>{Fe()},3*1e3))}},Qe=async()=>{var u;const a=await It({productCode:G,withInsureInfo:!0,tenantId:h});a.code==="10000"&&(l.value=a.data,document.title=((u=a.data)==null?void 0:u.productFullName)||"");const e=await Dt({productCode:G});e.code==="10000"&&(P.value=e.data),g&&Fe()},Xe=()=>{g?R&&V?(console.log("\u6295\u4FDD\u5B8C\u6210\u6765\u5347\u7EA7\u4FDD\u969C\u7684"),_.value=Te,M.value=Te,console.log("\u652F\u4ED8\u5B8C\u6210\u8FDB\u5165")):V||(console.log("\u6295\u4FDD\u94FE\u63A5-\u6765\u4ED8\u94B1"),_.value=T(w({},W),{paymentFrequencyDisable:!0}),M.value=W,c.canInsure=!0):(console.log("\u6295\u4FDD\u94FE\u63A5"),_.value=T(w({},W),{paymentFrequencyDisable:!0}),M.value=W,c.canInsure=!0)};return it(()=>{Xe(),Qe(),setTimeout(async()=>{X=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(a,e)=>{const u=ee("van-loading"),o=ee("van-button"),r=ee("van-config-provider"),n=ct("dompurify-html");return B(),te(mt,null,[I(r,{"theme-vars":f(Pt)},{default:ae(()=>{var s,d,v,O,b,S,k;return[j.value.show?dt((B(),te("div",Lt,null,512)),[[n,j.value.html]]):H("",!0),q("div",Mt,[q("div",qt,[I(Ot,{url:(d=(s=l.value)==null?void 0:s.tenantProductInsureVO)==null?void 0:d.banner[0]},null,8,["url"]),I(bt,{"product-name":(v=l.value)==null?void 0:v.productFullName,"product-desc":(b=(O=l.value)==null?void 0:O.showConfigVO)==null?void 0:b.desc},null,8,["product-name","product-desc"])]),((k=(S=l.value)==null?void 0:S.tenantProductInsureVO)==null?void 0:k.titleAndDescVOS)?(B(),U(St,{key:0,"img-type":"BW","guarantee-list":f(Ue)},null,8,["guarantee-list"])):H("",!0),I(kt,{detail:l.value},{form:ae(()=>[I(xt,{ref_key:"formRef",ref:ce,disable:!f(c).showInsure,"form-auth":_.value,"form-info":f(t),premium:y.value,"product-detail":l.value,payments:[1],"payment-method":[0],onOnReset:Le,onOnUpdate:Me},null,8,["disable","form-auth","form-info","premium","product-detail"])]),_:1},8,["detail"]),q("div",Yt,[q("div",Kt,[Wt,Q.value?(B(),U(u,{key:1,class:"premium-loading",type:"spinner"})):(B(),te("span",Gt,Y(y.value?"\uFFE5":"")+Y(f(vt)(y.value))+Y(y.value?"\u5143/\u6708":""),1))]),I(o,{type:"primary",class:"right",disabled:!(f(c).canInsure||f(c).canUpgrade),onClick:fe},{default:ae(()=>[Pe(Y(f(c).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),f(g)?H("",!0):(B(),U(Ht,{key:1,"product-detail":l.value},null,8,["product-detail"])),f(V)?(B(),U(Ut,{key:2,"order-no":f(g),"tenant-id":f(h),"upgrade-code":f(V),"is-show":J.value,onOnConfirm:pe,onOnClose:$e},null,8,["order-no","tenant-id","upgrade-code","is-show"])):H("",!0)]}),_:1},8,["theme-vars"]),I(Vt,{show:$.value,"onUpdate:show":e[0]||(e[0]=s=>$.value=s),"content-list":f(He),"active-index":0,onOnConfirmHealth:Je},null,8,["show","content-list"]),L.value?(B(),U($t,{key:0,show:L.value,"onUpdate:show":e[1]||(e[1]=s=>L.value=s),"content-list":f(Ve),"active-index":xe.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9",onSubmit:je},null,8,["show","content-list","active-index"])):H("",!0),I(Rt,{"is-show":z.value},null,8,["is-show"])],64)}}});var fa=Ft(zt,[["__scopeId","data-v-399f1348"]]);export{fa as default};
