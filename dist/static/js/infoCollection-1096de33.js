import{q as e,u as t,Y as a,j as n,T as o,b as u,p as r,v as i}from"./index-d66a20d8.js";import{defineAsyncComponent as l,reactive as s,ref as d,computed as v,onBeforeMount as c}from"vue";/* empty css              */import{_ as f,t as p}from"./PayInfo-b4b67b23.js";import{g as m,i as h}from"./trial-0ac61dce.js";import{_ as I}from"./TrialButton-4937b12b.js";import{n as C}from"./nextStep-3971c3a9.js";import{u as y}from"./useAttachment-2f6cf69c.js";import{a as b,q as j}from"./product-d1af8bd8.js";import{g as O}from"./utils-57fec98c.js";import{u as g}from"./useOrder-d2812e23.js";import{P as L,B as P}from"./constants-7afb7c3d.js";import{t as N}from"./utils-7eb757b9.js";import{T as x}from"./index-88f21684.js";import"./pdfh5-e588f83d.js";import"./merge-e7788e50.js";import"./keysIn-131bbce9.js";import"./isObjectLike-a9798079.js";import"./_getTag-d5b47d26.js";import"./debounce-6981b306.js";import"./phoneVerify-a37057a4.js";import"./useDicData-b539129e.js";import"./bankCard-54e59047.js";import"./index-88613e6f.js";import"./core-15eeb464.js";import"./constant-8927d485.js";import"./infoCollection-e6a8a0ee.js";import"./trial-b3f7bf73.js";import"./createProposal-edb2e0a1.js";import"./cloneDeep-6abacc69.js";import"./index-973d3f66.js";import"./index-ceb5d62e.js";import"./box-title-70dc1627.js";import"./index-293de2c7.js";import"./echarts-6ee22673.js";import"./empty-ae586b6c.js";const V={class:"long-info-collection"},_=vue.defineComponent({__name:"infoCollection",setup(_){const w=l((()=>e((()=>import("./index-4bd92c7d.js")),["static/js/index-4bd92c7d.js","static/css/index-fa4edf2a.css","static/js/index-d66a20d8.js","static/css/index-5064de6f.css","static/js/pdfh5-e588f83d.js","static/js/theme-65292714.js","static/js/index-88613e6f.js","static/css/index-827a8544.css","static/js/utils-57fec98c.js","static/js/infoCollection-e6a8a0ee.js","static/js/trial-b3f7bf73.js"]))),k=l((()=>e((()=>import("./index-37ac1006.js")),["static/js/index-37ac1006.js","static/css/index-4640d9aa.css"]))),T=t(),B=g(),{productCode:S="",tenantId:F,agentCode:D="",agencyCode:E,saleChannelId:U,isShare:q,orderNo:R,extraInfo:A,insurerCode:M,preview:H}=T.query;let J={};try{J=JSON.parse(decodeURIComponent(A))}catch(je){}const G=s({isView:!1,personalInfo:{},payInfo:{schema:[],config:[],formData:[]},defaultValue:null,isAutoChange:!1,defaultPlanCode:"",userData:{}}),Y=`${window.origin}/baseInsurance/long/phoneVerify${window.location.search}`,$=d({imgUrl:"",desc:"",title:"",link:Y}),z=d();d();const Q=d(),W=d({}),X=d({}),K=d([]),Z=d(),ee=d({}),te=d(!1),ae=d(!1),ne=d(0),oe=d(!0),{fileList:ue,mustReadFileCount:re,popupFileList:ie}=y(ee,Z),le=d(!1),se=d(!1),de=()=>{ae.value=!1,oe.value=!0,K.value.length<1||(te.value=!0)},ve=()=>{te.value=!1,ae.value=!1,oe.value=!0};d({}),d(!1),d([{}]);const ce=d(""),fe=d(0),pe=d(!1);d(),d(),d(),v((()=>{var e,t;const{insureProductRiskVOList:n}=(null==(t=null==(e=X.value)?void 0:e.productPlanInsureVOList)?void 0:t[0])||{};return(n||[]).find((e=>e.mainRiskFlag===a.YES))}));const me=d(0);d({});const he=d(),Ie=()=>{ce.value="试算中...",fe.value=0,pe.value=!0},Ce=(e,t)=>{ce.value="",me.value=e.premium,fe.value=e,he.value=t,pe.value=!1},ye=async()=>{var e,t;if(H)return void n(L.INFO_COLLECTION,T.query);if(!fe.value)return;const a=[];Q.value&&a.push(null==(e=Q.value)?void 0:e.validate(!1)),z.value&&a.push(null==(t=z.value)?void 0:t.validate(!1)),Promise.all(a).then((()=>{if(!le.value)return void o("请勾选投保人阅读并接受");Object.assign(B.value,{extInfo:{...B.value.extInfo,buttonCode:P.INFO_COLLECTION,pageCode:L.INFO_COLLECTION}});const e=Q.value.dealMixData(),t=N({...e,productCode:S,productName:X.value.productName},fe.value,B.value);C(t,((e,t)=>{t===u.JUMP_PAGE&&r(e.nextPageCode,T.query)}))}))};s({tenantOrderPayInfoList:[]});const be=async()=>{b({productCode:S,tenantId:F}).then((({data:e,code:t})=>{if("10000"===t){W.value=e;const{wxShareConfig:t,showWXShare:a,title:n,desc:o,image:u}=(null==e?void 0:e.PRODUCT_LIST)||{};a?Object.assign($.value,{...t,imgUrl:t.image,isShare:a}):Object.assign($.value,{title:n,desc:o,imgUrl:u,isShare:a}),e.BASIC_INFO&&e.BASIC_INFO.themeType&&i(e.BASIC_INFO.themeType)}})),R&&await m({orderNo:R,tenantId:F}).then((({code:e,data:t})=>{var a;if("10000"===e){if(fe.value=t.orderAmount,(null==(a=t.insuredList)?void 0:a.length)>0){const{planCode:e}=t.insuredList[0];G.defaultPlanCode=e}Object.assign(B.value,t,{tenantOrderPayInfoList:t.tenantOrderPayInfoList||[],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0,withPayInfo:!0},productCode:S}),G.defaultValue=B.value,se.value=!0}})),j({productCode:S}).then((({code:e,data:t})=>{var a,n,o,u;if("10000"===e){const{productMaterialPlanVOList:e,productQuestionnaireVOList:r}=t;Z.value=e||[];const{basicInfo:{questionnaireType:i},questions:l,questionnaireName:s}=(null==(a=null==r?void 0:r[0])?void 0:a.questionnaireDetailResponseVO)||{basicInfo:{}};i&&(K.value=2===i?[{attachmentName:s,attachmentUri:l,attachmentType:"question"}]:[{attachmentName:s,attachmentUri:null==(n=null==l?void 0:l[0])?void 0:n.content,attachmentType:O(String(null==(o=null==l?void 0:l[0])?void 0:o.textType),null==(u=null==l?void 0:l[0])?void 0:u.content)}])}})),await h({productCode:S,isTenant:!H}).then((({data:e,code:t})=>{var a;if("10000"===t){X.value=e,console.log("state.defaultPlanCode",G.defaultPlanCode),ee.value=e.productPlanInsureVOList.find((e=>e.planCode===G.defaultPlanCode))||{};const{payInfo:t}=p(null==(a=ee.value)?void 0:a.productFactor);G.payInfo={...G.payInfo,...t}}}))};return c((()=>{be()})),(e,t)=>{var a,n,r,i,l,s;const d=vue.resolveComponent("ProNavigator"),v=vue.resolveComponent("ProLazyComponent");return vue.openBlock(),vue.createElementBlock("div",V,[vue.createVNode(d),vue.unref(se)||vue.unref(H)?(vue.openBlock(),vue.createBlock(x,{key:0,ref_key:"personalInfoRef",ref:Q,"data-source":vue.unref(ee),"product-info":{productCode:vue.unref(S),productName:vue.unref(X).productName,insurerCode:vue.unref(M),tenantId:vue.unref(F),planList:vue.unref(X).productPlanInsureVOList},"tenant-product-detail":vue.unref(W),"hide-benefit":"","default-data":[vue.unref(G).defaultValue],onTrialStart:Ie,onTrialEnd:Ce,"onUpdate:userData":t[0]||(t[0]=e=>vue.unref(G).userData=e)},null,8,["data-source","product-info","tenant-product-detail","default-data"])):vue.createCommentVNode("",!0),vue.unref(G).payInfo.schema.length?(vue.openBlock(),vue.createBlock(vue.unref(f),{key:1,ref_key:"payInfoRef",ref:z,modelValue:vue.unref(B).tenantOrderPayInfoList,"onUpdate:modelValue":t[1]||(t[1]=e=>vue.unref(B).tenantOrderPayInfoList=e),schema:vue.unref(G).payInfo.schema,"is-view":vue.unref(G).isView,"user-data":vue.unref(G).userData},null,8,["modelValue","schema","is-view","user-data"])):vue.createCommentVNode("",!0),vue.createVNode(v,null,{default:vue.withCtx((()=>{var e;return[(null==(e=vue.unref(ue))?void 0:e.length)?(vue.openBlock(),vue.createBlock(vue.unref(k),{key:0,modelValue:vue.unref(le),"onUpdate:modelValue":t[2]||(t[2]=e=>vue.isRef(le)?le.value=e:null),"attachment-list":vue.unref(ue),"is-show-radio":"","pre-text":"投保人阅读并接受",onPreviewFile:t[3]||(t[3]=e=>(e=>{ne.value=e,ae.value=!0})(e))},null,8,["modelValue","attachment-list"])):vue.createCommentVNode("",!0)]})),_:1}),vue.unref(ae)?(vue.openBlock(),vue.createBlock(vue.unref(w),{key:2,show:vue.unref(ae),"onUpdate:show":t[4]||(t[4]=e=>vue.isRef(ae)?ae.value=e:null),"content-list":vue.unref(oe)?vue.unref(ue):vue.unref(ie),"is-only-view":vue.unref(oe),"active-index":vue.unref(ne),text:vue.unref(oe)?"关闭":"我已逐页阅读并确认告知内容","force-read-count":vue.unref(oe)?0:vue.unref(re),onSubmit:de,onOnCloseFilePreviewByMask:ve},null,8,["show","content-list","is-only-view","active-index","text","force-read-count"])):vue.createCommentVNode("",!0),vue.createVNode(I,{"is-share":vue.unref($).isShare&&!vue.unref(q),premium:null==(a=vue.unref(fe))?void 0:a.initialPremium,"share-info":vue.unref($),"loading-text":vue.unref(ce),"payment-frequency":(null==(s=null==(l=null==(i=null==(r=null==(n=vue.unref(he))?void 0:n.insuredList)?void 0:r[0].productList)?void 0:i[0].riskList)?void 0:l[0])?void 0:s.paymentFrequency)+"","tenant-product-detail":vue.unref(W),"handle-share":e=>(e=>{Q.value.validateHolder(["mobile"]).then((()=>{Object.assign(B.value,{extInfo:{...B.value.extInfo,buttonCode:P.INFO_COLLECTION,pageCode:L.INFO_COLLECTION}});const t=Q.value.getUserData(),a=N({...he.value,holder:null==t?void 0:t.holder},fe.value||{},B.value);C(a,((t,a)=>{a===u.JUMP_PAGE&&(null==e||e())}))})).catch((()=>{o("请录入投保人手机号后进行分享")}))})(e),disabled:!vue.unref(fe),onHandleClick:ye},{default:vue.withCtx((()=>[vue.createTextVNode("下一步")])),_:1},8,["is-share","premium","share-info","loading-text","payment-frequency","tenant-product-detail","handle-share","disabled"])])}}});export{_ as default};
