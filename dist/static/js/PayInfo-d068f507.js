import{d as e,r as a,au as t,aV as i,x as n,bB as s,K as m,Q as r,at as o,c as d,y as l,U as c,e as u,g as y,R as p}from"./index-811aa171.js";import{B as E}from"./ProRenderFormWithCard.vue_vue_type_style_index_0_scoped_true_lang-221e9d34.js";/* empty css              */import{b as h,B as f,a as T}from"./bankCard-183fe83c.js";import{P as R}from"./index-c184b165.js";const v=e({__name:"PayInfo",props:{schema:{default:()=>[]},config:{default:()=>[]},modelValue:{default:()=>[]},isView:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{expose:v,emit:_}){const M=e,I={BANK_PAY:"1",ALI_PAY:"2",WECHAT_PAY:"3"},S=a(null);a();const L=[{title:"首期支付",schema:[],paymentType:h.FIRST_TERM,formData:{initialCardType:f.DEBIT},config:{initialCardType:{isView:!0}},nanoid:t(),paymentMethodKey:"initialPaymentMethod",hiddenKeyList:["initialCardType","initialBankCard","initialPaymentType"]},{title:"续期支付",schema:[],paymentType:h.RENEW_TERM,formData:{sameFirstIssue:String(T.FIRST_SAME),renewalCardType:f.DEBIT},config:{renewalCardType:{isView:!0}},nanoid:t(),hiddenKeyList:["renewalCardType","renewalBankCard","renewalPaymentType"],paymentMethodKey:"renewalPaymentMethod"},{title:"年金领取银行卡",schema:[],paymentType:h.REPRISE,formData:{},config:{},nanoid:t(),paymentMethodKey:"annuityPaymentMethod",hiddenKeyList:["annuityBankCard"]}],P=[["initialPaymentMethod","initialCardType","initialBankCard","initialPaymentType"],["renewalPaymentMethod","renewalCardType","renewalBankCard","renewalPaymentType","premiumOverdue"],["annuityBankCard"]];i();const D=n({schemaList:s(L)}),g=m((()=>["FIRST_TERM","RENEW_TERM","REPRISE"].reduce(((e,a)=>{var t;return e[a]=(t=a,D.schemaList.findIndex((e=>String(e.paymentType)===String(h[t])))),e}),{}))),F=(e,a)=>{var t,i;return e>-1&&(null==(i=null==(t=D.schemaList[e])?void 0:t.formData)?void 0:i.sameFirstIssue)===`${T[a]}`},A=(e,a)=>{const t=D.schemaList[e].paymentMethodKey,i=D.schemaList[a].paymentMethodKey;Object.assign(D.schemaList[e].formData,((e,a)=>{let t={};a&&(t=Object.keys(a).map((t=>({[t]:e[a[t]]}))));return E.reduce(((a,t)=>(a[t]=e[t],a)),t)})(D.schemaList[a].formData,{[t]:i}))};return r((()=>D.schemaList.map((e=>{var a;return null==(a=e.formData)?void 0:a[e.paymentMethodKey]}))),(()=>{D.schemaList.forEach(((e,a)=>{const{formData:i,schema:n,hiddenKeyList:s}=e||{},m=[I.ALI_PAY,I.WECHAT_PAY].includes(null==i?void 0:i[e.paymentMethodKey]);n.forEach((e=>{e.hidden=m&&s.includes(e.name)})),e.nanoid=t()}))}),{deep:!0,immediate:!0}),r((()=>{var e;return null==(e=D.schemaList[g.value.FIRST_TERM])?void 0:e.formData}),(e=>{const a=g.value.RENEW_TERM,t=g.value.REPRISE;F(a,"FIRST_SAME")&&A(a,g.value.FIRST_TERM),F(t,"FIRST_SAME")&&A(t,a)}),{deep:!0}),r((()=>{var e;return null==(e=D.schemaList[g.value.RENEW_TERM])?void 0:e.formData}),(e=>{const a=g.value.REPRISE;F(a,"RENEW_SAME")&&A(a,g.value.RENEW_TERM)}),{deep:!0}),r((()=>{var e,a;return null==(a=null==(e=D.schemaList[g.value.RENEW_TERM])?void 0:e.formData)?void 0:a.sameFirstIssue}),(e=>{const a=g.value.FIRST_TERM,t=g.value.RENEW_TERM;e===String(T.FIRST_SAME)?A(t,a):D.schemaList[t].formData={...L[t].formData,sameFirstIssue:e}}),{immediate:!0}),r((()=>{var e,a;return null==(a=null==(e=D.schemaList[g.value.REPRISE])?void 0:e.formData)?void 0:a.sameFirstIssue}),(e=>{const a=g.value.FIRST_TERM,t=g.value.RENEW_TERM,i=g.value.REPRISE;if([T.FIRST_SAME,T.RENEW_SAME].includes(Number(e))){const n=e===String(T.FIRST_SAME)?a:t;A(i,n)}else D.schemaList[i].formData={...L[i].formData,sameFirstIssue:e}}),{immediate:!0}),r([()=>M.schema,()=>M.config],(()=>{let e=[];o(M.schema)&&(D.schemaList=s(L)),D.schemaList=M.schema.reduce(((a,t)=>{const i=P.findIndex((e=>e.includes(t.name)));return"paymentDrawType"===t.name&&(e=t.columns.map((e=>e.code))),i>-1&&a[i].schema.push({...t,paymentType:L[i].paymentType}),a}),s(L)).map(((e,a)=>({...e,config:{...e.config,...M.config[a]||{}},nanoid:t()}))).filter((({schema:a,...t})=>!e.includes(`${t.paymentType}`)?t:{schema:a,...t}))}),{deep:!0,immediate:!0}),r((()=>M.modelValue),(e=>{o(e)&&D.schemaList.forEach(((a,t)=>{Object.assign(a.formData,e[t])}))}),{deep:!0,immediate:!0}),r((()=>{var e;return null==(e=D.schemaList)?void 0:e.map((e=>e.formData))}),(e=>{o(e)&&_("update:modelValue",e.map((e=>({...e,paymentType:e.paymentType}))))}),{deep:!0,immediate:!0}),v({validate:e=>{var a;return Promise.all(null==(a=S.value)?void 0:a.map((e=>e.validate())))}}),(a,t)=>(d(!0),l(p,null,c(y(D).schemaList,(a=>(d(),u(y(R),{ref_for:!0,ref_key:"payInfoFormRef",ref:S,key:a.nanoid,schema:a.schema,model:a.formData,config:a.config,title:a.title,"is-view":e.isView},null,8,["schema","model","config","title","is-view"])))),128))}});export{v as _};
