import{h as ze,aa as je,P as Qe,r as m,N as Fe,A as G,$ as he,l as Xe,j as Ze,k as J,ag as et,m as B,s as z,t as D,p as j,I as tt,x as k,B as H,n as U,C as p,L as V,G as Ne,F as at,T as E,D as ut,Y as rt}from"./vendor-902054a7.js";import{_ as ot,C as ve,a1 as nt,I as st,J as ye,a4 as De}from"./index-119d3d1b.js";import{a as Q}from"./order-84748336.js";import{S as R,R as C,g as lt}from"./infoCollection-38f1bb04.js";import{p as Ee,i as it,s as ct,g as dt,u as mt,a as pt}from"./trial-4f6d7812.js";import{p as ft}from"./product-82161a47.js";import{g as Ce,t as Ft,v as X,a as ge,b as ht,s as vt}from"./utils-0edefefc.js";import{f as yt,a as Dt}from"./utils-b77f2acb.js";import{t as Et}from"./theme-ea709837.js";import{d as Be,B as Ct,D as gt,G as Bt,S as It,H as Nt,P as _t,U as At,_ as wt,W as Tt,p as Ie,a as L}from"./auth-e51b6482.js";import{_ as Pt}from"./index-41e8fd08.js";import"./trial-a74a8f2e.js";import"./check-detail-c292a89b.js";import"./index-d3e7ac0c.js";import"./bankCard-9a81d270.js";import"./header-logo-59ba1c63.js";import"./phoneVerify-3f24ff08.js";import"./loading-1c9c1d7b.js";import"./close-bad1ffb4.js";const Ot={key:0},St={class:"page-internet-product-detail"},bt={class:"info"},xt={class:"footer-button"},kt={class:"price"},Ht=Ne(" \u603B\u4FDD\u8D39"),Ut={key:0},Vt=ze({setup(Rt){const Z=je(),ee=Qe(),{productCode:M="BWYL2021",tenantId:f,orderNo:y,phoneNo:te,agentCode:I="",saleChannelId:_e,paymentMethod:Ae,certNo:ae,name:ue,pageCode:re,upgradeCode:we,from:oe}=ee.query,ne=m(),l=m(),N=m(),h=m(),O=re==="payBack",Te=m(!1),S=m(!1),b=m(!1),Pe=m(0),$=m(!1),q=m(!1),Y=m({show:!1,html:""}),K=m(!1),se=m();let W="";const t=Fe({holder:{certNo:ae,certType:ve.CERT,mobile:te,name:ue,socialFlag:R.HAS},insured:{certNo:ae,certType:ve.CERT,name:ue,socialFlag:R.HAS,relationToHolder:C.SELF},paymentMethod:Ae,renewalDK:"Y",paymentFrequency:lt.MONTH}),x=m(Be),g=m(Be),c=Fe({showInsure:!O,canInsure:!1,canUpgrade:!1}),Oe=G(()=>{var a,e;return((e=(a=l.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:e.attachmentVOList.filter(u=>u.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),Se=G(()=>{var a,e,u,o,r,n,s,d;return[...((e=(a=l.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:e.titleAndDescVOS)||[],{desc:`\u51FA\u751F${yt((o=(u=l.value)==null?void 0:u.tenantProductInsureVO)==null?void 0:o.holderAgeLimit)}`,title:"\u6295\u4FDD\u5E74\u9F84",noDetail:!0},{desc:Dt((n=(r=l.value)==null?void 0:r.tenantProductInsureVO)==null?void 0:n.insurancePeriodValues),title:"\u4FDD\u969C\u671F\u9650",noDetail:!0},{desc:`${(d=(s=l.value)==null?void 0:s.tenantProductInsureVO)==null?void 0:d.waitPeriod}\u5929\uFF0C\u4E0A\u4E00\u5F20\u4FDD\u5355\u671F\u6EE1\u540E\u6307\u5B9A\u671F\u9650\u5185\u91CD\u65B0\u6295\u4FDD\u3001\u56E0\u906D\u53D7\u610F\u5916\u4F24\u5BB3\u5BFC\u81F4\u7684\u533B\u7597\u65E0\u7B49\u5F85\u671F`,title:"\u7B49\u5F85\u671F",noDetail:!0}]}),be=G(()=>{var a,e;return((e=(a=l.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:e.attachmentVOList.filter(u=>u.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),le=()=>{if(t.holder.certNo){const a=ye(t.holder.certNo);if(X(t.holder.certNo,18,"year"))return E("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E18\u5C81\uFF01"),!1;if(t.insured.certNo&&t.insured.relationToHolder===C.MATE){const e=ye(t.insured.certNo);if(a===e)return E("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(t.insured.certNo){if(t.insured.relationToHolder===C.CHILD&&X(t.insured.certNo,30,"day"))return E("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(t.insured.relationToHolder===C.PARENT&&!X(t.insured.certNo,71,"year"))return E("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E70\u5C81\uFF01"),!1}if([C.CHILD,C.PARENT].includes(t.insured.relationToHolder)){const a=ge(t.holder.certNo,"year"),e=ge(t.insured.certNo,"year");if(t.insured.relationToHolder===C.CHILD&&a-e<18)return E("\u6295\u4FDD\u4EBA\u548C\u5B50\u5973\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1;if(t.insured.relationToHolder===C.PARENT&&e-a<18)return E("\u6295\u4FDD\u4EBA\u548C\u7236\u6BCD\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1}return!0},xe=()=>{const{holder:{certNo:a,mobile:e,name:u,socialFlag:o},insured:{certNo:r,name:n,socialFlag:s,relationToHolder:d},paymentMethod:F}=t;return st(r)&&!!s},ie=()=>{Z.push({path:"/internet/guaranteeUpgrade",query:{...ee.query,tenantId:f,productCode:"BWYL2022",orderNo:y,agentCode:I}})},ke=()=>{q.value=!1,Z.replace(`/pay?orderNo=${y}&saleUserId=${I}&tenantId=${f}`)},He=()=>{g.value=x.value},Ue=()=>{g.value={...g.value,relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1}},Ve=async a=>{E.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0,duration:0});try{const e=await mt(a),{code:u}=e;if(u==="10000"){const o=await pt({orderNo:a.orderNo,tenantId:f}),{data:r}=o;o.code==="10000"&&(r.type===2?(Y.value={show:!0,html:r.paymentUrl},rt(()=>{const n=document.getElementById("cashierSubmit");n==null||n.addEventListener("submit",s=>{s.preventDefault()}),n==null||n.submit()})):window.location.href=r.paymentUrl)}c.canInsure=!0}catch{c.canInsure=!0}finally{E.clear()}},Re=a=>{var r,n;const e=JSON.parse((n=(r=N.value)==null?void 0:r.productBasicInfoVO)==null?void 0:n.extInfo);let u="";return e.endorsementFlag===1&&(u=`&upgradeCode=${e.endorsementCode}`),`${De}/internet/productDetail?tenantId=${f}&productCode=${M}&orderNo=${a}&agentCode=${I}&pageCode=payBack${u}&from=${oe||"normal"}`},Le=a=>`${De}/internet/payFail?tenantId=${f}&orderNo=${a}&agentCode=${I}&pageCode=payBack&from=${oe||"normal"}`,Me=async a=>{const e=ht({tenantId:f,saleUserId:I,saleChannelId:_e,detail:l.value,insureDetail:N.value,paymentMethod:t.paymentMethod,renewalDK:t.renewalDK,iseeBizNo:W,successJumpUrl:"",premium:h.value,holder:t.holder,insured:t.insured,tenantOrderRiskList:a,orderStatus:"",orderTopStatus:"",orderNo:y,originOrderIds:se.value});try{const u=await ct(e),{code:o,data:r}=u;o==="10000"&&Ve({...e,orderNo:r.data,extInfo:{extraInfo:{renewalDK:t.renewalDK,paymentMethod:t.paymentMethod,paymentFrequency:t.paymentFrequency,successJumpUrl:Re(r.data),failUrl:Le(r.data)},iseeBizNo:W}})}catch{c.canInsure=!0}},$e=async()=>{if(c.canInsure=!0,!le())return{};const{calcData:a,riskVOList:e}=Ce({holder:t.holder,insured:t.insured,tenantId:f,paymentFrequency:t.paymentFrequency,productDetail:l.value,insureDetail:N.value},!0);if(!Array.isArray(e)||e.length<1)return E("\u88AB\u4FDD\u4EBA\u5E74\u9F84\u9700\u572830\u5929(\u542B) - 70\u5C81(\u542B)\u4E4B\u95F4\uFF01"),h.value=null,{};K.value=!0;const u=await Ee(a);K.value=!1;const{code:o,data:r}=u;return o==="10000"?t.insured.certNo?(h.value=r.premium,{condition:e,data:r}):(h.value=null,{condition:e,data:r}):{}},qe=()=>new Promise((a,e)=>{var u,o;(o=(u=ne.value)==null?void 0:u.validateForm)==null||o.call(u).then(async()=>{if(!le()){e(new Error);return}const{calcData:r,riskVOList:n}=Ce({holder:t.holder,insured:t.insured,tenantId:f,paymentFrequency:t.paymentFrequency,productDetail:l.value,insureDetail:N.value},!0),s=await Ee(r),{code:d,data:F}=s;d==="10000"?(h.value=F.premium,a({condition:n,data:F})):e(new Error)}).catch(r=>{c.canInsure=!0,vt(r)})}),ce=async()=>{var a;if(O){ie();return}c.canInsure=!1;try{const{condition:e,data:u}=await qe(),o={},r=(s=[])=>{(s||[]).forEach(d=>{var F;o[d.riskCode]=d,(F=d.riskPremiumDetailVOList)!=null&&F.length&&r(d.riskPremiumDetailVOList)})};r(u.riskPremiumDetailVOList);const n=Ft({tenantId:f,riskList:e,riskPremium:o,productId:(a=l.value)==null?void 0:a.id});Me(n)}catch{c.canInsure=!0}},Ye=a=>{a==="allFalse"?(S.value=!1,ce(),c.canInsure=!0):ut.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"}).then(()=>{window.history.back()})},Ke=()=>{Te.value=!0,b.value=!1,S.value=!0};he([()=>t.insured.certNo,()=>t.insured.socialFlag],Xe.exports.debounce(()=>{t.insured.certNo&&t.insured.socialFlag&&re!=="payBack"&&xe()&&$e()},500),{deep:!0,immediate:!0}),he(()=>t.insured.certNo,()=>{t.insured.certNo||(h.value=null)});const de=async()=>{var o,r,n,s,d,F,_,A,w,T,me,pe,fe;const a=await dt({orderNo:y,tenantId:f}),{code:e,data:u}=a;if(e==="10000"){const{id:Je,tenantOrderHolder:v,tenantOrderInsuredList:i,extInfo:P}=u;if(!O){se.value={id:Je,holderId:v==null?void 0:v.id,insuredId:i==null?void 0:i[0].id},Object.assign(t,{holder:{certNo:v.certNo,certType:v.certType,mobile:v.mobile,name:v.name,socialFlag:R.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(o=i[0])==null?void 0:o.certType,name:(r=i[0])==null?void 0:r.name,socialFlag:(s=(n=i[0])==null?void 0:n.extInfo)==null?void 0:s.hasSocialInsurance,relationToHolder:(d=i[0])==null?void 0:d.relationToHolder},paymentMethod:P.extraInfo.paymentMethod,paymentFrequency:P.extraInfo.paymentFrequency,renewalDK:"Y"}),c.canInsure=!0;return}Object.assign(t,{holder:{certNo:v.certNo,certType:v.certType,mobile:v.mobile,name:v.name,socialFlag:R.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(F=i[0])==null?void 0:F.certType,name:(_=i[0])==null?void 0:_.name,socialFlag:(w=(A=i[0])==null?void 0:A.extInfo)==null?void 0:w.hasSocialInsurance,relationToHolder:(T=i[0])==null?void 0:T.relationToHolder},paymentMethod:P.extraInfo.paymentMethod,paymentFrequency:P.extraInfo.paymentFrequency,renewalDK:P.extraInfo.renewalDK||"N"}),h.value=(fe=(pe=(me=i[0])==null?void 0:me.tenantOrderProductList)==null?void 0:pe[0])==null?void 0:fe.premium,(u.orderStatus===Q.ACCEPT_POLICY||u.orderStatus===Q.PAYMENT_SUCCESS)&&(c.canUpgrade=!0,$.value=!1,q.value=!0),u.orderStatus===Q.PAYING&&($.value=!0,setTimeout(()=>{de()},3*1e3))}},We=async()=>{var u;const a=await ft({productCode:M,withInsureInfo:!0,tenantId:f});a.code==="10000"&&(l.value=a.data,document.title=((u=a.data)==null?void 0:u.productFullName)||"");const e=await it({productCode:M});e.code==="10000"&&(N.value=e.data),y&&de()},Ge=()=>{O?(g.value=Ie,x.value=Ie,console.log("\u652F\u4ED8\u5B8C\u6210\u8FDB\u5165")):y?(console.log("\u6295\u4FDD\u94FE\u63A5-\u6765\u4ED8\u94B1"),g.value={...L,paymentFrequencyDisable:!0},x.value=L,c.canInsure=!0):te||y||(console.log("\u6295\u4FDD\u94FE\u63A5"),g.value={...L,paymentFrequencyDisable:!0},x.value=L,c.canInsure=!0)};return Ze(()=>{Ge(),We(),setTimeout(async()=>{W=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(a,e)=>{const u=J("van-loading"),o=J("van-button"),r=J("van-config-provider"),n=et("dompurify-html");return B(),z(at,null,[D(r,{"theme-vars":p(Et)},{default:j(()=>{var s,d,F,_,A,w,T;return[Y.value.show?tt((B(),z("div",Ot,null,512)),[[n,Y.value.html]]):k("",!0),H("div",St,[H("div",bt,[D(Ct,{url:(d=(s=l.value)==null?void 0:s.tenantProductInsureVO)==null?void 0:d.banner[0]},null,8,["url"]),D(gt,{"product-name":(F=l.value)==null?void 0:F.productFullName,"product-desc":(A=(_=l.value)==null?void 0:_.showConfigVO)==null?void 0:A.desc},null,8,["product-name","product-desc"])]),(T=(w=l.value)==null?void 0:w.tenantProductInsureVO)!=null&&T.titleAndDescVOS?(B(),U(Bt,{key:0,"guarantee-list":p(Se)},null,8,["guarantee-list"])):k("",!0),D(It,{detail:l.value},{form:j(()=>[D(Nt,{ref_key:"formRef",ref:ne,disable:!p(c).showInsure,"form-auth":g.value,"form-info":p(t),premium:h.value,"product-detail":l.value,payments:[1],"payment-method":[0],onOnReset:He,onOnUpdate:Ue},null,8,["disable","form-auth","form-info","premium","product-detail"])]),_:1},8,["detail"]),H("div",xt,[H("div",kt,[Ht,K.value?(B(),U(u,{key:1,class:"premium-loading",type:"spinner"})):(B(),z("span",Ut,V(h.value?"\uFFE5":"")+V(p(nt)(h.value))+V(h.value?"\u5143/\u6708":""),1))]),D(o,{type:"primary",class:"right",disabled:!(p(c).canInsure||p(c).canUpgrade),onClick:ce},{default:j(()=>[Ne(V(p(c).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),p(y)?k("",!0):(B(),U(_t,{key:1,"product-detail":l.value},null,8,["product-detail"])),D(At,{"order-no":p(y),"tenant-id":p(f),"upgrade-code":p(we),"is-show":q.value,onOnConfirm:ie,onOnClose:ke},null,8,["order-no","tenant-id","upgrade-code","is-show"])]}),_:1},8,["theme-vars"]),D(wt,{show:S.value,"onUpdate:show":e[0]||(e[0]=s=>S.value=s),"content-list":p(Oe),"active-index":0,onOnConfirmHealth:Ye},null,8,["show","content-list"]),b.value?(B(),U(Pt,{key:0,show:b.value,"onUpdate:show":e[1]||(e[1]=s=>b.value=s),"content-list":p(be),"active-index":Pe.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9",onSubmit:Ke},null,8,["show","content-list","active-index"])):k("",!0),D(Tt,{"is-show":$.value},null,8,["is-show"])],64)}}});var oa=ot(Vt,[["__scopeId","data-v-7ccd9102"]]);export{oa as default};
