import{d as e,aV as a,aW as t,i as o,j as l,r as n,k as i,bc as s,l as u,ca as r,o as d,c,b as v,u as p,p as f,ak as m,w as I,f as h,q as g,v as y,bj as L,bb as C,T as k,ba as O,bi as R,bk as b,a_ as j,cb as w,bO as _,a$ as x,aX as P,cc as V,aY as E}from"./index-066cf51b.js";import{P as D,a as F}from"./PolicyInfo-0e5c6466.js";import{s as N,g as q,m as T}from"./trial-46c505a1.js";import{_ as S}from"./TrialButton-5e696095.js";import{n as U}from"./nextStep-b5827458.js";import{u as A}from"./useAttachment-dbe6bded.js";import"./infoCollection-3431159e.js";import{R as B}from"./trial-74b41113.js";import{u as M}from"./useOrder-b7f10d5a.js";import{t as $}from"./utils-16507f6f.js";import H from"./index-69569fea.js";import{p as J,a as G}from"./utils-b9c41d2e.js";import{f as z,a as K}from"./findLastIndex-2f79cc1e.js";import{c as Y}from"./cloneDeep-634d8e10.js";import"./index-d2b8cb11.js";import"./format-31cde443.js";import"./core-9f316132.js";import"./utils-aafba4c6.js";import"./createProposal-2536d462.js";import"./InsureInfos-28d87360.js";import"./index-1581315d.js";import"./index-f6e52c03.js";import"./questionnaire-42dcb602.js";import"./util-ad06257c.js";import"./product-7bbf9c44.js";import"./constants-6ad2f07c.js";const W={class:"long-info-collection"},X=e({name:"InfoCollection"}),Q=e({...X,setup(e){const X=a((()=>t((()=>import("./index-91e44b8e.js")),["static/js/index-91e44b8e.js","static/css/index-fa4edf2a.css","static/js/index-066cf51b.js","static/css/index-53ee4d9d.css","static/js/theme-94cf7d00.js","static/js/index-d2b8cb11.js","static/css/index-bbfdd7ec.css","static/js/utils-aafba4c6.js","static/js/infoCollection-3431159e.js","static/js/trial-74b41113.js"]))),Q=a((()=>t((()=>import("./index-efc97b08.js")),["static/js/index-efc97b08.js","static/css/index-4822eb94.css","static/js/index-066cf51b.js","static/css/index-53ee4d9d.css"]))),Z=a((()=>t((()=>import("./SelectRiskList-5c0ba0ed.js")),["static/js/SelectRiskList-5c0ba0ed.js","static/css/SelectRiskList-e1e05c2e.css","static/js/index-066cf51b.js","static/css/index-53ee4d9d.css","static/js/trial-46c505a1.js","static/js/trial-74b41113.js"]))),ee=o(),ae=M({}),te=l(!0),{productCode:oe="",tenantId:le,agentCode:ne="",agencyCode:ie,saleChannelId:se,isShare:ue,orderNo:re,extraInfo:de,insurerCode:ce,preview:ve}=ee.query;let pe={};const fe=null,me=l(2);try{pe=JSON.parse(decodeURIComponent(de))}catch(pa){}const Ie={moduleType:7,subModuleType:null,code:"renewFlag",title:"保证续保型的一年期产品在保证续保期间是否申请续保",planCode:null,displayName:null,defaultValue:null,isHidden:null,isReadOnly:null,isMustInput:1,isExtend:null,regex:null,displayType:6,datasource:null,factorScript:null,isCalculationFactor:2,attributeValueList:[{code:"1",value:"是",defaultFlag:null,useFlag:null},{code:"2",value:"否",defaultFlag:null,useFlag:null}],position:null,remark:""},he=n({isView:!1,personalInfo:{},payInfo:{schema:[],config:[],formData:[]},policyInfo:{schema:[],config:[],formData:{}},defaultValue:null,isAutoChange:!1,defaultPlanCode:"",userData:{},solvency:""}),ge=`${window.origin}/baseInsurance/long/phoneVerify${window.location.search}`,ye=l({imgUrl:"",desc:"",title:"",link:ge}),Le=l(),Ce=l();l();const ke=l(),Oe=l({}),Re=l({}),be=l([]),je=l(),we=l({}),_e=l(!1),xe=l(!1),Pe=l(0),Ve=l(!0),{fileList:Ee,mustReadFileCount:De,popupFileList:Fe}=A(we,je);l(!1);const Ne=l(!1),qe=l(!1),Te=()=>{xe.value=!1,Ve.value=!0,be.value.length<1||(_e.value=!0)},Se=()=>{_e.value=!1,xe.value=!1,Ve.value=!0};l({}),l(!1),l([{}]);const Ue=l(""),Ae=l({}),Be=l(!1);l();const Me=l();l();const $e=l([]),He=l(0);l({});const Je=l(),Ge=()=>{Ue.value="试算中...",Ae.value=null,Be.value=!0},ze=(e,a)=>{Ue.value="",He.value=e.premium,Ae.value=e,Je.value=a,Be.value=!1},Ke=l(!1),Ye=l(),We=l({}),Xe=l({productList:[]}),Qe=l({}),Ze=l(),ea=(e,a)=>{var t;const o=[],l=a;return e.forEach((e=>{var a;const{insureProductRiskVOList:t}=(null==(a=e.productPlanInsureVOList)?void 0:a[0])||{};t.reduce(((e,a)=>{const{riskFixedRuleVO:{guaranteedRenewalFlag:t},riskCode:o}=(null==a?void 0:a.riskDetailResVO)||{};return t===E.YES&&e.push(o),e}),o)})),Object.assign(ae.value.extInfo,{renewRisk:o.join(",")}),(null==o?void 0:o.length)?(null==(t=l[7])?void 0:t.length)?l[7].push(Ie):l[7]=[Ie]:l[7]=(l[7]||[]).filter((e=>e.code!==Ie.code)),l},aa=i((()=>{const e=Ze.value[5]||[];return Boolean(e.find((e=>"solvency"===e.code)))})),ta=()=>{T(Xe.value).then((({code:e,data:a})=>{if("10000"===e){const{productDetailResList:e,productFactor:t}=a;Xe.value=G(e),Ze.value=ea(e,t);const{other:o}=_(Ze.value);he.policyInfo=o;const l={};e.forEach((e=>{l[e.productCode]=e})),Qe.value=l}}))},oa=()=>{Ke.value=!1},la=e=>{const a=Xe.value.productList.find((e=>e.productCode===Ye.value)),t=e.map((e=>({riskCode:e,riskType:B.RIDER_RISK,mainRiskCode:We.value.riskCode}))),o=z(a.mergeRiskReqList,(e=>e.riskCode===We.value.riskCode)),l=K(a.mergeRiskReqList,(e=>e.mainRiskCode===We.value.riskCode));let n=o;-1!==l&&(n=l),a.mergeRiskReqList=[...a.mergeRiskReqList.slice(0,n+1),...t,...a.mergeRiskReqList.slice(n+1,a.mergeRiskReqList.length)],ke.value.getRiderRiskDefaultValue(Ye.value,e,We.value.riskCode,a.mergeRiskReqList),ta(),Ke.value=!1},na=(e,a,t)=>{Ke.value=!0,$e.value=t,We.value=a,Ye.value=e},ia=(e,a,t)=>{Qe.value[e],t?(Qe.value[e].productPlanInsureVOList[0].insureProductRiskVOList=Qe.value[e].productPlanInsureVOList[0].insureProductRiskVOList.filter((e=>e.riskCode!==a)),Xe.value.productList=Xe.value.productList.map((t=>(t.productCode===e&&(t.mergeRiskReqList=t.mergeRiskReqList.filter((e=>e.riskCode!==a))),t)))):(Xe.value.productList=Xe.value.productList.filter((a=>a.productCode!==e)),ta())},sa=l(!1),ua=async()=>{var e,a,t;if(ve)return void L(C.INFO_COLLECTION,ee.query);if(!Ae.value)return;const o=[];ke.value&&o.push(null==(e=ke.value)?void 0:e.validate(!1)),Le.value&&o.push(null==(a=Le.value)?void 0:a.validate(!1)),Ce.value&&o.push(null==(t=Ce.value)?void 0:t.validate(!1)),Promise.all(o).then((e=>{if(aa.value&&!Ne.value)return void k("请阅读并勾选特别约定");Object.assign(ae.value,{extInfo:{...ae.value.extInfo,buttonCode:O.INFO_COLLECTION,pageCode:C.INFO_COLLECTION,specNoticeFlag:Ne.value?1:2}});const a=ke.value.dealMixData(),t=$({...a,productCode:oe,productName:Re.value.productName},Ae.value,ae.value);ee.query.productClass=`${me.value}`,delete ee.query.canBack;const o=(()=>{var e,a;const{holder:t,insuredList:o}=he.userData,l=[],n=(e,a)=>{e.ocrData&&Object.keys(e.ocrData).find((a=>(e[a]||e.ocrData[a])&&e.ocrData[a]!==e[a]))&&l.push(`${a}信息影像识别与录入信息不一致，请确认`)};return n(t,"投保人"),n(null==o?void 0:o[0],"被保险人"),((null==(e=null==o?void 0:o[0])?void 0:e.beneficiaryList)||[]).forEach(((e,a)=>{n(e,`受益人${a+1}`)})),n(null==o?void 0:o[0].guardian,"监护人"),n(null==o?void 0:o[0].guardian,"监护人"),((null==(a=ae.value)?void 0:a.tenantOrderPayInfoList)||[]).forEach((e=>{n(null==o?void 0:o[0].guardian,"银行卡")})),l})();sa.value=!0,(null==o?void 0:o.length)?R.confirm({message:null==o?void 0:o[0]}).then((()=>{clearInterval(fe),k.loading({duration:0,message:"自核中..."}),U(t,((e,a)=>{sa.value=!1,k.clear(),a===b.JUMP_PAGE&&j(e.nextPageCode,ee.query)}),ee,!1)})):(clearInterval(fe),k.loading({duration:0,message:"自核中..."}),U(t,((e,a)=>{sa.value=!1,k.clear(),a===b.JUMP_PAGE&&j(e.nextPageCode,ee.query)}),ee,!1))}),(e=>{w(".long-info-collection",".van-field--error")})).catch((e=>{console.log("e",e)}))},ra=e=>{const a=ae.value.tenantOrderPayInfoList[0];ae.value.tenantOrderPayInfoList.splice(0,1,{...a,...e})},da=e=>{Object.assign(he.userData,e)},ca=l(),va=()=>{var e,a;Object.assign(ae.value,{extInfo:{...ae.value.extInfo,buttonCode:O.INFO_COLLECTION,pageCode:C.INFO_COLLECTION}});const t=null==(a=null==(e=ke.value)?void 0:e.dealMixData)?void 0:a.call(e),o=$(t,Ae.value,ae.value);o.orderStatus="collectInfo",N(o).then((({code:e,data:a})=>{"10000"===e&&k("暂存成功")}))};return s((()=>{(async()=>{k.loading("加载中..."),re&&await q({orderNo:re,tenantId:le}).then((({code:e,data:a})=>{var t;if("10000"===e){if((null==(t=a.insuredList)?void 0:t.length)>0){const{planCode:e}=a.insuredList[0];he.defaultPlanCode=e}Object.assign(ae.value,a,{tenantOrderPayInfoList:a.tenantOrderPayInfoList||[],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0,withPayInfo:!0},productCode:oe}),ca.value=Y(ae.value),he.defaultValue=ae.value,Xe.value=J(a.insuredList[0].productList),me.value=a.insuredList[0].productList.length>1?1:2,qe.value=!0}})),await T(Xe.value).then((({data:e,code:a})=>{if("10000"===a){const{productDetailResList:a,productFactor:t,solvency:o}=e;Ze.value=ea(a,t);const l={};a.forEach((e=>{l[e.productCode]=e})),Qe.value=l;const{payInfo:n,other:i}=_(Ze.value);he.payInfo={...he.payInfo,...n},he.solvency=o,he.policyInfo={...he.policyInfo,...i},setTimeout((()=>{te.value=!1}),500)}}))})()})),u((()=>{setTimeout((async()=>{Me.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),r((()=>{clearInterval(fe)})),(e,a)=>{var t,o,l,n,i,s;const u=x,r=P,L=V;return d(),c("div",W,[v(u),p(qe)||p(ve)?(d(),f(H,{key:0,ref_key:"personalInfoRef",ref:ke,"product-info":{productCode:p(oe),productName:p(Re).productName,insurerCode:p(ce),tenantId:p(le),planList:[]},"tenant-product-detail":p(Oe),"hide-benefit":"","product-collection":p(Qe),"default-data":p(ae),"product-factor":p(Ze),"page-loading":p(te),onTrialStart:Ge,onTrialEnd:ze,"onUpdate:userData":da,onUpdateBank:ra,onAddRisk:na,onDeleteRisk:ia},m({_:2},[p(te)?void 0:{name:"middleInfo",fn:I((()=>[p(he).payInfo.schema.length?(d(),f(p(D),{key:0,ref_key:"payInfoRef",ref:Le,modelValue:p(ae).tenantOrderPayInfoList,"onUpdate:modelValue":a[0]||(a[0]=e=>p(ae).tenantOrderPayInfoList=e),schema:p(he).payInfo.schema,"is-view":p(he).isView,"user-data":p(he).userData},null,8,["modelValue","schema","is-view","user-data"])):h("",!0),p(he).policyInfo.schema.length?(d(),f(p(F),{key:1,ref_key:"policyInfoRef",ref:Ce,modelValue:p(ae).extInfo,"onUpdate:modelValue":a[1]||(a[1]=e=>p(ae).extInfo=e),schema:p(he).policyInfo.schema,"is-view":p(he).isView},null,8,["modelValue","schema","is-view"])):h("",!0)])),key:"0"}]),1032,["product-info","tenant-product-detail","product-collection","default-data","product-factor","page-loading"])):h("",!0),v(r,null,{default:I((()=>[!p(te)&&p(aa)?(d(),f(p(Q),{key:0,modelValue:p(Ne),"onUpdate:modelValue":a[2]||(a[2]=e=>g(Ne)?Ne.value=e:null),class:"special-tips","has-bg-color":!1,"attachment-list":p(Ee),"is-show-radio":"","pre-text":`本人已认真阅读下面的特别约定${p(he).solvency}`,onPreviewFile:a[3]||(a[3]=e=>(e=>{Pe.value=e,xe.value=!0})(e))},null,8,["modelValue","attachment-list","pre-text"])):h("",!0)])),_:1}),p(xe)?(d(),f(p(X),{key:1,show:p(xe),"onUpdate:show":a[4]||(a[4]=e=>g(xe)?xe.value=e:null),"content-list":p(Ve)?p(Ee):p(Fe),"is-only-view":p(Ve),"active-index":p(Pe),text:p(Ve)?"关闭":"我已逐页阅读并确认告知内容","force-read-count":p(Ve)?0:p(De),onSubmit:Te,onOnCloseFilePreviewByMask:Se},null,8,["show","content-list","is-only-view","active-index","text","force-read-count"])):h("",!0),v(S,{"is-share":p(ye).isShare&&!p(ue),premium:null==(t=p(Ae))?void 0:t.initialPremium,"share-info":p(ye),"loading-text":p(Ue),"payment-frequency":(null==(s=null==(i=null==(n=null==(l=null==(o=p(Je))?void 0:o.insuredList)?void 0:l[0].productList)?void 0:n[0].riskList)?void 0:i[0])?void 0:s.paymentFrequency)+"","tenant-product-detail":p(Oe),"handle-share":e=>(e=>{ke.value.validateHolder(["mobile"]).then((()=>{Object.assign(ae.value,{extInfo:{...ae.value.extInfo,buttonCode:O.INFO_COLLECTION,pageCode:C.INFO_COLLECTION}});const a=ke.value.getUserData(),t=$({...Je.value,holder:null==a?void 0:a.holder},Ae.value||{},ae.value);U(t,((a,t)=>{t===b.JUMP_PAGE&&(null==e||e())}),ee)})).catch((()=>{k("请录入投保人手机号后进行分享")}))})(e),disabled:!p(Ae)||p(sa)||p(te),onHandleClick:ua},{label:I((()=>[y(" 首年总保费 ")])),default:I((()=>[y("下一步 ")])),_:1},8,["is-share","premium","share-info","loading-text","payment-frequency","tenant-product-detail","handle-share","disabled"]),p(Ke)?(d(),f(p(Z),{key:2,type:p(B).RIDER_RISK,"product-class":p(me),show:p(Ke),"insured-list":p($e),title:"添加附加险","current-product-code":p(Ye),"main-risk-code":p(We).riskCode,"select-list":p(Xe).productList,onCancel:oa,onConfirm:la},null,8,["type","product-class","show","insured-list","current-product-code","main-risk-code","select-list"])):h("",!0),v(L,{"button-image":p("/h5insure/static/png/cache_icon-a458a0d2.png"),onClick:va},null,8,["button-image"])])}}});export{Q as default};
