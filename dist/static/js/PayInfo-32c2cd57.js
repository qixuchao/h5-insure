import{d as e,r as a,ar as t,au as n,t as i,aI as s,I as m,v as r,aq as d,b as o,c as l,X as c,Y as u,i as y,W as p}from"./index-3300826d.js";import{B as E}from"./SchemaRenderField.vue_vue_type_style_index_0_scoped_true_lang-fe6cebc4.js";/* empty css              */import{b as h,B as f,a as T}from"./bankCard-07bf592d.js";import{_ as R}from"./index-aa4b8783.js";const v=e({__name:"PayInfo",props:{schema:{default:()=>[]},config:{default:()=>[]},modelValue:{default:()=>[]},isView:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{expose:v,emit:_}){const M=e,I={BANK_PAY:"1",ALI_PAY:"2",WECHAT_PAY:"3"},S=a(null);a();const L=[{title:"首期支付",schema:[],paymentType:h.FIRST_TERM,formData:{initialCardType:f.DEBIT},config:{initialCardType:{isView:!0}},nanoid:t(),paymentMethodKey:"paymentMethod",hiddenKeyList:["initialCardType","initialBankCard","initialPaymentType"]},{title:"续期支付",schema:[],paymentType:h.RENEW_TERM,formData:{sameFirstIssue:String(T.FIRST_SAME),renewalCardType:f.DEBIT},config:{renewalCardType:{isView:!0}},nanoid:t(),hiddenKeyList:["renewalCardType","renewalBankCard","renewalPaymentType"],paymentMethodKey:"renewalPaymentMethod"},{title:"年金领取银行卡",schema:[],paymentType:h.REPRISE,formData:{},config:{},nanoid:t(),paymentMethodKey:"annuityPaymentMethod",hiddenKeyList:["annuityBankCard"]}],P=[["paymentMethod","initialPaymentMethod","initialCardType","initialBankCard","initialPaymentType"],["renewalPaymentMethod","renewalCardType","renewalBankCard","renewalPaymentType","premiumOverdue"],["annuityPaymentMethod","annuityBankCard"]];n();const D=i({schemaList:s(L)}),F=m((()=>["FIRST_TERM","RENEW_TERM","REPRISE"].reduce(((e,a)=>{var t;return e[a]=(t=a,D.schemaList.findIndex((e=>String(e.paymentType)===String(h[t])))),e}),{}))),g=(e,a)=>{var t,n;return e>-1&&(null==(n=null==(t=D.schemaList[e])?void 0:t.formData)?void 0:n.sameFirstIssue)===`${T[a]}`},A=(e,a)=>{const t=D.schemaList[e].paymentMethodKey,n=D.schemaList[a].paymentMethodKey;Object.assign(D.schemaList[e].formData,((e,a)=>{let t={};a&&(t=Object.keys(a).map((t=>({[t]:e[a[t]]}))));return E.reduce(((a,t)=>(a[t]=e[t],a)),t)})(D.schemaList[a].formData,{[t]:n}))};return r((()=>D.schemaList.map((e=>{var a;return null==(a=e.formData)?void 0:a[e.paymentMethodKey]}))),(()=>{D.schemaList.forEach(((e,a)=>{const{formData:n,schema:i,hiddenKeyList:s}=e||{},m=[I.ALI_PAY,I.WECHAT_PAY].includes(null==n?void 0:n[e.paymentMethodKey]);i.forEach((e=>{e.hidden=m&&s.includes(e.name)})),e.nanoid=t()}))}),{deep:!0,immediate:!0}),r((()=>{var e;return null==(e=D.schemaList[F.value.FIRST_TERM])?void 0:e.formData}),(e=>{const a=F.value.RENEW_TERM,t=F.value.REPRISE;g(a,"FIRST_SAME")&&A(a,F.value.FIRST_TERM),g(t,"FIRST_SAME")&&A(t,a)}),{deep:!0}),r((()=>{var e;return null==(e=D.schemaList[F.value.RENEW_TERM])?void 0:e.formData}),(e=>{const a=F.value.REPRISE;g(a,"RENEW_SAME")&&A(a,F.value.RENEW_TERM)}),{deep:!0}),r((()=>{var e,a;return null==(a=null==(e=D.schemaList[F.value.RENEW_TERM])?void 0:e.formData)?void 0:a.sameFirstIssue}),(e=>{const a=F.value.FIRST_TERM,t=F.value.RENEW_TERM;e===String(T.FIRST_SAME)?A(t,a):D.schemaList[t].formData={...L[t].formData,sameFirstIssue:e}}),{immediate:!0}),r((()=>{var e,a;return null==(a=null==(e=D.schemaList[F.value.REPRISE])?void 0:e.formData)?void 0:a.sameFirstIssue}),(e=>{const a=F.value.FIRST_TERM,t=F.value.RENEW_TERM,n=F.value.REPRISE;if([T.FIRST_SAME,T.RENEW_SAME].includes(Number(e))){const i=e===String(T.FIRST_SAME)?a:t;A(n,i)}else D.schemaList[n].formData={...L[n].formData,sameFirstIssue:e}}),{immediate:!0}),r([()=>M.schema,()=>M.config],(()=>{let e=[];d(M.schema)&&(D.schemaList=s(L)),D.schemaList=M.schema.reduce(((a,t)=>{const n=P.findIndex((e=>e.includes(t.name)));return"paymentDrawType"===t.name&&(e=t.columns.map((e=>e.code))),n>-1&&a[n].schema.push({...t,paymentType:L[n].paymentType}),a}),s(L)).map(((e,a)=>({...e,config:{...e.config,...M.config[a]||{}},nanoid:t()}))).filter((({schema:a,...t})=>!e.includes(`${t.paymentType}`)?t:{schema:a,...t}))}),{deep:!0,immediate:!0}),r((()=>D.schemaList),(e=>{d(e)&&_("update:modelValue",e.map((e=>({...e.formData,paymentType:e.paymentType}))))}),{deep:!0,immediate:!0}),v({validate:e=>{var a;return Promise.all(null==(a=S.value)?void 0:a.map((e=>e.validate())))}}),(a,t)=>(o(!0),l(p,null,c(y(D).schemaList,(a=>(o(),u(y(R),{ref_for:!0,ref_key:"payInfoFormRef",ref:S,key:a.nanoid,schema:a.schema,model:a.formData,config:a.config,title:a.title,"is-view":e.isView},null,8,["schema","model","config","title","is-view"])))),128))}});export{v as _};
