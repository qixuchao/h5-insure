import{g as $e,a9 as Ye,O as Ke,E as m,M as ce,y as W,_ as We,l as ze,h as Ge,r as de,af as Je,j as T,n as z,p as y,m as G,H as je,t as k,z as U,A as p,J as me,C as Ce,k as pe,F as Qe,T as v,D as Xe,X as Ze}from"./vendor-3ed1524d.js";import{_ as et,C as fe,a0 as tt,I as he,H as at,a1 as ye}from"./index-6896b2f1.js";import{a as J}from"./order-26db6dbf.js";import{S as M,R as D,f as rt}from"./infoCollection-192ba138.js";import{p as Fe,i as ot,s as ut,g as nt,u as st,a as lt}from"./trial-4dbb4ebc.js";import{p as it}from"./product-6f7ca3a9.js";import{g as b,a as ve,t as ct,b as dt}from"./utils-4ea9446e.js";import{t as mt}from"./theme-ea709837.js";import{d as De,B as pt,D as ft,G as ht,S as yt,H as Ft,P as vt,U as Dt,_ as Et,W as Ct,p as Ee,a as R}from"./auth-cb47f13c.js";import{_ as gt}from"./index-6e68cfb9.js";import"./utils-b6782348.js";import"./trial-418b528f.js";import"./index-33eb37fa.js";import"./bankCard-0e4ce564.js";import"./phoneVerify-6eb7507c.js";const Nt={key:0},_t={class:"page-internet-product-detail"},It={class:"info"},Bt={class:"footer-button"},wt={class:"price"},At=Ce(" \u603B\u4FDD\u8D39"),Tt={key:0},bt=$e({setup(Ot){const j=Ye(),L=Ke(),{productCode:q="BWYL2021",tenantId:f,orderNo:E,phoneNo:Q,agentCode:N="",saleChannelId:ge,paymentMethod:Ne,certNo:X,name:Z,pageCode:V,upgradeCode:_e,from:ee}=L.query;console.log(L.query,"route.query");const te=m(),i=m(),_=m(),C=m(),O=V==="payBack",Ie=m(!1),P=m(!1),H=m(!1),Be=m(0),$=m(!1),Y=m(!1),S=m({show:!1,html:""});let K="";const t=ce({holder:{certNo:X,certType:fe.CERT,mobile:Q,name:Z,socialFlag:M.HAS},insured:{certNo:X,certType:fe.CERT,name:Z,socialFlag:M.HAS,relationToHolder:D.SELF},paymentMethod:Ne,renewalDK:"Y",paymentFrequency:rt.MONTH}),x=m(De),g=m(De),s=ce({showInsure:!O,canInsure:!1,canUpgrade:!1}),we=W(()=>{var a,e;return((e=(a=i.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:e.attachmentVOList.filter(r=>r.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),Ae=W(()=>{var a,e;return((e=(a=i.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:e.attachmentVOList.filter(r=>r.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),ae=W(()=>{if(t.holder.certNo){const a=b(t.holder.certNo,"year"),e=he(t.holder.certNo);if(a<18)return v("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E18\u5C81\uFF01"),!1;if(t.insured.certNo&&t.insured.relationToHolder===D.MATE){const r=he(t.insured.certNo);if(e===r)return v("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(t.insured.certNo){const a=b(t.insured.certNo,"day"),e=b(t.insured.certNo,"year");if(t.insured.relationToHolder===D.CHILD&&a<30)return v("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(t.insured.relationToHolder===D.PARENT&&e>=71)return v("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E70\u5C81\uFF01"),!1}if([D.CHILD,D.PARENT].includes(t.insured.relationToHolder)){const a=b(t.holder.certNo,"year"),e=b(t.insured.certNo,"year");if(t.insured.relationToHolder===D.CHILD&&a-e<18)return v("\u6295\u4FDD\u4EBA\u548C\u5B50\u5973\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1;if(t.insured.relationToHolder===D.PARENT&&e-a<18)return v("\u6295\u4FDD\u4EBA\u548C\u7236\u6BCD\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1}return!0}),Te=()=>{const{holder:{certNo:a,mobile:e,name:r,socialFlag:n},insured:{certNo:o,name:u,socialFlag:c,relationToHolder:d},paymentMethod:h}=t;return at(o)&&!!c},re=()=>{j.push({path:"/internet/guaranteeUpgrade",query:{...L.query,tenantId:f,productCode:"BWYL2022",orderNo:E,agentCode:N}})},be=()=>{Y.value=!1,j.replace(`/pay?orderNo=${E}&saleUserId=${N}&tenantId=${f}`)},Oe=()=>{g.value=x.value},Pe=()=>{g.value={...g.value,relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1}},He=async a=>{v.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const e=await st(a),{code:r}=e;if(r==="10000"){v.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const n=await lt({orderNo:a.orderNo,tenantId:f}),{data:o}=n;n.code==="10000"&&(o.type===2?(S.value={show:!0,html:o.paymentUrl},console.log("data.paymentUrl",S.value),Ze(()=>{console.log("document.forms",document.forms);const u=document.getElementById("cashierSubmit");u==null||u.addEventListener("submit",c=>{c.preventDefault()}),u==null||u.submit()})):window.location.href=o.paymentUrl)}s.canInsure=!0}catch{s.canInsure=!0}},Se=a=>{var o,u;const e=JSON.parse((u=(o=_.value)==null?void 0:o.productBasicInfoVO)==null?void 0:u.extInfo);let r="";return e.endorsementFlag===1&&(r=`&upgradeCode=${e.endorsementCode}`),`${ye}/internet/productDetail?tenantId=${f}&productCode=${q}&orderNo=${a}&agentCode=${N}&pageCode=payBack${r}&from=${ee||"normal"}`},xe=a=>`${ye}/internet/payFail?tenantId=${f}&orderNo=${a}&agentCode=${N}&pageCode=payBack&from=${ee||"normal"}`,ke=async a=>{const e=dt({tenantId:f,saleUserId:N,saleChannelId:ge,detail:i.value,insureDetail:_.value,paymentMethod:t.paymentMethod,renewalDK:t.renewalDK,iseeBizNo:K,successJumpUrl:"",premium:C.value,holder:t.holder,insured:t.insured,tenantOrderRiskList:a,orderStatus:"",orderTopStatus:""});try{const r=await ut(e),{code:n,data:o}=r;n==="10000"&&He({...e,orderNo:o.data,extInfo:{extraInfo:{renewalDK:t.renewalDK,paymentMethod:t.paymentMethod,paymentFrequency:t.paymentFrequency,successJumpUrl:Se(o.data),failUrl:xe(o.data)},iseeBizNo:K}})}catch{s.canInsure=!0}},Ue=async()=>{if(!ae.value)return{};const{calcData:a,riskVOList:e}=ve({holder:t.holder,insured:t.insured,tenantId:f,paymentFrequency:t.paymentFrequency,productDetail:i.value,insureDetail:_.value},!0),r=await Fe(a),{code:n,data:o}=r;return n==="10000"?(C.value=o.premium,{condition:e,data:o}):{}},Me=()=>new Promise((a,e)=>{var r,n;(n=(r=te.value)==null?void 0:r.validateForm)==null||n.call(r).then(async()=>{if(!ae.value)return;const{calcData:o,riskVOList:u}=ve({holder:t.holder,insured:t.insured,tenantId:f,paymentFrequency:t.paymentFrequency,productDetail:i.value,insureDetail:_.value},!0),c=await Fe(o),{code:d,data:h}=c;d==="10000"?(C.value=h.premium,a({condition:u,data:h})):e(new Error)}).catch(()=>{s.canInsure=!0})}),oe=async()=>{var a;if(O){re();return}s.canInsure=!1;try{const{condition:e,data:r}=await Me(),n={},o=(c=[])=>{(c||[]).forEach(d=>{var h;n[d.riskCode]=d,(h=d.riskPremiumDetailVOList)!=null&&h.length&&o(d.riskPremiumDetailVOList)})};o(r.riskPremiumDetailVOList);const u=ct({tenantId:f,riskList:e,riskPremium:n,productId:(a=i.value)==null?void 0:a.id});ke(u)}catch{s.canInsure=!0}},Re=a=>{a==="allFalse"?(P.value=!1,oe(),s.canInsure=!0):Xe.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"}).then(()=>{window.history.back()})},Le=()=>{Ie.value=!0,H.value=!1,P.value=!0};We([()=>t.insured.certNo,()=>t.insured.socialFlag],ze.exports.debounce(()=>{t.insured.certNo&&t.insured.socialFlag&&V!=="payBack"&&Te()&&Ue()},500),{deep:!0,immediate:!0});const ue=async()=>{var n,o,u,c,d,h,I,B,w,ne,se,le,ie;const a=await nt({orderNo:E,tenantId:f}),{code:e,data:r}=a;if(e==="10000"){const{tenantOrderHolder:F,tenantOrderInsuredList:l,extInfo:A}=r;if(!O){Object.assign(t,{holder:{certNo:F.certNo,certType:F.certType,mobile:F.mobile,name:F.name,socialFlag:M.HAS},insured:{certNo:l==null?void 0:l[0].certNo,certType:(n=l[0])==null?void 0:n.certType,name:(o=l[0])==null?void 0:o.name,socialFlag:(c=(u=l[0])==null?void 0:u.extInfo)==null?void 0:c.hasSocialInsurance,relationToHolder:(d=l[0])==null?void 0:d.relationToHolder},paymentMethod:A.extraInfo.paymentMethod,paymentFrequency:A.extraInfo.paymentFrequency,renewalDK:"Y"}),s.canInsure=!0;return}Object.assign(t,{holder:{certNo:F.certNo,certType:F.certType,mobile:F.mobile,name:F.name,socialFlag:M.HAS},insured:{certNo:l==null?void 0:l[0].certNo,certType:(h=l[0])==null?void 0:h.certType,name:(I=l[0])==null?void 0:I.name,socialFlag:(w=(B=l[0])==null?void 0:B.extInfo)==null?void 0:w.hasSocialInsurance,relationToHolder:(ne=l[0])==null?void 0:ne.relationToHolder},paymentMethod:A.extraInfo.paymentMethod,paymentFrequency:A.extraInfo.paymentFrequency,renewalDK:A.extraInfo.renewalDK||"N"}),C.value=(ie=(le=(se=l[0])==null?void 0:se.tenantOrderProductList)==null?void 0:le[0])==null?void 0:ie.premium,(r.orderStatus===J.ACCEPT_POLICY||r.orderStatus===J.PAYMENT_SUCCESS)&&(s.canUpgrade=!0,$.value=!1,Y.value=!0),r.orderStatus===J.PAYING&&($.value=!0,setTimeout(()=>{ue()},3*1e3))}},qe=async()=>{const a=it({productCode:q,withInsureInfo:!0,tenantId:f}),e=ot({productCode:q});await Promise.all([a,e]).then(([r,n])=>{var o;r.code==="10000"&&(i.value=r.data,document.title=((o=r.data)==null?void 0:o.productFullName)||""),n.code==="10000"&&(_.value=n.data)}),E&&ue()},Ve=()=>{O?(g.value=Ee,x.value=Ee,console.log("\u652F\u4ED8\u5B8C\u6210\u8FDB\u5165")):E?(console.log("\u6295\u4FDD\u94FE\u63A5-\u6765\u4ED8\u94B1"),g.value={...R,paymentFrequencyDisable:!0},x.value=R,s.canInsure=!0):Q||E||(console.log("\u6295\u4FDD\u94FE\u63A5"),g.value={...R,paymentFrequencyDisable:!0},x.value=R,s.canInsure=!0)};return Ge(()=>{Ve(),qe(),setTimeout(async()=>{K=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(a,e)=>{const r=de("van-button"),n=de("van-config-provider"),o=Je("dompurify-html");return T(),z(Qe,null,[y(n,{"theme-vars":p(mt)},{default:G(()=>{var u,c,d,h,I,B,w;return[S.value.show?je((T(),z("div",Nt,null,512)),[[o,S.value.html]]):k("",!0),U("div",_t,[U("div",It,[y(pt,{url:(c=(u=i.value)==null?void 0:u.tenantProductInsureVO)==null?void 0:c.banner[0]},null,8,["url"]),y(ft,{"product-name":(d=i.value)==null?void 0:d.productFullName,"product-desc":(I=(h=i.value)==null?void 0:h.showConfigVO)==null?void 0:I.desc},null,8,["product-name","product-desc"])]),y(ht,{"guarantee-list":(w=(B=i.value)==null?void 0:B.tenantProductInsureVO)==null?void 0:w.titleAndDescVOS},null,8,["guarantee-list"]),y(yt,{detail:i.value},{form:G(()=>[y(Ft,{ref_key:"formRef",ref:te,disable:!p(s).showInsure,"form-auth":g.value,"form-info":p(t),premium:C.value,"product-detail":i.value,payments:[1],"payment-method":[0],onOnReset:Oe,onOnUpdate:Pe},null,8,["disable","form-auth","form-info","premium","product-detail"])]),_:1},8,["detail"]),U("div",Bt,[U("div",wt,[At,C.value?(T(),z("span",Tt,"\uFFE5"+me(p(tt)(C.value))+"/\u6708",1)):k("",!0)]),y(r,{type:"primary",class:"right",disabled:!(p(s).canInsure||p(s).canUpgrade),onClick:oe},{default:G(()=>[Ce(me(p(s).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),p(V)!=="payBack"?(T(),pe(vt,{key:1,"product-detail":i.value},null,8,["product-detail"])):k("",!0),y(Dt,{"order-no":p(E),"tenant-id":p(f),"upgrade-code":p(_e),"is-show":Y.value,onOnConfirm:re,onOnClose:be},null,8,["order-no","tenant-id","upgrade-code","is-show"])]}),_:1},8,["theme-vars"]),y(Et,{show:P.value,"onUpdate:show":e[0]||(e[0]=u=>P.value=u),"content-list":p(we),"active-index":0,onOnConfirmHealth:Re},null,8,["show","content-list"]),H.value?(T(),pe(gt,{key:0,show:H.value,"onUpdate:show":e[1]||(e[1]=u=>H.value=u),"content-list":p(Ae),"active-index":Be.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9",onSubmit:Le},null,8,["show","content-list","active-index"])):k("",!0),y(Ct,{"is-show":$.value},null,8,["is-show"])],64)}}});var zt=et(bt,[["__scopeId","data-v-5e7dc05f"]]);export{zt as default};
