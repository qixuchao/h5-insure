import{d as e,i as t,h as a,j as o,k as i,aR as s,l as n,bV as r,o as u,c as l,u as d,p as c,bR as p,f as v,w as f,v as b,b as m,dv as y,aB as h,T as q,aI as g,aG as I,aZ as j,aX as T,bS as N,bT as w,ds as C,bP as k}from"./index-c77f497b.js";import{l as x}from"./product-bc426308.js";import{O,Q as R}from"./questionnaire-42dcb602.js";import{g as $}from"./utils-6fb400b2.js";import{n as L}from"./nextStep-34b1f9d6.js";import{u as P}from"./useOrder-abef6b73.js";import{g as _}from"./trial-8366872d.js";import{N as E,Q as V,a as S}from"./notice-8b73b56d.js";import{P as A}from"./constants-6c7c253a.js";import{u as B}from"./useThread-637a02aa.js";import"./infoCollection-2bb14c70.js";import"./trial-b466dbb7.js";import"./core-29010964.js";import"./utils-e1c9ceb5.js";import"./createProposal-dc06ef6b.js";import"./PolicyInfo-00dddf8e.js";const U={class:"long-health-notice-wrap"},D={key:1,class:"footer-btn footer-button"},Q={key:2,class:"footer-btn"},J=e({__name:"healthNotice",setup(e){const J=t(),M=a(),z=P({}),{orderNo:G,tenantId:X,preview:F,agentCode:H,questionnaireId:W}=J.query,Y=o({}),Z=o(),K=o(),ee=o(),te=o([]),ae=o({orderNo:G,tenantId:X,noticeType:K}),oe=o(),ie=o(),se=o(!1),ne=o(),re=o(!1),ue=o(),le=()=>{Z.value?M.push({path:`${A.healthNotice}/${Z.value}`,query:{...J.query,questionnaireId:Z.value}}):F?M.push({path:A.infoPreview,query:J.query}):(z.value.extInfo.buttonCode=y.short.saveNoticeNextPage,z.value.extInfo.pageCode="healthNotice",L(z.value,((e,t,a)=>{t===j.JUMP_PAGE?M.push({path:A.holderInfoPreview,query:J.query}):t===j.JUMP_ALERT&&"faceAuth"===e.alertType&&T.confirm({message:a,confirmButtonText:"去分享",cancelButtonText:"被保险人确认"}).then((()=>{const e={...J.query,isShare:1,orderNo:G,agentCode:H,objectType:"insured",origin:"share"};oe.value={title:"标题",desc:"描述",imageUrl:C,url:`${window.location.origin}${A.faceVerify}?${k.stringify(e)}`,link:`${window.location.origin}${A.faceVerify}?${k.stringify(e)}`},ie.value.handleShare(oe.value),se.value=!0,ne.value.run()})).catch((()=>{M.push({path:A.faceVerify,query:{...J.query,objectType:"insured",origin:"confirm"}})}))})))},de=()=>{K.value===E.INSURED?(z.value.extInfo.buttonCode=y.short.saveNotice,z.value.extInfo.pageCode="healthNotice",L(z.value,((e,t,a)=>{t===j.JUMP_ALERT?T.alert({message:a,confirmButtonText:"确定"}):t===j.CONTINUE&&le()}))):le()},ce=o([]),pe=i((()=>!(!ce.value.length||K.value!==O.HOLDER)&&!!ce.value.find((e=>`${e.id}`===W)))),ve=()=>{const e=te.value.find((e=>e.id===ee.value));Object.assign(Y.value,null==e?void 0:e.questionnaireDetailResponseVO)},fe=async(e=!0)=>{var t,a,o;const{code:i,data:s}=await _({orderNo:G,tenantId:X},{loading:e});if("10000"===i){re.value=(null==(a=null==(t=s.insuredList)?void 0:t[0])?void 0:a.faceAuthFlag)===h.YES,re.value&&(ne.value.isStart&&q("被保险人认证完成"),ne.value.stop()),Object.assign(z.value,s,{extInfo:{...s.extInfo,pageCode:"healthNotice",buttonCode:y.short.saveNotice}});const e=null==(o=s.insuredList[0])?void 0:o.planCode,i=s.insuredList[0].productList.map((e=>e.productCode));ae.value.objectId=s.insuredList[0].id,(async(e,t)=>{var a;const{code:o,data:i}=await N({orderNo:G,tenantId:X});"10000"===o&&(te.value=i.productQuestionnaireVOList);const{code:s,data:n}=await x(e);if("10000"===s){const{productQuestionnaireVOList:e}=n||{},o=e.filter((e=>("-1"===e.planCode||!t||e.planCode===t)&&e.businessType===V.NEW_CONTRACT&&-1!==e.noticeObject));(null==o?void 0:o.length)||q("未匹配到健康告知问卷"),ce.value=o;let i=o[0]||{};if((null==o?void 0:o.length)>1)if(W){const e=o.findIndex((e=>`${e.id}`===W));o[e]&&(i=o[e]),o[e+1]&&(Z.value=o[e+1].id)}else Z.value=null==(a=o[1])?void 0:a.id;const{questionnaireDetailResponseVO:s,questionnaireId:r,questionnaireName:u,noticeObject:l}=i||{},{questions:d,basicInfo:c}=s||{},{questionnaireType:p}=c||{};if(K.value=l,w(`${S[l]}健康告知`),ee.value=r,p===R.TEXT){const{content:e,textType:t}=(null==d?void 0:d[0])||{};Y.value={content:e,contentType:$(`${t}`,e),questionnaireId:r,questionnaireName:u}}else{const e=(te.value||[]).find((e=>e.questionnaireId===ee.value&&e.noticeObject===K.value));Y.value={...s,questionnaireId:r,contentType:"question",...null==e?void 0:e.questionnaireDetailResponseVO}}}})({productCodeList:i},e)}};ne.value=B({start:()=>{fe(!1),re.value=!1},stop:()=>{re.value=!0},time:1e4,number:0});const be=()=>{var e;null==(e=ue.value)||e.submitQuestion()};s((()=>{!F&&fe()}));const me=o();return n((()=>{setTimeout((async()=>{me.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),r((()=>{ne.value.stop()})),(e,t)=>{const a=g,o=I;return u(),l("div",U,[d(Y)?(u(),c(p,{key:0,ref_key:"previewRef",ref:ue,type:d(Y).contentType,content:d(Y),params:d(ae),"is-view":d(se),"mark-requested":!1,"success-callback":de},null,8,["type","content","params","is-view"])):v("",!0),"question"===d(Y).contentType&&d(Y).questionnaireId?(u(),l("div",D,[d(pe)?(u(),c(a,{key:0,round:"",type:"primary",plain:"",onClick:ve},{default:f((()=>[b("同被保险人")])),_:1})):v("",!0),m(a,{round:"",type:"primary",block:"",disabled:d(se)&&!d(re),onClick:be},{default:f((()=>[b(" 下一步 ")])),_:1},8,["disabled"])])):(u(),l("div",Q,[m(a,{round:"",type:"primary",block:"",disabled:d(se)&&!d(re),onClick:de},{default:f((()=>[b(" 下一步 ")])),_:1},8,["disabled"])])),m(o,{ref_key:"shareRef",ref:ie},null,512)])}}});export{J as default};
