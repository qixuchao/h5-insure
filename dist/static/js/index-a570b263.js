import{g as O,Q as H,C as E,d as g,ab as Z,r as T,k as D,m as b,y as p,I as N,B as M,z as l,n as _,j as B,T as x,L,a4 as R,a9 as ae,G as z,H as te,J as j,F as A,E as W,h as k,D as G,a0 as oe,M as le,s as F,a5 as ue,a2 as ne,a3 as ie}from"./vendor-e9263418.js";import{b as J,u as de}from"./index-b8742a0a.js";import{u as q}from"./useCheckBack-f80d3d5c.js";import{q as Q,Z as se,c as ce,s as re,d as ve}from"./daily-f7fbbe99.js";import{_ as X}from"./plugin-vue_export-helper-46f75680.js";import{Z as me}from"./index-1d81fe2a.js";import{b as P}from"./record-2e0ec2a3.js";import"./play-93cba0e9.js";import"./jsbridge-7ca0f033.js";const pe={class:"com-date-select"},fe={class:"label"},ye={class:"date"},De=O({props:{modelValue:{type:String,default:""},name:{type:String,default:"date"},label:{type:String,default:"\u9009\u62E9\u65E5\u671F"},placeholder:{type:String,default:"\u70B9\u51FB\u9009\u62E9\u65E5\u671F"},disabled:{type:Boolean,default:!1},isView:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(m,{emit:f}){const d=m,C=new Date("1990/01/01"),r=new Date("2050/12/31"),c=H(),h=E(!1),u=E(g(d.modelValue).format("YYYY-MM-DD")),o=E(new Date(d.modelValue.replace(/-/g,"/")));Z(()=>{u.value=g(d.modelValue).format("YYYY-MM-DD"),o.value=new Date(d.modelValue.replace(/-/g,"/"))});const e=()=>{d.disabled||(h.value=!0)},y=n=>{d.isView?Q({userId:c.query.userId,workDay:g(n).format("YYYY-MM-DD HH:mm:ss")}).then(v=>{v.data.status===200&&v.data.data?(u.value=g(n).format("YYYY-MM-DD"),f("update:modelValue",g(n).format("YYYY-MM-DD")),h.value=!1):x.fail("\u6240\u9009\u65E5\u671F\u672A\u586B\u5199\u5DE5\u4F5C\u65E5\u5FD7")}):(u.value=g(n).format("YYYY-MM-DD"),f("update:modelValue",g(n).format("YYYY-MM-DD")),h.value=!1)};return(n,v)=>{const V=T("van-icon"),Y=T("van-datetime-picker"),$=T("van-popup");return D(),b("div",pe,[p("div",{class:"input",onClick:e},[p("div",fe,N(m.label),1),p("div",ye,[M(N(l(g)(o.value).format("YYYY-MM-DD")),1),_(V,{name:"arrow",color:"#ddd"})])]),_($,{show:h.value,"onUpdate:show":v[2]||(v[2]=I=>h.value=I),position:"bottom"},{default:B(()=>[_(Y,{modelValue:o.value,"onUpdate:modelValue":v[0]||(v[0]=I=>o.value=I),"min-date":l(C),"max-date":l(r),type:"date",title:"\u9009\u62E9\u65E5\u671F",onConfirm:y,onCancel:v[1]||(v[1]=I=>h.value=!1)},null,8,["modelValue","min-date","max-date"])]),_:1},8,["show"])])}}});var ge=X(De,[["__scopeId","data-v-603f26bc"]]);const _e={class:"title"},Ce={class:"label"},he=M(" \u8BED\u97F3 "),Ve={class:"body"},Ee={class:"textarea-wrapper"},be={class:"voice-list"},Fe=O({props:{modelValue:{type:Object,default:()=>({content:"",voice:[]})},label:{type:String,default:""},name:{type:String,default:""},placeholder:{type:String,default:"\u8BF7\u8F93\u5165..."},max:{type:Number,default:200},disabled:{type:Boolean,default:!1},maxVoiceCount:{type:Number,default:5}},emits:["update:modelValue","voiceClick"],setup(m,{emit:f}){const d=m,C=E(!1);E(-1);const r=E(null),c=L(d.modelValue);Z(()=>{c.content=d.modelValue.content,c.voice=d.modelValue.voice});const h=()=>{c.voice.length<d.maxVoiceCount&&(C.value=!0)};R([()=>c],([y])=>{f("update:modelValue",y)});const u=y=>{const{file:n,duration:v}=y;c.voice.push({voiceUrl:n,voiceDuration:v})},o=(y,n)=>{G.confirm({title:"\u786E\u8BA4\u5220\u9664\u6B64\u8BED\u97F3\u5417\uFF1F"}).then(()=>{c.voice.splice(y,1),P()}).catch(v=>{console.log(v)})},e=()=>{setTimeout(()=>{if(r.value){const{top:y}=r.value.getBoundingClientRect(),n=document.querySelector(".page-container");n&&(n.scrollTop+=y,console.log(y,n.scrollTop))}},200)};return ae(()=>{P()}),(y,n)=>{const v=T("van-field");return D(),b(A,null,[p("div",{ref_key:"dom",ref:r,class:"com-text-voice"},[p("div",_e,[p("div",Ce,N(m.label),1),z(p("div",{class:j(["voice-btn",{"in-active":l(c).voice.length>=m.maxVoiceCount}]),onClick:h},[_(J,{name:"mic",class:"mic-icon"}),he],2),[[te,!m.disabled]])]),p("div",Ve,[p("div",Ee,[_(v,{modelValue:l(c).content,"onUpdate:modelValue":n[0]||(n[0]=V=>l(c).content=V),modelModifiers:{trim:!0},class:"textarea",placeholder:m.placeholder,maxlength:m.max,disabled:m.disabled,name:m.name,"input-align":"left",rows:"3",type:"textarea","show-word-limit":"",onFocus:e},null,8,["modelValue","placeholder","maxlength","disabled","name"])]),p("div",be,[(D(!0),b(A,null,W(l(c).voice,(V,Y)=>(D(),k(se,{key:Y,url:V.voiceUrl,duration:V.voiceDuration,"show-delete":!m.disabled,onDeleteClick:$=>o(Y)},null,8,["url","duration","show-delete","onDeleteClick"]))),128))])])],512),_(me,{visible:C.value,"onUpdate:visible":n[1]||(n[1]=V=>C.value=V),onRecord:u},null,8,["visible"])],64)}}});var w=X(Fe,[["__scopeId","data-v-722eb481"]]);const K=m=>(ne("data-v-80779372"),m=m(),ie(),m),ke=K(()=>p("div",null,null,-1)),Te=K(()=>p("div",{class:"divider"},null,-1)),Ye={class:"detail"},Ie={class:"detail-title-list"},we=["onClick"],Be=["src"],xe={class:"title"},Ne={class:"page-add-daily-footer"},Me={class:"footer"},$e=M(" \u5220\u9664 "),Ue=M("\u6D3B\u52A8\u91CF\u6570\u636E"),Se=O({setup(m){const{getIconUrl:f}=de(),d=H(),C=oe(),r=E(!1),c=E(!1),h=E(!0),u={TEXT:"1",VOICE:"2"},o=L({workDay:d.query.date||g().format("YYYY-MM-DD"),data:{content:"",voice:[]}}),e=L([{tagName:"\u4F18\u70B9",image:f("daily.advantageImage"),activeImage:f("daily.advantageActiveImage"),active:!1,tagCode:"",data:{content:"",voice:[]}},{tagName:"\u4E0D\u8DB3",image:f("daily.insufficientImage"),activeImage:f("daily.insufficientActiveImage"),active:!1,tagCode:"",data:{content:"",voice:[]}},{tagName:"\u5FC3\u5F97",image:f("daily.experienceImage"),activeImage:f("daily.experienceActiveImage"),active:!1,tagCode:"",data:{content:"",voice:[]}},{tagName:"\u89C4\u5212",image:f("daily.planImage"),activeImage:f("daily.planActiveImage"),active:!1,tagCode:"",data:{content:"",voice:[]}},{tagName:"\u56E2\u961F\u89C4\u5212",image:f("daily.teamPlanImage"),activeImage:f("daily.teamPlanActiveImage"),active:!1,tagCode:"",data:{content:"",voice:[]}}]);q(o,e);let y="",n="";const v=i=>{Q(i).then(a=>{a.data.status===200&&a.data.data?(console.log(a.data.data.workDay,33),o.data.content="",o.data.voice=[],e.forEach(t=>{t.data.content="",t.data.voice=[],t.active=!1}),o.workDay=a.data.data.workDay,n=a.data.data.dailyId,o.data.voice=[],e[0].data.voice=[],e[1].data.voice=[],e[2].data.voice=[],e[3].data.voice=[],e[4].data.voice=[],a.data.data.detailList.forEach(t=>{switch(t.tagName){case"\u5DE5\u4F5C\u65E5\u5FD7":t.inputType===u.TEXT?o.data.content=t.content:t.inputType===u.VOICE&&o.data.voice.push(t.contentVoice);break;case"\u4F18\u70B9":e[0].active=!0,t.inputType===u.TEXT?e[0].data.content=t.content:t.inputType===u.VOICE&&e[0].data.voice.push(t.contentVoice);break;case"\u4E0D\u8DB3":e[1].active=!0,t.inputType===u.TEXT?e[1].data.content=t.content:t.inputType===u.VOICE&&e[1].data.voice.push(t.contentVoice);break;case"\u5FC3\u5F97":e[2].active=!0,t.inputType===u.TEXT?e[2].data.content=t.content:t.inputType===u.VOICE&&e[2].data.voice.push(t.contentVoice);break;case"\u89C4\u5212":e[3].active=!0,t.inputType===u.TEXT?e[3].data.content=t.content:t.inputType===u.VOICE&&e[4].data.voice.push(t.contentVoice);break;case"\u56E2\u961F\u89C4\u5212":e[4].active=!0,t.inputType===u.TEXT?e[4].data.content=t.content:t.inputType===u.VOICE&&e[4].data.voice.push(t.contentVoice);break}}),q(o,e)):c.value&&(x.fail("\u8BE5\u65E5\u5FD7\u88AB\u5220\u9664"),C.back())})};le(()=>{ce().then(i=>{e.forEach(t=>{const U=i.data.data.find(S=>S.itemName===t.tagName);U&&(t.tagCode=U.itemCode)});const a=i.data.data.find(t=>t.itemName==="\u5DE5\u4F5C\u65E5\u5FD7");a&&(y=a.itemCode),q(o,e)}),d.query.isView&&(c.value=!0),d.query.id&&(r.value=!0,h.value=!1,v({dailyId:d.query.id,userCode:d.query.userId}))});const V=i=>{r.value||(i.active=!i.active)},Y=()=>{if(r.value){r.value=!1;return}const i={dailyId:n,workDay:g(o.workDay).format("YYYY-MM-DD HH:mm:ss"),detailList:[]};o.data.content&&i.detailList.push({content:o.data.content,inputType:u.TEXT,tagCode:y,tagName:"\u5DE5\u4F5C\u65E5\u5FD7"}),o.data.voice.forEach(a=>{i.detailList.push({contentVoice:{voiceUrl:a.voiceUrl,voiceDuration:a.voiceDuration},inputType:u.VOICE,tagCode:y,tagName:"\u5DE5\u4F5C\u65E5\u5FD7"})}),e.forEach(a=>{a.active&&(a.data.content&&i.detailList.push({content:a.data.content,inputType:u.TEXT,tagCode:a.tagCode,tagName:a.tagName}),a.data.voice&&a.data.voice.length>0&&a.data.voice.forEach(t=>{i.detailList.push({contentVoice:{voiceUrl:t.voiceUrl,voiceDuration:t.voiceDuration},inputType:u.VOICE,tagCode:a.tagCode,tagName:a.tagName})}))}),i.detailList.some(a=>a.content||a.contentVoice)?re(i).then(a=>{a.data.status===200&&(x.success("\u4FDD\u5B58\u6210\u529F"),q(),C.back())}):x.fail("\u8BF7\u81F3\u5C11\u586B\u5199\u4E00\u9879\u5DE5\u4F5C\u65E5\u5FD7\u5185\u5BB9")},$=()=>{G.confirm({title:"\u786E\u8BA4\u5220\u9664\u8BE5\u65E5\u5FD7?"}).then(()=>{ve(n).then(i=>{i.data.status===200&&(x.success("\u5220\u9664\u6210\u529F"),C.back())})}).catch(i=>{console.log(i)})};R(()=>o.workDay,(i,a)=>{g(i).isSame(g(a),"day")||v({workDay:g(i).format("YYYY-MM-DD HH:mm:ss"),userCode:d.query.userId})});const I=()=>{d.query.isPersonal?C.push(`/activityVolumeAnalysis?date=${o.workDay}`):C.push(`/activityVolumeAnalysis?date=${o.workDay}&isTeamChecked=Y&userId=${d.query.userId}&userName=${d.query.userName}`)};return(i,a)=>{const t=T("van-form"),U=T("ZaPageWrap"),S=T("van-button"),ee=ue("resize");return D(),b(A,null,[_(U,{"hide-header-placeholder":!0,"hide-footer-placeholder":!0,"main-class":"page-add-daily"},{default:B(()=>[ke,_(t,{"input-align":"right"},{default:B(()=>[_(ge,{modelValue:l(o).workDay,"onUpdate:modelValue":a[0]||(a[0]=s=>l(o).workDay=s),label:"\u5DE5\u4F5C\u65F6\u95F4",disabled:c.value?!1:r.value,"is-view":c.value},null,8,["modelValue","disabled","is-view"]),_(w,{modelValue:l(o).data,"onUpdate:modelValue":a[1]||(a[1]=s=>l(o).data=s),name:"content",label:"\u5DE5\u4F5C\u65E5\u5FD7",placeholder:"\u8BF7\u8F93\u5165\u8BE6\u7EC6\u5DE5\u4F5C\u65E5\u5FD7",max:200,disabled:r.value},null,8,["modelValue","disabled"]),Te,p("div",Ye,[p("div",Ie,[(D(!0),b(A,null,W(l(e),s=>(D(),b("div",{key:s.tagName,class:j(["detail-title-item",{active:s.active}]),onClick:qe=>V(s)},[p("img",{src:s.active?s.activeImage:s.image,class:"image"},null,8,Be),p("div",xe,N(s.tagName),1)],10,we))),128))]),l(e)[0].active?(D(),k(w,{key:0,modelValue:l(e)[0].data,"onUpdate:modelValue":a[2]||(a[2]=s=>l(e)[0].data=s),label:"\u4F18\u70B9",disabled:r.value},null,8,["modelValue","disabled"])):F("",!0),l(e)[1].active?(D(),k(w,{key:1,modelValue:l(e)[1].data,"onUpdate:modelValue":a[3]||(a[3]=s=>l(e)[1].data=s),label:"\u4E0D\u8DB3",disabled:r.value},null,8,["modelValue","disabled"])):F("",!0),l(e)[2].active?(D(),k(w,{key:2,modelValue:l(e)[2].data,"onUpdate:modelValue":a[4]||(a[4]=s=>l(e)[2].data=s),label:"\u5FC3\u5F97",disabled:r.value},null,8,["modelValue","disabled"])):F("",!0),l(e)[3].active?(D(),k(w,{key:3,modelValue:l(e)[3].data,"onUpdate:modelValue":a[5]||(a[5]=s=>l(e)[3].data=s),label:"\u89C4\u5212",disabled:r.value},null,8,["modelValue","disabled"])):F("",!0),l(e)[4].active?(D(),k(w,{key:4,modelValue:l(e)[4].data,"onUpdate:modelValue":a[6]||(a[6]=s=>l(e)[4].data=s),label:"\u56E2\u961F\u89C4\u5212",disabled:r.value},null,8,["modelValue","disabled"])):F("",!0)])]),_:1})]),_:1}),p("div",Ne,[z((D(),b("div",Me,[!c.value&&!h.value?(D(),b("div",{key:0,class:"delete-btn",onClick:$},[_(J,{name:"delete",class:"delete-icon"}),$e])):F("",!0),_(S,{round:"",class:"btn ghost",onClick:I},{default:B(()=>[Ue]),_:1}),c.value?F("",!0):(D(),k(S,{key:1,round:"",class:"btn",onClick:Y},{default:B(()=>[M(N(r.value?"\u7F16\u8F91\u65E5\u5FD7":"\u4FDD\u5B58\u65E5\u5FD7"),1)]),_:1}))])),[[ee]])])],64)}}});var je=X(Se,[["__scopeId","data-v-80779372"]]);export{je as default};
