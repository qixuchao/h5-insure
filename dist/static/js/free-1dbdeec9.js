import{_ as e,d as t,aY as r,r as a,z as n,a7 as i,b as o,c as l,g as s,i as d,f as c,t as u,e as p,l as f,a8 as m,aZ as v,u as w,a as y,x as h,y as I,a_ as b,a2 as O,a$ as D,w as C,j as V,h as T,F as j,b0 as x,T as F,b1 as g,$ as _}from"./index-a63027e0.js";import{p as P,g as L}from"./product-f44dca50.js";import{i as A,t as N}from"./trial-0d4b182a.js";import{a as E,s as k,c as H}from"./phoneVerify-d15de357.js";import{u as Y,B as S,P as M}from"./index-15275d78.js";import{n as R}from"./nextStep-e56ef807.js";import{j as B}from"./trial-779407aa.js";import{v as $,f as U}from"./utils-5130123d.js";import{u as z}from"./theme-65292714.js";import J from"./index-24e3572e.js";import q from"./index-97ee4d40.js";import"./pdfdist-66c75904.js";import"./logo-e4245f5a.js";import"./core-6db39013.js";import"./index-c1807f2c.js";import"./useStorage-50c264a5.js";import"./infoCollection-3b556a44.js";import"./relativeTime-12fe38c5.js";import"./validator-5a13dc82.js";import"./useDicData-bc6177c4.js";const G={class:"free-card"},W={class:"container"},X={class:"title"};var Z=e(t({props:{colors:{type:Array,default:()=>["#CDDFFE","#F1F7FE"]},detail:{type:Object,default:()=>{}},isFirst:{type:Boolean,default:!0},insureDetail:{type:Object,default:()=>{}},previewMode:{type:Boolean,default:!1}},setup(e,{expose:t}){const v=e;r((e=>({"4c27741b":v.colors[0],"4c27743a":v.colors[1]})));const w=a(),y=n({factorObj:{1:[{attributeValues:null,code:"mobile",datasource:null,defaultValue:null,displayType:null,factorId:null,factorScript:null,hasDefaultValue:1,id:8249,isDisplay:1,isHidden:1,isMustInput:1,isReadOnly:null,moduleType:1,placeholder:null,planCode:null,position:null,productCode:"lin23323",productId:null,title:"手机号"},{attributeValues:null,code:"verificationCode",datasource:null,defaultValue:null,displayType:null,factorId:null,factorScript:null,hasDefaultValue:1,id:8249,isDisplay:1,isHidden:1,isMustInput:1,isReadOnly:null,moduleType:1,placeholder:null,planCode:null,position:null,productCode:"lin23323",productId:null,title:"验证码"}],2:[],3:[]},isFirst:!0}),h=async({mobile:e,type:t},r)=>{var a;if(w.value){if(v.previewMode)return void(null==r||r());null==(a=w.value)||a.validateForm(`${t}_mobile`).then((async()=>{const t=v.isFirst?E:k,a=await t(e),{code:n,data:i}=a;"10000"===n&&(null==r||r())}))}};return i((()=>v.isFirst),(()=>{var e;v.isFirst||(y.factorObj=null==(e=v.insureDetail)?void 0:e.productFactor)})),t({validateForm:()=>new Promise(((e,t)=>{w.value.validateForm().then((t=>{e(!0)})).catch((()=>{t()}))}))}),(t,r)=>{const a=o("ProSvg");return l(),s("div",G,[d("div",W,[d("div",X,[c(a,{name:"free-arrow"}),d("span",null,u(e.isFirst?"凭手机号 免费领取":"最后一步 填写信息"),1),c(a,{name:"free-arrow"})]),(l(),p(q,{ref_key:"formRef",ref:w,key:e.isFirst?1:2,"send-sms-code":h,"need-desensitize":"","form-info":e.detail,"factor-object":f(y).factorObj},null,8,["form-info","factor-object"])),m(t.$slots,"default",{},void 0,!0)])])}}}),[["__scopeId","data-v-1ca348ab"]]);const K={class:"page-free-product-detail"},Q={class:"product-desc"},ee={key:1,class:"page-free-footer"};var te=e(t({setup(e){r((e=>({"42df68bd":f(pe).colors[1]})));const t=v((()=>x((()=>import("./index-bd75ba49.js")),["static/js/index-bd75ba49.js","static/css/index-607986ff.css","static/js/index-a63027e0.js","static/css/index-76f73643.css","static/js/pdfdist-66c75904.js"]))),u=v((()=>x((()=>import("./index-17c0d942.js")),["static/js/index-17c0d942.js","static/css/index-b9ba3011.css","static/js/index-a63027e0.js","static/css/index-76f73643.css","static/js/pdfdist-66c75904.js"]))),m=v((()=>x((()=>import("./index-97256b50.js")),["static/js/index-97256b50.js","static/css/index-ea588f10.css","static/js/index-a63027e0.js","static/css/index-76f73643.css","static/js/pdfdist-66c75904.js","static/js/theme-65292714.js","static/js/index-24e3572e.js","static/css/index-2dbcd337.css","static/js/utils-5130123d.js","static/js/infoCollection-3b556a44.js","static/js/useStorage-50c264a5.js","static/js/trial-779407aa.js"]))),E=z(),k=w(),q=y(),{productCode:G="",agencyCode:W="",tenantId:X="",saleUserId:te="",saleChannelId:re="",extraInfo:ae,preview:ne}=q.query;let ie={};try{ie=JSON.parse(decodeURIComponent(ae))}catch(De){}const{openId:oe,indirectCode:le="",agentCode:se}=ie,de=a(),ce=a(),ue=a(),pe=n({colors:["#fff"],detail:{},order:{tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},insuredBeneficiaryType:"1",tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}]}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}},relationList:{},banner:"",productDesc:[],newAuth:!0,isValidateCode:!1,insureDetail:{},loading:!0,isSelfInsure:!0,showBtn:!1,activeIndex:0,showFilePreview:!1,isOnlyView:!0}),fe=a();oe&&Y({openId:oe},(e=>{pe.relationList=e}));const me=h((()=>!!ne)),ve=()=>{var e,t,r;const a=pe.insureDetail.productRiskVoList||[];return 1===((null==(r=null==(t=null==(e=null==a?void 0:a[0])?void 0:e.riskDetailVOList)?void 0:t[0])?void 0:r.insuranceStartType)||1)?`${_(new Date).format("YYYY-MM-DD")} 00:00:00`:`${_(new Date).add(1,"day").format("YYYY-MM-DD")} 00:00:00`},we=()=>{var e,t;const r=pe.insureDetail.productRiskVoList||[],{insuranceEndType:a,riskInsureLimitVO:n}=(null==(t=null==(e=null==r?void 0:r[0])?void 0:e.riskDetailVOList)?void 0:t[0])||{},{insurancePeriodValueList:i}=n||{},[o,l]=((null==i?void 0:i[0])||"").split("_");return 1===a?`${_(new Date).add(l||0,o).format("YYYY-MM-DD")} 23:59:59`:a?`${_(new Date).add(l,o).format("YYYY-MM-DD")} 00:00:00`:""},ye=async()=>{pe.loading=!0;const e=P({productCode:G,withInsureInfo:!0,tenantId:X}),t=A({productCode:G}),r=L({openId:oe});await Promise.all([e,t,r]).then((([e,t,r])=>{var a,n,i,o,l;if("10000"===e.code){pe.detail=e.data,pe.banner=null==(a=pe.detail.tenantProductInsureVO)?void 0:a.banner[0];const{colorEnd:t,colorStart:r}=(null==(n=pe.detail.tenantProductInsureVO)?void 0:n.backgroundInsureVO)||{};pe.colors=[r,t],pe.productDesc=pe.detail.tenantProductInsureVO.spec||[],document.title=(null==(o=null==(i=pe.detail)?void 0:i.tenantProductInsureVO)?void 0:o.productName)||""}if("10000"===t.code&&(pe.insureDetail=t.data,pe.insureDetail.productFactor[1].forEach((e=>{"verificationCode"===e.code&&1===e.isDisplay&&(pe.isValidateCode=!0)})),pe.insureDetail.productFactor[2]=null==(l=pe.insureDetail.productFactor)?void 0:l[2].map((e=>{var t,r;return"relationToHolder"===e.code&&1===e.isDisplay&&(e.title="被保人",pe.order.tenantOrderInsuredList[0].relationToHolder=(null==(r=null==(t=e.attributeValueList)?void 0:t[0])?void 0:r.code)||""),e}))),"10000"===r.code&&(pe.newAuth=!r.data,pe.isSelfInsure=!!r.data,r.data)){const e=r.data;pe.order.tenantOrderHolder={certNo:null==e?void 0:e.certiNo,extInfo:{},mobile:null==e?void 0:e.mobile,name:null==e?void 0:e.name}}(()=>{var e;let t={};if(t=(null==(e=pe.detail.tenantProductInsureVO.planInsureVO)?void 0:e.attachmentVOList)||[],!t)return void(fe.value=[]);const r={2:"richText",3:"link"};fe.value=Object.keys(t).map((e=>(t[e].forEach((e=>{if("1"===e.attachmentType){const t=e.attachmentUri.split("?"),r=t[0].substr(t[0].lastIndexOf(".")+1);e.attachmentType="pdf"===r?"pdf":"picture"}else e.attachmentType=r[e.attachmentType]})),{attachmentName:e,attachmentList:t[e]})))||[]})(),pe.loading=!1}))},he=async()=>{let e={loginType:"2",openId:oe,thirdUserType:"XINAO_WECHAT",indirectCode:le};try{if(pe.newAuth?(e.loginName=pe.order.tenantOrderHolder.mobile,e.password=pe.order.tenantOrderHolder.verificationCode):e=U({order:pe.order,tenantId:X,extraInfo:ie,commencementTime:ve(),expiryDate:we(),detail:pe.detail,insureDetail:pe.insureDetail,iseeBizNo:de.value,agentCode:se,agencyCode:W,saleUserId:te,templateId:null==ie?void 0:ie.templateId,saleChannelId:re,pageCode:"infoCollection",buttonCode:"EVENT_FREE_multiIssuePolicy"}),pe.newAuth)if(me.value)pe.newAuth=!1;else{const{code:t,data:r}=await N(e);"10000"===t&&(pe.newAuth=!1)}else R(e,((e,t)=>{t===g.JUMP_PAGE&&e.orderNo&&k.push(`/baseInsurance/orderDetail?from=free&tenantId=${X}&orderNo=${e.orderNo}`)}))}catch(t){}},Ie=async()=>await(async()=>{var e;if(me.value)return!0;await ue.value.validateForm();const t=null==(e=pe.order.tenantOrderHolder)?void 0:e.verificationCode;if((pe.isValidateCode||pe.newAuth)&&(!t||!$(t)))return F({message:"请输入正确的验证码"}),!1;if(pe.newAuth||!pe.isValidateCode)return!0;const{code:r,data:a}=await H(pe.order.tenantOrderHolder.mobile,t);return!!a})()?(pe.newAuth||0===fe.value.length?he():(pe.isOnlyView=!1,pe.showFilePreview=!0),!1):null,be=()=>{pe.showFilePreview=!1,pe.isOnlyView=!0},Oe=()=>{pe.showFilePreview=!1,pe.isOnlyView=!0,he()};return I((()=>{ye(),setTimeout((async()=>{de.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),i((()=>pe.order.tenantOrderInsuredList[0]),(e=>{if(b(pe.relationList)||pe.newAuth)return null;const t=pe.relationList[e.relationToHolder]||[];if(1===t.length)if(B.SELF!==e.relationToHolder){const{certNo:e,name:r,mobile:a,certType:n}=pe.order.tenantOrderInsuredList[0];pe.order.tenantOrderInsuredList[0].certNo=e||t[0].cert[0].certNo,pe.order.tenantOrderInsuredList[0].name=r||t[0].cert[0].certName,pe.order.tenantOrderInsuredList[0].mobile=a||t[0].contact[0].contactNo,pe.order.tenantOrderInsuredList[0].certType=n||t[0].cert[0].certType||O.CERT}else if(pe.isSelfInsure){pe.isSelfInsure=!1;const{certNo:e,name:r,mobile:a,certType:n}=pe.order.tenantOrderHolder;pe.order.tenantOrderHolder.certNo=e||t[0].cert[0].certNo,pe.order.tenantOrderHolder.name=r||t[0].cert[0].certName,pe.order.tenantOrderHolder.mobile=a||t[0].contact[0].contactNo,pe.order.tenantOrderHolder[0].certType=n||t[0].cert[0].certType||O.CERT}return!1}),{immediate:!0,deep:!0}),D(ce,(([{isIntersecting:e}],t)=>{pe.showBtn=!e})),(e,r)=>{const a=o("van-image"),n=o("van-config-provider");return l(),p(n,{"theme-vars":f(E)},{default:C((()=>{var e,n,i,o;return[d("div",K,[c(S,{url:f(pe).banner},null,8,["url"]),c(Z,{ref_key:"formRef",ref:ue,"is-first":f(pe).newAuth,"insure-detail":f(pe).insureDetail,detail:f(pe).order,colors:f(pe).colors,"preview-mode":f(me)},{default:C((()=>[c(J,{ref_key:"root",ref:ce,class:"submit-btn",disabled:!f(pe).newAuth&&f(me),"is-gradient":!1,text:f(pe).newAuth?"立即领取":"激活保障",onClick:Ie},null,8,["disabled","text"]),!f(pe).newAuth&&fe.value&&fe.value.length>0?(l(),p(f(u),{key:0,"attachement-list":fe.value,"has-bg-color":!1,"pre-text":"请阅读",onPreviewFile:r[0]||(r[0]=e=>(e=>{pe.isOnlyView=!0,pe.activeIndex=e,pe.showFilePreview=!0})(e))},null,8,["attachement-list"])):V("",!0)])),_:1},8,["is-first","insure-detail","detail","colors","preview-mode"]),d("div",Q,[(l(!0),s(j,null,T(f(pe).productDesc,((e,t)=>(l(),p(a,{key:t,width:"100%","lazy-load":"",src:e,class:""},null,8,["src"])))),128))]),(null==(n=null==(e=f(pe).detail)?void 0:e.tenantProductInsureVO)?void 0:n.inscribedContent)?(l(),p(f(t),{key:0,"inscribed-content":null==(o=null==(i=f(pe).detail)?void 0:i.tenantProductInsureVO)?void 0:o.inscribedContent},null,8,["inscribed-content"])):V("",!0),f(pe).showBtn?(l(),s("footer",ee,[c(J,{disabled:!f(pe).newAuth&&f(me),"is-gradient":!1,text:f(pe).newAuth?"立即领取":"激活保障",onClick:Ie},null,8,["disabled","text"])])):V("",!0)]),f(pe).showFilePreview&&0!==fe.value.length?(l(),p(f(m),{key:0,show:f(pe).showFilePreview,"onUpdate:show":r[1]||(r[1]=e=>f(pe).showFilePreview=e),"content-list":fe.value,"is-only-view":f(pe).isOnlyView,"active-index":f(pe).activeIndex,text:f(pe).isOnlyView?"关闭":"我已逐页阅读上述内容并同意","force-read-cound":0,"on-close-file-preview":"",onSubmit:Oe,onOnCloseFilePreview:be},null,8,["show","content-list","is-only-view","active-index","text"])):V("",!0),f(pe).loading?V("",!0):(l(),p(M,{key:1,"product-detail":f(pe).detail},null,8,["product-detail"]))]})),_:1},8,["theme-vars"])}}}),[["__scopeId","data-v-9e9ab874"]]);export{te as default};
