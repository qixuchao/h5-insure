var Ge=Object.defineProperty,We=Object.defineProperties;var je=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var ze=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable;var ue=(_,f,h)=>f in _?Ge(_,f,{enumerable:!0,configurable:!0,writable:!0,value:h}):_[f]=h,m=(_,f)=>{for(var h in f||(f={}))ze.call(f,h)&&ue(_,h,f[h]);if(se)for(var h of se(f))Je.call(f,h)&&ue(_,h,f[h]);return _},p=(_,f)=>We(_,je(f));import{g as Qe,a9 as Xe,O as Ze,E as F,M as le,y as ie,_ as et,l as tt,h as at,r as ce,af as ot,j as $,n as de,p as N,m as z,H as rt,t as J,z as x,A as C,J as me,C as Ne,k as pe,F as nt,D as st,T as fe,X as ut}from"./vendor-17026bfd.js";import{_ as lt,C as he,G as it,$ as ct,a1 as ve}from"./index-bf552ee9.js";import{a as b}from"./order-c0ced472.js";import{S as B,R as ye,f as dt}from"./infoCollection-192ba138.js";import{p as De,i as mt,s as pt,g as ft,a as ht,u as vt,b as yt}from"./trial-171a9822.js";import{p as Dt}from"./product-60afd889.js";import{g as ge,t as gt,a as Ft}from"./utils-e184c7a2.js";import{t as Ct}from"./theme-ea709837.js";import{d as Fe,B as Et,D as It,G as _t,S as Nt,H as wt,P as Tt,U as bt,_ as At,W as Bt,c as Y,f as Ce,o as Ee,a as q,n as Ie,h as _e}from"./auth-da0998e0.js";import{_ as Ot}from"./index-560e0eb2.js";import"./utils-b6782348.js";import"./trial-b84ce850.js";import"./index-3f00620a.js";import"./bankCard-0e4ce564.js";import"./phoneVerify-4aefc1b3.js";const Pt={key:0},St={class:"page-internet-product-detail"},Ut={class:"info"},kt={class:"footer-button"},xt={class:"price"},Ht=Ne(" \u603B\u4FDD\u8D39"),Mt=Qe({setup(_){const f=Xe(),h=Ze(),{productCode:H="BWYL2021",tenantId:E,orderNo:O,phoneNo:M,agentCode:L="",saleChannelId:we,paymentMethod:D,certNo:Q,name:X,pageCode:P,upgradeCode:Te,from:Z}=h.query;console.log(h.query,"route.query");const K=F(),v=F(),S=F(),A=F(),U=P==="payBack",ee=F(!1),V=F(!1),k=F(!1),te=F(0),G=F(!1),W=F(!1),R=F({show:!1,html:""});let j="";const s=le({holder:{certNo:Q,certType:he.CERT,mobile:M,name:X,socialFlag:B.HAS},insured:{certNo:Q,certType:he.CERT,name:X,socialFlag:B.HAS,relationToHolder:ye.SELF},paymentMethod:D,renewalDK:"Y",paymentFrequency:dt.MONTH}),w=F(Fe),I=F(Fe),u=le({showInsure:!U,canInsure:!1,canUpgrade:!1}),be=ie(()=>{var a,t;return((t=(a=v.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(e=>e.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),Ae=ie(()=>{var a,t;return((t=(a=v.value)==null?void 0:a.tenantProductInsureVO)==null?void 0:t.attachmentVOList.filter(e=>e.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),Be=()=>{const{holder:{certNo:a,mobile:t,name:e,socialFlag:n},insured:{certNo:o,name:r,socialFlag:i,relationToHolder:c},paymentMethod:y}=s;return it(o)&&!!i},ae=()=>{f.push({path:"/internet/guaranteeUpgrade",query:p(m({},h.query),{tenantId:E,productCode:"BWYL2022",orderNo:O,agentCode:L})})},Oe=()=>{W.value=!1},Pe=()=>{I.value=w.value},Se=()=>{I.value=p(m({},I.value),{relationToHolderDisable:!1,insuredNameDisable:!1,insuredCertDisable:!1,insuredSocialDisable:!1})},Ue=async a=>{fe.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const t=await vt(a),{code:e}=t;if(e==="10000"){fe.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const n=await yt({orderNo:a.orderNo,tenantId:E}),{data:o}=n;n.code==="10000"&&(o.type===2?(R.value={show:!0,html:o.paymentUrl},console.log("data.paymentUrl",R.value),ut(()=>{console.log("document.forms",document.forms);const r=document.getElementById("cashierSubmit");r==null||r.addEventListener("submit",i=>{i.preventDefault()}),r==null||r.submit()})):window.location.href=o.paymentUrl)}u.canInsure=!0}catch{u.canInsure=!0}},ke=a=>{var o,r;const t=JSON.parse((r=(o=S.value)==null?void 0:o.productBasicInfoVO)==null?void 0:r.extInfo);let e="";return t.endorsementFlag===1&&(e=`&upgradeCode=${t.endorsementCode}`),`${ve}/internet/productDetail?tenantId=${E}&productCode=${H}&orderNo=${a}&agentCode=${L}&pageCode=payBack${e}&from=${Z||"normal"}`},xe=a=>`${ve}/internet/payFail?tenantId=${E}&orderNo=${a}&agentCode=${L}&pageCode=payBack&from=${Z||"normal"}`,He=async a=>{const t=Ft({tenantId:E,saleUserId:L,saleChannelId:we,detail:v.value,insureDetail:S.value,paymentMethod:s.paymentMethod,renewalDK:s.renewalDK,iseeBizNo:j,successJumpUrl:"",premium:A.value,holder:s.holder,insured:s.insured,tenantOrderRiskList:a,orderStatus:"",orderTopStatus:""});try{const e=await pt(t),{code:n,data:o}=e;n==="10000"&&Ue(p(m({},t),{orderNo:o.data,extInfo:{extraInfo:{renewalDK:s.renewalDK,paymentMethod:s.paymentMethod,successJumpUrl:ke(o.data),failUrl:xe(o.data)},iseeBizNo:j}}))}catch{u.canInsure=!0}},Me=async()=>{const{calcData:a,riskVOList:t}=ge({holder:s.holder,insured:s.insured,tenantId:E,paymentFrequency:s.paymentFrequency,productDetail:v.value,insureDetail:S.value},!0),e=await De(a),{code:n,data:o}=e;return n==="10000"?(A.value=o.premium,{condition:t,data:o}):{}},Le=a=>{te.value=a,k.value=!0},Ve=()=>new Promise((a,t)=>{var e,n;(n=(e=K.value)==null?void 0:e.validateForm)==null||n.call(e).then(async()=>{var d;if(!(((d=K.value)==null?void 0:d.isAgreeFile)||ee.value)){Le(0);return}const{calcData:r,riskVOList:i}=ge({holder:s.holder,insured:s.insured,tenantId:E,paymentFrequency:s.paymentFrequency,productDetail:v.value,insureDetail:S.value},!0),c=await De(r),{code:y,data:g}=c;y==="10000"?(A.value=g.premium,a({condition:i,data:g})):t(new Error)}).catch(()=>{u.canInsure=!0})}),oe=async()=>{var a;if(U){ae();return}u.canInsure=!1;try{const{condition:t,data:e}=await Ve(),n={},o=(i=[])=>{(i||[]).forEach(c=>{var y;n[c.riskCode]=c,((y=c.riskPremiumDetailVOList)==null?void 0:y.length)&&o(c.riskPremiumDetailVOList)})};o(e.riskPremiumDetailVOList);const r=gt({tenantId:E,riskList:t,riskPremium:n,productId:(a=v.value)==null?void 0:a.id});He(r)}catch{u.canInsure=!0}},Re=a=>{a==="allFalse"?(V.value=!1,oe(),u.canInsure=!0):st.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"})},$e=()=>{ee.value=!0,k.value=!1,V.value=!0};et([()=>s.insured.certNo,()=>s.insured.socialFlag],tt.exports.debounce(()=>{s.insured.certNo&&s.insured.socialFlag&&P!=="payBack"&&Be()&&Me()},500),{deep:!0,immediate:!0});const re=async()=>{var n,o,r,i,c,y,g,d;const a=await ft({orderNo:O,tenantId:E}),{code:t,data:e}=a;if(t==="10000"){const{tenantOrderHolder:l,tenantOrderInsuredList:T,extInfo:ne}=e;if(!U){Object.assign(s,{holder:{certNo:l.certNo,certType:l.certType,mobile:l.mobile,name:l.name,socialFlag:B.HAS},insured:{certNo:l.certNo,certType:l.certType,name:l.name,socialFlag:B.HAS,relationToHolder:ye.SELF},paymentMethod:D,renewalDK:"Y"}),u.canInsure=!0,I.value=Ie,w.value=Ie;return}Object.assign(s,{holder:{certNo:l.certNo,certType:l.certType,mobile:l.mobile,name:l.name,socialFlag:B.HAS},insured:{certNo:T==null?void 0:T[0].certNo,certType:(n=T[0])==null?void 0:n.certType,name:(o=T[0])==null?void 0:o.name,socialFlag:(i=(r=T[0])==null?void 0:r.extInfo)==null?void 0:i.hasSocialInsurance,relationToHolder:(c=T[0])==null?void 0:c.relationToHolder},paymentMethod:ne.extraInfo.paymentMethod,renewalDK:ne.extraInfo.renewalDK||"N"}),A.value=(d=(g=(y=T[0])==null?void 0:y.tenantOrderProductList)==null?void 0:g[0])==null?void 0:d.premium,(e.orderStatus===b.ACCEPT_POLICY||e.orderStatus===b.PAYMENT_SUCCESS)&&(u.canUpgrade=!0,G.value=!1,W.value=!0),e.orderStatus===b.PAYING&&(G.value=!0,setTimeout(()=>{re()},3*1e3))}},Ye=async()=>{var n,o,r,i,c,y;console.log("\u77ED\u4FE1\u8FDB\u5165\uFF0C\u5E26\u4E86orderNo, mobile");const a=await ht({holderPhone:M,orderStatus:[b.PAYING.toUpperCase(),b.TIMEOUT.toUpperCase(),"ACCEPT_POLICY"],productCode:H,tenantId:E}),{code:t,data:e}=a;if(e.orderStatus===b.ACCEPT_POLICY&&(console.log("\u5DF2\u627F\u4FDD\uFF0C\u88AB\u4FDD\u4EBA\u4FE1\u606F\u4E0D\u80FD\u4FEE\u6539"),I.value=p(m({},_e),{paymentDisable:!!D}),w.value=p(m({},_e),{paymentDisable:!!D})),(e.orderStatus===b.PAYING||e.orderStatus===b.TIMEOUT)&&(console.log("\u652F\u4ED8\u4E2D\uFF0C\u8D85\u65F6\u53EF\u4EE5\u4FEE\u6539\u6295\u4FDD\u4EBA\u4FE1\u606F"),I.value=p(m({},q),{paymentDisable:!!D}),w.value=p(m({},q),{paymentDisable:!!D})),t==="10000"&&((n=e==null?void 0:e.tenantOrderHolder)==null?void 0:n.certNo)){u.canInsure=!0;const{tenantOrderHolder:g,tenantOrderInsuredList:d,extInfo:l}=e;Object.assign(s,{holder:{certNo:g.certNo,certType:g.certType,mobile:g.mobile,name:g.name,socialFlag:B.HAS},insured:{certNo:d==null?void 0:d[0].certNo,certType:(o=d[0])==null?void 0:o.certType,name:(r=d[0])==null?void 0:r.name,socialFlag:(c=(i=d[0])==null?void 0:i.extInfo)==null?void 0:c.hasSocialInsurance,relationToHolder:(y=d[0])==null?void 0:y.relationToHolder},paymentMethod:D||l.extraInfo.paymentMethod,renewalDK:l.extraInfo.renewalDK})}else I.value=p(m({},Y),{paymentDisable:!!D}),w.value=p(m({},Y),{paymentDisable:!!D}),u.canInsure=!0},qe=async()=>{const a=Dt({productCode:H,withInsureInfo:!0,tenantId:E}),t=mt({productCode:H});await Promise.all([a,t]).then(([e,n])=>{var o;e.code==="10000"&&(v.value=e.data,document.title=((o=e.data)==null?void 0:o.productFullName)||""),n.code==="10000"&&(S.value=n.data)}),O?re():M&&P==="productDetail"&&Ye()},Ke=()=>{P==="free"?U?(I.value=p(m({},Ce),{paymentDisable:!!D}),w.value=p(m({},Ce),{paymentDisable:!!D}),u.canInsure=!0):(I.value=p(m({},Y),{paymentDisable:!!D}),w.value=p(m({},Y),{paymentDisable:!!D}),u.canInsure=!0):U?(I.value=Ee,w.value=Ee,console.log("\u652F\u4ED8\u5B8C\u6210\u8FDB\u5165")):M||O||(console.log("\u6295\u4FDD\u94FE\u63A5"),I.value=p(m({},q),{paymentFrequencyDisable:!0}),w.value=q,u.canInsure=!0)};return at(()=>{Ke(),qe(),setTimeout(async()=>{j=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(a,t)=>{const e=ce("van-button"),n=ce("van-config-provider"),o=ot("dompurify-html");return $(),de(nt,null,[N(n,{"theme-vars":C(Ct)},{default:z(()=>{var r,i,c,y,g,d,l;return[R.value.show?rt(($(),de("div",Pt,null,512)),[[o,R.value.html]]):J("",!0),x("div",St,[x("div",Ut,[N(Et,{url:(i=(r=v.value)==null?void 0:r.tenantProductInsureVO)==null?void 0:i.banner[0]},null,8,["url"]),N(It,{"product-name":(c=v.value)==null?void 0:c.productFullName,"product-desc":(g=(y=v.value)==null?void 0:y.showConfigVO)==null?void 0:g.desc},null,8,["product-name","product-desc"])]),N(_t,{"guarantee-list":(l=(d=v.value)==null?void 0:d.tenantProductInsureVO)==null?void 0:l.titleAndDescVOS},null,8,["guarantee-list"]),N(Nt,{detail:v.value},{form:z(()=>[N(wt,{ref_key:"formRef",ref:K,disable:!C(u).showInsure,"form-auth":I.value,"form-info":C(s),premium:A.value,"product-detail":v.value,payments:[1],"payment-method":[0],onOnReset:Pe,onOnUpdate:Se},null,8,["disable","form-auth","form-info","premium","product-detail"])]),_:1},8,["detail"]),x("div",kt,[x("div",xt,[Ht,x("span",null,"\uFFE5"+me(C(ct)(A.value))+"/\u6708",1)]),N(e,{type:"primary",class:"right",disabled:!(C(u).canInsure||C(u).canUpgrade),onClick:oe},{default:z(()=>[Ne(me(C(u).showInsure?"\u7ACB\u5373\u6295\u4FDD":"\u5347\u7EA7\u4FDD\u969C"),1)]),_:1},8,["disabled"])])]),C(P)!=="payBack"?($(),pe(Tt,{key:1,"product-detail":v.value},null,8,["product-detail"])):J("",!0),N(bt,{"order-no":C(O),"tenant-id":C(E),"upgrade-code":C(Te),"is-show":W.value,onOnConfirm:ae,onOnClose:Oe},null,8,["order-no","tenant-id","upgrade-code","is-show"])]}),_:1},8,["theme-vars"]),N(At,{show:V.value,"onUpdate:show":t[0]||(t[0]=r=>V.value=r),"content-list":C(be),"active-index":0,onOnConfirmHealth:Re},null,8,["show","content-list"]),k.value?($(),pe(Ot,{key:0,show:k.value,"onUpdate:show":t[1]||(t[1]=r=>k.value=r),"content-list":C(Ae),"active-index":te.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9",onSubmit:$e},null,8,["show","content-list","active-index"])):J("",!0),N(Bt,{"is-show":G.value},null,8,["is-show"])],64)}}});var ta=lt(Mt,[["__scopeId","data-v-5da8db94"]]);export{ta as default};
