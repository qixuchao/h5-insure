import{d as e,af as a,ag as t,i as o,h as s,c9 as n,r as i,j as l,aG as r,l as u,o as c,c as d,b as f,u as m,p,q as y,f as I,w as v,F as h,s as b,a as w,g as j,v as g,e as k,dG as C,T as V,ah as x,bH as q,ak as L,bK as P,aS as T,dM as _,aQ as O,c6 as N}from"./index-317fe516.js";import{P as R,a as E}from"./PolicyInfo-f96b35af.js";import{g as S,m as U}from"./trial-aa1d6cf6.js";import{n as D}from"./nextStep-a99ccab9.js";import{b as Q,l as F}from"./product-b2900c6a.js";import{u as M}from"./useOrder-c2fee243.js";import{P as $}from"./index-eca0d721.js";import{P as A}from"./index-473c8b61.js";import{_ as B}from"./InsureInfo-b2f6985c.js";import{p as G,d as z}from"./utils-95154cc8.js";import{Q as J}from"./notice-33e6eedd.js";import{g as W}from"./utils-6bcd1a83.js";import{Q as H}from"./questionnaire-42dcb602.js";import{P as K}from"./constants-b39aa53b.js";import{T as X}from"./infoCollection-73b145a3.js";import"./core-5b4c0234.js";import"./cloneDeep-10680285.js";import"./util-4ac6553b.js";import"./trial-1b3459d5.js";const Y={class:"long-info-preview"},Z={class:"footer-button"},ee=e({__name:"infoPreview",setup(e){const ee=a((()=>t((()=>import("./index-d71a4c72.js")),["static/js/index-d71a4c72.js","static/css/index-fa4edf2a.css","static/js/index-317fe516.js","static/css/index-3dd092cb.css","static/js/theme-94cf7d00.js","static/js/index-473c8b61.js","static/css/index-bbfdd7ec.css","static/js/utils-6bcd1a83.js","static/js/infoCollection-73b145a3.js","static/js/trial-1b3459d5.js"]))),ae=o(),te=s(),oe=M(),{productCode:se="",tenantId:ne,agentCode:ie="",agencyCode:le,saleChannelId:re,isShare:ue,orderNo:ce,extraInfo:de,insurerCode:fe,objectType:me="1",templateId:pe,preview:ye,origin:Ie}=ae.query;let ve={};try{ve=JSON.parse(decodeURIComponent(de))}catch(Ue){}const[he,be]=n(!1),we=i({isView:!1,personalInfo:{},policyInfo:{schema:[],config:[],formData:{}},payInfo:{schema:[],config:[],formData:[]},customerQuestions:[]}),je=`${window.origin}/baseInsurance/long/phoneVerify${window.location.search}`;l({imgUrl:"",desc:"",title:"",link:je});const ge=l(),ke=l(),Ce=l(!1),Ve=l(!1),xe=l(0),qe=l(!1),Le=()=>{Ve.value=!1},Pe=()=>{Ce.value=!0,oe.value.extInfo.buttonCode=C.short.underWrite,oe.value.extInfo.pageCode="infoPreview",D(oe.value,((e,a)=>{}))},Te=()=>{if(pe===X.FREE)oe.value.extInfo.buttonCode=C.free.underWriteAndIssue,oe.value.extInfo.pageCode="productInfo",D(oe.value,((e,a)=>{a===O.JUMP_PAGE&&te.push({path:K[e.nextPageCode],query:ae.query})}));else{if(Ce.value)return void Pe();be(!0)}},_e=async()=>{pe===X.FREE?V("被保人已完成认证"):be(!0)},Oe=l(),Ne=l(),Re=l([]),Ee=async()=>{let e={};const{code:a,data:t}=await S({orderNo:ce,tenantId:ne});"10000"===a&&(Object.assign(oe.value,t),e=G(t.insuredList[0].productList),Oe.value=t,qe.value=!0),(async e=>{let a=[];const{code:t,data:o}=await N({orderNo:ce,tenantId:ne});"10000"===t&&(a=o.productQuestionnaireVOList);const{code:s,data:n}=await F(e);if("10000"===s){const{productQuestionnaireVOList:e}=n||{},t=e.filter((e=>e.businessType!==J.VISIT));we.customerQuestions=t.map((e=>{const{questionnaireDetailResponseVO:t,questionnaireId:o,questionnaireName:s}=e||{},{questions:n,basicInfo:i}=t||{},{objectType:l,questionnaireType:r}=i||{};if(r===H.TEXT){const{content:e,textType:a}=(null==n?void 0:n[0])||{};return{content:e,contentType:W(`${a}`,e),questionnaireId:o,questionnaireName:s}}const u=(a||[]).find((e=>e.questionnaireId===o));return{...t,contentType:"question",...null==u?void 0:u.questionnaireDetailResponseVO,questionnaireId:o,questionnaireName:s}}))}})({productCodeList:e.productList.map((e=>e.productCode))}),Q(e).then((({code:e,data:a})=>{if("10000"===e){const{productMaterialList:e,riskMaterialList:t}=z(a);we.fileList=e.map((e=>({tabName:e.attachmentName,isExpand:!0,files:e.attachmentList.map((e=>({name:e.materialName,file:e.materialContent,type:e.materialSource,mustRead:e.mustReadFlag===x.YES})))}))),Re.value=e.concat(t)}})),U(e).then((({data:e,code:a})=>{if("10000"===a){const{productDetailResList:a,productFactor:t}=e;Ne.value=t;const{payInfo:o,other:s}=q(t);we.payInfo={...we.payInfo,...o},we.policyInfo={...we.policyInfo,...s}}}))};r((()=>{Ee()}));const Se=l();return u((()=>{setTimeout((async()=>{Se.value=window.getIseeBiz&&await window.getIseeBiz()}),1500)})),(e,a)=>{var t,o,s;const n=L,i=P,l=T,r=_;return c(),d("div",Y,[f(n),f(B,{"product-data":null==(o=null==(t=m(oe).insuredList)?void 0:t[0])?void 0:o.productList},null,8,["product-data"]),(null==(s=Object.keys(m(Ne)||{}))?void 0:s.length)?(c(),p($,{key:0,ref_key:"personalInfoRef",ref:ke,modelValue:m(Oe),"onUpdate:modelValue":a[0]||(a[0]=e=>y(Oe)?Oe.value=e:null),"product-factor":m(Ne),"is-view":"","input-align":"left"},null,8,["modelValue","product-factor"])):I("",!0),m(we).payInfo.schema.length?(c(),p(m(R),{key:1,ref_key:"payInfoRef",ref:ge,modelValue:m(oe).tenantOrderPayInfoList,"onUpdate:modelValue":a[1]||(a[1]=e=>m(oe).tenantOrderPayInfoList=e),schema:m(we).payInfo.schema,"is-view":""},null,8,["modelValue","schema"])):I("",!0),m(we).policyInfo.schema.length?(c(),p(m(E),{key:2,modelValue:m(oe).extInfo,"onUpdate:modelValue":a[2]||(a[2]=e=>m(oe).extInfo=e),schema:m(we).policyInfo.schema,"is-view":""},null,8,["modelValue","schema"])):I("",!0),f(l,{title:"产品资料","show-line":!1,"show-icon":!1},{default:v((()=>[(c(!0),d(h,null,b(m(Re),((e,a)=>(c(),p(i,{key:a,"is-link":"",title:e.attachmentName,onClick:e=>(e=>{xe.value=e,Ve.value=!0})(a)},null,8,["title","onClick"])))),128))])),_:1}),w("div",Z,["share"===m(Ie)?(c(),p(A,{key:0,shadow:!1,onClick:_e},{default:v((()=>[j(e.$slots,"default",{},(()=>[g("确认")]))])),_:3})):(c(),p(A,{key:1,shadow:!1,onClick:Te},{default:v((()=>[j(e.$slots,"default",{},(()=>[g(k(m(pe)===m(X).free?"领取保障并激活":"确认支付"),1)]))])),_:3}))]),m(Ve)?(c(),p(m(ee),{key:3,show:m(Ve),"onUpdate:show":a[3]||(a[3]=e=>y(Ve)?Ve.value=e:null),"content-list":[m(Re)[m(xe)]],"is-only-view":"","active-index":0,text:"关闭","force-read-cound":0,onOnCloseFilePreviewByMask:Le},null,8,["show","content-list"])):I("",!0),m(he)?(c(),p(r,{key:4,modelValue:m(he),"onUpdate:modelValue":a[4]||(a[4]=e=>y(he)?he.value=e:null),closeable:!1,"data-source":m(we).fileList,onSubmit:Pe},null,8,["modelValue","data-source"])):I("",!0)])}}});export{ee as default};
