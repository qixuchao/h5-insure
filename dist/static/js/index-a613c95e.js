var Oe=Object.defineProperty,Ie=Object.defineProperties;var xe=Object.getOwnPropertyDescriptors;var de=Object.getOwnPropertySymbols;var Le=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var Be=(E,a,f)=>a in E?Oe(E,a,{enumerable:!0,configurable:!0,writable:!0,value:f}):E[a]=f,h=(E,a)=>{for(var f in a||(a={}))Le.call(a,f)&&Be(E,f,a[f]);if(de)for(var f of de(a))be.call(a,f)&&Be(E,f,a[f]);return E},x=(E,a)=>Ie(E,xe(a));import{g as Pe,O as we,a9 as He,E as g,d as Ue,y as Me,h as $e,r as X,j as d,k as L,m as _,z as l,p as v,J as T,n as D,L as Ce,t as b,A as S,G as $,F as j,a4 as je,a5 as qe,C as w,T as P,D as Ve}from"./vendor-af6fda0a.js";import{q as Ye}from"./index-a99815ab.js";import{_ as Qe,S as Ge,L as Je,M as ze,q as Z,l as q,Q as Ee,r as fe,H as We,n as Ke,P as Xe,R as ee,T as V,B as _e}from"./index-087f6a80.js";import{_ as Ze}from"./index-3fdfdcf7.js";import{f as eu,s as ve,g as De,a as uu}from"./verify-2a87ee8f.js";import{a as pe}from"./order-35b0e3c5.js";import{l as Fe,g as tu}from"./inform-4b8c0ba2.js";const ue=E=>(je("data-v-6dcf6dbe"),E=E(),qe(),E),su={class:"page-verify"},nu={class:"people"},ou={class:"name"},ru={class:"verify-item"},au=ue(()=>l("div",{class:"label"},"\u8BC1\u4EF6\u53F7\u7801",-1)),iu={class:"no"},lu=w(" \u53BB\u8BA4\u8BC1 "),cu={class:"sign-body"},du={class:"date"},Bu={class:"file"},Cu=w(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A "),Eu={class:"people"},fu={class:"name"},_u={class:"verify-item"},vu=ue(()=>l("div",{class:"label"},"\u8BC1\u4EF6\u53F7\u7801",-1)),Du={class:"no"},pu=["onClick"],Fu=w(" \u53BB\u8BA4\u8BC1 "),Au=["onClick"],yu={class:"sign-body"},hu={class:"date"},gu={class:"file"},Tu=w(" \u7B7E\u540D\u5C06\u88AB\u7528\u4E8E\u4EE5\u4E0B\u6587\u4EF6\uFF1A "),mu={class:"footer-button footer"},Nu=ue(()=>l("div",{class:"text"},"\u5237\u65B0",-1)),Ru=w("\u5206\u4EAB"),Su=w("\u63D0\u4EA4"),ku=Pe({setup(E){const a={CERT:1,NO_CERT:2},f=we(),Ae=He(),{saleUserId:Y="D1234567-1",tenantId:p="9991000007",templateId:ye=1,productCode:he="CQ75CQ76",insurerCode:Q="ancheng",isShare:G,orderCode:H,orderNo:m,productCategory:te}=f.query,se=()=>{const t=f.query;return t.orderCode&&(t.orderNo=t.orderCode),t},J=new Ge({source:"localStorage"}),z=g([]),W=g([]),ne=g([]),oe=g([]),c=g(),k=g(),N=[],O=g(""),U=g(),re=Ue().format("YYYY-MM-DD"),ge=()=>{var t;(t=k.value)==null||t.clear()},Te=t=>{N[t].clear()},ae=(t,i)=>{let s=window.location.href;s=s.includes("orderCode")?s:s.replace("orderNo","orderCode"),uu({callbackUrl:s,certiNo:t,faceAuthMode:"TENCENT",userName:i,tenantId:9991000007}).then(u=>{const{code:B,data:n}=u;if(B==="10000"){const{originalUrl:e,serialNo:o}=n;window.location.href=e,J.set("verifyData",{serialNo:o,certNo:t,name:i})}})},ie=t=>{const{id:i,objectType:s}=t;O.value="",U.value="";const u={1:"pdf",2:"richText",3:"link"};tu({insurerCode:Q,id:i,objectType:s,productCategory:te,orderNo:m,tenantId:p}).then(({code:B,data:n})=>{B==="10000"&&(console.log(n),(n==null?void 0:n[0].questionType)===2?(O.value="question",U.value=n):((n==null?void 0:n[0].textType)===1&&(n==null?void 0:n[0].content.includes("png"))?O.value="picture":O.value=u[n==null?void 0:n[0].textType],U.value=n==null?void 0:n[0].content))})},I=t=>`${t}`===ze.CERT,le=t=>{var i,s,u,B;t===-1?ae((i=c.value.tenantOrderHolder)==null?void 0:i.certNo,(s=c.value.tenantOrderHolder)==null?void 0:s.name):ae((u=c.value.tenantOrderInsuredList[t])==null?void 0:u.certNo,(B=c.value.tenantOrderInsuredList[t])==null?void 0:B.name)},me=t=>{t&&N.every(i=>i!==t)&&N.push(t)},Ne=()=>{var i,s,u,B,n;if((i=k.value)==null?void 0:i.isEmpty()){P.fail("\u8BF7\u6295\u4FDD\u4EBA\u7B7E\u540D");return}if(N.some(e=>e.isEmpty())){P.fail("\u8BF7\u88AB\u4FDD\u4EBA\u7B7E\u540D");return}if(((u=(s=c.value.tenantOrderHolder)==null?void 0:s.extInfo)==null?void 0:u.isCert)!==a.CERT&&I((B=c.value.tenantOrderHolder)==null?void 0:B.certType)){P.fail("\u8BF7\u6295\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}if((n=c.value.tenantOrderInsuredList)==null?void 0:n.some(e=>{var o;return((o=e.extInfo)==null?void 0:o.isCert)!==a.CERT&&I(e.certType)})){P.fail("\u8BF7\u88AB\u4FDD\u4EBA\u53BB\u8BA4\u8BC1");return}fe({orderNo:H||m,saleUserId:Y,tenantId:p}).then(e=>{const{code:o,data:r}=e;o==="10000"&&(r.orderStatus===pe.PENDING||r.orderStatus===pe.PAYMENT_FAILED?Ve.confirm({title:"\u63D0\u793A",message:"\u8BF7\u786E\u8BA4\u4FE1\u606F\u586B\u5199\u65E0\u8BEF\u540E\uFF0C\u518D\u8FDB\u884C\u652F\u4ED8"}).then(()=>{var F,y;const C=(F=k.value)==null?void 0:F.save();Promise.all([ve("HOLDER",C,(y=c.value)==null?void 0:y.id,`${p}`),...N.map(A=>{var R;return ve("INSURED",A.save(),(R=c.value)==null?void 0:R.id,`${p}`)})]).then(()=>{Ke(x(h({},c.value),{pageCode:"sign",operateOption:{withSignInfo:!0},extInfo:x(h({},c.value.extInfo),{pageCode:"sign",templateId:ye,shareFlag:G?"Y":"N"}),venderCode:Q})).then(A=>{const{code:R,data:M}=A;o==="10000"&&M.success&&Ae.push({path:Xe[M.pageAction.data.nextPageCode],query:{orderNo:H||m,saleUserId:Y,tenantId:p}})})})}):We("paymentResult",se()))})},K=(t=!1)=>{fe({orderNo:H||m,saleUserId:Y,tenantId:p}).then(i=>{var B,n;const{code:s,data:u}=i;s==="10000"&&(c.value=u,t&&(((n=(B=u==null?void 0:u.tenantOrderHolder)==null?void 0:B.extInfo)==null?void 0:n.isCert)===a.NO_CERT||(u==null?void 0:u.tenantOrderInsuredList.some(e=>{var o;return((o=e.extInfo)==null?void 0:o.isCert)===a.NO_CERT}))?P("\u7528\u6237\u672A\u5B8C\u8EAB\u4EFD\u8BA4\u8BC1\u53CA\u7B7E\u5B57"):(!(u==null?void 0:u.tenantOrderAttachmentList.find(e=>e.category===ee.ELECTRIC_SIGN&&e.objectType===V.HOLDER))||!(u==null?void 0:u.tenantOrderAttachmentList.find(e=>e.category===ee.ELECTRIC_SIGN&&e.objectType===V.INSURED)))&&P("\u7528\u6237\u672A\u5B8C\u8EAB\u4EFD\u8BA4\u8BC1\u53CA\u7B7E\u5B57")),setTimeout(()=>{let e=0;u.tenantOrderAttachmentList.forEach(o=>{o.category===ee.ELECTRIC_SIGN&&(o.objectType===V.HOLDER?(k.value.clear(),k.value.setDataURL(o.fileBase64)):o.objectType===V.INSURED&&(N[e].clear(),N[e].setDataURL(o.fileBase64),e+=1))})}))})},Re=()=>{K(!0)},Se=Me(()=>{const t=x(h({},se()),{isShare:1,sharePageCode:"sign"});return`${window.location.origin}/phoneVerify?${Ye.stringify(t)}`}),ke=()=>{const t={orderNo:H||m,productCode:he,tenantId:p,objectType:1},i={insurerCode:Q,orderNo:m,productCategory:te,tenantId:p,noticeType:4,objectType:1};De(h({},t)).then(({code:s,data:u})=>{s==="10000"&&(W.value=u||[])}),De(x(h({},t),{objectType:2})).then(({code:s,data:u})=>{s==="10000"&&(z.value=u||[])}),Fe(h({},i)).then(({code:s,data:u})=>{s==="10000"&&(oe.value=u||[])}),Fe(x(h({},i),{noticeType:5,objectType:2})).then(({code:s,data:u})=>{s==="10000"&&(ne.value=u||[])})};return $e(()=>{K(),ke();const t=J.get("verifyData");if(t){const{serialNo:i,certNo:s,name:u}=t;eu({certiNo:s,orderNo:H||m,serialNo:i,tenantId:p,userName:u}).then(B=>{const{code:n,data:e}=B;n==="10000"&&(J.remove("verifyData"),K())})}}),(t,i)=>{const s=X("ProPDFviewer"),u=X("van-button"),B=X("ProPageWrap");return d(),L(B,null,{default:_(()=>{var n;return[l("div",su,[v(Je,{type:"warning",title:"\u5C0A\u656C\u7684\u5BA2\u6237\uFF0C\u672C\u6B21\u6295\u4FDD\u9700\u8981\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",content:"\u672C\u4EA7\u54C1\u6295\u4FDD\u9700\u8981\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u8FDB\u884C\u5B9E\u540D\u8BA4\u8BC1\uFF0C\u60A8\u8D2D\u4E70\u672C\u4EA7\u54C1\u7684\u7D2F\u8BA1\u603B\u4FDD\u8D39\u5DF2\u8D85\u8FC720\u4E07\uFF0C\u6309\u76D1\u7BA1\u8981\u6C42\uFF0C\u9700\u8981\u63D0\u4F9B\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\u3001\u6307\u5B9A\u53D7\u76CA\u4EBA\u8BC1\u4EF6\u5F71\u50CF\uFF0C\u672C\u4EA7\u54C1\u975E\u672C\u4EBA\u6295\u4FDD\u4E14\u5E26\u8EAB\u6545\u8D23\u4EFB\u3001\u9700\u5BF9\u6295\u4FDD\u4EBA\u3001\u88AB\u4FDD\u4EBA\uFF08\u6210\u4EBA\uFF09\u7684\u6295\u4FDD\u610F\u613F\u8FDB\u884C\u7B7E\u5B57\u786E\u8BA4\u3002"}),v(q,{title:"\u6295\u4FDD\u4EBA",class:"card"},{extra:_(()=>{var e,o,r,C,F,y,A,R,M,ce;return[l("div",nu,[l("div",ou,T((o=(e=c.value)==null?void 0:e.tenantOrderHolder)==null?void 0:o.name),1),I((C=(r=c.value)==null?void 0:r.tenantOrderHolder)==null?void 0:C.certType)?(d(),D("div",{key:0,class:Ce(["status",{verified:((A=(y=(F=c.value)==null?void 0:F.tenantOrderHolder)==null?void 0:y.extInfo)==null?void 0:A.isCert)===a.CERT}])},T(((ce=(M=(R=c.value)==null?void 0:R.tenantOrderHolder)==null?void 0:M.extInfo)==null?void 0:ce.isCert)===a.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)):b("",!0)])]}),default:_(()=>{var e,o,r,C,F,y,A;return[l("div",ru,[au,l("div",iu,T((o=(e=c.value)==null?void 0:e.tenantOrderHolder)==null?void 0:o.certNo),1),((F=(C=(r=c.value)==null?void 0:r.tenantOrderHolder)==null?void 0:C.extInfo)==null?void 0:F.isCert)!==a.CERT&&I((A=(y=c.value)==null?void 0:y.tenantOrderHolder)==null?void 0:A.certType)?(d(),D("div",{key:0,class:"action",onClick:i[0]||(i[0]=R=>le(-1))},[lu,v(Z,{name:"right_arrow",class:"icon"})])):b("",!0)])]}),_:1}),v(q,{title:"\u6295\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:_(()=>[l("div",{class:"resign",onClick:ge},"\u91CD\u7B7E")]),default:_(()=>[v(Ee,{ref_key:"holderSign",ref:k,class:"sign"},null,512),l("div",cu,[l("div",du,"\u7B7E\u540D\u65E5\u671F\uFF1A "+T(S(re)),1),l("div",Bu,[Cu,(d(!0),D(j,null,$(W.value,(e,o)=>(d(),L(s,{key:o,class:"file",title:`\u300A${e.materialName}\u300B`,content:e.materialContent,type:S(_e)(e.materialContent,e.materialSource+"")},null,8,["title","content","type"]))),128)),(d(!0),D(j,null,$(oe.value,(e,o)=>(d(),L(s,{key:o+W.value.length,class:"file",title:`\u300A${e.title}\u300B`,content:U.value,type:O.value,onClick:r=>ie(e)},null,8,["title","content","type","onClick"]))),128))])])]),_:1}),(d(!0),D(j,null,$((n=c.value)==null?void 0:n.tenantOrderInsuredList,(e,o)=>(d(),D("div",{key:o},[v(q,{title:"\u88AB\u4FDD\u4EBA",class:"card"},{extra:_(()=>{var r,C;return[l("div",Eu,[l("div",fu,T(e.name),1),I(e.certType)?(d(),D("div",{key:0,class:Ce(["status",{verified:((r=e.extInfo)==null?void 0:r.isCert)===a.CERT}])},T(((C=e.extInfo)==null?void 0:C.isCert)===a.CERT?"\u5DF2\u8BA4\u8BC1":"\u5F85\u8BA4\u8BC1"),3)):b("",!0)])]}),default:_(()=>{var r;return[l("div",_u,[vu,l("div",Du,T(e.certNo),1),((r=e.extInfo)==null?void 0:r.isCert)!==a.CERT&&I(e.certType)?(d(),D("div",{key:0,class:"action",onClick:C=>le(o)},[Fu,v(Z,{name:"right_arrow",class:"icon"})],8,pu)):b("",!0)])]}),_:2},1024),v(q,{title:"\u88AB\u4FDD\u4EBA\u7B7E\u540D","show-icon":!1,class:"sign-card","show-line":!1},{extra:_(()=>[l("div",{class:"resign",onClick:r=>Te(o)},"\u91CD\u7B7E",8,Au)]),default:_(()=>[v(Ee,{ref_for:!0,ref:me,class:"sign"}),l("div",yu,[l("div",hu,"\u7B7E\u540D\u65E5\u671F\uFF1A "+T(S(re)),1),l("div",gu,[Tu,(d(!0),D(j,null,$(z.value,(r,C)=>(d(),L(s,{key:C,class:"file",title:`\u300A${r.materialName}\u300B`,content:r.materialContent,type:S(_e)(r.materialContent,r.materialSource+"")},null,8,["title","content","type"]))),128)),(d(!0),D(j,null,$(ne.value,(r,C)=>(d(),L(s,{key:C+z.value.length,class:"file",title:`\u300A${r.title}\u300B`,content:U.value,type:O.value,onClick:F=>ie(r)},null,8,["title","content","type","onClick"]))),128))])])]),_:2},1024)]))),128)),l("div",mu,[S(G)?b("",!0):(d(),D("div",{key:0,class:"refresh-btn",onClick:Re},[l("div",null,[v(Z,{name:"refresh"})]),Nu])),S(G)?b("",!0):(d(),L(Ze,{key:1,title:"\u9080\u8BF7\u60A8\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",desc:"\u9080\u8BF7\u60A8\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1",link:S(Se)},{default:_(()=>[v(u,{plain:"",type:"primary",class:"share-btn"},{default:_(()=>[Ru]),_:1})]),_:1},8,["link"])),v(u,{type:"primary",class:"submit-btn",onClick:Ne},{default:_(()=>[Su]),_:1})])])]}),_:1})}}});var Uu=Qe(ku,[["__scopeId","data-v-6dcf6dbe"]]);export{Uu as default};
