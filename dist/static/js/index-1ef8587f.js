import{h as Je,aa as Ge,P as Xe,r as c,N as Qe,A as R,$ as ue,l as Ze,j as et,k as L,m as U,s as tt,t as D,p as N,B as x,L as at,C as V,n as se,x as ie,F as ot,G as rt,D as le,a5 as nt,a6 as ut,T as y,Y as st}from"./vendor-902054a7.js";import{g as ce,a as de,r as it,v as me,t as pe,b as lt,c as T}from"./utils-f9b0d761.js";import{p as M,i as ct,g as dt,s as mt,u as pt,a as ft}from"./trial-80db563f.js";import{_ as Ft,C as fe,I as vt,n as yt,J as Fe,a4 as ve}from"./index-84e52064.js";import{_ as Et}from"./index-65d2063a.js";import{u as ht}from"./theme-fdbb0f53.js";import{a as q}from"./order-d8528336.js";import{S,R as E,g as Ct,I as gt}from"./infoCollection-06729193.js";import{_ as It,a as Bt}from"./index-b1a9af19.js";import"./useStorage-fc2bd838.js";import"./trial-1f149b67.js";import"./relativeTime-cdc592a9.js";import"./useDicData-a1a7d9a2.js";import"./index-77abe60a.js";const ye=k=>(nt("data-v-7c7e84a8"),k=k(),ut(),k),Dt={class:"product-name"},Nt=ye(()=>x("span",null,"223",-1)),_t=ye(()=>x("span",null,"222",-1)),Ot={class:"footer-button"},At=rt("\u5206\u4EAB\u7528\u6237\u786E\u8BA4\u6295\u4FDD"),Pt=Je({setup(k){const Ee=ht(),he=Ge(),Y=Xe(),{productCode:Ce="HTEJBX",tenantId:m="9991000001",orderNo:H,phoneNo:ge,agentCode:_="",saleChannelId:$,paymentMethod:Ie,certNo:K,name:W,pageCode:Be,from:De}=Y.query,O=c(),A=c(),d=c(),F=c(),j=c({}),h=c({}),z=Be==="payBack",P=c(!1),w=c(!1),C=c(!1),J=c(0),G=c(!1),Ne=c(!1),X=c({show:!1,html:""});let b="";const I=c({agencyId:_,commencementTime:"",expiryDate:"",extInfo:{buttonCode:"EVENT_NETSALE_underWrite",pageCode:"infoCollection",templateId:3,iseeBizNo:""},orderCategory:1,saleUserId:$,tenantId:m,venderCode:"",tenantOrderHolder:{extInfo:{}},tenantOrderInsuredList:[{relationToHolder:"0",extInfo:{occupationCodeList:[]},insuredBeneficiaryType:"1",tenantOrderBeneficiaryList:[{beneficiaryId:0,extInfo:{occupationCodeList:[]}}],tenantOrderProductList:[{}]}],operateOption:{withBeneficiaryInfo:!0,withHolderInfo:!0,withInsuredInfo:!0,withAttachmentInfo:!0,withProductInfo:!0}}),a=Qe({holder:{certNo:K,certType:fe.CERT,mobile:ge,name:W,socialFlag:S.HAS},insured:{certNo:K,certType:fe.CERT,name:W,socialFlag:S.HAS,relationToHolder:E.SELF},paymentMethod:Ie,renewalDK:"Y",paymentFrequency:Ct.YEAR,packageProductList:[],mobileSmsCode:""}),Q=R(()=>{var t,e;return!!((e=(t=d.value)==null?void 0:t.productRelationPlanVOList)!=null&&e.length)}),_e=R(()=>{var e,o,r;let t=[];return Q.value?t=((o=(e=d.value)==null?void 0:e.productRelationPlanVOList.find(n=>n.planCode===A.value))==null?void 0:o.productRiskVoList)||[]:t=((r=d.value)==null?void 0:r.productRiskVoList)||[],t[0]}),Oe=async(t,e,o)=>{var n;const r={holder:{personVO:t.tenantOrderHolder},insuredVOList:t.tenantOrderInsuredList.map(u=>({insuredCode:"",personVO:u,productPlanVOList:[{insurerCode:e.productBasicInfoVO.insurerCode,planCode:A.value||0,riskVOList:it(o)}]}))};await M(r),I.value.tenantOrderInsuredList[0].tenantOrderProductList=(n=r.insuredVOList[0])==null?void 0:n.productPlanVOList},Ae=(t={},e={},o={})=>{var u;const r={...o},n={tenantId:m,riskList:((u=r.tenantOrderInsuredList[0])==null?void 0:u.tenantOrderProductList[0].riskVOList)||[],riskPremium:e,productId:t==null?void 0:t.productBasicInfoVO.id};return r.tenantOrderInsuredList[0].tenantOrderProductList[0]={premium:"",productCode:t.productBasicInfoVO.productCode,productName:t.productBasicInfoVO.productName,tenantOrderRiskList:pe(n)},r},Pe=async()=>{var o;I.value.venderCode=(o=d.value)==null?void 0:o.productBasicInfoVO.insurerCode;const{code:t,data:e}=await yt(Ae(d.value,{},I.value));t==="10000"&&console.log("123123",e)},we=async()=>{Oe(I.value,d.value,_e.value.riskDetailVOList),le.confirm({title:"\u5206\u4EAB",message:`\u5373\u5C06\u5411\u5BA2\u6237\u3010${I.value.tenantOrderHolder.name}\u3011\u53D1\u9001\u6295\u4FDD\u786E\u8BA4\u4FE1\u606F,\u8BF7\u786E\u8BA4\u662F\u5426\u7EE7\u7EED\uFF1F`}).then(()=>{Pe()})},Le=R(()=>{var t,e;return((e=(t=h.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:e.attachmentVOList.filter(o=>o.attachmentName==="\u5065\u5EB7\u544A\u77E5"))||[]}),Te=R(()=>{var t,e;return((e=(t=h.value)==null?void 0:t.tenantProductInsureVO)==null?void 0:e.attachmentVOList.filter(o=>o.attachmentName!=="\u5065\u5EB7\u544A\u77E5"))||[]}),ke=()=>{if(a.holder.certNo){const t=T(a.holder.certNo,"year"),e=Fe(a.holder.certNo);if(t<18)return y("\u6295\u4FDD\u4EBA\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E18\u5C81\uFF01"),!1;if(a.insured.certNo&&a.insured.relationToHolder===E.MATE){const o=Fe(a.insured.certNo);if(e===o)return y("\u88AB\u4FDD\u4EBA\u4E3A\u914D\u5076\u65F6\uFF0C\u6027\u522B\u4E0D\u53EF\u76F8\u540C\uFF01"),!1}}if(a.insured.certNo){const t=T(a.insured.certNo,"day"),e=T(a.insured.certNo,"year");if(a.insured.relationToHolder===E.CHILD&&t<30)return y("\u88AB\u4FDD\u4EBA\u4E3A\u5B50\u5973\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E30\u5929\uFF01"),!1;if(a.insured.relationToHolder===E.PARENT&&e>=71)return y("\u88AB\u4FDD\u4EBA\u4E3A\u7236\u6BCD\u65F6\uFF0C\u5E74\u9F84\u5FC5\u987B\u5C0F\u4E8E\u7B49\u4E8E70\u5C81\uFF01"),!1}if([E.CHILD,E.PARENT].includes(a.insured.relationToHolder)){const t=T(a.holder.certNo,"year"),e=T(a.insured.certNo,"year");if(a.insured.relationToHolder===E.CHILD&&t-e<18)return y("\u6295\u4FDD\u4EBA\u548C\u5B50\u5973\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1;if(a.insured.relationToHolder===E.PARENT&&e-t<18)return y("\u6295\u4FDD\u4EBA\u548C\u7236\u6BCD\u5E74\u9F84\u5FC5\u987B\u76F8\u5DEE18\u5C81\uFF01"),!1}return!0},Re=()=>{const{holder:{certNo:t,mobile:e,name:o,socialFlag:r},insured:{certNo:n,name:u,socialFlag:l,relationToHolder:s},paymentMethod:p}=a;return!!(vt(n)&&!!l)},Ve=()=>{he.push({path:"/internet/guaranteeUpgrade",query:{...Y.query,tenantId:m,productCode:"BWYL2022",orderNo:H,agentCode:_}})},Se=async t=>{y.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});try{const e=await pt(t),{code:o}=e;if(o==="10000"){y.loading({message:"\u6838\u4FDD\u4E2D...",forbidClick:!0});const r=await ft({orderNo:t.orderNo,tenantId:m}),{data:n}=r;r.code==="10000"&&(n.type===2?(X.value={show:!0,html:n.paymentUrl},console.log("data.paymentUrl",X.value),st(()=>{console.log("document.forms",document.forms);const u=document.getElementById("cashierSubmit");u==null||u.addEventListener("submit",l=>{l.preventDefault()}),u==null||u.submit()})):window.location.href=n.paymentUrl)}}catch(e){console.log(e)}},xe=t=>`${ve}/pay?orderNo=${t}&saleUserId=${_}&tenantId=${m}`,He=t=>`${ve}/internet/payFail?tenantId=${m}&orderNo=${t}&agentCode=${_}&pageCode=payBack&from=${De||"normal"}`,be=async t=>{console.log("risk",t);const e=lt({tenantId:m,saleUserId:_,saleChannelId:$,detail:h.value,insureDetail:d.value,paymentMethod:a.paymentMethod,paymentFrequency:a.paymentFrequency,renewalDK:a.renewalDK,iseeBizNo:b,successJumpUrl:"",premium:F.value,holder:a.holder,insured:a.insured,tenantOrderRiskList:t,orderStatus:"",orderTopStatus:""});try{const o=await mt(e),{code:r,data:n}=o;r==="10000"&&Se({...e,orderNo:n.data,extInfo:{extraInfo:{renewalDK:a.renewalDK,paymentMethod:a.paymentMethod,paymentFrequency:a.paymentFrequency,successJumpUrl:xe(n.data),failUrl:He(n.data)},iseeBizNo:b}})}catch(o){console.log(o)}},Ue=async()=>{const{calcData:t,riskVOList:e}=ce({holder:a.holder,insured:a.insured,tenantId:m,productDetail:h.value,insureDetail:d.value,paymentFrequency:a.paymentFrequency,packageRiskIdList:de(a.packageProductList)},!1,me);if(!Array.isArray(e)||e.length<1)return F.value=null,{};const o=await M(t),{code:r,data:n}=o;return r==="10000"?(F.value=n.premium,{condition:e,data:n}):(F.value=null,{})},Me=t=>{J.value=t,C.value=!0},qe=()=>new Promise((t,e)=>{var o,r;(r=(o=O.value)==null?void 0:o.validateForm)==null||r.call(o).then(async()=>{var g;if(!ke())return;if(!(((g=O.value)==null?void 0:g.isAgreeFile)||P.value)){P.value=!1,C.value=!0,Me(0);return}const{calcData:u,riskVOList:l}=ce({holder:a.holder,insured:a.insured,tenantId:m,productDetail:h.value,insureDetail:d.value,paymentFrequency:a.paymentFrequency,packageRiskIdList:de(a.packageProductList)},!1,me);(!Array.isArray(l)||l.length<1)&&(F.value=null,e(new Error));const s=await M(u),{code:p,data:f}=s;p==="10000"?(F.value=f.premium,t({condition:l,data:f})):(F.value=null,e(new Error))}).catch(()=>{})}),Ye=async()=>{var t;if(z){Ve();return}try{const{condition:e,data:o}=await qe(),r={},n=(l=[])=>{(l||[]).forEach(s=>{var p;r[s.riskCode]=s,(p=s.riskPremiumDetailVOList)!=null&&p.length&&n(s.riskPremiumDetailVOList)})};n(o.riskPremiumDetailVOList);const u=pe({tenantId:m,riskList:e,riskPremium:r,productId:(t=h.value)==null?void 0:t.id});be(u)}catch(e){console.log(e)}},$e=t=>{t==="allFalse"?(w.value=!1,P.value=!0,Ye()):le.confirm({message:"\u60A8\u5F53\u524D\u7684\u5065\u5EB7\u72B6\u51B5\u4E0D\u7B26\u5408\u8BE5\u4EA7\u54C1",confirmButtonText:"\u786E\u5B9A"}).then(()=>{window.history.back()}).catch(()=>{var e;(e=O.value)==null||e.reEditForm(),P.value=!1})},Z=()=>{var t;(t=O.value)==null||t.reEditForm(),P.value=!1},Ke=()=>{console.log("onCloseHealthPopup========"),w.value=!1,Z()},We=()=>{console.log("onCloseFilePreview========"),C.value=!1,Z()},je=()=>{C.value=!1,w.value=!0};ue(()=>h.value,()=>{console.log("123123")},{deep:!0}),ue([()=>a.insured.certNo,()=>a.insured.socialFlag,()=>a.packageProductList,()=>a.paymentFrequency],Ze.exports.debounce(()=>{a.insured.certNo&&a.insured.socialFlag&&Re()&&Ue()},500),{deep:!0,immediate:!0});const ee=async()=>{var r,n,u,l,s,p,f,g,te,ae,oe,re,ne;const t=await dt({orderNo:H,tenantId:m}),{code:e,data:o}=t;if(e==="10000"){const{tenantOrderHolder:v,tenantOrderInsuredList:i,extInfo:B}=o;if(!z){Object.assign(a,{holder:{certNo:v.certNo,certType:v.certType,mobile:v.mobile,name:v.name,socialFlag:S.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(r=i[0])==null?void 0:r.certType,name:(n=i[0])==null?void 0:n.name,socialFlag:(l=(u=i[0])==null?void 0:u.extInfo)==null?void 0:l.hasSocialInsurance,relationToHolder:(s=i[0])==null?void 0:s.relationToHolder},paymentMethod:B.extraInfo.paymentMethod,paymentFrequency:B.extraInfo.paymentFrequency,renewalDK:B.extraInfo.renewalDK||"N"});return}Object.assign(a,{holder:{certNo:v.certNo,certType:v.certType,mobile:v.mobile,name:v.name,socialFlag:S.HAS},insured:{certNo:i==null?void 0:i[0].certNo,certType:(p=i[0])==null?void 0:p.certType,name:(f=i[0])==null?void 0:f.name,socialFlag:(te=(g=i[0])==null?void 0:g.extInfo)==null?void 0:te.hasSocialInsurance,relationToHolder:(ae=i[0])==null?void 0:ae.relationToHolder},paymentMethod:B.extraInfo.paymentMethod,paymentFrequency:B.extraInfo.paymentFrequency,renewalDK:B.extraInfo.renewalDK||"N"}),F.value=(ne=(re=(oe=i[0])==null?void 0:oe.tenantOrderProductList)==null?void 0:re[0])==null?void 0:ne.premium,(o.orderStatus===q.ACCEPT_POLICY||o.orderStatus===q.PAYMENT_SUCCESS)&&(G.value=!1,Ne.value=!0),o.orderStatus===q.PAYING&&(G.value=!0,setTimeout(()=>{ee()},3*1e3))}},ze=async()=>{var o,r;const{code:t,data:e}=await ct({productCode:Ce});t==="10000"&&(a.packageProductList=(((o=e.data)==null?void 0:o.packageProductVOList)||[]).map(n=>({...n,value:gt.UN_INSURE,disabled:!1})),d.value=e,j.value=e.productFactor,(r=e==null?void 0:e.productRelationPlanVOList)!=null&&r.length&&(A.value=e.productRelationPlanVOList[0].planCode)),H&&ee()};return et(()=>{ze(),setTimeout(async()=>{b=window.getIseeBiz&&await window.getIseeBiz()},1500)}),(t,e)=>{const o=L("ProRadioButton"),r=L("ProCard"),n=L("van-button"),u=L("ProPageWrap"),l=L("van-config-provider");return U(),tt(ot,null,[D(l,{"theme-vars":V(Ee)},{default:N(()=>[D(u,{class:"net-sale-wrap"},{default:N(()=>{var s,p;return[x("div",Dt,at((p=(s=d.value)==null?void 0:s.productBasicInfoVO)==null?void 0:p.productFullName),1),V(Q)?(U(),se(r,{key:0,title:"\u4FDD\u969C\u5E74\u671F"},{default:N(()=>{var f;return[D(o,{modelValue:A.value,"onUpdate:modelValue":e[0]||(e[0]=g=>A.value=g),class:"radio-group",prop:{label:"planName",value:"planCode"},options:(f=d.value)==null?void 0:f.productRelationPlanVOList},null,8,["modelValue","options"])]}),_:1})):ie("",!0),D(Et,{ref_key:"formRef",ref:O,"title-collection":{HOLDER:"\u672C\u4EBA\u4FE1\u606F\uFF08\u6295\u4FDD\u4EBA\uFF09",INSURER:"\u4E3A\u8C01\u6295\u4FDD\uFF08\u88AB\u4FDD\u4EBA\uFF09",BENEFICIARY:"\u6536\u76CA\u4EBA"},"form-info":I.value,"send-sms-code":()=>{},"input-align":"left","factor-object":j.value},{holderName:N(()=>[Nt]),insurerName:N(()=>[_t]),_:1},8,["form-info","send-sms-code","factor-object"]),x("div",Ot,[D(n,{type:"primary",block:"",onClick:we},{default:N(()=>[At]),_:1})])]}),_:1})]),_:1},8,["theme-vars"]),D(It,{show:w.value,"onUpdate:show":e[1]||(e[1]=s=>w.value=s),"content-list":V(Le),"active-index":0,onOnConfirmHealth:$e,onOnCloseHealth:Ke},null,8,["show","content-list"]),C.value?(U(),se(Bt,{key:0,show:C.value,"onUpdate:show":e[2]||(e[2]=s=>C.value=s),"content-list":V(Te),"active-index":J.value,text:"\u6211\u5DF2\u9010\u9875\u9605\u8BFB\u5E76\u786E\u8BA4\u544A\u77E5\u5185\u5BB9","force-read-cound":2,"on-close-file-preview":"",onSubmit:je,onOnCloseFilePreview:We},null,8,["show","content-list","active-index"])):ie("",!0)],64)}}});var $t=Ft(Pt,[["__scopeId","data-v-7c7e84a8"]]);export{$t as default};
